<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЦ╝я╕П ЁЯТЫ ЁЯдЫЁЯП╗ рдПрдХрддрд╛ рд╣реЗрдХреНрд╕рд╛рдЧреЛрди рдореИрдкреНрд╕: рд░рдлрдиреЗрд╕, рдирджрд┐рдпрд╛рдВ рдФрд░ рд╕рдбрд╝рдХреЗрдВ ЁЯд╕ ЁЯХд ЁЯНй</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рднрд╛рдЧ 1-3: рдЬрд╛рд▓, рд░рдВрдЧ рдФрд░ рд╕реЗрд▓ рдКрдБрдЪрд╛рдИ 

 рднрд╛рдЧ 4-7: рдзрдХреНрдХреЛрдВ, рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ 

 рднрд╛рдЧ 8-11: рдЬрд▓, рднреВ-рднрд╛рдЧ рдФрд░ рдкреНрд░рд╛рдЪреАрд░ 

 12-15 рднрд╛рдЧ: рдмрдЪрдд рдФрд░ рд▓реЛрдбрд┐рдВрдЧ, рдмрдирд╛рд╡рдЯ, рджреВрд░рд┐рдпрд╛рдВ 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдПрдХрддрд╛ рд╣реЗрдХреНрд╕рд╛рдЧреЛрди рдореИрдкреНрд╕: рд░рдлрдиреЗрд╕, рдирджрд┐рдпрд╛рдВ рдФрд░ рд╕рдбрд╝рдХреЗрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424491/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/716/b6b/8a9/716b6b8a9d024dc87b2d645b5d4bdbb6.jpg" alt="рдЫрд╡рд┐"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 1-3: рдЬрд╛рд▓, рд░рдВрдЧ рдФрд░ рд╕реЗрд▓ рдКрдБрдЪрд╛рдИ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 4-7: рдзрдХреНрдХреЛрдВ, рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 8-11: рдЬрд▓, рднреВ-рднрд╛рдЧ рдФрд░ рдкреНрд░рд╛рдЪреАрд░</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">12-15 рднрд╛рдЧ: рдмрдЪрдд рдФрд░ рд▓реЛрдбрд┐рдВрдЧ, рдмрдирд╛рд╡рдЯ, рджреВрд░рд┐рдпрд╛рдВ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 16-19: рд░рд╛рд╕реНрддрд╛ рдЦреЛрдЬрдирд╛, рдЦрд┐рд▓рд╛рдбрд╝реА рджрд╕реНрддреЗ, рдПрдирд┐рдореЗрд╢рди</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 20-23: рдХреЛрд╣рд░реЗ рдХреЗ рдпреБрджреНрдз, рдорд╛рдирдЪрд┐рддреНрд░ рдЕрдиреБрд╕рдВрдзрд╛рди, рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдкреАрдврд╝реА</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 24-27: рдЬрд▓ рдЪрдХреНрд░, рдЕрдкрд░рджрди, рдмрд╛рдпреЛрдо, рдмреЗрд▓рдирд╛рдХрд╛рд░ рдирдХреНрд╢рд╛</a> <br><br><h1>  рднрд╛рдЧ 4: рдЦреБрд░рджрд░рд╛рдкрди </h1><br><h2>  рд╕рд╛рдордЧреНрд░реА рдХреА рддрд╛рд▓рд┐рдХрд╛ </h2><br><ul><li>  рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ред </li><li>  рд╕рд┐рд░реЛрдВ рдХреЛ рдШреБрдорд╛рдПрдВред </li><li>  рд╣рдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд╕рдорддрд▓рддрд╛ рдХреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </li><li>  рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдЙрдк-рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░реЗрдВред </li></ul><br>  рдЬрдмрдХрд┐ рд╣рдорд╛рд░рд╛ рдЧреНрд░рд┐рдб рдордзреБрдХреЛрд╢ рдХрд╛ рдПрдХ рд╕рдЦреНрдд рдкреИрдЯрд░реНрди рдерд╛ред  рдЗрд╕ рднрд╛рдЧ рдореЗрдВ, рд╣рдо рдирдХреНрд╢реЗ рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рдкреНрд░рд╛рдХреГрддрд┐рдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдзрдХреНрдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝реЗрдВрдЧреЗред <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e33/034/982/e33034982aafb942e1e656b76dde0981.png"></div><br>  <i>рдХреЛрдИ рдФрд░ рднреА рд╣реЗрдХреНрд╕рд╛рдЧреЛрдиреНрд╕ред</i> <br><br><h2>  рд╢реЛрд░ </h2><br>  рдзрдХреНрдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдпрд╛рджреГрдЪреНрдЫрд┐рдХрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рд╣реА рдпрд╛рджреГрдЪреНрдЫрд┐рдХрддрд╛ рдирд╣реАрдВред  рд╣рдо рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдирдХреНрд╢рд╛ рдмрджрд▓рддреЗ рд╕рдордп рд╕рдм рдХреБрдЫ рд╕реБрд╕рдВрдЧрдд рд╣реЛред  рдЕрдиреНрдпрдерд╛, рдЬрдм рдЖрдк рдХреЛрдИ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреВрдж рдЬрд╛рдПрдВрдЧреЗред  рдпрд╣реА рд╣реИ, рд╣рдореЗрдВ рдХреБрдЫ рдкреНрд░рдХрд╛рд░ рдХреЗ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдЫрджреНрдо рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╢реЛрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рдПрдХ рдЕрдЪреНрдЫрд╛ рдЙрдореНрдореАрджрд╡рд╛рд░ рдкреЗрд░рд▓рд┐рди рдХрд╛ рд╢реЛрд░ рд╣реИред  рдпрд╣ рдХрд╣реАрдВ рднреА рдкреНрд░рдЬрдирди рдпреЛрдЧреНрдп рд╣реИред  рдХрдИ рдЖрд╡реГрддреНрддрд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╕рдордп, рдпрд╣ рд╢реЛрд░ рднреА рдмрдирд╛рддрд╛ рд╣реИ, рдЬреЛ рдмрдбрд╝реА рджреВрд░реА рдкрд░ рдмрд╣реБрдд рднрд┐рдиреНрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЫреЛрдЯреА рджреВрд░реА рдкрд░ рд▓рдЧрднрдЧ рд╕рдорд╛рди рд░рд╣рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдЪрд┐рдХрдиреА рд╡рд┐рдХреГрддрд┐рдпреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдПрдХ рджреВрд╕рд░реЗ рд╕реЗ рд╕рдЯреЗ рдмрд┐рдВрджреБ рдЖрдорддреМрд░ рдкрд░ рдкрд╛рд╕ рдореЗрдВ рд░рд╣рддреЗ рд╣реИрдВ, рдФрд░ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рдмрд┐рдЦрд░реЗ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред <br><br>  рд╣рдо рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рдкреЗрд░рд▓рд┐рди рд╢реЛрд░ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╢реЛрд░</a> рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ, рдореИрдВ рд╕рдордЭрд╛рддрд╛ рд╣реВрдВ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИред  рд▓реЗрдХрд┐рди рд╣рдо рдкреВрд░реНрд╡-рдирд┐рд░реНрдорд┐рдд рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рд╕реЗ рднреА рдирдореВрдирд╛ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВред  рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рд▓рд╛рдн рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рдкреЗрд░рд▓рд┐рди рдХреА рдмрд╣реБ-рдЖрд╡реГрддреНрддрд┐ рд╢реЛрд░ рдХреА рдЧрдгрдирд╛ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╕рд░рд▓ рдФрд░ рдмрд╣реБрдд рддреЗрдЬ рд╣реИред  рдЗрд╕рдХрд╛ рдиреБрдХрд╕рд╛рди рдпрд╣ рд╣реИ рдХрд┐ рдмрдирд╛рд╡рдЯ рдЕрдзрд┐рдХ рдореЗрдореЛрд░реА рд▓реЗрддреА рд╣реИ рдФрд░ рд╢реЛрд░ рдХреЗ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдХрд╡рд░ рдХрд░рддреА рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдкрд░реНрдпрд╛рдкреНрдд рдмрдбрд╝рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рд╣рдбрд╝рддрд╛рд▓реА рди рд╣реЛред <br><br><h3>  рд╢реЛрд░ рдмрдирд╛рд╡рдЯ </h3><br>  рд╣рдо рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╢реЛрд░</a> рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИред  рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рдмрдирд╛рд╡рдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрд╣рд╛рдБ рдпрд╣ рд╣реИ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbd/8e8/5d7/fbd8e85d783626c737decd6bc69a2519.png"></div><br>  <i>рдирд┐рд░реНрдмрд╛рдз рд░реВрдк рд╕реЗ рдкрд░реНрд▓рд┐рди рд╢реЛрд░ рдХреА рдмрдирд╛рд╡рдЯ рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред</i> <br><br>  рдКрдкрд░ рджрд┐рдЦрд╛рдИ рдЧрдИ рдмрдирд╛рд╡рдЯ рдореЗрдВ рдкрд░реНрд▓рд┐рди рдХреА рдореВрд▓ рд░реВрдк рд╕реЗ рдпреБрдЧреНрдорд┐рдд рдмрд╣реБ-рдЖрд╡реГрддреНрддрд┐ рд╢реЛрд░ рд╢рд╛рдорд┐рд▓ рд╣реИред  рдпрд╣ рдПрдХ рдЧреНрд░реЗрд╕реНрдХреЗрд▓ рдЗрдореЗрдЬ рд╣реИред  рдЗрд╕рдХрд╛ рдФрд╕рдд рдорд╛рди 0.5 рд╣реИ, рдФрд░ рдЪрд░рдо рдорд╛рди 0 рдФрд░ 1 рддрдХ рд╣реИред <br><br>  рд▓реЗрдХрд┐рди рд░реБрдХрд┐рдП, рдкреНрд░рддреНрдпреЗрдХ рдмрд┐рдВрджреБ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдПрдХ рдореВрд▓реНрдп рд╣реИред  рдпрджрд┐ рд╣рдореЗрдВ 3 рдбреА рд╡рд┐рд░реВрдкрдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рддреАрди рдЫрджреНрдо рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдирдореВрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ!  рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдЕрд▓рдЧ рд╢реЛрд░ рдХреЗ рд╕рд╛рде рджреЛ рдФрд░ рдмрдирд╛рд╡рдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рд╣рдо рдЙрдиреНрд╣реЗрдВ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдкреНрд░рддреНрдпреЗрдХ рд░рдВрдЧ рдЪреИрдирд▓реЛрдВ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╢реЛрд░ рдореВрд▓реНрдпреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рд╣рдореЗрдВ рдПрдХ рдмрдирд╛рд╡рдЯ рдореЗрдВ рдЪрд╛рд░ рд╢реЛрд░ рдкреИрдЯрд░реНрди рддрдХ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред  рдпрд╣рд╛рдБ рдпрд╣ рдмрдирд╛рд╡рдЯ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a1d/509/aca/a1d509acaf05d64de002829afc59cb90.png"></div><br>  <i>рдПрдХ рдореЗрдВ рдЪрд╛рд░ред</i> <br><br><div class="spoiler">  <b class="spoiler_title">рдЗрд╕ рддрд░рд╣ рдХреА рдмрдирд╛рд╡рдЯ рдХреИрд╕реЗ рдмрдирд╛рдПрдВ?</b> <div class="spoiler_text">  рдореИрдВрдиреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирдВрдмрд░рдлреНрд▓реЛ рдХрд╛</a> рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ред  рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдмрдирд╛рд╡рдЯ рд╕рдВрдкрд╛рджрдХ рд╣реИ рдЬрд┐рд╕реЗ рдореИрдВрдиреЗ рдПрдХрддрд╛ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рд╣реИред </div></div><br>  рдЗрд╕ рдмрдирд╛рд╡рдЯ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдЕрдкрдиреА рдПрдХрддрд╛ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдЖрдпрд╛рдд рдХрд░реЗрдВред  рдЪреВрдВрдХрд┐ рд╣рдо рдХреЛрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ, рдпрд╣ рдкрдардиреАрдп рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  <em>рдЯреЗрдХреНрд╕рдЪрд░ рдкреНрд░рдХрд╛рд░</em> рдХреЛ <em>рдЙрдиреНрдирдд рдкрд░</em> рд╕реНрд╡рд┐рдЪ рдХрд░реЗрдВ рдФрд░ <em>рдкрдврд╝реЗрдВ / рд╕рдХреНрд╖рдо рд╕рдХреНрд╖рдо рдХрд░реЗрдВ</em> ред  рдпрд╣ рдмрдирд╛рд╡рдЯ рдбреЗрдЯрд╛ рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рдмрдЪрд╛рдПрдЧрд╛ рдФрд░ C # рдХреЛрдб рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  <em>рдкреНрд░рд╛рд░реВрдк</em> рдХреЛ <em>рд╕реНрд╡рдЪрд╛рд▓рд┐рдд Truecolor рдкрд░</em> рд╕реЗрдЯ рдХрд░реЗрдВ, рдЕрдиреНрдпрдерд╛ рдХреБрдЫ рднреА рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред  рд╣рдо рдЕрдкрдиреЗ рд╢реЛрд░ рдкреИрдЯрд░реНрди рдХреЛ рдирд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рд╡рдЯ рд╕рдВрдкреАрдбрд╝рди рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рд╣реИрдВред <br><br>  рдЖрдк <em>рдЬрдирд░реЗрдЯ рдореИрдк рдореИрдкреНрд╕</em> рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рдЙрдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ <em>рдмрд╛рдпрдкрд╛рд╕ sRGB рд╕реИрдВрдкрд▓рд┐рдВрдЧ рдХреЛ</em> рд╕рдХреНрд╖рдо рдХрд░реЗрдВред  рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреА, рд▓реЗрдХрд┐рди рдРрд╕рд╛ рд╣реЛрдЧрд╛ред  рдпрд╣ рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдмрдирд╛рд╡рдЯ рдореЗрдВ рдЧрд╛рдорд╛ рд╕реНрдерд╛рди рдореЗрдВ рд░рдВрдЧ рдбреЗрдЯрд╛ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3aa/c36/e45/3aac36e45d7ead64823dc57b55afe67e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5fe/6c8/99a/5fe6c899a966eecb34046d5c243036b7.png"></div><br>  рдЖрдпрд╛рддрд┐рдд рд╢реЛрд░ рдмрдирд╛рд╡рдЯред <br><br><div class="spoiler">  <b class="spoiler_title">SRGB рдирдореВрдирд╛ рдХрдм рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ?</b> <div class="spoiler_text">  рдпрджрд┐ рд╣рдо рдХрд┐рд╕реА рд╢реИрдбрд░ рдореЗрдВ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рд╕реЗ рдлрд░реНрдХ рдкрдбрд╝реЗрдЧрд╛ред  рд░реИрдЦрд┐рдХ рд░реЗрдВрдбрд░рд┐рдВрдЧ рдореЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЧрд╛рдорд╛ рд╕реЗ рд░реИрдЦрд┐рдХ рд░рдВрдЧ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рд░рдВрдЧ рдбреЗрдЯрд╛ рдХреЛ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИред  рд╣рдорд╛рд░реЗ рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдЧрд▓рдд рдкрд░рд┐рдгрд╛рдо рджреЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </div></div><br><div class="spoiler">  <b class="spoiler_title">рдореЗрд░реА рдмрдирд╛рд╡рдЯ рдЖрдпрд╛рдд рд╕реЗрдЯрд┐рдВрдЧ рдЕрд▓рдЧ рдХреНрдпреЛрдВ рджрд┐рдЦрддреА рд╣реИрдВ?</b> <div class="spoiler_text">  рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдХреЗ рд▓рд┐рдЦреЗ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж рдЙрдиреНрд╣реЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ рдЧрдпрд╛ред  рдЖрдкрдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ 2D рдмрдирд╛рд╡рдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, <em>sRGB (рд░рдВрдЧ рдмрдирд╛рд╡рдЯ)</em> рдХреЛ рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ <em>рд╕рдВрдкреАрдбрд╝рди</em> рдХреЛ рдХрд┐рд╕реА рдкрд░ рд╕реЗрдЯ <em>рдирд╣реАрдВ</em> рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </div></div><br><h3>  рд╢реЛрд░ рдХрд╛ рдирдореВрдирд╛ </h3><br>  рдЪрд▓реЛ <code>HexMetrics</code> рд╢реЛрд░ рдирдореВрдирд╛ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ <code>HexMetrics</code> рддрд╛рдХрд┐ рдЖрдк рдЗрд╕реЗ рдХрд╣реАрдВ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдВред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ <code>HexMetrics</code> рдореЗрдВ рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдХрд╛ рд╕рдВрджрд░реНрдн рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Texture2D noiseSource;</code> </pre> <br>  рдЪреВрдВрдХрд┐ рдпрд╣ рдПрдХ рдШрдЯрдХ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рд╕рдВрдкрд╛рджрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдмрдирд╛рд╡рдЯ рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рдПрдХ рдордзреНрдпрд╕реНрде рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдо <code>HexGrid</code> рдЙрдкрдпреЛрдЧ <code>HexGrid</code> ред  рдЪреВрдВрдХрд┐ <code>HexGrid</code> рдкрд╣рд▓реЗ рдХрд╛рд░реНрдп рдХрд░реЗрдЧрд╛, рдпрд╣ рдареАрдХ рд╣реЛрдЧрд╛ рдпрджрд┐ рд╣рдо рдЗрд╕рдХреА <code>Awake</code> рд╡рд┐рдзрд┐ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдмрдирд╛рд╡рдЯ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Texture2D noiseSource; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; тАж }</code> </pre> <br>  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг Play рдореЛрдб рдореЗрдВ рдкреБрдирд░реНрд╕рдВрдпреЛрдЬрди рд╕реЗ рдирд╣реАрдВ рдмрдЪреЗрдЧрд╛ред  рд╕реНрдЯреИрдЯрд┐рдХ рд╡реИрд░рд┐рдПрдмрд▓ рдХреЛ рдПрдХрддрд╛ рдЗрдВрдЬрди рджреНрд╡рд╛рд░рд╛ рдХреНрд░рдордмрджреНрдз рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, <code>OnEnable</code> рдЗрд╡реЗрдВрдЯ рдкрджреНрдзрддрд┐ рдореЗрдВ рдмрдирд╛рд╡рдЯ рдХреЛ рдкреБрди: рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВред  рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рдкреБрдирд░реНрд╕рдВрдпреЛрдЬрди рдХреЗ рдмрд╛рдж рдХрд╣рд╛ рдЬрд╛рдПрдЧрд╛ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d87/4fd/3a5/d874fd3a57faad4e57e5af830b202a19.png"></div><br>  <i>рдПрдХ рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВред</i> <br><br>  рдЕрдм рдЬрдм <code>HexMetrics</code> рдХреА рдмрдирд╛рд╡рдЯ рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ, рддреЛ рдЖрдЗрдП рдЗрд╕рдореЗрдВ рдПрдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╢реЛрд░ рдирдореВрдирд╛ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВред  рдпрд╣ рд╡рд┐рдзрд┐ рджреБрдирд┐рдпрд╛ рдореЗрдВ рдПрдХ рд╕реНрдерд┐рддрд┐ рд▓реЗрддреА рд╣реИ рдФрд░ 4 рдбреА рд╡реЗрдХреНрдЯрд░ рдмрдирд╛рддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЪрд╛рд░ рд╢реЛрд░ рдирдореВрдиреЗ рд╣реЛрддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleNoise</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br>  рдмрд┐рд▓рд┐рдирд┐рдпрд░ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рд╡рдЯ рдХреЗ рдирдореВрдиреЗ рджреНрд╡рд╛рд░рд╛ рдирдореВрдиреЗ рдмрдирд╛рдП рдЧрдП рдереЗ, рдЬрд┐рд╕рдореЗрдВ рджреБрдирд┐рдпрд╛ рдХреЗ рдПрдХреНрд╕ рдФрд░ рдЬреЗрдб рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░рд╛ рд╢реЛрд░ рд╕реНрд░реЛрдд рджреЛ-рдЖрдпрд╛рдореА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рджреБрдирд┐рдпрд╛ рдХреЗ рддреАрд╕рд░реЗ рд╕рдордиреНрд╡рдп рдХреА рдЙрдкреЗрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВред  рдпрджрд┐ рд╢реЛрд░ рд╕реНрд░реЛрдд рддреАрди-рдЖрдпрд╛рдореА рдерд╛, рддреЛ рд╣рдо рд╡рд╛рдИ рд╕рдордиреНрд╡рдп рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br><br>  рдирддреАрдЬрддрди, рд╣рдореЗрдВ рдПрдХ рд░рдВрдЧ рдорд┐рд▓рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ 4D рд╡реЗрдХреНрдЯрд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХреА рдХрдореА рдЕрдкреНрд░рддреНрдпрдХреНрд╖ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЕрд░реНрдерд╛рдд рд╣рдо рд╕реАрдзреЗ рд░рдВрдЧ рд╡рд╛рдкрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ <code>(Vector4)</code> рд╕рд╣рд┐рддред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleNoise</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> noiseSource.GetPixelBilinear(position.x, position.z); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рдмрд┐рд▓рд┐рдирд┐рдпрд░ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?</b> <div class="spoiler_text">  рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдФрд░ рдмрдирд╛рд╡рдЯ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рддрд┐рдкрд╛рджрди 2</a> рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">, рд╢реЗрдбрд░ рдлрдВрдбрд╛рдореЗрдВрдЯрд▓реНрд╕ рджреЗрдЦреЗрдВ</a> ред </div></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">unitypackage</a> <br><br><h2>  рд╡рд░реНрдЯреЗрдХреНрд╕ рдЖрдВрджреЛрд▓рди </h2><br>  рд╣рдо рдЫрддреНрддреЗ рдХреА рд╣рдорд╛рд░реА рдЪрд┐рдХрдиреА рдЧреНрд░рд┐рдб рдХреЛ рд╡рд┐рдХреГрдд рдХрд░реЗрдВрдЧреЗ, рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЛрдиреЗ рдХреЛ рдШреБрдорд╛рддреЗ рд╣реБрдПред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЪрд▓рд┐рдП <code>Perturb</code> рдкрджреНрдзрддрд┐ рдХреЛ <code>Perturb</code> ред  рдпрд╣ рдПрдХ unmoving рдмрд┐рдВрджреБ рд▓реЗрддрд╛ рд╣реИ рдФрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдПрдХ рдХреЛ рд╡рд╛рдкрд╕ рдХрд░рддрд╛ рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд╣ рд╢реЛрд░ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрддреЗ рд╕рдордп рдПрдХ рдЧреИрд░-рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдмрд┐рдВрджреБ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = HexMetrics.SampleNoise(position); }</code> </pre> <br>  рдЖрдЗрдП рдмрд╕ рд╢реЛрд░ рдХреЗ рдирдореВрдиреЗ X, Y рдФрд░ Z рдХреЛ рд╕рдВрдмрдВрдзрд┐рдд рдмрд┐рдВрджреБ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рд╕реАрдзреЗ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = HexMetrics.SampleNoise(position); position.x += sample.x; position.y += sample.y; position.z += sample.z; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br>  рд╣рдо рд╕рднреА рдХреЛрдиреЗ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>HexMesh</code> рдХреЛ рдЬрд▓реНрджреА рд╕реЗ рдХреИрд╕реЗ рдмрджрд▓рддреЗ рд╣реИрдВ?  <code>AddTriangle</code> рдФрд░ <code>AddQuad</code> рдореЗрдВ рд╕реВрдЪреА рдореЗрдВ рд╢реАрд░реНрд╖ рдЬреЛрдбрд╝рддреЗ рд╕рдордп рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдХреЛ рдмрджрд▓рдХрд░ред  рдЪрд▓реЛ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 v1, Vector3 v2, Vector3 v3</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertexIndex = vertices.Count; vertices.Add(Perturb(v1)); vertices.Add(Perturb(v2)); vertices.Add(Perturb(v3)); тАж } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertexIndex = vertices.Count; vertices.Add(Perturb(v1)); vertices.Add(Perturb(v2)); vertices.Add(Perturb(v3)); vertices.Add(Perturb(v4)); тАж }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рдХреНрдпрд╛ рдЪрддреБрд░реНрднреБрдЬ рдЕрдкрдиреЗ рд╢реАрд░реНрд╖рдХреЛрдВ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╕рдкрд╛рдЯ рд░рд╣реЗрдВрдЧреЗ?</b> <div class="spoiler_text">  рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реИред  рдЙрдирдореЗрдВ рджреЛ рддреНрд░рд┐рдХреЛрдг рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдЕрдм рдПрдХ рд╣реА рд╡рд┐рдорд╛рди рдореЗрдВ рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЪреВрдВрдХрд┐ рдЗрди рддреНрд░рд┐рднреБрдЬреЛрдВ рдореЗрдВ рджреЛ рд╕рд╛рдорд╛рдиреНрдп рдХреЛрдиреЗ рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЗрди рдХреЛрдгреЛрдВ рдХреЗ рдорд╛рдирджрдВрдбреЛрдВ рдХреЛ рд╕реБрдЪрд╛рд░реВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рджреЛ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреЗ рдмреАрдЪ рддреЗрдЬ рдмрджрд▓рд╛рд╡ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред  рдпрджрд┐ рд╡рд┐рдХреГрддрд┐ рдмрд╣реБрдд рдмрдбрд╝реА рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рдЕрднреА рднреА рдЪрддреБрд╖реНрдХреЛрдг рдХреЛ рд╕рдкрд╛рдЯ рд╕рдордЭреЗрдВрдЧреЗред </div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/589/55c/47d/58955c47d221104096d943df9f9b948c.png"></div><br>  <i>рдХреЛрдиреЗ рдпрд╛ рддреЛ рдЪрд▓реЗ рдЧрдП рд╣реИрдВ рдпрд╛ рдирд╣реАрдВред</i> <br><br>  рд╣рд╛рд▓рд╛рдВрдХрд┐ рдкрд░рд┐рд╡рд░реНрддрди рдмрд╣реБрдд рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реИрдВ, рдХреЗрд╡рд▓ рд╕реЗрд▓ рд▓реЗрдмрд▓ рдЧрд╛рдпрдм рд╣реЛ рдЧрдП рд╣реИрдВред  рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реБрдЖ рдХреНрдпреЛрдВрдХрд┐ рд╣рдордиреЗ рд╢реЛрд░ рдХреЗ рдирдореВрдиреЛрдВ рдХреЛ рдЕрдВрдХреЛрдВ рдореЗрдВ рдЬреЛрдбрд╝рд╛, рдФрд░ рд╡реЗ рд╣рдореЗрд╢рд╛ рд╕рдХрд╛рд░рд╛рддреНрдордХ рд░рд╣реЗред  рдЗрд╕рд▓рд┐рдП, рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╕рднреА рддреНрд░рд┐рдХреЛрдг рдЕрдкрдиреЗ рдирд┐рд╢рд╛рди рд╕реЗ рдКрдкрд░ рдЙрдареЗ, рдЙрдиреНрд╣реЗрдВ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ред  рд╣рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рдХреЗрдВрджреНрд░ рдореЗрдВ рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рд╡реЗ рджреЛрдиреЛрдВ рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рд╣реЛред  рд╢реЛрд░ рдирдореВрдиреЗ рдХреЗ рдЕрдВрддрд░рд╛рд▓ рдХреЛ 0-1 рд╕реЗ тАУ1тАУ1 рддрдХ рдмрджрд▓реЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = HexMetrics.SampleNoise(position); position.x += sample.x * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>; position.y += sample.y * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>; position.z += sample.z * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f0/bd6/83a/1f0bd683ad92592fa6c5df171eab646c.png"></div><br>  <i>рдХреЗрдиреНрджреНрд░рд┐рдд рд╡рд┐рд╕реНрдерд╛рдкрдиред</i> <br><br><h3>  рд╡рд┐рд╕реНрдерд╛рдкрди рдХрд╛ рдкрд░рд┐рдорд╛рдг (рдмрд▓) </h3><br>  рдЕрдм рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рд╣рдордиреЗ рдЧреНрд░рд┐рдб рдХреЛ рд╡рд┐рдХреГрдд рдХрд░ рджрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдкреНрд░рднрд╛рд╡ рдореБрд╢реНрдХрд┐рд▓ рд╕реЗ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдЖрдпрд╛рдо рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди 1 рдЗрдХрд╛рдИ рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реИред  рдпрд╣реА рд╣реИ, рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рдЕрдзрд┐рдХрддрдо рд╡рд┐рд╕реНрдерд╛рдкрди тЙИ3 units 1.73 рдЗрдХрд╛рдЗрдпрд╛рдВ рд╣реИрдВ, рдЬреЛ рдХрд┐ рдмрд╣реБрдд рдХрдо рд╣реА рд╣реЛрдЧрд╛, рдпрджрд┐ рдмрд┐рд▓реНрдХреБрд▓ рднреА рд╣реЛред  рдЪреВрдВрдХрд┐ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдмрд╛рд╣рд░реА рддреНрд░рд┐рдЬреНрдпрд╛ 10 рдЗрдХрд╛рдЗрдпрд╛рдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╡рд┐рд╕реНрдерд╛рдкрди рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдЫреЛрдЯрд╛ рд╣реИред <br><br>  рд╕рдорд╛рдзрд╛рди <code>HexMetrics</code> рд▓рд┐рдП рдПрдХ <code>HexMetrics</code> рдкреИрд░рд╛рдореАрдЯрд░ <code>HexMetrics</code> рддрд╛рдХрд┐ рдЖрдк рдЖрдВрджреЛрд▓рдиреЛрдВ рдХреЛ рд╕реНрдХреЗрд▓ рдХрд░ рд╕рдХреЗрдВред  рдЖрдЗрдП рдмрд▓ рдкреНрд░рдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ 5. рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рдЕрдзрд┐рдХрддрдо рд╡рд┐рд╕реНрдерд╛рдкрди тЙИ75 6 8.66 рдЗрдХрд╛рдИ рд╣реЛрдЧрд╛, рдЬреЛ рдХрд┐ рдЕрдзрд┐рдХ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cellPerturbStrength = <span class="hljs-number"><span class="hljs-number">5f</span></span>;</code> </pre> <br>  рд╣рдо <code>HexMesh.Perturb</code> рдореЗрдВ рдирдореВрдиреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЗрд╕реЗ рдЧреБрдгрд╛ рдХрд░рдХреЗ рдмрд▓ рд▓рд╛рдЧреВ <code>HexMesh.Perturb</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = HexMetrics.SampleNoise(position); position.x += (sample.x * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * HexMetrics.cellPerturbStrength; position.y += (sample.y * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * HexMetrics.cellPerturbStrength; position.z += (sample.z * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * HexMetrics.cellPerturbStrength; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fa8/2ef/fc0/fa82effc05a418729e81ee54f0922f26.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b19/fc8/3f0/b19fc83f0828160b2100a346083f1047.png"></div><br>  <i>рдмрдврд╝реА рд╣реБрдИ рддрд╛рдХрддред</i> <br><br><h3>  рд╢реЛрд░ рдкреИрдорд╛рдирд╛ </h3><br>  рдпрджреНрдпрдкрд┐ рдЧреНрд░рд┐рдб рдкрд░рд┐рд╡рд░реНрддрди рд╕реЗ рдкрд╣рд▓реЗ рдЕрдЪреНрдЫрд╛ рджрд┐рдЦрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рдм рдХреБрдЫ рдЧрд▓рдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рд╕реАрд╕рд╛ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред  рдЙрдирдХреА рдЪреЛрдЯрд┐рдпрд╛рдВ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд░реВрдк рд╕реЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рд╡рд┐рдХреГрдд рд╣реЛ рд╕рдХрддреА рд╣реИрдВ, рдЕрд░рд╛рдЬрдХрддрд╛ рдкреИрджрд╛ рдХрд░ рд╕рдХрддреА рд╣реИрдВред  рдкреЗрд░рд▓рд┐рди рд╢реЛрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдпрд╣ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рд╕рдорд╕реНрдпрд╛ рдЗрд╕рд▓рд┐рдП рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рд╕реАрдзреЗ рд╢реЛрд░ рдХреЗ рдирдореВрдиреЗ рдХреЗ рд▓рд┐рдП рджреБрдирд┐рдпрд╛ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕ рд╡рдЬрд╣ рд╕реЗ, рдмрдирд╛рд╡рдЯ рдкреНрд░рддреНрдпреЗрдХ рдЗрдХрд╛рдИ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЫрд┐рдкреА рд╣реБрдИ рд╣реИ, рдФрд░ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдЗрд╕ рдореВрд▓реНрдп рд╕реЗ рдмрд╣реБрдд рдмрдбрд╝реА рд╣реИрдВред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдмрдирд╛рд╡рдЯ рдХреЛ рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рдмрд┐рдВрджреБрдУрдВ рдкрд░ рдорд╛рдкрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЗрд╕рдХреА рдореМрдЬреВрджрд╛ рдЕрдЦрдВрдбрддрд╛ рдирд╖реНрдЯ рд╣реЛ рдЬрд╛рддреА рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3f/bd1/717/f3fbd1717515fdf4e500e9674d82a08f.png"></div><br>  <i>10 рд╕реЗ 10 рдЧреНрд░рд┐рдб рдУрд╡рд░рд▓реИрдк рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдкрдВрдХреНрддрд┐рдпрд╛рдБред</i> <br><br>  рд╣рдореЗрдВ рд╢реЛрд░ рдХреЗ рдирдореВрдиреЗ рдХреЛ рд╕реНрдХреЗрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдмрдирд╛рд╡рдЯ рдмрд╣реБрдд рдмрдбрд╝реЗ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдХрд╡рд░ рдХрд░реЗред  рдЪрд▓реЛ рдЗрд╕ рдкреИрдорд╛рдиреЗ рдХреЛ <code>HexMetrics</code> рдФрд░ рдЗрд╕реЗ 0.003 рдХрд╛ рдорд╛рди рджреЗрддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдЗрд╕ рдХрд╛рд░рдХ рджреНрд╡рд╛рд░рд╛ рдирдореВрдиреЛрдВ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рд╕реНрдХреЗрд▓ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> noiseScale = <span class="hljs-number"><span class="hljs-number">0.003f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleNoise</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> noiseSource.GetPixelBilinear( position.x * noiseScale, position.z * noiseScale ); }</code> </pre> <br>  рдпрд╣ рдЕрдЪрд╛рдирдХ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реА рдмрдирд╛рд╡рдЯ 333 &amp; frac13;  рд╡рд░реНрдЧ рдЗрдХрд╛рдЗрдпрд╛рдБ, рдФрд░ рдЗрд╕рдХреА рд╕реНрдерд╛рдиреАрдп рдЕрдЦрдВрдбрддрд╛ рд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЬрд╛рддреА рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9de/219/e7a/9de219e7ae0495bcc9dfc2eca4ce52d6.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53c/0fc/e14/53c0fce142f96daecfd5001ac45e2222.png"></div><br>  <i>рд╢реЛрд░ рдордЪрд╛рдпрд╛ред</i> <br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рдирдП рдкреИрдорд╛рдиреЗ рдкрд░ рд╢реЛрд░ рдХреЗ рдЬреЛрдбрд╝реЛрдВ рдХреЗ рдмреАрдЪ рдХреА рджреВрд░реА рдмрдврд╝ рдЬрд╛рддреА рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЪреВрдВрдХрд┐ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ 10 units3 рдЗрдХрд╛рдЗрдпреЛрдВ рдХрд╛ рдЖрдВрддрд░рд┐рдХ рд╡реНрдпрд╛рд╕ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдПрдХреНрд╕ рдЖрдпрд╛рдо рдореЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рдЯрд╛рдЗрд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╢реЛрд░ рдХреА рд╕реНрдерд╛рдиреАрдп рдЕрдЦрдВрдбрддрд╛ рдХреЗ рдХрд╛рд░рдг, рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░, рд╣рдо рдЕрднреА рднреА рджреЛрд╣рд░рд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреИрдЯрд░реНрди рдХреЛ рдкрд╣рдЪрд╛рдирдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ, рд▓рдЧрднрдЧ 20 рд╕реЗрд▓, рднрд▓реЗ рд╣реА рд╡рд┐рд╡рд░рдг рдорд┐рд▓рд╛рди рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рд▓реЗрдХрд┐рди рд╡реЗ рдЕрдиреНрдп рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рдмрд┐рдирд╛ рдХреЗрд╡рд▓ рдорд╛рдирдЪрд┐рддреНрд░ рдкрд░ рд╕реНрдкрд╖реНрдЯ рд╣реЛрдВрдЧреЗред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">unitypackage</a> <br><br><h2>  рд╕реЗрд▓ рдХреЗрдВрджреНрд░реЛрдВ рдХреЛ рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рдирд╛ </h2><br>  рд╕рднреА рд╕рд┐рд░реЛрдВ рдХреЛ рд╣рд┐рд▓рд╛рдиреЗ рд╕реЗ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЛ рдЕрдзрд┐рдХ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд░реВрдк рдорд┐рд▓рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХрдИ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реИрдВред  рдЪреВрдВрдХрд┐ рдЕрдм рдХреЛрд╢рд┐рдХрд╛рдПрдВ рджрд╛рдВрддреЗрджрд╛рд░ рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ, рдЙрдирдХреЗ рд▓реЗрдмрд▓ рдЬрд╛рд▓ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдЪреНрдЫреЗрдж рдХрд░рддреЗ рд╣реИрдВред  рдФрд░ рдЪрдЯреНрдЯрд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдкрдЯреНрдЯрд┐рдпреЛрдВ рдХреЗ рдЬреЛрдбрд╝реЛрдВ рдореЗрдВ рджрд░рд╛рд░реЗрдВ рдкреИрджрд╛ рд╣реЛрддреА рд╣реИрдВред  рд╣рдо рдмрд╛рдж рдореЗрдВ рджрд░рд╛рд░реЗрдВ рдЫреЛрдбрд╝ рджреЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдЕрдм рд╣рдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╕рддрд╣реЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░реЗрдВрдЧреЗред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/320/626/85f/32062685fe221819ba4d9375175f66ee.png"></div><br>  <i>рдирдХреНрд╢рд╛ рдХрдо рд╕рдЦреНрдд рд╣реЛ рдЧрдпрд╛, рд▓реЗрдХрд┐рди рдЕрдзрд┐рдХ рд╕рдорд╕реНрдпрд╛рдПрдВ рджрд┐рдЦрд╛рдИ рджреАрдВред</i> <br><br>  рдЪреМрд░рд╛рд╣реЗ рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХреЗрдВрджреНрд░реЛрдВ рдХреЛ рд╕рдкрд╛рдЯ рдмрдирд╛рдирд╛ рд╣реИред  рдЪрд▓реЛ <code>HexMesh.Perturb</code> рдореЗрдВ Y рд╕рдордиреНрд╡рдп рдХреЛ рди рдмрджрд▓реЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = HexMetrics.SampleNoise(position); position.x += (sample.x * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * HexMetrics.cellPerturbStrength; <span class="hljs-comment"><span class="hljs-comment">// position.y += (sample.y * 2f - 1f) * HexMetrics.cellPerturbStrength; position.z += (sample.z * 2f - 1f) * HexMetrics.cellPerturbStrength; return position; }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bfb/6f6/38e/bfb6f638e8cdb45d6178d1f18cdb723b.png"></div><br>  <i>рд╕рдВрд░реЗрдЦрд┐рдд рдХреЛрд╢рд┐рдХрд╛рдПрдВред</i> <br><br>  рдЗрд╕ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рд╕рд╛рде, рд╕рднреА рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд╕реНрдерд┐рддрд┐ рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд░рд╣реЗрдВрдЧреА, рджреЛрдиреЛрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рдФрд░ рдЕрдЧреБрд╡рд╛рдИ рдХреЗ рдЪрд░рдгреЛрдВ рдореЗрдВред  рдпрд╣ рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдпрд╣ рдХреЗрд╡рд▓ XZ рд╡рд┐рдорд╛рди рдореЗрдВ тЙИ50 this 7.07 рдХреЗ рдЕрдзрд┐рдХрддрдо рд╡рд┐рд╕реНрдерд╛рдкрди рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИред <br><br>  рдпрд╣ рдПрдХ рдЕрдЪреНрдЫрд╛ рдмрджрд▓рд╛рд╡ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдкрд╣рдЪрд╛рди рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рд╕реЗ рдПрд▓рд░реНрдЬреЗрд╕ рдмрд╣реБрдд рдЬреНрдпрд╛рджрд╛ рдЕрд░рд╛рдЬрдХ рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдереЛрдбрд╝рд╛ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рдЖрдВрджреЛрд▓рди рдЬреЛрдбрд╝рдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реЛрдЧрд╛ред <br><br><h3>  рд╕реЗрд▓ рдХреА рдКрдБрдЪрд╛рдИ рдкрд░ рдЬрд╛рдПрдБ </h3><br>  рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдкрд░ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рдЖрдВрджреЛрд▓рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдЗрд╕реЗ рдПрдХ рд╕реЗрд▓ рдкрд░ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдХреЛрд╢рд┐рдХрд╛ рд╕рдкрд╛рдЯ рд░рд╣реЗрдЧреА, рд▓реЗрдХрд┐рди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓рддрд╛ рдЕрднреА рднреА рдмрдиреА рд░рд╣реЗрдЧреАред  рдКрдВрдЪрд╛рдИ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдкреИрдорд╛рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рднреА рддрд░реНрдХрд╕рдВрдЧрдд рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ <code>HexMetrics</code> рдЬреЛрдбрд╝реЗрдВред  1.5 рдЗрдХрд╛рдЗрдпреЛрдВ рдХрд╛ рдПрдХ рдмрд▓ рдереЛрдбрд╝рд╛ рднрд┐рдиреНрдирддрд╛ рдкреИрджрд╛ рдХрд░рддрд╛ рд╣реИ, рд▓рдЧрднрдЧ рдПрдХ рдХрджрдо рдХреА рдКрдВрдЪрд╛рдИ рдХреЗ рдмрд░рд╛рдмрд░ред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> elevationPerturbStrength = <span class="hljs-number"><span class="hljs-number">1.5f</span></span>;</code> </pre> <br>  <code>HexCell.Elevation</code> рдкреНрд░реЙрдкрд░реНрдЯреА рдХреЛ рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рд╕реЗрд▓ рдХреЗ рд╡рд░реНрдЯрд┐рдХрд▓ рдкреЛрдЬрд┐рд╢рди рдореЗрдВ рдпрд╣ рдореВрд╡ <code>HexCell.Elevation</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { elevation = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Vector3 position = transform.localPosition; position.y = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * HexMetrics.elevationStep; position.y += (HexMetrics.SampleNoise(position).y * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * HexMetrics.elevationPerturbStrength; transform.localPosition = position; Vector3 uiPosition = uiRect.localPosition; uiPosition.z = -position.y; uiRect.localPosition = uiPosition; } }</code> </pre> <br>  рдЗрд╕ рдХрджрдо рдХреЛ рддреБрд░рдВрдд рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ <code>HexGrid.CreateCell</code> рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрд▓ рдХреА рдКрдВрдЪрд╛рдИ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЕрдиреНрдпрдерд╛, рдЧреНрд░рд┐рдб рд╢реБрд░реВ рдореЗрдВ рд╕рдкрд╛рдЯ рд╣реЛрдЧрд╛ред  UI рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдЗрд╕реЗ рдЕрдВрдд рдореЗрдВ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { тАж cell.Elevation = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d4f/dd7/15c/d4fdd715c130c8cd8b2519ff37c837de.png"></div><br>  <i>рджрд░рд╛рд░реЗрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рд╕реНрдерд╛рдкрд┐рдд рдКрдВрдЪрд╛рдЗрдпреЛрдВред</i> <br><br><h3>  рд╕рдорд╛рди рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </h3><br>  рдореЗрд╖ рдореЗрдВ рдХрдИ рджрд░рд╛рд░реЗрдВ рджрд┐рдЦрд╛рдИ рджреАрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рд╣рдо рдореЗрд╖ рдХреЛ рддреНрд░рд┐рдХреЛрдг рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдПрдХ рд╣реА рд╕реЗрд▓ рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдЪрд▓рд┐рдП рдЗрд╕рдХреА рд╕реНрдерд┐рддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>HexCell</code> рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдЬреЛрдбрд╝реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЗрд╕реЗ рдХрд╣реАрдВ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 Position { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transform.localPosition; } }</code> </pre> <br>  рдЕрдм рд╣рдо рд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>HexMesh.Triangulate</code> рдореЗрдВ рдЗрд╕ рдЧреБрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector3 center = cell.Position; тАж }</code> </pre> <br>  рдФрд░ рдЬрдм рд╣рдо рдкрдбрд╝реЛрд╕реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рдкрджреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдЗрд╕реЗ <code>TriangulateConnection</code> рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 v1, Vector3 v2 </span></span></span><span class="hljs-function">)</span></span> { тАж Vector3 bridge = HexMetrics.GetBridge(direction); Vector3 v3 = v1 + bridge; Vector3 v4 = v2 + bridge; v3.y = v4.y = neighbor.Position.y; тАж HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E &amp;&amp; nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Vector3 v5 = v2 + HexMetrics.GetBridge(direction.Next()); v5.y = nextNeighbor.Position.y; тАж } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69b/9a2/d90/69b9a2d90b7f29ef57f658f8206f6dda.png"></div><br>  <i>рд╕реЗрд▓ рдКрдВрдЪрд╛рдИ рдХрд╛ рд▓рдЧрд╛рддрд╛рд░ рдЙрдкрдпреЛрдЧред</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">unitypackage</a> <br><br><h2>  рд╕реЗрд▓ рдПрдЬ рдпреВрдирд┐рдЯ </h2><br>  рдпрджреНрдпрдкрд┐ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдПрдХ рд╕реБрдВрджрд░ рдмрджрд▓рд╛рд╡ рд╣реИ, рдлрд┐рд░ рднреА рд╡реЗ рд╕реНрдкрд╖реНрдЯ рд╣реЗрдХреНрд╕рд╛рдЧреЛрдиреНрд╕ рдХреА рддрд░рд╣ рджрд┐рдЦрддреЗ рд╣реИрдВред  рдпрд╣ рдЕрдкрдиреЗ рдЖрдк рдореЗрдВ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдЙрдирдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d5/895/e86/6d5895e8650286653b532d9c6fa1c10d.png"></div><br>  <i>рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рджреГрд╢реНрдпрдорд╛рди рд╣реЗрдХреНрд╕рд╛рдЧреЛрдирд▓ рдХреЛрд╢рд┐рдХрд╛рдПрдВред</i> <br><br>  рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрдзрд┐рдХ рдХреЛрдиреЗ рд╣реИрдВ, рддреЛ рдЕрдзрд┐рдХ рд╕реНрдерд╛рдиреАрдп рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓рддрд╛ рд╣реЛрдЧреАред  рддреЛ рдЪрд▓реЛ рдкреНрд░рддреНрдпреЗрдХ рдХреЛрдиреЗ рдХреЛрдиреЛрдВ рдХреЗ рдмреАрдЪ рдореЗрдВ рдХрд┐рдирд╛рд░реЗ рдХреЗ рд╢реАрд░реНрд╖ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рд╕реЗрд▓ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдХрд┐рдирд╛рд░реЗ рдХреЛ рджреЛ рднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░реЗрдВред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ <code>HexMesh.Triangulate</code> рдХреЛ рдПрдХ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рджреЛ <code>HexMesh.Triangulate</code> рдХреЛ рдЬреЛрдбрд╝рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector3 center = cell.Position; Vector3 v1 = center + HexMetrics.GetFirstSolidCorner(direction); Vector3 v2 = center + HexMetrics.GetSecondSolidCorner(direction); Vector3 e1 = Vector3.Lerp(v1, v2, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); AddTriangle(center, v1, e1); AddTriangleColor(cell.color); AddTriangle(center, e1, v2); AddTriangleColor(cell.color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { TriangulateConnection(direction, cell, v1, v2); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b09/03c/d20/b0903cd20983599abdc064f04c95aa4f.png"></div><br>  <i>рдЫрд╣ рдХреЗ рдмрдЬрд╛рдп рдмрд╛рд░рд╣ рдкрдХреНрд╖ред</i> <br><br>  рджреЛрд╣рд░реАрдХрд░рдг рдФрд░ рддреНрд░рд┐рдХреЛрдг рджреЛрд╣рд░реАрдХрд░рдг рд╕реЗ рд╕реЗрд▓ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдЕрдзрд┐рдХ рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓рддрд╛ рдЖрддреА рд╣реИред  рдЖрдЗрдП, рдЙрдиреНрд╣реЗрдВ рд╢реАрд░реНрд╖ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рддреАрди рдЧреБрдирд╛ рдХрд░рдХреЗ рдФрд░ рднреА рдЕрд╕рдорд╛рди рдмрдирд╛рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> Vector3 e1 = Vector3.Lerp(v1, v2, <span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); Vector3 e2 = Vector3.Lerp(v1, v2, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); AddTriangle(center, v1, e1); AddTriangleColor(cell.color); AddTriangle(center, e1, e2); AddTriangleColor(cell.color); AddTriangle(center, e2, v2); AddTriangleColor(cell.color);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad2/852/e6c/ad2852e6ccbf3db0adca140818545bb3.png"></div><br>  <i>18 рдкрдХреНрд╖ред</i> <br><br><h3>  рд░рд┐рдм рдЬреЙрдЗрдВрдЯ рдбрд┐рд╡реАрдЬрди </h3><br>  рдмреЗрд╢рдХ, рд╣рдореЗрдВ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдЬреЛрдбрд╝реЛрдВ рдХреЛ рд╡рд╢ рдореЗрдВ рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо <code>TriangulateConnection</code> рд▓рд┐рдП рдирдП рд╢реАрд░реНрд╖ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдкрд╛рд╕ рдХрд░реЗрдВрдЧреЗред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { TriangulateConnection(direction, cell, v1, e1, e2, v2); }</code> </pre> <br>  <code>TriangulateConnection</code> рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЛрдиреЗ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд╕рдХреЗред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 v1, Vector3 e1, Vector3 e2, Vector3 v2 </span></span></span><span class="hljs-function">)</span></span> { тАж }</code> </pre> <br>  рд╣рдореЗрдВ рдкрдбрд╝реЛрд╕реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд┐рдирд╛рд░реЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдкреБрд▓ рдХреЛ рджреВрд╕рд░реА рддрд░рдл рд╕реЗ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рдж рд╣рдо рдЙрдирдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> Vector3 bridge = HexMetrics.GetBridge(direction); Vector3 v3 = v1 + bridge; Vector3 v4 = v2 + bridge; v3.y = v4.y = neighbor.Position.y; Vector3 e3 = Vector3.Lerp(v3, v4, <span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); Vector3 e4 = Vector3.Lerp(v3, v4, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>);</code> </pre> <br>  рдЕрдЧрд▓рд╛ рд╣рдореЗрдВ рд░рд┐рдм рдХреЗ рддреНрд░рд┐рднреБрдЬ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЬрдм рддрдХ рд╣рдо рдврд▓рд╛рди рдХреЗ рд╕рд╛рде рдврд▓рд╛рди рдХреЛ рдЕрдирджреЗрдЦрд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддрдм рддрдХ рдХреЗрд╡рд▓ рдПрдХ рдХреНрд╡рд╛рдб рдХреЗ рдмрдЬрд╛рдп рддреАрди рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces(v1, v2, cell, v3, v4, neighbor); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddQuad(v1, e1, v3, e3); AddQuadColor(cell.color, neighbor.color); AddQuad(e1, e2, e3, e4); AddQuadColor(cell.color, neighbor.color); AddQuad(e2, v2, e4, v4); AddQuadColor(cell.color, neighbor.color); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afa/9d6/708/afa9d67080045b6ea2951a715c569003.png"></div><br>  <i>рдЙрдкрд╡рд┐рднрд╛рдЬрд┐рдд рдХрдиреЗрдХреНрд╢рдиред</i> <br><br><h3>  рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХрд╛ рдорд┐рд▓рди </h3><br>  рдЪреВрдВрдХрд┐ рдХрд┐рдирд╛рд░реЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдЕрдм рдЪрд╛рд░ рд╕рд┐рд░реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдПрдХ рд╕реЗрдЯ рдореЗрдВ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рдирд╛ рддрд░реНрдХрд╕рдВрдЧрдд рд╣реЛрдЧрд╛ред  рдпрд╣ рдЪрд╛рд░ рд╕реНрд╡рддрдВрддреНрд░ рд╢реАрд░реНрд╖реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред  рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ <code>EdgeVertices</code> рд╕рдВрд░рдЪрдирд╛ рдмрдирд╛рдПрдБред  рдпрд╣ рд╕реЗрд▓ рдмрдврд╝рдд рдХреЗ рд╕рд╛рде рдШрдбрд╝реА рдХреА рджрд┐рд╢рд╛ рдореЗрдВ рдЬрд╛ рд░рд╣реЗ рдЪрд╛рд░ рдХреЛрдиреЗ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> EdgeVertices { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 v1, v2, v3, v4; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рдХреНрдпрд╛ рдЙрдиреНрд╣реЗрдВ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП?</b> <div class="spoiler_text">  рд╣рдо рдЗрд╕ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рддреНрд░рд┐рдХреЛрдгреАрдпрдХрд░рдг рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗред  рдЗрд╕ рд╕реНрддрд░ рдкрд░, рд╣рдореЗрдВ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдХреЛрдиреЗ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдХреНрд░рдордмрджреНрдз рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИред </div></div><br>  рдЗрд╕рдореЗрдВ рдПрдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВ, рдЬреЛ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдордзреНрдпрд╡рд░реНрддреА рдмрд┐рдВрджреБрдУрдВ рдХреА рдЧрдгрдирд╛ рд╕реЗ рдирд┐рдкрдЯреЗрдЧрд╛ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EdgeVertices</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 corner1, Vector3 corner2</span></span></span><span class="hljs-function">)</span></span> { v1 = corner1; v2 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); v3 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); v4 = corner2; }</code> </pre> <br>  рдЕрдм рд╣рдо рд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рдФрд░ рдЙрд╕рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдмреАрдЪ рддреНрд░рд┐рдХреЛрдг рдХреЗ рдПрдХ рдкреНрд░рд╢рдВрд╕рдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП <code>HexMesh</code> рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ <code>HexMesh</code> рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeFan</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 center, EdgeVertices edge, Color color</span></span></span><span class="hljs-function">)</span></span> { AddTriangle(center, edge.v1, edge.v2); AddTriangleColor(color); AddTriangle(center, edge.v2, edge.v3); AddTriangleColor(color); AddTriangle(center, edge.v3, edge.v4); AddTriangleColor(color); }</code> </pre> <br>  рдФрд░ рджреЛ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдмреАрдЪ рдЪрддреБрд╖реНрдХреЛрдг рдХреА рдПрдХ рдкрдЯреНрдЯреА рдХреЛ рддреНрд░рд┐рднреБрдЬ рдмрдирд╛рдиреЗ рдХреА рдПрдХ рд╡рд┐рдзрд┐ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color c1, EdgeVertices e2, Color c2 </span></span></span><span class="hljs-function">)</span></span> { AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); AddQuadColor(c1, c2); AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); AddQuadColor(c1, c2); AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); AddQuadColor(c1, c2); }</code> </pre> <br>  рдпрд╣ рд╣рдореЗрдВ <code>Triangulate</code> рдкрджреНрдзрддрд┐ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector3 center = cell.Position; EdgeVertices e = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstSolidCorner(direction), center + HexMetrics.GetSecondSolidCorner(direction) ); TriangulateEdgeFan(center, e, cell.color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { TriangulateConnection(direction, cell, e); } }</code> </pre> <br>  рдЪрд▓рд┐рдП <code>TriangulateConnection</code> рдкрд░ рдЪрд▓рддреЗ рд╣реИрдВред  рдЕрдм рд╣рдо <code>TriangulateEdgeStrip</code> рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдиреНрдп рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЬрд╣рд╛рдВ рд╣рдо <code>v1</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рдереЗ, рд╣рдореЗрдВ <code>e1.v1</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕реА рддрд░рд╣, <code>v2</code> <code>e1.v4</code> рдмрди рдЬрд╛рддрд╛ рд╣реИ, <code>v3</code> <code>e2.v1</code> рдмрди рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ <code>v4</code> <code>e2.v4</code> рдмрди рдЬрд╛рддрд╛ рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { HexCell neighbor = cell.GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 bridge = HexMetrics.GetBridge(direction); bridge.y = neighbor.Position.y - cell.Position.y; EdgeVertices e2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( e1.v1 + bridge, e1.v4 + bridge ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces(e1.v1, e1.v4, cell, e2.v1, e2.v4, neighbor); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeStrip(e1, cell.color, e2, neighbor.color); } HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E &amp;&amp; nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Vector3 v5 = e1.v4 + HexMetrics.GetBridge(direction.Next()); v5.y = nextNeighbor.Position.y; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.Elevation &lt;= neighbor.Elevation) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.Elevation &lt;= nextNeighbor.Elevation) { TriangulateCorner( e1.v4, cell, e2.v4, neighbor, v5, nextNeighbor ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateCorner( v5, nextNeighbor, e1.v4, cell, e2.v4, neighbor ); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor.Elevation &lt;= nextNeighbor.Elevation) { TriangulateCorner( e2.v4, neighbor, v5, nextNeighbor, e1.v4, cell ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateCorner( v5, nextNeighbor, e1.v4, cell, e2.v4, neighbor ); } }</code> </pre> <br><h3>  рд▓реЗрдбрд┐рдЬ рдбрд┐рд╡реАрдЬрди </h3><br>  рд╣рдореЗрдВ рдХрдбрд╝рд┐рдпреЛрдВ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ <code>TriangulateEdgeTerraces</code> рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces(e1, cell, e2, neighbor); }</code> </pre> <br>  рдЕрдм рд╣рдореЗрдВ <code>TriangulateEdgeTerraces</code> рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддрд╛рдХрд┐ рдпрд╣ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдмреАрдЪ рдФрд░ рдХреЛрдиреЗ рдХреЗ рдЬреЛрдбрд╝реЗ рдХреЗ рдмреАрдЪ рди рд╣реЛред  рдорд╛рди <code>EdgeVertices</code> рд╣реИрдВ рдХрд┐ рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>EdgeVertices</code> рдкрд╛рд╕ рдПрдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╕реНрдереИрддрд┐рдХ рддрд░реАрдХрд╛ рд╣реИред  рдпрд╣ рд╣рдореЗрдВ рдЬрдЯрд┐рд▓ рдмрдирд╛рдиреЗ рдХреЗ рдмрдЬрд╛рдп <code>TriangulateEdgeTerraces</code> рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeTerraces</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices begin, HexCell beginCell, EdgeVertices end, HexCell endCell </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e2 = EdgeVertices.TerraceLerp(begin, end, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color c2 = HexMetrics.TerraceLerp(beginCell.color, endCell.color, <span class="hljs-number"><span class="hljs-number">1</span></span>); TriangulateEdgeStrip(begin, beginCell.color, e2, c2); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; HexMetrics.terraceSteps; i++) { EdgeVertices e1 = e2; Color c1 = c2; e2 = EdgeVertices.TerraceLerp(begin, end, i); c2 = HexMetrics.TerraceLerp(beginCell.color, endCell.color, i); TriangulateEdgeStrip(e1, c1, e2, c2); } TriangulateEdgeStrip(e2, c2, end, endCell.color); }</code> </pre> <br>  <code>EdgeVertices.TerraceLerp</code> рд╡рд┐рдзрд┐ рдмрд╕ рджреЛ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ <code>EdgeVertices.TerraceLerp</code> рд╕рднреА рдЪрд╛рд░ рдЬреЛрдбрд╝реЗ рдХреЗ рдмреАрдЪ рдХреА <code>EdgeVertices.TerraceLerp</code> рдХреЛ рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рдХрд░рддреА рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> EdgeVertices </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TerraceLerp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices a, EdgeVertices b, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> step</span></span></span><span class="hljs-function">)</span></span> { EdgeVertices result; result.v1 = HexMetrics.TerraceLerp(a.v1, b.v1, step); result.v2 = HexMetrics.TerraceLerp(a.v2, b.v2, step); result.v3 = HexMetrics.TerraceLerp(a.v3, b.v3, step); result.v4 = HexMetrics.TerraceLerp(a.v4, b.v4, step); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a7d/ead/906/a7dead9066cbd1f7ddd29ca751d81cb0.png"></div><br>  <i>рдЙрдкрд╡рд┐рднрд╛рдЬрд┐рдд рдЕрдЧреБрд╡рд╛рдИред</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">unitypackage</a> <br><br><h2>  рдЪрдЯреНрдЯрд╛рдиреЛрдВ рдФрд░ рдкреБрд▓реЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ </h2><br>  рдЕрдм рддрдХ, рд╣рдордиреЗ рдЪрдЯреНрдЯрд╛рдиреЛрдВ рдФрд░ рдкрдЯреНрдЯрд┐рдпреЛрдВ рдХреЗ рдЬрдВрдХреНрд╢рди рдореЗрдВ рджрд░рд╛рд░реЗрдВ рдХреА рдЕрдирджреЗрдЦреА рдХреА рд╣реИред  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдЖ рдЧрдпрд╛ рд╣реИред  рдЖрдЗрдП рдкрд╣рд▓реЗ рдЪрдЯреНрдЯрд╛рди-рдврд▓рд╛рди-рдврд▓рд╛рди (OSS) рдФрд░ рдврд▓рд╛рди-рдЪрдЯреНрдЯрд╛рди-рдврд▓рд╛рди (SOS) рдорд╛рдорд▓реЛрдВ рдХреЛ рджреЗрдЦреЗрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/402/951/0fa/4029510fa08226cc4e4aee18faf1959b.png"></div><br>  <i>рдореЗрд╖ рдЫреЗрджред</i> <br><br>  рд╕рдорд╕реНрдпрд╛ рдЗрд╕рд▓рд┐рдП рдкреИрджрд╛ рд╣реЛрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╕реАрдорд╛рдУрдВ рдХреЗ рдКрдкрд░ рдЪрд▓реЗ рдЧрдП рд╣реИрдВред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдЕрдм рд╡реЗ рдЪрдЯреНрдЯрд╛рди рдХреЗ рдХрд┐рдирд╛рд░реЗ рдкрд░ рдмрд┐рд▓реНрдХреБрд▓ рдЭреВрда рдирд╣реАрдВ рдмреЛрд▓рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рджрд░рд╛рд░ рд╣реЛ рдЬрд╛рддреА рд╣реИред  рдХрднреА-рдХрднреА рдпреЗ рдЫреЗрдж рдЕрджреГрд╢реНрдп рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдХрднреА-рдХрднреА рд╣рдбрд╝рддрд╛рд▓реА рд╣реЛрддреЗ рд╣реИрдВред <br><br>  рдЗрд╕рдХрд╛ рдЙрдкрд╛рдп рдпрд╣ рд╣реИ рдХрд┐ рд╕реАрдорд╛ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рди рдЬрд╛рдПрдВред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдпрд╣ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдмрд┐рдВрджреБ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдпрд╛ рдирд╣реАрдВред  рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдПрдХ <code>AddTriangle</code> рд╡рд┐рдХрд▓реНрдк рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ <code>AddTriangle</code> рдирд╣реАрдВ рдЪрд▓рддрд╛ рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleUnperturbed</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 v1, Vector3 v2, Vector3 v3</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertexIndex = vertices.Count; vertices.Add(v1); vertices.Add(v2); vertices.Add(v3); triangles.Add(vertexIndex); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre> <br>  <code>TriangulateBoundaryTriangle</code> рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рд╡рд╣ рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдЙрд╕реЗ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рднреА рд╕реАрдорд╛рдУрдВ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рд╕реАрдорд╛ рд╡рд╛рд▓реЗ рд▓реЛрдЧреЛрдВ рдХреЛ рдЫреЛрдбрд╝рдХрд░ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateBoundaryTriangle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, HexCell beginCell, Vector3 left, HexCell leftCell, Vector3 boundary, Color boundaryColor </span></span></span><span class="hljs-function">)</span></span> { Vector3 v2 = HexMetrics.TerraceLerp(begin, left, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color c2 = HexMetrics.TerraceLerp(beginCell.color, leftCell.color, <span class="hljs-number"><span class="hljs-number">1</span></span>); AddTriangleUnperturbed(Perturb(begin), Perturb(v2), boundary); AddTriangleColor(beginCell.color, c2, boundaryColor); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; HexMetrics.terraceSteps; i++) { Vector3 v1 = v2; Color c1 = c2; v2 = HexMetrics.TerraceLerp(begin, left, i); c2 = HexMetrics.TerraceLerp(beginCell.color, leftCell.color, i); AddTriangleUnperturbed(Perturb(v1), Perturb(v2), boundary); AddTriangleColor(c1, c2, boundaryColor); } AddTriangleUnperturbed(Perturb(v2), Perturb(left), boundary); AddTriangleColor(c2, leftCell.color, boundaryColor); }</code> </pre> <br>  рдпрд╣ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ: рдЪреВрдБрдХрд┐ рд╣рдо рдХрд┐рд╕реА рдЕрдиреНрдп рдмрд┐рдВрджреБ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>v2</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рд╣рдо рдЗрд╕реЗ рддреБрд░рдВрдд рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рдПрдХ рд╕рд░рд▓ рдЕрдиреБрдХреВрд▓рди рд╣реИ рдФрд░ рдпрд╣ рдХреЛрдб рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдЗрдП рдЗрд╕реЗ рдкреЗрд╢ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateBoundaryTriangle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, HexCell beginCell, Vector3 left, HexCell leftCell, Vector3 boundary, Color boundaryColor </span></span></span><span class="hljs-function">)</span></span> { Vector3 v2 = Perturb(HexMetrics.TerraceLerp(begin, left, <span class="hljs-number"><span class="hljs-number">1</span></span>)); Color c2 = HexMetrics.TerraceLerp(beginCell.color, leftCell.color, <span class="hljs-number"><span class="hljs-number">1</span></span>); AddTriangleUnperturbed(Perturb(begin), v2, boundary); AddTriangleColor(beginCell.color, c2, boundaryColor); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; HexMetrics.terraceSteps; i++) { Vector3 v1 = v2; Color c1 = c2; v2 = Perturb(HexMetrics.TerraceLerp(begin, left, i)); c2 = HexMetrics.TerraceLerp(beginCell.color, leftCell.color, i); AddTriangleUnperturbed(v1, v2, boundary); AddTriangleColor(c1, c2, boundaryColor); } AddTriangleUnperturbed(v2, Perturb(left), boundary); AddTriangleColor(c2, leftCell.color, boundaryColor); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fd/221/0ed/3fd2210ed0a8148ba9d39ef1655848e8.png"></div><br>  <i>рдмреЗрдорд┐рд╕рд╛рд▓ рд╕реАрдорд╛рдПрдБред</i> <br><br>  рдпрд╣ рдмреЗрд╣рддрд░ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдЕрднреА рддрдХ рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред  <code>TriangulateCornerTerracesCliff</code> рдкрджреНрдзрддрд┐ рдХреЗ рдЕрдВрджрд░, рд╕реАрдорд╛ рдмрд┐рдВрджреБ рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рдмрд┐рдВрджреБрдУрдВ рдХреЗ рдмреАрдЪ рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рд╣реЛрддреА рд╣реИред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрди рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдЕрднреА рддрдХ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдкрд░рд┐рдгрд╛рдореА рдЪрдЯреНрдЯрд╛рди рдХреЗ рдЕрдиреБрд░реВрдк рд╕реАрдорд╛ рдмрд┐рдВрджреБ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдмрд┐рдВрджреБрдУрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><pre> <code class="cs hljs"> Vector3 boundary = Vector3.Lerp(Perturb(begin), Perturb(right), b);</code> </pre> <br>  <code>TriangulateCornerCliffTerraces</code> рдкрджреНрдзрддрд┐ рдХреЗ рд▓рд┐рдП рднреА рдпрд╣реА рд╕рддреНрдп рд╣реИред <br><br><pre> <code class="cs hljs"> Vector3 boundary = Vector3.Lerp(Perturb(begin), Perturb(left), b);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c18/917/670/c189176704e7ebcdfd92bc6a1cffaee3.png"></div><br>  <i>рдЫреЗрдж рд╣реЛ рдЧрдП рд╣реИрдВред</i> <br><br><h3>  рдбрдмрд▓ рдЪрдЯреНрдЯрд╛рди рдФрд░ рдврд▓рд╛рди </h3><br>  рд╢реЗрд╖ рд╕рднреА рд╕рдорд╕реНрдпрд╛рдЧреНрд░рд╕реНрдд рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рджреЛ рдЪрдЯреНрдЯрд╛рдиреЗрдВ рдФрд░ рдПрдХ рдврд▓рд╛рди рдореМрдЬреВрдж рд╣реИрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/408/f2f/4a6/408f2f4a6fca5fffd8659b4380f59e51.png"></div><br>  <i>рдПрдХрд▓ рддреНрд░рд┐рдХреЛрдг рдХреЗ рдХрд╛рд░рдг рдмрдбрд╝рд╛ рдЫреЗрджред</i> <br><br>  рдпрд╣ рд╕рдорд╕реНрдпрд╛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ <code>TriangulateCornerTerracesCliff</code> рдХреЗ рдЕрдВрдд рдореЗрдВ <code>else</code> рдмреНрд▓реЙрдХ рдореЗрдВ рдПрдХрд▓ рддреНрд░рд┐рднреБрдЬ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдХреЗ рд╣рд▓ рдХреА рдЧрдИ рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddTriangleUnperturbed(Perturb(left), Perturb(right), boundary); AddTriangleColor(leftCell.color, rightCell.color, boundaryColor); }</code> </pre> <br>  рд╡рд╣реА <code>TriangulateCornerCliffTerraces</code> рд▓рд┐рдП рдЬрд╛рддрд╛ рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddTriangleUnperturbed(Perturb(left), Perturb(right), boundary); AddTriangleColor(leftCell.color, rightCell.color, boundaryColor); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ff/b34/64a/9ffb3464a6de3dc443cede9d42797022.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд╡реАрдирддрдо рджрд░рд╛рд░реЛрдВ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдПрдВред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреБрдирд░реНрдирд┐рдорд╛рдг </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд╣реА рд╡рд┐рдХреГрдд рдЬрд╛рд▓ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╢реЛрд░, рдЗрд╕рдХреЗ рдкреИрдорд╛рдиреЗ рдФрд░ рд╡рд┐рд░реВрдкрдг рдХреА рддрд╛рдХрддреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╡рд┐рдХреГрддрд┐ рдмрд╣реБрдд рдордЬрдмреВрдд рд▓рдЧ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рдпрд╣ рдЕрд╕рдорд╛рдирддрд╛ рд╕реБрдВрджрд░ рджрд┐рдЦрддреА рд╣реИ, рд╣рдо рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдХреЛрд╢рд┐рдХрд╛рдПрдБ рд╕рдорд╛рди рдЧреНрд░рд┐рдб рд╕реЗ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╡рд┐рдЪрд▓рди рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рд╣рдо рдЕрднреА рднреА рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реЗрд▓ рдХреЛ рдЖрдХрд╛рд░ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рдЕрдЧрд░ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдЖрдХрд╛рд░ рдмрд╣реБрдд рдЕрдзрд┐рдХ рднрд┐рдиреНрди рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЙрдирдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЬрдЧрд╣ рджреЗрдирд╛ рдЕрдзрд┐рдХ рдХрдард┐рди рд╣реЛрдЧрд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35f/32e/d06/35f32ed066f03b1079ed0bec70ba83ca.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eac/3f5/d6c/eac3f5d6cd6a1e65185d1aec48e8abb0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╡рд┐рднрд╛рдЬрд┐рдд рдФрд░ рд╡рд┐рдХреГрдд рдореЗрд╖ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╡рд┐рдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд▓ 5 рдмрд╣реБрдд рдорд╣рд╛рди рд╣реИред</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╡рд┐рдХреГрддрд┐ 0 рд╕реЗ 5 рддрдХ рд╣реИред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪрд▓реЛ рдЧреНрд░рд┐рдб рдХреА рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ 4 рддрдХ рдХрдо рдХрд░реЗрдВ, рдмрд┐рдирд╛ рдЗрд╕реЗ рд╕рд╣реА рдХрд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЕрдзрд┐рдХрддрдо XZ рдСрдлрд╕реЗрдЯ тЙИ32 units 5.66 рдпреВрдирд┐рдЯ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cellPerturbStrength = <span class="hljs-number"><span class="hljs-number">4f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/803/2f6/b8d/8032f6b8d0cf048f5d55c30e2d0e465d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рд╡рд┐рд░реВрдкрдг рд╢рдХреНрддрд┐ 4.</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рдФрд░ рдореВрд▓реНрдп рдЬрд┐рд╕реЗ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рд╡рд╣ рд╣реИ рдЕрдЦрдВрдбрддрд╛ рдЧреБрдгрд╛рдВрдХред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рдЗрд╕реЗ рдмрдврд╝рд╛рддреЗ рд╣реИрдВ, рддреЛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдлреНрд▓реИрдЯ рдХреЗрдВрджреНрд░ рдмрдбрд╝реЗ рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ, рдЕрд░реНрдерд╛рдд рднрд╡рд┐рд╖реНрдп рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╕реНрдерд╛рди рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдРрд╕рд╛ рдХрд░рдиреЗ рдореЗрдВ рд╡реЗ рдЕрдзрд┐рдХ рд╣реЗрдХреНрд╕рд╛рдЧреЛрдирд▓ рдмрди рдЬрд╛рдПрдВрдЧреЗред</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.75 рд╕реЗ 0.95 рддрдХ рдЕрдЦрдВрдбрддрд╛ рдХрд╛ рдЧреБрдгрд╛рдВрдХред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.8 рдХреА рдЕрдЦрдВрдбрддрд╛ рдХреЗ рдЧреБрдгрд╛рдВрдХ рдореЗрдВ рдереЛрдбрд╝реА рд╡реГрджреНрдзрд┐ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рд╣рдорд╛рд░реЗ рдЬреАрд╡рди рдХреЛ рдереЛрдбрд╝рд╛ рд╕рд░рд▓ рдХрд░реЗрдЧреАред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> solidFactor = <span class="hljs-number"><span class="hljs-number">0.8f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9a/9a2/036/a9a9a2036fbcd0e4e5f11e56078911c1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЦрдВрдбрддрд╛ рдХрд╛ рдЧреБрдгрд╛рдВрдХ 0.8ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдКрдВрдЪрд╛рдИ рд╕реНрддрд░реЛрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдмрд╣реБрдд рддреЗрдЬ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ рдЬрдм рдЖрдкрдХреЛ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдХрд┐ рдореЗрд╖ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реБрдЖ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд░ рд░рд╣реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЗрд╕реЗ 1 рдпреВрдирд┐рдЯ рдкреНрд░рддрд┐ рдЪрд░рдг рдЪрд░рдг рддрдХ рдХрдо рдХрд░реЗрдВ, рдЕрд░реНрдерд╛рдд 3 рддрдХред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> elevationStep = <span class="hljs-number"><span class="hljs-number">3f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5cc/4b0/028/5cc4b002843f822556c7ced67b9f54db.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд┐рдЪ рдХрдо рд╣реЛ рдЧрдИ рд╣реИ 3.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдкрд┐рдЪ рд╡рд┐рд░реВрдкрдг рдХреА рддрд╛рдХрдд рднреА рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрдм рдЗрд╕рдХрд╛ рдореВрд▓реНрдп 1.5 рд╣реИ, рдЬреЛ рдКрдВрдЪрд╛рдИ рдореЗрдВ рдЖрдзрд╛ рдХрджрдо рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ, рдЬреЛ рд╣рдореЗрдВ рд╕реВрдЯ рдХрд░рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдБрдЪрд╛рдИ рдХреЗ рдЫреЛрдЯреЗ рдЪрд░рдг рдКрдВрдЪрд╛рдИ рдХреЗ рд╕рднреА рд╕рд╛рдд рд╕реНрддрд░реЛрдВ рдХреЗ рдЕрдзрд┐рдХ рддрд╛рд░реНрдХрд┐рдХ рдЙрдкрдпреЛрдЧ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдорд╛рдирдЪрд┐рддреНрд░ рдХреА рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓рддрд╛ рдмрдврд╝ рдЬрд╛рддреА рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f63/9b3/aac/f639b3aac128c4c72c28fa85d68cc0e4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдХреЗ рд╕рд╛рдд рд╕реНрддрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 5: рдмрдбрд╝реЗ рдХрд╛рд░реНрдб </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдЧреНрд░рд┐рдб рдХреЛ рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдХреИрдорд░реЗ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рдВрдЧреЛрдВ рдФрд░ рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд░рдВрдЧ рджреЗрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмрдврд╝реЗ рд╣реБрдП рдмреНрд░рд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрднреА рддрдХ рд╣рдо рдмрд╣реБрдд рдЫреЛрдЯреЗ рдирдХреНрд╢реЗ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдмрдврд╝рд╛рдиреЗ рдХрд╛ рд╕рдордп рдЖ рдЧрдпрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c8/11c/4b4/0c811c4b480c13b584a2b824fdae1cee.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдореЗрдВ рдЬрд╝реВрдо рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд╛рд▓ рдХреЗ рдЯреБрдХрдбрд╝реЗ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЧреНрд░рд┐рдб рдХреЛ рдмрд╣реБрдд рдмрдбрд╝рд╛ рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддреЗ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдПрдХ рдЬрд╛рд▓реА рдореЗрдВ рдлрд┐рдЯ рд╣реЛрдиреЗ рдХреА рд╕реАрдорд╛ рдореЗрдВ рдЪрд▓рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдХреИрд╕реЗ рд╣рд▓ рдХрд░реЗрдВ? </font><font style="vertical-align: inherit;">рдХрдИ рдЬрд╛рд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЕрдкрдиреЗ рдЧреНрд░рд┐рдб рдХреЛ рдХрдИ рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдо рдирд┐рд░рдВрддрд░ рдЖрдХрд╛рд░ рдХреЗ рдЖрдпрддрд╛рдХрд╛рд░ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/423/453/db2/423453db217ed74da2457198c576ef63.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреНрд░рд┐рдб рдХреЛ 3 рд╕реЗ 3 рдЦрдВрдбреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрдЗрдП 5 рдХрд╛ рдЙрдкрдпреЛрдЧ 5 рдмреНрд▓реЙрдХреЛрдВ рдореЗрдВ рдХрд░реЗрдВ, рдпрд╛рдиреА рдкреНрд░рддрд┐ рдЦрдВрдб 25 рдХреЛрд╢рд┐рдХрд╛рдПрдВред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkSizeX = <span class="hljs-number"><span class="hljs-number">5</span></span>, chunkSizeZ = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рд╕ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЖрдХрд╛рд░ рдЙрдкрдпреБрдХреНрдд рдорд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ?</font></font></b> <div class="spoiler_text">  .       ,     .      .      ,       (frustum culling),       .            . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдЬрд╛рд▓ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рднреА рдЖрдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдХрдИ рдЖрдХрд╛рд░ рдХрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЗрд╕реЗ рдмрджрд▓ рджреЗрдВ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдирд╣реАрдВ рдмрд▓реНрдХрд┐ рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ рдЕрдкрдирд╛ рдЖрдХрд╛рд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗред </font><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЖрдХрд╛рд░ рдХреЛ 4 рд╕реЗ 3 рдЯреБрдХрдбрд╝реЗ рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ, рдЕрд░реНрдерд╛рдд, рдХреЗрд╡рд▓ 12 рдЯреБрдХрдбрд╝реЗ рдпрд╛ 300 рд╕реЗрд▓ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдкрд░реАрдХреНрд╖рд╛ рдХрд╛рд░реНрдб рдорд┐рд▓рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkCountX = <span class="hljs-number"><span class="hljs-number">4</span></span>, chunkCountZ = <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЕрднреА рднреА рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>height</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рдЕрдм рдЙрдиреНрд╣реЗрдВ рдирд┐рдЬреА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдФрд░ рдЙрдирдХрд╛ рдирд╛рдо рдмрджрд▓ </font></font><code>cellCountX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>cellCountZ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХ рд╣реА рдмрд╛рд░ рдореЗрдВ рдЗрди рдЪрд░ рдХреА рд╕рднреА рдШрдЯрдирд╛рдУрдВ рдХрд╛ рдирд╛рдо рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдкрд╛рджрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЕрдм рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реЛрдЧрд╛ рдХрд┐ рд╣рдо рдЯреБрдХрдбрд╝реЛрдВ рдпрд╛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public int width = 6; // public int height = 6; int cellCountX, cellCountZ;</span></span></code> </pre> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/227/ff4/160/227ff41602f115787a8a0e5d98ca89c9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ рдЖрдХрд╛рд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрджрд▓реЛ </font></font><code>Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐, рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдЯреБрдХрдбрд╝реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреА рдЧрдгрдирд╛ рдХреА рдЬрд╛рдПред </font><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рд░реЛрдХрдирд╛ рди рд╣реЛ </font></font><code>Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; gridCanvas = GetComponentInChildren&lt;Canvas&gt;(); hexMesh = GetComponentInChildren&lt;HexMesh&gt;(); cellCountX = chunkCountX * HexMetrics.chunkSizeX; cellCountZ = chunkCountZ * HexMetrics.chunkSizeZ; CreateCells(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { cells = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCell[cellCountZ * cellCountX]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = <span class="hljs-number"><span class="hljs-number">0</span></span>, i = <span class="hljs-number"><span class="hljs-number">0</span></span>; z &lt; cellCountZ; z++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; cellCountX; x++) { CreateCell(x, z, i++); } } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрдЧрджрдбрд╝ рдкреНрд░реАрдлрд╝рдм </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд╛рд▓ рдХреЗ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдирдП рдкреНрд░рдХрд╛рд░ рдХреЗ рдШрдЯрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.UI; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexGridChunk</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЧреЗ рд╣рдо рдПрдХ рдкреНрд░реАрдлреИрдм рдЯреБрдХрдбрд╝рд╛ рдмрдирд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╣рдо </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдХреНрд╕ рдЧреНрд░рд┐рдб</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░рдХреЗ </font><font style="vertical-align: inherit;">рдФрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдХреНрд╕ рдЧреНрд░рд┐рдб рдЪрдВрдХ рдХрд╛</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирд╛рдо рдмрджрд▓рдХрд░ рдРрд╕рд╛ рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдШрдЯрдХ рдХреЛ рдирд┐рдХрд╛рд▓реЗрдВ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рдПрдХ рдШрдЯрдХ рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рдЗрд╕реЗ рдкреНрд░реАрдлрд╝реИрдм рдореЗрдВ рдмрджрд▓ рджреЗрдВ рдФрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рд╕реАрди рд╕реЗ рд╣рдЯрд╛ рджреЗрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/106/a02/bea/106a02bead67c37151be26d5f6a4bea9.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1cb/586/7a3/1cb5867a3851159ce2bf1747a4e213bc.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдХреИрдирд╡рд╛рд╕ рдФрд░ рдЬрд╛рд▓ рдХреЗ рд╕рд╛рде рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдкреНрд░реАрдлрд╝реИрдмред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╡рд╣ рдЗрди рдЕрдВрд╢реЛрдВ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдмрдирд╛рдПрдЧрд╛ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрд╕реЗ рдЦрдВрдб рдХреЗ рдкреНрд░реАрдлрд╝реИрдм рдХрд╛ рд▓рд┐рдВрдХ рджреЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGridChunk chunkPrefab;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a9/6b8/882/2a96b8882c5d6cc5bdb6345d5217ae83.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЯреБрдХрдбрд╝реЛрдВ рдХреЗ рд╕рд╛рдеред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрд╢реЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдирд╛, рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдЬреИрд╕рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЙрдиреНрд╣реЗрдВ рдПрдХ рд╕рд░рдгреА рдХреА рдорджрдж рд╕реЗ рдЯреНрд░реИрдХ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдЗрд╕реЗ рднрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдбрдмрд▓ рд▓реВрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> HexGridChunk[] chunks; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { тАж CreateChunks(); CreateCells(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateChunks</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { chunks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexGridChunk[chunkCountX * chunkCountZ]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = <span class="hljs-number"><span class="hljs-number">0</span></span>, i = <span class="hljs-number"><span class="hljs-number">0</span></span>; z &lt; chunkCountZ; z++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; chunkCountX; x++) { HexGridChunk chunk = chunks[i++] = Instantiate(chunkPrefab); chunk.transform.SetParent(transform); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреЛ рд╢реБрд░реВ рдХрд░рдирд╛ рд╣рдо рд╣реЗрдХреНрд╕рд╛рдЧреЛрдиреНрд╕ рдХреЗ рдПрдХ рдЧреНрд░рд┐рдб рдХреЛ рдХреИрд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рд╕рдорд╛рди рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд╣ рд╕рдм рдХреБрдЫ рд╕реЗрдЯ </font></font><code>Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░рддреА рд╣реИ рдФрд░ рдЗрд╕рдореЗрдВ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рдХрд░рддреА рд╣реИ </font></font><code>Start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдХреИрдирд╡рд╛рд╕ рдФрд░ рдЬрд╛рд▓ рдХреЗ рд╕рдВрджрд░реНрдн рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рдгреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЯреБрдХрдбрд╝рд╛ рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЧреНрд░рд┐рдб рдРрд╕рд╛ рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexGridChunk</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { HexCell[] cells; HexMesh hexMesh; Canvas gridCanvas; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { gridCanvas = GetComponentInChildren&lt;Canvas&gt;(); hexMesh = GetComponentInChildren&lt;HexMesh&gt;(); cells = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCell[HexMetrics.chunkSizeX * HexMetrics.chunkSizeZ]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Triangulate(cells); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд▓ рдирд┐рд░реБрдкрд┐рдд </font></font></h3><br> <code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрднреА рднреА рд╕рднреА рд╕реЗрд▓ рдмрдирд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдм рд╣рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрд▓ рдХреЛ рдПрдХ рдЙрдкрдпреБрдХреНрдд рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдЬрд╛рд▓ рдФрд░ рдХреИрдирд╡рд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░рдирд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { тАж HexCell cell = cells[i] = Instantiate&lt;HexCell&gt;(cellPrefab); <span class="hljs-comment"><span class="hljs-comment">// cell.transform.SetParent(transform, false); cell.transform.localPosition = position; cell.coordinates = HexCoordinates.FromOffsetCoordinates(x, z); cell.color = defaultColor; тАж Text label = Instantiate&lt;Text&gt;(cellLabelPrefab); // label.rectTransform.SetParent(gridCanvas.transform, false); label.rectTransform.anchoredPosition = new Vector2(position.x, position.z); label.text = cell.coordinates.ToStringOnSeparateLines(); cell.uiRect = label.rectTransform; cell.Elevation = 0; AddCellToChunk(x, z, cell); } void AddCellToChunk (int x, int z, HexCell cell) { }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдкреВрд░реНрдгрд╛рдВрдХ рд╡рд┐рднрд╛рдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦрдВрдб рдЖрдХрд╛рд░ рджреНрд╡рд╛рд░рд╛ </font><font style="vertical-align: inherit;">рд╕рд╣реА рдЯреБрдХрдбрд╝рд╛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCellToChunk</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkX = x / HexMetrics.chunkSizeX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkZ = z / HexMetrics.chunkSizeZ; HexGridChunk chunk = chunks[chunkX + chunkZ * chunkCountX]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдордзреНрдпрд╡рд░реНрддреА рдкрд░рд┐рдгрд╛рдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдо рдЗрд╕ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╕реЗрд▓ рдХреЗ рд╕реНрдерд╛рдиреАрдп рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рднреА рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рдЖрдк рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рдПрдХ рд╕реЗрд▓ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCellToChunk</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkX = x / HexMetrics.chunkSizeX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkZ = z / HexMetrics.chunkSizeZ; HexGridChunk chunk = chunks[chunkX + chunkZ * chunkCountX]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> localX = x - chunkX * HexMetrics.chunkSizeX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> localZ = z - chunkZ * HexMetrics.chunkSizeZ; chunk.AddCell(localX + localZ * HexMetrics.chunkSizeX, cell); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрдм рдпрд╣ </font></font><code>HexGridChunk.AddCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рдХреЛ рдЕрдкрдиреЗ рд╕рд░рдгреА рдореЗрдВ рд░рдЦрддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдпрд╣ рд╕реЗрд▓ рдФрд░ рдЙрд╕рдХреЗ UI рдХреЗ рд▓рд┐рдП рдореВрд▓ рддрддреНрд╡реЛрдВ рдХреЛ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cells[index] = cell; cell.transform.SetParent(transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); cell.uiRect.SetParent(gridCanvas.transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдорд┐рдЯрд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рд╡рд╣ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреЗ рдмрдЪреНрдЪреЛрдВ рдХреЗ рдХреИрдирд╡рд╛рд╕ рдФрд░ рд╖рдЯреНрднреБрдЬ рдЬрд╛рд▓ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛ рд╕рдХрддрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рд╕рд╛рде рдХреЛрдб рднреАред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Canvas gridCanvas; // HexMesh hexMesh; void Awake () { HexMetrics.noiseSource = noiseSource; // gridCanvas = GetComponentInChildren&lt;Canvas&gt;(); // hexMesh = GetComponentInChildren&lt;HexMesh&gt;(); тАж } // void Start () { // hexMesh.Triangulate(cells); // } // public void Refresh () { // hexMesh.Triangulate(cells); // }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдореЗрдВ рдЫреБрдЯрдХрд╛рд░рд╛ рдорд┐рд▓ рдЧрдпрд╛ рд╣реИ </font></font><code>Refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд╣рдореЗрдВ </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ </font><font style="vertical-align: inherit;">рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cell.color = activeColor; cell.Elevation = activeElevation; <span class="hljs-comment"><span class="hljs-comment">// hexGrid.Refresh(); }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a0/f4b/c99/5a0f4bc99bce766e53ff1a0192abd16e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдХреНрд╕рд╛рдЧреЛрдиреНрд╕ рдХреА рд╕рд╛рдл рдЧреНрд░рд┐рдбред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд▓реЗ рдореЛрдб рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдХрд╛рд░реНрдб рдЕрднреА рднреА рд╕рдорд╛рди рджрд┐рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдкрджрд╛рдиреБрдХреНрд░рдо рдЕрд▓рдЧ рд╣реЛрдЧрд╛ред </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдХреНрд╕ рдЧреНрд░рд┐рдб</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдм рдЦрдВрдбрд┐рдд рдмрд╛рд▓ рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рд╣реЛрддреА рд╣реИрдВ, рд╕рд╛рде рд╣реА рд╕рд╛рде рдЙрдирдХреЗ рдЬрд╛рд▓ рдФрд░ рдХреИрдирд╡рд╛рд╕ рднреА рд╣реЛрддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a7f/bc4/f8e/a7fbc4f8e4898504bc34a4a918ebb567.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд▓реЗ рдореЛрдб рдореЗрдВ рдмрд╛рд▓ рдЯреБрдХрдбрд╝реЗред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╛рдпрдж рд╣рдореЗрдВ рд╕реЗрд▓ рд▓реЗрдмрд▓ рдХреЗ рд╕рд╛рде рдХреБрдЫ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рд╣рдордиреЗ рд▓реЗрдмрд▓ рдХреА рдЪреМрдбрд╝рд╛рдИ 5 рдкрд░ рд╕реЗрдЯ рдХреАред рдпрд╣ рдЙрди рджреЛ рдкрд╛рддреНрд░реЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдерд╛ рдЬреЛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдирдХреНрд╢реЗ рдкрд░ рдкрд░реНрдпрд╛рдкреНрдд рдереЗред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ ,10 рдЬреИрд╕реЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рддреАрди рд╡рд░реНрдг рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡реЗ рдлрд┐рдЯ рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ рдФрд░ рдЫрдВрдЯрдиреА рдХреА рдЬрд╛рдПрдЧреАред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реЗрд▓ рд▓реЗрдмрд▓ рдХреА рдЪреМрдбрд╝рд╛рдИ рдмрдврд╝рд╛рдХрд░ 10 рдпрд╛ рдЗрд╕рд╕реЗ рднреА рдЕрдзрд┐рдХ рдХрд░ рджреЗрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e7/fd3/4a5/2e7fd34a5b649256e326b73a3aa9227a.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7c/926/fae/f7c926fae8356aa8d2402a21359fea8f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╕реЗрд▓ рд▓реЗрдмрд▓ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдмрд╣реБрдд рдмрдбрд╝реЗ рдорд╛рдирдЪрд┐рддреНрд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ! </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдкреВрд░реЗ рдЧреНрд░рд┐рдб рдХреЛ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдореЗрдВ рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдмрдбрд╝реЗ рдорд╛рдирдЪрд┐рддреНрд░ рдмрдирд╛рдиреЗ рдореЗрдВ рд▓рдВрдмрд╛ рд╕рдордп рд▓рдЧ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкреНрд░рдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢рд╛рд▓ рд╕реНрдерд╛рди рд╣реЛрдЧрд╛ред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрд▓ рд╕рдВрдкрд╛рджрди рдареАрдХ рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрд╛рджрди рд╡рд░реНрддрдорд╛рди рдЪрд░рдг рдореЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдЕрдм рдЧреНрд░рд┐рдб рдХреЛ рдЕрдкрдбреЗрдЯ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЯреБрдХрдбрд╝реЗ, рддреЛ рдПрдХ рд╡рд┐рдзрд┐ рдХреА рдЬрд░реВрд░рдд рдЕрджреНрдпрддрди рдХрд┐рдпрд╛ рдЬрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝ </font></font><code>Refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд┐рдП </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Refresh</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Triangulate(cells); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЗрд╕ рдкрджреНрдзрддрд┐ рдХреЛ рдХрдм рдХреЙрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП? </font><font style="vertical-align: inherit;">рд╣рдордиреЗ рд╣рд░ рдмрд╛рд░ рдкреВрд░реА рдЧреНрд░рд┐рдб рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ рдПрдХ рдЬрд╛рд▓ рдерд╛ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХрдИ рдЯреБрдХрдбрд╝реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рд░ рдмрд╛рд░ рдЙрди рд╕рднреА рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдмрджрд▓реЗ рд╣реБрдП рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЕрдзрд┐рдХ рдХреБрд╢рд▓ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдмрдбрд╝реЗ рдХрд╛рд░реНрдбреЛрдВ рдХреЛ рдмрджрд▓рдирд╛ рдПрдХ рдмрд╣реБрдд рдзреАрдорд╛ рдСрдкрд░реЗрд╢рди рдмрди рдЬрд╛рдПрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╣рдо рдХреИрд╕реЗ рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЕрджреНрдпрддрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреМрди рд╕рд╛ рдЯреБрдХрдбрд╝рд╛ рд╣реИ? </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдХреЛрд╢рд┐рдХрд╛ рдХреЛ рдкрддрд╛ рд╣реЛ рдХрд┐ рд╡рд╣ рдХрд┐рд╕ рдЯреБрдХрдбрд╝реЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред </font><font style="vertical-align: inherit;">рддрдм рд╕реЗрд▓ рдЗрд╕ рд╕реЗрд▓ рдХреЛ рдмрджрд▓рддреЗ рд╕рдордп рдЗрд╕рдХреЗ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХреЗрдЧреАред </font><font style="vertical-align: inherit;">рддреЛ рдЪрд▓рд┐рдП </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рд▓рд┐рдВрдХ </font><font style="vertical-align: inherit;">рджреЗрддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGridChunk chunk;</code> </pre> <br> <code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬреЛрдбрд╝рдиреЗ рдкрд░ рд╕реЗрд▓ рдореЗрдВ рдЦреБрдж рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cells[index] = cell; cell.chunk = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; cell.transform.SetParent(transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); cell.uiRect.SetParent(gridCanvas.transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рдЬреЛрдбрд╝рдХрд░, рд╣рдо </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font></font><code>Refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рд░ рдмрд╛рд░ рдПрдХ рд╕реЗрд▓ рдЕрдкрдбреЗрдЯ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдпрд╣ рдмрд╕ рдЗрд╕рдХреЗ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Refresh</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { chunk.Refresh(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЗрд╕реЗ </font></font><code>HexCell.Refresh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп </font><font style="vertical-align: inherit;">рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ </font><font style="vertical-align: inherit;">, рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдЗрд╕реЗ рдмрджрд▓рд╛ рдЧрдпрд╛ рдерд╛ рддреЛ рд╕реЗрд▓ рд╕реНрд╡рдпрдВ рдмреЗрд╣рддрд░ рдЬрд╛рдирддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕рдХреА рдКрдВрдЪрд╛рдИ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рджред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { тАж Refresh(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдореЗрдВ рдЗрд╕реЗ рддрднреА рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрдм рдЗрд╕рдХреА рдКрдВрдЪрд╛рдИ рдПрдХ рдЕрд▓рдЧ рдореВрд▓реНрдп рдореЗрдВ рдмрджрд▓ рдЧрдИ рд╣реЛред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдореЗрдВ рдкрд╣рд▓реЗ рдХреА рддрд░рд╣ рд╣реА рдКрдБрдЪрд╛рдИ рдкреНрд░рджрд╛рди рдХрд░рдиреА рд╣реЛ, рддреЛ рдЙрд╕реЗ рдлрд┐рд░ рд╕реЗ рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рд╕реЗрдЯрд░ рдХреА рд╢реБрд░реБрдЖрдд рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (elevation == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } тАж } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╣рдо рдЧрдгрдирд╛ рдХреЛ рдкрд╣рд▓реА рдмрд╛рд░ рдЫреЛрдбрд╝реЗрдВрдЧреЗ рдЬрдм рдКрдБрдЪрд╛рдИ 0 рдкрд░ рд╕реЗрдЯ рд╣реЛрдЧреА, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдореЗрд╖ рдКрдБрдЪрд╛рдИ рдорд╛рди рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╢реБрд░реБрдЖрддреА рдореВрд▓реНрдп рдРрд╕реЗ рдмрдирд╛рдПрдВрдЧреЗ рдЬреИрд╕реЗ рд╣рдо рдХрднреА рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> elevation = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MinValue;</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Int.inValue рдХреНрдпрд╛ рд╣реИ?</font></font></b> <div class="spoiler_text">   ,    integer.    C# integer тАФ <br>  32- ,   2 <sup>32</sup>  integer,    ,    .       . <br><br>  тАФ  тИТ2 <sup>31</sup> = тИТ2 147 483 648.        ! <br><br>   2 <sup>31</sup> тИТ 1 = 2 147 483 647.     2 <sup>31</sup> - . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рдХреЗ рд░рдВрдЧ рдкрд░рд┐рд╡рд░реНрддрди рдХреЛ рдкрд╣рдЪрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрд╕реЗ рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ </font></font><code>Color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрд░рдХреЗрд╕ рдкрд░ </font><font style="vertical-align: inherit;">рдирд╛рдо рджреЗрдВ </font><font style="vertical-align: inherit;">, рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ рдПрдХ рдирд┐рдЬреА рдЪрд░ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ рдмрджрд▓ рджреЗрдВ </font></font><code>color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░рдВрдЧ рдорд╛рди рдкрд╛рд░рджрд░реНрд╢реА рдХрд╛рд▓рд╛ рд╣реЛрдЧрд╛, рдЬреЛ рд╣рдореЗрдВ рд╕реВрдЯ рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Color Color { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (color == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } color = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Refresh(); } } Color color;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдм рд╣рдо рдкреНрд▓реЗ рдореЛрдб рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдЕрд╢рдХреНрдд-рд╕рдВрджрд░реНрдн рдЕрдкрд╡рд╛рдж рдорд┐рд▓рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рд╕реЗрд▓ рдХреЛ рдЙрд╕рдХреЗ рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЙрдирдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рдиреЛрдВ рдореЗрдВ рд░рдВрдЧ рдФрд░ рдКрдВрдЪрд╛рдИ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ рдХрд┐ рд╣рдо рдЗрд╕ рд╕реНрддрд░ рдкрд░ рдЕрдВрд╢реЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╕рднреА рдЖрд░рдВрднрд┐рдХ рдкреВрд░реНрдг рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рддреНрд░рд┐рдХреЛрдгрд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рд╣рдо рдХрд┐рд╕реА рдЦрдВрдб рдХреЛ рдХреЗрд╡рд▓ рддрднреА рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдЬрдм рдЙрд╕реЗ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Refresh</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (chunk) { chunk.Refresh(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЕрдВрддрддрдГ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ! </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рдПрдХ рд╕рдорд╕реНрдпрд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЬрдм рдЯреБрдХрдбрд╝реЛрдВ рдХреА рд╕реАрдорд╛рдУрдВ рдХреЗ рд╕рд╛рде рдбреНрд░рд╛рдЗрдВрдЧ, рд╕реАрдо рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/41a/94f/50c/41a94f50c430ce8f13fb1a3be274b520.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреБрдХрдбрд╝реЛрдВ рдХреА рд╕реАрдорд╛рдУрдВ рдореЗрдВ рддреНрд░реБрдЯрд┐рдпрд╛рдВред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрд╣ рддрд░реНрдХрд╕рдВрдЧрдд рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдПрдХ рдПрдХрд▓ рдХреЛрд╢рд┐рдХрд╛ рдмрджрд▓рддреА рд╣реИ, рддреЛ рдЙрд╕рдХреЗ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рднреА рдХрдиреЗрдХреНрд╢рди рднреА рдмрджрд▓рддреЗ рд╣реИрдВред рдФрд░ рдпреЗ рдкрдбрд╝реЛрд╕реА рдЕрдиреНрдп рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рд╕рдмрд╕реЗ рд╕рд░рд▓ рд╕рдорд╛рдзрд╛рди рд╕рднреА рдкрдбрд╝реЛрд╕реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЕрджреНрдпрддрди рдХрд░рдирд╛ рд╣реИ рдпрджрд┐ рд╡реЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Refresh</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (chunk) { chunk.Refresh(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; neighbors.Length; i++) { HexCell neighbor = neighbors[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; neighbor.chunk != chunk) { neighbor.chunk.Refresh(); } } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдкрддрд╛ рдЪрд▓ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдХрдИ рдмрд╛рд░ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╣реИрдВред рдФрд░ рдЬрдм рд╣рдо рдПрдХ рдмрд╛рд░ рдореЗрдВ рдХрдИ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд░рдВрдЧрдирд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╕рдм рдХреБрдЫ рдЦрд░рд╛рдм рд╣реЛ рдЬрд╛рдПрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рддреБрд░рдВрдд рдмрд╛рдж рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдмрд╕ рд▓рд┐рдЦрддреЗ рд╣реИрдВ рдХрд┐ рдмрджрд▓рд╛рд╡ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдПрдХ рдЕрдкрдбреЗрдЯ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдФрд░ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рдХрд░рдирд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдпрд╣ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдХреБрдЫ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд╣рдо рдЕрдкрдбреЗрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреА рд╕рдХреНрд╖рдо рд╕реНрдерд┐рддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╕рдордп, рд╣рдо рдШрдЯрдХ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕реЗ рдХрдИ рдмрд╛рд░ рдЪрд╛рд▓реВ рдХрд░рдиреЗ рд╕реЗ рдХреБрдЫ рднреА рдирд╣реАрдВ рдмрджрд▓реЗрдЧрд╛ред рдШрдЯрдХ рдХреЛ рдмрд╛рдж рдореЗрдВ рдЕрджреНрдпрддрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рд╣рдо рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░ рддреНрд░рд┐рдХреЛрдг рдХрд░реЗрдВрдЧреЗ рдФрд░ рдШрдЯрдХ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЕрдХреНрд╖рдо рдХрд░реЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ </font><font style="vertical-align: inherit;">рдХрд░рддреЗ рд╣реИрдВ</font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд░реНрддрдорд╛рди рдлреНрд░реЗрдо рдХреЗ рд▓рд┐рдП рдкрд░рд┐рд╡рд░реНрддрди рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рд╣реЛрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Refresh</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// hexMesh.Triangulate(cells); enabled = true; } void LateUpdate () { hexMesh.Triangulate(cells); enabled = false; }</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрджреНрдпрддрди рдФрд░ рд▓реЗрдЯрдЕрдк рдХреЗ рдмреАрдЪ рдХреНрдпрд╛ рдЕрдВрддрд░ рд╣реИ?</font></font></b> <div class="spoiler_text">     <code>Update</code>    -     .          <code>LateUpdate</code> .      ,   . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░рд╛ рдШрдЯрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЕрдм рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ </font></font><code>Start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рд╣рдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// void Start () { // hexMesh.Triangulate(cells); // }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a6f/104/7c3/a6f1047c34bb9cf9b69360343ab53aac.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10,000 рдХреЛрд╢рд┐рдХрд╛рдУрдВ рд╡рд╛рд▓реЗ 20 рд╕реЗ 20 рдХреЗ рдЯреБрдХрдбрд╝реЗред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╕реВрдЪреА </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рд╣рдордиреЗ рдЧреНрд░рд┐рдб рдХреЛ рддреНрд░рд┐рднреБрдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд░реВрдк рд╕реЗ рдкрд░рд┐рд╡рд░реНрддрди рдХрд┐рдпрд╛ рд╣реИ, </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рд╕рдорд╛рди рд╣реИред </font><font style="vertical-align: inherit;">рдЙрд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ, рдпрд╣ рдПрдХ рд╕рд░рдгреА рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдЧрд░ рд╣реЗрдХреНрд╕рд╛рдЧреЛрдиреНрд╕ рдпрд╛ рдЙрдирдореЗрдВ рд╕реЗ рдХрдИ рдХрд╛ рдПрдХ рдЬрд╛рд▓ рд╣реИ рддреЛ рд╡рд╣ рдкрд░рд╡рд╛рд╣ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╣рдордиреЗ рдЕрднреА рддрдХ рдХрдИ рдореЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╢рд╛рдпрдж рдпрд╣рд╛рдБ рдХреБрдЫ рд╕реБрдзрд╛рд░рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реВрдЪреА рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдЕрд╕реНрдерд╛рдпреА рдмрдлрд╝рд░ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рддреНрд░рд┐рдХреЛрдгреАрдпрдХрд░рдг рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдФрд░ рдЯреБрдХрдбрд╝реЗ рдПрдХ рд╕рдордп рдореЗрдВ рдПрдХ рддреНрд░рд┐рдХреЛрдгрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рд╕реЗрдЯ рд╕реВрдЪреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рд╣реЗрдХреНрд╕рд╛рдЧреЛрди рдореЗрд╖ рд╡рд╕реНрддреБ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реВрдЪрд┐рдпреЛрдВ рдХреЛ рд╕реНрдерд┐рд░ рдмрдирд╛рдХрд░ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;Vector3&gt; vertices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Vector3&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;Color&gt; colors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Color&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; triangles = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GetComponent&lt;MeshFilter&gt;().mesh = hexMesh = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mesh(); meshCollider = gameObject.AddComponent&lt;MeshCollider&gt;(); hexMesh.name = <span class="hljs-string"><span class="hljs-string">"Hex Mesh"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// vertices = new List&lt;Vector3&gt;(); // colors = new List&lt;Color&gt;(); // triangles = new List&lt;int&gt;(); }</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд╕реНрдереИрддрд┐рдХ рд╕реВрдЪреА рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВ?</font></font></b> <div class="spoiler_text">           .    ,   ,       . <br><br>     ,           .    20  20     100. </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреИрдорд░рд╛ рдирд┐рдпрдВрддреНрд░рдг </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрдбрд╝рд╛ рдХреИрдорд░рд╛ рдЕрджреНрднреБрдд рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдмреЗрдХрд╛рд░ рд╣реИ рдЕрдЧрд░ рд╣рдо рдЗрд╕реЗ рдирд╣реАрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред рдкреВрд░реЗ рдирдХреНрд╢реЗ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдХреИрдорд░реЗ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЬрд╝реВрдо рдХрд░рдирд╛ рднреА рдЙрдкрдпреЛрдЧреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рдЗрди рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреИрдорд░рд╛ рдмрдирд╛рдПрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдбрдореА рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВ рдФрд░ рдЗрд╕реЗ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдХреНрд╕ рдореИрдк рдХреИрдорд░рд╛</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╣реЗрдВ </font><font style="vertical-align: inherit;">ред рдЗрд╕рдХреЗ рдкрд░рд┐рд╡рд░реНрддрди рдШрдЯрдХ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдЕрдкрдиреЗ рдШреБрдорд╛рд╡ рдФрд░ рдкреИрдорд╛рдиреЗ рдХреЛ рдмрджрд▓реЗ рдмрд┐рдирд╛ рдореВрд▓ рдореЗрдВ рдЪрд▓рд╛ рдЬрд╛рдПред рдПрдХ рдмрдЪреНрдЪреЗ рдХреЛ рдЗрд╕рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ, </font><font style="vertical-align: inherit;">рдЬрд┐рд╕реЗ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреБрдВрдбрд╛</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдФрд░ рдЗрд╕рдореЗрдВ рдПрдХ рдмрдЪреНрдЪрд╛ рдЬреЛрдбрд╝реЗрдВ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫрдбрд╝реА</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред рдореБрдЦреНрдп рдХреИрдорд░рд╛ рд╕реНрдЯрд┐рдХ рдХрд╛ рдПрдХ рдмрдЪреНрдЪрд╛ рдмрдирд╛рдПрдВ, рдФрд░ рдЗрд╕рдХреЗ рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдо рдШрдЯрдХ рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░реЗрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a8/33f/3d9/0a833f3d9eea9b9fef1682ef63a7f372.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреИрдорд░реЗ рдХрд╛ рдкрджрд╛рдиреБрдХреНрд░рдоред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреИрдорд░рд╛ рдХрд╛рдЬ (рдХреБрдВрдбрд╛) рдХрд╛ рд▓рдХреНрд╖реНрдп рдЙрд╕ рдХреЛрдг рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдирд╛ рд╣реИ рдЬрд┐рд╕ рдкрд░ рдХреИрдорд░рд╛ рдирдХреНрд╢реЗ рдкрд░ рджрд┐рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рд╣рдо рдЗрд╕реЗ рдПрдХ рдореЛрдбрд╝ рджреЗрдВ (45, 0, 0)ред </font><font style="vertical-align: inherit;">рд╣реИрдВрдбрд▓ (рд╕реНрдЯрд┐рдХ) рдЙрд╕ рджреВрд░реА рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕ рдкрд░ рдХреИрдорд░реЗ рд╕реНрдерд┐рдд рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЙрд╕рдХреА рд╕реНрдерд┐рддрд┐ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ (0, 0, -45)ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рдЗрд╕ рдкреНрд░рдгрд╛рд▓реА рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдШрдЯрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдШрдЯрдХ рдХреЛ рдХреИрдорд░рд╛ рдкрджрд╛рдиреБрдХреНрд░рдо рдХреА рдЬрдбрд╝ рдореЗрдВ рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЙрд╕реЗ рдХрд╛рдЬ рдФрд░ рд╕рдВрднрд╛рд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрдбрд╝реА рджреЗ, рдЙрдиреНрд╣реЗрдВ рдореЗрдВ рд╣реЛ рд░рд╣реА рд╣реИ </font></font><code>Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexMapCamera</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { Transform swivel, stick; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { swivel = transform.GetChild(<span class="hljs-number"><span class="hljs-number">0</span></span>); stick = swivel.GetChild(<span class="hljs-number"><span class="hljs-number">0</span></span>); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eb6/2e5/44b/eb62e544b9e00bc558dfbc504802cfba.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╖рдЯреНрдХреЛрдг рдорд╛рдирдЪрд┐рддреНрд░ рдХреИрдорд░рд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд╝реВрдо </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓рд╛ рдлрд╝рдВрдХреНрд╢рди рдЬреЛ рд╣рдо рдмрдирд╛рдПрдВрдЧреЗ рд╡рд╣ рдЬрд╝реВрдорд┐рдВрдЧ (рдЬрд╝реВрдо) рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдлреНрд▓реЛрдЯ рдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд░реНрддрдорд╛рди рдЬрд╝реВрдо рд╕реНрддрд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">0 рдХреЗ рдорд╛рди рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╣рдо рдкреВрд░реА рддрд░рд╣ рд╕реЗ рджреВрд░ рд╣реИрдВ, рдФрд░ 1 рдХреЗ рдорд╛рди рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╣рдо рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХрд░реАрдм рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдзрд┐рдХрддрдо рдЬрд╝реВрдо рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zoom = <span class="hljs-number"><span class="hljs-number">1f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╝реВрдо рдЖрдорддреМрд░ рдкрд░ рдорд╛рдЙрд╕ рд╡реНрд╣реАрд▓ рдпрд╛ рдПрдирд╛рд▓реЙрдЧ рдХрдВрдЯреНрд░реЛрд▓ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ </font><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдЙрд╕ рд╕реНрдХреНрд░реЛрд▓рд╡реНрд╣реАрд▓</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрдирдкреБрдЯ рдЕрдХреНрд╖ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВ рдЬреЛ </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЗрдирдкреБрдЯ рдбреЗрд▓реНрдЯрд╛ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдЬрд╛рдБрдЪ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдПрдХ рд╣реИ, рддреЛ рдпрд╣ рдЬрд╝реВрдо рдкрд░рд┐рд╡рд░реНрддрди рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zoomDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Mouse ScrollWheel"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (zoomDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustZoom(zoomDelta); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustZoom</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд╝реВрдо рд╕реНрддрд░ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдмрд╕ рдЗрд╕рдореЗрдВ рдПрдХ рдбреЗрд▓реНрдЯрд╛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдорд╛рди рдХреЛ рд╕реАрдорд┐рдд рдХрд░рддреЗ рд╣реИрдВ (0-8)ред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustZoom</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { zoom = Mathf.Clamp01(zoom + delta); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╝реВрдо рдЗрди рдФрд░ рдЖрдЙрдЯ рдХрд░рддреЗ рд╕рдордп, рдХреИрдорд░реЗ рдХреА рджреВрд░реА рддрджрдиреБрд╕рд╛рд░ рдмрджрд▓рдиреА рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╣ Z рдХреА рд╣реИрдВрдбрд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрджрд▓рдХрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдиреНрдпреВрдирддрдо рдФрд░ рдЕрдзрд┐рдХрддрдо рдЬрд╝реВрдо рдкрд░ рд╣реИрдВрдбрд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рд╕рд╛рдорд╛рдиреНрдп рдлреНрд▓реЛрдЯ рдЪрд░ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдЫреЛрдЯреЗ рдорд╛рдирдЪрд┐рддреНрд░ рд╡рд┐рдХрд╕рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдорд╛рдиреЛрдВ рдХреЛ -250 рдФрд░ -45 рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> stickMinZoom, stickMaxZoom;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╝реВрдо рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдирдП рдЬрд╝реВрдо рдорд╛рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЗрди рджреЛ рдореВрд▓реНрдпреЛрдВ рдХреЗ рдмреАрдЪ рд░реИрдЦрд┐рдХ рдкреНрд░рдХреНрд╖реЗрдк рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣реИрдВрдбрд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustZoom</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { zoom = Mathf.Clamp01(zoom + delta); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = Mathf.Lerp(stickMinZoom, stickMaxZoom, zoom); stick.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, distance); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cec/f4c/f07/cecf4cf07d627d6eaab94ecdc2953d30.png"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреНрдпреВрдирддрдо рдФрд░ рдЕрдзрд┐рдХрддрдо рд╕реНрдЯрд┐рдХ рдорд╛рдиред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрд╝реВрдо рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рдпрд╣ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдорддреМрд░ рдкрд░, рдЬрдм рдЬрд╝реВрдо рджреВрд░ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдХреИрдорд░рд╛ рдПрдХ рд╢реАрд░реНрд╖ рджреГрд╢реНрдп рдореЗрдВ рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдПрд╣рд╕рд╛рд╕ рд╣рдо рдХрд╛рдЬ рдХреЛ рдореЛрдбрд╝рдХрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдХрд╛рдЬ рдХреЗ рд▓рд┐рдП рдЪрд░ рдорд┐рдирдЯ рдФрд░ рдЕрдзрд┐рдХрддрдо рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЙрдиреНрд╣реЗрдВ 90 рдФрд░ 45 рдорд╛рди рд╕реЗрдЯ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> swivelMinZoom, swivelMaxZoom;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрднрд╛рд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд╕рд╛рде, рд╣рдо рдПрдХ рдЙрдкрдпреБрдХреНрдд рдЬрд╝реВрдо рдХреЛрдг рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣рдо рдХрд╛рдЬ рдХреЗ рд░реЛрдЯреЗрд╢рди рдХреЛ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustZoom</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { zoom = Mathf.Clamp01(zoom + delta); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = Mathf.Lerp(stickMinZoom, stickMaxZoom, zoom); stick.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, distance); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> angle = Mathf.Lerp(swivelMinZoom, swivelMaxZoom, zoom); swivel.localRotation = Quaternion.Euler(angle, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/766/0c3/fcd/7660c3fcd621567398ea7c013fae549c.png"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреБрдВрдбрд╛ рдХрд╛ рдиреНрдпреВрдирддрдо рдФрд░ рдЕрдзрд┐рдХрддрдо рдореВрд▓реНрдпред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдЙрд╕ рд╡реНрд╣реАрд▓ рдХреЗ рдЗрдирдкреБрдЯ рдорд╛рдкрджрдВрдбреЛрдВ рдХреА рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ рдХреЛ рдмрджрд▓рдХрд░ рдЬрд╝реВрдо рдХреЗ рдкрд░рд┐рд╡рд░реНрддрди рдХреА рджрд░ рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╡реЗ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрд╛рджрди / рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ / рдЗрдирдкреБрдЯ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЙрдиреНрд╣реЗрдВ реж.рез рд╕реЗ реж.режреирел рддрдХ рдмрджрд▓рдиреЗ рдкрд░, рд╣рдореЗрдВ рдЬрд╝реВрдо рдореЗрдВ рдПрдХ рдзреАрдореА рдФрд░ рдЪрд┐рдХрдиреА рдмрджрд▓рд╛рд╡ рдорд┐рд▓рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d43/f86/ef3/d43f86ef3587be1bfd15ca208eec418f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдЙрд╕ рд╡реНрд╣реАрд▓ рдЗрдирдкреБрдЯ рд╡рд┐рдХрд▓реНрдкред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд┐рд╕реНрдерд╛рдкрди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЪрд▓рддреЗ рд╣реИрдВ рдХреИрдорд░рд╛ рд╣рд┐рд▓рд╛рдиреЗ рдХрд╛ред </font><font style="vertical-align: inherit;">рдПрдХреНрд╕ рдФрд░ рдЬреЗрдб рдХреА рджрд┐рд╢рд╛ рдореЗрдВ рдЖрдВрджреЛрд▓рди рдХреЛ рд╣рдореЗрдВ </font></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреВрдо рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ </font><font style="vertical-align: inherit;">рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕рдХреЗ рд▓рд┐рдП </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд╖реИрддрд┐рдЬ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрд░реНрдзреНрд╡рд╛рдзрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрдирдкреБрдЯ рдХреБрд▓реНрд╣рд╛рдбрд╝рд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╣рдореЗрдВ рддреАрд░ рдФрд░ WASD рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдХреИрдорд░рд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zoomDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Mouse ScrollWheel"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (zoomDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustZoom(zoomDelta); } <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span> || zDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustPosition(xDelta, zDelta); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдмрд╕реЗ рд╕рд░рд▓ рддрд░реАрдХрд╛ рдХреИрдорд░рд╛ рд╕рд┐рд╕реНрдЯрдо рдХреА рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИ, рдЗрд╕рдореЗрдВ рдбреЗрд▓реНрдЯрд╛рд╕ рдПрдХреНрд╕ рдФрд░ рдЬреЗрдб рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╣реИ, рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдкрд░рд┐рдгрд╛рдо рдЕрд╕рд╛рдЗрди рдХрд░рдирд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { Vector3 position = transform.localPosition; position += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(xDelta, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zDelta); transform.localPosition = position; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рддреАрд░ рдпрд╛ WASD рдХреЛ рдкрдХрдбрд╝рддреЗ рд╕рдордп рдХреИрдорд░рд╛ рд╣рд┐рд▓ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рд╕реНрдерд┐рд░ рдЧрддрд┐ рд╕реЗ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдлреНрд░реЗрдо рджрд░ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЙрд╕ рджреВрд░реА рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рд╕реЗ рдЖрдкрдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд╣рдо рд╕рдордп рдбреЗрд▓реНрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рд╕рд╛рде рд╣реА рдЖрд╡рд╢реНрдпрдХ рдЧрддрд┐ рднреАред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЪрд░ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font></font><code>moveSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ 100 рдкрд░ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рд╕реНрдерд┐рддрд┐ рдбреЗрд▓реНрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рд╕рдордп рдбреЗрд▓реНрдЯрд╛ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> moveSpeed; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = moveSpeed * Time.deltaTime; Vector3 position = transform.localPosition; position += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(xDelta, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zDelta) * distance; transform.localPosition = position; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6da/1bc/307/6da1bc3074dc31868b934a35aaa31b10.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрддрд┐ рдмрдврд╝ рд░рд╣реА рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдПрдХреНрд╕ рдпрд╛ рдЬреЗрдб рдХреБрд▓реНрд╣рд╛рдбрд╝рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдерд┐рд░ рдЧрддрд┐ рд╕реЗ рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред рд▓реЗрдХрд┐рди рдЬрдм рдПрдХ рд╣реА рд╕рдордп (рддрд┐рд░рдЫреЗ) рджреЛрдиреЛрдВ рдХреБрд▓реНрд╣рд╛рдбрд╝рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рдмрдврд╝реЗрдВрдЧреЗ рддреЛ рдЖрдВрджреЛрд▓рди рддреЗрдЬ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдбреЗрд▓реНрдЯрд╛ рд╡реЗрдХреНрдЯрд░ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЖрдкрдХреЛ рдЧрдВрддрд╡реНрдп рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { Vector3 direction = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(xDelta, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zDelta).normalized; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = moveSpeed * Time.deltaTime; Vector3 position = transform.localPosition; position += direction * distance; transform.localPosition = position; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдХрд░реНрдг рдЖрдВрджреЛрд▓рди рдХреЛ рдЕрдм рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдЪрд╛рдирдХ рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рд╕рднреА рдЪрд╛рдмрд┐рдпреЛрдВ рдХреЛ рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рднреА рдХреИрдорд░рд╛ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдЪрд▓рддрд╛ рд░рд╣рддрд╛ рд╣реИред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрдирдкреБрдЯ рдХреБрд▓реНрд╣рд╛рдбрд╝рд┐рдпрд╛рдБ рдХреБрдВрдЬреА рджрдмрд╛рдиреЗ рдХреЗ рддреБрд░рдВрдд рдмрд╛рдж рд╕реАрдорд╛ рдореВрд▓реНрдпреЛрдВ рдкрд░ рддреБрд░рдВрдд рдирд╣реАрдВ рдХреВрджрддреА рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдХреБрдЫ рд╕рдордп рдЪрд╛рд╣рд┐рдПред рдХреБрдВрдЬреА рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдпрд╣реА рд╕рдЪ рд╣реИред рд╢реВрдиреНрдп рдЕрдХреНрд╖ рдорд╛рди рдкрд░ рд▓реМрдЯрдиреЗ рдореЗрдВ рд╕рдордп рд▓рдЧрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЬрдм рд╕реЗ рд╣рдордиреЗ рдЗрдирдкреБрдЯ рдорд╛рдиреЛрдВ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрд┐рдпрд╛, рдЕрдзрд┐рдХрддрдо рдЧрддрд┐ рд▓рдЧрд╛рддрд╛рд░ рдмрдиреА рд╣реБрдИ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рджреЗрд░реА рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╡реЗ рдЪрд┐рдХрдирд╛рдИ рдХреА рднрд╛рд╡рдирд╛ рджреЗрддреЗ рд╣реИрдВ рдЬреЛ рдмрдЪрдд рдХреЗ рд▓рд╛рдпрдХ рд╣реИред рд╣рдо рдореЛрд╢рди рдХреЗ рдЧреБрдгрд╛рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХреБрд▓реНрд╣рд╛рдбрд╝рд┐рдпреЛрдВ рдХреЗ рд╕рдмрд╕реЗ рдЪрд░рдо рдореВрд▓реНрдп рдХреЛ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> Vector3 direction = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(xDelta, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zDelta).normalized; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> damping = Mathf.Max(Mathf.Abs(xDelta), Mathf.Abs(zDelta)); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = moveSpeed * damping * Time.deltaTime;</code> </pre><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд╖реАрдгрди рдХреЗ рд╕рд╛рде рдЖрдВрджреЛрд▓рдиред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЖрдВрджреЛрд▓рди рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдХрдо рд╕реЗ рдХрдо рдЬрд╝реВрдо рдореЗрдВ рд╡реГрджреНрдзрд┐ рдХреЗ рд╕рд╛рдеред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдХреБрдЫ рд╣реА рджреВрд░реА рдкрд░ рдпрд╣ рдмрд╣реБрдд рдзреАрдорд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХрдо рдЬрд╝реВрдо рдХреЗ рд╕рд╛рде, рд╣рдореЗрдВ рдЧрддрд┐ рдмрдврд╝рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ </font></font><code>moveSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреНрдпреВрдирддрдо рдФрд░ рдЕрдзрд┐рдХрддрдо рдЬрд╝реВрдо рдХреЗ рд▓рд┐рдП рджреЛ рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">рдПрдХ рдЪрд░ </font><font style="vertical-align: inherit;">рдХреЛ </font><font style="vertical-align: inherit;">рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ </font><font style="vertical-align: inherit;">рдФрд░ рдлрд┐рд░ рдЗрдВрдЯрд░рдкреЛрд▓рд┐рдВрдЧ </font><font style="vertical-align: inherit;">рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ 400 рдФрд░ 100 рдХреЗ рдорд╛рди рдкреНрд░рджрд╛рди рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public float moveSpeed; public float moveSpeedMinZoom, moveSpeedMaxZoom; void AdjustPosition (float xDelta, float zDelta) { Vector3 direction = new Vector3(xDelta, 0f, zDelta).normalized; float damping = Mathf.Max(Mathf.Abs(xDelta), Mathf.Abs(zDelta)); float distance = Mathf.Lerp(moveSpeedMinZoom, moveSpeedMaxZoom, zoom) * damping * Time.deltaTime; Vector3 position = transform.localPosition; position += direction * distance; transform.localPosition = position; }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a9/cb8/65e/5a9cb865ee0a67d4b3ad056317faf479.png"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдВрджреЛрд▓рди рдХреА рдЧрддрд┐ рдЬрд╝реВрдо рд╕реНрддрд░ рдХреЗ рд╕рд╛рде рдмрджрд▓рддреА рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдЬрд▓реНрджреА рд╕реЗ рдореИрдк рдкрд░ рдШреВрдо рд╕рдХрддреЗ рд╣реИрдВ! </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдо рдирдХреНрд╢реЗ рд╕реЗ рдмрд╣реБрдд рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрд╡рд╛рдВрдЫрдиреАрдп рд╣реИред </font><font style="vertical-align: inherit;">рдХреИрдорд░рд╛ рдореИрдк рдХреЗ рдЕрдВрджрд░ рд╣реА рд░рд╣рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдорд╛рдирдЪрд┐рддреНрд░ рдХреА рд╕реАрдорд╛рдУрдВ рдХреЛ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЧреНрд░рд┐рдб рдХреА рдПрдХ рд▓рд┐рдВрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGrid grid;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e71/f87/68e/e71f8768e16aee250700a7bd694a0e6b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреНрд░рд┐рдб рдЖрдХрд╛рд░ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдирдИ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдирдИ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рд╕реАрдорд┐рдд рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { тАж transform.localPosition = ClampPosition(position); } <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрдерд┐рддрд┐ X рдХрд╛ рдиреНрдпреВрдирддрдо рдорд╛рди 0 рд╣реИ, рдФрд░ рдЕрдзрд┐рдХрддрдо рдорд╛рдирдЪрд┐рддреНрд░ рдХреЗ рдЖрдХрд╛рд░ рд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реЛрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xMax = grid.chunkCountX * HexMetrics.chunkSizeX * (<span class="hljs-number"><span class="hljs-number">2f</span></span> * HexMetrics.innerRadius); position.x = Mathf.Clamp(position.x, <span class="hljs-number"><span class="hljs-number">0f</span></span>, xMax); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрд╣реА рд╕реНрдерд┐рддрд┐ Z рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреА рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xMax = grid.chunkCountX * HexMetrics.chunkSizeX * (<span class="hljs-number"><span class="hljs-number">2f</span></span> * HexMetrics.innerRadius); position.x = Mathf.Clamp(position.x, <span class="hljs-number"><span class="hljs-number">0f</span></span>, xMax); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zMax = grid.chunkCountZ * HexMetrics.chunkSizeZ * (<span class="hljs-number"><span class="hljs-number">1.5f</span></span> * HexMetrics.outerRadius); position.z = Mathf.Clamp(position.z, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zMax); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рдереЛрдбрд╝рд╛ рдЧрд▓рдд рд╣реИред </font><font style="vertical-align: inherit;">рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдмрд┐рдВрджреБ рдХреЛрд╢рд┐рдХрд╛ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рд╣реИ, рдмрд╛рдИрдВ рдУрд░ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдХреИрдорд░рд╛ рд╕рдмрд╕реЗ рд╕рд╣реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рдмрдВрдж рд╣реЛред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХреНрд╕ рдХреЗ рдЕрдзрд┐рдХрддрдо рд╕реЗ рдЖрдзреЗ рд╕реЗрд▓ рдХреЛ рдШрдЯрд╛рдПрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xMax = (grid.chunkCountX * HexMetrics.chunkSizeX - <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) * (<span class="hljs-number"><span class="hljs-number">2f</span></span> * HexMetrics.innerRadius); position.x = Mathf.Clamp(position.x, <span class="hljs-number"><span class="hljs-number">0f</span></span>, xMax);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрд╕реА рдХрд╛рд░рдг рд╕реЗ, рд╣рдореЗрдВ рдЕрдзрд┐рдХрддрдо рдЬреЗрдб рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЪреВрдВрдХрд┐ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рд╣реИрдВ, рд╣рдореЗрдВ рдкреВрд░реНрдг рд╕реЗрд▓ рдХреЛ рдШрдЯрд╛рдирд╛ рд╣реЛрдЧрд╛ред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zMax = (grid.chunkCountZ * HexMetrics.chunkSizeZ - <span class="hljs-number"><span class="hljs-number">1</span></span>) * (<span class="hljs-number"><span class="hljs-number">1.5f</span></span> * HexMetrics.outerRadius); position.z = Mathf.Clamp(position.z, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zMax);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЖрдВрджреЛрд▓рди рдХреЗ рд╕рд╛рде, рдХреЗрд╡рд▓ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рд╡рд┐рд╕реНрддрд╛рд░ рд░рд╣рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХрднреА-рдХрднреА UI рддреАрд░ рдХреБрдВрдЬреА рдкрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рдЗрд╕ рддрдереНрдп рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдЬрдм рдЖрдк рдХреИрдорд░реЗ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╕реНрд▓рд╛рдЗрдбрд░ рдЪрд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдпреВрдЖрдИ рдЦреБрдж рдХреЛ рд╕рдХреНрд░рд┐рдп рдорд╛рдирддрд╛ рд╣реИ, рдЬрдм рдЖрдк рдЙрд╕ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдХрд░реНрд╕рд░ рдЗрд╕рдХреЗ рдКрдкрд░ рд░рд╣рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдк рдХреАрдмреЛрд░реНрдб рдЗрдирдкреБрдЯ рд╕реБрдирдиреЗ рд╕реЗ рдпреВрдЖрдИ рдХреЛ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EventSystem</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдСрдмреНрдЬреЗрдХреНрдЯ </font><font style="vertical-align: inherit;">рдХреЛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреЗрд╡рд┐рдЧреЗрд╢рди рдиреЗрд╡рд┐рдЧреЗрд╢рди рдЗрд╡реЗрдВрдЯреНрд╕</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд░рдиреЗ рдХрд╛ </font><em><font style="vertical-align: inherit;">рдирд┐рд░реНрджреЗрд╢</font></em><font style="vertical-align: inherit;"> рджреЗрдХрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/008/313/35c/00831335c530f6fcb06d4fe15890c316.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрдИ рдФрд░ рдиреЗрд╡рд┐рдЧреЗрд╢рди рдЗрд╡реЗрдВрдЯ рдирд╣реАрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЛрдбрд╝ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЪрдЯреНрдЯрд╛рди рдХреЗ рдкреАрдЫреЗ рдХреНрдпрд╛ рд╣реИ? </font><font style="vertical-align: inherit;">рдХреИрдорд░реЗ рдХреЛ рдШреБрдорд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрдЧрд╛! </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдЯреЗрд╢рди рдХреЗ рд▓рд┐рдП рдЬрд╝реВрдо рд╕реНрддрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИ, рдХреЗрд╡рд▓ рдЧрддрд┐ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЪрд░ рдЬреЛрдбрд╝реЗрдВ </font></font><code>rotationSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ 180 рдбрд┐рдЧреНрд░реА рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред </font><em><font style="vertical-align: inherit;">рд░реЛрдЯреЗрд╢рди</font></em></font><code>Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдХреНрд╖ рдХреА рдЬрд╛рдВрдЪ </font><font style="vertical-align: inherit;">рдХрд░рдХреЗ рдФрд░ рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рд░реЛрдЯреЗрд╢рди рдХреЛ рдмрджрд▓рдХрд░ </font><font style="vertical-align: inherit;">рд░реЛрдЯреЗрд╢рди рдбреЗрд▓реНрдЯрд╛ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rotationSpeed; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zoomDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Mouse ScrollWheel"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (zoomDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustZoom(zoomDelta); } <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rotationDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Rotation"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rotationDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustRotation(rotationDelta); } <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> zDelta = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span> || zDelta != <span class="hljs-number"><span class="hljs-number">0f</span></span>) { AdjustPosition(xDelta, zDelta); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustRotation</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c17/189/c8f/c17189c8f16ef3e50aa8af32f7ff34c8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрдбрд╝рдиреЗ рдХреА рдЧрддрд┐ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдЯреЗрд╢рди</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдХреНрд╖ </font><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк </font><font style="vertical-align: inherit;">рд╕реЗ </font><font style="vertical-align: inherit;">рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрдирдкреБрдЯ рдорд╛рдкрджрдВрдбреЛрдВ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рд╕рдмрд╕реЗ рдКрдкрд░реА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рдВрдмрд╡рдд</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд╛ рдирд╛рдо </font><font style="vertical-align: inherit;">рдмрджрд▓рдХрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rotation</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ QE рдФрд░ рдЕрд▓реНрдкрд╡рд┐рд░рд╛рдо (,) рдХреЗ рд╕рд╛рде рдПрдХ рдЕрд╡рдзрд┐ () рдореЗрдВ рдмрджрд▓реЗрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/549/6a8/50a/5496a850af906515b57a0d0fd1aea7b5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдирдкреБрдЯ рдЕрдХреНрд╖ рдХреЛ рдЪрд╛рд▓реВ рдХрд░реЗрдВред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдПрдХрддрд╛ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛, рдореЗрд░реЗ рдкрд╛рд╕ рдпрд╣ рдЗрдирдкреБрдЯ рдХреНрдпреЛрдВ рдирд╣реАрдВ рд╣реИ?</font></font></b> <div class="spoiler_text">     .       Unity.  ,     .    ,    ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдЯреЗрд╢рди рдХреЛрдг рд╣рдо рдЯреНрд░реИрдХ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдЕрдВрджрд░ рдмрджрд▓реЗрдВрдЧреЗ </font></font><code>AdjustRotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рд╣рдо рдкреВрд░реЗ рдХреИрдорд░рд╛ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд░реЛрдЯреЗрдЯ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rotationAngle; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustRotation</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { rotationAngle += delta * rotationSpeed * Time.deltaTime; transform.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, rotationAngle, <span class="hljs-number"><span class="hljs-number">0f</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪреВрдВрдХрд┐ рдкреВрд░реНрдг рдЪрдХреНрд░ 360 рдбрд┐рдЧреНрд░реА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рд░реЛрдЯреЗрд╢рди рдХреЛрдг рдХреЛ рд░реЛрд▓ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпрд╣ 0 рд╕реЗ 360 рддрдХ рд╣реЛред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustRotation</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { rotationAngle += delta * rotationSpeed * Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rotationAngle &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span>) { rotationAngle += <span class="hljs-number"><span class="hljs-number">360f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rotationAngle &gt;= <span class="hljs-number"><span class="hljs-number">360f</span></span>) { rotationAngle -= <span class="hljs-number"><span class="hljs-number">360f</span></span>; } transform.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, rotationAngle, <span class="hljs-number"><span class="hljs-number">0f</span></span>); }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрд░рд╡рд╛рдИ рдореЗрдВ рдмрд╛рд░реАред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд░реЛрдЯреЗрд╢рди рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдВрджреЛрд▓рди рдирд┐рд░рдкреЗрдХреНрд╖ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, 180 рдбрд┐рдЧреНрд░реА рдореЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдВрджреЛрд▓рди рд╡рд╣реА рд╣реЛрдЧрд╛ рдЬреЛ рдЕрдкреЗрдХреНрд╖рд┐рдд рдерд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрдЧрд╛ рдХрд┐ рдХреИрдорд░реЗ рдХреЗ рджреЗрдЦрдиреЗ рдХреЗ рдХреЛрдг рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдЖрдВрджреЛрд▓рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдЖрдВрджреЛрд▓рди рдХреА рджрд┐рд╢рд╛ рд╕реЗ рд╡рд░реНрддрдорд╛рди рд░реЛрдЯреЗрд╢рди рдХреЛ рдЧреБрдгрд╛ рдХрд░рдХреЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AdjustPosition</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xDelta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zDelta</span></span></span><span class="hljs-function">)</span></span> { Vector3 direction = transform.localRotation * <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(xDelta, <span class="hljs-number"><span class="hljs-number">0f</span></span>, zDelta).normalized; тАж }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдкреЗрдХреНрд╖ рд╡рд┐рд╕реНрдерд╛рдкрдиред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрдиреНрдирдд рд╕рдВрдкрд╛рджрди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдмрдбрд╝рд╛ рдирдХреНрд╢рд╛ рд╣реИ, рддреЛ рдЖрдк рдорд╛рдирдЪрд┐рддреНрд░ рд╕рдВрдкрд╛рджрди рдЯреВрд▓ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдПрдХ рд╕рдордп рдореЗрдВ рдПрдХ рд╕реЗрд▓ рдмрджрд▓рдирд╛ рдмрд╣реБрдд рд▓рдВрдмрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рдмрдбрд╝рд╛ рдмреНрд░рд╢ рдмрдирд╛рдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рднреА рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрдЧрд╛ рдпрджрд┐ рдЖрдк рдкреЗрдВрдЯ рдХреЛ рдмрджрд▓рдирд╛ рдпрд╛ рдКрдБрдЪрд╛рдИ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдмрд╛рдХреА рд╕рдм рдХреЛ рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рдЫреЛрдбрд╝ рджреЗрдВред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡реИрдХрд▓реНрдкрд┐рдХ рд░рдВрдЧ рдФрд░ рдКрдВрдЪрд╛рдИ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЯреЙрдЧрд▓ рд╕рдореВрд╣ рдореЗрдВ рдПрдХ рдЦрд╛рд▓реА рдЪрдпрди рд╡рд┐рдХрд▓реНрдк рдЬреЛрдбрд╝рдХрд░ рд░рдВрдЧреЛрдВ рдХреЛ рд╡реИрдХрд▓реНрдкрд┐рдХ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд░рдВрдЧ рд╕реНрд╡рд┐рдЪреЗрд╕ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдПрдХ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░реЗрдВ рдФрд░ рдЗрд╕рдХреЗ рд▓реЗрдмрд▓ рдХреЛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрд╛ рдХреБрдЫ рдЗрд╕реА рддрд░рд╣ рд╕реЗ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдпрд╣ рд░рдВрдЧ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рдЗрд╕рдХреЗ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдСрди рд╡реИрд▓реНрдпреВ рдЪреЗрдВрдЬреЗрдб</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╡реЗрдВрдЯ рдХреЗ рддрд░реНрдХ рдХреЛ рдмрджрд▓рдХрд░ </font><em><font style="vertical-align: inherit;">its1</font></em><font style="vertical-align: inherit;"> рдХрд░ рджреЗрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/786/485/b0c/786485b0cbbae8edee6c80873f19afc3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдорд╛рдиреНрдп рд░рдВрдЧ рд╕реВрдЪрдХрд╛рдВрдХред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдпрд╣ рд╕реВрдЪрдХрд╛рдВрдХ рд░рдВрдЧреЛрдВ рдХреА рдПрдХ рд╕рд░рдгреА рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд░рдВрдЧ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyColor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelectColor</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { applyColor = index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { activeColor = colors[index]; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } cell.Elevation = activeElevation; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдВрдЪрд╛рдИ рдПрдХ рд╕реНрд▓рд╛рдЗрдбрд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕рдореЗрдВ рд╕реНрд╡рд┐рдЪ рдирд╣реАрдВ рдЬреЛрдбрд╝ рд╕рдХрддреЗред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдКрдВрдЪрд╛рдИ рд╕рдВрдкрд╛рджрди рдХреЛ рд╕рдХреНрд╖рдо рдпрд╛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╕реНрд╡рд┐рдЪ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдпрд╣ рд╕рдХреНрд╖рдо рд╣реЛ рдЬрд╛рдПрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyElevation = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UI рдореЗрдВ рдПрдХ рдирдИ рдКрдВрдЪрд╛рдИ рд╕реНрд╡рд┐рдЪ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдореИрдВ рд╕рдм рдХреБрдЫ рдПрдХ рдирдП рдкреИрдирд▓ рдкрд░ рднреА рдбрд╛рд▓реВрдВрдЧрд╛, рдФрд░ рдКрдВрдЪрд╛рдИ рд╕реНрд▓рд╛рдЗрдбрд░ рдХреЛ рдХреНрд╖реИрддрд┐рдЬ рдмрдирд╛ рджреВрдВрдЧрд╛ рддрд╛рдХрд┐ рдпреВрдЖрдИ рдЕрдзрд┐рдХ рд╕реБрдВрджрд░ рд╣реЛред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07d/cab/84d/07dcab84d8e8fe4daac4b6120df34d60.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реИрдХрд▓реНрдкрд┐рдХ рд░рдВрдЧ рдФрд░ рдКрдВрдЪрд╛рдИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдВрдЪрд╛рдИ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдирдИ рд╡рд┐рдзрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╣рдо UI рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyElevation</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyElevation = toggle; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рдКрдВрдЪрд╛рдИ рд╕реНрд╡рд┐рдЪ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдХреЗ, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдбрд╛рдпрдирд╛рдорд┐рдХ рдмреВрд▓ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рд╕реВрдЪреА рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рд╣реА рд╕рдВрд╕реНрдХрд░рдг рдирд┐рд░реАрдХреНрд╖рдХ рдореЗрдВ рдЪреЗрдХрдорд╛рд░реНрдХ рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/887/d5b/1b2/887d5b1b275cb18957b63bcbecf145d4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдКрдВрдЪрд╛рдИ рд╕реНрд╡рд┐рдЪ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдХреЗрд╡рд▓ рдлреВрд▓реЛрдВ рдпрд╛ рдХреЗрд╡рд▓ рдКрдВрдЪрд╛рдИ рдХреЗ рд╕рд╛рде рд░рдВрдЧ рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╛ рджреЛрдиреЛрдВ, рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣ред </font><font style="vertical-align: inherit;">рд╣рдо рдпрд╛ рддреЛ рдПрдХ рдпрд╛ рджреВрд╕рд░реЗ рдХреЛ рдирд╣реАрдВ рдмрджрд▓рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рдпрд╣ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реИред</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рдВрдЧ рдФрд░ рдКрдВрдЪрд╛рдИ рдХреЗ рдмреАрдЪ рд╕реНрд╡рд┐рдЪ рдХрд░реЗрдВред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рдВрдЧ рдЪреБрдирддреЗ рд╕рдордп рдКрдБрдЪрд╛рдИ рдХреНрдпреЛрдВ рдмрдВрдж рд╣реЛ рдЬрд╛рддреА рд╣реИ?</font></font></b> <div class="spoiler_text">  ,       toggle group. ,          ,     toggle group. </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмреНрд░рд╢ рдХрд╛ рдЖрдХрд╛рд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдХрд╛рд░ рджреЗрдиреЗ рдпреЛрдЧреНрдп рдмреНрд░рд╢ рдЖрдХрд╛рд░ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкреВрд░реНрдгрд╛рдВрдХ рдЪрд░ </font></font><code>brushSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ UI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕реЗ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рд╕реНрд▓рд╛рдЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдлрд┐рд░ рд╕реЗ рд╣рдореЗрдВ рдорд╛рди рдХреЛ рдлреНрд▓реЛрдЯ рд╕реЗ рдЗрдВрдЯ рдореЗрдВ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> brushSize; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetBrushSize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size</span></span></span><span class="hljs-function">)</span></span> { brushSize = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)size; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/794/bfb/60f/794bfb60f2f1c777fa0363ede3f19540.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреНрд░рд╢ рдХреЗ рдЖрдХрд╛рд░ рдХрд╛ рд╕реНрд▓рд╛рдЗрдбрд░ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдк рдКрдВрдЪрд╛рдИ рд╕реНрд▓рд╛рдЗрдбрд░ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░рдХреЗ рдПрдХ рдирдпрд╛ рд╕реНрд▓рд╛рдЗрдбрд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрдзрд┐рдХрддрдо рдореВрд▓реНрдп рдХреЛ 4 рдореЗрдВ рдмрджрд▓реЗрдВ рдФрд░ рдЗрд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╡рд┐рдзрд┐ рдореЗрдВ рд╕рдВрд▓рдЧреНрди рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЙрд╕рдХреЗ рд╕рд╛рде рдПрдХ рдЯреИрдЧ рднреА рдЬреЛрдбрд╝рд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/8b2/f58/88e8b2f58abfd48657387e6670c51215.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреНрд░рд╢ рдЖрдХрд╛рд░ рд╕реНрд▓рд╛рдЗрдбрд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдм рд╣рдо рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдХрдИ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>EditCells</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╡рд┐рдзрд┐ рдореЗрдВ </font></font><code>EditCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╛рдорд┐рд▓ рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдХреЙрд▓ </font><font style="vertical-align: inherit;">рдХрд┐рдпрд╛ </font><font style="vertical-align: inherit;">рдЬрд╛рдПрдЧрд╛ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ рдЪрдпрдирд┐рдд рд╕реЗрд▓ рдХреЛ рдмреНрд░рд╢ рдХрд╛ рдХреЗрдВрджреНрд░ рдорд╛рдирд╛ рдЬрд╛рдПрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Ray inputRay = Camera.main.ScreenPointToRay(Input.mousePosition); RaycastHit hit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Physics.Raycast(inputRay, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> hit)) { EditCells(hexGrid.GetCell(hit.point)); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell center</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреНрд░рд╢ рдХрд╛ рдЖрдХрд╛рд░ рд╕рдВрдкрд╛рджрди рдХреА рддреНрд░рд┐рдЬреНрдпрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">0 рдХреА рддреНрд░рд┐рдЬреНрдпрд╛ рдХреЗ рд╕рд╛рде, рдпрд╣ рдХреЗрд╡рд▓ рдПрдХ рдХреЗрдВрджреНрд░реАрдп рд╕реЗрд▓ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">1 рдХреА рддреНрд░рд┐рдЬреНрдпрд╛ рдХреЗ рд╕рд╛рде, рдпрд╣ рдХреЗрдВрджреНрд░ рдФрд░ рдЗрд╕рдХреЗ рдкрдбрд╝реЛрд╕реА рд╣реЛрдВрдЧреЗред </font><font style="vertical-align: inherit;">2 рдХреЗ рджрд╛рдпрд░реЗ рдореЗрдВ, рдХреЗрдВрджреНрд░ рдХреЗ рдкрдбрд╝реЛрд╕реА рдФрд░ рдЙрдирдХреЗ рдирд┐рдХрдЯрд╡рд░реНрддреА рдкрдбрд╝реЛрд╕реА рд╕реНрд╡рд┐рдЪ рдСрди рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реА рддрд░рд╣ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/612/14d/b65/61214db6508869c0ceda156c103ca032.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреНрд░рд┐рдЬреНрдпрд╛ рддрдХред 3.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдХ рд▓реВрдк рдореЗрдВ рдЙрдирдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рд╣рдореЗрдВ рдХреЗрдВрджреНрд░ рдХреЗ рдПрдХреНрд╕ рдФрд░ рдЬреЗрдб рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell center</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerX = center.coordinates.X; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerZ = center.coordinates.Z; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рддреНрд░рд┐рдЬреНрдпрд╛ рдХреЛ рдШрдЯрд╛рдХрд░ рдиреНрдпреВрдирддрдо Z рд╕рдордиреНрд╡рдп рдкрд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рддреЛ рд╣рдо рд╢реВрдиреНрдп рд░реЗрдЦрд╛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рд▓рд╛рдЗрди рдкрд░ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдХреЗрдВрджреНрд░ рдореЗрдВ рд▓рд╛рдЗрди рдХреЛ рдХрд╡рд░ рдХрд░рдиреЗ рддрдХ рд▓реВрдк рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell center</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerX = center.coordinates.X; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerZ = center.coordinates.Z; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, z = centerZ - brushSize; z &lt;= centerZ; z++, r++) { } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреАрдЪреЗ рдХреА рдкрдВрдХреНрддрд┐ рдореЗрдВ рдкрд╣рд▓реА рд╕реЗрд▓ рдореЗрдВ рдХреЗрдВрджреНрд░ рд╕реЗрд▓ рдХреЗ рд╕рдорд╛рди рдПрдХреНрд╕ рд╕рдордиреНрд╡рдп рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рдордиреНрд╡рдп рдмрдврд╝рддреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд╕рд╛рде рдШрдЯрддрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрддрд┐рдо рд╕реЗрд▓ рдореЗрдВ рд╣рдореЗрд╢рд╛ рдХреЗрдВрджреНрд░ рд╕рдордиреНрд╡рдп рдкреНрд▓рд╕ рддреНрд░рд┐рдЬреНрдпрд╛ рдХреЗ рдмрд░рд╛рдмрд░ рдПрдХ рдПрдХреНрд╕ рд╕рдордиреНрд╡рдп рд╣реЛрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рдкрдВрдХреНрддрд┐ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рд▓реВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рджреНрд╡рд╛рд░рд╛ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, z = centerZ - brushSize; z &lt;= centerZ; z++, r++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = centerX - r; x &lt;= centerX + brushSize; x++) { EditCell(hexGrid.GetCell(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCoordinates(x, z))); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рддрдХ </font></font><code>HexGrid.GetCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдордиреНрд╡рдп рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдПрдХ </font><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдирд╣реАрдВ рд╣реИ </font><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдмрдирд╛рдПрдВред </font><font style="vertical-align: inherit;">рд╡рд┐рд╕реНрдерд╛рдкрди рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░реЗрдВ рдФрд░ рд╕реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCoordinates coordinates</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = coordinates.Z; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = coordinates.X + z / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cells[x + z * cellCountX]; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b59/490/9f2/b594909f28de1c2d52c954d312d7b90f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреНрд░рд╢ рдХрд╛ рдирд┐рдЪрд▓рд╛ рд╣рд┐рд╕реНрд╕рд╛, рдЖрдХрд╛рд░ 2.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдмрд╛рдХреА рдмреНрд░рд╢ рдХреЛ рдХрд╡рд░ рдХрд░рддреЗ рд╣реИрдВ, рдКрдкрд░ рд╕реЗ рдиреАрдЪреЗ рддрдХ рдПрдХ рдЪрдХреНрд░ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рддрд░реНрдХ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдХреЗрдВрджреНрд░реАрдп рдкрдВрдХреНрддрд┐ рдХреЛ рдмрд╛рд╣рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell center</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerX = center.coordinates.X; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerZ = center.coordinates.Z; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, z = centerZ - brushSize; z &lt;= centerZ; z++, r++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = centerX - r; x &lt;= centerX + brushSize; x++) { EditCell(hexGrid.GetCell(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCoordinates(x, z))); } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, z = centerZ + brushSize; z &gt; centerZ; z--, r++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = centerX - brushSize; x &lt;= centerX + r; x++) { EditCell(hexGrid.GetCell(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCoordinates(x, z))); } } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e8/add/c7c/9e8addc7cf0012210cdd5dc0588bc6cf.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкреВрд░реНрдг рдмреНрд░рд╢, рдЖрдХрд╛рд░ 2.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрд╣ рддрдм рддрдХ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬрдм рддрдХ рдХрд┐ рд╣рдорд╛рд░рд╛ рдмреНрд░рд╢ рдЧреНрд░рд┐рдб рдХреА рд╕реАрдорд╛рдУрдВ рд╕реЗ рдкрд░реЗ рдирд╣реАрдВ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЬрдм рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдПрдХ рдЗрдВрдбреЗрдХреНрд╕-рдЖрдЙрдЯ-рдСрдл-рд░реЗрдВрдЬ рдЕрдкрд╡рд╛рдж рдорд┐рд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реАрдорд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ </font></font><code>HexGrid.GetCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдХреЛрдИ рднреА рдмрд┐рдирд╛ рд╕реЗрд▓ рдХреЗ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ </font><font style="vertical-align: inherit;">рд╡рд╛рдкрд╕ рд▓реМрдЯреЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCoordinates coordinates</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = coordinates.Z; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || z &gt;= cellCountZ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = coordinates.X + z / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || x &gt;= cellCountX) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cells[x + z * cellCountX]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд▓-рд╕рдВрджрд░реНрдн-рдЕрдкрд╡рд╛рдж рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╕реЗрд▓ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдореМрдЬреВрдж рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } } }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрдИ рдмреНрд░рд╢ рдЖрдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрд▓ рд▓реЗрдмрд▓ рджреГрд╢реНрдпрддрд╛ рдЯреЙрдЧрд▓ рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдХ рдмрд╛рд░ рдирд╣реАрдВ, рд╣рдореЗрдВ рд╕реЗрд▓ рд▓реЗрдмрд▓ рджреЗрдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рддреЛ рдЪрд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рд╡реИрдХрд▓реНрдкрд┐рдХ рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдХреЗ рдмрд╛рдж рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдЯреБрдХрдбрд╝рд╛ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдХреИрдирд╡рд╛рд╕ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИ, рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝рдиреЗ рдХреЗ </font></font><code>ShowUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд┐рдП </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬрдм рдпреВрдЖрдИ рджрд┐рдЦрд╛рдИ рджреЗрдиреА рдЪрд╛рд╣рд┐рдП, рд╣рдо рдХреИрдирд╡рд╛рд╕ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдЗрд╕реЗ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowUI</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visible</span></span></span><span class="hljs-function">)</span></span> { gridCanvas.gameObject.SetActive(visible); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрдЗрдП рдпреВрдЖрдИ рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЫрд┐рдкрд╛рддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { gridCanvas = GetComponentInChildren&lt;Canvas&gt;(); hexMesh = GetComponentInChildren&lt;HexMesh&gt;(); cells = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCell[HexMetrics.chunkSizeX * HexMetrics.chunkSizeZ]; ShowUI(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗ рдмрд╛рдж рд╕реЗ рдпреВрдЖрдИ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдкреВрд░реЗ рдирдХреНрд╢реЗ рдХреЗ рд▓рд┐рдП рд╕реНрд╡рд┐рдЪ, рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝рдиреЗ </font></font><code>ShowUI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рд┐рд░реНрдл рдЗрд╕рдХреЗ рдЕрдВрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдкрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowUI</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visible</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; chunks.Length; i++) { chunks[i].ShowUI(visible); } }</code> </pre> <br> <code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЧреНрд░рд┐рдб рдХреЗ рдЕрдиреБрд░реЛрдз рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реА рд╡рд┐рдзрд┐ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреА рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowUI</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visible</span></span></span><span class="hljs-function">)</span></span> { hexGrid.ShowUI(visible); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдВрдд рдореЗрдВ, рд╣рдо UI рдореЗрдВ рдПрдХ рд╕реНрд╡рд┐рдЪ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/120/637/740/120637740d174168d298407ec129c0d3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреИрдЧ рджреГрд╢реНрдпрддрд╛ рд╕реНрд╡рд┐рдЪред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 6: рдирджрд┐рдпрд╛рдБ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджрд┐рдпреЛрдВ рдХреЛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдбреНрд░реЙрдЗрдВрдЧ рдирджрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдЦреАрдВрдЪреЗрдВ рдФрд░ рдЫреЛрдбрд╝реЗрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рд┐рд╡рд░рдмреЗрдб рдмрдирд╛рдирд╛ред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рддрд┐ рдЯреБрдХрдбрд╝рд╛ рдХрдИ рдЬрд╛рд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рд╕рд╛рдЭрд╛ рд╕реВрдЪреА рдкреВрд▓ рдмрдирд╛рдПрдБред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддреНрд░рд┐рдХреЛрдгреАрдпрдХрд░рдг рдФрд░ рдмрд╣рддреЗ рдкрд╛рдиреА рдХрд╛ рдПрдиреАрдореЗрд╢рдиред </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд┐рдЫрд▓реЗ рднрд╛рдЧ рдореЗрдВ, рд╣рдордиреЗ рдмрдбрд╝реЗ рдорд╛рдирдЪрд┐рддреНрд░реЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХреА рдереАред </font><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдмрдбрд╝реЗ рд░рд╛рд╣рдд рддрддреНрд╡реЛрдВ рдХреА рдУрд░ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рдмрд╛рд░ рд╣рдо рдирджрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56a/e66/4fb/56ae664fb799dd59d5d8e85397945937.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд╛рдбрд╝реЛрдВ рд╕реЗ рдирджрд┐рдпрд╛рдБ рдмрд╣рддреА рд╣реИрдВред</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА рдХреА рдХреЛрд╢рд┐рдХрд╛рдПрдБ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдХреНрд╕рд╛рдЧреЛрдиреНрд╕ рдХреЗ рдЧреНрд░рд┐рдб рдореЗрдВ рдирджрд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рддреАрди рддрд░реАрдХреЗ рд╣реИрдВред рдкрд╣рд▓рд╛ рддрд░реАрдХрд╛ рдЙрдиреНрд╣реЗрдВ рд╕реЗрд▓ рд╕реЗ рд╕реЗрд▓ рдореЗрдВ рдЬрд╛рдиреЗ рджреЗрдирд╛ рд╣реИред рдЗрд╕ рддрд░рд╣ рдЗрд╕реЗ рдПрдВрдбрд▓реЗрд╕ рд▓реАрдЬреЗрдВрдб рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рджреВрд╕рд░рд╛ рддрд░реАрдХрд╛ рд╣реИ, рдЙрдиреНрд╣реЗрдВ рдХрд┐рдирд╛рд░реЗ рд╕реЗ рдХрд┐рдирд╛рд░реЗ рддрдХ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдкреНрд░рд╡рд╛рд╣ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВред рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рд╕рднреНрдпрддрд╛ 5 рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рддреАрд╕рд░рд╛ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдирджреА рдХреЗ рд╡рд┐рд╢реЗрд╖ рдврд╛рдВрдЪреЗ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдмрд┐рд▓реНрдХреБрд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдП, рдмрд▓реНрдХрд┐ рдЙрдиреНрд╣реЗрдВ рд╕реБрдЭрд╛рд╡ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рдиреА рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПред рдЗрд╕рд▓рд┐рдП рдирджрд┐рдпреЛрдВ рдХреЛ рдЖрдпреБ рдХреЗ рдЪрдорддреНрдХрд╛рд░ 3 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ </font><font style="vertical-align: inherit;">рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдврд▓рд╛рди рдФрд░ рдЪрдЯреНрдЯрд╛рдиреЛрдВ рдХрд╛ рдХрдмреНрдЬрд╛ рд╣реИред рдЗрд╕рд╕реЗ рдирджрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдХрдо рдЬрдЧрд╣ рдмрдЪреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╕реЗрд▓ рд╕реЗ рд╕реЗрд▓ рдореЗрдВ рдкреНрд░рд╡рд╛рд╣рд┐рдд рдХрд░реЗрдВрдЧреЗред рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдХреЛрд╢рд┐рдХрд╛ рдореЗрдВ рдпрд╛ рддреЛ рдХреЛрдИ рдирджреА рдирд╣реАрдВ рд╣реЛрдЧреА, рдпрд╛ рдЙрд╕рдХреЗ рд╕рд╛рде рдПрдХ рдирджреА рдмрд╣реЗрдЧреА, рдпрд╛ рдЙрд╕рдореЗрдВ рдирджреА рдХреА рд╢реБрд░реБрдЖрдд рдпрд╛ рдЕрдВрдд рд╣реЛрдЧрд╛ред рдЙрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЬрд┐рдирдХреЗ рд╕рд╛рде рдирджреА рдмрд╣рддреА рд╣реИ, рдпрд╣ рд╕реАрдзреЗ рдкреНрд░рд╡рд╛рд╣ рдХрд░ рд╕рдХрддреА рд╣реИ, рдПрдХ рдореЛрдбрд╝ рдПрдХ рдХрджрдо рдпрд╛ рджреЛ рдХрджрдо рдмрдирд╛ рд╕рдХрддреА рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e7f/db2/2a4/e7fdb22a4346f9281865ad95a1946f75.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдВрдЪ рд╕рдВрднрд╡ рдирджреА рд╡рд┐рдиреНрдпрд╛рд╕ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдирджрд┐рдпреЛрдВ рдХреА рд╢рд╛рдЦрд╛рдУрдВ рдпрд╛ рд╡рд┐рд▓рдп рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рдЪреАрдЬреЛрдВ рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдХрд░реЗрдЧрд╛, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдкрд╛рдиреА рдХрд╛ рдкреНрд░рд╡рд╛рд╣ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдкрд╛рдиреА рдХреА рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рд╕реЗ рд╣реИрд░рд╛рди рдирд╣реАрдВ рд╣реЛрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╣рдо рдЙрдиреНрд╣реЗрдВ рджреВрд╕рд░реЗ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА рдХреА рдЯреНрд░реИрдХрд┐рдВрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд┐рд╕ рд╕реЗрд▓ рдХреЗ рд╕рд╛рде рдирджреА рдмрд╣рддреА рд╣реИ рдЙрд╕реЗ рдПрдХ рд╕рд╛рде рдЖрдиреЗ рд╡рд╛рд▓реА рдФрд░ рдмрд╛рд╣рд░ рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдирджреА рдорд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЗрд╕рдореЗрдВ рдирджреА рдХреА рд╢реБрд░реБрдЖрдд рд╢рд╛рдорд┐рд▓ рд╣реИ, рддреЛ рдЗрд╕рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдмрд╣рдиреЗ рд╡рд╛рд▓реА рдирджреА рд╣реИред </font><font style="vertical-align: inherit;">рдФрд░ рдЕрдЧрд░ рдЗрд╕рдореЗрдВ рдирджреА рдХрд╛ рдЕрдВрдд рд╢рд╛рдорд┐рд▓ рд╣реИ, рддреЛ рдЗрд╕рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдмреВрд▓рд┐рдпрди рдорд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ </font><font style="vertical-align: inherit;">рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд╕рдХрддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasIncomingRiver, hasOutgoingRiver;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдпрд╣ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЗрди рдирджрд┐рдпреЛрдВ рдХреА рджрд┐рд╢рд╛ рдХреЛ рднреА рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдПрдХ рдЖрдЙрдЯрдЧреЛрдЗрдВрдЧ рдирджреА рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХрд╣рд╛рдВ рдШреВрдо рд░рд╣рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХрд╣рд╛рдВ рд╕реЗ рдЖрдпрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasIncomingRiver, hasOutgoingRiver; HexDirection incomingRiver, outgoingRiver;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рддреНрд░рд┐рдХреЛрдгреАрдп рдХрд░рддреЗ рд╕рдордп рд╣рдореЗрдВ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреБрдг рдЬреЛрдбрд╝реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╕реАрдзреЗ рдЕрд╕рд╛рдЗрди рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЖрдЧреЗ рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasIncomingRiver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasIncomingRiver; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasOutgoingRiver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasOutgoingRiver; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexDirection IncomingRiver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> incomingRiver; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexDirection OutgoingRiver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> outgoingRiver; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд╡рд╛рд▓ рдпрд╣ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕реЗрд▓ рдореЗрдВ рдПрдХ рдирджреА рд╣реИ, рд╡рд┐рд╡рд░рдг рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдкрддреНрддрд┐ рднреА рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasRiver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasIncomingRiver || hasOutgoingRiver; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдФрд░ рддрд╛рд░реНрдХрд┐рдХ рд╕рд╡рд╛рд▓: рд╕реЗрд▓ рдореЗрдВ рдирджреА рдХреА рд╢реБрд░реБрдЖрдд рдпрд╛ рдЕрдВрдд рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдиреЗ рд╡рд╛рд▓реА рдФрд░ рдмрд╛рд╣рд░ рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреА рд╕реНрдерд┐рддрд┐ рдЕрд▓рдЧ рд╣реИ, рддреЛ рдпрд╣ рд╕рд┐рд░реНрдл рдорд╛рдорд▓рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЗрд╕реЗ рдПрдХ рдФрд░ рд╕рдВрдкрддреНрддрд┐ рдмрдирд╛рдПрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasRiverBeginOrEnd { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasIncomingRiver != hasOutgoingRiver; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдЕрдВрдд рдореЗрдВ, рдпрд╣ рдЬрд╛рдирдирд╛ рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдирджреА рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд░рд┐рдЬ рд╕реЗ рдмрд╣рддреА рд╣реИ, рдЪрд╛рд╣реЗ рд╡рд╣ рдЖрдиреЗ рд╡рд╛рд▓реА рдпрд╛ рдмрд╛рд╣рд░ рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╣реЛред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasRiverThroughEdge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasIncomingRiver &amp;&amp; incomingRiver == direction || hasOutgoingRiver &amp;&amp; outgoingRiver == direction; }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА рдирд┐рдХрд╛рд▓рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо рдПрдХ рдирджреА рдХреЛ рдПрдХ рд╕реЗрд▓ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ, рдЪрд▓реЛ рдкрд╣рд▓реЗ рдирджреА рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рд▓рд╛рдЧреВ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдирджреА рдХреЗ рдХреЗрд╡рд▓ рдмрд╛рд╣рд░ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рд▓рд┐рдЦреЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╕реЗрд▓ рдореЗрдВ рдХреЛрдИ рдЖрдЙрдЯрдЧреЛрдЗрдВрдЧ рдирджреА рдирд╣реАрдВ рд╣реИ, рддреЛ рдХреБрдЫ рднреА рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдЗрд╕реЗ рдмрдВрдж рдХрд░реЗрдВ рдФрд░ рдЕрджреНрдпрддрди рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasOutgoingRiver) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Refresh(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдм рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдмрд╛рд╣рд░ рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреЛ рдХрд╣реАрдВ рдкрд░ рдЪрд▓рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреЗ рд╕рд╛рде рдПрдХ рдкрдбрд╝реЛрд╕реА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЙрд╕рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasOutgoingRiver) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Refresh(); HexCell neighbor = GetNeighbor(outgoingRiver); neighbor.hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbor.Refresh(); }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдПрдХ рдирджреА рдПрдХ рдирдХреНрд╢реЗ рд╕реЗ рдмрд╛рд╣рд░ рдирд╣реАрдВ рдирд┐рдХрд▓ рд╕рдХрддреА рд╣реИ?</font></font></b> <div class="spoiler_text">      ,     .     ,   . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рд╕реА рдирджреА рдХреЛ рдХрд┐рд╕реА рд╕реЗрд▓ рд╕реЗ рдирд┐рдХрд╛рд▓рдиреЗ рд╕реЗ рдХреЗрд╡рд▓ рдЙрд╕ рд╕реЗрд▓ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдмрджрд▓ рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдКрдВрдЪрд╛рдИ рдпрд╛ рд░рдВрдЧ рдХреЗ рд╕рдВрдкрд╛рджрди рдХреЗ рд╡рд┐рдкрд░реАрдд, рдпрд╣ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдХреЗрд╡рд▓ рд╕реЗрд▓ рдХреЛ рд╣реА рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреА рдирд╣реАрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasOutgoingRiver) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; RefreshSelfOnly(); HexCell neighbor = GetNeighbor(outgoingRiver); neighbor.hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbor.RefreshSelfOnly(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╡рд┐рдзрд┐ </font></font><code>RefreshSelfOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рдЙрд╕ рдЦрдВрдб рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреА рд╣реИ, рдЬреЛ рд╕реЗрд▓ рдХрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рд╣рдо рдЧреНрд░рд┐рдб рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рджреМрд░рд╛рди рдирджреА рдХреЛ рдирд╣реАрдВ рдмрджрд▓рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдпрд╣ рдЪрд┐рдВрддрд╛ рдХрд░рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдкрд╣рд▓реЗ рд╣реА рд╕реМрдВрдкрд╛ рдЬрд╛ рдЪреБрдХрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshSelfOnly</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { chunk.Refresh(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрдиреЗ рд╡рд╛рд▓реА рдирджрд┐рдпреЛрдВ рдХреЛ рд╣рдЯрд╛рдирд╛ рдЙрд╕реА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveIncomingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasIncomingRiver) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; RefreshSelfOnly(); HexCell neighbor = GetNeighbor(incomingRiver); neighbor.hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbor.RefreshSelfOnly(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдкреВрд░реА рдирджреА рдХреЛ рд╣рдЯрд╛рдиреЗ рдХрд╛ рд╕реАрдзрд╛ рдорддрд▓рдм рд╣реИ рдирджреА рдХреЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдФрд░ рдмрд╛рд╣рд░ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рджреЛрдиреЛрдВ рд╣рд┐рд╕реНрд╕реЛрдВ рдХреЛ рд╣рдЯрд╛рдирд╛ред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { RemoveOutgoingRiver(); RemoveIncomingRiver(); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджрд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛ рдХреЗ рдмрд╣рд┐рд░реНрдЧрд╛рдореА рдирджреА рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрд╕реЗ рдкрд┐рдЫрд▓реА рд╕рднреА рдЖрдЙрдЯрдЧреЛрдЗрдВрдЧ рдирджрд┐рдпреЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдирджреА рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИ, рддреЛ рд╣рдореЗрдВ рдХреБрдЫ рднреА рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasOutgoingRiver &amp;&amp; outgoingRiver == direction) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛, рд╣рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╕рд╣реА рджрд┐рд╢рд╛ рдореЗрдВ рдкрдбрд╝реЛрд╕реА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдирджрд┐рдпрд╛рдВ рдирд╣реАрдВ рдмрд╣ рд╕рдХрддреАрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдкрдбрд╝реЛрд╕реА рдЕрдзрд┐рдХ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдСрдкрд░реЗрд╢рди рдкреВрд░рд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> HexCell neighbor = GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!neighbor || elevation &lt; neighbor.elevation) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛ рд╣рдореЗрдВ рдкрд┐рдЫрд▓реА рдирд┐рд╡рд░реНрддрдорд╛рди рдирджреА рдХреЛ рд╕рд╛рдл рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдФрд░ рд╣рдореЗрдВ рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреЛ рднреА рд╣рдЯрд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ, рдЕрдЧрд░ рдпрд╣ рдПрдХ рдирдИ рдирд┐рд╡рд░реНрддрдорд╛рди рдирджреА рдкрд░ рдЖрд░реЛрдкрд┐рдд рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> RemoveOutgoingRiver(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasIncomingRiver &amp;&amp; incomingRiver == direction) { RemoveIncomingRiver(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдм рд╣рдо рдирд┐рд╡рд░реНрддрдорд╛рди рдирджреА рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; outgoingRiver = direction; RefreshSelfOnly();</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдЗрд╕рдХреА рд╡рд░реНрддрдорд╛рди рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рд╕реЗрд▓ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд░рдирд╛ рди рднреВрд▓реЗрдВ, рдЕрдЧрд░ рдпрд╣ рдореМрдЬреВрдж рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> neighbor.RemoveIncomingRiver(); neighbor.hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; neighbor.incomingRiver = direction.Opposite(); neighbor.RefreshSelfOnly();</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмрд╣ рд░рд╣реА рдирджрд┐рдпреЛрдВ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдмрдХрд┐ рд╣рдордиреЗ рдХреЗрд╡рд▓ рд╕рд╣реА рдирджрд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╕рдВрднрд╡ рдмрдирд╛ рджрд┐рдпрд╛ рд╣реИ, рдЕрдиреНрдп рдХрд╛рд░реНрдп рдЕрднреА рднреА рдЧрд▓рдд рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЬрдм рд╣рдо рд╕реЗрд▓ рдХреА рдКрдВрдЪрд╛рдИ рдмрджрд▓рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдлрд┐рд░ рд╕реЗ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдирджрд┐рдпрд╛рдВ рдХреЗрд╡рд▓ рдиреАрдЪреЗ рдмрд╣ рд╕рдХрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рднреА рдЕрдирд┐рдпрдорд┐рдд рдирджрд┐рдпреЛрдВ рдХреЛ рд╣рдЯрд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( hasOutgoingRiver &amp;&amp; elevation &lt; GetNeighbor(outgoingRiver).elevation ) { RemoveOutgoingRiver(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( hasIncomingRiver &amp;&amp; elevation &gt; GetNeighbor(incomingRiver).elevation ) { RemoveIncomingRiver(); } Refresh(); } }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджрд┐рдпреЛрдВ рдХреЛ рдмрджрд▓реЛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдХреЗ рд╕рдВрдкрд╛рджрди рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ UI рдкрд░ рдПрдХ рдирджреА рд╕реНрд╡рд┐рдЪ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рддреАрди рд╕рдВрдкрд╛рджрди рдореЛрдб рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдпрд╛ рддреЛ рдирджрд┐рдпреЛрдВ рдХреЛ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдпрд╛ рдЙрдиреНрд╣реЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛, рдпрд╛ рдЙрдиреНрд╣реЗрдВ рд╣рдЯрд╛рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдо рд╕реНрдерд┐рддрд┐ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрд╡рд┐рдЪ рдХрд╛ рдПрдХ рд╕рд░рд▓ рд╕рд╣рд╛рдпрдХ рдЧрдгрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдЗрд╕реЗ рдХреЗрд╡рд▓ рд╕рдВрдкрд╛рджрдХ рдХреЗ рдЕрдВрджрд░ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдореЛрдб рдлрд╝реАрд▓реНрдб рдХреЗ рд╕рд╛рде, </font><font style="vertical-align: inherit;">рдХрдХреНрд╖рд╛ рдХреЗ рдЕрдВрджрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> OptionalToggle { Ignore, Yes, No } OptionalToggle riverMode;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рд╣рдореЗрдВ UI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирджреА рд╢рд╛рд╕рди рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRiverMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mode</span></span></span><span class="hljs-function">)</span></span> { riverMode = (OptionalToggle)mode; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рд╢рд╛рд╕рди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпреВрдЖрдИ рдореЗрдВ рддреАрди рд╕реНрд╡рд┐рдЪ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдирдП рдЯреЙрдЧрд▓ рд╕рдореВрд╣ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рд░рдВрдЧреЛрдВ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рд╕реНрд╡рд┐рдЪ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рд╣реИрдВ рддрд╛рдХрд┐ рдЙрдирдХреЗ рд▓реЗрдмрд▓ рдЪреЗрдХрдмреЙрдХреНрд╕ рдХреЗ рдиреАрдЪреЗ рд╣реЛрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рд╡реЗ рдПрдХ рд▓рд╛рдЗрди рдкрд░ рд╕рднреА рддреАрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рдлрд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдкрддрд▓реЗ рд░рд╣реЗрдВрдЧреЗред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f5/1bf/d9c/0f51bfd9ce2a73bc23f1ef99cbd4b24e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпреВрдЖрдИ рдирджрд┐рдпреЛрдВ</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбреНрд░реЙрдк рдбрд╛рдЙрди рд╕реВрдЪреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрдпреЛрдВ рдирд╣реАрдВ рдХрд░рддреЗ?</font></font></b> <div class="spoiler_text">  ,    .   dropdown list  Unity        Play.    ,      . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдбреНрд░реИрдЧ рдПрдВрдб рдбреНрд░реЙрдк рдорд╛рдиреНрдпрддрд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдирджреА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рд╕реЗрд▓ рдФрд░ рдПрдХ рджрд┐рд╢рд╛ рджреЛрдиреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд▓рд╣рд╛рд▓, </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рд╕реЗрд▓ рд╕реЗ рджреВрд╕рд░реЗ рдореЗрдВ рдбреНрд░реИрдЧ рдФрд░ рдбреНрд░реЙрдк рд╕рдкреЛрд░реНрдЯ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдбреНрд░реИрдЧ рд╕рд╣реА рд╣реЛрдЧрд╛, рдФрд░ рдЗрд╕рдХреА рджрд┐рд╢рд╛ рднреА рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдФрд░ рдбреНрд░реИрдЧ рдФрд░ рдбреНрд░реЙрдк рдХреЛ рдкрд╣рдЪрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдкрд┐рдЫрд▓реА рд╕реЗрд▓ рдХреЛ рдпрд╛рдж рд░рдЦрдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isDrag; HexDirection dragDirection; HexCell previousCell;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рдЬрдм рдбреНрд░реИрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдкрд┐рдЫрд▓рд╛ рд╕реЗрд▓ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рдЬрдм рдХреЛрдИ рдЗрдирдкреБрдЯ рдирд╣реАрдВ рд╣реИ рдпрд╛ рд╣рдо рдХрд╛рд░реНрдб рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдореВрд▓реНрдп рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( Input.GetMouseButton(<span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; !EventSystem.current.IsPointerOverGameObject() ) { HandleInput(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { previousCell = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Ray inputRay = Camera.main.ScreenPointToRay(Input.mousePosition); RaycastHit hit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Physics.Raycast(inputRay, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> hit)) { EditCells(hexGrid.GetCell(hit.point)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { previousCell = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рд╡рд╣ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдмреАрдо рдХреЛ рдЬрд╛рд▓ рдХреЗ рд╕рд╛рде рдкрд╛рд░ рдХрд░рдХреЗ рдкрд╛рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЗрд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдирдП рдЕрдкрдбреЗрдЯ рдХреЗ рд▓рд┐рдП рдкрд┐рдЫрд▓реА рд╕реЗрд▓ рдмрди рдЬрд╛рддреА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Ray inputRay = Camera.main.ScreenPointToRay(Input.mousePosition); RaycastHit hit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Physics.Raycast(inputRay, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> hit)) { HexCell currentCell = hexGrid.GetCell(hit.point); EditCells(currentCell); previousCell = currentCell; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { previousCell = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЗрд╕рдХреА рддреБрд▓рдирд╛ рдкрд┐рдЫрд▓реЗ рд╕реЗрд▓ рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрджрд┐ рдХреЛрдИ рд╣реЛред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдореЗрдВ рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реЗрд▓ рдорд┐рд▓рддреЗ рд╣реИрдВ, рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рд╣реА рдбреНрд░реИрдЧ рдФрд░ рдбреНрд░реЙрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╣рдореЗрдВ рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдпрд╣ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рдЦреАрдВрдЪреЗрдВ рдФрд░ рдбреНрд░реЙрдк рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Physics.Raycast(inputRay, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> hit)) { HexCell currentCell = hexGrid.GetCell(hit.point); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousCell &amp;&amp; previousCell != currentCell) { ValidateDrag(currentCell); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { isDrag = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } EditCells(currentCell); previousCell = currentCell; isDrag = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдбреНрд░реИрдЧ рдФрд░ рдбреНрд░реЙрдк рдХреА рдЬрд╛рдВрдЪ рдХреИрд╕реЗ рдХрд░рддреЗ рд╣реИрдВ? </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рдкрд┐рдЫрд▓реЗ рдПрдХ рдХрд╛ рдкрдбрд╝реЛрд╕реА рд╣реИ рддреЛ рдЬрд╛рдБрдЪ рдХрд░рдирд╛ред </font><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рдЪрдХреНрд░ рдореЗрдВ рдЗрд╕рдХреЗ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рдХреЗ рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдореЗрдВ рдХреЛрдИ рдореЗрд▓ рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рд╣рдо рддреБрд░рдВрдд рдбреНрд░реИрдЧ рдХреА рджрд┐рд╢рд╛ рднреА рдкрд╣рдЪрд╛рди рд▓реЗрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValidateDrag</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell currentCell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( dragDirection = HexDirection.NE; dragDirection &lt;= HexDirection.NW; dragDirection++ ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousCell.GetNeighbor(dragDirection) == currentCell) { isDrag = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } isDrag = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд╣рдо рдЭрдЯрдХреЗрджрд╛рд░ рдбреНрд░рдЧреНрд╕ рдмрдирд╛рдПрдВрдЧреЗ?</font></font></b> <div class="spoiler_text">       ,          .         ┬л┬╗ ,     . <br><br>    ,   .            . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдмрджрд▓реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдбреНрд░реИрдЧ рдФрд░ рдбреНрд░реЙрдк рдХреЛ рдкрд╣рдЪрд╛рди рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдо рдЖрдЙрдЯрдЧреЛрдЗрдВрдЧ рдирджрд┐рдпреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдирджрд┐рдпреЛрдВ рдХреЛ рднреА рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдбреНрд░реИрдЧ рдПрдВрдб рдбреНрд░реЙрдк рдХреЗ рд╕рдорд░реНрдерди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (riverMode == OptionalToggle.No) { cell.RemoveRiver(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDrag &amp;&amp; riverMode == OptionalToggle.Yes) { previousCell.SetOutgoingRiver(dragDirection); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдХреЛрдб рдкрд┐рдЫрд▓реА рд╕реЗрд▓ рд╕реЗ рдХрд░рдВрдЯ рддрдХ рдирджреА рдХреЛ рдЦреАрдВрдЪреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╡рд╣ рдмреНрд░рд╢ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд░ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдХрд╛рдлреА рддрд░реНрдХрд╕рдВрдЧрдд рд╣реИ, рд▓реЗрдХрд┐рди рдЪрд▓реЛ рдмреНрд░рд╢ рджреНрд╡рд╛рд░рд╛ рдмрдВрдж рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдирджрд┐рдпреЛрдВ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рдВрдкрд╛рджрд┐рдд рд╕реЗрд▓ рдкрд░ рдСрдкрд░реЗрд╢рди рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдФрд░ рд╕реЗрд▓ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдореМрдЬреВрдж рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDrag &amp;&amp; riverMode == OptionalToggle.Yes) { HexCell otherCell = cell.GetNeighbor(dragDirection.Opposite()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherCell) { otherCell.SetOutgoingRiver(dragDirection); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдирджрд┐рдпреЛрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдиреНрд╣реЗрдВ рдЕрднреА рддрдХ рдирд╣реАрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдбрд┐рдмрдЧ рдЗрдВрд╕реНрдкреЗрдХреНрдЯрд░ рдореЗрдВ рд╕рдВрд╢реЛрдзрд┐рдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fe/927/46f/4fe92746f97fc517dc0d1da7c0aeee62.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд┐рдмрдЧ рдЗрдВрд╕реНрдкреЗрдХреНрдЯрд░ рдореЗрдВ рдПрдХ рдирджреА рдХреЗ рд╕рд╛рде рдПрдХ рд╕реЗрд▓ред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд┐рдмрдЧ рдЗрдВрд╕реНрдкреЗрдХреНрдЯрд░ рдХреНрдпрд╛ рд╣реИ?</font></font></b> <div class="spoiler_text">             .        .    ,     . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд░рд┐рд╡рд░рдмреЗрдбреНрд╕ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рд╕реА рдирджреА рдХреЛ рддреНрд░рд┐рднреБрдЬ рдмрдирд╛рддреЗ рд╕рдордп, рд╣рдореЗрдВ рджреЛ рднрд╛рдЧреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: рдирджреА рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХрд╛ рд╕реНрдерд╛рди рдФрд░ рдЙрд╕рд╕реЗ рдмрд╣рдиреЗ рд╡рд╛рд▓рд╛ рдкрд╛рдиреАред </font><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ, рд╣рдо рдПрдХ рдЪреИрдирд▓ рдмрдирд╛рдПрдВрдЧреЗ, рдФрд░ рдмрд╛рдж рдореЗрдВ рдкрд╛рдиреА рдЫреЛрдбрд╝ рджреЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдХрд╛ рд╕рдмрд╕реЗ рд╕рд░рд▓ рд╣рд┐рд╕реНрд╕рд╛ рд╡рд╣ рд╣реИ рдЬрд╣рд╛рдВ рдпрд╣ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдЬрдВрдХреНрд╢рдиреЛрдВ рдореЗрдВ рдмрд╣рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЬрдмрдХрд┐ рд╣рдо рдЗрд╕ рдХреНрд╖реЗрддреНрд░ рдХреЛ рддреНрд░рд┐рднреБрдЬ рдХреА рдкрдЯреНрдЯреА рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝ рд░рд╣реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдмреАрдЪ рдХреЗ рдХреНрд╡рд╛рдб рдХреЛ рдХрдо рдХрд░рдХреЗ рдФрд░ рджреЛ рдЪреИрдирд▓ рдХреА рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдЗрд╕рдореЗрдВ рдПрдХ рд░рд┐рд╡рд░ рдмреЗрдб рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/545/b3c/b93/545b3cb9373e9479011916513c3c51da.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд░рд┐рдм рдкрдЯреНрдЯреА рдореЗрдВ рдПрдХ рдирджреА рдЬреЛрдбрд╝рдирд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП, рдирджреА рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рджреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреНрд╡реИрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдФрд░ рджреЛ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдЪреИрдирд▓ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЪрд╛рд░ рдХреНрд╡рд╛рдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣рдо рдврд▓рд╛рди рд╡рд╛рд▓реА рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдмрд┐рд╕реНрддрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдордзреНрдп рдЪреЛрдЯреА рдХреЛ рдХрдо рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/757/7d9/ac1/7577d9ac1978be05cbdda0f8925c75d0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрд╢рд╛ рдЪреМрдорд╛рд╕рд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдорд╛рди рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЪрддреБрд░реНрднреБрдЬ рдХрд╛ рдирд┐рд░рдВрддрд░ рдЙрдкрдпреЛрдЧ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХреЛ рдЪреБрдиреЗрдВред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдЬ рдЯреЙрдкреНрд╕ рдЬреЛрдбрд╝рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреАрди рд╕реЗ рдЪрд╛рд░ рдкреНрд░рддрд┐ рдЫреЛрд░ рд╕реЗ рд╕рдВрдХреНрд░рдордг рдХреЛ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╢реАрд░реНрд╖ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдкреБрдирд░реНрд▓реЗрдЦрди </font></font><code>EdgeVertices</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдкрд╣рд▓реЗ рдХрд╛ рдирд╛рдо рдмрджрд▓рдиреЗ </font></font><code>v4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ </font></font><code>v5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рдирд╛рдо рджрд┐рдпрд╛ </font></font><code>v3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font></font><code>v4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдХреНрд░рдо рдореЗрдВ рдХрд╛рд░реНрдп рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╕рднреА рдХреЛрдб рд╕рд╣реА рд╡рд░реНрдЯрд┐рдХрд▓ рдХрд╛ рд╕рдВрджрд░реНрдн рджреЗрддреЗ рд░рд╣реЗрдВред </font><font style="vertical-align: inherit;">рд╣рд░ рдЬрдЧрд╣ рдкрд░рд┐рд╡рд░реНрддрди рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рд╕рдВрдкрд╛рджрдХ рдХреЗ рдирд╛рдо рдпрд╛ рд░рд┐рдлрд▓реЗрдХреНрдЯрд░ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдЖрдкрдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдкреВрд░реЗ рдХреЛрдб рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдмрджрд▓рд╛рд╡ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 v1, v2, v4, v5;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдм рдХреБрдЫ рдХрд╛ рдирд╛рдо рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рдж, рдПрдХ рдирдпрд╛ рдЬреЛрдбрд╝реЗрдВ </font></font><code>v3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 v1, v2, v3, v4, v5;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рдореЗрдВ рдПрдХ рдирдпрд╛ рд╢реАрд░реНрд╖ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдХреЛрдиреЗ рдХреА рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдиреНрдп рдХреЛрдиреЗ рдЕрдм, рдФрд░ ices рдореЗрдВ рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП, рдФрд░ frac13 рдореЗрдВ рдирд╣реАрдВ; </font><font style="vertical-align: inherit;">рдФрд░ frac23;</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EdgeVertices</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 corner1, Vector3 corner2</span></span></span><span class="hljs-function">)</span></span> { v1 = corner1; v2 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">0.25f</span></span>); v3 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); v4 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">0.75f</span></span>); v5 = corner2; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ </font></font><code>v3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>TerraceLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> EdgeVertices </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TerraceLerp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices a, EdgeVertices b, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> step</span></span></span><span class="hljs-function">)</span></span> { EdgeVertices result; result.v1 = HexMetrics.TerraceLerp(a.v1, b.v1, step); result.v2 = HexMetrics.TerraceLerp(a.v2, b.v2, step); result.v3 = HexMetrics.TerraceLerp(a.v3, b.v3, step); result.v4 = HexMetrics.TerraceLerp(a.v4, b.v4, step); result.v5 = HexMetrics.TerraceLerp(a.v5, b.v5, step); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдореБрдЭреЗ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рдм рдХреЗ рддреНрд░рд┐рдХреЛрдг рдХреЗ рдкреНрд░рд╢рдВрд╕рдХреЛрдВ рдореЗрдВ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╢реАрд░реНрд╖ рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeFan</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 center, EdgeVertices edge, Color color</span></span></span><span class="hljs-function">)</span></span> { AddTriangle(center, edge.v1, edge.v2); AddTriangleColor(color); AddTriangle(center, edge.v2, edge.v3); AddTriangleColor(color); AddTriangle(center, edge.v3, edge.v4); AddTriangleColor(color); AddTriangle(center, edge.v4, edge.v5); AddTriangleColor(color); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдЗрд╕рдХреЗ рдЪрддреБрд░реНрднреБрдЬреЛрдВ рдХреА рдзрд╛рд░рд┐рдпреЛрдВ рдореЗрдВ рднреАред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color c1, EdgeVertices e2, Color c2 </span></span></span><span class="hljs-function">)</span></span> { AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); AddQuadColor(c1, c2); AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); AddQuadColor(c1, c2); AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); AddQuadColor(c1, c2); AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); AddQuadColor(c1, c2); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/819/89d/599/81989d5996d7c2832e3dd7f61b4a9bb1.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/625/9b1/6a2/6259b16a2776344c51725d32d70001e8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддрд┐ рдЫреЛрд░ рдЪрд╛рд░ рдФрд░ рдкрд╛рдВрдЪ рдХреЛрдиреЗ рдХреА рддреБрд▓рдирд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА рддрд▓ рдХреА рдКрдБрдЪрд╛рдИ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рд░рд┐рдм рдХреЗ рдирд┐рдЪрд▓реЗ рд╢реАрд░реНрд╖ рдХреЛ рдиреАрдЪреЗ рдХрд░рдХреЗ рдЪреИрдирд▓ рдмрдирд╛рдпрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рдирджреА рдХреЗ рддрд▓ рдХреА рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд╕реНрдерд┐рддрд┐ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рдкреНрд░рддреНрдпреЗрдХ рдХреЛрд╢рд┐рдХрд╛ рдХреА рд╕рдЯреАрдХ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд╕реНрдерд┐рддрд┐ рд╡рд┐рдХреГрдд рд╣реИ, рд╣рдореЗрдВ рдирджреА рдХреЗ рддрд▓ рдХреА рд╕рдорд╛рди рдКрдВрдЪрд╛рдИ рдХреЛ рдЙрд╕реА рдКрдВрдЪрд╛рдИ рд╡рд╛рд▓реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдмрдирд╛рдП рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкрд╛рдиреА рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рдЗрд╕реЗ рдКрдкрд░ рдХреА рдУрд░ рдирд╣реАрдВ рдмрд╣рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдмрд┐рд╕реНрддрд░ рдХреЛ рдиреАрдЪреЗ рд░рд╣рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдХрдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рд╕рдмрд╕реЗ рд╡рд┐рдЪрд▓рд┐рдд рдЦрдбрд╝реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЬрдмрдХрд┐ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдкрд╛рдиреА рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЬрдЧрд╣ рдЫреЛрдбрд╝рдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕ рдСрдлрд╕реЗрдЯ рдХреЛ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдВрдЪрд╛рдИ рдХреЗ рд░реВрдк рдореЗрдВ </font><font style="vertical-align: inherit;">рд╕реЗрдЯ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ рд╡реНрдпрдХреНрдд рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдПрдХ рд╕реНрддрд░ рдХреЗ рдСрдлрд╕реЗрдЯ рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> streamBedElevationOffset = <span class="hljs-number"><span class="hljs-number">-1f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рдирджреА рдХреЗ рддрд▓ рдХреА рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд╕реНрдерд┐рддрд┐ рдкреНрд░рд╛рдкреНрдд </font><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреБрдгреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдореАрдЯреНрд░рд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> StreamBedY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (elevation + HexMetrics.streamBedElevationOffset) * HexMetrics.elevationStep; } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рдЪреИрдирд▓ рдмрдирд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдХреЛрд╢рд┐рдХрд╛ рдХреЗ рдЫрд╣ рддреНрд░рд┐рдХреЛрдгреАрдп рднрд╛рдЧреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рддреНрд░рд┐рднреБрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдо рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдирджреА рдЗрд╕рдХреЗ рдХрд┐рдирд╛рд░реЗ рд╕реЗ рдмрд╣рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдРрд╕рд╛ рд╣реИ, рддреЛ рд╣рдо рд░рд┐рдм рдХреЗ рдордзреНрдп рд╢рд┐рдЦрд░ рдХреЛ рдирджреА рдХреЗ рдмрд┐рд╕реНрддрд░ рдХреА рдКрдВрдЪрд╛рдИ рддрдХ рдХрдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector3 center = cell.Position; EdgeVertices e = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstSolidCorner(direction), center + HexMetrics.GetSecondSolidCorner(direction) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e.v3.y = cell.StreamBedY; } TriangulateEdgeFan(center, e, cell.Color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { TriangulateConnection(direction, cell, e); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d0d/a57/028/d0da570288985442d990858b2831c07a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рдм рдХреЗ рдордзреНрдп рд╢реАрд░реНрд╖ рдХреЛ рдмрджрд▓реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдирджреА рдХреЗ рдкрд╣рд▓реЗ рд▓рдХреНрд╖рдг рдХреИрд╕реЗ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд░рд╛рд╣рдд рдореЗрдВ рдЫреЗрдж рдкреИрджрд╛ рд╣реЛрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рдмрдВрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рджреВрд╕рд░реЗ рдХрд┐рдирд╛рд░реЗ рдХреЛ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдлрд┐рд░ рдХрдиреЗрдХреНрд╢рди рдХреЛ рддреНрд░рд┐рднреБрдЬ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { HexCell neighbor = cell.GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 bridge = HexMetrics.GetBridge(direction); bridge.y = neighbor.Position.y - cell.Position.y; EdgeVertices e2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( e1.v1 + bridge, e1.v5 + bridge ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e2.v3.y = neighbor.StreamBedY; } тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4c/aa9/5f4/b4caa95f424004569e7876bc19c73a20.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рдм рдЬреЛрдбрд╝реЛрдВ рдХреЗ рдкреВрд░реНрдг рдЪреИрдирд▓ред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рд╕реЗрд▓ рд╕реЗ рд╣реЛрдХрд░ рдЧреБрдЬрд░рдиреЗ рд╡рд╛рд▓реЗ рд░рд┐рд╡рд░рдмреЗрдб </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕рд╣реА рд░рд┐рд╡рд░рдмреЗрдбреНрд╕ рд╣реИрдВред рд▓реЗрдХрд┐рди рдЬрдм рдирджреА рд╕реЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╣рддреА рд╣реИ, рддреЛ рдЪреИрдирд▓ рд╣рдореЗрд╢рд╛ рдЗрд╕рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЖрдЗрдП рдЙрд╕ рдорд╛рдорд▓реЗ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ рдЬрдм рдПрдХ рдирджреА рдПрдХ рд╕реЗрд▓ рд╕реЗ рд╕реАрдзреЗ рдмрд╣рддреА рд╣реИ, рдПрдХ рдХрд┐рдирд╛рд░реЗ рд╕реЗ рд╡рд┐рдкрд░реАрдд рддрдХред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдХреЛрдИ рдирджреА рдирд╣реАрдВ рд╣реИ, рддреЛ рд╕реЗрд▓ рдХрд╛ рдкреНрд░рддреНрдпреЗрдХ рднрд╛рдЧ рддреНрд░рд┐рдХреЛрдг рдХрд╛ рдПрдХ рд╕рд░рд▓ рдкреНрд░рд╢рдВрд╕рдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдЬрдм рдирджреА рд╕реАрдзреЗ рдмрд╣рддреА рд╣реИ, рддреЛ рдПрдХ рдЪреИрдирд▓ рдбрд╛рд▓рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдореЗрдВ рдХреЗрдВрджреНрд░реАрдп рд╢реАрд░реНрд╖ рдХреЛ рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рдлреИрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдордзреНрдп рджреЛ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреЛ рдЪрддреБрд╖реНрдХреЛрдг рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ред рдлрд┐рд░ рддреНрд░рд┐рднреБрдЬреЛрдВ рдХрд╛ рдкреНрд░рд╢рдВрд╕рдХ рдПрдХ рдЯреНрд░реЗрдкреЛрдЬрд╝реЙрдЗрдб рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a9/919/ffb/9a9919ffbb99bcded8d44f45e62c3955.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЪреИрдирд▓ рдХреЛ рддреНрд░рд┐рдХреЛрдг рдореЗрдВ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд╕реЗ рдЪреИрдирд▓ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХрдиреЗрдХреНрд╢рди рд╕реЗ рдЧреБрдЬрд░рдиреЗ рд╡рд╛рд▓реЗ рд▓реЛрдЧреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд▓рдВрдмреЗ рд╣реЛрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рд╢реАрд░реНрд╖ рд╕реНрдерд╛рди рд╡рд┐рдХреГрдд рд╣реЛрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЖрдЗрдП рдХреЗрдВрджреНрд░ рдФрд░ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдмреАрдЪ рдореЗрдВ рд╡рд░реНрдЯреЗрдХреНрд╕ рдХрд┐рдирд╛рд░реЛрдВ рдХрд╛ рдПрдХ рдФрд░ рд╕реЗрдЯ рдбрд╛рд▓рдХрд░ рдЯреНрд░реЗрдкреЗрдЬрд╝реЙрдЗрдб рдХреЛ рджреЛ рд╕реЗрдЧрдореЗрдВрдЯ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░реЗрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/650/f94/109/650f9410923cb781f145b5211dbe4950.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреИрдирд▓ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рдиред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдПрдХ рдирджреА рдХреЗ рд╕рд╛рде рддреНрд░рд┐рдХреЛрдгреАрдпрдХрд░рдг рдПрдХ рдирджреА рдХреЗ рдмрд┐рдирд╛ рддреНрд░рд┐рдХреЛрдгреАрдпрдХрд░рдг рд╕реЗ рдмрд╣реБрдд рдЕрд▓рдЧ рд╣реЛрдЧрд╛, рдЖрдЗрдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдирджреА рд╣реИ, рддреЛ рд╣рдо рдЗрд╕ рдкрджреНрдзрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЕрдиреНрдпрдерд╛ рд╣рдо рддреНрд░рд┐рдХреЛрдг рдХрд╛ рдПрдХ рдкреНрд░рд╢рдВрд╕рдХ рдЫреЛрдбрд╝ рджреЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector3 center = cell.Position; EdgeVertices e = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstSolidCorner(direction), center + HexMetrics.GetSecondSolidCorner(direction) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e.v3.y = cell.StreamBedY; TriangulateWithRiver(direction, cell, center, e); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeFan(center, e, cell.Color); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { TriangulateConnection(direction, cell, e); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/928/f0f/526/928f0f526852960fce6c37bdb480b5bc.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫреЗрдж рдЬрд┐рд╕рдореЗрдВ рдирджрд┐рдпрд╛рдБ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ, рдЕрд╕реНрдерд╛рдИ рд░реВрдк рд╕реЗ рд╕реЗрд▓ рд╡рд┐рдХреГрддрд┐ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cellPerturbStrength = <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-comment"><span class="hljs-comment">// 4f;</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2aa/f49/ae3/2aaf49ae366805585727f1a1ed11c2aa.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╡рд┐рд░рд▓ рдЪреЛрдЯрд┐рдпрд╛рдБред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реАрдзреЗ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рдХреЗ рднрд╛рдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реАрдзреЗ рдПрдХ рдЪреИрдирд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдХреЗрдВрджреНрд░ рдХреЛ рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рдлреИрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рд▓рд╛рдЗрди рдХреА рдЪреИрдирд▓ рдХреА рдЪреМрдбрд╝рд╛рдИ рд╕рдорд╛рди рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд╣рдо рдХреЗрдВрджреНрд░ рд╕реЗ рджреВрд░реА рдХреЗ рдкрд┐рдЫрд▓реЗ рднрд╛рдЧ рдХреЗ рдкрд╣рд▓реЗ рдХреЛрдиреЗ рддрдХ рд▓реЗ рдЬрд╛рдХрд░ рдмрд╛рдИрдВ рдУрд░ рдХрд╛ рд╢реАрд░реНрд╖ рдвреВрдБрдв рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { Vector3 centerL = center + HexMetrics.GetFirstSolidCorner(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реА рддрд░рд╣ рд╕рд╣реА рд╡рд░реНрдЯреЗрдХреНрд╕ рдХреЗ рд▓рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдореЗрдВ рдЕрдЧрд▓реЗ рднрд╛рдЧ рдХреЗ рджреВрд╕рд░реЗ рдХреЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> Vector3 centerL = center + HexMetrics.GetFirstSolidCorner(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; Vector3 centerR = center + HexMetrics.GetSecondSolidCorner(direction.Next()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЗрдВрджреНрд░ рдФрд░ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдмреАрдЪ рд╢реАрд░реНрд╖ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдмрдирд╛рдХрд░ рдордзреНрдп рд░реЗрдЦрд╛ рдХреЛ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> EdgeVertices m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( Vector3.Lerp(centerL, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(centerR, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдЧрд▓рд╛, рдордзреНрдп рд░рд┐рдм рдХреЗ рдордзреНрдп рд╢реАрд░реНрд╖, рд╕рд╛рде рд╣реА рдХреЗрдВрджреНрд░ рдХреЛ рдмрджрд▓ рджреЗрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЪреИрдирд▓ рдХреЗ рдирд┐рдЪрд▓реЗ рдмрд┐рдВрджреБ рдмрди рдЬрд╛рдПрдВрдЧреЗред </font></font><br><br><pre> <code class="cs hljs"> m.v3.y = center.y = e.v3.y;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо </font></font><code>TriangulateEdgeStrip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдордзреНрдп рд░реЗрдЦрд╛ рдФрд░ рдХрд┐рдирд╛рд░реЗ рд░реЗрдЦрд╛ рдХреЗ рдмреАрдЪ рдХреЗ рд╕реНрдерд╛рди рдХреЛ рднрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> TriangulateEdgeStrip(m, cell.Color, e, cell.Color);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ab/050/b30/3ab050b301f8815479142c5b8feae26e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдХреБрдЪрд┐рдд рдЪреИрдирд▓ред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдЪреИрдирд▓ рд╕рдВрдХреБрдЪрд┐рдд рджрд┐рдЦрддреЗ рд╣реИрдВред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдкрд╕рд▓реА рдХреЗ рдордзреНрдп рдХреЛрдиреЗ рдПрдХ-рджреВрд╕рд░реЗ рдХреЗ рдмрд╣реБрдд рдХрд░реАрдм рд╣реЛрддреЗ рд╣реИрдВред рдРрд╕рд╛ рдХреНрдпреЛрдВ рд╣реБрдЖ? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдмрд╛рд╣рд░реА рдХрд┐рдирд╛рд░реЗ рдХреА рд▓рдВрдмрд╛рдИ 1 рд╣реИ, рддреЛ рдХреЗрдВрджреНрд░ рд░реЗрдЦрд╛ рдХреА рд▓рдВрдмрд╛рдИ length рд╣реЛрдЧреАред рдЪреВрдВрдХрд┐ рдмреАрдЪ рдХрд╛ рдХрд┐рдирд╛рд░рд╛ рдЙрдирдХреЗ рдмреАрдЪ рдореЗрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреА рд▓рдВрдмрд╛рдИ in рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреИрдирд▓ рдХреА рдЪреМрдбрд╝рд╛рдИ ┬╜ рд╣реИ рдФрд░ рд╕реНрдерд┐рд░ рд░рд╣рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЪреВрдВрдХрд┐ рдордзреНрдп рдХрд┐рдирд╛рд░реЗ рдХреА рд▓рдВрдмрд╛рдИ ┬╛ рд╣реИ, рдХреЗрд╡рд▓ according рдмрдиреА рд╣реБрдИ рд╣реИ, &amp; frac18 рдХреЗ рдЕрдиреБрд╕рд╛рд░; рдЪреИрдирд▓ рдХреЗ рджреЛрдиреЛрдВ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e1/25f/037/2e125f03727f078ccfd094a29ad4d596.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдкреЗрдХреНрд╖ рд▓рдВрдмрд╛рдИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдордзреНрдп рдХрд┐рдирд╛рд░реЗ рдХреА рд▓рдВрдмрд╛рдИ middle рд╣реИ, рддреЛ &amp; frac18; </font><font style="vertical-align: inherit;">рдордзреНрдп рд░рд┐рдм рдХреА рд▓рдВрдмрд╛рдИ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдФрд░ frac16 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ ;; </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдЗрд╕рдХреЗ рджреВрд╕рд░реЗ рдФрд░ рдЪреМрдереЗ рдХреЛрдиреЗ рдХреЛ рдЫрдареЗ рд╕реЗ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдХреНрд╡рд╛рд░реНрдЯрд░ рд╕реЗ рдЗрдВрдЯрд░рдкреЛрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо </font></font><code>EdgeVertices</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рдХрд░ рдРрд╕реЗ рд╡реИрдХрд▓реНрдкрд┐рдХ рдкреНрд░рдХреНрд╖реЗрдк рдХреЗ рд▓рд┐рдП рд╕рд╣рд╛рдпрддрд╛ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдХреЗ рдмрдЬрд╛рдп рдХреЗ рд▓рд┐рдП рдирд┐рд╢реНрдЪрд┐рдд рдкреНрд░рдХреНрд╖реЗрдк </font></font><code>v2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>v4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EdgeVertices</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 corner1, Vector3 corner2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outerStep</span></span></span><span class="hljs-function">)</span></span> { v1 = corner1; v2 = Vector3.Lerp(corner1, corner2, outerStep); v3 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); v4 = Vector3.Lerp(corner1, corner2, <span class="hljs-number"><span class="hljs-number">1f</span></span> - outerStep); v5 = corner2; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдЗрд╕реЗ &amp; frac16 рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ; </font><font style="vertical-align: inherit;">рд╕реА </font></font><code>HexMesh.TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> EdgeVertices m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( Vector3.Lerp(centerL, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(centerR, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), <span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">6f</span></span> );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c4a/df8/cb5/c4adf8cb5aa6b1685f6d5c592976ea3b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдзрд╛ рдЪреИрдирд▓ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреИрдирд▓ рдХреЛ рд╕реАрдзрд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЯреНрд░реЗрдкреЛрдЬрд╝реЙрдЗрдб рдХреЗ рджреВрд╕рд░реЗ рднрд╛рдЧ рдореЗрдВ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдо рд░рд┐рдм рд╕реНрдЯреНрд░рд┐рдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдкрдХреНрд╖реЛрдВ рдкрд░ рддреНрд░рд┐рдХреЛрдг рдмрдирд╛рдПрдВред</font></font><br><br><pre> <code class="cs hljs"> AddTriangle(centerL, m.v1, m.v2); AddTriangleColor(cell.Color); AddTriangle(centerR, m.v4, m.v5); AddTriangleColor(cell.Color);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/10b/dc7/a5b/10bdc7a5b1d32d03dbc155a2d00bbfb5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдЗрдб рддреНрд░рд┐рдХреЛрдгред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдЕрдЪреНрдЫрд╛ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЪреИрдирд▓ рдХреЗ рдЕрдВрддрд┐рдо рднрд╛рдЧ рдХреЛ рдмрдирд╛рддреЗ рд╣реБрдП, рд╢реЗрд╖ рд╕реНрдерд╛рди рдХреЛ рджреЛ рдЪрддреБрд╖реНрдХреЛрдгреЛрдВ рд╕реЗ рднрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> AddTriangle(centerL, m.v1, m.v2); AddTriangleColor(cell.Color); AddQuad(centerL, center, m.v2, m.v3); AddQuadColor(cell.Color); AddQuad(center, centerR, m.v3, m.v4); AddQuadColor(cell.Color); AddTriangle(centerR, m.v4, m.v5); AddTriangleColor(cell.Color);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ </font></font><code>AddQuadColor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рдПрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдХреЛрдИ рд╡рд┐рдХрд▓реНрдк рдирд╣реАрдВ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬрдмрдХрд┐ рд╣рдореЗрдВ рдЗрд╕рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рдереАред </font><font style="vertical-align: inherit;">рддреЛ рдЪрд▓рд┐рдП рдЗрд╕реЗ рдмрдирд╛рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadColor</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Color color</span></span></span><span class="hljs-function">)</span></span> { colors.Add(color); colors.Add(color); colors.Add(color); colors.Add(color); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af0/b62/c32/af0b62c3232b36cd0a136b1fc009b7dd.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдзреЗ рдЪреИрдирд▓реЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд┐рдпрд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рд╢реБрд░реВ рдХрд░реЗрдВ рдФрд░ рд╕рдорд╛рдкреНрдд рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рднрд╛рдЧ рдХреА рддреНрд░рд┐рдХреЛрдгреАрдпрддрд╛ рдЬрд┐рд╕рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдирджреА рдХреА рд╢реБрд░реБрдЖрдд рдпрд╛ рдЕрдВрдд рд╣реЛрддрд╛ рд╣реИ, рдХрд╛рдлреА рдЕрд▓рдЧ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЙрд╕реЗ рдЕрдкрдиреА рд╡рд┐рдзрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЗрд╕реЗ рдЬрд╛рдВрдЪреЗрдВрдЧреЗ </font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЙрдкрдпреБрдХреНрдд рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ </font><font style="vertical-align: inherit;">рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e.v3.y = cell.StreamBedY; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { TriangulateWithRiverBeginOrEnd(direction, cell, center, e); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateWithRiver(direction, cell, center, e); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдХреЗрдВрджреНрд░ рдореЗрдВ рдЪреИрдирд▓ рдХреЛ рдкреВрд░рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╣рдо рдЕрднреА рднреА рдЗрд╕рдХреЗ рд▓рд┐рдП рджреЛ рдЪрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдХреЗрдВрджреНрд░ рдпрд╛ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдмреАрдЪ рдореЗрдВ рдлрд┐рд░ рд╕реЗ рдмреАрдЪ рдХрд╛ рдХрд┐рдирд╛рд░рд╛ рдмрдирд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдЪреИрдирд▓ рдХреЛ рдкреВрд░рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдХрд╛рдлреА рдЦреБрд╢ рд╣реИрдВ рдХрд┐ рдпрд╣ рд╕рдВрдХреБрдЪрд┐рдд рд╣реЛ рдЬрд╛рдПрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiverBeginOrEnd</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдЪреИрдирд▓ рдмрд╣реБрдд рдЬрд▓реНрджреА рдЙрдерд▓реЗ рди рд╣реЛ рдЬрд╛рдП, рд╣рдо рдирджреА рдХреЗ рддрд▓ рдХреА рдКрдБрдЪрд╛рдИ рдХреЛ рдордзреНрдп рд╢рд┐рдЦрд░ рдХреЛ рд╕реМрдВрдк рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдХреЗрдВрджреНрд░ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> m.v3.y = e.v3.y;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдПрдХ рд░рд┐рдм рд╕реНрдЯреНрд░рд┐рдк рдФрд░ рдПрдХ рдкреНрд░рд╢рдВрд╕рдХ рдХреЗ рд╕рд╛рде рддреНрд░рд┐рдХреЛрдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> TriangulateEdgeStrip(m, cell.Color, e, cell.Color); TriangulateEdgeFan(center, m, cell.Color);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/16b/0c5/9e0/16b0c59e0999f2a505e709648c1e1af7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдХ рд╢реБрд░реВ рдФрд░ рд╕рдорд╛рдкреНрдд рдХрд░реЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рди-рд╕реНрдЯреЗрдк рдЯрд░реНрди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрд╕рдиреНрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдЙрд╕ рдЭрд┐рдЭрдХ рдХреЛ рддреЗрдЬ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЙрдиреНрд╣реЗрдВ рднреА рд╕рдВрднрд╛рд▓ рд▓реЗрдВрдЧреЗ </font></font><code>TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдирджреА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/523/c03/e37/523c03e370096f804df6b84a97dbdfbf.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╝рд┐рдЧрдЬрд╝рдЧ рдирджреАред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╕реЗрд▓ рдореЗрдВ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рдмрд╣рдиреЗ рд╡рд╛рд▓реА рдирджреА рд╣реИ, рд╕рд╛рде рд╣реА рдЬрд┐рд╕ рджрд┐рд╢рд╛ рдореЗрдВ рд╣рдо рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдПрдХ рд╕реАрдзреА рдирджреА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдЙрд╕ рдХреЗрдВрджреНрд░ рд░реЗрдЦрд╛ рдХреЛ рд╕рд╣реЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╣реА рдЧрдгрдирд╛ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдпрд╣ рдХреЗрдВрджреНрд░ рдмрд┐рдВрджреБ рдХреЛ рдореЛрдбрд╝рддреЗ рд╣реБрдП, рдПрдХ рдмрд┐рдВрджреБ рдкрд░ рд▓реМрдЯрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> Vector3 centerL, centerR; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Opposite())) { centerL = center + HexMetrics.GetFirstSolidCorner(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; centerR = center + HexMetrics.GetSecondSolidCorner(direction.Next()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { centerL = centerR = center; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90c/992/4c0/90c9924c049cf8033e7480c90b74b903.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░реНрд▓ рдХрд┐рдП рд╣реБрдП рдЬрд╝рд┐рдЧрдЬрд╝реИрдЧред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЬрд╛рдБрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╕реЗрд▓ рдХреЗ рдЕрдЧрд▓реЗ рдпрд╛ рдкрд┐рдЫрд▓реЗ рднрд╛рдЧ рд╕реЗ рд╣реЛрдХрд░ рдЧреБрдЬрд░рдиреЗ рд╡рд╛рд▓реА рдирджреА рд╣реИ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╡рд╣рд╛рдБ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдЗрд╕ рдФрд░ рдкрдбрд╝реЛрд╕реА рднрд╛рдЧ рдХреЗ рдмреАрдЪ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХреЗ рд╕рд╛рде рдХреЗрдВрджреНрд░ рд░реЗрдЦрд╛ рдХреЛ рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдХреЗрдВрджреНрд░ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдХреЛрдг рдХреЗ рдмреАрдЪ рдХреА рд░реЗрдЦрд╛ рдХреЗ рд╕рдВрдЧрдд рдкрдХреНрд╖ рдХреЛ рд░рдЦрдХрд░ рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓рд╛рдЗрди рдХрд╛ рджреВрд╕рд░рд╛ рдХрд┐рдирд╛рд░рд╛ рддрдм рдХреЗрдВрджреНрд░ рдмрди рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Opposite())) { centerL = center + HexMetrics.GetFirstSolidCorner(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; centerR = center + HexMetrics.GetSecondSolidCorner(direction.Next()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { centerL = center; centerR = Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { centerL = Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); centerR = center; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { centerL = centerR = center; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрд╣ рддрдп рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдХрд┐ рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рдмрд┐рдВрджреБ рдХрд╣рд╛рдВ рд╣реИрдВ, рд╣рдо рдФрд╕рдд рдХреЗрдВрджреНрд░ рдХреЛ рдЙрдирдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Opposite())) { тАж } center = Vector3.Lerp(centerL, centerR, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f14/cc6/4f9/f14cc64f953da69fb270ff2adf613b2e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдСрдлрд╕реЗрдЯ рдХреЗрдВрджреНрд░реАрдп рд░рд┐рдмред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЪреИрдирд▓ рдХреА рджреЛрдиреЛрдВ рддрд░рдл рд╕рдорд╛рди рдЪреМрдбрд╝рд╛рдИ рд╣реИ, рдпрд╣ рдХрд╛рдлреА рд╕рдВрдХреБрдЪрд┐рдд рджрд┐рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдХреЗрдВрджреНрд░ рд░реЗрдЦрд╛ 60 ┬░ рдореЛрдбрд╝рдиреЗ рдХреЗ рдХрд╛рд░рдг рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХреЗрдВрджреНрд░ рд░реЗрдЦрд╛ рдХреА рдЪреМрдбрд╝рд╛рдИ рдХреЛ рдереЛрдбрд╝рд╛ рдмрдврд╝рд╛рдХрд░ рдЖрдк рдЗрд╕ рдкреНрд░рднрд╛рд╡ рдХреЛ рд╕реБрдЪрд╛рд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">┬╜ рдХреЗ рд╕рд╛рде рдкреНрд░рдХреНрд╖реЗрдк рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо &amp; frac23 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ;</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { centerL = center; centerR = Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { centerL = Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); centerR = center; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28c/c01/ea3/28cc01ea3d203243a1dfe49cde5e9802.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкреАрдбрд╝рди рдХреЗ рдмрд┐рдирд╛ рдЬрд╝рд┐рдЧрдЬрд╝реИрдЧред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреЛ-рдЪрд░рдг рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реЗрд╖ рдорд╛рдорд▓реЗ рдЭреАрдЧреНрдЬ рдФрд░ рд╕реАрдзреА рдирджрд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рдХреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпреЗ рджреЛ-рдЪрд░рдг рдореЛрдбрд╝ рд╣реИрдВ рдЬреЛ рдзреАрд░реЗ-рдзреАрд░реЗ рдШреБрдорд╛рд╡рджрд╛рд░ рдирджрд┐рдпреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67d/bab/9b2/67dbab9b235833d69b3201c9b38ac653.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╣рддреА рд╣реБрдИ рдирджреАред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рд╕рдВрднрд╛рд╡рд┐рдд рдЭреБрдХрд╛рд╡реЛрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>direction.Next().Next()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдФрд░ рдЕрдзрд┐рдХ рдЬреЛрдбрд╝рдХрд░ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддреЗ рд╣реИрдВ </font></font><code>HexDirection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╕реНрддрд╛рд░ рдХреЗ рддрд░реАрдХреЛрдВ </font></font><code>Next2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>Previous2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexDirection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Previous2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { direction -= <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> direction &gt;= HexDirection.NE ? direction : (direction + <span class="hljs-number"><span class="hljs-number">6</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexDirection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Next2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { direction += <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> direction &lt;= HexDirection.NW ? direction : (direction - <span class="hljs-number"><span class="hljs-number">6</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░ рд╡рд╛рдкрд╕ </font></font><code>HexMesh.TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдЕрдкрдиреЗ рд╕рд╛рде рдмрд╣рдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреА рджрд┐рд╢рд╛ рдХреЛ рдкрд╣рдЪрд╛рди рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>direction.Next2()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Opposite())) { centerL = center + HexMetrics.GetFirstSolidCorner(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; centerR = center + HexMetrics.GetSecondSolidCorner(direction.Next()) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { centerL = center; centerR = Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { centerL = Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">2f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); centerR = center; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next2())) { centerL = centerR = center; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { centerL = centerR = center; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрди рдЕрдВрддрд┐рдо рджреЛ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рд╣рдореЗрдВ рдХреЗрдВрджреНрд░ рд░реЗрдЦрд╛ рдХреЛ рдЙрд╕ рдХрдХреНрд╖ рдХреЗ рднрд╛рдЧ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рд╡рдХреНрд░ рдХреЗ рдЕрдВрджрд░ рд╕реНрдерд┐рдд рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдареЛрд╕ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдмреАрдЪ рдореЗрдВ рдПрдХ рд╡реЗрдХреНрдЯрд░ рдерд╛, рддреЛ рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдВрддрд┐рдо рдмрд┐рдВрджреБ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next2())) { centerL = center; centerR = center + HexMetrics.GetSolidEdgeMiddle(direction.Next()) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { centerL = center + HexMetrics.GetSolidEdgeMiddle(direction.Previous()) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; centerR = center; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдЕрдм рд╣рдореЗрдВ рдРрд╕реА рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЙрд╕реЗ рдмрд╕ рдЖрд╕рдиреНрди рдХреЛрдгреЛрдВ рдХреЗ рджреЛ рд╡реИрдХреНрдЯрд░реЛрдВ рдХреЛ рдФрд╕рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЕрдЦрдВрдбрддрд╛ рдЧреБрдгрд╛рдВрдХ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSolidEdgeMiddle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] + corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction + <span class="hljs-number"><span class="hljs-number">1</span></span>]) * (<span class="hljs-number"><span class="hljs-number">0.5f</span></span> * solidFactor); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be1/058/429/be1058429e3d36cd25b8e1da0c1be77a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдереЛрдбрд╝рд╛ рд╕рдВрдХреБрдЪрд┐рдд рдШрдЯрддрд╛ рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реА рдХреЗрдВрджреНрд░ рд░реЗрдЦрд╛рдПрдВ рдЕрдм 30 ┬░ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдШреВрдо рд░рд╣реА рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╡реЗ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИрдВ, рдпрд╣реА рд╡рдЬрд╣ рд╣реИ рдХрд┐ рдЪреИрдирд▓ рдереЛрдбрд╝рд╛ рд╕рдВрдХреБрдЪрд┐рдд рд╣реИрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд░рд┐рдм рдХрд╛ рдордзреНрдпрдмрд┐рдВрджреБ рд░рд┐рдм рдХреЗ рдХреЛрдг рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХреЗрдВрджреНрд░ рдХреЗ рдХрд░реАрдм рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреА рджреВрд░реА рдЖрдВрддрд░рд┐рдХ рддреНрд░рд┐рдЬреНрдпрд╛ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ, рдмрд╛рд╣рд░реА рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдпрд╛рдиреА рд╣рдо рдЧрд▓рдд рдкреИрдорд╛рдиреЗ рдкрд░ рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдмрд╛рд╣рд░реА рд╕реЗ рдЖрдВрддрд░рд┐рдХ рддреНрд░рд┐рдЬреНрдпрд╛ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рд░рд┐рд╡рд░реНрд╕ рдСрдкрд░реЗрд╢рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рддреЛ рдЪрд▓реЛ рджреЛрдиреЛрдВ рд░реВрдкрд╛рдВрддрд░рдг рдХрд╛рд░рдХ рдЙрдкрд▓рдмреНрдз рдХрд░рд╛рддреЗ рд╣реИрдВ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> outerToInner = <span class="hljs-number"><span class="hljs-number">0.866025404f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> innerToOuter = <span class="hljs-number"><span class="hljs-number">1f</span></span> / outerToInner; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> outerRadius = <span class="hljs-number"><span class="hljs-number">10f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> innerRadius = outerRadius * outerToInner;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рд╕рд╣реА рдкреИрдорд╛рдиреЗ рдкрд░ рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>HexMesh.TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЪреИрдирд▓ рдЕрднреА рднреА рдЕрдкрдиреА рдмрд╛рд░реА рдХреЗ рдХрд╛рд░рдг рдереЛрдбрд╝рд╛ рдирд┐рдЪреЛрдбрд╝рд╛ рд╣реБрдЖ рд░рд╣реЗрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдЬрд╝рд┐рдЧрдЬрд╝реИрдЧ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдмрд╣реБрдд рдХрдо рд╕реНрдкрд╖реНрдЯ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрд╕рдХреА рднрд░рдкрд╛рдИ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next2())) { centerL = center; centerR = center + HexMetrics.GetSolidEdgeMiddle(direction.Next()) * (<span class="hljs-number"><span class="hljs-number">0.5f</span></span> * HexMetrics.innerToOuter); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { centerL = center + HexMetrics.GetSolidEdgeMiddle(direction.Previous()) * (<span class="hljs-number"><span class="hljs-number">0.5f</span></span> * HexMetrics.innerToOuter); centerR = center; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a2/849/49c/2a284949c066c558391613611b93d093.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд┐рдХрдиреА рдШрдЯрддрд╛ рд╣реИред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджрд┐рдпреЛрдВ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдХреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реА рдирджрд┐рдпрд╛рдВ рддреИрдпрд╛рд░ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╣рдордиреЗ рдЕрднреА рддрдХ рдирджрд┐рдпреЛрдВ рд╕реЗ рдпреБрдХреНрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдЕрдиреНрдп рднрд╛рдЧреЛрдВ рдХреЛ рдирд╣реАрдВ рдорд┐рд▓рд╛рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдЗрди рдЫреЗрджреЛрдВ рдХреЛ рдмрдВрдж рдХрд░ рджреЗрдВрдЧреЗред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f47/5fd/74d/f475fd74d147a577e8adb72cd1ff63fb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреИрдирд▓реЛрдВ рдХреЗ рдкрд╛рд╕ рдЫреЗрджред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╕реЗрд▓ рдореЗрдВ рдПрдХ рдирджреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд░реНрддрдорд╛рди рджрд┐рд╢рд╛ рдореЗрдВ рдирд╣реАрдВ рдмрд╣рддреА рд╣реИ, рддреЛ </font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рдирдИ рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e.v3.y = cell.StreamBedY; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { TriangulateWithRiverBeginOrEnd(direction, cell, center, e); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateWithRiver(direction, cell, center, e); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateAdjacentToRiver(direction, cell, center, e); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeFan(center, e, cell.Color); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдкрджреНрдзрддрд┐ рдореЗрдВ, рд╣рдо рдПрдХ рдкрдЯреНрдЯреА рдФрд░ рдПрдХ рдкрдВрдЦреЗ рдХреЗ рд╕рд╛рде рд╕реЗрд▓ рддреНрд░рд┐рдХреЛрдг рдХреЛ рднрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдмрд╕ рдПрдХ рдкрдВрдЦрд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЛ рдирджреА рд╕реЗ рд▓рдЧреЗ рднрд╛рдЧреЛрдВ рдХреЗ рдордзреНрдп рдХрд┐рдирд╛рд░реЗ рдХреЗ рдЕрдиреБрд░реВрдк рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) ); TriangulateEdgeStrip(m, cell.Color, e, cell.Color); TriangulateEdgeFan(center, m, cell.Color); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/059/4df/7bb/0594df7bb3225d20852c9e0d0d708101.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШрдЯрддрд╛ рдФрд░ рд╕реАрдзреА рдирджрд┐рдпреЛрдВ рдореЗрдВ рдУрд╡рд░рд▓реЗред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪреИрдирд▓ рдХрд╛ рдорд┐рд▓рд╛рди рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рд╣рдореЗрдВ рдЙрд╕ рдХреЗрдВрджреНрд░ рдХреЛ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдирджреА рдХреЗ рд╣рд┐рд╕реНрд╕реЛрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдордзреНрдп рднрд╛рдЧ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЬрд╝рд┐рдЧрдЬрд╝реИрдЧ рдХреЗ рд╕рд╛рде, рд╕рдм рдХреБрдЫ рдХреНрд░рдо рдореЗрдВ рд╣реИ, рдФрд░ рдШрдЯрддрд╛ рдФрд░ рд╕реАрдзреА рдирджрд┐рдпреЛрдВ рдкрд░ рдзреНрдпрд╛рди рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдирджреА рдХреЗ рдкреНрд░рдХрд╛рд░ рдФрд░ рдЙрд╕рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдЕрднрд┐рд╡рд┐рдиреНрдпрд╛рд╕ рджреЛрдиреЛрдВ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдЬрд╛рдБрдЪ рдХрд░рдХреЗ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рд╣рдо рд╡рдХреНрд░ рдХреЗ рдЕрдВрджрд░ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкрд┐рдЫрд▓реА рдФрд░ рдЕрдЧрд▓реА рджреЛрдиреЛрдВ рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рдирджреА рд╢рд╛рдорд┐рд▓ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдРрд╕рд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдХреЗрдВрджреНрд░ рдХреЛ рдХрд┐рдирд╛рд░реЗ рдкрд░ рд▓реЗ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { center += HexMetrics.GetSolidEdgeMiddle(direction) * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } } EdgeVertices m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/016/620/d89/016620d89847368d487d49bb1c81cdc7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдРрд╕рд╛ рдорд╛рдорд▓рд╛ рддрдп рдХрд┐рдпрд╛ рдЬрд╣рд╛рдВ рдирджреА рджреЛрдиреЛрдВ рдУрд░ рд╕реЗ рдмрд╣рддреА рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЕрд▓рдЧ рджрд┐рд╢рд╛ рдореЗрдВ рдПрдХ рдирджреА рд╣реИ, рд▓реЗрдХрд┐рди рдкрд┐рдЫрд▓реЗ рдПрдХ рдореЗрдВ рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рд╕реАрдзрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдРрд╕рд╛ рд╣реИ, рддреЛ рдХреЗрдВрджреНрд░ рдХреЛ рдкрд╣рд▓реЗ рдХреЛрдиреЗ рдореЗрдВ рд▓реЗ рдЬрд╛рдПрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { center += HexMetrics.GetSolidEdgeMiddle(direction) * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cell.HasRiverThroughEdge(direction.Previous2()) ) { center += HexMetrics.GetFirstSolidCorner(direction) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a1d/85a/366/a1d85a3669a55984eb69a43af5e8631f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдзреА рдирджреА рдХреЗ рд╕рд╛рде рдЖрдзрд╛ рдУрд╡рд░рд▓реЗред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рд╣рдордиреЗ рд╕реАрдзреА рдирджрд┐рдпреЛрдВ рд╕реЗ рд╕рдЯреЗ рдЖрдзреЗ рд╣рд┐рд╕реНрд╕реЛрдВ рдХреЗ рд╕рд╛рде рдЗрд╕ рдореБрджреНрджреЗ рдХреЛ рд╣рд▓ рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдЖрдЦрд┐рд░реА рдорд╛рдорд▓рд╛ - рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд┐рдЫрд▓реА рджрд┐рд╢рд╛ рдореЗрдВ рдПрдХ рдирджреА рд╣реИ, рдФрд░ рдпрд╣ рд╕реАрдзреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдХреЗрдВрджреНрд░ рдХреЛ рдЕрдЧрд▓реЗ рдХреЛрдиреЗ рдореЗрдВ рд▓реЗ рдЬрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { center += HexMetrics.GetSolidEdgeMiddle(direction) * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cell.HasRiverThroughEdge(direction.Previous2()) ) { center += HexMetrics.GetFirstSolidCorner(direction) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cell.HasRiverThroughEdge(direction.Previous()) &amp;&amp; cell.HasRiverThroughEdge(direction.Next2()) ) { center += HexMetrics.GetSecondSolidCorner(direction) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c9d/d1a/20c/c9dd1a20c213658aeed27b9065e6bf58.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдХреЛрдИ рдУрд╡рд░рд▓реЗ рдирд╣реАрдВред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реЗрдХреНрд╕рдореЗрд╢ рд╕рд╛рдорд╛рдиреНрдпреАрдХрд░рдг </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рдЪреИрдирд▓реЛрдВ рдХрд╛ рддреНрд░рд┐рдХреЛрдгреАрдХрд░рдг рдкреВрд░рд╛ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдЙрдиреНрд╣реЗрдВ рдкрд╛рдиреА рд╕реЗ рднрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдкрд╛рдиреА рдЬрдореАрди рд╕реЗ рдЕрд▓рдЧ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╢реАрд░реНрд╖ рдбреЗрдЯрд╛ рдФрд░ рдЕрд▓рдЧ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдПрдХ рдЕрд▓рдЧ рдЬрд╛рд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдпрд╣ рдХрд╛рдлреА рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрдЧрд╛ рдпрджрд┐ рд╣рдо </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реБрд╢реА рдФрд░ рдкрд╛рдиреА рджреЛрдиреЛрдВ рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рддреЛ рдЖрдЗрдП </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рдПрдХ рд╡рд░реНрдЧ рдореЗрдВ рдмрджрд▓рдХрд░ </font><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛ рдЗрди рдЬрд╛рд▓реЛрдВ рд╕реЗ рдирд┐рдкрдЯрддрд╛ рд╣реИ, рднрд▓реЗ рд╣реА рдЗрд╕рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рддреНрд░рд┐рднреБрдЬ рдмрдирд╛рдиреЗ рдХреЗ рдХрд╛рдо рд╕реЗ рдЧреБрдЬрд░реЗрдВрдЧреЗ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Perturb рд╡рд┐рдзрд┐ рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╡рд┐рдзрд┐ </font></font><code>Perturb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рдлреА рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╣реИ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдПрдЧреА, рдЖрдЗрдП рдЗрд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЗрд╕реЗ рдирд╛рдо рдмрджрд▓реЗрдВ </font></font><code>HexMetrics.Perturb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рдЧрд▓рдд рд╡рд┐рдзрд┐ рдХрд╛ рдирд╛рдо рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЗрд╕рдХреЗ рдЙрдЪрд┐рдд рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рд╕рднреА рдХреЛрдб рдХреЛ рд░рд┐рдлреНрд▓реЗрдХреНрдЯрд░ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдкрдХреЗ рдХреЛрдб рд╕рдВрдкрд╛рджрдХ рдореЗрдВ рдЪрд▓рддреА рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдХреЛ рдЕрдВрджрд░ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рдХрд░ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдФрд░ рд╕реНрдерд┐рд░ рдмрдирд╛рдПрдВ рдФрд░ рдлрд┐рд░ рдЗрд╕рдХрд╛ рдирд╛рдо рд╕рд╣реА рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perturb</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Vector4 sample = SampleNoise(position); position.x += (sample.x * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * cellPerturbStrength; position.z += (sample.z * <span class="hljs-number"><span class="hljs-number">2f</span></span> - <span class="hljs-number"><span class="hljs-number">1f</span></span>) * cellPerturbStrength; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддреНрд░рд┐рднреБрдЬ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд░ рдХреЗ рдкрд░рд┐рд╡рд░реНрддрди </font></font><code>hexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдЭрд╛ рдЪрд░ рдореЗрдВ </font></font><code>terrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain; <span class="hljs-comment"><span class="hljs-comment">// HexMesh hexMesh; void Awake () { gridCanvas = GetComponentInChildren&lt;Canvas&gt;(); // hexMesh = GetComponentInChildren&lt;HexMesh&gt;(); cells = new HexCell[HexMetrics.chunkSizeX * HexMetrics.chunkSizeZ]; ShowUI(false); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛, рд╣рдо </font><font style="vertical-align: inherit;">c </font></font><code>AddтАж</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗ </font><font style="vertical-align: inherit;">рд╕рднреА рддрд░реАрдХреЛрдВ </font><font style="vertical-align: inherit;">рдХреЛ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рдлреНрд▓реЗрдХреНрдЯрд░ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>terrain.AddтАж</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╕рднреА рддрд░реАрдХреЛрдВ </font></font><code>TriangulateтАж</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ </font><font style="vertical-align: inherit;">рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд </font><font style="vertical-align: inherit;">рдХрд░реЗрдВ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рдЖрдк рддрд░реАрдХреЛрдВ рдХреЗ рдирд╛рдо рдХреЛ рд╕рд╣реА рдХрд░ рд╕рдХрддреЗ </font></font><code>AddтАж</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЖрдо рд╣реИрдВред </font><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рд╕рднреА рдЬрдЯрд┐рд▓ рддреНрд░рд┐рднреБрдЬ рддрд░реАрдХреЗ рдорд┐рд▓реЗрдВрдЧреЗ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ рдЬрд╛рд▓ рдореЗрдВ рдбреЗрдЯрд╛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд░рд▓ рддрд░реАрдХреЗ рдЕрдВрджрд░ рд░рд╣реЗрдВрдЧреЗ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЕрднреА рддрдХ рдирд╣реАрдВ рдХрд┐рдП рдЧрдП рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдм рдЗрд╕реЗ </font></font><code>HexGridChunk.LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреА рд╡рд┐рдзрд┐ рдХрд╣рдиреА рдЪрд╛рд╣рд┐рдП </font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕реЗ рдЕрдм рдПрдХ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдкрд╛рд░рд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдпрд╣ </font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдирд╛ рдкреИрд░рд╛рдореАрдЯрд░ рдЦреЛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдФрд░ рдЙрд╕реЗ рдЬрд╛рд▓ рдбреЗрдЯрд╛ рдХреА рд╕рдлрд╛рдИ рдФрд░ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛ рд╕реМрдВрдкрдирд╛ рд╣реЛрдЧрд╛ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LateUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Triangulate(); <span class="hljs-comment"><span class="hljs-comment">// hexMesh.Triangulate(cells); enabled = false; } public void Triangulate () { terrain.Clear(); // hexMesh.Clear(); // vertices.Clear(); // colors.Clear(); // triangles.Clear(); for (int i = 0; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); // hexMesh.vertices = vertices.ToArray(); // hexMesh.colors = colors.ToArray(); // hexMesh.triangles = triangles.ToArray(); // hexMesh.RecalculateNormals(); // meshCollider.sharedMesh = hexMesh; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╡рд╢реНрдпрдХ рд╡рд┐рдзрд┐рдпрд╛рдВ рдЬреЛрдбрд╝реЗрдВ </font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>Apply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Clear(); vertices.Clear(); colors.Clear(); triangles.Clear(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.SetVertices(vertices); hexMesh.SetColors(colors); hexMesh.SetTriangles(triangles, <span class="hljs-number"><span class="hljs-number">0</span></span>); hexMesh.RecalculateNormals(); meshCollider.sharedMesh = hexMesh; }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetVertices, SetColors рдФрд░ SetTriangles рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?</font></font></b> <div class="spoiler_text">        <code>Mesh</code> .        .  ,           . <br><br>  <code>SetTriangles</code>    integer,    .      ,    . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдЬрд╛рд▓ рдХреЗ рдмрдЪреНрдЪреЗ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЯреБрдХрдбрд╝реЗ рдХреЗ рдкреНрд░реАрдлреИрдм рдореЗрдВ рд╕рдВрд▓рдЧреНрди рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЕрдм рдЗрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдЬрд▓реНрдж рд╣реА рдЬрд╛рд▓ рдореЗрдВ рджреВрд╕рд░рд╛ рдмрдЪреНрдЪрд╛ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЕрдкрдиреЗ рдЙрджреНрджреЗрд╢реНрдп рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдЗрд╕реЗ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЗрд░реЗрди</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛ </font><font style="vertical-align: inherit;">рдирд╛рдо рджреЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/614/3b4/0dc/6143b40dc88ecec6761348d9e6208944.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд░рд╛рд╣рдд рдкреНрд░рджрд╛рди рдХрд░реЗрдВред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлрд╝реИрдм рдмрдЪреНрдЪреЗ рдХрд╛ рдирд╛рдо рдмрджрд▓рдирд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ?</font></font></b> <div class="spoiler_text">          .    ,   .  ,     <em>Apply</em> ,       .        . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реВрдЪреА рдкреВрд▓ рдмрдирд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐ рд╣рдо рдХрд╛рдлреА рдХреЛрдб рд▓реЗ рдЧрдП рд╣реИрдВ, рдлрд┐рд░ рднреА рд╣рдорд╛рд░рд╛ рдирдХреНрд╢рд╛ рдкрд╣рд▓реЗ рдЬреИрд╕рд╛ рд╣реА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рдПрдХ рдФрд░ рдЬрд╛рд▓ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдпрд╣ рдирд╣реАрдВ рдмрджрд▓реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╣рдо рд╡рд░реНрддрдорд╛рди рдХреЗ рд╕рд╛рде рдРрд╕рд╛ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рддреЛ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдЙрддреНрдкрдиреНрди рд╣реЛ рд╕рдХрддреА рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдордиреЗ рдпрд╣ рдорд╛рди рд▓рд┐рдпрд╛ рдерд╛ рдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рдПрдХ рд╕рдордп рдореЗрдВ рдПрдХ рдЬрд╛рд▓ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рд╣рдореЗрдВ рдЕрд╕реНрдерд╛рдпреА рдЬрд╛рд▓ рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдереИрддрд┐рдХ рд╕реВрдЪрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реАред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдкрд╛рдиреА рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдПрдХ рд╕рд╛рде рджреЛ рдореЗрд╖реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЕрдм рд╕реНрдереИрддрд┐рдХ рд╕реВрдЪреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд╕реВрдЪреА рд╕реЗрдЯ рдкрд░ рдирд╣реАрдВ рд▓реМрдЯреЗрдВрдЧреЗ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдПрдХ рд╕реНрдерд┐рд░ рд╕реВрдЪреА рдкреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдпрд╣ рдкреВрд▓рд┐рдВрдЧ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ, рддреЛ рдЪрд▓рд┐рдП рд╕реНрд╡рдпрдВ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╕реВрдЪреА рдкреВрд▓ рдХреНрд▓рд╛рд╕ рдмрдирд╛рдХрд░ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListPool</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ListPool &lt;T&gt; рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?</font></font></b> <div class="spoiler_text">     ,  <code>List&lt;int&gt;</code>    .  <code>&lt;T&gt;</code>    <code>ListPool</code> ,  ,    .      ,    <code>T</code> (  template). </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдкреВрд▓ рдореЗрдВ рд╕реВрдЪрд┐рдпреЛрдВ рдХрд╛ рд╕рдВрдЧреНрд░рд╣ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕реНрдЯреИрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдореИрдВ рдЖрдорддреМрд░ рдкрд░ рд╕реВрдЪрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реВрдВ рдХреНрдпреЛрдВрдХрд┐ рдПрдХрддрд╛ рдЙрдиреНрд╣реЗрдВ рдХреНрд░рдордмрджреНрдз рдирд╣реАрдВ рдХрд░рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListPool</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Stack&lt;List&lt;T&gt;&gt; stack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stack&lt;List&lt;T&gt;&gt;(); }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдЯреИрдХ &lt;рд╕реВрдЪреА &lt;t &gt;&gt; рдХрд╛ рдХреНрдпрд╛ рдорддрд▓рдм рд╣реИ?</font></font></b> <div class="spoiler_text">     .  ,     .      . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреВрд▓ рд╕реЗ рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдереИрддрд┐рдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╕реНрдЯреИрдХ рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рд╢реАрд░реНрд╖ рд╕реВрдЪреА рдирд┐рдХрд╛рд▓реЗрдВрдЧреЗ рдФрд░ рдЗрд╕реЗ рд╡рд╛рдкрд╕ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рд╣рдо рдПрдХ рдирдИ рд╕реВрдЪреА рдмрдирд╛рдПрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stack.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stack.Pop(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;T&gt;(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реВрдЪрд┐рдпреЛрдВ рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЙрдирдХреЗ рд╕рд╛рде рдХрд╛рдо рдЦрддреНрдо рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЙрдиреНрд╣реЗрдВ рдкреВрд▓ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред </font></font><code>ListPool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реВрдЪреА рдХреЛ рд╕рд╛рдл рдХрд░реЗрдЧрд╛ рдФрд░ рд╕реНрдЯреИрдХ рдкрд░ рдзрдХреЗрд▓ рджреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;T&gt; list</span></span></span><span class="hljs-function">)</span></span> { list.Clear(); stack.Push(list); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдкреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╕реНрдереИрддрд┐рдХ рд╕реВрдЪреА рдХреЛ рдЧреИрд░-рд╕реНрдерд┐рд░ рдирд┐рдЬреА рд▓рд┐рдВрдХ рд╕реЗ рдмрджрд▓реЗрдВред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЙрдиреНрд╣реЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░реЗрдВ </font></font><code>NonSerialized</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдПрдХрддрд╛ рдкреБрдирд░реНрд╕рдВрдпреЛрдЬрди рдХреЗ рджреМрд░рд╛рди рдЙрдиреНрд╣реЗрдВ рд╕рдВрд░рдХреНрд╖рд┐рдд рди рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдпрд╛ </font><font style="vertical-align: inherit;">рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ </font><font style="vertical-align: inherit;">рд▓рд┐рдЦрдирд╛ </font></font><code>System.NonSerialized</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╛ рдЬреЛрдбрд╝рдирд╛ </font></font><code>using System;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">NonSerialized</span></span>] List&lt;Vector3&gt; vertices; [NonSerialized] List&lt;Color&gt; colors; [NonSerialized] List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; triangles; <span class="hljs-comment"><span class="hljs-comment">// static List&lt;Vector3&gt; vertices = new List&lt;Vector3&gt;(); // static List&lt;Color&gt; colors = new List&lt;Color&gt;(); // static List&lt;int&gt; triangles = new List&lt;int&gt;();</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪреВрдВрдХрд┐ рдирдП рдбреЗрдЯрд╛ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдореЗрд╖ рдХреЛ рдареАрдХ рд╕реЗ рд╕рд╛рдл рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рдпрд╣рд╛рдВ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдкреВрд▓ рд╕реЗ рд╕реВрдЪрд┐рдпрд╛рдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Clear(); vertices = ListPool&lt;Vector3&gt;.Get(); colors = ListPool&lt;Color&gt;.Get(); triangles = ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Get(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрди рдЬрд╛рд▓реЛрдВ рдХреЛ рд▓рдЧрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдЕрдм рдЙрдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣рд╛рдВ рд╣рдо рдЙрдиреНрд╣реЗрдВ рдкреВрд▓ рдореЗрдВ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.SetVertices(vertices); ListPool&lt;Vector3&gt;.Add(vertices); hexMesh.SetColors(colors); ListPool&lt;Color&gt;.Add(colors); hexMesh.SetTriangles(triangles, <span class="hljs-number"><span class="hljs-number">0</span></span>); ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Add(triangles); hexMesh.RecalculateNormals(); meshCollider.sharedMesh = hexMesh; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕рд▓рд┐рдП рд╣рдордиреЗ рд╕реВрдЪрд┐рдпреЛрдВ рдХреЗ рдХрдИ рдЙрдкрдпреЛрдЧреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛, рднрд▓реЗ рд╣реА рд╣рдо рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдХрд┐рддрдиреЗ рдЬрд╛рд▓ рднрд░реЗрдВред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡реИрдХрд▓реНрдкрд┐рдХ рдХреЙрд▓рд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╣рдорд╛рд░реЗ рдЗрд▓рд╛рдХреЗ рдХреЛ рдПрдХ рдХреЛрд▓рд╛рдЗрдбрд░ рдХреА рдЬрд░реВрд░рдд рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдирджрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЬрд░реВрд░реА рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдХрд┐рд░рдгреЗрдВ рдХреЗрд╡рд▓ рдкрд╛рдиреА рд╕реЗ рд╣реЛрдХрд░ рдЧреБрдЬрд░реЗрдВрдЧреА рдФрд░ рдиреАрдЪреЗ рдХреЗ рдЪреИрдирд▓ рд╕реЗ рдорд┐рд▓реЗрдВрдЧреАред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ рдмрдирд╛рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╣рдо рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЛрд▓рд╛рдЗрдбрд░ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХреЗрдВ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдХреНрд╖реЗрддреНрд░ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдЗрд╕рдХрд╛ рдПрд╣рд╕рд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>bool useCollider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд▓рд╛рдХреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрд╕реЗ рдЪрд╛рд▓реВ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useCollider;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e7/f19/a3c/4e7f19a3c7eb01a1432618a8be6903e5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЬрд╛рд▓ рдХреЛрд▓реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдЙрд╕ рдЪрд╛рд▓реВ рд╣реЛрдиреЗ рдкрд░ рдЙрд╕реЗ рдмрдирд╛рдпрд╛ рдФрд░ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХреЛрд▓рд╛рдЗрдбрд░ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GetComponent&lt;MeshFilter&gt;().mesh = hexMesh = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mesh(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useCollider) { meshCollider = gameObject.AddComponent&lt;MeshCollider&gt;(); } hexMesh.name = <span class="hljs-string"><span class="hljs-string">"Hex Mesh"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useCollider) { meshCollider.sharedMesh = hexMesh; } тАж }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡реИрдХрд▓реНрдкрд┐рдХ рд░рдВрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрдЯреЗрдХреНрд╕ рд░рдВрдЧ рд╡реИрдХрд▓реНрдкрд┐рдХ рднреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреА рд░рд╛рд╣рдд рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкрд╛рдиреА рд░рдВрдЧ рдирд╣реАрдВ рдмрджрд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╡реИрдХрд▓реНрдкрд┐рдХ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рд╣рдордиреЗ рдХреЛрд▓рд╛рдЗрдбрд░ рдХреЛ рд╡реИрдХрд▓реНрдкрд┐рдХ рдмрдирд╛рдпрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useCollider, useColors; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Clear(); vertices = ListPool&lt;Vector3&gt;.Get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useColors) { colors = ListPool&lt;Color&gt;.Get(); } triangles = ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Get(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.SetVertices(vertices); ListPool&lt;Vector3&gt;.Add(vertices); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useColors) { hexMesh.SetColors(colors); ListPool&lt;Color&gt;.Add(colors); } тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмреЗрд╢рдХ, рдЗрд▓рд╛рдХреЗ рдХреЛ рд░рдВрдЧреЛрдВ рдХреЗ рд░рдВрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдЪрд╛рд▓реВ рдХрд░реЗрдВред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/624/c01/bbd/624c01bbda8ad0250747b9c1af852590.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рдВрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡реИрдХрд▓реНрдкрд┐рдХ рдпреВрд╡реА </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рд╣рдо рдРрд╕рд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рд╣рдо рд╡реИрдХрд▓реНрдкрд┐рдХ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рднреА рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐ рд░рд╛рд╣рдд рдЗрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреА рд╣реИ, рдлрд┐рд░ рднреА рд╣рдореЗрдВ рдкрд╛рдиреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useCollider, useColors, useUVCoordinates; [NonSerialized] List&lt;Vector2&gt; uvs; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Clear(); vertices = ListPool&lt;Vector3&gt;.Get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useColors) { colors = ListPool&lt;Color&gt;.Get(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUVCoordinates) { uvs = ListPool&lt;Vector2&gt;.Get(); } triangles = ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Get(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.SetVertices(vertices); ListPool&lt;Vector3&gt;.Add(vertices); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useColors) { hexMesh.SetColors(colors); ListPool&lt;Color&gt;.Add(colors); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUVCoordinates) { hexMesh.SetUVs(<span class="hljs-number"><span class="hljs-number">0</span></span>, uvs); ListPool&lt;Vector2&gt;.Add(uvs); } тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b01/a99/559/b01a9955989cdc83a2e8de2582c1cbeb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рддреНрд░рд┐рднреБрдЬ рдФрд░ рдХреНрд╡рд╛рдбреНрд░реИрдВрдЧрд▓реНрд╕ рдореЗрдВ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рддрд░реАрдХреЗ рдмрдирд╛рдПрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleUV</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 uv1, Vector2 uv2, Vector3 uv3</span></span></span><span class="hljs-function">)</span></span> { uvs.Add(uv1); uvs.Add(uv2); uvs.Add(uv3); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUV</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 uv1, Vector2 uv2, Vector3 uv3, Vector3 uv4</span></span></span><span class="hljs-function">)</span></span> { uvs.Add(uv1); uvs.Add(uv2); uvs.Add(uv3); uvs.Add(uv4); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП </font></font><code>AddQuadUV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЖрдпрддрд╛рдХрд╛рд░ рдпреВрд╡реА рдХреНрд╖реЗрддреНрд░ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд░реВрдк рд╕реЗ рдЬреЛрдбрд╝рдиреЗ </font><font style="vertical-align: inherit;">рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╡рд┐рдзрд┐ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдорд╛рдирдХ рдорд╛рдорд▓рд╛ рд╣реИ рдЬрдм рдХреНрд╡рд╛рдб рдФрд░ рдЗрд╕рдХреА рдмрдирд╛рд╡рдЯ рд╕рдорд╛рди рд╣реИ, рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирджреА рдХреЗ рдкрд╛рдиреА рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUV</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uMin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uMax, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vMin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vMax</span></span></span><span class="hljs-function">)</span></span> { uvs.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMin, vMin)); uvs.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMax, vMin)); uvs.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMin, vMax)); uvs.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMax, vMax)); }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд░реНрддрдорд╛рди рдирджрд┐рдпрд╛рдБ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ рдпрд╣ рдкрд╛рдиреА рдмрдирд╛рдиреЗ рдХрд╛ рд╕рдордп рд╣реИ! </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдПрдХ рдХреНрд╡рд╛рдб рдХреЗ рд╕рд╛рде рдХрд░реЗрдВрдЧреЗ, рдЬреЛ рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдФрд░ рдЬрдм рд╕реЗ рд╣рдо рдирджрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдкрд╛рдиреА рдмрд╣рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдирджреА рдХреЗ рдЙрдиреНрдореБрдЦреАрдХрд░рдг рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрдиреЗ рд╡рд╛рд▓реЗ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреА рдХрд▓реНрдкрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдирдП рд╢реЗрдбрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдПрдХ рдирдпрд╛ рдорд╛рдирдХ рд╢реЗрдбрд░ рдмрдирд╛рдПрдВ рдФрд░ рдЗрд╕реЗ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рд╡рд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╣реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╣рд░реЗ рдФрд░ рд▓рд╛рд▓ рдЕрд▓реНрдмреЗрдбреЛ рдЪреИрдирд▓реЛрдВ рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдП рдЬрд╛рдПрдВред</font></font><br><br><pre> <code class="hljs pgsql">Shader "Custom/River" { тАж <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex) * _Color; o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; o.Albedo.rg = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex; } ENDCG } FallBack "Diffuse" }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рдХреНрд╖реЗрддреНрд░ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexMesh rivers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рд╕рд╛рдл рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд░рд╛рд╣рдд рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЙрд╕реА рддрд░рд╣ рд╕реЗ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрддрд┐рд░рд┐рдХреНрдд рдбреНрд░реЙ рдХреЙрд▓ рд╣реЛрдВрдЧреЗ, рднрд▓реЗ рд╣реА рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдирджрд┐рдпрд╛рдБ рди рд╣реЛрдВ?</font></font></b> <div class="spoiler_text">  Unity  ,        .     ,  -  . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реАрдлрд╝реИрдм рдХреЛ рдмрджрд▓реЗрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ), рдЗрд╕рдХреЗ рдЗрд▓рд╛рдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░рддреЗ рд╣реБрдП, рдЗрд╕рдХрд╛ рдирд╛рдо рдмрджрд▓рдХрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рд╡рд░ рд░рдЦрд╛ рдЧрдпрд╛</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдЗрд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/efd/0d6/680/efd0d66801d78d636d07f59b34e5c615.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e46/119/b43/e46119b43f4cd398d96261715975a36a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдкреНрд░реАрдлреИрдм рдЯреБрдХрдбрд╝рд╛ред </font></font></i> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдирдП рд╢реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ </font><em><font style="vertical-align: inherit;">рд░рд┐рд╡рд░</font></em></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореИрдЯреЗрд░рд┐рдпрд▓ рдмрдирд╛рдПрдВ </font><font style="vertical-align: inherit;">рдФрд░ </font><em><font style="vertical-align: inherit;">рд░рд┐рд╡рд░</font></em><font style="vertical-align: inherit;"> рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдордиреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд╣реЗрдХреНрд╕рд╛рдЧреЛрди рдореЗрд╖ рдШрдЯрдХ рдХреЛ рднреА рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗ, рд▓реЗрдХрд┐рди рд╡рд░реНрдЯреЗрдХреНрд╕ рд░рдВрдЧреЛрдВ рдпрд╛ рдХреЛрд▓рд╛рдЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7df/db6/134/7dfdb6134b4dc27d843db92492b61708.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subobject Riversред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛рдиреА рдХреЛ рдЯреНрд░рд╛рдИ рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо рдкрд╛рдиреА рдХреЛ рддреНрд░рд┐рдХреЛрдгреАрдп рдХрд░ рд╕рдХреЗрдВ, рд╣рдореЗрдВ рдЗрд╕рдХреА рд╕рддрд╣ рдХреЗ рд╕реНрддрд░ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЗрд╕реЗ рдКрдВрдЪрд╛рдИ рдореЗрдВ рдПрдХ рдмрджрд▓рд╛рд╡ рдмрдирд╛рддреЗ рд╣реИрдВ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдирджреА рдХреЗ рдмрд┐рд╕реНрддрд░ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╕реЗрд▓ рдХрд╛ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд╡рд┐рд░реВрдкрдг рдЖрдзреА рдКрдВрдЪрд╛рдИ рдХреА рд╢рд┐рдлреНрдЯ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирджреА рдХреА рд╕рддрд╣ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рд╣рдо рдЧрд╛рд░рдВрдЯреА рджреЗрддреЗ рд╣реИрдВ рдХрд┐ рдкрд╛рдиреА рдХрднреА рднреА рд╕реЗрд▓ рдХреА рд╕реНрдерд▓рд╛рдХреГрддрд┐ рд╕реЗ рдКрдкрд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> riverSurfaceElevationOffset = <span class="hljs-number"><span class="hljs-number">-0.5f</span></span>;</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рдереЛрдбрд╝рд╛ рдХрдо рдХреНрдпреЛрдВ рдирд╣реАрдВ рдХрд┐рдпрд╛?</font></font></b> <div class="spoiler_text">          ,   . ,         . </div></div><br><font style="vertical-align: inherit;"></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреА рдирджреА рдХреА рд╕рддрд╣ рдХреА рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд╕реНрдерд┐рддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдПрдХ </font><font style="vertical-align: inherit;">рд╕рдВрдкрддреНрддрд┐ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> RiverSurfaceY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (elevation + HexMetrics.riverSurfaceElevationOffset) * HexMetrics.elevationStep; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдХрд╛рдо рдореЗрдВ рд▓рдЧ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">! </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдирджрд┐рдпреЛрдВ рдХреЗ рдХрдИ рдЪрддреБрд░реНрднреБрдЬ рдмрдирд╛рдПрдВрдЧреЗ, рддреЛ рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ рдЪрд╛рд░ рдХреЛрдиреЗ рджреЗрдВ рдФрд░ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдКрдВрдЪрд╛рдИ рджреЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╣рдореЗрдВ рдХреНрд╡рд╛рдб рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рд╕рд╛рде рд╕рднреА рдЪрд╛рд░ рдХреЛрдиреЗ рдХреА рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд░реВрдк рд╕реЗ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y </span></span></span><span class="hljs-function">)</span></span> { v1.y = v2.y = v3.y = v4.y = y; rivers.AddQuad(v1, v2, v3, v4); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдпрд╣рд╛рдВ рдЪрддреБрд░реНрднреБрдЬ рдХреЗ рдпреВрд╡реА-рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдЬреЛрдбрд╝реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдмрд╕ рдмрд╛рдПрдВ рд╕реЗ рджрд╛рдПрдВ рдФрд░ рдиреАрдЪреЗ рд╕реЗ рдКрдкрд░ рддрдХ рдШреВрдореЗрдВред</font></font><br><br><pre> <code class="cs hljs"> rivers.AddQuad(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br> <code>TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдпрд╣ рдкрд╣рд▓реА рд╡рд┐рдзрд┐ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдирджрд┐рдпреЛрдВ рдХреЗ рдЪрддреБрд░реНрднреБрдЬ рдЬреЛрдбрд╝реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдкрд╣рд▓рд╛ рдХреНрд╡рд╛рдб рдХреЗрдВрджреНрд░ рдФрд░ рдордзреНрдп рдХреЗ рдмреАрдЪ рд╣реИред </font><font style="vertical-align: inherit;">рджреВрд╕рд░рд╛ рдордзреНрдп рдФрд░ рдкрд╕рд▓реА рдХреЗ рдмреАрдЪ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдХреЗрд╡рд▓ рдЙрди рд╕рд┐рд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЗрди рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЛ рдХрдо рдХрд░рдХреЗ рдЖрдВрдХрд╛ рдЬрд╛рдПрдЧрд╛, рдирддреАрдЬрддрди рдкрд╛рдиреА рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдЪреИрдирд▓ рдХреА рдЭреБрдХреА рд╣реБрдИ рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рдиреАрдЪреЗ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдкрд╛рдиреА рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХреА рд╕рдЯреАрдХ рд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж TriangulateRiverQuad(centerL, centerR, m.v2, m.v4, cell.RiverSurfaceY); TriangulateRiverQuad(m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/418/a40/e9c/418a40e9c73fd3da885ce467e475ff63.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛рдиреА рдХреЗ рдкрд╣рд▓реЗ рд▓рдХреНрд╖рдгред </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдиреА рдХреА рдЪреМрдбрд╝рд╛рдИ рдХреНрдпреЛрдВ рдмрджрд▓рддреА рд╣реИ?</font></font></b> <div class="spoiler_text">  ,     ,      тАФ .           .      . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рд╡рд╛рд╣ рдХреЗ рд╕рд╛рде рдЪрд▓ рд░рд╣рд╛ рд╣реИ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рдореЗрдВ, рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдирджреА рдХреА рджрд┐рд╢рд╛ рдХреЗ рдЕрдиреБрд░реВрдк рдирд╣реАрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдпрд╣рд╛рдВ рдирд┐рд░рдВрддрд░рддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред </font><font style="vertical-align: inherit;">рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рдирджреА рдХреЗ рдмрд╛рдИрдВ рдУрд░ U рд╕рдордиреНрд╡рдп 0 рд╣реИ, рдФрд░ рдиреАрдЪреЗ рдХреА рдУрд░ рджреЗрдЦрдиреЗ рдкрд░ рджрд╛рдИрдВ рдУрд░ 1 рд╣реИред </font><font style="vertical-align: inherit;">рдФрд░ V рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдирджреА рдХреА рджрд┐рд╢рд╛ рдореЗрдВ 0 рд╕реЗ 1 рддрдХ рднрд┐рдиреНрди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╡рд┐рдирд┐рд░реНрджреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдирд┐рд╡рд░реНрддрдорд╛рди рдирджреА рдХреЛ рддреНрд░рд┐рдХреЛрдгреАрдп рдмрдирд╛рдиреЗ рдкрд░ рдпреВрд╡реА рд╕рд╣реА рд╣реЛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рд╡реЗ рдЧрд▓рдд рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ рдФрд░ рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреЗ рддреНрд░рд┐рдХреЛрдгрд┐рдд рд╣реЛрдиреЗ рдкрд░ рдЙрдиреНрд╣реЗрдВ рдЪрд╛рд▓реВ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдХрд╛рд░реНрдп рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, </font></font><code>TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font></font><code>bool reversed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рдлреНрд▓рд┐рдк рдлреНрд▓рд┐рдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed </span></span></span><span class="hljs-function">)</span></span> { v1.y = v2.y = v3.y = v4.y = y; rivers.AddQuad(v1, v2, v3, v4); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reversed) { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ </font></font><code>TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рджрд┐рд╢рд╛ рдЪрд╛рд▓реВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрдм рднреЗрдЬреЗ рдирджреА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.IncomingRiver == direction; TriangulateRiverQuad( centerL, centerR, m.v2, m.v4, cell.RiverSurfaceY, reversed ); TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, reversed );</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/546/c86/e9d/546c86e9d2d8752caa30523098283542.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреА рд╕рд╣рдорддрд┐ рд╡рд╛рд▓реА рджрд┐рд╢рд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА рдХреА рд╢реБрд░реБрдЖрдд рдФрд░ рдЕрдВрдд </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрджрд░, </font></font><code>TriangulateWithRiverBeginOrEnd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рд╡рд╛рд╣ рдХреА рджрд┐рд╢рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рд╣реИ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣рдо рдмреАрдЪ рдФрд░ рд░рд┐рдм рдХреЗ рдмреАрдЪ рдПрдХ рдФрд░ рдХреНрд╡рд╛рдб рдирджреА рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiverBeginOrEnd</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.HasIncomingRiver; TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, reversed ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрдВрджреНрд░ рдФрд░ рдордзреНрдп рдХреЗ рдмреАрдЪ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдПрдХ рддреНрд░рд┐рдХреЛрдг рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рдПрдХрдорд╛рддреНрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рдХреЗрдВрджреНрд░реАрдп рд╢рд┐рдЦрд░ рдирджреА рдХреЗ рдмреАрдЪ рдореЗрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЗрд╕рдХрд╛ рд╕рдордиреНрд╡рдп рдпреВ рд╣рдореЗрд╢рд╛ its рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> center.y = m.v2.y = m.v4.y = cell.RiverSurfaceY; rivers.AddTriangle(center, m.v2, m.v4); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reversed) { rivers.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rivers.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c04/07f/539/c0407f539ce2ff6a91081e84062a4097.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реБрд░реБрдЖрдд рдФрд░ рдЕрдВрдд рдореЗрдВ рдкрд╛рдиреАред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд╕рд┐рд░реЛрдВ рдкрд░ рдкрд╛рдиреА рдХреЗ рдЧрд╛рдпрдм рд╣рд┐рд╕реНрд╕реЗ рд╣реИрдВ?</font></font></b> <div class="spoiler_text">       ,   quad  ,     .           .           . <br><br>      ,  .     ,      .      . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдкреНрд░рд╡рд╛рд╣ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдкрд╛рдиреА рдЬреЛрдбрд╝рддреЗ рд╕рдордп, рд╣рдореЗрдВ рдКрдВрдЪрд╛рдИ рдореЗрдВ рдЕрдВрддрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рд╛рд╡рдзрд╛рди рд░рд╣рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдкрд╛рдиреА рдврд▓рд╛рди рдФрд░ рдЪрдЯреНрдЯрд╛рдиреЛрдВ рд╕реЗ рдиреАрдЪреЗ рдмрд╣ рд╕рдХреЗ, рдЗрд╕реЗ </font></font><code>TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдКрдВрдЪрд╛рдИ рд╡рд╛рд▓реЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рддреЛ рдЪрд▓рд┐рдП рдПрдХ рджреВрд╕рд░рд╛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed </span></span></span><span class="hljs-function">)</span></span> { v1.y = v2.y = y1; v3.y = v4.y = y2; rivers.AddQuad(v1, v2, v3, v4); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reversed) { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП, рдЖрдЗрдП рдПрдХ рд╡рд┐рдХрд▓реНрдк рдЬреЛрдбрд╝реЗрдВ рдЬреЛ рдПрдХ рдКрдВрдЪрд╛рдИ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рд┐рд░реНрдл рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рдХрд╣реЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed </span></span></span><span class="hljs-function">)</span></span> { TriangulateRiverQuad(v1, v2, v3, v4, y, y, reversed); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдХреНрд╡рд╛рдб рдирджреА рдФрд░ рдореЗрдВ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рд╣рдо рддреБрд░рдВрдд рдпрд╣ рдкрддрд╛ рдирд╣реАрдВ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдирджреА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдореЛрдбрд╝ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рд╣рдореЗрдВ рдпрд╣ рдЬрд╛рдБрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рд╣реИ рдФрд░ рдпрджрд┐ рд╡рд╣ рд╣рдорд╛рд░реЗ рджрд┐рд╢рд╛ рдореЗрдВ рдЖрдЧреЗ рдмрдврд╝ рд░рд╣реА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e2.v3.y = neighbor.StreamBedY; TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/283/1f2/62e/2831f262ed46e82bebabf45d0a8215f2.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреВрд░реА рд╣реЛ рдЪреБрдХреА рдирджреАред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡реА рд╕рдордиреНрд╡рдп рдЦрд┐рдВрдЪрд╛рд╡ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рддрдХ, рдирджреА рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдЦрдВрдб рдореЗрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ 0 рд╕реЗ 1 рддрдХ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ V рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╣реИрдВред рдЕрд░реНрдерд╛рддреН, рд╕реЗрд▓ рдореЗрдВ рдЙрдирдореЗрдВ рд╕реЗ рдХреЗрд╡рд▓ рдЪрд╛рд░ рд╣реИрдВред рдкрд╛рдВрдЪ рдЕрдЧрд░ рд╣рдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдз рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред рд╣рдо рдирджреА рдХреЛ рдмреБрдирд╛рд╡рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЙрд╕реЗ рдмрд╕ рдХрдИ рдмрд╛рд░ рджреЛрд╣рд░рд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо V рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рдЦреАрдВрдЪрдХрд░ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдХрдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рдкреВрд░реЗ рд╕реЗрд▓ рдкреНрд▓рд╕ рдПрдХ рдХрдиреЗрдХреНрд╢рди рдореЗрдВ 0 рд╕реЗ 1 рддрдХ рдЬрд╛ рд╕рдХреЗрдВред рдпрд╣ рдкреНрд░рддреНрдпреЗрдХ рдЦрдВрдб рдореЗрдВ рд╡реА рд╕рдордиреНрд╡рдп рдХреЛ 0.2 рд╕реЗ рдмрдврд╝рд╛рдХрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рд╣рдо рдХреЗрдВрджреНрд░ рдореЗрдВ 0.4 рдбрд╛рд▓рддреЗ рд╣реИрдВ, рддреЛ рдордзреНрдп рдореЗрдВ рдпрд╣ 0.6 рд╣реЛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдХрд┐рдирд╛рд░реЗ рдкрд░ рдпрд╣ 0.8 рддрдХ рдкрд╣реБрдВрдЪ рдЬрд╛рдПрдЧрд╛ред рдлрд┐рд░ рд╕реЗрд▓ рдХрдиреЗрдХреНрд╢рди рдореЗрдВ, рдорд╛рди 1 рд╣реЛрдЧрд╛ред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдирджреА рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рдмрд╣рддреА рд╣реИ, рддреЛ рд╣рдо рдЕрднреА рднреА рдХреЗрдВрджреНрд░ рдореЗрдВ 0.4 рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдмреАрдЪ рдореЗрдВ рдпрд╣ 0.2 рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдХрд┐рдирд╛рд░реЗ рдкрд░ - 0. рдпрджрд┐ рд╣рдо рдЗрд╕реЗ рд╕реЗрд▓ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдиреЗ рддрдХ рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдкрд░рд┐рдгрд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ -0.2 рдорд┐рд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рджреЛрд╣рд░рд╛рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдореЛрдб рдХреЗ рд╕рд╛рде рдмрдирд╛рд╡рдЯ рдХреЗ рд▓рд┐рдП 0.8 рдХреЗ рд╕рдорд╛рди рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ 0 1 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22e/4de/cd9/22e4decd99e9c2f0c9312be9eaaceb9a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ V рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрдиред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ </font></font><code>TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдФрд░ рдкреИрд░рд╛рдореАрдЯрд░ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed </span></span></span><span class="hljs-function">)</span></span> { TriangulateRiverQuad(v1, v2, v3, v4, y, y, v, reversed); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed </span></span></span><span class="hljs-function">)</span></span> { тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрдм рджрд┐рд╢рд╛ рдЙрд▓рдЯ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рддреЛ рд╣рдо рдмрд╕ рдЪрддреБрд░реНрднреБрдЬ рдХреЗ рддрд▓ рдкрд░ рд╕рдВрдЪрд░рд┐рдд рд╕рдордиреНрд╡рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╢реАрд░реНрд╖ рдкрд░ 0.2 рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, v, v + <span class="hljs-number"><span class="hljs-number">0.2f</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо 0.8 рдФрд░ 0.6 рд╕реЗ рд╕рдордиреНрд╡рдп рдХреЛ рдШрдЯрд╛рдХрд░ рдПрдХ рдЙрд▓реНрдЯреЗ рджрд┐рд╢рд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reversed) { rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span> - v, <span class="hljs-number"><span class="hljs-number">0.6f</span></span> - v); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рд╕рд╣реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдкреНрд░реЗрд╖рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬреИрд╕реЗ рдХрд┐ рд╣рдо рдПрдХ рдирд┐рд╡рд░реНрддрдорд╛рди рдирджреА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рдереЗред </font><font style="vertical-align: inherit;">рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> TriangulateRiverQuad( centerL, centerR, m.v2, m.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>, reversed ); TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, reversed );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд░ </font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдмрджрд▓реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЕрдВрдд рдореЗрдВ </font></font><code>TriangulateWithRiverBeginOrEnd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, reversed ); center.y = m.v2.y = m.v4.y = cell.RiverSurfaceY; rivers.AddTriangle(center, m.v2, m.v4); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reversed) { rivers.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.2f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.2f</span></span>) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rivers.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/44e/786/63f/44e78663f2d77264660f30917a5e1a94.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдЯреНрд░реЗрдЪреНрдб V рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХред V рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЗ рддрд╣ рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╡реЗ рдирджреА рдХреЗ рдХрд┐рдирд╛рд░реЗ рдореЗрдВ рд╕рдХрд╛рд░рд╛рддреНрдордХ рдмрдиреЗ рд╣реБрдП рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y += <span class="hljs-number"><span class="hljs-number">1</span></span>; } o.Albedo.rg = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aec/30e/a84/aec30ea849af0c8ba42cd6e0cef44635.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдХреБрдЪрд┐рдд рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ V. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА рдХрд╛ рдПрдиреАрдореЗрд╢рди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдирджрд┐рдпреЛрдВ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред рдирджреА рдХрд╛ рдХрд┐рдирд╛рд░рд╛ рдРрд╕рд╛ рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рд╣рдореЗрдВ рд▓рдЧрд╛рддрд╛рд░ рдЬрд╛рд▓ рдХреЛ рдЕрдкрдбреЗрдЯ рди рдХрд░рдирд╛ рдкрдбрд╝реЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ рдПрдХ рдЬрдЯрд┐рд▓ рдирджреА рд╢реЗрдбрд░ рдирд╣реАрдВ рдмрдирд╛рдПрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдмрд╛рдж рдореЗрдВ рдЗрд╕реЗ рдХрд░реЗрдВрдЧреЗред рдЕрднреА рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рд╕рд░рд▓ рдкреНрд░рднрд╛рд╡ рдмрдирд╛рдПрдВрдЧреЗ рдЬреЛ рдЗрд╕ рдмрд╛рдд рдХреА рд╕рдордЭ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдПрдиреАрдореЗрд╢рди рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдиреАрдореЗрд╢рди рдЦреЗрд▓ рдХреЗ рд╕рдордп рдХреЗ рдЖрдзрд╛рд░ рдкрд░ V рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдХреЗ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред рдПрдХрддрд╛ рдЖрдкрдХреЛ рдПрдХ рд╡реИрд░рд┐рдПрдмрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕рдХрд╛ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ </font></font><code>_Time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЗрд╕рдХреЗ рдШрдЯрдХ Y рдореЗрдВ рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╕рдордп рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рд╣рдо рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдЕрдиреНрдп рдШрдЯрдХреЛрдВ рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕рдордп рдХреЗ рдкреИрдорд╛рдиреЗ рд╣реЛрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рд╡реА рдХреЗ рд╕рд╛рде рддрд╣ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛ рд▓реЗрдВрдЧреЗ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рдЕрдм рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рд╡рд░реНрддрдорд╛рди рд╕рдордп рдХреЛ V рд╕рдордиреНрд╡рдп рд╕реЗ рдШрдЯрд╛рддреЗ рд╣реИрдВред рдпрд╣ рд╕рдордиреНрд╡рдп рдХреЛ рдиреАрдЪреЗ рдЧрд┐рд░рд╛ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдирджреА рдХреЗ рдкреНрд░рд╡рд╛рд╣ рдХреЗ рдиреАрдЪреЗ рдмрд╣рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рднреНрд░рдо рдкреИрджрд╛ рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="hljs pgsql">// <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { // <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y += <span class="hljs-number"><span class="hljs-number">1</span></span>; // } <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y -= _Time.y; o.Albedo.rg = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╕реЗрдХрдВрдб рдореЗрдВ, рд╕рднреА рдмрд┐рдВрджреБрдУрдВ рдкрд░ V рд╕рдордиреНрд╡рдп рд╢реВрдиреНрдп рд╕реЗ рдХрдо рд╣реЛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЕрдм рдЕрдВрддрд░ рдирд╣реАрдВ рджреЗрдЦреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╕реЗ, рдмрдирд╛рд╡рдЯ рджреЛрд╣рд░рд╛рдиреЗ рдореЛрдб рдореЗрдВ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╡реА рдХреЗ рдЖрдВрд╢рд┐рдХ рдЕрдВрд╢ рдХреЛ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y -= _Time.y; <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y = frac(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y); o.Albedo.rg = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдирд┐рдореЗрдЯреЗрдб V рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЛрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдорд╛рд░реА рдирджреА рдПрдирд┐рдореЗрдЯреЗрдб рд╣реИ, рд▓реЗрдХрд┐рди рджрд┐рд╢рд╛ рдФрд░ рдЧрддрд┐ рдореЗрдВ рддреЗрдЬ рдмрджрд▓рд╛рд╡ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░рд╛ рдпреВрд╡реА рдкреИрдЯрд░реНрди рдЙрдиреНрд╣реЗрдВ рдмрд╣реБрдд рд╕реНрдкрд╖реНрдЯ рдмрдирд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдЖрдк рдЕрдзрд┐рдХ рдкрд╛рдиреА рдЬреИрд╕реЗ рдкреИрдЯрд░реНрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕реЗ рдкрд╣рдЪрд╛рдирдирд╛ рдХрдард┐рди рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рдХрдЪреНрдЪреЗ рдпреВрд╡реА рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЪрд▓реЛ рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЕрдкрдиреЗ рдореМрдЬреВрджрд╛ рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕рдХрд╛ рдирдореВрдирд╛ рд▓реЗрддреЗ рд╣реИрдВ рдФрд░ рдкрд╣рд▓реЗ рд╢реЛрд░ рдЪреИрдирд▓ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд░рдВрдЧ рдХреЛ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { float2 uv = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex; uv.y -= _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, uv); fixed4 c = _Color * noise.r; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ рдФрд░ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдпрд╣ рд╕рдлреЗрдж рд╣реИред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc8/dd4/e4e/dc8dd4e4ee9b92f2f104ba3107da30ce.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3f/0ca/319/b3f0ca31928fd594a715868ebbb7265c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдмрд╣реБрдд рдлреИрд▓рд╛ рд╣реБрдЖ рд╣реИ, рд╢реЛрд░ рдХреА рдмрдирд╛рд╡рдЯ рдирджреА рдХреЗ рд╕рд╛рде рднреА рдлреИрд▓рддреА рд╣реИред </font><font style="vertical-align: inherit;">рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдкрд╛рдареНрдпрдХреНрд░рдо рдмрд╣реБрдд рд╕реБрдВрджрд░ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ рджреВрд╕рд░реЗ рддрд░реАрдХреЗ рд╕реЗ рдлреИрд▓рд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ - рдпреВ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рдкреИрдорд╛рдиреЗ рдХреЛ рдмрд╣реБрдд рдХрдо рдХрд░реЗрдВред рдПрдХ рд╕реЛрд▓рд╣рд╡реАрдВ рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдХреЗ рдПрдХ рд╕рдВрдХреАрд░реНрдг рдмреИрдВрдб рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="hljs pgsql"> float2 uv = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex; uv.x *= <span class="hljs-number"><span class="hljs-number">0.0625</span></span>; uv.y -= _Time.y;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa9/957/2a9/aa99572a9c0ad3daaa7b5b4eb3978cc0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпреВ рдХреЛ рд╕рдордиреНрд╡рд┐рдд рдХрд░рдирд╛ред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪрд▓реЛ рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб рдПрдХ рдЪреМрдерд╛рдИ рддрдХ рднреА рдзреАрдорд╛ рдХрд░ рджреЗрдВ рддрд╛рдХрд┐ рдмрдирд╛рд╡рдЯ рдЪрдХреНрд░ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдореЗрдВ рдЪрд╛рд░ рд╕реЗрдХрдВрдб рд▓рдЧреЗрдВред</font></font><br><br><pre> <code class="hljs"> uv.y -= _Time.y * 0.25;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рд╢реЛрд░ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЛрд░ рдорд┐рд▓рд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдм рдХреБрдЫ рдкрд╣рд▓реЗ рд╕реЗ рдмрд╣реБрдд рдмреЗрд╣рддрд░ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкреИрдЯрд░реНрди рд╣рдореЗрд╢рд╛ рд╕рдорд╛рди рд░рд╣рддрд╛ рд╣реИред рдкрд╛рдиреА рдЬреИрд╕рд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рд╢реЛрд░ рдХреЗ рдПрдХ рдЫреЛрдЯреЗ рдмреИрдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдмрдирд╛рд╡рдЯ рдХреЗ рд╕рд╛рде рдЗрд╕ рдмреИрдВрдб рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдХреЗ рдкреИрдЯрд░реНрди рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдпреВ рд╕рдордиреНрд╡рдп рдХреЗ рд▓рд┐рдП рд╕рдордп рдЬреЛрдбрд╝рдХрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рдореЗрдВ рдЗрд╕реЗ рдзреАрд░реЗ-рдзреАрд░реЗ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЕрдиреНрдпрдерд╛ рдирджреА рдмрдЧрд╝рд▓ рдореЗрдВ рдмрд╣рддреА рдкреНрд░рддреАрдд рд╣реЛрдЧреАред рдЪрд▓реЛ 0.005 рдХреЗ рдЧреБрдгрд╛рдВрдХ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдкреИрдЯрд░реНрди рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдореЗрдВ 200 рд╕реЗрдХрдВрдб рд▓рдЧрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs markdown"> uv.x = uv.x <span class="hljs-bullet"><span class="hljs-bullet">* 0.0625 + _Time.y *</span></span> 0.005;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓рддреА рд╣реБрдИ рдЖрд╡рд╛рдЬред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдпрд╣ рдмрд╣реБрдд рд╕реБрдВрджрд░ рдирд╣реАрдВ рджрд┐рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкрд╛рдиреА рдЕрднреА рднреА рд╕реНрдерд┐рд░ рд╣реИ рдФрд░ рдмрджрд▓рд╛рд╡ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдмрд╣реБрдд рдзреАрдорд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рджреЛ рд╢реЛрд░ рдирдореВрдиреЛрдВ рдХреЗ рд╕рдВрдпреЛрдЬрди рд╕реЗ рдмрджрд▓рд╛рд╡ рдХреЛ рдЫрд┐рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рдЕрдЧрд░ рд╣рдо рджреВрд╕рд░реЗ рдирдореВрдиреЗ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рдорд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдкрд░рд┐рд╡рд░реНрддрди рдХрд╛ рдПрдХ рд╣рд▓реНрдХрд╛ рдПрдиреАрдореЗрд╢рди рдмрдирд╛рдПрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╣рдо рдХрднреА рднреА рдПрдХ рд╣реА рд╢реЛрд░ рдкреИрдЯрд░реНрди рдХреЛ рдУрд╡рд░рд▓реИрдк рди рдХрд░реЗрдВ, рд╣рдо рджреВрд╕рд░реЗ рдирдореВрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдЪреИрдирд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"> float2 uv = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex; uv.x = uv.x * <span class="hljs-number"><span class="hljs-number">0.0625</span></span> + _Time.y * <span class="hljs-number"><span class="hljs-number">0.005</span></span>; uv.y -= _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, uv); float2 uv2 = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex; uv2.x = uv2.x * <span class="hljs-number"><span class="hljs-number">0.0625</span></span> - _Time.y * <span class="hljs-number"><span class="hljs-number">0.0052</span></span>; uv2.y -= _Time.y * <span class="hljs-number"><span class="hljs-number">0.23</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(_MainTex, uv2); fixed4 c = _Color * (noise.r * noise2.a);</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рд╢реЛрд░ рдкреИрдЯрд░реНрди рдХрд╛ рдПрдХ рд╕рдВрдпреЛрдЬрдиред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛рд░рднрд╛рд╕реА рдЬрд▓ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░рд╛ рдкреИрдЯрд░реНрди рдХрд╛рдлреА рдЧрддрд┐рд╢реАрд▓ рджрд┐рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛ рдХрджрдо рдЗрд╕реЗ рдкрд╛рд░рднрд╛рд╕реА рдмрдирд╛рдирд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдкрд╛рдиреА рдЫрд╛рдпрд╛ рдирд╣реАрдВ рдбрд╛рд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рдЙрдиреНрд╣реЗрдВ рдкреНрд░реАрдлрд╝реИрдм рдореЗрдВ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд░реЗрдВрдбрд░рд░ рдШрдЯрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a61/894/e14/a61894e14d9999315d59b5ff0c0de517.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫрд╛рдпрд╛ рдХрд╛рд╕реНрдЯрд┐рдВрдЧ рдЕрдХреНрд╖рдо рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм shader рдХреЛ рдкрд╛рд░рджрд░реНрд╢реА рдореЛрдб рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, shader рдЯреИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдлрд┐рд░ </font></font><code>#pragma surface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреАрд╡рд░реНрдб </font><font style="vertical-align: inherit;">рдХреЛ рд▓рд╛рдЗрди рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ </font></font><code>alpha</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬрдм рд╣рдо рдпрд╣рд╛рдВ рд╣реИрдВ, рддреЛ рдЖрдк рдХреАрд╡рд░реНрдб рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>fullforwardshadows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдЕрднреА рднреА рдЫрд╛рдпрд╛ рдирд╣реАрдВ рдбрд╛рд▓рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs cs"> Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>=<span class="hljs-string"><span class="hljs-string">"Transparent"</span></span> <span class="hljs-string"><span class="hljs-string">"Queue"</span></span>=<span class="hljs-string"><span class="hljs-string">"Transparent"</span></span> } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf Standard alpha // fullforwardshadows #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> target 3.0</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдирджреА рдХреЗ рд░рдВрдЧ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЛ рдмрджрд▓ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╢реЛрд░ рдХреЛ рд░рдВрдЧ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдЙрд╕рдореЗрдВ рд╢реЛрд░ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣рдо </font></font><code>saturate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди </font><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ 1 рд╕реЗ рдЕрдзрд┐рдХ рди рд╣реЛред</font></font><br><br><pre> <code class="hljs swift"> fixed4 <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = saturate(_Color + noise.r * noise2.a);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╣рдореЗрдВ рдЖрдзрд╛рд░ рд░рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рднреМрддрд┐рдХ рд░рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╢реЛрд░ рдЗрд╕рдХреА рдЪрдордХ рдФрд░ рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рдХреЛ рдмрдврд╝рд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ рдиреАрд▓реА рд░рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рдХрд╛рдлреА рдХрдо рдЕрдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рд╣реЛред </font><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рд╣рдореЗрдВ рд╕рдлреЗрдж рдЫреАрдВрдЯреЛрдВ рдХреЗ рд╕рд╛рде рдиреАрд▓рд╛ рдкрд╛рд░рднрд╛рд╕реА рдкрд╛рдиреА рдорд┐рд▓рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af8/3f7/5a1/af83f75a143aabdd3b83525e4114fc3b.png"></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рдВрдЧреАрди рдкрд╛рд░рднрд╛рд╕реА рдЬрд▓ред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреБрдирд░реНрдирд┐рдорд╛рдг </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдм рд╕рдм рдХреБрдЫ рдХрд╛рдо рдХрд░рдиреЗ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рдпрд╣ рд╕рдордп рд╣реИ рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рд╡рд┐рдХреГрдд рдХрд░рдиреЗ рдХрд╛ред </font><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рд╡рд┐рдХреГрдд рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рд╣рдорд╛рд░реА рдирджрд┐рдпреЛрдВ рдХреЛ рдЕрд╕рдорд╛рди рдмрдирд╛ рджреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cellPerturbStrength = <span class="hljs-number"><span class="hljs-number">4f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c8/ff5/96b/8c8ff596bc247be79a30122e49ca27f5.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ca/664/808/6ca66480859e94d00e2e558caa17cbf4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдХреГрдд рдФрд░ рд╡рд┐рдХреГрдд рдЪреЛрдЯрд┐рдпрд╛рдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдХреГрддрд┐ рдХреЗ рдХрд╛рд░рдг рдЙрддреНрдкрдиреНрди рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЗрд▓рд╛рдХреЗ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рд▓рдЧрддрд╛ рд╣реИ рдЬреИрд╕реЗ рд╡реЗ рд╣реИрдВ! </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рд▓рдВрдмреЗ рдЭрд░рдиреЗ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df1/95b/a33/df195ba33947744e97173412373f5ad4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрдЯреНрдЯрд╛рдиреЛрдВ рджреНрд╡рд╛рд░рд╛ рдХрд╛рдЯреЗ рдЧрдП рдкрд╛рдиреАред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рдКрдВрдЪреЗ рдЭрд░рдиреЗ рд╕реЗ рдЧрд┐рд░рдиреЗ рд╡рд╛рд▓рд╛ рдкрд╛рдиреА рдПрдХ рдЪрдЯреНрдЯрд╛рди рдХреЗ рдкреАрдЫреЗ рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рдЬрдм рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдмрд╣реБрдд рд╣реА рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╣реБрдд рдХрдо рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдЭрд░рдиреЗ рд╕реАрдзреЗ рдиреАрдЪреЗ рдЙрддрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдврд▓рд╛рди рд╡рд╛рд▓реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдореЗрдВ рдкрд╛рдиреА рдЙрд╕ рддрд░рд╣ рдирд╣реАрдВ рдмрд╣рддрд╛ рд╣реИ, рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реИред рд╣рдорд╛рд░рд╛ рдорд╕реНрддрд┐рд╖реНрдХ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░реЗрдЧрд╛ рдХрд┐ рдпрд╣ рд╣рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рд▓рдЧрддрд╛ рд╣реИред рддреЛ рдмрд╕ рдЗрд╕реЗ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд░реЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдиреА рдХреА рдХрдореА рд╕реЗ рдмрдЪрдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ рдирджреА рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдЧрд╣рд░рд╛ рдХрд░рдирд╛ред рдЗрд╕рд▓рд┐рдП рд╣рдо рдкрд╛рдиреА рдХреА рд╕рддрд╣ рдФрд░ рдирджреА рдХреЗ рдмрд┐рд╕реНрддрд░ рдХреЗ рдмреАрдЪ рдЕрдзрд┐рдХ рдЬрдЧрд╣ рдмрдирд╛рдПрдВрдЧреЗред рдпрд╣ рдЪреИрдирд▓ рдХреА рджреАрд╡рд╛рд░реЛрдВ рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рдмрдирд╛ рджреЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдмрд╣реБрдд рдЧрд╣рд░рд╛рдИ рддрдХ рди рдЬрд╛рдПрдВред рдЪрд▓реЛ рдкреВрдЫрддреЗ рд╣реИрдВ</font></font><code>HexMetrics.streamBedElevationOffset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рди -1.75ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдереЛрдХ рдХреЛ рд╣рд▓ рдХрд░реЗрдЧрд╛, рдФрд░ рдмрд┐рд╕реНрддрд░ рдмрд╣реБрдд рдЧрд╣рд░рд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдкрд╛рдиреА рдХрд╛ рдПрдХ рд╣рд┐рд╕реНрд╕рд╛ рдЕрднреА рднреА рдХрд╛рдЯ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдкреВрд░реЗ рдЭрд░рдиреЗ рдирд╣реАрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> streamBedElevationOffset = <span class="hljs-number"><span class="hljs-number">-1.75f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/57b/80c/d26/57b80cd2687ff6afb9be83176e984b7d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд╣рд░рд╛рдИ рд╕реЗ рдЪреИрдирд▓ред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 7: рд╕рдбрд╝рдХреЗрдВ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХ рд╕рдорд░реНрдерди рдЬреЛрдбрд╝реЗрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХ рдХреЛ рддреНрд░рд┐рдХреЛрдгрд┐рдд рдХрд░реЗрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рд╕рдбрд╝рдХреЛрдВ рдФрд░ рдирджрд┐рдпреЛрдВ рдХреЛ рдорд┐рд▓рд╛рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХреЛрдВ рдХреА рд╕реВрд░рдд рд╕реБрдзрд╛рд░рдирд╛ред </font></font></li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f7/b24/05e/9f7b2405e5ceed9842cc1ebd7b549b0a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреНрдпрддрд╛ рдХреЗ рдкрд╣рд▓реЗ рд▓рдХреНрд╖рдгред</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд╕рд╛рде рд╕реЗрд▓ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреА рддрд░рд╣, рд╕рдбрд╝рдХреЗрдВ рд╕реЗрд▓ рд╕реЗ рд╕реЗрд▓ рддрдХ рдЬрд╛рддреА рд╣реИрдВ, рд╕реЗрд▓ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдмреАрдЪ рд╕реЗ рд╣реЛрдХрд░ рдЬрд╛рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдмрдбрд╝рд╛ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рд╕рдбрд╝рдХреЛрдВ рдкрд░ рдкрд╛рдиреА рдирд╣реАрдВ рдмрд╣ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡реЗ рдЕрдкреНрд░рддреНрдпрдХреНрд╖ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХрд╛рд░реНрдпрд╛рддреНрдордХ рд╕рдбрд╝рдХ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд▓рд┐рдП рдЪреМрд░рд╛рд╣реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдкреНрд░рддрд┐ рд╕реЗрд▓ рджреЛ рд╕реЗ рдЕрдзрд┐рдХ рд╕рдбрд╝рдХреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рд╕рдбрд╝рдХреЛрдВ рдХреЛ рд╕рднреА рдЫрд╣ рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рдЬрд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ, рддреЛ рд╕реЗрд▓ рд╢реВрдиреНрдп рд╕реЗ рдЫрд╣ рд╕рдбрд╝рдХреЛрдВ рддрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдХреБрд▓ рдЪреМрджрд╣ рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдбрд╝рдХ рд╡рд┐рдиреНрдпрд╛рд╕ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдкрд╛рдВрдЪ рд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╡ рдирджреА рд╡рд┐рдиреНрдпрд╛рд╕ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЕрдзрд┐рдХ рд╕рд╛рдорд╛рдиреНрдп рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рд╕рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╕рдВрднрд╛рд▓ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d46/965/5b7/d469655b7efdbab33a6cac1c42e61a7e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14 рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдбрд╝рдХ рд╡рд┐рдиреНрдпрд╛рд╕ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХ рдХреА рдЯреНрд░реИрдХрд┐рдВрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рдореЗрдВ рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рд╕рд░рд▓ рддрд░реАрдХрд╛ рдмреВрд▓рд┐рдпрди рдореВрд▓реНрдпреЛрдВ рдХреА рдПрдХ рд╕рд░рдгреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рд░рдгреА рдХреЗ рдирд┐рдЬреА рдХреНрд╖реЗрддреНрд░ рдХреЛ рдЗрд╕рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ рдХреНрд░рдордмрджреНрдз рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЗрд╕реЗ рдирд┐рд░реАрдХреНрд╖рдХ рдореЗрдВ рджреЗрдЦ рд╕рдХреЗрдВред </font><font style="vertical-align: inherit;">рд╕реЗрд▓ рдкреНрд░реАрдлреИрдм рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд░рдгреА рдХрд╛ рдЖрдХрд╛рд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдЫрд╣ рд╕рдбрд╝рдХреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗред</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">SerializeField</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[] roads;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/439/167/2c4/4391672c4c1de9075138eef3f1cafd73.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫрд╣ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд╕рд╛рде Prefab рд╕реЗрд▓ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВ рдХрд┐ рдХреНрдпрд╛ рд╕реЗрд▓ рдореЗрдВ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рджрд┐рд╢рд╛ рдореЗрдВ рдПрдХ рд░рд╛рд╕реНрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasRoadThroughEdge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдЬрд╛рдирдирд╛ рднреА рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрдЧрд╛ рдХрд┐ рд╕реЗрд▓ рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рдПрдХ рд╕рдбрд╝рдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдмрд╕ рд▓реВрдк рдореЗрдВ рдПрд░реЗ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдЬрд╛рдПрдВ рдФрд░ </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреИрд╕реЗ рд╣реА рд╣рдореЗрдВ рд░рд╛рд╕реНрддрд╛ рдорд┐рд▓реЗ, </font><font style="vertical-align: inherit;">рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рдПрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╕рдбрд╝рдХреЗрдВ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рд╡рд╛рдкрд╕ рд▓реМрдЯреЗрдВ </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HasRoads { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; roads.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХ рд╣рдЯрд╛рдиреЗ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдо рд╕реЗрд▓ рд╕реЗ рд╕рднреА рд╕рдбрд╝рдХреЛрдВ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рд▓реВрдк рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╣рд░ рд╕рдбрд╝рдХ рдХреЛ рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рд╕рдХреНрд╖рдо рдерд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRoads</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; neighbors.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i]) { roads[i] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмреЗрд╢рдХ, рд╣рдореЗрдВ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдореЗрдВ рднреА рдЗрд╕реА рдорд╣рдВрдЧреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i]) { roads[i] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbors[i].roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((HexDirection)i).Opposite()] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрд▓ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╕рдбрд╝рдХреЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдиреАрдп рд╣реИрдВ, рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЗ рдмрд┐рдирд╛ рдХреЗрд╡рд▓ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i]) { roads[i] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbors[i].roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((HexDirection)i).Opposite()] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; neighbors[i].RefreshSelfOnly(); RefreshSelfOnly(); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХреЗрдВ рдЬреЛрдбрд╝рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╕рдбрд╝рдХреЛрдВ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдВрддрд░ рдХреЗрд╡рд▓ рдЗрддрдирд╛ рд╣реИ рдХрд┐ рд╣рдо рдмреВрд▓рд┐рдпрди рдХреЛ рдПрдХ рдореВрд▓реНрдп рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдирд╣реАрдВ </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рдирд┐рдЬреА рд╡рд┐рдзрд┐ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рджреЛрдиреЛрдВ рд╕рдВрдЪрд╛рд▓рди рдХрд░ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╕рдбрд╝рдХ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдФрд░ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction]) { SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRoads</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; neighbors.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i]) { SetRoad(i, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state</span></span></span><span class="hljs-function">)</span></span> { roads[index] = state; neighbors[index].roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((HexDirection)index).Opposite()] = state; neighbors[index].RefreshSelfOnly(); RefreshSelfOnly(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдПрдХ рд╣реА рджрд┐рд╢рд╛ рдореЗрдВ рдПрдХ рдирджреА рдФрд░ рд╕рдбрд╝рдХ рджреЛрдиреЛрдВ рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддреЗред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╕рдбрд╝рдХ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдЬрд╛рдВрдЪ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдХреНрдпрд╛ рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдЬрдЧрд╣ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] &amp;&amp; !HasRiverThroughEdge(direction)) { SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЪрдЯреНрдЯрд╛рдиреЛрдВ рд╕реЗ рдирд╣реАрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдмрд╣реБрдд рддреЗрдЬ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╛ рд╢рд╛рдпрдж рдпрд╣ рдПрдХ рдХрдо рдЪрдЯреНрдЯрд╛рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдорд╛рд░реНрдЧ рдкреНрд░рд╢рд╕реНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд╛рдпрдХ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдЙрдЪреНрдЪ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд╣реАрдВ? </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдРрд╕реА рд╡рд┐рдзрд┐ рдмрдирд╛рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рд╣реИ рдЬреЛ рд╣рдореЗрдВ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рджрд┐рд╢рд╛ рдореЗрдВ рдКрдБрдЪрд╛рдИ рдХрд╛ рдЕрдВрддрд░ рдмрддрд╛рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetElevationDifference</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> difference = elevation - GetNeighbor(direction).elevation; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> difference &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ? difference : -difference; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдкрд░реНрдпрд╛рдкреНрдд рдКрдБрдЪрд╛рдИ рдХреЗ рдЕрдВрддрд░ рдкрд░ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдореИрдВ рдЦреБрдж рдХреЛ рдХреЗрд╡рд▓ рдврд▓рд╛рди рддрдХ рд╕реАрдорд┐рдд рдХрд░реВрдВрдЧрд╛, рдпрд╛рдиреА рдЕрдзрд┐рдХрддрдо 1 рдпреВрдирд┐рдЯред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] &amp;&amp; !HasRiverThroughEdge(direction) &amp;&amp; GetElevationDifference(direction) &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ) { SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЧрд▓рдд рд░рд╛рд╕реНрддреЛрдВ рдХреЛ рд╣рдЯрд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рдЕрдиреБрдореЗрдп рд╣реЛрдиреЗ рдкрд░ рд╣реА рд╕рдбрд╝рдХреЗрдВ рдмрдирд╛рдИрдВред </font><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдЕрдЧрд░ рдмрд╛рдж рдореЗрдВ рд╡реЗ рдЧрд▓рдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ рддреЛ рдЙрдиреНрд╣реЗрдВ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬрдм рдПрдХ рдирджреА рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдКрдкрд░ рдирджрд┐рдпреЛрдВ рдХреЗ рдирд┐рдпреЛрдЬрди рдкрд░ рд░реЛрдХ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╕рдбрд╝рдХреЛрдВ рдкрд░ рдирджрд┐рдпреЛрдВ рдХреЛ рдмрд╛рдзрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рд░рд╛рд╕реНрддреЗ рд╕реЗ рд╣рдЯрдиреЗ рджреЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ рдХрд┐ рд╣рдо рд╕рдбрд╝рдХ рдХреЗ рд▓рд┐рдП рдХрд╣реЗрдВ </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЪрд╛рд╣реЗ рд╕рдбрд╝рдХ рдХреЛрдИ рднреА рд╣реЛред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рджреЛрдиреЛрдВ рд╕реЗрд▓ рд╣рдореЗрд╢рд╛ рдЕрдкрдбреЗрдЯ рд░рд╣реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЕрдм рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ </font></font><code>RefreshSelfOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИ </font></font><code>SetOutgoingRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasOutgoingRiver &amp;&amp; outgoingRiver == direction) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } HexCell neighbor = GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!neighbor || elevation &lt; neighbor.elevation) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } RemoveOutgoingRiver(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasIncomingRiver &amp;&amp; incomingRiver == direction) { RemoveIncomingRiver(); } hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; outgoingRiver = direction; <span class="hljs-comment"><span class="hljs-comment">// RefreshSelfOnly(); neighbor.RemoveIncomingRiver(); neighbor.hasIncomingRiver = true; neighbor.incomingRiver = direction.Opposite(); // neighbor.RefreshSelfOnly(); SetRoad((int)direction, false); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдФрд░ рдСрдкрд░реЗрд╢рди рдЬреЛ рд╕рдбрд╝рдХ рдХреЛ рдЧрд▓рдд рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рд╡рд╣ рд╣реИ рдКрдБрдЪрд╛рдИ рдореЗрдВ рдмрджрд▓рд╛рд╡ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдореЗрдВ рд╕рднреА рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рд╕рдбрд╝рдХреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдКрдВрдЪрд╛рдИ рдЕрдВрддрд░ рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╣реИ, рддреЛ рдореМрдЬреВрджрд╛ рд╕рдбрд╝рдХ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; roads.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roads[i] &amp;&amp; GetElevationDifference((HexDirection)i) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { SetRoad(i, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } Refresh(); } }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХ рдХрд╛ рд╕рдВрдкрд╛рджрди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрд╛рджрди рд╕рдбрд╝рдХреЗрдВ рдирджрд┐рдпреЛрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рддрд░рд╣ рд╣реА рдХрд╛рдо рдХрд░рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдПрдХ рдФрд░ рд╕реНрд╡рд┐рдЪ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рдЗрд╕рдХреЗ рд░рд╛рдЬреНрдп рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ред</font></font><br><br><pre> <code class="cs hljs"> OptionalToggle riverMode, roadMode; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRiverMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mode</span></span></span><span class="hljs-function">)</span></span> { riverMode = (OptionalToggle)mode; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRoadMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mode</span></span></span><span class="hljs-function">)</span></span> { roadMode = (OptionalToggle)mode; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╡рд┐рдзрд┐ </font></font><code>EditCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдЕрдм рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд╕рд╛рде рд╣рдЯрд╛рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдЦреАрдВрдЪрдиреЗ рдФрд░ рдЫреЛрдбрд╝рдиреЗ рдкрд░ рд╡рд╣ рджреЛ рд╕рдВрднрд╛рд╡рд┐рдд рдХреНрд░рд┐рдпрд╛рдУрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдХреЛрдб рдХреЛ рдереЛрдбрд╝рд╛ рдкреБрдирд░реНрдЧрдарди рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╕рд╣реА рдбреНрд░реИрдЧ рдФрд░ рдбреНрд░реЙрдк рдХреЛ рд▓реЗ рдЬрд╛рдиреЗ рдкрд░, рджреЛрдиреЛрдВ рд╕реНрд╡рд┐рдЪ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рд╣реЛред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (riverMode == OptionalToggle.No) { cell.RemoveRiver(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roadMode == OptionalToggle.No) { cell.RemoveRoads(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDrag) { HexCell otherCell = cell.GetNeighbor(dragDirection.Opposite()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherCell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (riverMode == OptionalToggle.Yes) { otherCell.SetOutgoingRiver(dragDirection); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roadMode == OptionalToggle.Yes) { otherCell.AddRoad(dragDirection); } } } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдирджреА рдкрдЯреНрдЯреА рдХреЛ рдХреЙрдкреА рдХрд░рдХреЗ рдФрд░ рд╕реНрд╡рд┐рдЪреЗрд╕ рджреНрд╡рд╛рд░рд╛ рдмреБрд▓рд╛рдП рдЧрдП рддрд░реАрдХреЗ рдХреЛ рдмрджрд▓рдХрд░ рдпреВрдЖрдИ рдореЗрдВ рд╕рдбрд╝рдХ рдкрдЯреНрдЯреА рдХреЛ рдЬрд▓реНрджреА рд╕реЗ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рд╣рдо рдПрдХ рдмрд╣реБрдд рд╣реА рдЙрдЪреНрдЪ рдпреВрдЖрдИ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдЕрдзрд┐рдХ рдХреЙрдореНрдкреИрдХреНрдЯ рд╕рдбрд╝рдХ рдФрд░ рдирджреА рдкреИрдирд▓реЛрдВ рдХреЛ рдлрд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рдВрдЧ рдкреИрдирд▓ рд▓реЗрдЖрдЙрдЯ рдХреЛ рдмрджрд▓ рджрд┐рдпрд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fd/de5/a8a/0fdde5a8a4abc86308b771f43b36bf4a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд╕рд╛рде рдпреВрдЖрдИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЕрдм рдореИрдВ рд░рдВрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рддреАрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рджреЛ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ, рддреЛ рджреВрд╕рд░реЗ рд░рдВрдЧ рдХреЗ рд▓рд┐рдП рдЬрдЧрд╣ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдирд╛рд░рдВрдЧреА рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрдЗрдЯрдо рдЬреЛрдбрд╝рд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a06/9c6/08d/a069c608dfe531a5e1b2a8c59fef5846.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e96/12a/499/e9612a49993e3a2d4cb20790186ecf02.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдВрдЪ рд░рдВрдЧ: рдкреАрд▓рд╛, рд╣рд░рд╛, рдиреАрд▓рд╛, рдирд╛рд░рдВрдЧреА рдФрд░ рд╕рдлреЗрджред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рд╕рдбрд╝рдХреЛрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рд╡реЗ рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗ рд░рд╣реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЖрдк рдирд┐рд░реАрдХреНрд╖рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╕рдм рдХреБрдЫ рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/160/c4f/0e4/160c4f0e496acec2a2a2d739152a7cfa.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░реАрдХреНрд╖рдХ рдореЗрдВ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд╕рд╛рде рд╕реЗрд▓ред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХ рдХрд╛ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рддреНрд░рд┐рдХреЛрдгрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдирджрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЬрд╛рд▓ рдмрдирд╛рдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реИ, рдХреЗрд╡рд▓ рдирджреА рдХреЗ рдХрд┐рдирд╛рд░реЗ рд░рд╛рд╣рдд рдореЗрдВ рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдПрдХ рдирдпрд╛ рдорд╛рдирдХ рд╢реЗрдбрд░ рдмрдирд╛рдПрдВ рдЬреЛ рд╕рдбрд╝рдХ рдХреА рд╕рддрд╣ рдХреЛ рдЪрд┐рддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд┐рд░ рд╕реЗ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред</font></font><br><br><pre> <code class="hljs pgsql">Shader "Custom/Road" { Properties { _Color ("Color", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex ("Albedo (RGB)", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Glossiness ("Smoothness", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> _Metallic ("Metallic", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> } SubShader { Tags { "RenderType"="Opaque" } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM #pragma surface surf Standard fullforwardshadows #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; }; half _Glossiness; half _Metallic; fixed4 _Color; <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = fixed4(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; } ENDCG } FallBack "Diffuse" }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕ shader рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╕рдбрд╝рдХ рд╕рд╛рдордЧреНрд░реА рдмрдирд╛рдПрдБред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/973/9e3/2b8/9739e32b82ad2148c559b8f7c4caa868.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдордЧреНрд░реА рд╕рдбрд╝рдХред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреБрдХрдбрд╝реЗ рдХреЗ рдкреНрд░реАрдлрд╝реИрдм рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЙрд╕реЗ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реЗрдХреНрд╕рд╛рдЧреЛрди рдХрд╛ рдПрдХ рдФрд░ рдмрдЪреНрдЪрд╛ рдЬрд╛рд▓ рдкреНрд░рд╛рдкреНрдд рд╣реЛред </font><font style="vertical-align: inherit;">рдЗрд╕ рдЬрд╛рд▓ рдХреЛ рдЫрд╛рдпрд╛ рдирд╣реАрдВ рдбрд╛рд▓рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдХреЗрд╡рд▓ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рддреЗрдЬрд╝ рддрд░реАрдХрд╛ рдкреНрд░реАрдлрд╝реИрдм рдЙрджрд╛рд╣рд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реИ - </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреА</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╕реНрддреБ рдХреА рдирдХрд▓ рдХрд░рдирд╛ </font><font style="vertical-align: inherit;">рдФрд░ рдЙрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдмрджрд▓рдирд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf8/476/a9e/bf8476a9e950a13c69051a5cd43480c1.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a64/4d8/776/a644d8776f3c6f0ba64cf3aef666f475.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рд▓ рд╡рд╕реНрддреБ рд╕рдбрд╝рдХреЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рдлрд╝реАрд▓реНрдб рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexMesh roads</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ </font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдЗрдВрд╕реНрдкреЗрдХреНрдЯрд░ рдореЗрдВ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдбреНрд╕</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a95/c0e/c2a/a95c0ec2ae59dccbb249e6a02ccdc7c5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдбреНрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдХреА рд╕рдбрд╝рдХреЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕рдбрд╝рдХ рдЦрдВрдбреЛрдВ рдХреЛ рджреЗрдЦреЗрдВред </font><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреА рддрд░рд╣, рд╕рдбрд╝рдХреЛрдВ рдХреЛ рджреЛ рдордзреНрдпрдо рдХреНрд╡рд╛рдб рджреНрд╡рд╛рд░рд╛ рдмрдВрдж рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрди рдХрдиреЗрдХреНрд╢рди рдХреНрд╡рд╛рдбреНрд░рд╛рдВрдЧрд▓реНрд╕ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдбрд╝рдХ рдХреЗ рдЪрддреБрд░реНрднреБрдЬреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╡рд░ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдПрдХ рд╣реА рдЫрд╣ рдЪреЛрдЯрд┐рдпреЛрдВ рдХреА рд╕реНрдерд┐рддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font></font><code>TriangulateRoadSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, Vector3 v5, Vector3 v6 </span></span></span><span class="hljs-function">)</span></span> { roads.AddQuad(v1, v2, v4, v5); roads.AddQuad(v2, v3, v5, v6); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдореЗрдВ рдЕрдм рдкрд╛рдиреА рдХреЗ рдкреНрд░рд╡рд╛рд╣ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡реА рд╕рдордиреНрд╡рдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рд╣рд░ рдЬрдЧрд╣ 0 рдорд╛рди рджреЗрддреЗ рд╣реИрдВред рд╣рдо рдпреВ рд╕рдордиреНрд╡рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╣рдо рд╕рдбрд╝рдХ рдХреЗ рдмреАрдЪ рдпрд╛ рдХрд┐рдирд╛рд░реЗ рдкрд░ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдмреАрдЪ рдореЗрдВ 1 рдХреЗ рдмрд░рд╛рдмрд░ рдФрд░ рджреЛрдиреЛрдВ рддрд░рдл 0 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдиреЗ рджреЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, Vector3 v5, Vector3 v6 </span></span></span><span class="hljs-function">)</span></span> { roads.AddQuad(v1, v2, v4, v5); roads.AddQuad(v2, v3, v5, v6); roads.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); roads.AddQuadUV(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26a/730/868/26a73086896099b06098de0a25eb63ae.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕рдбрд╝рдХ рдХрд╛ рдПрдХ рдЦрдВрдбред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдкрджреНрдзрддрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рддрд░реНрдХрд╕рдВрдЧрдд рд╣реЛрдЧрд╛ </font></font><code>TriangulateEdgeStrip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдЕрдЧрд░ рд╡рд╣рд╛рдБ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХ рд╕рдбрд╝рдХ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдзрд┐ рдореЗрдВ рдПрдХ рдмреВрд▓рд┐рдпрди рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color c1, EdgeVertices e2, Color c2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдЕрдм рд╣рдо рд╕рдВрдХрд▓рдХ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗ, рдХреНрдпреЛрдВрдХрд┐ рдЕрднреА рддрдХ рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдЕрднреА рддрдХ рдкреНрд░рд╕рд╛рд░рд┐рдд рдирд╣реАрдВ рд╣реБрдИ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рднреА рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЕрдВрддрд┐рдо рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ, рдХреЙрд▓ </font></font><code>TriangulateEdgeStrip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╣рдо рдпрд╣ рднреА рдШреЛрд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рдмрд░рд╛рдмрд░ рд╣реИ </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рдкреИрд░рд╛рдореАрдЯрд░ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рд╕рдВрдХрд▓рди рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рдПрдВрдЧреАред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color c1, EdgeVertices e2, Color c2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { тАж }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реИрдХрд▓реНрдкрд┐рдХ рдкреИрд░рд╛рдореАрдЯрд░ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ?</font></font></b> <div class="spoiler_text">        ,   . ,  <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyMethod</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y; }</code> </pre> <br>    <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyMethod</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyMethod</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MyMethod(x, <span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyMethod</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MyMethod(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}; }</code> </pre> <br>   .      .    .      . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рдХреЛ рддреНрд░рд┐рднреБрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font></font><code>TriangulateRoadSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ </font><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ </font><font style="vertical-align: inherit;">рдордзреНрдп рдЫрд╣ рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">рдХреЙрд▓ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color c1, EdgeVertices e2, Color c2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { terrain.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); terrain.AddQuadColor(c1, c2); terrain.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); terrain.AddQuadColor(c1, c2); terrain.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); terrain.AddQuadColor(c1, c2); terrain.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); terrain.AddQuadColor(c1, c2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRoad) { TriangulateRoadSegment(e1.v2, e1.v3, e1.v4, e2.v2, e2.v3, e2.v4); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдлреНрд▓реИрдЯ рд╕реЗрд▓ рдХрдиреЗрдХреНрд╢рди рдХреИрд╕реЗ рд╕рдВрднрд╛рд▓рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЛрдВ рдкрд░ рд╕рдбрд╝рдХреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдпрд╣ рднреА рдмрддрд╛рдирд╛ рд╣реЛрдЧрд╛ </font></font><code>TriangulateEdgeTerraces</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐ рд╕рдбрд╝рдХ рдХреЛ рдХрд╣рд╛рдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд╡рд╣ рдмрд╕ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд╡реНрдпрдХреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ </font></font><code>TriangulateEdgeStrip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeTerraces</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices begin, HexCell beginCell, EdgeVertices end, HexCell endCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e2 = EdgeVertices.TerraceLerp(begin, end, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color c2 = HexMetrics.TerraceLerp(beginCell.Color, endCell.Color, <span class="hljs-number"><span class="hljs-number">1</span></span>); TriangulateEdgeStrip(begin, beginCell.Color, e2, c2, hasRoad); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; HexMetrics.terraceSteps; i++) { EdgeVertices e1 = e2; Color c1 = c2; e2 = EdgeVertices.TerraceLerp(begin, end, i); c2 = HexMetrics.TerraceLerp(beginCell.Color, endCell.Color, i); TriangulateEdgeStrip(e1, c1, e2, c2, hasRoad); } TriangulateEdgeStrip(e2, c2, end, endCell.Color, hasRoad); }</code> </pre> <br> <code>TriangulateEdgeTerraces</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрджрд░ рдмреБрд▓рд╛рдпрд╛ </font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдпрд╣рд╛рдВ рд╣реИ рдХрд┐ рд╣рдо рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╡рд░реНрддрдорд╛рди рджрд┐рд╢рд╛ рдореЗрдВ рдПрдХ рд╕рдбрд╝рдХ рдЬрд╛ рд░рд╣реА рд╣реИ, рджреЛрдиреЛрдВ рдЬрдм рдПрдХ рдХрд┐рдирд╛рд░реЗ рдкрд░ рддреНрд░рд┐рдХреЛрдгреАрдп рдФрд░ рдЬрдм рддреНрд░рд┐рдХреЛрдгреАрдп рд╕реАрдврд╝рд┐рдпрд╛рдВ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces( e1, cell, e2, neighbor, cell.HasRoadThroughEdge(direction) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeStrip( e1, cell.Color, e2, neighbor.Color, cell.HasRoadThroughEdge(direction) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7a/67d/e7d/d7a67de7d2edeb2d23b63e9b37bc7508.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕рдбрд╝рдХ рдЦрдВрдбред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рддрд┐рдкрд╛рджрди рдкрд░ рд╕реЗрд▓ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЗрдВ рдмрдирд╛рддреЗ рд╕рдордп, рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рд╕рдбрд╝рдХ рдЦрдВрдб рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВред рдЗрди рдЦрдВрдбреЛрдВ рдХреЗ рдордзреНрдп рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдиреАрд▓реЗ рд░рдВрдЧ рдХреЗ рд╕рдВрдХреНрд░рдордг рдХреЗ рд╕рд╛рде рдмреИрдВрдЧрдиреА рд╣реЛрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЬрдм рдЖрдк рдХреИрдорд░рд╛ рд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рд╕реЗрдЧрдореЗрдВрдЯ рдЭрд┐рд▓рдорд┐рд▓рд╛рдиреЗ рд▓рдЧрддреЗ рд╣реИрдВ, рдФрд░ рдХрднреА-рдХрднреА рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рддреНрд░рд┐рдХреЛрдг рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд▓рд╛рдХреЗ рдХреЗ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреЛ рдУрд╡рд░рд▓реИрдк рдХрд░рддреЗ рд╣реИрдВред рдкреНрд░рддрд┐рдкрд╛рджрди рдХреЗ рд▓рд┐рдП рддреНрд░рд┐рдХреЛрдг рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЪреБрдиреЗ рдЧрдП рд╣реИрдВред рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рджреЛ рдЪрд░рдгреЛрдВ рдореЗрдВ рддрдп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд╛рд╣рдд рдкрд╣реБрдВрдЪрд╛рдиреЗ рдХреЗ рдмрд╛рдж рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рд╣рдо рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЦреАрдВрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреЗ рдмрд╛рдж рдЙрдиреНрд╣реЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рддреН, рдмрд╛рдж рдореЗрдВ рдкреНрд░рддрд┐рдкрд╛рджрди рдХрддрд╛рд░ рдореЗрдВ рд░рдЦрдХрд░ред</font></font><br><br><pre> <code class="hljs objectivec"> Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>=<span class="hljs-string"><span class="hljs-string">"Opaque"</span></span> <span class="hljs-string"><span class="hljs-string">"Queue"</span></span> = <span class="hljs-string"><span class="hljs-string">"Geometry+1"</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ, рд╣рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЙрд╕реА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЗрд▓рд╛рдХреЗ рдХреЗ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреЗ рдКрдкрд░ рдЦреАрдВрдЪрд╛ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЧрд╣рд░рд╛рдИ рдкрд░реАрдХреНрд╖рдг рдСрдлрд╕реЗрдЯ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЬреАрдкреАрдпреВ рдХреЛ рдпрд╣ рдорд╛рдирдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ рдХрд┐ рддреНрд░рд┐рдХреЛрдг рдХреИрдорд░реЗ рдХреЗ рдХрд░реАрдм рд╣реИрдВ, рдЬрдмрдХрд┐ рд╡реЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs powershell"> Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>=<span class="hljs-string"><span class="hljs-string">"Opaque"</span></span> <span class="hljs-string"><span class="hljs-string">"Queue"</span></span> = <span class="hljs-string"><span class="hljs-string">"Geometry+1"</span></span> } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> Offset <span class="hljs-literal"><span class="hljs-literal">-1</span></span>, <span class="hljs-literal"><span class="hljs-literal">-1</span></span></code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдбрд╝рдХреЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреЛ рддреНрд░рд┐рдХреЛрдгреАрдп рдХрд░рддреЗ рд╕рдордп, рд╣рдореЗрдВ рдкреНрд░рддрд┐ рд╕реЗрд▓ рджреЛ рдирджреА рджрд┐рд╢рд╛рдУрдВ рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рдирд┐рдкрдЯрдирд╛ рдерд╛ред рд╣рдо рдкрд╛рдВрдЪ рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рд╣реА рджрд┐рдЦрдиреЗ рд╡рд╛рд▓реА рдирджрд┐рдпреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдЕрд▓рдЧ рддрд░рд╣ рд╕реЗ рддреНрд░рд┐рдХреЛрдгрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЪреМрджрд╣ рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рдХрд▓реНрдк рд╣реИрдВред рд╣рдо рдЗрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рдХрд▓реНрдк рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдбрд╝рдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛, рдкреНрд░рддреНрдпреЗрдХ рдЫрд╣ рд╕реЗрд▓ рджрд┐рд╢рд╛рдУрдВ рдХреЛ рдЙрд╕реА рддрд░рд╣ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░реЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдХреЛрдИ рд╕рдбрд╝рдХ рд╕реЗрд▓ рдХреЗ рдПрдХ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд╕рд╛рде рдЧреБрдЬрд░рддреА рд╣реИ, рддреЛ рд╣рдо рдЗрд╕реЗ рддреНрд░рд┐рдХреЛрдг рдХреЗ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдЫреЛрдбрд╝рдХрд░, рд╕реАрдзреЗ рд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рдЦреАрдВрдЪ рд▓реЗрдВрдЧреЗред рд╣рдо рдХреЗрдВрджреНрд░ рдХреА рджрд┐рд╢рд╛ рдореЗрдВ рдХрд┐рдирд╛рд░реЗ рд╕реЗ рдЖрдзреЗ рддрдХ рд╕рдбрд╝рдХ рдХреЗ рдПрдХ рдЦрдВрдб рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░реЗрдВрдЧреЗред рдлрд┐рд░ рд╣рдо рджреЛ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рд╢реЗрд╖ рдХреЗрдВрджреНрд░ рдХреЛ рдмрдВрдж рдХрд░ рджреЗрддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/df0/659/a13/df0659a13206731d401579ba8c7f3b8f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рдХреЗ рдПрдХ рд╣рд┐рд╕реНрд╕реЗ рдХрд╛ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рдиред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдпреЛрдЬрдирд╛ рдХреЛ рддреНрд░рд┐рднреБрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░, рдмрд╛рдПрдБ рдФрд░ рджрд╛рдПрдБ рдордзреНрдп рдХреЛрдиреЗ рдФрд░ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдХреЛрдиреЗ рдХреЛ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ред </font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрдпреБрдХреНрдд рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 center, Vector3 mL, Vector3 mR, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рдЦрдВрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдЪреЛрдЯреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдмрд╛рдПрдБ рдФрд░ рджрд╛рдПрдБ рдордзреНрдп рд╢рд┐рдЦрд░ рдХреЗ рдмреАрдЪ рд╕реНрдерд┐рдд рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 center, Vector3 mL, Vector3 mR, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { Vector3 mC = Vector3.Lerp(mL, mR, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); TriangulateRoadSegment(mL, mC, mR, e.v2, e.v3, e.v4); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдм рд╣рдо рд╢реЗрд╖ рджреЛ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреЛ рднреА рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> TriangulateRoadSegment(mL, mC, mR, e.v2, e.v3, e.v4); roads.AddTriangle(center, mL, mC); roads.AddTriangle(center, mC, mR);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рддреНрд░рд┐рднреБрдЬреЛрдВ рдХреЗ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рднреА рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЙрдирдХреА рджреЛ рдЪреЛрдЯрд┐рдпрд╛рдБ рд╕рдбрд╝рдХ рдХреЗ рдмреАрдЪ рдореЗрдВ рд╣реИрдВ, рдФрд░ рд╢реЗрд╖ рдХрд┐рдирд╛рд░реЗ рдкрд░ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> roads.AddTriangle(center, mL, mC); roads.AddTriangle(center, mC, mR); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрднреА рдХреЗ рд▓рд┐рдП, рдЪрд▓реЛ рдЕрдкрдиреЗ рдЖрдк рдХреЛ рдЙрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рддрдХ рд╕реАрдорд┐рдд рдХрд░ рджреЗрдВ рдЬрд┐рдирдореЗрдВ рдХреЛрдИ рдирджрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдпрд╣ </font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рддреНрд░рд┐рдХреЛрдг рдХрд╛ рдкреНрд░рд╢рдВрд╕рдХ рдмрдирд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдХреЛрдб рдХреЛ рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдореЗрдВ рд▓реЗ рдЬрд╛рдПрдБред </font><font style="vertical-align: inherit;">рддрдм рд╣рдо рдПрдХ рдХреЙрд▓ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рд╕рдбрд╝рдХ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдмрд╛рдПрдВ рдФрд░ рджрд╛рдПрдВ рдордзреНрдп рдХреЛрдиреЗ рдХреЛ рдХреЗрдВрджреНрд░ рдФрд░ рджреЛ рдХреЛрдиреЗ рдХреЗ рдХреЛрдиреЗ рдХреЗ рдмреАрдЪ рдкреНрд░рдХреНрд╖реЗрдк рджреНрд╡рд╛рд░рд╛ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { тАж } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateWithoutRiver(direction, cell, center, e); } тАж } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithoutRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { TriangulateEdgeFan(center, e, cell.Color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoadThroughEdge(direction)) { TriangulateRoad( center, Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), e ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29d/ae4/def/29dae4def1f841ae190e64b267f6e4ea.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕реЗ рдЧреБрдЬрд░рддреА рд╕рдбрд╝рдХреЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХ рдХреА рдкрд╕рд▓рд┐рдпрд╛рдБ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рд╕рдбрд╝рдХреЛрдВ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЗ рдХрд░реАрдм рдЬреЛ рд╡реЗ рд╕рдВрдХреАрд░реНрдг рд╣реИрдВред рдЪреВрдБрдХрд┐ рд╣рдо рдЗрд╕ рдмрд╛рдд рдХреА рдЬрд╛рдБрдЪ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдХрд┐рд╕ рдЪреМрджрд╣ рд╡рд┐рдХрд▓реНрдк рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЕрдзрд┐рдХ рд╕реБрдВрджрд░ рдЖрдХреГрддрд┐рдпреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рд╕реЗрд▓ рдХреЗ рдЕрдиреНрдп рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдбрд╝рдХ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рд╕рдбрд╝рдХреЗрдВ рд╕реЗрд▓ рд╕реЗ рдЧреБрдЬрд░рддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╡рд░реНрддрдорд╛рди рджрд┐рд╢рд╛ рдореЗрдВ рдирд╣реАрдВ, рддреЛ рд╣рдо рд╕рдбрд╝рдХ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдПрдХ рддреНрд░рд┐рдХреЛрдг рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред рдпрд╣ рддреНрд░рд┐рдХреЛрдг рдХреЗрдВрджреНрд░, рдмрд╛рдПрдБ рдФрд░ рджрд╛рдПрдБ рдордзреНрдп рдХреЛрдиреЗ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХреЗрд╡рд▓ рдХреЗрдВрджреНрд░реАрдп рд╢рд┐рдЦрд░ рд╕рдбрд╝рдХ рдХреЗ рдмреАрдЪ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред рдЕрдиреНрдп рджреЛ рдЙрд╕рдХреА рдкрд╕рд▓реА рдкрд░ рдЭреВрда рдмреЛрд▓рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadEdge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 center, Vector3 mL, Vector3 mR</span></span></span><span class="hljs-function">)</span></span> { roads.AddTriangle(center, mL, mR); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bd1/293/6ec/bd12936ec0833f7d7da4e038158bb167.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рд╣рдореЗрдВ рдПрдХ рдкреВрд░реА рд╕рдбрд╝рдХ рдпрд╛ рд╕рд┐рд░реНрдл рдПрдХ рдХрд┐рдирд╛рд░реЗ рдХреЛ рддреНрд░рд┐рдХреЛрдг рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рддреЛ рд╣рдореЗрдВ рдЗрд╕реЗ рдЫреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ </font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╕рдбрд╝рдХ рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рдХрд┐рдирд╛рд░реЗ рдХреА рджрд┐рд╢рд╛ рд╕реЗ рдЧреБрдЬрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 center, Vector3 mL, Vector3 mR, EdgeVertices e, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoadThroughCellEdge </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRoadThroughCellEdge) { Vector3 mC = Vector3.Lerp(mL, mR, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); TriangulateRoadSegment(mL, mC, mR, e.v2, e.v3, e.v4); roads.AddTriangle(center, mL, mC); roads.AddTriangle(center, mC, mR); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateRoadEdge(center, mL, mR); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм </font><font style="vertical-align: inherit;">рдХрд┐рд╕реА рднреА рд╕рдбрд╝рдХ рдХреЗ рд╕реЗрд▓ рд╕реЗ рдЧреБрдЬрд░рдиреЗ </font></font><code>TriangulateWithoutRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ </font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдФрд░ рдЙрд╕реЗ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░рдиреА рд╣реЛрдЧреА рдХрд┐ рдХреНрдпрд╛ рд╕рдбрд╝рдХ рд╡рд░реНрддрдорд╛рди рдХрд┐рдирд╛рд░реЗ рд╕реЗ рдЧреБрдЬрд░рддреА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithoutRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { TriangulateEdgeFan(center, e, cell.Color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoads) { TriangulateRoad( center, Vector3.Lerp(center, e.v1, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), Vector3.Lerp(center, e.v5, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>), e, cell.HasRoadThroughEdge(direction) ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/89e/f99/1a0/89ef991a0790911d140b68b1457fb9df.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреВрд░реНрдг рдкрд╕рд▓рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдбрд╝рдХреЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХ рдХрд╛ рд╕реБрдЪрд╛рд░реВ рд╣реЛрдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЗрдВ рдЕрдм рдкреВрд░реА рд╣реЛ рдЪреБрдХреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рдЙрднрд╛рд░ рдмрдирд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдмреАрдЪ рдФрд░ рдХреЛрдиреЛрдВ рдХреЗ рдмреАрдЪ рдореЗрдВ рдмрд╛рдИрдВ рдФрд░ рджрд╛рдИрдВ рдЪреЛрдЯрд┐рдпреЛрдВ рдХреЛ рд╕рдорддрд▓ рдХрд░рдирд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИ рдЬрдм рдЙрдирдХреЗ рдмрдЧрд▓ рдореЗрдВ рдПрдХ рд╕рдбрд╝рдХ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдпрд╣ рдирд╣реАрдВ рд╣реИ, рддреЛ рдПрдХ рдЙрднрд╛рд░ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдРрд╕реЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд╣рдо рдХреЗрдВрджреНрд░ рдХреЗ рдХрд░реАрдм рдХреЛрдиреЗ рдХреЛ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рддрдм ┬╝ рдХреЗ рд╕рд╛рде рдирд╣реАрдВ рдмрд▓реНрдХрд┐ ┬╝ рдХреЗ рд╕рд╛рде рдкреНрд░рдХреНрд╖реЗрдк рдХрд░рдирд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдЬрд╛рдиреЗрдВ рдХрд┐ рдкреНрд░рдХреНрд╖реЗрдкрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЙрдирдореЗрдВ рд╕реЗ рджреЛ рд╣реИрдВ, рд╣рдо рдЗрд╕рдореЗрдВ рдкрд░рд┐рдгрд╛рдо рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>Vector2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдШрдЯрдХ X рдмрд╛рдПрдВ рдмрд┐рдВрджреБ рдХрд╛ рдкреНрд░рдХреНрд╖реЗрдкрдХ рд╣реЛрдЧрд╛, рдФрд░ рдШрдЯрдХ Y рджрд╛рдПрдВ рдмрд┐рдВрджреБ рдХрд╛ рдкреНрд░рдХреНрд╖реЗрдкрдХ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRoadInterpolators</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector2 interpolators; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> interpolators; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрджрд┐ рд╡рд░реНрддрдорд╛рди рджрд┐рд╢рд╛ рдореЗрдВ рдХреЛрдИ рд╕рдбрд╝рдХ рдЬрд╛ рд░рд╣реА рд╣реИ, рддреЛ рд╣рдо рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдмреАрдЪ рдореЗрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRoadInterpolators</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector2 interpolators; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoadThroughEdge(direction)) { interpolators.x = interpolators.y = <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> interpolators; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рд╡рд┐рдХрд▓реНрдк рдЕрд▓рдЧ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдмрд╛рдПрдВ рдмрд┐рдВрджреБ рдХреЗ рд▓рд┐рдП, рд╣рдо ┬╜ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрджрд┐ рдкрд┐рдЫрд▓реА рджрд┐рд╢рд╛ рдореЗрдВ рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕рдбрд╝рдХ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдпрд╣ рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдореЗрдВ ┬╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд╡рд╣реА рд╕рд╣реА рдмрд┐рдВрджреБ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рджрд┐рд╢рд╛ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Vector2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRoadInterpolators</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { Vector2 interpolators; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoadThroughEdge(direction)) { interpolators.x = interpolators.y = <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { interpolators.x = cell.HasRoadThroughEdge(direction.Previous()) ? <span class="hljs-number"><span class="hljs-number">0.5f</span></span> : <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; interpolators.y = cell.HasRoadThroughEdge(direction.Next()) ? <span class="hljs-number"><span class="hljs-number">0.5f</span></span> : <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> interpolators; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЖрдк рдЗрд╕ рдирдИ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕реЗ рдкреНрд░рдХреНрд╖реЗрдкрдХ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рд╕рдбрд╝рдХреЛрдВ рдХреЛ рд╕реБрдЪрд╛рд░реВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithoutRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { TriangulateEdgeFan(center, e, cell.Color); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoads) { Vector2 interpolators = GetRoadInterpolators(direction, cell); TriangulateRoad( center, Vector3.Lerp(center, e.v1, interpolators.x), Vector3.Lerp(center, e.v5, interpolators.y), e, cell.HasRoadThroughEdge(direction) ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c9/d0b/d12/3c9d0bd1262c2d47a3efc2d300212efd.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/84c/5fa/4f8/84c5fa4f8ef27bd4f6d294d0bf50acf6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд┐рдХрдиреА рд╕рдбрд╝рдХреЗрдВред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ рдХрд╛ рд╕рдВрдпреЛрдЬрди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рд╕реНрддрд░ рдкрд░, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рд╕рдбрд╝рдХреЗрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдЕрдЧрд░ рдХреЛрдИ рдирджрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╕реЗрд▓ рдореЗрдВ рдПрдХ рдирджреА рд╣реИ, рддреЛ рд╕рдбрд╝рдХреЛрдВ рдХреЛ рддреНрд░рд┐рдХреЛрдгрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5e/76f/814/f5e76f814407359057d0c1bb1688988c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреЗ рдкрд╛рд╕ рд╕рдбрд╝рдХреЗрдВ рдирд╣реАрдВ рд╣реИрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП </font></font><code>TriangulateRoadAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ </font><font style="vertical-align: inherit;">рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдкрджрдВрдбреЛрдВ рдкрд░ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рд╡рд┐рдзрд┐ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдХрд╣реЗрдВрдЧреЗ </font></font><code>TriangulateAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoads) { TriangulateRoadAdjacentToRiver(direction, cell, center, e); } тАж } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдирджрд┐рдпреЛрдВ рдХреЗ рдмрд┐рдирд╛ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд▓рд┐рдП рднреА рдРрд╕рд╛ рд╣реА рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╣рдо рдпрд╣ рдЬрд╛рдВрдЪ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдХреНрдпрд╛ рд╕рдбрд╝рдХ рд╡рд░реНрддрдорд╛рди рдХрд┐рдирд╛рд░реЗ рд╕реЗ рдЧреБрдЬрд░рддреА рд╣реИ, рдЗрдВрдЯрд░рдкреЛрд▓рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреА рд╣реИ, рдордзреНрдп-рд╢рд┐рдЦрд░ рдмрдирд╛рддреА рд╣реИ рдФрд░ рдХреЙрд▓ рдХрд░рддреА рд╣реИ </font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЪреВрдВрдХрд┐ рдирджрд┐рдпрд╛рдВ рд░рд╛рд╕реНрддреЗ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреА, рд╣рдореЗрдВ рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЙрдирд╕реЗ рджреВрд░ рдЬрд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред </font><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рд╕рдбрд╝рдХ рдХрд╛ рдХреЗрдВрджреНрд░ рдПрдХ рдЕрд▓рдЧ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдирдИ рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>roadCenter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рдпрд╣ рд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRoadThroughEdge = cell.HasRoadThroughEdge(direction); Vector2 interpolators = GetRoadInterpolators(direction, cell); Vector3 roadCenter = center; Vector3 mL = Vector3.Lerp(roadCenter, e.v1, interpolators.x); Vector3 mR = Vector3.Lerp(roadCenter, e.v5, interpolators.y); TriangulateRoad(roadCenter, mL, mR, e, hasRoadThroughEdge); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рд╣рдо рдирджрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЖрдВрд╢рд┐рдХ рд╕рдбрд╝рдХреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЬрд┐рди рджрд┐рд╢рд╛рдУрдВ рд╕реЗ рд╣реЛрдХрд░ рдирджрд┐рдпрд╛рдБ рдЧреБрдЬрд░рддреА рд╣реИрдВ, рд╡реЗ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдЕрдВрддрд░рд╛рд▓ рд╕реЗ рдХрдЯ рдЬрд╛рдПрдБрдЧреАред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95e/029/595/95e0295954967415965a3992ffd91882.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рд╡рд╛рд▓реА рд╕рдбрд╝рдХреЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА рдХрд╛ рдЖрд░рдВрдн рдпрд╛ рдЕрдВрдд </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдкрд╣рд▓реЗ рдХрд┐рд╕реА рдирджреА рдХреА рд╢реБрд░реБрдЖрдд рдпрд╛ рдЕрдВрдд рд╡рд╛рд▓реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рджреЗрдЦреЗрдВред </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рд╕рдбрд╝рдХреЗрдВ рдкрд╛рдиреА рдХреЗ рд╕рд╛рде рдУрд╡рд░рд▓реИрдк рди рд╣реЛрдВ, рдЪрд▓реЛ рдирджреА рд╕реЗ рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЖрдиреЗ рд╡рд╛рд▓реА рдпрд╛ рдмрд╛рд╣рд░ рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреА рджрд┐рд╢рд╛ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрддреНрддрд┐ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexDirection RiverBeginOrEndDirection { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasIncomingRiver ? incomingRiver : outgoingRiver; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдЗрд╕ рд╕рдВрдкрддреНрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ </font></font><code>HexGridChunk.TriangulateRoadAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рджрд┐рд╢рд╛ рдореЗрдВ рдПрдХ рддрд┐рд╣рд╛рдИ рдХреЛ рдордзреНрдп рд░рд┐рдм рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRoadThroughEdge = cell.HasRoadThroughEdge(direction); Vector2 interpolators = GetRoadInterpolators(direction, cell); Vector3 roadCenter = center; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { roadCenter += HexMetrics.GetSolidEdgeMiddle( cell.RiverBeginOrEndDirection.Opposite() ) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); } Vector3 mL = Vector3.Lerp(roadCenter, e.v1, interpolators.x); Vector3 mR = Vector3.Lerp(roadCenter, e.v5, interpolators.y); TriangulateRoad(roadCenter, mL, mR, e, hasRoadThroughEdge);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f18/12b/280/f1812b2807add77e4d173b85ad65e4da.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрд╢реЛрдзрд┐рдд рд╕рдбрд╝рдХреЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЧреЗ рд╣рдореЗрдВ рдЕрдВрддрд░рд╛рд▓ рдХреЛ рдмрдВрдж рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдирджреА рдХреЗ рдХрд░реАрдм рд╣реЛрдиреЗ рдкрд░ рд╕рдбрд╝рдХ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рддреНрд░рд┐рдХреЛрдг рдЬреЛрдбрд╝рдХрд░ рдРрд╕рд╛ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдкрд┐рдЫрд▓реА рджрд┐рд╢рд╛ рдореЗрдВ рдПрдХ рдирджреА рд╣реИ, рддреЛ рд╣рдо рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░, рд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рдФрд░ рдордзреНрдп рдмрд╛рдПрдВ рдмрд┐рдВрджреБ рдХреЗ рдмреАрдЪ рдПрдХ рддреНрд░рд┐рдХреЛрдг рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рдЕрдЧрд░ рдирджреА рдЕрдЧрд▓реА рджрд┐рд╢рд╛ рдореЗрдВ рд╣реИ, рддреЛ рд╣рдо рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░, рдордзреНрдп рджрд╛рдПрдВ рдмрд┐рдВрджреБ рдФрд░ рд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЗ рдмреАрдЪ рдПрдХ рддреНрд░рд┐рдХреЛрдг рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдирджреА рдХреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ рдРрд╕рд╛ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рдХреЛрдб рдХреЛ рд╡рд┐рдзрд┐ рдХреЗ рдЕрдВрдд рдореЗрдВ рд░рдЦреЗрдВред</font></font><br><br><pre> <code class="cs hljs"> Vector3 mL = Vector3.Lerp(roadCenter, e.v1, interpolators.x); Vector3 mR = Vector3.Lerp(roadCenter, e.v5, interpolators.y); TriangulateRoad(roadCenter, mL, mR, e, hasRoadThroughEdge); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Previous())) { TriangulateRoadEdge(roadCenter, center, mL); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction.Next())) { TriangulateRoadEdge(roadCenter, mR, center); }</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдЖрдк рдЕрдиреНрдп рд╡рд┐рд╡рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ?</font></font></b> <div class="spoiler_text">      .   ,     . </div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/93d/485/bc8/93d485bc8072e6fa8471fb98d084467a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреИрдпрд╛рд░ рд╕рдбрд╝рдХреЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реАрдзреА рдирджрд┐рдпрд╛рдБ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдзреЗ рдирджрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрд╢рд┐рдХрд╛рдПрдВ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдореБрд╢реНрдХрд┐рд▓ рд╣реЛрддреА рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдХреЛрд╢рд┐рдХрд╛ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рджреЛ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирджрд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░рд╛рд▓ рдХреЛ рднрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рддреНрд░рд┐рдХреЛрдг рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдирджреА рдХреЗ рд╡рд┐рдкрд░реАрдд рд╕рдбрд╝рдХреЛрдВ рдХреЛ рднреА рдХрд╛рдЯрдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab6/203/055/ab62030558305530ed4aed038669ba9c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╕реАрдзреА рдирджреА рдХреЛ рдУрд╡рд░рд▓реИрдк рдХрд░рддреЗ рд╣реБрдП рд╕рдбрд╝рдХреЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рд╕реЗрд▓ рдореЗрдВ рдирджреА рдХреА рд╢реБрд░реБрдЖрдд рдпрд╛ рдЕрдВрдд рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдиреЗ рд╡рд╛рд▓реА рдФрд░ рдмрд╛рд╣рд░ рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдирджрд┐рдпрд╛рдВ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рдЬрд╛рддреА рд╣реИрдВ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдРрд╕рд╛ рд╣реИ, рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд╕реАрдзреА рдирджреА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { roadCenter += HexMetrics.GetSolidEdgeMiddle( cell.RiverBeginOrEndDirection.Opposite() ) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдирджреА рд╡рд░реНрддрдорд╛рди рджрд┐рд╢рд╛ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдХрд╣рд╛рдВ рд╣реИ, рд╣рдореЗрдВ рдкрдбрд╝реЛрд╕реА рджрд┐рд╢рд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдирджреА рдпрд╛ рддреЛ рдмрд╛рдПрдВ рдпрд╛ рджрд╛рдПрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рд╡рд┐рдзрд┐ рдХреЗ рдЕрдВрдд рдореЗрдВ рдРрд╕рд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдмреВрд▓рд┐рдпрди рдЪрд░ рдореЗрдВ рдЗрди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдХреИрд╢ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рд╣рдорд╛рд░реЗ рдХреЛрдб рдХреЛ рдкрдврд╝рдиреЗ рдореЗрдВ рднреА рдЖрд╕рд╛рдиреА рд╣реЛрдЧреАред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRoadThroughEdge = cell.HasRoadThroughEdge(direction); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> previousHasRiver = cell.HasRiverThroughEdge(direction.Previous()); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> nextHasRiver = cell.HasRiverThroughEdge(direction.Next()); Vector2 interpolators = GetRoadInterpolators(direction, cell); Vector3 roadCenter = center; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { roadCenter += HexMetrics.GetSolidEdgeMiddle( cell.RiverBeginOrEndDirection.Opposite() ) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { } } Vector3 mL = Vector3.Lerp(roadCenter, e.v1, interpolators.x); Vector3 mR = Vector3.Lerp(roadCenter, e.v5, interpolators.y); TriangulateRoad(roadCenter, mL, mR, e, hasRoadThroughEdge); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { TriangulateRoadEdge(roadCenter, center, mL); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { TriangulateRoadEdge(roadCenter, mR, center); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рдирджреА рд╕реЗ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдгреАрдп рд╡реЗрдХреНрдЯрд░ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдирджреА рдкрд┐рдЫрд▓реА рджрд┐рд╢рд╛ рд╕реЗ рдЧреБрдЬрд░рддреА рд╣реИ, рддреЛ рдпрд╣ рджреВрд╕рд░рд╛ рдареЛрд╕ рдХреЛрдг рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдпрд╣ рдкрд╣рд▓рд╛ рдареЛрд╕ рдХреЛрдг рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { Vector3 corner; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { corner = HexMetrics.GetSecondSolidCorner(direction); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { corner = HexMetrics.GetFirstSolidCorner(direction); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддрд╛рдХрд┐ рдпрд╣ рдирджреА рдХреЗ рдирд┐рдХрдЯ рд╣реЛ, рд╣рдореЗрдВ рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рдЗрд╕ рдХреЛрдиреЗ рд╕реЗ рдЖрдзреА рджреВрд░реА рдкрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣рдореЗрдВ рд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рдЙрд╕ рджрд┐рд╢рд╛ рдореЗрдВ рджреВрд░реА рдХреЗ рдПрдХ рдЪреМрдерд╛рдИ рднрд╛рдЧ рдкрд░ рд▓реЗ рдЬрд╛рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { Vector3 corner; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { corner = HexMetrics.GetSecondSolidCorner(direction); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { corner = HexMetrics.GetFirstSolidCorner(direction); } roadCenter += corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; center += corner * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4c/6bf/85b/e4c6bf85b3120697996ad75a3256a3a0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рднрд╛рдЬрд┐рдд рд╕рдбрд╝рдХреЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рдЗрд╕ рд╕реЗрд▓ рдХреЗ рдЕрдВрджрд░ рд╕рдбрд╝рдХреЛрдВ рдХрд╛ рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рд╕рд╛рдЭрд╛ рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ рдЬрдм рдирджреА рдХреЗ рджреЛрдиреЛрдВ рддрд░рдл рд╕рдбрд╝рдХреЗрдВ рд╣реЛрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдПрдХ рддрд░рдл рд╕рдбрд╝рдХ рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЕрд▓рдЧ рд╕рдбрд╝рдХ рдХрд╛ рдПрдХ рдЫреЛрдЯрд╛ рдЯреБрдХрдбрд╝рд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рдЕрддрд╛рд░реНрдХрд┐рдХ рд╣реИ, рддреЛ рдЖрдЗрдП рдРрд╕реЗ рд╣рд┐рд╕реНрд╕реЛрдВ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдПрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╡рд░реНрддрдорд╛рди рджрд┐рд╢рд╛ рдореЗрдВ рдПрдХ рд╕рдбрд╝рдХ рдЬрд╛ рд░рд╣реА рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рд╕рдбрд╝рдХ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдирджреА рдХреЗ рдЙрд╕реА рддрд░рдл рдХреА рджреВрд╕рд░реА рджрд┐рд╢рд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╡рд╣рд╛рдВ рдпрд╛ рд╡рд╣рд╛рдВ рд╕реЗ рдХреЛрдИ рдЧреБрдЬрд░рдиреЗ рд╡рд╛рд▓реА рд╕рдбрд╝рдХ рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рд╕реЗ рдкрд╣рд▓реЗ рд╡рд┐рдзрд┐ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !hasRoadThroughEdge &amp;&amp; !cell.HasRoadThroughEdge(direction.Next()) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } corner = HexMetrics.GetSecondSolidCorner(direction); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !hasRoadThroughEdge &amp;&amp; !cell.HasRoadThroughEdge(direction.Previous()) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } corner = HexMetrics.GetFirstSolidCorner(direction); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/09e/398/532/09e398532543dcd7f78987c23e012571.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдХрд╛рдЯ рджрд┐рдпрд╛ред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреБрд▓реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?</font></font></b> <div class="spoiler_text">     .         . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд╝рд┐рдЧрдЬрд╝реИрдЧ рдирджрд┐рдпрд╛рдБ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдХрд╛ рдЕрдЧрд▓рд╛ рдкреНрд░рдХрд╛рд░ рдЬрд╝рд┐рдЧреНрдЬреИрдЧ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕реА рдирджрд┐рдпрд╛рдБ рд╕рдбрд╝рдХ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рд╕рд╛рдЭрд╛ рдирд╣реАрдВ рдХрд░рддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдмрд╕ рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/851/29b/f56/85129bf56e4948296b17916094fd9d8b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЛрдВ рд╕реЗ рдЧреБрдЬрд░ рд░рд╣реЗ рдЭреВрд▓реЗ </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╝рд┐рдЧрдЬрд╝реИрдЧ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдЖрдиреЗ рд╡рд╛рд▓реА рдФрд░ рдмрд╣рдиреЗ рд╡рд╛рд▓реА рдирджрд┐рдпреЛрдВ рдХреА рджрд┐рд╢рд╛рдУрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╡реЗ рдЖрд╕рдиреНрди рд╣реИрдВ, рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЬрд╝рд┐рдЧрдЬрд╝реИрдЧ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдкреНрд░рд╡рд╛рд╣ рдХреА рджрд┐рд╢рд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рджреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverBeginOrEnd) { тАж } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { тАж } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Previous()) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Next()) { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЖрдиреЗ рд╡рд╛рд▓реА рдирджреА рдХреА рджрд┐рд╢рд╛ рдХреЗ рдХреЛрдиреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЪреБрдирд╛ рдЧрдпрд╛ рдХреЛрдг рдкреНрд░рд╡рд╛рд╣ рдХреА рджрд┐рд╢рд╛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">0.2 рдХреЗ рдХрд╛рд░рдХ рдХреЗ рд╕рд╛рде рдЗрд╕ рдХреЛрдг рд╕реЗ рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Previous()) { roadCenter -= HexMetrics.GetSecondCorner(cell.IncomingRiver) * <span class="hljs-number"><span class="hljs-number">0.2f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Next()) { roadCenter -= HexMetrics.GetFirstCorner(cell.IncomingRiver) * <span class="hljs-number"><span class="hljs-number">0.2f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fa/3c6/f27/1fa3c6f277079e277491027207f9398f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рдХреЛ рдЬрд╝рд┐рдЧрдЬрд╝реИрдЧ рд╕реЗ рджреВрд░ рдзрдХреЗрд▓ рджрд┐рдпрд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреБрдЯрд┐рд▓ рдирджрд┐рдпреЛрдВ рдХреЗ рдЕрдВрджрд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрддрд┐рдо рдирджреА рд╡рд┐рдиреНрдпрд╛рд╕ рдПрдХ рдЪрд┐рдХрдиреА рд╡рдХреНрд░ рд╣реИред </font><font style="vertical-align: inherit;">рд╕реАрдзреА рдирджреА рдХреА рддрд░рд╣, рдпрд╣ рд╕рдбрд╝рдХреЗрдВ рднреА рдЕрд▓рдЧ рдХрд░ рд╕рдХрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкрдХреНрд╖ рдЕрд▓рдЧ рд╣реЛрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рд╣рдореЗрдВ рд╡рдХреНрд░ рдХреЗ рдЕрдВрджрд░ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/566/b8f/3db/566b8f3dbffec4cdc91556abe0f2bf5e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрдХреНрдХреА рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдШреБрдорд╛рд╡рджрд╛рд░ рдирджреАред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╡рд░реНрддрдорд╛рди рджрд┐рд╢рд╛ рдХреЗ рджреЛрдиреЛрдВ рддрд░рдл рдПрдХ рдирджреА рд╣реЛрддреА рд╣реИ, рддреЛ рд╣рдо рд╡рдХреНрд░ рдХреЗ рдЕрдВрджрд░ рд╣реЛрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Next()) { тАж } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver &amp;&amp; nextHasRiver) { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ рд╕реЗрд▓ рдХреЗ рд╡рд░реНрддрдорд╛рди рдХрд┐рдирд╛рд░реЗ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рдбрд╝рдХ рдереЛрдбрд╝реА рдЫреЛрдЯреА рд╣реЛ рдЬрд╛рдПред </font><font style="vertical-align: inherit;">0.7 рдХрд╛ рдЧреБрдгрд╛рдВрдХ рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╕реЗрд▓ рдХреЗрдВрджреНрд░ рдХреЛ 0.5 рдХреЗ рдЧреБрдгрд╛рдВрдХ рдХреЗ рд╕рд╛рде рднреА рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver &amp;&amp; nextHasRiver) { Vector3 offset = HexMetrics.GetSolidEdgeMiddle(direction) * HexMetrics.innerToOuter; roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>; center += offset * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2d/64f/a82/a2d64fa828544540d43856bf94e34f9d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫреЛрдЯреА рд╕рдбрд╝рдХреЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдзреА рдирджрд┐рдпреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдореЗрдВ рд╕рдбрд╝рдХреЛрдВ рдХреЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣рд┐рд╕реНрд╕реЛрдВ рдХреЛ рдХрд╛рдЯрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдХреЗрд╡рд▓ рд╡рд░реНрддрдорд╛рди рджрд┐рд╢рд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver &amp;&amp; nextHasRiver) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hasRoadThroughEdge) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 offset = HexMetrics.GetSolidEdgeMiddle(direction) * HexMetrics.innerToOuter; roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>; center += offset * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30b/6a0/d9d/30b6a0d9db5fe0960265713c62ef2ae5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдХрд╛рдЯ рджрд┐рдпрд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреБрдЯрд┐рд▓ рдирджрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд╣рд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд┐рдЫрд▓реЗ рд╕рднреА рдорд╛рдорд▓реЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХреЗ рдмрд╛рдж, рдХреЗрд╡рд▓ рд╢реЗрд╖ рд╡рд┐рдХрд▓реНрдк рдШреБрдорд╛рд╡рджрд╛рд░ рдирджреА рдХрд╛ рдмрд╛рд╣рд░реА рд╣рд┐рд╕реНрд╕рд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдмрд╛рд╣рд░ рд╕реЗрд▓ рдХреЗ рддреАрди рд╣рд┐рд╕реНрд╕реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдордзреНрдп рджрд┐рд╢рд╛ рдЦреЛрдЬрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рд╕рдбрд╝рдХ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЛ 0.25 рдХреЗ рдХрд╛рд░рдХ рд╕реЗ рдЗрд╕ рд░рд┐рдм рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver &amp;&amp; nextHasRiver) { тАж } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { HexDirection middle; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { middle = direction.Next(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { middle = direction.Previous(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { middle = direction; } roadCenter += HexMetrics.GetSolidEdgeMiddle(middle) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8b8/84c/a29/8b884ca29118c36e522674cd00ab8613.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рдХреЗ рдмрд╛рд╣рд░ рдмрджрд▓ рджрд┐рдпрд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрддрд┐рдо рдЪрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдореЗрдВ рдирджреА рдХреЗ рдЗрд╕ рддрд░рдл рдХреА рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЫреЛрдЯрд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдмреАрдЪ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рд╕рдбрд╝рдХ рдХреА рддреАрдиреЛрдВ рджрд┐рд╢рд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдЧрд░ рд╕рдбрд╝рдХреЗрдВ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рд╣рдо рдХрд╛рдо рдХрд░рдирд╛ рдмрдВрдж рдХрд░ рджреЗрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { HexDirection middle; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { middle = direction.Next(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { middle = direction.Previous(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { middle = direction; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !cell.HasRoadThroughEdge(middle) &amp;&amp; !cell.HasRoadThroughEdge(middle.Previous()) &amp;&amp; !cell.HasRoadThroughEdge(middle.Next()) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } roadCenter += HexMetrics.GetSolidEdgeMiddle(middle) * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56d/69a/d1b/56d69ad1b8d6ffdf74e9adb1c4800695.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9a/8c3/178/a9a8c3178c8a44738b4bbd01ef5f221d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд▓рд┐рдкрд┐рдВрдЧ рд╕реЗ рдкрд╣рд▓реЗ рдФрд░ рдмрд╛рдж рдореЗрдВ рд╕рдбрд╝рдХреЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рдирджреА рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдорд╛рд░реА рдирджрд┐рдпрд╛рдБ рдФрд░ рд╕рдбрд╝рдХреЗрдВ рд╕рд╣-рдЕрд╕реНрддрд┐рддреНрд╡ рдореЗрдВ рдЖ рд╕рдХрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдирджрд┐рдпрд╛рдБ рд╕рдбрд╝рдХреЛрдВ рдХреА рдЙрдкреЗрдХреНрд╖рд╛ рдХрд░рддреА рд╣реИрдВ, рдФрд░ рд╕рдбрд╝рдХреЗрдВ рдирджрд┐рдпреЛрдВ рдХреЗ рдЕрдиреБрдХреВрд▓ рд╣реЛрддреА рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b32/6e4/28b/b326e428b45df027cac2f99a336e71e9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ рдХрд╛ рд╕рдВрдпреЛрдЬрдиред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХреЛрдВ рдХреА рд╕реВрд░рдд </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕ рдХреНрд╖рдг рддрдХ, рд╣рдордиреЗ рд╕рдбрд╝рдХ рдХреЗ рд░рдВрдЧреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдирдХреЗ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдХреЗрд╡рд▓ рдпреВ рд╕рдордиреНрд╡рдп рдмрджрд▓ рдЧрдпрд╛, рд╣рдордиреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рдбрд╝рдХ рдХреЗ рдордзреНрдп рдФрд░ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдмреАрдЪ рд╕рдВрдХреНрд░рдордг рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/084/cb2/8ac/084cb28ac448ddb258846c09d8b3b83a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдкреНрд░рджрд░реНрд╢рдиред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдм рд╕рдбрд╝рдХреЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рддреНрд░рд┐рдХреЛрдгрд┐рдд рд╣реЛ рдЧрдИ рд╣реИрдВ, рддреЛ рд╣рдо рд╕рдбрд╝рдХ рдХреЗ рд╢реЗрдбрд░ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпрд╣ рд╕рдбрд╝рдХреЛрдВ рдХреА рддрд░рд╣ рдХреБрдЫ рдФрд░ рдкреНрд░рд╕реНрддреБрдд рдХрд░реЗред </font><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдирджрд┐рдпреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рджреГрд╢реНрдп рд╣реЛрдЧрд╛, рдХреЛрдИ рддрд╛рдордЭрд╛рдо рдирд╣реАрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдареЛрд╕ рд░рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдмрд╕ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд░рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЗрд╕реЗ рд▓рд╛рд▓ рдХрд░ рджрд┐рдпрд╛ред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = _Color; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/304/2e4/ab4/3042e4ab4b01b3389822072244208cb6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд╛рд▓ рд╕рдбрд╝рдХреЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдмрд╣реБрдд рдмреЗрд╣рддрд░ рд▓рдЧ рд░рд╣рд╛ рд╣реИ! </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдпреВ рдХреЛ рдорд┐рдХреНрд╕рд┐рдВрдЧ рдлреИрдХреНрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдпреВ рдХреЛрд░реНрдбрд┐рдиреЗрдЯ рдХрд░рддреЗ рд╣реБрдП, рдЗрд▓рд╛рдХреЗ рдХреЛ рдЬрд╛рд░реА рд░рдЦреЗрдВ рдФрд░ рд╕рдбрд╝рдХ рдХреЛ рдорд┐рд▓рд╛рдПрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = _Color; <span class="hljs-type"><span class="hljs-type">float</span></span> blend = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = blend; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХреБрдЫ рднреА рдирд╣реАрдВ рдмрджрд▓рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реБрдЖ рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░рд╛ рд╢реЗрдк рдЕрдкрд╛рд░рджрд░реНрд╢реА рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдм рдЙрд╕реЗ рдЕрд▓реНрдлрд╛ рдмреНрд▓реЗрдВрдбрд┐рдВрдЧ рдХреА рдЬрд░реВрд░рдд рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рд╣рдореЗрдВ рдПрдХ рд╕рдВрднреЛрдЧ decal рд╕рддрд╣ рдХреЗ рд▓рд┐рдП рдПрдХ shader рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдирд┐рд░реНрджреЗрд╢ рдХреЗ рд▓рд┐рдП рдПрдХ </font></font><code>#pragma surface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрдВрдХреНрддрд┐ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рдХрд░ рдЖрд╡рд╢реНрдпрдХ shader рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>decal:blend</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs cs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf Standard fullforwardshadows decal:blend</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a0/66c/501/7a066c5015ea14533f1b9ed881469323.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЛрдВ рдХрд╛ рдорд┐рд╢реНрд░рдгред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рд╣рдордиреЗ рдордзреНрдп рд╕реЗ рдХрд┐рдирд╛рд░реЗ рддрдХ рдПрдХ рдЪрд┐рдХрдиреА рд░реИрдЦрд┐рдХ рдорд┐рд╢реНрд░рдг рдмрдирд╛рдпрд╛ рдЬреЛ рдмрд╣реБрдд рд╕реБрдВрджрд░ рдирд╣реАрдВ рджрд┐рдЦрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рд╕рдбрд╝рдХ рдХреА рддрд░рд╣ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдареЛрд╕ рдХреНрд╖реЗрддреНрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдмрд╛рдж рдПрдХ рдЕрдкрд╛рд░рджрд░реНрд╢реА рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рддреНрд╡рд░рд┐рдд рд╕рдВрдХреНрд░рдордг рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рдЗрд╕рдХреЗ рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>smoothstep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ 0 рд╕реЗ 1 рддрдХ рдПрдХ рд░реИрдЦрд┐рдХ рдкреНрд░рдЧрддрд┐ рдХреЛ рдПрд╕-рдЖрдХрд╛рд░ рдХреЗ рд╡рдХреНрд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2b0/030/f57/2b0030f57819183470fc7fae72ea18bd.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реИрдЦрд┐рдХ рдкреНрд░рдЧрддрд┐ рдФрд░ smoothstepред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди </font></font><code>smoothstep</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ рдПрдХ рдордирдорд╛рдирд╛ рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рд╡рдХреНрд░ рдлрд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреНрдпреВрдирддрдо рдФрд░ рдЕрдзрд┐рдХрддрдо рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИред </font><font style="vertical-align: inherit;">рд╕реАрдорд╛ рдХреЗ рдмрд╛рд╣рд░ рдЗрдирдкреБрдЯ рдорд╛рди рд╡рдХреНрд░ рдХреЛ рд╕рдкрд╛рдЯ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реАрдорд┐рдд рд╣реИрдВред </font><font style="vertical-align: inherit;">рдХрд░реНрд╡ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ 0.4 рдФрд░ рдЕрдВрдд рдореЗрдВ 0.7 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдпреВ 0 рд╕реЗ 0.4 рддрдХ рд╕рдордиреНрд╡рдп рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкрд╛рд░рджрд░реНрд╢реА рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдФрд░ рдпреВ 0.7 рд╕реЗ 1 рддрдХ рд╕рдордиреНрд╡рдп рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдкрд╛рд░рджрд░реНрд╢реА рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╕рдВрдХреНрд░рдордг 0.4 рдФрд░ 0.7 рдХреЗ рдмреАрдЪ рд╣реЛрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> blend = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x; blend = smoothstep(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>, blend);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/543/fe1/4b4/543fe14b4d760b820ec106626230876f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрд╛рд░рджрд░реНрд╢реА рдФрд░ рдкрд╛рд░рджрд░реНрд╢реА рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рддреНрд╡рд░рд┐рдд рд╕рдВрдХреНрд░рдордгред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЛрд░ рдХреЗ рд╕рд╛рде рд╕рдбрд╝рдХ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╕рдбрд╝рдХ рдХрд╛ рдЬрд╛рд▓ рд╡рд┐рдХреГрдд рд╣реЛ рдЬрд╛рдПрдЧрд╛, рд╕рдбрд╝рдХреЛрдВ рдХреА рдЪреМрдбрд╝рд╛рдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рд╕рдВрдХреНрд░рдордг рдХреА рдЪреМрдбрд╝рд╛рдИ рднреА рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓ рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдХрднреА рдпрд╣ рдзреБрдВрдзрд▓рд╛ рд╣реЛрддрд╛ рд╣реИ, рдХрднреА рдХрдареЛрд░ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рддрд░рд╣ рдХреА рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓рддрд╛ рд╣рдореЗрдВ рд╕реВрдЯ рдХрд░рддреА рд╣реИ, рдЕрдЧрд░ рд╣рдо рд╕рдбрд╝рдХреЛрдВ рдХреЛ рд░реЗрддреАрд▓реЗ рдпрд╛ рдорд┐рдЯреНрдЯреА рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЕрдЧрд▓рд╛ рдХрджрдо рдЙрдард╛рддреЗ рд╣реИрдВ рдФрд░ рд╢реЛрд░ рдХреЛ рд╕рдбрд╝рдХ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдЙрдиреНрд╣реЗрдВ рдЕрдзрд┐рдХ рдЕрд╕рдорд╛рди рдФрд░ рдХрдо рдмрд╣реБрднреБрдЬ рдмрдирд╛ рджреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдо рд╢реЛрд░ рдХреА рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдХрд░ рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдирдореВрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк XZ рджреБрдирд┐рдпрд╛ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдареАрдХ рд╡реИрд╕реЗ рд╣реА рдЬреИрд╕реЗ рд╣рдордиреЗ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХреЛрдиреЗ рдХреЛ рд╡рд┐рдХреГрдд рдХрд░рддреЗ рд╕рдордп рдХрд┐рдпрд╛ рдерд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рддрд╣ рдХреА рдЫрд╛рдпрд╛ рдореЗрдВ рджреБрдирд┐рдпрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрдирдкреБрдЯ рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ </font></font><code>float3 worldPos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs swift"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> </span></span>{ float2 uv_MainTex; float3 worldPos; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо </font></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрдЦреНрдп рдмрдирд╛рд╡рдЯ рдХреЗ рдирдореВрдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╕рд╛рде рд╣реА рдЬрд╝реВрдо рдЖрдЙрдЯ рдХрд░реЗрдВ, рдЕрдиреНрдпрдерд╛ рдмрдирд╛рд╡рдЯ рдмрд╣реБрдд рдмрд╛рд░ рджреЛрд╣рд░рд╛рдПрдЧреАред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); fixed4 c = _Color; <span class="hljs-type"><span class="hljs-type">float</span></span> blend = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рд╕рдордиреНрд╡рдп рдпреВ рдХреЛ рдЧреБрдгрд╛ рдХрд░рдХреЗ рд╕рдВрдХреНрд░рдордг рдХреЛ рд╡рд┐рдХреГрдд рдХрд░рддреЗ рд╣реИрдВ </font></font><code>noise.x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЪреВрдВрдХрд┐ рд╢реЛрд░ рдорд╛рди рдФрд╕рддрди 0.5 рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕рдбрд╝рдХреЗрдВ рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рдПрдВрдЧреАред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЧреБрдгрд╛ рд╕реЗ рдкрд╣рд▓реЗ рд╢реЛрд░ рдореЗрдВ 0.5 рдЬреЛрдбрд╝реЗрдВред</font></font><br><br><pre> <code class="hljs mel"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> blend = IN.uv_MainTex.x; blend *= <span class="hljs-keyword"><span class="hljs-keyword">noise</span></span>.x + <span class="hljs-number"><span class="hljs-number">0.5</span></span>; blend = <span class="hljs-keyword"><span class="hljs-keyword">smoothstep</span></span>(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>, blend);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c08/b7d/e28/c08b7de2879b84c816286530871b6a6f.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4be/bdf/28f/4bebdf28fc519b3f186f119b6e501261.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рдХреЗ рд╡рд┐рдХреГрдд рдХрд┐рдирд╛рд░реЗред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рд╕рдорд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕рдбрд╝рдХреЛрдВ рдХреЗ рд░рдВрдЧ рдХреЛ рднреА рд╡рд┐рдХреГрдд рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдлрдЬреА рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдЕрдиреБрд░реВрдк рдЧрдВрджрдЧреА рдХреА рд╕рдирд╕рдиреА рджреЗрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЕрдиреНрдп рд╢реЛрд░ рдЪреИрдирд▓ рджреНрд╡рд╛рд░рд╛ рд░рдВрдЧ рдХреЛ рдЧреБрдгрд╛ рдХрд░реЗрдВ, рджреНрд╡рд╛рд░рд╛ рдХрд╣реЗрдВ </font></font><code>noise.y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдФрд╕рддрди рдЖрдзреЗ рд░рдВрдЧ рдХрд╛ рдореВрд▓реНрдп рдорд┐рд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдпрд╣ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реИ, рд╣рдо рд╢реЛрд░ рдкреИрдорд╛рдиреЗ рдХреЛ рдереЛрдбрд╝рд╛ рдХрдо рдХрд░ рджреЗрдВрдЧреЗ рдФрд░ рдПрдХ рдирд┐рд░рдВрддрд░ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗ рддрд╛рдХрд┐ рдпреЛрдЧ 1 рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗред</font></font><br><br><pre> <code class="hljs swift"> fixed4 <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = _Color * (noise.y * <span class="hljs-number"><span class="hljs-number">0.75</span></span> + <span class="hljs-number"><span class="hljs-number">0.25</span></span>);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d2/a25/d49/6d2a25d4929cf56f7c4059352b4ed70a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦрд╕реНрддрд╛рд╣рд╛рд▓ рд╕рдбрд╝рдХреЗрдВред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi424491/">https://habr.com/ru/post/hi424491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi424475/index.html">2018 рдХреЗ I рдЫрдорд╛рд╣реА рдХреЗ рд▓рд┐рдП рд╕реВрдЪрдирд╛ рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдЧрд░рд╛рдиреА рдХреЗрдВрджреНрд░ рдХреА рд░рд┐рдкреЛрд░реНрдЯ</a></li>
<li><a href="../hi424477/index.html">Pygame рдкрд░ рдЦреЗрд▓реЛрдВ рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛</a></li>
<li><a href="../hi424481/index.html">RTOS рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрд░реА рд╕рдЪреНрдЪрд╛рдИред рдЕрдиреБрдЪреНрдЫреЗрдж # 11ред рдХрд╛рд░реНрдп: рд╡рд┐рдиреНрдпрд╛рд╕ рдФрд░ рдПрдкреАрдЖрдИ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдЪрдп</a></li>
<li><a href="../hi424483/index.html">$ 38 рдмрд┐рд▓рд┐рдпрди рдХрд╛ рд╕реМрджрд╛ рдФрд░ рдЗрд╕рдХреЗ рдирд┐рд╣рд┐рддрд╛рд░реНрде: рдХреИрд╕реЗ Comcast рдФрд░ Disney рдирд┐рд╡реЗрд╢ рдХреЗ рд╕рд╛рде Amazon рдФрд░ Netflix рд╕реЗ рд▓рдбрд╝рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi424485/index.html">рдЖрдИрдУрдПрд╕ рдРрдк рдореЗрдВ рдПрд╕рдПрд╕рдПрд▓ рдкрд┐рдирд┐рдВрдЧ рдмрд╛рдИрдкрд╛рд╕</a></li>
<li><a href="../hi424495/index.html">Google Chrome рдХрдВрдкрдиреА рдХреА рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░рддреЗ рд╕рдордп рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рдордирд╛ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдЬреЛрдбрд╝ рджреЗрдЧрд╛ *</a></li>
<li><a href="../hi424497/index.html">рдирдкреБрдВрд╕рдХ рдХреЗ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдкрд░ рд╢рдХ рдХрд░рдирд╛ рдмрдВрдж рдХрд░реЛред рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░ рдмреЗрд╣рддрд░ рд╕реАрдЦреЗрдВ</a></li>
<li><a href="../hi424499/index.html">рдЕрдЪреНрдЫрд╛ рд╣реИ, рд╡рд╣ рдЖрдкрдХрд╛</a></li>
<li><a href="../hi424501/index.html">рд░рд┐рдпрд▓ рд╡реЗрд▓реНрдбрд░ рдХреЗ рд▓рд┐рдП рдбрд╛рдпрдЧреНрдиреЛрд╕реНрдЯрд┐рдХ рдЯрд░реНрдорд┐рдирд▓</a></li>
<li><a href="../hi424503/index.html">рдЕрдкрдиреЗ рдЖрдк рдХреЛ рдмреВрдЯ, рд╡рд╕рдВрдд рдЖ рд░рд╣рд╛ рд╣реИ (рднрд╛рдЧ 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>