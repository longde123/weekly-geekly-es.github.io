<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title> す 锔 Visualizaci贸n tridimensional en simuladores de material rodante basados en el motor OpenSceneGraph   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace poco menos de un a帽o, se public贸 una publicaci贸n donde hablamos sobre el complejo de capacitaci贸n y laboratorio (ULK) del tren el茅ctrico ES1 Last...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Visualizaci贸n tridimensional en simuladores de material rodante basados en el motor OpenSceneGraph</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436276/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/bp/4h/_g/bp4h_g1ct8gq0ntec_7pe8pkan8.jpeg"></div><br><br>  Hace poco menos de un a帽o, se public贸 una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicaci贸n</a> donde hablamos sobre el complejo de capacitaci贸n y laboratorio (ULK) del tren el茅ctrico ES1 Lastochka desarrollado por nuestra universidad.  Luego promet铆 que esta no ser铆a la 煤ltima publicaci贸n sobre este tema, en particular, amenac茅 con hablar sobre los problemas de crear una visualizaci贸n tridimensional para tales simuladores y describir los principales enfoques para resolverlos. <br><br>  El a帽o pasado, estuvimos satisfechos con nuestro pr贸ximo lanzamiento: el ULK del tren el茅ctrico de alta velocidad Sapsan EVS2, que tuvo lugar en agosto del a帽o pasado.  El complejo educativo y de laboratorio de este tren el茅ctrico en s铆 merece una historia aparte, pero en el contexto de esta publicaci贸n hablaremos sobre la llaga: el problema de crear un subsistema adecuado de visualizaci贸n tridimensional, cuya soluci贸n se acerc贸 a nuestro equipo desde diferentes lados durante aproximadamente dos a帽os.  El lanzamiento del simulador Sapsan es significativo (entre otras cosas) y en eso determin贸 el vector de desarrollo de nuestros desarrollos en esta 谩rea. <br><a name="habracut"></a><br><h1>  1. Brevemente sobre ULK EVS2 "Sapsan" </h1><br>  Quiero enfatizar una vez m谩s (lo que hago con una frecuencia envidiable) que los complejos educativos y de laboratorio de material rodante desarrollados en nuestra universidad no est谩n destinados a la preparaci贸n de brigadas de locomotoras.  Como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">uno de los comentaristas del</a> art铆culo anterior <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se帽al贸</a> acertadamente, nuestros ULK no son simuladores, sino simuladores, donde el 茅nfasis principal est谩 en la implementaci贸n competente de la f铆sica del movimiento del tren y la simulaci贸n de la operaci贸n de los subsistemas de material rodante que aseguran su movimiento y parada.  El simulador Sapsan no es una excepci贸n, en la que se resuelven las siguientes tareas: <br><br><ul><li>  Se implement贸 un modelo din谩mico de la parte mec谩nica del tren teniendo en cuenta las fuerzas longitudinales y el perfil de la v铆a. </li><li>  Se ha construido un modelo inform谩tico detallado del funcionamiento de los subsistemas clave del tren el茅ctrico: circuito el茅ctrico de potencia, accionamiento el茅ctrico de tracci贸n, frenos neum谩ticos y electroneum谩ticos. </li><li>  Se reproducen los algoritmos b谩sicos del funcionamiento del sistema de control del tren el茅ctrico a diferentes niveles. </li></ul><br>  Adem谩s, el complejo de capacitaci贸n y laboratorio incluye un modelo de tama帽o completo de la cabina del tren el茅ctrico con los controles principales y los medios para mostrar la informaci贸n.  A diferencia del simulador Swallows, esta cabina no fue fabricada por nosotros por nuestra cuenta, sino que fue comprada en 2015 en una oficina en el pa铆s que produce simuladores de entrenamiento.  Por lo tanto, el proceso de desarrollo del simulador se centr贸 en la creaci贸n de software. <br><br><div class="spoiler">  <b class="spoiler_title">Foto de la cabina</b> <div class="spoiler_text">  <i>Vista general del interior de la cabina.</i> <br><img src="https://habrastorage.org/webt/ud/de/ic/uddeiczrsp23eszvl6tx6zwal7y.jpeg"><br><br>  <i>Ver a trav茅s del parabrisas</i> <br><img src="https://habrastorage.org/webt/r1/nz/kn/r1nzknpyastfa6b8iy6ghp2m4ic.jpeg"><br><br>  <i>Display dispositivo locomotor de seguridad integrado (CLUB-U).</i>  <i>El rojo "290" es el l铆mite de velocidad actual obtenido de la tarjeta electr贸nica CLUB-U.</i>  <i>Hasta ahora, el l铆mite de velocidad alcanzado por Sapsan en el ferrocarril de octubre hace alarde aqu铆.</i>  <i>En el futuro, la tarjeta electr贸nica se implementar谩 como se hace en la vida.</i> <br><img src="https://habrastorage.org/webt/nt/on/-g/nton-ggphlulx1e0yxmznf_epnu.jpeg"><br><br>  <i>Pantalla principal "Interfaz hombre-m谩quina"</i> <br><img src="https://habrastorage.org/webt/xk/kd/qk/xkkdqkxqznjjkl_vx-lfbdhys4w.jpeg"><br><br>  <i>Visualizaci贸n del estado del sistema de frenos del tren el茅ctrico.</i> <br><img src="https://habrastorage.org/webt/ap/wl/qv/apwlqvuggyfjgwd_prliwn3hjck.jpeg"><br><br>  <i>Ajustador de velocidad y controlador de tracci贸n</i> <br><img src="https://habrastorage.org/webt/u3/ok/nb/u3oknbv0nitjk-d7fcpqmywhxr4.jpeg"><br><br>  <i>Controlador de control de freno de tren el茅ctrico</i> <br><img src="https://habrastorage.org/webt/6k/mf/eg/6kmfegwxufy_317kqfvmp7n00k8.jpeg"><br><br>  <i>Interruptores de palanca para el control de colectores de corriente y dispositivos de protecci贸n (BV / GV) - interruptores de palanca negros cerca del ajustador de velocidad</i> <br><img src="https://habrastorage.org/webt/dn/gs/3p/dngs3pxzgoqcawtdewf84z8squc.jpeg"><br><br>  <i>Interfaz de gesti贸n de formaci贸n: pantalla de selecci贸n de ruta</i> <br><img src="https://habrastorage.org/webt/_n/sh/jp/_nshjpyo8nu8wbxalcfhtfowns0.jpeg"><br><br>  <i>Pantalla de control de volumen de efectos de audio</i> <br><img src="https://habrastorage.org/webt/ba/ll/p_/ballp_v52zh8rmq4iosfkicienw.jpeg"><br><br>  <i>Contador de kilometraje.</i>  <i>Una historia divertida se asocia con su apariencia.</i>  <i>Cuando entregamos nuestro primer simulador de la locomotora diesel 2TE116, el representante del cliente brome贸 con nuestra pregunta sobre cu谩ndo se firmar谩 el acto de finalizaci贸n: Bueno, hag谩moslo como en la vida: cuando se pone en funcionamiento una nueva locomotora, debe pasar por una carrera de 5000 kil贸metros.</i>  <i>Eso pasar谩 ... ".</i>  <i>El acto, por supuesto, se firm贸 mucho antes, pero, evaluando el humor de la situaci贸n, ya hicimos un contador similar en el simulador Swallows.</i>  <i>El contador se puede restablecer a "0" ingresando la contrase帽a de servicio.</i> <br><img src="https://habrastorage.org/webt/yo/hc/jq/yohcjqcfhoe8irnm6j3ynr9exby.jpeg"><br><br>  <i>Panel accesorio derecho con man贸metros de freno y v谩lvula de freno de emergencia.</i>  <i>No todos los elementos inherentes a este Sapsan est谩n instalados aqu铆; el proveedor recibi贸 un control remoto de este tipo</i> <br><img src="https://habrastorage.org/webt/fr/te/5l/frte5lrezbuss2ng2iesdqcl0p8.jpeg"><br><br>  <i>Por lo tanto, algunos de los controles que son cr铆ticos para nosotros se implementaron en el software, en particular, el panel de interruptores de derivaci贸n controlados desde la pantalla t谩ctil</i> <br><img src="https://habrastorage.org/webt/he/c2/ga/hec2gahq08cziegrxl1qfkriqya.png"><br></div></div><br>  El desarrollo de software para dicho simulador es una pregunta muy amplia, y tratar茅 (lo mejor que pueda) de satisfacer el inter茅s de los lectores en estos temas en el futuro (si corresponde), pero por ahora, volvamos al tema principal del art铆culo: visualizaci贸n tridimensional del proceso de movimiento del tren. <br><br><h1>  2. Antecedentes y tecnolog铆a del pasado. </h1><br>  En los comentarios al 煤ltimo art铆culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">, se hizo una pregunta</a> que, francamente, me divirti贸 bastante.  S铆, de hecho, en muchos simuladores que todav铆a se usan hoy en d铆a, este enfoque todav铆a se usa: el video se graba en una secci贸n real del ferrocarril y luego se desplaza en el simulador a una velocidad proporcional a la velocidad de movimiento.  Esto se hizo solo porque en aquellos d铆as en que se crearon tales simuladores, la calidad de los gr谩ficos tridimensionales dejaba mucho que desear, y esto tambi茅n se aplicaba a las estaciones gr谩ficas duras en Unix comerciales, y no hab铆a duda de una PC.  Por lo tanto, incluso los fabricantes de juegos de computadora, por ejemplo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> , no dudaron en utilizar este enfoque. <br><br>  Esto no tiene sentido hoy, porque: <br><br><ol><li>  La velocidad de fotogramas insuficiente a bajas velocidades del tren no proporciona la suavidad deseada de la actualizaci贸n de la imagen.  Tendremos los atesorados 25 fps solo a la velocidad a la que se grab贸 el video desde la cabina del conductor.  Y esta falla fatal no se puede superar de ninguna manera, ni disparando con una c谩mara de alta velocidad (驴cu谩nto pesar谩 el video a 120 cuadros por segundo? Eso es lo mismo ...), ni por la generaci贸n programada de cuadros intermedios.  Este 煤ltimo lo llevamos a cabo utilizando la tecnolog铆a OpenCV, pero no condujo a resultados normales.  Esta pregunta se estudi贸 repetidamente desde todos los lados y, como resultado, se concluy贸 que el costo de los recursos para crear dicho sistema es mucho mayor que el desarrollo de un sistema similar, pero basado en gr谩ficos 3D </li><li>  Dificultades para desplazar suavemente el video hacia atr谩s.  E incluso teniendo en cuenta que ser谩n superados, entonces, 驴d贸nde correr谩n los perros que corren en la plataforma? 驴Creemos que debemos ir en reversa? </li><li>  La falta de toda "interactividad".  驴Qu茅 hacer con un cambio en el sem谩foro, con el movimiento de desv铆os, el movimiento de trenes que se aproximan y pasan? </li></ol><br>  Por lo tanto, todos los simuladores y simuladores modernos se crean utilizando gr谩ficos 3D interactivos, ya que hoy en d铆a no existen obst谩culos desde el punto de vista del software o del hardware. <br><br>  Si todo est谩 muy claro desde el punto de vista del hardware: el monitor instalado en lugar del parabrisas est谩 conectado a una PC con una tarjeta de video normal (ni siquiera la de gama alta), entonces, desde el punto de vista del software, surge la pregunta de elegir la tecnolog铆a para implementar la tarea. <br><br><h1>  3. El motor gr谩fico versus el motor del juego o por qu茅 se eligi贸 OpenSceneGraph </h1><br>  Puedo estar equivocado, pero anticipo los comentarios por adelantado, lo que har谩 una pregunta completamente l贸gica, 驴por qu茅, al analizar las tecnolog铆as existentes, nuestra elecci贸n no se detuvo en mastodontes como Unity o Unreal Engine 4?  Contestar茅 esta pregunta, adem谩s, justificar茅 mi respuesta. <br><br>  Brevemente, ni Unity ni Unreal Engine satisfacen los requisitos de la tarea que se est谩 resolviendo.  Una respuesta m谩s detallada proporciona, en primer lugar, una lista de los requisitos en cuesti贸n.  TK, compilado por nosotros en el subsistema de visualizaci贸n tridimensional, incluye (en orden decreciente de importancia) las siguientes disposiciones: <br><br><ol><li>  Independencia del proceso de desarrollo de software del subsistema de visualizaci贸n y del proceso de creaci贸n de recursos para 茅l.  Los recursos, en este caso, incluyen modelos tridimensionales, texturas, as铆 como las llamadas <i>rutas</i> .  Una ruta se entiende como una combinaci贸n de objetos de configuraci贸n y recursos que permiten que el subsistema de video muestre la secci贸n deseada del ferrocarril y simule el movimiento del tren a lo largo de 茅l.  Esto tambi茅n incluye la <i>posibilidad de cambiar la ruta sin reconstruir la parte del software del subsistema de video</i> </li><li>  Crea rutas de longitud ilimitada.  Har茅 una reserva de que una longitud ilimitada es en principio inalcanzable debido a los recursos limitados de hardware.  Este requisito debe entenderse que la longitud de la ruta debe estar al menos dentro de un "arc茅n", es decir, una secci贸n de la carretera entre los puntos de giro, y esto, dependiendo de varios factores, es una distancia suficientemente grande, estimada en m谩s de cien kil贸metros.  Este requisito impone la necesidad de proporcionar carga / descarga din谩mica de los recursos del programa con suficiente suavidad con un consumo de memoria razonable.  Y es deseable que el motor contenga dicha funcionalidad "fuera de la caja" </li><li>  Integraci贸n conveniente con la pila de tecnolog铆a utilizada.  Tradicionalmente, debido a razones objetivas nuevamente, nuestro equipo usa lenguaje C ++ con Qt Framework, QtCreator IDE y Git como un sistema de control de versiones para desarrollar software para ULK PS.  Como plataforma de sistema ULK PS, se utiliza un sistema operativo basado en el kernel de Linux </li></ol><br>  驴Qu茅 hay de malo en Unity y UE?  驴Cu谩l es el hecho de que otros motores pueden importar recursos de formatos completamente diferentes?  Sin embargo, al ensamblar el proyecto, se convierten irreversiblemente al formato binario interno, lo que hace que sea imposible agregar y cambiar recursos sin volver a ensamblar el proyecto.  Las tecnolog铆as como los prefabricados y los paquetes de activos disponibles en Unity no resuelven el problema, ya que el editor del motor no es el mejor lugar para crear ubicaciones ferroviarias, lo que requiere la extensi贸n del editor, lo que lleva a la necesidad de escribir un "motor dentro del motor".  Adem谩s, la creaci贸n de prefabricados y paquetes es imposible sin el uso del editor de Unity, y esto, como ha demostrado la pr谩ctica, no es muy conveniente, especialmente para modeladores y dise帽adores de niveles puros.  En cuanto a la UE, hice muchas preguntas sobre este y otros recursos durante dos a帽os sobre c贸mo separar el proceso de construcci贸n de un proyecto del proceso de agregar / cambiar los recursos que usa, y no obtuve una respuesta adecuada ni en la documentaci贸n ni en " inveterados "desarrolladores de juegos.  Ser铆a muy feliz (sin sarcasmo) si me topara razonablemente con algo que me perd铆. <br><br>  En cuanto al segundo requisito, tanto Unity como UE parecen proporcionar la capacidad de crear ubicaciones cargadas din谩micamente, pero la pregunta sigue sin respuesta, 驴c贸mo pueden crearse dichas ubicaciones independientemente del editor y sin reconstruir el proyecto?  Solo hay una salida: escribir un "motor dentro del motor", que cargar谩 la geometr铆a y las texturas "en bruto" (en cualquiera de los formatos de exportaci贸n establecidos previamente desde editores 3D), aplicar谩 todos los efectos necesarios y col贸quelas en el espacio en funci贸n de los datos descritos en un tercero independiente del formato del motor, que a煤n necesita ser desarrollado y ense帽ado para interpretar el motor. <br><br>  En relaci贸n con lo anterior, surge la pregunta: si para resolver este problema es necesario escribir una capa de software potente sobre el motor del juego, cuya mayor parte de la funcionalidad simplemente no es necesaria en el problema en consideraci贸n, entonces 驴por qu茅 necesitamos un motor de juego? <br><br>  Tal vez el motor de gr谩ficos es suficiente?  Le hice esta pregunta al equipo anterior, que abord贸 el problema en discusi贸n, confiando en Unity (y naturalmente se fusion贸 un poco m谩s tarde).  En respuesta, recibi贸 una contrapregunta: "驴Qu茅 sugieres?", Respondiendo que, en el esp铆ritu del texto anterior, recibi贸 la sonrisa sarc谩stica de un oponente. <br><br>  Si no tiene sarcasmo, la tarea presentada es una tarea t铆pica de visualizaci贸n: solo requiere un marco para trabajar con gr谩ficos, ya que tanto la f铆sica como el subsistema de audio basado en la f铆sica se implementan en el lado del servidor.  Mi equipo y yo llegamos a comprender este hecho, movi茅ndonos por inercia de los desarrolladores anteriores, primero hacia Unity, a trav茅s de UE e intentando sujetar el subsistema de gr谩ficos de uno de los simuladores de ferrocarril abierto (OpenBVE, que por cierto result贸, pero se convirti贸 en una muleta temporal) <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OpenSceneGraph</a> es, con mucho, el motor gr谩fico m谩s desarrollado (abierto y gratuito) centrado en el desarrollo de C ++.  Es ampliamente utilizado en el extranjero precisamente para la visualizaci贸n t茅cnica tridimensional.  Este motor no se libr贸 de ning煤n tipo de simulador, el m谩s famoso de los cuales es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FlightGear</a> .  Hubo una vez un simulador ferroviario basado en este motor: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Indra</a> , que, sin embargo, dej贸 solo capturas de pantalla aburridas del enlace de arriba y su destino adicional es desconocido para m铆. <br><br>  En el contexto de la tarea en cuesti贸n, el motor de gr谩ficos OSG tiene las siguientes cualidades positivas: <br><br><ul><li>  Multiplataforma, lo que hace posible su aplicaci贸n en el ecosistema GNU / Linux </li><li>  El lenguaje de desarrollo es C ++ / STL, lo que permite integrarlo f谩cil y naturalmente en el proceso tecnol贸gico de desarrollo establecido; </li><li>  La gama m谩s amplia de formatos de recursos admitidos "listos para usar": geometr铆a 3D y texturas debido al sistema de plug-in desarrollado.  Una interfaz simple e intuitiva para escribir sus propios complementos para configurar el administrador de recursos para formatos no est谩ndar, que utilizamos (escribir茅 sobre esto a continuaci贸n); </li><li>  Un sistema de gesti贸n de memoria basado en su propio modelo de punteros inteligentes (hist贸ricamente se ha utilizado un formato patentado de punteros inteligentes, debido al hecho de que al comienzo del desarrollo del motor de puntero inteligente no hab铆a un est谩ndar en C ++); </li><li>  Arquitectura modular flexible; </li><li>  El gestor de objetos de escena que carga din谩micamente objetos, proporciona carga y representaci贸n de solo aquellos objetos que caen dentro de la pir谩mide de recorte (debido a la clase osg :: PagedLOD) </li><li>  Capacidad para integrarse con el marco Qt.  Gracias al conveniente modelo de "se帽ales - ranuras" proporcionado por Qt, que simplifica y acelera significativamente el desarrollo de C ++, utilizamos ampliamente este marco para desarrollar software complejo de capacitaci贸n.  En consecuencia, hemos acumulado una importante base de c贸digo reutilizada en diferentes proyectos, especialmente con respecto a la biblioteca de comunicaci贸n entre procesos basada en sockets TCP.  Usar las capacidades de Qt en el proyecto del subsistema de video parece ser una decisi贸n l贸gica; </li><li>  Suficiente calidad de imagen para la tarea a resolver. </li></ul><br>  Tom贸 cerca de seis meses de estudio intensivo de las capacidades de OSG para "investigar el terreno" a fondo y encontrar enfoques para resolver el problema con este motor.  Lo que naci贸 como resultado merece una discusi贸n por separado. <br><br><h1>  4. De la arquitectura al prototipo de trabajo. </h1><br>  El subsistema de video de los simuladores de capacitaci贸n de material rodante (HTSC) es una aplicaci贸n cliente, denominada rutinariamente video3d-client, y realiza las siguientes funciones: <br><br><ul><li>  Solicitud de conexi贸n a la parte del servidor del simulador, autorizaci贸n en el servidor con solicitud peri贸dica posterior para el identificador de la ruta cargada, y luego la posici贸n actual del tren.  Si la conexi贸n se desconecta del lado del servidor, el sistema cambia al modo de espera para volver a conectarse; </li><li>  Descarga de la ruta seleccionada, organizaci贸n de la gesti贸n din谩mica de los contenidos de la escena renderizada; </li><li>  Realmente renderizando la escena de acuerdo con la posici贸n actual del tren en la ruta </li></ul><br>  No es que este proyecto fuera de c贸digo abierto, pero el c贸digo de una demostraci贸n de tecnolog铆a con todas las funciones se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu铆</a> .  El proyecto consta de los siguientes m贸dulos: <br><br><ul><li>  <i>sistema de archivos</i> : una biblioteca para trabajar con el sistema de archivos, proporciona la generaci贸n de rutas a archivos de configuraci贸n y recursos de aplicaciones </li><li>  <i>biblioteca</i> : una implementaci贸n multiplataforma del cargador din谩mico de bibliotecas.  En general, una muleta escrita en un momento en que las posibilidades de integraci贸n con Qt (donde hay un m贸dulo QLibrary listo para la batalla) todav铆a era vago </li><li>  <i>osgdb_dmd</i> es un complemento para cargar modelos de un formato espec铆fico para el motor DGLEngine versi贸n 1.1.  Para lo que se requiri贸, explicar茅 un poco m谩s abajo </li><li>  <i>route-loader</i> es una biblioteca que proporciona una interfaz abstracta para el cargador de rutas.  Es posible cargar rutas de formato arbitrario </li><li>  <i>tcp-connection</i> : biblioteca de comunicaci贸n entre procesos a trav茅s de sockets TCP </li><li>  <i>visor</i> - el principal m贸dulo ejecutable del programa </li><li>  <i>zds-route-loader</i> : complemento para cargar rutas del formato ZDSimulator </li></ul><br>  Al dise帽ar el VTPS, surgi贸 la pregunta de si desarrollar un formato de ruta de forma independiente, o usar el formato de ruta existente, as铆 como rutas ya preparadas de ferrocarriles dom茅sticos para el simulador ferroviario existente.  Afortunadamente, surgi贸 la decisi贸n: el producto cerrado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ZDSimulator</a> , que tiene la caracter铆stica de que est谩 dise帽ado para el material rodante nacional y los detalles de la red ferroviaria.  A pesar de los elogios de los autores del proyecto, tiene muchos inconvenientes importantes, pero tiene un formato simple y claro de rutas de acceso p煤blico.  En la primera etapa, era un pecado no aprovechar la oportunidad, a pesar de que la parte gr谩fica del simulador se basa en el motor abierto DGLEngine.  El problema es que este motor, aunque est谩 en desarrollo (el estado actual del proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se puede ver aqu铆</a> ), pero su segunda versi贸n actual es incompatible con la versi贸n 1.1, en la que se basa ZDSimulator.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los c贸digos fuente de la versi贸n 1.1 se pierden, los enlaces que conducen a ellos se han desvanecido durante mucho tiempo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una b煤squeda exhaustiva en el archivo web permiti贸 encontrar a los perdidos y guardarlos publicando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DGLEngine v1.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en Gtihub. </font><font style="vertical-align: inherit;">Este motor utiliza su propio formato espec铆fico de modelos 3D. </font><font style="vertical-align: inherit;">Teniendo la fuente del motor, fue f谩cil escribir el complemento apropiado para OSG. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, la tarea de crear HTPS se redujo a escribir la parte del software en el motor OSG. </font><font style="vertical-align: inherit;">En el futuro, se planea desarrollar su propio formato de rutas, ya que el formato actual permite el movimiento solo a lo largo de las rutas principales y tiene una serie de inconvenientes que no permiten recrear una serie de rutas complejas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La jerarqu铆a de las clases principales de HTPS se presenta en el siguiente diagrama</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/59/2l/sx/592lsx2l9c4ktp7q9j__9mqu3ic.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La jerarqu铆a de clases del cargador de rutas se ve as铆 </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dl/yw/lb/dlywlbrbkjuzxgl_3whfakiv11q.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El cargador de cualquier otro formato de ruta se puede escribir como un complemento que contiene una clase que hereda de la clase RouteLoader. </font><font style="vertical-align: inherit;">Al comienzo de VTPS, la ruta al directorio con la ruta se transfiere a ella, se determina el formato de la ruta y el complemento correspondiente se carga din谩micamente, lo que realiza el resto del trabajo sucio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un matiz fundamentalmente importante fue la integraci贸n del motor OSG y Qt. </font><font style="vertical-align: inherit;">Dicha integraci贸n existe y se llama </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osgQt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Esta biblioteca no se us贸 en este proyecto por dos razones:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No hay necesidad de controles de ventana proporcionados por Qt. </font><font style="vertical-align: inherit;">OSG tiene su propio sistema de gesti贸n de ventanas GUI bien desarrollado y no tiene sentido cerrar la GUI encima de otra GUI, ya que osgQt est谩 destinado principalmente a integrar el visor OSG en la GUI basada en Qt</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osgQt est谩 sujeto a un error: operaci贸n incorrecta con el contexto OpenGL, que en algunos casos no se puede dividir entre OSG y QGLWidget, debido a que la escena se muestra en cualquier lugar, pero no en el widget Qt. </font><font style="vertical-align: inherit;">Adem谩s, a煤n no ha sido posible descubrir las razones, ya que en algunos sistemas este error no se manifiesta.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se entendi贸 que la integraci贸n con Qt es necesaria en t茅rminos del uso del concepto de "ranuras de se帽al" para garantizar la interacci贸n con el subsistema de red de conexi贸n tcp que usa Qt y es el est谩ndar de facto en nuestros dise帽os. </font><font style="vertical-align: inherit;">Realmente no quer铆a confiar en el sistema de mensajer铆a OSG y reescribir el cliente TCP (e incluso multiplataforma). </font><font style="vertical-align: inherit;">Se encontr贸 una soluci贸n elegante, basada en el hecho de que si queremos que un objeto env铆e una se帽al que active una ranura para otro objeto, debemos cumplir tres condiciones:</font></font><br><br><ol><li>  Heredar clases interactivas de QObject </li><li>  Organice un bucle de procesamiento de se帽al </li><li>  Cree una instancia de la clase QApplication (o QCoreApplication) que existe en la memoria durante la operaci贸n de la aplicaci贸n </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este caso, en ning煤n caso debe realizar una llamada a QApplication :: exec (), que inicia el ciclo de procesamiento de se帽al regular, es suficiente para organizar un ciclo en el que sea f谩cil procesar se帽ales llamando a QApplication :: processEvents (). OSG tiene dicho ciclo (el ciclo en el que se realiza el renderizado) y es posible crear un controlador de eventos en el que se procesa el evento osgGA :: GUIEventAdapter :: FRAME generado por el motor cuando se procesa el siguiente marco. Por lo tanto, toda la integraci贸n se redujo a c贸digo</font></font><br><br>  <b>qt-events.h</b> <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> QT_EVENTS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> QT_EVENTS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;osgGA/GUIEventHandler&gt; #include &lt;QtCore/QtCore&gt; class QtEventsHandler : public osgGA::GUIEventHandler { public: QtEventsHandler(){} virtual bool handle(const osgGA::GUIEventAdapter &amp;ea, osgGA::GUIActionAdapter &amp;aa); protected: }; #endif // QT_EVENTS_H</span></span></span></span></code> </pre> <br><br>  <b>qt-events.cpp</b> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"qt-events.h"</span></span></span><span class="hljs-meta"> bool QtEventsHandler::handle(const osgGA::GUIEventAdapter &amp;ea, osgGA::GUIActionAdapter &amp;aa) { switch (ea.getEventType()) { case osgGA::GUIEventAdapter::FRAME: { QCoreApplication::processEvents(QEventLoop::AllEvents, 100); break; } default: break; } return false; }</span></span></code> </pre><br>  <b>main.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*! * \fn * \brief Entry point */</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//------------------------------------------------------------------------------ // //------------------------------------------------------------------------------ int main(int argc, char *argv[]) { QCoreApplication app(argc, argv); RouteViewer viewer(argc, argv); if (viewer.isReady()) return viewer.run(); return 0; }</span></span></span></span></code> </pre><br>  despu茅s de lo cual, las clases heredadas de QObject y sus derivados pueden intercambiar se帽ales hasta que se pierde el pulso. <br><br>  Todo lo anterior permiti贸 durante dos meses crear el primer prototipo funcional de HTPS.  Para demostrar lo que sucedi贸 al final, propongo la siguiente secci贸n de viajes experimentales en rutas reales.  Pido disculpas de antemano por la calidad de los disparos: no obtuvieron tecnolog铆a inteligente <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CENZVOC2ZxE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h1>  Conclusi贸n y conclusiones </h1><br>  La conclusi贸n principal, al menos para nuestro equipo, fue que no hab铆a una "bala gris" en la elecci贸n de la tecnolog铆a para implementar el proyecto.  Los motores de juego comercializados agresivamente no siempre son adecuados para resolver tareas espec铆ficas, que incluyen la visualizaci贸n de los resultados de los sistemas t茅cnicos de modelado.  Y si son adecuados, entonces no son 贸ptimos en t茅rminos de los esfuerzos dedicados al desarrollo y mantenimiento del proyecto. <br><br>  Es una pena que un motor de gr谩ficos OSG muy bueno y, lo m谩s importante, gratuito, de hecho, no tenga una comunidad en nuestro pa铆s.  Para solucionar este problema, escribo una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">serie de art铆culos aqu铆 sobre el recurso</a> (all铆 recopil茅 todos los enlaces a fuentes de informaci贸n m谩s o menos adecuadas, incluso en ruso).  Adem谩s, como documentaci贸n que describe los principios b谩sicos de OSG, tambi茅n puedo ofrecer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este blog</a> .  Espero que alguien encuentre 煤til esta informaci贸n. <br><br>  En cuanto a HTSC, el trabajo en esta direcci贸n contin煤a.  Todav铆a hay muchas tareas importantes que deben resolverse en el futuro cercano. <br><br>  Gracias por su atencion! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">(c) Centro para el Desarrollo de Competencias de Innovaci贸n</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es436276/">https://habr.com/ru/post/es436276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es436266/index.html">Escalamiento extremo en Alibaba JDK</a></li>
<li><a href="../es436268/index.html">Recopilamos un mazo completo</a></li>
<li><a href="../es436270/index.html">El 35% de la audiencia de Runet no usa una computadora para Internet</a></li>
<li><a href="../es436272/index.html">Programaci贸n visual para Sonoff Basic</a></li>
<li><a href="../es436274/index.html">Se est谩 creando una aplicaci贸n m贸vil para el registro de accidentes en Rusia</a></li>
<li><a href="../es436278/index.html">Verificaci贸n de un proyecto CDK con el analizador est谩tico IntelliJ IDEA</a></li>
<li><a href="../es436282/index.html">Desaf铆o de una empresa extranjera o c贸mo fall茅 una entrevista</a></li>
<li><a href="../es436284/index.html">Hackear Amazon Echo y Google Home para proteger la privacidad</a></li>
<li><a href="../es436288/index.html">驴C贸mo comenz贸 el monopolio, o un peque帽o alboroto con la PC 5150 de IBM?</a></li>
<li><a href="../es436292/index.html">Controlar, modificar, eliminar: los 10 mejores informes de DotNext 2018 Mosc煤</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>