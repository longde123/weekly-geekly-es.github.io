<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌼 📫 🏂🏿 Proxy PHP Xdebug: ketika fitur standar Xdebug tidak cukup ➕ 🏪 ➡️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk debugging program PHP sering menggunakan Xdebug . Namun, fitur standar IDE dan Xdebug tidak selalu cukup. Beberapa masalah dapat diselesaikan de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Proxy PHP Xdebug: ketika fitur standar Xdebug tidak cukup</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/442504/"><p><img src="https://habrastorage.org/webt/qr/30/pd/qr30pdoglljz7da1c8uooyutxu8.jpeg" alt="Proxy PHP Xdebug: ketika fitur standar Xdebug tidak cukup"></p><br><p>  Untuk debugging program PHP sering menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Xdebug</a> .  Namun, fitur standar IDE dan Xdebug tidak selalu cukup.  Beberapa masalah dapat diselesaikan dengan menggunakan proxy Xdebug - pydbgpproxy, tetapi masih belum semuanya.  Oleh karena itu, saya mengimplementasikan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proksi PHP Xdebug</a> berdasarkan kerangka kerja asinkron amphp. </p><br><p>  Di bawah potongan, saya akan memberi tahu Anda apa yang salah dengan pydbgpproxy, apa yang hilang di dalamnya dan mengapa saya tidak memodifikasinya.  Saya juga akan menjelaskan bagaimana proksi PHP Xdebug bekerja dan menunjukkan cara memperpanjangnya menggunakan contoh. <a name="habracut"></a></p><br><h2 id="pydbgpproxy-vs-php-xdebug-proxy">  Pydbgpproxy vs PHP Xdebug proxy </h2><br><p>  Proxy Xdebug adalah layanan perantara antara IDE dan Xdebug (permintaan proksi dari Xdebug ke IDE dan sebaliknya).  Paling sering digunakan untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">debugging multi-pengguna</a> .  Ini adalah ketika Anda memiliki satu server web, dan beberapa pengembang. </p><br><p>  Sebagai proxy, pydbgpxxy biasanya digunakan.  Tetapi dia memiliki beberapa masalah: </p><br><ul><li>  tidak ada halaman resmi; </li><li>  sulit menemukan tempat untuk mengunduhnya;  ternyata ini dapat dilakukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> - tiba-tiba, Klien Debugging Jarak Jauh Python; </li><li>  Saya tidak menemukan repositori resmi; </li><li>  sebagai konsekuensi dari paragraf sebelumnya, tidak jelas kemana harus mengajukan permintaan tarik; </li><li>  proxy, seperti namanya, ditulis dalam Python, yang tidak semua pengembang PHP tahu, yang berarti memperluasnya adalah masalah; </li><li>  kelanjutan dari paragraf sebelumnya: jika ada kode dalam PHP, dan itu harus digunakan dalam proxy, maka harus porting ke Python, dan duplikasi kode selalu tidak baik. </li></ul><br><p>  Pencarian untuk proxy Xdebug yang ditulis dalam PHP di GitHub dan di Internet tidak membuahkan hasil.  Jadi saya menulis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proksi PHP Xdebug</a> .  Di bawah tenda, saya menggunakan kerangka asynchronous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">amphp</a> . </p><br><p>  Keuntungan utama proksi PHP Xdebug dibandingkan pydbgpproxy: </p><br><ul><li>  Proxy PHP Xdebug ditulis dalam bahasa yang akrab bagi pengembang PHP, yang berarti: <br><ul><li>  lebih mudah untuk memecahkan masalah di dalamnya; </li><li>  lebih mudah berkembang; </li></ul></li><li>  Proxy PHP Xdebug memiliki repositori publik, yang berarti: <br><ul><li>  Anda dapat melakukan fork dan menyelesaikannya sesuai kebutuhan Anda; </li><li>  Anda dapat mengirim permintaan tarik dengan fitur yang hilang atau solusi untuk masalah. </li></ul></li></ul><br><h2 id="kak-rabotat-s-php-xdebug-proxy">  Cara bekerja dengan proksi PHP Xdebug </h2><br><h3 id="ustanovka">  Instalasi </h3><br><p>  Proxy PHP Xdebug dapat diinstal sebagai dependensi dev melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">komposer</a> : </p><br><pre><code class="bash hljs">composer.phar require mougrim/php-xdebug-proxy --dev</code> </pre> <br><p>  Tetapi jika Anda tidak ingin menyeret dependensi tambahan ke proyek Anda, maka proksi PHP Xdebug dapat diinstal sebagai proyek melalui komposer yang sama: </p><br><pre> <code class="bash hljs">composer.phar create-project mougrim/php-xdebug-proxy <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-xdebug-proxy</code> </pre> <br><p>  Proxy PHP Xdebug dapat dikembangkan, tetapi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ext-dom</a> diperlukan secara default (ekstensi diaktifkan secara default di PHP) untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mem-</a> parsing XML dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">amphp / log</a> untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">logging</a> asinkron: </p><br><pre> <code class="bash hljs">composer.phar require amphp/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">'^1.0.0'</span></span></code> </pre> <br><h3 id="zapusk">  Luncurkan </h3><br><p><img src="https://habrastorage.org/webt/jb/n4/dc/jbn4dcyqwpirx7koyqjzwxfwozc.jpeg" alt="Proxy PHP Xdebug"></p><br><p>  Proxy dimulai sebagai berikut: </p><br><pre> <code class="bash hljs">bin/xdebug-proxy</code> </pre> <br><p>  Proxy akan mulai dengan pengaturan default: </p><br><pre> <code class="plaintext hljs">Using config path /path/to/php-xdebug-proxy/config [2019-02-14 10:46:24] xdebug-proxy.NOTICE: Use default ide: 127.0.0.1:9000 array ( ) array ( ) [2019-02-14 10:46:24] xdebug-proxy.NOTICE: Use predefined ides array ( 'predefinedIdeList' =&gt; array ( 'idekey' =&gt; '127.0.0.1:9000', ), ) array ( ) [2019-02-14 10:46:24] xdebug-proxy.NOTICE: [Proxy][IdeRegistration] Listening for new connections on '127.0.0.1:9001'... array ( ) array ( ) [2019-02-14 10:46:24] xdebug-proxy.NOTICE: [Proxy][Xdebug] Listening for new connections on '127.0.0.1:9002'... array ( ) array ( )</code> </pre> <br><p>  Dari log Anda dapat melihat bahwa proxy default: </p><br><ul><li>  mendengarkan <code>127.0.0.1:9001</code> untuk koneksi login IDE; </li><li>  mendengarkan <code>127.0.0.1:9002</code> untuk koneksi Xdebug; </li><li>  menggunakan <code>127.0.0.1:9000</code> sebagai IDE default dan IDE yang telah ditentukan sebelumnya dengan kunci idekey. </li></ul><br><h3 id="konfiguraciya">  Konfigurasi </h3><br><p>  Jika Anda ingin mengonfigurasi port mendengarkan, dll., Anda dapat menentukan jalur ke folder pengaturan.  Cukup salin folder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">konfigurasi</a> : </p><br><pre> <code class="bash hljs">cp -r /path/to/php-xdebug-proxy/config /your/custom/path</code> </pre> <br><p>  Ada tiga file di folder pengaturan: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>config.php</code></a> : <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'xdebugServer'</span></span> =&gt; [ <span class="hljs-comment"><span class="hljs-comment">// host:port    Xdebug 'listen' =&gt; '127.0.0.1:9002', ], 'ideServer' =&gt; [ //  proxy    IDE,     IDE  , //    IDE  ,     . // IDE   ,  proxy    . 'defaultIde' =&gt; '127.0.0.1:9000', //  IDE    'idekey' =&gt; 'host:port', //   IDE  ,     . //  IDE ,   proxy  , //           proxy. 'predefinedIdeList' =&gt; [ 'idekey' =&gt; '127.0.0.1:9000', ], ], 'ideRegistrationServer' =&gt; [ // host:port     IDE, //     IDE,     . 'listen' =&gt; '127.0.0.1:9001', ], ];</span></span></code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>logger.php</code></a> : Anda dapat mengkonfigurasi logger;  file tersebut harus mengembalikan objek yang merupakan instance dari <code>\Psr\Log\LoggerInterface</code> , defaultnya adalah <code>\Monolog\Logger</code> dengan <code>\Amp\Log\StreamHandler</code> (untuk rekaman yang tidak menghalangi), menampilkan log ke stdout; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>factory.php</code></a> : Anda bisa mengonfigurasi kelas yang digunakan dalam proxy;  file tersebut harus mengembalikan objek yang merupakan turunan dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>Factory\Factory</code></a> , defaultnya adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>Factory\DefaultFactory</code></a> . </li></ul><br><p>  Setelah menyalin file, Anda dapat mengedit dan menjalankan proxy: </p><br><pre> <code class="bash hljs">bin/xdebug-proxy --configs=/your/custom/path/config</code> </pre> <br><h3 id="otladka">  Debugging </h3><br><p>  Banyak artikel telah ditulis tentang cara men-debug kode menggunakan Xdebug.  Saya akan perhatikan poin utama. </p><br><p>  Di php.ini, pengaturan berikut harus di bagian <code>[xdebug]</code> (koreksi jika berbeda dari yang standar): </p><br><ul><li>  idekey = idekey </li><li>  remote_host = 127.0.0.1 </li><li>  remote_port = 9002 </li><li>  remote_enable = Aktif </li><li>  remote_autostart = Hidup </li><li>  remote_connect_back = Mati </li></ul><br><p>  Kemudian Anda dapat menjalankan kode PHP yang di-debug: </p><br><pre> <code class="bash hljs">php /path/to/your/script.php</code> </pre> <br><p>  Jika Anda melakukan semuanya dengan benar, maka debugging akan dimulai dari breakpoint pertama di IDE.  Debugging dalam mode php-fpm oleh beberapa pengembang berada di luar cakupan artikel ini, tetapi dijelaskan, misalnya, di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </p><br><h2 id="rasshirenie-funkciy-proxy">  Fitur proxy ekstensi </h2><br><p>  Segala sesuatu yang kami periksa di atas, pydbgpproksi juga dapat mencapai tingkat tertentu. </p><br><p>  Sekarang mari kita bicara tentang proxy PHP Xdebug yang paling menarik.  Proxy dapat diperluas menggunakan pabrik Anda sendiri (dibuat di konfigurasi <code>factory.php</code> , lihat di atas).  Pabrik harus mengimplementasikan antarmuka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>Factory\Factory</code></a> . </p><br><p>  Yang paling kuat adalah yang disebut penyusun permintaan.  Mereka dapat memodifikasi permintaan dari Xdebug ke IDE dan sebaliknya.  Untuk menambahkan <code>Factory\DefaultFactory::createRequestPreparers()</code> kueri, Anda harus mengganti metode <code>Factory\DefaultFactory::createRequestPreparers()</code> .  Metode mengembalikan array objek yang mengimplementasikan antarmuka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>RequestPreparer\RequestPreparer</code></a> .  Ketika mem-proksi permintaan dari Xdebug ke IDE, mereka dieksekusi dalam urutan langsung, ketika memproksi permintaan dari IDE ke Xdebug, itu dibalik. </p><br><p>  Penangan kueri dapat digunakan, misalnya, untuk mengubah jalur ke file (dalam breakpoints dan file yang dapat dieksekusi). </p><br><h3 id="debag-perepisannyh-faylov">  Debug menimpa file </h3><br><p>  Untuk memberikan contoh tentang persiapan, saya akan membuat sedikit penyimpangan.  Dalam pengujian unit, kami menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">soft-mock</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> ).  Soft-mock memungkinkan Anda untuk mengganti fungsi, metode statis, konstanta, dll dalam pengujian, merupakan alternatif untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">runkit</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">uopz</a> .  Ini berfungsi dengan menulis ulang file PHP dengan cepat.  Demikian pula, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AspectMock</a> masih berfungsi. </p><br><p>  Tetapi fitur standar Xdebug dan IDE memungkinkan Anda untuk men-debug ditulis ulang (memiliki jalur yang berbeda), daripada file aslinya. </p><br><p>  Mari kita lihat lebih dekat masalah debugging menggunakan soft-mock dalam pengujian.  Pertama, ambil kasus di mana kode PHP dieksekusi secara lokal. </p><br><p>  Kesulitan pertama muncul pada tahap pengaturan breakpoints (breakpoints).  Dalam IDE, mereka dipasang di file asli, bukan yang ditulis ulang.  Untuk meletakkan breakpoint melalui IDE, Anda perlu menemukan file yang ditulis ulang yang sebenarnya.  Masalahnya diperparah oleh fakta bahwa setiap kali file asli diubah, file yang ditulis ulang baru dibuat, yaitu, untuk setiap konten file yang unik akan ada file yang ditulis ulang yang unik. </p><br><p>  Masalah ini dapat diselesaikan dengan memanggil fungsi <code>xdebug_break()</code> , yang mirip dengan pengaturan breakpoint.  Dalam hal ini, tidak perlu mencari file yang ditulis ulang. </p><br><p>  Sekarang pertimbangkan situasinya lebih rumit: aplikasi berjalan pada mesin jarak jauh. </p><br><p>  Dalam hal ini, Anda dapat memasang folder dengan file yang ditulis ulang, misalnya, melalui SSHFS.  Jika jalur lokal dan jarak jauh ke folder berbeda, maka Anda masih perlu mendaftarkan pemetaan di IDE. </p><br><p>  Dengan satu atau lain cara, metode ini sedikit berbeda dari yang biasa dan memungkinkan Anda untuk men-debug hanya file yang disalin, tetapi tidak yang asli.  Tetapi saya masih ingin mengedit dan men-debug file asli yang sama. </p><br><p>  AspectMock mengatasi masalah dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengaktifkan mode debug</a> tanpa kemampuan untuk menonaktifkannya: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $options = [])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($options[<span class="hljs-string"><span class="hljs-string">'excludePaths'</span></span>])) { $options[<span class="hljs-string"><span class="hljs-string">'excludePaths'</span></span>] = []; } $options[<span class="hljs-string"><span class="hljs-string">'debug'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; $options[<span class="hljs-string"><span class="hljs-string">'excludePaths'</span></span>][] = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::init($options); }</code> </pre> <br><p>  Dalam contoh pengujian sederhana, mode debug lebih lambat 20 persen, tetapi saya tidak memiliki cukup tes AspectMock untuk memberikan perkiraan yang lebih akurat tentang seberapa lambatnya.  Jika Anda memiliki banyak tes di AspectMock, saya akan senang jika Anda membagikan perbandingan di komentar. </p><br><h3 id="ispolzovanie-xdebug-s-soft-mocks">  Menggunakan Xdebug dengan soft-mock </h3><br><p><img src="https://habrastorage.org/webt/eu/3d/ui/eu3duipif0jihrhzwlquhfpywuc.jpeg" alt="Xdebug + soft-mock"></p><br><p>  Sekarang masalahnya sudah jelas, pertimbangkan bagaimana menyelesaikannya menggunakan proxy PHP Xdebug.  Bagian utama adalah di kelas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>RequestPreparer\SoftMocksRequestPreparer</code></a> . </p><br><p>  Di konstruktor kelas, tentukan path ke skrip inisialisasi soft-mock dan jalankan (diasumsikan bahwa soft-mock terhubung sebagai dependensi, tetapi setiap jalur dapat dilewati ke konstruktor): </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LoggerInterface $logger, string $initScript = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger = $logger; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$initScript) { $possibleInitScriptPaths = [ <span class="hljs-comment"><span class="hljs-comment">// proxy   , soft-mocks —    __DIR__.'/../../vendor/badoo/soft-mocks/src/init_with_composer.php', // proxy  soft-mocks    __DIR__.'/../../../../badoo/soft-mocks/src/init_with_composer.php', ]; foreach ($possibleInitScriptPaths as $possiblInitScriptPath) { if (file_exists($possiblInitScriptPath)) { $initScript = $possiblInitScriptPath; break; } } } if (!$initScript) { throw new Error("Can't find soft-mocks init script"); } //  soft-mocks (       ..) require $initScript; }</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/9p/8t/u7/9p8tu7eatpdhaewvfxvv2ossunu.jpeg" alt="Xdebug + soft-mock: dari Xdebug ke IDE"></p><br><p>  Untuk menyiapkan permintaan dari Xdebug ke IDE, Anda perlu mengganti path ke file yang ditulis ulang dengan file asli: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareRequestToIde</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XmlDocument $xmlRequest, string $rawRequest)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $context = [ <span class="hljs-string"><span class="hljs-string">'request'</span></span> =&gt; $rawRequest, ]; $root = $xmlRequest-&gt;getRoot(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$root) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($root-&gt;getChildren() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $child) { <span class="hljs-comment"><span class="hljs-comment">//         : // - 'stack': https://xdebug.org/docs-dbgp.php#stack-get // - 'xde</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">bug:</span></span></span><span class="hljs-comment">message': https://xdebug.org/docs-dbgp.php#error-notification if (!in_array($child-&gt;getName(), ['stack', 'xde</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">bug:</span></span></span><span class="hljs-comment">message'], true)) { continue; } $attributes = $child-&gt;getAttributes(); if (isset($attributes['filename'])) { //         ,      $filename = $this-&gt;getOriginalFilePath($attributes['filename'], $context); if ($attributes['filename'] !== $filename) { $this-&gt;logger-&gt;info("Change '{$attributes['filename']}' to '{$filename}'", $context); $child-&gt;addAttribute('filename', $filename); } } } }</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/6h/qw/er/6hqwerwharffc9a_ylzobqxut9o.jpeg" alt="Xdebug + soft-mock: dari IDE ke Xdebug"></p><br><p>  Untuk menyiapkan permintaan dari IDE ke Xdebug, Anda perlu mengganti path ke file asli dengan path ke yang ditulis ulang: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareRequestToXdebug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $request, CommandToXdebugParser $commandToXdebugParser)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       [$command, $arguments] = $commandToXdebugParser-&gt;parseCommand($request); $context = [ 'request' =&gt; $request, 'arguments' =&gt; $arguments, ]; if ($command === 'breakpoint_set') { //    -f,          // . https://xdebug.org/docs-dbgp.php#id3 if (isset($arguments['-f'])) { $file = $this-&gt;getRewrittenFilePath($arguments['-f'], $context); if ($file) { $this-&gt;logger-&gt;info("Change '{$arguments['-f']}' to '{$file}'", $context); $arguments['-f'] = $file; //    $request = $commandToXdebugParser-&gt;buildCommand($command, $arguments); } } else { $this-&gt;logger-&gt;error("Command {$command} is without argument '-f'", $context); } } return $request; }</span></span></code> </pre> <br><p>  Agar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>Factory\DefaultFactory</code></a> kueri berfungsi, Anda perlu membuat kelas pabrik dan mewarisinya dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>Factory\DefaultFactory</code></a> , atau mengimplementasikan antarmuka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>Factory\Factory</code></a> .  Untuk soft- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>Factory\SoftMocksFactory</code></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>Factory\SoftMocksFactory</code></a> terlihat seperti ini: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoftMocksFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $config)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Config</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       return new SoftMocksConfig($config); } public function createRequestPreparers(LoggerInterface $logger, Config $config): array { $requestPreparers = parent::createRequestPreparers($logger, $config); return array_merge($requestPreparers, [$this-&gt;createSoftMocksRequestPreparer($logger, $config)]); } public function createSoftMocksRequestPreparer(LoggerInterface $logger, SoftMocksConfig $config): SoftMocksRequestPreparer { //     init-   return new SoftMocksRequestPreparer($logger, $config-&gt;getSoftMocks()-&gt;getInitScript()); } }</span></span></code> </pre> <br><p>  Di sini Anda memerlukan kelas konfigurasi Anda sendiri sehingga Anda dapat menentukan jalur skrip init soft-mock.  Apa itu, Anda bisa lihat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Config \ SoftMocksConfig</a> . </p><br><p>  Hanya sedikit yang tersisa: untuk membuat pabrik baru dan menunjukkan jalur ke skrip init soft-mock.  Cara ini dilakukan dapat dilihat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>softMocksConfig</code></a> . </p><br><h3 id="neblokiruyuschiy-api">  API non-pemblokiran </h3><br><p>  Seperti yang saya tulis di atas, proksi PHP Xdebug menggunakan amphp di bawah tenda, yang berarti bahwa API non-pemblokiran harus digunakan untuk bekerja dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">I / O.</a>  Apmphp sudah memiliki banyak komponen yang mengimplementasikan API non-pemblokiran ini.  Jika Anda akan memperpanjang proxy PHP Xdebug dan menggunakannya dalam mode multi-pengguna, maka pastikan untuk menggunakan API non-pemblokiran. </p><br><h2 id="vyvody">  Kesimpulan </h2><br><p>  Proxy PHP Xdebug masih merupakan proyek yang cukup muda, tetapi di Badoo sudah aktif digunakan untuk men-debug tes menggunakan soft-mock. </p><br><p>  Proxy PHP Xdebug: </p><br><ul><li>  menggantikan pydbgpproxy dalam debugging multi-pengguna; </li><li>  dapat bekerja dengan soft-mock; </li><li>  dapat diperluas: <br><ul><li>  Anda dapat mengganti jalur ke file yang berasal dari IDE dan dari Xdebug; </li><li>  statistik dapat dikumpulkan: dalam mode debug, setidaknya konteks yang dapat dieksekusi tersedia ketika debugging (nilai variabel dan baris kode yang dapat dieksekusi). </li></ul></li></ul><br><p>  Jika Anda menggunakan proxy Xdebug untuk apa pun selain debugging multi-pengguna, maka bagikan kasus Anda dan proxy Xdebug yang Anda gunakan dalam komentar. </p><br><p>  Jika Anda menggunakan pydbgpproksi atau proksi Xdebug lainnya, maka coba proksi PHP Xdebug, ceritakan masalah Anda, bagikan permintaan penarikan.  Ayo kembangkan proyek bersama!  :) </p><br><p>  PS Terima kasih kepada kolega saya Yevgeny <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Makhrov</a> alias <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">eZH</a> untuk gagasan proxy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">smdbgpproxy</a> ! </p><br><h2 id="eschyo-raz-ssylki">  Tautan lagi </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PHP Xdebug proxy</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proxy</a> Xdebug, yang dibahas dalam artikel; </li><li>  pydbgpproxy dapat diunduh di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> - tiba-tiba, Klien Debugging Jarak Jauh Python; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">amphp</a> - kerangka kerja PHP non-blocking asinkron; </li><li>  alat untuk mock-s: <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">soft-mock</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AspectMock</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">uopz</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">runkit</a> . </li></ul></li></ul><br><p>  Terima kasih atas perhatian anda! </p><br><p>  Saya akan senang memberikan komentar dan saran. </p><br><p>  Rinat Akhmadeev, Sr.  Pengembang PHP </p><br><p>  <strong>UPD</strong> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Terjemahan</a> artikel yang dipublikasikan ke dalam bahasa Inggris. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id442504/">https://habr.com/ru/post/id442504/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id442494/index.html">Komponen Figma dan organisasi contoh menggunakan Userpic sebagai contoh</a></li>
<li><a href="../id442496/index.html">Babi perusahaan</a></li>
<li><a href="../id442498/index.html">10 laporan teratas konferensi C ++ Russia 2018: video lengkap, slide, komentar</a></li>
<li><a href="../id442500/index.html">Detekt Static Analyzer untuk Kotlin</a></li>
<li><a href="../id442502/index.html">Kami mengubah tempat kerja menjadi berbaring seharga $ 200</a></li>
<li><a href="../id442506/index.html">Apakah Rusia dihukum karena perdagangan ilegal dalam data pribadi?</a></li>
<li><a href="../id442508/index.html">Bagaimana udalenka mempercepat inovasi di GitLab</a></li>
<li><a href="../id442512/index.html">Kustomisasi Django ORM pada contoh ZomboDB</a></li>
<li><a href="../id442514/index.html">Sistem terdistribusi. Pola desain. Ulasan Buku</a></li>
<li><a href="../id442516/index.html">Panduan Pandas untuk Analisis Data Besar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>