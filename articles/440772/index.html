<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÑ ü•™ ü§Ωüèø Dise√±o impulsado por dominios: una receta para un pragm√°tico üõ£Ô∏è üëé üöï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øPor qu√© los DDD generalmente se abordan desde el lado equivocado? ¬øY de qu√© lado quieres? ¬øQu√© tienen que ver las jirafas y los ornitorrincos con tod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dise√±o impulsado por dominios: una receta para un pragm√°tico</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/440772/"><img src="https://habrastorage.org/webt/0d/g2/_y/0dg2_yqhafnwjnnd2iqwabmrysc.jpeg"><br>  ¬øPor qu√© los DDD generalmente se abordan desde el lado equivocado?  ¬øY de qu√© lado quieres?  ¬øQu√© tienen que ver las jirafas y los ornitorrincos con todo esto? <br><br>  Especialmente para Habr: una transcripci√≥n de texto del informe "Dise√±o impulsado por el dominio: una receta para un pragm√°tico".  El informe se realiz√≥ en la conferencia DotNext .NET, pero puede ser √∫til no solo para los donantes, sino para todos los que est√©n interesados ‚Äã‚Äãen DDD (creemos que dominar√° un par de ejemplos de c√≥digo C #).  Tambi√©n se adjunta una grabaci√≥n de video del informe. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CR9mLGN9jh0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Hola a todos, mi nombre es Alexey Merson.  Te dir√© qu√© es el dise√±o impulsado por dominio y cu√°l es su esencia, pero primero, descubramos por qu√© es necesario. <br><br><img src="https://habrastorage.org/webt/mb/3q/2v/mb3q2vmpui3hndlrdyxscvi-ovo.jpeg"><br><br>  Martin Fowler dijo: "Hay pocas cosas que son menos l√≥gicas que la l√≥gica de negocios".  La jirafa es definitivamente una de estas pocas.  La distancia entre el cerebro y la laringe de una jirafa es de solo unos cent√≠metros.  Sin embargo, el nervio que los conecta alcanza los 4 metros.  Primero, baja por todo el cuello, all√≠ rodea la arteria y luego regresa casi de la misma manera. <br><br>  A primera vista, realmente no hay l√≥gica.  Pero este es solo un denso legado que qued√≥ de los peces antiguos.  En los peces, como saben, no hay cuello, por lo que este nervio recorre el camino √≥ptimo.  Y cuando aparecieron los mam√≠feros despu√©s de varios millones de a√±os de refactorizaci√≥n, el nervio tuvo que extenderse para mantener la compatibilidad con versiones anteriores.  Bueno, ¬øno remodelas por alguna jirafa? <br><br>  Pero la jirafa est√° bien, porque hay un ornitorrinco. <br><br><img src="https://habrastorage.org/webt/j0/fv/t3/j0fvt3ieyzwdykfidna95z9w-vw.jpeg"><br>  Pi√©nsalo bien.  El mamifero  Con un pico.  Vive principalmente en el agua.  Pone huevos.  Y adem√°s, venenoso.  Puede parecer que la √∫nica explicaci√≥n l√≥gica de su existencia es que √©l es de Australia. <br><br>  Pero creo que todo es m√°s banal.  El contratista simplemente se olvid√≥ del dise√±o y ahorr√≥ con StackOverflow, bueno, o lo que hab√≠a en esos d√≠as. <br><img src="https://habrastorage.org/webt/hr/xm/lw/hrxmlwxz0r0fwr4xfrueljqhc7e.jpeg"><br>  S√© lo que est√°s pensando ahora: "Alexey, bueno, ¬°nos prometiste un dise√±o impulsado por dominio, y aqu√≠ hay una especie de" en el mundo animal "!" <br><br>  Colegas, ¬øqu√© es el desarrollo?  El desarrollo es cuando tomamos parte del mundo real, un proceso de negocios, y lo convertimos en c√≥digo, es decir, construimos un modelo de software.  ¬øQu√© problemas nos esperan en el camino? <br><br>  El primero es la complejidad de los procesos comerciales en s√≠ mismos, es decir, la dificultad de comprender c√≥mo funciona el negocio, qu√© procesos tienen lugar all√≠, seg√∫n la l√≥gica con la que se construyen. <br><br>  El segundo problema es la implementaci√≥n de estos procesos de negocio en forma de c√≥digo, el uso de los patrones correctos, los enfoques correctos, etc.  Este tambi√©n es un tema bastante complicado. <br><img src="https://habrastorage.org/webt/41/de/a2/41dea2lr4g73nouzxekhq8-t3qm.jpeg"><br>  Mire, los procesos comerciales son como esa jirafa: comenzaron con los unicelulares m√°s simples, y luego "lo" mira, y nadie entiende "de d√≥nde vino" o "c√≥mo funciona". <br><br>  Para construir un modelo exitoso de dicho proceso, primero debe responder la pregunta "¬øpor qu√©?".  ¬øPor qu√© queremos construir este modelo?  ¬øQu√© objetivos queremos alcanzar?  Despu√©s de todo, si el cliente quer√≠a una jirafa de peluche, pero ten√≠a las agallas, se molestar√≠a, incluso si la digesti√≥n en este modelo se implementa por el bien de los ojos.  Y el cliente perder√° no solo dinero y tiempo, perder√° la confianza en nosotros como desarrolladores, y nosotros perderemos nuestra reputaci√≥n y cliente. <br><br>  Pero incluso si descubrimos los objetivos, esto todav√≠a no garantiza que no obtendremos el ornitorrinco como resultado.  El hecho es que el objetivo es poco para entender.  El objetivo debe ser alcanzado.  Y esto nos ayuda a un dise√±o basado en dominio. <br><img src="https://habrastorage.org/webt/qb/dz/ib/qbdzibra6bypzj_36zfv-dnhlti.jpeg"><br>  El objetivo principal del dise√±o impulsado por dominio es combatir la complejidad de los procesos comerciales y su automatizaci√≥n e implementaci√≥n en c√≥digo.  "Dominio" se traduce como "dominio", y el desarrollo y el dise√±o dentro del marco de este enfoque se alejan del dominio. <br><br>  El dise√±o controlado por dominio incluye muchas cosas.  Esta planificaci√≥n estrat√©gica, y la interacci√≥n entre las personas, los enfoques de la arquitectura y los patrones t√°cticos, es todo un arsenal que realmente funciona y realmente ayuda a hacer proyectos.  Solo hay un "pero".  Antes de comenzar a lidiar con la complejidad con el dise√±o impulsado por dominio, debe aprender a lidiar con la complejidad del dise√±o impulsado por dominio. <br><br><img src="https://habrastorage.org/webt/ho/xz/9k/hoxz9k3iyujhnbgzlt8dlfzd4b0.png"><br><br>  Cuando una persona comienza a sumergirse en este tema, se le cae una gran cantidad de informaci√≥n: libros gruesos, un mont√≥n de art√≠culos, patrones, ejemplos.  Todo esto es confuso, y es f√°cil, como dicen, no darse cuenta detr√°s de los √°rboles del bosque.  Una vez sent√≠ esto en m√≠ mismo, pero hoy quiero compartir mi experiencia con usted y ayudarlo a atravesar esta jungla, finalmente comenzando a usar el dise√±o impulsado por dominio. <br><img src="https://habrastorage.org/webt/bm/mi/hs/bmmihsln4udtdm2d892qwb9elmo.jpeg"><br>  El t√©rmino dise√±o impulsado por el dominio fue propuesto por Eric Evans en 2003 en su libro impronunciable, que la comunidad simplemente llama el Libro Azul.  El problema es que la primera mitad del libro Evans habla sobre patrones t√°cticos (todos los conocen: son f√°bricas, entidades, repositorios, servicios), y las personas generalmente no llegan a la segunda mitad.  El hombre mira: todo es familiar, ir√© a buscar la aplicaci√≥n DDD. <br><img src="https://habrastorage.org/webt/7y/xz/_r/7yxz_r9ayavde_qjite3vti58fi.jpeg"><br>  A la derecha est√° lo que sucede si lanzas locamente patrones t√°cticos en el compilador.  Izquierda: si usa patrones estrat√©gicos. <br><br><img src="https://habrastorage.org/webt/g9/bd/cj/g9bdcj-skoztnm7s3rsbxyo9w68.jpeg"><br><br>  Desde el lanzamiento del Libro Azul, se ha formado una comunidad DDD bastante fuerte, se han repensado muchas cosas.  S√≠, y el propio Evans admiti√≥ que ya no comprende c√≥mo podr√≠a poner fin a algo tan importante como el dise√±o estrat√©gico. <br><br>  Y 10 a√±os despu√©s, en 2013, el Libro Rojo fue publicado por Vaughn Vernon.  Y en este libro, la presentaci√≥n ya est√° construida en el orden correcto: comienza con el dise√±o estrat√©gico, con lo b√°sico.  Y cuando el lector ha recibido la base necesaria, ya comienzan a hablar sobre patrones t√°cticos y detalles de implementaci√≥n. <br><br>  Por lo general, en los informes sobre DDD recomiendan leer Evans, en Internet incluso hay manuales completos en el orden en que debe leer los cap√≠tulos para una inmersi√≥n adecuada.  Recomiendo hacerlo m√°s f√°cilmente: comience con el Libro Rojo, l√©alo y luego contin√∫e con Azul. <br><br>  Y dado que el dise√±o estrat√©gico es algo tan importante, hablemos de sus ideas clave. <br><br><h2>  "Ideas clave del dise√±o estrat√©gico" </h2><br>  En cualquier proyecto de automatizaci√≥n de negocios, siempre hay expertos en dominios.  Estas son personas que entienden mejor c√≥mo funcionan los procesos de negocio que se van a modelar.  Estos pueden ser desarrolladores l√≠deres, ejecutivos, altos directivos.  En general, puede ser cualquiera, si solo √©l comprende los procesos comerciales con los que tenemos que lidiar. <br><br><img src="https://habrastorage.org/webt/c0/s1/ho/c0s1ho_prs7h-b-qbkh7_rrroaa.jpeg"><br><br>  Por otro lado, hay expertos t√©cnicos: desarrolladores, arquitectos que est√°n directamente involucrados en la automatizaci√≥n e implementaci√≥n de aplicaciones.  En el ejemplo representado, el cliente probablemente quer√≠a un ferrocarril para ni√±os, pero result√≥ ser una especie de monstruo. <br><br>  ¬øPor qu√© est√° pasando esto?  Debido a que la interacci√≥n entre expertos t√©cnicos y expertos en dominios en una situaci√≥n t√≠pica se ve m√°s o menos as√≠: hay un muro muy grande entre ellos, y un gerente camina a lo largo de la parte superior de este muro y primero trata de escuchar lo que gritan a un lado del muro, luego trata de gritarlo al mejor de los paquetes al otro lado de la pared, y as√≠ sucesivamente en un c√≠rculo. <br><br>  A veces, un gerente es sordo, entonces se puede construir una cadena completa de tales administradores, lo que, por supuesto, no contribuye al √©xito del proyecto.  ¬øY c√≥mo deber√≠a ser? <br><br><img src="https://habrastorage.org/webt/wc/ov/sh/wcovshn5e04eei99ry9a9ydm4gy.jpeg"><br><br>  Debe haber una interacci√≥n constante.  Expertos t√©cnicos, expertos en dominios: todos los participantes del proyecto deben mantener una comunicaci√≥n constante, sincronizarse, discutir objetivos, formas de alcanzarlos y por qu√© hacemos todo esto. <br><br>  Y aqu√≠ llegamos al primer y, probablemente, el punto clave m√°s importante tanto del dise√±o estrat√©gico como del dise√±o impulsado por dominio en general. <br><br><img src="https://habrastorage.org/webt/tz/nl/jg/tznljgxy0ptqsd5vw-5s3ptopdk.jpeg"><br><br>  La comunicaci√≥n entre los participantes del proyecto forma lo que Domain-Driven Design llama lenguaje ubicuo.  √âl no es uno en el sentido de que es uno para todas las ocasiones.  Justo lo contrario.  Es √∫nico en el sentido de que todos los participantes se comunican en √©l, toda la discusi√≥n se lleva a cabo en t√©rminos de un solo idioma, y ‚Äã‚Äãtodos los artefactos deben ser m√°ximos en t√©rminos de un solo idioma, es decir, comenzando desde TK y terminando con un c√≥digo. <br><br><h2>  Escenarios de negocios </h2><br>  Para una mayor discusi√≥n, necesitamos alg√∫n tipo de escenario empresarial.  Imaginemos esta situaci√≥n: <br><br><img src="https://habrastorage.org/webt/nm/4g/ig/nm4gigksgfmt0bgp-iixvbbxow4.jpeg"><br><br>  El director del grupo JUG.ru se acerca a nosotros y dice: "Chicos, el flujo de informes est√° creciendo, la gente, en general, es torturada para hacer todo manualmente ... Automaticemos el proceso de preparaci√≥n de la conferencia".  Respondemos: "¬°Est√° bien!"  - y ponte a trabajar. <br><br>  El primer escenario que automatizaremos es: "El orador presenta una solicitud para un informe en un evento espec√≠fico y agrega informaci√≥n sobre su informe".  ¬øQu√© vemos en este escenario?  Qu√© es un orador, hay un evento y hay un informe, lo que significa que ya es posible construir el primer modelo de dominio. <br><br><img src="https://habrastorage.org/webt/e_/up/_t/e_up_tj4aagy5ewxeq1xwdnim_k.jpeg"><br><br>  Aqu√≠ tenemos un modelo de dominio: Altavoz - orador, Talk - informe, Evento - evento.  Pero el modelo de dominio no puede ser ilimitado, no puede cubrir todo, de lo contrario se volver√° borroso y perder√° el foco, por lo que el modelo de dominio debe estar limitado por algo.  Este es el siguiente punto clave. <br><br><img src="https://habrastorage.org/webt/e_/0w/w8/e_0ww82sof-x_waqu_epiihi8de.jpeg"><br><br>  Tanto el modelo de dominio como el lenguaje ubicuo est√°n limitados por el contexto que Domain-Driven Design llama contexto acotado.  Restringe el modelo de dominio de tal manera que todos los conceptos dentro de √©l no sean ambiguos y todos entiendan lo que est√° en juego. <br><br>  Si dicen "Usuario", entonces todo deber√≠a estar claro a la vez, deber√≠a tener un papel comprensible, un significado comprensible, no deber√≠a ser alg√∫n tipo de usuario abstracto desde el punto de vista de la industria de TI. <br><br><img src="https://habrastorage.org/webt/fv/v-/7r/fvv-7rprlvfbdhyo81bgitdvvny.jpeg"><br><br>  En nuestro caso, este modelo de dominio es v√°lido para el contexto de la preparaci√≥n de la conferencia, por lo que es en el contexto que llamaremos el "contexto de planificaci√≥n de eventos".  Pero para que el orador agregue algo, cambie la informaci√≥n, de alguna manera debe iniciar sesi√≥n, debe tener algunos derechos.  Y este ya ser√° otro contexto, "Contexto de identidad", en el que habr√° alg√∫n tipo de sus propias entidades: Usuario, Rol, Perfil. <br><br>  Y mira qu√© cosa est√° aqu√≠.  Cuando una persona inicia sesi√≥n en el sistema y tiene la intenci√≥n de ingresar alg√∫n tipo de informaci√≥n, f√≠sicamente esta es la misma persona, pero en diferentes contextos est√° representada por diferentes entidades, y estas entidades no est√°n directamente relacionadas. <br><br>  Si tomamos y, por ejemplo, heredamos el altavoz del usuario, entonces mezclar√≠amos cosas que no se pueden mezclar, y algunos atributos podr√≠an mezclarse por l√≥gica.  Y el modelo perder√≠a el foco en el significado espec√≠fico que tiene, dividi√©ndose en varios contextos. <br><br><h2>  Demostraci√≥n: servicio de ventas </h2><br>  Pasemos un poco de la teor√≠a seca y miremos el c√≥digo. <br><br>  Una conferencia no es solo la preparaci√≥n de contenido, sino tambi√©n las ventas.  Imaginemos que ya se ha escrito un servicio para vender boletos, y un gerente de ventas se nos acerca y nos dice: ‚Äú¬°Chicos!  Una vez que alguien escribi√≥ este servicio, averig√º√©moslo, algo no me queda claro c√≥mo se considera el descuento para clientes habituales ‚Äù. <br><br>  Despu√©s de hablar con el gerente, descubrimos que todo el escenario de este servicio es el siguiente: al hacer clic en Pagar, el precio final del boleto se considera teniendo en cuenta el descuento regular para el cliente, y el pedido pasa al estado "Esperando el pago". <br><br>  El c√≥digo que ahora analizaremos se puede ver por separado en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio</a> . <br><br>  Abra la soluci√≥n, mire la estructura: <br><br><img src="https://habrastorage.org/webt/hy/wl/j4/hywlj4jodqlkuhsfza7b_gglj2u.png"><br><br>  Parece que todo se ve bien: hay Aplicaci√≥n y N√∫cleo (aparentemente, la gente sabe sobre capas), Repositorio ... Aparentemente, la persona domin√≥ la primera mitad de Evans. <br><br>  Abra OrderCheckoutService.  ¬øQu√© vemos all√≠?  Aqu√≠ <a href="">est√° el c√≥digo</a> : <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Checkout</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ord = _ordersRepository.GetOrder(id); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> orders = _ordersRepository.GetOrders() .Count(o =&gt; o.CustomerId == ord.CustomerId &amp;&amp; o.StateId == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; o.OrderDate &gt;= DateTime.UtcNow.AddYears(<span class="hljs-number"><span class="hljs-number">-3</span></span>)); ord.Price *= (<span class="hljs-number"><span class="hljs-number">100</span></span> - (orders &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">30</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? <span class="hljs-number"><span class="hljs-number">20</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">10</span></span>m : <span class="hljs-number"><span class="hljs-number">0</span></span>)) / <span class="hljs-number"><span class="hljs-number">100</span></span>; ord.StateId = <span class="hljs-number"><span class="hljs-number">1</span></span>; _ordersRepository.SaveOrder(ord); }</code> </pre> <br><br>  Nos fijamos en la l√≠nea con el precio: aqu√≠ el precio cambia.  Llamamos a nuestro gerente de ventas y le decimos: "Aqu√≠, en resumen, el descuento se considera aqu√≠, todo est√° claro": <br><br><pre> <code class="cs hljs">ord.Price *= (<span class="hljs-number"><span class="hljs-number">100</span></span> - (orders &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">30</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? <span class="hljs-number"><span class="hljs-number">20</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">10</span></span>m : <span class="hljs-number"><span class="hljs-number">0</span></span>)) / <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br><br>  √âl mira sobre su hombro: ‚Äú¬°Oh!  ¬°As√≠ es como se ve Brainfuck!  Y me dijeron que los chicos est√°n escribiendo en C # ". <br><br>  Obviamente, el desarrollador de este c√≥digo respondi√≥ bien a una entrevista sobre algoritmos y estructuras de datos.  Escrib√≠ en las olimpiadas de la escuela con el mismo estilo.  Despu√©s de un tiempo, utilizando el formato y la refactorizaci√≥n <s>obscena</s> , descubrimos qu√© es qu√© y le explicamos a nuestro sufrido gerente de ventas que la l√≥gica es esta: si el n√∫mero de pedidos en los √∫ltimos 3 a√±os no es inferior a uno, entonces recibe un 10% de descuento , no menos de tres - 20%, y no menos de cinco - 30%.  Se marcha alegre: ahora est√° claro c√≥mo funciona todo. <br><br>  Creo que muchos han le√≠do el C√≥digo Limpio de Bob Martin.  All√≠ dice sobre la regla de Boy Scout: "El estacionamiento despu√©s de que nos vayamos deber√≠a estar m√°s limpio de lo que estaba antes de llegar all√≠".  Por lo tanto, refactoricemos este c√≥digo para que se vea humano y se corresponda con lo que hablamos un poco antes sobre el lenguaje ubicuo y su uso en el c√≥digo. <br><br>  Aqu√≠ est√° el c√≥digo refactorizado. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DiscountCalculator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IOrdersRepository _ordersRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiscountCalculator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IOrdersRepository ordersRepository</span></span></span><span class="hljs-function">)</span></span> { _ordersRepository = ordersRepository; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateDiscountBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> customerId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completedOrdersCount = _ordersRepository.GetLast3YearsCompletedOrdersCountFor(customerId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DiscountBy(completedOrdersCount); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiscountBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> completedOrdersCount</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><br>  Lo primero que hacemos es transferir el c√°lculo de descuento a un Calculador de descuento por separado, en el que aparece el m√©todo CalculateDiscountBy customerId.  Todo se lee humanamente, todo est√° claro: qu√©, por qu√© y c√≥mo.  Dentro de este m√©todo, vemos que tenemos globalmente dos pasos para calcular el descuento.  Primero: obtenemos algo del repositorio de pedidos, todo depende del caso del usuario, ni siquiera tiene que entrar si esta no es la parte que le interesa ahora.  El hecho es que obtenemos el n√∫mero de algunos pedidos completados, despu√©s de lo cual inmediatamente consideramos el segundo descuento para esta cantidad como el segundo paso. <br><br>  Si queremos ver c√≥mo se considera, vamos a DiscountBy, y aqu√≠ casi lo mismo est√° escrito en ingl√©s casi humano que nuestro "tipo de brainfair" era antes, todo es claro y preciso. <br><br>  La √∫nica pregunta que podr√≠a surgir es en qu√© unidades se mide el descuento.  Ser√≠a posible agregar la palabra "porcentaje" en el nombre del m√©todo para que quede claro, pero por el contexto y las cifras involucradas, lo m√°s probable es que adivine que estos son porcentajes, y por brevedad puede omitirse.  Si queremos ver cu√°l fue el n√∫mero de pedidos, entonces iremos al c√≥digo del Repositorio y veremos.  Ahora no haremos esto.  En nuestro Servicio, necesitamos agregar una nueva dependencia de DiscountCalculator.  Y veamos con qu√© terminamos en la segunda versi√≥n del m√©todo Checkout. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckoutV2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> orderId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> order = _ordersRepository.GetOrder(orderId); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> discount = _discountCalculator.CalculateDiscountBy(order.CustomerId); order.ApplyDiscount(discount); order.State = OrderState.AwaitingPayment; _ordersRepository.SaveOrder(order); }</code> </pre><br><br>  Mire, el m√©todo Checkout recibe orderId, luego recibe un orderId por orderId, de acuerdo con el CustomerId de este pedido, considera el descuento utilizando la calculadora de descuentos, aplica el descuento al pedido, establece el estado en AwaitingPayment y guarda el pedido.  Ten√≠amos un gui√≥n en ruso en la diapositiva, pero aqu√≠ pr√°cticamente leemos la traducci√≥n de este gui√≥n al ingl√©s y todo est√° claro, todo es obvio. <br><br>  ¬øVes lo que es el encanto?  Este c√≥digo se puede mostrar a cualquiera: no solo a los programadores, sino tambi√©n al control de calidad, a los analistas, a los clientes.  Todos entender√°n lo que est√° sucediendo, porque todo est√° escrito en lenguaje humano.  Utilizo esto en nuestro proyecto, realmente QA puede ver algunas piezas, consultar con Wiki y comprender que hay alg√∫n tipo de error.  Porque el Wiki lo dice, y el c√≥digo es un poco diferente, pero entiende lo que est√° sucediendo all√≠, aunque no es un desarrollador.  Y de la misma manera, podemos analizar el c√≥digo con el analista y analizarlo en detalle.  Yo digo: "Mira, as√≠ es como funciona en c√≥digo".  Nuestro √∫ltimo recurso no es el Wiki, sino el c√≥digo.  Todo funciona tal como est√° escrito en el c√≥digo.  Es muy importante utilizar un lenguaje ubicuo al escribir c√≥digo. <br><br><img src="https://habrastorage.org/webt/-a/15/pc/-a15pcu9tfp6xjadw-98qlpcxrs.jpeg"><br><br>  Este es el tercer punto clave. <br><br>  Hay tanta confusi√≥n sobre el dise√±o impulsado por dominio en cosas como dominio, subdominio, contexto acotado, c√≥mo se relacionan con lo que significan.  Parece que todo el mundo est√° limitando algo, todos de alguna manera est√°n ordenados.  Pero no est√° claro cu√°l es la diferencia, por qu√© son tan diferentes inventados. <br><br><img src="https://habrastorage.org/webt/tp/zo/nf/tpzonf_lfbysx7pgiiqrxbiineo.jpeg"><br><br>  El dominio es algo global, es un √°rea tem√°tica global en la que este negocio en particular gana dinero.  Por ejemplo, para DotNext esta es una conferencia, para Pyaterochka es una venta minorista de bienes. <br><br>  Las grandes corporaciones pueden tener varios dominios.  Por ejemplo, Amazon se dedica tanto a la venta de bienes a trav√©s de Internet como a la provisi√≥n de servicios en la nube, estas son diferentes √°reas tem√°ticas. <br><br>  Sin embargo, es algo global y no puede automatizarse directamente, incluso investigarlo es dif√≠cil.  Para el an√°lisis, el dominio se divide inevitablemente en subdominios, es decir, en subdominios. <br><br><img src="https://habrastorage.org/webt/rc/wv/qz/rcwvqzdcicpkiw57o6p1lzunmn4.jpeg"><br><br>  Los subdominios son partes de un negocio que, en nuestro idioma, est√°n altamente conectados, es decir, son alg√∫n tipo de procesos l√≥gicos aislados que interact√∫an entre s√≠ en alg√∫n nivel importante. <br><br>  Por ejemplo, si tomamos una tienda en l√≠nea, ser√° la formaci√≥n y el procesamiento de pedidos, ser√° la entrega, esto es trabajo con proveedores, esto es marketing, esto es contabilidad.  Estas son algunas de estas piezas: en esto se divide el negocio. <br><br><img src="https://habrastorage.org/webt/yc/rc/ub/ycrcubvepugwbmk-xpidrsxc1pu.jpeg"><br><br>  Desde el punto de vista de DDD, los subdominios se dividen en tres tipos.  Y aqu√≠ quiero decir una cosa m√°s: a menudo en libros y art√≠culos, el Subdominio simplemente se reduce a Dominio, pero generalmente en el caso cuando se combina con el tipo de Subdominio.  Es decir, cuando dicen "Dominio principal", se refieren a Subdominio principal, no se confundan en esto.  Al principio me dej√≥ alucinado. <br><br>  Los subdominios se dividen en tres tipos. <br><br><img src="https://habrastorage.org/webt/a0/vg/jh/a0vgjhuiklcpufzsw_lsdzgisnw.jpeg"><br><br>  El primero y m√°s importante es Core.  Core es el subdominio principal, esta es la ventaja competitiva de la compa√±√≠a, lo que le hace ganar dinero a la compa√±√≠a, c√≥mo se diferencia de sus competidores, su know-how, como se llame.  Si tomamos la conferencia DotNext, entonces este es el contenido.  Todos vinieron aqu√≠ por contenido, si no hubiera tal contenido aqu√≠, no ir√≠an o ir√≠an a otra conferencia.  No habr√≠a DotNext en la forma en que est√°. <br><br><img src="https://habrastorage.org/webt/up/dr/cc/updrcc6vh3xb0niwkpsuqnrlr-s.jpeg"><br><br>  El segundo tipo es Subdominio de soporte.  Esto tambi√©n es algo importante para ganar dinero, tambi√©n es algo sin lo cual es imposible, pero no es alg√∫n tipo de conocimiento, una verdadera ventaja competitiva.  Esto es lo que admite el subdominio principal.  Desde el punto de vista de la aplicaci√≥n del dise√±o impulsado por dominio, esto significa que se gasta menos esfuerzo en el subdominio de soporte, todas las fuerzas principales se lanzan en Core. <br><br>  Un ejemplo para el mismo DotNext es el marketing.  Es imposible sin marketing, de lo contrario, nadie habr√≠a sabido sobre la conferencia, pero sin marketing de contenido no es necesario. <br><br><img src="https://habrastorage.org/webt/ad/in/ar/adinar6ki4kdf1xnozjylhho9ea.jpeg"><br><br>  Y finalmente, el subdominio gen√©rico.  Gen√©rico es una tarea empresarial t√≠pica, que, por regla general, puede automatizarse con productos terminados o externalizarse.  Esto es lo que tambi√©n se necesita, pero no necesariamente requiere una implementaci√≥n independiente por nuestra parte, e incluso m√°s que eso, generalmente ser√° una buena idea usar un producto de terceros. <br><br>  Por ejemplo, venta de boletos.  DotNext vende boletos a trav√©s de TimePad.  TimePad automatiza perfectamente este subdominio, y no necesita escribir un segundo TimePad usted mismo. <br><br><img src="https://habrastorage.org/webt/38/xi/5c/38xi5cgogl1edatrnmd4jy6o5yg.jpeg"><br><br>  Y finalmente, contexto acotado.  El contexto limitado y el subdominio siempre est√°n cerca, pero hay una diferencia significativa entre ellos.  Esto es muy importante <br><br><img src="https://habrastorage.org/webt/pa/xm/bo/paxmbosiaaglpdk-fc-38ouji3g.jpeg"><br><br>  Hay una pregunta en StackExchange sobre c√≥mo el contexto acotado difiere del Subdominio.  El subdominio es una parte del negocio, una parte del mundo real, es el concepto de un espacio de declaraci√≥n de problemas.  El contexto limitado limita el modelo de dominio y el lenguaje ubicuo, es decir, cu√°l es el resultado del modelado y, en consecuencia, el contexto limitado es el concepto de un espacio de soluci√≥n.  En el proceso de implementaci√≥n del proyecto, se realiza un tipo de mapeo de Subdominios en contextos limitados. <br><br><img src="https://habrastorage.org/webt/ba/91/mi/ba91mikbrcn3l50d_k2dwedusug.jpeg"><br><br>  Un ejemplo cl√°sico: la contabilidad como un Subdominio, c√≥mo se mapea el proceso, est√° automatizado, por ejemplo, 1C Contabilidad, Elba o "Mi negocio" - de alguna manera est√° automatizado por alg√∫n producto.  Este es el contexto limitado de la contabilidad, en el que existe su lenguaje ubicuo, su propia terminolog√≠a.  Esa es la diferencia entre ellos. <br><br><img src="https://habrastorage.org/webt/fs/y1/lv/fsy1lvc6qabh0flcrli7bkxvpho.jpeg"><br><br>  Si volvemos a DotNext, entonces, como dije, los tickets se asignan a TimePad, y el contenido que es nuestro Subdominio principal se asigna a una aplicaci√≥n personalizada que estamos desarrollando para la administraci√≥n de contenido. <br><br><h3>  Tama√±o de contexto acotado </h3><br>  Hay un momento que plantea muchas preguntas.  ¬øC√≥mo elegir el tama√±o correcto para el contexto acotado?  En los libros, uno puede encontrar esa definici√≥n: "El contexto limitado debe ser exactamente tal que el lenguaje ubicuo sea completo, consistente, inequ√≠voco, inequ√≠voco, consistente".  Definici√≥n genial, al estilo de un matem√°tico de una broma famosa: muy precisa, pero in√∫til. <br><br>  Analicemos c√≥mo entendemos lo mismo: si deber√≠a ser una Soluci√≥n, un Proyecto o un espacio de nombres, ¬øqu√© escala deber√≠a adjuntarse al contexto acotado? <br><br><img src="https://habrastorage.org/webt/l8/h5/7y/l8h57y11erupofzzpnc3q6li7ei.jpeg"><br><br>  Lo primero que puede leer en casi todas partes: idealmente, <b>un subdominio debe mapearse a un contexto limitado</b> , es decir, ser automatizado por un contexto limitado.  Suena l√≥gico, porque tanto all√≠ como existen limitaciones de un proceso comercial separado, en ambos casos, algunos t√©rminos comerciales, aparece un solo idioma.  Pero aqu√≠ debe comprender que esta es una situaci√≥n ideal, no necesariamente tendr√° esto, y no es necesario tratar de lograrlo. <br><br>  Porque, por un lado, el Subdominio puede ser bastante grande, y se pueden obtener varias aplicaciones o servicios que lo automatizar√°n, por lo que puede resultar que varios contextos limitados correspondan a un Subdominio. <br><br>  Pero hay una situaci√≥n inversa, como regla, esto es t√≠pico de Legacy.  Es decir, cuando crearon una aplicaci√≥n muy grande que automatiza todo en el mundo en esta empresa, todo lo contrario resultar√°.  Una aplicaci√≥n es un contexto limitado, es probable que el modelo sea alg√∫n tipo de ambig√ºedad, pero los Subdominios no han desaparecido de este, respectivamente, un contexto limitado corresponder√° a varios Subdominios. <br><br>  Cuando la arquitectura de microservicios se puso de moda, apareci√≥ otra recomendaci√≥n (aunque no se contradicen entre s√≠): <b>un contexto limitado por microservicio</b> .  Nuevamente, suena l√≥gico, la gente realmente hace eso.  Porque el microservicio debe asumir una funci√≥n clara, que internamente tiene una alta conectividad, y se comunica con otros servicios a trav√©s de alg√∫n tipo de interacci√≥n.  Si usa una arquitectura de microservicio, puede tomar esta recomendaci√≥n usted mismo. <br><br>  Pero eso no es todo.  Perm√≠tame recordarle una vez m√°s que el dise√±o impulsado por el dominio es mucho: sobre el lenguaje, sobre las personas.  Y no puede ignorar a las personas y solo hacer criterios t√©cnicos en este asunto.  Por lo tanto, escrib√≠ esto: <b>un contexto es igual a X-man</b> .  Sol√≠a ‚Äã‚Äãpensar que x es aproximadamente 10, pero hablamos un poco con Igor Labutin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">twitter.com/ilabutin</a> ) y la pregunta permaneci√≥ abierta. <br><br>  Aqu√≠ es importante entender esto: un solo idioma permanece unificado mientras todos los participantes hablan, discuten y todos lo entienden sin ambig√ºedades.  Est√° claro que un n√∫mero infinito de personas no puede hablar el mismo idioma.  Nuestra historia de la humanidad muestra claramente esto.  En cualquier caso, aparecen algunos dialectos, algunos de sus significados, ahora incluso puedes agregar memes, etc.  De una forma u otra, el idioma se volver√° borroso. <br><br>  Por lo tanto, debe entenderse que el n√∫mero de personas que usan este lenguaje √∫nico y, en consecuencia, participan en el desarrollo, en la automatizaci√≥n, es limitado.  Los libros tambi√©n hablan de algunas razones pol√≠ticas: si dos equipos trabajan bajo el liderazgo de diferentes gerentes y trabajan en el mismo contexto acotado, y por alguna raz√≥n estos gerentes no son amigos entre s√≠, los conflictos comenzar√°n y se perder√° el enfoque.  Por lo tanto, ser√° mucho m√°s simple y correcto hacer dos contextos limitados para cada comando y no intentar combinar lo que no se combina. <br><br><h2>  Arquitectura y gesti√≥n de dependencias </h2><br>  Desde el punto de vista del dise√±o impulsado por dominio, realmente no importa qu√© arquitectura elija.  El dise√±o dirigido por el dominio no se trata de eso; el dise√±o dirigido por el dominio se trata del lenguaje y la comunicaci√≥n. <br><br><img src="https://habrastorage.org/webt/3r/de/2i/3rde2isfgddxyjfzswpj2nvxtbe.jpeg"><br><br>  Pero hay un punto importante, desde el punto de vista de los criterios para elegir la arquitectura que nos interesa desde la perspectiva del dise√±o impulsado por dominio: <b>nuestro objetivo es eliminar al m√°ximo la l√≥gica empresarial de las dependencias de terceros</b> .  Porque, tan pronto como aparecen las dependencias de terceros, aparece la terminolog√≠a, aparecen palabras que no entran en un solo idioma y comienzan a ensuciar nuestra l√≥gica comercial. <br><br><img src="https://habrastorage.org/webt/nz/pw/nu/nzpwnurj_5kkbnmjo6uhosycd1u.jpeg"><br><br>  Veamos un ejemplo cl√°sico de arquitectura: la conocida arquitectura de tres capas.  Tan pronto como no llamen una capa de dominio (aqu√≠ la capa Business): business, core y domain son todos iguales.  En cualquier caso, esta es la capa en la que se encuentra la l√≥gica de negocios, y si depende de la capa de datos, significa que algunos conceptos de la capa de datos fluir√°n de alguna manera en la capa de dominio y la ensuciar√°n. <br><br><img src="https://habrastorage.org/webt/ft/kh/34/ftkh34ce3zbpt26jx3v8id9vaym.jpeg"><br><br>  La arquitectura de cuatro capas es esencialmente la misma, la capa de dominio a√∫n depende, y como depende, las dependencias innecesarias de terceros llegar√°n a ella. <br><br><img src="https://habrastorage.org/webt/wz/uv/ky/wzuvky-2bgljcwwarvtseclyqjy.jpeg"><br><br>  Y en este sentido, hay una arquitectura que permite evitar esto: es la arquitectura de cebolla ("cebolla").  Su diferencia es que consiste en capas conc√©ntricas, las dependencias van del exterior al centro.  Es decir, la capa externa puede depender de las internas, la capa interna no puede depender de las externas. <br><br>  La capa m√°s externa es la interfaz de usuario en un sentido global (es decir, no es necesariamente una interfaz de usuario humana, puede ser una API REST ni nada).  Y la infraestructura, que a menudo en general tambi√©n se parece a E / S, es la misma base de datos, de hecho, una capa de datos.  Todas estas cosas est√°n en la capa externa.  Es decir, debido a que la aplicaci√≥n de alguna manera recibe algunos datos, comandos, etc., se elimina y la capa de dominio elimina la dependencia de estas cosas. <br><br>  Luego viene la capa de aplicaci√≥n, un tema bastante hol√≠stico, pero esta es la capa en la que se encuentran los guiones, los casos de los usuarios.  Esta capa usa la capa de dominio para implementar sus conceptos. <br><br>  En el centro est√° la capa de dominio.  Como vemos, ya no depende de nada; se convierte en una cosa en s√≠ mismo.  Y es por eso que la capa de dominio a menudo se llama "Core", porque es el n√∫cleo, es lo que est√° en el centro, lo que no depende de cosas de terceros. <br><br><img src="https://habrastorage.org/webt/h4/cl/_n/h4cl_nmaowsib1bw1thjvpolr8u.jpeg"><br><br>  Una de las opciones para implementar dicha arquitectura de cebolla es la arquitectura hexagonal, o "puertos y adaptadores".  Traje esta foto para intimidar, no voy a hablar de eso.  Al final de la publicaci√≥n hay un enlace a uno de un mill√≥n de art√≠culos sobre esta arquitectura, puede leer. <br><br><h2>  Un poco sobre patrones t√°cticos: interfaz separada </h2><br>  Como dije, en primer lugar, la mayor√≠a de los patrones t√°cticos son familiares para todos, y en segundo lugar, el objetivo de mi informe es que no son la esencia.  Pero me gusta el patr√≥n de Interfaz separada por separado, y quiero hablar sobre √©l por separado. <br><br>  Volvamos al c√≥digo de nuestro microservicio y veamos qu√© pas√≥ con el repositorio. <br><br><img src="https://habrastorage.org/webt/jl/c7/_d/jlc7_dwrkqw8mfy4zd1nibrdwti.png"><br><br>  La capa de dominio ten√≠a <a href="">la</a> interfaz del <a href="">repositorio</a> IOrdersRepository.cs y su <a href="">implementaci√≥n,</a> OrdersRepository.cs. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DotNext.Sales.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IOrdersRepository</span></span> { <span class="hljs-function"><span class="hljs-function">Order </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Order order</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IQueryable&lt;Order&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrders</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> V2 int GetLast3YearsCompletedOrdersCountFor(long customerId); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } }</span></span></code> </pre><br><br>  Aqu√≠ hemos agregado un cierto m√©todo para recibir pedidos durante los √∫ltimos tres a√±os GetLast3YearsCompletedOrdersCountFor. <br><br>  Y lo implementaron de alguna forma (en este caso, a trav√©s del Entity Framework, pero puede ser cualquier cosa): <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLast3YearsCompletedOrdersCountFor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> customerId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> threeYearsAgo = DateTime.UtcNow.AddYears(<span class="hljs-number"><span class="hljs-number">-3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _dbContext.Orders .Count(o =&gt; o.CustomerId == customerId &amp;&amp; o.State == OrderState.Completed &amp;&amp; o.OrderDate &gt;= threeYearsAgo); }</code> </pre><br><br>  Mira cu√°l es el problema.  El repositorio termin√≥ en la capa de dominio, su implementaci√≥n en la capa de dominio, pero el c√≥digo, que comienza con DateTime.UtcNow.AddYears (-3), inherentemente no pertenece a la capa de dominio, y no es una l√≥gica de negocios.  S√≠, LINQ lo hace m√°s o menos humanizado, pero si, por ejemplo, hubo consultas SQL aqu√≠, todo ser√≠a completamente triste. <br><br>  El significado del patr√≥n de interfaz separada es que la interfaz de servicio que utilizamos en la l√≥gica de dominio se declara en la capa de dominio.  Estamos hablando de repositorios y servicios similares en los que los detalles de la implementaci√≥n de estos servicios no son l√≥gica empresarial.  La l√≥gica de negocios es el hecho de la existencia de estos servicios y el hecho de su llamado y uso en la capa de dominio.  Por lo tanto, la interfaz del repositorio permanece en la capa de dominio y la implementaci√≥n se mueve a la capa de infraestructura. <br><br>  Prepar√© otra opci√≥n.  La interfaz del repositorio permanece en el ensamblaje Core, pero la implementaci√≥n se traslada a Infrastructure.EF. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rh/k0/b_/rhk0b_dgbqe72y--hxcx13qlqco.png"></div><br><br>  Por lo tanto, trajimos a la infraestructura aquellos conceptos que no eran peculiares de la capa de dominio.  Como efecto secundario, podemos reemplazar esta infraestructura con alguna otra implementaci√≥n.  Pero este no es el objetivo principal, el objetivo principal es, como dije, eliminar la l√≥gica del dominio de las dependencias de terceros. <br><br><h2>  Una vez m√°s sobre el idioma. </h2><br>  Hablemos una y otra vez sobre el idioma. <br><br>  Al principio, creamos el modelo de dominio "orador - hablar - evento".  Creo que nadie ha planteado ninguna pregunta especial. <br><br>  Y aqu√≠ est√° el escenario en base al cual construimos este modelo de dominio: <br><br><img src="https://habrastorage.org/webt/2r/go/hp/2rgohppxhq7iqwvndfimzctuit8.jpeg"><br><br>  Mira, el gui√≥n est√° en ruso y el modelo de dominio est√° en ingl√©s. <br><br>  Para los desarrolladores que no hablan ingl√©s, esto es algo con lo que tienes que vivir constantemente. <br><br><img src="https://habrastorage.org/webt/jm/3p/rf/jm3prfqcjwydo3mg2c1p0zh3olc.jpeg"><br><br>  Cada uno de ustedes, muy probablemente, realiza constantemente este proceso: traduce del ruso al ingl√©s y viceversa.  Aquellos que trabajan con clientes y proyectos de habla inglesa son un poco m√°s f√°ciles, porque los requisitos est√°n en ingl√©s, las discusiones con los clientes en ingl√©s, por regla general, todos los escenarios est√°n en ingl√©s, el c√≥digo est√° en ingl√©s y solo hay comunicaci√≥n dentro del equipo en ruso, que crece r√°pidamente en ingl√©s (cliente - cliente, pedido - pedido).  Y esa carga cognitiva, esa sobrecarga, creada por una traducci√≥n constante, retrocede un poco. <br><br>   ,     ,        ,    .    ,    . <br><br>         1,        .   ,  ‚Äî    ,     ,          . <br><br><img src="https://habrastorage.org/webt/1e/b7/jh/1eb7jhuiy5i1ft1bsfrnu1x7_9u.jpeg"><br><br>      1. PascalCase  ,     ,     ,     <s></s>  ,      ,    , ,  - -     . <br><br>  ,  -  ? <br><br><img src="https://habrastorage.org/webt/lj/js/vd/ljjsvdrqh4v9117mps2yrelyxna.jpeg"><br><br>   ,     use case,   ,     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> ,   .        C#,  ,  , .       ,    ,   ,  . <br><br>        ,  ,      Domain-Driven Design.      ,   ,    , ,        C#    .                    . <br><br>   ,      -  Continuous Integration.  ,       ,    , -   - .   ,     -  ,   ,  .  ,  95%      ,      ,  Continuous Integration,  , TeamCity .   . <br><br>               ,          . .   ,           1-,  ,    .        ¬´¬ª  ,     .    ,   ,    . <br><br><img src="https://habrastorage.org/webt/qh/ff/32/qhff32udhgwxb4cav3gjjoakn4e.jpeg"><br><br>         ,   Domain-Driven Design. <br><br>  ‚Äî  ,   . Domain-Driven Design ‚Äî    ,    .  ‚Äî    ,  ,          ubiquitous language.     ,     ,   .      ,   ,      ,        . <br><br> .    ,  .    - ,      ,    ,     ,  ,     ,  ,  ,  ,      ,  ‚Äî .     . <br><br>       .      .      .      .   ,    ,      .        DSL-.        .NET-,     - ,    ,  ,  ,   .   ,     . <br><br> , -    .    ,    ,     ubiquitous language  -.     . <br><br><h2>    </h2><br><ul><li> <b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">marshinov</a> </b> .    ,      DDD: , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬´   DDD, CQRS  Event Sourcing    ¬ª</a> .    ,    ,      . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> ,  AutoMapper   MediatR.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> ,       Domain-Driven Design,      . </li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬´F# for fun and profit¬ª</a> ,   ,   F#  Domain-Driven Design.  ,  ,   ,    . </li><li>  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>    ,   . </li></ul><br>   , ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  GitHub</a> . <br><br><blockquote>   DotNext: <br>   , ¬´       ,     ¬ª.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  <b>DotNext</b> ( <b>15-16   </b> )     .    ,   1   ,         . <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440772/">https://habr.com/ru/post/440772/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440756/index.html">CI / CD sin servidor en AWS</a></li>
<li><a href="../440758/index.html">¬°Ve a Meetup en Acronis! (Mosc√∫, Fiztehpark)</a></li>
<li><a href="../440760/index.html">La nueva edad de oro para la arquitectura de computadoras</a></li>
<li><a href="../440762/index.html">Revisiones de los empleadores: la naturaleza y la falta de sentido de las revisiones an√≥nimas</a></li>
<li><a href="../440766/index.html">De geeks a geeks: regalos para el 23 de febrero</a></li>
<li><a href="../440774/index.html">Los graves errores matem√°ticos de la NHTSA permiten a Tesla reclamar la seguridad del piloto autom√°tico</a></li>
<li><a href="../440776/index.html">Correo electr√≥nico, vista interior</a></li>
<li><a href="../440778/index.html">Segunda reuni√≥n de OpenStack en Mail.ru Group: 22 de febrero</a></li>
<li><a href="../440780/index.html">Google no bloquear√° los bloqueadores de anuncios de terceros en el navegador Chromium</a></li>
<li><a href="../440782/index.html">Me estoy adentrando en la clandestinidad, o lo que debe saber, optimizando la aplicaci√≥n de red</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>