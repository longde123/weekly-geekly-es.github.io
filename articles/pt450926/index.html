<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôÄÔ∏è ‚ûó üë©üèø‚Äçü§ù‚Äçüë©üèæ Jogo 3D em three.js, nw.js üîü üëÇ üñäÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Decidi lan√ßar uma nova vers√£o do meu antigo jogo de navegador, que por alguns anos tem sido bem-sucedido como um aplicativo nas redes sociais. Desta v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jogo 3D em three.js, nw.js</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450926/"> Decidi lan√ßar uma nova vers√£o do meu antigo jogo de navegador, que por alguns anos tem sido bem-sucedido como um aplicativo nas redes sociais.  Desta vez, decidi projet√°-lo tamb√©m como um aplicativo para Windows (7-8-10) e coloc√°-lo em v√°rias lojas.  Obviamente, no futuro voc√™ poder√° fazer montagens para MacOS e Linux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1c/tj/vi/1ctjvijgbjodkdjhwszw4atwgvm.jpeg"></div><br>  O c√≥digo do jogo √© escrito inteiramente em javascript puro.  Para exibir gr√°ficos 3D, a biblioteca three.js √© usada como um link entre o script e o WebGL.  No entanto, esse foi o caso na vers√£o antiga do navegador.  O mais importante neste projeto para mim foi o motivo, em paralelo com o jogo, de adicionar minha pr√≥pria biblioteca, projetada para complementar o three.js com as ferramentas para um trabalho conveniente com objetos de cena, suas anima√ß√µes e muitos outros recursos.  Eu ent√£o o abandonei por um longo tempo.  √â hora de voltar para ela. <br><a name="habracut"></a><br><br>  Minha biblioteca cont√©m ferramentas convenientes para adicionar e remover objetos da cena, alterar as propriedades de partes individuais de objetos (malhas), anima√ß√£o independente da taxa de quadros de objetos 3D, um sombreador de c√©u com uma textura estrelada do c√©u √† noite e muito mais.  Vou falar sobre alguns deles.  Em rela√ß√£o ao c√©u, implementei sua cria√ß√£o com uma √∫nica fun√ß√£o que utiliza v√°rios par√¢metros de entrada, inicializa o sombreador, carrega a textura da nuvem (se necess√°rio) e inicia a atualiza√ß√£o do c√©u com uma determinada itera√ß√£o. <br><br>  No entanto, tudo √© um pouco mais complicado l√° - para fun√ß√µes peri√≥dicas, mas raramente chamadas, outra constru√ß√£o realmente funciona, usando setInterval (), no qual os eventos podem ser executados em intervalos diferentes, e isso reduzir√° tudo isso a um denominador comum e funcionar√° √† direita eventos necess√°rios na lista.  L√° voc√™ tamb√©m pode jogar o intervalo de atualiza√ß√£o do c√©u.  Mas o movimento dos objetos de jogos em 3D para maior suavidade j√° foi implementado por meio de requestAnimationFrame () ... <br><br>  Ent√£o, como estamos falando do c√©u, come√ßaremos com ele. <br><br><h3>  O c√©u </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ge/xw/da/gexwday-od32dav2p4gb48p1nme.jpeg"></div><br>  A adi√ß√£o do firmamento √† cena √© a seguinte. <br><br>  Primeiro, voc√™ precisa adicionar a luz padr√£o three.js √† cena com seus valores de brilho m√°ximo (inicial).  Toda a cena com seus objetos, luz e outros atributos, para n√£o bagun√ßar o espa√ßo global, ser√° armazenada no espa√ßo de nomes apscene. <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  (AmbLight)   apscene.AmbLight=new THREE.AmbientLight(0xFFFFFF); apscene.scene.add(apscene.AmbLight); //  (AmbLightBk)   (      ) apscene.AmbLightBk=new THREE.AmbientLight(0xFFFFFF); apscene.sceneb.add(apscene.AmbLightBk); // (, )   var SFog=new THREE.FogExp2(0xaaaaaa, 0.0007); apscene.scene.fog=SFog; // (, )   var SFogBk=new THREE.FogExp2(0xa2a2aC, 0.0006); apscene.sceneb.fog=SFogBk; //  apscene.hemiLight=new THREE.HemisphereLight(0xFFFFFF, 0x999999, 1); apscene.scene.add(apscene.hemiLight); //        .       .        three.js   ,   ,     ,  ,   ... apscene.dirLight=new THREE.DirectionalLight(...) apscene.dirLightBk=new THREE.DirectionalLight(...)</span></span></code> </pre> <br>  Depois disso, voc√™ j√° pode executar a anima√ß√£o do c√©u com shaders, texturas (blackjack e ... bem, tudo bem) atrav√©s de uma das minhas fun√ß√µes: <br><br><pre> <code class="javascript hljs">m3d.graph.skydom.initWorld( <span class="hljs-comment"><span class="hljs-comment">//  ,  ,         {saveStart:false}, { //ltamb (light ambient,    ) -       ltamb:{a1:-2, a2:8, k1:0.2, k2:0.75, obj:[ {obj:apscene.AmbLight.color, key:['r','g','b']} ]}, //a1  a2 -      (altitude,      ),     ,   obj,     (k1..k2),   k1  k2 -         // ,    ltamb :     -2  8 (    ),    (apscene.AmbLight.color),    r, g  b,    0.2  0.75     ( ,    ,    0xFFFFFF). //key -    ,        three.js //        (apscene.AmbLightBk.color).    (  altitude)  -4  12          0.3 ... 0.99    .  -4 , ,    0.3  ,   12   0.99   ltambb:{a1:-4, a2:12, k1:0.3, k2:0.99, obj:[ {obj:apscene.AmbLightBk.color, key:['r','g','b']} ]}, //      : ltdir:{a1:-2, a2:8, k1:0.0, k2:1, obj:[ {obj:apscene.dirLight, key:['intensity']}, {obj:apscene.dirLightBk, key:['intensity']} ]}, //       (apscene.dirLightBk)   ,    ,       . // ,      three.js    - inensity ( , apscene.dirLight.intensity).  ,  ,       three.js    . //  .   ,     ( 0.15  )     12  8 (, ,    8  12), : lthem:{a1:8, a2:12, k1:0.15, k2:0.3, obj:[ {obj:apscene.hemiLight, key:['intensity']} ]}, //         .       . //    ()   : ltambfog:{a1:-2, a2:8, k1:0.4, k2:1, obj:[ {obj:apscene.scene.fog.color, key:['r','g','b']} ]}, //  : ltambbfog:{a1:-2, a2:12, k1:0.25, k2:1, obj:[ {obj:apscene.sceneb.fog.color, key:['r','g','b']} ]}, //     .  ,         ,  . ltambfogd:{a1:8, a2:12, k1:0.2, k2:0.35, obj:[ {obj:apscene.scene.fog, key:['density']} ]}, //  ltambbfogd:{a1:6, a2:12, k1:0.2, k2:0.28, obj:[ {obj:apscene.sceneb.fog, key:['density']} ]}, //  ,      ( ,   ),   ,     ,   , -¬´¬ª     ,      skyplane1..6: planeAmb:{a1:-5, a2:12, k1:0.5, k2:1.0, obj:[ {obj:apscene.user.skyplane1.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane2.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane3.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane4.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane5.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane6.material.color, key:['r','g','b']} ]} //,     ,     ,  . };</span></span></code> </pre> <br>  Como resultado, um c√©u din√¢mico aparece na cena com uma mudan√ßa suave na altura do sol e, consequentemente, uma mudan√ßa na hora do dia. <br><br>  N√£o √© necess√°rio usar todos os tipos de ilumina√ß√£o no palco.  E n√£o √© necess√°rio alterar todos os par√¢metros, dependendo da hora do dia.  Por√©m, brincando com o brilho, voc√™ pode criar uma imagem bastante realista da mudan√ßa do dia e da noite.  Voc√™ pode nomear os par√¢metros como quiser, o principal √© observar as chaves dos objetos dentro deles, conforme s√£o especificadas no three.js. <br><br>  Como fica, voc√™ pode ver o v√≠deo da cena demo: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/PoAPy3ByPRU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Este √© um jogo diferente.  √â s√≥ que o horizonte n√£o est√° cheio de v√°rios objetos e, portanto, o trabalho desse script √© mais claramente vis√≠vel.  Mas no jogo sobre o qual a hist√≥ria est√° sendo discutida, exatamente a mesma abordagem √© usada.  A alta velocidade da passagem do tempo aqui √© definida apenas para fins de demonstra√ß√£o e, portanto, o tempo flui, √© claro, mais lentamente, com o mesmo passo da itera√ß√£o atualizando o firmamento.  Nesta demonstra√ß√£o, a prop√≥sito, um shader de √°gua est√° envolvido, tamb√©m com par√¢metros vari√°veis, dependendo da altura do sol ... Mas ainda n√£o o finalizei. <br><br><h3>  Desempenho </h3><br>  Tudo isso √© muito pouco exigente em ferro.  Trabalhando no navegador Chrome, ele carrega o Xeon E5440 no LGA775 (e com 4 GB de RAM) em 20% e o n√∫cleo da placa gr√°fica GT730 em 45%.  Mas isso √© puramente devido √† anima√ß√£o da √°gua.  Se falamos de um jogo em que n√£o h√° √°gua, mas h√° uma cidade, esta: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0i/_k/se/0i_ksepjxwtge9qffnonerlnkes.jpeg"></div><br>  ent√£o, no momento em que o carro se move pela cidade - 45%, placa de v√≠deo 50%.  Em princ√≠pio, com uma redu√ß√£o de alguns fps (at√© cerca de 30 quadros por segundo), funciona razoavelmente bem, mesmo em Pentium4 3GHz (1Gb de RAM) e em um tablet no Intel Atom 1.3GHz (2Gb de RAM). <br><br>  Todo esse hardware √© extremamente fraco e outros jogos semelhantes no WebGL e no HTML5, mesmo em 2D, diminuem a velocidade de Deus, at√© o ponto em que fica imposs√≠vel reproduzi-los.  Como eles dizem, escreva o jogo voc√™ mesmo, conforme necess√°rio, e jogue. <br><br><h3>  Scene </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/zo/y1/jbzoy1gm1aomyfdgyp7udkziole.jpeg"></div><br>  A cena 3D em three.js √© um objeto de cena e sua matriz derivada √©, de fato, todos os modelos 3D carregados na cena.  Para n√£o registrar uma chamada do carregador de inicializa√ß√£o para cada modelo, decidi que toda a cena do jogo seria definida na forma de uma determinada configura√ß√£o, com um grande locd associativo de matriz: {} (como dados de localiza√ß√£o), que conteria todas as configura√ß√µes - luzes, caminhos de texturas pr√©-carregadas e imagens para a interface, caminhos para todos os modelos que devem ser carregados no palco e muito mais.  Em geral, esta √© a configura√ß√£o completa da cena.  Ele √© definido uma vez no arquivo js do jogo e alimentado no meu carregador de cenas. <br><br>  E esse objeto locd: {}, em particular, cont√©m os caminhos para os modelos 3D individuais que precisam ser carregados.  O caminho zero √© o caminho comum e, em seguida, os caminhos relativos para cada objeto, como: <br><pre> <code class="javascript hljs">[<span class="hljs-string"><span class="hljs-string">'path/myObj'</span></span>, scale, y, x,z, r*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>]</code> </pre> <br>  Entende-se que todos os modelos s√£o exportados do editor 3D para o formato json, ou seja, possuem caminhos como path / myObj.json.  Isso √© seguido pela escala (como o editor pode ser salvo com uma escala que n√£o √© adequada para o jogo), a posi√ß√£o do objeto em altura (y), ao longo dos eixos (x) e (z) e, em seguida, o √¢ngulo de rota√ß√£o ¬Æ do modelo em (y), v√°rios par√¢metros opcionais e o nome da cena em que carregar o modelo - na cena principal (cena) ou no plano de fundo (cena). <br><br>  Sim, foi necess√°rio implementar isso n√£o na forma de um simples, mas na forma de uma matriz associativa.  Portanto, a ordem dos par√¢metros √© incompreens√≠vel, mesmo sem documenta√ß√£o, ou pelo menos sem o tipo de fun√ß√£o que aceita esses par√¢metros, voc√™ n√£o entender√°.  Penso que no futuro vou refazer essas linhas em matrizes associativas.  Enquanto isso, fica assim: <br><pre> <code class="javascript hljs">landobj: [ [<span class="hljs-string"><span class="hljs-string">'gamePath/'</span></span>], [ [<span class="hljs-string"><span class="hljs-string">'landscape/ground'</span></span>, <span class="hljs-number"><span class="hljs-number">9.455</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], [<span class="hljs-string"><span class="hljs-string">'landscape/plants'</span></span>, <span class="hljs-number"><span class="hljs-number">9.455</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI,<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], [<span class="hljs-string"><span class="hljs-string">'landscape/buildings/house01'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-420</span></span>,<span class="hljs-number"><span class="hljs-number">420</span></span>, <span class="hljs-number"><span class="hljs-number">-0.75</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], ... ] ],</code> </pre> <br>  Esses modelos s√£o carregados no palco e colocados nas coordenadas dadas aqui no espa√ßo.  Em princ√≠pio, todos os modelos podem ser carregados como um √∫nico objeto, ou seja, exportados do editor como uma cena inteira do jogo e carregados em coordenadas (0; 0; 0).  Depois, haver√° apenas uma linha: paisagem / solo - eu tenho ground.json - essa √© a parte principal do mundo do jogo.  Mas, neste caso, ser√° dif√≠cil manipular objetos individuais da cena, pois voc√™ precisar√° primeiro olhar no console do navegador e lembrar qual dos filhos desse enorme terreno √©.  E entre em contato com eles por n√∫meros.  Portanto, os modelos de jogos em roaming s√£o mais bem carregados com objetos separados.  Em seguida, eles podem ser acessados ‚Äã‚Äãpelo nome a partir da matriz associativa, que ser√° criada automaticamente especialmente para esse fim. <br><br>  A configura√ß√£o completa do jogo pode ser, por exemplo, assim: <br><pre> <code class="javascript hljs">locd:{ <span class="hljs-comment"><span class="hljs-comment">// name: 'SeaBattle', type: 'game', menulabel: '', //    x:-420, y:70, z:-420, rot: -0.5, //    intsdistance: 200, // ambLtColor: 0xFFFFFF, ambLtColorBk: 0xFFFFFF, lightD: [0xDDDDDD,0.3,1000, 200000,0.3,-0.0003, -190,200000,-140,0,0,0, 200,-200,200,-200], lightDBk: [0xFFFFFF,0.3,10000, 40000,0.3,-0.0035, -190,1200,-140,0,0,0, 50000,-50000,50000,-50000], lightH: [0xFFFFFF,0x999999,1, 0,500,0], //      lightsP: [], //     lightsPDynamicAr: [ [0xffffff, 4, [0, -2000, 0], [50, 1.5] ] //[[distance], [decay]] ], //         (x,y,z) userPointLights: [ [0, -2000, 0] ], //   lightsS: [ [0xffffbb, 1.0, [0, 250, 180], [0, 0, 180], 0.5, 600,600,600, -0.0005] ], //  shadowMapCullFace:0, shadowsMode: 'all', //all,list,flag //  imagePaths: [ 'game/img/', 'interface.png', 'interface2.png' ], // 3D  landobj: [ ['game/models/'], [ ['landscape/land',1, 0, 0,0, 0.0*Math.PI,1,'','','',1,['','','',''],'scene'], ['landscape/sbp',1, 0, 0,180, 1.0*Math.PI,1,'','','',1,['','','',''],'scene'], ['landscape/sbu',1, 0, 0,1120, 1.0*Math.PI,1,'','','',1,['','','',''],'scene'] ] ], //        staffobj: [ ['game/models2/'], [ ] ], //  progobj: [ [ ] ] },</span></span></code> </pre> <br>  Sim, √© melhor refazer todos esses subarrays em arrays associativos, caso contr√°rio, a ordem dos par√¢metros neles n√£o √© clara ... <br><br><h3>  Modelos 3D </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fz/fm/ql/fzfmqlr4yfw3_tkm79xjwlb_ccw.jpeg"></div><br>  Outra coisa interessante.  Carregando modelos.  Minha biblioteca aceita modelos 3D com texturas e define automaticamente alguns par√¢metros para seus elementos individuais (malhas), dependendo dos nomes.  O fato √© que, por exemplo, se o modelo estiver definido para projetar uma sombra, ele ser√° convertido por cada malha inclu√≠da em sua composi√ß√£o.  Nem sempre √© necess√°rio que o modelo inteiro projete uma sombra completamente ou adquira outras propriedades que afetem fortemente o desempenho.  Portanto, se voc√™ ativar um determinado sinalizador sinalizando que √© necess√°rio considerar cada malha separadamente, ao carregar √© poss√≠vel determinar qual malha ter√° essa ou aquela propriedade e quais n√£o.  Bem, por exemplo, n√£o h√° absolutamente nenhuma necessidade de a sombra ser projetada pelo teto horizontal plano da casa ou por muitos detalhes irrelevantes do modelo em um fundo grande.  Mesmo assim, o player n√£o poder√° ver essas sombras e a energia do processador de v√≠deo ser√° usada para process√°-las. <br><br>  Para fazer isso, no editor de gr√°ficos (Blender, Max, etc.), voc√™ pode especificar imediatamente os nomes das malhas (no campo de nome do objeto) de acordo com uma determinada regra.  Deve haver um sublinhado (_).  Os caracteres de controle condicional devem ficar no lado esquerdo, por exemplo: d - lado duplo (a malha √© bidirecional, caso contr√°rio - unidirecional), c (sombra projetada) - lan√ßa uma sombra, r (recebe sombra) - leva sombras.  Ou seja, por exemplo, o nome da malha de tubos na casa pode ser cr_tube.  Muitas outras letras tamb√©m s√£o usadas.  Por exemplo, "l" √© um colisor, ou seja, a parede da casa, com o nome crl_wall01, n√£o permitir√° que o jogador passe por si mesma e tamb√©m projeta e faz sombra.  N√£o h√° necessidade de fazer coletores, como um telhado ou uma ma√ßaneta da porta, e assim degradar o desempenho.  Como voc√™ j√° entendeu, ao carregar um modelo, minha biblioteca analisa os nomes das malhas e fornece as propriedades correspondentes na cena.  Mas, para isso, √© necess√°rio nomear corretamente todas as malhas antes de exportar o modelo do editor 3D.  Isso economizar√° significativamente o desempenho. <br><br>  Todos os sinalizadores de controle para malhas dentro de um objeto: <br><blockquote>  col_ ... √© o colisor.  Essa malha ser√° exibida simplesmente como um colisor transparente e invis√≠vel.  No editor, ele pode parecer com qualquer coisa, apenas sua forma √© importante.  Por exemplo, pode ser um paralelep√≠pedo em torno de todo o modelo, se for necess√°rio que o jogador n√£o consiga passar por esse modelo (constru√ß√£o, pedra grande, etc.). <br><br>  l_ ... √© um objeto colid√≠vel.  Dando a qualquer malha uma propriedade de colis√£o. <br><br>  i_ ... - cruzamentos.  A malha ser√° adicionada √† lista de interse√ß√µes, que pode ser usada, por exemplo, para clicar nela, ou seja, para dar interatividade ao jogo. <br><br>  j_ ... tamb√©m interse√ß√µes.  O mesmo que acima, apenas uma vers√£o mais recente - com um algoritmo aprimorado para encontrar interse√ß√µes no jogo e menor consumo de recursos. <br><br>  e_ ... - cruzamentos para as portas das casas (entrada / sa√≠da).  Exclui interse√ß√£o sobre outras malhas de objetos.  √â usado se for necess√°rio nas casas em algum momento tornar apenas as portas interativas, excluindo todos os outros elementos interativos.  Com imagina√ß√£o, voc√™ pode criar esse e muitos outros usos. <br><br>  c_ ... - projetar sombras.  A malha lan√ßa uma sombra. <br><br>  r_ ... - recebe sombras.  Uma malha aceita sombras de todas as outras malhas que as lan√ßam. <br><br>  d_ ... - bilateral (dupla face).  Vis√≠vel em ambos os lados, a textura √© sobreposta em ambos os lados. <br><br>  t_ ... - transparente (transparente), se o objeto inteiro estiver definido como alphatest em three.js. <br><br>  u_ ... - transparente (transparente), com densidade fixa (0,4), se o objeto inteiro n√£o especificar o alphatest em three.js. <br><br>  g_ ... - vidro.  A transpar√™ncia fixa est√° definida (0,2). <br><br>  h_ ... - invis√≠vel (oculto).  Para partes do objeto (malhas) que devem ser ocultadas ao adicionar o objeto √† cena.  Entrou na lista de ocultos. <br><br>  v_ ... vis√≠vel.  Todos os objetos, exceto aqueles marcados com "h", j√° est√£o vis√≠veis, mas com o sinalizador "v", eles s√£o inseridos em uma lista separada, vis√≠vel para oculta√ß√£o adicional ou outras manipula√ß√µes. </blockquote><br>  Como resultado, o nome da malha pode ser algo assim: crltj_box1 (projeta, aceita uma sombra, colisor, transparente, interativo).  E outra malha como parte do mesmo modelo: cr_box2 (somente projeta e cria sombras). Naturalmente, os caracteres de controle podem ser definidos em qualquer ordem.  Assim, no editor, voc√™ pode controlar a exibi√ß√£o futura de partes do objeto no jogo, ou melhor, algumas de suas propriedades, economizando, ao mesmo tempo, poder de computa√ß√£o. <br><br><h3>  A ess√™ncia do jogo </h3><br>  O significado, de fato, do jogo sobre o qual a hist√≥ria √©, √© mover-se pelo per√≠metro do campo quadrado e comprar empresas.  O campo √© feito na forma de ruas em 3D.  O modelo econ√¥mico do jogo √© significativamente diferente daquele de seu tipo.  No meu jogo, quando algu√©m inicia um neg√≥cio, seu lucro esperado cai.  E vice-versa, quando voc√™ descobre algo, aumenta.  Todos os c√°lculos de lucros e perdas s√£o feitos na inspe√ß√£o fiscal no campo Iniciar.  Voc√™ tamb√©m pode tomar um empr√©stimo em um banco, negociar valores mobili√°rios e fazer v√°rias outras coisas.  Melhorei o comportamento da IA ‚Äã‚Äãem compara√ß√£o com a vers√£o antiga.  Refez quase todos os modelos e texturas 3D do jogo e desempenho otimizado.  Fez mais configura√ß√µes e muito mais. <br><br><h3>  Anima√ß√£o </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lw/7u/m_/lw7um_phbrcpp-yx78ec5ihw9jy.jpeg"></div><br>  Para animar o movimento dos objetos do jogo, √© usado o mecanismo mais simples, que com uma determinada taxa de quadros (limitada ao 60¬∫) altera quaisquer par√¢metros num√©ricos por um determinado intervalo de tempo, distribuindo valores intermedi√°rios ao manipulador.  E no manipulador, por exemplo, o modelo √© exibido. <br><br>  Por exemplo.  Precisamos mover o objeto obj no espa√ßo da posi√ß√£o (10; 10; 50) para o ponto (100; 300; 60).  Definimos 3 par√¢metros, indicando seus valores iniciais e finais.  A coordenada x varia de 10 a 100, y - de 10 a 300 e z - de 50 a 60. E tudo isso deve acontecer, digamos, em 4 segundos. <br><pre> <code class="javascript hljs">m3d.lib.anim.add( <span class="hljs-string"><span class="hljs-string">'moveobj'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4000</span></span>, <span class="hljs-string"><span class="hljs-string">'and'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">userpar1</span></span>:<span class="hljs-number"><span class="hljs-number">111</span></span>, <span class="hljs-attr"><span class="hljs-attr">obj</span></span>:my3DObject}, [ {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>} ], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ myPeriodicFun(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ myFinishFun(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } ); m3d.lib.anim.play();</code> </pre> <br>  A primeira linha de 5 par√¢metros: moveobj - nome da anima√ß√£o (qualquer), 1 - n√∫mero de fluxo (voc√™ pode animar objetos em paralelo em um n√∫mero ilimitado de fluxos), 4000 - tempo de anima√ß√£o 4 segundos e - at√© um par√¢metro n√£o utilizado, que no futuro ser√° respons√°vel pela l√≥gica de transi√ß√£o entre anima√ß√µes no mesmo fluxo, userpar √© qualquer matriz associativa que ser√° transmitida ao manipulador como um par√¢metro, por exemplo, com um raio calculado, senos, cossenos e geralmente quaisquer valores calculados para essa anima√ß√£o, para n√£o serem calculados em  sobre o tempo de cada itera√ß√£o.  Ou com refer√™ncia a um objeto 3D que, de fato, ser√° animado. <br><br>  Em seguida √© uma matriz com par√¢metros mut√°veis.  N√≥s achamos que o primeiro par√¢metro √© a mudan√ßa na coordenada x, o segundo √© y, o terceiro √© z.  Escrevemos para cada um em lim1 e lim2, de qual e para qual tamanho ele ser√° alterado.  No sstart e no sfin, especificamos os mesmos valores.  Aqui voc√™ pode especificar um in√≠cio, por exemplo, de algum outro valor, ent√£o o par√¢metro "rolar√°" em um c√≠rculo a partir dele, ignorando o lim2 e iniciando uma nova "revolu√ß√£o" com o lim1.  Bem, por exemplo, isso √© necess√°rio se nossa anima√ß√£o estiver em loop entre alguns valores (lim1 e lim2), mas precisamos inici√°-la n√£o desde o in√≠cio (ou seja, n√£o de lim1), mas de algum valor intermedi√°rio. <br><br>  t: 0 apenas define que a anima√ß√£o para este par√¢metro √© executada 1 vez, de acordo com o tempo total (4000), como se estendido a ele.  Se definirmos outro n√∫mero, menor que o hor√°rio principal, esse par√¢metro ser√° repetido e repetido at√© o hor√°rio da anima√ß√£o principal (4000).  √â conveniente, por exemplo, definir a rota√ß√£o do objeto quando o √¢ngulo deve cruzar repetidamente a linha de 360 ‚Äã‚Äãgraus e redefinir para 0. <br><br>  Em seguida, v√™m dois retornos de chamada - aquele que ser√° executado a cada itera√ß√£o e o que ser√° executado uma vez ap√≥s a conclus√£o de toda a anima√ß√£o (ponto de sa√≠da). <br><br>  O primeiro retorno de chamada myPeriodicFun (this), por exemplo, pode ser assim: <br><pre> <code class="javascript hljs">myPeriodicFun:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state=self.par[<span class="hljs-number"><span class="hljs-number">0</span></span>].state, state_old=self.par[<span class="hljs-number"><span class="hljs-number">0</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state2=self.par[<span class="hljs-number"><span class="hljs-number">1</span></span>].state, state_old2=self.par[<span class="hljs-number"><span class="hljs-number">1</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state3=self.par[<span class="hljs-number"><span class="hljs-number">2</span></span>].state, state_old3=self.par[<span class="hljs-number"><span class="hljs-number">2</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((state!=state_old)||(state2!=state_old2)||(state3!=state_old3)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj=self.userpar.obj; obj.position.x=state; obj.position.y=state2; obj.position.z=state3; ap.cameraFollowObj(obj); }; },</code> </pre> <br>  Ou seja, a cada itera√ß√£o do movimento, um par√¢metro (self) √© lan√ßado nessa fun√ß√£o que cont√©m os valores intermedi√°rios calculados para todos os par√¢metros de anima√ß√£o: self.par [0] .state, self.par [1] .state, self.par [2] .state.  Este √© o nosso x, ye z no momento atual.  Por exemplo, se a anima√ß√£o durar 4 segundos, ap√≥s 2 segundos x ser√° igual a (100-10) / 2 = 45. E o mesmo acontece com todas as coordenadas.  Assim, em myPeriodicFun, simplesmente exibimos nosso objeto nessas coordenadas.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o navegador come√ßar a ficar lento ou apenas rodar lentamente neste hardware, n√£o ser√° assustador: o tempo total de anima√ß√£o n√£o ser√° alterado, apenas a taxa de quadros cair√° e a imagem se transformar√° em uma apresenta√ß√£o de slides. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que verificar f ((state! = State_old) ..., isto √©, se o novo valor calculado √© igual ao antigo (state_old lembra o valor calculado na itera√ß√£o anterior), bem, por exemplo, para que, se algum par√¢metro for alterado menos de um, n√£o redesenhe o objeto inteiro e n√£o gaste a energia do sistema nele, e o mecanismo de anima√ß√£o produz n√∫meros inteiros em state e state_old, que, digamos, podem ser interpretados como uma etapa igual a um pixel, e se o objeto n√£o se mover em rela√ß√£o √† posi√ß√£o anterior mesmo por 1 pixel, n√£o h√° necessidade de redesenhar, pois A posi√ß√£o na tela n√£o muda.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em geral, a anima√ß√£o √© entendida como uma simples altera√ß√£o em qualquer n√∫mero de par√¢metros em um determinado tempo, com a entrega de seus valores intermedi√°rios a uma fun√ß√£o de retorno de chamada. Por exemplo, voc√™ pode adicionar outro quarto par√¢metro, que ser√° respons√°vel pelo √¢ngulo de rota√ß√£o do objeto. E voc√™ geralmente pode agrupar os par√¢metros de muitos objetos em uma anima√ß√£o se eles se moverem de alguma maneira uniforme. Voc√™ pode colocar anima√ß√µes em diferentes fluxos, para que sejam processadas em paralelo. Voc√™ pode adicionar (m3d.lib.anim.add ()) a um √∫nico thread uma sequ√™ncia inteira de anima√ß√µes, e elas ser√£o executadas uma ap√≥s a outra. Al√©m disso, cada thread ter√° sua pr√≥pria sequ√™ncia independente. O principal √© que o sistema tem energia suficiente e tudo n√£o se transforma em uma apresenta√ß√£o de slides.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS: Os fluxos aqui s√£o realizados simplesmente por enumera√ß√£o seq√ºencial a cada itera√ß√£o de todas as anima√ß√µes paralelas e c√°lculo para cada uma delas de valores intermedi√°rios de todos os seus par√¢metros. </font><font style="vertical-align: inherit;">Ou seja, n√£o h√° multithreading real em javascript. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O mesmo "mecanismo" tamb√©m pode ser usado para animar os elementos da interface, configurando-os para alterar 2 coordenadas no plano da tela e exibindo esses elementos nas fun√ß√µes de retorno de chamada de acordo com os valores intermedi√°rios obtidos. </font><font style="vertical-align: inherit;">O que, de fato, √© feito no meu jogo.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sombras din√¢micas </font></font></h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fd/4c/1-/fd4c1-dofkcz8fsysds0pbi_-eo.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A exibi√ß√£o de sombras em toda a cena acabou sendo t√£o in√∫til que, quando ativadas, os qps ca√≠ram v√°rias vezes. </font><font style="vertical-align: inherit;">Isso n√£o √© bom. </font><font style="vertical-align: inherit;">Vamos mostrar as sombras dos objetos em um determinado quadrado pequeno ao redor do player. </font><font style="vertical-align: inherit;">Eu direi imediatamente que tal t√©cnica aumenta significativamente a taxa de quadros.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nada complicado aqui. As sombras de three.js s√£o projetadas dentro de uma certa c√¢mera de sombra especificada pela caixa (shadowCameraLeft, shadowCameraRight, shadowCameraTop, shadowCameraBottom). Pode ser esticada para toda a cena ou pode ser feita de forma a seguir a c√¢mera principal e as sombras serem projetadas apenas em torno dela. A √∫nica coisa que adicionei a este sistema √© a etapa pela qual as sombras ser√£o atualizadas. N√£o h√° absolutamente nenhuma necessidade de fazer essa atualiza√ß√£o toda vez que o player se contrai, pois isso carrega o sistema com c√°lculos. Deixe-o superar uma certa dist√¢ncia m√≠nima ao longo de qualquer um dos tr√™s eixos para que as sombras sejam atualizadas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na minha biblioteca, ao inicializar o mundo 3D, um objeto contr √© criado, que a qualquer momento cont√©m as coordenadas da c√¢mera. Tamb√©m √© poss√≠vel definir o par√¢metro do usu√°rio contr.cameraForShadowStep, que cont√©m a etapa da posi√ß√£o da c√¢mera na qual a posi√ß√£o da c√¢mera sombra √© alterada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se, digamos, o paralelep√≠pedo da c√¢mera sombra tiver dimens√µes 700x700x700, ent√£o contr.cameraForShadowStep poder√° ser definido como, por exemplo, 20. E quando o jogador mover 20 em qualquer um dos eixos, a posi√ß√£o inicial ser√° lembrada novamente e as sombras ao redor do jogador ser√£o atualizadas. A escala do mundo 3D pode ser qualquer, dependendo da escala em que todos os modelos foram criados no editor 3D. E √© prov√°vel que, em vez de 700x700x700 e 20, voc√™ precise usar 7000x7000x7000 e 200. Mas isso n√£o muda a ess√™ncia de forma alguma.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A prop√≥sito, quando o sol se move no c√©u, as sombras s√£o atualizadas independentemente desse sistema, pois a dire√ß√£o das sombras deve mudar para l√°. </font><font style="vertical-align: inherit;">Ou seja, eles ser√£o atualizados mesmo se o jogador estiver parado sem movimento. </font><font style="vertical-align: inherit;">L√°, a fun√ß√£o de atualizar as sombras de acordo com o per√≠odo de atualiza√ß√£o do c√©u √© estupidamente chamada.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Point Light System </font></font></h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kg/fa/be/kgfabepvwgn_zxwfctnyh2rce7g.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A presen√ßa de mais de uma d√∫zia de fontes pontuais de luz no palco √© t√£o forte em qps quanto sombras din√¢micas. E at√© torna imposs√≠vel tocar o velho "c√¢nhamo". Al√©m disso, n√£o importa se essas fontes est√£o no campo de vis√£o do jogador (o alcance do desenho do mundo pode ser definido) ou a uma dist√¢ncia consider√°vel. Se eles est√£o estupidamente presentes no palco, tudo funciona lentamente. Portanto, eu forneci no menu de configura√ß√µes do jogo, que pode ser chamado antes de carregar o mundo 3D, op√ß√µes para o n√∫mero dessas fontes (2, 4 ou 8) chamado "Light of Lanterns".</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mr/-g/sr/mr-gsrw4vfm6qjobtc5a36p432s.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim, √† noite, acender todas as luzes colocadas no palco ao mesmo tempo n√£o funcionar√°. Acima, na descri√ß√£o do esquema de inicializa√ß√£o mundial, apresentei matrizes de userPointLights e lightsPDynamicAr. No userPointLights, as coordenadas de todas as l√¢mpadas no palco s√£o definidas em uma matriz. E lightsPDynamicAr cont√©m as configura√ß√µes de luz para todas as 8 inst√¢ncias. Dependendo da configura√ß√£o do n√∫mero de luzes, a biblioteca pegar√° a primeira delas e aumentar√° a cena no campo de vis√£o do jogador.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato, enquanto o jogador est√° em movimento, √© feita uma busca por 2 a 8 lanternas mais pr√≥ximas do jogador pela matriz de coordenadas das lanternas userPointLights. </font><font style="vertical-align: inherit;">E fontes de luz pontuais se movem sob elas. </font><font style="vertical-align: inherit;">Em outras palavras, 2-8 l√¢mpadas de ilumina√ß√£o seguem o jogador, cercando-o. </font><font style="vertical-align: inherit;">Al√©m disso, isso tamb√©m √© feito n√£o com todos os quadros de fps, mas com uma determinada etapa. </font><font style="vertical-align: inherit;">N√£o h√° absolutamente nenhuma necessidade de iniciar a fun√ß√£o de busca 60 vezes por segundo, especialmente se o jogador n√£o estiver em movimento - ent√£o deixe as luzes j√° encontradas ao seu redor acenderem. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â assim que fica em movimento (Xeon E5440, GeForce GT730):</font></font><br><iframe width="560" height="315" src="https://www.youtube.com/embed/IPuJrH8EJ_E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Constru√ß√£o de distribui√ß√£o </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como n√£o uso nenhum ambiente de desenvolvimento sofisticado (exceto o bloco de notas avan√ßado), escrevi um arquivo bat no qual o Google Closure Compiler √© chamado para ofuscar o c√≥digo de cada arquivo * .js. </font><font style="vertical-align: inherit;">E o nwjc.exe do pacote nw.js √© chamado para compilar js em bin√°rios (* .bin). </font><font style="vertical-align: inherit;">Vou dar um exemplo para um dos arquivos:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">java -jar D: \ servidores de web \ Encerramento \ compiler.jar --js D: \ servidores de web \ proj \ m3d \ www \ jogo \ bus \ bus.js --js_output_file D: \ servidores de web \ proj \ nwProjects \ bus \ game \ bus \ bus.js </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd D: \ "Arquivos de programas" \ Web2Exe \ down \ nwjs-sdk-v0.35.5-win-ia32 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D: \ "Arquivos de programas" \ Web2Exe \ down \ nwjs-sdk-v0.35.5-win -ia32 \ nwjc.exe D: \ servidores de web \ proj \ nwProjetos \ barramento \ jogo \ barramento \ bus.js D: \ servidores web \ proj \ nwProjetos \ barramento \ jogo \ barramento \ barramento.bin </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do D: \ servidores \ proj \ nwProjetos \ bus \ jogo \ bus \ bus.js</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em seguida, uso o utilit√°rio Web2Executable simples para criar um arquivo exe com assembly no Windows. Eu escolhi o nw.js vers√£o 0.35.5, embora tamb√©m estejam dispon√≠veis vers√µes mais recentes. N√£o notei nenhum efeito deles, exceto pelo aumento do tamanho da montagem.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hk/_2/ed/hk_2ed5imb6en8ffx6vtfx_7t-o.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O utilit√°rio √© capaz de baixar a vers√£o selecionada do nw.js para a pr√≥pria pasta especificada. </font><font style="vertical-align: inherit;">A sa√≠da √© uma montagem. </font><font style="vertical-align: inherit;">O arquivo execut√°vel de 35 megabytes cont√©m, de fato, o pr√≥prio jogo. </font><font style="vertical-align: inherit;">Tudo o resto √© node-webkit. </font><font style="vertical-align: inherit;">A pasta localidades cont√©m arquivos, obviamente, com alguns recursos em diferentes idiomas. </font><font style="vertical-align: inherit;">Exclu√≠-os e deixei apenas aqueles relacionados ao ingl√™s. </font><font style="vertical-align: inherit;">A prop√≥sito, isso n√£o impediu o lan√ßamento da vers√£o em russo do jogo (no jogo, o idioma alterna entre russo e ingl√™s). </font><font style="vertical-align: inherit;">Por que todos esses arquivos ent√£o, eu n√£o sei. </font><font style="vertical-align: inherit;">Mas sem o ingl√™s, nada come√ßa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A montagem inteira levou 167 MB.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jp/ev/qq/jpevqq5deupdq0zkm7naffok4fa.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Depois, agrupei tudo em um arquivo de distribui√ß√£o execut√°vel usando um dos utilit√°rios gratuitos projetados para essa finalidade, e a sa√≠da foi de 70,2 MB Businessman3DSetup.exe. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sf/xd/nn/sfxdnnsvu3fpp9ukkzsius2vqsm.jpeg"></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Postagem </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enviei a montagem para diferentes lojas de aplicativos. A maioria deles ainda est√° moderando meu jogo. No momento, apenas a coceira a publicou at√© agora. Eu aviso imediatamente, o jogo √© pago, o pre√ßo √© de US $ 3. Ainda n√£o existem compras, mas ainda n√£o participei de sua promo√ß√£o. O GOG se recusou a publicar, citando o fato de que o jogo √© bastante simples e de nicho. Eu, em princ√≠pio, concordo. A Epic Store, eu acho, far√° o mesmo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A vers√£o publicada do jogo √© de usu√°rio √∫nico, com bots no valor de 1 a 5. Idioma - russo e ingl√™s. Pretendo terminar a vers√£o da rede. Mas pensando bem - para liber√°-lo na forma do mesmo aplicativo ou na forma de uma vers√£o do navegador da Web dispon√≠vel imediatamente no Windows, Linux, iOs e MacOs, e geralmente onde quer que o navegador suporte o WebGL. Na verdade, o webkit √© um navegador e o jogo funciona bem nele, no Firefox, no Edge e at√© no IE11 no Windows, embora no √∫ltimo seja muito lento.</font></font><br><br><h3>  Conclus√µes </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kw/cf/wm/kwcfwmtwbwugbnnsb3gol4bshkk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acho que ainda n√£o estou pronto para colocar meu mecanismo para uso geral, pois ainda n√£o est√° conclu√≠do. Vou escrever primeiro outro jogo, exatamente esse, no v√≠deo de demonstra√ß√£o, sobre navios, porque nesse jogo voc√™ pode "executar" o trabalho com o shader de √°gua. Al√©m disso, pretendo implementar um mecanismo de f√≠sica simples l√°. Sim, e voc√™ ainda precisa concluir todos os outros recursos, corrigir todas as falhas. E √© melhor fazer isso em dois jogos do que em um, pois algumas nuances s√£o poss√≠veis. Enquanto isso, meu mecanismo, na minha opini√£o, ainda est√° muito afiado para um jogo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, n√£o tenho certeza de que algu√©m precise de tudo isso. </font><font style="vertical-align: inherit;">Se voc√™ olhar com sobriedade, ningu√©m escreve jogos em javascript puro. </font><font style="vertical-align: inherit;">Mas gosto porque os jogos s√£o f√°ceis e r√°pidos para o navegador. </font><font style="vertical-align: inherit;">Eles carregam rapidamente, n√£o exigem muita RAM e trabalham muito rapidamente em compara√ß√£o com os concorrentes no html5, mesmo quando comparados ao 2D. </font><font style="vertical-align: inherit;">Acho que vou lan√ßar mais de um jogo de navegador (e n√£o apenas) em todos esses desenvolvimentos.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt450926/">https://habr.com/ru/post/pt450926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt450914/index.html">As negocia√ß√µes falharam: como a Oracle matou o Java EE</a></li>
<li><a href="../pt450916/index.html">Compara√ß√£o da qualidade das fotos tiradas em telefones com diferentes configura√ß√µes de sensores</a></li>
<li><a href="../pt450918/index.html">Gerenciamento de conhecimento de TI: a primeira confer√™ncia e o panorama geral</a></li>
<li><a href="../pt450922/index.html">Caminhada no escrit√≥rio</a></li>
<li><a href="../pt450924/index.html">Tudo sobre anima√ß√µes SVG</a></li>
<li><a href="../pt450928/index.html">Como os data centers salvam feriados</a></li>
<li><a href="../pt450930/index.html">Como desenvolvemos # bigdataX5 e quem √© necess√°rio no Big Data</a></li>
<li><a href="../pt450938/index.html">Linux Install Fest 05.19 em Nizhny Novgorod 18 de maio de 2019</a></li>
<li><a href="../pt450940/index.html">Vivaldi 2.5 - Macrocosmo atraente</a></li>
<li><a href="../pt450942/index.html">Sidecar para uma divis√£o de c√≥digo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>