<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСд тШЭЁЯП┐ ЁЯек Yandex.Metrica рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдЖрдВрдХрдбрд╝реЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЖрд░ рднрд╛рд╖рд╛ рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░ рдлрд╝рдирд▓ рдХрд╛ рдирд┐рд░реНрдорд╛рдг ЁЯзУЁЯП╛ ЁЯТФ ЁЯСК</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдмрд┐рдХреНрд░реА рдлрд╝рдирд▓ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЗрдВрдЯрд░рдиреЗрдЯ рдорд╛рд░реНрдХреЗрдЯрд┐рдВрдЧ рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдИ-рдХреЙрдорд░реНрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдп рд╣реИред рдЗрд╕рдХреА рдорджрдж рд╕реЗ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: 


- рдкрддрд╛ рдХрд░реЗрдВ рдХрд┐ рдЦрд░реАрдж рдХреЗ рд▓...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Yandex.Metrica рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдЖрдВрдХрдбрд╝реЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЖрд░ рднрд╛рд╖рд╛ рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░ рдлрд╝рдирд▓ рдХрд╛ рдирд┐рд░реНрдорд╛рдг</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462279/"><p>  рдмрд┐рдХреНрд░реА рдлрд╝рдирд▓ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЗрдВрдЯрд░рдиреЗрдЯ рдорд╛рд░реНрдХреЗрдЯрд┐рдВрдЧ рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдИ-рдХреЙрдорд░реНрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдп рд╣реИред  рдЗрд╕рдХреА рдорджрдж рд╕реЗ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><ul><li>  рдкрддрд╛ рдХрд░реЗрдВ рдХрд┐ рдЦрд░реАрдж рдХреЗ рд▓рд┐рдП рдХреМрди рд╕реЗ рдХрджрдо рдЖрдк рд╕рдВрднрд╛рд╡рд┐рдд рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рдЦреЛ рд░рд╣реЗ рд╣реИрдВред </li><li>  рдЦрд░реАрдж рдХреЗ рд▓рд┐рдП рдкрде рдкрд░ рдкреНрд░рддреНрдпреЗрдХ рдХрджрдо рдХреЗ рд╡рд┐рд╕реНрддрд╛рд░ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЕрддрд┐рд░рд┐рдХреНрдд рд░рд╛рдЬрд╕реНрд╡ рдкреНрд░рд╡рд╛рд╣ рдХреА рдорд╛рддреНрд░рд╛ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред </li><li>  рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдЬреНрдЮрд╛рдкрди рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдкрд░ рдЦрд░реАрджреЗ рдЧрдП рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреА рдЧреБрдгрд╡рддреНрддрд╛ рдХрд╛ рдЖрдХрд▓рди рдХрд░реЗрдВред </li><li> рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдмрдВрдзрдХ рдХреЗ рд▓рд┐рдП рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЧреБрдгрд╡рддреНрддрд╛ рдХрд╛ рдЖрдХрд▓рди рдХрд░реЗрдВред </li></ul><br><p>  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рдореИрдВ рдпреИрдВрдбреЗрдХреНрд╕ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рд╕реЗ рдЖрд░ рднрд╛рд╖рд╛ рдореЗрдВ рдбреЗрдЯрд╛ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реВрдВрдЧрд╛, рдЙрдирдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдХ рдлрд╝рдирд▓ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдХрд▓реНрдкрдирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред </p><br><p> рдЖрд░ рднрд╛рд╖рд╛ рдХреЗ рдореБрдЦреНрдп рд▓рд╛рднреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рд╕рдВрдХреБрд▓ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рд╣реИ рдЬреЛ рдЗрд╕рдХреА рдореВрд▓ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо <code>rym</code> , <code>funneljoin</code> рдФрд░ <code>ggplot2</code> ред </p><br><p>  <code>funneljoin</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП <code>rym</code> рд╣рдо рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рд╕реЗ рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, рдПрдХ рд╡реНрдпрд╡рд╣рд╛рд░ рдлрд╝рдирд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП <code>ggplot2</code> рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдкрд░рд┐рдгрд╛рдо рдХреА рдХрд▓реНрдкрдирд╛ <code>ggplot2</code> рд▓рд┐рдП <code>ggplot2</code> рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/903/ac7/75e/903ac775e293295d418a628a673f73d6.jpg" alt="рдЫрд╡рд┐"></p><a name="habracut"></a><br><h1 id="soderzhanie">  рд╕рд╛рдордЧреНрд░реА </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЙрдЧ рдПрдкреАрдЖрдИ рдпрд╛рдВрдбреЗрдХреНрд╕ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рд╕реЗ рдбреЗрдЯрд╛ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВ</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Rym рдкреИрдХреЗрдЬ рд╕реНрдерд╛рдкрдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░реЙрдо рдкреИрдХреЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рдпрд╛рдВрдбреЗрдХреНрд╕ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╛рдВрдбреЗрдХреНрд╕ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдПрдкреАрдЖрдИ рдореЗрдВ рдкреНрд░рд╛рдзрд┐рдХрд░рдг</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Yandex Metrica API рд╕реЗ рдбреЗрдЯрд╛ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВ</a> </li></ul></li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд╝рдирд▓ рдмрд┐рд▓реНрдбрд┐рдВрдЧ рдлрд╝рдирд▓рдЬреЙрдЗрди рдкреИрдХреЗрдЬ</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд╝рдирд▓ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдкреЛрд╕реНрдЯрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдбреЗрдЯрд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд╝рдирд▓ рдкреНрд░рдХрд╛рд░</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд╝рдирд▓ рдЪрд░рдг</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд╝рдирд▓ рджреГрд╢реНрдп</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд╛рдорд╛рдиреНрдп рдлрд╝рдирд▓ рдХрд╛ рджреГрд╢реНрдп</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреНрд░реИрдлрд┐рдХ рдЪреИрдирд▓реЛрдВ рджреНрд╡рд╛рд░рд╛ рдлрд╝рдирд▓ рджреГрд╢реНрдп</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреБрдирд╢реНрдЪ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирд┐рд╖реНрдХрд░реНрд╖</a> </li></ul><br><h1 id="zapros-dannyh-iz-logs-api-yandeks-metriki">  рд▓реЙрдЧ рдПрдкреАрдЖрдИ рдпрд╛рдВрдбреЗрдХреНрд╕ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рд╕реЗ рдбреЗрдЯрд╛ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВ </h1><br><p>  рдХреМрди рдирд╣реАрдВ рдЬрд╛рдирддрд╛ рдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ</a> рдпрд╣рд╛рдВ рдХреНрдпрд╛ рд╣реИ, рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдпреИрдВрдбреЗрдХреНрд╕ рдорджрдж рд╕реЗ рдПрдХ рдЙрджреНрдзрд░рдг рд╣реИред </p><br><blockquote>  рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рдЖрдкрдХреЛ Yandex.Metrica рджреНрд╡рд╛рд░рд╛ рдПрдХрддреНрд░рд┐рдд рдЧреИрд░-рдПрдХрддреНрд░рд┐рдд рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдпрд╣ рдПрдкреАрдЖрдИ рдЙрд╕ рд╕реЗрд╡рд╛ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╣реИ рдЬреЛ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рд╕рд╛рдВрдЦреНрдпрд┐рдХреАрдп рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ рдЕрджреНрд╡рд┐рддреАрдп рд╡рд┐рд╢реНрд▓реЗрд╖рдгрд╛рддреНрдордХ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </blockquote><p>  R рдореЗрдВ Yandex.Metrica Logs API рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо <code>rym</code> рдкреИрдХреЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред </p><br><div class="spoiler">  <b class="spoiler_title">рд░рд┐рдо рдкреИрдХреЗрдЬ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд▓рд┐рдВрдХ</b> <div class="spoiler_text"><p>  рд╕рдВрджрд░реНрдн: </p><br><ul><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Rym рдкреИрдХреЗрдЬ рдкреНрд░рд▓реЗрдЦрди</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">CRAN рдкрд░ Rym рдкреИрдХреЗрдЬ рдкреЗрдЬ</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Rith рдкреИрдХреЗрдЬ рдкреЗрдЬ github рдкрд░</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Rym рдкреИрдХреЗрдЬ рд╡реЗрдмрд┐рдирд╛рд░</a></em> </li></ul></div></div><br><p>  <code>rym</code> - рдЖрд░ рдкреИрдХреЗрдЬ рдЬреЛ рдХрд┐ рдпреИрдВрдбреЗрдХреНрд╕ рдореЗрдЯреНрд░рд┐рдХ рдПрдкреАрдЖрдИ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╣реИред  рдЖрдкрдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рдмрдВрдзрди</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">API, рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">API, рдЧреЛрд░ API API Google Analytics v3</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЙрдЧреНрд╕ API рдХреЗ</a> рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рджреЗрддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред </p><br><h2 id="ustnovka-paketa-rym">  Rym рдкреИрдХреЗрдЬ рд╕реНрдерд╛рдкрдирд╛ </h2><br><p>  рдЖрд░ рдореЗрдВ рдХрд┐рд╕реА рднреА рдкреИрдХреЗрдЬ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рдкрд╣рд▓реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдФрд░ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  <code>install.packages()</code> рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдмрд╛рд░ рдПрдХ рдкреИрдХреЗрдЬ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред  <code>library()</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд░ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдирдП рдХрд╛рд░реНрдп рд╕рддреНрд░ рдореЗрдВ рдкреИрдХреЗрдЬ рдХреЛ рдХрдиреЗрдХреНрдЯ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред </p><br><p>  <code>rym</code> рдкреИрдХреЗрдЬ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдФрд░ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрди рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ: </p><br><pre> <code class="plaintext hljs">install.packages("rym") library(rym)</code> </pre> <br><h2 id="rabota-s-logs-api-yandeks-metriki-s-pomoschyu-paketa-rym">  рд░реЙрдо рдкреИрдХреЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рдпрд╛рдВрдбреЗрдХреНрд╕ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ </h2><br><p>  рд╡реНрдпрд╡рд╣рд╛рд░ рдлрд╝рдирд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЖрдкрдХреА рд╕рд╛рдЗрдЯ рдкрд░ рдХрд┐рдП рдЧрдП рд╕рднреА рд╡рд┐рдЬрд╝рд┐рдЯ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рдЖрдЧреЗ рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><h3 id="avtorizaciya-v-api-yandeks-metriki">  рдпрд╛рдВрдбреЗрдХреНрд╕ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдПрдкреАрдЖрдИ рдореЗрдВ рдкреНрд░рд╛рдзрд┐рдХрд░рдг </h3><br><p>  рдПрдкреАрдЖрдИ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред  <code>rym</code> рдкреИрдХреЗрдЬ рдореЗрдВ <code>rym</code> рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╣реЛрддреА рд╣реИ рдФрд░ рддрдм рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ рдЬрдм рдЗрд╕рдХреЗ рдХрд┐рд╕реА рднреА рдХрд╛рд░реНрдп рдХреЛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдкрд╣рд▓реА рдмрд╛рд░ рдЬрдм рдЖрдк рдПрдкреАрдЖрдИ рддрдХ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ <code>rym</code> рдкреИрдХреЗрдЬ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рдпреИрдВрдбреЗрдХреНрд╕ рдореИрдЯреНрд░рд┐рдХреНрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдкреБрд╖реНрдЯрд┐ рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рдЙрд╕ рдкреГрд╖реНрда рдкрд░ рдкреБрдирдГ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрд╣рд╛рдВ рдЖрдкрдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдкреБрд╖реНрдЯрд┐рдХрд░рдг рдХреЛрдб рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЗрд╕реЗ <code>"Enter authorize code:"</code> рдХрдВрд╕реЛрд▓ <code>"Enter authorize code:"</code> рдЕрдиреБрд░реЛрдз рдХреЗ рдЬрд╡рд╛рдм рдХреЗ рд░реВрдк рдореЗрдВ рдЖрд░ рдХрдВрд╕реЛрд▓ рдореЗрдВ рдХреЙрдкреА рдФрд░ рдкреЗрд╕реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><p>  рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрдк <code>y</code> рдпрд╛ <code>yes</code> рдЬрд╡рд╛рдм рджреЗрдХрд░ рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рд╕рд╣реЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ <code>"Do you want save API credential in local file ..."</code> ред  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, API рдкрд░ рдЕрдЧрд▓реА рдХреЙрд▓ рдкрд░, рдЖрдкрдХреЛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреБрди: рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреА, рдФрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рд╕реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><h3 id="zapros-dannyh-iz-api-yandeks-metriki">  Yandex Metrica API рд╕реЗ рдбреЗрдЯрд╛ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдВ </h3><br><p>  рдпреИрдВрдбреЗрдХреНрд╕ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдПрдкреАрдЖрдИ рд╕реЗ рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рд╣рдо рдкреВрдЫрддреЗ рд╣реИрдВ, рд╡рд╣ рдЙрдкрд▓рдмреНрдз рдХрд╛рдЙрдВрдЯрд░реЛрдВ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд▓рдХреНрд╖реНрдпреЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рд╣реИред  рдпрд╣ <code>rym_get_counters()</code> рдФрд░ <code>rym_get_goals()</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs">#   library(rym) #    counters &lt;- rym_get_counters(login = " ") #    goals &lt;- rym_get_goals("0000000", #    login = " ")</code> </pre> <br><p>  рдЙрдкрд░реЛрдХреНрдд рдХреЛрдб рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, <code>" "</code> рдХреЛ рдЕрдкрдиреЗ Yandex рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдХреЗ рд╕рд╛рде рдмрджрд▓реЗрдВ, рдЬрд┐рд╕рдХреЗ рддрд╣рдд рдЖрдкрдХреЛ рдЖрд╡рд╢реНрдпрдХ Yandex рдореАрдЯреНрд░рд┐рдХ рдЙрдкрд▓рдмреНрдз рд╣реИрдВред  рдФрд░ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЖрд╡рд╢реНрдпрдХ рдХрд╛рдЙрдВрдЯрд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП <code>"0000000"</code> ред  рдЖрдк рд▓реЛрдб рдХрд┐рдП рдЧрдП <em>рдХрд╛рдЙрдВрдЯрд░реЛрдВ рдХреА</em> рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЖрдкрдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдХрд╛рдЙрдВрдЯрд░реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдЙрдкрд▓рдмреНрдз рдХрд╛рдЙрдВрдЯрд░реЛрдВ рдХреА рддрд╛рд▓рд┐рдХрд╛ - <em>рдХрд╛рдЙрдВрдЯрд░реЛрдВ</em> рдХреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд░реВрдк рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs"># A tibble: 2 x 9 id status owner_login name code_status site permission type gdpr_agreement_accepted &lt;int&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; 1 11111111 Active site.ru1 Aerosus CS_NOT_FOUND site.ru edit simple 0 2 00000000 Active site.ru Aerosus RU CS_OK site.ru edit simple 1</code> </pre> <br><p>  <em>рдЖрдИрдбреА</em> рдлрд╝реАрд▓реНрдб рд╕рднреА рдЙрдкрд▓рдмреНрдз рдпреИрдВрдбреЗрдХреНрд╕ рдореАрдЯреНрд░рд┐рдХ рдХрд╛рдЙрдВрдЯрд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рджрд┐рдЦрд╛рддреА рд╣реИред </p><br><p>  <em>рд▓рдХреНрд╖реНрдп</em> рддрд╛рд▓рд┐рдХрд╛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: </p><br><pre> <code class="plaintext hljs"># A tibble: 4 x 5 id name type is_retargeting conditions &lt;int&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; &lt;fct&gt; 1 47873638    url 0 type:contain, url:site.ru/checkout/cart/ 2 47873764    url 0 type:contain, url:site.ru/onestepcheckout/ 3 47874133     url 0 type:contain, url:/checkout/onepage/success 4 50646283     action 0 type:exact, url:click_phone</code> </pre> <br><p>  рдпрд╛рдиреА  рдЬрд┐рд╕ рдХрд╛рдЙрдВрдЯрд░ рд╕реЗ рдореИрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реВрдВ, рдЙрд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреНрд░рд┐рдпрд╛рдПрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИ рд╣реИрдВ: </p><br><ul><li>  рдЯреЛрдХрд░реА рдореЗрдВ рдЬрд╛рдУ </li><li>  рднреБрдЧрддрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдУ </li><li>  рдЖрджреЗрд╢ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж рдкреГрд╖реНрда </li><li>  рдлрд╝реЛрди рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ </li></ul><br><p>  рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рдбреЗрдЯрд╛ рд░реВрдкрд╛рдВрддрд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо <code>tidyverse</code> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдкреИрдХреЗрдЬреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ: <code>tidyr</code> , <code>dplyr</code> ред  рдЗрд╕рд▓рд┐рдП, рдирд┐рдореНрди рдХреЛрдб рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЗрди рдкреИрдХреЗрдЬреЛрдВ рдпрд╛ рд╕рдВрдкреВрд░реНрдг <code>tidyverse</code> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдФрд░ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВред </p><br><pre> <code class="plaintext hljs"># install.packages("tidyverse") # library(tidyverse) install.packages(c("dplyr", "tidyr")) library(dplyr) library(tidyr)</code> </pre> <br><p>  <code>rym_get_logs()</code> рдлрд╝рдВрдХреНрд╢рди рдЖрдкрдХреЛ <code>rym_get_logs()</code> рдореИрдЯреНрд░рд┐рдХреНрд╕ рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рдореЗрдЯреНрд░рд┐рдХреНрд╕ рд╕реЗ рдбреЗрдЯрд╛ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs">#      logs &lt;- rym_get_logs(counter = "0000000", date.from = "2019-04-01", date.to = "2019-06-30", fields = "ym:s:visitID, ym:s:clientID, ym:s:date, ym:s:goalsID, ym:s:lastTrafficSource, ym:s:isNewUser", login = " ") %&gt;% mutate(ym.s.date = as.Date(ym.s.date), ym.s.clientID = as.character(ym.s.clientID))</code> </pre> <br><p>  <code>rym_get_logs()</code> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдореБрдЦреНрдп рддрд░реНрдХ <code>rym_get_logs()</code> : </p><br><ul><li>  рдХрд╛рдЙрдВрдЯрд░ - рдХрд╛рдЙрдВрдЯрд░ рдирдВрдмрд░ рдЬрд┐рд╕рд╕реЗ рдЖрдк рд▓реЙрдЧ рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╣реИрдВ; </li><li>  date.from - рдкреНрд░рд╛рд░рдВрдн рддрд┐рдерд┐; </li><li>  date.to - рд╕рдорд╛рдкреНрддрд┐ рддрд┐рдерд┐; </li><li>  рдлрд╝реАрд▓реНрдб - рдЙрди рдлрд╝реАрд▓реНрдб рдХреА рдПрдХ рд╕реВрдЪреА рдЬрд┐рд╕реЗ рдЖрдк рд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ; </li><li>  рд▓реЙрдЧрд┐рди - рдпреИрдВрдбреЗрдХреНрд╕ рд▓реЙрдЧрд┐рди рдЬрд┐рд╕рдХреЗ рддрд╣рдд <em>рдХрд╛рдЙрдВрдЯрд░ рдореЗрдВ</em> рдирд┐рд░реНрджрд┐рд╖реНрдЯ <em>рдХрд╛рдЙрдВрдЯрд░</em> рдЙрдкрд▓рдмреНрдз рд╣реИред </li></ul><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдордиреЗ рд▓реЙрдЧреНрд╕ API рд╕реЗ рдбреЗрдЯрд╛ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд┐рд╕рдореЗрдВ рдирд┐рдореНрди рдХреЙрд▓рдо рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: </p><br><ul><li>  ym: s: visitID - рд╡рд┐рдЬрд┐рдЯ рдЖрдИрдбреА </li><li>  ym: s: clientID - рд╕рд╛рдЗрдЯ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА </li><li>  ym: s: рджрд┐рдирд╛рдВрдХ - рдпрд╛рддреНрд░рд╛ рдХреА рддрд┐рдерд┐ </li><li>  ym: s: goalID - рдЗрд╕ рдпрд╛рддреНрд░рд╛ рдХреЗ рджреМрд░рд╛рди рдкреНрд░рд╛рдкреНрдд рд▓рдХреНрд╖реНрдпреЛрдВ рдХреА рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ </li><li>  ym: s: lastTrafficSource - рдЯреНрд░реИрдлрд╝рд┐рдХ рд╕реНрд░реЛрдд </li><li>  ym: s: .NewUser - рдкрд╣рд▓реЗ рдЖрдЧрдВрддреБрдХ рдХрд╛ рджреМрд░рд╛ </li></ul><br><blockquote>  рдЙрдкрд▓рдмреНрдз рдлрд╝реАрд▓реНрдб рдХреА рдкреВрд░реА рд╕реВрдЪреА рдХреЗ рд▓рд┐рдП, рд▓реЙрдЧреНрд╕ API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд╣рд╛рдпрддрд╛ рджреЗрдЦреЗрдВ</a> ред </blockquote><p>  рдкреНрд░рд╛рдкреНрдд рдбреЗрдЯрд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдлрд╝рдирд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ, рдЬрд┐рд╕рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рдХреЗ рд╕рд╛рде рдХрд╛рдо рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рд╣рдо рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреЗ рдЕрдЧрд▓реЗ рдЪрд░рдг - рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдкрд░ рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВред </p><br><h1 id="postroenie-voronok-paket-funneljoin">  рдлрд╝рдирд▓ рдмрд┐рд▓реНрдбрд┐рдВрдЧ рдлрд╝рдирд▓рдЬреЙрдЗрди рдкреИрдХреЗрдЬ </h1><br><blockquote>  рдЗрд╕ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рджреА рдЧрдИ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣рд┐рд╕реНрд╕рд╛ рдлрд╝рдирд▓рдЬреЗрди README рдкреИрдХреЗрдЬ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ <a href="">рд╕рдВрджрд░реНрдн</a> рджреНрд╡рд╛рд░рд╛ рдЙрдкрд▓рдмреНрдз рд╣реИред </blockquote><p>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рдлрд╝рдирд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП <code>funneljoin</code> рд▓рдХреНрд╖реНрдп рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдкрдХрд╛ рдХрд╛рд░реНрдп рдЙрди рд▓реЛрдЧреЛрдВ рдХреЛ рдЦреЛрдЬрдирд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреА рд╕рд╛рдЗрдЯ рдкрд░ рдЧрдП рдФрд░ рдлрд┐рд░ рдкрдВрдЬреАрдХреГрдд рд╣реБрдП, рдФрд░ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдХрд┐ рдкрд╣рд▓реА рдпрд╛рддреНрд░рд╛ рдФрд░ рдкрдВрдЬреАрдХрд░рдг рдХреЗ рдмреАрдЪ рдХрд┐рддрдирд╛ рд╕рдордп рдмреАрдд рдЪреБрдХрд╛ рд╣реИред  рдпрд╛ рдЖрдкрдХреЛ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рджреЛ рджрд┐рдиреЛрдВ рдХреЗ рднреАрддрд░ рдЙрддреНрдкрд╛рдж рдХрд╛рд░реНрдб рдХреЛ рджреЗрдЦрд╛ рдФрд░ рдЯреЛрдХрд░реА рдореЗрдВ рдЬреЛрдбрд╝ рджрд┐рдпрд╛ред  <code>funneljoin</code> рдкреИрдХреЗрдЬ рдФрд░ <code>after_join()</code> рдлрд╝рдВрдХреНрд╢рди рдРрд╕реА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  <strong>рдХреЗ рдмрд╛рдж <code>after_join()</code> :</strong> </p><br><ul><li>  x - рдкрд╣рд▓реЗ рдИрд╡реЗрдВрдЯ рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдкрд░ рдЬрд╛рдирдХрд╛рд░реА рдпреБрдХреНрдд рдбреЗрдЯрд╛ рдХрд╛ рдПрдХ рд╕реЗрдЯ (рдкрд╣рд▓реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╕рд╛рдЗрдЯ рдкрд░ рдЬрд╛рдХрд░, рджреВрд╕рд░реЗ рдЙрддреНрдкрд╛рдж рдХреЛ рджреЗрдЦрдиреЗ рдкрд░) </li><li>  y - рджреВрд╕рд░реА рдШрдЯрдирд╛ рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╡рд╛рд▓рд╛ рдПрдХ рдбреЗрдЯрд╛ рд╕реЗрдЯ, (рдкрдВрдЬреАрдХрд░рдг рдХреЗ рдкрд╣рд▓реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рджреВрд╕рд░реЗ рдореЗрдВ, рдЯреЛрдХрд░реА рдореЗрдВ рдЙрддреНрдкрд╛рдж рдЬреЛрдбрд╝рдХрд░)ред </li><li>  by_time - рддрд╛рд▓рд┐рдХрд╛ <em>x</em> рдФрд░ <em>y</em> рдореЗрдВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдШрдЯрдирд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╡рд╛рд▓рд╛ рдПрдХ рд╕реНрддрдВрднред </li><li>  by_user - рддрд╛рд▓рд┐рдХрд╛ <em>x</em> рдФрд░ <em>y</em> рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрддрдВрднред </li><li>  рдореЛрдб - рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╡рд┐рдзрд┐: "рдЗрдирд░", "рдлреБрд▓", "рдПрдВрдЯреА", "рд╕реЗрдореА", "рд░рд╛рдЗрдЯ", "рд▓реЗрдлреНрдЯ"ред  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдЖрдк <code>after_mode_join</code> (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <code>after_inner_join</code> рдмрдЬрд╛рдп <code>after_join (..., mode = "inner")</code> рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </li><li>  рдкреНрд░рдХрд╛рд░ - рдЕрдиреБрдХреНрд░рдо рдХрд╛ рдкреНрд░рдХрд╛рд░ рдШрдЯрдирд╛рдУрдВ рдХреЗ рдЬреЛрдбрд╝реЗ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ "рдкрд╣рд▓реЗ-рдкрд╣рд▓реЗ", "рдЕрдВрддрд┐рдо-рдкрд╣рд▓реЗ", "рдХрд┐рд╕реА рднреА-рдкрд╣рд▓реЗ"ред  "рдлрд╝рдирд▓ рдХреЗ рдкреНрд░рдХрд╛рд░" рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдореЗрдВ рд╡рд░реНрдгрд┐рдд рд╣реИред </li><li>  max_gap / min_gap (рд╡реИрдХрд▓реНрдкрд┐рдХ) - рдкрд╣рд▓реА рдФрд░ рджреВрд╕рд░реА рдШрдЯрдирд╛рдУрдВ рдХреЗ рдмреАрдЪ рдЕрдзрд┐рдХрддрдо рдФрд░ рдиреНрдпреВрдирддрдо рдЕрд╡рдзрд┐ рддрдХ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░реЗрдВред </li><li>  gap_col (рд╡реИрдХрд▓реНрдкрд┐рдХ) - рдХреНрдпрд╛ рдШрдЯрдирд╛рдУрдВ рдХреЗ рдмреАрдЪ рдПрдХ рд╕рдордп рдХреЗ рдЕрдВрддрд░ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрдЦреНрдпрд╛рддреНрдордХ <em>.gap</em> рдХреЙрд▓рдо рд╡рд╛рдкрд╕ рдХрд░рдирд╛ рд╣реИред  рдбрд┐рдлрд╝реЙрд▓реНрдЯ FALSE рд╣реИред </li></ul><br><h2 id="ustanovka-funneljoin">  рдлрд╝рдирд▓ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ </h2><br><p>  рдЗрд╕ рд▓реЗрдЦрди рдХреЗ рд╕рдордп, <code>funneljoin</code> рдкреИрдХреЗрдЬ CRAN рдкрд░ рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ <code>funneljoin</code> , рдЗрд╕рд▓рд┐рдП рдЖрдк рдЗрд╕реЗ GitHub рд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  GitHub рд╕реЗ рдкреИрдХреЗрдЬ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдкреИрдХреЗрдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА - <code>devtools</code> ред </p><br><pre> <code class="plaintext hljs">install.packages("devtools") devtools::install_github("robinsones/funneljoin")</code> </pre> <br><h2 id="postobrabotka-dannyh-poluchennyh-iz-logs-api">  рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдкреЛрд╕реНрдЯрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдбреЗрдЯрд╛ </h2><br><p>  рдлрд╝рдирд▓ рдирд┐рд░реНрдорд╛рдг рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдХреЗ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЕрдзреНрдпрдпрди рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдбреЗрдЯрд╛ рдХреЛ рд╡рд╛рдВрдЫрд┐рдд рд░реВрдк рдореЗрдВ рд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдбреЗрдЯрд╛ рдореЗрдВ рд╣реЗрд░рдлреЗрд░ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рддрд░реАрдХрд╛, рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдКрдкрд░ рд▓рд┐рдЦрд╛ рдерд╛, <code>tidyr</code> рдФрд░ <code>dplyr</code> рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ <code>dplyr</code> ред </p><br><p>  рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░реЗрдВ: </p><br><ol><li>  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, <em>рд▓реЙрдЧ</em> рдЯреЗрдмрд▓ рдХреА рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рдПрдХ рд╡рд┐рдЬрд╝рд┐рдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ, рдФрд░ <em>ym.s.goalsID</em> рдХреЙрд▓рдо рдлреЙрд░реНрдо рдХреА рдПрдХ рд╕рд░рдгреА рд╣реЛрддреА рд╣реИ - <code>[0,1,0,...]</code> , рдЬрд┐рд╕рдореЗрдВ рдЗрд╕ рдпрд╛рддреНрд░рд╛ рдХреЗ рджреМрд░рд╛рди рдкреНрд░рд╛рдкреНрдд рд▓рдХреНрд╖реНрдпреЛрдВ рдХреЗ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╣реЛрддреЗ рд╣реИрдВред  рд╕рд░рдгреА рдХреЛ рдЖрдЧреЗ рдХреЗ рдХрд╛рдо рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд░реВрдк рдореЗрдВ рд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╡рд░реНрдЧ рдХреЛрд╖реНрдардХ рд╕реЗ, рдЕрддрд┐рд░рд┐рдХреНрдд рд╡рд░реНрдгреЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред </li><li>  рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рд╕реБрдзрд╛рд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рддрд╛рдХрд┐ рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рдпрд╛рддреНрд░рд╛ рдХреЗ рджреМрд░рд╛рди рдкреНрд░рд╛рдкреНрдд рдПрдХ рд▓рдХреНрд╖реНрдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛред  рдпрд╛рдиреА  рдпрджрд┐ рдПрдХ рдпрд╛рддреНрд░рд╛ рдХреЗ рджреМрд░рд╛рди рддреАрди рд▓рдХреНрд╖реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЧрдП рдереЗ, рддреЛ рдЗрд╕ рдпрд╛рддреНрд░рд╛ рдХреЛ рддреАрди рдкрдВрдХреНрддрд┐рдпреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдкрдВрдХреНрддрд┐, <em>ym.s.goalsID</em> рдХреЙрд▓рдо рдореЗрдВ <em>,</em> рдХреЗрд╡рд▓ рдПрдХ рд▓рдХреНрд╖реНрдп рдХреА рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╣реЛрдЧреАред </li><li>  рдкреНрд░рддреНрдпреЗрдХ рдпрд╛рддреНрд░рд╛ рдХреЗ рджреМрд░рд╛рди рд▓рдХреНрд╖реНрдпреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓реЙрдЧ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд▓рдХреНрд╖реНрдпреЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рдХреЗ рд╕рд╛рде рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рд╕рдВрд▓рдЧреНрди рдХрд░реЗрдВред </li><li>  <em>рдШрдЯрдирд╛рдУрдВ рдХреЗ</em> рд▓рд┐рдП рд▓рдХреНрд╖реНрдп рдирд╛рдо рдХреЗ рд╕рд╛рде <em>рдирд╛рдо</em> рд╕реНрддрдВрдн рдХрд╛ <em>рдирд╛рдо</em> рдмрджрд▓реЗрдВред </li></ol><br><p>  рдЙрдкрд░реЛрдХреНрдд рд╕рднреА рдХреНрд░рд┐рдпрд╛рдПрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдкреЛрд╕реНрдЯрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#      logs_goals &lt;- logs %&gt;% mutate(ym.s.goalsID = str_replace_all(ym.s.goalsID, #     "\\[|\\]", "") %&gt;% str_split(",")) %&gt;% #     unnest(cols = c(ym.s.goalsID)) %&gt;% mutate(ym.s.goalsID = as.integer(ym.s.goalsID)) %&gt;% #  id     left_join(goals, by = c("ym.s.goalsID" = "id")) %&gt;% #      rename(events = name) #     events</code> </pre> </div></div><br><p>  рдХреЛрдб рдХреА рдПрдХ рдЫреЛрдЯреА рд╡реНрдпрд╛рдЦреНрдпрд╛ред  <code>%&gt;%</code> рдСрдкрд░реЗрдЯрд░ рдХреЛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдХреЛрдб рдХреЛ рдЕрдзрд┐рдХ рдкрдардиреАрдп рдФрд░ рдХреЙрдореНрдкреИрдХреНрдЯ рдмрдирд╛рддрд╛ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд▓реЗрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЕрдЧрд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкрд╣рд▓реЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдПрдХ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдХрдиреНрд╡реЗрдпрд░ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ рдордзреНрдпрд╡рд░реНрддреА рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕реБрдкрд░рдлреБрд▓ рдЪрд░ рдХреЗ рд╕рд╛рде рд░реИрдо рдХреЛ рд░реЛрдХрдирд╛ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред </p><br><p>  <code>str_replace_all</code> рдлрд╝рдВрдХреНрд╢рди <em>ym.s.goalsID</em> рдХреЙрд▓рдо рдореЗрдВ рд╡рд░реНрдЧ рдХреЛрд╖реНрдардХ рд╣рдЯрд╛рддрд╛ рд╣реИред  <code>str_split</code> <em>ym.s.goalsID</em> рдХреЙрд▓рдо рд╕реЗ рд▓рдХреНрд╖реНрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдорд╛рдиреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ <code>unnest</code> рдЙрдиреНрд╣реЗрдВ рдЕрдиреНрдп рд╕рднреА рд╕реНрддрдВрднреЛрдВ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ <code>unnest</code> , рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИред </p><br><p>  <code>mutate</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП <code>mutate</code> рд╣рдо рдкреВрд░реНрдгрд╛рдВрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓рд┐рдП рд▓рдХреНрд╖реНрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдбрд╛рд▓рддреЗ рд╣реИрдВред </p><br><p>  <code>left_join</code> рдкрд░рд┐рдгрд╛рдо рдХреЗ рд▓рд┐рдП <em>рдЧреЛрд▓</em> рддрд╛рд▓рд┐рдХрд╛ <code>left_join</code> , рдЬреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд▓рдХреНрд╖реНрдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред  рд╡рд░реНрддрдорд╛рди рддрд╛рд▓рд┐рдХрд╛ рд╕реЗ <em>ym.s.goalsID</em> рдХреЙрд▓рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рдФрд░ рдХреБрдВрдЬреА рддрд╛рд▓рд┐рдХрд╛ рд╕реЗ рдХреБрдВрдЬреА рд╕реНрддрдВрдн рдХреЗ рд░реВрдк рдореЗрдВ <em>рдЖрдИрдбреА</em> рдХреЙрд▓рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </p><br><p>  рдЕрдВрдд рдореЗрдВ, <code>rename</code> рдлрд╝рдВрдХреНрд╢рди <em>рдШрдЯрдирд╛рдУрдВ</em> рдореЗрдВ <em>рдирд╛рдо</em> рд╕реНрддрдВрдн рдХрд╛ <em>рдирд╛рдо</em> рдмрджрд▓ рджреЗрддрд╛ рд╣реИред </p><br><p>  рдЕрдм <em>log_goals</em> рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЖрдЧреЗ рдХреЗ рдХрд╛рдо рдХреЗ рд▓рд┐рдП <em>рдЙрдкрд╕реНрдерд┐рддрд┐</em> рдЖрд╡рд╢реНрдпрдХ рд╣реИред </p><br><p>  рдЕрдЧрд▓рд╛, рддреАрди рдирдИ рддрд╛рд▓рд┐рдХрд╛рдПрдБ рдмрдирд╛рдПрдБ: </p><br><ul><li>  first_visits - рд╕рднреА рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рд╕рддреНрд░ рдХреА рддрд╛рд░реАрдЦреЗрдВ </li><li>  рдХрд╛рд░реНрдЯ - рдЯреЛрдХрд░реА рдореЗрдВ рдЙрддреНрдкрд╛рджреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреА рддрд╛рд░реАрдЦреЗрдВ </li><li>  рдЖрджреЗрд╢ - рдЖрджреЗрд╢ </li></ul><br><div class="spoiler">  <b class="spoiler_title">рддрд╛рд▓рд┐рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#      first_visits &lt;- logs_goals %&gt;% filter(ym.s.isNewUser == 1 ) %&gt;% #     select(ym.s.clientID, #   clientID ym.s.date) #   date #       cart &lt;- logs_goals %&gt;% filter(events == "  ") %&gt;% select(ym.s.clientID, ym.s.date) #   orders &lt;- logs_goals %&gt;% filter(events == "   ") %&gt;% select(ym.s.clientID, ym.s.date)</code> </pre> </div></div><br><p>  рдкреНрд░рддреНрдпреЗрдХ рдирдИ рддрд╛рд▓рд┐рдХрд╛ рдЕрдВрддрд┐рдо рдЪрд░рдг рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдореБрдЦреНрдп <em>рд▓реЙрдЧ_рдЧреЛрд▓реНрд╕</em> рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИред  рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ <code>filter</code> рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдлрд╝рдирд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдФрд░ рдШрдЯрдирд╛ рдХреА рддрд╛рд░реАрдЦ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдЫреЛрдбрд╝рдирд╛ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ, рдЬреЛ рдХрд┐ <em>ym.s.clientID</em> рдФрд░ <em>ym.s.date</em> рдХреЙрд▓рдо рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ, рдирдИ рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдореЗрдВред  рдЗрдЪреНрдЫрд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд╛рдВрдЫрд┐рдд рдХреЙрд▓рдо рдЪреБрдиреЗ рдЧрдП рдереЗред </p><br><h2 id="tipy-voronok">  рдлрд╝рдирд▓ рдкреНрд░рдХрд╛рд░ </h2><br><p>  <em>рдкреНрд░рдХрд╛рд░</em> рддрд░реНрдХ <code>first</code> , <code>last</code> , <code>any</code> рдФрд░ <code>lastbefore</code> рдХреЗ <code>first</code> , <code>last</code> , <code>any</code> рдФрд░ <code>first</code> рдХреЗ рдмрд╛рдж рдХреЗ рдХрд┐рд╕реА рднреА рд╕рдВрдпреЛрдЬрди рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рд╕рдмрд╕реЗ рдЙрдкрдпреЛрдЧреА рд╕рдВрдпреЛрдЬрдиреЛрдВ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ: </p><br><ul><li>  <code>first-first</code> : рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдЬрд▓реНрдж рд╕реЗ рдЬрд▓реНрдж <em>x</em> рдФрд░ <em>y</em> рдЗрд╡реЗрдВрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо <strong>рдкрд╣рд▓реА</strong> рдпрд╛рддреНрд░рд╛ рдХреА рддрд╛рд░реАрдЦ, рдФрд░ <strong>рдкрд╣рд▓реА</strong> рдЦрд░реАрдж рдХреА рддрд╛рд░реАрдЦ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЬрд┐рд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ <code>first-first</code> рдлрд╝рдирд▓ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </li></ul><br><pre> <code class="plaintext hljs">#    first-first first_visits %&gt;% after_inner_join(orders, by_user = "ym.s.clientID", by_time = "ym.s.date", type = "first-first")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 42 x 3 ym.s.clientID ym.s.date.x ym.s.date.y &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1552251706539589249 2019-04-18 2019-05-15 2 1554193975665391000 2019-04-02 2019-04-15 3 1554317571426012455 2019-04-03 2019-04-04 4 15544716161033564779 2019-04-05 2019-04-08 5 1554648729526295287 2019-04-07 2019-04-11 6 1554722099539384487 2019-04-08 2019-04-17 7 1554723388680198551 2019-04-08 2019-04-08 8 15547828551024398507 2019-04-09 2019-05-13 9 1554866701619747784 2019-04-10 2019-04-10 10 1554914125524519624 2019-04-10 2019-04-10 # ... with 32 more rows</code> </pre> <br><p>  рд╣рдореЗрдВ рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдорд┐рд▓реА рд╣реИ рдЬрд┐рд╕рдореЗрдВ 1 рдкрдВрдХреНрддрд┐ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╕рд╛рдЗрдЯ рдкрд░ рдкрд╣рд▓реА рдпрд╛рддреНрд░рд╛ рдХреА рддрд╛рд░реАрдЦ рдФрд░ рдЙрд╕рдХреЗ рдкрд╣рд▓реЗ рдЖрджреЗрд╢ рдХреА рддрд╛рд░реАрдЦ рдХрд╛ рдбреЗрдЯрд╛ рд╣реИред </p><br><ul><li>  <code>first-firstafter</code> : рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ <em>x</em> рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ, рдлрд┐рд░ рдкрд╣рд▓рд╛ <em>y</em> рдкрд╣рд▓реЗ <em>x рдХреЗ</em> рдмрд╛рдж рд╣реБрдЖред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдиреЗ рдЖрдкрдХреА рд╕рд╛рдЗрдЯ рдкрд░ рдмрд╛рд░-рдмрд╛рд░ рджреМрд░рд╛ рдХрд┐рдпрд╛ рд╣реИ, рдФрд░ рдпрд╛рддреНрд░рд╛рдУрдВ рдХреЗ рджреМрд░рд╛рди рдЙрд╕рдиреЗ рдЯреЛрдХрд░реА рдореЗрдВ рдЙрддреНрдкрд╛рджреЛрдВ рдХреЛ рдЬреЛрдбрд╝рд╛, рдпрджрд┐ рдЖрдкрдХреЛ рдЯреЛрдХрд░реА рдореЗрдВ рдмрд╣реБрдд <strong>рдкрд╣рд▓реЗ</strong> рдЙрддреНрдкрд╛рдж рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреА рддрд┐рдерд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ <strong>рдирд┐рдХрдЯрддрдо</strong> рдСрд░реНрдбрд░ рдХреА рддрд╛рд░реАрдЦ, рдлрд╝рдирд▓ <code>first-firstafter</code> рдЯрд╛рдЗрдк рдХрд╛ рдЙрдкрдпреЛрдЧ <code>first-firstafter</code> ред </li></ul><br><pre> <code class="plaintext hljs">cart %&gt;% after_inner_join(orders, by_user = "ym.s.clientID", by_time = "ym.s.date", type = "first-firstafter")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 49 x 3 ym.s.clientID ym.s.date.x ym.s.date.y &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1551433754595068897 2019-04-02 2019-04-05 2 1552251706539589249 2019-05-15 2019-05-15 3 1552997205196001429 2019-05-23 2019-05-23 4 1553261825377658768 2019-04-11 2019-04-11 5 1553541720631103579 2019-04-04 2019-04-05 6 1553761108775329787 2019-04-16 2019-04-16 7 1553828761648236553 2019-04-03 2019-04-03 8 1554193975665391000 2019-04-13 2019-04-15 9 1554317571426012455 2019-04-04 2019-04-04 10 15544716161033564779 2019-04-08 2019-04-08 # ... with 39 more rows</code> </pre> <br><ul><li>  <code>lastbefore-firstafter</code> : first <em>x</em> рдЙрд╕рдХреЗ рдмрд╛рдж <em>y</em> рдЕрдЧрд▓реЗ <em>y</em> рд╕реЗ рдкрд╣рд▓реЗред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдкрдХреА рд╕рд╛рдЗрдЯ рдкрд░ рдмрд╛рд░-рдмрд╛рд░ рдЖрдпрд╛ рд╣реИ, рдХреБрдЫ рд╕рддреНрд░ рдЦрд░реАрдж рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реБрдПред  рдпрджрд┐ рдЖрдкрдХреЛ рдЦрд░реАрджрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЕрдВрддрд┐рдо рд╕рддреНрд░ рдХреА рддрд╛рд░реАрдЦ рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рдЦрд░реАрдж рдХреА рддрд╛рд░реАрдЦ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдлрд╝рдирд▓ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </li></ul><br><pre> <code class="plaintext hljs">first_visits %&gt;% after_inner_join(orders, by_user = "ym.s.clientID", by_time = "ym.s.date", type = "lastbefore-firstafter")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 50 x 3 ym.s.clientID ym.s.date.x ym.s.date.y &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1551433754595068897 2019-04-05 2019-04-05 2 1552251706539589249 2019-05-15 2019-05-15 3 1552251706539589249 2019-05-16 2019-05-16 4 1552997205196001429 2019-05-23 2019-05-23 5 1553261825377658768 2019-04-11 2019-04-11 6 1553541720631103579 2019-04-05 2019-04-05 7 1553761108775329787 2019-04-16 2019-04-16 8 1553828761648236553 2019-04-03 2019-04-03 9 1554193975665391000 2019-04-15 2019-04-15 10 1554317571426012455 2019-04-04 2019-04-04 # ... with 40 more rows</code> </pre> <br><p>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдореЗрдВ рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдорд┐рд▓реА рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рд╡рд╣ рджрд┐рдирд╛рдВрдХ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдЖрджреЗрд╢ рдкреВрд░рд╛ рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЕрдВрддрд┐рдо рдЙрддреНрдкрд╛рдж рдХреЛ рдЯреЛрдХрд░реА рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рдЖрджреЗрд╢ рдХреА рддрд┐рдерд┐ рднреАред </p><br><ul><li>  <code>any-firstafter</code> рдкрд╣рд▓реЗ рдХреЗ рдмрд╛рдж: рд╕рднреА <em>x</em> рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рдкрд╣рд▓рд╛ <em>y рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</em> ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдкрдХреА рд╕рд╛рдЗрдЯ рдкрд░ рдмрд╛рд░-рдмрд╛рд░ рдЖрдпрд╛ рд╣реИ, рдкреНрд░рддреНрдпреЗрдХ рдпрд╛рддреНрд░рд╛ рдХреЗ рджреМрд░рд╛рди рдЙрд╕рдиреЗ рдЯреЛрдХрд░реА рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдЙрддреНрдкрд╛рджреЛрдВ рдХреЛ рдЬреЛрдбрд╝рд╛ рдФрд░ рд╕рдордп-рд╕рдордп рдкрд░ рд╕рднреА рдЬреЛрдбрд╝реЗ рдЧрдП рдЙрддреНрдкрд╛рджреЛрдВ рдХреЗ рд╕рд╛рде рдСрд░реНрдбрд░ рдХрд┐рдПред  рдпрджрд┐ рдЖрдкрдХреЛ рдЯреЛрдХрд░реА рдореЗрдВ рд╕рднреА рдкрд░рд┐рд╡рд░реНрдзрди рдХреА рддрд╛рд░реАрдЦреЗрдВ рдФрд░ рдЕрдкрдиреЗ рдЖрджреЗрд╢реЛрдВ рдХреА рддрд╛рд░реАрдЦреЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдлрд╝рдирд▓ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ <code>any-firstafter</code> ред </li></ul><br><pre> <code class="plaintext hljs">cart %&gt;% after_inner_join(orders, by_user = "ym.s.clientID", by_time = "ym.s.date", type = "any-firstafter")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 239 x 3 ym.s.clientID ym.s.date.x ym.s.date.y &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1551433754595068897 2019-04-02 2019-04-05 2 1551433754595068897 2019-04-02 2019-04-05 3 1551433754595068897 2019-04-03 2019-04-05 4 1551433754595068897 2019-04-03 2019-04-05 5 1551433754595068897 2019-04-03 2019-04-05 6 1551433754595068897 2019-04-05 2019-04-05 7 1551433754595068897 2019-04-05 2019-04-05 8 1551433754595068897 2019-04-05 2019-04-05 9 1551433754595068897 2019-04-05 2019-04-05 10 1551433754595068897 2019-04-05 2019-04-05 # ... with 229 more rows</code> </pre> <br><ul><li>  рдХреЛрдИ рднреА-рдХреЛрдИ: рд╕рднреА <em>x</em> рдФрд░ рд╕рднреА <em>y</em> рдХреЛ рдкреНрд░рддреНрдпреЗрдХ <em>x рдХреЗ</em> рдмрдЧрд▓ рдореЗрдВ <em>рд▓рд╛рдПрдБ</em> ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рд╕рднреА рдмрд╛рдж рдХреЗ рдЖрджреЗрд╢реЛрдВ рдХреЗ рд╕рд╛рде рд╕рд╛рдЗрдЯ рдХреА рд╕рднреА рдпрд╛рддреНрд░рд╛рдУрдВ рдХреА рдПрдХ рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред </li></ul><br><pre> <code class="plaintext hljs">first_visits %&gt;% after_inner_join(orders, by_user = "ym.s.clientID", by_time = "ym.s.date", type = "any-any")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 122 x 3 ym.s.clientID ym.s.date.x ym.s.date.y &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1552251706539589249 2019-04-18 2019-05-15 2 1552251706539589249 2019-04-18 2019-05-15 3 1552251706539589249 2019-04-18 2019-05-15 4 1552251706539589249 2019-04-18 2019-05-16 5 1554193975665391000 2019-04-02 2019-04-15 6 1554193975665391000 2019-04-02 2019-04-25 7 1554317571426012455 2019-04-03 2019-04-04 8 15544716161033564779 2019-04-05 2019-04-08 9 1554648729526295287 2019-04-07 2019-04-11 10 1554722099539384487 2019-04-08 2019-04-17 # ... with 112 more rows</code> </pre> <br><h3 id="shagi-po-voronke">  рдлрд╝рдирд▓ рдЪрд░рдг </h3><br><p>  рдЙрдкрд░реЛрдХреНрдд рдЙрджрд╛рд╣рд░рдг <code>after_inner_join()</code> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реБрдП рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдпрд╣ рдЙрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ рдЬрд╣рд╛рдВ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЕрд▓рдЧ-рдЕрд▓рдЧ рддрд╛рд▓рд┐рдХрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕рднреА рдШрдЯрдирд╛рдПрдВ рд╣реИрдВ, рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ <em>first_visits</em> , <em>рдХрд╛рд░реНрдЯ</em> рдФрд░ <em>рдСрд░реНрдбрд░</em> рдЯреЗрдмрд▓ рдХреЗ рдЕрдиреБрд╕рд╛рд░ред </p><br><p>  рд▓реЗрдХрд┐рди рд▓реЙрдЧреНрд╕ рдПрдкреАрдЖрдИ рдЖрдкрдХреЛ рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕рднреА рдШрдЯрдирд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рджреЗрддрд╛ рд╣реИ, рдФрд░ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдЕрдиреБрдХреНрд░рдо рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП <code>funnel_start()</code> рдФрд░ <code>funnel_step()</code> рдлрд╝рдВрдХреНрд╢рди рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рддрд░реАрдХрд╛ рд╣реЛрдЧрд╛ред  <code>funnel_start</code> рдлрд╝рдирд▓ рдХреЗ рдкрд╣рд▓реЗ рдЪрд░рдг рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкрд╛рдБрдЪ рддрд░реНрдХ рд▓реЗрддрд╛ рд╣реИ: </p><br><ul><li>  tbl - рдШрдЯрдирд╛ рддрд╛рд▓рд┐рдХрд╛; </li><li>  moment_type - рдлрд╝рдирд▓ рдореЗрдВ рдкрд╣рд▓реА рдШрдЯрдирд╛; </li><li>  рдкрд▓ - рд╕реНрддрдВрдн рдХрд╛ рдирд╛рдо рдЬрд┐рд╕рдореЗрдВ рдШрдЯрдирд╛ рдХрд╛ рдирд╛рдо рд╢рд╛рдорд┐рд▓ рд╣реИ; </li><li>  tstamp - рдЙрд╕ рдШрдЯрдирд╛ рдХреЗ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рджрд┐рдирд╛рдВрдХ рдХреЗ рд╕рд╛рде рд╕реНрддрдВрдн рдХрд╛ рдирд╛рдо; </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ - рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХреЙрд▓рдо рдХрд╛ рдирд╛рдоред </li></ul><br><pre> <code class="plaintext hljs">logs_goals %&gt;% select(events, ym.s.clientID, ym.s.date) %&gt;% funnel_start(moment_type = "   ", moment = "events", tstamp = "ym.s.date", user = "ym.s.clientID")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 52 x 2 ym.s.clientID `ym.s.date_   ` &lt;chr&gt; &lt;date&gt; 1 1556018960123772801 2019-04-24 2 1561216372134023321 2019-06-22 3 1556955573636389438 2019-05-04 4 1559220890220134879 2019-05-30 5 1553261825377658768 2019-04-11 6 1561823182372545402 2019-06-29 7 1556047887455246275 2019-04-23 8 1554722099539384487 2019-04-17 9 1555420652241964245 2019-04-17 10 1553541720631103579 2019-04-05 # ... with 42 more rows</code> </pre> <br><p>  <code>funnel_start</code> <em>ym.s.clientI</em> рдФрд░ <em>ym.s.date_</em> рдХреЙрд▓рдо рдХреЗ рд╕рд╛рде рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рджреЗрддрд╛ рд╣реИ <code>ym.s.date_   </code> (рджрд┐рдирд╛рдВрдХ рдХреЗ рд╕рд╛рде рдЖрдкрдХреЗ рдХреЙрд▓рдо рдХрд╛ рдирд╛рдо, _ рдФрд░ рдШрдЯрдирд╛ рдХрд╛ рдирд╛рдо)ред </p><br><p>  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд░рдгреЛрдВ рдХреЛ <code>funnel_step()</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  <code>funnel_start</code> рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рд╕реНрддрдВрднреЛрдВ рдХреЗ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рджрд┐рдП рд╣реИрдВ, рдЕрдм рд╣рдореЗрдВ рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдХреМрди рд╕рд╛ рдИрд╡реЗрдВрдЯ <em>рдХреНрд╖рдгрд┐рдХрд╛</em> рддрд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрд╝рдирд▓ рдореЗрдВ рдЕрдЧрд▓рд╛ рдЪрд░рдг рд╣реЛрдЧрд╛, рдФрд░ рдХрдиреЗрдХреНрд╢рди <em>рдкреНрд░рдХрд╛рд░ рдЯрд╛рдЗрдк рд╣реИ</em> (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <code>"first-first"</code> , <code>"first-any"</code> )ред </p><br><pre> <code class="plaintext hljs">logs_goals %&gt;% select(events, ym.s.clientID, ym.s.date) %&gt;% funnel_start(moment_type = "  ", moment = "events", tstamp = "ym.s.date", user = "ym.s.clientID") %&gt;% funnel_step(moment_type = "   ", type = "first-last")</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 319 x 3 ym.s.clientID `ym.s.date_  ` `ym.s.date_   ` &lt;chr&gt; &lt;date&gt; &lt;date&gt; 1 1550828847886891355 2019-04-01 NA 2 1551901759770098825 2019-04-01 NA 3 1553595703262002507 2019-04-01 NA 4 1553856088331234886 2019-04-01 NA 5 1554044683888242311 2019-04-01 NA 6 1554095525459102609 2019-04-01 NA 7 1554100987632346537 2019-04-01 NA 8 1551433754595068897 2019-04-02 2019-04-05 9 1553627918798485452 2019-04-02 NA 10 155418104743178061 2019-04-02 NA # ... with 309 more rows</code> </pre> <br><p>  <code>funnel_step</code> рд╕рд╛рде <code>funnel_step</code> рдЖрдк рдХрд┐рд╕реА рднреА рдЪрд░рдг рдХреЗ рд╕рд╛рде рдлрд╝рдирд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреВрд░реНрдг рдлрд╝рдирд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдореЗрд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдЖрдк рдирд┐рдореНрди рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреВрд░реНрдг рдлрд╝рдирд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#         #     events - " " logs_goals &lt;- logs_goals %&gt;% filter(ym.s.isNewUser == 1 ) %&gt;% mutate(events = " ") %&gt;% bind_rows(logs_goals) #     logs_goals %&gt;% select(events, ym.s.clientID, ym.s.date) %&gt;% funnel_start(moment_type = " ", moment = "events", tstamp = "ym.s.date", user = "ym.s.clientID") %&gt;% funnel_step(moment_type = "  ", type = "first-last") %&gt;% funnel_step(moment_type = "  ", type = "first-last") %&gt;% funnel_step(moment_type = "   ", type = "first-last")</code> </pre> </div></div><br><p>  рдФрд░ рдЕрдм рдХреЗрдХ рдкрд░ рдЪреЗрд░реА <code>summarize_funnel()</code> ред  рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдЬреЛ рдЖрдкрдХреЛ рдкрд┐рдЫрд▓реЗ рдЪрд░рдг рд╕реЗ рдЕрдЧрд▓реЗ рддрдХ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкреНрд░рддрд┐рд╢рдд рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдкреНрд░рддрд┐рд╢рдд рдЬреЛ рдкрд╣рд▓реЗ рдЪрд░рдг рд╕реЗ рдЧреБрдЬрд░ рдЪреБрдХреЗ рд╣реИрдВ, рдкреНрд░рддреНрдпреЗрдХ рдмрд╛рдж рдореЗрдВред </p><br><pre> <code class="plaintext hljs">my_funnel &lt;- logs_goals %&gt;% select(events, ym.s.clientID, ym.s.date) %&gt;% funnel_start(moment_type = " ", moment = "events", tstamp = "ym.s.date", user = "ym.s.clientID") %&gt;% funnel_steps(moment_type = c("  ", "  ", "   "), type = "first-last") %&gt;% summarize_funnel()</code> </pre> <br><pre> <code class="plaintext hljs"># A tibble: 4 x 4 moment_type nb_step pct_cumulative pct_step &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; 1   18637 1 NA 2    1589 0.0853 0.0853 3    689 0.0494 0.579 4     34 0.0370 0.749</code> </pre> <br><p> <code>nb_step</code> тАФ   ,   , <code>pct_cumulative</code> тАФ      ,  <code>pct_step</code> тАФ    . </p><br><h1 id="vizualizaciya-voronki">   </h1><br><p>    <em>my_funnel</em>   ,        <code>ggplot2</code> . </p><br><p> <code>ggplot2</code> тАФ       R,      .     ,      ,  . </p><br><p>  <code>ggplot2</code>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  </a> ,     2005 .    ,    photoshop,  ,       . </p><br><h3 id="vizualizaciya-obschey-voronki">    </h3><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># install.packages("ggplot2") library(ggplot2) my_funnel %&gt;% mutate(padding = (sum(my_funnel$nb_step) - nb_step) / 2) %&gt;% gather(key = "variable", value = "val", -moment_type) %&gt;% filter(variable %in% c("nb_step", "padding")) %&gt;% arrange(desc(variable)) %&gt;% mutate(moment_type = factor(moment_type, levels = c("   ", "  ", "  ", " "))) %&gt;% ggplot( aes(x = moment_type) ) + geom_bar(aes(y = val, fill = variable), stat='identity', position='stack') + scale_fill_manual(values = c('coral', NA) ) + geom_text(data = my_funnel, aes(y = sum(my_funnel$nb_step) / 2, label = paste(round(round(pct_cumulative * 100,2)), '%')), colour='tomato4', fontface = "bold") + coord_flip() + theme(legend.position = 'none') + labs(x='moment', y='volume')</code> </pre> </div></div><br><p>         : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/260/763/bcf/260763bcf4c60a84ab713d2931e95ebe.png" alt="рдлрд╝рдирд▓ рджреГрд╢реНрдп"></p><br><p>     . </p><br><ol><li>         <em>my_funnel</em> . </li><li> <code>ggplot</code> тАФ      ,    ,     ,    X     <em>moment_type</em> . </li><li> <code>geom_bar</code> тАФ  тАФ  ,            <code>aes</code> . </li><li> <code>scale_fill_manual</code> тАФ    ,         ,    . </li><li> <code>geom_text</code> тАФ   ,   %    . </li><li> <code>coord_flip</code> тАФ   ,     . </li><li> <code>theme</code> тАФ      : ,   ..           . </li><li> <code>labs</code> тАФ     . </li></ol><br><h3 id="vizualizaciya-voronki-v-razreze-kanalov-trafika">       </h3><br><p>     ,   ,  ,      ,    . </p><br><p>           <code>lapply</code> ,       R.        ,      ,        <code>bind_rows</code> . </p><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#        first_visits &lt;- rename(first_visits, firstSource = ym.s.lastTrafficSource) #          logs_goals &lt;- select(first_visits, ym.s.clientID, firstSource) %&gt;% left_join(logs_goals, ., by = "ym.s.clientID") #     my_multi_funnel &lt;- lapply(c("ad", "organic", "direct"), function(source) { logs_goals %&gt;% filter(firstSource == source) %&gt;% select(events, ym.s.clientID, ym.s.date) %&gt;% funnel_start(moment_type = " ", moment = "events", tstamp = "ym.s.date", user = "ym.s.clientID") %&gt;% funnel_steps(moment_type = c("  ", "  ", "   "), type = "first-last") %&gt;% summarize_funnel() %&gt;% mutate(firstSource = source) }) %&gt;% bind_rows() #  </code> </pre></div></div><br><pre> <code class="plaintext hljs"># A tibble: 12 x 5 moment_type nb_step pct_cumulative pct_step firstSource &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 1   14392 1 NA ad 2    154 0.0107 0.0107 ad 3    63 0.00438 0.409 ad 4     14 0.000973 0.222 ad 5   3372 1 NA organic 6    68 0.0202 0.0202 organic 7    37 0.0110 0.544 organic 8     13 0.00386 0.351 organic 9   607 1 NA direct 10    49 0.0807 0.0807 direct 11    21 0.0346 0.429 direct 12     8 0.0132 0.381 direct</code> </pre> <br><p>     <em>my_multi_funnel</em> ,        . </p><br><div class="spoiler"> <b class="spoiler_title">       </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#    my_multi_funnel %&gt;% mutate(padding = ( 1 - pct_cumulative) / 2 ) %&gt;% gather(key = "variable", value = "val", -moment_type, -firstSource) %&gt;% filter(variable %in% c("pct_cumulative", "padding")) %&gt;% arrange(desc(variable)) %&gt;% mutate(moment_type = factor(moment_type, levels = c("   ", "  ", "  ", " ")), variable = factor(variable, levels = c("pct_cumulative", "padding"))) %&gt;% ggplot( aes(x = moment_type) ) + geom_bar(aes(y = val, fill = variable), stat='identity', position='stack') + scale_fill_manual(values = c('coral', NA) ) + geom_text(data = my_multi_funnel_df, aes(y = 1 / 2, label =paste(round(round(pct_cumulative * 100, 2)), '%')), colour='tomato4', fontface = "bold") + coord_flip() + theme(legend.position = 'none') + labs(x='moment', y='volume') + facet_grid(. ~ firstSource)</code> </pre> </div></div><br><p>      : <br><img src="https://habrastorage.org/getpro/habr/post_images/12d/9a7/631/12d9a7631235b42f1081d996fa7eec62.png" alt="рдЪреИрдирд▓ рдХреАрдк"></p><br><p>     ? </p><br><ol><li>   <code>first_visits</code>    <code>ym.s.lastTrafficSource</code>  <code>firstSource</code> . </li><li>   <code>left_join</code>          <em>ym.s.clientID</em> .                 <code>firstSource</code> . </li><li>   <code>lapply</code>        ad, organic  direct.         <code>bind_rows</code> . </li><li>      <code>facet_grid(. ~ firstSource)</code> ,         <code>firstSource</code> . </li></ol><br><h1 id="ps">  рдкреБрдирд╢реНрдЪ </h1><br><p>    .       <strong>PS</strong>      ,       R.           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">R4marketing</a> ,          R        . </p><br><p>    : </p><br><ul><li> ; </li><li> ; </li><li> ; </li><li>         R. </li></ul><br><h1 id="zaklyuchenie">  рдирд┐рд╖реНрдХрд░реНрд╖ </h1><br><p>  ,    ,        R     : </p><br><ol><li>             .; </li><li>   R    RStudio; </li><li>   <code>rym</code> , <code>funneljoin</code>  <code>ggplot2</code> ; </li><li>    <code>rym</code>   <code>rym_get_logs()</code>    .; </li><li>    <code>funneljoin</code>      . </li><li>      <code>ggplot2</code> . </li></ol><br><p>           ,     Logs API  ,      : CRM, 1   . ,         :  ,    -. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi462279/">https://habr.com/ru/post/hi462279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi462269/index.html">рдЬреЙрди рд░реЛрдореЗрд░реЛ рд╕реЗ рдХрдпрд╛рдордд: 80 рдХреЗ рджрд╢рдХ рдЦреЗрд▓ рджреЗрд╡</a></li>
<li><a href="../hi462271/index.html">IOS рдореЗрдВ рд▓реЙрдХ рдХреЛрдб: рдХреИрд╕реЗ Apple рдбрд┐рдлреЗрдВрд╕ рд╕реЗ рдбрд┐рдлреЗрдВрд╕ рдореЗрдВ рдмрджрд▓рдХрд░ рд╕рд┐рдВрдЧрд▓ рдлреНрд░рдВрдЯрд┐рдпрд░ рдХреА рд░рдЦрд╡рд╛рд▓реА рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi462273/index.html">Digispark рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рд▓реИрдкрдЯреЙрдк рд╕реНрдЯреИрдВрдб рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░реЗрдВ</a></li>
<li><a href="../hi462275/index.html">рдкреЗрд╢ рд╣реИ рдЬрд╛рд╡рд╛ рдХреЗ рд▓рд┐рдП рдкреАрд╡реАрдПрд╕-рд╕реНрдЯреВрдбрд┐рдпреЛ рд╕реНрдЯреЗрдЯрд┐рдХ рдПрдирд╛рд▓рд╛рдЗрдЬрд░</a></li>
<li><a href="../hi462277/index.html">рдЯреЗрдХ рд░рд┐рд▓реАрдЬ Mail.ru рдЧреНрд░реБрдк 2019</a></li>
<li><a href="../hi462283/index.html">рдирд┐рдпрдВрддреНрд░рдг рдХрдХреНрд╖ рдкрд░ GAZ-66 рдЦрд┐рд▓реМрдирд╛ред рднрд╛рдЧ 1</a></li>
<li><a href="../hi462293/index.html">рдХреИрд╕реЗ рддреЗрдЬреА рд╕реЗ рд╡рд┐рдХрд╛рд╕ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХрд┐рдпрд╛рдВ рдЕрдкреНрд░рд┐рдп рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рд╕реНрд░реЛрдд рдмрди рд╕рдХрддреА рд╣реИрдВ</a></li>
<li><a href="../hi462295/index.html">рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЖрдХрд╛рд░ рд╣рдорд╛рд░реЗ рдкреНрд░рдпрд╛рд╕ рдХреЗ рд▓рд╛рдпрдХ рдирд╣реАрдВ рд╣реИ</a></li>
<li><a href="../hi462297/index.html">рд╣реИрдмрд░ рд╡реАрдХрд▓реА # 12 / рд╡рдирд╡реЗрдм, рдПрдЧреНрд░реАрдЧреЗрдЯрд░реНрд╕ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реНрдЯреЗрд╢рди, рдЖрдИрдЯреА рдореЗрдВ рд╡реЗрддрди, "рдкреНрд░рд┐рдп, рд╣рдо рдЗрдВрдЯрд░рдиреЗрдЯ рдХреЛ рдорд╛рд░рддреЗ рд╣реИрдВ" рд░реВрд╕реА рд╕рдВрдШ рдореЗрдВ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рдереА</a></li>
<li><a href="../hi462299/index.html">рдкреВрд░реА рддрд░рд╣ рд╕реЗ .NET рдореЗрдВ рд░рд╛рдЙрдВрдбрд┐рдВрдЧ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>