<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚û∞ üëºüèΩ üîì R√©tro-ing√©nierie du mode d√©veloppeur Animal Crossing üë©üèº‚Äçüéì üéå üëçüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'√©t√© dernier, j'ai commenc√© le reverse engineering Animal Crossing pour le GameCube. Je voulais explorer la possibilit√© de cr√©er des mods pour ce jeu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©tro-ing√©nierie du mode d√©veloppeur Animal Crossing</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413967/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/fe4/7f0/b4dfe47f0139ba1af039decfb6274524.jpg" alt="Utiliser le code sur un vrai GameCube"></div><br>  L'√©t√© dernier, j'ai commenc√© le reverse engineering Animal Crossing pour le GameCube.  Je voulais explorer la possibilit√© de cr√©er des mods pour ce jeu.  De plus, je voulais documenter le processus de cr√©ation de didacticiels pour les personnes int√©ress√©es par le piratage des ROM et le reverse engineering.  Dans cet article, je parlerai des fonctionnalit√©s de d√©bogage des d√©veloppeurs qui sont rest√©es dans le jeu, et partagerai √©galement comment j'ai d√©couvert des combinaisons de triche qui peuvent √™tre utilis√©es pour les d√©verrouiller. <br><a name="habracut"></a><br><h3>  new_Debug_mode </h3><br>  En √©tudiant les symboles de d√©bogage restants, j'ai remarqu√© les noms des fonctions et des variables contenant le mot ¬´d√©bogage¬ª, et j'ai d√©cid√© qu'il serait int√©ressant de voir s'il restait une fonctionnalit√© de d√©bogage dans le jeu.  Si j'arrive √† activer les fonctions de d√©bogage ou de d√©veloppement, cela m'aidera √† cr√©er des mods. <br><br>  La premi√®re fonction que j'ai remarqu√©e √©tait <code>new_Debug_mode</code> .  Il est appel√© par la fonction d' <code>entry</code> , qui d√©marre imm√©diatement apr√®s la fin de l'√©cran du logo Nintendo.  Elle ne fait que placer la structure d'octets <code>0x1C94</code> et y enregistrer un pointeur. <br><br>  Apr√®s avoir √©t√© appel√© en <code>entry</code> dans la structure h√©berg√©e √† l'offset <code>0xD4</code> imm√©diatement avant d'appeler <code>mainproc</code> valeur 0 est d√©finie. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/63e/fbc/0af/63efbc0af9ebfb4eeb2c3b42feddcbed.png"></div><br>  Pour voir ce qui se passe lorsque la valeur n'est pas nulle, j'ai corrig√© l'instruction <code>li r0, 0</code> √† <code>80407C8C</code> , en la rempla√ßant par <code>li r0, 1</code> .  Les octets bruts de l'instruction <code>li r0, 0</code> sont <code>38 00 00 00</code> o√π la valeur assign√©e est √† la fin de l'instruction, donc je pourrais simplement remplacer les octets par <code>38 00 00 01</code> et obtenir <code>li r0, 1</code> .  Pour cr√©er des instructions de mani√®re plus fiable, vous pouvez utiliser quelque chose comme <code>kstool</code> : <br><br> <code>$ kstool ppc32be "li 0, 1" <br> li 0, 1 = [ 38 00 00 01 ]</code> <br> <br>  Dans l'√©mulateur Dolphin, ce patch peut √™tre appliqu√© en allant dans l'onglet "Patches" dans les propri√©t√©s du jeu et en le saisissant comme suit: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e65/ecb/706/e65ecb7061c9470c9a9b71c4aad8e506.png"></div><br>  Apr√®s avoir attribu√© la valeur 1, un graphique int√©ressant est apparu en bas de l'√©cran: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be5/cab/e1f/be5cabe1fe1df63d0534c092d49ca8f9.png"></div><br><br>  Cela ressemblait √† un indicateur de performance: les petites barres en bas de l'√©cran ont augment√© ou diminu√©.  (Plus tard, lorsque j'ai regard√© les noms des fonctions qui dessinent ce graphique, j'ai constat√© qu'elles affichent en fait des mesures d'utilisation du processeur et de la m√©moire.) <br><br>  C'√©tait super, mais pas particuli√®rement utile.  Apr√®s avoir attribu√© la valeur 1, ma ville a cess√© de se charger, donc rien d'autre n'a pu √™tre fait ici. <br><br><h3>  Mode Zuru </h3><br>  J'ai recommenc√© √† chercher d'autres r√©f√©rences aux fonctions de d√©bogage, et plusieurs fois j'ai rencontr√© quelque chose appel√© ¬´mode zuru¬ª.  Les branches de blocs de code avec fonctionnalit√© de d√©bogage v√©rifiaient souvent la variable <code>zurumode_flag</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/4d4/63c/88e4d463c3ea3474d3b67e2cf8367ee2.png" alt="Fonction game_move_first"></div><br>  <code>zzz_LotsOfDebug</code> (le nom que j'ai trouv√© moi-m√™me) dans la fonction <code>game_move_first</code> montr√©e ci-dessus est appel√© uniquement lorsque <code>zurumode_flag</code> pas √©gal √† z√©ro. <br><br>  √Ä la recherche de fonctions associ√©es √† cette valeur, j'ai trouv√© celles-ci: <br><br><ul><li> <code>zurumode_init</code> </li> <li> <code>zurumode_callback</code> </li> <li> <code>zurumode_update</code> </li> <li> <code>zurumode_cleanup</code> </li> </ul><br>  √Ä premi√®re vue, leur objectif est myst√©rieux, ils jonglent avec des bits dans les d√©calages d'une variable appel√©e <code>osAppNMIBuffer</code> . <br><br>  Voici √† quoi ressemble le travail de ces fonctions √† premi√®re vue: <br><br><h4>  zurumode_init </h4><br><ul><li>  D√©finit <code>zurumode_flag</code> √† 0 </li><li>  V√©rifie plusieurs bits dans <code>osAppNMIBuffer</code> </li><li>  Enregistre un pointeur sur la fonction <code>zurumode_callback</code> dans la structure <code>padmgr</code> </li><li>  Appelle <code>zurumode_update</code> </li></ul><br><h4>  zurumode_update </h4><br><ul><li>  V√©rifie plusieurs bits dans <code>osAppNMIBuffer</code> </li><li>  En fonction de la valeur de ces bits, <code>zurumode_flag</code> met √† jour </li><li>  Imprime une cha√Æne de format sur la console du syst√®me d'exploitation. </li></ul><br>  Ceci est g√©n√©ralement utile pour donner du contexte au code, mais il y avait beaucoup de caract√®res non imprimables dans la ligne.  Le seul texte reconnaissable √©tait ¬´zurumode_flag¬ª et ¬´% d¬ª. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/268/f99/093/268f99093e0f9dec2a19bfc22be95ac7.png" alt="cha√Æne de formatage en mode zuru"></div><br>  En supposant qu'il pourrait s'agir d'un texte japonais avec un codage de caract√®res multi-octets, j'ai pass√© la cha√Æne via l'outil de reconnaissance de codage et j'ai d√©couvert que la cha√Æne √©tait cod√©e avec Shift-JIS.  En traduction, la ligne signifiait simplement "La valeur de zurumode_flag est pass√©e de% d √†% d".  Cela ne nous donne pas beaucoup de nouvelles informations, mais maintenant nous savons que Shift-JIS est utilis√©: dans les fichiers binaires et les tables de lignes, il y a beaucoup plus de lignes dans cet encodage. <br><br><h4>  zurumode_callback </h4><br><ul><li>  Appelle <code>zerumode_check_keycheck</code> </li><li>  V√©rifie plusieurs bits dans <code>osAppNMIBuffer</code> </li><li>  La valeur <code>zurumode_flag</code> </li><li>  Appelle <code>zurumode_update</code> </li></ul><br>  <code>zerumode_check_keycheck</code> jusqu'√† ce que nous nous rencontrions √† cause d'une orthographe diff√©rente ... qu'est-ce que c'est? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49e/ca7/1fd/49eca71fdd3cefb01b01c578a93bbe72.png" alt="zerumode_check_keycheck"></div><br>  Une √©norme fonction complexe qui fait beaucoup plus de travail sur les bits avec des valeurs sans nom. <br><br>  √Ä ce stade, j'ai d√©cid√© de prendre du recul et d'√©tudier d'autres fonctions et variables de d√©bogage, car je n'√©tais pas s√ªr de l'importance du mode zuru.  De plus, je n'ai pas compris ce que signifie ¬´v√©rification des cl√©s¬ª ici.  Est-il possible qu'il s'agisse d'une cl√© cryptographique? <br><br><h3>  Retour au d√©bogage </h3><br>  √Ä cette √©poque, j'ai remarqu√© un probl√®me avec ma fa√ßon de charger les symboles de d√©bogage dans l'IDA.  Le fichier <code>foresta.map</code> sur le disque du jeu contient de nombreuses adresses et noms de fonctions et de variables.  Au d√©but, je n'ai pas vu que les adresses de chaque section recommencent √† z√©ro, j'ai donc √©crit un script simple qui ajoute une entr√©e de nom pour chaque ligne du fichier. <br><br>  J'ai √©crit de nouveaux scripts IDA pour corriger le chargement des tables de symboles pour diff√©rentes sections du programme: <code>.text</code> , <code>.rodata</code> , <code>.data</code> et <code>.bss</code> .  La section <code>.text</code> contient toutes les fonctions, donc je l'ai fait pour que cette fois, lorsque je d√©finirai le nom, le script reconna√Ætra automatiquement les fonctions √† chaque adresse. <br><br>  Dans les sections de donn√©es, il a maintenant cr√©√© un segment pour chaque objet binaire (par exemple, <code>m_debug.o</code> , qui √©tait cens√© √™tre du code compil√© pour quelque chose appel√© <code>m_debug</code> ), et a d√©fini l'espace et les noms pour chaque √©l√©ment de donn√©es. <br><br>  Cela m'a donn√© beaucoup plus d'informations, mais j'ai d√ª d√©finir manuellement le type de donn√©es pour chaque √©l√©ment de donn√©es, car j'ai d√©fini chaque objet de donn√©es comme un tableau d'octets simple.  (Avec le recul, je comprends qu'il serait pr√©f√©rable de supposer que des fragments de 4 octets contenaient des entiers 32 bits, car il y en avait beaucoup et beaucoup contenaient des adresses de fonctions et de donn√©es importantes pour la construction de r√©f√©rences crois√©es.) <br><br>  En √©tudiant le nouveau segment <code>.bss</code> pour <code>m_debug_mode.o</code> , j'ai trouv√© plusieurs variables de la forme <code>quest_draw_status</code> et <code>event_status</code> .  C'est int√©ressant car je voulais que des informations utiles, pas seulement un graphique de performances, soient affich√©es en mode d√©bogage.  Heureusement, √† partir de ces enregistrements de donn√©es, il y avait des r√©f√©rences crois√©es √† un √©norme morceau de code v√©rifiant <code>debug_print_flg</code> . <br><br>  √Ä l'aide d'un d√©bogueur dans l'√©mulateur Dolphin, j'ai d√©fini un point d'arr√™t √† l'emplacement de la fonction o√π <code>debug_print_flg</code> v√©rifi√© (√† <code>8039816C</code> ) pour comprendre comment cette v√©rification fonctionne.  Mais le programme n'est jamais pass√© √† ce point d'arr√™t. <br><br>  Voyons pourquoi cela se produit: cette fonction est appel√©e par <code>game_debug_draw_last</code> .  Devinez quelle valeur est v√©rifi√©e avant son appel conditionnel?  <code>zurumode_flag</code> !  Que diable se passe-t-il? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/257/048/964/257048964f9e8265670952e66868fc83.png" alt="v√©rification zurumode_flag"></div><br>  J'ai d√©fini un point d'arr√™t sur ce ch√®que ( <code>80404E18</code> ) et cela a fonctionn√© tout de suite.  La valeur de <code>zurumode_flag</code> √©tait nulle, donc en ex√©cution normale, le programme aurait manqu√© l'appel √† cette fonction.  J'ai ins√©r√© une instruction de branche NOP √† la place (remplac√©e par une instruction qui ne fait rien) pour v√©rifier ce qui se passe lorsque la fonction est appel√©e. <br><br>  Dans le d√©bogueur Dolphin, cela peut √™tre fait en interrompant le jeu, en cliquant avec le bouton droit sur les instructions et en s√©lectionnant ¬´Ins√©rer nop¬ª: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e6/f00/8d1/2e6f008d1dcf1be707b1961e05df2e71.png" alt="D√©bogueur Dolphin Nopping"></div><br>  Il ne s'est rien pass√©.  Ensuite, j'ai v√©rifi√© ce qui se passait √† l'int√©rieur de la fonction et d√©couvert une autre construction de branchement qui a contourn√© tout ce qui √©tait int√©ressant √† <code>803981a8</code> .  J'ai √©galement ins√©r√© NOP √† la place, et la lettre "D" est apparue dans le coin sup√©rieur droit de l'√©cran. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a18/9a0/816/a189a0816b08438ad5b85c09adaac57c.png" alt="Lettre de mode de d√©bogage D"></div><br>  Dans cette fonction √† <code>8039816C</code> (je l'ai appel√©e <code>zzz_DebugDrawPrint</code> ), il y a encore un tas de code int√©ressant, mais il n'est pas appel√©.  Si vous regardez cette fonction sous la forme d'un graphique, vous pouvez voir qu'il existe une s√©rie d'op√©rateurs de branchement qui ignorent les blocs de code dans la fonction: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/236/131/4bb/2361314bbb4165b8e1c82386e8c50533.png" alt="Branches dans zzz_DebugDrawPrint"></div><br>  Apr√®s avoir ins√©r√© NOP au lieu de plusieurs autres constructions de ramification, j'ai commenc√© √† voir diverses choses int√©ressantes √† l'√©cran: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0db/c19/008/0dbc1900844131d0c3d7f507f2b61b63.png" alt="Plus de trucs de d√©bogage imprim√©s"></div><br>  La question suivante √©tait de savoir comment activer cette fonctionnalit√© de d√©bogage sans modifier le code. <br><br>  En outre, dans certaines constructions de branche, <code>zurumode_flag</code> se produit √† nouveau dans cette fonction de dessin de d√©bogage.  J'ai ajout√© un autre patch afin que dans <code>zurumode_update</code> drapeau <code>zurumode_update</code> <code>zurumode_flag</code> toujours attribuer la valeur 2, car lorsqu'il ne se compare pas √† 0, il est compar√© sp√©cifiquement √† la valeur 2. <br><br>  Apr√®s avoir red√©marr√© le jeu, j'ai vu dans le coin sup√©rieur droit de l'√©cran un tel message "msg.  non. " <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97d/16e/a0b/97d16ea0b169c72dd86ab623e0e3f977.png" alt="affichage du num√©ro de message"></div><br>  Le nombre 687 est l'identifiant d'enregistrement du dernier message affich√©.  Je l'ai v√©rifi√© en utilisant le programme de visualisation de table que j'ai √©crit au tout d√©but de l'analyse, mais vous pouvez √©galement le v√©rifier en utilisant l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©diteur de table de cha√Ænes avec une interface graphique compl√®te</a> , que j'ai √©crite pour pirater les ROM.  Voici √† quoi ressemble le message dans l'√©diteur: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cad/e3f/378/cade3f3785a86e9bf335a144fe16a338.png" alt="Message 687 dans l'√©diteur de table de cha√Ænes"></div><br>  √Ä ce stade, il est devenu clair que l'√©tude du mode zuru n'√©tait plus supprim√©e - elle est directement li√©e aux fonctions de d√©bogage du jeu. <br><br><h3>  Retour au mode Zuru √† nouveau </h3><br>  <code>zurumode_init</code> initialise plusieurs choses: <br><br><ul><li>  <code>0xC(padmgr_class)</code> re√ßoit la valeur de l'adresse <code>zurumode_callback</code> </li><li>  <code>0x10(padmgr_class)</code> re√ßoit la valeur d'adresse de <code>padmgr_class</code> elle-m√™me </li><li>  <code>0x4(zuruKeyCheck)</code> re√ßoit la valeur du dernier bit du mot charg√© √† partir de <code>0x3C(osAppNMIBuffer)</code> . </li></ul><br>  J'ai compris ce qu'est <code>padmgr</code> , une abr√©viation de ¬´gamepad manager¬ª.  Cela signifie qu'il peut y avoir une combinaison sp√©ciale de touches (boutons) qui peuvent √™tre saisies sur la manette de jeu pour activer le mode zuru, ou une sorte de dispositif de d√©bogage ou une fonction de la console du d√©veloppeur qui peut √™tre utilis√©e pour envoyer un signal pour l'activer. <br><br>  <code>zurumode_init</code> n'est ex√©cut√© que lors du premier chargement du jeu (lorsque le bouton de r√©initialisation est enfonc√©, cela ne fonctionne pas). <br><br>  Apr√®s avoir d√©fini un point d'arr√™t √† l'adresse <code>8040efa4</code> , auquel la valeur <code>0x4(zuruKeyCheck)</code> est attribu√©e <code>0x4(zuruKeyCheck)</code> , nous pouvons voir que lors du chargement sans appuyer sur les touches, la valeur est d√©finie sur 0. Si vous le remplacez par 1, une chose int√©ressante se produit: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9dc/5f5/0fb/9dc5f50fbd68beb624745d0704a18383.png" alt="√âcran de titre avec le mode zuru"></div><br>  La lettre "D" appara√Æt √† nouveau dans le coin sup√©rieur droit (cette fois est verte, pas jaune), et certaines informations d'assemblage sont √©galement affich√©es: <br><br> <code>[CopyDate: 02/08/01 00:16:48 ] <br> [Date: 02-07-31 12:52:00] <br> [Creator:SRD@SRD036J]</code> <br> <br>  Un patch qui d√©finit toujours <code>0x4(zuruKeyCheck)</code> √† 1 au d√©but ressemble √† ceci: <br><br> <code>8040ef9c 38c00001</code> <br> <br>  Cela semble √™tre la bonne fa√ßon d'initialiser le mode zuru.  Apr√®s cela, diverses actions peuvent √™tre n√©cessaires pour obtenir l'affichage de certaines informations de d√©bogage.  En commen√ßant le jeu, en vous promenant dessus et en parlant √† un villageois, nous ne verrons aucun des messages mentionn√©s ci-dessus (√† l'exception de la lettre "D" dans le coin). <br><br>  Les suspects les plus probables sont <code>zurumode_update</code> et <code>zurumode_callback</code> . <br><br><h4>  zurumode_update </h4><br>  <code>zurumode_update</code> abord appel√© dans <code>zurumode_init</code> puis constamment appel√© par <code>zurumode_callback</code> . <br><br>  Il v√©rifie √† nouveau le dernier bit <code>0x3C(osAppNMIBuffer)</code> puis, en fonction de cette valeur, met √† jour <code>zurumode_flag</code> . <br><br>  Si le bit est nul, le drapeau est mis √† z√©ro. <br><br>  Sinon, l'instruction suivante est ex√©cut√©e, la valeur compl√®te <code>0x3c(osAppNMIBuffer)</code> √©tant <code>r5</code> : <br><br> <code>extrwi r3, r5, 1, 28</code> <br> <br>  Il extrait le 28e bit de <code>r5</code> et le stocke dans <code>r3</code> . <br><br>  Ensuite, 1 est ajout√© au r√©sultat, c'est-√†-dire que le r√©sultat final est toujours 1 ou 2. <br><br>  Ensuite, <code>zurumode_flag</code> compar√© au r√©sultat pr√©c√©dent, en fonction du nombre de 28e et dernier bits d√©finis sur <code>0x3c(osAppNMIBuffer)</code> : 0, 1 ou 2. <br><br>  Cette valeur est √©crite dans <code>zurumode_flag</code> .  Si cela ne change rien, la fonction se ferme et renvoie la valeur d'indicateur actuelle.  S'il modifie la valeur, une cha√Æne de blocs de code beaucoup plus complexe est ex√©cut√©e. <br><br>  Un message s'affiche en japonais: la m√™me ¬´valeur zurumode_flag est pass√©e de% d √†% d¬ª, dont nous avons parl√© plus haut. <br><br>  Ensuite, une s√©rie de fonctions est appel√©e avec diff√©rents arguments, selon que le drapeau est devenu √©gal √† z√©ro ou non.  Le code assembleur de cette partie est monotone, je vais donc montrer son pseudocode: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag_changed_to_zero) { JC_JUTAssertion_changeDevice(<span class="hljs-number"><span class="hljs-number">2</span></span>) JC_JUTDbPrint_setVisible(JC_JUTDbPrint_getManager(), <span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BIT(nmiBuffer, <span class="hljs-number"><span class="hljs-number">25</span></span>) || BIT(nmiBuffer, <span class="hljs-number"><span class="hljs-number">31</span></span>)) { JC_JUTAssertion_changeDevice(<span class="hljs-number"><span class="hljs-number">3</span></span>) JC_JUTDbPrint_setVisible(JC_JUTDbPrint_getManager(), <span class="hljs-number"><span class="hljs-number">1</span></span>) }</code> </pre> <br>  Notez que si l'indicateur est nul, l'argument 0 est pass√© √† JC_JUTDbPrint_setVisible. <br><br>  Si l'indicateur n'est pas √©gal √† z√©ro et que le bit 25 ou le bit 31 sont d√©finis sur <code>0x3C(osAppNMIBuffer)</code> , <code>setVisible</code> argument 1. <br><br>  Il s'agit de la premi√®re cl√© pour activer le mode zuru: le dernier bit <code>0x3C(osAppNMIBuffer)</code> doit √™tre d√©fini sur 1 pour afficher les informations de d√©bogage et d√©finir <code>zurumode_flag</code> valeur non nulle. <br><br><h4>  zurumode_callback </h4><br>  <code>zurumode_callback</code> est situ√© au <code>8040ee74</code> et est probablement appel√© par une fonction li√©e √† la manette de jeu.  Apr√®s avoir ins√©r√© un point d'arr√™t dans le d√©bogueur Dolphin, la pile d'appels nous montre qu'il est r√©ellement appel√© √† partir de <code>padmgr_HandleRetraceMsg</code> . <br><br>  L'une de ses premi√®res actions a √©t√© d'ex√©cuter <code>zerucheck_key_check</code> .  Cette fonction est complexe, mais il semble qu'en g√©n√©ral elle est con√ßue pour lire et mettre √† jour la valeur de <code>zuruKeyCheck</code> .  Avant de passer √† la fonction de v√©rification des touches, j'ai d√©cid√© de v√©rifier comment cette valeur est utilis√©e dans le reste de la fonction de rappel. <br><br>  Ensuite, il v√©rifie √† nouveau pour certains bits dans <code>0x3c(osAppNMIBuffer)</code> .  Si le bit 26 est d√©fini, ou si le bit 25 est d√©fini et que <code>padmgr_isConnectedController(1)</code> renvoie une valeur diff√©rente de z√©ro, le dernier bit de <code>0x3c(osAppNMIBuffer)</code> sur 1! <br><br>  Si aucun de ces bits n'est d√©fini, ou que le bit 25 est d√©fini, mais que <code>padmgr_isConnectedController(1)</code> renvoie 0, la fonction v√©rifie si l'octet √† l'adresse <code>0x4(zuruKeyCheck)</code> est √©gal √† z√©ro.  S'il est √©gal, il r√©initialise le dernier bit de la valeur d'origine et le <code>0x3c(osAppNMIBuffer)</code> sur <code>0x3c(osAppNMIBuffer)</code> .  Sinon, il d√©finit toujours le dernier bit sur 1. <br><br>  En pseudo code, cela ressemble √† ceci: <br><br><pre> <code class="cpp hljs">x = osAppNMIBuffer[<span class="hljs-number"><span class="hljs-number">0x3c</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BIT(x, <span class="hljs-number"><span class="hljs-number">26</span></span>) || (BIT(x, <span class="hljs-number"><span class="hljs-number">25</span></span>) &amp;&amp; isConnectedController(<span class="hljs-number"><span class="hljs-number">1</span></span>)) || zuruKeyCheck[<span class="hljs-number"><span class="hljs-number">4</span></span>] != <span class="hljs-number"><span class="hljs-number">0</span></span>) { osAppNMIBuffer[<span class="hljs-number"><span class="hljs-number">0x3c</span></span>] = x | <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">// set last bit } else { osAppNMIBuffer[0x3c] = x &amp; ~1 // clear last bit }</span></span></code> </pre> <br>  Apr√®s cela, si le bit 26 n'est pas d√©fini, la fonction passe √† l'appel de <code>zurumode_update</code> , puis se <code>zurumode_update</code> . <br><br>  Si le bit est d√©fini, alors si <code>0x4(zuruKeyCheck)</code> pas √©gal √† z√©ro, alors il charge une cha√Æne de format dans laquelle il affiche ce qui suit: "ZURU% d /% d". <br><br><h4>  Pour r√©sumer le sous-total </h4><br>  Voici ce qui se passe: <br><br>  <code>padmgr_HandleRetraceMsg</code> appelle <code>zurumode_callback</code> .  Je suppose que ce ¬´message de retour de poign√©e¬ª signifie qu'il scanne simplement les frappes du contr√¥leur.  √Ä chaque analyse, il peut provoquer une s√©rie de rappels diff√©rents. <br><br>  Lorsque <code>zurumode_callback</code> ex√©cut√© <code>zurumode_callback</code> il v√©rifie les frappes (boutons) en cours.  Il semble qu'elle v√©rifie un bouton sp√©cifique ou une combinaison de boutons. <br><br>  Le dernier bit du tampon NMI est mis √† jour en fonction des bits sp√©cifiques de sa valeur actuelle, ainsi que de la valeur de l'un des octets <code>zuruKeyCheck</code> ( <code>0x4(zuruKeyCheck)</code> ). <br><br>  Ensuite, <code>zurumode_update</code> est <code>zurumode_update</code> et v√©rifie ce bit.  S'il est √©gal √† 0, alors l'indicateur de mode zuru est mis √† 0. S'il est √©gal √† 1, alors l'indicateur de mode passe √† 1 ou 2, selon que le bit 28 est activ√©. <br><br>  <strong>Il existe trois fa√ßons d'activer le mode zuru:</strong> <br><br><ol><li>  Le bit 26 est d√©fini sur <code>0x3C(osAppNMIBuffer)</code> </li><li>  Le bit 25 est d√©fini sur <code>0x3C(osAppNMIBuffer)</code> et le contr√¥leur est connect√© au port 2 </li><li>  <code>0x4(zuruKeyCheck)</code> pas nul </li></ol><br><h4>  osAppNMIBuffer </h4><br>  Int√©ress√© par ce <code>osAppNMIBuffer</code> signifie <code>osAppNMIBuffer</code> , j'ai commenc√© √† chercher ¬´NMI¬ª et j'ai trouv√© des liens dans le contexte Nintendo vers ¬´interruption non masquable¬ª.  Il s'av√®re que le nom de cette variable est enti√®rement mentionn√© dans la documentation d√©veloppeur de Nintendo 64: <br><br><blockquote>  osAppNMIBuffer est un tampon de 64 octets qui est effac√© lors d'un red√©marrage √† froid.  Si le syst√®me red√©marre en raison de NMI, l'√©tat de ce tampon ne change pas. </blockquote><br>  En fait, il s'agit d'un petit morceau de m√©moire enregistr√© lors d'un red√©marrage ¬´doux¬ª (avec le bouton de r√©initialisation).  Le jeu peut utiliser ce tampon pour stocker toutes les donn√©es pendant que la console est sur le r√©seau.  L'original Animal Crossing est sorti sur Nintendo 64, il est donc logique que quelque chose de similaire ait d√ª appara√Ætre dans le code. <br><br>  Si nous allons dans le fichier <code>boot.dol</code> binaire (tout ce qui est montr√© ci-dessus √©tait dans <code>foresta.rel</code> ), alors sa fonction <code>main</code> a beaucoup de liens vers <code>osAppNMIBuffer</code> .  Un rapide coup d'≈ìil montre qu'il existe une s√©rie de v√©rifications qui peuvent conduire √† <code>0x3c(osAppNMIBuffer)</code> valeurs de diff√©rents bits <code>0x3c(osAppNMIBuffer)</code> aide d'op√©rations OR. <br><br>  Les valeurs d'op√©rande OR suivantes peuvent √™tre int√©ressantes: <br><br><ul><li>  Bit 31: 0x01 </li><li>  Bit 30: 0x02 </li><li>  Bit 29: 0x04 </li><li>  Bit 28: 0x08 </li><li>  Bit 27: 0x10 </li><li>  Bit 26: 0x20 </li></ul><br>  Nous nous souvenons que les bits 25, 26 et 28 sont particuli√®rement int√©ressants: 25 et 26 d√©terminent si le mode zuru est activ√© et le bit 28 d√©termine le niveau du drapeau (1 ou 2). <br>  Le bit 31 est √©galement int√©ressant, mais il semble qu'il change en fonction des valeurs des autres. <br><br><h5>  Bit 26 </h5><br>  Tout d'abord: √† l'adresse <code>800062e0</code> il y a une instruction <code>ori r0, r0, 0x20</code> avec une valeur tampon de <code>0x3c</code> .  Il active le bit 26, qui active toujours le mode zuru. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5c/b3c/207/b5cb3c207a61dc20dd12e6724f25099b.png" alt="R√®glement du bit 26"></div><br>  Pour que le bit soit d√©fini, le huiti√®me octet renvoy√© par <code>DVDGetCurrentDiskID</code> doit √™tre <code>0x99</code> .  Cet identifiant est situ√© au tout d√©but de l'image disque du jeu et est charg√© en m√©moire √† <code>80000000</code> .  Dans une version commerciale r√©guli√®re du jeu, l'ID ressemble √† ceci: <br><br> <code>47 41 46 45 30 31 00 00 GAFE01..</code> <br> <br>  En rempla√ßant le dernier octet de l'identifiant par un <code>0x99</code> pour <code>0x99</code> , nous obtenons l'image suivante au d√©marrage du jeu: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/da6/c58/c90/da6c58c90515fefb62ed8cf766ad8776.png" alt="ID de version du jeu 0x99"></div><br>  Et ce qui suit s'affiche dans la console du syst√®me d'exploitation: <br><br> <code>06:43:404 HW\EXI_DeviceIPL.cpp:339 N[OSREPORT]: ZURUMODE2 ENABLE <br> 08:00:288 HW\EXI_DeviceIPL.cpp:339 N[OSREPORT]: osAppNMIBuffer[15]=0x00000078</code> <br> <br>  Tous les autres correctifs peuvent √™tre supprim√©s, apr√®s quoi la lettre D appara√Æt √† nouveau dans le coin sup√©rieur droit de l'√©cran, mais aucun message de d√©bogage n'est activ√©. <br><br><h5>  Bit 25 </h5><br>  Le bit 25 est utilis√© conjointement avec la v√©rification du port du contr√¥leur 2. Qu'est-ce qui le fait s'allumer? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddf/d00/4a1/ddfd004a1488ec21842c90581ef177fc.png" alt="Bit 25 et 28"></div><br>  Il s'av√®re qu'il doit utiliser le m√™me contr√¥le que pour le bit 28: la version doit √™tre sup√©rieure ou √©gale √† <code>0x90</code> .  Si le bit 26 est d√©fini (l'ID est <code>0x99</code> ), ces deux bits seront √©galement d√©finis et le mode zuru sera toujours activ√©. <br><br>  Cependant, si la version est comprise entre <code>0x90</code> et <code>0x98</code> , le mode zuru ne s'active pas instantan√©ment.  Rappelez la v√©rification effectu√©e dans <code>zurumode_callback</code> - le mode ne sera activ√© que si le bit 25 est d√©fini <em>et</em> <code>padmgr_isConnectedController(1)</code> renvoie une valeur diff√©rente de z√©ro. <br><br>  Une fois que le contr√¥leur est connect√© au port 2 (l'argument <code>isConnectedController</code> a z√©ro indexation), le mode zuru est activ√©.  La lettre D et les informations sur l'assemblage apparaissent sur l'√©cran initial, et nous ... pouvons contr√¥ler l'affichage du d√©bogage √† l'aide des boutons du deuxi√®me contr√¥leur! <br><br>  Certains boutons effectuent des actions qui non seulement modifient l'affichage, mais aussi, par exemple, augmentent la vitesse du jeu. <br><br><h4>  zerucheck_key_check </h4><br>  Le dernier myst√®re reste <code>0x4(zuruKeyCheck)</code> .  Il s'av√®re que cette valeur est mise √† jour avec une √©norme fonction complexe que j'ai montr√©e ci-dessus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49e/ca7/1fd/49eca71fdd3cefb01b01c578a93bbe72.png" alt="zerumode_check_keycheck"></div><br>  En utilisant le d√©bogueur d'√©mulateur Dolphin, j'ai pu d√©terminer que la valeur v√©rifi√©e par cette fonction est un ensemble de bits correspondant aux pressions de bouton sur le deuxi√®me contr√¥leur. <br><br>  Le suivi des clics sur les boutons est stock√© dans une valeur de 16 bits √† <code>0x2(zuruKeyCheck)</code> .  Lorsque le contr√¥leur n'est pas connect√©, la valeur est <code>0x7638</code> . <br><br>  2 octets contenant les drapeaux des pressions des boutons du contr√¥leur sont t√©l√©charg√©s puis mis √† jour au d√©but de <code>zerucheck_key_check</code> .  La nouvelle valeur est transmise avec le registre <code>r4</code> fonction <code>padmgr_HandleRetraceMsg</code> lorsqu'elle appelle la fonction de rappel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f98/478/318/f984783181e592098f8beef9c22cef23.png" alt="fin de la v√©rification des cl√©s"></div><br>  Vers la fin de <code>zerucheck_key_check</code> il y a un autre endroit o√π <code>0x4(zuruKeyCheck)</code> mis √† jour <code>0x4(zuruKeyCheck)</code> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il n'apparaissait pas dans la liste de r√©f√©rences crois√©es car il l'utilisait comme adresse de base </font></font><code>r3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et nous ne pouvons conna√Ætre la valeur </font></font><code>r3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qu'en regardant la valeur qui lui est affect√©e avant d'appeler cette fonction. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä l'adresse, la </font></font><code>8040ed88</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur est </font></font><code>r4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©crite </font></font><code>0x4(zuruKeyCheck)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Juste avant cela, mais il est √©crit du m√™me endroit, puis XOR √† partir de 1. La t√¢che de cette op√©ration est de basculer la valeur d'octet (en fait le dernier bit) entre 0 et 1. (Si la valeur est 0, le r√©sultat de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XOR √† partir de 1 sera 1 . Si la valeur est 1, le r√©sultat sera 0. Voir la table de v√©rit√© pour XOR.)</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/048/c32/eb1/048c32eb12dda64c878fa7b9f0bd7ddc.png" alt="fin de la v√©rification des cl√©s"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus t√¥t, lorsque j'ai √©tudi√© les valeurs en m√©moire, je n'ai pas remarqu√© ce comportement, mais je vais essayer de casser cette instruction dans le d√©bogueur pour comprendre ce qui se passe. La valeur d'origine est charg√©e √† </font></font><code>8040ed7c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sans toucher aux boutons du contr√¥leur, je ne parviendrai pas √† ce point d'arr√™t sur l'√©cran initial. Pour entrer dans ce bloc de code, la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit devenir √©gale </font></font><code>0xb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avant l'instruction de branchement qui pr√©c√®de le point d'arr√™t ( </font></font><code>8040ed74</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Parmi les nombreux chemins diff√©rents menant √† ce bloc, un seul attribue une </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur </font></font><code>0xb</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devant lui √† l'adresse </font></font><code>8040ed68</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/04c/926/959/04c926959999b5f6facfc8920f6a212f.png" alt="D√©finition de r5 sur 0xb"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notez que pour atteindre le bloc affectant la </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur </font></font><code>0xB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la valeur </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre √©gale </font><font style="vertical-align: inherit;">juste avant </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">En suivant les blocs de la cha√Æne jusqu'au d√©but de la fonction, nous pouvons voir toutes les restrictions n√©cessaires pour r√©aliser ce bloc:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ed74: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre √©gale</font></font><code>0xB</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ed60: la valeur </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre √©gale</font></font><code>0x1000</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ebe8: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre √©gale</font></font><code>0xA</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040ebe4: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre inf√©rieure</font></font><code>0x5B</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040eba4: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre sup√©rieure</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040eb94: la valeur </font></font><code>r6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre 1</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8040eb5c: la valeur </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne doit pas √™tre 0</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040eb74: les valeurs du bouton du port 2 doivent changer </font></font></li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28e/2fa/9f3/28e2fa9f3d35b1c6146f816120dee72b.png" alt="Tra√ßage du chemin du code"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, nous avons atteint le point o√π les anciennes valeurs de bouton sont charg√©es et les nouvelles valeurs sont enregistr√©es. Viennent ensuite quelques op√©rations appliqu√©es aux nouvelles et anciennes valeurs: </font><font style="vertical-align: inherit;">L'op√©ration XOR marque tous les bits qui ont chang√© entre les deux valeurs. Ensuite, l'op√©ration ET masque la nouvelle entr√©e pour d√©finir tous les bits qui ne sont pas actuellement d√©finis sur l'√©tat 0. Le r√©sultat en </font><font style="vertical-align: inherit;">est un ensemble de nouveaux bits (pressions de bouton) dans la nouvelle valeur. S'il n'est pas vide, nous sommes sur la bonne voie. </font><font style="vertical-align: inherit;">Pour faire </font><font style="vertical-align: inherit;">une diff√©rence </font><font style="vertical-align: inherit;">, le quatri√®me des boutons de suivi 16 bits doit changer. Apr√®s avoir ins√©r√© un point d'arr√™t apr√®s l'op√©ration XOR / AND, j'ai d√©couvert que le bouton START d√©clenche cet √©tat. </font><font style="vertical-align: inherit;">La question suivante est de savoir comment le rendre </font><font style="vertical-align: inherit;">initialement √©gal</font></font><br><br> <code>old_vals = old_vals XOR new_vals <br> old_vals = old_vals AND new_vals</code> <br> <br><font style="vertical-align: inherit;"></font><code>r0</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>r0</code><font style="vertical-align: inherit;"></font><code>0x1000</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>r5</code><font style="vertical-align: inherit;"></font><code>0xA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>r6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont charg√©s depuis </font></font><code>0x0(zuruKeyCheck)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le d√©but de la fonction de test cl√© et mis √† jour plus pr√®s de la fin, lorsque nous n'entrons pas dans le bloc de code qui comprend </font></font><code>0x4(zuruKeyCheck)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a plusieurs endroits avant cela o√π la </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur est affect√©e </font></font><code>0xA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><ul><li> <code>8040ed50</code> </li> <li> <code>8040ed00</code> </li> <li> <code>8040ed38</code> </li> </ul><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040ed38 </font></font></h5><br><ul><li> <code>8040ed34</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre √©gale </font></font><code>0x4000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(le bouton B </font><font style="vertical-align: inherit;">est </font><font style="vertical-align: inherit;">enfonc√©)</font></font></li><li> <code>8040ebe0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre √©gale</font></font><code>0x5b</code> </li><li> <code>8040eba4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre sup√©rieure</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alors tout se passe comme avant ... </font></font></li></ul><br> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devrait commencer par </font></font><code>0x5b</code> <br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040ed00 </font></font></h5><br><ul><li> <code>8040ecfc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre √©gale </font></font><code>0xC000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(A et B sont press√©s)</font></font></li><li> <code>8040ebf8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre&gt; = 9</font></font></li><li> <code>8040ebf0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre inf√©rieure √† 10</font></font></li><li> <code>8040ebe4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre inf√©rieure</font></font><code>0x5b</code> </li><li> <code>8040eba4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devrait √™tre plus</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alors tout se passe comme avant ... </font></font></li></ul><br> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devrait commencer √† 9 </font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8040ed50 </font></font></h5><br><ul><li> <code>8040ed4c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre √©gale </font></font><code>0x8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bouton A enfonc√©)</font></font></li><li> <code>8040ec04</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre inf√©rieure</font></font><code>0x5d</code> </li><li> <code>8040ebe4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre sup√©rieure</font></font><code>0x5b</code> </li><li> <code>8040eba4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: la valeur </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre sup√©rieure</font></font><code>0x7</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alors tout se passe comme avant ... </font></font></li></ul><br> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devrait commencer par </font></font><code>0x5c</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il semble qu'il y ait une sorte d'√©tat entre les frappes, apr√®s quoi vous devez entrer une certaine s√©quence de combos √† partir des boutons, en terminant par une pression sur START. </font><font style="vertical-align: inherit;">Il semble que A et / ou B devraient aller juste avant START. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous tracez le chemin du code qui d√©finit la </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur √† 9, alors un mod√®le appara√Æt: </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- c'est une valeur croissante qui peut soit augmenter lorsqu'une </font></font><code>r0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur appropri√©e est trouv√©e, soit z√©ro. </font><font style="vertical-align: inherit;">Les cas les plus √©tranges lorsque ce n'est pas une valeur dans la plage de </font></font><code>0x0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√†</font></font><code>0xB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se produisent lors du traitement d'√©tapes avec plusieurs boutons, par exemple, lorsque A et B sont enfonc√©s simultan√©ment. Une personne qui essaie d'entrer dans ce combo ne peut g√©n√©ralement pas appuyer sur les deux boutons exactement en m√™me temps tout en suivant la manette de jeu, vous devez donc traiter le bouton sur lequel vous appuyez. premier. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous continuons d'explorer diff√©rents chemins de code:</font></font><br><br><ul><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur 9 lorsque vous appuyez sur DROITE √† l'adresse </font></font><code>8040ece8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur 8 lorsque le bouton droit C √† l'adresse est enfonc√© </font></font><code>8040eccc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur 7 lorsque le bouton gauche C est press√© √† l'adresse </font></font><code>8040ecb0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur 6 lorsque GAUCHE est press√© √† l'adresse </font></font><code>8040ec98</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur 5 (et r6 prend la valeur 1) lorsque BAS est press√© √† l'adresse </font></font><code>8040ec7c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur 4 lorsque le bouton sup√©rieur C √† l'adresse est enfonc√© </font></font><code>8040ec64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur 3 lorsque le bouton inf√©rieur C √† l'adresse est enfonc√© </font></font><code>8040ec48</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur 2 lorsque vous appuyez sur UP √† l'adresse </font></font><code>8040ec30</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li> <code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur 1 (et </font></font><code>r6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend la valeur 1) lorsque Z est press√© √† l'adresse </font></font><code>8040ec1c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La s√©quence actuelle est: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z, UP, C-DOWN, C-UP, DOWN, LEFT, C-LEFT, C-RIGHT, RIGHT, A + B, START </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avant de v√©rifier Z, une autre condition est v√©rifi√©e: bien qu'un nouveau bouton doive √™tre enfonc√© Z, les drapeaux actuels doivent √™tre √©gaux </font></font><code>0x2030</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: les pare-chocs gauche et droit doivent √©galement √™tre enfonc√©s (ils ont les valeurs de </font></font><code>0x10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>0x20</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">De plus, UP / DOWN / LEFT / RIGHT sont des boutons D-pad, pas un stick analogique.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Code de triche </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le combo complet ressemble √† ceci: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tenez les pare-chocs L + R et appuyez sur Z </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-up </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-DOWN </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-up </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-down </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-gauche </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-gauche </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C-DROIT </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D-DROIT </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A + B </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> COMMENCER </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√áa marche! </font><font style="vertical-align: inherit;">Connectez le contr√¥leur au deuxi√®me port et entrez le code, apr√®s quoi les informations de d√©bogage apparaissent. </font><font style="vertical-align: inherit;">Apr√®s cela, vous pouvez commencer √† appuyer sur les boutons du deuxi√®me (voire du troisi√®me) contr√¥leur pour effectuer diverses actions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce combo fonctionnera sans patcher le num√©ro de version du jeu. </font><font style="vertical-align: inherit;">Il peut m√™me √™tre utilis√© dans une copie r√©guli√®re du jeu au d√©tail sans outils de triche ou mods de console. </font><font style="vertical-align: inherit;">Une nouvelle saisie des combos d√©sactive le mode zuru.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/fe4/7f0/b4dfe47f0139ba1af039decfb6274524.jpg" alt="Utiliser le code sur un vrai GameCube"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le message "ZURU% d /% d" est </font></font><code>zurumode_callback</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilis√© pour afficher l'√©tat de cette combinaison si vous le saisissez lorsque l'ID de disque est d√©j√† √©gal </font></font><code>0x99</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(probablement pour d√©boguer le code de triche lui-m√™me). Le premier nombre correspond √† votre position actuelle dans la s√©quence correspondante </font></font><code>r5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Le second prend la valeur 1, lorsque certains boutons de la s√©quence sont maintenus, ils peuvent correspondre au moment o√π la </font></font><code>r6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur est affect√©e 1. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La plupart des messages n'expliquent pas ce qu'ils font √† l'√©cran, donc pour comprendre leur fonction, vous devez trouver des fonctions qui les traitent. Par exemple, une longue ligne d'√©toiles bleues et rouges en haut de l'√©cran sont des espaces r√©serv√©s pour afficher l'√©tat de diverses qu√™tes. Lorsque la qu√™te est active, certains num√©ros y apparaissent, indiquant l'√©tat de la qu√™te.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'√©cran noir affich√© en appuyant sur Z est une console pour afficher les messages de d√©bogage, en particulier pour les aspects de bas niveau, tels que l'allocation de m√©moire, les erreurs de tas et autres mauvaises exceptions. Par comportement, </font></font><code>fault_callback_scroll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on peut supposer qu'il est utilis√© pour afficher ces erreurs avant le red√©marrage du syst√®me. Il ne lance aucune de ces erreurs, mais peut les amener √† imprimer quelques caract√®res parasites avec plusieurs NOP. Je pense qu'√† l'avenir, il sera tr√®s utile pour afficher vos propres messages de d√©bogage:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b06/755/a33/b06755a33e0b0b8b010b7cbff7a26594.png" alt="JUTConsole ordures caract√®res"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s avoir fait tout cela, j'ai d√©couvert que passer en mode d√©bogage en corrigeant l'ID de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version </font><font style="vertical-align: inherit;">est </font></font><code>0x99</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©j√† connu des autres: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://tcrf.net/Animal_Crossing#Debug_Mode</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">(Il y a aussi de bonnes notes sur le lien qui indiquent divers messages et parlent d'autres choses qui peuvent √™tre faites avec le contr√¥leur dans le port 3.) Cependant, pour autant que je sache, personne n'a encore publi√© la combinaison de triche.</font></font><br><br>  C‚Äôest tout.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il y a d'autres fonctionnalit√©s pour les d√©veloppeurs que j'aimerais explorer, comme l'√©cran de d√©bogage de la carte et l'√©cran de s√©lection de l'√©mulateur NES, et comment les activer sans utiliser de correctifs. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/258/eb3/445/258eb3445236357c201c343d6c8ae4ba.png" alt="√âcran de s√©lection de carte"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> De plus, je publierai des articles sur la r√©tro-ing√©nierie des syst√®mes de dialogue, des √©v√©nements et des qu√™tes dans le but de cr√©er des mods. </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413967/">https://habr.com/ru/post/fr413967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413955/index.html">Cycle de d√©veloppement complet du dispositif IoT pour le contr√¥le du chauffage de piscine sur l'ESP8266 dans un environnement Arduino</a></li>
<li><a href="../fr413957/index.html">Un exemple de cr√©ation d'une application sportive en temps r√©el sur Node.js</a></li>
<li><a href="../fr413959/index.html">Plus petite image Docker - moins de 1 000 octets</a></li>
<li><a href="../fr413963/index.html">Mini CRM pour les petites entreprises</a></li>
<li><a href="../fr413965/index.html">Revue de code: vous vous trompez</a></li>
<li><a href="../fr413969/index.html">Technopark Russky - d√©veloppement innovant de milliards de dollars</a></li>
<li><a href="../fr413971/index.html">Plus de 10 m√©dias d'information en anglais pour les apprenants de langues</a></li>
<li><a href="../fr413973/index.html">√âvaluation de Cavium ThunderX2: le r√™ve du serveur Arm se r√©alise (partie 2)</a></li>
<li><a href="../fr413977/index.html">Cr√©ation d'un syst√®me de protection antivirus √©tendu pour une petite entreprise. 3e partie</a></li>
<li><a href="../fr413979/index.html">Mitap "Comment g√©rer des guildes et des communaut√©s?" de Tutu.ru et AgileVerse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>