<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüîß üèæ üë®üèæ‚Äç‚öïÔ∏è Toda a verdade sobre o RTOS. Artigo 30. Procedimentos de inicializa√ß√£o e inicializa√ß√£o do N√∫cleo SE ‚òùüèª üç≥ üí≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Qualquer sistema operacional possui um mecanismo de inicializa√ß√£o espec√≠fico. O princ√≠pio de opera√ß√£o desse mecanismo para cada sistema √© diferente. G...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toda a verdade sobre o RTOS. Artigo 30. Procedimentos de inicializa√ß√£o e inicializa√ß√£o do N√∫cleo SE</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460617/"><img src="https://habrastorage.org/webt/nr/me/cz/nrmeczn3tg-kdwyme6qgmd7ily4.jpeg"><br><br>  Qualquer sistema operacional possui um mecanismo de inicializa√ß√£o espec√≠fico.  O princ√≠pio de opera√ß√£o desse mecanismo para cada sistema √© diferente.  Geralmente eles dizem que o sistema √© inicializado (Eng. Boot), esta √© uma abrevia√ß√£o de "bootstrap", que se refere √† express√£o "puxe-se sobre uma cerca pelas pr√≥prias bootstraps" como o sistema se move independentemente de um estado em que a mem√≥ria est√° cheia de vazio ( <i>nota do tradutor: se for absolutamente preciso, ent√£o lixo</i> ) para a execu√ß√£o est√°vel do programa.  Tradicionalmente, uma pequena parte do programa √© carregada na mem√≥ria e pode ser armazenada na ROM.  No passado, era poss√≠vel digitar usando os interruptores na parte frontal do computador.  Este carregador de inicializa√ß√£o leu um programa de inicializa√ß√£o mais complexo que j√° carregou o sistema operacional.  Hoje, o computador de mesa inicializa da seguinte maneira: o c√≥digo do BIOS procura por dispositivos (discos r√≠gidos, CD-ROMs, pen drives) nos quais inicializar e, em seguida, o sistema operacional √© inicializado. <br><br>  O SO para sistemas embarcados tamb√©m pode ser inicializado de maneira semelhante.  E, de fato, os sistemas operacionais incorporados desenvolvidos com base nos sistemas operacionais de desktop s√£o carregados.  Mas na maioria dos RTOS "cl√°ssicos", √© usado um m√©todo muito mais simples (e, portanto, mais r√°pido). <br><a name="habracut"></a><br>  O sistema operacional faz parte do software.  Se esse software j√° estiver na mem√≥ria (por exemplo, de uma forma ou de outra da ROM), basta garantir que a sequ√™ncia de comandos da CPU ap√≥s a redefini√ß√£o termine com a execu√ß√£o do c√≥digo de inicializa√ß√£o do SO.  √â assim que a maioria dos RTOS funciona, incluindo o Nucleus SE ( <i>nota do tradutor: isso tamb√©m se aplica ao nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RTOS MAX</a></i> ). <br><br>  A maioria das ferramentas de desenvolvimento de software incorporado inclui o c√≥digo de inicializa√ß√£o necess√°rio para lidar com a redefini√ß√£o da CPU e transferir o controle para a fun√ß√£o Ponto de Entrada na fun√ß√£o <b>main ()</b> .  O c√≥digo redistribu√≠vel do Nucleus SE n√£o lida com esse processo, pois deve ser o mais port√°til poss√≠vel.  Em vez disso, cont√©m a fun√ß√£o <b>main ()</b> , que assume o controle da CPU, inicializa e inicia o sistema operacional.  Esse recurso ser√° discutido em detalhes abaixo. <br><br><div class="spoiler">  <b class="spoiler_title">Artigos anteriores da s√©rie:</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 29.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Interrup√ß√µes no N√∫cleo SE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 28.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Temporizadores de software</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo # 27</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Hora do sistema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 26.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Canais: servi√ßos auxiliares e estruturas de dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 25.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Canais de Dados: Introdu√ß√£o e Servi√ßos B√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 24.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Filas: servi√ßos auxiliares e estruturas de dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 23.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Filas: introdu√ß√£o e servi√ßos b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 22.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Caixas de correio: servi√ßos auxiliares e estruturas de dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Caixas de correio: Introdu√ß√£o e servi√ßos b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sem√°foros: Servi√ßos Auxiliares e Estruturas de Dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sem√°foros: introdu√ß√£o e servi√ßos b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo # 18</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grupos de Sinalizadores de Eventos: Servi√ßos Auxiliares e Estruturas de Dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grupos de Sinalizadores de Eventos: Introdu√ß√£o e Servi√ßos B√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Signals</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parti√ß√µes de mem√≥ria: servi√ßos e estruturas de dados</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Se√ß√µes de mem√≥ria: introdu√ß√£o e servi√ßos b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Estruturas de dados da tarefa e chamadas de API n√£o suportadas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Servi√ßos para trabalhar com tarefas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tarefas: configura√ß√£o e introdu√ß√£o √† API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Agendador: recursos avan√ßados e preserva√ß√£o de contexto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Agendador: implementa√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">N√∫cleo SE: Projeto Interno e Implanta√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo # 7</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">N√∫cleo SE: Introdu√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Outros servi√ßos RTOS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Intera√ß√£o e sincroniza√ß√£o de tarefas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tarefas, altern√¢ncia de contexto e interrup√ß√µes</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo # 3</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tarefas e planejamento</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RTOS: estrutura e modo em tempo real</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Artigo 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RTOS: introdu√ß√£o.</a> <br></div></div><br><h3>  Inicializa√ß√£o de mem√≥ria </h3><br>  As declara√ß√µes de todas as vari√°veis ‚Äã‚Äãest√°ticas no c√≥digo Nucleus SE come√ßam com o prefixo <b>ROM</b> ou <b>RAM</b> para indicar onde elas devem estar localizadas.  Essas duas diretivas <b>#define</b> s√£o definidas no arquivo <b>nuse_types.h</b> e devem ser configuradas levando em considera√ß√£o as especificidades do conjunto de ferramentas de desenvolvimento usadas (compilador e vinculador).  Normalmente, a <b>ROM</b> deve ser do tipo <b>const</b> ( <i>nota do tradutor: pela minha experi√™ncia, <b>const</b> nem sempre √© suficiente, melhor √© <b>const est√°tica</b></i> ) e <b>RAM</b> √© um valor vazio. <br><br>  Todas as vari√°veis ‚Äã‚Äãde <b>ROM</b> s√£o inicializadas estaticamente, o que √© l√≥gico.  <b>As</b> vari√°veis ‚Äã‚Äãde <b>RAM</b> n√£o s√£o inicializadas estaticamente (pois isso funciona apenas com certas caixas de ferramentas configuradas para copiar automaticamente da ROM para a RAM);  um c√≥digo de inicializa√ß√£o expl√≠cito est√° inclu√≠do no aplicativo e ser√° descrito em detalhes abaixo. <br><br>  O Nucleus SE n√£o armazena dados "constantes" na RAM, que geralmente √© escassa em pequenos sistemas.  Em vez de usar estruturas de dados complexas para descrever objetos do kernel, conjuntos de tabelas (matrizes) s√£o usados, que s√£o facilmente colocados na ROM ou RAM, dependendo da necessidade. <br><br><h2>  Fun√ß√£o Main () </h2><br>  A seguir, est√° o c√≥digo completo da fun√ß√£o <b>main ()</b> do Nucleus SE: <br><br><pre><code class="plaintext hljs">void main(void) { NUSE_Init(); /* initialize kernel data */ /* user initialization code here */ NUSE_Scheduler(); /* start tasks */ }</code> </pre> <br>  A sequ√™ncia de opera√ß√µes √© bastante simples: <br><br><ul><li>  Primeiro, a fun√ß√£o <b>NUSE_Init ()</b> √© <b>chamada</b> .  Inicializa todas as estruturas de dados do Nucleus SE e ser√° descrito em detalhes abaixo. </li><li>  Em seguida, o usu√°rio pode inserir qualquer c√≥digo de inicializa√ß√£o do aplicativo que ser√° executado antes do in√≠cio do planejador de tarefas.  Para obter mais informa√ß√µes sobre o que pode ser alcan√ßado com esse c√≥digo, consulte mais adiante neste artigo. </li><li>  Por fim, o agendador do N√∫cleo SE ( <b>NUSE_Scheduler ()</b> ) √© iniciado.  Isso tamb√©m ser√° discutido em detalhes posteriormente neste artigo. </li></ul><br><h2>  Fun√ß√£o NUSE_Init () </h2><br>  Essa fun√ß√£o inicializa todas as vari√°veis ‚Äã‚Äãe estruturas de dados do n√∫cleo Nucleus SE. <br><br><div class="spoiler">  <b class="spoiler_title">Abaixo est√° o c√≥digo completo da fun√ß√£o:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">void NUSE_Init(void) { U8 index; /* global data */ NUSE_Task_Active = 0; NUSE_Task_State = NUSE_STARTUP_CONTEXT; #if NUSE_SYSTEM_TIME_SUPPORT NUSE_Tick_Clock = 0; #endif #if NUSE_SCHEDULER_TYPE == NUSE_TIME_SLICE_SCHEDULER NUSE_Time_Slice_Ticks = NUSE_TIME_SLICE_TICKS; #endif /* tasks */ #if ((NUSE_SCHEDULER_TYPE != NUSE_RUN_TO_COMPLETION_SCHEDULER) || NUSE_SIGNAL_SUPPORT || NUSE_TASK_SLEEP || NUSE_SUSPEND_ENABLE || NUSE_SCHEDULE_COUNT_SUPPORT) for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { NUSE_Init_Task(index); } #endif /* partition pools */ #if NUSE_PARTITION_POOL_NUMBER != 0 for (index=0; index&lt;NUSE_PARTITION_POOL_NUMBER; index++) { NUSE_Init_Partition_Pool(index); } #endif /* mailboxes */ #if NUSE_MAILBOX_NUMBER != 0 for (index=0; index&lt;NUSE_MAILBOX_NUMBER; index++) { NUSE_Init_Mailbox(index); } #endif /* queues */ #if NUSE_QUEUE_NUMBER != 0 for (index=0; index&lt;NUSE_QUEUE_NUMBER; index++) { NUSE_Init_Queue(index); } #endif /* pipes */ #if NUSE_PIPE_NUMBER != 0 for (index=0; index&lt;NUSE_PIPE_NUMBER; index++) { NUSE_Init_Pipe(index); } #endif /* semaphores */ #if NUSE_SEMAPHORE_NUMBER != 0 for (index=0; index&lt;NUSE_SEMAPHORE_NUMBER; index++) { NUSE_Init_Semaphore(index); } #endif /* event groups */ #if NUSE_EVENT_GROUP_NUMBER != 0 for (index=0; index&lt;NUSE_EVENT_GROUP_NUMBER; index++) { NUSE_Init_Event_Group(index); } #endif /* timers */ #if NUSE_TIMER_NUMBER != 0 for (index=0; index&lt;NUSE_TIMER_NUMBER; index++) { NUSE_Init_Timer(index); } #endif }</code> </pre><br></div></div><br>  Primeiro, as vari√°veis ‚Äã‚Äãglobais s√£o inicializadas: <br><ul><li>  <b>NUSE_Task_Active</b> - √≠ndice da tarefa ativa, inicializada em zero;  mais tarde, isso pode alterar o agendador. </li><li>  <b>NUSE_Task_State</b> - inicializado com o valor <b>NUSE_STARTUP_CONTEXT</b> , que limita a funcionalidade da API para qualquer c√≥digo de inicializa√ß√£o de aplicativo subsequente. </li><li>  Se o suporte de hor√°rio do sistema estiver ativado, <b>NUSE_Tick_Clock ser√° definido</b> como zero. </li><li>  Se o planejador do Time Slice estiver ativado, <b>NUSE_Time_Slice_Ticks receber√°</b> o valor configurado <b>NUSE_TIME_SLICE_TICKS</b> . </li></ul><br>  Em seguida, as fun√ß√µes s√£o chamadas para inicializar os objetos do kernel: <br><br><ul><li>  <b>NUSE_Init_Task ()</b> √© chamado para inicializar as estruturas de dados de cada tarefa.  Essa chamada ser√° ignorada apenas se o agendador Executar at√© a conclus√£o for usado e os sinais, pausa na tarefa e contador de agendamento n√£o estiverem configurados (uma vez que essa combina√ß√£o de fun√ß√µes resultar√° na aus√™ncia dessas estruturas de tarefas na RAM, portanto, a inicializa√ß√£o n√£o ser√° executada). </li><li>  <b>NUSE_Init_Partition_Pool ()</b> √© chamado para inicializar cada objeto do conjunto de parti√ß√µes.  Essas chamadas ser√£o ignoradas se nenhum conjunto de parti√ß√µes estiver configurado. </li><li>  <b>NUSE_Init_Mailbox ()</b> √© chamado para inicializar cada objeto da caixa de correio.  Essas chamadas s√£o ignoradas se n√£o houver caixas de correio configuradas. </li><li>  <b>NUSE_Init_Queue ()</b> √© chamado para inicializar cada objeto da fila.  Essas chamadas s√£o ignoradas se n√£o houver filas configuradas. </li><li>  <b>NUSE_Init_Pipe ()</b> √© chamado para inicializar cada objeto de canal.  Essas chamadas s√£o ignoradas se n√£o houver canais configurados. </li><li>  <b>NUSE_Init_Semaphore ()</b> √© chamado para inicializar cada objeto de sem√°foro.  Essas chamadas ser√£o ignoradas se nenhum sem√°foro estiver configurado. </li><li>  <b>NUSE_Init_Event_Group ()</b> √© chamado para inicializar cada objeto do grupo de eventos.  Essas chamadas ser√£o ignoradas se n√£o houver grupos de eventos configurados. </li><li>  <b>NUSE_Init_Timer ()</b> √© chamado para inicializar cada objeto de timer.  Essas chamadas s√£o ignoradas se n√£o houver temporizadores configurados. </li></ul><br><h3>  Inicializa√ß√£o de tarefas </h3><br><div class="spoiler">  <b class="spoiler_title">A seguir, est√° o c√≥digo completo da fun√ß√£o NUSE_Init_Task ():</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">void NUSE_Init_Task(NUSE_TASK task) { #if NUSE_SCHEDULER_TYPE != NUSE_RUN_TO_COMPLETION_SCHEDULER NUSE_Task_Context[task][15] = /* SR */ NUSE_STATUS_REGISTER; NUSE_Task_Context[task][16] = /* PC */ NUSE_Task_Start_Address[task]; NUSE_Task_Context[task][17] = /* SP */ (U32 *)NUSE_Task_Stack_Base[task] + NUSE_Task_Stack_Size[task]; #endif #if NUSE_SIGNAL_SUPPORT || NUSE_INCLUDE_EVERYTHING NUSE_Task_Signal_Flags[task] = 0; #endif #if NUSE_TASK_SLEEP || NUSE_INCLUDE_EVERYTHING NUSE_Task_Timeout_Counter[task] = 0; #endif #if NUSE_SUSPEND_ENABLE || NUSE_INCLUDE_EVERYTHING #if NUSE_INITIAL_TASK_STATE_SUPPORT || NUSE_INCLUDE_EVERYTHING NUSE_Task_Status[task] = NUSE_Task_Initial_State[task]; #else NUSE_Task_Status[task] = NUSE_READY; #endif #endif #if NUSE_SCHEDULE_COUNT_SUPPORT || NUSE_INCLUDE_EVERYTHING NUSE_Task_Schedule_Count[task] = 0; #endif }</code> </pre><br></div></div><br>  Se o agendador Run to Completion n√£o tiver sido configurado, o bloco de contexto da <b>tarefa NUSE_Task_Context [task] [] ser√°</b> inicializado.  A maioria dos elementos n√£o possui valores atribu√≠dos, pois representam registros comuns da m√°quina, que devem ter um valor intermedi√°rio ao iniciar uma tarefa.  No exemplo (Freescale ColdFire) da implementa√ß√£o do Nucleus SE (mas para outros processadores, o mecanismo ser√° semelhante), as tr√™s √∫ltimas entradas s√£o definidas explicitamente: <br><br><ul><li>  <b>NUSE_Task_Context [task] [15]</b> cont√©m o registro de status ( <b>SR</b> , registro de status) e possui o valor da diretiva <b>#define NUSE_STATUS_REGISTER</b> . </li><li>  <b>NUSE_Task_Context [task] [16]</b> cont√©m o contador de programas ( <b>PC</b> , contador de programas) e possui o valor do endere√ßo do ponto de entrada do c√≥digo da tarefa: <b>NUSE_Task_Start_Address [task]</b> . </li><li>  <b>NUSE_Task_Context [task] [17]</b> cont√©m o ponteiro da pilha ( <b>SP</b> , ponteiro da pilha) e √© inicializado com o valor calculado como a soma do endere√ßo da pilha de tarefas ( <b>NUSE_Task_Stack_Base [task]</b> ) e o tamanho da pilha de tarefas ( <b>NUSE_Task_Stack_Size [task]</b> ). </li></ul><br>  Se o suporte a sinal estiver ativado, os sinalizadores de tarefa ( <b>NUSE_Task_Signal_Flags [task]</b> ) ser√£o definidos como zero. <br><br>  Se a suspens√£o da tarefa estiver ativada (ou seja, a chamada de servi√ßo da API <b>NUSE_Task_Sleep ()</b> ), o contador de tempo limite da tarefa ( <b>NUSE_Task_Timeout_Counter [task]</b> ) ser√° definido como zero. <br><br>  Se o estado de suspens√£o da tarefa estiver ativado, o status da tarefa ( <b>NUSE_Task_Status [task]</b> ) ser√° inicializado.  Este valor inicial √© definido pelo usu√°rio (em <b>NUSE_Task_Initial_State [task]</b> ) se o suporte ao estado inicial da tarefa estiver ativado.  Caso contr√°rio, o estado √© atribu√≠do a <b>NUSE_READY</b> . <br><br>  Se o contador de planejamento estiver ativado, o contador de tarefas ( <b>NUSE_Task_Schedule_Count [task]</b> ) ser√° definido como zero. <br><br><h3>  Inicializando conjuntos de parti√ß√µes </h3><br>  A seguir, est√° o c√≥digo completo da fun√ß√£o <b>NUSE_Init_Partition_Pool ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Partition_Pool(NUSE_PARTITION_POOL pool) { NUSE_Partition_Pool_Partition_Used[pool] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Partition_Pool_Blocking_Count[pool] = 0; #endif }</code> </pre><br>  O contador do conjunto de parti√ß√µes "usado" ( <b>NUSE_Partition_Pool__Partition_Used [pool]</b> ) est√° definido como zero. <br><br>  Se o bloqueio de tarefas estiver ativado, o contador de tarefas bloqueadas dos conjuntos de parti√ß√µes ( <b>NUSE_Partition_Pool_Blocking_Count [pool]) ser√° definido</b> como zero. <br><br><h3>  Inicializando caixas de correio </h3><br>  Abaixo est√° o c√≥digo completo do <b>NUSE_Init_Mailbox ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Mailbox(NUSE_MAILBOX mailbox) { NUSE_Mailbox_Data[mailbox] = 0; NUSE_Mailbox_Status[mailbox] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Mailbox_Blocking_Count[mailbox] = 0; #endif }</code> </pre><br>  O armazenamento de dados da caixa de correio ( <b>NUSE_Mailbox_Data [caixa de correio]</b> ) √© definido como zero e o estado ( <b>NUSE_Mailbox_Status [caixa de correio]</b> ) se torna "n√£o utilizado" (ou seja, zero). <br><br>  Se o bloqueio de tarefas estiver ativado, o contador de tarefas da caixa de correio bloqueada ( <b>NUSE_Mailbox_Blocking_Count [caixa de correio]</b> ) ser√° definido como zero. <br><br><h3>  Inicializa√ß√£o da fila </h3><br>  A seguir, est√° o c√≥digo completo da fun√ß√£o <b>NUSE_Init_Queue ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Queue(NUSE_QUEUE queue) { NUSE_Queue_Head[queue] = 0; NUSE_Queue_Tail[queue] = 0; NUSE_Queue_Items[queue] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Queue_Blocking_Count[queue] = 0; #endif }</code> </pre><br>  Os ponteiros para o in√≠cio e o fim da fila (de fato, esses s√£o os √≠ndices <b>NUSE_Queue_Head [fila</b> ] e <b>NUSE_Queue_Tail [fila]</b> ) recebem valores que indicam o in√≠cio da √°rea de dados das filas (ou seja, assumem um valor zero).  O contador na fila ( <b>NUSE_Queue_Items [fila]</b> ) tamb√©m est√° definido como zero. <br><br>  Se o bloqueio de tarefas estiver ativado, o contador de tarefas da fila bloqueadas ( <b>NUSE_Queue_Blocking_Count [fila]</b> ) ser√° definido como zero. <br><br><h3>  Inicializa√ß√£o de canal </h3><br>  A seguir, est√° o c√≥digo completo da fun√ß√£o <b>NUSE_Init_Pipe ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Pipe(NUSE_PIPE pipe) { NUSE_Pipe_Head[pipe] = 0; NUSE_Pipe_Tail[pipe] = 0; NUSE_Pipe_Items[pipe] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Pipe_Blocking_Count[pipe] = 0; #endif }</code> </pre><br>  Os ponteiros para o in√≠cio e o fim do canal (de fato, esses s√£o os √≠ndices - <b>NUSE_Pipe_Head [pipe]</b> e <b>NUSE_Pipe_Tail [pipe]</b> ) recebem um valor que indica o in√≠cio da √°rea de dados do canal (ou seja, eles assumem um valor zero).  O <b>contador de</b> canais ( <b>NUSE_Pipe_Items [pipe]</b> ) tamb√©m est√° definido como zero. <br><br>  Se o bloqueio de tarefas estiver ativado, o contador de tarefas bloqueadas do canal ( <b>NUSE_Pipe_Blocking_Count [pipe]</b> ) ser√° definido como zero. <br><br><h3>  Inicializa√ß√£o de sem√°foro </h3><br>  A seguir, est√° o c√≥digo completo da fun√ß√£o <b>NUSE_Init_Semaphore ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Semaphore(NUSE_SEMAPHORE semaphore) { NUSE_Semaphore_Counter[semaphore] = NUSE_Semaphore_Initial_Value[semaphore]; #if NUSE_BLOCKING_ENABLE NUSE_Semaphore_Blocking_Count[semaphore] = 0; #endif }</code> </pre><br>  O contador de sem√°foro ( <b>NUSE_Semaphore_Counter [sem√°foro]</b> ) √© inicializado com o valor definido pelo usu√°rio ( <b>NUSE_Semaphore_Initial_Value [sem√°foro]</b> ). <br><br>  Se o bloqueio de tarefas estiver ativado, o contador de tarefas de sem√°foro bloqueado ( <b>NUSE_Semaphore_Blocking_Count [sem√°foro]</b> ) ser√° definido como zero. <br><br><h3>  Inicializando grupos de eventos </h3><br>  A seguir, est√° o c√≥digo completo da fun√ß√£o <b>NUSE_Init_Event_Group ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Event_Group(NUSE_EVENT_GROUP group) { NUSE_Event_Group_Data[group] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Event_Group_Blocking_Count[group] = 0; #endif }</code> </pre><br>  Os sinalizadores do grupo de eventos s√£o redefinidos, ou seja,  <b>NUSE_Event_Group_Data [group]</b> recebe um valor nulo. <br><br>  Se o bloqueio de tarefas estiver ativado, o contador de tarefas bloqueadas do grupo de sinalizadores de eventos ( <b>NUSE_Event_Group_Blocking_Count [group]</b> ) ser√° definido como zero. <br><br><h3>  Inicializa√ß√£o do timer </h3><br>  Abaixo est√° o c√≥digo completo de <b>NUSE_Init_Timer ()</b> ; <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Timer(NUSE_TIMER timer) { NUSE_Timer_Status[timer] = FALSE; NUSE_Timer_Value[timer] = NUSE_Timer_Initial_Time[timer]; NUSE_Timer_Expirations_Counter[timer] = 0; }</code> </pre><br>  O estado do timer ( <b>NUSE_Timer_Status [timer]</b> ) est√° definido como "n√£o utilizado", ou seja,  <b>FALSO</b> <br><br>  O valor da contagem regressiva ( <b>NUSE_Timer_Value [timer</b> ]) √© inicializado pelo valor definido pelo usu√°rio ( <b>NUSE_Timer_Initial_Time [timer]</b> ). <br><br>  O contador de conclus√£o ( <b>NUSE_Timer_Expirations_Counter [timer]</b> ) est√° definido como zero. <br><br><h2>  Inicializando o c√≥digo do aplicativo </h2><br>  Depois que as estruturas de dados do Nucleus SE foram inicializadas, torna-se poss√≠vel executar o c√≥digo respons√°vel pela inicializa√ß√£o do aplicativo antes de iniciar a tarefa.  Esse recurso pode ser √∫til para as seguintes tarefas: <br><br><ul><li>  Inicializa√ß√£o de estruturas de dados de aplicativos.  O preenchimento expl√≠cito de estruturas de dados √© mais f√°cil de entender e depurar em compara√ß√£o com a inicializa√ß√£o autom√°tica de vari√°veis ‚Äã‚Äãest√°ticas. </li><li>  Atribui√ß√£o de objetos do kernel.  Dado que todos os objetos do kernel s√£o criados estaticamente no est√°gio de constru√ß√£o e s√£o identificados usando valores de √≠ndice, pode ser √∫til atribuir um "propriet√°rio" ou determinar o uso desses objetos.  Isso pode ser feito usando a diretiva #define, no entanto, se houver v√°rias inst√¢ncias de tarefas, √© melhor atribuir √≠ndices de objetos por meio de matrizes globais (indexadas pelo ID da tarefa). </li><li>  Inicializa√ß√£o do dispositivo.  Isso pode ser √∫til para a instala√ß√£o inicial de perif√©ricos. </li></ul><br>  Obviamente, muitos desses objetivos podem ser alcan√ßados antes da inicializa√ß√£o do Nucleus SE, mas a vantagem na localiza√ß√£o do c√≥digo do aplicativo aqui √© que agora voc√™ pode usar os servi√ßos do kernel (chamadas de API).  Por exemplo, uma fila ou caixa de correio pode ser preenchida previamente com dados que precisar√£o ser processados ‚Äã‚Äãquando a tarefa for iniciada. <br><br>  As chamadas de API t√™m uma restri√ß√£o: todas as a√ß√µes que geralmente levam √† ativa√ß√£o do agendador s√£o proibidas (por exemplo, pausar / bloquear tarefas).  A vari√°vel global <b>NUSE_Task_State</b> foi definida como <b>NUSE_STARTUP_CONTEXT</b> para <b>indicar</b> essa limita√ß√£o. <br><br><h2>  Agendador de inicializa√ß√£o </h2><br>  Ap√≥s a inicializa√ß√£o ser conclu√≠da, resta apenas executar o planejador para come√ßar a executar o c√≥digo do aplicativo - tarefas.  A configura√ß√£o do planejador e o trabalho de v√°rios tipos de planejadores foram descritos em detalhes em um dos artigos anteriores ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n¬∫ 9</a> ); portanto, apenas um breve resumo √© necess√°rio aqui. <br>  A sequ√™ncia das etapas principais √© a seguinte: <br><br><ul><li>  <b>Configurando a</b> vari√°vel global <b>NUSE_Task_State como</b> <b>NUSE_TASK_CONTEXT</b> . </li><li>  Selecione o √≠ndice da primeira tarefa a ser executada.  Se o suporte para a tarefa inicial estiver ativado, a procura pela primeira tarefa finalizada ser√° executada, caso contr√°rio, ser√° usado um valor zero. </li><li>  O agendador √© <b>chamado</b> - <b>NUSE_Scheduler ()</b> . </li></ul><br>  O que exatamente acontece na √∫ltima etapa depende de qual planejador est√° selecionado.  Ao usar o planejador Executar at√© a conclus√£o, um ciclo de planejamento √© iniciado e as tarefas s√£o chamadas seq√ºencialmente.  Ao usar outros agendadores, o contexto da primeira tarefa √© carregado e o controle √© transferido para a tarefa. <br><br>  O artigo a seguir discutir√° diagn√≥sticos e verifica√ß√£o de erros. <br><br>  <b>Sobre o autor:</b> Colin Walls trabalha na ind√∫stria eletr√¥nica h√° mais de trinta anos, dedicando a maior parte de seu tempo ao firmware.  Ele agora √© engenheiro de firmware na Mentor Embedded (uma divis√£o da Mentor Graphics).  Colin Walls frequentemente fala em confer√™ncias e semin√°rios, autor de v√°rios artigos t√©cnicos e dois livros sobre firmware.  Vive no Reino Unido.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Blog</a> profissional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de Colin</a> , e-mail: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460617/">https://habr.com/ru/post/pt460617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460603/index.html">V2G. Carros el√©tricos ajudar√£o a equilibrar a produ√ß√£o e o consumo de eletricidade</a></li>
<li><a href="../pt460605/index.html">Est√∫dio Fotogr√°fico Autom√°tico, Parte 1</a></li>
<li><a href="../pt460607/index.html">Loja de aplicativos de seguran√ßa ofensiva com ferramentas de hackers do Android</a></li>
<li><a href="../pt460611/index.html">Failover: o perfeccionismo nos destr√≥i e ... pregui√ßa</a></li>
<li><a href="../pt460615/index.html">Na sequ√™ncia do Industrial Ninja: como o PLC foi hackeado no Positive Hack Days 9</a></li>
<li><a href="../pt460621/index.html">Tic Tac Toe Parte 4: Interagindo com o back-end do frasco usando HTTP</a></li>
<li><a href="../pt460623/index.html">Sobre a tortura de Julian Assange</a></li>
<li><a href="../pt460625/index.html">Como n√£o consegui o primeiro lugar na competi√ß√£o para desenvolvedores de JavaScript do Telegram</a></li>
<li><a href="../pt460627/index.html">vGPU - o uso n√£o pode ser ignorado</a></li>
<li><a href="../pt460629/index.html">A probabilidade de 2 mineiros terem o mesmo mundo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>