<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👉🏼 📌 🐿️ 方便的Pebble，稳定的Noolite和价格合理的esp8266实现自动化 🏮 👩🏼‍🚒 📜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="从上一篇文章开始（ 链接已使用了将近一年。在这一年中，我重新考虑了一些东西，互联网，结果证明是IoT :)→物联网）。 

 我将尝试总结积累的知识的新部分，描述我的努力方向和想要实现的目标→请您阅读。 

 Noolite F v2.0 
 在标题中，我得到了这样的字眼：卵石和硅藻土。 让我们继续...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>方便的Pebble，稳定的Noolite和价格合理的esp8266实现自动化</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403273/">从上一篇文章开始（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">链接已使用</a>了将近一年。在这一年中，我重新考虑了一些东西，互联网，结果证明是IoT :)→物联网）。 <br><br> 我将尝试总结积累的知识的新部分，描述我的努力方向和想要实现的目标→请您阅读。 <br><a name="habracut"></a><br><h2>  Noolite F v2.0 </h2><br>  <b>在标题中，我得到了这样的字眼：卵石和硅藻土。</b>  <b>让我们继续前进吧！</b> <br> 我仍然用卵石来管理我的诺莱特灯，车库和大门。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">搜索已经</a>显示了很多有关Noolite的有用信息， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">搜索</a>显示了新文章。 <br><br> 除了Noolite系统的第一代装置外，我还有新的装置：带反馈功能的动力装置SLF-1-200（nooLite-F）（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">以及新一代加密装置</a> ）。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/312/be1/be5/312be1be5d922ebcc46d307015f01eb0.png" alt="图片"><br><br> 电源块SB-1-150 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/0a1/575/b81/0a1575b813bdd72fa22800bf8b33374d.png" alt="图片"><br><br> 并更新了USB适配器MTRF-64 USB。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/61e/842/1de/61e8421deaa8155d33aba9f064002a3b.png" alt="图片"><br><br>  Noolite系统上我家的所有灯都亮着。 <br><br> 直到最近，我还拥有一个第一代USB适配器，该适配器具有16个设备，现在在“系统家用抽筋”中具有64个通道（MTRF-64 USB），还用于带反馈的新一代设备（noolite F）。 但是技术正在朝着正确的方向发展，创造了新的现代设备。 <br><br>  <b>新设备有2个最重要的选项：反馈和通过地址标识设备的原理：ID。</b> 现在，您不必将设备写入通道1并控制该通道。 现在，您可以通过其ID在一个通道中访问特定设备，并向其发送执行命令。 <br><br> 新一代模块的文档<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">可</a>在制造商的网站上找到。 <br><br><div class="spoiler">  <b class="spoiler_title">一切都可以使用python代码通过串行端口工作。</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- #!/usr/bin/env python import serial import time class NooLiteCommand: def __init__(self, ch, cmd, mode=0, ctr=0, res=0, fmt=0, d0=0, d1=0, d2=0, d3=0, id0=0, id1=0, id2=0, id3=0): self.st = 171 self.mode = mode self.ctr = ctr self.res = res self.ch = ch self.cmd = cmd self.fmt = fmt self.d0 = d0 self.d1 = d1 self.d2 = d2 self.d3 = d3 self.id0 = id0 self.id1 = id1 self.id2 = id2 self.id3 = id3 self.sp = 172 @property def crc(self): crc = sum([ self.st, self.mode, self.ctr, self.res, self.ch, self.cmd, self.fmt, self.d0, self.d1, self.d2, self.d3, self.id0, self.id1, self.id2, self.id3, ]) return crc if crc &lt; 256 else divmod(crc, 256)[1] def to_bytes(self): return bytearray([ self.st, self.mode, self.ctr, self.res, self.ch, self.cmd, self.fmt, self.d0, self.d1, self.d2, self.d3, self.id0, self.id1, self.id2, self.id3, self.crc, self.sp ]) class NooliteSerial: def __init__(self, tty_name): self.tty = self._get_tty(tty_name) def on(self, ch): self.send_command(ch, 2, 2, 0) pass def off(self, ch): self.send_command(ch, 0, 2, 0) pass def status(self, ch): m = self.send_command(ch, 128, 2, 0) pass def send_command(self, ch, cmd, mode=0, ctr=0, res=0, fmt=0, d0=0, d1=0, d2=0, d3=0, id0=0, id1=0, id2=0, id3=0): command = NooLiteCommand(ch, cmd, mode, ctr, res, fmt, d0, d1, d2, d3, id0, id1, id2, id3) self.tty.write(command.to_bytes()) while True: bytes_response = list(self.tty.read(117)) if bytes_response: all_responses.append(bytes_response) if bytes_response[3] == 0: break else: break return all_responses @staticmethod def _get_tty(tty_name): serial_port = serial.Serial(tty_name, timeout=0.1) if not serial_port.is_open: serial_port.open() serial_port.flushInput() serial_port.flushOutput() return serial_port noo_serial = NooliteSerial('/dev/ttyUSB0') #ch, cmd, mode, ctr #noo_serial.send_command(1, 15, 2, 0) #    1 #noo_serial.send_command(0, 4, 2, 0) #switch #noo_serial.send_command(0, 2, 2, 0) #turn on #noo_serial.send_command(0, 3, 2, 0) #   #noo_serial.send_command(0, 0, 2, 0) #turn off #noo_serial.send_command(0, 15, 2, 0) #  #noo_serial.send_command(0, 128, 2, 0,0,1) #CMD_Read_State + fmt = 1 #noo_serial.on(0) #noo_serial.status(0) #noo_serial.off(0) #noo_serial.off(0) #noo_serial.status(0) #noo_serial.send_command(ch=0,ctr=8, cmd=4, id0=0,id1=0,id2=48,id3=114) #switch noolite ID 0.0.48.114</span></span></code> </pre> <br></div></div><br> 在正确的时间使用必要的功能，我们可以控制Noolite块并从新块接收状态。 由于我有99％的这些旧块，因此考虑到USB适配器支持旧块和新块的事实，我仍然可以使用将1个块写入1个通道的旧方案（感谢开发人员的兼容性，无需铃鼓跳舞）。 在运行中，您可以管理和接收新块的状态以及管理旧块的状态。 <br><br> 直到最近，屋子里还没有一个按钮开关。 我不得不在车库里加光（我刚到那儿整理东西：D），化妆镜的背光灯上也出现了一个开关。 知道有<b>一个SB-1-150电源设备后</b> ，我设置了普通开关并连接了<b>电源</b>设备。 镜子的背光由一块白板制成，3w的灯泡4000 K，白光。  SB-1-150的独特之处在于，它可以在现有电路环境中放置在墙壁开关（开关）的盒子中，并且可以通过将按钮开关连接到设备本身来放置。 <br><br><div class="spoiler">  <b class="spoiler_title">正是我的女孩需要化妆:)</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/geektimes/post_images/63d/97d/4ff/63d97d4ff9ed73ee3fe00abba6a94fed.png" alt="图片"><br></div></div><br><h2> 卵石 </h2><br> 当我开始涉足自动化领域时，主要因素之一是：称职且方便的管理。 <br><br> 用智能手机进行控制似乎很方便，但是...每次在不舒服的小按钮，左撇子广告或直到您按下按钮之前，每次加载应用程序都不方便，所有的欲望都消失了。 语音控制消失了，因为它也很不方便和奇怪：)-让它保留在科幻电影的情节中。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/5ea/226/ba7/5ea226ba78a2e6fb2e61a63458aa88af.png" alt="图片"><br><br> 然后，我以另一种方式解决了这个问题-通过一块手表，它与我在一起时不会占用空间，并且将所有便利设施，移动性和控制速度结合在一起。 通常-小卵石还活着！ 但是最重​​要的是，您仍然可以随时编写应用程序-您自己的应用程序，以管理自动化系统。 实际上是炸弹。 <br><br><div class="spoiler">  <b class="spoiler_title">小卵石还活着！</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">门控视频</a> <br></div></div><br> 关闭pebble.com公司的悲剧（Fitbit购买了所有pebble.com以获得专利）并没有影响其业绩和业绩。 最近，有一个iOS安卓系统更新-手表与卵石云服务（如果终止支持）和授权无关。 <br><br> 从视觉<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上看</a> -没有任何变化，但服务<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">仍然存在</a> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">cloudpebble.net</a> -WTF？ 这是非常有用的事情。 如果您可以用JS编写代码（并且不希望在C ++上花费很多时间）-请在板上:)-云卵石可让您快速地“抛出”应用程序。 嗯，这就是我做到的方式。 当然，JS的性能不应该与C ++（这是神圣的）相提并论。 是的！ <br><br><div class="spoiler">  <b class="spoiler_title">用于API的Pebble Cloud JS代码</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> UI = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ui'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ajax = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ajax'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> noolite = [ [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/mqtt/gate/slidegate'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/gate.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/mqtt/gate/garage'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/door.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'!'</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/103'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/100'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/system2.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'1  '</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'2  '</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1'</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/101'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2'</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/102'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/system/1'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/system1.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> water = [ [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/1'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/2'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/20'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/21'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 3 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/22'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 4 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/23'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 5 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/5'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 6 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/6'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 7 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/7'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 8 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/8'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 9 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/9'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> light1 = [ [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/6'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/0'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/1'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/7'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/8'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/2'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/3'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/4'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/5'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/9'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> light2 = [ [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/15'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/16'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/10'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/11'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/12'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/13'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/14'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;noolite.length; i++) { items[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: noolite[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: noolite[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items1 = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;light1.length; i++) { items1[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: light1[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: light1[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items2 = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;light2.length; i++) { items2[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: light2[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: light2[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items3 = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;water.length; i++) { items3[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: water[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: water[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } menu.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items); menu1.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items1); menu2.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items2); menu3.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items3); menu.show(); menu.on(<span class="hljs-string"><span class="hljs-string">'select'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.itemIndex == <span class="hljs-number"><span class="hljs-number">4</span></span>) { menu1.show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.itemIndex == <span class="hljs-number"><span class="hljs-number">5</span></span>) { menu2.show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.itemIndex ==<span class="hljs-number"><span class="hljs-number">8</span></span>) { menu3.show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = noolite[e.itemIndex][<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(url); ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: url, <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'get'</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'switched OK'</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Failure! console.log('error'); } ); } }); menu1.on('select', function(e) { var url = light1[e.itemIndex][1]; console.log(url); ajax({ url: url, method: 'get' }, function(data) { console.log('switched OK'); }, function(error) { // Failure! console.log('error'); } ); }); menu2.on('select', function(e) { var url = light2[e.itemIndex][1]; console.log(url); ajax({ url: url, method: 'get' }, function(data) { console.log('switched OK'); }, function(error) { // Failure! console.log('error'); } ); }); menu3.on('select', function(e) { var url = water[e.itemIndex][1]; ajax({ url: url, method: 'get' }, function(data) { console.log('switched OK'); }, function(error) { // Failure! console.log('error'); } ); });</span></span></code> </pre><br></div></div><br> 可以直接在Pebble的云网站上编写，编译代码，并可以通过电话下载已编译的应用程序，从而可以按秒安装时钟。 一切都很简单，任何年轻的自动化工程师都可以处理；） <br><br> 真可惜...可惜的是，Pebble不再存在，目前我没有其他选择。 卵石时间永远在我们心中！ <br><br><h2>  MQTT </h2><br> 去年，我遇到了一个很棒的协议，例如MQTT（历史记录：该协议的第一个版本是由Andy Stanford-Clark博士（IBM）和Arlene Nipper（Arcom）于1999年开发，并在免版税的许可下发布的。MQTT3.1.1规范是由OASIS联盟于2014年标准化。 <br><br> 关于协议如何工作以及客户端是什么的信息很多，而令我非常失望的是，没有真正的移动应用程序客户端，只有在android上。 <br><br> 了解缺乏好的移动应用程序是物联网领域的一个大问题（很多人说，但是他们做的很少..）-我和我的团队在工作中决定为android，ios，wp创建一个客户端使其符合所有标准且舒适。 稍后我将介绍有关客户端的信息，以及我们如何结交ESP8266 + MTRF64（Noolite）朋友并准备Nodemcu固件的方法。 它将是伟大，方便，便宜和美丽的！ 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>关注应用程序新闻。 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/96c/60d/e63/96c60de63c38253cccee7ddb9aad0b4b.png" alt="图片"><br><br>  <s>现在，您无需任何家用服务器和USB适配器即可控制Noolite照明，价格为50-100美元！</s> <br><br><h2> 家庭自动化的总体方案 </h2><br> 仍然存在以下方案： <br><br><blockquote> 视频监控：xeoma视频监控[网络摄像机] <br> 系统单元上的服务器：nginx + gunicorn + python + mqtt代理 <br> 管理：Pebble watch + MQTT客户端 <br> 控制模块（系统节点）：ESP8266 +光耦合器\ ds18b20，dht11传感器[22] </blockquote><br> 由于我看到了MQTT协议中的许多便利性，从订阅体系结构和与最终IoT设备的即时通信开始，到最后一个事实是MQTT消息可以通过路由器飞行而无需“转发”那里的任何端口并铃鼓跳舞。 方便！ 玩得开心！ 热情地:) <br><br> 所有这些导致我分散了系统的分散性，也就是说，避免了一个“家庭暴力”并切换到许多所谓的节点，并使用了一个云MQTT代理（有免费的MQTT代理，例如： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">mqtt.ximxim.com</a> （在站点登录并通过访问权限） ））-由于esp8266解决了所有问题，因此它又使用MQTT协议通过wifi工作。 <br><br> 鉴于MQTT Buddy将提供脚本服务，我不会考虑编写任何家庭脚本，我只会在云解决方案中创建它们，这将是真正的物联网，并且可以工作！ 从言语到行动！ <br><br><h2>  ESP8266 </h2><br> 当我熟悉该开发板时，开发板很小，就给我留下了深刻的印象，它支持Nodemcu固件上的LUA编程语言。 您需要的是+ MQTT模块。 在自动化领域，简单可靠的解决方案是基础。 费用从2美元到5美元不等（使用板载USB适配器的第5个型号立即收费），您可以快速部署子系统。 <br><br>  WiFi连接速度很快，可能性很多。 例如：大门/车库\浇水\照明控制。 我有30％的草坪灌溉由Noolite系统（干式接触块）驱动，其余70％的esp8266开发板通过使用MQTT协议的LUA语言控制。 <br><br><div class="spoiler">  <b class="spoiler_title">示例esp8266的LUA代码，获取ip并使用MQTT调用工作文件</b> <div class="spoiler_text"><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--load credentials dofile("credentials.lua") function init(name, pass) wifi.setmode(wifi.STATION) wifi.sta.config(name, pass) wifi.sta.connect() tmr.alarm(0, 1000, 1, function() if wifi.sta.getip()== nil then print("IP unavaiable, Waiting...") else tmr.stop(0) print("Config done, IP is "..wifi.sta.getip()) print("mac : "..wifi.sta.getmac()) dofile("mqtt.lua") end end) end print("START!") init(SSID,PASSWORD)</span></span></code> </pre><br><br>  -mqtt.lua文件 <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> door = <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-comment"><span class="hljs-comment">-- gpio13 local window = 6 -- gpio12 local cooler = 5 --gpio14 local led = 4 --GPIO2 board led! LOW == turn ON local light1 = 8 --gpio 15 local light2 = 1 --gpio 5 local light3 = 2 -- gpio 4 function register_myself() m:subscribe("mqtt_buddy/#",0,function(conn) print ("subscribed to Xim mqtt.ximxim.com server") end) end m = mqtt.Client("MQTT_BUDDY_SHOW_ROOM", 120, MQTT_USER, MQTT_PASS) m:on("connect", function(client) print ("connected to Xim mqtt.ximxim.com server") end) m:on("offline", function(client) reconnect_mqtt() end) m:on("message", function(client, topic, data) --print(topic.." data:"..data) if topic == "mqtt_buddy/window" and data == "1" then print "open-close window..." gpio.write(window, gpio.HIGH) gpio.write(led, gpio.LOW) tmr.alarm(1, 1000, tmr.ALARM_SINGLE, function() gpio.write(window, gpio.LOW) gpio.write(led, gpio.HIGH) print "command to close\open window is sent!" end) elseif topic == "mqtt_buddy/door" and data == "1" then print "open-close door..." gpio.write(door, gpio.HIGH) gpio.write(led, gpio.LOW) tmr.alarm(2, 1000, tmr.ALARM_SINGLE, function() gpio.write(door, gpio.LOW) gpio.write(led, gpio.HIGH) print "command to close\open door is sent!" end) elseif topic == "mqtt_buddy/cooler" then if data == "1" then print "switch on fan..." gpio.write(cooler, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch off fan..." gpio.write(cooler, gpio.LOW) gpio.write(led, gpio.HIGH) end elseif topic == "mqtt_buddy/light1" then if data == "1" then print "switch light1 ON..." gpio.write(light1, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch light1 off..." gpio.write(light1, gpio.LOW) gpio.write(led, gpio.HIGH) end elseif topic == "mqtt_buddy/light2" then if data == "1" then print "switch light2 ON..." gpio.write(light2, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch light2 off..." gpio.write(light2, gpio.LOW) gpio.write(led, gpio.HIGH) end elseif topic == "mqtt_buddy/light3" then if data == "1" then print "switch light3 ON..." gpio.write(light3, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch light3 off..." gpio.write(light3, gpio.LOW) gpio.write(led, gpio.HIGH) end end end) m:connect(MQTT_SERVER, MQTT_SERVER_PORT, 0, function(conn) register_myself() end)</span></span></code> </pre><br></div></div><br><h3> 问题 </h3><br> 在一个庞大的有<b>思想的</b>社区中，我想谈一个非常重要的话题，或者是我想解决的问题，但是没有足够的时间进行更深入的研究/知识。 <br><br> 底线是：通过权力下放，视频监视仍然存在，这需要一种或多种方式（至少）将主机图像传输到视频监视服务器（例如ivideon）或什至在xeoma之类的家用计算机上处​​理视频的主机（尽管它们也有云）-一种或另一种方式-您需要“转发”视频流，具有最终计算能力的图片（云解决方案）（反之亦然），以使流传输变得简单。 <br><br> 有想法从相机接收源图像（这里还有一个问题，不是每个相机都有一个用于从相机接收图片的URL，通常不清楚其他人将如何识别此URL ....）并转发到支持二进制数据的MQTT通道（即有一张图片可以很容易地通过mqtt协议以二进制形式传输）。 <br><br> 也许有人已经尝试实现这样的事情= ESP8266 + IP网络摄像头？ <br> 请回复（bogdanovich.alex [@] gmail.com）。 我将非常感谢！ <br><br> 当实施probros时，家庭服务器的问题将消失。 怎么了 因为他吃电并加热我的炉子:) <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/148/bfb/eab/148bfbeab6e37921aa198344af6564de.png" alt="图片"><br><br> 一切顺利，心情愉快！ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN403273/">https://habr.com/ru/post/zh-CN403273/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN403255/index.html">创建第一个“感知”广告拦截器，它与页面布局无关</a></li>
<li><a href="../zh-CN403263/index.html">如何在“ NAG”服务中心安排工作</a></li>
<li><a href="../zh-CN403265/index.html">酒店业向Airbnb宣战</a></li>
<li><a href="../zh-CN403267/index.html">通过FPGA到芯片上系统：基辅数字微电子学周-2017年4月24日至29日</a></li>
<li><a href="../zh-CN403271/index.html">直升机射击</a></li>
<li><a href="../zh-CN403275/index.html">寻找宇宙中缺少的反物质仍处于令人不安的不确定状态</a></li>
<li><a href="../zh-CN403277/index.html">这些印度女科学家向火星发射了火箭弹，其价格低于电影《火星人》的预算</a></li>
<li><a href="../zh-CN403279/index.html">RFID新闻：碎毛皮大衣的销售已突破...上限</a></li>
<li><a href="../zh-CN403281/index.html">Windows 10将禁止后台应用程序</a></li>
<li><a href="../zh-CN403283/index.html">3D打印机Funtastique EVO v1.0：首次介绍</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>