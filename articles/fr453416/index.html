<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüöí üëÜüèª ‚ö±Ô∏è Fonctionnement de la configuration dans .NET Core üõÄ ü§≥üèº ‚ñ∂Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Arr√™tons de parler de DDD et de r√©flexion pendant un moment. Je propose de parler du simple, de l'organisation des param√®tres de l'application. 


 Ap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fonctionnement de la configuration dans .NET Core</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453416/"><p>  Arr√™tons de parler de DDD et de r√©flexion pendant un moment.  Je propose de parler du simple, de l'organisation des param√®tres de l'application. </p><br><p>  Apr√®s que mes coll√®gues et moi avons d√©cid√© de passer √† .NET Core, la question s'est pos√©e de savoir comment organiser les fichiers de configuration, comment effectuer des transformations, etc. dans le nouvel environnement.  Le code suivant se trouve dans de nombreux exemples, et beaucoup l'ont utilis√© avec succ√®s. </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {   Environment = environment;   Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"appsettings.json"</span></span>) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  Mais voyons comment fonctionne la configuration, et dans quels cas utiliser cette approche, et dans lequel faire confiance aux d√©veloppeurs de .NET Core.  Je demande un chat. </p><a name="habracut"></a><br><h2 id="kak-bylo-ranshe">  Comme avant </h2><br><p>  Comme toute histoire, cet article a un d√©but.  L'un des premiers probl√®mes apr√®s le passage √† ASP.NET Core a √©t√© la transformation des fichiers de configuration. </p><br><div class="spoiler">  <b class="spoiler_title">Rappelez-vous comment c'√©tait avant avec web.config</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/28/rh/tx/28rhtxxm6uw-67utmgjas0oh0ii.png"></p><br><p>  La configuration se composait de plusieurs fichiers.  Le fichier principal √©tait <i>web.config</i> , et des transformations ( <em>web.Development.config</em> , etc.) lui √©taient d√©j√† appliqu√©es, selon la configuration de l'assembly.  Dans le m√™me temps, les attributs <em>xml</em> ont √©t√© activement utilis√©s pour rechercher et transformer la section du document <em>xml</em> . </p></div></div><br><p>  Mais comme nous le savons dans ASP.NET Core, le <em>fichier web.config a √©t√©</em> remplac√© par <em>appsettings.json</em> et il n'y a plus le m√©canisme de transformation habituel. </p><br><div class="spoiler">  <b class="spoiler_title">Que nous dit google?</b> <div class="spoiler_text"><p>  Le r√©sultat de recherche pour "Transformer en ASP.NET Core" sur <em>google a</em> donn√© le code suivant: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {  Environment = environment;  Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"appsettings.json"</span></span>) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  Dans le constructeur de la classe <em>Startup</em> , nous cr√©ons un objet de configuration √† l'aide de <em>ConfigurationBuilder</em> .  Dans ce cas, nous indiquons explicitement les sources de configuration que nous voulons utiliser. </p><br><p>  Et tels: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {  Environment = environment;  Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  Selon la variable d'environnement, l'une ou l'autre source de configuration est s√©lectionn√©e. </p></div></div><br><p>  Ces r√©ponses se trouvent souvent sur <abbr title="Stackoverflow">SO</abbr> et d'autres ressources moins populaires.  Mais le sentiment n'est pas parti.  que nous allons mal.  Que faire si je souhaite utiliser des variables d'environnement ou des arguments de ligne de commande dans la configuration?  Pourquoi dois-je √©crire ce code dans chaque projet? </p><br><p>  √Ä la recherche de la v√©rit√©, j'ai d√ª approfondir la documentation et le code source.  Et je veux partager les connaissances acquises dans cet article. </p><br><p>  Voyons comment fonctionne la configuration dans .NET Core. </p><br><h2 id="konfiguraciya">  La configuration </h2><br><p>  La configuration dans .NET Core est repr√©sent√©e par un <em>objet d'</em> interface <em>IConfiguration</em> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConfiguration</span></span> {  <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> key] { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }  <span class="hljs-function"><span class="hljs-function">IConfigurationSection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key</span></span></span><span class="hljs-function">)</span></span>;  <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;IConfigurationSection&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;  <span class="hljs-function"><span class="hljs-function">IChangeToken </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetReloadToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br><ul><li>  indexeur <strong>[cl√© de cha√Æne]</strong> , qui permet d'obtenir la valeur du param√®tre de configuration par cl√© </li><li>  <strong>GetSection (cha√Æne cl√©)</strong> renvoie la section de configuration qui correspond √† la cl√© <em>cl√©</em> </li><li>  <strong>GetChildren ()</strong> renvoie un ensemble de sous-sections de la section de configuration actuelle </li><li>  <strong>GetReloadToken ()</strong> renvoie une instance de <em>IChangeToken</em> qui peut √™tre utilis√©e pour recevoir des notifications lorsque la configuration change </li></ul><br><p>  Une configuration est une collection de paires cl√©-valeur.  Lors de la lecture √† partir d'une source de configuration (fichier, variables d'environnement), les donn√©es hi√©rarchiques sont r√©duites √† une structure plate.  Par exemple, <em>json est un</em> objet de la forme </p><br><pre> <code class="plaintext hljs">{ "Settings": { "Key": "I am options" } }</code> </pre> <br><p>  sera r√©duite √† une vue √† plat: </p><br><pre> <code class="plaintext hljs">Settings:Key = I am options</code> </pre> <br><p>  Ici, la cl√© est <em>Param√®tres: Cl√©</em> et la valeur est <em>Je suis des options</em> . <br>  Les fournisseurs de configuration sont utilis√©s pour remplir la configuration. </p><br><h2 id="provaydery-konfiguracii">  Fournisseurs de configuration </h2><br><p>  Un objet d'interface est responsable de la lecture des donn√©es de la source de configuration. <br>  <em>IConfigurationProvider</em> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConfigurationProvider</span></span> {  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TryGet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span>;  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span>;  <span class="hljs-function"><span class="hljs-function">IChangeToken </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetReloadToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;  <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetChildKeys</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; earlierKeys, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parentPath</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><ul><li>  <strong>TryGet (string key, out string value)</strong> permet d'obtenir la valeur du param√®tre de configuration par cl√© </li><li>  <strong>Set (cl√© de cha√Æne, valeur de cha√Æne) est</strong> utilis√© pour d√©finir la valeur du param√®tre de configuration </li><li>  <strong>GetReloadToken ()</strong> renvoie une instance de <em>IChangeToken</em> qui peut √™tre utilis√©e pour recevoir des notifications lorsqu'une source de configuration change </li><li>  M√©thode <strong>Load ()</strong> qui est responsable de la lecture de la source de configuration </li><li>  <strong>GetChildKeys (IEnumerable &lt;string&gt; earlyKeys, string parentPath)</strong> vous permet d'obtenir une liste de toutes les cl√©s fournies par ce fournisseur de configuration </li></ul><br><p>  Les fournisseurs suivants sont disponibles dans la bo√Æte: </p><br><ul><li>  Json </li><li>  Ini </li><li>  Xml </li><li>  Variables d'environnement </li><li>  Inmemory </li><li>  Azure </li><li>  Fournisseur de configuration personnalis√© </li></ul><br><p>  Les conventions suivantes pour l'utilisation des fournisseurs de configuration sont accept√©es. </p><br><ol><li>  Les sources de configuration sont lues dans l'ordre dans lequel elles ont √©t√© sp√©cifi√©es. </li><li>  Si les m√™mes cl√©s sont pr√©sentes dans diff√©rentes sources de configuration (la comparaison n'est pas sensible √† la casse), la derni√®re valeur ajout√©e est utilis√©e. </li></ol><br><p>  Si nous cr√©ons une instance d'un serveur <em>Web √†</em> l'aide de <em>CreateDefaultBuilder</em> , les fournisseurs de configuration suivants sont connect√©s par d√©faut: </p><br><p><img src="https://habrastorage.org/webt/pq/0l/5q/pq0l5qp3qultg9xhtg1kvpimj_y.png"></p><br><ul><li>  <strong>ChainedConfigurationProvider</strong> via ce fournisseur, vous pouvez obtenir des valeurs et des cl√©s de configuration qui ont √©t√© ajout√©es par d'autres fournisseurs de configuration </li><li>  <strong>JsonConfigurationProvider</strong> utilise des fichiers <em>json</em> comme source de configuration.  Comme vous pouvez le voir, trois fournisseurs de ce type sont ajout√©s √† la liste des fournisseurs.  Le premier utilise <em>appsettings.json</em> comme source, le second <em>utilise appsettings. {Environment} .json</em> .  Le troisi√®me lit les donn√©es de <em>secrets.json</em> .  Si vous g√©n√©rez l'application dans la configuration <em>Release</em> , le troisi√®me fournisseur ne sera pas connect√©, car il n'est pas recommand√© d'utiliser des secrets dans l'environnement de <em>production</em> </li><li>  <strong>EnvironmentVariablesConfigurationProvider</strong> r√©cup√®re les param√®tres de configuration des variables d'environnement </li><li>  <strong>CommandLineConfigurationProvider</strong> permet d'ajouter des arguments de ligne de commande √† la configuration </li></ul><br><p>  La configuration √©tant stock√©e sous forme de dictionnaire, il est n√©cessaire de s'assurer que les cl√©s sont uniques.  Par d√©faut, cela fonctionne comme ceci. </p><br><p>  Si le fournisseur <em>CommandLineConfigurationProvider</em> a un √©l√©ment avec la cl√© key et que le fournisseur <em>JsonConfigurationProvider</em> a un √©l√©ment avec la cl√© key, l'√©l√©ment de <em>JsonConfigurationProvider</em> sera remplac√© par l'√©l√©ment de <em>CommandLineConfigurationProvider</em> car il est enregistr√© en dernier et a une priorit√© plus √©lev√©e. </p><br><div class="spoiler">  <b class="spoiler_title">Rappelons un exemple du d√©but de l'article</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IConfiguration Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IHostingEnvironment Environment { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfiguration configuration, IHostingEnvironment environment</span></span></span><span class="hljs-function">)</span></span> {  Environment = environment;  Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationBuilder() .AddJsonFile(<span class="hljs-string"><span class="hljs-string">"appsettings.json"</span></span>) .AddJsonFile(<span class="hljs-string"><span class="hljs-string">$"appsettings.</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{Environment.EnvironmentName}</span></span></span><span class="hljs-string">.json"</span></span>) .Build(); }</code> </pre> <br><p>  Nous n'avons pas besoin de cr√©er <em>IConfiguration nous-m√™mes</em> afin de transformer les fichiers de configuration, car cela est activ√© par d√©faut.  Cette approche est n√©cessaire lorsque l'on veut limiter le nombre de sources de configuration. </p></div></div><br><h2 id="kastomnyy-provayder-konfiguracii">  Fournisseur de configuration personnalis√© </h2><br><p>  Pour √©crire votre fournisseur de configuration, vous devez impl√©menter les <em>interfaces</em> <em>IConfigurationProvider</em> et <em>IConfigurationSource</em> .  <em>IConfigurationSource est une</em> nouvelle interface que nous n'avons pas encore consid√©r√©e dans cet article. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConfigurationSource</span></span> { <span class="hljs-function"><span class="hljs-function">IConfigurationProvider </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationBuilder builder</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><p>  L'interface consiste en une seule m√©thode <em>Build</em> qui prend <em>IConfigurationBuilder</em> comme param√®tre et renvoie une nouvelle instance de <em>IConfigurationProvider</em> . </p><br><p>  Pour impl√©menter nos fournisseurs de configuration, les classes abstraites <em>ConfigurationProvider</em> et <em>FileConfigurationProvider</em> sont √† notre disposition.  Dans ces classes, la logique des <em>m√©thodes TryGet</em> , <em>Set</em> , <em>GetReloadToken</em> , <em>GetChildKeys</em> est d√©j√† impl√©ment√©e et il reste √† impl√©menter uniquement la m√©thode <em>Load</em> . </p><br><p>  Regardons un exemple.  Il est n√©cessaire d'impl√©menter la lecture de la configuration √† partir du fichier <em>yaml</em> , et il est √©galement n√©cessaire que nous puissions changer la configuration sans red√©marrer notre application. </p><br><p>  Cr√©ez la classe <em>YamlConfigurationProvider</em> et faites-en l'h√©ritier de <em>FileConfigurationProvider</em> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationProvider</span></span> : <span class="hljs-title"><span class="hljs-title">FileConfigurationProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _filePath; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YamlConfigurationProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FileConfigurationSource source</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream stream</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } }</code> </pre> <br><p>  Dans l'extrait de code ci-dessus, vous pouvez remarquer certaines fonctionnalit√©s de la classe <em>FileConfigurationProvider</em> .  Le constructeur accepte une instance de <em>FileConfigurationSource</em> , qui contient le <em>IFileProvider</em> .  <em>IFileProvider est</em> utilis√© pour lire un fichier et pour s'abonner √† un √©v√©nement de modification de fichier.  Vous pouvez √©galement remarquer que la m√©thode <em>Load</em> accepte un <em>flux</em> dans lequel le fichier de configuration est ouvert en lecture.  Il s'agit d'une m√©thode de la classe <em>FileConfigurationProvider</em> et ne se trouve pas dans l'interface <em>IConfigurationProvider</em> . </p><br><p>  Ajoutez une impl√©mentation simple qui nous permet de lire le fichier <em>yaml</em> .  Pour lire le fichier, je vais utiliser le package <em>YamlDotNet</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Impl√©mentation de YamlConfigurationProvider</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationProvider</span></span> : <span class="hljs-title"><span class="hljs-title">FileConfigurationProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _filePath; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YamlConfigurationProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FileConfigurationSource source</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream stream</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stream.CanSeek) { stream.Seek(<span class="hljs-number"><span class="hljs-number">0L</span></span>, SeekOrigin.Begin); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StreamReader streamReader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(stream)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileContent = streamReader.ReadToEnd(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> yamlObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DeserializerBuilder() .Build() .Deserialize(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringReader(fileContent)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;; Data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> yamlObject) { FillData(String.Empty, pair); } } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> prefix, KeyValuePair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; pair</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = String.IsNullOrEmpty(prefix) ? pair.Key.ToString() : <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{prefix}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{pair.Key}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (pair.Value) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: Data.Add(key, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; section: { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sectionPair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> section) FillData(pair.Key.ToString(), sectionPair); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } }</code> </pre> </div></div><br><p>  Pour cr√©er une instance de notre fournisseur de configuration, vous devez impl√©menter <em>FileConfigurationSource</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Impl√©mentation de YamlConfigurationSource</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationSource</span></span> : <span class="hljs-title"><span class="hljs-title">FileConfigurationSource</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YamlConfigurationSource</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { Path = fileName; ReloadOnChange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IConfigurationProvider </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationBuilder builder</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.EnsureDefaults(builder); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YamlConfigurationProvider(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><p>  Il est important de noter ici que pour initialiser les propri√©t√©s de la classe de base, vous devez appeler la <em>m√©thode this.EnsureDefaults (builder)</em> . </p></div></div><br><p>  Pour enregistrer un fournisseur de configuration personnalis√© dans l'application, vous devez ajouter l'instance de fournisseur √† <em>IConfigurationBuilder</em> .  Vous pouvez appeler la m√©thode <em>Add</em> depuis <em>IConfigurationBuilder</em> , mais je <em>mettrai</em> imm√©diatement <em>la logique d'</em> initialisation <em>YamlConfigurationProvider</em> dans la m√©thode d' <em>extension</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Impl√©menter YamlConfigurationExtensions</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">YamlConfigurationExtensions</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IConfigurationBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddYaml</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IConfigurationBuilder builder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filePath</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (builder == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(builder)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(filePath)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(filePath)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> builder .Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YamlConfigurationSource(filePath)); } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Appelez la m√©thode AddYaml</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { CreateWebHostBuilder(args).Build().Run(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IWebHostBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateWebHostBuilder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> =&gt; WebHost.CreateDefaultBuilder(args) .ConfigureAppConfiguration((context, builder) =&gt; { builder.AddYaml(<span class="hljs-string"><span class="hljs-string">"appsettings.yaml"</span></span>); }) .UseStartup&lt;Startup&gt;(); }</code> </pre> </div></div><br><h2 id="otslezhivanie-izmeneniy">  Suivi des modifications </h2><br><p>  Dans la nouvelle configuration de l' <em>API</em> , il est devenu possible de relire la source de configuration lorsqu'elle est modifi√©e.  En m√™me temps, l'application ne red√©marre pas. <br>  Comment √ßa marche: </p><br><ul><li>  Le fournisseur de configuration surveille les modifications de la source de configuration </li><li>  Si un changement de configuration se produit, un nouveau <em>IChangeToken</em> est cr√©√© <em>.</em> </li><li>  Lorsque <em>IChangeToken</em> est <em>modifi√©</em> , un rechargement de configuration est appel√© </li></ul><br><p>  Voyons comment le suivi des modifications est impl√©ment√© dans <em>FileConfigurationProvider</em> . </p><br><pre> <code class="cs hljs">ChangeToken.OnChange( <span class="hljs-comment"><span class="hljs-comment">//producer () =&gt; Source.FileProvider.Watch(Source.Path), //consumer () =&gt; { Thread.Sleep(Source.ReloadDelay); Load(reload: true); });</span></span></code> </pre> <br><p>  Deux param√®tres sont transmis √† la m√©thode <em>OnChange</em> de la classe statique <em>ChangeToken</em> .  Le premier param√®tre est une fonction qui renvoie un nouveau <em>IChangeToken</em> lorsque la source de configuration (dans ce cas, le fichier) change, il s'agit du soi-disant <em>producteur</em> .  Le deuxi√®me param√®tre est la fonction de <em>rappel</em> (ou <em>consommateur</em> ), qui sera appel√©e lorsque la source de configuration est modifi√©e. <br>  En savoir plus sur la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ChangeToken</a> . </p><br><p>  Tous les fournisseurs de configuration n'impl√©mentent pas le suivi des modifications.  Ce m√©canisme est disponible pour les descendants de <em>FileConfigurationProvider</em> et <em>AzureKeyVaultConfigurationProvider</em> . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Dans .NET Core, nous avons un m√©canisme simple et pratique pour g√©rer les param√®tres des applications.  De nombreux modules compl√©mentaires sont disponibles pr√™ts √† l'emploi, de nombreuses choses sont utilis√©es par d√©faut. <br>  Bien s√ªr, chaque personne d√©cide de la fa√ßon de l'utiliser, mais je suis pour le fait que les gens connaissent leurs outils. </p><br><p>  Cet article ne couvre que les bases.  En plus des bases, les IOptions, les scripts de post-configuration, la validation des param√®tres et bien plus sont √† notre disposition.  Mais c'est une autre histoire. </p><br><p>  Vous pouvez trouver le projet d'application avec des exemples de cet article dans le r√©f√©rentiel sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Github</a> . <br>  Partagez dans les commentaires qui utilise quelles approches de gestion de la configuration? <br>  Merci de votre attention. </p><br><p>  <strong>upd</strong> .: Comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">AdAbsurdum l'a</a> correctement sugg√©r√©, lorsque vous travaillez avec des tableaux, les √©l√©ments ne seront pas toujours remplac√©s lors de la fusion d'une configuration √† partir de deux sources. <br>  Prenons un exemple.  Lors de la lecture d'un tableau depuis <em>appsettings.json,</em> nous obtenons cette vue plate: </p><br><pre> <code class="plaintext hljs">array:0=valueA</code> </pre> <br><p>  Lors de la lecture √† partir de <em>appsettings.Development.json</em> : </p><br><pre> <code class="plaintext hljs">array:0=valueB array:1=value</code> </pre> <br><p>  En cons√©quence, la configuration sera: </p><br><pre> <code class="plaintext hljs">array:0=valueB array:1=value</code> </pre> <br><p>  Tous les √©l√©ments avec des indices uniques ( <em>tableau: 1</em> dans l'exemple) seront ajout√©s au tableau r√©sultant.  Les √©l√©ments provenant de diff√©rentes sources de configuration, mais ayant le m√™me index ( <em>tableau: 0</em> dans l'exemple) seront fusionn√©s et l'√©l√©ment qui a √©t√© ajout√© en dernier sera utilis√©. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr453416/">https://habr.com/ru/post/fr453416/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453406/index.html">Batteries modernes pour lecteurs Sony Discman</a></li>
<li><a href="../fr453408/index.html">Bo√Æte √† outils pour les chercheurs - Deuxi√®me √©dition: une collection de 15 banques de donn√©es th√©matiques</a></li>
<li><a href="../fr453410/index.html">Ne jetez pas d'ampoules intelligentes √† la poubelle, ou le danger de l'IoT</a></li>
<li><a href="../fr453412/index.html">Top 3D Shop devient le distributeur exclusif d'UFactory</a></li>
<li><a href="../fr453414/index.html">L'essor et la chute d'IEO, tout ce que vous devez savoir sur la nouvelle vague de collecte de fonds</a></li>
<li><a href="../fr453418/index.html">Ce que vous devez savoir avant de passer √† la bo√Æte √† outils Akka pour impl√©menter Event Sourcing et CQRS</a></li>
<li><a href="../fr453422/index.html">Connaissance de l'ITSM: 10 habratopiks et mat√©riaux experts pour une ¬´immersion rapide¬ª dans le sujet</a></li>
<li><a href="../fr453428/index.html">Am√©lioration de la lisibilit√© du code dans le d√©veloppement iOS</a></li>
<li><a href="../fr453430/index.html">Au moment o√π j'√©crivais mon suivi</a></li>
<li><a href="../fr453432/index.html">De la critique aux algorithmes: la voix qui s'estompe des √©lites dans le monde de la musique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>