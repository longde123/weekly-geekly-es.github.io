<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïù üë©üèΩ‚Äç‚úàÔ∏è üëäüèø Utilisation de Golang pour cr√©er des microservices dans The Economist: A Retrospective üßëüèø‚Äçü§ù‚Äçüßëüèø ‚õëÔ∏è üë®üèΩ‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! D√©j√† le 28 mai, nous lan√ßons le premier groupe au cours de d√©veloppeur de Golang . Et aujourd'hui, nous partageons avec vous la premi√®...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Utilisation de Golang pour cr√©er des microservices dans The Economist: A Retrospective</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/451760/">  Bonjour √† tous!  D√©j√† le 28 mai, nous lan√ßons le premier groupe au cours de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©veloppeur de Golang</a> .  Et aujourd'hui, nous partageons avec vous la premi√®re publication consacr√©e au lancement de ce cours.  Allons-y. <br><br><img src="https://habrastorage.org/webt/3r/wa/jy/3rwajyps3se5vmahtiv_ioninq0.png"><br><br>  <b>Extraits cl√©s</b> <br><br><ul><li>  The Economist avait besoin de plus de flexibilit√© pour distribuer du contenu sur une cha√Æne num√©rique de plus en plus diversifi√©e.  Pour atteindre cet objectif et maintenir un haut niveau de performances et de fiabilit√©, la plateforme est pass√©e d'une architecture monolithique √† une architecture de microservices. </li><li>  Les outils √©crits en Go √©taient un √©l√©ment cl√© du nouveau syst√®me, qui a permis √† The Economist de fournir des services √©volutifs et performants et de cr√©er rapidement de nouveaux produits. </li><li>  Go, destin√© √† la prise en charge simultan√©e et √† l'API, ainsi qu'√† sa construction d'un langage compil√© statique, a facilit√© le d√©veloppement de syst√®mes de traitement d'√©v√©nements distribu√©s qui pouvaient √©voluer.  Le support des tests √©tait √©galement un plus. </li><li>  En g√©n√©ral, l'exp√©rience de l'√©quipe The Economist avec Go a √©t√© positive, et cela a √©t√© l'un des facteurs d√©cisifs qui ont aid√© √† faire √©voluer la plateforme de contenu. </li><li>  Go ne sera pas toujours un outil appropri√©, et c'est normal.  The Economist a une plate-forme polyglotte et utilise diff√©rents langages lorsque cela a du sens. </li></ul><a name="habracut"></a><br>  J'ai rejoint <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'</a> √©quipe de d√©veloppement de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Economist en</a> tant que d√©veloppeur Drupal.  Cependant, ma v√©ritable t√¢che √©tait de participer √† un projet qui changerait fondamentalement la technologie de diffusion de contenu Economist.  Les premiers mois, j'ai pass√© √† apprendre le Go, plusieurs mois √† travailler avec un consultant externe pour cr√©er un MVP (produit minimum viable), puis j'ai rejoint l'√©quipe √† nouveau pour superviser leur immersion dans le Go. <br>  Ce changement technologique a √©t√© d√©clench√© par la mission de The Economist d'√©largir son audience num√©rique, alors que la consommation de nouvelles s'est √©loign√©e de la presse √©crite.  The Economist avait besoin de plus de flexibilit√© pour fournir du contenu √† des canaux num√©riques de plus en plus diversifi√©s.  Pour atteindre cet objectif et maintenir un haut niveau de performances et de fiabilit√©, la plateforme est pass√©e d'une architecture monolithique √† une architecture de microservices.  Les outils √©crits en Go √©taient un √©l√©ment cl√© du nouveau syst√®me, qui a permis √† The Economist de fournir des services √©volutifs et performants et de cr√©er rapidement de nouveaux produits. <br><br>  Impl√©mentation de Go dans The Economist: <br><br><ul><li>  Permis aux ing√©nieurs de d√©velopper et de mettre en ≈ìuvre rapidement de nouvelles fonctionnalit√©s. </li><li>  Meilleures pratiques approuv√©es pour les services √† d√©faillance rapide avec gestion intelligente des erreurs. </li><li>  Prise en charge fiable de la simultan√©it√© et du fonctionnement du r√©seau dans un syst√®me distribu√©. </li><li>  Il a montr√© un manque de maturit√© et de soutien dans certains domaines n√©cessaires pour le contenu et les m√©dias. </li><li>  Facilitation d'une plate-forme pouvant √©voluer pour la publication num√©rique. </li></ul><br>  <b>Pourquoi The Economist a-t-il choisi Go?</b> <br><br>  Pour r√©pondre √† cette question, il sera utile de mettre en √©vidence l'architecture globale de la nouvelle plateforme.  La plateforme, appel√©e Content Platform, est un syst√®me de gestion d'√©v√©nements.  Il r√©pond aux √©v√©nements de diff√©rentes plates-formes de cr√©ation de contenu et lance un flux de processus ex√©cut√©s dans des microservices fonctionnant s√©par√©ment.  Ces services remplissent des fonctions telles que la standardisation des donn√©es, l'analyse des balises s√©mantiques, l'indexation dans ElasticSearch et l'envoi de contenu vers des plateformes externes telles qu'Apple News ou Facebook.  La plate-forme dispose √©galement d'une API RESTful, qui en combinaison avec GraphQL est le principal point d'entr√©e pour les clients et produits frontaux. <br><br>  En d√©veloppant une architecture commune, l'√©quipe a recherch√© quelles langues r√©pondraient aux besoins de la plateforme.  Go a √©t√© compar√© √† Python, Ruby, Node, PHP et Java.  Bien que chaque langue ait ses propres atouts, Go est le mieux adapt√© √† l'architecture de la plate-forme.  Go, destin√© √† la prise en charge simultan√©e et √† l'API, ainsi qu'√† sa construction d'un langage compil√© statique, a facilit√© le d√©veloppement de syst√®mes de traitement d'√©v√©nements distribu√©s qui pouvaient √©voluer.  De plus, la syntaxe relativement simple de Go a permis de s'impliquer facilement dans le d√©veloppement et de commencer √† √©crire du code de travail, ce qui a promis des avantages imm√©diats pour une √©quipe en pleine transition technologique.  En g√©n√©ral, il a √©t√© d√©termin√© que Go est le langage le plus appropri√© pour la convivialit√© et l'efficacit√© dans un syst√®me cloud distribu√©. <br><br>  <b>Trois ans plus tard: Go correspondait-il √† ces objectifs ambitieux?</b> <br><br>  Certains √©l√©ments de conception de la plateforme √©taient bien align√©s sur le langage Go.  Failing Fast √©tait un √©l√©ment essentiel du syst√®me car il consistait en des services ind√©pendants distribu√©s.  Conform√©ment aux principes de l'application √† douze facteurs ("application √† 12 facteurs"), l'application devait d√©marrer rapidement et √©chouer rapidement (√©chec rapide).  La conception de Go en tant que langage compil√© statique fournit des temps de d√©marrage rapides et les performances du compilateur s'am√©liorent constamment et n'ont jamais √©t√© un probl√®me pour la conception ou le d√©ploiement.  De plus, la conception de gestion des erreurs de Go a permis aux applications de tomber en panne non seulement plus rapidement, mais aussi plus intelligemment. <br><br>  <b>Gestion des erreurs</b> <br><br>  Une caract√©ristique que les ing√©nieurs remarquent rapidement dans Go est qu'il s'agit d'un type d'erreur plut√¥t que d'un syst√®me d'exception.  Dans Go, toutes les erreurs sont des valeurs.  Le type d'erreur est pr√©d√©fini et est une interface.  Une interface dans Go est essentiellement une collection nomm√©e de m√©thodes, et tout autre type d'utilisateur peut satisfaire une interface si elle a les m√™mes m√©thodes.  Le type d'erreur est une interface qui peut se d√©crire comme une cha√Æne. <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> error <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Error() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> }</code> </pre> <br>  Cela donne aux ing√©nieurs plus de contr√¥le et de fonctionnalit√©s dans la gestion des erreurs.  En ajoutant une m√©thode Error qui renvoie une cha√Æne dans n'importe quel module utilisateur, vous pouvez cr√©er vos propres erreurs et les g√©n√©rer, par exemple, en utilisant la fonction Nouveau ci-dessous, qui provient du package Errors. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> errorString <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { s <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e *errorString)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> es }</code> </pre> <br>  Qu'est-ce que cela signifie dans la pratique?  Dans Go, les fonctions autorisent plusieurs valeurs de retour, donc si votre fonction ne fonctionne pas, elle renverra tr√®s probablement une valeur d'erreur.  Le langage vous encourage √† v√©rifier explicitement les erreurs l√† o√π elles se produisent (par opposition √† lever et intercepter une exception), donc votre code devrait g√©n√©ralement inclure une v√©rification ¬´si err!  = N√©ant. "  Au d√©but, cette gestion fr√©quente des erreurs peut sembler monotone.  Cependant, error en tant que valeur vous permet d'utiliser Error pour simplifier la gestion des erreurs.  Par exemple, dans un syst√®me distribu√©, vous pouvez facilement impl√©menter des tentatives de nouvelle tentative de requ√™tes en encapsulant des erreurs. <br><br>  Des probl√®mes de r√©seau se produiront toujours dans le syst√®me, qu'il s'agisse d'envoyer des donn√©es √† d'autres services internes ou de les transf√©rer vers des outils tiers.  Cet exemple de paquet net montre comment vous pouvez utiliser l'erreur comme type pour distinguer les erreurs r√©seau temporaires des erreurs permanentes.  L'√©quipe Economist a utilis√© un wrapper d'erreur similaire pour cr√©er des tentatives incr√©mentielles lors de l'envoi de contenu √† des API externes. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> net <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Error <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { error Timeout() <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-comment"><span class="hljs-comment">// Is the error a timeout? Temporary() bool // Is the error temporary? } if nerr, ok := err.(net.Error); ok &amp;&amp; nerr.Temporary() { time.Sleep(1e9) continue } if err != nil { log.Fatal(err) }</span></span></code> </pre> <br>  Les auteurs de Go croient que toutes les exceptions ne sont pas exceptionnelles.  Les ing√©nieurs sont plus susceptibles de r√©cup√©rer intelligemment des erreurs que de planter l'application.  De plus, la gestion des erreurs Go vous permet de mieux contr√¥ler les erreurs, ce qui peut am√©liorer des aspects tels que le d√©bogage ou la convivialit√© des erreurs.  Au sein de la plateforme de contenu, cette fonctionnalit√© de conception de Go a permis aux d√©veloppeurs de prendre des d√©cisions √©clair√©es concernant les erreurs, ce qui a entra√Æn√© une augmentation de la fiabilit√© du syst√®me dans son ensemble. <br><br>  <b>Coh√©rence des donn√©es</b> <br><br>  La coh√©rence des donn√©es est un facteur critique dans la plateforme de contenu.  Chez The Economist, le contenu est le fondement de l'entreprise et l'objectif de la plateforme de contenu est de garantir que le contenu peut √™tre publi√© une fois et est disponible partout.  Par cons√©quent, il est important que chaque produit et consommateur ait une coh√©rence des donn√©es avec l'API Content Platform.  Les produits utilisent principalement GraphQL pour les requ√™tes API, ce qui n√©cessite un sch√©ma statique, qui sert de sorte de contrat entre les consommateurs et la plateforme.  Le contenu trait√© par la plateforme doit √™tre conforme √† ce sch√©ma.  Le langage statique a aid√© √† l'impl√©menter et a facilit√© la coh√©rence des donn√©es. <br><br>  <b>Tester avec Go</b> <br><br>  Une autre fonctionnalit√© qui favorise la coh√©rence est la suite de tests Go.  Le temps de compilation rapide de Go, combin√© √† des tests de premi√®re classe en tant que caract√©ristique du langage, a permis √† l'√©quipe d'incorporer des m√©thodes de test efficaces dans les workflows de conception et des d√©faillances rapides dans les pipelines d'assemblage.  Les outils de test de Go facilitent la configuration et l'ex√©cution.  L'ex√©cution de ¬´go test¬ª ex√©cutera tous les tests dans le r√©pertoire courant et la commande test a plusieurs indicateurs utiles.  L'indicateur de couverture fournit un rapport de couverture de code d√©taill√©.  Le test de banc ex√©cute des tests de r√©f√©rence, qui sont indiqu√©s en ex√©cutant le nom de la fonction de test avec le mot ¬´banc¬ª plut√¥t que ¬´test¬ª.  La fonction TestMain fournit des m√©thodes pour une configuration de test suppl√©mentaire, comme un serveur d'authentification factice. <br><br>  De plus, Go a la possibilit√© de cr√©er des tests tabulaires avec des structures anonymes et des stubs avec des interfaces, am√©liorant la couverture des tests.  Bien que les tests ne soient pas nouveaux en termes de fonctionnalit√©s linguistiques, Go facilite la cr√©ation de tests robustes et leur int√©gration ais√©e dans les workflows.  D√®s le d√©but, les ing√©nieurs de The Economist ont pu ex√©cuter des tests dans le cadre des pipelines d'assemblage sans configuration sp√©ciale, et ont m√™me ajout√© Git Hooks pour ex√©cuter des tests avant de pousser le code dans Github. <br><br>  Cependant, le projet n'a pas √©t√© sans effort pour assurer la coh√©rence des donn√©es.  Le premier probl√®me majeur pour la plateforme √©tait la gestion de contenu dynamique √† partir de backends impr√©visibles.  La plate-forme consomme le contenu des syst√®mes CMS d'origine principalement via des points de terminaison JSON, o√π la structure et les types de donn√©es ne sont pas garantis.  Cela signifie que la plate-forme ne peut pas utiliser le package Go standard pour interpr√©ter json, qui prend en charge la d√©s√©rialisation JSON en structures, mais cela d√©clenche une alarme si les types des champs de donn√©es de structure et d'entr√©e ne correspondent pas. <br><br>  Pour surmonter ce probl√®me, une m√©thode sp√©ciale √©tait n√©cessaire pour mapper la partie serveur au format standard.  Apr√®s plusieurs it√©rations de l'approche choisie, l'√©quipe a introduit son propre processus de d√©s√©rialisation.  Bien que cette approche ressemble un peu √† la refonte d'un package de biblioth√®que standard, elle a donn√© aux ing√©nieurs un contr√¥le complet sur le traitement des donn√©es source. <br><br>  <b>Support r√©seau</b> <br><br>  L'√©volutivit√© √©tait au premier plan de la nouvelle plate-forme, et cela a √©t√© fourni par les biblioth√®ques Go standard pour la mise en r√©seau et les API.  Dans Go, vous pouvez rapidement impl√©menter des points de terminaison HTTP √©volutifs sans avoir besoin de frameworks.  Dans l'exemple ci-dessous, le package de biblioth√®que standard net / http est utilis√© pour configurer un gestionnaire qui accepte un r√©dacteur de demandes et de r√©ponses.  Lorsque l'API Content Platform a √©t√© impl√©ment√©e pour la premi√®re fois, elle utilisait le framework API.  Elle a finalement √©t√© remplac√©e par une biblioth√®que standard, car l'√©quipe a reconnu qu'elle r√©pond √† tous les besoins de leur r√©seau sans compromis suppl√©mentaires inutiles.  Les gestionnaires HTTP Golang √©voluent parce que chaque demande au gestionnaire est ex√©cut√©e en parall√®le dans Goroutine, un thread l√©ger sans besoin de personnalisation. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, handler) log.Fatal(http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) }</code> </pre> <br>  <b>Mod√®le de simultan√©it√©</b> <br><br>  Le mod√®le d'acc√®s simultan√© Go a fourni de multiples avantages en am√©liorant les performances sur la plate-forme.  Travailler avec des donn√©es distribu√©es implique de s'occuper des garanties promises aux consommateurs.  Selon le th√©or√®me de CAP, il n'est pas possible de fournir plus de deux des trois garanties suivantes en m√™me temps: Coh√©rence des donn√©es.  La disponibilit√©  R√©sistant √† la s√©paration.  Dans la plateforme The Economist, la coh√©rence a finalement √©t√© adopt√©e, ce qui signifie que la lecture √† partir des sources de donn√©es sera finalement coh√©rente, et des retards mod√©r√©s dans toutes les sources de donn√©es atteignant un √©tat coh√©rent sont acceptables.  Une fa√ßon de minimiser cet √©cart est d'utiliser les Goroutines. <br><br>  Les goroutines sont des threads l√©gers g√©r√©s par le runtime Go pour les emp√™cher de manquer de threads.  Les goroutines ont permis d'optimiser les t√¢ches asynchrones sur la plateforme.  Par exemple, l'un des r√©f√©rentiels de donn√©es de la plate-forme est Elasticsearch.  Lorsque le contenu est mis √† jour sur le syst√®me, le contenu qui fait r√©f√©rence √† cet √©l√©ment dans Elasticsearch est mis √† jour et r√©index√©.  Gr√¢ce √† la mise en ≈ìuvre de Goroutines, le temps de traitement a √©t√© r√©duit, ce qui a assur√© une coh√©rence rapide des √©l√©ments.  Cet exemple montre comment les √©l√©ments adapt√©s au retraitement sont retrait√©s dans Goroutine. <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reprocess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(searchResult *http.Response)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { responses := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>([]response, <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(searchResult.Hits)) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wg sync.WaitGroup wg.Add(<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(responses)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, hit := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> searchResult.Hits { wg.Add(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, item elastic.SearchHit)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> wg.Done() code, err := reprocessItem(item) responses[i].code = code responses[i].err = err }(i, *hit) } wg.Wait <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.StatusOK, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  La conception de syst√®mes ne se limite pas √† la programmation.  Les ing√©nieurs doivent comprendre quels outils, o√π et quand, sont appropri√©s.  Alors que Go √©tait un outil puissant pour la plupart des besoins de la plateforme de contenu de The Economist, certaines limitations n√©cessitaient d'autres solutions. <br><br>  <b>Gestion des d√©pendances</b> <br><br>  Lorsque Go vient de sortir, il ne disposait pas d'un syst√®me de gestion des d√©pendances.  Au sein de la communaut√©, plusieurs outils ont √©t√© d√©velopp√©s pour r√©pondre √† ce besoin.  The Economist a utilis√© les sous-modules Git, ce qui √©tait logique √† un moment o√π la communaut√© faisait activement la promotion d'un outil standard de gestion des d√©pendances.  Aujourd'hui, bien que la communaut√© soit d√©j√† beaucoup plus proche d'une approche coh√©rente de la gestion de la d√©pendance, elle n'est pas l√†.  L'approche The Economist utilisant des sous-modules n'a pas pos√© de probl√®mes s√©rieux, mais elle a √©t√© difficile pour les autres d√©veloppeurs de Go, et cela doit √™tre pris en compte lors du passage √† Go. <br><br>  Il y avait √©galement des exigences de plate-forme pour lesquelles les fonctionnalit√©s ou la conception de Go n'√©taient pas la meilleure solution.  √âtant donn√© que la plate-forme a ajout√© la prise en charge du traitement audio, les outils de Go pour l'extraction des m√©tadonn√©es √©taient limit√©s √† l'√©poque, et l'√©quipe a donc choisi Exiftool Python √† la place.  Les services de plateforme fonctionnent dans des conteneurs Docker, ce qui a permis d'installer Exiftool et de le lancer √† partir de l'application Go. <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runExif</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { cmdOut, err := exec.Command(<span class="hljs-string"><span class="hljs-string">"exiftool"</span></span>, args...).Output() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmdOut, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  Un autre sc√©nario courant pour la plate-forme est la r√©ception de code HTML non fonctionnel √† partir des syst√®mes CMS source, l'analyse du code HTML pour l'exactitude et l'assainissement du code HTML.  Initialement, Go √©tait utilis√© pour ce processus, mais comme la biblioth√®que HTML standard de Go n√©cessite un code HTML correct, il a fallu une grande quantit√© de code personnalis√© pour analyser le HTML avant le traitement.  Ce code est rapidement devenu fragile et a manqu√© des cas limites, donc une nouvelle solution a √©t√© impl√©ment√©e en Javascript.  Javascript a fourni une grande flexibilit√© et adaptabilit√© pour contr√¥ler le processus de v√©rification et de d√©sinfection du HTML. <br><br>  Javascript a √©galement √©t√© un choix courant pour filtrer et router les √©v√©nements dans la plate-forme.  Les √©v√©nements sont filtr√©s √† l'aide d'AWS Lambdas, qui sont des fonctions l√©g√®res qui ne s'ex√©cutent que lorsqu'elles sont appel√©es.  Un cas d'utilisation est le filtrage des √©v√©nements sur diff√©rentes bandes, telles que rapides et lentes.  Ce filtrage est bas√© sur un seul champ de m√©tadonn√©es dans l'objet JSON du shell du gestionnaire d'√©v√©nements.  L'impl√©mentation du filtrage a utilis√© un package de pointeur Javascript JSON pour capturer un √©l√©ment dans un objet JSON.  Cette approche √©tait beaucoup plus efficace que le d√©montage complet du JSON dont Go aurait besoin.  Bien que des fonctionnalit√©s de ce type puissent √™tre obtenues avec Go, l'utilisation de Javascript √©tait plus facile pour les ing√©nieurs et fournissait des lambdas plus simples. <br><br>  <b>R√©trospective Go</b> <br><br>  Apr√®s avoir impl√©ment√© la plate-forme de contact et l'avoir soutenue dans la production, si je devais mener une r√©trospective de Go et de la plate-forme de contenu, mes commentaires seraient les suivants: <br><br>  Qu'est-ce qui est d√©j√† bon? <br><br><ul><li>  √âl√©ments de conception du langage cl√© pour les syst√®mes distribu√©s. </li><li>  Un mod√®le de simultan√©it√© relativement facile √† impl√©menter. </li><li>  Belle communaut√© de codage et de plaisir. </li></ul><br>  Que peut-on am√©liorer? <br><br><ul><li>  Poursuite des progr√®s dans les normes de contr√¥le de version et de vente. </li><li>  Pas assez de maturit√© dans certaines r√©gions. </li><li>  D√©tails pour des cas d'utilisateurs sp√©cifiques. </li></ul><br>  En g√©n√©ral, ce fut une exp√©rience positive, et Go est l'un des √©l√©ments les plus importants qui a permis de faire √©voluer la plateforme de contenu.  Go ne sera pas toujours un outil appropri√©, et c'est normal.  The Economist a une plate-forme polyglotte et utilise diff√©rents langages lorsque cela a du sens.  Go ne sera probablement jamais le meilleur choix lorsque vous avez besoin de jouer avec des objets texte et du contenu dynamique, donc Javascript est toujours dans la bo√Æte √† outils.  Cependant, les points forts de Go sont le fondement qui permet au syst√®me de s'adapter et de cro√Ætre. <br>  Pour d√©terminer si Go vous convient, tenez compte des principaux probl√®mes de conception du syst√®me: <br><br><ul><li>  Quelles sont les t√¢ches de votre syst√®me? </li><li>  Quelles garanties offrez-vous √† vos consommateurs? </li><li>  Quelle architecture et quels mod√®les conviennent √† votre syst√®me? </li><li>  Comment votre syst√®me doit-il √©voluer? </li></ul><br>  Si vous d√©veloppez un syst√®me qui rel√®ve les d√©fis des donn√©es distribu√©es, des flux de travail asynchrones et des performances et une √©volutivit√© √©lev√©es, je vous recommande de consid√©rer Go et ses capacit√©s pour acc√©l√©rer les objectifs de votre syst√®me. <br><br>  Amis, nous attendons vos commentaires et invitons tout le monde au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">webinaire ouvert</a> , qui sera organis√© le 16 par le d√©veloppeur senior de Yandex et, en combinaison, notre professeur est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dmitry Smal</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr451760/">https://habr.com/ru/post/fr451760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr451748/index.html">Surveillance de l'√©tat du SSD dans les baies Qsan</a></li>
<li><a href="../fr451750/index.html">Livre "Elasticsearch, Kibana, Logstash et Next Generation Search Engine"</a></li>
<li><a href="../fr451752/index.html">30e anniversaire de l'ins√©curit√© galopante</a></li>
<li><a href="../fr451754/index.html">Comment trouver les expressions Lambda dans IntelliJ IDEA</a></li>
<li><a href="../fr451758/index.html">Liaisons montantes suppl√©mentaires dans l'architecture logique du syst√®me Intel C620</a></li>
<li><a href="../fr451766/index.html">Heisenbug 2019 Piter: ce qui se passera dans la diffusion gratuite, et ce uniquement lors de l'√©v√©nement</a></li>
<li><a href="../fr451768/index.html">Am√©liorer le travail du Wi-Fi. Principes g√©n√©raux et choses utiles</a></li>
<li><a href="../fr451770/index.html">Veeam Backup & Replication: conseils utiles pour rendre les sauvegardes et les r√©pliques viables</a></li>
<li><a href="../fr451772/index.html">Quelle est la particularit√© de Cloudera et comment le cuisiner</a></li>
<li><a href="../fr451776/index.html">Comment programmer des moteurs de jeux de r√¥les dans Google Sheets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>