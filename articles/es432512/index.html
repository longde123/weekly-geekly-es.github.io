<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úùÔ∏è ü§õüèª üç§ PostgreSQL: PipelineDB - consultas agregadas en tiempo real üôÇ üë®üèø‚Äç‚öïÔ∏è üèÇüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øAlguna vez le han pedido que calcule la cantidad de algo bas√°ndose en los datos de la base de datos del √∫ltimo mes, agrupando el resultado por alguno...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PostgreSQL: PipelineDB - consultas agregadas en tiempo real</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432512/">  ¬øAlguna vez le han pedido que calcule la cantidad de algo bas√°ndose en los datos de la base de datos del √∫ltimo mes, agrupando el resultado por algunos valores y desglos√°ndolo todo por d√≠a / hora? <br>  Si es as√≠, entonces ya te imaginas que tienes que escribir algo como esto, solo que peor <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">hour</span></span>(datetime), somename, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*), <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(somemetric) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> datetime &gt; :monthAgo <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  De vez en cuando, comienzan a aparecer una gran variedad de tales solicitudes, y si aguanta y ayuda una vez, lamentablemente, las apelaciones vendr√°n en el futuro. <br><br>  Pero tales solicitudes son malas ya que consumen bien los recursos del sistema en tiempo de ejecuci√≥n, y puede haber tantos datos que incluso una r√©plica para tales solicitudes ser√° una pena (y su momento). <br><br>  Pero, ¬øqu√© sucede si digo que justo en PostgreSQL puede crear una vista que sobre la marcha solo tendr√° en cuenta los nuevos datos entrantes en una consulta directamente similar, como se indic√≥ anteriormente? <br><br>  Entonces, puede hacer la extensi√≥n PipelineDB <br><br><div class="spoiler">  <b class="spoiler_title">Demo de su sitio como funciona</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/kz/5x/mb/kz5xmbjf4yjqv_ogkuhnirwu-ve.gif"><br></div></div><br><a name="habracut"></a>  PipelineDB era anteriormente un proyecto separado, pero ahora est√° disponible como una extensi√≥n para PG 10.1 y superior. <br><br>  Y aunque las oportunidades ofrecidas han existido durante mucho tiempo en otros productos dise√±ados espec√≠ficamente para recopilar m√©tricas en tiempo real, PipelineDB tiene una ventaja significativa: un umbral de entrada m√°s bajo para los desarrolladores que ya conocen SQL). <br><br>  Quiz√°s para algunos no sea esencial.  Personalmente, no soy demasiado vago para probar todo lo que parece adecuado para resolver un problema en particular, pero no me mover√© de inmediato para usar una nueva soluci√≥n para todos los casos.  Por lo tanto, en este art√≠culo no insto a soltar todo e instalar PipelineDB de inmediato, esto es solo una descripci√≥n general de la funcionalidad principal, como  La cosa me pareci√≥ curiosa. <br><br>  Entonces, en general, tienen buena documentaci√≥n, pero quiero compartir mi experiencia sobre c√≥mo probar este negocio en la pr√°ctica y llevar los resultados a Grafana. <br><br>  Para no tirar basura en la m√°quina local, implemento todo en la ventana acoplable. <br>  Im√°genes utilizadas: <code>postgres:latest</code> , <code>grafana/grafana</code> <br><br><h3>  Instalar PipelineDB en Postgres </h3><br>  En una m√°quina con postgres, ejecute secuencialmente: <br><br><ol><li> <code>apt update</code> </li> <li> <code>apt install curl</code> </li> <li> <code>curl -s http://download.pipelinedb.com/apt.sh | bash</code> </li> <li> <code>apt install pipelinedb-postgresql-11</code> </li> <li> <code>cd /var/lib/postgresql/data</code> </li> <li>  Abra el archivo <code>postgresql.conf</code> en cualquier editor </li><li>  Encuentre la clave <code>shared_preload_libraries</code> , descomente y establezca el valor <code>pipelinedb</code> </li><li>  Key <code>max_worker_processes</code> establecido en 128 (muelles de recomendaci√≥n) </li><li>  Reiniciar el servidor </li></ol><br><h3>  Crear una secuencia y una vista en PipelineDB </h3><br><div class="spoiler">  <b class="spoiler_title">Despu√©s de reiniciar pg - mira los registros para que haya tal cosa</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xc/6i/dz/xc6idzmydyyu2qgvpu7emd7aj2i.png"><br></div></div><br><ol><li>  La base de datos en la que trabajaremos: <code>CREATE DATABASE testpipe;</code> </li><li>  Crear una extensi√≥n: <code>CREATE EXTENSION pipelinedb;</code> </li><li>  Ahora lo m√°s interesante es crear una secuencia.  Es en √©l que necesita agregar datos para su posterior procesamiento: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> flow_stream ( dtmsk <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span> <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SERVER</span></span> pipelinedb;</code> </pre> <br>  De hecho, es muy similar a crear una tabla normal, no puede obtener datos de esta secuencia con una simple <code>select</code> : necesita una vista </li><li>  en realidad c√≥mo crearlo: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> viewflow <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (ttl = <span class="hljs-string"><span class="hljs-string">'3 month'</span></span>, ttl_column = <span class="hljs-string"><span class="hljs-string">'m'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">minute</span></span>(dtmsk) m, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*), <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>)::<span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">min</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flow_stream <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre> <br>  Se denominan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vistas continuas</a> y su material predeterminado es materializar, es decir.  con preservacion de estado. <br><br>  La <code>WITH</code> pasa par√°metros adicionales. <br><br>  En mi caso, <code>ttl = '3 month'</code> significa que necesita almacenar datos solo durante los √∫ltimos 3 meses y tomar la fecha / hora de la columna <code>M</code>  El proceso de <code>reaper</code> segundo plano <code>reaper</code> datos obsoletos y los elimina. <br><br>  Para aquellos que no est√°n al tanto, la funci√≥n de <code>minute</code> devuelve una fecha / hora sin segundos.  Por lo tanto, todos los eventos que ocurrieron en un minuto tendr√°n el mismo tiempo como resultado de la agregaci√≥n. </li><li>  Tal vista es casi una tabla, porque el √≠ndice por fecha para el muestreo ser√° √∫til si se almacenan muchos datos <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> viewflow (m <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span>);</code> </pre> </li></ol><br><h3>  Usando PipelineDB </h3><br>  Recuerde: inserte datos en la secuencia y lea desde la vista que se suscribe <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> flow_stream <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">now</span></span>(), <span class="hljs-string"><span class="hljs-string">'act1'</span></span>, <span class="hljs-number"><span class="hljs-number">21</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> flow_stream <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">now</span></span>(), <span class="hljs-string"><span class="hljs-string">'act2'</span></span>, <span class="hljs-number"><span class="hljs-number">33</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> viewflow <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">now</span></span>()</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Ejecuto la solicitud manualmente</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/3j/rb/fy/3jrbfyanqdnf8uhrmwytpmippxa.gif"><br></div></div>  Primero veo c√≥mo cambian los datos en el minuto 46 <br>  Tan pronto como llega el 47, el anterior deja de actualizarse y el minuto actual comienza a funcionar. <br><br>  Si presta atenci√≥n al plan de consulta, puede ver la tabla original con datos <br><br><img src="https://habrastorage.org/webt/z8/pm/fd/z8pmfdnqxflibrane_hjpmyxupa.png"><br><br>  Recomiendo ir a √©l y descubrir c√≥mo se almacenan realmente sus datos <br><br><div class="spoiler">  <b class="spoiler_title">Generador de eventos C #</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Npgsql; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">PipelineDbLogGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Random _rnd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] _actions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-string"><span class="hljs-string">"bar"</span></span>, <span class="hljs-string"><span class="hljs-string">"yep"</span></span>, <span class="hljs-string"><span class="hljs-string">"goal"</span></span>, <span class="hljs-string"><span class="hljs-string">"ano"</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> connString = <span class="hljs-string"><span class="hljs-string">"Host=localhost;port=5432;Username=postgres;Database=testpipe"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NpgsqlConnection(connString)) { conn.Open(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dt = DateTime.UtcNow; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NpgsqlCommand()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> act = GetAction(); cmd.Connection = conn; cmd.CommandText = <span class="hljs-string"><span class="hljs-string">"INSERT INTO flow_stream VALUES (@dtmsk, @action, @duration)"</span></span>; cmd.Parameters.AddWithValue(<span class="hljs-string"><span class="hljs-string">"dtmsk"</span></span>, dt); cmd.Parameters.AddWithValue(<span class="hljs-string"><span class="hljs-string">"action"</span></span>, act); cmd.Parameters.AddWithValue(<span class="hljs-string"><span class="hljs-string">"duration"</span></span>, GetDuration(act)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = cmd.ExecuteNonQuery(); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{res}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{dt}</span></span></span><span class="hljs-string">"</span></span>); } Thread.Sleep(_rnd.Next(<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">230</span></span>)); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDuration</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> act</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; act.Length; i++) { c += act[i]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _rnd.Next(c); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _actions[_rnd.Next(_actions.Length)]; } } }</code> </pre> <br></div></div><br><h3>  Conclusi√≥n en Grafana </h3><br>  Para obtener datos de postgres, debe agregar la fuente de datos adecuada: <br><br><img src="https://habrastorage.org/webt/_6/5s/lo/_65slonsdesxobympei4ty266es.png"><br><br>  Cree un nuevo panel de control y agregue un panel de tipo Gr√°fico, y luego debe editar el panel: <br><br><img src="https://habrastorage.org/webt/sm/va/ca/smvacalablhaoaohk0hamjcdrv0.png"><br><br>  A continuaci√≥n, seleccione una fuente de datos, cambie al modo de escritura sql-query e ingrese esto: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>, <span class="hljs-comment"><span class="hljs-comment">-- Grafana   time count, action from viewflow where $__timeFilter(m) --  ,     ,   col between :startdate and :enddate order by m desc, action;</span></span></code> </pre> <br>  Y luego obtienes un horario normal, por supuesto, si iniciaste el generador de eventos <br><br><img src="https://habrastorage.org/webt/y-/3j/3k/y-3j3k8kzkwu_p6ipmzovycuqe0.png"><br><br>  FYI: tener un √≠ndice puede ser muy importante.  Aunque su uso depende del volumen de la tabla resultante.  Si planea almacenar una peque√±a cantidad de filas en un corto per√≠odo de tiempo, puede resultar muy f√°cil que la exploraci√≥n secuencial sea m√°s barata, y el √≠ndice solo agregar√° m√°s.  cargar al actualizar valores <br><br>  Se pueden suscribir varias vistas a una secuencia. <br><br>  Supongamos que quiero ver cu√°ntos m√©todos de API realizan los percentiles. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> viewflow_per <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (ttl = <span class="hljs-string"><span class="hljs-string">'3 d'</span></span>, ttl_column = <span class="hljs-string"><span class="hljs-string">'m'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">minute</span></span>(dtmsk) m, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">percentile_cont</span></span>(<span class="hljs-number"><span class="hljs-number">0.50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITHIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>)::<span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span> p50, <span class="hljs-keyword"><span class="hljs-keyword">percentile_cont</span></span>(<span class="hljs-number"><span class="hljs-number">0.95</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITHIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>)::<span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span> p95, <span class="hljs-keyword"><span class="hljs-keyword">percentile_cont</span></span>(<span class="hljs-number"><span class="hljs-number">0.99</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITHIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>)::<span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span> p99 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flow_stream <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> viewflow_per (m <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>);</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Hago el mismo truco con grafana y obtengo:</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rx/zx/kj/rxzxkjagevdpf_v82yx-81b3-7a.png"><br></div></div><br><h3>  Total </h3><br>  En general, la cosa est√° funcionando, se comport√≥ bien, sin quejas.  Aunque bajo el docker, la descarga de su base de datos de demostraci√≥n en el archivo (2,3 GB) result√≥ ser un poco larga. <br><br>  Quiero se√±alar: no realic√© pruebas de estr√©s. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Documentaci√≥n oficial</a> <br><br><h4>  Puede ser interesante </h4><br><ul><li>  Soporte para descargar datos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de Apache Kafka a transmisiones</a> </li><li>  Similar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Amazon Kinesis</a> </li><li>  Puede crear vistas solo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">para la transformaci√≥n de datos</a> (sin almacenamiento) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PipelineDB Cluster</a> : hay una versi√≥n comercial.  En √©l, puede distribuir vistas seg√∫n fragmentos.  M√°s detalles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el panel de decisiones del cl√∫ster</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es432512/">https://habr.com/ru/post/es432512/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es432500/index.html">Certificaci√≥n PMP: Auditor√≠a de aplicaciones</a></li>
<li><a href="../es432502/index.html">Internet puede tener serios problemas debido a lenguajes como C y C ++ que contribuyen a las vulnerabilidades.</a></li>
<li><a href="../es432506/index.html">Microsoft Connect (); 2018: todos los anuncios de la conferencia en la nube</a></li>
<li><a href="../es432508/index.html">Sobre las barreras para el uso de sistemas de signos en inteligencia artificial</a></li>
<li><a href="../es432510/index.html">La cuota de mercado de Noruega de veh√≠culos el√©ctricos enchufables casi alcanza un nuevo m√°ximo</a></li>
<li><a href="../es432514/index.html">Reconocimiento de textos sobre Android con ABBYY RTR SDK y django</a></li>
<li><a href="../es432516/index.html">¬°Ampl√≠a tus horizontes, Holmes! ¬øO por qu√© los f√≠sicos necesitan un viol√≠n y habilidades culinarias?</a></li>
<li><a href="../es432518/index.html">Electr√≥n y el declive de las aplicaciones nativas.</a></li>
<li><a href="../es432520/index.html">C√≥mo cambiar la contrase√±a de administrador en Atlassian Jira y Confluence en la base de datos integrada (H2)</a></li>
<li><a href="../es432524/index.html">¬øPor qu√© nunca deber√≠as volver a usar Quora?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>