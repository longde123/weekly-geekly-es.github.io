<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛰️ 👩🏻‍🤝‍👨🏿 👔 Arcade Reverse Engineering: Rekam Michael Jordan di NBA Jam ⚗️ 👘 👩🏽‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Musim panas lalu saya diundang ke sebuah pesta di Sunnyvale. Ternyata pemilik di garasi memiliki mesin arcade NBA JAM Tournament Edition untuk empat p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arcade Reverse Engineering: Rekam Michael Jordan di NBA Jam</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473660/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e1/f90/849/7e1f90849dee7927ad904dca4f68bf2d.png" width="150%"></div><br>  Musim panas lalu saya diundang ke sebuah pesta di Sunnyvale.  Ternyata pemilik di garasi memiliki mesin arcade NBA JAM Tournament Edition untuk empat pemain.  Terlepas dari kenyataan bahwa permainan sudah lebih dari 25 tahun (dirilis pada tahun 1993), masih sangat menarik untuk dimainkan, terutama untuk penggemar yang antusias. <br><br>  Saya terkejut dengan daftar pemain Chicago Bulls yang tidak termasuk Michael Jordan.  Menurut sumber <sup>[1]</sup> , MJ menerima lisensi sendiri dan bukan bagian dari kesepakatan yang dibuat Midway dengan NBA. <br><br>  Setelah bertanya kepada pemilik mesin, saya mengetahui bahwa peretas merilis mod untuk SNES "NBA Jam 2K17", yang memungkinkan pemain baru dan MJ untuk bermain, tetapi tidak ada yang menganalisis bagaimana versi arcade bekerja.  Karena itu, saya pasti harus mencari ke dalam. <br><a name="habracut"></a><br><h2>  Latar belakang </h2><br>  Kisah NBA Jam dimulai bukan dengan bola basket, tetapi dengan Jean-Claude Van Damme.  Sekitar waktu yang sama ketika Universal Soldier dirilis, Midway Games mengembangkan teknologi untuk memanipulasi sprite fotorealistik yang besar dan dijital yang memiliki kemiripan dengan aktor nyata.  Itu adalah terobosan teknologi besar: animasi dengan 60 frame per detik, sprite yang sebelumnya tak terlihat berukuran 100x100 piksel, masing-masing memiliki palet 256-warna sendiri. <br><br>  Perusahaan menggunakan teknologi ini dengan sukses besar dalam penembak populer "Terminator 2: Judgment Day" <sup>[2]</sup> , tetapi tidak dapat memperoleh lisensi untuk "Universal Soldier" (kondisi keuangan JCVD ​​tidak dapat diterima untuk Midway <sup>[3]</sup> ).  Ketika negosiasi berakhir dengan kegagalan, Midway mengubah arah dan mulai mengembangkan game pertempuran mega-hit Capcom 1991 yang disebut Street Fighter II: The World Warrior. <br><br>  Sebuah tim beranggotakan empat orang berkumpul (Ed Boone menulis kode, John Tobias melakukan seni dan skrip, John Vogel menggambar grafik, dan Dan Forden adalah seorang insinyur suara).  Setelah satu tahun kerja keras <sup>[4]</sup> Midway meluncurkan Mortal Kombat pada tahun 1992. <br><br>  Gaya visualnya sangat berbeda dari pixel art biasa, dan desain gimnya, paling tidak, "kontroversial."  Permainan dengan liter darah di layar dan sangat kejam mendorong- "kematian" langsung menjadi hit dunia dan menghasilkan hampir 1 miliar dolar dalam setahun <sup>[5]</sup> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3b/39e/38c/b3b39e38c2dc236966ea48153bd2c9fc.png"></div><br>  <i>SF2: 384 × 224 dengan 4.096 warna.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fa/ecc/af5/8faeccaf515916b68f8b63e8a08357e9.png"></div><br>  <i>MK: 400 × 254 dengan 32.768 warna.</i> <br><br>  <u><b>Fakta menarik:</b></u> seperti dalam Mode VGA 0x13 pada PC, dalam game ini pikselnya tidak persegi.  Meskipun penyangga bingkai Mortal Kombat memiliki ukuran 400 × 254, itu diperbesar hingga rasio 4: 3 dari layar CRT, memberikan resolusi 400 × 300 <sup>[6]</sup> <br><br><h2>  Peralatan T-Unit Midway </h2><br>  Perangkat keras yang dikembangkan oleh Midway untuk Mortal Kombat ternyata sangat bagus.  Begitu baik sehingga ia diberi nama sendiri T-Unit dan digunakan kembali di game lain. <br><br><ul><li>  Mortal Kombat. </li><li>  Mortal Kombat II. </li><li>  NBA Jam. </li><li>  Edisi Turnamen NBA Jam. </li><li>  Hakim Dredd (belum dirilis). </li></ul><br>  T-Unit terdiri dari dua papan.  Kebanyakan dari mereka berurusan dengan logika dan grafis gim. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/753/893/a37/753893a376a67cef13cef49846d2ae82.png" width="100%"></div><br>  <i>Papan prosesor NBA JAM TE Edition (sekitar 40x40 cm, atau 15 inci).</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/300/f9c/fb4/300f9cfb461f4833a340ad1028f9f389.png" width="55%"></div><br>  Papan lainnya tidak terlalu rumit, tetapi juga mampu melakukan banyak hal.  Ini dirancang untuk audio, tetapi dapat memainkan tidak hanya musik menggunakan sintesis FM, tetapi juga suara digital. <br><br>  Kartu suara terhubung ke sumber daya dan kartu grafis dipasang di bagian belakang.  Perhatikan radiator besar yang terletak di sudut kiri atas. <br><br>  Bersama-sama, dua papan ini berisi lebih dari dua ratus chip, resistor, dan EPROM.  Untuk memahami semua ini hanya berdasarkan nomor seri akan sangat memakan waktu.  Tapi, yang mengejutkan, kadang-kadang di perangkat dari dokumentasi tahun 90an tidak sengaja ditemukan.  Dan dalam kasus NBA Jam, dia luar biasa. <br><br><h2>  Arsitektur Unit-T Midway </h2><br>  Mencari data, saya menemukan Kit Jam NBA.  Tingkat detail dokumen ini luar biasa <sup>[7]</sup> .  Di antara hal-hal lain, saya berhasil menemukan deskripsi terperinci tentang koneksi kabel, termasuk EPROM dan chip. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e2/f43/ef7/3e2f43ef76224de29c2376514fdfea3b.jpg" width="100%"></div><br>  Informasi dari dokumen memungkinkan kami untuk menggambar diagram papan dan menentukan fungsi setiap bagian.  Untuk membantu dalam pencarian komponen, papan memiliki koordinat dengan awal di sudut kanan bawah (UA0), meningkat ke sudut kiri atas (UJ26). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/552/c6d/525/552c6d5257527f5a7c8655eb51acfdd9.svg" width="100%"></div><br>  Jantung dari papan utama adalah Texas Instrument TMS34010 (UB21) dengan frekuensi 50 MHz dan dengan kode 1 mebibyte dalam EPROMs dan DRAM 512 kibibytes <sup>[8]</sup> .  34010 adalah chip 32-bit dengan bus 16-bit, yang memiliki instruksi grafis luar biasa seperti PIXT dan PIXBLT <sup>[9]</sup> .  Pada awal 90-an, chip ini digunakan dalam beberapa kartu akselerasi perangkat keras <sup>[10]</sup> , dan saya pikir ia menangani sejumlah besar efek grafis.  Anehnya, dia hanya berurusan dengan logika game dan tidak menarik apa pun. <br><br>  Bahkan, chip UE13 yang disebut "DMA2" ternyata menjadi monster grafis.  Menurut diagram dari dokumentasi, ia memiliki bus data 32-bit dan bus alamat 32-bit yang mengesankan (oleh karena itu menjadi chip terbesar di papan tulis).  Sirkuit terintegrasi khusus (ASIC) ini mampu melakukan banyak operasi grafis, yang akan saya bahas di bawah ini. <br><br>  Semua chip (RAM Sistem, GFX EPROM, Palette SDRAM, Code, Video Banks) dipetakan ke satu ruang alamat 32-bit dan terhubung ke bus yang sama.  Saya tidak dapat menemukan informasi tentang protokol bus, jadi jika Anda tahu sesuatu tentang itu, tulis email. <br><br>  Perhatikan triknya: satu komponen EPROM (ditandai dengan warna biru) digunakan untuk membuat sistem penyimpanan lain (dan menghemat uang).  EPROMs 512 kb ini memiliki pin alamat 32-bit dan pin data 8-bit.  Untuk 34010, yang membutuhkan bus data 16-bit, dua EPROM (J12 dan G12) terhubung dengan dua alternatif alamat, sehingga menghasilkan memori 1 mebibyte.  Demikian pula, sumber daya grafis dihubungkan dengan bergantian empat kali lipat alamat untuk membentuk alamat 32-bit dengan sistem penyimpanan 32-bit yang berisi 8 mebibytes. <br><br>  Meskipun dalam artikel ini saya terutama akan mempertimbangkan pipa grafis, saya tidak bisa menahan godaan, dan karena itu saya akan berbicara singkat tentang sistem audio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26b/07c/c13/26b07cc13020639a04bc7f25b5ef0117.svg" width="55%"></div><br>  Diagram kartu suara menunjukkan Motorola 6809 (U4 dengan frekuensi 2 MHz), yang menerima instruksi dari satu EPROM (U3) untuk mengontrol musik dan efek suara. <br><br>  Chip sintesis FM Yamaha 2151 (3,5 MHz) menghasilkan musik langsung dari instruksi yang diterima dari 6809 (musik menggunakan bandwidth yang cukup kecil). <br><br>  OKI6295 (1 MHz) bertanggung jawab untuk memutar audio digital dalam format ADPCM (misalnya, “Boomshakalaka” yang legendaris <sup>[11]</sup> Tim Kittsrow). <br><br>  Perhatikan bahwa pada papan utama, EPROM 32a / 8d biru 512-kbyte yang sama digunakan dalam sistem 16-bit dengan penyisipan ganda alamat untuk menyimpan suara digital, tetapi untuk instruksi 8-bit data / alamat Motorola 6809 tidak disisipkan. <br><br><h2>  Kehidupan bingkai </h2><br>  Seluruh layar Jam NBA diindeks dalam palet 16-bit.  Warna disimpan dalam format xRGB 1555 dalam palet 64-kbyte.  Palet dibagi menjadi 128 blok (256 * 16 bit) dari 512 byte.  Sprite yang disimpan di EPROM ditandai sebagai "GFX".  Setiap sprite memiliki palet sendiri hingga warna 256x16-bit.  Sprite sering menggunakan seluruh blok palet, tetapi tidak pernah lebih dari satu.  Sinyal CRT ditransmisikan ke monitor menggunakan RAMDAC, yang untuk setiap piksel membaca indeks dari bank DRAM Video dan melakukan pencarian warna dalam palet. <br><br>  Kehidupan setiap frame video NBA Jam berjalan sebagai berikut: <br><br><ol><li>  Logika permainan terdiri dari aliran instruksi 16-bit yang dikirimkan dari J12 / G12 ke 34010. </li><li>  34010 membaca input pemain, menghitung status game, dan kemudian menggambar layar. </li><li>  Untuk menggambar di layar, 34010 pertama-tama menemukan blok yang tidak digunakan dalam palet dan menulis palet sprite di sana (palet sprite disimpan bersama dengan instruksi 34010 di J12 / G12). </li><li>  34010 membuat permintaan ke DMA2, yang meliputi alamat dan ukuran sprite, blok palet 8-bit yang digunakan, pemotongan, penskalaan, metode pemrosesan piksel transparan, dan sebagainya. </li><li>  DMA2 membaca indeks sprite 8-bit dari chip ROM J14-G23 GFX, menggabungkan nilai ini dengan indeks blok palet 8-bit dan menulis indeks 16-bit ke bank video.  DRAM2 dapat dianggap sebagai blitter yang membaca nilai 8-bit dari GFX EPROM dan menulis nilai 16-bit ke bank video </li><li>  Langkah 3-5 diulang sampai semua permintaan untuk menggambar sprite selesai. </li><li>  Ketika datang ke refresh layar, RAMDAC mengubah data di bank video menjadi sinyal bahwa monitor CRT dapat mengerti.  Agar bandwidth cukup untuk mengubah indeks 16-bit menjadi 16-bit RGB, palet disimpan dalam SRAM yang sangat mahal dan sangat cepat. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f95/cca/564/f95cca564f1eb585bce4cf20470590b1.jpg" width="30%"></div><br>  <u><b>Fakta yang menarik:</b></u> EPROM flash firmware bukanlah proses yang sederhana.  Sebelum menulis ke chip, Anda harus menghapus semua isinya. <br><br>  Untuk melakukan ini, chip harus disinari dengan sinar UV.  Pertama, Anda harus membatalkan pemasangan stiker dari bagian atas EPROM untuk membuka diagramnya.  Kemudian EPROM ditempatkan di perangkat penghapus khusus di mana ada lampu UV. <br><br>  Setelah 20 menit, EPROM akan diisi dengan nol dan siap untuk direkam. <br><br><h2>  Dokumentasi MAME </h2><br>  Setelah mengetahui peralatannya, saya menyadari set EPROM apa yang dapat Anda tulis ke Michael Jordan (palet disimpan dalam Kode EPROMs, dan indeks dalam GFX EPROMs).  Namun, saya masih tidak tahu lokasi atau format yang digunakan. <br><br>  Dokumentasi yang hilang ditemukan di MAME. <br><br>  Jika Anda tidak tahu cara kerja emulator yang luar biasa ini, saya akan jelaskan secara singkat.  MAME didasarkan pada konsep "driver", yang merupakan tiruan dari papan.  Setiap driver terdiri dari komponen yang meniru (biasanya) setiap chip.  Dalam hal Midway T-Unit, kami tertarik pada file-file berikut: <br><br><pre>  mame / include / midtunit.h
 mame / src / mame / video / midtunit.cpp
 mame / src / mame / drivers / midtunit.cpp
 mame / src / mame / machine / midtunit.cpp
 cpu / tms34010 / tms34010.h </pre><br>  Jika Anda melihat driver / midtunit.cpp, kita akan melihat bahwa setiap chip memori adalah bagian dari ruang alamat 32-bit tunggal.  Dapat dilihat dari kode sumber driver bahwa palet dimulai pada 0x01800000, gfxrom dimulai pada 0x02000000, dan chip DMA2 dimulai pada 0x01a80000.  Untuk mengikuti jalur data, kita harus mengikuti fungsi C ++ yang dijalankan ketika objek operasi baca atau tulis adalah alamat memori. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> midtunit_state::main_map(address_map &amp;<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>.unmap_value_high(); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x00000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x003fffff</span></span>).rw(m_video, FUNC(midtunit_vram_r), FUNC(midtunit_vram_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x013fffff</span></span>).ram(); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01400000</span></span>, <span class="hljs-number"><span class="hljs-number">0x0141ffff</span></span>).rw(FUNC(midtunit_cmos_r), FUNC(midtunit_cmos_w)).share(<span class="hljs-string"><span class="hljs-string">"nvram"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01480000</span></span>, <span class="hljs-number"><span class="hljs-number">0x014fffff</span></span>).w(FUNC(midtunit_cmos_enable_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600000</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160000f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"IN0"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600010</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160001f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"IN1"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600020</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160002f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"IN2"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01600030</span></span>, <span class="hljs-number"><span class="hljs-number">0x0160003f</span></span>).portr(<span class="hljs-string"><span class="hljs-string">"DSW"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01800000</span></span>, <span class="hljs-number"><span class="hljs-number">0x0187ffff</span></span>).ram().w(m_palette, FUNC(write16)).share(<span class="hljs-string"><span class="hljs-string">"palette"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01a80000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01a800ff</span></span>).rw(m_video, FUNC(midtunit_dma_r), FUNC(midtunit_dma_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01b00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01b0001f</span></span>).w(m_video, FUNC(midtunit_control_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01d00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01d0001f</span></span>).r(FUNC(midtunit_sound_state_r)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01d01020</span></span>, <span class="hljs-number"><span class="hljs-number">0x01d0103f</span></span>).rw(FUNC(midtunit_sound_r), FUNC(midtunit_sound_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01d81060</span></span>, <span class="hljs-number"><span class="hljs-number">0x01d8107f</span></span>).w(<span class="hljs-string"><span class="hljs-string">"watchdog"</span></span>, FUNC(watchdog_timer_device::reset16_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x01f00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x01f0001f</span></span>).w(m_video, FUNC(midtunit_control_w)); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x02000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x07ffffff</span></span>).r(m_video, FUNC(midtunit_gfxrom_r)).share(<span class="hljs-string"><span class="hljs-string">"gfxrom"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0x1f800000</span></span>, <span class="hljs-number"><span class="hljs-number">0x1fffffff</span></span>).rom().region(<span class="hljs-string"><span class="hljs-string">"maincpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* mirror used by MK*/</span></span> <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(<span class="hljs-number"><span class="hljs-number">0xff800000</span></span>, <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>).rom().region(<span class="hljs-string"><span class="hljs-string">"maincpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> <br>  Pada akhir file yang sama "drivers / midtunit.cpp" kita melihat bagaimana isi EPROM dimuat ke dalam RAM.  Dalam kasus sumber daya grafis "gfxrom" (terkait dengan alamat 0x02000000), kita dapat melihat bahwa mereka membentang 8 mebibytes ruang alamat dalam blok chip dengan empat kali lipat alamat bergantian.  Perhatikan bahwa nama file sesuai dengan lokasi chip (misalnya, UJ12 / UG12).  Set file EPROM ini di dunia emulator lebih dikenal sebagai "ROM." <br><br><pre> <code class="cpp hljs">ROM_START( nbajamte ) ROM_REGION( <span class="hljs-number"><span class="hljs-number">0x50000</span></span>, <span class="hljs-string"><span class="hljs-string">"adpcm:cpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-comment"><span class="hljs-comment">/* sound CPU*/</span></span> ROM_LOAD( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_u3_sound_rom.u3"</span></span>, <span class="hljs-number"><span class="hljs-number">0x010000</span></span>, <span class="hljs-number"><span class="hljs-number">0x20000</span></span>, NO_DUMP) ROM_RELOAD( <span class="hljs-number"><span class="hljs-number">0x030000</span></span>, <span class="hljs-number"><span class="hljs-number">0x20000</span></span> ) ROM_REGION( <span class="hljs-number"><span class="hljs-number">0x100000</span></span>, <span class="hljs-string"><span class="hljs-string">"adpcm:oki"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-comment"><span class="hljs-comment">/* ADPCM*/</span></span> ROM_LOAD( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_u12_sound_rom.u12"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_u13_sound_rom.u13"</span></span>, <span class="hljs-number"><span class="hljs-number">0x080000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_REGION16_LE( <span class="hljs-number"><span class="hljs-number">0x100000</span></span>, <span class="hljs-string"><span class="hljs-string">"maincpu"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-comment"><span class="hljs-comment">/* 34010 code*/</span></span> ROM_LOAD16_BYTE( <span class="hljs-string"><span class="hljs-string">"l4_nba_jam_tournament_game_rom_uj12.uj12"</span></span>, <span class="hljs-number"><span class="hljs-number">0x00000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD16_BYTE( <span class="hljs-string"><span class="hljs-string">"l4_nba_jam_tournament_game_rom_ug12.ug12"</span></span>, <span class="hljs-number"><span class="hljs-number">0x00001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_REGION( <span class="hljs-number"><span class="hljs-number">0xc00000</span></span>, <span class="hljs-string"><span class="hljs-string">"gfxrom"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug14.ug14"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj14.uj14"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug19.ug19"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj19.uj19"</span></span>, <span class="hljs-number"><span class="hljs-number">0x000003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug16.ug16"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj16.uj16"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug20.ug20"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj20.uj20"</span></span>, <span class="hljs-number"><span class="hljs-number">0x200003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug17.ug17"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj17.uj17"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug22.ug22"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj22.uj22"</span></span>, <span class="hljs-number"><span class="hljs-number">0x400003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug18.ug18"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600000</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj18.uj18"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600001</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_ug23.ug23"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600002</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_LOAD32_BYTE( <span class="hljs-string"><span class="hljs-string">"l1_nba_jam_tournament_game_rom_uj23.uj23"</span></span>, <span class="hljs-number"><span class="hljs-number">0x600003</span></span>, <span class="hljs-number"><span class="hljs-number">0x80000</span></span>, NO_DUMP) ROM_END</code> </pre> <br>  <b><u>Fakta yang menarik:</u></b> pada contoh kode di atas, parameter fungsi yang terakhir diganti dengan “NO_DUMP” sehingga EPROMs yang dimodifikasi dapat dimuat.  Bidang-bidang ini biasanya <sup>[12]</sup> hash CRC / SHA1 dari isi EPROM.  Beginilah cara MAME menentukan game mana yang termasuk ROM dan membuat Anda tahu bahwa salah satu ROM di set hilang atau rusak. <br><br><h2>  Mesin video jantung: DMA2 </h2><br>  Kunci untuk memahami format grafik adalah fungsi yang memproses tulis / baca DMA di 256 register DMA2 yang terletak di alamat dari 0x01a80000 hingga 0x01a800ff.  Semua kerja keras rekayasa balik telah dilakukan oleh pengembang MAME.  Mereka bahkan meluangkan waktu untuk mendokumentasikan format perintah dengan sangat baik. <br><br><pre>  Register DMA
  ------------------

   Daftar |  Bit |  Aplikasi
  ---------- + - FEDCBA9876543210 - + ------------
      0 |  xxxxxxxx -------- |  piksel dibuang di awal setiap baris
            |  -------- xxxxxxxx |  piksel dibuang di akhir setiap baris
      1 |  x --------------- |  aktifkan perekaman (atau hapus jika nol)
            |  -421 ------------ |  gambar bpp (0 = 8)
            |  ---- 84 ---------- |  ukuran lulus setelah = (1 &lt;&lt; x)
            |  ------ 21 -------- |  lulus ukuran hingga = (1 &lt;&lt; x)
            |  -------- 8 ------- |  aktifkan lewati sebelum / sesudah
            |  --------- 4 ------ |  aktifkan pemotongan
            |  ---------- 2 ----- |  y mirroring
            |  ----------- 1 ---- |  x mirroring
            |  ------------ 8 --- |  mentransfer piksel bukan nol sebagai warna
            |  ------------- 4-- |  mentransmisikan nol piksel sebagai warna
            |  -------------- 2- |  transmisi piksel bukan nol
            |  --------------- 1 |  transmisi nol piksel
      2 |  xxxxxxxxxxxxxxxx |  alamat sumber kata rendah
      3 |  xxxxxxxxxxxxxxxx |  alamat sumber kata tinggi
      4 |  ------- xxxxxxxxx |  x penerima
      5 |  ------- xxxxxxxxx |  y penerima
      6 |  ------ xxxxxxxxxx |  kolom gambar
      7 |  ------ xxxxxxxxxx |  garis gambar
      8 |  xxxxxxxxxxxxxxxx |  palet
      9 |  xxxxxxxxxxxxxxxx |  warna
     10 |  --- xxxxxxxxxxxxx |  skala x
     11 |  --- xxxxxxxxxxxxx |  skala y
     12 |  ------- xxxxxxxxx |  pemangkasan atas / kiri
     13 |  ------- xxxxxxxxx |  pemangkasan bawah / kanan
     14 |  ---------------- |  tes
     15 |  xxxxxxxx -------- |  byte deteksi nol
            |  -------- 8 ------- |  halaman tambahan
            |  --------- 4 ------ |  ukuran penerima
            |  ---------- 2 ----- |  pemilihan tepi atas / bawah atau kiri / kanan untuk register 12/13 </pre><br>  Bahkan ada fungsi debugging yang memungkinkan Anda untuk menyimpan sprite asli dalam proses mentransfernya ke DMA2 (fungsi ini ditulis oleh peserta lama dalam proyek MAME, Ryan Holtz <sup>[13]</sup> ).  Sudah cukup bagi saya untuk hanya memainkan game sehingga semua file dengan metadata disimpan ke disk. <br><br>  Ternyata sprite terdiri dari elemen sederhana dari palet 16-bit tanpa kompresi.  Namun, tidak semua sprite memiliki jumlah warna yang sama.  Beberapa sprite hanya menggunakan 16 warna dengan indeks warna 4-bit, sementara yang lain menggunakan 256 warna dan memerlukan indeks warna 8-bit. <br><br><h2>  Tambalan </h2><br>  Sekarang saya tahu lokasi dan format sprite, jadi tetap melakukan jumlah minimum reverse engineering.  Saya menulis sebuah program kecil di Golang untuk menghilangkan pergantian "kode" EPROM dan "gfx".  Dengan menghilangkan striping, mudah untuk mencari ASCII atau nilai yang diketahui, karena saya bekerja persis dengan apa yang tampak seperti RAM selama eksekusi program. <br><br>  Setelah itu, Anda dapat dengan mudah menemukan karakteristik pemain.  Ternyata mereka semua disimpan satu demi satu dalam format big-endian 16-bit unsigned (yang sangat logis, karena 34010 bekerja dengan big-endian).  Saya menambahkan patcher untuk memodifikasi atribut pemain.  Tidak terlalu tertarik pada bola basket, saya memasukkan SPEED = 9, 3 PTS = 9, DUNKS = 9, PASS = 9, POWER = 9, STEAL = 9, BLOCK = 9 dan CLTCH = 9. <br><br>  Saya juga menulis kode untuk menambal game dengan sprite baru dengan satu-satunya batasan - sprite baru harus memiliki ukuran yang sama dengan yang tergantikan.  Untuk foto MJ, saya membuat indeks PNG 256-warna (Anda bisa melihatnya di <a href="">sini</a> ). <br><br>  Akhirnya, saya menambahkan kode untuk mengkonversi format menengah ke format yang disisipkan untuk menulis ke masing-masing file EPROM. <br><br><h2>  Mulai game </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca2/427/e60/ca2427e606192878c8c2a116b73e821e.png" width="49%"></div><br>  Setelah menambal isi EPROM, alat diagnostik NBAJam menunjukkan bahwa isi beberapa chip ditandai sebagai "BAD".  Saya mengharapkan ini karena saya hanya menambal isi EPROM, tetapi tidak repot mencari format CRC dan bahkan lokasi penyimpanannya. <br><br>  EPROM GFX ditandai dengan warna merah (UG16 / UJ16, UG17 / UJ17, UG18 / UJ18, UG20 / UJ20, UG22 / UJ22 dan UG23 / UJ23), karena berisi gambar yang saya ubah.  Dua EPROMs di mana instruksi (UG12 dan UJ12) disimpan juga berwarna merah, karena ada palet. <br><br>  Untungnya, di sini CRC tidak digunakan untuk melindungi konten yang dimodifikasi dan hanya diperlukan untuk memverifikasi integritas chip.  Game sudah dimulai.  Dan hasilkan! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0e/341/ad0/e0e341ad08eaace26ce47cae7a7758cb.png" width="100%"></div><br><h2>  Hasta La Vista, Baby! </h2><hr><br>  Setelah selesai dengan kesulitan teknis, saya dengan cepat kehilangan minat pada alat dan berhenti mengembangkannya.  Gagasan untuk mereka yang ingin bermain-main dengan kode: <br><br><ul><li>  Tambahkan ke Eastern Conference Toronto Raptors. </li><li>  Tambahkan kemampuan untuk mengubah nama pemain.  Sayangnya, mereka tidak terdiri dari ASCII, tetapi gambar yang dibuat sebelumnya. </li></ul><br><h2>  Buku tentang NBA Jam </h2><br>  Jika Anda penggemar NBA Jam, maka Reyan Ali menulis seluruh buku tentangnya <sup>[14]</sup> .  Anda bisa membelinya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><h2>  Kode sumber </h2><br>  Jika Anda ingin berkontribusi atau hanya melihat cara kerja semuanya, maka sumber lengkap diunggah ke github di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><h2>  Referensi </h2><br>  [1] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">'NJA Jam' oleh Reyan Ali</a> <br><br>  [2] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">'NJA Jam' oleh Reyan Ali</a> <br><br>  [3] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">'NJA Jam' oleh Reyan Ali</a> <br><br>  [4] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mortal Kombat 1 Behind The Scene</a> <br><br>  [5] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">'NJA Jam' oleh Reyan Ali</a> <br><br>  [6] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">4: 3 versus Piksel Persegi</a> <br><br>  [7] Komentar: Sayangnya, era dokumentasi yang luar biasa seperti ini telah lama berlalu <br><br>  [8] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Layar pembuka Mame NBA Jam</a> <br><br>  [9] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Set Instruksi TMS34010</a> <br><br>  [10] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">T34010 Panduan Pengguna</a> <br><br>  [11] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">NBA Jam - Video BoomShakaLaka</a> <br><br>  [12] Sumber: <a href="">MAME T-Unit driver.cpp</a> <br><br>  [13] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Commit 'midtunit.cpp: Menambahkan penampil DMA-blitter opsional'</a> <br><br>  [14] Sumber: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">'NBA JAM Book' oleh Reyan Ali</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id473660/">https://habr.com/ru/post/id473660/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id473648/index.html">Kuda itu mati - menangis: transisi dari tslint ke eslint</a></li>
<li><a href="../id473652/index.html">Membuat API REST dengan Node.js dan Oracle Database. Bagian 5</a></li>
<li><a href="../id473654/index.html">PHP Composer: Perbaiki dependensi tanpa rasa sakit</a></li>
<li><a href="../id473656/index.html">Hugo Static Site Generator Experience</a></li>
<li><a href="../id473658/index.html">Menangani bug di Go 1.13</a></li>
<li><a href="../id473664/index.html">Pengalaman belajar langsung. Yandex.Practicum - Analis Data</a></li>
<li><a href="../id473666/index.html">Sebagai penulis fiksi ilmiah, Arthur Clark hampir menutup jurnal Tech - Youth</a></li>
<li><a href="../id473668/index.html">Mengapa Bitrix - Bitrix</a></li>
<li><a href="../id473670/index.html">Stoloto: cara memperkenalkan ponsel ke lotre</a></li>
<li><a href="../id473672/index.html">Kenapa, Bitrix? Atau dunia peri 1C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>