<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø üëèüèø ü§πüèæ Domain-gesteuertes Design: ein Rezept f√ºr einen Pragmatiker üéã üôáüèæ üçã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Warum werden DDDs normalerweise von der falschen Seite angegangen? Und welche Seite willst du? Was haben Giraffen und Schnabeltiere damit zu tun? 

 S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Domain-gesteuertes Design: ein Rezept f√ºr einen Pragmatiker</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/440772/"><img src="https://habrastorage.org/webt/0d/g2/_y/0dg2_yqhafnwjnnd2iqwabmrysc.jpeg"><br>  Warum werden DDDs normalerweise von der falschen Seite angegangen?  Und welche Seite willst du?  Was haben Giraffen und Schnabeltiere damit zu tun? <br><br>  Speziell f√ºr Habr - eine Textabschrift des Berichts "Domain-gesteuertes Design: ein Rezept f√ºr einen Pragmatiker".  Der Bericht wurde auf der DotNext .NET-Konferenz erstellt, kann jedoch nicht nur f√ºr Spender, sondern f√ºr alle, die an DDD interessiert sind, n√ºtzlich sein (wir glauben, dass Sie einige C # -Codebeispiele beherrschen werden).  Eine Videoaufzeichnung des Berichts ist ebenfalls beigef√ºgt. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CR9mLGN9jh0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Hallo allerseits, mein Name ist Alexey Merson.  Ich werde Ihnen sagen, was Domain-Driven Design ist und was es ausmacht, aber zuerst wollen wir herausfinden, warum es √ºberhaupt ben√∂tigt wird. <br><br><img src="https://habrastorage.org/webt/mb/3q/2v/mb3q2vmpui3hndlrdyxscvi-ovo.jpeg"><br><br>  Martin Fowler sagte: "Es gibt wenige Dinge, die weniger logisch sind als Gesch√§ftslogik."  Die Giraffe ist definitiv eine dieser wenigen.  Der Abstand zwischen Gehirn und Kehlkopf einer Giraffe betr√§gt nur wenige Zentimeter.  Der Nerv, der sie verbindet, erreicht jedoch 4 Meter.  Zuerst geht er durch den ganzen Hals, dort geht er um die Arterie herum und dann geht er fast auf die gleiche Weise zur√ºck. <br><br>  Auf den ersten Blick gibt es wirklich keine Logik.  Aber dies ist nur ein dichtes Erbe, das von alten Fischen √ºbrig geblieben ist.  Wie Sie wissen, gibt es bei Fischen keinen Hals, sodass dieser Nerv auf dem optimalen Weg verl√§uft.  Und als S√§ugetiere nach mehreren Millionen Jahren Refactoring auftauchten, musste der Nerv verl√§ngert werden, um die Abw√§rtskompatibilit√§t aufrechtzuerhalten.  Nun, nicht wegen einer Giraffe umbauen? <br><br>  Aber die Giraffe ist okay, weil es ein Schnabeltier gibt. <br><br><img src="https://habrastorage.org/webt/j0/fv/t3/j0fvt3ieyzwdykfidna95z9w-vw.jpeg"><br>  √úberleg es dir.  Das S√§ugetier  Mit einem Schnabel.  Lebt haupts√§chlich im Wasser.  Legt Eier.  Und au√üerdem giftig.  Es scheint, dass die einzig logische Erkl√§rung f√ºr seine Existenz darin besteht, dass er aus Australien stammt. <br><br>  Aber ich denke, dass alles banaler ist.  Der Auftragnehmer verga√ü einfach das Design und sparte mit StackOverflow, na ja, oder was damals da war. <br><img src="https://habrastorage.org/webt/hr/xm/lw/hrxmlwxz0r0fwr4xfrueljqhc7e.jpeg"><br>  Ich wei√ü, was Sie jetzt denken: "Alexey, Sie haben uns Domain-Driven Design versprochen, und hier ist eine Art" In der Tierwelt "!" <br><br>  Kollegen, was ist Entwicklung?  Entwicklung ist, wenn wir einen Teil der realen Welt, einen Gesch√§ftsprozess, in Code umwandeln, dh ein Softwaremodell erstellen.  Welche Probleme erwarten uns auf dem Weg? <br><br>  Das erste ist die Komplexit√§t der Gesch√§ftsprozesse selbst, dh die Schwierigkeit zu verstehen, wie das Gesch√§ft funktioniert, welche Prozesse dort stattfinden und nach welcher Logik sie aufgebaut sind. <br><br>  Das zweite Problem ist die Implementierung dieser Gesch√§ftsprozesse in Form von Code, die Verwendung der richtigen Muster, der richtigen Ans√§tze usw.  Dies ist auch ein ziemlich kompliziertes Thema. <br><img src="https://habrastorage.org/webt/41/de/a2/41dea2lr4g73nouzxekhq8-t3qm.jpeg"><br>  Schauen Sie, Gesch√§ftsprozesse sind wie diese Giraffe: Sie haben mit den einfachsten einzelligen begonnen, und dann sieht ‚Äûdas‚Äú Sie an, und niemand versteht entweder ‚Äûwoher es kommt‚Äú oder ‚Äûwie es funktioniert‚Äú. <br><br>  Um ein erfolgreiches Modell eines solchen Prozesses zu erstellen, m√ºssen Sie zuerst die Frage ‚ÄûWarum?‚Äú Beantworten.  Warum wollen wir dieses Modell bauen?  Welche Ziele wollen wir erreichen?  Wenn der Kunde eine ausgestopfte Giraffe haben m√∂chte, aber den Mut dazu hat, ist er schlie√ülich ver√§rgert, auch wenn die Verdauung in diesem Modell f√ºr eine Augenweide durchgef√ºhrt wird.  Und der Kunde wird nicht nur Geld und Zeit verlieren, er wird auch das Vertrauen in uns als Entwickler verlieren und wir werden unseren Ruf und Kunden verlieren. <br><br>  Aber selbst wenn wir die Ziele herausgefunden haben, garantiert dies nicht, dass wir das Schnabeltier als Ergebnis nicht bekommen.  Tatsache ist, dass das Ziel wenig zu verstehen ist.  Das Ziel muss erreicht werden.  Und das hilft uns beim dom√§nengesteuerten Design. <br><img src="https://habrastorage.org/webt/qb/dz/ib/qbdzibra6bypzj_36zfv-dnhlti.jpeg"><br>  Das Hauptziel von Domain-Driven Design ist es, die Komplexit√§t von Gesch√§ftsprozessen sowie deren Automatisierung und Implementierung in Code zu bek√§mpfen.  "Domain" bedeutet "Domain", und Entwicklung und Design im Rahmen dieses Ansatzes werden von der Domain verdr√§ngt. <br><br>  Domain-Driven Design beinhaltet viele Dinge.  Dieses strategische Design und die Interaktion zwischen Menschen, Architekturans√§tzen und taktischen Mustern - dies ist ein ganzes Arsenal, das wirklich funktioniert und wirklich hilft, Projekte zu machen.  Es gibt nur ein "aber".  Bevor Sie sich mit der Komplexit√§t von Domain-Driven Design befassen, m√ºssen Sie lernen, wie Sie mit der Komplexit√§t von Domain-Driven Design selbst umgehen. <br><br><img src="https://habrastorage.org/webt/ho/xz/9k/hoxz9k3iyujhnbgzlt8dlfzd4b0.png"><br><br>  Wenn eine Person beginnt, sich mit diesem Thema zu besch√§ftigen, f√§llt eine gro√üe Menge an Informationen auf sie: dicke B√ºcher, eine Reihe von Artikeln, Mustern, Beispielen.  All dies ist verwirrend und es ist leicht, wie sie sagen, hinter den B√§umen des Waldes nicht zu bemerken.  Ich habe das einmal an mir selbst gesp√ºrt, aber heute m√∂chte ich meine Erfahrungen mit Ihnen teilen und Ihnen helfen, durch diesen Dschungel zu kommen und endlich Domain-Driven Design zu verwenden. <br><img src="https://habrastorage.org/webt/bm/mi/hs/bmmihsln4udtdm2d892qwb9elmo.jpeg"><br>  Der Begriff Domain-Driven Design selbst wurde 2003 von Eric Evans in seinem unaussprechlichen Buch vorgeschlagen, das die Community einfach als Blue Book bezeichnet.  Das Problem ist, dass in der ersten H√§lfte des Buches Evans √ºber taktische Muster gesprochen wird (Sie alle kennen sie: Dies sind Fabriken, Unternehmen, Endlager, Dienstleistungen) und die Leute normalerweise nicht in die zweite H√§lfte gelangen.  Der Mann sieht aus: Alles ist bekannt, ich hole die DDD-Anwendung. <br><img src="https://habrastorage.org/webt/7y/xz/_r/7yxz_r9ayavde_qjite3vti58fi.jpeg"><br>  Auf der rechten Seite passiert, wenn Sie wahnsinnig taktische Muster auf den Compiler werfen.  Links - wenn Sie strategische Muster verwenden. <br><br><img src="https://habrastorage.org/webt/g9/bd/cj/g9bdcj-skoztnm7s3rsbxyo9w68.jpeg"><br><br>  Seit der Ver√∂ffentlichung des Blue Book hat sich eine ziemlich starke DDD-Community gebildet, viele Dinge wurden √ºberdacht.  Ja, und Evans selbst gab zu, dass er nicht mehr versteht, wie er einer so wichtigen Sache wie dem strategischen Design ein Ende setzen kann. <br><br>  Und 10 Jahre sp√§ter, 2013, wurde das Rote Buch von Vaughn Vernon ver√∂ffentlicht.  Und in diesem Buch ist die Pr√§sentation bereits in der richtigen Reihenfolge aufgebaut: Sie beginnt mit dem strategischen Design, mit den Grundlagen.  Und wenn der Leser die notwendige Basis erhalten hat, beginnt er bereits √ºber taktische Muster und Implementierungsdetails zu sprechen. <br><br>  Normalerweise empfehlen sie in DDD-Berichten das Lesen von Evans. Im Internet gibt es sogar ganze Handb√ºcher, in deren Reihenfolge Sie die Kapitel lesen m√ºssen, um richtig eintauchen zu k√∂nnen.  Ich empfehle, es einfacher zu machen: Beginnen Sie mit dem Roten Buch, lesen Sie es und fahren Sie erst dann mit Blau fort. <br><br>  Und da strategisches Design so wichtig ist, lassen Sie uns √ºber seine Schl√ºsselideen sprechen. <br><br><h2>  "Schl√ºsselideen des strategischen Designs" </h2><br>  In jedem Gesch√§ftsautomatisierungsprojekt gibt es immer Domain-Experten.  Dies sind Menschen, die am besten verstehen, wie die zu modellierenden Gesch√§ftsprozesse funktionieren.  Dies k√∂nnen f√ºhrende Entwickler, F√ºhrungskr√§fte und Top-Manager sein.  Im Allgemeinen kann es jeder sein, wenn er nur die Gesch√§ftsprozesse versteht, mit denen wir uns befassen m√ºssen. <br><br><img src="https://habrastorage.org/webt/c0/s1/ho/c0s1ho_prs7h-b-qbkh7_rrroaa.jpeg"><br><br>  Auf der anderen Seite gibt es technische Experten: Entwickler, Architekten, die direkt an der Automatisierung und Implementierung von Anwendungen beteiligt sind.  In dem abgebildeten Beispiel wollte der Kunde wahrscheinlich eine Kinderbahn, aber es stellte sich heraus, dass es sich um eine Art Monster handelte. <br><br>  Warum passiert das?  Weil die Interaktion zwischen technischen Experten und Domain-Experten in einer typischen Situation ungef√§hr so ‚Äã‚Äãaussieht: Es gibt eine gro√üe Wand zwischen ihnen, und ein Manager geht oben an dieser Wand entlang und versucht zuerst zu h√∂ren, was sie auf einer Seite der Wand schreien, dann versucht er, es den besten B√ºndeln zu schreien auf der anderen Seite der Wand und so weiter im Kreis. <br><br>  Manchmal ist ein Manager taub, dann kann eine ganze Kette solcher Manager aufgebaut werden, was nat√ºrlich nicht zum Erfolg des Projekts beitr√§gt.  Und wie soll es sein? <br><br><img src="https://habrastorage.org/webt/wc/ov/sh/wcovshn5e04eei99ry9a9ydm4gy.jpeg"><br><br>  Es muss eine st√§ndige Interaktion geben.  Technische Experten, Domain-Experten - Alle Projektteilnehmer m√ºssen st√§ndig kommunizieren, synchronisieren, Ziele diskutieren, Wege finden, um sie zu erreichen, und warum wir das alles tun. <br><br>  Und hier kommen wir zum ersten und wahrscheinlich wichtigsten Punkt sowohl des strategischen Designs als auch des dom√§nengesteuerten Designs im Allgemeinen. <br><br><img src="https://habrastorage.org/webt/tz/nl/jg/tznljgxy0ptqsd5vw-5s3ptopdk.jpeg"><br><br>  Die Kommunikation zwischen den Projektteilnehmern bildet das, was Domain-Driven Design als allgegenw√§rtige Sprache bezeichnet.  Er ist nicht einer in dem Sinne, dass er einer f√ºr alle Gelegenheiten ist.  Im Gegenteil.  Es ist einfach in dem Sinne, dass alle Teilnehmer darin kommunizieren, alle Diskussionen in einer einzigen Sprache stattfinden und alle Artefakte maximal in einer einzigen Sprache sein sollten, dh beginnend mit TK und endend mit einem Code. <br><br><h2>  Gesch√§ftsszenarien </h2><br>  F√ºr die weitere Diskussion ben√∂tigen wir eine Art Gesch√§ftsszenario.  Stellen wir uns diese Situation vor: <br><br><img src="https://habrastorage.org/webt/nm/4g/ig/nm4gigksgfmt0bgp-iixvbbxow4.jpeg"><br><br>  Der Direktor der JUG.ru-Gruppe kommt zu uns und sagt: "Leute, der Fluss der Berichte w√§chst, die Menschen werden im Allgemeinen gefoltert, um alles manuell zu erledigen ... Lassen Sie uns den Prozess der Vorbereitung der Konferenz automatisieren."  Wir antworten: "Okay!"  - und mach dich an die Arbeit. <br><br>  Das erste Szenario, das wir automatisieren werden, lautet: ‚ÄûDer Redner reicht bei einem bestimmten Ereignis einen Antrag f√ºr einen Bericht ein und f√ºgt Informationen zu seinem Bericht hinzu.‚Äú  Was sehen wir in diesem Szenario?  Was ist ein Sprecher, es gibt ein Ereignis und es gibt einen Bericht, was bedeutet, dass es bereits m√∂glich ist, das erste Dom√§nenmodell zu erstellen. <br><br><img src="https://habrastorage.org/webt/e_/up/_t/e_up_tj4aagy5ewxeq1xwdnim_k.jpeg"><br><br>  Hier haben wir ein Domain-Modell: Sprecher - Sprecher, Talk - Bericht, Event - Event.  Das Dom√§nenmodell kann jedoch nicht unbegrenzt sein, kann nicht alles abdecken, da es sonst verschwommen wird und den Fokus verliert. Daher muss das Dom√§nenmodell durch etwas eingeschr√§nkt werden.  Dies ist der n√§chste wichtige Punkt. <br><br><img src="https://habrastorage.org/webt/e_/0w/w8/e_0ww82sof-x_waqu_epiihi8de.jpeg"><br><br>  Sowohl das Dom√§nenmodell als auch die allgegenw√§rtige Sprache sind durch den Kontext begrenzt, den Domain-Driven Design als begrenzten Kontext bezeichnet.  Er schr√§nkt das Dom√§nenmodell so ein, dass alle darin enthaltenen Konzepte eindeutig sind und jeder versteht, worum es geht. <br><br>  Wenn sie "Benutzer" sagen, sollte alles auf einmal klar sein, es sollte eine verst√§ndliche Rolle haben, eine verst√§ndliche Bedeutung, es sollte aus Sicht der IT-Branche keine Art abstrakter Benutzer sein. <br><br><img src="https://habrastorage.org/webt/fv/v-/7r/fvv-7rprlvfbdhyo81bgitdvvny.jpeg"><br><br>  In unserem Fall gilt dieses Dom√§nenmodell f√ºr den Kontext der Vorbereitung der Konferenz. In diesem Kontext werden wir den Kontext ‚ÄûEreignisplanung‚Äú nennen.  Aber damit der Sprecher etwas hinzuf√ºgen und Informationen √§ndern kann, muss er sich irgendwie anmelden und ihm m√ºssen einige Rechte einger√§umt werden.  Und dies wird bereits ein anderer Kontext sein, der ‚ÄûIdentit√§tskontext‚Äú, in dem es eine Art eigener Entit√§ten geben wird: Benutzer, Rolle, Profil. <br><br>  Und schau was das Ding hier ist.  Wenn sich eine Person beim System anmeldet und beabsichtigt, Informationen einzugeben, ist dies physisch dieselbe Person, aber in unterschiedlichen Kontexten wird sie von verschiedenen Entit√§ten dargestellt, und diese Entit√§ten sind nicht direkt miteinander verbunden. <br><br>  Wenn wir beispielsweise Speaker von User √ºbernehmen und erben w√ºrden, w√ºrden wir Dinge mischen, die nicht gemischt werden k√∂nnen, und einige Attribute k√∂nnten durch Logik gemischt werden.  Und das Modell w√ºrde den Fokus auf die spezifische Bedeutung verlieren, die es hat, und in mehrere Kontexte unterteilt werden. <br><br><h2>  Demo: Verkaufsservice </h2><br>  Lassen Sie uns ein wenig von der Trockentheorie abweichen und den Code betrachten. <br><br>  Eine Konferenz ist nicht nur die Vorbereitung von Inhalten, sondern auch der Verkauf.  Stellen wir uns vor, ein Service f√ºr den Verkauf von Tickets wurde bereits geschrieben, und ein Verkaufsleiter kommt zu uns und sagt: ‚ÄûLeute!  Wenn jemand diesen Service geschrieben hat, ist mir nicht klar, wie der Rabatt f√ºr Stammkunden ber√ºcksichtigt wird. ‚Äú <br><br>  Nach einem Gespr√§ch mit dem Manager stellen wir fest, dass das gesamte Szenario dieses Service das folgende ist: Wenn Sie auf Kasse klicken, wird der endg√ºltige Ticketpreis unter Ber√ºcksichtigung des regul√§ren Kundenrabattes ber√ºcksichtigt, und die Bestellung wird in den Status "Warten auf Zahlung" versetzt. <br><br>  Der Code, den wir jetzt analysieren, kann separat im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> angezeigt werden. <br><br>  √ñffnen Sie die L√∂sung und sehen Sie sich die Struktur an: <br><br><img src="https://habrastorage.org/webt/hy/wl/j4/hywlj4jodqlkuhsfza7b_gglj2u.png"><br><br>  Es sieht so aus, als ob alles gut aussieht: Es gibt Anwendung und Kern (anscheinend wissen die Leute √ºber Ebenen Bescheid), Repository ... Anscheinend hat die Person die erste H√§lfte von Evans gemeistert. <br><br>  √ñffnen Sie OrderCheckoutService.  Was sehen wir dort?  Hier <a href="">ist der Code</a> : <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Checkout</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ord = _ordersRepository.GetOrder(id); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> orders = _ordersRepository.GetOrders() .Count(o =&gt; o.CustomerId == ord.CustomerId &amp;&amp; o.StateId == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; o.OrderDate &gt;= DateTime.UtcNow.AddYears(<span class="hljs-number"><span class="hljs-number">-3</span></span>)); ord.Price *= (<span class="hljs-number"><span class="hljs-number">100</span></span> - (orders &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">30</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? <span class="hljs-number"><span class="hljs-number">20</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">10</span></span>m : <span class="hljs-number"><span class="hljs-number">0</span></span>)) / <span class="hljs-number"><span class="hljs-number">100</span></span>; ord.StateId = <span class="hljs-number"><span class="hljs-number">1</span></span>; _ordersRepository.SaveOrder(ord); }</code> </pre> <br><br>  Wir betrachten die Linie mit Preis: hier √§ndert sich der Preis.  Wir rufen unseren Verkaufsleiter an und sagen: ‚ÄûHier, kurz gesagt, wird hier der Rabatt ber√ºcksichtigt, alles ist klar‚Äú: <br><br><pre> <code class="cs hljs">ord.Price *= (<span class="hljs-number"><span class="hljs-number">100</span></span> - (orders &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">30</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? <span class="hljs-number"><span class="hljs-number">20</span></span>m : orders &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">10</span></span>m : <span class="hljs-number"><span class="hljs-number">0</span></span>)) / <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br><br>  Er schaut √ºber die Schulter: ‚ÄûOh!  So sieht also Brainfuck aus!  Und sie sagten mir irgendwie, dass die Jungs in C # schreiben. ‚Äú <br><br>  Offensichtlich hat der Entwickler dieses Codes gut auf ein Interview √ºber Algorithmen und Datenstrukturen reagiert.  Ich schrieb in der Schule Olympiaden in etwa dem gleichen Stil.  Nach einiger Zeit finden wir mithilfe von Formatierung und <s>obsz√∂nem</s> Refactoring heraus, was was ist, und erkl√§ren unserem langm√ºtigen Vertriebsleiter, dass die Logik folgende lautet: Wenn die Anzahl der Bestellungen in den letzten 3 Jahren nicht weniger als eins betr√§gt, erh√§lt er 10% Rabatt nicht weniger als drei - 20% und nicht weniger als f√ºnf - 30%.  Er geht freudig - jetzt ist klar, wie das alles funktioniert. <br><br>  Ich denke, viele haben Bob Martins Clean Code gelesen.  Dort sagt er √ºber die Pfadfinderregel: "Der Parkplatz nach unserer Abreise sollte sauberer sein als vor unserer Ankunft."  Lassen Sie uns diesen Code daher so umgestalten, dass er menschlich aussieht und dem entspricht, wor√ºber wir etwas fr√ºher √ºber die allgegenw√§rtige Sprache und ihre Verwendung im Code gesprochen haben. <br><br>  Hier ist der √ºberarbeitete Code. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DiscountCalculator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IOrdersRepository _ordersRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiscountCalculator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IOrdersRepository ordersRepository</span></span></span><span class="hljs-function">)</span></span> { _ordersRepository = ordersRepository; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateDiscountBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> customerId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completedOrdersCount = _ordersRepository.GetLast3YearsCompletedOrdersCountFor(customerId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DiscountBy(completedOrdersCount); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DiscountBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> completedOrdersCount</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (completedOrdersCount &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br><br>  Als erstes √ºbertragen wir die Rabattberechnung auf einen separaten DiscountCalculator, in dem die CalculateDiscountBy customerId-Methode angezeigt wird.  Alles wird menschlich gelesen, alles ist klar: was, warum und wie.  Innerhalb dieser Methode sehen wir, dass wir global zwei Schritte haben, um den Rabatt zu berechnen.  Erstens: Wir erhalten etwas aus dem Auftrags-Repository. Alles h√§ngt vom Benutzerfall ab. Sie m√ºssen nicht einmal hineingehen, wenn dies nicht der Teil ist, der Sie jetzt interessiert.  Tatsache ist, dass wir die Anzahl einiger abgeschlossener Bestellungen erhalten, wonach wir den zweiten Rabatt f√ºr diese Menge sofort als zweiten Schritt betrachten. <br><br>  Wenn wir sehen wollen, wie es betrachtet wird, gehen wir zu DiscountBy, und hier ist fast das gleiche in fast menschlichem Englisch geschrieben, das unsere "Art von Brainfuck" vorher war, alles ist klar und pr√§zise. <br><br>  Die einzige Frage, die sich stellen k√∂nnte, ist, in welchen Einheiten der Rabatt gemessen wird.  Es w√§re m√∂glich, das Wort ‚ÄûProzent‚Äú in den Namen der Methode einzuf√ºgen, um dies zu verdeutlichen. Aus dem Kontext und den Zahlen geht jedoch h√∂chstwahrscheinlich hervor, dass es sich um Prozents√§tze handelt, und der K√ºrze halber kann es weggelassen werden.  Wenn wir sehen m√∂chten, wie viele Bestellungen es gab, gehen wir zum Repository-Code und sehen.  Jetzt werden wir das nicht tun.  In unserem Service m√ºssen wir eine neue DiscountCalculator-Abh√§ngigkeit hinzuf√ºgen.  Und mal sehen, was wir in der zweiten Version der Checkout-Methode erreicht haben. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckoutV2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> orderId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> order = _ordersRepository.GetOrder(orderId); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> discount = _discountCalculator.CalculateDiscountBy(order.CustomerId); order.ApplyDiscount(discount); order.State = OrderState.AwaitingPayment; _ordersRepository.SaveOrder(order); }</code> </pre><br><br>  Schauen Sie, die Checkout-Methode empf√§ngt die Bestell-ID und erh√§lt dann eine Bestell-ID f√ºr die Bestell-ID. Entsprechend der Kunden-ID dieser Bestellung ber√ºcksichtigt sie den Rabatt mithilfe des Rabattrechners, wendet den Rabatt auf die Bestellung an, setzt den Status auf Warten auf Zahlung und speichert die Bestellung.  Wir hatten ein Skript in russischer Sprache auf der Folie, aber hier lesen wir praktisch die √úbersetzung dieses Skripts ins Englische und alles ist klar, alles ist offensichtlich. <br><br>  Sehen Sie, was der Charme ist?  Dieser Code kann jedem angezeigt werden: nicht nur Programmierern, sondern auch Qualit√§tssicherern, Analysten und Kunden.  Sie werden alle verstehen, was passiert, weil alles in menschlicher Sprache geschrieben ist.  Ich benutze dies in unserem Projekt. Die Qualit√§tssicherung kann sich wirklich einige Teile ansehen, im Wiki nachsehen und verstehen, dass es eine Art Fehler gibt.  Weil das Wiki das sagt und der Code etwas anders ist, aber er versteht, was dort passiert, obwohl er kein Entwickler ist.  Auf die gleiche Weise k√∂nnen wir den Code mit dem Analysten besprechen und ihn ausf√ºhrlich besprechen.  Ich sage: "Sehen Sie, so funktioniert es im Code."  Unser letzter Ausweg ist nicht das Wiki, sondern der Code.  Alles funktioniert so, wie es im Code geschrieben steht.  Es ist sehr wichtig, beim Schreiben von Code eine allgegenw√§rtige Sprache zu verwenden. <br><br><img src="https://habrastorage.org/webt/-a/15/pc/-a15pcu9tfp6xjadw-98qlpcxrs.jpeg"><br><br>  Dies ist der dritte wichtige Punkt. <br><br>  Es gibt so viel Verwirrung √ºber Domain-Driven Design in Dingen wie Domain, Subdomain, Bounded-Kontext, wie sie sich auf das beziehen, was sie bedeuten.  Es scheint, dass jeder etwas einschr√§nkt, alle sind irgendwie aufger√§umt.  Aber es ist dann nicht klar, was der Unterschied ist, warum sie so unterschiedlich erfunden sind. <br><br><img src="https://habrastorage.org/webt/tp/zo/nf/tpzonf_lfbysx7pgiiqrxbiineo.jpeg"><br><br>  Domain ist eine globale Sache, es ist ein globaler Themenbereich, in dem dieses spezielle Gesch√§ft Geld verdient.  F√ºr DotNext ist dies beispielsweise eine Konferenz, f√ºr Pyaterochka ein Einzelhandelsverkauf von Waren. <br><br>  Gro√üe Unternehmen k√∂nnen mehrere Dom√§nen haben.  Beispielsweise befasst sich Amazon sowohl mit dem Verkauf von Waren √ºber das Internet als auch mit der Bereitstellung von Cloud-Diensten. Dies sind verschiedene Themenbereiche. <br><br>  Trotzdem ist es etwas Globales und kann nicht direkt automatisiert werden, selbst wenn es schwierig ist, es zu untersuchen.  Zur Analyse wird die Dom√§ne unweigerlich in Subdom√§nen unterteilt, dh in Subdom√§nen. <br><br><img src="https://habrastorage.org/webt/rc/wv/qz/rcwvqzdcicpkiw57o6p1lzunmn4.jpeg"><br><br>  Subdomains sind Teile eines Unternehmens, die in unserer Sprache eng miteinander verbunden sind, dh isolierte logische Prozesse, die auf einer wichtigen Ebene miteinander interagieren. <br><br>  Wenn wir zum Beispiel einen Online-Shop nutzen, wird dies die Bildung und Bearbeitung von Bestellungen sein, es wird die Lieferung sein, dies ist die Arbeit mit Lieferanten, dies ist Marketing, dies ist Buchhaltung.  Hier sind einige dieser Teile - in diese Bereiche ist das Gesch√§ft unterteilt. <br><br><img src="https://habrastorage.org/webt/yc/rc/ub/ycrcubvepugwbmk-xpidrsxc1pu.jpeg"><br><br>  Aus Sicht von DDD werden Subdomains in drei Typen unterteilt.  Und hier m√∂chte ich noch eines sagen: Oft wird die Subdomain in B√ºchern und Artikeln einfach auf Domain reduziert, normalerweise jedoch, wenn sie mit dem Subdomain-Typ kombiniert wird.  Das hei√üt, wenn sie "Core Domain" sagen, meinen sie Core Subdomain, bitte verwechseln Sie dies nicht.  Es hat mich zuerst umgehauen. <br><br>  Subdomains werden in drei Typen unterteilt. <br><br><img src="https://habrastorage.org/webt/a0/vg/jh/a0vgjhuiklcpufzsw_lsdzgisnw.jpeg"><br><br>  Der erste und wichtigste ist Core.  Kern ist die wichtigste Subdomain, dies ist der Wettbewerbsvorteil des Unternehmens, was dieses Unternehmen Geld verdient, wie es sich von seinen Mitbewerbern unterscheidet, sein Know-how, wie auch immer Sie es nennen.  Wenn wir an der DotNext-Konferenz teilnehmen, ist dies der Inhalt.  Sie alle sind wegen Inhalten hierher gekommen. Wenn es hier keine solchen Inhalte g√§be, w√ºrden Sie nicht zu einer anderen Konferenz gehen oder gehen.  Es w√ºrde kein DotNext in der Form geben, in der es ist. <br><br><img src="https://habrastorage.org/webt/up/dr/cc/updrcc6vh3xb0niwkpsuqnrlr-s.jpeg"><br><br>  Der zweite Typ ist Supporting Subdomain.  Dies ist auch eine wichtige Sache, um Geld zu verdienen, es ist auch etwas, ohne das es unm√∂glich ist, aber es ist keine Art von Know-how, ein echter Wettbewerbsvorteil.  Dies wird von der Core Subdomain unterst√ºtzt.  Unter dem Gesichtspunkt der Anwendung von Domain-Driven Design bedeutet dies, dass weniger Aufwand f√ºr die Unterst√ºtzung von Subdomain aufgewendet wird und alle Hauptkr√§fte auf Core geworfen werden. <br><br>  Ein Beispiel f√ºr denselben DotNext ist das Marketing.  Ohne Marketing ist das nicht m√∂glich, sonst h√§tte niemand etwas √ºber die Konferenz gewusst, aber ohne Content-Marketing ist kein Marketing erforderlich. <br><br><img src="https://habrastorage.org/webt/ad/in/ar/adinar6ki4kdf1xnozjylhho9ea.jpeg"><br><br>  Und schlie√ülich die generische Subdomain.  Generisch ist eine typische Gesch√§ftsaufgabe, die in der Regel mit fertigen Produkten automatisiert oder ausgelagert werden kann.  Dies ist auch erforderlich, erfordert jedoch nicht unbedingt eine unabh√§ngige Implementierung durch uns, und dar√ºber hinaus ist es normalerweise eine gute Idee, ein Produkt eines Drittanbieters zu verwenden. <br><br>  Zum Beispiel Tickets verkaufen.  DotNext verkauft Tickets √ºber TimePad.  Diese Subdomain wird von TimePad perfekt automatisiert, und Sie m√ºssen kein zweites TimePad selbst schreiben. <br><br><img src="https://habrastorage.org/webt/38/xi/5c/38xi5cgogl1edatrnmd4jy6o5yg.jpeg"><br><br>  Und schlie√ülich ein begrenzter Kontext.  Begrenzter Kontext und Subdomain befinden sich immer irgendwo in der N√§he, aber es gibt einen signifikanten Unterschied zwischen ihnen.  Es ist sehr wichtig. <br><br><img src="https://habrastorage.org/webt/pa/xm/bo/paxmbosiaaglpdk-fc-38ouji3g.jpeg"><br><br>  Bei StackExchange gibt es eine Frage, wie sich der begrenzte Kontext von der Subdomain unterscheidet.  Subdomain ist ein St√ºck Gesch√§ft, ein St√ºck der realen Welt, es ist das Konzept eines Problem Statement Space.  Der begrenzte Kontext begrenzt das Dom√§nenmodell und die allgegenw√§rtige Sprache, dh das Ergebnis der Modellierung, und dementsprechend ist der begrenzte Kontext das Konzept eines L√∂sungsraums.  W√§hrend der Projektimplementierung findet eine Art Mapping von Subdomains in begrenzten Kontexten statt. <br><br><img src="https://habrastorage.org/webt/ba/91/mi/ba91mikbrcn3l50d_k2dwedusug.jpeg"><br><br>  Ein klassisches Beispiel: Die Buchhaltung als Subdomain, wie der Prozess abgebildet wird, wird automatisiert, z. B. 1C Bookkeeping, Elba oder ‚ÄûMy Business‚Äú - wird von einem Produkt irgendwie automatisiert.  Dies ist der begrenzte Kontext des Rechnungswesens, in dem es seine allgegenw√§rtige Sprache, seine eigene Terminologie gibt.  Das ist der Unterschied zwischen ihnen. <br><br><img src="https://habrastorage.org/webt/fs/y1/lv/fsy1lvc6qabh0flcrli7bkxvpho.jpeg"><br><br>  Wenn wir zu DotNext zur√ºckkehren, werden, wie gesagt, Tickets TimePad zugeordnet, und Inhalte, die unsere Kern-Subdomain sind, werden einer benutzerdefinierten Anwendung zugeordnet, die wir f√ºr die Inhaltsverwaltung entwickeln. <br><br><h3>  Begrenzte Kontextgr√∂√üe </h3><br>  Es gibt einen Moment, der viele Fragen aufwirft.  Wie w√§hle ich die richtige Gr√∂√üe f√ºr den begrenzten Kontext?  In B√ºchern findet man eine solche Definition: "Der begrenzte Kontext muss genau so sein, dass die allgegenw√§rtige Sprache vollst√§ndig, konsistent, eindeutig, eindeutig, konsistent ist."  Coole Definition im Stil eines Mathematikers aus einem ber√ºhmten Witz: sehr genau, aber nutzlos. <br><br>  Lassen Sie uns diskutieren, wie wir es trotzdem verstehen: ob es sich um eine L√∂sung, ein Projekt oder einen Namespace handeln soll - welche Skala sollte an den begrenzten Kontext angeh√§ngt werden? <br><br><img src="https://habrastorage.org/webt/l8/h5/7y/l8h57y11erupofzzpnc3q6li7ei.jpeg"><br><br>  Das erste, was Sie fast √ºberall lesen k√∂nnen: <b>Idealerweise sollte eine Subdomain einem begrenzten Kontext zugeordnet werden</b> , dh durch einen begrenzten Kontext automatisiert werden.  Es klingt logisch, da sowohl dort als auch dort Einschr√§nkungen eines separaten Gesch√§ftsprozesses bestehen. In beiden F√§llen wird in einigen Gesch√§ftsbegriffen eine einzige Sprache angezeigt.  Aber hier m√ºssen Sie verstehen, dass dies eine ideale Situation ist, Sie werden dies nicht unbedingt haben, und es ist nicht notwendig, zu versuchen, dies zu erreichen. <br><br>  Da die Subdomain einerseits sehr gro√ü sein kann und mehrere Anwendungen oder Dienste abgerufen werden k√∂nnen, die sie automatisieren, kann sich herausstellen, dass mehrere begrenzte Kontexte einer Subdomain entsprechen. <br><br>  Aber es gibt eine umgekehrte Situation, in der Regel ist dies typisch f√ºr Legacy.  Das hei√üt, wenn sie eine gro√üe, gro√üe Anwendung erstellt haben, die in diesem Unternehmen alles auf der Welt automatisiert, wird sich das Gegenteil herausstellen.  Eine Anwendung ist ein begrenzter Kontext. Dort wird das Modell wahrscheinlich mehrdeutig sein, aber Subdomains sind nicht aus diesem verschwunden. Ein begrenzter Kontext entspricht mehreren Subdomains. <br><br>  Als die Microservice-Architektur in Mode kam, erschien eine weitere Empfehlung (obwohl sie sich nicht widersprechen): <b>ein begrenzter Kontext pro Microservice</b> .  Wieder klingt es logisch, die Leute machen das wirklich.  Weil der Mikrodienst eine klare Funktion √ºbernehmen muss, die intern eine hohe Konnektivit√§t aufweist und √ºber eine Art Interaktion mit anderen Diensten kommuniziert.  Wenn Sie eine Microservice-Architektur verwenden, k√∂nnen Sie diese Empfehlung selbst √ºbernehmen. <br><br>  Das ist aber noch nicht alles.  Ich m√∂chte Sie noch einmal daran erinnern, dass es bei Domain-Driven Design um viel geht: um die Sprache, um Menschen.  Und Sie k√∂nnen Personen nicht ignorieren und in dieser Angelegenheit nur technische Kriterien erf√ºllen.  Deshalb habe ich folgendes geschrieben: <b>Ein Kontext ist gleich X-Man</b> .  Fr√ºher dachte ich, dass x ungef√§hr 10 ist, aber wir haben ein bisschen mit Igor Labutin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">twitter.com/ilabutin</a> ) gesprochen und die Frage blieb offen. <br><br>  Hier ist es wichtig, dies zu verstehen: Eine einzige Sprache bleibt einheitlich, w√§hrend alle Teilnehmer sprechen, diskutieren und jeder sie eindeutig versteht.  Es ist klar, dass unendlich viele Menschen nicht dieselbe Sprache sprechen k√∂nnen.  Unsere Geschichte der Menschheit zeigt dies deutlich.  In jedem Fall erscheinen einige Dialekte, einige ihrer Bedeutungen, jetzt k√∂nnen Sie sogar Meme hinzuf√ºgen und so weiter.  Auf die eine oder andere Weise wird die Sprache verschwimmen. <br><br>  Daher muss verstanden werden, dass die Anzahl der Personen, die diese einzelne Sprache verwenden und dementsprechend an der Entwicklung und Automatisierung teilnehmen, begrenzt ist.  In den B√ºchern wird auch √ºber einige politische Gr√ºnde gesprochen: Wenn zwei Teams unter der F√ºhrung verschiedener Manager arbeiten und an demselben begrenzten Kontext arbeiten und diese Manager aus irgendeinem Grund nicht miteinander befreundet sind, beginnen Konflikte und der Fokus geht verloren.  Daher ist es viel einfacher und korrekter, f√ºr jeden Befehl zwei begrenzte Kontexte zu erstellen und nicht zu versuchen, das zu kombinieren, was nicht kombiniert wird. <br><br><h2>  Architektur und Abh√§ngigkeitsmanagement </h2><br>  Aus Sicht von Domain-Driven Design spielt es keine Rolle, f√ºr welche Architektur Sie sich entscheiden.  Bei Domain-Driven Design geht es nicht darum, bei Domain-Driven Design geht es um Sprache und Kommunikation. <br><br><img src="https://habrastorage.org/webt/3r/de/2i/3rde2isfgddxyjfzswpj2nvxtbe.jpeg"><br><br>  Unter dem Gesichtspunkt der Kriterien f√ºr die Auswahl der Architektur, die uns aus Sicht des dom√§nengesteuerten Designs interessiert, gibt es jedoch einen wichtigen Punkt: <b>Unser Ziel ist es, die Gesch√§ftslogik von Abh√§ngigkeiten Dritter maximal zu befreien</b> .  Denn sobald Abh√§ngigkeiten von Drittanbietern auftreten, wird die Terminologie angezeigt, und es werden W√∂rter angezeigt, die nicht in eine einzige Sprache eingehen und unsere Gesch√§ftslogik verunreinigen. <br><br><img src="https://habrastorage.org/webt/nz/pw/nu/nzpwnurj_5kkbnmjo6uhosycd1u.jpeg"><br><br>  Schauen wir uns ein klassisches Beispiel f√ºr Architektur an: die bekannte dreischichtige Architektur.  Sobald sie keine Domain-Schicht (hier die Business-Schicht) aufrufen, sind Business, Core und Domain alle gleich.  In jedem Fall ist dies die Schicht, in der sich die Gesch√§ftslogik befindet, und wenn dies von der Datenschicht abh√§ngt, bedeutet dies, dass einige Konzepte aus der Datenschicht irgendwie in die Dom√§nenschicht flie√üen und diese verunreinigen. <br><br><img src="https://habrastorage.org/webt/ft/kh/34/ftkh34ce3zbpt26jx3v8id9vaym.jpeg"><br><br>  Die vierschichtige Architektur ist im Wesentlichen dieselbe, die Dom√§nenschicht h√§ngt immer noch davon ab, und da sie davon abh√§ngt, werden unn√∂tige Abh√§ngigkeiten von Drittanbietern ihren Weg dorthin finden. <br><br><img src="https://habrastorage.org/webt/wz/uv/ky/wzuvky-2bgljcwwarvtseclyqjy.jpeg"><br><br>  Und in diesem Sinne gibt es eine Architektur, mit der dies vermieden werden kann - es ist eine Zwiebelarchitektur (‚ÄûZwiebel‚Äú).  Der Unterschied besteht darin, dass es aus konzentrischen Schichten besteht, die Abh√§ngigkeiten gehen von au√üen nach innen.  Das hei√üt, die √§u√üere Schicht kann von irgendwelchen inneren abh√§ngen, die innere Schicht kann nicht von den √§u√üeren abh√§ngen. <br><br>  Die √§u√üerste Schicht ist die Benutzeroberfl√§che im globalen Sinne (das hei√üt, es handelt sich nicht unbedingt um eine menschliche Benutzeroberfl√§che, es kann sich um eine REST-API oder etwas anderes handeln).  Und die Infrastruktur, die im Allgemeinen oft auch wie E / A aussieht, ist dieselbe Datenbank, in der Tat eine Datenschicht.  All diese Dinge befinden sich in der √§u√üeren Schicht.  Das hei√üt, aufgrund dessen die Anwendung einige Daten, Befehle usw. empf√§ngt, werden sie entfernt und die Dom√§nenschicht wird von der Abh√§ngigkeit von diesen Dingen befreit. <br><br>  Als n√§chstes kommt die Anwendungsschicht - ein ziemlich ganzheitliches Thema, aber dies ist die Schicht, in der sich Skripte und Benutzerf√§lle befinden.  Diese Schicht verwendet die Dom√§nenschicht, um ihre Konzepte zu implementieren. <br><br>  In der Mitte befindet sich die Dom√§nenschicht.  Wie wir sehen, h√§ngt er nicht mehr von irgendetwas ab, er wird eine Sache in sich.  Und deshalb wird die Dom√§nenschicht oft als "Kern" bezeichnet, weil es der Kern ist, der im Zentrum steht, der nicht von Dingen Dritter abh√§ngt. <br><br><img src="https://habrastorage.org/webt/h4/cl/_n/h4cl_nmaowsib1bw1thjvpolr8u.jpeg"><br><br>  Eine der Optionen zur Implementierung einer solchen Zwiebelarchitektur ist die hexagonale Architektur oder ‚ÄûPorts und Adapter‚Äú.  Ich habe dieses Bild zur Einsch√ºchterung mitgebracht, ich werde nicht dar√ºber sprechen.  Am Ende des Beitrags befindet sich ein Link zu einem von einer Million Artikeln √ºber diese Architektur, die Sie lesen k√∂nnen. <br><br><h2>  Ein bisschen √ºber taktische Muster: Separated Interface </h2><br>  Wie ich bereits sagte, sind zum einen die meisten taktischen Muster jedem bekannt, und zum anderen geht es in meinem Bericht darum, dass sie nicht die Essenz sind.  Aber ich mag das Muster der getrennten Schnittstelle separat und ich m√∂chte separat dar√ºber sprechen. <br><br>  Kehren wir zum Code unseres Microservices zur√ºck und sehen, was mit dem Repository passiert ist. <br><br><img src="https://habrastorage.org/webt/jl/c7/_d/jlc7_dwrkqw8mfy4zd1nibrdwti.png"><br><br>  Die Dom√§nenschicht hatte <a href="">die Repository-</a> Schnittstelle IOrdersRepository.cs und deren <a href="">Implementierung</a> OrdersRepository.cs. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DotNext.Sales.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IOrdersRepository</span></span> { <span class="hljs-function"><span class="hljs-function">Order </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveOrder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Order order</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IQueryable&lt;Order&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrders</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> V2 int GetLast3YearsCompletedOrdersCountFor(long customerId); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } }</span></span></code> </pre><br><br>  Hier haben wir eine bestimmte Methode zum Empfangen von Bestellungen f√ºr die letzten drei Jahre hinzugef√ºgt. GetLast3YearsCompletedOrdersCountFor. <br><br>  Und sie haben es in irgendeiner Form implementiert (in diesem Fall √ºber das Entity Framework, aber es kann alles sein): <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLast3YearsCompletedOrdersCountFor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> customerId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> threeYearsAgo = DateTime.UtcNow.AddYears(<span class="hljs-number"><span class="hljs-number">-3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _dbContext.Orders .Count(o =&gt; o.CustomerId == customerId &amp;&amp; o.State == OrderState.Completed &amp;&amp; o.OrderDate &gt;= threeYearsAgo); }</code> </pre><br><br>  Sehen Sie, was das Problem ist.  Das Repository landete in der Dom√§nenschicht, seine Implementierung in der Dom√§nenschicht, aber der Code, beginnend mit DateTime.UtcNow.AddYears (-3), geh√∂rt nicht von Natur aus zur Dom√§nenschicht und ist keine Gesch√§ftslogik.  Ja, LINQ macht es mehr oder weniger humanisiert, aber wenn es hier zum Beispiel SQL-Abfragen g√§be, w√§re alles v√∂llig traurig. <br><br>  Die Bedeutung des Musters der getrennten Schnittstelle besteht darin, dass die Dienstschnittstelle, die wir in der Dom√§nenlogik verwenden, in der Dom√§nenschicht deklariert wird.  Wir sprechen von Repositorys und √§hnlichen Diensten, bei denen die Details der Implementierung dieser Dienste keine Gesch√§ftslogik sind.  Die Gesch√§ftslogik ist die Tatsache, dass diese Dienste vorhanden sind und dass sie in der Dom√§nenschicht aufgerufen und verwendet werden.  Daher verbleibt die Repository-Schnittstelle in der Dom√§nenschicht, und die Implementierung wird in die Infrastrukturschicht verschoben. <br><br>  Ich habe eine andere Option vorbereitet.  Die Repository-Schnittstelle verbleibt in der Core-Assembly, die Implementierung wird jedoch in Infrastructure.EF verschoben. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rh/k0/b_/rhk0b_dgbqe72y--hxcx13qlqco.png"></div><br><br>  Daher haben wir die Konzepte, die der Dom√§nenschicht nicht eigen waren, in die Infrastruktur aufgenommen.  Als Nebeneffekt k√∂nnen wir diese Infrastruktur durch eine andere Implementierung ersetzen.  Dies ist jedoch nicht das Hauptziel, sondern, wie gesagt, die Dom√§nenlogik von Abh√§ngigkeiten von Drittanbietern zu befreien. <br><br><h2>  Noch einmal √ºber die Sprache </h2><br>  Reden wir immer wieder √ºber die Sprache. <br><br>  Zu Beginn haben wir das Domain-Modell ‚ÄûSpeaker-Talk-Event‚Äú erstellt.  Ich denke, dass niemand spezielle Fragen aufgeworfen hat. <br><br>  Und hier ist das Szenario, auf dessen Grundlage wir dieses Dom√§nenmodell erstellt haben: <br><br><img src="https://habrastorage.org/webt/2r/go/hp/2rgohppxhq7iqwvndfimzctuit8.jpeg"><br><br>  Das Skript ist in Russisch und das Domain-Modell in Englisch. <br><br>  F√ºr nicht englischsprachige Entwickler ist dies etwas, mit dem Sie st√§ndig leben m√ºssen. <br><br><img src="https://habrastorage.org/webt/jm/3p/rf/jm3prfqcjwydo3mg2c1p0zh3olc.jpeg"><br><br>  Jeder von Ihnen f√ºhrt diesen Prozess h√∂chstwahrscheinlich st√§ndig durch: √ºbersetzt vom Russischen ins Englische und umgekehrt.  Diejenigen, die mit englischsprachigen Kunden und Projekten arbeiten, sind etwas einfacher, da die Anforderungen auf Englisch sind, Gespr√§che mit Kunden auf Englisch, in der Regel alle Szenarien auf Englisch, der Code auf Englisch und nur die Kommunikation innerhalb des Teams auf Russisch, die schnell auf Englisch w√§chst (Kunde - Kunde, Bestellung - Bestellung).  Und diese kognitive Belastung, dieser Overhead, der durch eine st√§ndige √úbersetzung entsteht, l√§sst ein wenig nach. <br><br>   ,     ,        ,    .    ,    . <br><br>         1,        .   ,  ‚Äî    ,     ,          . <br><br><img src="https://habrastorage.org/webt/1e/b7/jh/1eb7jhuiy5i1ft1bsfrnu1x7_9u.jpeg"><br><br>      1. PascalCase  ,     ,     ,     <s></s>  ,      ,    , ,  - -     . <br><br>  ,  -  ? <br><br><img src="https://habrastorage.org/webt/lj/js/vd/ljjsvdrqh4v9117mps2yrelyxna.jpeg"><br><br>   ,     use case,   ,     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> ,   .        C#,  ,  , .       ,    ,   ,  . <br><br>        ,  ,      Domain-Driven Design.      ,   ,    , ,        C#    .                    . <br><br>   ,      -  Continuous Integration.  ,       ,    , -   - .   ,     -  ,   ,  .  ,  95%      ,      ,  Continuous Integration,  , TeamCity .   . <br><br>               ,          .  Nein.   ,           1-,  ,    .        ¬´¬ª  ,     .    ,   ,    . <br><br><img src="https://habrastorage.org/webt/qh/ff/32/qhff32udhgwxb4cav3gjjoakn4e.jpeg"><br><br>         ,   Domain-Driven Design. <br><br>  ‚Äî  ,   . Domain-Driven Design ‚Äî    ,    .  ‚Äî    ,  ,          ubiquitous language.     ,     ,   .      ,   ,      ,        . <br><br>  Weiter.    ,  .    - ,      ,    ,     ,  ,     ,  ,  ,  ,      ,  ‚Äî .     . <br><br>       .      .      .      .   ,    ,      .        DSL-.        .NET-,     - ,    ,  ,  ,   .   ,     . <br><br> , -    .    ,    ,     ubiquitous language  -.     . <br><br><h2>    </h2><br><ul><li> <b>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">marshinov</a> </b> .    ,      DDD: , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">¬´   DDD, CQRS  Event Sourcing    ¬ª</a> .    ,    ,      . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> ,  AutoMapper   MediatR.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> ,       Domain-Driven Design,      . </li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">¬´F# for fun and profit¬ª</a> ,   ,   F#  Domain-Driven Design.  ,  ,   ,    . </li><li>  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>    ,   . </li></ul><br>   , ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  GitHub</a> . <br><br><blockquote>   DotNext: <br>   , ¬´       ,     ¬ª.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>  <b>DotNext</b> ( <b>15-16   </b> )     .    ,   1   ,         . <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de440772/">https://habr.com/ru/post/de440772/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de440756/index.html">Serverloses CI / CD unter AWS</a></li>
<li><a href="../de440758/index.html">Treffen Sie sich bei Acronis! (Moskau, Fiztehpark)</a></li>
<li><a href="../de440760/index.html">Das neue goldene Zeitalter f√ºr Computerarchitektur</a></li>
<li><a href="../de440762/index.html">Arbeitgeberbewertungen: Art und Bedeutungslosigkeit anonymer Bewertungen</a></li>
<li><a href="../de440766/index.html">Von Geeks zu Geeks: Geschenke f√ºr den 23. Februar</a></li>
<li><a href="../de440774/index.html">Schwerwiegende mathematische NHTSA-Fehler erm√∂glichen es Tesla, die Sicherheit des Autopiloten zu beanspruchen</a></li>
<li><a href="../de440776/index.html">E-Mail, Innenansicht</a></li>
<li><a href="../de440778/index.html">Zweites OpenStack-Treffen bei Mail.ru Group: 22. Februar</a></li>
<li><a href="../de440780/index.html">Google blockiert keine Werbeblocker von Drittanbietern im Chromium-Browser</a></li>
<li><a href="../de440782/index.html">Ich gehe tiefer in den Untergrund oder was Sie wissen sollten, um die Netzwerkanwendung zu optimieren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>