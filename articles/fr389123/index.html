<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÜüèæ üïµüèº üë©üèæ‚Äçüéì M√©thodes de d√©bogage d'un logiciel de microcontr√¥leur dans un entra√Ænement √©lectrique üë©üèΩ‚Äçü§ù‚Äçüë®üèø üí£ üåßÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comment d√©boguer des programmes de microcontr√¥leur? Le JTAG est pris, l'oscilloscope est un couple de jours / semaines et le programme est d√©bogu√©. Ce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√©thodes de d√©bogage d'un logiciel de microcontr√¥leur dans un entra√Ænement √©lectrique</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/npf_vektor/blog/389123/"><img src="https://habrastorage.org/files/95f/7de/cb5/95f7decb5aa64618b6ad35270c2e753f.JPG" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment d√©boguer des programmes de microcontr√¥leur? Le JTAG est pris, l'oscilloscope est un couple de jours / semaines et le programme est d√©bogu√©. Ce sera une r√©ponse typique, et dans la plupart des cas elle sera correcte ... Mais pas toujours. Les microcontr√¥leurs r√©solvent des probl√®mes tr√®s diff√©rents, et dans cet article, nous examinerons ce qu'il faut faire si vous avez besoin de d√©velopper un logiciel de bas niveau encombrant pour contr√¥ler tout √©quipement √©lectrique de puissance, par exemple, les convertisseurs de fr√©quence pour les moteurs √©lectriques, les convertisseurs de charge de batterie DC / DC pour les trains, les correcteurs de puissance, les servos et etc. √âquipement, o√π les kiloamp√®res circulent et kilovolts PWM, o√π chaque commutation des cl√©s de l'onduleur IGBT est compt√©e, o√π le temps de r√©ponse du microcontr√¥leur √† une situation anormale est mesur√© en microsecondes, et l'√©quipement lui-m√™me dans des cas scell√©s est install√© et utilis√© quelque part dans les usines de Yakoutie.Si vous voulez savoir quelles fonctionnalit√©s cela impose aux m√©thodes de d√©bogage, bienvenue dans cat.</font></font><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caract√©ristiques des syst√®mes de contr√¥le de d√©bogage</font></font></h1><br>
<img src="https://habrastorage.org/files/b75/1ed/df5/b751eddf52ae41f4afbb776f6c31055c.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelles sont les caract√©ristiques du d√©bogage des microcontr√¥leurs (MK) qui effectuent de telles t√¢ches? </font><font style="vertical-align: inherit;">Premi√®rement, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lorsque MK fonctionne avec un √©quipement √©lectrique, il ne peut pas √™tre arr√™t√©.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MK √† l'aide de PWM contr√¥le les touches de puissance, r√©gule de nombreuses valeurs dans ses couloirs - courants des phases du moteur, tension du circuit interm√©diaire, vitesse, position du corps de travail, etc. Si vous arr√™tez le MK tout en travaillant au point d'arr√™t, alors dans le meilleur des cas, l'√©quipement s'√©teindra en raison de la protection mat√©rielle, et dans le pire des cas, tout explosera simplement (si les interrupteurs d'alimentation restent allum√©s en position "un" ou avec un cycle de service). Par cons√©quent, la m√©thode classique de d√©bogage consiste √† ¬´parcourir les √©tapes avec le d√©bogueur¬ª dans de telles t√¢ches. Vous ne pouvez donc ex√©cuter sur la table que des modules logiciels ¬´compl√®tement bruts¬ª avant leur premi√®re int√©gration sur des √©quipements r√©els.</font></font><br>
<br>
<img src="https://habrastorage.org/files/0ec/67d/061/0ec67d061c1d4bdc86b3c0fff1a21003.png" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deuxi√®mement, c'est la complexit√© des logiciels de bas niveau. La taille de la section de code de programme .text est de 50 √† 200 Ko pour le code de programme qui contr√¥le exclusivement le mat√©riel (sans pilotes de communication de haut niveau, etc.) - c'est une situation typique pour un microcontr√¥leur de certains servo variateurs industriels. Par cons√©quent, les microcontr√¥leurs de la s√©rie motorcontrol sont utilis√©s pour de telles t√¢ches, qui combinent √† la fois des p√©riph√©riques tr√®s d√©velopp√©s, de hautes performances et une taille de m√©moire relativement grande (pour MK). Comme exemple des MK import√©s, on peut citer les instruments MK 32 bits de la s√©rie Texas Instruments C2000, de la puce K1921VK01T domestique de NIIET OJSC. Les logiciels pour ces MK contiennent g√©n√©ralement des dizaines ou des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">centaines de milliers de lignes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code C / C ++ optimis√© parfait, qui ne peut tout simplement pas √™tre d√©bogu√© en "clignotant une LED", "printfom in UART" ou en observant le fonctionnement des jambes d'un oscilloscope externe. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e1a/d3e/2e5/e1ad3e2e5e394042886eb06b707c14f7.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Troisi√®mement, le contr√¥leur du syst√®me de commande de l'entra√Ænement √©lectrique se trouve le plus souvent √† l'int√©rieur du convertisseur de puissance, dont le bo√Ætier est ferm√©, et parfois m√™me scell√©. Par cons√©quent, l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acc√®s via JTAG est d√©j√† un gros probl√®me,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne serait-ce que pour le firmware (hors tension). Et un probl√®me encore plus grave est le d√©bogage JTAG avec la mise sous tension. Ici, le JTAG n√©cessairement isol√© galvaniquement et insonoris√© doit √™tre utilis√© (nous utilisons pour MK TI JTAG SAURIS avec isolation galvanique int√©gr√©e - cher, mais cela fonctionne). </font></font><br>
<br>
<img src="https://habrastorage.org/files/e0c/89b/f08/e0c89bf08ca143d1a7f1760ca39b7dc2.png" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quatri√®mement, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas de syst√®mes d'exploitation!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous pouvons pr√©voir comment certaines personnes ont l'id√©e ¬´eh bien, puisque vous avez une t√¢che si difficile, mettez un microcontr√¥leur normal avec Linux et √©crivez des applications r√©guli√®res pour cela, en mettant √† jour le logiciel √† partir d'un lecteur flash¬ª. Les syst√®mes de contr√¥le des √©quipements √©lectriques sont des syst√®mes en temps r√©el tr√®s difficiles. Ce n'est pas que Linux, m√™me tous les syst√®mes d'exploitation sp√©cialis√©s en temps r√©el ne conviennent pas √† de telles t√¢ches. Par exemple, l'interruption de l'ADC par la lecture et la moyenne des donn√©es analogiques peut √™tre provoqu√©e avec une fr√©quence allant jusqu'√† 100 kHz. En m√™me temps, il ne contiendra qu'une douzaine ou deux lignes de code - collecte de donn√©es des canaux analogiques, quelques v√©rifications des protections √† haute vitesse et sortie - tout, rien d'autre √† faire. Si vous indiquez une telle interruption √† un planificateur de t√¢ches du syst√®me d'exploitation, alors simplement sa propre ex√©cution prendra plus de ressources. Sans oublier que, en particulier,pour Linux, au lieu d'une puce MK, vous devez en mettre deux de plus sur la carte - RAM externe et m√©moire flash, allouer un tas de pattes en cristal pr√©cieuses, utiliser une carte √† six couches pour un c√¢blage appropri√©, obtenir un temps de d√©marrage MK √©norme (parfois en cas de panne de courant ou d'une minuterie de surveillance) commencer √† travailler avant l'arr√™t du moteur!), avoir des probl√®mes avec l'int√©grit√© du syst√®me de fichiers, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, la cinqui√®me caract√©ristique - les syst√®mes de contr√¥le de bas niveau pour les entra√Ænements √©lectriques et autres √©quipements √©lectriques (contrairement aux t√¢ches de communication sur diff√©rentes interfaces, les automates programmables, les contr√¥leurs de toutes sortes d'alarmes, les t√©l√©commandes, etc.) impl√©mentent principalement des algorithmes de syst√®mes de contr√¥le automatique. √Ä savoir: la moiti√© du logiciel se compose de diff√©rents types de structures ferm√©es avec des contr√¥leurs PID, des blocs de saturation, des zones mortes, des tableaux de d√©pendance les uns des autres, des filtres, des observateurs, des ajusteurs d'intensit√©, des planificateurs de mouvement et autres. Les calculs dans ces logiciels sont effectu√©s avec une certaine fr√©quence - disons, √† une fr√©quence de 10 kHz, une interruption est d√©clench√©e et calcule tous les blocs r√©pertori√©s, qui forment ensemble la structure de contr√¥le de l'√©quipement n√©cessaire. Dans de tels algorithmes, le d√©bogage √©tape par √©tape n'aide pas - le plus souvent, √† chaque √©tape, chaque module g√©n√®re cece qu'on attend de lui - en fait, tous ces filtres, r√©gulateurs, etc. sont d√©j√† d√©bogu√©s depuis des ann√©es et il y a peu de surprises l√†-bas.</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des probl√®mes surviennent pendant le fonctionnement de l'ensemble de la structure dans son ensemble - chaque unit√© fonctionne individuellement et le processus de r√©glementation souhait√© ne se produit pas comme pr√©vu</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Et les probl√®mes se trouvent dans l'ajustement de centaines de param√®tres et de coefficients de ces blocs, ainsi que dans la structure assembl√©e √† partir d'eux - il peut s'av√©rer que vous devez ajouter un nouveau circuit de stabilisation quelque part, ajouter un bloc de pr√©diction, des restrictions, etc. Par cons√©quent, c'est une autre "pierre dans le jardin" des messages de d√©bogage √©tape par √©tape et de d√©bogage printf: vous devez d√©boguer plus souvent qu'autrement le code du programme lui-m√™me, mais la structure de contr√¥le automatique assembl√©e. Si quelqu'un a peu d'id√©e de ce que c'est (structure), alors voici la structure la plus simple d'une commande vectorielle sans capteur d'un moteur synchrone:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/bfd/b52/e6d/bfdb52e6d24c4d4ab7fac47a46fc8dd6.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chaque case est parfois constitu√©e de quelques formules, et parfois d'un module sur une douzaine ou deux pages de code. </font><font style="vertical-align: inherit;">Le module poss√®de des entr√©es / sorties, ainsi que certaines variables d'√©tat (par exemple, la partie int√©grante du r√©gulateur PI, etc.). </font><font style="vertical-align: inherit;">Ceux qui le souhaitent peuvent √©galement voir une structure similaire sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la page Wikipedia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√âtant donn√© que le syst√®me de commande est ferm√©, le mauvais fonctionnement d'une unit√© (ou son r√©glage incorrect) conduit √† l'inop√©rabilit√© de l'ensemble de la structure. </font><font style="vertical-align: inherit;">Et trouver exactement o√π est le probl√®me - c'est une autre t√¢che.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment le d√©boguer?</font></font></h1><br>
<img src="https://habrastorage.org/files/ff6/921/70e/ff692170e60d460ba420efd360713681.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors que faire, comment le d√©boguer? Un oscilloscope externe? N'aidera pas. L'oscilloscope, bien s√ªr, est n√©cessaire pour d√©boguer certains probl√®mes purement mat√©riels, mais ils ne peuvent voir que les valeurs d'entr√©e et de sortie du microcontr√¥leur, et des centaines de variables √† l'int√©rieur de la structure resteront dans les coulisses. Eh bien, vous verrez que le courant de phase du moteur saccade √©trangement et que la tension de sortie de l'onduleur saccade √©trangement. Et pourquoi - quel bloc √† l'int√©rieur du logiciel MK conduit √† cela (ou un moteur ou un capteur de position ou autre chose conduit √† cette courbe) - reste incertain. </font></font><br>
<br>
<img src="https://habrastorage.org/files/cb4/56d/195/cb456d1959b148e18c758a60bcbf4b1d.png" align="right"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mod√®le? Oui, c'est une bonne aide.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le plus souvent, le d√©veloppement de structures de gestion complexes commence par la mod√©lisation. En termes de TAU et sous forme d'√©quations diff√©rentielles, l'objet de contr√¥le est d√©crit, le syst√®me de contr√¥le propos√© est construit (comme dans la figure ci-dessus, par exemple), puis tout cela est r√©alis√© ... eh bien, qui aime quoi, mais la norme de facto est Simulink Matlab. Dans ce document, vous pouvez ¬´dessiner¬ª une structure avec un mod√®le de l'objet de contr√¥le, en utilisant ¬´l√¢che¬ª sous la forme d'int√©grateurs, d'additionneurs, de fonctions de transition, etc. Vous pouvez utiliser son package pour mod√©liser des circuits √©lectriques, o√π il y a des cl√©s IGBT pr√™tes √† l'emploi, des moteurs √©lectriques, des r√©sistances, des condensateurs et plus encore, donnant √† la merci des programmeurs matlab la mise en ≈ìuvre du trac√© sous la forme d'√©quations diff√©rentielles, et dessiner la structure de contr√¥le elle-m√™me d√©j√† sous la forme de ¬´feuilles mobiles¬ª elle-m√™me.Et vous pouvez √©crire tous les blocs n√©cessaires dans matlab en C. Cette m√©thode est pratique dans la mesure o√π le code de programme d√©bogu√© dans le matlab peut simplement √™tre copi√© sur le microcontr√¥leur. Habituellement, cette √©tape suit toujours le ¬´dessin¬ª, lorsque la structure du syst√®me de contr√¥le apr√®s un travail de recherche approximatif sur la mod√©lisation est plus ou moins form√©e. Mais souvent, les param√®tres de l'objet sont inconnus a priori, ou ils sont connus de mani√®re tr√®s impr√©cise - jamais auparavant le logiciel fonctionnant dans le mod√®le n'a commenc√© √† fonctionner aussi bien sur l'objet. Il est √©galement impossible de mettre "tout" dans le mod√®le - transistors de commutation transitoires, saturation du circuit magn√©tique, courants de Foucault, couplage capacitif, param√®tres flottants de la temp√©rature et d'instance en instance, interf√©rences ici et l√† ... Et parfois, l'objet de r√©gulation est si compliqu√©,qu'il est plus facile de faire le d√©veloppement d'une structure de contr√¥le pour elle directement sur le site.</font></font><br>
<blockquote><i>,                 ,   ()  -    .        ,        ,     ¬´¬ª  ‚Äì      ,    ,       - ? (   ‚Äì  ,   ¬´  ¬ª,   ).</i></blockquote><br>
<br>
<img src="https://habrastorage.org/files/87d/3fa/b55/87d3fab5514c4539abcba708c6601d24.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe √©galement un certain nombre de produits qui vous permettent de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"dessiner" des programmes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directement pour les microcontr√¥leurs. Y compris le m√™me Matlab est capable de g√©n√©rer du code C pour les marques c√©l√®bres MK bas√©es sur le mod√®le de Simulink. Apparemment, vous pouvez dessiner et d√©boguer la structure dessin√©e du syst√®me de contr√¥le sur l'ordinateur dans le mod√®le, puis la t√©l√©charger sur MK - et vous avez termin√©, c'est parti! Et m√™me de tels environnements vous permettent de d√©boguer des structures de contr√¥le dessin√©es directement √† l'int√©rieur du MK, de surveiller les variables, etc., et sur les sites de ces produits, il existe un tas de projets de d√©monstration pour les syst√®mes les plus complexes, ¬´programm√©s¬ª de cette fa√ßon. Mais comme tous les projets r√©els sont toujours programm√©s avec des ¬´mains¬ª pour une raison quelconque, nous pouvons deviner que quelque chose ne va pas avec le ¬´dessin¬ª. Mais ici, il est m√™me difficile de d√©crire ce qui est exactement, sinon, c'est tout. Le principal argument contre</font></font><b>‚Äì        </b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Vous appuyez sur un bouton dans un tel environnement ¬´bien faire¬ª et esp√©rez que le g√©n√©rateur de code fera le reste pour vous. Pour certains syst√®mes simples, o√π les performances MK sont ¬´derri√®re les yeux¬ª, le calendrier de d√©veloppement est tr√®s serr√©, et personne ne sait comment programmer dans l'entreprise qui a lanc√© le projet ... alors oui, vous pouvez probablement essayer de ¬´dessiner¬ª le programme. Mais si cela ne fonctionne pas comme il se doit, ou aura un probl√®me tr√®s sp√©cifique, il n'y aura plus aucune chance de le d√©boguer. Et pour une t√¢che complexe, o√π m√™me lorsque la programmation avec les mains avec des performances MK est toujours un probl√®me, le dessin ne convient pas simplement en raison du manque de ressources - tout langage de programmation qu'il est de niveau sup√©rieur (beaucoup plus √©lev√© que le dessin) g√©n√®re un code machine moins optimal. Et les optimisations de bas niveau qu'un programmeur C feraitun tel syst√®me ne sera pas en mesure de le faire (calcul de blocs de la m√™me structure avec des horloges diff√©rentes, utilisation de valeurs mises en cache de sinus et cosinus, remplacement des fonctions de division par multiplication par une valeur pr√©-pr√©par√©e, ou des choses absolument d√©licates comme</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tels</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc.). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, vous devez √©crire votre logiciel et √©crire en C.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et d'une mani√®re ou d'une autre, vous devez d√©boguer votre logiciel, et c'est n√©cessaire sur l'objet. Probablement, tout le monde √† ce stade de l'article a d√©j√† compris que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la structure de contr√¥le ne peut √™tre d√©bogu√©e qu'en consultant les oscillogrammes des variables internes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-√†-dire voir les graphiques au fil du temps, comment telle ou telle variable en C change - disons, "la sortie de ce bloc, le cinqui√®me √† partir de la gauche, simultan√©ment avec les entr√©es du troisi√®me √† partir de la droite". Obtenir des images comme celle-ci:</font></font><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/files/0e0/2cc/c45/0e02ccc455504d699a7f8dfc02617634.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et cela ne peut se faire qu'au moyen du microcontr√¥leur lui-m√™me. Vous ne pouvez pas simplement prendre et mettre en place l'interface de communication rapide externe et envoyer ¬´en haut¬ª la valeur d'une variable, aussi rapidement que possible, et cr√©er un graphique dans le syst√®me de niveau sup√©rieur. Parce qu'aucune interface de communication MK n'aura le temps de le faire avec la fr√©quence √† laquelle les transitoires r√©gul√©s se produisent. Et si vous r√©ussissez, toutes les ressources MK iront √† la maintenance de cette interface de communication. Par cons√©quent, ils le font - ils </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enregistrent la forme d'onde dans la RAM de MK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">juste dans un tableau. Habituellement, beaucoup de points ne sont pas n√©cessaires - il suffit de saisir le bon moment pour √©crire exactement les donn√©es: mettez le bon d√©clencheur au d√©but de l'enregistrement. Et puis vous pouvez voir ce que ces ou ces blocs du syst√®me de contr√¥le distribuaient au moment de l'√©chec, comment il se d√©veloppait, ce que MK essayait de faire. Bien s√ªr, toutes les variables ne peuvent pas √™tre imm√©diatement oscill√©es simultan√©ment - mais dans la pratique, selon notre exp√©rience, il y a, disons, quatre tableaux de 256 points chacun - une sorte d'oscilloscope √† quatre canaux utilisant des outils MK. Si l'√©quipement fonctionne plus d'une fois par semaine, le d√©bogage n'est pas un probl√®me - dans une exp√©rience, nous examinons ces 4 variables, dans la suivante, nous rempla√ßons la moiti√© par les autres, regardons √† nouveau ... jusqu'√† ce qu'une unit√© d√©fectueuse soit trouv√©e, ou jusqu'√† ce que nous supprimions tout ce qui se passe sur tous les blocs et ne laissez pas regarder les "images", gratter l'endroit qui pense quoi ...</font></font><br>
<br>
<img src="https://habrastorage.org/files/e35/ad1/99c/e35ad199c3054cf88227b00e60ea4e42.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment filmer de tels oscillogrammes? Quel logiciel peut faire cela? Quelle interface de communication cela transmet-il? En fait, Texas Instruments est donc le leader dans la production de microcontr√¥leurs de motocontr√¥le, car il a tout fait pour cela: Code Composer Studio (leur environnement de d√©veloppement) plus MK en temps r√©el. Le mode temps r√©el est lorsque, via le JTAG, l'environnement de d√©veloppement peut demander et √©crire des donn√©es dans la m√©moire RAM du MK sans l'arr√™ter. M√™me pas seulement sans s'arr√™ter, mais sans la moindre interruption de son travail. Ce mode est disponible dans tous les MK de la s√©rie C2000, mais il n√©cessite le JTAG cher et rapide pour l'utiliser, ce qui le prend en charge. Mais en plus du mode lui-m√™me, le MK devrait avoir quelque chose de correspondant √† l'arri√®re du c√¢ble: l'environnement de d√©veloppement Code Composer Studio est capable de cr√©er des formes d'onde hors de la bo√Æte.De plus, √† la fois dans le mode le plus simple, lorsque l'utilisateur d√©finit le nom de la variable C et voit son changement dans le temps sur le graphique, et que l'environnement demande des donn√©es avec la fr√©quence √† laquelle il peut (g√©n√©ralement bon, si Hertz 10), et dans le mode d'affichage du tableau en m√©moire dans forme d'onde - c.-√†-d. juste ce qui est d√©crit ci-dessus.</font></font><b> ,     ,      ,  Code Composer Studio  JTAG       .</b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le m√™me temps, l'appareil peut continuer √† fonctionner comme si de rien n'√©tait. Cet outil est utilis√© avec succ√®s depuis plus de dix ans et, en fait, une telle id√©ologie de d√©bogage (il semble, mais je peux me tromper) a √©t√© propos√©e par le Texas. Dans tous leurs projets de d√©monstration, il existe un module d'enregistreur de donn√©es (qui enregistre des tableaux de formes d'onde) et les manuels d√©crivent comment l'utiliser. Au fait, ici, vous devez jeter une pierre dans le jardin ARM. Ils ont √©galement un mode en temps r√©el, et sur cette architecture, il y a des MK qui peuvent contr√¥ler les moteurs √©lectriques. Cependant, dans aucun environnement de d√©veloppement, je suis tomb√© sur une fonction graphique, m√™me si le mode temps r√©el est pris en charge. Par exemple, dans Keil est le bien-aim√© de tout le monde, il est m√™me impossible de changer normalement la valeur d'une variable sur un MK en cours d'ex√©cution - elle est constamment mise √† jour,et la nouvelle valeur entr√©e par l'utilisateur dans la fen√™tre est effac√©e ... Sans parler des graphiques. Peut-√™tre que quelqu'un dans les commentaires sugg√©rera une option de travail? Ou est-ce "personne n'a besoin" et ne fonctionne donc pas?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais il y a un probl√®me avec cette m√©thode de d√©bogage, m√™me via Code Composer Studio. </font><font style="vertical-align: inherit;">Et ce probl√®me est JTAG. </font><font style="vertical-align: inherit;">Comme cela a √©t√© dit, son connecteur n'est pas toujours disponible, et le plus souvent sur des √©quipements en marche et n'est pas du tout disponible. </font><font style="vertical-align: inherit;">Et, franchement, ce n'est </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas tr√®s confortable de s'asseoir √† quelques m√®tres du convertisseur m√©gawatt, de regarder ses oscillogrammes de travail,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et tr√®s concentr√© et concentr√© pour contourner le bouton "stop" du microcontr√¥leur avec la souris, et si un doigt tremblait en cours de route? </font><font style="vertical-align: inherit;">Savez-vous comment le pav√© tactile est bogu√© lors de l'utilisation d'un PWM puissant? </font><font style="vertical-align: inherit;">Et si l'environnement √©choue? </font><font style="vertical-align: inherit;">Et JTAG? </font><font style="vertical-align: inherit;">Tout, larges?</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Babakh ordinaire</font></font></b><div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/files/de8/e31/f38/de8e31f38400412aaa02056649add98c.jpg"></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, les formes d'onde dans l'environnement de d√©veloppement sont affich√©es dans les valeurs ¬´telles quelles¬ª en C, sans aucune mise √† l'√©chelle, dans diff√©rentes fen√™tres des graphiques, sans unit√©s de mesure personnalis√©es (rappelez-vous que dans ce graphique 0,342 sont des volts, ils doivent √™tre multipli√©s dans l'esprit par 540 pour obtenir des unit√©s physiques, et ici 1,2 sont des amp√®res avec une √©chelle de 800A). </font><font style="vertical-align: inherit;">Et inconfortable et effrayant. </font><font style="vertical-align: inherit;">Et pourtant, tous les MK et environnements de d√©veloppement ne peuvent pas regarder les oscillogrammes! </font><font style="vertical-align: inherit;">Soudain, ce n'est pas le Texas? </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par cons√©quent, nous avons d√©cid√© d'inventer une autre fa√ßon.</font></font></b><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notre d√©cision</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, si nous n'avons pas besoin d'un d√©bogage √©tape par √©tape, quel est le probl√®me? </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous rempla√ßons tout ce que nous faisons via JTAG par toute autre interface de communication</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et cr√©ons notre propre shell de niveau sup√©rieur, qui construit les graphiques comme nous le souhaitons. </font><font style="vertical-align: inherit;">Profit!</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/64f/f8d/f37/64ff8df373724e92af81eb389bc1becc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous l'avons donc fait. Interface de communication que nous avons choisie CAN, protocole - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CANopen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pourquoi? CAN est une tr√®s bonne interface de communication industrielle, r√©sistante au bruit, a un arbitrage mat√©riel, un acc√®s non destructif au bus, une confirmation mat√©rielle des packages, et en m√™me temps - seulement deux fils et la terre. C'est mieux que tous les RS, et moins monstrueux qu'Ethernet (ce qui est plut√¥t exotique sur motorcontrol MK). Pourquoi canopen? En fait, il existe deux protocoles communs pour CAN, ce sont J1939 (¬´automobile¬ª) et CANopen (machines-outils, automatisation, capteurs, etc.). Il n'y a pas beaucoup de diff√©rence entre eux, mais CANopen nous a sembl√© plus flexible, nous l'avons donc impl√©ment√© dans notre propre pile (driver). Qui ne sait rien de CANopen - sa fonction principale, comme de nombreux protocoles pour MK, est de donner acc√®s au dictionnaire des objets (liste des variables en C MK) √† une adresse sp√©cifique. Cela peut se faire de deux mani√®res principales:Messages SDO du type requ√™te-r√©ponse, ainsi que messages PDO sous forme de valeurs d'envoi constantes par temporisateur ou √©v√©nement (d√©finit le niveau sup√©rieur de ce qui doit √™tre envoy√© et quand). Il existe √©galement divers services de services tels que des messages d'urgence, des messages sur la pr√©sence d'appareils sur le r√©seau (battement de c≈ìur), etc. Un assistant sur le r√©seau n'est pas n√©cessaire: celui qui veut - envoie, √† qui il veut - accepte.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/5e6/c70/423/5e6c70423a3840419cb3b46741987eb4.png" align="left"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons cr√©√© la pile CANopen non seulement pour MK, mais aussi pour l'ordinateur sous la forme d'une biblioth√®que. Et d√©j√† sur sa base, Windows a √©crit son propre environnement de haut niveau. D'abord, ils ont simplement rendu l'acc√®s aux variables du dictionnaire d'objets afin qu'il √©tait possible de regarder et de modifier les param√®tres du syst√®me de contr√¥le (et il y en a des centaines, en passant!), Ensuite, ils ont fait des graphiques en interrogeant p√©riodiquement le param√®tre du dictionnaire d'objets sur le r√©seau, puis ont ajout√© le chargement des formes d'onde des tableaux MK (de plus, le choix de l'oscillographe est √©galement fait √† partir des objets variables du dictionnaire). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons tout de m√™me pour le d√©bogage via JTAG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ou pas? Non, car j'avais √©galement besoin de la fonction de mise √† jour du logiciel via CAN. Malgr√© la pr√©sence d'un chargeur de d√©marrage CAN au Texas MK, nous avons d√©cid√© de faire le notre, car celui standard n'√©tait pas CANopen et pouvait interf√©rer avec le fonctionnement d'autres appareils sur le r√©seau pendant que nous en cousions un, ainsi que les appareils pouvaient interf√©rer avec le firmware. De plus, il y a eu des probl√®mes de correction d'erreurs et de perte de messages (bien que CAN soit tr√®s bon, il se bloque parfois, et le firmware est une chose tr√®s importante pour ne pas faire de v√©rification ou r√©essayer d'envoyer une pi√®ce cass√©e). Nous avons donc </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impl√©ment√© notre ¬´programmeur¬ª sur le r√©seau CAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais dans le cadre du protocole CANOpen. Maintenant c'est tout. Nous avons maintenant pu abandonner compl√®tement JTAG, en l'utilisant une seule fois, pour programmer un nouveau MK.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le m√™me temps, cette approche a ouvert de nouveaux horizons de d√©bogage que nous n'avions pas vus auparavant. Puisque nous avons cr√©√© l'environnement de premier niveau en tenant compte non seulement des programmeurs, mais √©galement des ¬´personnes ordinaires¬ª, nous avons cr√©√© tous les param√®tres en russe et r√©dig√© la documentation pour l'installateur pour chaque param√®tre (la documentation n'est pas l'environnement, mais le p√©riph√©rique, bien s√ªr). Et cela a √©t√© b√©n√©fique - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maintenant, s'il y a un probl√®me avec le lecteur, vous n'avez pas √† "tirer" le d√©veloppeur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- dans certains cas, le personnel du service client peut diagnostiquer ind√©pendamment les probl√®mes. Maintenant, nous pouvons obtenir un e-mail comme ¬´Notre lecteur a commenc√© √† faire des sons √©tranges parfois, j'ai regard√© l'oscillogramme du capteur de position, c'est ce que j'ai vu (photo). J'ai v√©rifi√© la mise √† la terre de l'√©cran, elle est tomb√©e, j'ai soud√© et tout a fonctionn√© comme il se doit! ¬ª Et absolument pas besoin d'aller n'importe o√π ou de voler! La deuxi√®me "d√©couverte" - s'il y a un probl√®me, nous demandons au client de connecter l'ordinateur √† l'√©quipement et de donner le contr√¥le du bureau √† distance sur Internet - nous lan√ßons notre environnement de haut niveau, nous allons tout osciller nous-m√™mes, nous corrigeons les param√®tres / firmware / nous disons qu'il s'est cass√© - profit! Encore une fois, vous n'avez pas besoin d'aller n'importe o√π (l'essentiel est qu'Internet soit install√© dans l'√©tablissement, au moins via un r√©seau cellulaire).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au fil des ans, ce programme de haut niveau a acquis de petites fonctions, comme les champignons (un processus naturel pour les logiciels qu'ils utilisent). Cela inclut l'utilisation du journal des plantages du p√©riph√©rique, l'enregistrement / le chargement d'un nugget de tous les param√®tres dans un fichier sur l'ordinateur, et la configuration du panneau de contr√¥le du p√©riph√©rique √† la "panneau de contr√¥le", et la gestion des journaux r√©seau dans un fichier et le retour du trafic r√©seau CAN sur TCP / IP, et le firmware / param√©trage multiple automatique d'appareils similaires sur le r√©seau (s'il y a des dizaines d'appareils, alors tout flasher avec vos mains est paresseux, vous avez besoin d'un script), etc.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/9ba/78c/d12/9ba78cd1202b435f810aa132a0f3299e.png" align="left"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, maintenant de la publicit√©. Maintenant, c'est d√©j√† un outil tr√®s puissant (nous l'avons appel√© autant que UniCON), qui dans certaines t√¢ches semble plus fonctionnel que les logiciels similaires de marques c√©l√®bres pour configurer leurs lecteurs et appareils. De plus, il n'est pas li√© √† un appareil sp√©cifique - vous pouvez configurer au moins un entra√Ænement √©lectrique, au moins un po√™le, au moins un chargeur - seul le dictionnaire des objets change. Maintenant, dans notre entreprise, nous ne voyons pas l'opportunit√© de mener √† bien un nouveau projet complexe sans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nos outils de d√©bogage CANopen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Pour travailler avec UniCON, il vous suffit d'int√©grer notre pile CANopen dans MK, apr√®s quoi MK se transforme en laboratoire num√©rique. Nous sommes s√ªrs que toutes les entreprises qui font des syst√®mes de contr√¥le s√©rieux sur MK disposent d'outils de d√©bogage similaires. Mais nous proposons notre solution CANopen sous la forme d'un produit logiciel ind√©pendant, car il est universellement mis en ≈ìuvre en termes d'ind√©pendance par rapport aux fonctions de l'appareil. Actuellement, nous avons impl√©ment√© la pile CANopen avec les fonctions avanc√©es d√©crites pour le Texas Instruments C2000 MK, leurs microcontr√¥leurs ARM (par exemple, la famille Concerto) et pour le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K1921VK01T du</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NIIET OJSC. Par cons√©quent, si vous avez besoin de d√©velopper un syst√®me de contr√¥le pour un entra√Ænement √©lectrique ou un autre objet de contr√¥le complexe, nous vous invitons √† coop√©rer.</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les commentaires, nous attendons avec impatience les critiques de la forme "Il y a donc *** - √ßa fait tout de m√™me et gratuitement." Depuis que nous recherchons depuis longtemps des outils de d√©bogage similaires pour ARM pour la fonctionnalit√©, nous sommes m√™me tomb√©s sur des environnements de d√©veloppement c√©l√®bres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD: Merci aux commentaires d'   </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indemsys</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,   </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">olekl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et   </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LeonidLenin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous avons trouv√© des fonctions de cartographie dans les environnements de d√©veloppement pour ARM Keil et STMStudio lors de l'utilisation de SWD. </font><font style="vertical-align: inherit;">Cependant, ils ne savent pas comment afficher un tableau de donn√©es de la m√©moire MK sous la forme d'un graphique, ce qui est juste ce qui est n√©cessaire pour observer les processus rapides des syst√®mes de contr√¥le (mais STMStudio peut afficher des graphiques avec un temps d'√©chantillonnage d'environ 1 ms en utilisant la mise en cache des donn√©es). </font><font style="vertical-align: inherit;">L'outil NXP FreeMaster est √©galement int√©ressant - dans sa description et son objectif, il est tr√®s similaire √† notre d√©veloppement UniCON, mais avec ses propres caract√©ristiques. </font><font style="vertical-align: inherit;">De plus, le Segger J-Link poss√®de son propre outil d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">affichage de forme d'onde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr389123/">https://habr.com/ru/post/fr389123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr389113/index.html">Le SSD le plus spacieux du monde: 13 To de Fixstars</a></li>
<li><a href="../fr389115/index.html">Il est propos√© de d√©velopper des organes et des tissus humains pour la transplantation chez les animaux.</a></li>
<li><a href="../fr389117/index.html">L'imprimante 3D Ripple Maker transf√®re l'image ou le texte souhait√© sur la surface de la mousse de caf√©</a></li>
<li><a href="../fr389119/index.html">Ajout et configuration de la base de donn√©es 1C sur le serveur</a></li>
<li><a href="../fr389121/index.html">Firefox 46 prendra en charge plusieurs moniteurs avec diff√©rentes densit√©s de pixels</a></li>
<li><a href="../fr389125/index.html">Galactosismologie: comment les galaxies naines compos√©es de mati√®re noire laissent des traces dans le gaz interstellaire</a></li>
<li><a href="../fr389127/index.html">Marketing agressif ou en quoi la motivation d'un arc lumineux au poignet ("babioles") diff√®re de la motivation d'un bracelet de fitness</a></li>
<li><a href="../fr389129/index.html">Nouveau microcontr√¥leur domestique de contr√¥le moteur K1921VK01T de OJSC NIIET</a></li>
<li><a href="../fr389133/index.html">Les chiens reconnaissent les √©motions humaines √† travers plusieurs sens</a></li>
<li><a href="../fr389139/index.html">Drinky est un robot copain qui est toujours l√†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>