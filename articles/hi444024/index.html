<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯШ╗ ЁЯСЙЁЯП╝ ЁЯОЕЁЯП┐ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВред рднрд╛рдЧ 3: рд╕реАрдкреАрдПрд╕ рджреБрднрд╛рд╖рд┐рдпрд╛ тМЫя╕П ЁЯГП ЁЯдд</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ! рдореИрдВ рдЖрдкрдХреЛ рдЕрдкрдиреА рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ - рдкреАрдПрд▓ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореЗрд░реЗ рдЕрдиреБрд╡рд╛рдж рдХреЗ рддреАрд╕рд░реЗ рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реВрдВред...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВред рднрд╛рдЧ 3: рд╕реАрдкреАрдПрд╕ рджреБрднрд╛рд╖рд┐рдпрд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444024/"><p>  рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ!  рдореИрдВ рдЖрдкрдХреЛ рдЕрдкрдиреА рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреАрдПрд▓ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓</a> рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореЗрд░реЗ рдЕрдиреБрд╡рд╛рдж рдХреЗ рддреАрд╕рд░реЗ рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реВрдВред </p><br><h1 id="ot-perevodchika">  рдЕрдиреБрд╡рд╛рджрдХ рд╕реЗ </h1><br><p>  рд╣рдо рдЕрдкрдиреА рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ - <strong>╬╗ рднрд╛рд╖рд╛</strong> (рдореВрд▓ - ╬╗anguage рдореЗрдВ) рдмрдирд╛рдПрдВрдЧреЗред  рдирд┐рд░реНрдорд╛рдг рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ, рд╣рдо рдХрдИ рджрд┐рд▓рдЪрд╕реНрдк рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдЬреИрд╕реЗ рдХрд┐ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд╡рдВрд╢, рдирд┐рдпрдВрддреНрд░рдг рд╣рд╕реНрддрд╛рдВрддрд░рдг рд╢реИрд▓реА, рдФрд░ рдмреБрдирд┐рдпрд╛рджреА рдЕрдиреБрдХреВрд▓рди рддрдХрдиреАрдХред  рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЗ рджреЛ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рдП рдЬрд╛рдПрдВрдЧреЗ - рдирд┐рдпрдорд┐рдд рдФрд░ рд╕реАрдкреАрдПрд╕ рджреБрднрд╛рд╖рд┐рдпреЛрдВ, рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдЯреНрд░рд╛рдВрд╕-рдХрдВрдкрд╛рдЗрд▓рд░ред </p><br><p>  рдореВрд▓ рдХреЗ рд▓реЗрдЦрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдорд┐рд╣рд╛рдИ Bazon</a> , рдкреНрд░рд╕рд┐рджреНрдз UglifyJS рдкреБрд╕реНрддрдХрд╛рд▓рдп (рдЬреЗрдПрд╕ рдХреЛрдб рдХреЛ рдХрдо рдХрд░рдиреЗ рдФрд░ рдкреНрд░рд╛рд░реВрдкрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЙрдкрдХрд░рдг) рдХреЗ рд▓реЗрдЦрдХ рд╣реИрдВред </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">рд╕рд╛рдордЧреНрд░реА</b> <div class="spoiler_text"><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВред</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 1: рдкрд╛рд░реНрд╕рд░</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВред</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 2: рджреБрднрд╛рд╖рд┐рдпрд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВред</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 3: рд╕реАрдкреАрдПрд╕ рджреБрднрд╛рд╖рд┐рдпрд╛</a> </li><li>  рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВред  рднрд╛рдЧ 4: JS рдореЗрдВ рдЯреНрд░рд╛рдВрд╕ рдХрдВрдкрд╛рдЗрд▓рд┐рдВрдЧ </li></ol></div></div><br><p> PS рдЗрдВрдЯрд░рдкреНрд░реЗрдЯрд░ рдФрд░ рдХрдВрдкрд╛рдЗрд▓рд░ рдореЗрдВ рдПрдХ рдмрдЧ рд╣реИ: <code>a() &amp;&amp; b()</code> рдпрд╛ <code>a() || b()</code>  <code>a() || b()</code> рджреЛрдиреЛрдВ рднрд╛рдЧреЛрдВ рдХреЛ рд╣рдореЗрд╢рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдЧрд▓рдд рд╣реИ рдХреНрдпреЛрдВрдХрд┐ <code>a()</code> <code>&amp;&amp;</code> рдСрдкрд░реЗрдЯрд░ рдХреЗ рд▓рд┐рдП рдЧрд▓рдд рд╣реИ, рдпрд╛ рдЙрд╕рдХреЗ рд▓рд┐рдП рдЧрд▓рдд рдирд╣реАрдВ рд╣реИ <code>||</code>  , рддрдм <code>b()</code> рдХрд╛ рдорд╛рди <code>b()</code> рдХреЛрдИ рднреВрдорд┐рдХрд╛ рдирд╣реАрдВ рдирд┐рднрд╛рддрд╛ рд╣реИред  рдЗрд╕реЗ рдареАрдХ рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реИред </p><br><h1 id="cps-interpretator">  рд╕реАрдкреАрдПрд╕ рджреБрднрд╛рд╖рд┐рдпрд╛ </h1><br><p>  рд╣рдорд╛рд░реА ╬╗ рднрд╛рд╖рд╛ рдореЗрдВ рджреЛ рдХрдорд┐рдпрд╛рдВ рд╣реИрдВ: </p><br><ul><li>  рд░рд┐рдХрд░реНрд╕рди рдЬреЗрдПрд╕ рд╕реНрдЯреИрдХ рддрдХ рд╕реАрдорд┐рдд рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд▓реВрдк рдХрд░рдиреЗ рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХрд╛ рдирд╣реАрдВ рд╣реИред </li><li>  рджреБрднрд╛рд╖рд┐рдпрд╛ рдзреАрдорд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдмрд╣реБрдд рдзреАрдореА рд╣реИред </li></ul><br><p>  рдЕрдм рд╣рдо рдЗрд╕ рддрдереНрдп рдкрд░ рдзреНрдпрд╛рди рджрд┐рдП рдмрд┐рдирд╛ рдкрд╣рд▓рд╛ рджреЛрд╖ рдареАрдХ рдХрд░реЗрдВрдЧреЗ рдХрд┐ рджреБрднрд╛рд╖рд┐рдпрд╛ рдФрд░ рднреА рдзреАрдорд╛ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред  рд╣рдо рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЛ "рдирд┐рд░рдВрддрд░рддрд╛-рдЧреБрдЬрд░ рд╢реИрд▓реА" (рд╕реАрдкреАрдПрд╕) рд╢реИрд▓реА рдореЗрдВ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦреЗрдВрдЧреЗред </p><br><h2 id="chto-takoe-peredacha-prodolzheniya">  "рдирд┐рд░рдВрддрд░рддрд╛ рд╣рд╕реНрддрд╛рдВрддрд░рдг" рдХреНрдпрд╛ рд╣реИ </h2><br><p>  рдЖрдк рд╣рд░ рд╕рдордп NodeJS рдореЗрдВ рдРрд╕рд╛ рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="javascript hljs">fs.readFile(<span class="hljs-string"><span class="hljs-string">"file.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf8"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error, data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   - "" //     'return', // 'readFile'  ,  . });</span></span></code> </pre> <br><p>  рд╣рд░ рдХрджрдо рдкрд░ рдПрдХ рдХреЙрд▓рдмреИрдХ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдкрдХреЛ рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдиреЗ рдкрд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдирд┐рд░рдВрддрд░рддрд╛ рд╣рд╕реНрддрд╛рдВрддрд░рдг рд╢реИрд▓реА рдирд┐рдпрдВрддреНрд░рдг рд╣рд╕реНрддрд╛рдВрддрд░рдг рдХреЛ "рд╕реНрдкрд╖реНрдЯ" рдмрдирд╛рддреА рд╣реИ - рдЖрдк <code>return</code> , <code>throw</code> , <code>break</code> рдпрд╛ <code>continue</code> рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ <code>return</code> ред  рдХреЛрдб рдореЗрдВ рдХреЛрдИ рдирд┐рд╣рд┐рдд рдЫрд▓рд╛рдВрдЧ рдирд╣реАрдВ рд╣реИред  рдЖрдк рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдпрд╛ рдЗрд╕рдХреЗ <code>for</code> рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ рдореЗрдВ рдЙрдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреНрдпреЛрдВ рд╣реИ? </p><br><p>  рдПрдХ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рдкреНрд░реЗрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рд╢реИрд▓реА рдореЗрдВ рдХреЛрдб рд▓рд┐рдЦрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдФрд░ рдЖрд╕рд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдХреЗрд╡рд▓ рдЙрд╕ рд╢реИрд▓реА рдореЗрдВ рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦреЗрдВрдЧреЗред </p><br><h2 id="funkciya-evaluate">  рдлрд╝рдВрдХреНрд╢рди рдХрд╛ <code>evaluate</code> рдХрд░реЗрдВ </h2><br><p>  <code>evaluate</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рддреАрди рддрд░реНрдХ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдВрдЧреЗ: рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ (рдПрдПрд╕рдЯреА), рд╕рдВрджрд░реНрдн (рдкрд░реНрдпрд╛рд╡рд░рдг), рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдЬрд┐рд╕реЗ рдкрд░рд┐рдгрд╛рдо рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣рд╛рдБ рдХреЛрдб рд╣реИ, рдкреНрд░рддреНрдпреЗрдХ рдЯреБрдХрдбрд╝реЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рд╣реИ: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">exp, env, callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (exp.type) {</code> </pre> <br><p>  рд╕реНрдерд┐рд░рд╛рдВрдХ рдХреЗ рд▓рд┐рдП, рд╣рдо рдХреЗрд╡рд▓ рдЙрдирдХрд╛ рдорд╛рди рд▓реМрдЯрд╛рдПрдВрдЧреЗред  рд▓реЗрдХрд┐рди рдпрд╛рдж рд░рдЦреЗрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ <code>return</code> рдирд╣реАрдВ рд╣реИ - рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рд╣рдо рдХреЗрд╡рд▓ рдХреЙрд▓рдмреИрдХ рдХрд╣рддреЗ рд╣реИрдВ рдФрд░ рдореВрд▓реНрдп рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"num"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"str"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"bool"</span></span>: callback(exp.value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  <code>var</code> рдиреЛрдб рднреА рд╕рд░рд▓ рд╣реИ - рд╕рдВрджрд░реНрдн рд╕реЗ рдЪрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдкрд╛рд╕ рдХрд░реЗрдВ: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"var"</span></span>: callback(env.get(exp.value)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  <code>assign</code> рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдмрд╛рдИрдВ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ ( <code>right</code> ) рдХрд╛ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо <code>evaluate</code> рдХрд╣рддреЗ рд╣реИрдВ, рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрд╛рд╕ рдХрд░рдирд╛ рдЬреЛ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ (рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЗ рджрд╛рдИрдВ рдУрд░)ред  рдФрд░ рдлрд┐рд░ рд╣рдо рдЪрд░ рдХреЛ рд╡рд░реНрддрдорд╛рди рдорд╛рди рдореЗрдВ рдЪрд░ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реБрдП рдЪрд░ рдорд╛рди рдХреЗ рд╕рд╛рде <code>callback</code> рдХрд╣рддреЗ рд╣реИрдВ: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"assign"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.left.type != <span class="hljs-string"><span class="hljs-string">"var"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"Cannot assign to "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(exp.left)); evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ callback(env.set(exp.left.value, right)); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  рдЯрд╛рдЗрдк <code>binary</code> рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рд╕рдорд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рд╣рдореЗрдВ рдкрд╣рд▓реЗ <code>left</code> рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рд╣реА <code>right</code> рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдореВрд▓реНрдпред  рддрдм рд╣рдо рд╕рд┐рд░реНрдл рдХреЙрд▓рдмреИрдХ рдХрд╣рддреЗ рд╣реИрдВ, рдСрдкрд░реЗрд╢рди рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реБрдП: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"binary"</span></span>: evaluate(exp.left, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left</span></span></span><span class="hljs-function">)</span></span>{ evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ callback(apply_op(exp.operator, left, right)); }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  <code>let</code> рдиреЛрдб рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рджрд┐рдЦрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рд╕рд░рд▓ рд╣реИред  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреБрдЫ рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЪрд░ рд╣реИрдВред  рдЙрдирдХрд╛ <code>def</code> рдХреНрд╖реЗрддреНрд░ (рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдореВрд▓реНрдп) рдЦрд╛рд▓реА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣рдо рдЗрд╕реЗ <code>false</code> рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗред  рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдХреЛрдИ рдореВрд▓реНрдп рд╣реИ, рддреЛ рд╣рдореЗрдВ рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░реВрдк рд╕реЗ <code>evaluate</code> рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рдпрджрд┐ рдЖрдкрдиреЗ рдкрд╣рд▓реЗ NodeJS рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдкрдиреЗ рдкрд╣рд▓реЗ рднреА рдХрдИ рдмрд╛рд░ рдРрд╕рд╛ рдХрд┐рдпрд╛ рд╣реИред  рдХреЙрд▓рдмреИрдХ рдХреЗ рдХрд╛рд░рдг, рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрди рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХреА рдПрдХ рдмрд╛рд░ рдореЗрдВ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП ( <code>evaluate</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ)ред  рдиреАрдЪреЗ рджрд┐рдП рдЧрдП <code>loop</code> рдлрд╝рдВрдХреНрд╢рди (рддреБрд░рдВрдд рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) рдХреЛ рд╕рдВрджрд░реНрдн рдФрд░ рдЙрд╕ рдкрд░рд┐рднрд╛рд╖рд╛ рдХреА рд╕рдВрдЦреНрдпрд╛ рдорд┐рд▓рддреА рд╣реИ рдЬрд┐рд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: </p><br><ul><li>  рдпрджрд┐ рдпрд╣ рд╕рдВрдЦреНрдпрд╛ рдЪрд░ ( <code>vars.length</code> ) рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рднреА рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рд╣реИ рддрд╛рдХрд┐ рд╣рдо рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд╢рд░реАрд░ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХреЗрдВред  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕ рдмрд╛рд░ рд╣рдо <code>callback</code> рдирд╣реАрдВ рдХрд╣рддреЗ <code>callback</code> , рд▓реЗрдХрд┐рди рдЗрд╕реЗ <code>evaluate</code> рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рддрдм рдЗрд╕реЗ рдХреЙрд▓ рдХрд░реЗрдЧрд╛ред </li><li>  рдпрджрд┐ рдпрд╣ рд╕рдВрдЦреНрдпрд╛ рдХрдо рд╣реИ, рддреЛ рдЖрдкрдХреЛ рд╡рд░реНрддрдорд╛рди рдкрд░рд┐рднрд╛рд╖рд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдФрд░ рд╕рдВрджрд░реНрдн рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдкрд╛рд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ <code>loop(scope, i + 1)</code> рдХрд╣реЗрдЧрд╛ред <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"let"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.vars.length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = exp.vars[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v.def) evaluate(v.def, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, value); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { evaluate(exp.body, env, callback); } })(env, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> </li></ul><br><p>  <code>lambda</code> рдиреЛрдб рдХреЛ рдкрд╣рд▓реЗ рдХреА рддрд░рд╣ рдПрдХ рдЕрд▓рдЧ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>: callback(make_lambda(env, exp)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  <code>if</code> рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдкрд╣рд▓реЗ рд╕реНрдерд┐рддрд┐ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддреЗ рд╣реИрдВред  рдпрджрд┐ рдпрд╣ рдЧрд▓рдд рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо <code>then</code> рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддреЗ рд╣реИрдВ, рджреВрд╕рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрджрд┐ рдХреЛрдИ рдПрдХ рд╣реИ, рддреЛ рдЙрд╕рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░реЗрдВ рдпрд╛ рдирд╣реАрдВ рддреЛ <code>false</code> ред  рдкрд╣рд▓реЗ рдХреА рддрд░рд╣, <code>then</code> рдФрд░ <code>then</code> рд╣рдо рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреА "рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдмрд╛рдж рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдХрд╛рд░реНрд░рд╡рд╛рдИ" рдХреЗ рд░реВрдк рдореЗрдВ <code>callback</code> рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"if"</span></span>: evaluate(exp.cond, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cond</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cond !== <span class="hljs-literal"><span class="hljs-literal">false</span></span>) evaluate(exp.then, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.else) evaluate(exp.else, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> callback(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  <code>prog</code> рдиреЛрдб рдХреЛ <code>let</code> рдиреЛрдб рдХреЗ рд╕рдорд╛рди рд╕рдордЭрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рдЕрдВрддрд░ рдХреЗ рд╕рд╛рде рдХрд┐ рд╣рдореЗрдВ рд╕рдВрджрд░реНрдн рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдпрд╛ рдЪрд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдФрд░ рдлрд┐рд░, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ <code>loop</code> рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬреЛ рдПрдХ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рд╕рдВрдЦреНрдпрд╛ рд▓реЗрддрд╛ рд╣реИред  рдЬрдм рдпрд╣ <code>prog.length</code> рдмрд░рд╛рдмрд░ <code>prog.length</code> , рддреЛ рд╣рдордиреЗ рд╕рднреА рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ рдФрд░ рд╣рдо рдХреЗрд╡рд▓ рдЕрдВрддрд┐рдо рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рджреЗрддреЗ рд╣реИрдВ (рд╢рдмреНрдж "рд╡рд╛рдкрд╕реА" рд╕реЗ рдореЗрд░рд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рдЗрд╕рдХреЗ рд╕рд╛рде <code>callback</code> рдХрд╣рддреЗ рд╣реИрдВ)ред  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рдо <code>loop</code> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕реЗ рдкрд╛рд░рд┐рдд рдХрд░рдХреЗ рдЕрдВрддрд┐рдо рдореВрд▓реНрдп рдХреЛ рдпрд╛рдж рдХрд░рддреЗ рд╣реИрдВ (рд╢реБрд░реБрдЖрдд рдореЗрдВ рдпрд╣ рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП <code>false</code> рдЬрдм рд╢рд░реАрд░ рдЦрд╛рд▓реА рд╣реИ): </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"prog"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">last, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.prog.length) evaluate(exp.prog[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">)</span></span>{ loop(val, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { callback(last); } })(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА <code>call</code> рд╣рдореЗрдВ <code>func</code> рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рд╕рднреА рддрд░реНрдХ рдХреНрд░рдо рдореЗрдВ рд╣реИрдВред  рдФрд░ рдлрд┐рд░, рдПрдХ <code>loop</code> рдлрд╝рдВрдХреНрд╢рди рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдПрдХ рд╣реА рд╕рд┐рджреНрдзрд╛рдВрдд рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕реЗ <code>let</code> рдпрд╛ <code>prog</code> , рдЗрд╕ рдЕрдВрддрд░ рдХреЗ рд╕рд╛рде рдХрд┐ рдЕрдм рдпрд╣ рдПрдХ рдкрд░рд┐рдгрд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╕рд░рдгреА рдмрдирд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"call"</span></span>: evaluate(exp.func, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">)</span></span>{ (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.args.length) evaluate(exp.args[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">)</span></span>{ args[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] = arg; loop(args, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { func.apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, args); } })([ callback ], <span class="hljs-number"><span class="hljs-number">0</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  рдареАрдХ рд╣реИ, рдорд╛рдирдХ рд╕рдорд╛рдкреНрдд рд╣реЛрдирд╛: рдЕрдЧрд░ рд╣рдореЗрдВ рдирд╣реАрдВ рдкрддрд╛ рдХрд┐ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ, рддреЛ рдПрдХ рдЕрдкрд╡рд╛рдж рдлреЗрдВрдХреЗрдВ: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"I don't know how to evaluate "</span></span> + exp.type); } }</code> </pre> <br><p>  рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдКрдкрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдкреНрд░рддреНрдпреЗрдХ <code>case</code> <code>return</code> рдХреАрд╡рд░реНрдб рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдХреЛрдИ рд╡рд╛рдкрд╕реА рдореВрд▓реНрдп рдирд╣реАрдВ рд╣реИ - рдкрд░рд┐рдгрд╛рдо рд╣рдореЗрд╢рд╛ <code>callback</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><h3 id="novaya-funkciya-make_lambda">  рдирдпрд╛ <code>make_lambda</code> рдлрд╝рдВрдХреНрд╢рди </h3><br><p>  рдЗрд╕ рд╡реНрдпрд╛рдЦреНрдпрд╛рдХрд╛рд░ рдореЗрдВ, рд╕рднреА рдлрд╝рдВрдХреНрд╢рди рдкрд╣рд▓реЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ "рдирд┐рд░рдВрддрд░рддрд╛" рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗ - рдкрд░рд┐рдгрд╛рдо рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдЬрд┐рд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдЗрд╕рдХреЗ рдмрд╛рдж рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рддрд░реНрдХ рд╣реИрдВред  рдпрд╣рд╛рдБ <code>make_lambda</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдирдпрд╛ рдХреЛрдб рд╣реИ: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, exp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.name) { env = env.extend(); env.def(exp.name, lambda); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> names = exp.vars; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; names.length; ++i) scope.def(names[i], i + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>.length ? <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] : <span class="hljs-literal"><span class="hljs-literal">false</span></span>); evaluate(exp.body, scope, callback); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lambda; }</code> </pre> <br><p>  рд╡рд╣ рдЬреНрдпрд╛рджрд╛ рдЕрд▓рдЧ рдирд╣реАрдВ рд╣реИред  рдпрд╣ рдирдП рдЪрд░ рдХреЛ рдПрдХ рдирдП рд╕рдВрджрд░реНрдн рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдореЗрдВ рдпрд╣ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдкрд╣рд▓рд╛ рддрд░реНрдХ <code>callback</code> ред  рдЕрдВрдд рдореЗрдВ, <code>evaluate</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдлрд╝рдВрдХреНрд╢рди рдХреЛрдб рдХреЛ рдПрдХ рдирдП рд╕рдВрджрд░реНрдн рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди, рдкрд╣рд▓реЗ рдХреА рддрд░рд╣, рд╣рдо <code>callback</code> рдкрд╛рд╕ рдХрд░рддреЗ <code>callback</code> ред </p><br><p>  рд╡реИрд╕реЗ, рдпрд╣ рдПрдХрдорд╛рддреНрд░ рд╕реНрдерд╛рди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдореИрдВрдиреЗ рд▓реВрдк рдХреЗ <code>for</code> рдХрд┐рдпрд╛ рдерд╛ред  рдРрд╕рд╛ рддрдм рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ <code>call</code> рдиреЛрдб рд╕рдВрд╕рд╛рдзрд┐рдд рд╣реЛрдиреЗ рдкрд░ рддрд░реНрдХ рдорд╛рди рдкрд╣рд▓реЗ рд╣реА рдЧрдгрдирд╛ рдХрд░ рд▓рд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред </p><br><h2 id="nativnye-funkcii">  рдореВрд▓ рдХрд╛рд░реНрдп </h2><br><p>  рдЗрд╕ рджреБрднрд╛рд╖рд┐рдпрд╛ рдореЗрдВ, рдореВрд▓ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдкрд╣рд▓реЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ <code>callback</code> рдорд┐рд▓рддрд╛ рд╣реИред  рджреЗрд╢реА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╕рдордп рд╣рдореЗрдВ рдпрд╣ рдпрд╛рдж рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдпрд╣рд╛рдБ рдирдП рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдирдореВрдирд╛ рдХреЛрдб рд╣реИ: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = <span class="hljs-string"><span class="hljs-string">"sum = lambda(x, y) x + y; print(sum(2, 3));"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ast = parse(TokenStream(InputStream(code))); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> globalEnv = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Environment(); <span class="hljs-comment"><span class="hljs-comment">// define the "print" primitive function globalEnv.def("print", function(callback, txt){ console.log(txt); callback(false); // call the continuation with some return value // if we don't call it, the program would stop // abruptly after a print! }); // run the evaluator evaluate(ast, globalEnv, function(result){ // the result of the entire program is now in "result" });</span></span></code> </pre> <br><h2 id="malenkiy-test">  рдереЛрдбрд╝рд╛ рдкрд░реАрдХреНрд╖рдг </h2><br><p>  рдЖрдЗрдП рдлрд┐рд░ рд╕реЗ рдлрд╛рдЗрдмреЛрдиреИрдЪрд┐ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ: </p><br><pre> <code class="javascript hljs">fib = ╬╗(n) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> then n <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>); time( ╬╗() println(fib(<span class="hljs-number"><span class="hljs-number">10</span></span>)) );</code> </pre> <br><p>  рд▓реЗрдХрд┐рди, рдпрджрд┐ рд╣рдо 27 рд╡реЗрдВ рдирдВрдмрд░ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рд╕реНрдЯреИрдХ рдУрд╡рд░рдлреНрд▓реЛ рдорд┐рд▓рддрд╛ рд╣реИред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рд╕реНрдЯреИрдХ рдЕрдм рдмрд╣реБрдд рддреЗрдЬреА рд╕реЗ рдмрдврд╝ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдЕрдм рд╣рдо рдлрд╛рдЗрдмреЛрдиреИрдЪрд┐ рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдХреЗрд╡рд▓ 12 рд╡реЗрдВ (рдХрдо рд╕реЗ рдХрдо рдореЗрд░реЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ) рдЧрд┐рди рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕реЗ рдХрд┐рд╕реА рддрд░рд╣ рдареАрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><h1 id="zaschischaem-stek">  рд╣рдо рдвреЗрд░ рдХреА рд░рдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВ </h1><br><p>  рд╕реАрдкреАрдПрд╕ рджреБрднрд╛рд╖рд┐рдпрд╛ рдореЗрдВ, рд╕реНрдЯреИрдХ рдмрд╣реБрдд рддреЗрдЬреА рд╕реЗ рдмрдврд╝рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рджреБрднрд╛рд╖рд┐рдпрд╛ рд╣рдореЗрд╢рд╛ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдкреБрдирд░рд╛рд╡рд░реНрддреА рдХрд╣рддрд╛ рд╣реИ, рдХрднреА рднреА рдкрд░рд┐рдгрд╛рдо рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╣рдо рджреБрднрд╛рд╖рд┐рдпрд╛ рдореЗрдВ <code>return</code> , рд╣рдореЗрдВ рдЙрдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдмрд╣реБрдд рдЧрд╣рд░реА рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдЙрди рддрдХ рдХрднреА рдирд╣реАрдВ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВред </p><br><p>  рдЖрдЗрдП рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░рд╛ рд╕реНрдЯреИрдХ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИред  рдореИрдВ рдЫрджреНрдо рдХреЛрдб рджрд┐рдЦрд╛рдКрдВрдЧрд╛ рдФрд░ рдореИрдВрдиреЗ <code>env</code> рдирд╣реАрдВ рдЬреЛрдбрд╝рд╛ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдпрд╣рд╛рдВ рдХреЛрдИ рднреВрдорд┐рдХрд╛ рдирд╣реАрдВ рдирд┐рднрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="python hljs">print(<span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">## : evaluate( print(1 + 2 * 3), K0 ) evaluate( print, K1 ) K1(print) #  'var',      evaluate( 1 + 2 * 3, K2 ) evaluate( 2 * 3, K3 ) evaluate( 2, K4 ) K4(2) # 2  ,      evaluate( 3, K5 ) #    3,      K5(3) K3(6) #  2*3 evaluate( 1, K6 ) #  ,  K6(1) K2(7) #  1+2*3 print(K0, 7) # ,     'print' K0(false) #  . 'print'  'false'.</span></span></code> </pre> <br><p>  рдХреЗрд╡рд▓ рдЕрдВрддрд┐рдо рдХреЙрд▓ рдХреЗ рдмрд╛рдж, рдмреЗрдХрд╛рд░ <code>return</code> рдХрд╛ рдПрдХ рд▓рдВрдмрд╛ рдХреНрд░рдо рд╕реНрдЯреИрдХ рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рд╣рдо рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╕реНрдЯреИрдХ рд╕реНрдкреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдХрд▓реНрдкрдирд╛ рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ рдХрд┐ <code>fib(13)</code> рд▓рд┐рдП рдХреНрдпрд╛ рд╣реЛрдЧрд╛ред </p><br><h2 id="zaschita-steka">  рдвреЗрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ </h2><br><p>  рд╣рдорд╛рд░реЗ рдирдП рджреБрднрд╛рд╖рд┐рдпрд╛ рдореЗрдВ, рд╕реНрдЯреИрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдПрдХ <code>callback</code> рдореЗрдВ рдХреБрдЫ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рд╕рднреА рдХреЛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕реЗ рдПрдХ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рддреЛ рдпрд╣рд╛рдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд╕рд╡рд╛рд▓ рд╣реИ: рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдпрджрд┐ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдиреЗ рд╕реНрдЯреИрдХ рдХреЛ "рдбрдВрдк" рдХрд░рдирд╛ рд╕рдВрднрд╡ рдмрдирд╛ рджрд┐рдпрд╛ред  рдлрд┐рд░ рд╣рдо рд╕реНрдЯреИрдХ рдХреЛ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЕрд╕реАрдо рд░реВрдк рд╕реЗ рдЧрд╣рд░реА рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХрд╛рдо рдХрд░реЗрдЧреАред </p><br><p>  рдЖрдЗрдП рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ <code>GUARD</code> рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬреЛ рдРрд╕рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕реЗ рджреЛ рдорд╛рди рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди, рдФрд░ рддрд░реНрдХ рдЬреЛ рдЗрд╕реЗ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ: рдпрджрд┐ рд╕реНрдЯреИрдХ рдмрд╣реБрдд рдЧрд╣рд░рд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реНрдЯреИрдХ рдХреЛ рд╕рд╛рдл рдХрд░реЗрдЧрд╛ рдФрд░ рдкрд╛рд░рд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛ред  рдПрдХ рдЕрдиреНрдп рдорд╛рдорд▓реЗ рдореЗрдВ, рд╡рд╣ рдХреБрдЫ рдирд╣реАрдВ рдХрд░рддреА рд╣реИред </p><br><p>  рдирдП рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдиреАрдЪреЗ рджрд┐рдЦрд╛рдП рдЧрдП рдЕрдиреБрд╕рд╛рд░ рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрддреЗ рд╣реИрдВред  рдореИрдВ рдкреНрд░рддреНрдпреЗрдХ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдорд╛рдорд▓реЗ рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛, рдкрд╣рд▓реЗ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рдХреЛрдб рд╣реИ, рд▓реЗрдХрд┐рди <code>GUARD</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">exp, env, callback</span></span></span><span class="hljs-function">) </span></span>{ GUARD(evaluate, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (exp.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"num"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"str"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"bool"</span></span>: callback(exp.value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"var"</span></span>: callback(env.get(exp.value)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"assign"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.left.type != <span class="hljs-string"><span class="hljs-string">"var"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"Cannot assign to "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(exp.left)); evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); callback(env.set(exp.left.value, right)); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"binary"</span></span>: evaluate(exp.left, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); evaluate(exp.right, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">right</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); callback(apply_op(exp.operator, left, right)); }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"let"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, i</span></span></span><span class="hljs-function">)</span></span>{ GUARD(loop, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.vars.length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = exp.vars[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v.def) evaluate(v.def, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, value); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = env.extend(); scope.def(v.name, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); loop(scope, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { evaluate(exp.body, env, callback); } })(env, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>: callback(make_lambda(env, exp)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"if"</span></span>: evaluate(exp.cond, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cond</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cond !== <span class="hljs-literal"><span class="hljs-literal">false</span></span>) evaluate(exp.then, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.else) evaluate(exp.else, env, callback); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> callback(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"prog"</span></span>: (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">last, i</span></span></span><span class="hljs-function">)</span></span>{ GUARD(loop, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.prog.length) evaluate(exp.prog[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); loop(val, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { callback(last); } })(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"call"</span></span>: evaluate(exp.func, env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">args, i</span></span></span><span class="hljs-function">)</span></span>{ GUARD(loop, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; exp.args.length) evaluate(exp.args[i], env, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function">)</span></span>{ GUARD(CC, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); args[i + <span class="hljs-number"><span class="hljs-number">1</span></span>] = arg; loop(args, i + <span class="hljs-number"><span class="hljs-number">1</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { func.apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, args); } })([ callback ], <span class="hljs-number"><span class="hljs-number">0</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"I don't know how to evaluate "</span></span> + exp.type); } }</code> </pre> <br><p>  рдЕрдирд╛рдо рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдирд╛рдо рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рд╣рдо рдЙрдиреНрд╣реЗрдВ <code>GUARD</code> рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдкрд╛рд╕ рдХрд░ рд╕рдХреЗрдВред  рдореИрдВрдиреЗ <code>CC</code> ( <code>current continuation</code> ) рдирд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рдЖрдк <code>arguments.callee</code> рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <code>arguments.callee</code> , рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдкреБрд░рд╛рдирд╛ рдПрдкреАрдЖрдИ рд╣реИред </p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, <code>make_lambda</code> рдореЗрдВ рд╕рдорд╛рди рдкрд░рд┐рд╡рд░реНрддрди: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, exp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp.name) { env = env.extend(); env.def(exp.name, lambda); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ GUARD(lambda, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); <span class="hljs-comment"><span class="hljs-comment">// &lt;--  var names = exp.vars; var scope = env.extend(); for (var i = 0; i &lt; names.length; ++i) scope.def(names[i], i + 1 &lt; arguments.length ? arguments[i + 1] : false); evaluate(exp.body, scope, callback); } return lambda; }</span></span></code> </pre> <br><p>  <code>GUARD</code> рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИред  рдХреИрд╕реЗ рдПрдХ рдЧрд╣рд░реА рдХреЙрд▓ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рд▓рд┐рдП?  рдЕрдкрд╡рд╛рджреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рд╡реИрд╢реНрд╡рд┐рдХ рдЪрд░ рд╣реЛрдЧрд╛ рдЬреЛ рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдЧрд╛ рдХрд┐ рд╣рдо рдХрд┐рддрдиреА рдЕрдзрд┐рдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрджрд┐ рдпрд╣ рд╢реВрдиреНрдп рдкрд░ рдкрд╣реБрдВрдЪ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдо <code>Continuation</code> рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдлреЗрдВрдХ рджреЗрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдирд┐рд░рдВрддрд░рддрд╛ рд╣реЛрдЧреА - рдлрд╝рдВрдХреНрд╢рди рдФрд░ рддрд░реНрдХ: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> STACKLEN; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GUARD</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (--STACKLEN &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Continuation(f, args); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Continuation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f = f; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.args = args; }</code> </pre> <br><p>  рдФрд░ рдЕрдВрдд рдореЗрдВ, рд╣рдореЗрдВ рдПрдХ рд▓реВрдк рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ <code>Continuation</code> рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдкрдХрдбрд╝реЗрдЧрд╛ред  рд╣рдореЗрдВ рдЗрд╕ рд▓реВрдк рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджреБрднрд╛рд╖рд┐рдП рдХреЛ рдмреБрд▓рд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рд╕рдм рдХреБрдЫ рдХрд╛рдо рдХрд░реЗ: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { STACKLEN = <span class="hljs-number"><span class="hljs-number">200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f.apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, args); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(ex) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ex <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Continuation) f = ex.f, args = ex.args; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ex; } }</code> </pre> <br><p>  <code>Execute</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рдВрдХреНрд╢рди рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рддрд░реНрдХ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рдПрдХ рд▓реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдЧрд░ <code>return</code> рдмрд┐рдирд╛ рд╕реНрдЯреИрдХ рдУрд╡рд░рдлреНрд▓реЛ рдХреЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╣рдо <code>return</code> рдзреНрдпрд╛рди рджреЗрддреЗ рд╣реИрдВ, рд╣рдо рддреБрд░рдВрдд рд░реБрдХ рдЬрд╛рддреЗ рд╣реИрдВред  рдЬрдм рд╣рдо рд▓реВрдк рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рд░ рдмрд╛рд░ рд░реАрд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  <code>200</code> рдорд╛рди - рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдлрд┐рдЯ рдмреИрдарддрд╛ рд╣реИред  рдЬрдм рд╣рдо <code>Continuation</code> рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдкрдХрдбрд╝рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдПрдХ рдирдП рдлрд╝рдВрдХреНрд╢рди рдФрд░ рддрд░реНрдХреЛрдВ рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рд▓реВрдк рдХреЛ рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рдЕрдкрд╡рд╛рдж рдХреЗ рдХрд╛рд░рдг, рдвреЗрд░ рдХреЛ рд╕рд╛рдл рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддрд╛рдХрд┐ рд╣рдо рдЬрд╛рд░реА рд░рдЦ рд╕рдХреЗрдВред </p><br><p>  рджреБрднрд╛рд╖рд┐рдпрд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЕрдм <code>Execute</code> рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="javascript hljs">Execute(evaluate, [ ast, globalEnv, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"*** Result:"</span></span>, result); }]);</code> </pre> <br><h2 id="test">  рдХрд╕реМрдЯреА </h2><br><p>  рдЕрдм рдпрд╣ рдХрд╛рдо рдХрд░реЗрдЧрд╛: </p><br><pre> <code class="python hljs">fib = ╬╗(n) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> then n <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> fib(n - <span class="hljs-number"><span class="hljs-number">1</span></span>) + fib(n - <span class="hljs-number"><span class="hljs-number">2</span></span>); time( ╬╗() println(fib(<span class="hljs-number"><span class="hljs-number">20</span></span>)) ); <span class="hljs-comment"><span class="hljs-comment"># 6765, ~300ms</span></span></code> </pre> <br><p>  рдпрд╣ рдЕрдлрд╝рд╕реЛрд╕ рдХреА рдмрд╛рдд рд╣реИ, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк <code>fib(27)</code> рдЦреЛрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдирд┐рдпрдорд┐рдд рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓рдЧрднрдЧ рдЪрд╛рд░ рдЧреБрдирд╛ рд▓рдВрдмрд╛ рд╣реЛрдЧрд╛ред  рд▓реЗрдХрд┐рди рддрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрдм рдЕрдирдВрдд рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рд╣реИ: </p><br><pre> <code class="javascript hljs">sum = ╬╗(n, ret) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n == <span class="hljs-number"><span class="hljs-number">0</span></span> then ret <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> sum(n - <span class="hljs-number"><span class="hljs-number">1</span></span>, ret + n); # compute <span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> + ... + <span class="hljs-number"><span class="hljs-number">50000</span></span> time( ╬╗() println(sum(<span class="hljs-number"><span class="hljs-number">50000</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) ); # <span class="hljs-number"><span class="hljs-number">1250025000</span></span>, ~<span class="hljs-number"><span class="hljs-number">700</span></span>ms</code> </pre> <br><p>  рдмреЗрд╢рдХ, рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ ╬╗ рднрд╛рд╖рд╛ рдмрд╣реБрдд рдзреАрдореА рд╣реИред  рдЬрд░рд╛ рдХрд▓реНрдкрдирд╛ рдХреАрдЬрд┐рдП, рдПрдХ рдЪрд░ рддрдХ рд╣рд░ рдкрд╣реБрдВрдЪ рдПрдХ <code>Environment</code> рд╡рд╕реНрддреБ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛рддреА рд╣реИред  рдЗрдВрдЯрд░рдкреНрд░реЗрдЯрд░ рдХреЛ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИ - рд╣рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкреНрд░рджрд░реНрд╢рди рд▓рд╛рдн рдирд╣реАрдВ рдорд┐рд▓реЗрдЧрд╛ред  рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рд╕рдорд╛рдзрд╛рди рд╣реИ: рдЬреЗрдПрд╕ рдореЗрдВ ╬╗ рднрд╛рд╖рд╛ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ, рдФрд░ рдпрд╣реА рд╣рдо рдХрд░реЗрдВрдЧреЗред  рдкрд╣рд▓реЗ, рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рд╕реАрдкреАрдПрд╕ рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рд╣рдо рдХреНрдпрд╛ рджрд┐рд▓рдЪрд╕реНрдк рдЪреАрдЬреЗрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><h1 id="prodolzheniya">  рдЕрдЧрд▓реА рдХрдбрд╝рд┐рдпреЛрдВ </h1><br><p>  рдЕрдм рдЬрдм рджреБрднрд╛рд╖рд┐рдпрд╛ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рдкреНрд░реЗрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рд╢реИрд▓реА рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдФрд░ рд╕рднреА рдХрд╛рд░реНрдп, ╬╗ рднрд╛рд╖рд╛ рдлрд╝рдВрдХреНрд╢рди рдФрд░ рджреЗрд╢реА JS рдлрд╝рдВрдХреНрд╢рди, рдкрд░рд┐рдгрд╛рдо рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░рдВрддрд░рддрд╛ рдлрд╝рдВрдХреНрд╢рди рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ (рдпрд╣ рддрд░реНрдХ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ ╬╗ рднрд╛рд╖рд╛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдЕрджреГрд╢реНрдп рд╣реИ)ред </p><br><p>  рдЪрд░ <code>callback</code> рдорддрд▓рдм рдкреВрд░реЗ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреА рдирд┐рд░рдВрддрд░рддрд╛ рд╣реИред  <em>рд╡рд╣ рд╕рдм рдЖрдЧреЗ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХрд░реЗрдВрдЧреЗред</em>  рд╣рдо рдЗрд╕ рдЪрд░ рдХреЛ 'рд╡рд░реНрддрдорд╛рди рдирд┐рд░рдВрддрд░рддрд╛' рдпрд╛ рдХреЛрдб рдореЗрдВ <code>k</code> рдХрд╣реЗрдВрдЧреЗред </p><br><p>  рд╕рд╛рде рд╣реА, рдпрджрд┐ рд╣рдо рдирд┐рд░рдВрддрд░рддрд╛ рдХрд╛ рдХрд╛рд░рдг рдирд╣реАрдВ рдмрдирддреЗ рд╣реИрдВ, рддреЛ рдХрд╛рд░реНрдпрдХреНрд░рдо рдмрдВрдж рд╣реЛ рдЬрд╛рдПрдЧрд╛ред  рд╣рдо рдЗрд╕реЗ ╬╗ рднрд╛рд╖рд╛ рд╕реЗ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рдХреНрдпреЛрдВрдХрд┐ <code>make_lambda</code> рд╡реИрд╕реЗ рднреА рдЬрд╛рд░реА <code>make_lambda</code> рд╣реИред  рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕реЗ рдПрдХ рджреЗрд╢реА рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдореИрдВрдиреЗ рдпрд╣ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдорд╛рд░реЛрд╣ рдмрдирд╛рдпрд╛ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: </p><br><pre> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"halt"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k</span></span></span><span class="hljs-function">)</span></span>{});</code> </pre> <br><p>  рдпрд╣ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬреЛ рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рд╡рд╣ рдирд┐рд░рдВрддрд░рддрд╛ ( <code>k</code> ) рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдХреЙрд▓ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ: </p><br><pre> <code class="python hljs">println(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); halt(); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>);</code> </pre> <br><p>  рдирд┐рд╖реНрдХрд░реНрд╖: </p><br><pre> <code class="plaintext hljs">foo</code> </pre> <br><p>  рдпрджрд┐ рдЖрдк <code>halt()</code> рдХреЙрд▓ рдХреЛ рд╣рдЯрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдЙрдЯрдкреБрдЯ рд╣реЛрдЧрд╛: <code>foo / bar / ***Result: false</code> (рдХреНрдпреЛрдВрдХрд┐ рдЕрдВрддрд┐рдо <code>println</code> <code>false</code> рдЖрддреА <code>false</code> )ред  рд▓реЗрдХрд┐рди <code>halt()</code> рдпрд╣ рдХреЗрд╡рд▓ <code>foo</code> рдЖрдЙрдЯрдкреБрдЯ рдХрд░рддрд╛ рд╣реИред  * рдЕрдм рдПрдХ рдкрд░рд┐рдгрд╛рдо рднреА рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ <code>halt()</code> рдПрдХ рдирд┐рд░рдВрддрд░рддрд╛ рдХрд╛ рдХрд╛рд░рдг рдирд╣реАрдВ рдмрдирддрд╛ рд╣реИ рдФрд░ рдЗрд╕рд▓рд┐рдП, рдХреЙрд▓рдмреИрдХ рдЬрд┐рд╕реЗ рд╣рдордиреЗ <code>evaluate</code> рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ <code>evaluate</code> - рд╡рд╣ рдЬреЛ рд╕реНрдЯреНрд░рд┐рдВрдЧ <code>***Result</code> рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдХрднреА рдирд╣реАрдВ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдлрд╝рдВрдХреНрд╢рди рдЬрд┐рд╕реЗ <code>evaluate</code> рдХрд╣рд╛ <code>evaluate</code> рд╣реИ, рдпрд╣ рдзреНрдпрд╛рди рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдХрд╛рд░реНрдпрдХреНрд░рдо рдмрдВрдж рд╣реЛ рдЧрдпрд╛ рд╣реИред  NodeJS рдореЗрдВ, рдпрд╣ рдкреИрд░ рдореЗрдВ рдПрдХ рдЧреЛрд▓реА рд╣реЛрдЧреАред </p><br><hr><br><p>  рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рд╣рдореЗрдВ рдПрдХ <code>sleepe</code> рд╕рдорд╛рд░реЛрд╣ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ рдмрдВрдж рдХрд┐рдП рдмрд┐рдирд╛ рдПрдХ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ (рдЗрд╕рд▓рд┐рдП, рдмреЗрд╡рдХреВрдл рдЫреЛрд░реЛрдВ рдХреЗ рдмрд┐рдирд╛)ред  рд╣рдо рдореВрд▓ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"sleep"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, milliseconds</span></span></span><span class="hljs-function">)</span></span>{ setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ Execute(k, [ <span class="hljs-literal"><span class="hljs-literal">false</span></span> ]); <span class="hljs-comment"><span class="hljs-comment">//   ,  'false' }, milliseconds); });</span></span></code> </pre> <br><p>  рдереЛрдбрд╝реА рд╕реА рдЕрд╕рд╛рд╡рдзрд╛рдиреА рдпрд╣ рд╣реИ рдХрд┐ рд╣рдореЗрдВ <code>Execute</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ <code>setTimeout</code> рдХреЙрд▓рдмреИрдХ рдХрд╛ рдХрд╛рд░рдг рдмрдиреЗрдЧрд╛, рдЬреЛ рддрдм <code>Continuation</code> рдлреЗрдВрдХрддрд╛ рд╣реИ, рдФрд░ рдХреЛрдИ рднреА рдЗрд╕реЗ рдирд╣реАрдВ рдкрдХрдбрд╝реЗрдЧрд╛ред  рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ: </p><br><pre> <code class="python hljs">let loop (n = <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n &lt; <span class="hljs-number"><span class="hljs-number">10</span></span> { println(n); sleep(<span class="hljs-number"><span class="hljs-number">250</span></span>); loop(n + <span class="hljs-number"><span class="hljs-number">1</span></span>); } }; println(<span class="hljs-string"><span class="hljs-string">"And we're done"</span></span>);</code> </pre> <br><p>  рдирд┐рд╖реНрдХрд░реНрд╖: </p><br><pre> <code class="plaintext hljs">0 1 2 3 4 5 6 7 8 9 And we're done ***Result: false</code> </pre> <br><p>  рдзреНрдпрд╛рди рджреЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдкрдВрдХреНрддрд┐ рдХреЗ рдмреАрдЪ рдереЛрдбрд╝реА рджреЗрд░реА рд╣реИред  рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореВрд▓ рд▓реЗрдЦ</a> рдореЗрдВ рдЗрд╕ рдХреЛрдб рдХреЛ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХреБрдЫ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рд╕рд╛рдорд╛рдиреНрдп рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рдореИрдиреБрдЕрд▓ рдЯреНрд░рд╛рдВрд╕рдорд┐рд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛ (рдФрд░ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдк рдЗрд╕рдХреЗ <code>for</code> рд▓реВрдк рдХреЗ <code>for</code> рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ): </p><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(n); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ loop(n + <span class="hljs-number"><span class="hljs-number">1</span></span>); }, <span class="hljs-number"><span class="hljs-number">250</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { println(<span class="hljs-string"><span class="hljs-string">"And we're done"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    } })(0);</span></span></code> </pre> <br><hr><br><p>  рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдЖрдк ode рднрд╛рд╖рд╛ рдореЗрдВ NodeJS API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"readFile"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, filename</span></span></span><span class="hljs-function">)</span></span>{ fs.readFile(filename, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// error handling is a bit more complex, ignoring for now Execute(k, [ data ]); // hope it's clear why we need the Execute }); }); globalEnv.def("writeFile", function(k, filename, data){ fs.writeFile(filename, data, function(err){ Execute(k, [ false ]); }); });</span></span></code> </pre> <br><p>  рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ: </p><br><pre> <code class="python hljs">copyFile = ╬╗(source, dest) { writeFile(dest, readFile(source)); }; copyFile(<span class="hljs-string"><span class="hljs-string">"foo.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"bar.txt"</span></span>);</code> </pre> <br><p>  рдФрд░ рдпрд╣ рд╕рдм рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд░реВрдк рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рдХреЛрдИ рдФрд░ рдЕрдзрд┐рдХ рдХреЙрд▓рдмреИрдХ рдирд░рдХред </p><br><hr><br><p>  рдпрд╣рд╛рдБ рдПрдХ рдФрд░ рджрд┐рд▓рдЪрд╕реНрдк рдЙрджрд╛рд╣рд░рдг рд╣реИред  рдореИрдВрдиреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореВрд▓ рдХрд╛рд░реНрдп рд▓рд┐рдЦрд╛ рд╣реИ: </p><br><pre> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"twice"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, a, b</span></span></span><span class="hljs-function">)</span></span>{ k(a); k(b); });</code> </pre> <br><p>  рдХрд╛рд░реНрдпрдХреНрд░рдо рджреЛ рддрд░реНрдХ <code>a</code> рдФрд░ <code>b</code> рд▓реЗрддрд╛ <code>a</code> рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рддрд░реНрдХ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рд░ рдирд┐рд░рдВрддрд░рддрд╛ рдХрд╣рддрд╛ рд╣реИред  рдЖрдЗрдП рдЗрд╕реЗ рдХреЙрд▓ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ: </p><br><pre> <code class="python hljs">println(<span class="hljs-number"><span class="hljs-number">2</span></span> + twice(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)); println(<span class="hljs-string"><span class="hljs-string">"Done"</span></span>);</code> </pre> <br><p>  рдирд┐рд╖реНрдХрд░реНрд╖: </p><br><pre> <code class="plaintext hljs">5 Done ***Result: false 6 Done ***Result: false</code> </pre> <br><p>  рдирд┐рд╖реНрдХрд░реНрд╖ рдЕрдЬреАрдм рд╣реИ рдЕрдЧрд░ рдЖрдкрдиреЗ рдкрд╣рд▓реЗ рдХрднреА рднреА рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рдХреЛрдб рдХреЛ рд╕реНрд╡рдпрдВ рд╕рдордЭрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред  рдереЛрдбрд╝рд╛ рд╕рдВрдХреЗрдд: рдХрд╛рд░реНрдпрдХреНрд░рдо рдПрдХ рдмрд╛рд░ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкрд░рд┐рдгрд╛рдо рджреЛ рдмрд╛рд░ рд▓реМрдЯрддрд╛ рд╣реИред </p><br><h2 id="obobschenie-callcc">  рд╕рд╛рдорд╛рдиреНрдпреАрдХрд░рдг: <code>CallCC</code> </h2><br><p>  рдЬрдм рд╣рдо рджреЗрд╢реА рдХрд╛рд░реНрдп рд▓рд┐рдЦрддреЗ рдереЗ рддреЛ рд╣рдо рдЖрдЧ рд╕реЗ рдЦреЗрд▓рддреЗ рдереЗред  рд╡рд░реНрддрдорд╛рди рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ╬╗ рднрд╛рд╖рд╛ рдореЗрдВ рдХреЛрдИ рд░рд╛рд╕реНрддрд╛ рдирд╣реАрдВ рд╣реИред  <code>CallCC</code> рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧреАред  рдирд╛рдо рдпреЛрдЬрдирд╛ рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдирд╛рдо рд╣реИ - <code>call-with-current-continuation</code> (рдЬрд┐рд╕реЗ рдЖрдорддреМрд░ рдкрд░ рдпреЛрдЬрдирд╛ рдореЗрдВ рдХреЙрд▓ / рд╕реАрд╕реА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ)ред </p><br><pre> <code class="javascript hljs">globalEnv.def(<span class="hljs-string"><span class="hljs-string">"CallCC"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k, f</span></span></span><span class="hljs-function">)</span></span>{ f(k, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">discarded, ret</span></span></span><span class="hljs-function">)</span></span>{ k(ret); }); });</code> </pre> <br><p>  рдпрд╣ рдПрдХ рдлрдВрдХреНрд╢рди рдореЗрдВ рд╡рд░реНрддрдорд╛рди рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджрд░реНрд╢рд╛рддрд╛</a> рд╣реИ рдЬрд┐рд╕реЗ рд╕реАрдзреЗ ╬╗ рднрд╛рд╖рд╛ рд╕реЗ рдХрд╣рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдЗрд╕рдХреА рдореВрд▓ <code>CallCC</code> рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рдЕрдирджреЗрдЦрд╛ <code>discarded</code> рджреЗрдЧрд╛ рдФрд░ рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рдЙрд╕ рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛ рдЬреЛ <code>CallCC</code> рдлрд╝рдВрдХреНрд╢рди рдХреЛ рджреА <code>CallCC</code> ред </p><br><p>  рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕реАрдзреЗ рднрд╛рд╖рд╛ рдореЗрдВ, рджреЗрд╢реА рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд╣реАрдВ!) рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╡рд╛рд╣ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдВрддреНрд░рдг рдХрдердиреЛрдВ рдХрд╛ рдПрдХ рдмрдбрд╝рд╛ рд╕реЗрдЯ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдкрд╣рд▓реЗ рднреА рдирд╣реАрдВ рд╕реЛрдЪрд╛ рдерд╛ - рдЕрдкрд╡рд╛рджреЛрдВ рд╕реЗ рд╢реБрд░реВ рдФрд░ <code>return</code> рд╕рд╛рде рд╕рдорд╛рдкреНрддред  рдЪрд▓реЛ рдЖрдЦрд┐рд░реА рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред </p><br><h3 id="realizaciya-return">  рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди <code>return</code> </h3><br><pre> <code class="python hljs">foo = ╬╗(<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>){ println(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-string"><span class="hljs-string">"DONE"</span></span>); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>); }; CallCC(foo);</code> </pre> <br><p>  рдирд┐рд╖реНрдХрд░реНрд╖: </p><br><pre> <code class="plaintext hljs">foo ***Result: DONE</code> </pre> <br><p>  <code>foo</code> рдлрд╝рдВрдХреНрд╢рди рдПрдХ рддрд░реНрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕реЗ <code>return</code> рдХреЗ рд╕рдорд╛рди рд╣реЛрддрд╛ рд╣реИ (рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдирд┐рдпрдорд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ)ред  рдпрд╣ рд╡рд░реНрддрдорд╛рди рдирд┐рд░рдВрддрд░рддрд╛ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддрд╛ рд╣реИ (рдЬреЛ 'рдмрд╛рд░' рдЖрдЙрдЯрдкреБрдЯ рдХрд░реЗрдЧрд╛) рдФрд░ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддрд╛ рд╣реИ, рджрд┐рдП рдЧрдП рдореВрд▓реНрдп ("рдкреВрд░рд╛") рдХреЛ рд╡рд╛рдкрд╕ рдХрд░рддрд╛ рд╣реИред  рдмреЗрд╢рдХ, рдпрд╣ рдХреЗрд╡рд▓ рддрднреА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬрдм рдЖрдк рдХреЙрд▓ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЙрд▓ рдХреЛ <code>return</code> рд░реВрдк рдореЗрдВ рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛рд╕ рдХрд░рддреЗ <code>return</code> ред  рд╣рдо рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрд╡рд░рдг рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = ╬╗(f) ╬╗() CallCC(f); foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(╬╗(<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>){ println(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-string"><span class="hljs-string">"DONE"</span></span>); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>); }); foo();</code> </pre> <br><p>  рдирд┐рд╖реНрдХрд░реНрд╖: </p><br><pre> <code class="plaintext hljs">foo ***Result: DONE</code> </pre> <br><p>  рдЗрд╕ рдкрджреНрдзрддрд┐ рдХрд╛ рд▓рд╛рдн рдпрд╣ рд╣реИ рдХрд┐ рдЬрдм рд╣рдо <code>foo</code> рдлреЛрди рдХрд░рддреЗ рд╣реИрдВ рддреЛ рд╣рдореЗрдВ <code>CallCC</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред  рдпрд╣ рдЕрдЪреНрдЫрд╛ рд╣реЛрдЧрд╛, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдЕрдЧрд░ рд╣рдореЗрдВ рдПрдХ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ <code>return</code> рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдпрд╛ <code>with-return</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рдереА, рд▓реЗрдХрд┐рди рднрд╛рд╖рд╛ рдореЗрдВ рд╕реАрдзреЗ рд╕реЗ рд╕реЗрдиреЗрдЯрд┐рдХ рдЪреАрдиреА рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рдХреЛрдИ рддрд░реАрдХрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рдкрд╛рд░реНрд╕рд░ (рд▓рд┐рд╕реНрдк рдХреЗ рд▓рд┐рдП +1) рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><h3 id="perehody">  рд╕рдВрдХреНрд░рдордг </h3><br><p>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬреЛ 100 рддрдХ рдХреЗ рд╕рднреА рд╕рдХрд╛рд░рд╛рддреНрдордХ рдкреВрд░реНрдгрд╛рдВрдХ рдХреЗ рдЬреЛрдбрд╝реЗ рдХреЛ рджреЗрдЦреЗрдЧрд╛, рдпрджрд┐ рдЙрдирдХрд╛ рдЧреБрдгрди 84 рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдХреЛрдИ рдореБрд╢реНрдХрд┐рд▓ рдХрд╛рдо рдирд╣реАрдВ рд╣реИ рдФрд░ рдЖрдк рдЗрд╕реЗ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреБрд░рдВрдд рджреЛ рдиреЗрд╕реНрдЯреЗрдб рд▓реВрдкреЛрдВ рдХреА рдХрд▓реНрдкрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рд╣рдо рдПрдХ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рдЬрд╛рддреЗ рд╣реИрдВред  рд╣рдо рджреЛ рдХрд╛рд░реНрдп рдмрдирд╛рдПрдВрдЧреЗ: <code>guess</code> рдФрд░ <code>fail</code> ред  рдкрд╣рд▓рд╛ рдирдВрдмрд░ рдЪреБрдиреЗрдЧрд╛, рдФрд░ рджреВрд╕рд░рд╛ рдЙрд╕реЗ рдмрддрд╛рддрд╛ рд╣реИ "рджреВрд╕рд░реЗ рдирдВрдмрд░ рдкрд░ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред"  рд╣рдо рдЙрдиреНрд╣реЗрдВ рдЗрд╕ рддрд░рд╣ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ: </p><br><pre> <code class="python hljs">a = guess(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">#  -  &gt;= 1 b = guess(a); #  -  &gt;= a if a * b == 84 { #    : print(a); print(" x "); println(b); }; fail(); #    `guess`    </span></span></code> </pre> <br><p>  : </p><br><pre> <code class="python hljs">fail = ╬╗() false; guess = ╬╗(current) { CallCC(╬╗(k){ let (prevFail = fail) { fail = ╬╗(){ current = current + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current &gt; <span class="hljs-number"><span class="hljs-number">100</span></span> { fail = prevFail; fail(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { k(current); }; }; k(current); }; }); }; a = guess(<span class="hljs-number"><span class="hljs-number">1</span></span>); b = guess(a); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a * b == <span class="hljs-number"><span class="hljs-number">84</span></span> { print(a); print(<span class="hljs-string"><span class="hljs-string">" x "</span></span>); println(b); }; fail();</code> </pre> <br><p>     ,  ,      <code>a</code> ,    <code>84</code> ,   <code>b</code> ,  <code>84 / a</code> .           <code>guess</code> : <code>start</code>  <code>end</code> тАФ      .   ,  . </p><br><h3 id="try-i-catch-iz-common-lisp"> <code>try</code>  <code>catch</code>  Common Lisp </h3><br><p>     тАФ <code>catch</code>  <code>throw</code> .     : </p><br><pre> <code class="python hljs">f1 = ╬╗() { throw(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span>); print(<span class="hljs-string"><span class="hljs-string">"not reached"</span></span>); }; println(catch(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>, ╬╗() { f1(); print(<span class="hljs-string"><span class="hljs-string">"not reached"</span></span>); })); <span class="hljs-comment"><span class="hljs-comment">#  EXIT</span></span></code> </pre> <br><ul><li>  <code>catch(TAG, function)</code>  ,    ,  <code>TAG</code> ',   <code>function</code> . </li><li>  <code>throw(TAG, value)</code>  ,     ,  <code>TAG</code> '  ,     <code>value</code> . </li></ul><br><p>  : </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">##  , 'throw'   . ##       `error`, ##     JavaScript.    . throw = ╬╗(){ println("ERROR: No more catch handlers!"); halt(); }; catch = ╬╗(tag, func){ CallCC(╬╗(k){ let (rethrow = throw, ret) { ##   ,     . throw = ╬╗(t, val) { throw = rethrow; #   ,   . if t == tag then k(val) else throw(t, val); }; ##      . ret = func(); ##       (  'throw') ##    .   . throw = rethrow; # XXX ##  . ret; }; }); };</span></span></code> </pre> <br><p>  рдПрдХ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># ... f1 = ╬╗() { throw("foo", "EXIT"); print("not reached"); }; println(catch("foo", ╬╗() { f1(); print("not reached"); }));</span></span></code> </pre> <br><h2 id="temnaya-storona-sily">    </h2><br><p>    <code>catch</code> ,     ,    ,    .   ,    , ,  <code>CallCC</code>     .    ,     .    "   " тАФ      тАФ  .    ,  ,     ,  <code>catch</code> / <code>throw</code>    ,  . </p><br><p>    .   ,    <code>catch</code> . ,   <code>throw</code>   , ,  <code>catch</code>   ,     .  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: </p><br><pre> <code class="python hljs">exit = false; <span class="hljs-comment"><span class="hljs-comment">#  . x = 0; # :   ,   'exit()'  CallCC( ╬╗(k) exit = k ); ## 'exit()'   ... if x == 0 then catch("foo", ╬╗(){ println("in catch"); x = 1; #  exit(); }); println("After catch"); throw("foo", "FOO");</span></span></code> </pre> <br><p>  рдирд┐рд╖реНрдХрд░реНрд╖: </p><br><pre> <code class="plaintext hljs">After catch After catch ERROR: No more catch handlers!</code> </pre> <br><p>    'After catch' ,   'ERROR: No more catch handlers!'. -  ,   'After catch'   ,   . ,  ''  ,  <code>catch</code> . ,    'XXX'   <code>catch</code>   ,         <code>throw</code> ,   <code>catch</code>   . </p><br><p> (       ,     .) </p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  CallCC</a> (, <em>   ,   CallCC</em> ).  ,    тАФ  <code>CallCC</code>           . </p><br><h1 id="yield"> Yield </h1><br><p> ,    ,   <code>yield</code> : </p><br><pre> <code class="python hljs">foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(╬╗(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); <span class="hljs-comment"><span class="hljs-comment"># 1 println(foo()); # 2 println(foo()); # 3 println(foo()); # DONE</span></span></code> </pre> <br><p>    <code>yield</code> ,       .  ,  <code>return</code> .      ,       ,    <code>yield</code> ,       . </p><br><p>  : </p><br><pre> <code class="python hljs">fib = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(╬╗(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ let loop (a = <span class="hljs-number"><span class="hljs-number">1</span></span>, b = <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(b); loop(b, a + b); }; }); <span class="hljs-comment"><span class="hljs-comment">##   50   let loop (i = 0) { if i &lt; 50 { println(fib()); loop(i + 1); }; };</span></span></code> </pre> <br><p>  <code>fib</code>   .    .  <code>yield</code>      .     ,    ,         50  ,      50 . </p><br><p> ,      ,     , ,            . </p><br><h2 id="neudachnaya-popytka-realizacii">    </h2><br><p>          ,         . </p><br><p>   <code>yield</code> ,  ,       .   ,        ,      <code>return</code> . ,  ,    <code>yield</code> ,       <code>yield</code> ,         <em></em> .   ,   .      : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(func) { <span class="hljs-comment"><span class="hljs-comment">## with-yield     ╬╗() { CallCC(╬╗(kret){ # kret     let (yield) { ##  yield yield = ╬╗(value) { # yield  ,    CallCC(╬╗(kyld){ # kyld    yield... func = kyld; # ...     kret(value); #  . }); }; ## , ,  ,   yield. func(yield); }; }); }; };</span></span></code> </pre> <br><p>       <code>yield</code>  ,     . ,         ,     ,      "DONE". </p><br><p> ,     .   ,     - ,     ,    4   : </p><br><pre> <code class="python hljs">println(foo()); foo();</code> </pre> <br><p>    . </p><br><h3 id="problema-1-yield-nikogda-ne-izmenyaetsya">  тДЦ1: yield    </h3><br><p>  ,   ,  ,   ,     <code>yield</code> ( <code>kyld</code> ,    ,   )    : </p><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>;</code> </pre> <br><p>    <code>yield</code>   ?     <code>yield</code> ,       ,    <code>yield</code>    . ,    .  ,     <code>yield</code>        <code>return</code> ,      : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(value) { CallCC(╬╗(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); <span class="hljs-comment"><span class="hljs-comment"># 'return'  ,     }); #        . }; # ╬╗(val) { # CallCC(╬╗(kret){ # return = kret; # &lt;-  func(val || yield); }); }; }; };</span></span></code> </pre> <br><p> ,  ,       <code>yield</code>  ,   <code>yield</code>       (  ).      <code>yield</code> . </p><br><p>   ,    ,    <code>println(foo())</code>   : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(value) { CallCC(╬╗(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); }); }; ╬╗(val) { CallCC(╬╗(kret){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = kret; func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); }); }; }; }; foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(╬╗(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); println(foo()); println(foo());</code> </pre> <br><p> ,    .        ,      <code>print(foo()); foo()</code> .   ,     <code>println(foo())</code> ?   ... </p><br><h3 id="problema-2-wtf">  тДЦ2: WTF? </h3><br><p>     .     :    ,          <code>foo()</code> .  ,     ? тАФ    . </p><br><pre> <code class="python hljs">println(foo()); <span class="hljs-comment"><span class="hljs-comment">## yield 1 &lt;-----------------  ---------------------------+ println(foo()); ## yield 2 | println(foo()); ## yield 3 | println(foo()); ##   "DONE",   foo()  --&gt;--+</span></span></code> </pre> <br><p>       <code>with-yield</code> : </p><br><pre> <code class="python hljs"> func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); <span class="hljs-comment"><span class="hljs-comment">#...</span></span></code> </pre> <br><p>     <code>yield</code> ,   ,       <code>#...</code> .   ,   ,     ( <code>"DONE"</code> ),     ,   <code>"DONE"</code>   ,     . <code>foo()</code>     ,    <code>"DONE"</code>   .      : </p><br><pre> <code class="python hljs">println(foo()); println(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>); println(foo()); println(foo()); foo();</code> </pre> <br><p>   : <code>1, bar, 2, 3, DONE, bar, DONE, bar, ...</code> . </p><br><p>      <code>func</code>  - ,    .   ,    <code>"no more continuations"</code> : </p><br><pre> <code class="python hljs"> val = func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); func = ╬╗() <span class="hljs-string"><span class="hljs-string">"NO MORE CONTINUATIONS"</span></span>; kret(val);</code> </pre> <br><p>     : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(value) { CallCC(╬╗(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); }); }; ╬╗(val) { CallCC(╬╗(kret){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = kret; val = func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); func = ╬╗() <span class="hljs-string"><span class="hljs-string">"NO MORE CONTINUATIONS"</span></span>; kret(val); }); }; }; }; foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(╬╗(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); println(foo()); println(foo()); println(foo());</code> </pre> <br><p>      ,     : </p><br><pre> <code class="plaintext hljs">1 2 3 DONE NO MORE CONTINUATIONS NO MORE CONTINUATIONS NO MORE CONTINUATIONS ***Result: false</code> </pre> <br><p>    <code>1, 2, 3, DONE</code> ,      <code>"NO MORE CONTINUATIONS"</code>  .  ,       : </p><br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">"A. "</span></span>); println(foo()); print(<span class="hljs-string"><span class="hljs-string">"B. "</span></span>); println(foo()); print(<span class="hljs-string"><span class="hljs-string">"C. "</span></span>); println(foo()); print(<span class="hljs-string"><span class="hljs-string">"D. "</span></span>); println(foo()); <span class="hljs-comment"><span class="hljs-comment">##   : A. 1 B. 2 C. 3 D. DONE B. NO MORE CONTINUATIONS C. NO MORE CONTINUATIONS D. NO MORE CONTINUATIONS ***Result: false</span></span></code> </pre> <br><p>  ,     :       , , ,      ,  <code>"B."</code>   . </p><br><p>       ,         <code>yield</code> ,     : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(value) { CallCC(╬╗(kyld){ func = kyld; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(value); }); }; ╬╗(val) { CallCC(╬╗(kret){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> = kret; val = func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>); func = ╬╗() <span class="hljs-string"><span class="hljs-string">"NO MORE CONTINUATIONS"</span></span>; kret(val); }); }; }; }; fib = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(╬╗(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ let loop (a = <span class="hljs-number"><span class="hljs-number">1</span></span>, b = <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(b); loop(b, a + b); }; }); <span class="hljs-comment"><span class="hljs-comment">##   50   let loop (i = 0) { if i &lt; 50 { println(fib()); loop(i + 1); }; };</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рдирд┐рд╖реНрдХрд░реНрд╖</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765 10946 17711 28657 46368 75025 121393 196418 317811 514229 832040 1346269 2178309 3524578 5702887 9227465 14930352 24157817 39088169 63245986 102334155 165580141 267914296 433494437 701408733 1134903170 1836311903 2971215073 4807526976 7778742049 12586269025 20365011074 ***Result: false</code> </pre> </div></div><br><p> ,      (,       ),       " ". </p><br><h2 id="otdelennye-prodolzheniya-reset-i-shift">  : <code>reset</code>  <code>shift</code> </h2><br><p>    <code>yield</code>    : <code>reset</code>  <code>shift</code> .   " " тАФ ,     .  <code>reset</code>  ,   <code>shift</code>     ,   <code>CallCC</code> . </p><br><p>  , <code>reset</code>  <code>shift</code>    тАФ .     <code>reset</code> ,  <code>shift</code>      ,    <code>reset</code> . </p><br><p>  ,    <code>with-yield</code> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-comment"><span class="hljs-comment">## 'yield'  'shift'     ##  'reset'.  ,   ,    ##   'func' тАФ ,   `func()` ##    ,    . yield = ╬╗(val) { shift(╬╗(k){ func = k; #    val; #    }); }; ##  `with-yield`      ##   'reset',    ,  ##   'yield' ( )    ##    ╬╗(val) { reset( ╬╗() func(val || yield) ); }; } };</span></span></code> </pre> <br><p>  ,      <code>reset</code> .  ,  ,       ,     <code>reset</code> .  ,    .     ,           . </p><br><p>     : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(func) { let (<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> = ╬╗(val) { shift(╬╗(k){ func = k; val; }); }; ╬╗(val) { reset( ╬╗() func(val || <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>) ); }; } }; foo = <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(╬╗(<span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-string"><span class="hljs-string">"DONE"</span></span>; }); println(foo()); <span class="hljs-comment"><span class="hljs-comment">#  1 println(foo()); #  2 println(foo()); #  3 println(foo()); #  DONE</span></span></code> </pre> <br><h2 id="realizaciya-reset-i-shift">  <code>reset</code>  <code>shift</code> </h2><br><p>       ,      .    .     .     ,     ,        ,   .    <a href="">  Scheme</a> ( тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Oleg Kiselyov</a> ).   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a>     . </p><br><h3 id="ispolzuya-nativnye-funkcii">    </h3><br><p>      ,      (    <code>CallCC</code> )         .   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pstack = []; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_goto</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f</span></span></span><span class="hljs-function">) </span></span>{ f(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">KGOTO</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> h = pstack.pop(); h(r); }); } globalEnv.def(<span class="hljs-string"><span class="hljs-string">"reset"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KRESET, th</span></span></span><span class="hljs-function">)</span></span>{ pstack.push(KRESET); _goto(th); }); globalEnv.def(<span class="hljs-string"><span class="hljs-string">"shift"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KSHIFT, f</span></span></span><span class="hljs-function">)</span></span>{ _goto(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">KGOTO</span></span></span><span class="hljs-function">)</span></span>{ f(KGOTO, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SK</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">k1, v</span></span></span><span class="hljs-function">)</span></span>{ pstack.push(k1); KSHIFT(v); }); }); });</code> </pre> <br><p>   ,   <code>reset</code> ,   <code>shift</code>  <code>_goto</code> ,  тАФ  .     .  <code>_goto</code>         ( <code>KGOTO</code> ).  ,       <code>f</code> (  <code>CallCC</code> )    -      <code>KGOTO</code> ,     .  ,  <code>f</code> ,   ,    <code>KGOTO</code> ,      ,     . </p><br><p>  <code>reset</code>      ( <code>KRESET</code> )     <code>_goto(th)</code> .      ,    , ,      <code>_goto</code> . ,     , <code>KGOTO</code>   <code>KRESET</code> . </p><br><p>   , <code>shift</code>     <code>KGOTO</code>     ,  <code>KGOTO</code>    <code>pstack</code> ,      <code>SK</code> ,     ,   <code>shift</code>   (   <code>shift</code> тАФ <code>KSHIFT</code> ).  <code>SK</code> тАФ   тАФ              ( <code>k1</code> )   .   ,     <code>shift2</code> ,    ,    <code>pstack.push(k1);</code> : </p><br><pre> <code class="python hljs">println(reset(╬╗(){ <span class="hljs-number"><span class="hljs-number">1</span></span> + shift( ╬╗(k) k(k(<span class="hljs-number"><span class="hljs-number">2</span></span>)) ); })); println(reset(╬╗(){ <span class="hljs-number"><span class="hljs-number">1</span></span> + shift2( ╬╗(k) k(k(<span class="hljs-number"><span class="hljs-number">2</span></span>)) ); }));</code> </pre> <br><p>  рдирд┐рд╖реНрдХрд░реНрд╖: </p><br><pre> <code class="plaintext hljs">4 3 ***Result: false</code> </pre> <br><p>  <code>shift</code>    ( <code>k</code> ),       <code>reset</code> .     тАФ  1   <code>shift</code> : </p><br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> + [?]</code> </pre> <br><p>    <code>k</code> ,   <code>?</code> .     тАФ <code>k(k(2))</code> .   2   ,   <code>k(2)</code>  3. ,  <code>k(3)</code>  3     ,     4. </p><br><p> <code>shift2</code>  :  k(2)    . </p><br><h3 id="ispolzuya-callcc">  <code>CallCC</code> </h3><br><p>   ,       ,     <code>CallCC</code> ,    .     ,     JS, ,      ,       .    ,    <code>CallCC</code> ,    . </p><br><p>      тАФ    <code>goto</code> ,       (    ): </p><br><pre> <code class="plaintext hljs">pstack = NIL; goto = false; reset = ╬╗(th) { CallCC(╬╗(k){ pstack = cons(k, pstack); goto(th); }); }; shift = ╬╗(f) { CallCC(╬╗(k){ goto(╬╗(){ f(╬╗(v){ CallCC(╬╗(k1){ pstack = cons(k1, pstack); k(v); }); }); }); }); }; let (v = CallCC( ╬╗(k){ goto = k; k(false) } )) { if v then let (r = v(), h = car(pstack)) { pstack = cdr(pstack); h(r); } };</code> </pre> <br><p>          тАФ        ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi444024/">https://habr.com/ru/post/hi444024/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi444014/index.html">Microsoft рдмрд┐рдЬрдиреЗрд╕ рд╕реНрдХреВрд▓ рдХреЛ AI рд░рдгрдиреАрддрд┐рдпрд╛рдБ, рд╕рдВрд╕реНрдХреГрддрд┐ рдФрд░ рдЬрд┐рдореНрдореЗрджрд╛рд░реА рд╕реАрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЦреЛрд▓рддрд╛ рд╣реИ</a></li>
<li><a href="../hi444016/index.html">Microsoft рдЧреЗрдо рд╕реНрдЯреИрдХ рдХреЗ рд╕рд╛рде рдЕрдзрд┐рдХ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</a></li>
<li><a href="../hi444018/index.html">рдХреИрд╕реЗ рдПрдХ PostgreSQL рд╡рд┐рдиреНрдпрд╛рд╕ рдкрд░рд┐рд╡рд░реНрддрди рдзреАрдореА рдХреНрд╡реЗрд░реА рдкреНрд░рджрд░реНрд╢рди 50 рдЯрд╛рдЗрдореНрд╕ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi444020/index.html">рдпреВрдПрд╕рдПрд╕рдЖрд░ рдореЗрдВ рдХрд╛рд░реНрдЯрд┐рдВрдЧ: рд╕реЛрд╡рд┐рдпрдд рд╕рдВрдШ рдореЗрдВ рдЕрдореЗрд░рд┐рдХреА рдкрд╛рдпрд▓рдЯреЛрдВ рдХрд╛ рд╢реМрдХ рдПрдХ рд╡рд┐рд╢рд╛рд▓ DIY рд╢реМрдХ рдХреИрд╕реЗ рдмрди рдЧрдпрд╛</a></li>
<li><a href="../hi444022/index.html">рдмреАрдЧреЛ рдЕрдм рдЧреЛ рдирд╣реАрдВ рд╣реИ</a></li>
<li><a href="../hi444026/index.html">MODX рдбрд╛рдЗрдЬреЗрд╕реНрдЯ # 1.1 (25 рдлрд░рд╡рд░реА - 11 рдорд╛рд░реНрдЪ, 2019)</a></li>
<li><a href="../hi444028/index.html">рдкреЗрд╢ рд╣реИ рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдЧреЗрдо рд╕реНрдЯреИрдХ</a></li>
<li><a href="../hi444030/index.html">рдЪреАрдиреА рдСрдирд▓рд╛рдЗрди рд░рд┐рдЯреЗрд▓рд░ рдЧрд┐рдпрд░рдмреЗрд╕реНрдЯ рдиреЗ рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕ рдЦреЛрд▓рд╛ рдЬрд┐рд╕рдореЗрдВ рд▓рд╛рдЦреЛрдВ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЧреНрд░рд╛рд╣рдХ рдбреЗрдЯрд╛ рдереЗ</a></li>
<li><a href="../hi444032/index.html">рдХреНрдпреЛрдВ рдПрдХ 3 рдбреА рдкреНрд░рд┐рдВрдЯрд░ рдПрдХ рдкреНрд░рд┐рдВрдЯрд░ рдирд╣реАрдВ рд╣реИ</a></li>
<li><a href="../hi444034/index.html">рдПрдХ рдкреНрд░рдмрдВрдзрдХ рдХреЗ 7 рдШрд╛рддрдХ рдкрд╛рдк</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>