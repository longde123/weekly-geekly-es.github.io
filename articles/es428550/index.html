<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üó°Ô∏è üò≥ üòõ Un inversor con un seno puro en 15 minutos o "electr√≥nica de potencia - para todos" üë®üèæ‚Äçüè≠ üßïüèø üë¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øQu√© es la electr√≥nica de potencia? Sin duda, ¬°este es el mundo entero! Moderno y lleno de confort. Mucha gente piensa en la electr√≥nica de potencia c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un inversor con un seno puro en 15 minutos o "electr√≥nica de potencia - para todos"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428550/">  ¬øQu√© es la electr√≥nica de potencia?  Sin duda, ¬°este es el mundo entero!  Moderno y lleno de confort.  Mucha gente piensa en la electr√≥nica de potencia como algo "m√°gico" y distante, pero mira a nuestro alrededor: casi todo lo que nos rodea contiene un convertidor de potencia: una fuente de alimentaci√≥n para computadora port√°til, una l√°mpara LED, UPS, varios reguladores, reguladores de voltaje, medidores de frecuencia (IF) ) en la ventilaci√≥n o ascensor y mucho m√°s.  La mayor parte de este equipo hace que nuestra vida sea c√≥moda y segura. <br><br>  Por varias razones, el desarrollo de la electr√≥nica de potencia es una de las √°reas m√°s dif√≠ciles de la electr√≥nica: el precio del error es muy alto, mientras que el desarrollo de convertidores de potencia siempre ha atra√≠do a los amantes, los trabajadores de bricolaje y no solo.  ¬øSeguramente quer√≠as construir una poderosa fuente de alimentaci√≥n para tu proyecto?  ¬øO tal vez UPS en l√≠nea por un par de kW y no quebrar?  ¬øO tal vez un chastotnik en el taller? <br><br>  Hoy hablar√© sobre mi peque√±o proyecto abierto, o m√°s bien sobre su parte, que permitir√° a cualquiera que quiera ingresar al mundo del desarrollo de la electr√≥nica de potencia y al mismo tiempo mantenerse con vida.  Como demostraci√≥n de las posibilidades, mostrar√© c√≥mo ensamblar un inversor de voltaje de 12 V CC a 230 V CA con una salida sinusoidal en 15 minutos.  Intrigado?  Vamos! <br><br><img src="https://habrastorage.org/webt/na/rx/gk/narxgkn5e_6tiuqmfysesuukoug.jpeg"><br><a name="habracut"></a><br><br><h2>  Razones del proyecto </h2><br>  En los √∫ltimos a√±os, el desarrollo de convertidores de potencia ha representado alrededor del 90% de mis pedidos, los principales costos de mano de obra se destinan principalmente al desarrollo de software y creaci√≥n de prototipos, el dise√±o de circuitos + el seguimiento final de la placa del costo total generalmente no es m√°s del 10-15%.  Aqu√≠ llega el entendimiento de que el proceso de creaci√≥n de prototipos, que incluye el desarrollo de software, debe reducirse y optimizarse de alguna manera. <br><br>  Hay al menos dos opciones como siempre: comprar depuraci√≥n ya preparada, por ejemplo, de Texas Instrumets o Infineon, pero generalmente est√°n dise√±ados para una tarea espec√≠fica y cuestan de $ 500 a $ 5,000, mientras que no hay garant√≠a de que habr√° un pedido similar y esta inversi√≥n con alta probabilidad es f√°cil no valdr√° la pena <br>  La segunda opci√≥n es hacerlo usted mismo, pero hacerlo a fondo es casi lo mismo que lanzar "+1 revisi√≥n de hierro", lo que generar√° gastos adicionales para el cliente.  Si no se hace a fondo, entonces, como siempre, todo estar√° en mocos y en alg√∫n lugar algo se caer√° y hasta el dise√±o, los componentes y el tiempo. <br>  Despu√©s de un tiempo, llam√© la atenci√≥n sobre la soluci√≥n m√°s obvia.  Es tan simple y obvio que durante mucho tiempo me pregunt√© por qu√© el mismo TI o Infineon a√∫n no lo hab√≠an hecho.  Ahora contar√© sobre mi "iluminaci√≥n". <br><br>  Veamos algunas de las topolog√≠as de convertidor de potencia m√°s populares: <br><br><img src="https://habrastorage.org/webt/d8/_c/0v/d8_c0v8ih8ydkihocalqkrqc2xw.png"><br><img src="https://habrastorage.org/webt/gt/hy/fn/gthyfnx_nnsjohhak7ls4xjszny.png"><br><img src="https://habrastorage.org/webt/bk/ag/qq/bkagqqyzbrqjntnfuxsrrvuxpyy.png"><br><img src="https://habrastorage.org/webt/0y/w0/xp/0yw0xpwofk5jjf47usbdrwglyfy.png"><br><img src="https://habrastorage.org/webt/-c/mz/z_/-cmzz_9skvlq8ux30pjluy0zkvi.png"><br><br>  Ahora mira cuidadosamente de nuevo.  Pint√© espec√≠ficamente sin flejes, solo los componentes clave para hacerlo m√°s claro.  ¬øQu√© tienen en com√∫n estas topolog√≠as?  Lo primero que llama la atenci√≥n es una serie de puntos comunes: <br><ul><li>  Todas las topolog√≠as incluyen los componentes principales: condensadores, transistores e inductancia (inductor o transformador).  Estas son 3 ballenas de electr√≥nica de potencia; </li><li>  Los transistores se activan en todas partes del mismo modo y forman el llamado "medio puente".  Casi todas las topolog√≠as de convertidor se crean a partir de √©l; </li><li>  La opci√≥n de encender el acoplador de medio puente + condensador no cambia en todas las topolog√≠as.  El tipo de inductancia y las opciones para activar los medios puentes est√°n cambiando. </li></ul><br><br>  A partir de esto, podemos concluir que al tener un cierto m√≥dulo est√°ndar en forma de medio puente + condensador acoplado, puede construir cualquier convertidor agregando solo el inductor o transformador necesarios.  Por lo tanto, la soluci√≥n obvia para simplificar la creaci√≥n de prototipos fue la creaci√≥n de dicho m√≥dulo: <br><img src="https://habrastorage.org/webt/vx/d6/ec/vxd6ec8swnwqef7v6uhkljsysek.png"><br><br><h2>  La lucha entre el bien y el mal. </h2><br>  Desafortunadamente, un n√∫mero limitado de horas por d√≠a y la pereza banal dictan sus condiciones.  Llegu√© a la necesidad de hacer este m√≥dulo hace un a√±o, pero la implementaci√≥n se transfiri√≥ constantemente bajo el lema: <i>"¬°Definitivamente lo har√© el pr√≥ximo fin de semana!"</i>  . <br><br>  Quiz√°s la idea hubiera quedado en el estante, si no fuera por 2 eventos.  En primer lugar, 2 clientes vinieron a m√≠ en un mes y todos quer√≠an un convertidor que fuera complejo e interesante de implementar, y lo m√°s importante, estaban listos para pagar muy bien.  Aunque teniendo en cuenta que √©l es de Europa, puede haber resultado barato para ellos)) Ambos proyectos fueron interesantes para m√≠, por ejemplo, uno de ellos era un "regulador de voltaje trif√°sico con aislamiento galv√°nico (sic!)", Es decir, un trif√°sico PFC + 3 convertidores de puente (desfasados) + rectificador s√≠ncrono + inversor trif√°sico.  Todo esto en SiC y muy compacto.  En general, tom√© 2 pedidos grandes, cada uno de ellos ~ 800 horas hombre y un per√≠odo de 6 meses.  Como resultado, me "obligaron" a buscar formas de optimizaci√≥n. <br><br>  En segundo lugar, los muchachos de la compa√±√≠a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PCBway me</a> escribieron inesperadamente, muchos probablemente les pidieron tableros y se ofrecieron a cooperar.  Apoyan muy activamente los proyectos de hardware abierto, es decir, la propia iniciativa de CERN - Open Source Hardware.  La cooperaci√≥n es simple, comprensible para ambas partes: me proporcionan tableros gratuitos para mis proyectos, y los abro y los coloco en su sitio web, en otros lugares ya por solicitud.  Para m√≠ se convirti√≥ en una motivaci√≥n adicional, y lo m√°s importante, mi conciencia est√° clara, porque  He estado ordenando tableros para prototipos durante varios a√±os, y para la producci√≥n en masa, les cuento a amigos y socios sobre ellos.  Ahora, para esto, tambi√©n tengo un bollo en forma de tableros gratuitos para peque√±os proyectos, a menudo puede escribir en el centro)) <br><br>  Y luego se rompi√≥ el hielo, se decidi√≥ crear no solo el m√≥dulo descrito anteriormente, sino un conjunto completo del desarrollador de electr√≥nica de potencia y hacerlo abierto y accesible para todos. <br><br><h2>  Estructura del proyecto </h2><br>  Al comienzo del art√≠culo, mencion√© que hoy solo le contar√© una parte: este es el <b>m√≥dulo de alimentaci√≥n del medio puente</b> .  Solo le permite crear un convertidor simplemente atornillando un circuito de control, por ejemplo, depurando STM32-Discovery, Arduino, TMS320, TL494 o lo que sea que tenga all√≠.  No hay enlace a ninguna plataforma o MK en absoluto. <br><br>  Solo que este no es todo el proyecto, sino parte)) ¬øEn qu√© consiste el convertidor de potencia terminado?  En primer lugar, la unidad de potencia necesita un cierto m√≥dulo de control para funcionar, para comprender lo que est√° sucediendo, necesita una indicaci√≥n, y para comprender lo que est√° sucediendo desde una distancia segura, tambi√©n necesita una interfaz, por ejemplo, Modbus RTU o CAN. <br><br>  Como resultado, la estructura general del proyecto se ve as√≠: <br><br> <a href=""><img src="https://habrastorage.org/webt/oh/tj/ix/ohtjixc8dimubg0tr7mbjym_aqc.png"></a> <br><br>  Probablemente en el futuro tambi√©n escribir√© un programa para calcular transformadores y choques, tanto convencionales como planos.  Hasta ahora  Las diferentes partes del diagrama en forma de borrador ya se han implementado y se ejecutan en dos proyectos, despu√©s de modificaciones menores, los art√≠culos tambi√©n se escribir√°n en ellos y el c√≥digo fuente estar√° disponible. <br><br><h2>  M√≥dulo de potencia de medio puente </h2><br>  Ahora es el momento de mirar m√°s de cerca al h√©roe de hoy.  El m√≥dulo es universal y le permite trabajar con transistores Mosfet e IGBT, tanto interruptores de bajo voltaje como de alto voltaje de hasta 1200V. <br><br>  <u>Caracter√≠sticas del m√≥dulo:</u> <br><ul><li>  Aislamiento galv√°nico del lado de control (digital) del poder.  Tensi√≥n de ruptura del aislamiento 3 kV; </li><li>  Las teclas superior e inferior son independientes, cada una tiene su propio controlador con aislamiento galv√°nico y CC / CC con aislamiento galv√°nico; </li><li>  Se aplica el controlador moderno de Infineon - 1EDC60I12AHXUMA1.  La corriente de apertura / cierre de pulso es 6A / 10A.  Frecuencia m√°xima: 1 MHz (probado hasta 1,5 MHz de forma estable); </li><li>  Protecci√≥n de corriente de hardware: shunt + op-amp + comparador + optoacoplador; </li><li>  La corriente m√°xima es de 20A.  No est√° limitado por las teclas, sino por el tama√±o del radiador y el grosor de los pol√≠gonos de cobre. </li></ul><br><br>  La primera revisi√≥n del m√≥dulo aparece en el art√≠culo, est√° en pleno funcionamiento, pero habr√° una segunda revisi√≥n, en la que se eliminar√°n los defectos puramente de dise√±o y los conectores se reemplazar√°n por otros m√°s convenientes.  Despu√©s de completar la documentaci√≥n, arroj√≥ el gerber en PCBway y despu√©s de 6 d√≠as, el servicio de mensajer√≠a llam√≥ a mi puerta y me entreg√≥ tal encanto: <br><br> <a href=""><img src="https://habrastorage.org/webt/bj/dw/lt/bjdwlt-ijg3_gdxfx0wfkwggk18.jpeg"></a> <br><br>  Una semana despu√©s, los <s>perros</s> finalmente trajeron componentes de una hermosa tienda dom√©stica.  Como resultado, todo fue montado: <br><br> <a href=""><img src="https://habrastorage.org/webt/kw/mv/cg/kwmvcghxvdiimkk9ili2zqfnorg.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/ea/dg/cz/eadgczqqlkscl5n89r7ynnvyivm.jpeg"></a> <br><br>  Antes de continuar, veamos el diagrama del circuito del m√≥dulo.  Puede descargarlo aqu√≠ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PDF</a> . <br><br>  No hay nada complicado ni m√°gico.  El medio puente habitual: 2 llaves en la parte inferior, 2 en la parte superior, puede soldar una a la vez.  El conductor, como se escribi√≥ anteriormente de la familia 1ED, es muy malvado e inmortal.  En todas partes de la alimentaci√≥n hay una indicaci√≥n, que incluye + 12V en la salida de CC / CC.  La protecci√≥n se implementa en el elemento l√≥gico AND, si se excede la corriente, el comparador emitir√° + 3.3V, iluminar√°n el optoacoplador y extraer√° una de las entradas AND al suelo, lo que significa que el establecimiento de log.0 y la se√±al PWM de los controladores desaparecer√°n.  Y con 3 entradas se han utilizado espec√≠ficamente, en la pr√≥xima revisi√≥n planeo hacer protecci√≥n contra el sobrecalentamiento por el radiador e iniciar la se√±al de error all√≠ tambi√©n.  Todas las fuentes estar√°n al final del art√≠culo. <br><br><h2>  Montamos el dise√±o del inversor </h2><br>  Durante mucho tiempo pens√© en c√≥mo demostrar el funcionamiento del m√≥dulo, para que no fuera muy aburrido, √∫til y no muy dif√≠cil, para que cualquiera pudiera repetirlo.  Por lo tanto, me detuve en un inversor de voltaje, est√°n acostumbrados a trabajar con paneles solares, si algo huele en el lado de bajo voltaje, no da miedo, pero en el lado de alto voltaje, justo cuando lo enciende, no ponga las manos en √©l. <br><br>  El inversor en s√≠ es vergonzosamente simple, por cierto, MAP Energy est√° fascinado as√≠, aqu√≠ hay un ejemplo de incluso la implementaci√≥n comercial de esta idea.  El trabajo del inversor es formar una variable sinusoidal con una frecuencia de 50 Hz a partir de un voltaje de 12V CC, porque es con esto que un transformador convencional a 50 Hz est√° acostumbrado a trabajar.  Utilizo alg√∫n tipo de sovi√©tico, como OSM, bobinado de f√°brica de 220V y se usa como secundario, y el primario ~ 8V est√° enrollado con un bus de cobre.  Se ve as√≠: <br><br> <a href=""><img src="https://habrastorage.org/webt/xf/6c/js/xf6cjsweiig-ter1invjtnfslci.jpeg"></a> <br><br>  ¬°Y este monstruo tiene solo 400 vatios!  El peso del transformador es de aproximadamente 5-7 kg, seg√∫n las sensaciones, si lo deja caer sobre su pierna, definitivamente no ser√°n llevados al ej√©rcito.  En realidad, esta es la desventaja de los inversores con transformadores de "hierro", son enormes y pesados.  Su ventaja es que estos inversores son muuuy simples, no requieren ninguna experiencia para crearlos y, por supuesto, son baratos. <br><br>  Ahora conectemos los m√≥dulos y el transformador.  De hecho, el m√≥dulo para el desarrollador debe presentarse simplemente como una "caja negra" que tiene una entrada de 2 PWM y 3 salidas de potencia: VCC, GND y la salida de medio puente. <br><br><img src="https://habrastorage.org/webt/yt/4f/l5/yt4fl55ueuuzkxi2ytlanqt_z58.png"><br><br>  Ahora, de estas "cajas negras", dibujemos nuestro inversor: <br><br><img src="https://habrastorage.org/webt/ht/ar/pu/htarpuz2ma1w3bduxmbpculsxia.png"><br><br>  S√≠, solo tom√≥ 3 elementos externos: un transformador + filtro LC.  Para este √∫ltimo, hice un estrangulamiento simplemente enrollando el cable del m√≥dulo al transformador en un anillo de material Kool Mu, tama√±o R32 con una permeabilidad de 60 y una inductancia de aproximadamente 10 ŒºH.  Por supuesto, el acelerador debe calcularse, pero necesitamos 15 minutos)) En general, si maneja algo as√≠ a 400 W, entonces necesita un anillo de tama√±o R46 (este es el di√°metro exterior).  Capacitancia: pel√≠cula de 1-10 uF, esto es suficiente.  De hecho, no puede configurar el condensador como una econom√≠a, porque la capacidad del devanado del transformador es saludable ... en general, los chinos y el MAP hicieron exactamente eso)) El inductor se ve as√≠: <br><br><img src="https://habrastorage.org/webt/b0/wl/zy/b0wlzyrj0gxbmarg2rz5kuppdoc.jpeg"><br><br>  Queda por lanzar una carga de prueba en la salida, tengo un par de bombillas LED de 20 W (nada m√°s a la mano), ellos mismos comen 24 W, sin embargo, la eficiencia.  Adem√°s, la corriente de circuito abierto del transformador es de aproximadamente 1A.  Con bater√≠a comer√° unos 5A.  Como resultado, tenemos tal soporte: <br><br> <a href=""><img src="https://habrastorage.org/webt/3s/w2/q2/3sw2q2qvocpryrps6vj4ynvwavo.jpeg"></a> <br><br>  Adem√°s, el dise√±o utiliza la bater√≠a Delta HR12-17, respectivamente, a 12V y con una capacidad de 17 A * h.  Controlaremos el convertidor desde la placa de depuraci√≥n STM32F469-Discovery. <br><br><h2>  C√≥digo </h2><br>  Inicialmente, estaba planeado usar mi STM32VL-Disco, que se recibi√≥ en la exposici√≥n en 2010, para el control, pero sucedi√≥ que fue en este dise√±o que estaba destinado a morir cuando se escribi√≥ todo el c√≥digo y se lanz√≥ el dise√±o.  Olvid√© las sondas de osciloscopio y combin√© 2 tierras, am√©n.  Como resultado, todo se reescribi√≥ en STM32F469NIH6, fue esta depuraci√≥n la que estaba a la mano, por lo que habr√° 2 proyectos: para F100 y para F469, ambos verificados.  El proyecto est√° construido para TrueSTUDIO, la versi√≥n eclipse de ST. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de tela para los pies</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/********************************************* Sinus table **********************************************************/</span></span></span><span class="hljs-meta"> uint16_t sinData[240] = {0,13,26,39,52,65,78,91,104,117,130,143,156,169,182,195,207,220,233,246,258,271,284,296,309,321,333,346,358,370, 382,394,406,418,430,442,453,465,477,488,500,511,522,533,544,555,566,577,587,598,608,619,629,639,649,659,669,678,688,697, 707,716,725,734,743,751,760,768,777,785,793,801,809,816,824,831,838,845,852,859,866,872,878,884,891,896,902,908,913,918, 923,928,933,938,942,946,951,955,958,962,965,969,972,975,978,980,983,985,987,989,991,993,994,995,996,997,998,999,999,999, 999,999,999,998,997,996,995,994,993,991,989,987,985,983,980,978,975,972,969,965,962,958,955,951,946,942,938,933,928,923, 918,913,908,902,896,891,884,878,872,866,859,852,845,838,831,824,816,809,801,793,785,777,768,760,751,743,734,725,716,707, 697,688,678,669,659,649,639,629,619,608,598,587,577,566,555,544,533,522,511,500,488,477,465,453,442,430,418,406,394,382, 370,358,346,333,321,309,296,284,271,258,246,233,220,207,195,182,169,156,143,130,117,104,91,78,65,52,39,26,13,0}; uint16_t sinStep; uint8_t sinStatus; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/******************************************** Used functions ********************************************************/</span></span></span><span class="hljs-meta"> void StartInitClock (void) { RCC-&gt;CR |= RCC_CR_HSEON; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Enable HSE while (!(RCC-&gt;CR &amp; RCC_CR_HSERDY)); FLASH-&gt;ACR |= FLASH_ACR_LATENCY_5WS; RCC-&gt;PLLCFGR = 0x00; RCC-&gt;PLLCFGR |= RCC_PLLCFGR_PLLM_3; // Div for HSE = 8 RCC-&gt;PLLCFGR |= RCC_PLLCFGR_PLLN_4 | RCC_PLLCFGR_PLLN_5 | RCC_PLLCFGR_PLLN_6 | RCC_PLLCFGR_PLLN_7; // PLL mult x240 RCC-&gt;PLLCFGR |= RCC_PLLCFGR_PLLSRC; // Source HSE RCC-&gt;CR |= RCC_CR_PLLON; while((RCC-&gt;CR &amp; RCC_CR_PLLRDY) == 0){} RCC-&gt;CFGR &amp;= ~RCC_CFGR_SW; RCC-&gt;CFGR |= RCC_CFGR_SW_PLL; // Select source SYSCLK = PLL while((RCC-&gt;CFGR &amp; RCC_CFGR_SWS) != RCC_CFGR_SWS_1) {} // Wait till PLL is used RCC-&gt;CR |= RCC_CR_PLLSAION; while ((RCC-&gt;CR &amp; RCC_CR_PLLSAIRDY) == 0) {} } void EnableOutputMCO (void) { RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOAEN; // Enable clock port A GPIOA-&gt;MODER &amp;= ~GPIO_MODER_MODER8; GPIOA-&gt;MODER |= GPIO_MODER_MODER8_1; // Alternative PP GPIOA-&gt;OSPEEDR |= GPIO_OSPEEDER_OSPEEDR8; // Very high speed RCC-&gt;CFGR |= RCC_CFGR_MCO1; // Source PLL RCC-&gt;CFGR &amp;= ~RCC_CFGR_MCO1PRE; // Div = 1 } void InitIndicatorLED (void) { /* * LED1 - PG6 * LED2 - PD4 * LED3 - PD5 * LED4 - PK3 */ RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOGEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIODEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOKEN; GPIOG-&gt;MODER &amp;= ~GPIO_MODER_MODER6; GPIOG-&gt;MODER |= GPIO_MODER_MODER6_0; // Output PP GPIOD-&gt;MODER &amp;= ~GPIO_MODER_MODER4; GPIOD-&gt;MODER |= GPIO_MODER_MODER4_0; // Output PP GPIOD-&gt;MODER &amp;= ~GPIO_MODER_MODER5; GPIOD-&gt;MODER |= GPIO_MODER_MODER5_0; // Output PP GPIOK-&gt;MODER &amp;= ~GPIO_MODER_MODER3; GPIOK-&gt;MODER |= GPIO_MODER_MODER3_0; // Output PP } void EnableIndicatorLED (void) { GPIOG-&gt;BSRR |= GPIO_BSRR_BR_6; GPIOD-&gt;BSRR |= GPIO_BSRR_BR_4; GPIOD-&gt;BSRR |= GPIO_BSRR_BR_5; GPIOK-&gt;BSRR |= GPIO_BSRR_BR_3; } void InitLowPWM (void) { /* * TIM1-CH1 - PA8 * TIM1-CH1N - PB13 */ RCC-&gt;APB2ENR |= RCC_APB2ENR_TIM1EN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOAEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOBEN; /*********** GPIO **********/ GPIOA-&gt;MODER &amp;= ~GPIO_MODER_MODER8; GPIOA-&gt;MODER |= GPIO_MODER_MODER8_1; // Alternative output PP GPIOA-&gt;AFR[1] |= GPIO_AFRH_AFRH0_0; // Select TIM1-CH1 GPIOB-&gt;MODER &amp;= ~GPIO_MODER_MODER13; GPIOB-&gt;MODER |= GPIO_MODER_MODER13_1; // Alternative output PP GPIOB-&gt;AFR[1] |= GPIO_AFRH_AFRH5_0; // Select TIM1-CH1N /*********** Timer *********/ TIM1-&gt;PSC = 2400-1; // div for clock: F = SYSCLK / [PSC + 1] TIM1-&gt;ARR = 1000; // count to 1000 TIM1-&gt;CR1 &amp;= ~TIM_CR1_CKD; // div for dead-time: Tdts = 1/Fosc = 41.6 ns TIM1-&gt;CCR1 = 500; // duty cycle 50% TIM1-&gt;CCER |= TIM_CCER_CC1E | TIM_CCER_CC1NE; // enable PWM complementary out to PB15 and to PA10 TIM1-&gt;CCER &amp;= ~TIM_CCER_CC1NP; // active high level: 0 - high, 1 - low TIM1-&gt;CCMR1 &amp;= ~TIM_CCMR1_OC1M; TIM1-&gt;CCMR1 |= TIM_CCMR1_OC1M_2 | TIM_CCMR1_OC1M_1; // positiv PWM1_CH3 and PWM1_CH3N TIM1-&gt;BDTR &amp;= ~TIM_BDTR_DTG; // clear register TIM1-&gt;BDTR |= TIM_BDTR_DTG_2 | TIM_BDTR_DTG_1 | TIM_BDTR_DTG_0; // value dead-time: = 31*Tdts = 32*41,6ns = 1.29us TIM1-&gt;BDTR |= TIM_BDTR_MOE | TIM_BDTR_AOE; // enable generation output and dead-time TIM1-&gt;CR1 &amp;= ~TIM_CR1_DIR; // count up: 0 - up, 1 - down TIM1-&gt;CR1 &amp;= ~TIM_CR1_CMS; // aligned on the front signal: 00 - front; 01, 10, 11 - center TIM1-&gt;CR1 |= TIM_CR1_CEN; // start count } void InitSinusPWM (void) { /* * TIM3-CH1 - PB4 * TIM3-CH2 - PC7 */ RCC-&gt;APB1ENR |= RCC_APB1ENR_TIM3EN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOBEN; RCC-&gt;AHB1ENR |= RCC_AHB1ENR_GPIOCEN; /*********** GPIO **********/ GPIOB-&gt;MODER &amp;= ~GPIO_MODER_MODER4; GPIOB-&gt;MODER |= GPIO_MODER_MODER4_1; // Alternative output PP GPIOB-&gt;AFR[0] |= GPIO_AFRL_AFRL4_1; // Select TIM3-CH1 GPIOC-&gt;MODER &amp;= ~GPIO_MODER_MODER7; GPIOC-&gt;MODER |= GPIO_MODER_MODER7_1; // Alternative output PP GPIOC-&gt;AFR[0] |= GPIO_AFRL_AFRL7_1; // Select TIM3-CH2 /*********** Timer *********/ TIM3-&gt;PSC = 5-1; // div for clock: F = SYSCLK / [PSC + 1] TIM3-&gt;ARR = 1000; // count to 1000 TIM3-&gt;CCR1 = 0; // duty cycle 0% TIM3-&gt;CCR2 = 0; // duty cycle 0% TIM3-&gt;CCER |= TIM_CCER_CC1E; // enable PWM out to PA8 TIM3-&gt;CCER &amp;= ~TIM_CCER_CC1P; // active high level: 0 - high, 1 - low TIM3-&gt;CCER |= TIM_CCER_CC2E; // enable PWM complementary out to PA9 TIM3-&gt;CCER &amp;= ~TIM_CCER_CC1P; // active high level: 0 - high, 1 - low TIM3-&gt;CCMR1 &amp;= ~(TIM_CCMR1_OC1M | TIM_CCMR1_OC2M); TIM3-&gt;CCMR1 |= TIM_CCMR1_OC1M_2 | TIM_CCMR1_OC1M_1 | TIM_CCMR1_OC2M_2 | TIM_CCMR1_OC2M_1; // positiv PWM1_CH1 and PWM1_CH2 TIM3-&gt;CR1 &amp;= ~TIM_CR1_DIR; // count up: 0 - up, 1 - down TIM3-&gt;CR1 &amp;= ~TIM_CR1_CMS; // aligned on the front signal: 00 - front; 01, 10, 11 - center TIM3-&gt;CR1 |= TIM_CR1_CEN; // start count } void InitStepSinus (void) { RCC-&gt;APB1ENR |= RCC_APB1ENR_TIM6EN; // enable clock for basic TIM6 TIM6-&gt;PSC = 5-1; // div, frequency 24 kHz TIM6-&gt;ARR = 1000; // count to 1000 TIM6-&gt;DIER |= TIM_DIER_UIE; // enable interrupt for timer TIM6-&gt;CR1 |= TIM_CR1_CEN; // start count NVIC_EnableIRQ(TIM6_DAC_IRQn); // enable interrupt TIM6_DAC_IRQn } /************************************* Main code *********************************************/ int main (void) { StartInitClock(); // EnableOutputMCO(); InitIndicatorLED(); InitLowPWM(); InitSinusPWM(); InitStepSinus(); EnableIndicatorLED(); while(1) { } } /****************************** Interrupts ******************************************************/ void TIM6_DAC_IRQHandler (void) { TIM6-&gt;SR &amp;= ~TIM_SR_UIF; if (sinStatus == 0) {TIM3-&gt;CCR1 = sinData[sinStep];} if (sinStatus == 1) {TIM3-&gt;CCR2 = sinData[sinStep];} sinStep++; if (sinStep &gt;= 240) { sinStep = 0; sinStatus = sinStatus ? 0 : 1; } }</span></span></span></span></code> </pre> <br></div></div><br>  En general, en otro art√≠culo, describi√≥ en detalle y claramente c√≥mo generar una se√±al sinusoidal, c√≥mo escribir c√≥digo, etc.  Puedes leerlo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  Has le√≠do  ¬øQuieres coleccionar?  Mantener el proyecto: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Proyecto para F469</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Proyecto para F100</a> </li></ul><br>  Ejecutamos el c√≥digo, nos armamos con un osciloscopio y seguimos adelante.  En primer lugar, verificamos la presencia de una se√±al en la entrada de los controladores, deber√≠a ser as√≠: <br><br><img src="https://habrastorage.org/webt/nd/gc/5f/ndgc5fcjhtwnxk_oxdwnanbwtkq.png"><br><br>  Vale la pena se√±alar que doy 2 se√±ales dibujando un seno en un medio puente (m√≥dulo) y 50 Hz en 2 se√±ales.  Adem√°s, una diagonal es "rojo + amarillo" y la otra es "azul + verde".  En el art√≠culo que di arriba, esto est√° escrito en detalle, si de repente no lo entiendes.  Ahora, cuando llegaron las se√±ales, pusimos tanto medio puente + 12V como GND desde la fuente de alimentaci√≥n del laboratorio.  Inmediatamente la bater√≠a no avisa, si comete un error en alg√∫n lugar, entonces algo se puede quemar.  La protecci√≥n en el tablero salva de sobrecorriente, pero no de jambas obvias, cuando el m√°s y el menos se mezclan, pero el t√©cnico de laboratorio ahorra.  12V y 1A son suficientes para las pruebas.  Llevamos la sonda del osciloscopio, su cable de tierra a la salida del primer medio puente, y la sonda en s√≠ a la salida del otro medio puente, y deber√≠a haber una imagen as√≠: <br><br><img src="https://habrastorage.org/webt/px/6j/fk/px6jfknnkrrf4y_l09t-_h9csfk.png"><br><br>  ¬øD√≥nde est√° el seno que preguntas?  El hecho es que la resistencia de entrada del osciloscopio es grande y no constituye una carga, por lo que la corriente no fluye y no hay de d√≥nde obtener el seno.  Agregue una carga, hice una carga de 90 ohmios a partir de resistencias de 10 ohmios simplemente encendiendo 9 piezas en serie.  Conectamos la carga a las salidas de los medios puentes y vemos la siguiente imagen: <br><br><img src="https://habrastorage.org/webt/a1/ro/7b/a1ro7ba6mmxhagnpiyau1mjstqo.png"><br><br>  ¬øTienes lo mismo?  As√≠ que es hora de conectar el inductor, el transformador, la carga e intentar arrancar.  <b>Achtung!</b>  <b>No puede encender este modelo sin carga, porque en inactivo, la salida puede ser de hasta 350 ... 380V.</b>  <b>Para que esto no necesite una carga o sistema operativo.</b>  No tendremos el √∫ltimo, este es el tema de un art√≠culo separado, puede, como opci√≥n, fijar el controlador P m√°s simple, ya tiene una plantilla de proyecto. <br><br><h2>  Inclusi√≥n </h2><br>  Despu√©s de encenderlo, obtenemos aproximadamente 230V en la salida, la salida ciertamente no est√° estabilizada y flotar√° 230V + -30V, para las pruebas se ir√°, en otro art√≠culo finalizaremos el dise√±o cuando decida hablar sobre los controladores P y PI y su implementaci√≥n. <br><br>  Ahora puede disfrutar del resultado del trabajo y, si es necesario, poner todo en una caja e incluso aplicarlo en la granja o en el pa√≠s para proporcionarle luz y otras comodidades. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Te0OhTMt0Tk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Probablemente haya notado un retraso entre el "clic", es decir, encender el Discovery y encender las l√°mparas; este es el tiempo que el MK pas√≥ en la inicializaci√≥n.  Este retraso puede reducirse escribiendo un solo d√≠gito en el registro de una vez, en lugar de dividir la entrada del registro en un mont√≥n de l√≠neas.  Lo aplast√© solo con fines ilustrativos.  Aunque esto no da miedo, con el c√≥digo HAL, el retraso es 3 veces m√°s largo y la gente de alguna manera vive con √©l)) <br><br>  Hasta que lo olvid√©, la fuente del proyecto: <br><br><ul><li>  Diagrama esquem√°tico - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PDF</a> </li><li>  BOM - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Excel</a> </li><li>  Gerber-archivos - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RAR</a> </li></ul><br><br>  Queda por ver c√≥mo es con las temperaturas en el tablero, si hay puntos particularmente calientes.  5-6A ciertamente no es suficiente, pero si hay una corriente continua o alg√∫n error grave, entonces es suficiente para convertir la placa en un hervidor de agua: <br><br><img src="https://habrastorage.org/webt/xz/fp/ln/xzfplnlxfklygc-vjabjtpws1em.png"><br><br>  Como puede ver, el elemento m√°s caliente es el m√≥dulo de CC / CC para aislamiento galv√°nico, que es de 2 vatios, se calienta hasta 34 grados, bueno, tambi√©n una derivaci√≥n.  Los transistores y el radiador tienen una temperatura ambiente despu√©s de 30 minutos de funcionamiento del convertidor)) <br><br><h2>  Gracias y planes </h2><br>  En un futuro pr√≥ximo planeo escribir sobre la placa DSP y administrarla no desde el descubrimiento de depuraci√≥n, sino desde el m√≥dulo "especializado".  Los tableros de la segunda revisi√≥n le llegaron desde el mismo PCBway, espero los componentes e inmediatamente escribo. <br><br>  Espero que hayan disfrutado el art√≠culo y la idea en s√≠.  En el futuro, en los mismos m√≥dulos mostrar√© c√≥mo ensamblar un chastotnik, un controlador mppt o tal vez algo m√°s interesante.  Si tiene preguntas, no dude en hacerlas en los comentarios o en PM, si de repente no tiene una cuenta completa, intentar√© responder todas las preguntas. <br><br>  Ahora, gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PCBway</a> , es realmente muy bueno que admitan el motor de c√≥digo abierto.  Pronto, los fabricantes de hardware pueden incluso ponerse al d√≠a con los escritores de software en t√©rminos de cantidad y calidad de proyectos de c√≥digo abierto. <br><br><img src="https://habrastorage.org/webt/hm/pu/px/hmpupxkj9ov6-oum1vvnqmi0oqu.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es428550/">https://habr.com/ru/post/es428550/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es428540/index.html">Los ensayos cl√≠nicos han demostrado una disminuci√≥n en la progresi√≥n de la enfermedad de Alzheimer en m√°s de la mitad</a></li>
<li><a href="../es428542/index.html">Los turistas en la Uni√≥n Europea ser√°n revisados ‚Äã‚Äãusando AI</a></li>
<li><a href="../es428544/index.html">La vulnerabilidad en Bluetooth abre oportunidades para ataques en puntos de acceso inal√°mbrico</a></li>
<li><a href="../es428546/index.html">Tres a√±os de tecnolog√≠a. soporte, 152 centros de salud, 3740 piezas</a></li>
<li><a href="../es428548/index.html">Programaci√≥n Orientada a Aspectos, Spring AOP</a></li>
<li><a href="../es428552/index.html">Algoritmo: c√≥mo encontrar la pr√≥xima permutaci√≥n lexicogr√°fica</a></li>
<li><a href="../es428556/index.html">"El entorno de producci√≥n est√° m√°s all√° de su control": Rian Lewis sobre la prueba de proyectos de blockchain</a></li>
<li><a href="../es428558/index.html">C√≥mo cre√© un asistente para WordPress a partir de mi pereza profunda</a></li>
<li><a href="../es428560/index.html">Anuncio no programado del viernes</a></li>
<li><a href="../es428562/index.html">Droidcon London. Como fue</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>