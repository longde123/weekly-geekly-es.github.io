<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍛 👌🏽 ◀️ Smart Home von einem alten Smartphone oder Antipattern der Heimautomation 📧 🌔 👨‍👧‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo liebe Leser! Eine andere Geschichte darüber, wie der Manager des mittleren Glieds, der Staub von den abgestandenen Drüsen im Regal bläst, dies t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Smart Home von einem alten Smartphone oder Antipattern der Heimautomation</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/405557/">  Hallo liebe Leser!  Eine andere Geschichte darüber, wie der Manager des mittleren Glieds, der Staub von den abgestandenen Drüsen im Regal bläst, dies tut, was dazu führt, dass Profis aller Art Schmerzen in den Augen haben.  Aber es funktioniert, Amigo! <br><br><img src="https://habrastorage.org/web/f60/376/42b/f6037642b6b94e65a098cf7d930fbc45.jpg"><br><br>  Ich gebe zu, diesmal wollte ich alles richtig machen.  Nahm den Raspbery Pi aus dem Regal.  Der Kuchen ist der gleiche, den ich bereits in meinem Roboter-Rasenmäher verwendet habe: ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link zu einem Beitrag</a> und ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link zu einem anderen Beitrag</a> .  Er hat Mücken genommen, alles hätte auf mqtt funktionieren sollen, aber du rennst nirgendwo vor dir weg.  Unter dem Schnitt ein Meer von Rechen, Fahrrädern, schlechtem Löten, die Hölle für einen Perfektionisten. <br><a name="habracut"></a><br><img src="https://habrastorage.org/files/4c5/827/fc2/4c5827fc2a714b56bb64c18700b69382.jpg" alt="Bild"><br><br>  Alles begann mit dem Wunsch, mein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Noorik-</a> Projekt zu ergänzen, das ich auf mein Tor setzte.  Kurz gesagt - dies ist eine DIY-Lösung für den GSM-Block, der das Tor öffnet. <br>  Um das Tor zu öffnen, müssen bestimmte Kontakte auf der Platine geschlossen werden. <br><br><img src="https://habrastorage.org/files/5f3/8e2/40c/5f38e240c82f4e4692737b0f5e600041.jpg" alt="Bild"><br><br>  Ersetzte Arduino durch esp8266 und erstellte ein Webinterface mit einer geöffneten Schaltfläche.  Es stellte sich als interessant heraus, aber dann wollte ich eine einzige Schnittstelle zum Öffnen von Schiebetoren, Garagentoren und Toren. <br><br>  Als ich anfing, meine gesamte Wunschliste zu malen, stellte sich heraus, dass ich dasselbe brauchte: <br><br><ol><li>  Kesselsteuerung </li><li>  Sicherheitssystem </li><li>  mobile Schnittstelle zu Überwachungskameras </li><li>  Temperaturdaten im Haus und auf der Straße </li></ol><br><h2>  Backend </h2><br>  Malinka funktionierte gut, aber beim nächsten Einschalten hörte es einfach auf, sich einzuschalten.  Die Power-LED leuchtet zuerst auf und erlischt dann in 3-5 Sekunden sanft. Das Element (Polyfuse T075) in der Nähe der Steckdose ist sehr heiß.  Und hier juckten schon Hände, um mqtt, blackger, Kurtisanen und andere Köstlichkeiten einzuladen. <br><br><img src="https://habrastorage.org/web/62d/d94/26c/62dd9426ccc24ae5ae0a851147fb62ae.jpg"><br><br>  Es spielt keine Rolle, der Nutzen seines Schicksals wartete auf einen anderen Patienten.  Orange pi Null ins Studio.  Wie sehr ich nicht unter diesem Wunder des chinesischen Denkens gelitten habe - einem so kleinen Kuchen Leben einzuhauchen, stellte sich als eine Angelegenheit heraus, die meine Stärke überstieg.  Ich habe Firmware auf den offiziellen und linken Websites heruntergeladen, Firmware von meinen Händen gekauft und gegen Kryptowährung eingetauscht.  Ich glaube, ich bin gerade auf eine defekte Probe gestoßen. <br><br><img src="https://habrastorage.org/web/63c/64d/d6f/63c64dd6f17f48c687b33e036ef859f6.jpg"><br><br>  Ich erkannte, dass das Schicksal mich in die Arme des Fahrradbaus drückte, und um meine Freude zu verbergen, stürzte ich mich mit meinem Kopf in diese Aktivität. <br><br><img src="https://habrastorage.org/web/206/f40/1e3/206f401e31ff4a06b895f513756e181e.jpg"><br><br>  Zunächst entschied ich mich für ein Smartphone als Headunit (Broker, Server).  Sie wissen, dass diese alten Dinge einfach nicht verschwinden.  Ich habe es benutzt, meine Frau, meine Tochter, dann habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">meinen Roboter mit einer Schneefräse</a> von diesem Smartphone aus gesteuert und versucht, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ihn im Fluss</a> zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ertränken</a> (ich habe den Moskauer Fluss nie erreicht, aber diese Pfeife hat in meiner Heimatstadt Pakhra ein Rascheln verursacht).  Und hier ist sie - ein neues Leben für das Samsung Galaxy S3. <br><br>  Installierter Palapa-Webserver und FTP-Server auf dem Smartphone.  Die Idee ist in einer MySQL-Datenbank mit nur drei Tabellen einfach: Werte, Protokolle, Regeln. <br><br><ul><li>  In der Wertetabelle Schlüssel / Wert-Paare. </li><li>  Die Protokolltabelle zeigt den Verlauf der Wertänderungen. </li><li>  In der Regeltabelle sind die Regeln zum Ändern einiger Zellen abhängig vom Wert in anderen. </li></ul><br>  Alle diese Farm dient einem PHP-Skript, das Daten aus der Datenbank durch eine http-Anfrage schreibt oder ausgibt, und dient auch geplanten Regeln. <br>  Ich verstehe nicht einmal, wie hoch die Programmierebene sein sollte, damit eine Person sie sehen kann, aber ich bin bereit, Ihnen den Code zu zeigen - schreiben Sie in das LAN. <br><br><h2>  Frontend </h2><br><img src="https://habrastorage.org/web/f60/376/42b/f6037642b6b94e65a098cf7d930fbc45.jpg"><br><br>  Wirf keine Steine ​​auf mich, ich gestehe mich.  Ich habe Bootstrap verwendet.  Ja, sündig. <br>  Der erste Gedanke war, alles über Phonegap zu erledigen und eine vollständige App zu erhalten.  Ich werde mehr sagen, ich habe genau das getan, aber am Ende hat sich die Online-Version als effizienter herausgestellt.  Ich und meine Frau am Telefon haben gerade eine Verknüpfung auf dem Desktop erstellt, um die gewünschte Seite auf der internen IP zu öffnen. <br><br>  Jedes Element reagiert auf ein Klickereignis + Der Status von Ajax wird durch Anforderungen an den Server überprüft und bei Bedarf geändert.  Dies ist sehr praktisch, da Sie alle Änderungen sehen, die durch die Regel in Kraft getreten sind oder von einem anderen Benutzer vorgenommen wurden. <br>  Eigentlich ist der Code auf Anfrage ohne Probleme. <br><br><h2>  ESP-8266 </h2><br><img src="https://habrastorage.org/web/900/20a/853/90020a8530cc491cadc9aa15c8fb4e5c.jpg"><br><br>  Ich habe verschiedene Module und reines ESP-8266 ausprobiert.  Infolgedessen erwies sich das LOLIN V3-Modul als die bequemste Option. <br><br><img src="https://habrastorage.org/web/325/c58/cda/325c58cda83f4c9a8cef58f7a1d88e8a.jpg"><br><br>  Stromversorgung über Schaltnetzteile. <br><br><img src="https://habrastorage.org/web/268/d77/8ee/268d778ee71443c9a369bea9bb71491a.jpg"><br><br>  Die Gate-Module benötigten ein Relais und ich hatte Bedenken, dass die Kontaktrelais ausgelöst würden.  Infolgedessen funktionieren sowohl Festkörper- als auch Kontaktkörper.  Das Problem ist, dass eine große Anzahl von Modulen auch ohne Beschriftung niedrig ausgelöst wird. <br><br><img src="https://habrastorage.org/web/c81/9a8/130/c819a813070a47b5b6ebcb23a6d1bc8d.jpg"><br><br>  Beim Einschalten des Moduls tritt eine kurzfristige Öffnung auf, die beim Einschalten der Stromversorgung zu einer unwillkürlichen Öffnung führt.  Es wird gelöst, indem auf Null gezogen und der Status deklariert wird, bevor der Ausgabetyp deklariert wird. <br><br><pre><code class="hljs lisp">digitalWrite(<span class="hljs-name"><span class="hljs-name">rele</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-comment"><span class="hljs-comment">; digitalWrite(rele2, 1); pinMode(rele, OUTPUT); pinMode(rele2, OUTPUT);</span></span></code> </pre> <br>  Infolgedessen sieht das Modul für die Garagenbaugruppe so aus.  Der PIR-Sensor zur Bewegungserkennung wird sanft in die native Haut geknabbert. <br><br><img src="https://habrastorage.org/web/2ed/8f6/3b6/2ed8f63b60ea4b7abfb7bda9c04697c6.jpg"><br><br>  Im Heizraum ist mein Heizkessel sehr einfach und von einer komplexen Automatisierung ist keine Rede. <br><br><img src="https://habrastorage.org/web/49a/966/18a/49a96618a1ec46b28d2ac11a79096533.jpg"><br><br>  Zusätzlich dient jeder Kreislauf einer separaten Pumpe. <br><br><img src="https://habrastorage.org/web/220/bc5/af7/220bc5af7fcd43e0b90dcbf335f9b66a.jpg"><br><br>  In Reihe mit den Maschinen wurden Relais zur Steuerung der Pumpen und des Kessels eingeschaltet. <br><br><img src="https://habrastorage.org/web/ae4/8b6/e04/ae48b6e0415047b58588b2a2cbfc5b1d.jpg"><br><br>  Schiebt sanft die gesamte Wirtschaft in den Schild. <br><br><img src="https://habrastorage.org/web/0cc/5d3/28d/0cc5d328d26b4f2a83450df8e2ced105.jpg"><br><br><h2>  Firmware </h2><br>  Ich entschied mich, die Arduino IDE für die Firmware zu verwenden, um mich nicht mit Nodemcu und Lua herumzuschlagen.  Im Internet und insbesondere bei GT eine riesige Menge an Informationen für Anfänger. <br>  Von der interessanten, scheint mir, die Funktion der Verbindung zu WiFi.  Tatsache ist, dass es in meinem Haus 4 WLAN-Netzwerke gibt, die hinzugefügt werden können.  Um den Netzwerknamen nicht starr festzulegen, scannen wir zuerst die verfügbaren Netzwerke. <br><br><div class="spoiler">  <b class="spoiler_title">SetupWiFi () Code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> setupWiFi() { WiFi.mode(WIFI_STA); WiFi.disconnect(); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(WiFi.status() != WL_CONNECTED) { <span class="hljs-type"><span class="hljs-type">int</span></span> n = WiFi.scanNetworks(); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("scan done"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("no networks found"); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(n); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(" networks found"); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; ++i) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(""); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(i + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(": "); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(WiFi.SSID(i)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(" ("); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(WiFi.RSSI(i)); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(")"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println((WiFi.encryptionType(i) == ENC_TYPE_NONE)?" ":"*"); j=<span class="hljs-number"><span class="hljs-number">0</span></span>; ssid=WiFi.SSID(i); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Connecting"); ssid.toCharArray(charBuf, <span class="hljs-number"><span class="hljs-number">50</span></span>); WiFi.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(charBuf,WIFI_PASS); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(WiFi.status() != WL_CONNECTED) { delay(<span class="hljs-number"><span class="hljs-number">500</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("."); j++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(j&gt;<span class="hljs-number"><span class="hljs-number">20</span></span>){ break; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((WiFi.status() == WL_CONNECTED)){ break; } } } } <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Connected"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(WiFi.localIP()); }</code> </pre> <br></div></div><br>  Wenn der automatische Modus des Kesselraums eingeschaltet ist, werden die Außentemperatur und die Temperatur des Kühlmittels gemäß dem Zeitplan überprüft. <br><br><ul><li>  Bei Temperaturen unter 14 ° C wird der warme Boden des ersten Stocks eingeschaltet. </li><li>  Bei Temperaturen unter 4 ° C sind alle Stromkreise eingeschaltet. </li></ul><br>  Die Temperatur des Kühlmittels wird gemäß der Tabelle in Abhängigkeit vom Rohrquerschnitt und der Außentemperatur ausgewählt.  Bei Erreichen der gewünschten Raumtemperatur schaltet sich der Kessel aus.  Bei allen wurde eine bestimmte Hysterese angewendet, um die Übergangswerte zu glätten. <br><br>  Das Sicherheitssystem arbeitet noch einfacher.  In der Tabelle gibt es eine Regel, dass bei eingeschaltetem Sicherheitssystem SMS über die API eines der Dienste gesendet werden, wenn eine Bewegung an einem der PIR-Sensoren erkannt wird. <br><br><h2>  Pläne </h2><br><ul><li>  Erstellung einer Online-Version auf einem Remote-Server und Synchronisierung von Änderungen für die Möglichkeit der Fernsteuerung. </li><li>  Anzeigen von Daten von GSM / GPS-Beacons im Auto; </li><li>  Öffnen der Tore, wenn unsere Autos in einem bestimmten Bereich erscheinen; </li><li>  Verbindung zum Fernbedienungssystem; </li></ul><br>  <b>Abstimmung per Foto.</b>  <b>Welches Projekt als nächstes zu tun?</b> <br><br><div class="spoiler">  <b class="spoiler_title">Beende KickBrick</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://geektimes.ru/post/281716/</a> <br><img src="https://habrastorage.org/web/626/a41/9a5/626a419a5b1143f092c0549638cbf9cc.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Beenden Sie den Delta 3D-Drucker an den Konstruktionsstiften</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/7ff/ec2/55e/7ffec255ec8b4196a7f1c9cc92ca9c4e.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Stabilisator für Spiegelreflexkamera</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/138/3b8/b61/1383b8b61f724649b6cb832d0e69b6da.jpg"><br></div></div><br>  Vielen Dank für Ihre Aufmerksamkeit.  Mit dir war SlavaGik. <br><br><img src="https://habrastorage.org/web/ebc/aa9/11a/ebcaa911ade648528ae7128e3031e563.jpg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de405557/">https://habr.com/ru/post/de405557/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de405545/index.html">Schalten Sie den Ofen in den Apokalypse-Modus: eine Überprüfung der Geräte zur Kontrolle von Atomwaffen vor dem Flug</a></li>
<li><a href="../de405547/index.html">Zwei neue Möglichkeiten, um den Camcorder automatisch auszurichten</a></li>
<li><a href="../de405551/index.html">Casey Rias: Software als Kunst</a></li>
<li><a href="../de405553/index.html">Macht verursacht Hirnschäden</a></li>
<li><a href="../de405555/index.html">Navi für fliegendes iPhone: DJI Spark Fly More Combo</a></li>
<li><a href="../de405561/index.html">Chocola3D Food 3D-Drucker Live Review</a></li>
<li><a href="../de405563/index.html">Microsoft entwickelt einen KI-Beschleuniger für HoloLens</a></li>
<li><a href="../de405565/index.html">DNK | PRIME Zweiter Teil: Testen</a></li>
<li><a href="../de405567/index.html">Neurogenese: physiologische Grundlagen und Perspektiven der Regulation für therapeutische Zwecke</a></li>
<li><a href="../de405571/index.html">Elemente des nationalen Innovationssystems der USA, Teil 1: Unternehmensumfeld und Steuern, Handels- und Wirtschaftspolitik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>