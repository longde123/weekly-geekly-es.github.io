<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍❤️‍💋‍👨 🚭 💆🏻 L'introduction la plus courte à la création de compilateurs 🔆 🤞 🤞🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ici, j'ai essayé de montrer dans la pratique quels sont certains concepts importants du domaine de la création de compilateurs. Il est possible que de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L'introduction la plus courte à la création de compilateurs</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432982/"><p>  Ici, j'ai essayé de montrer dans la pratique quels sont certains concepts importants du domaine de la création de compilateurs.  Il est possible que de telles histoires terminées de 15 minutes puissent être un bon moyen de plonger dans des sujets complexes.  Seulement ce serait bien de ne pas lire passivement ce qui est présenté ci-dessous, mais aussi de vérifier le code en cours. </p><br><p>  Si la première expérience est réussie, à l'avenir, vous pouvez vous attendre à d'autres "croquis" de 15 minutes sur le sujet des compilateurs. </p><a name="habracut"></a><br><h1 id="o-chem-poydet-rech">  Ce qui sera discuté </h1><br><p>  Faisons un compilateur d'expression arithmétique.  Celui qui traduit le texte source en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notation polonaise inverse</a> (il est également appelé RPN ou POLIZ) en code intermédiaire qui fonctionne avec la pile.  Mais nous pouvons nous passer d'interprètes ici.  Ensuite, nous traduisons immédiatement le résultat en une représentation C.  Autrement dit, nous obtenons un compilateur de RPN à C. </p><br><p>  Soit dit en passant, nous allons écrire le compilateur en Python.  Mais ne laissez pas cela arrêter ceux qui préfèrent un autre langage de programmation.  Voici un exercice utile pour vous: traduisez le code ci-dessous dans votre langue préférée.  Ou utilisez une traduction déjà terminée: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Implémentation</a> F # (par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">gsomix</a> ): <br>  <a href="">première version</a> <br>  <a href="">Version SSA</a> </p><br><h1 id="nachnem-s-sintaksicheskogo-analiza">  Commençons par l'analyse </h1><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source)</span></span></span><span class="hljs-function">:</span></span> tokens = source.split() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [(<span class="hljs-string"><span class="hljs-string">"Push"</span></span>, int(x)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x[<span class="hljs-number"><span class="hljs-number">0</span></span>].isdigit() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> (<span class="hljs-string"><span class="hljs-string">"Op"</span></span>, x) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tokens]</code> </pre> <br><p>  Qu'avons-nous fait ici?  La fonction de numérisation reçoit une chaîne de l'utilisateur en notation polonaise inverse ("2 2 +"). </p><br><p>  Et à la sortie, nous obtenons sa représentation intermédiaire.  Voici un exemple: </p><br><pre> <code class="plaintext hljs">[ ('Push', 2), ('Push', 2), ('Op', '+') ]</code> </pre> <br><p>  Donc, nous avons déjà le compilateur.  Mais il est très frivole.  Rappelons qu'il s'agissait initialement de code C. </p><br><h1 id="zaymemsya-translyaciey-v-si">  Diffusons en C </h1><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trans</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ir)</span></span></span><span class="hljs-function">:</span></span> code = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tag, val <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ir: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tag == <span class="hljs-string"><span class="hljs-string">"Push"</span></span>: code.append(<span class="hljs-string"><span class="hljs-string">"st[sp] = %d;"</span></span> % val) code.append(<span class="hljs-string"><span class="hljs-string">"sp += 1;"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> tag == <span class="hljs-string"><span class="hljs-string">"Op"</span></span>: code.append(<span class="hljs-string"><span class="hljs-string">"st[sp - 2] = st[sp - 2] %s st[sp - 1];"</span></span> % val) code.append(<span class="hljs-string"><span class="hljs-string">"sp -= 1;"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"\n"</span></span>.join(code)</code> </pre> <br><p>  Que se passe-t-il ici?  Regardons la sortie de cette fonction (en utilisant le même exemple avec "2 2 +"). </p><br><pre> <code class="plaintext hljs">st[sp] = 2; sp += 1; st[sp] = 2; sp += 1; st[sp - 2] = st[sp - 2] + st[sp - 1]; sp -= 1;</code> </pre> <br><p>  Oui, il ressemble déjà au code C.  Array st joue le rôle de la pile et sp en est le pointeur.  Habituellement, les machines de pile virtuelles fonctionnent avec ces choses. </p><br><p>  C'est juste la machine elle-même - l'interprète, nous ne l'avons pas.  Il y a un compilateur.  Que nous reste-t-il?  Il est nécessaire d'ajouter les trames nécessaires pour le programme C. </p><br><h1 id="nash-pervyy-kompilyator-v-gotovom-vide">  Notre premier compilateur fini </h1><br><pre> <code class="python hljs">ST_SIZE = <span class="hljs-number"><span class="hljs-number">100</span></span> C_CODE = <span class="hljs-string"><span class="hljs-string">r"""#include &lt;stdio.h&gt; int main(int argc, char** argv) { int st[%d], sp = 0; %s printf("%%d\n", st[sp - 1]); return 0; }"""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source)</span></span></span><span class="hljs-function">:</span></span> tokens = source.split() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [(<span class="hljs-string"><span class="hljs-string">"Push"</span></span>, int(x)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x[<span class="hljs-number"><span class="hljs-number">0</span></span>].isdigit() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> (<span class="hljs-string"><span class="hljs-string">"Op"</span></span>, x) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tokens] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trans</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ir)</span></span></span><span class="hljs-function">:</span></span> code = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tag, val <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ir: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tag == <span class="hljs-string"><span class="hljs-string">"Push"</span></span>: code.append(<span class="hljs-string"><span class="hljs-string">"st[sp] = %d;"</span></span> % val) code.append(<span class="hljs-string"><span class="hljs-string">"sp += 1;"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> tag == <span class="hljs-string"><span class="hljs-string">"Op"</span></span>: code.append(<span class="hljs-string"><span class="hljs-string">"st[sp - 2] = st[sp - 2] %s st[sp - 1];"</span></span> % val) code.append(<span class="hljs-string"><span class="hljs-string">"sp -= 1;"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"\n"</span></span>.join(code) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rpn_to_c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> C_CODE % (ST_SIZE, trans(scan(source))) print(rpn_to_c(<span class="hljs-string"><span class="hljs-string">"2 2 +"</span></span>))</code> </pre> <br><p>  Il reste à compiler la sortie de ce programme avec le compilateur C. </p><br><p>  Êtes-vous toujours prêt à continuer?  Discutons ensuite de ce que nous avons fait.  Il y a un moment douteux - notre compilateur traduit des expressions constantes, et vous pouvez les calculer simplement au stade de la compilation.  Cela n'a aucun sens de les traduire en code.  Mais prenons pour le moment que certains arguments peuvent entrer dans la pile de l'extérieur.  Insistons sur le fait que le sens pratique de notre développement peut être donné plus tard.  Maintenant, il est important d'avoir une idée générale de la construction des compilateurs les plus simples, non? </p><br><h1 id="kompilyator-s-ispolzovaniem-formy-ssa">  Compilateur de formulaires SSA </h1><br><p>  Aimez-vous le titre?  SSA - cela semble très solide pour tout compilateur.  Et maintenant, nous allons utiliser ce même SSA.  Qu'est-ce que c'est?  Avançons dans l'ordre. </p><br><p>  Nous générons actuellement du code C, sans aucune machine virtuelle.  Mais pourquoi avons-nous besoin d'un rudiment sous la forme d'opérations de pile?  Remplaçons ces opérations en travaillant avec des variables ordinaires de C.  De plus, nous n'enregistrerons pas de variables - nous aurons un nouveau nom pour chaque expression.  Laissez le compilateur C gérer tout cela.  Il s'avère qu'avec nous, chaque variable ne reçoit une valeur qu'une seule fois.  Et c'est d'ailleurs la forme de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ASS</a> . </p><br><p>  Voici notre nouveau compilateur. </p><br><pre> <code class="python hljs">C_CODE = <span class="hljs-string"><span class="hljs-string">r"""#include &lt;stdio.h&gt; int main(int argc, char** argv) { %s printf("%%d\n", %s); return 0; }"""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source)</span></span></span><span class="hljs-function">:</span></span> tokens = source.split() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [(<span class="hljs-string"><span class="hljs-string">"Push"</span></span>, int(x)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x[<span class="hljs-number"><span class="hljs-number">0</span></span>].isdigit() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> (<span class="hljs-string"><span class="hljs-string">"Op"</span></span>, x) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tokens] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trans</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ir)</span></span></span><span class="hljs-function">:</span></span> stack, code = [], [] name_cnt = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tag, val <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ir: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tag == <span class="hljs-string"><span class="hljs-string">"Push"</span></span>: code.append(<span class="hljs-string"><span class="hljs-string">"int t%d = %d;"</span></span> % (name_cnt, val)) stack.append(<span class="hljs-string"><span class="hljs-string">"t%d"</span></span> % name_cnt) name_cnt += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> tag == <span class="hljs-string"><span class="hljs-string">"Op"</span></span>: a, b = stack.pop(), stack.pop() code.append(<span class="hljs-string"><span class="hljs-string">"int t%d = %s %s %s;"</span></span> % (name_cnt, b, val, a)) stack.append(<span class="hljs-string"><span class="hljs-string">"t%d"</span></span> % name_cnt) name_cnt += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"\n"</span></span>.join(code), stack.pop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rpn_to_c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> C_CODE % trans(scan(source)) print(rpn_to_c(<span class="hljs-string"><span class="hljs-string">"2 2 +"</span></span>))</code> </pre> <br><p>  Veuillez noter qu'il n'y a plus de pile dans le code C et que son utilisation est simulée pendant la traduction.  La pile utilisée dans le processus de compilation ne contient pas de valeurs, mais des noms de variables. </p><br><p>  Voici le résultat final: </p><br><pre> <code class="plaintext hljs">#include &lt;stdio.h&gt; int main(int argc, char** argv) { int t0 = 2; int t1 = 2; int t2 = t0 + t1; printf("%d\n", t2); return 0; }</code> </pre> <br><h1 id="itogi">  Résumé </h1><br><p>  Il semble que le temps de notre leçon commune soit écoulé.  Nous étions engagés dans la traduction du programme d'une langue à une autre.  C'est ce qu'on appelle la traduction de source à source.  Ou - juste une traduction, qui peut être considérée comme un synonyme de compilation, mais généralement le compilateur traduit le programme d'une représentation de haut niveau à une représentation de bas niveau.  Il existe également le mot à la mode «transpilateur» pour le traducteur de source à source.  Mais la mention du «transpiler» peut être gênante pour les experts du compilateur, soyez prudent! </p><br><p>  Expérimentez avec le code.  En attente de commentaires! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432982/">https://habr.com/ru/post/fr432982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432968/index.html">6 problèmes courants lors de la mise en œuvre d'une solution de gestion de projet</a></li>
<li><a href="../fr432972/index.html">Source: "Loi de Conway"</a></li>
<li><a href="../fr432976/index.html">Père Noël anonyme 2018-2019: poste offrant des cadeaux du Nouvel An</a></li>
<li><a href="../fr432978/index.html">John Romero: Réflexion DOOM</a></li>
<li><a href="../fr432980/index.html">VMware NSX pour les plus petits. Partie 1</a></li>
<li><a href="../fr432984/index.html">Apprentissage automatique avec Node.js à l'aide de la bibliothèque Tensorflow.js</a></li>
<li><a href="../fr432986/index.html">Boucles C vs Go et mathématiques simples</a></li>
<li><a href="../fr432988/index.html">Huitième webmaster. En direct sur Habré</a></li>
<li><a href="../fr432990/index.html">Lampe en bois à commande vocale Edison. Prix ​​d'émission 5 $</a></li>
<li><a href="../fr432992/index.html">Il a mis ses écouteurs et est mort: nous parlons de la mort étrange d'un écolier à Rimbau</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>