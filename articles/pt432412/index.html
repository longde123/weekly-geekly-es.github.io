<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ™Ô∏è üóúÔ∏è üî§ Highload ++: Como ajudar o sistema ERP a lidar com 500.000 solicita√ß√µes por segundo ü•ì ‚õèÔ∏è ‚òÆÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No X5, processamos muitos dados em um sistema ERP. Acredita-se que ningu√©m mais nos processe no SAP ERP e SAP BW na R√∫ssia. Mas h√° outro ponto - o n√∫m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Highload ++: Como ajudar o sistema ERP a lidar com 500.000 solicita√ß√µes por segundo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/X5RetailGroup/blog/432412/">  No X5, processamos muitos dados em um sistema ERP.  Acredita-se que ningu√©m mais nos processe no SAP ERP e SAP BW na R√∫ssia.  Mas h√° outro ponto - o n√∫mero de opera√ß√µes e a carga neste sistema est√£o aumentando rapidamente.  Por 3 anos, "lutamos" pelo desempenho de nossos pesos pesados ‚Äã‚ÄãERP, obtivemos muitos cones e com quais m√©todos eles foram tratados, contamos abaixo. <br><br><img src="https://habrastorage.org/webt/5h/bu/5x/5hbu5xxbs9yb6vojgiy-2wl06hk.png" alt="imagem"><br><a name="habracut"></a><br><h2>  ERP X5 </h2><br>  Agora, o X5 opera mais de 13.000 lojas.  A maioria dos processos de neg√≥cios de cada um deles passa por um √∫nico sistema ERP.  Cada loja pode ter de 3.000 a 30.000 produtos, isso cria problemas com a carga no sistema, porque  processos de rec√°lculo regular de pre√ßos passam por ele de acordo com promo√ß√µes e exig√™ncias legislativas e com o c√°lculo da reposi√ß√£o de estoques.  Tudo isso √© cr√≠tico e, se n√£o for calculado em tempo √∫til quais mercadorias em que quantidade devem ser entregues amanh√£ √† loja ou qual pre√ßo deve estar nas mercadorias, os compradores n√£o encontrar√£o o que procuravam nas prateleiras ou n√£o poder√£o comprar as mercadorias pelo pre√ßo da promo√ß√£o atual a√ß√µes.  Em geral, al√©m de contabilizar transa√ß√µes financeiras, o sistema ERP √© respons√°vel por muito no dia a dia de cada loja. <br><br>  Um pouco das caracter√≠sticas de desempenho de um sistema ERP.  Sua arquitetura √© cl√°ssica, de tr√™s n√≠veis, com elementos orientados a servi√ßos: al√©m disso, temos mais de 5.000 clientes e terabytes de fluxos de informa√ß√µes de lojas e centros de distribui√ß√£o, na camada de aplicativos - SAP ABAP com mais de 10.000 processos e, finalmente, Oracle Database com mais de 100 TB de dados.  Cada processo ABAP √© uma m√°quina virtual condicional que executa a l√≥gica de neg√≥cios ABAP com seu pr√≥prio dialeto DBSL e SQL, armazenamento em cache, gerenciamento de mem√≥ria, ORM, etc.  Todos os dias, recebemos mais de 15 TB de altera√ß√µes no log do banco de dados.  O n√≠vel de carga √© de 500.000 solicita√ß√µes por segundo. <br><br>  Essa arquitetura √© um ambiente heterog√™neo.  Cada um dos componentes √© multiplataforma, podemos mov√™-lo para diferentes plataformas, escolher as melhores etc. <br><br>  O fato de o sistema ERP estar sob carga 24 horas por dia, 365 dias por ano, acrescenta combust√≠vel ao inc√™ndio.  Disponibilidade - 99,9% do tempo ao longo do ano.  A carga √© dividida em perfis diurno e noturno e manuten√ß√£o da casa em tempo livre. <br><br>  Mas isso n√£o √© tudo.  O sistema possui um ciclo de libera√ß√£o apertado.  Ele carrega mais de 2.000 trocas de lote por ano.  Esse pode ser um novo bot√£o e altera√ß√µes s√©rias na l√≥gica dos aplicativos de neg√≥cios. <br><br><img src="https://habrastorage.org/webt/xa/g3/xi/xag3xio65zfdslyhgosbjrmtakw.png" alt="imagem"><br><br>  Como resultado, √© um sistema grande e altamente carregado, mas ao mesmo tempo est√°vel, previs√≠vel e pronto para o crescimento que pode hospedar dezenas de milhares de lojas.  Mas esse nem sempre foi o caso. <br><br><h2>  2014. Ponto de bifurca√ß√£o </h2><br>  Para mergulhar no material pr√°tico, voc√™ precisa voltar para 2014.  Depois, houve as tarefas mais dif√≠ceis de otimizar o sistema.  Havia cerca de 5.000 lojas. <br><br>  O sistema da √©poca estava em tal estado que os processos mais cr√≠ticos n√£o eram escalon√°veis ‚Äã‚Äãe n√£o respondiam adequadamente √† carga crescente (ou seja, ao surgimento de novas lojas e mercadorias).  Al√©m disso, dois anos antes, um Hi-End caro foi comprado e, por algum tempo, uma atualiza√ß√£o n√£o fazia parte de nossos planos.  Al√©m disso, os processos no ERP j√° estavam prestes a violar o SLA.  O fornecedor concluiu que a carga no sistema n√£o √© escal√°vel.  Ningu√©m sabia se ela poderia suportar pelo menos + 10% do aumento de carga.  E foi planejado abrir duas vezes mais lojas em tr√™s anos. <br><br>  Era imposs√≠vel simplesmente alimentar o sistema ERP com ferro novo, e isso n√£o ajudaria.  Portanto, antes de tudo, decidimos incluir uma t√©cnica de otimiza√ß√£o de software no ciclo de lan√ßamento e seguir a regra: o crescimento linear da carga proporcional ao crescimento dos drivers de carga √© a chave da previsibilidade e escalabilidade. <br><br>  Qual foi a t√©cnica de otimiza√ß√£o?  Este √© um processo c√≠clico, dividido em v√°rias etapas: <br><br><ul><li>  monitoramento (identificar gargalos no sistema e identificar os principais consumidores de recursos) </li><li>  an√°lise (cria√ß√£o de perfil de processos do consumidor, identifica√ß√£o de estruturas com maior efeito e n√£o linear na carga) </li><li>  desenvolvimento (reduzindo a influ√™ncia das estruturas na carga, alcan√ßando carga linear) </li><li>  testes em um ambiente de avalia√ß√£o da qualidade ou implementa√ß√£o em um ambiente produtivo </li></ul><br>  Em seguida, o ciclo foi repetido. <br><br>  No processo, percebemos que as ferramentas de monitoramento atuais n√£o permitem identificar rapidamente os principais consumidores, identificar gargalos e processos que demandam recursos.  Portanto, para acelerar, tentamos as ferramentas de pesquisa el√°stica e Grafana.  Para fazer isso, eles desenvolveram independentemente coletores que, das ferramentas de monitoramento padr√£o no Oracle / SAP / AIX / Linux, transferiram m√©tricas para a pesquisa el√°stica e permitiram o monitoramento em tempo real da integridade do sistema.  Al√©m disso, eles enriqueceram o monitoramento com suas m√©tricas personalizadas, por exemplo, tempo de resposta e taxa de transfer√™ncia de componentes SAP espec√≠ficos ou layout de perfis de carga para processos de neg√≥cios. <br><img src="https://habrastorage.org/webt/m2/k3/dz/m2k3dzdu-nz384_pz4phtnlvkc0.png" alt="imagem"><br><br><h2>  Otimiza√ß√£o de c√≥digo e processo </h2><br>  Antes de tudo, para um menor efeito de gargalos na velocidade, eles garantiam um fornecimento mais suave de carga ao sistema. <br><br>  A maioria dos processos de neg√≥cios em nosso sistema ERP, por exemplo, como pre√ßos regulares ou planejamento de reposi√ß√£o de estoque, √© um processamento sequencial passo a passo de uma grande quantidade de dados (para todas as mercadorias e todas as lojas).  Para implementar o processamento no √¢mbito de tarefas t√£o dif√≠ceis, uma vez desenvolvemos nosso pr√≥prio despachante de processamento paralelo em lote (a seguir denominado agendador de carga).  Nesse caso, na forma de um pacote, √© apresentada uma etapa de processamento realizada separadamente para uma loja separada. <br><br>  Inicialmente, a l√≥gica do planejador era tal que primeiro os pacotes do primeiro est√°gio de processamento eram executados para todas as lojas, depois os pacotes do segundo est√°gio, etc.  Ou seja, o sistema executou simultaneamente processos que criaram o mesmo tipo de carga e causaram a degrada√ß√£o de certos recursos (entrada / sa√≠da no banco de dados ou CPU nos servidores de aplicativos, etc.). <br><img src="https://habrastorage.org/webt/kj/_r/sf/kj_rsf_nxsu309iuygujkxzavty.png" alt="imagem"><br><br>  Reescrevemos a l√≥gica do agendador para que a cadeia de pacotes fosse formada separadamente para cada loja e a prioridade do lan√ßamento de novos pacotes fosse constru√≠da n√£o por etapas, mas por lojas. <br><img src="https://habrastorage.org/webt/rc/_3/kw/rc_3kwnwqdi_hemnvuxnpmps_q0.png" alt="imagem"><br><br>  Devido √† dura√ß√£o diferente dos pacotes para diferentes lojas e ao grande n√∫mero controlado de processos executados simultaneamente no √¢mbito das tarefas do agendador de carga, conseguimos a execu√ß√£o simult√¢nea de processos heterog√™neos, carregamento mais suave da carga e elimina√ß√£o de alguns gargalos. <br><br>  Ent√£o eles come√ßaram a otimizar projetos individuais.  Cada pacote individual foi revisado, elaborado com perfil e montado projetos n√£o ideais e abordagens aplicadas para otimiz√°-los.  Posteriormente, essas abordagens foram inclu√≠das nos regulamentos do desenvolvedor para evitar o crescimento indesej√°vel de carga durante o desenvolvimento do sistema.  Alguns deles: <br><br><ul><li>  carga excessiva na CPU dos servidores de aplicativos (muitas vezes gerada por algoritmos n√£o lineares no c√≥digo do programa, por exemplo, a boa e antiga busca linear em loops ou algoritmos n√£o lineares para encontrar interse√ß√µes de conjuntos de elementos desordenados, etc. para procurar interse√ß√µes de conjuntos, usamos algoritmos lineares, pr√©-encomenda de elementos etc.) </li><li>  chamadas id√™nticas ao banco de dados com as mesmas condi√ß√µes no mesmo processo geralmente levam √† utiliza√ß√£o excessiva da CPU do banco de dados (ele √© tratado armazenando em cache os resultados da primeira amostra na mem√≥ria do programa ou no n√≠vel do servidor de aplicativos e usando dados em cache para amostras subsequentes) </li><li>  solicita√ß√µes de jun√ß√£o frequentes (√© melhor execut√°-las, √© claro, no n√≠vel do banco de dados, mas √†s vezes nos permit√≠amos dividi-las em amostras simples, cujo resultado √© armazenado em cache, e transferir a l√≥gica de colagem para o aplicativo. Nesses casos, √© melhor aquecer o servidor de aplicativos e n√£o o banco de dados. ) </li><li>  solicita√ß√µes de jun√ß√£o pesadas, resultando em muitas E / S </li></ul><br>  Sobre o √∫ltimo em mais detalhes.  Nesse caso, o modelo de dados foi traduzido para um formato menos normal.  Um exemplo cl√°ssico √© uma sele√ß√£o de documentos cont√°beis para uma data espec√≠fica para uma loja individual.  Muitos funcion√°rios solicitam.  A tabela mestre (tabela de cabe√ßalho) armazena as datas dos documentos, na tabela de posi√ß√µes - a loja e as mercadorias.  As consultas mais comuns s√£o uma sele√ß√£o de todos os documentos de uma loja espec√≠fica para uma data espec√≠fica.  Com essa solicita√ß√£o, o filtro por data na tabela de t√≠tulos fornece 500 mil registros, o filtro por loja - a mesma quantidade.  Ao mesmo tempo, depois de colar em uma loja separada para a data certa, temos um prazo de 3 mil.  Independentemente da tabela em que come√ßamos a filtrar e colar dados, sempre obtemos muitas E / S indesejadas. <br><img src="https://habrastorage.org/webt/rw/dp/kr/rwdpkruti_tjhpazqtcoonzpeq0.png" alt="imagem"><br><br>  Isso pode ser evitado apresentando os dados de uma forma menos normal.  Em um caso, o campo de data foi duplicado na tabela de posi√ß√µes, foi preenchido na cria√ß√£o de documentos, os √≠ndices foram coletados para pesquisa r√°pida e j√° estavam filtrados de acordo com a tabela de posi√ß√µes.  Assim, tendo sacrificado despesas indiretas insignificantes para armazenar um novo campo e √≠ndices, reduzimos o n√∫mero de opera√ß√µes de entrada / sa√≠da geradas por consultas problem√°ticas v√°rias vezes. <br><br><img src="https://habrastorage.org/webt/62/oh/gb/62ohgb45gxmmt9plaeuzdgckhds.png" alt="imagem"><br><br><h2>  2015. O problema de um servi√ßo </h2><br>  Durante um ano e meio, fizemos um √≥timo trabalho de otimiza√ß√£o do sistema, que se tornou mais previs√≠vel.  No entanto, os planos para dobrar o n√∫mero de lojas continuaram relevantes, ent√£o os desafios ainda nos enfrentavam. <br><br>  No caminho, encontramos v√°rios gargalos.  Por exemplo, no final de 2015, eles perceberam que haviam descansado no desempenho de um servi√ßo principal da plataforma.  Este √© um servi√ßo de bloqueio l√≥gico do SAP ABAP.  Por causa disso, o sistema claramente n√£o suportaria o crescimento da carga.  Perdas de muito dinheiro pairavam no horizonte. <br><br>  Para esclarecer, a tarefa do servi√ßo √© levar a transacionalidade l√≥gica ao n√≠vel do servidor de aplicativos.  No ABAP, uma √∫nica transa√ß√£o pode passar por v√°rias etapas em diferentes fluxos de trabalho.  Para que a transa√ß√£o seja conclu√≠da, existe um servi√ßo de bloqueio e mecanismos relacionados.  As opera√ß√µes de bloqueio e desbloqueio ocorrem rapidamente, mas s√£o at√¥micas, n√£o podem ser separadas.  Houve um problema com E / S s√≠ncrona. <br><br>  O servi√ßo acelerou um pouco depois que os desenvolvedores do SAP lan√ßaram um patch especial, trocamos o servi√ßo por outro hardware e trabalhamos nas configura√ß√µes do sistema, mas isso ainda n√£o foi suficiente.  O teto do servi√ßo de passaporte era de aproximadamente 7 mil opera√ß√µes por segundo e, durante muito tempo, j√° precis√°vamos de 10 mil. <br><br>  Ap√≥s o teste de carga sint√©tica, verificou-se que a degrada√ß√£o √© n√£o linear e, no entanto, estamos no limite de desempenho do servi√ßo acima do qual a degrada√ß√£o inaceit√°vel de todo o sistema ERP √© manifestada.  Chamadas repetidas para os desenvolvedores deram apenas um veredicto decepcionante - o servi√ßo est√° funcionando corretamente, apenas exigimos muito na arquitetura atual da solu√ß√£o.  Mesmo se nos compromet√™ssemos imediatamente a refazer toda a arquitetura da solu√ß√£o, levaria v√°rios meses para manter a operacionalidade do sistema atual. <br><br>  Uma das primeiras op√ß√µes para tentar estender a vida √∫til de um servi√ßo de bloqueio √© acelerar a E / S e gravar no sistema de arquivos.  O que?  Experimentos com uma alternativa ao AIX.  Transferiu o servi√ßo para o Linux na m√°quina Power mais poderosa e obteve muito tempo de resposta.  O servi√ßo com o sistema de arquivos ativado se comportou da mesma forma que no Aix com os desativados.  Em seguida, transferimos esse c√≥digo para um dos blades x86_64 e obtivemos uma curva de desempenho ainda mais fant√°stica do que antes.  Parecia engra√ßado. <br><br>  Pode-se supor que os desenvolvedores do AIX e Linux tenham feito algo diferente no √∫ltimo teste, mas a arquitetura do processador tamb√©m teve efeito aqui. <br><img src="https://habrastorage.org/webt/73/1v/pl/731vplzz4ndclyo0l7tga0mlhv8.png" alt="imagem"><br><br>  Qual foi a conclus√£o?  Alguma plataforma √© ideal para bancos de dados multithread, fornecendo desempenho e toler√¢ncia a falhas, mas um processador em uma arquitetura diferente pode lidar melhor com tarefas espec√≠ficas.  Se no in√≠cio da cria√ß√£o de uma solu√ß√£o para abandonar a plataforma cruzada, voc√™ poder√° perder espa√ßo para manobras no futuro. <br><br>  No entanto, descobrimos esse problema e o servi√ßo come√ßou a funcionar 3-4 vezes mais r√°pido, o que √© suficiente para um crescimento muito longo. <br><br><h2>  2016. Gargalo da CPU do DB </h2><br>  Literalmente seis meses depois, problemas ex√≥ticos come√ßaram a ser sentidos com a CPU no banco de dados.  Parece claro que, com um aumento na carga, o consumo de recursos do processador aumenta.  Mas o SysTime come√ßou a ocupar a maior parte dele, e havia claramente um problema no kernel.  Eles come√ßaram a entender, realizar testes de carga sint√©ticos e perceberam que nosso rendimento era de 300 mil opera√ß√µes por segundo, ou seja,  bilh√µes de solicita√ß√µes por hora e, em seguida, degrada√ß√£o. <br><br>  Como resultado, chegamos √† conclus√£o de que o pedido perfeito √© aquele que n√£o existe.  Expandimos nossa t√©cnica de otimiza√ß√£o com novas abordagens e realizamos uma auditoria no sistema ERP: come√ßamos a procurar consultas, por exemplo, com baixa efici√™ncia (100 mil sele√ß√µes - como resultado de 100 linhas ou 0 em geral) - para refazer.  Se as solicita√ß√µes "vazias" n√£o puderem ser removidas, deixe-as ir para o "cache negativo", se apropriado.  Se muitas solicita√ß√µes para os mesmos dados do produto forem processadas em paralelo, deixe-as atormentar o servidor de aplicativos, e n√£o o banco de dados, armazenamos em cache.  Tamb√©m ‚Äúampliamos‚Äù um grande n√∫mero de consultas √∫nicas e frequentes em uma chave na estrutura de um processo, substituindo-a por sele√ß√µes mais raras de uma parte de uma chave.  Ou, por exemplo, para distribuir a carga na cadeia de processamento, diferentes etapas podem ser executadas em diferentes servidores de aplicativos.  Isso √© bom, mas em est√°gios diferentes eles podem pedir a mesma coisa da base.  Em seguida, deixe a primeira etapa, ap√≥s iniciar no cache do aplicativo, parte das solicita√ß√µes, e ela permanece l√° para concluir o restante da cadeia. <br><img src="https://habrastorage.org/webt/ww/cx/uz/wwcxuzeyehn_idgaokwh2psy984.png" alt="imagem"><br><br>  Com a ajuda de tais truques, vencemos um pouco em todos os lugares, mas no final descarregamos seriamente a base.  O sistema ganhou vida.  Enquanto isso, descemos para Aix. <br><br>  Outras experi√™ncias revelaram que h√° um limite de desempenho - as 300.000 chamadas do DataBase j√° mencionadas por segundo.  A raiz do problema foi o desempenho da interface de rede, que tinha um limite - cerca de 300 mil pacotes por segundo em uma dire√ß√£o.  √Ä medida que o teto se aproximava, o tempo de chamadas do sistema aumentava.  Como se viu depois, tamb√©m era um legado da pilha de rede do kernel do AIX. <br><br>  Em geral, nunca tivemos problemas com a lat√™ncia, o n√∫cleo da rede era produtivo, todos os cabos foram montados em um grande canal indestrut√≠vel em uma interface.  Fizemos uma solu√ß√£o alternativa: dividimos toda a rede entre servidores de aplicativos e o banco de dados em grupos em diferentes interfaces.  Como resultado, cada grupo de servidores de aplicativos se comunicava com o banco de dados por meio de sua pr√≥pria interface separada.  O desempenho m√°ximo de cada interface foi ligeiramente reduzido, mas, no total, fizemos um overclock da rede para 1 milh√£o de pacotes por segundo em uma dire√ß√£o. <br><br>  E o princ√≠pio "A melhor solicita√ß√£o √© a que n√£o existe" foi adicionado ao Talmud para desenvolvedores, para que isso seja levado em considera√ß√£o ao escrever o c√≥digo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u-/lo/qh/u-loqhu4_avqxvne0eam6lmittq.png" alt="imagem"></div><br><h2>  2017. Live to upgrade </h2><br>  Bem, a √∫ltima etapa da recupera√ß√£o do nosso sistema, aprovada em 2017.  Tudo o que restava era viver um pouco at√© a atualiza√ß√£o e era necess√°rio manter o SLA para nada.  O c√≥digo foi otimizado, mas vimos que quanto maior a carga na CPU do banco de dados, mais lentos os processos funcionam, embora a margem de utiliza√ß√£o seja de 10 a 20%.  Inicialmente, estimou-se que 100% √© o dobro de 50%.  E quando h√° uma reserva de 10 a 20%, √© de 10 a 20%.  De fato, a uma carga acima de 67-80%, a dura√ß√£o das tarefas aumentou linearmente, ou seja,  A lei de Amdahl funcionou.  O sistema tinha um limite de paraleliza√ß√£o e quando foi excedido, com o envolvimento de um n√∫mero crescente de processadores no trabalho, o desempenho de cada processador individual diminuiu. <br><br>  Naquele momento, usamos 125 processadores f√≠sicos ou 500 l√≥gicos, considerando o multithreading no n√≠vel AIX.  O que voc√™ sugeriria?  Upgrade?  Mesmo antes do final de sua coordena√ß√£o, era necess√°rio aguardar v√°rios meses e n√£o abandonar o SLA. <br><br>  Em algum momento, eles perceberam que as m√©tricas tradicionais de utiliza√ß√£o do processador n√£o s√£o indicativas para n√≥s - elas n√£o mostram o in√≠cio real da degrada√ß√£o.  Para uma avalia√ß√£o realista da integridade do sistema, come√ßamos a usar a m√©trica integrada - o resultado de um teste sint√©tico como m√©trica para o desempenho do processador do banco de dados.  Uma vez por minuto, eles fizeram um teste sint√©tico, mediram sua dura√ß√£o e exibiram essa m√©trica em nossos monitores.  E reagiram se a m√©trica subisse acima do ponto cr√≠tico declarado.  Mantivemos a carga de nossos planejadores de carga um pouco, para que ela permanecesse na √°rea "torque m√°ximo" do banco de dados. <br><img src="https://habrastorage.org/webt/fg/o0/0u/fgo00uye8ms6yklbxscplqcly7s.png" alt="imagem"><br><br>  No entanto, o controle manual era ineficaz e est√°vamos cansados ‚Äã‚Äãde acordar √† noite.  Em seguida, reescrevemos o planejador de carga para que ele recebesse feedback sobre as m√©tricas de desempenho atuais.  Se as m√©tricas ultrapassassem o limite amarelo (veja a figura), o planejamento de pacotes de baixa prioridade foi congelado e apenas os processos cr√≠ticos de neg√≥cios receberam prioridade.  Assim, conseguimos controlar automaticamente a intensidade da carga e os recursos foram utilizados com efici√™ncia.  E o mais interessante √© que, mantendo o sistema dentro de 80% da carga, na mesma zona de torque m√°ximo, obtivemos uma redu√ß√£o no tempo total para a execu√ß√£o de processos de neg√≥cios, porque  cada thread come√ßou a trabalhar muito mais r√°pido. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gi/54/7w/gi547wixu3bnefxdvvy6wl-golc.png" alt="imagem"></div><br><h2>  Algumas dicas para quem trabalha com ERP altamente carregado </h2><br><ul><li>  √â muito importante monitorar o desempenho dos sistemas no in√≠cio de um projeto, especialmente com suas pr√≥prias m√©tricas. </li><li>  Garanta um aumento linear da carga proporcional ao aumento do n√∫mero de drivers de carga (no nosso caso, eram mercadorias e lojas). </li><li>  Elimine constru√ß√µes n√£o lineares no c√≥digo, use o cache para eliminar consultas id√™nticas ao banco de dados. </li><li>  Se voc√™ precisar transferir a carga da CPU do banco de dados para a CPU do servidor de aplicativos, poder√° dividir as solicita√ß√µes de jun√ß√£o em amostras simples. </li><li>  Para todas as otimiza√ß√µes, lembre-se de que uma solicita√ß√£o r√°pida √© boa e, √†s vezes, uma solicita√ß√£o r√°pida e frequente √© ruim. </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tente sempre testar e tirar proveito do ambiente de solu√ß√£o heterog√™neo. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juntamente com as m√©tricas de desempenho tradicionais, use uma m√©trica integrada que identifique exclusivamente a degrada√ß√£o; </font><font style="vertical-align: inherit;">Usando essa m√©trica, determine a zona de "torque m√°ximo" do seu sistema.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Forne√ßa √†s ferramentas de planejamento de carga mecanismos para monitorar as m√©tricas de desempenho atuais e gerenciar taxas de fluxo de carga para usar com efici√™ncia os recursos do sistema </font></font></li></ul><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agradecemos aos organizadores da Highload pela oportunidade de compartilhar essa experi√™ncia n√£o apenas em Habr√©, mas tamb√©m no palco do maior evento em sistemas altamente carregados. </font></font><br></i> <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dmitry Tsvetkov, Alexander Lishchuk, especialistas em SAP da # ITX5</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A prop√≥sito, a # ITX5 est√° √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">procura</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de consultores da SAP.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt432412/">https://habr.com/ru/post/pt432412/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt432400/index.html">CS: GO agora √© gratuito</a></li>
<li><a href="../pt432402/index.html">Ei RH, onde est√° minha lembran√ßa?</a></li>
<li><a href="../pt432404/index.html">O backup para Linux n√£o escreve letras</a></li>
<li><a href="../pt432408/index.html">Resumo da Fintech: prepara√ß√£o para desconectar pequenos bancos da Visa e Mastercard, uma calculadora de pens√µes e n√£o apenas</a></li>
<li><a href="../pt432410/index.html">Entidades no estilo DDD com Entity Framework Core</a></li>
<li><a href="../pt432414/index.html">Segredos antigos para depura√ß√£o r√°pida: Animando c√≥digo fonte</a></li>
<li><a href="../pt432416/index.html">Tipos dependentes - o futuro das linguagens de programa√ß√£o</a></li>
<li><a href="../pt432418/index.html">Analisando Express√µes Lambda em Java</a></li>
<li><a href="../pt432420/index.html">Introdu√ß√£o ao Git Merge e Git Rebase: Por que e quando us√°-los</a></li>
<li><a href="../pt432422/index.html">Modo offline no iOS e recursos de sua implementa√ß√£o no Realm</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>