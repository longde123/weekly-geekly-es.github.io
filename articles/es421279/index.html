<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçö üí± üßñüèΩ Software de seguridad adicional para NAS üó£Ô∏è üÜï üôÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La serie de art√≠culos se titula Creaci√≥n de un NAS seguro . Por lo tanto, este art√≠culo considerar√° aumentar el nivel de seguridad. Adem√°s, se describ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Software de seguridad adicional para NAS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421279/"><p><img src="https://habrastorage.org/webt/39/ch/xl/39chxldtklziggqygx3wgmom0ky.png"></p><br><p>  La serie de art√≠culos se titula <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Creaci√≥n de un NAS seguro</a> .  Por lo tanto, este art√≠culo considerar√° aumentar el nivel de seguridad.  Adem√°s, se describir√°n aquellas herramientas que no he usado, pero que es posible aplicar. </p><a name="habracut"></a><br><h2 id="kto-i-kak">  Quien y como </h2><br><p>  ¬øQui√©n va a atacar el sistema y c√≥mo lo har√°? </p><br><p>  Esta suele ser la primera pregunta que debe responderse antes de hablar de seguridad. <br>  Al menos en el caso de NAS, dicha respuesta ya est√° impl√≠cita.  Pero para responder completamente a esta pregunta, se est√°n construyendo un modelo de amenaza y un modelo de intrusos. </p><br><p>  Las empresas se est√°n embarcando en una fase de modelado de amenazas en sus ciclos de desarrollo. <br>  Microsoft tiene un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SDL</a> para esto, las personas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tienen otros modelos</a> . </p><br><p>  Implican el uso de ciertas t√©cnicas, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">STRIDE</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DREAD</a> (STRIDE es a√∫n m√°s general y est√° bien soportado instrumentalmente). </p><br><p>  En STRIDE, por ejemplo, un modelo se basa en flujos de datos y generalmente es grande, pesado y poco entendido.  Sin embargo, la herramienta proporciona una lista de posibles amenazas, lo que facilita su consideraci√≥n. </p><br><p>  El modelo de amenaza es informaci√≥n clasificada porque facilita que un atacante analice el sistema y encuentre debilidades.  Si recibe un modelo, no tendr√° que construirlo solo, porque los analistas ya se han ocupado de todo. </p><br><p>  <strong>Fue un minuto de publicidad.</strong> </p><br><p><img src="https://habrastorage.org/webt/w4/ye/cz/w4yeczwns0wzroeq-ufxttf9yhm.jpeg"></p><br><p>  As√≠ es como las empresas serias construyen el modelo.  Y si esto es interesante, de alguna manera puedo describirlo en un art√≠culo separado. </p><br><p>  Aqu√≠ describir√© lo que se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"endurecimiento"</a> en ingl√©s y tratar√© las fallas de seguridad que se hicieron durante la construcci√≥n del sistema. </p><br><p>  B√°sicamente, el mantenimiento de la seguridad a este nivel se realiza mediante el cierre de vulnerabilidades conocidas del sistema, monitore√°ndolo y verific√°ndolo peri√≥dicamente. </p><br><h2 id="literatura-po-teme">  Literatura relacionada </h2><br><p>  Que leer: </p><br><ul><li>  Vale la pena comenzar con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el proyecto Hardened Linux</a> , donde todos encontrar√°n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muchas cosas √∫tiles</a> . </li><li>  El paquete harden-doc contiene el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Manual de seguridad de Debian</a> antiguo en 2012, pero correr no interfiere con la comprensi√≥n del problema. </li><li>  Luego, lea el breve tutorial de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Debian 8 Hardening</a> . </li><li>  Y, por √∫ltimo, una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">peque√±a gu√≠a para reforzar los paquetes de deb</a> y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digo C / C ++</a> que probablemente no necesitar√°. </li></ul><br><h2 id="snapshoty-i-doker">  Instant√°neas y Docker </h2><br><p>  Anteriormente, se instal√≥ zfs-autosnapshot.  En repetidas ocasiones me ayud√≥, porque  Podr√≠a restaurar configuraciones corruptas (para Nextcloud, por ejemplo) a partir de instant√°neas. <br>  Sin embargo, con el tiempo, el sistema comenz√≥ a desacelerarse y se multiplicaron varios miles de instant√°neas. </p><br><p> <code>com.sun:auto-snapshot=false</code> que al crear el sistema de archivos principal para contenedores, olvid√© establecer el indicador <code>com.sun:auto-snapshot=false</code> . </p><br><p>  En el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo original,</a> este problema ya se ha solucionado, aqu√≠ mostrar√© c√≥mo deshacerse de las instant√°neas adicionales. </p><br><div class="spoiler">  <b class="spoiler_title">Detalles sobre c√≥mo solucionar el error.</b> <div class="spoiler_text"><p>  Primero, desactive zfs-auto-snapshot en el sistema de archivos principal de la ventana acoplable: </p><br><pre> <code class="plaintext hljs">zfs set com.sun:auto-snapshot=false tank0/docker/lib</code> </pre> <br><p>  Ahora elimine los contenedores e im√°genes no utilizados: </p><br><pre> <code class="plaintext hljs">docker container prune docker image prune</code> </pre> <br><p>  Eliminar instant√°neas: </p><br><pre> <code class="plaintext hljs">zfs list -t snapshot -o name -S creation | grep -e ".*docker/lib.*@zfs-auto-snap" | tail -n +1500 | xargs -n 1 zfs destroy -vr</code> </pre> <br><p>  Y ap√°guelos en todos los sistemas de archivos de imagen: </p><br><pre> <code class="plaintext hljs">zfs list -t filesystem -o name -S creation | grep -e "tank0/docker/lib" | xargs -n 1 zfs set com.sun:auto-snapshot=false</code> </pre> <br><p>  M√°s detalles se pueden leer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p></div></div><br><h2 id="ldap">  LDAP </h2><br><p>  La √∫ltima vez, solo se cre√≥ un usuario LDAP con un rol de administrador. </p><br><p>  Pero la mayor√≠a de los servicios no necesitan cambiar nada en la base de datos del usuario.  Por lo tanto, ser√≠a bueno agregar un usuario de solo lectura.  Para no crear roles manualmente, es posible usar un script de inicializaci√≥n de contenedor. </p><br><p>  Primero, agregue la configuraci√≥n en <code>docker-compose.yml</code> para habilitar al usuario de solo lectura: </p><br><pre> <code class="plaintext hljs">- "LDAP_READONLY_USER=true" - "LDAP_READONLY_USER_USERNAME=readonly" - "LDAP_READONLY_USER_PASSWORD=READONLY_PASSWORD"</code> </pre> <br><p>  Archivo completo bajo el spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">docker-compose.yml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">version: "2" networks: ldap: docker0: external: name: docker0 services: open-ldap: image: "osixia/openldap" hostname: "open-ldap" restart: always environment: - "LDAP_ORGANISATION=NAS" - "LDAP_DOMAIN=nas.nas" - "LDAP_ADMIN_PASSWORD=ADMIN_PASSWORD" - "LDAP_CONFIG_PASSWORD=CONFIG_PASSWORD" - "LDAP_READONLY_USER=true" - "LDAP_READONLY_USER_USERNAME=readonly" - "LDAP_READONLY_USER_PASSWORD=READONLY_PASSWORD" - "LDAP_TLS=true" - "LDAP_TLS_ENFORCE=false" - "LDAP_TLS_CRT_FILENAME=ldap_server.crt" - "LDAP_TLS_KEY_FILENAME=ldap_server.key" - "LDAP_TLS_CA_CRT_FILENAME=ldap_server.crt" volumes: - ./certs:/container/service/slapd/assets/certs - ./ldap_data/var/lib:/var/lib/ldap - ./ldap_data/etc/ldap/slapd.d:/etc/ldap/slapd.d networks: - ldap ports: - 172.21.0.1:389:389 - 172.21.0.1:636:636 phpldapadmin: image: "osixia/phpldapadmin:0.7.1" hostname: "nas.nas" restart: always networks: - ldap - docker0 expose: - 443 links: - open-ldap:open-ldap-server volumes: - ./certs:/container/service/phpldapadmin/assets/apache2/certs environment: - VIRTUAL_HOST=ldap.* - VIRTUAL_PORT=443 - VIRTUAL_PROTO=https - CERT_NAME=NAS.cloudns.cc - "PHPLDAPADMIN_LDAP_HOSTS=open-ldap-server" #- "PHPLDAPADMIN_HTTPS=false" - "PHPLDAPADMIN_HTTPS_CRT_FILENAME=certs/ldap_server.crt" - "PHPLDAPADMIN_HTTPS_KEY_FILENAME=private/ldap_server.key" - "PHPLDAPADMIN_HTTPS_CA_CRT_FILENAME=certs/ldap_server.crt" - "PHPLDAPADMIN_LDAP_CLIENT_TLS_REQCERT=allow" ldap-ssp: image: openfrontier/ldap-ssp:https volumes: - /etc/ssl/certs/ssl-cert-snakeoil.pem:/etc/ssl/certs/ssl-cert-snakeoil.pem - /etc/ssl/private/ssl-cert-snakeoil.key:/etc/ssl/private/ssl-cert-snakeoil.key restart: always networks: - ldap - docker0 expose: - 80 links: - open-ldap:open-ldap-server environment: - VIRTUAL_HOST=ssp.* - VIRTUAL_PORT=80 - VIRTUAL_PROTO=http - CERT_NAME=NAS.cloudns.cc - "LDAP_URL=ldap://open-ldap-server:389" - "LDAP_BINDDN=cn=admin,dc=nas,dc=nas" - "LDAP_BINDPW=ADMIN_PASSWORD" - "LDAP_BASE=ou=users,dc=nas,dc=nas" - "MAIL_FROM=admin@nas.nas" - "PWD_MIN_LENGTH=8" - "PWD_MIN_LOWER=3" - "PWD_MIN_DIGIT=2" - "SMTP_HOST=" - "SMTP_USER=" - "SMTP_PASS="</code> </pre> </div></div><br><p>  Luego, debe volcar y eliminar: </p><br><pre> <code class="plaintext hljs">$ cd /tank0/docker/services/ldap $ tar czf ~/ldap_backup.tgz . $ ldapsearch -Wx -D "cn=admin,dc=nas,dc=nas" -b "dc=nas,dc=nas" -H ldap://172.21.0.1 -LLL &gt; ldap_dump.ldif $ docker-compose down $ rm -rf ldap_data $ docker-compose up -d</code> </pre> <br><p>  Para evitar que el servidor se recupere de un volcado por malversaci√≥n de elementos duplicados, elimine las l√≠neas en el archivo: </p><br><pre> <code class="plaintext hljs">dn: dc=nas,dc=nas objectClass: top objectClass: dcObject objectClass: organization o: NAS dc: nas dn: cn=admin,dc=nas,dc=nas objectClass: simpleSecurityObject objectClass: organizationalRole cn: admin description: LDAP administrator userPassword:: PASSWORD_BASE64</code> </pre><br><p>  Y restaurar usuarios y grupos: </p><br><pre> <code class="plaintext hljs">$ ldapadd -Wx -D "cn=admin,dc=nas,dc=nas" -H ldap://172.21.0.1 -f ldap_dump.ldif</code> </pre> <br><p>  Tal bestia aparecer√° en la base de datos: </p><br><pre> <code class="plaintext hljs">dn: cn=readonly,dc=nas,dc=nas cn: readonly objectClass: simpleSecurityObject objectClass: organizationalRole userPassword:: PASSWORD_BASE64 description: LDAP read only user</code> </pre> <br><p>  El contenedor crear√° los roles en la configuraci√≥n del servidor LDAP. <br>  Realice comprobaciones despu√©s de la recuperaci√≥n y elimine la copia de seguridad: </p><br><pre> <code class="plaintext hljs">$ rm ~/ldap_backup.tgz</code> </pre> <br><h3 id="dobavlenie-grupp-v-ldap">  Agregar grupos a LDAP </h3><br><p>  Es conveniente la separaci√≥n de los usuarios LDAP en grupos similares a los grupos POSIX en Linux. <br>  Por ejemplo, es posible crear grupos cuyos usuarios tendr√°n acceso a repositorios, acceso a la nube o acceso a la biblioteca. </p><br><p>  Los grupos se agregan f√°cilmente a phpLDAPAdmin, y no me enfocar√© en esto. </p><br><p>  Solo noto lo siguiente: </p><br><ul><li>  El grupo se crea a partir de la plantilla "Predeterminada".  Este <strong>no</strong> es <strong>un</strong> grupo <strong>POSIX</strong> , sino un grupo de nombres. </li><li>  En consecuencia, el grupo tiene un atributo <code>objectClass</code> que incluye el valor de <code>groupOfUniqueNames</code> . </li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/tx/i8/yj/txi8yjxxtbvlzynr1yttkn-ddgc.png" alt="Agregar un grupo a phpLDAPAdmin"></a> </p><br><h2 id="docker">  Docker </h2><br><p>  En Docker, casi todo se ha hecho por ti. <br>  Por defecto, utiliza <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la restricci√≥n de llamadas del sistema</a> , que se incluye en el n√∫cleo OMV: </p><br><pre> <code class="plaintext hljs"># grep SECCOMP /boot/config-4.16.0-0.bpo.2-amd64 CONFIG_HAVE_ARCH_SECCOMP_FILTER=y CONFIG_SECCOMP_FILTER=y CONFIG_SECCOMP=y</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> puede leer sobre las reglas b√°sicas de seguridad de Docker con m√°s detalle. <br>  Adem√°s, si AppArmor est√° habilitado, Docker puede integrarse con √©l y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reenviar sus perfiles al contenedor</a> . </p><br><h2 id="set">  Red </h2><br><h3 id="ustranenie-vozmozhnosti-obnaruzheniya-os">  Eliminar el descubrimiento del sistema operativo </h3><br><p>  La red se encuentra detr√°s del enrutador, pero es posible hacer un curioso ejercicio cambiando algunos par√°metros de la pila de red para que el sistema operativo no pueda ser identificado por las respuestas. <br>  Hay poco beneficio real de esto, porque el atacante estudiar√° los banners de servicio y a√∫n entender√° qu√© sistema operativo est√° utilizando. </p><br><div class="spoiler">  <b class="spoiler_title">Nmap muestra qu√© sistema operativo se est√° ejecutando en el dispositivo.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># nmap -O localhost Starting Nmap 7.40 ( https://nmap.org ) at 2018-08-26 14:39 MSK Nmap scan report for localhost (127.0.0.1) Host is up (0.000015s latency). Other addresses for localhost (not scanned): ::1 Not shown: 992 closed ports PORT STATE SERVICE 53/tcp open domain 80/tcp open http 443/tcp open https 5432/tcp open postgresql Device type: general purpose Running: Linux 3.X|4.X OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4 OS details: Linux 3.8 - 4.6 Network Distance: 0 hops OS detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 4.07 seconds</code> </pre> </div></div><br><p>  Descargue la configuraci√≥n de sysctl.conf: </p><br><pre> <code class="plaintext hljs"># sysctl -p /etc/sysctl.conf net.ipv4.conf.all.accept_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.all.accept_source_route = 0 net.ipv6.conf.all.accept_source_route = 0 net.ipv4.tcp_rfc1337 = 1 net.ipv4.ip_default_ttl = 128 net.ipv4.icmp_ratelimit = 900 net.ipv4.tcp_synack_retries = 7 net.ipv4.tcp_syn_retries = 7 net.ipv4.tcp_window_scaling = 1 net.ipv4.tcp_timestamps = 1</code> </pre> <br><p>  Y entonces ... </p><br><div class="spoiler">  <b class="spoiler_title">Nmap no puede determinar el sistema operativo.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># nmap -O localhost Starting Nmap 7.40 ( https://nmap.org ) at 2018-08-26 14:40 MSK Nmap scan report for localhost (127.0.0.1) Host is up (0.000026s latency). Other addresses for localhost (not scanned): ::1 Not shown: 992 closed ports PORT STATE SERVICE 53/tcp open domain 80/tcp open http 443/tcp open https 5432/tcp open postgresql No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=7.40%E=4%D=8/26%OT=53%CT=1%CU=43022%PV=N%DS=0%DC=L%G=Y%TM=5B8291C OS:3%P=x86_64-pc-linux-gnu)SEQ(SP=FA%GCD=1%ISR=105%TI=Z%CI=I%TS=8)OPS(O1=MF OS:FD7ST11NW7%O2=MFFD7ST11NW7%O3=MFFD7NNT11NW7%O4=MFFD7ST11NW7%O5=MFFD7ST11 OS:NW7%O6=MFFD7ST11)WIN(W1=AAAA%W2=AAAA%W3=AAAA%W4=AAAA%W5=AAAA%W6=AAAA)ECN OS:(R=Y%DF=Y%T=80%W=AAAA%O=MFFD7NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F= OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=80%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5( OS:R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=Z% OS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N OS:%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=80%C OS:D=S) Network Distance: 0 hops OS detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.52 seconds</code> </pre> </div></div><br><p>  Estas configuraciones deben escribirse en <code>/etc/sysctl.conf</code> , luego, en cada reinicio, se leer√°n autom√°ticamente. </p><br><div class="spoiler">  <b class="spoiler_title">/Etc/sysctl.conf completo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">################################################################### # Additional settings - these settings can improve the network # security of the host and prevent against some network attacks # including spoofing attacks and man in the middle attacks through # redirection. Some network environments, however, require that these # settings are disabled so review and enable them as needed. # # Do not accept ICMP redirects (prevent MITM attacks) net.ipv4.conf.default.accept_redirects = 0 net.ipv6.conf.default.accept_redirects = 0 net.ipv4.conf.all.accept_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 # _or_ # Accept ICMP redirects only for gateways listed in our default # gateway list (enabled by default) # net.ipv4.conf.all.secure_redirects = 1 # # Do not send ICMP redirects (we are not a router) net.ipv4.conf.all.send_redirects = 0 # # Do not accept IP source route packets (we are not a router) net.ipv4.conf.all.accept_source_route = 0 net.ipv6.conf.all.accept_source_route = 0 ## protect against tcp time-wait assassination hazards ## drop RST packets for sockets in the time-wait state ## (not widely supported outside of linux, but conforms to RFC) net.ipv4.tcp_rfc1337 = 1 # # Log Martian Packets #net.ipv4.conf.all.log_martians = 1 # ################################################################### # Magic system request Key # 0=disable, 1=enable all # Debian kernels have this set to 0 (disable the key) # See https://www.kernel.org/doc/Documentation/sysrq.txt # for what other values do #kernel.sysrq=1 ################################################################### # Protected links # # Protects against creating or following links under certain conditions # Debian kernels have both set to 1 (restricted) # See https://www.kernel.org/doc/Documentation/sysctl/fs.txt #fs.protected_hardlinks=0 #fs.protected_symlinks=0 vm.overcommit_memory = 1 vm.swappiness = 10 ################################################################### # Anti-fingerprinting. # # Def: 64. net.ipv4.ip_default_ttl = 128 #   ICMP  (  1000) net.ipv4.icmp_ratelimit = 900 #    ,     . # Def: 5. net.ipv4.tcp_synack_retries = 7 # Def: 5. net.ipv4.tcp_syn_retries = 7 #   TCP window  timespamp    1323. net.ipv4.tcp_window_scaling = 1 net.ipv4.tcp_timestamps = 1 # Redis requirement. net.core.somaxconn = 511</code> </pre> </div></div><br><p>  La protecci√≥n contra la definici√≥n de versiones de servicio es m√°s √∫til, para lo cual un atacante tambi√©n puede usar Nmap: </p><br><pre> <code class="plaintext hljs"># nmap -sV -sR --allports --version-trace 127.0.0.1</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">El resultado no es muy bueno para el sistema.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Not shown: 991 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u3 (protocol 2.0) 25/tcp open smtp Postfix smtpd 80/tcp open http nginx 1.13.12 111/tcp open rpcbind 2-4 (RPC #100000) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 443/tcp open ssl/http nginx 1.13.12 445/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 3493/tcp open nut Network UPS Tools upsd 8000/tcp open http Icecast streaming media server 2.4.2 Service Info: Hosts: nas.localdomain, NAS; OS: Linux; CPE: cpe:/o:linux:linux_kernel Final times for host: srtt: 22 rttvar: 1 to: 100000</code> </pre> </div></div><br><p>  Pero con el disfraz de los servicios, no todo es sencillo: </p><br><ul><li>  Para cada servicio, se necesita un enfoque individual aqu√≠. </li><li>  La capacidad de eliminar la versi√≥n no siempre est√° disponible. </li></ul><br><p>  Por ejemplo, para SSH es posible agregar la opci√≥n <code>DebianBanner no</code> a <code>/etc/ssh/sshd_confg</code> . </p><br><p>  Como resultado: </p><br><pre> <code class="plaintext hljs">22/tcp open ssh OpenSSH 7.4p1 (protocol 2.0)</code> </pre> <br><p>  Mejor, por desgracia, no funcionar√°: SSH usa la versi√≥n para establecer qu√© caracter√≠sticas son compatibles, y es posible cambiarla solo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parcheando el servidor</a> . </p><br><h3 id="port-knocking">  Golpe de puerto </h3><br><p>  No es la t√©cnica de seguridad m√°s conocida, ya que permite que un usuario remoto que conoce el secreto se conecte a un puerto cerrado. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El trabajo se asemeja a un bloqueo de c√≥digo</a> : todos saben que los demonios de servicio est√°n trabajando en el servidor, pero "no est√°n all√≠" hasta que se marca el c√≥digo. <br>  Por ejemplo, para conectarse a un servidor SSH, un usuario debe activar los puertos UDP 7000, TCP 7007 y UDP 7777. <br>  Despu√©s de eso, con su IP, el firewall se iniciar√° en un puerto TCP <strong>cerrado</strong> 22. </p><br><p>  Puede leer m√°s sobre c√≥mo funciona esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el manual de Debian</a> . </p><br><p>  No recomiendo usar, como  fail2ban suele ser suficiente. </p><br><h3 id="fayrvoll">  Cortafuegos </h3><br><p>  Configuro el cortafuegos a trav√©s de la GUI web OpenMediaVault, que te recomiendo. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/cv/a9/eo/cva9eoxcbu4h8ut8cwrwczkjop8.png"></a> </p><br><p>  Abra los puertos necesarios, como 443 y 22, el resto al gusto.  Tambi√©n es aconsejable habilitar el registro de paquetes descartados. </p><br><h3 id="ssh">  Ssh </h3><br><div class="spoiler">  <b class="spoiler_title">Si SSH se bloquea en el puerto 22, que est√° abierto a Internet, recibir√° muchos mensajes interesantes ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># grep "invalid user" /var/log/auth.log|head Aug 26 00:07:57 nas sshd[29786]: input_userauth_request: invalid user test [preauth] Aug 26 00:07:59 nas sshd[29786]: Failed password for invalid user test from 185.143.160.137 port 51268 ssh2 Aug 26 00:11:01 nas sshd[5641]: input_userauth_request: invalid user 0 [preauth] Aug 26 00:11:01 nas sshd[5641]: Failed none for invalid user 0 from 5.188.10.180 port 49025 ssh2 Aug 26 00:11:04 nas sshd[5644]: input_userauth_request: invalid user 0101 [preauth] Aug 26 00:11:06 nas sshd[5644]: Failed password for invalid user 0101 from 5.188.10.180 port 59867 ssh2 Aug 26 00:32:55 nas sshd[20367]: input_userauth_request: invalid user ftp [preauth] Aug 26 00:32:56 nas sshd[20367]: Failed password for invalid user ftp from 5.188.10.144 port 47981 ssh2 Aug 26 00:32:57 nas sshd[20495]: input_userauth_request: invalid user guest [preauth] Aug 26 00:32:59 nas sshd[20495]: Failed password for invalid user guest from 5.188.10.144 port 34202 ssh2</code> </pre> </div></div><br><p>  A riesgo de parecer trivial, todav√≠a recuerdo que es obligatorio: </p><br><ul><li>  Prohibir estrictamente el inicio de sesi√≥n ra√≠z. </li><li>  Limite el inicio de sesi√≥n solo a los usuarios especificados. </li><li>  Cambiar el puerto a no est√°ndar. </li><li>  Es recomendable deshabilitar la autenticaci√≥n de contrase√±a, dejando solo la clave. </li></ul><br><p>  Leer m√°s es posible, por ejemplo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><p>  Todo esto se hace f√°cilmente desde la interfaz OpenMediaVault a trav√©s del men√∫ "Servicios -&gt; SSH". <br>  Excepto que no cambi√© el puerto a no est√°ndar, dejando 22 en la red local y simplemente reemplazando el puerto en el enrutador NAT. </p><br><div class="spoiler">  <b class="spoiler_title">Aqu√≠ hay una lista interesante de cuentas que intent√© compilar, hasta que cambi√© el puerto SSHD a uno diferente del 22.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># grep "invalid user" /var/log/auth.log|sed 's/.*invalid user \([^ ]*\) .*/\1/'|sort|uniq 0 0101 1234 22 admin ADMIN administrateur administrator admins alfred amanda amber Anonymous apache avahi backup@network bcnas benjamin bin cacti callcenter camera cang castis charlotte clamav client cristina cron CSG cvsuser cyrus david db2inst1 debian debug default denis elvira erik fabio fax ftp ftpuser gary gast GEN2 guest I2b2workdata2 incoming jboss john juan matilda max mia miner muhammad mysql nagios nginx noc office oliver operator oracle osmc pavel pi pmd postgres PROCAL prueba RSCS sales sales1 scaner selena student07 sunos support sybase sysadmin teamspeak telecomadmin test test1 test2 test3 test7 tirocu token tomcat tplink ubnt ubuntu user1 vagrant victor volition www-data xghwzp xxx zabbix zimbra</code> </pre> </div></div><br><p>  Una vez hecho esto, los intentos de inicio de sesi√≥n no autorizados se realizar√°n con mucha menos frecuencia. </p><br><p>  Para mejorar a√∫n m√°s la situaci√≥n, es posible bloquear a los atacantes de ciertas IP despu√©s de varios intentos de inicio de sesi√≥n. </p><br><p>  Para qu√© se puede utilizar: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fail2ban</a> .  Una utilidad popular que funciona no solo para SSH, sino tambi√©n para muchas otras aplicaciones. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Denyhosts</a>  Parece que fail2ban. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sshguard</a> , si lo desea, puede intentar usarlo, pero no me interes√≥ en detalle. </li></ul><br><p>  Estoy usando fail2ban.  Supervisar√° los registros en busca de varias acciones indeseables por parte de ciertas IP, y las prohibir√° si se excede el n√∫mero de respuestas: </p><br><div class="spoiler">  <b class="spoiler_title">/var/log/fail2ban.log.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">2018-08-29 21:17:25,351 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.144 2018-08-29 21:17:25,473 fail2ban.actions [8650]: NOTICE [sshd] Ban 5.188.10.144 2018-08-29 21:17:27,359 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.144 2018-08-29 21:28:13,128 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:13,132 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:15,137 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:20,145 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:25,153 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:25,421 fail2ban.actions [8650]: NOTICE [sshd] Ban 5.188.10.176 2018-08-29 21:30:05,272 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:05,274 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:13,285 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:13,286 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:15,289 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:15,803 fail2ban.actions [8650]: NOTICE [sshd] Ban 5.188.10.180</code> </pre> </div></div><br><p>  Se proh√≠be agregar una regla de firewall.  Despu√©s de un tiempo especificado, la regla se elimina y el usuario puede volver a intentar iniciar sesi√≥n. </p><br><p>  Inicialmente, solo SSH est√° activado, pero es posible habilitar el control de los registros del servidor web y otros servicios, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">al menos el mismo OMV</a> . <br>  Y tambi√©n, saque los registros de los contenedores y establezca fail2ban en ellos tambi√©n. </p><br><p>  Recomiendo agregar servicios al gusto. <br>  Puede leer m√°s sobre la configuraci√≥n, por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> o en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wiki nativo</a> . </p><br><h2 id="logi">  Registros </h2><br><h3 id="lwatchhttpspackagesdebianorgstretchadminlwatch">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lwatch</a> </h3><br><p>  Una peque√±a utilidad que debe instalarse para mayor comodidad.  Destacar√° los registros y los mostrar√° en una forma hermosa. <br>  Es posible utilizar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cualquier utilidad de este tipo</a> , lo principal es que los errores y las √°reas problem√°ticas de los registros se resaltan para facilitar su an√°lisis visual. </p><br><h3 id="logcheckhttplogcheckorg">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Logcheck</a> </h3><br><p>  Vale la pena instalar y configurar logcheck simplemente para que cuando identifique problemas de configuraci√≥n que se informan en los registros, lo vea inmediatamente en el correo. <br>  Ayuda mucho ver lo que va mal, aunque requiere ajuste. </p><br><p>  Instalaci√≥n: </p><br><pre> <code class="plaintext hljs"># apt-get install logcheck</code> </pre> <br><p>  Inmediatamente despu√©s de la instalaci√≥n, enviar√° informes. </p><br><div class="spoiler">  <b class="spoiler_title">Informe de ejemplo.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">System Events =-=-=-=-=-=-= Oct 2 02:02:15 nas kernel: [793847.981226] [DROPPED] IN=br-ce OUT= PHYSIN=veth6c2a68e MAC=ff:ff:ff:ff:ff:ff: SRC=172.22.0.11 DST=255.255.255.255 LEN=29 TOS=0x00 PREC=0x00 TTL=64 ID=40170 DF PROTO=UDP SPT=35623 DPT=35622 LEN=9 Oct 2 02:02:20 nas hddtemp[13791]: /dev/sdh: Micron_1100 N #020–Ç: 32 C Oct 2 02:02:37 nas kernel: [793869.247128] [DROPPED] IN=br-7ba OUT= MAC= SRC=172.31.0.1 DST=172.31.255.255 LEN=239 TOS=0x00 PREC=0x00 TTL=128 ID=23017 DF PROTO=UDP SPT=138 DPT=138 LEN=219 Oct 2 02:02:37 nas kernel: [793869.247174] [DROPPED] IN=br-7ba OUT= MAC= SRC=172.31.0.1 DST=172.31.255.255 LEN=232 TOS=0x00 PREC=0x00 TTL=128 ID=23018 DF PROTO=UDP SPT=138 DPT=138 LEN=212 Oct 2 02:02:37 nas kernel: [793869.247195] [DROPPED] IN=br-673 OUT= MAC= SRC=192.168.224.1 DST=192.168.239.255 LEN=239 TOS=0x00 PREC=0x00 TTL=128 ID=8959 DF PROTO=UDP SPT=138 DPT=138 LEN=219 Oct 2 02:02:37 nas kernel: [793869.247203] [DROPPED] IN=br-673 OUT= MAC= SRC=192.168.224.1 DST=192.168.239.255 LEN=232 TOS=0x00 PREC=0x00 TTL=128 ID=8960 DF PROTO=UDP SPT=138 DPT=138 LEN=212 Oct 2 02:02:50 nas hddtemp[13791]: /dev/sdh: Micron_1100 N #020–Ç: 32 C</code> </pre> </div></div><br><p>  Se puede ver que hay muchas cosas superfluas, y una mayor afinaci√≥n se reducir√° al filtrado. </p><br><p>  Primero, apague hddtemp, que no funciona correctamente debido a caracteres no ASCII en el nombre de SSD. <br>  Despu√©s de arreglar el archivo hddtemp, los mensajes dejaron de llegar: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/hddtemp</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :0-9]{11} [._[:alnum:]-]+ hddtemp\[[0-9]+\]: /dev/([hs]d[az]|sg[0-9]):.*[0-9]+.*[CF] ^\w{3} [ :0-9]{11} [._[:alnum:]-]+ hddtemp\[[0-9]+\]: /dev/([hs]d[az]|sg[0-9]):.*drive is sleeping</code> </pre> </div></div><br><p>  Entonces, es posible ver lo que dice logcheck est√° bloqueando el tr√°fico de transmisi√≥n por el firewall: </p><br><pre> <code class="plaintext hljs">[793869.247128] [DROPPED] IN=br-7ba OUT= MAC= SRC=172.31.0.1 DST=172.31.255.255 LEN=239 TOS=0x00 PREC=0x00 TTL=128 ID=23017 DF PROTO=UDP SPT=138 DPT=138 LEN=219</code> </pre> <br><p>  Por lo tanto, debe habilitar el tr√°fico de difusi√≥n desde el enrutador y los contenedores: </p><br><ul><li>  Puerto 35622 desde el contenedor con urbackup. </li><li>  El puerto 5678 del enrutador es el descubrimiento de vecino RouterOS.  Se puede deshabilitar en el enrutador. </li><li>  El puerto 5353 para abordar 224.0.0.251 es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mDNS</a> . </li></ul><br><p>  Comprobar logcheck: </p><br><pre> <code class="plaintext hljs">sudo -u logcheck logcheck -t -d</code> </pre> <br><p>  Finalmente, los problemas se hacen visibles: </p><br><pre> <code class="plaintext hljs">Oct 21 21:58:18 nas systemd[1]: Removed slice User Slice of user. Oct 21 21:58:31 nas systemd[1]: smbd.service: Unit cannot be reloaded because it is inactive. Oct 21 21:58:31 nas root: /etc/dhcp/dhclient-enter-hooks.d/samba returned non-zero exit status 1</code> </pre> <br><p>  Resulta que SAMBA no se inicia.  De hecho, el an√°lisis mostr√≥ que lo disfraz√© a trav√©s de systemctl, y OMV estaba tratando de iniciarlo. </p><br><p>  Logcheck seguir√° siendo spam con varios mensajes. <br>  Aqu√≠, por ejemplo, se pas√≥ zfs-auto-snapshot: </p><br><pre> <code class="plaintext hljs">Oct 21 22:00:57 nas zfs-auto-snap: @zfs-auto-snap_frequent-2018-10-21-1900, 16 created, 16 destroyed, 0 warnings.</code> </pre> <br><p>  Para ignorar: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/zfs-auto-snapshot</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :0-9]{11} [._[:alnum:]-]+ zfs-auto-snap: \@zfs-auto-snap_[[:alnum:]-]+, [0-9]+ created, [0-9]+ destroyed, 0 warnings.$</code> </pre> </div></div><br><p>  rrdcached tambi√©n est√° en ignorar: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/rrdcached</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: flushing old values$ ^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: rotating journals$ ^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: started new journal [./[:alnum:]]+$ ^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: removing old journal [./[:alnum:]]+$</code> </pre> </div></div><br><p>  Adem√°s, es aconsejable eliminar zed si a√∫n no se elimina: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/zed</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :0-9]{11} [._[:alnum:]-]+ (/usr/bin/)?zed: .*$ ^\w{3} [ :0-9]{11} [._[:alnum:]-]+ (/usr/bin/)?zed\[[0-9]+\]: .*$</code> </pre> </div></div><br><p>  Bueno y as√≠ sucesivamente.  Mucha gente piensa que logcheck es una utilidad bastante in√∫til. <br>  Esto es cierto si lo usa como algo que configura y olvida. </p><br><p>  Sin embargo, si comprende que logcheck es solo un filtro de registro personalizado, sin algoritmos heur√≠sticos, m√°gicos y adaptativos, no surge la cuesti√≥n de su necesidad.  Iterativamente, analizando lo que env√≠a y, ya sea agreg√°ndolo para ignorarlo o corrigi√©ndolo, es gradualmente posible obtener informes informativos. </p><br><p>  Usar una herramienta automatizada para el an√°lisis es mucho mejor que ejecutar los registros a trav√©s de las mismas expresiones regulares con las manos, y a menudo es mejor que usar un sistema completo de an√°lisis de datos como Splunk. </p><br><p>  Logcheck y su configuraci√≥n se pueden leer en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wiki Gentoo</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><h2 id="ids-urovnya-uzla">  IDS de nivel de nodo </h2><br><p>  Aqu√≠ me referir√© a mi propio art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Un breve an√°lisis de soluciones en el campo de SOC y el desarrollo de un detector de anomal√≠as de redes neuronales en redes de transmisi√≥n de datos"</a> , en el que hay varios ejemplos. </p><br><p>  Puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">leer una</a> revisi√≥n m√°s completa y una comparaci√≥n de IDS similares <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en la Wiki</a> . </p><br><h3 id="stig-4httpswwwstigviewercomstigred_hat_enterprise_linux_6">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">STIG-4</a> </h3><br><p>  Un script complejo y grande para el an√°lisis est√°tico de brechas conocidas de RedHat. <br>  Existe su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puerto en Debian</a> , que recomiendo descargar y ejecutar al menos una vez. </p><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de operaci√≥n STIG-4</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># cd root@nas:~# git clone https://github.com/hardenedlinux/STIG-4-Debian Cloning into 'STIG-4-Debian'... remote: Enumerating objects: 572, done. remote: Total 572 (delta 0), reused 0 (delta 0), pack-reused 572 Receiving objects: 100% (572/572), 634.37 KiB | 0 bytes/s, done. Resolving deltas: 100% (316/316), done. root@nas:~# cd STIG-4-Debian/ root@nas:~/STIG-4-Debian# bash stig-4-debian.sh -H Script Run: Mon Nov 12 23:58:34 MSK 2018 Start checking process... [ FAIL ] The cryptographic hash of system files and commands must match vendor values. ... Pass Count: 54 Failed Count: 137</code> </pre> </div></div><br><p>  El proceso de trabajar con este script es aproximadamente el siguiente: </p><br><ul><li>  Deshazte del gui√≥n. </li><li>  Busque en Internet todas las l√≠neas con <code>[ FAIL ]</code> . </li><li>  Como regla general, se encontrar√° un enlace a la base de datos en l√≠nea de STIG. </li><li>  Correcto, siguiendo las instrucciones en la base de datos, haciendo un descuento en el hecho de que es Debian. </li><li>  Ejecute el script nuevamente. </li></ul><br><h3 id="rkhunterhttprkhuntersourceforgenet">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Rkhunter</a> </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Se ha</a> escrito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">demasiado</a> sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RkHunter</a> . <br>  Usado durante mucho tiempo, ampliamente, a√∫n en desarrollo.  Hay un repositorio de Debian. </p><br><h3 id="tigerhttpswwwnongnuorgtiger">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tigre</a> </h3><br><p>  Un script de shell modular que realiza la auditor√≠a del sistema y la detecci√≥n de intrusos. <br>  Es algo similar a STIG-4. <br>  Puede utilizar utilidades de terceros para analizar registros y detectar infracciones de suma de verificaci√≥n. </p><br><p>  Consiste en una gran cantidad de m√≥dulos diferentes. </p><br><p>  Por ejemplo, hay un m√≥dulo que detecta servicios que usan archivos eliminados, lo que sucede cuando las bibliotecas utilizadas por el servicio se cambiaron durante el proceso de actualizaci√≥n del sistema, pero el servicio no se reinici√≥ por alguna raz√≥n. </p><br><p>  Hay m√≥dulos para buscar usuarios de servicios que ya no se usan, verificar el sistema por falta de parches de seguridad, verificar umask, etc. </p><br><p>  M√°s detalles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el hombre</a> . </p><br><p>  No se ha desarrollado durante 10 a√±os (s√≠, no soy el √∫nico en abandonar el software). </p><br><h3 id="samhainhttpswwwla-samhnadesamhain">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Samhain</a> </h3><br><p>  HIDS t√≠picos que pueden: </p><br><ul><li>  Verifique la integridad de todo el sistema mediante hashes criptogr√°ficos. </li><li>  Busque varios ejecutables con el SUID instalado, que no debe instalarse. </li><li>  Detectar procesos ocultos. </li><li>  Firmar registros y bases de datos. </li></ul><br><p>  Adem√°s, tiene monitoreo centralizado con una interfaz web y env√≠o centralizado de registros al servidor. <br>       ,        . <br>       . </p><br><p> ,  ,           . ,  ,    ,    ,         . </p><br><p> -     HIDS:        . <br>     Samhain,      . </p><br><h3 id="tripwirehttpssourceforgenetprojectstripwire"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tripwire</a> </h3><br><p>   ,   Samhain,  Tripwire ‚Äî    . <br>    ,   . </p><br><h3 id="lynishttpscisofycomlynis"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lynis</a> </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  RkHunter</a> . </p><br><p>  ,    . <br>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>     . <br>   Tiger       ,     ,  . <br>   ,  .    ,       , Lynix    Tripwire. </p><br><h3 id="chkrootkithttpwwwchkrootkitorg"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Chkrootkit</a> </h3><br><p>     .    . <br> : </p><br><ul><li>   ,  . </li><li>       . </li><li> ,     latslog, wtmp  utmp. </li><li>     ,   ,     . </li></ul><br><p>      . </p><br><h3 id="ninjahttpforkbomborgninja"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ninja</a> </h3><br><p>        Linux. </p><br><p>      ninja-build. </p><br><p> ,      .      UID/GID, Ninja      ,         ,    (,     , ). <br>          (, su). <br>   ,     . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  Ubuntu</a> ,     Debian. </p><br><h2 id="skanery-bezopasnosti">   </h2><br><p>       .   .    ,    ,    ,   . <br>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nmap</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">W3af</a>  Web-. </p><br><h2 id="sistemy-alternativnyh-modeley-bezopasnosti">     </h2><br><p>  Linux  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> (  )  </a> . <br>      .  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . </p><br><p>   ,  ,   ,    . </p><br><p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  " Linux"  IBM</a> . </p><br><p>  NAS        ,    AppArmor. <br>  ,       ,     . <br> ,          ,          ,         . </p><br><h3 id="access-control-listshttpsdocsoraclecomcde19253-01820-0836ftyxiindexhtml"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Access Control Lists</a> </h3><br><p>     ,     . <br>  , ZFS       . </p><br><div class="spoiler"> <b class="spoiler_title">   ACL  ZFS.</b> <div class="spoiler_text"><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiso para agregar un nuevo archivo al directorio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiso para crear un subdirectorio en un directorio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiso para eliminar un archivo. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiso para eliminar un archivo o directorio dentro de un directorio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiso para ejecutar un archivo o buscar el contenido de un directorio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiso para enumerar los contenidos del directorio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiso para leer ACL (comando ls). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiso para leer los atributos b√°sicos del archivo (que no sean ACL, atributos en el nivel de comando "stat"). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiso para leer el contenido del archivo. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiso para leer atributos de archivos extendidos o buscar en el directorio atributos de archivos extendidos. </font></font></li><li>           . </li><li>       . </li><li>      ,     ,   . </li><li>       ACL    chmod. </li><li>        .        chown  chgrp . </li><li>           ,     .               PRIV_FILE_CHOWN. </li><li>      ACL   . </li><li>   ACL      . </li><li>   ACL   ,         ,     .     ACL    file_inherit,  dir_inherit   . </li><li>   ACL       ,      . </li></ul></div></div><br><p>  ACL    , ,     ,   .         . </p><br><p>    EXT ,  ZFS  ACL      <code>setfacl/getfacl</code> ,    <code>chmod</code>  <code>ls</code> . </p><br><h3 id="apparmorhttpsgitlabcomapparmorapparmorwikishome"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AppArmor</a> </h3><br><p><img src="https://habrastorage.org/webt/p2/yt/br/p2ytbr0l4cq_ujt9sh_njrh1t7k.jpeg"></p><br><p>         . </p><br><p> ,         ,     <code>exec</code> ,  ,      <code>open</code> , <code>exec</code>  . <br>      ,     . <br> AppArmor ,       . <br>  ,      . <br>     capabilites. </p><br><p>     ,    .       ,   ,      ,   . </p><br><div class="spoiler"> <b class="spoiler_title">     ping.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#include &lt;tunables/global&gt; profile ping /{usr/,}bin/ping flags=(complain) { #include &lt;abstractions/base&gt; #include &lt;abstractions/consoles&gt; #include &lt;abstractions/nameservice&gt; capability net_raw, capability setuid, network inet raw, network inet6 raw, /{,usr/}bin/ping mixr, /etc/modules.conf r, # Site-specific additions and overrides. See local/README for details. #include &lt;local/bin.ping&gt; }</code> </pre> </div></div><br><p> ,       , ..     . ,  ,           ( <code>local/bin.ping</code> ),    ,     . </p><br><p>     deb-based . <br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  firejail</a> ,    . </p><br><p>      ,   ,      . </p><br><p>    Debian, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> . </p><br><h3 id="selinuxhttpselinuxprojectorgpagemain_page"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SELinux</a> </h3><br><p> <a href=""><img src="https://habrastorage.org/webt/uk/8e/_4/uk8e_4yzmie_mnhkeak2sxxztem.png" alt="Arquitectura SELinux"></a> </p><br><p>    . <br>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NSA</a> ,      Debian   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> . </p><br><p>   SELinux   " " (type enforcement). </p><br><p>  , , ,      SELinux .      "". </p><br><p> ,    ,   <code>firefox_t</code> . <br> SELinux         ,     . </p><br><p>  Un ejemplo: </p><br><pre> <code class="plaintext hljs">allow firefox_t user_home_t : file { read write };</code> </pre> <br><p>     , ,  <code>firefox_t</code>         , ,  <code>user_home_t</code> . </p><br><p>  Un ejemplo: </p><br><pre> <code class="plaintext hljs">allow user_t user_home_t:file { create read write unlink };</code> </pre> <br><p>    <code>user_t</code>  , ,       <code>user_home_t</code> .  <code>user_t</code> ,  ,  . </p><br><p> ,      . </p><br><p>     AppArmor -,  ,   ,        . </p><br><div class="spoiler"> <b class="spoiler_title">     SELinux   .</b> <div class="spoiler_text"><ul><li> <strong></strong>  SELinux     Linux.     su  sudo,  SELinux  .   Linux    SELinux ,     1:1,     root. </li><li> <strong></strong> ,   ,   .  " ", "Web-", " ".     ,     <code>object_r</code> . <br>      ,  . </li><li> <strong></strong>  <strong></strong>      .  ‚Äî    ,  . </li><li> <strong></strong>  <strong></strong>     .  ,   ,        . ,     <code>user_u:user_r:user_t</code> ,        <code>user_u:object_r:user_home_t</code> .     : </li></ul><br><pre> <code class="plaintext hljs">user:role:type:range</code> </pre> <br><p>   ‚Äî SELinux user.    ‚Äî   , .  ‚Äî   MLS . </p><br><p> ,     ,  ,  <code>user_home_t.</code> <code>user_home_t</code> ‚Äî  ,         ,     . </p><br><ul><li> <strong> </strong>  <strong> </strong> ,   <code>dir</code>    <code>file</code>     ,    ,    .      ,     . , <code>file</code>     (create),  (read),  (write)   (unlink),   <code>unix_stream_socket object</code> ( UNIX)     (create),   (connect),    (sendto). </li></ul></div></div><br><p>     ,        . <br>     . ,    (,     ),    . </p><br><p> ,   AppArmor,  permissive ,       ,    . <br>       . <br>   ,       ,    AppArmor       . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   SELinux</a>   . <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> . <br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  IBM</a> . </p><br><h3 id="grsecurityhttpswwwgrsecuritynet"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GrSecurity</a> </h3><br><p>    Debian -  .  ,    ,   . <br> ,   (     ), ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> Gentoo</a> .     : hardening <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> . </p><br><p> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   </a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  Debian</a>  ,    GrSecurity  PaX. </p><br><h3 id="tomoyohttptomoyoosdnjp"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tomoyo</a> </h3><br><p> Tomoyo  Debian   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> . </p><br><p>        .   AppArmor,   .   2003 . <br>   ,    ,  . <br>    ,    AppArmor,     . </p><br><h2 id="melochi">  </h2><br><p>        <code>/etc/securetty</code>  ,  root       ( ),        . </p><br><p>       PAM,       <code>/etc/security</code> . </p><br><p>    ,  Samhain  Tripwire,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">debsums</a> ,      . </p><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>    .     ,      . </p><br><p>  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> Github </a> ,   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421279/">https://habr.com/ru/post/es421279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421267/index.html">Enfriamiento de fuente de alimentaci√≥n de computadora semi pasiva</a></li>
<li><a href="../es421269/index.html">El sistema de reconocimiento facial instalado en el aeropuerto estadounidense ayud√≥ a atrapar al atacante</a></li>
<li><a href="../es421271/index.html">Una selecci√≥n de materiales √∫tiles en Azure. Parte 2 - cursos</a></li>
<li><a href="../es421275/index.html">Lo que entend√≠ despu√©s de vender dos startups en 12 meses</a></li>
<li><a href="../es421277/index.html">Segmentaci√≥n de im√°genes satelitales usando el reconocimiento de √°rboles como ejemplo</a></li>
<li><a href="../es421281/index.html">Respuestas de soporte t√©cnico de 3CX: instalaci√≥n de su propio logotipo en la pantalla del tel√©fono IP</a></li>
<li><a href="../es421283/index.html">El libro sobre "P√°rrafo" sobre Habr√©. Cap√≠tulo uno: El cient√≠fico vigilante</a></li>
<li><a href="../es421285/index.html">Rastreadores √≥pticos: ASEF y MOSSE</a></li>
<li><a href="../es421287/index.html">Ladrillos lunares de un horno solar</a></li>
<li><a href="../es421289/index.html">El n√∫mero de autom√≥viles el√©ctricos en Rusia aument√≥ de 920 a 2500 en un a√±o y medio.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>