<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛃 🙌🏻 🚵🏼 Menggunakan bootloader yang ditandatangani untuk memintas perlindungan Boot Aman UEFI 🛋️ 🌖 🙌🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Versi Rusia dari artikel ini. 
 Pendahuluan  Firmware motherboard komputer modern berfungsi sesuai dengan spesifikasi UEFI , dan sejak 2013 mereka men...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menggunakan bootloader yang ditandatangani untuk memintas perlindungan Boot Aman UEFI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446072/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Versi Rusia dari artikel ini.</a> <br><h2>  Pendahuluan </h2>  Firmware motherboard komputer modern berfungsi sesuai dengan spesifikasi <abbr title="Unified Extensible Firmware Interface, Penggantian BIOS">UEFI</abbr> , dan sejak 2013 mereka mendukung teknologi otentikasi program yang diunduh dan driver Secure Boot, yang dirancang untuk melindungi komputer dari <abbr title="Bootloader berbahaya yang memodifikasi bootloader sesungguhnya dari OS, menginfeksi file sistem sebelum OS melakukan boot.">bootkit</abbr> .  Boot Aman memblokir eksekusi kode program yang tidak ditandatangani atau tidak dipercaya: .efi-file program dan boot loader dari sistem operasi, firmware dari peralatan tambahan (kartu video OPROM, adaptor jaringan). <br>  Boot Aman dapat dinonaktifkan pada motherboard toko mana pun, tetapi persyaratan fisik untuk mengubah pengaturannya adalah keberadaan fisik di komputer.  Anda harus masuk ke pengaturan UEFI saat komputer dinyalakan, dan hanya dengan demikian dimungkinkan untuk menonaktifkan teknologi atau mengubah pengaturannya. <br><br>  Sebagian besar motherboard hanya memiliki kunci Microsoft yang tepercaya, itulah sebabnya pencipta perangkat lunak boot terpaksa menghubungi Microsoft untuk tanda tangan bootloader, menjalani prosedur audit, dan membenarkan perlunya tanda tangan global dari file mereka jika mereka menginginkan drive atau flash drive untuk berjalan secara tidak perlu. nonaktifkan Boot Aman atau tambahkan kunci mereka secara manual di setiap komputer. <br>  Microsoft harus menandatangani pengunduh untuk pengembang distribusi Linux, hypervisor, disk boot antivirus, dan program pemulihan komputer. <br><br>  Saya ingin membuat flash drive USB yang dapat di-boot dengan berbagai perangkat lunak pemulihan komputer yang akan melakukan booting tanpa menonaktifkan Boot Aman.  Mari kita lihat bagaimana ini bisa diterapkan. <a name="habracut"></a><br><br><h2>  Pengunduh Bootloader yang Ditandatangani </h2>  Jadi, untuk mem-boot Linux dengan Boot Aman diaktifkan, Anda memerlukan bootloader yang telah ditandatangani.  Microsoft telah melarang penandatanganan perangkat lunak yang dilisensikan di bawah GPLv3 karena larangan <abbr title="Praktek menciptakan perangkat keras dan sistem perangkat lunak yang perangkat lunaknya memiliki lisensi copyleft, tetapi perangkat keras tidak memungkinkan untuk menjalankan versi perangkat lunak yang dimodifikasi (misalnya, dengan tanda tangan digital). Nama itu berasal dari kotak set-top TiVo yang menggunakan praktik ini.">tivoisasi oleh</abbr> aturan lisensi, sehingga <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GRUB tidak akan dapat menandatangani</a> . <br>  Sebagai tanggapan, Linux Foundation merilis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PreLoader</a> , dan Matthew Garrett menulis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">shim</a> , bootloader kecil yang memverifikasi tanda tangan atau hash dari unduhan berikutnya.  PreLoader dan shim tidak menggunakan sertifikat <abbr title="Toko sertifikat tepercaya di motherboard">UEFI db</abbr> , tetapi berisi basis data hash yang diizinkan (PreLoader) atau sertifikat (shim) di dalamnya. <br>  Kedua program, selain mengunduh file tepercaya secara otomatis, memungkinkan Anda untuk mengunduh file yang sebelumnya tidak dipercaya dalam mode Boot Aman, tetapi memerlukan kehadiran fisik pengguna: pada permulaan pertama, Anda perlu memilih sertifikat tambahan atau file hash dalam antarmuka grafis, setelah itu data dimasukkan ke dalam variabel NVRAM khusus motherboard yang tidak tersedia untuk diubah dari sistem operasi yang dimuat.  File menjadi tepercaya hanya untuk prapemuat ini, dan tidak untuk Boot Aman secara umum, dan Anda tidak dapat menjalankannya tanpa PreLoader / shim. <br><br><img src="https://habrastorage.org/webt/8v/fh/ut/8vfhut0fieoez9092xlirmoxndk.png" alt="Diperlukan tindakan untuk menjalankan program yang tidak terpercaya melalui shim."><br>  <i>Diperlukan tindakan saat memulai program yang tidak terpercaya untuk pertama kali melalui shim.</i> <br><br>  Semua distribusi Linux populer saat ini menggunakan shim, karena dukungan sertifikat, yang membuatnya mudah untuk memperbarui bootloader berikutnya tanpa perlu interaksi pengguna.  Biasanya, shim digunakan untuk menjalankan GRUB2, bootloader paling populer di Linux. <br><br><h2>  GRUB2 </h2>  Untuk mencegah penyerang diam-diam melakukan bisnis dengan bantuan bootloader yang ditandatangani dari beberapa kit distribusi, Red Hat membuat tambalan untuk GRUB2 yang memblokir fungsi "berbahaya" ketika Secure Boot diaktifkan: insmod / rmmod, appleloader, linux (diganti oleh linuxefi), multiboot, xnu, memrw, iorw.  Modul chainloader, yang memuat file .efi sewenang-wenang, dilengkapi dengan loader .efi (PE) sendiri, tanpa menggunakan perintah UEFI LoadImage / StartImage, serta kode validasi file yang diunduh melalui shim, sehingga kemampuan untuk mengunduh file yang dipercaya untuk shim tetapi tidak dipercaya. dalam hal UEFI.  Mengapa mereka melakukan itu tidak jelas;  UEFI memungkinkan Anda untuk mendefinisikan kembali (mengaitkan) fungsi memeriksa gambar yang diunduh, ini adalah cara kerja PreLoader, dan shim sendiri memiliki <a href="">fungsi seperti itu</a> , tetapi dinonaktifkan secara default. <br><br>  Dengan satu atau lain cara, menggunakan GRUB yang ditandatangani dari beberapa distribusi Linux akan gagal.  Ada dua cara untuk membuat flash drive USB universal yang dapat di-boot yang tidak perlu menambahkan kunci dari setiap file yang diunduh ke yang tepercaya: <br><br><ul><li>  Menggunakan GRUB yang dimodifikasi yang mengunduh file EFI sendiri, tanpa memeriksa tanda tangan digital, dan tanpa memblokir modul; </li><li>  Menggunakan preloader Anda sendiri (kedua) menggantikan fungsi verifikasi tanda tangan digital UEFI (EFI_SECURITY_ARCH_PROTOCOL.FileAuthenticationState, EFI_SECURITY2_ARCH_PROTOCOL.FileAuthentication) </li></ul><br>  Opsi kedua lebih disukai - program yang tidak dipercaya yang diunduh juga dapat mengunduh program yang tidak tepercaya (misalnya, Anda dapat mengunduh file melalui UEFI Shell), dan dalam versi pertama, hanya GRUB sendiri yang dapat mengunduh semuanya.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kami memodifikasi PreLoader</a> , menghapus kode tambahan dari itu dan memungkinkan peluncuran file apa pun. <br><br>  Total, arsitektur flash drive adalah sebagai berikut: <br><pre><code class="plaintext hljs">______ ______ ______ ╱│ │ ╱│ │ ╱│ │ /_│ │ → /_│ │ → /_│ │ │ │ → │ │ → │ │ │ EFI │ → │ EFI │ → │ EFI │ │_______│ │_______│ │_______│ BOOTX64.efi grubx64.efi grubx64_real.efi (shim) (FileAuthentication (GRUB2) override) ↓↓↓ ↑ ↑ ______ ↑ ╱│ │ ║ /_│ │ ║ │ │ ═══════════╝ │ EFI │ │_______│ MokManager.efi (Key enrolling tool)</code> </pre> <br><br>  Jadi ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>Super</u> UEFIinSecureBoot Disk</a> . <br><blockquote>  Super UEFIinSecureBoot Disk - gambar disk dengan bootloader GRUB2, yang dirancang untuk menjalankan program dan sistem operasi yang tidak ditandai dalam mode Boot Aman UEFI. <br><br>  Disk dapat digunakan sebagai dasar untuk membuat drive USB dengan utilitas pemulihan komputer, untuk meluncurkan berbagai distribusi langsung Linux dan WinPE, booting dari jaringan, tanpa menonaktifkan Boot Aman dalam pengaturan motherboard, yang dapat dengan mudah digunakan saat melayani komputer atau perusahaan orang lain laptop, misalnya, dengan kata sandi yang diatur untuk mengubah pengaturan UEFI. <br><br>  Gambar tersebut terdiri dari tiga komponen: prapemuat shim dari Fedora (ditandatangani dengan kunci Microsoft yang sudah diinstal pada sebagian besar motherboard dan laptop), preloader Linux Foundation PreLoader yang dimodifikasi (untuk menonaktifkan verifikasi tanda tangan saat memuat file .efi), dan bootloader GRUB2 yang dimodifikasi. <br><br>  Selama boot pertama dari disk di komputer dengan Boot Aman, Anda harus memilih sertifikat melalui menu MokManager (dimulai secara otomatis), setelah itu bootloader akan berfungsi seolah-olah Boot Aman mati: GRUB memuat file .efi atau kernel Linux yang tidak ditandatangani, program EFI yang diunduh dapat menjalankan program dan driver lain dengan tanda tangan yang hilang atau tidak tepercaya. <br><br>  Untuk menunjukkan pengoperasian, gambar berisi Super Grub Disk (skrip untuk mencari dan memuat sistem operasi yang diinstal, bahkan jika bootloadernya rusak), GRUB Live ISO Multiboot (skrip untuk boot LiveCD Linux yang nyaman langsung dari ISO, tanpa membongkar dan memproses awal), One File Linux (kernel dan initrd dalam satu file, untuk pemulihan sistem), dan beberapa utilitas UEFI. <br><br>  Drive ini kompatibel dengan UEFI tanpa Boot Aman, serta komputer lama dengan BIOS. </blockquote><br><br><h2>  Pengunduh yang Ditandatangani </h2>  Saya bertanya-tanya apakah mungkin entah bagaimana menyiasati kebutuhan untuk menambahkan kunci melalui shim pada awal pertama.  Mungkin ada beberapa pengunduh bertanda tangan yang memungkinkan Anda melakukan lebih dari yang diharapkan penulis? <br>  Ternyata - ada loader seperti itu.  Salah satunya digunakan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kaspersky Rescue Disk 18</a> - disk boot dengan perangkat lunak antivirus.  GRUB dari disk memungkinkan Anda memuat modul (perintah insmod), sedangkan modul di GRUB memungkinkan Anda memuat kode yang dapat dieksekusi biasa.  Pra-pemuat disk adalah asli. <br><br>  Tentu saja, hanya karena GRUB dari disk tidak memuat kode yang tidak dipercaya.  Penting untuk memodifikasi modul chainloader sehingga GRUB tidak menggunakan fungsi UEFI LoadImage / StartImage, tetapi secara mandiri memuat file .efi ke dalam memori, melakukan relokasi, menemukan titik masuk dan mengikutinya.  Untungnya, hampir semua kode yang diperlukan ada di repositori <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GRUB dengan dukungan Red Hat Secure Boot</a> , satu-satunya masalah: tidak ada kode penguraian header <abbr title="Portable Executable, format yang digunakan untuk file .exe dan .efi.">PE</abbr> , header mem-parsing dan mengembalikan shim, sebagai respons terhadap panggilan fungsi melalui protokol khusus.  Ini dapat dengan mudah diperbaiki dengan porting kode yang sesuai dari shim atau PreLoader ke GRUB. <br><br>  Jadi ada Disk UEFIinSecureBoot <u>Diam</u> .  Arsitektur disk yang dihasilkan adalah sebagai berikut: <br><pre> <code class="plaintext hljs"> ______ ______ ______ ╱│ │ ╱│ │ ╱│ │ /_│ │ /_│ │ → /_│ │ │ │ │ │ → │ │ │ EFI │ │ EFI │ → │ EFI │ │_______│ │_______│ │_______│ BOOTX64.efi grubx64.efi grubx64_real.efi (Kaspersky (FileAuthentication (GRUB2) Loader) override) ↓↓↓ ↑ ↑ ______ ↑ ╱│ │ ║ /_│ │ ║ │ │ ═══════════╝ │ EFI │ │_______│ fde_ld.efi + custom chain.mod (Kaspersky GRUB2)</code> </pre> <br><br><h2>  Kesimpulan </h2>  Pada artikel ini, kami menemukan bahwa tidak ada cukup bootloader terpercaya yang ditandatangani dengan kunci Microsoft yang mengaktifkan mode Boot Aman. <br>  Dengan menggunakan file Kaspersky Rescue Disk yang telah ditandatangani, kami mencapai unduhan "diam" dari file .efi yang tidak tepercaya dengan Boot Aman yang diaktifkan, tanpa perlu menambahkan sertifikat ke UEFI db atau MOK shim. <br>  File-file ini dapat digunakan baik untuk perbuatan baik (untuk mengunduh dari USB flash drive) dan untuk yang jahat (untuk menginstal bootkit tanpa sepengetahuan pemilik komputer). <br>  Saya berasumsi bahwa sertifikat Kaspersky tidak akan bertahan lama, dan akan ditambahkan ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">daftar global sertifikat UEFI yang dicabut</a> , yang akan diinstal pada komputer yang menjalankan Windows 10 melalui Pembaruan Windows, yang akan mengganggu pemuatan Kaspersky Rescue Disk 18 dan Disk UEFIinSecureBoot yang Diam.  Mari kita lihat seberapa cepat ini akan terjadi. <br><br>  Unduh Super UEFIinSecureBoot Disk: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/ValdikSS/Super-UEFIinSecureBoot-Disk</a> <br>  Unduh Silent UEFIinSecureBoot Disk di jaringan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ZeroNet Git Center</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://127.0.0.1:43110/1KVD7PxZVke1iq4DKb4LNwuiHS4UzEAdAv/</a> <br><br><div class="spoiler">  <b class="spoiler_title">Tentang ZeroNet</b> <div class="spoiler_text">  ZeroNet adalah sistem yang sangat kuat untuk membuat situs web dan layanan dinamis terdistribusi terdesentralisasi.  Saat mengunjungi sumber daya, pengguna mulai mengunduh dan mendistribusikannya, seperti di BitTorrent.  Pada saat yang sama, dimungkinkan untuk membuat sumber daya lengkap: blog dengan komentar, forum, hosting video, situs wiki, obrolan, email, git. <br>  ZeroNet memisahkan konsep kode dan data situs: data pengguna disimpan dalam file .json, dan ketika disinkronkan, mereka diimpor ke dalam basis data sqlite situs dengan skema standar, yang memungkinkan Anda melakukan hal-hal menakjubkan: pencarian teks lokal di semua situs yang pernah dibuka dalam milidetik, otomatis analog RSS waktu nyata untuk semua situs sekaligus. <br>  Otentikasi dan sistem otorisasi standar (mirip dengan OAuth), dukungan untuk bekerja di belakang NAT dan melalui Tor. <br>  ZeroNet sangat cepat, ramah pengguna, memiliki antarmuka modern dan fitur kecil, tetapi sangat nyaman, seperti pergantian global tema siang / malam di situs. <br><br>  Saya menganggap ZeroNet sistem yang sangat diremehkan, dan saya sengaja menerbitkan versi Diam hanya di ZeroNet Git, untuk menarik pengguna baru. </div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id446072/">https://habr.com/ru/post/id446072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446058/index.html">Cara Membangun SDN - Delapan Alat Sumber Terbuka</a></li>
<li><a href="../id446060/index.html">Sintesis mimpi molekul tinggi</a></li>
<li><a href="../id446062/index.html">Quo vadis. Pengembang Melarang di Google Play</a></li>
<li><a href="../id446064/index.html">Pakar: pembaruan perangkat lunak tidak akan membantu perkawinan di peluncur Boeing</a></li>
<li><a href="../id446066/index.html">Kami mengembangkan teori algoritma sebagai proyek sumber terbuka</a></li>
<li><a href="../id446074/index.html">Bagaimana kami memecah perkembangan menjadi beberapa tim (dan melupakan sprint tanpa akhir dan stand-up yang tidak berguna)</a></li>
<li><a href="../id446076/index.html">QlikView. Pemformatan bersyarat "Suka di Excel"</a></li>
<li><a href="../id446078/index.html">"Suara": mendiskusikan podcast tentang teknologi audio</a></li>
<li><a href="../id446080/index.html">Di AS, pengadilan merekomendasikan untuk melarang impor model iPhone tertentu karena melanggar paten Qualcomm Apple</a></li>
<li><a href="../id446082/index.html">Kisah Setengah Lingkaran</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>