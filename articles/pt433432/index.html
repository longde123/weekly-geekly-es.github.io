<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïµüèΩ üë®üèª‚Äçüè≠ üìü Dez coisas que voc√™ pode fazer com o GraalVM üßúüèø ‚úãüèø üìç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do tradutor: GraalVM √© uma tecnologia nova e interessante, mas no Habr√© n√£o existem muitos artigos que possam mostrar exemplos dos recursos do Graal. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dez coisas que voc√™ pode fazer com o GraalVM</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/433432/"><p><img src="https://habrastorage.org/webt/7z/5d/ap/7z5dap05rvptsue50u6ajtsxsmw.png"><br>  <em>Do tradutor: GraalVM √© uma tecnologia nova e interessante, mas no Habr√© n√£o existem muitos artigos que possam mostrar exemplos dos recursos do Graal.</em>  <em>O artigo abaixo n√£o √© apenas uma lista do que o GraalVM pode fazer, mas tamb√©m uma pequena master class semelhante √† que Chris Seaton e Oleg Shelaev realizaram no Oracle CodeOne 2018. Seguindo o autor, exorto voc√™ a tentar fazer exemplos do artigo, realmente interessante</em> </p><br><p>  Existem muitas coisas diferentes no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GraalVM</a> , e se voc√™ j√° ouviu esse nome antes, ou mesmo viu relat√≥rios, ainda h√° muitas coisas que voc√™ provavelmente ainda n√£o sabe, mas que o GraalVM pode fazer.  Neste artigo, examinaremos os v√°rios recursos que o GraalVM fornece e mostraremos o que voc√™ pode fazer com eles. </p><br><ol><li>  Execu√ß√£o r√°pida de Java </li><li>  Diminuir a hora de in√≠cio e o uso de mem√≥ria para Java </li><li>  Combinando JavaScript, Java, Ruby e R </li><li>  Execu√ß√£o de programas escritos em linguagens espec√≠ficas da plataforma </li><li>  Ferramentas comuns para todas as linguagens de programa√ß√£o </li><li>  Suplemento de Aplicativo da JVM </li><li>  Aplicativos dependentes da plataforma </li><li>  C√≥digo Java como uma biblioteca espec√≠fica da plataforma </li><li>  Suporte para v√°rias linguagens de programa√ß√£o no banco de dados </li><li>  Criando linguagens de programa√ß√£o para GraalVM </li></ol><a name="habracut"></a><br><p>  Voc√™ pode fazer tudo o que √© mostrado neste artigo usando o GraalVM 1.0.0 RC1, dispon√≠vel no link <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no site do GraalVM</a> .  Eu usei o MacOS Enterprise Edition, mas o c√≥digo escrito aqui funcionar√° no Linux e no GraalVM Community Edition. </p><br><p>  Quando voc√™ ler o artigo, execute os programas descritos nele!  O c√≥digo pode ser baixado no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> . </p><br><h2 id="ustanovka">  Instala√ß√£o </h2><br><p> Ap√≥s fazer o download em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://graalvm.org/downloads,</a> adicionei o caminho para os execut√°veis ‚Äã‚Äãdo GraalVM em <code>$PATH</code> .  Por padr√£o, isso adiciona suporte √† execu√ß√£o de Java e JavaScript. </p><br><pre> <code class="plaintext hljs">$ git clone https://github.com/chrisseaton/graalvm-ten-things.git $ cd foo $ tar -zxf graalvm-ee-1.0.0-rc1-macos-amd64.tar.gz # or graalvm-ee-1.0.0-rc1-linux-amd64.tar.gz on Linux $ export PATH=graalvm-1.0.0-rc1/Contents/Home/bin:$PATH # or PATH=graalvm-1.0.0-rc1/bin:$PATH on Linux</code> </pre> <br><p>  O GraalVM vem com suporte JavaScript embutido e cont√©m um gerenciador de pacotes chamado <code>gu</code> que adiciona a capacidade de instalar suporte para idiomas diferentes de Java e JavaScript.  Eu tamb√©m instalei Ruby, Python e R, eles s√£o baixados do GitHub. </p><br><pre> <code class="plaintext hljs">$ gu install -c org.graalvm.ruby $ gu install -c org.graalvm.python $ gu install -c org.graalvm.R</code> </pre> <br><p>  Agora, se voc√™ executar o comando <code>java</code> ou <code>js</code> , ver√° as vers√µes GraalVM desses mecanismos. </p><br><pre> <code class="plaintext hljs">$ java -version java version "1.8.0_161" Java(TM) SE Runtime Environment (build 1.8.0_161-b12) GraalVM 1.0.0-rc1 (build 25.71-b01-internal-jvmci-0.42, mixed mode) $ js --version Graal JavaScript 1.0 (GraalVM 1.0.0-rc1)</code> </pre> <br><h2 id="1-bystroe-vypolnenie-java">  1. Execu√ß√£o r√°pida de Java </h2><br><p>  "Graal" no GraalVM √© o nome do compilador.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Somente ele foi criado para governar tudo</a> !  Isso significa que esta √© uma implementa√ß√£o de compilador escrita na forma de uma biblioteca que pode ser usada para muitas coisas diferentes.  Por exemplo, usamos o Graal para compilar <em>antecipadamente</em> e <em>just-in-time</em> para compilar c√≥digo escrito em diferentes linguagens de programa√ß√£o, inclusive para diferentes arquiteturas de processador. </p><br><p>  A primeira e mais f√°cil maneira de usar o Graal √© us√°-lo como um compilador Java JIT. </p><br><p>  Como exemplo, usaremos um programa que produz 10 das palavras mais comuns em um documento.  O programa usa os recursos da linguagem Java moderna, como Streams e cole√ß√µes. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.file.Files; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.file.Paths; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Function; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Collectors; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Stream; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TopTen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Arrays.stream(args) .flatMap(TopTen::fileLines) .flatMap(line -&gt; Arrays.stream(line.split(<span class="hljs-string"><span class="hljs-string">"\\b"</span></span>))) .map(word -&gt; word.replaceAll(<span class="hljs-string"><span class="hljs-string">"[^a-zA-Z]"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) .filter(word -&gt; word.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .map(word -&gt; word.toLowerCase()) .collect(Collectors.groupingBy(Function.identity(), Collectors.counting())) .entrySet().stream() .sorted((a, b) -&gt; -a.getValue().compareTo(b.getValue())) .limit(<span class="hljs-number"><span class="hljs-number">10</span></span>) .forEach(e -&gt; System.out.format(<span class="hljs-string"><span class="hljs-string">"%s = %d%n"</span></span>, e.getKey(), e.getValue())); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Stream&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String path)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Files.lines(Paths.get(path)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(e); } } }</code> </pre> <br><p>  O GraalVM inclui o compilador <code>javac</code> , mas n√£o h√° diferen√ßa para esta demonstra√ß√£o, seja para us√°-lo ou para o compilador padr√£o.  Portanto, voc√™ pode usar o compilador <code>javac</code> padr√£o, se desejar. </p><br><pre> <code class="plaintext hljs">$ javac TopTen.java</code> </pre> <br><p>  Se executarmos o comando <code>java</code> , inclu√≠do no GraalVM, o compilador Grait JIT ser√° usado automaticamente - nenhuma etapa adicional ser√° necess√°ria.  Usarei o comando <code>time</code> para obter dados reais sobre o tempo gasto na execu√ß√£o do programa do in√≠cio ao fim, em vez de implantar uma marca de microbench complexa.  Uma grande quantidade de entrada tamb√©m ser√° usada para que n√£o haja insinua√ß√µes sobre os segundos salvos aqui ou ali.  O tamanho do arquivo <code>large.txt</code> √© 150 MB. </p><br><pre> <code class="plaintext hljs">$ make large.txt $ time java TopTen large.txt sed = 502701 ut = 392657 in = 377651 et = 352641 id = 317627 eu = 317627 eget = 302621 vel = 300120 a = 287615 sit = 282613 real 0m17.367s user 0m32.355s sys 0m1.456s</code> </pre> <br><p>  Graal √© escrito em Java, n√£o em C ++, como a maioria dos outros compiladores JIT para Java.  Achamos que isso nos permite melhor√°-lo mais rapidamente do que os compiladores existentes, adicionando novas otimiza√ß√µes poderosas (como, por exemplo, an√°lise de escape parcial) que n√£o est√£o dispon√≠veis no compilador JIT padr√£o para HotSpot. <br>  E isso pode tornar seus programas Java muito mais r√°pidos. </p><br><p>  Para fins de compara√ß√£o, para executar programas sem o compilador Grait JIT, usarei o <code>-XX:-UseJVMCICompiler</code> .  JVMCI √© a interface entre Graal e a JVM.  Voc√™ tamb√©m pode executar o exemplo em uma JVM padr√£o e comparar os resultados. </p><br><pre> <code class="plaintext hljs">$ time java -XX:-UseJVMCICompiler TopTen large.txt sed = 502701 ut = 392657 in = 377651 et = 352641 id = 317627 eu = 317627 eget = 302621 vel = 300120 a = 287615 sit = 282613 real 0m23.511s user 0m24.293s sys 0m0.579s</code> </pre> <br><p>  Este teste mostra que Graal executa nosso programa Java em cerca de tr√™s quartos do tempo necess√°rio para execut√°-lo com o compilador HotSpot padr√£o.  Onde acreditamos que melhorar a produtividade em unidades de porcentagem √© uma conquista significativa, 25% √© um grande neg√≥cio. </p><br><p>  Hoje, o Twitter √© a √∫nica empresa que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usa o Graal em servidores de "batalha"</a> , e eles dizem que isso √© justificado por eles, em termos de economia de dinheiro real.  O Twitter usa o Graal para executar aplicativos escritos no Scala - o Graal funciona no n√≠vel de bytecode da JVM, ou seja,  aplic√°vel a qualquer idioma da JVM. </p><br><p>  Este √© o primeiro caso de uso do GraalVM - simplesmente substituindo o compilador JIT por uma vers√£o melhor para seus aplicativos Java existentes. </p><br><h2 id="2-umenshenie-vremeni-starta-i-potrebleniya-pamyati-dlya-java">  2. Diminua a hora de in√≠cio e o uso de mem√≥ria para Java </h2><br><p>  Os pontos fortes da plataforma Java s√£o especialmente evidentes ao trabalhar com processos de longa execu√ß√£o e cargas de pico.  Os processos de vida curta, por outro lado, sofrem com longos tempos de inicializa√ß√£o e uso de mem√≥ria relativamente alto. </p><br><p>  Por exemplo, se executarmos o aplicativo da se√ß√£o anterior, alimentando uma quantidade muito menor de dados de entrada - cerca de 1 KB em vez de 150 MB, parece que levar√° um tempo excessivamente longo e bastante mem√≥ria - cerca de 60 MB, para processar um arquivo t√£o pequeno .  Usamos a op√ß√£o <code>-l</code> para imprimir a quantidade de mem√≥ria usada, al√©m do tempo de execu√ß√£o. </p><br><pre> <code class="plaintext hljs">$ make small.txt $ /usr/bin/time -l java TopTen small.txt # -v on Linux instead of -l sed = 6 sit = 6 amet = 6 mauris = 3 volutpat = 3 vitae = 3 dolor = 3 libero = 3 tempor = 2 suscipit = 2 0.32 real 0.49 user 0.05 sys 59846656 maximum resident set size</code> </pre> <br><p>  O GraalVM nos fornece uma ferramenta que resolve esse problema.  Dissemos que o Graal √© uma biblioteca de compiladores e pode ser usada de v√°rias maneiras diferentes.  Um deles √© compilar <em>antecipadamente</em> em uma imagem execut√°vel <em>dependente da</em> plataforma, em vez de compilar <em>just in time</em> no tempo de execu√ß√£o.  Isso √© semelhante ao funcionamento de um compilador comum, como o <code>gcc</code> . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server TopTen classlist: 1,513.82 ms (cap): 2,333.95 ms setup: 3,584.09 ms (typeflow): 4,642.13 ms (objects): 3,073.58 ms (features): 156.34 ms analysis: 8,059.94 ms universe: 353.02 ms (parse): 1,277.02 ms (inline): 1,412.08 ms (compile): 10,337.76 ms compile: 13,776.23 ms image: 2,526.63 ms write: 1,525.03 ms [total]: 31,439.47 ms</code> </pre> <br><p>  Este comando cria um <code>topten</code> plataforma chamado <code>topten</code> .  Este arquivo n√£o inicia a JVM, n√£o est√° vinculado √† JVM e n√£o inclui a JVM de forma alguma.  O comando <code>native-image</code> compila verdadeiramente seu c√≥digo Java e as bibliotecas Java usadas no c√≥digo completo da m√°quina.  Para componentes de tempo de execu√ß√£o, como o coletor de lixo, lan√ßamos nossa pr√≥pria nova VM chamada SubstrateVM, que, como Graal, tamb√©m √© escrita em Java. </p><br><p>  Se voc√™ observar as depend√™ncias que <code>topten</code> usa, ver√° que essas s√£o apenas bibliotecas padr√£o do sistema.  Podemos transferir apenas esse arquivo para um sistema no qual a JVM nunca foi instalada e execut√°-lo l√° para verificar se ele n√£o usa a JVM ou outros arquivos.  <code>Topten</code> tamb√©m <code>Topten</code> bem pequeno - o c√≥digo execut√°vel ocupa menos de 6 MB. </p><br><pre> <code class="plaintext hljs">$ otool -L topten # ldd topten on Linux topten: .../CoreFoundation.framework ... .../libz.1.dylib ... .../libSystem.B.dylib ... $ du -h topten 5.7M topten</code> </pre> <br><p>  Se executarmos esse execut√°vel, veremos que ele inicia uma ordem de magnitude mais rapidamente e usa cerca de uma ordem de magnitude menos mem√≥ria que o mesmo programa em execu√ß√£o na JVM.  O lan√ßamento √© t√£o r√°pido que voc√™ n√£o percebe quanto tempo levou.  Se voc√™ usar a linha de comando, n√£o sentir√° a pausa que normalmente est√° presente quando voc√™ executa um programa pequeno e de curta dura√ß√£o na JVM </p><br><pre> <code class="plaintext hljs">$ /usr/bin/time -l ./topten small.txt sed = 6 sit = 6 amet = 6 mauris = 3 volutpat = 3 vitae = 3 dolor = 3 libero = 3 tempor = 2 suscipit = 2 0.02 real 0.00 user 0.00 sys 4702208 maximum resident set size</code> </pre> <br><p>  O utilit√°rio de <code>native-image</code> tem algumas <a href="">limita√ß√µes</a> .  Portanto, em tempo de compila√ß√£o, voc√™ deve ter todas as classes presentes, tamb√©m h√° restri√ß√µes no uso da API de reflex√£o.  Mas existem algumas vantagens adicionais sobre a compila√ß√£o b√°sica, como a execu√ß√£o de inicializadores est√°ticos em tempo de compila√ß√£o.  Portanto, a quantidade de trabalho realizado sempre que o aplicativo √© baixado √© reduzida. </p><br><p>  Esta √© a segunda aplica√ß√£o do GraalVM - a distribui√ß√£o e execu√ß√£o de programas Java existentes, com um in√≠cio r√°pido e menor consumo de mem√≥ria.  Esse m√©todo corrige problemas de configura√ß√£o, como encontrar o jar certo no tempo de execu√ß√£o, e tamb√©m permite criar imagens menores do docker. </p><br><h2 id="3-kombinirovanie-javascript-java-ruby-i-r">  3. Combinando JavaScript, Java, Ruby e R </h2><br><p>  Juntamente com o Java, o GraalVM inclui novas implementa√ß√µes dos mecanismos JavaScript, Ruby, R e Python.  Eles s√£o escritos usando uma nova estrutura chamada <em>Trufa</em> .  Essa estrutura possibilita a cria√ß√£o de int√©rpretes de linguagem simples e de alto desempenho.  Quando voc√™ escreve um int√©rprete de idioma usando o Truffle, ele automaticamente usa o Graal para fornecer compila√ß√£o JIT para o seu idioma.  Portanto, Graal n√£o √© apenas um compilador JIT e AOT para Java, mas tamb√©m pode ser um compilador JIT para JavaScript, Ruby, R e Python. </p><br><p>  O suporte a idiomas de terceiros no GraalVM visa ser uma substitui√ß√£o transparente dos mecanismos existentes para a execu√ß√£o de v√°rios idiomas.  Por exemplo, podemos instalar o m√≥dulo "color" para o Node.js: </p><br><pre> <code class="plaintext hljs">$ npm install --global color ... + color@3.0.0 added 6 packages in 14.156s</code> </pre> <br><p>  Em seguida, escreva um programa usando este m√≥dulo para converter cores HTML RGB em HSL: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Color = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'color'</span></span>); process.argv.slice(<span class="hljs-number"><span class="hljs-number">2</span></span>).forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val</span></span></span><span class="hljs-function">) </span></span>{ print(Color(val).hsl().string()); });</code> </pre> <br><p>  E execute-o da maneira usual: </p><br><pre> <code class="plaintext hljs">$ node color.js '#42aaf4' hsl(204.89999999999998, 89%, 60.8%)</code> </pre> <br><p>  Os mecanismos de execu√ß√£o de diferentes idiomas no GraalVM trabalham juntos - existe uma API que permite executar o c√≥digo de um idioma em um programa escrito em outro idioma.  E isso permite que voc√™ escreva programas multil√≠ngues - programas escritos em mais de uma linguagem de programa√ß√£o. </p><br><p>  Isso pode ser necess√°rio se voc√™ escrever a maior parte do seu programa em um idioma, mas desejar usar uma biblioteca escrita em outro idioma de programa√ß√£o.  Por exemplo, suponha que precisamos escrever um aplicativo para converter um nome de cor de CSS em sua representa√ß√£o num√©rica no Node.js, mas queremos usar uma biblioteca de cores Ruby em vez de escrever a convers√£o. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = express(); color_rgb = Polyglot.eval(<span class="hljs-string"><span class="hljs-string">'ruby'</span></span>, <span class="hljs-string"><span class="hljs-string">` require 'color' Color::RGB `</span></span>); app.get(<span class="hljs-string"><span class="hljs-string">'/css/:name'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ color = color_rgb.by_name(req.params.name).html() res.send(<span class="hljs-string"><span class="hljs-string">'&lt;h1 style="color: '</span></span> + color + <span class="hljs-string"><span class="hljs-string">'" &gt;'</span></span> + color + <span class="hljs-string"><span class="hljs-string">'&lt;/h1&gt;'</span></span>); }); app.listen(<span class="hljs-number"><span class="hljs-number">8080</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'serving at http://localhost:8080'</span></span>) });</code> </pre> <br><p>  Nesse c√≥digo, escrevemos que precisamos executar o c√≥digo Ruby como uma string, mas observe que n√£o fizemos muito aqui - apenas conectamos as bibliotecas e retornamos o objeto Ruby.  No Ruby, n√≥s o <code>Color::RGB.by_name (name).html</code> assim: <code>Color::RGB.by_name (name).html</code> .  Se voc√™ observar como o <code>color_rgb</code> usado posteriormente no JavaScript, ver√° que na verdade chamamos os mesmos m√©todos a partir do JavaScript, embora sejam objetos e m√©todos Ruby.  N√≥s as passamos como strings JavaScript e combinamos o resultado, que √© uma string Ruby, com uma string JavaScript. </p><br><p>  Instale as duas depend√™ncias - Ruby e JavaScript. </p><br><pre> <code class="plaintext hljs">$ gem install color Fetching: color-1.8.gem (100%) Successfully installed color-1.8 1 gem installed $ npm install express + express@4.16.2 updated 1 package in 10.393s</code> </pre> <br><p>  Ent√£o voc√™ precisa iniciar o <code>node</code> com algumas op√ß√µes adicionais: <code>--polyglot</code> , para dizer que precisamos acessar outros idiomas e <code>--jvm</code> , porque a imagem execut√°vel do <code>node</code> por padr√£o, n√£o inclui nada al√©m de JavaScript. </p><br><pre> <code class="plaintext hljs">$ node --polyglot --jvm color-server.js serving at http://localhost:8080</code> </pre> <br><p>  E, em seguida, acesse o URL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 8080 / css / orange</a> (ou alguma outra cor), como sempre, em seu navegador. <br><img src="https://habrastorage.org/webt/_h/uz/e2/_huze29ugzgpz8ecll22rpv6s1w.png"><br>  Vamos tentar fazer um exemplo mais s√©rio, que usa mais idiomas e m√≥dulos. </p><br><p>  O JavaScript n√£o suporta n√∫meros inteiros muito grandes.  Encontrei v√°rios m√≥dulos, como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√∫mero inteiro grande</a> , mas todos s√£o ineficientes porque  armazene os componentes de um n√∫mero como n√∫meros de ponto flutuante JavaScript.  A classe <code>BigInteger</code> em Java √© mais eficiente, vamos us√°-la para fazer algumas opera√ß√µes aritm√©ticas com n√∫meros inteiros grandes. </p><br><p>  O JavaScript tamb√©m n√£o possui suporte interno para desenhar gr√°ficos, enquanto R desenha excelentemente gr√°ficos.  Vamos usar o m√≥dulo <code>svg</code> de R para desenhar um gr√°fico de dispers√£o de uma fun√ß√£o trigonom√©trica no espa√ßo 3D. </p><br><p>  Nos dois casos, usaremos a API para oferecer suporte ao multilinguismo do GraalVM (doravante denominada API Polyglot) e podemos simplesmente inserir os resultados da execu√ß√£o de programas em outros idiomas no JavaScript. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BigInteger = Java.type(<span class="hljs-string"><span class="hljs-string">'java.math.BigInteger'</span></span>) app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = <span class="hljs-string"><span class="hljs-string">'Hello World from Graal.js!&lt;br&gt; '</span></span> <span class="hljs-comment"><span class="hljs-comment">// Using Java standard library classes text += BigInteger.valueOf(10).pow(100) .add(BigInteger.valueOf(43)).toString() + '&lt;br&gt;' // Using R interoperability to create graphs text += Polyglot.eval('R', `svg(); require(lattice); x &lt;- 1:100 y &lt;- sin(x/10) z &lt;- cos(x^1.3/(runif(1)*5+10)) print(cloud(x~y*z, main="cloud plot")) grDevices:::svg.off() `); res.send(text) }) app.listen(3000, function () { console.log('Example app listening on port 3000!') })</span></span></code> </pre> <br><p>  Abra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 3000 /</a> no seu navegador para ver o resultado: <br><img src="https://habrastorage.org/webt/1o/so/fj/1osofjuimjcfd7pv1qhcikonupo.png"><br>  Esta √© a terceira coisa que podemos fazer com o GraalVM - execute programas escritos em v√°rias linguagens e use m√≥dulos dessas linguagens juntos em um programa.  Apresentamos isso como uma maneira de unificar ambientes e bibliotecas de tempo de execu√ß√£o - voc√™ pode usar a linguagem de programa√ß√£o que achar melhor para resolver a tarefa atual e qualquer biblioteca que desejar, independentemente da linguagem de programa√ß√£o em que est√° escrita. </p><br><h2 id="4-ispolnenie-programm-napisannyh-na-platformo-zavisimyh-yazykah">  4. Execu√ß√£o de programas escritos em linguagens espec√≠ficas da plataforma </h2><br><p>  Outra linguagem que o GraalVM suporta √© C. O GraalVM pode executar o c√≥digo C da mesma maneira que executa programas escritos em JavaScript e Ruby. </p><br><p>  O que o GraalVM realmente suporta √© a execu√ß√£o do c√≥digo resultante da execu√ß√£o dos utilit√°rios LLVM, ou seja,  c√≥digo de bits, n√£o suporte direto a C. Isso significa que voc√™ pode usar as ferramentas existentes para a linguagem C e outras que suportam LLVM, como C ++, Fortran e, potencialmente, mais idiomas no futuro.  Para simplificar a demonstra√ß√£o, eu executo uma vers√£o especial do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gzip</a> , que √© montada em um √∫nico arquivo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Stephen McCamant</a> suporta esta vers√£o).  Este √© apenas o c√≥digo-fonte <code>gzip</code> e a configura√ß√£o do <code>autoconf</code> combinados em um arquivo para simplificar.  Eu tive que corrigir algumas coisas para faz√™-lo funcionar no macOS e com o clang, mas n√£o fiz nada especificamente para oferecer suporte ao GraalVM. </p><br><p>  Compilamos o gzip usando o <code>clang</code> padr√£o (compilador LLVM para C) e queremos que ele nos torne um c√≥digo de bits LLVM, e n√£o uma compila√ß√£o espec√≠fica da plataforma, porque o GraalVM n√£o o inicia.  Estou usando o <code>clang</code> 4.0.1. </p><br><pre> <code class="plaintext hljs">$ clang -c -emit-llvm gzip.c</code> </pre> <br><p>  E, em seguida, execute o resultado, diretamente usando o comando lli (interpretador de c√≥digo de bits LLVM) do GraalVM.  Vamos tentar compactar o arquivo usando o meu arquivador do sistema gzip e descompacte-o usando o gzip executado no GraalVM. </p><br><pre> <code class="plaintext hljs">$ cat small.txt Lorem ipsum dolor sit amet... $ gzip small.txt $ lli gzip.bc -d small.txt.gz $ cat small.txt Lorem ipsum dolor sit amet...</code> </pre> <br><p>  As implementa√ß√µes Ruby e Python no GraalVM usam a mesma t√©cnica para executar extens√µes escritas em C para essas linguagens.  Isso significa que voc√™ pode executar essas extens√µes dentro da VM e isso nos permite manter alta velocidade de execu√ß√£o, mesmo se usarmos interfaces de extens√£o espec√≠ficas da plataforma desatualizadas. </p><br><p>  Esta √© a quarta maneira de usar o GraalVM - executando programas escritos em linguagens espec√≠ficas da plataforma, como C ou C ++, al√©m de iniciar extens√µes para linguagens como Python ou Ruby, que n√£o s√£o capazes de fazer implementa√ß√µes de JVM dessas linguagens, como o JRuby. </p><br><h2 id="5-obschie-instrumenty-dlya-vseh-yazykov-programmirovaniya">  5. Ferramentas gerais para todas as linguagens de programa√ß√£o </h2><br><p>  Se voc√™ programa em Java, provavelmente est√° usando ferramentas de alta qualidade, como IDEs, depuradores e criadores de perfil.  Nem todos os idiomas possuem este kit de ferramentas, mas voc√™ pode obter um se usar idiomas suportados pelo GraalVM. </p><br><p>  O suporte para todas as linguagens no GraalVM (exceto Java, no momento) √© implementado usando uma estrutura comum - Truffle.  Isso nos permite criar a funcionalidade, por exemplo, um depurador, uma vez e us√°-la para todos os idiomas. </p><br><p>  Para tentar isso, escreveremos o programa mais simples - o <em>FizzBuzz</em> , porque √© visual (imprime algo na tela) e possui ramifica√ß√µes claras que s√£o usadas apenas em algumas itera√ß√µes.  Assim, ser√° mais f√°cil definir pontos de interrup√ß√£o.  Vamos come√ßar com uma implementa√ß√£o JavaScript. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fizzbuzz</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((n % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (n % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'FizzBuzz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Fizz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n % <span class="hljs-number"><span class="hljs-number">5</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Buzz'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = <span class="hljs-number"><span class="hljs-number">1</span></span>; n &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span>; n++) { print(fizzbuzz(n)); }</code> </pre> <br><p>  Iniciamos o programa como de costume, usando o utilit√°rio <code>js</code> , no GraalVM. </p><br><pre> <code class="plaintext hljs">$ js fizzbuzz.js 1 2 Fizz 4 Buzz Fizz</code> </pre> <br><p>  Tamb√©m podemos executar o programa com o sinalizador <code>--inspect</code> .  Isso nos dar√° um link que voc√™ pode abrir no Chrome e interromper o programa no depurador. </p><br><pre> <code class="plaintext hljs">$ js --inspect fizzbuzz.js Debugger listening on port 9229. To start debugging, open the following URL in Chrome: chrome-devtools://devtools/bundled/inspector.html?ws=127.0.0.1:9229/6c478d4e-1350b196b409</code> </pre> <br><p>  Voc√™ pode definir um ponto de interrup√ß√£o no c√≥digo do <em>FizzBuzz</em> e continuar a execu√ß√£o.  Quando o programa interrompe a execu√ß√£o, veremos o valor da vari√°vel <code>n</code> no depurador e podemos continuar a execu√ß√£o do programa ou estudar a interface do depurador. <br><img src="https://habrastorage.org/webt/kn/nq/so/knnqsotzl0j-k8e4y83a1ziz97w.png"><br>  O depurador do Chrome √© normalmente usado para JavaScript, mas para o GraalVM em JavaScript n√£o h√° nada diferente de outros idiomas.  O sinalizador <code>--inspect</code> tamb√©m <code>--inspect</code> dispon√≠vel e funciona nas implementa√ß√µes Python, Ruby e R. N√£o mostrarei a origem de cada programa, mas elas s√£o executadas da mesma maneira e voc√™ obt√©m o mesmo depurador no Chrome para cada um deles. </p><br><pre> <code class="plaintext hljs">$ graalpython --jvm --inspect fizzbuzz.py</code> </pre> <br><p><img src="https://habrastorage.org/webt/6t/fx/2m/6tfx2m4btthox9mxxkweqehwjgm.png"></p><br><pre> <code class="plaintext hljs">$ ruby --inspect fizzbuzz.rb</code> </pre> <br><p><img src="https://habrastorage.org/webt/2z/_z/ti/2z_ztia4yk9fqomzo_vxj9c7mb0.png"></p><br><pre> <code class="plaintext hljs">$ Rscript --inspect fizzbuzz.r</code> </pre> <br><p><img src="https://habrastorage.org/webt/rg/12/wn/rg12wnspfc176rtrz7uww4qymo0.png"><br>  Outra ferramenta que voc√™ pode estar familiarizado com Java √© o VisualVM.  Ele fornece uma interface com o usu√°rio atrav√©s da qual voc√™ pode ingressar em uma JVM em execu√ß√£o em sua m√°quina local ou atrav√©s de uma rede para inspecionar v√°rios aspectos da execu√ß√£o do programa, como uso de mem√≥ria ou execu√ß√£o de encadeamento. </p><br><p>  O GraalVM inclui o VisualVM como um utilit√°rio <code>jvisualvm</code> padr√£o. </p><br><pre> <code class="plaintext hljs">$ jvisualvm &amp;&gt; /dev/null &amp;</code> </pre> <br><p>  Se executarmos o VisualVM enquanto o programa <code>TopTen</code> Java estiver em <code>TopTen</code> , poderemos observar o uso da mem√≥ria ou, por exemplo, tirar uma captura instant√¢nea do conte√∫do da mem√≥ria e ver quais tipos de objetos usamos mem√≥ria no heap. </p><br><pre> <code class="plaintext hljs">$ java TopTen large.txt</code> </pre> <br><p><img src="https://habrastorage.org/webt/gd/-5/ld/gd-5ldwlrn3y9szdaoqrmd_7res.png"><br>  Eu escrevi este programa em Ruby para gerar algum lixo na mem√≥ria em tempo de execu√ß√£o. </p><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'erb'</span></span> x = <span class="hljs-number"><span class="hljs-number">42</span></span> template = ERB.new &lt;&lt;-EOF The value of x <span class="hljs-symbol"><span class="hljs-symbol">is:</span></span> &lt;%= x %&gt; EOF loop <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> puts template.result(binding) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Se voc√™ executar a implementa√ß√£o padr√£o do Ruby na JVM - JRuby, ficar√° desapontado com o VisualVM porque ver√° apenas objetos Java internos em vez de objetos em sua linguagem. </p><br><p>  Se voc√™ usar a vers√£o do Ruby para GraalVM, o VisualVM reconhecer√° objetos Ruby.  Precisamos usar a op√ß√£o <code>--jvm</code> para usar o VisualVM, pois  n√£o suporta vers√µes nativas do Ruby. </p><br><pre> <code class="plaintext hljs">$ ruby --jvm render.rb</code> </pre> <br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode, se necess√°rio, examinar o instant√¢neo do heap com objetos Java internos, como vimos anteriormente, ou, na guia Resumo, voc√™ pode selecionar o Ruby Heap e ver os objetos reais do Ruby. </font></font><br><img src="https://habrastorage.org/webt/ge/d4/xc/ged4xcxp5ylkaxjxyxd5b8v3kyo.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A estrutura do Truffle √© semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nexus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idiomas e ferramentas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Se voc√™ criar seu pr√≥prio mecanismo de idioma usando o Truffle e criar suas pr√≥prias ferramentas, como um depurador, levando em considera√ß√£o a API Truffle para ferramentas, cada uma dessas ferramentas funcionar√° em qualquer idioma baseado no Truffle, e voc√™ precisar√° escrev√™-lo apenas um vezes.</font></font></p><br><p> ,   GraalVM ‚Äî         ,       .   Truffle  GraalVM      ,       VisualVM. </p><br><h2 id="6-dopolnenie-jvm-prilozheniy"> 6.  JVM  </h2><br><p>   ,   ,   ,        Java .  API   <code>org.graalvm.polyglot</code>      ,         . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.polyglot.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.polyglot.Value; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtendJava</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ String language = <span class="hljs-string"><span class="hljs-string">"js"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> (Context context = Context.newBuilder().allowNativeAccess(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>).build()) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String arg: args) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg.startsWith(<span class="hljs-string"><span class="hljs-string">"-"</span></span>)) { language = arg.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Value v = context.eval(language, arg); System.out.println(v); } } } } }</code> </pre> <br><p>    <code>javac</code>  <code>java</code>   GraalVM,   <code>org.graalvm.*</code>     <code>classpath</code> , ..          . </p><br><pre> <code class="plaintext hljs">$ javac ExtendJava.java $ java ExtendJava '14 + 2' 16 $ java ExtendJava -js 'Math.sqrt(14)' 3.7416573867739413 $ java ExtendJava -python '[2**n for n in range(0, 8)]' [1, 2, 4, 8, 16, 32, 64, 128] $ java ExtendJava -ruby '[4, 2, 3].sort' [2, 3, 4]</code> </pre> <br><p> ,        ‚Äî     ,      <code>node</code>  <code>ruby</code> ,  GraalVM. </p><br><p>     GraalVM ‚Äî             Java . Polyglot API     ‚Äú‚Äù      Java ,       . </p><br><h2 id="7-dopolnenie-platformo-zavisimyh-prilozheniy"> 7.  -  </h2><br><p>  GraalVM    ,  ,    ‚Äî  ,        ,  GraalVM,  - . ,  JavaScript ,  V8,  Python ‚Äî CPython     , ..          . GraalVM           ‚Äî      Polyglot . </p><br><p>    GraalVM,       ,         JavaScript.    Polyglot ,    ,  : </p><br><pre> <code class="plaintext hljs">$ graalvm-1.0.0-rc1/Contents/Home/jre/lib/svm/bin/rebuild-images libpolyglot</code> </pre> <br><p>     C,   ,    ,  GraalVM,     .       <code>ExtendJava</code>   ,    ,   . </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;polyglot_api.h&gt; int main(int argc, char **argv) { graal_isolate_t *isolate = NULL; graal_isolatethread_t *thread = NULL; if (graal_create_isolate(NULL, &amp;isolate) != 0 || (thread = graal_current_thread(isolate)) == NULL) { fprintf(stderr, "initialization error\n"); return 1; } poly_context context = NULL; if (poly_create_context(thread, NULL, 0, &amp;context) != poly_ok) { fprintf(stderr, "initialization error\n"); return 1; } char* language = "js"; for (int n = 1; n &lt; argc; n++) { if (argv[n][0] == '-') { language = &amp;argv[n][1]; } else { poly_value result = NULL; if (poly_context_eval(thread, context, language, "unicalc", argv[n], &amp;result) != poly_ok) { fprintf(stderr, "eval error\n"); return 1; } char buffer[1024]; size_t length; if (poly_value_to_string_utf8(thread, result, buffer, sizeof(buffer), &amp;length) != poly_ok) { fprintf(stderr, "to string error\n"); return 1; } buffer[length] = '\0'; printf("%s\n", buffer); poly_destroy_handle(thread, result); } } return 0; }</span></span></span></span></code> </pre> </div></div><br><p>      ,       polyglot   GraalVM.  , ,    JVM. </p><br><pre> <code class="plaintext hljs">$ clang -Igraalvm-1.0.0-rc1/Contents/Home/jre/lib/polyglot / -rpath graalvm-1.0.0-rc1/Contents/Home / -Lgraalvm-1.0.0-rc1/Contents/Home/jre/lib/polyglot / -lpolyglot extendc.c -o extendc $ otool -L extendc extendc: .../libpolyglot.dylib ... .../libSystem.B.dylib ...</code> </pre> <br><pre> <code class="plaintext hljs">$ ./extendc '14 + 2' 16 $ ./extendc -js 'Math.sqrt(14)' 3.7416573867739413 $ ./extendc -python '[2**n for n in range(0, 8)]' [1, 2, 4, 8, 16, 32, 64, 128]</code> </pre> <br><p>   ,      GraalVM ‚Äî  -    ,    ,  GraalVM. </p><br><h2 id="8-kod-na-java-kak-platformo-zavisimaya-biblioteka"> 8.   Java  -  </h2><br><p>  Java        , , ,    ,  - ,      .     Java   - ,     JVM   ,         . </p><br><p> GraalVM    Java ,   ,      - ,          .      ,    ,    Java    JVM. </p><br><p>   ,     Apache SIS    ,     ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> )     .   SIS 0.8,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://sis.apache.org/</a>     jar. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.sis.distance.DistanceUtils; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Distance</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> aLat = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> aLong = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> bLat = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> bLong = Double.parseDouble(args[<span class="hljs-number"><span class="hljs-number">3</span></span>]); System.out.printf(<span class="hljs-string"><span class="hljs-string">"%.2f km%n"</span></span>, DistanceUtils.getHaversineDistance(aLat, aLong, bLat, bLong)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IsolateThread thread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aLat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aLong, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bLat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bLong)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DistanceUtils.getHaversineDistance(aLat, aLong, bLat, bLong); } }</code> </pre> <br><p>      ,       - </p><br><pre> <code class="plaintext hljs">$ javac -cp sis.jar -parameters Distance.java $ java -cp sis.jar:. Distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>       ,      <code>topten</code> . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server -cp sis.jar:. Distance ... $ ./distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>      ,    .   ,        <code>@CEntryPoint</code> </p><br><pre> <code class="java hljs">... <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.nativeimage.IsolateThread; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.graalvm.nativeimage.c.function.CEntryPoint; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Distance</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@CEntryPoint</span></span>(name = <span class="hljs-string"><span class="hljs-string">"distance"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IsolateThread thread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a_lat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a_long, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b_lat, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b_long)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DistanceUtils.getHaversineDistance(a_lat, a_long, b_lat, b_long); } ... }</code> </pre> <br><p>      <code>javac</code> ,   GraalVM    API  <code>classpath</code> . C         . </p><br><pre> <code class="plaintext hljs">$ native-image --no-server -cp sis.jar:. -H:Kind=SHARED_LIBRARY \ -H:Name=libdistance $ otool -L libdistance.dylib # .so on Linux libdistance.dylib: .../libdistance.dylib ... .../CoreFoundation.framework ... .../libz.1.dylib ... .../libSystem.B.dylib ... $ du -h libdistance.dylib 4.8M libdistance.dylib</code> </pre> <br><p>      ,     .     ,    :   VM   ,      ,           . </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;libdistance.h&gt; int main(int argc, char **argv) { graal_isolate_t *isolate = NULL; graal_isolatethread_t *thread = NULL; if (graal_create_isolate(NULL, &amp;isolate) != 0 || (thread = graal_current_thread(isolate)) == NULL) { fprintf(stderr, "initialization error\n"); return 1; } double a_lat = strtod(argv[1], NULL); double a_long = strtod(argv[2], NULL); double b_lat = strtod(argv[3], NULL); double b_long = strtod(argv[4], NULL); printf("%.2f km\n", distance(thread, a_lat, a_long, b_lat, b_long)); return 0; }</span></span></span></span></code> </pre> <br><p>       ,       (  <code>LD_LIBRARY_PARTH=.</code>  Linux) </p><br><pre> <code class="plaintext hljs">$ clang -I. -L. -ldistance distance.c -o distance $ otool -L distance distance: .../libdistance.dylib ... .../libSystem.B.dylib ... $ ./distance 51.507222 -0.1275 40.7127 -74.0059 5570.25 km</code> </pre> <br><p>     GraalVM ‚Äî   java  - ,         JVM </p><br><h2 id="9-podderzhka-neskolkih-yazykov-programmirovaniya-v-baze-dannyh"> 9.        </h2><br><p>     Polyglot  ‚Äî     Oracle.      Oracle Database Multilingual Engine (MLE),         GraalVM   SQL. </p><br><p> ,    front-end,    JavaScript     email ,  JavaScript  <code>validator</code> .     -       ,      SQL  PL/SQL.         ,    . </p><br><p>  MLE  Docker  : </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://oracle.github.io/oracle-db-mle/releases/0.2.7/docker/</a> </p><br><p>     Docker Daemon. </p><br><pre> <code class="plaintext hljs">$ docker load --input mle-docker-0.2.7.tar.gz</code> </pre> <br><p>  ,  Docker,  ,    (    ),  Bash   . </p><br><pre> <code class="plaintext hljs">$ docker run mle-docker-0.2.7 $ docker ps $ docker exec -ti &lt;container_id&gt; bash -li</code> </pre> <br><p>    <code>sqlplus</code> ( SQL ),   Bash,     ,   ,     . </p><br><pre> <code class="plaintext hljs">$ sqlplus scott/tiger@localhost:1521/ORCLCDB</code> </pre> <br><p>    ,    <code>sqlplus</code> . ,   Bash  Docker,         <code>dbjs</code> ,       .   <code>sqlplus</code> . </p><br><pre> <code class="plaintext hljs">$ npm install validator $ npm install @types/validator $ dbjs deploy -u scott -p tiger -c localhost:1521/ORCLCDB validator $ sqlplus scott/tiger@localhost:1521/ORCLCDB</code> </pre> <br><p>         <code>validator</code>   SQL . </p><br><pre> <code class="plaintext hljs">SQL&gt; select validator.isEmail('hello.world@oracle.com') from dual; VALIDATOR.ISEMAIL('HELLO.WORLD@ORACLE.COM') ------------------------------------------- 1 SQL&gt; select validator.isEmail('hello.world') from dual; VALIDATOR.ISEMAIL('HELLO.WORLD') -------------------------------- 0</code> </pre> <br><p>    ,     GraalVM ‚Äî  ,  GraalVM,   Oracle.  ,     front-end  back-end,    ,  ,           . </p><br><h2 id="10-sozdanie-yazykov-programmirovaniya-dlya-graalvm"> 10.     GraalVM </h2><br><p> Oracle Labs            JavaScript, R, Ruby, Python  C   ,      Truffle,       GraalVM. </p><br><p> Truffle ‚Äî  java ,     <em>  </em> (AST).  AST ‚Äî ,     ,                ,   , ,  .     ,    ,   Truffle  Graal   JIT  ,       AST . </p><br><p>    Truffle,    GraalVM    ,      ,  DSL.      Truffle  Graal   ,     ,  Truffle ‚Äî         GraalVM.        , , , , . ,         ,        . Oracle labs    Ruby ,    ,         . </p><br><p>       ,     ,   ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SimpleLanguage</a> ‚Äî         Truffle,       JavaScript.  ,  ,   , , , <a href="">   if</a> . </p><br><p>  ,    Truffle   Oracle Labs,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SmallTalk</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Newspeak</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lisp</a> .    Lisp  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> ,         . </p><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p> GraalVM        ‚Äî  ,         ,       .       ,  ,    ,      ,    . </p><br><p>   GraalVM,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://www.graalvm.org/</a> .          ,  ,      . </p><br><p>    ,              ,    .     ,     GraalVM         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@ChrisGSeaton</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@shelajev</a> . </p><br><p> <em>:</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Oleg ≈†elajev</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Olya Gupalo</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Doug Simon</a> </p><cut></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433432/">https://habr.com/ru/post/pt433432/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433414/index.html">Testando o PRTG Network Monitor e compara√ß√£o com o Zabbix</a></li>
<li><a href="../pt433420/index.html">Resultados ZeroNights 2018</a></li>
<li><a href="../pt433424/index.html">√â poss√≠vel carregar um n√≠vel intransit√°vel no Super Mario Maker?</a></li>
<li><a href="../pt433428/index.html">De onde vem a criatividade: an√°lise da atividade das ondas alfa do c√©rebro durante testes RAT</a></li>
<li><a href="../pt433430/index.html">Caixa Mecool KM9 para Android no novo SoC Amlogic S905X2 com 4 GB de RAM e Android TV 8.1 - entenda e perdoe</a></li>
<li><a href="../pt433434/index.html">‚ÄúPascal e menos ainda o Basic definitivamente n√£o s√£o necess√°rios‚Äù: uma entrevista com treinadores em programa√ß√£o esportiva</a></li>
<li><a href="../pt433436/index.html">Introdu√ß√£o √† Pesquisa de Desempenho</a></li>
<li><a href="../pt433438/index.html">A Duma do Estado limitar√° o financiamento coletivo</a></li>
<li><a href="../pt433442/index.html">Lan√ßamento do Entity Framework Core 2.2. Novidades (3 de 3)</a></li>
<li><a href="../pt433446/index.html">Semana da Seguran√ßa 51: bug no WordPress 5.0 e no software Logitech, vulnerabilidade de foto do Facebook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>