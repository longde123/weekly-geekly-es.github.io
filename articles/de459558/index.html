<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏽‍🤝‍🧑🏽 🙎🏽 🛀🏾 So starten Sie den Benutzermodus unter Linux 👇🏼 ❤️ 🤱🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einführung des Übersetzers: Vor dem Hintergrund des massiven Eintritts verschiedener Arten von Containern in unser Leben kann es sehr interessant und ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So starten Sie den Benutzermodus unter Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/459558/">  <i>Einführung des Übersetzers: Vor dem Hintergrund des massiven Eintritts verschiedener Arten von Containern in unser Leben kann es sehr interessant und nützlich sein, herauszufinden, mit welchen Technologien alles einmal begonnen hat.</i>  <i>Einige von ihnen können bis heute verwendet werden, aber nicht jeder erinnert sich an solche Methoden (oder weiß, ob sie während ihrer schnellen Entwicklung nicht gefunden wurden).</i>  <i>Eine solche Technologie ist User Mode Linux.</i>  <i>Der Autor des Originals kramte ziemlich herum, fand heraus, was von den alten Entwicklungen noch funktionierte und was nicht sehr viel, und sammelte so etwas wie eine Schritt-für-Schritt-Anleitung, wie ich in 2k19 selbstgebaute UML in 2k19 starten kann.</i>  <i>Und ja, wir haben den Autor des ursprünglichen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Cadey-</a> Beitrags nach <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Habr</a> eingeladen. Wenn Sie also Fragen haben, fragen Sie in den Kommentaren auf Englisch.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/480/b5e/ecc/480b5eeccd71ac8e098a9e7b3b8bedb6.jpg" alt="Bild"><br><br>  Der Linux-Benutzermodus ist in der Tat der Linux-Kernel-Port selbst.  In diesem Modus können Sie einen vollwertigen Linux-Kernel als Benutzerprozess ausführen und werden normalerweise von Entwicklern zum Testen von Treibern verwendet.  Dieser Modus eignet sich aber auch als Werkzeug für die allgemeine Isolation, deren Prinzip dem Betrieb virtueller Maschinen ähnelt.  Dieser Modus bietet mehr Isolation als Docker, jedoch weniger als eine vollwertige virtuelle Maschine wie KVM oder Virtual Box. <br><a name="habracut"></a><br>  Im Allgemeinen mag der Benutzermodus seltsam und schwierig zu verwenden erscheinen, hat aber immer noch seine eigenen Anwendungsbereiche.  Immerhin ist dies ein vollwertiger Linux-Kernel, der von einem nicht privilegierten Benutzer aus arbeitet.  Mit dieser Funktion können Sie möglicherweise nicht vertrauenswürdigen Code ausführen, ohne den Host-Computer zu gefährden.  Und da es sich um einen vollwertigen Kernel handelt, sind seine Prozesse vom Host-Computer isoliert, <b>dh die im Benutzermodus ausgeführten</b> Prozesse sind für den Host <b>nicht sichtbar</b> .  Dies ist nicht wie der übliche Docker-Container. In diesem Fall sieht der Host-Computer immer die Prozesse im Repository.  Schauen Sie sich dieses Stück pstree von einem meiner Server an: <br><br><pre><code class="xml hljs">containerd─┬─containerd-shim─┬─tini─┬─dnsd───19*[{dnsd}] │ │ └─s6-svscan───s6-supervise │ └─10*[{containerd-shim}] ├─containerd-shim─┬─tini─┬─aerial───21*[{aerial}] │ │ └─s6-svscan───s6-supervise │ └─10*[{containerd-shim}] ├─containerd-shim─┬─tini─┬─s6-svscan───s6-supervise │ │ └─surl │ └─9*[{containerd-shim}] ├─containerd-shim─┬─tini─┬─h───13*[{h}] │ │ └─s6-svscan───s6-supervise │ └─10*[{containerd-shim}] ├─containerd-shim─┬─goproxy───14*[{goproxy}] │ └─9*[{containerd-shim}] └─32*[{containerd}]</code> </pre> <br>  Und vergleichen Sie dies mit dem pstree Linux-Kernel im Benutzermodus: <br><br><pre> <code class="xml hljs">linux─┬─5*[linux] └─slirp</code> </pre> <br>  Wenn ich mit Docker-Containern arbeite, kann ich die Namen der Prozesse sehen, die auf dem Gastsystem vom Host ausgeführt werden.  Im Linux-Benutzermodus ist dies nicht möglich.  Was bedeutet das?  Dies bedeutet, dass bei Überwachungstools, die über das Linux-Überwachungssubsystem arbeiten <b>, keine</b> Prozesse auf dem Gastsystem ausgeführt werden.  In einigen Situationen kann diese Funktion jedoch zu einem zweischneidigen Schwert werden. <br><br>  Im Allgemeinen besteht der gesamte nachstehende Beitrag aus einer Reihe von Studien und unhöflichen Versuchen, das gewünschte Ergebnis zu erzielen.  Dazu musste ich verschiedene alte Tools verwenden, die Kernelquellen lesen, den Code, der bereits in der Grundschule geschrieben wurde, intensiv debuggen und Heroku-Assemblys mithilfe eines speziellen Binars auf der Suche nach den benötigten Tools durchsuchen.  All diese Arbeit hat die Leute in meinem IRC dazu gebracht, mich Magie zu nennen.  Ich hoffe, dass dieser Beitrag als zuverlässige Dokumentation für jemanden dient, um alles gleich zu machen, aber mit neueren Kerneln und Betriebssystemversionen. <br><br><h3>  Anpassung </h3><br>  Das Einrichten des Linux-Benutzermodus umfasst mehrere Schritte: <br><br><ul><li>  Installieren von Abhängigkeiten auf dem Host; </li><li>  Herunterladen des Linux-Kernels </li><li>  Kernel Assembly Setup; </li><li>  Kernel-Assembly; </li><li>  binäre Installation; </li><li>  Einrichten des Gastdateisystems; </li><li>  Auswahl der Kernel-Startparameter; </li><li>  Gastnetzwerk einrichten; </li><li>  Starten des Gastkerns. </li></ul><br>  Ich gehe davon aus, dass Sie, wenn Sie sich dazu entschließen, alles selbst anzukurbeln, höchstwahrscheinlich alles tun werden, was in einem Ubuntu- oder Debian-ähnlichen System beschrieben ist.  Ich habe versucht, all das in meiner Lieblingsdistribution - Alpine - zu implementieren, aber es kam nichts dabei heraus, anscheinend, weil der Linux-Kernel eine enge Bindung zu Glibc-Ismen für Treiber im Benutzermodus hatte.  Ich habe vor, dies dem Upstream zu melden, nachdem ich das Problem endlich herausgefunden habe. <br><br><h3>  Installieren Sie Abhängigkeiten auf dem Host </h3><br>  Ubuntu benötigt mindestens die folgenden Pakete, um den Linux-Kernel zu erstellen (vorausgesetzt, eine Neuinstallation): <br><br> <code>- 'build-essential' <br> - 'flex' <br> - 'bison' <br> - 'xz-utils' <br> - 'wget' <br> - 'ca-certificates' <br> - 'bc' <br> - 'linux-headers'</code> <br> <br>  Sie können sie mit dem folgenden Befehl installieren (mit Root-Rechten oder mit sudo): <br><br><pre> <code class="xml hljs">apt-get -y install build-essential flex bison xz-utils wget ca-certificates bc \ linux-headers-$(uname -r)</code> </pre> <br>  Beachten Sie, dass zum Ausführen des Menü-Setup-Programms für den Linux-Kernel <code>libncurses-dev</code> installiert werden <code>libncurses-dev</code> .  Stellen Sie sicher, dass es mit dem folgenden Befehl installiert wird (mit Root-Rechten oder mit sudo): <br><br><pre> <code class="xml hljs">apt-get -y install libncurses-dev</code> </pre> <br><h3>  Kernel herunterladen </h3><br>  Bestimmen Sie den Ort für das Laden und die anschließende Montage des Kernels.  Für diesen Vorgang müssen Sie etwa 1,3 GB Festplattenspeicher zuweisen. Stellen Sie daher sicher, dass Sie über einen verfügen. <br><br>  Gehen Sie dann zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kernel.org</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">rufen</a> Sie die URL ab, um die neueste stabile Kernelversion herunterzuladen.  Zum Zeitpunkt des Schreibens dieses Beitrags: <a href="">https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.1.16.tar.xz</a> <br><br>  Laden Sie diese Datei mit <code>'wget'</code> herunter: <br><br><pre> <code class="xml hljs">wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.1.16.tar.xz</code> </pre> <br>  Und extrahieren Sie es mit <code>'tar'</code> : <br><br><pre> <code class="xml hljs">tar xJf linux-5.1.16.tar.xz</code> </pre> <br>  Jetzt geben wir das Verzeichnis ein, das beim Auspacken des Tarballs erstellt wurde: <br><br><pre> <code class="xml hljs">cd linux-5.1.16</code> </pre> <br><h3>  Kernel-Build-Konfiguration </h3><br>  Das Kernel-Build-System ist eine Sammlung von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Makefiles</a> mit <b>vielen</b> benutzerdefinierten Tools und Skripten zur Automatisierung des Prozesses.  Öffnen Sie zunächst das Online-Setup-Programm: <br><br><pre> <code class="xml hljs">make ARCH=um menuconfig</code> </pre> <br>  Die Montage wird teilweise abgeschlossen und ein Dialogfeld für Sie angezeigt.  Wenn unten im Fenster ' <code>[Select]</code> ' angezeigt wird, können Sie die Konfiguration mit den Leertasten oder der Eingabetaste vornehmen.  Navigation im Fenster wie gewohnt mit den Aufwärts- und Abwärtspfeilen der Tastatur und der Auswahl der Elemente - „links“ oder „rechts“. <br><br>  Ein Ansichtszeiger ---&gt; bedeutet, dass Sie sich in einem Untermenü befinden, auf das Sie mit der Eingabetaste zugreifen.  Der Ausweg führt offensichtlich über ' <code>[Exit]</code> '. <br><br>  Fügen Sie die folgenden Parameter in ' <code>[Select]</code> ' ein und stellen Sie sicher, dass sich neben ihnen ein '[*]' Symbol befindet: <br><br><pre> <code class="xml hljs">UML-specific Options: - Host filesystem Networking support (enable this to get the submenu to show up): - Networking options: - TCP/IP Networking UML Network devices: - Virtual network device - SLiRP transport</code> </pre> <br>  Alles aus diesem Fenster kann durch sequentielle Auswahl von ' <code>[Exit]</code> ' beendet werden.  Stellen Sie einfach sicher, dass Sie am Ende aufgefordert werden, die Konfiguration zu speichern, und wählen Sie " <code>[Yes]</code> ". <br><br>  Ich empfehle, dass Sie nach dem Lesen dieses Beitrags mit den Kernel-Build-Optionen herumspielen.  Dank dieser Experimente können Sie viel lernen, um die Arbeit der Kernelmechanik auf niedriger Ebene und den Einfluss verschiedener Flags auf ihre Assemblierung zu verstehen. <br><br><h3>  Kernel-Assembly </h3><br>  Der Linux-Kernel ist ein großartiges Programm, das viele Dinge tut.  Selbst bei einer derart minimalen Konfiguration alter Geräte kann die Montage einige Zeit dauern.  Erstellen Sie daher den Kernel mit dem folgenden Befehl: <br><br><pre> <code class="xml hljs">make ARCH=um -j$(nproc)</code> </pre> <br>  Warum?  Dieser Befehl weist unseren Assembler an, alle verfügbaren Kerne und Prozessorthreads während des Erstellungsprozesses zu verwenden.  Der <code>$(nproc)</code> am Ende von Build ersetzt die Ausgabe des <code>nproc</code> , der Teil von <code>coreutils</code> im Standard-Ubuntu-Build ist. <br><br>  Nach einiger Zeit wird unser Kernel in eine ausführbare <code>./linux</code> kompiliert. <br><br><h3>  Binäre Installation </h3><br>  Da der Benutzermodus unter Linux eine reguläre Binärdatei erstellt, können Sie diese wie jedes andere Dienstprogramm installieren.  So habe ich es gemacht: <br><br><pre> <code class="xml hljs">mkdir -p ~/bin cp linux ~/bin/linux</code> </pre> <br>  Es lohnt sich auch zu überprüfen, ob <code>~/bin</code> in Ihrem <code>$PATH</code> : <br><br><pre> <code class="xml hljs">export PATH=$PATH:$HOME/bin</code> </pre> <br><h3>  Einrichten des Gastdateisystems </h3><br>  Erstellen Sie ein Verzeichnis für das Gastdateisystem: <br><br><pre> <code class="xml hljs">mkdir -p $HOME/prefix/uml-demo cd $HOME/prefix</code> </pre><br>  Öffnen Sie alpinelinux.org und finden Sie im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Download-Bereich</a> den aktuellen Link zum Herunterladen von <code>MINI ROOT FILESYSTEM</code> .  Zum Zeitpunkt dieses Schreibens war es: <br><br><pre> <code class="xml hljs">http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-minirootfs-3.10.0-x86_64.tar.gz</code> </pre> <br>  Laden Sie diesen Tarball mit wget herunter: <br><br><pre> <code class="xml hljs">wget -O alpine-rootfs.tgz http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-minirootfs-3.10.0-x86_64.tar.gz</code> </pre> <br>  Geben Sie nun das Verzeichnis des Gastdateisystems ein und entpacken Sie das Archiv: <br><br><pre> <code class="xml hljs">cd uml-demo tar xf ../alpine-rootfs.tgz</code> </pre> <br>  Mit den beschriebenen Schritten wird eine kleine Dateisystemvorlage erstellt.  Aufgrund der Art des Systems ist die Installation von Paketen über den Alpine Apk Manager äußerst schwierig.  Dieser FS wird jedoch ausreichen, um die allgemeine Idee zu bewerten. <br><br>  Wir benötigen auch das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tini-</a> Tool, um den Speicherverbrauch durch die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zombie-Prozesse</a> unseres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gastkerns</a> zu unterdrücken. <br><br><pre> <code class="xml hljs">wget -O tini https://github.com/krallin/tini/releases/download/v0.18.0/tini-static chmod +x tini</code> </pre> <br><h3>  Erstellen einer Kernel-Befehlszeile </h3><br>  Der Linux-Kernel verfügt wie die meisten anderen Programme über Befehlszeilenargumente, auf die durch Angabe des Schalters <code>--help</code> zugegriffen werden kann. <br><br><div class="spoiler">  <b class="spoiler_title">Sam - Hilfe</b> <div class="spoiler_text"><pre> <code class="xml hljs">linux --help User Mode Linux v5.1.16 available at http://user-mode-linux.sourceforge.net/ --showconfig Prints the config file that this UML binary was generated from. iomem=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> Configure <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> as an IO memory region named <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>. mem=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">desired</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ram</span></span></span><span class="hljs-tag">&gt;</span></span> This controls how much "physical" memory the kernel allocates for the system. The size is specified as a number followed by one of 'k', 'K', 'm', 'M', which have the obvious meanings. This is not related to the amount of memory in the host. It can be more, and the excess, if it's ever used, will just be swapped out. Example: mem=64M --help Prints this message. debug this flag is not needed to run gdb on UML in skas mode root=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">containing</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">the</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">root</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fs</span></span></span><span class="hljs-tag">&gt;</span></span> This is actually used by the generic kernel in exactly the same way as in any other kernel. If you configure a number of block devices and want to boot off something other than ubd0, you would use something like: root=/dev/ubd5 --version Prints the version number of the kernel. umid=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> This is used to assign a unique identity to this UML machine and is used for naming the pid file and management console socket. con[0-9]*=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">&gt;</span></span> Attach a console or serial line to a host channel. See http://user-mode-linux.sourceforge.net/old/input.html for a complete description of this switch. eth[0-9]+=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transport</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">options</span></span></span><span class="hljs-tag">&gt;</span></span> Configure a network device. aio=2.4 This is used to force UML to use 2.4-style AIO even when 2.6 AIO is available. 2.4 AIO is a single thread that handles one request at a time, synchronously. 2.6 AIO is a thread which uses the 2.6 AIO interface to handle an arbitrary number of pending requests. 2.6 AIO is not available in tt mode, on 2.4 hosts, or when UML is built with /usr/include/linux/aio_abi.h not available. Many distributions don't include aio_abi.h, so you will need to copy it from a kernel tree to your /usr/include/linux in order to build an AIO-capable UML nosysemu Turns off syscall emulation patch for ptrace (SYSEMU). SYSEMU is a performance-patch introduced by Laurent Vivier. It changes behaviour of ptrace() and helps reduce host context switch rates. To make it work, you need a kernel patch for your host, too. See http://perso.wanadoo.fr/laurent.vivier/UML/ for further information. uml_dir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> The location to place the pid and umid files. quiet Turns off information messages during boot. hostfs=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span>,... This is used to set hostfs parameters. The root directory argument is used to confine all hostfs mounts to within the specified directory tree on the host. If this isn't specified, then a user inside UML can mount anything on the host that's accessible to the user that's running it. The only flag currently supported is 'append', which specifies that all files opened by hostfs will be opened in append mode.</code> </pre> <br></div></div><br>  Dieses Banner beleuchtet die Hauptstartoptionen.  Lassen Sie uns den Kernel mit den minimal erforderlichen Optionen ausführen: <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ init=/bin/sh</code> </pre> <br>  Die obigen Zeilen sagen unserem Kern Folgendes: <br><br><ul><li>  Angenommen, das Root-Dateisystem ist das Pseudogerät <code>/dev/root</code> . </li><li>  Wählen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hostfs</a> als Root-Dateisystemtreiber. </li><li>  Hängen Sie das Gastdateisystem ein, das wir auf dem Root-Gerät erstellt haben. </li><li>  Und ja, im Lese- / Schreibmodus. </li><li>  Verwenden Sie nur 64 Megabyte RAM (Sie können viel weniger verwenden, je nachdem, was Sie vorhaben, aber 64 MB scheinen die optimale Größe zu sein). </li><li>  Der Kernel startet <code>/bin/sh</code> automatisch als <code>init</code> Prozess. </li></ul><br>  Führen Sie diesen Befehl aus, und Sie sollten Folgendes erhalten: <br><br><div class="spoiler">  <b class="spoiler_title">Noch ein Blatt</b> <div class="spoiler_text"><pre> <code class="xml hljs">Core dump limits : soft - 0 hard - NONE Checking that ptrace can change system call numbers...OK Checking syscall emulation patch for ptrace...OK Checking advanced syscall emulation patch for ptrace...OK Checking environment variables for a tempdir...none found Checking if /dev/shm is on tmpfs...OK Checking PROT_EXEC mmap in /dev/shm...OK Adding 32137216 bytes to physical memory to account for exec-shield gap Linux version 5.1.16 (cadey@kahless) (gcc version 7.4.0 (Ubuntu 7.4.0-1ubuntu1~18.04.1)) #30 Sun Jul 7 18:57:19 UTC 2019 Built 1 zonelists, mobility grouping on. Total pages: 23898 Kernel command line: root=/dev/root rootflags=/home/cadey/dl/uml/alpine rootfstype=hostfs rw mem=64M init=/bin/sh Dentry cache hash table entries: 16384 (order: 5, 131072 bytes) Inode-cache hash table entries: 8192 (order: 4, 65536 bytes) Memory: 59584K/96920K available (2692K kernel code, 708K rwdata, 588K rodata, 104K init, 244K bss, 37336K reserved, 0K cma-reserved) SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=1, Nodes=1 NR_IRQS: 15 clocksource: timer: mask: 0xffffffffffffffff max_cycles: 0x1cd42e205, max_idle_ns: 881590404426 ns Calibrating delay loop... 7479.29 BogoMIPS (lpj=37396480) pid_max: default: 32768 minimum: 301 Mount-cache hash table entries: 512 (order: 0, 4096 bytes) Mountpoint-cache hash table entries: 512 (order: 0, 4096 bytes) Checking that host ptys support output SIGIO...Yes Checking that host ptys support SIGIO on close...No, enabling workaround devtmpfs: initialized random: get_random_bytes called from setup_net+0x48/0x1e0 with crng_init=0 Using 2.6 host AIO clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns futex hash table entries: 256 (order: 0, 6144 bytes) NET: Registered protocol family 16 clocksource: Switched to clocksource timer NET: Registered protocol family 2 tcp_listen_portaddr_hash hash table entries: 256 (order: 0, 4096 bytes) TCP established hash table entries: 1024 (order: 1, 8192 bytes) TCP bind hash table entries: 1024 (order: 1, 8192 bytes) TCP: Hash tables configured (established 1024 bind 1024) UDP hash table entries: 256 (order: 1, 8192 bytes) UDP-Lite hash table entries: 256 (order: 1, 8192 bytes) NET: Registered protocol family 1 console [stderr0] disabled mconsole (version 2) initialized on /home/cadey/.uml/tEwIjm/mconsole Checking host MADV_REMOVE support...OK workingset: timestamp_bits=62 max_order=14 bucket_order=0 Block layer SCSI generic (bsg) driver version 0.4 loaded (major 254) io scheduler noop registered (default) io scheduler bfq registered loop: module loaded NET: Registered protocol family 17 Initialized stdio console driver Using a channel type which is configured out of UML setup_one_line failed for device 1 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 2 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 3 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 4 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 5 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 6 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 7 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 8 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 9 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 10 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 11 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 12 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 13 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 14 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 15 : Configuration failed Console initialized on /dev/tty0 console [tty0] enabled console [mc-1] enabled Failed to initialize ubd device 0 :Couldn't determine size of device's file VFS: Mounted root (hostfs filesystem) on device 0:11. devtmpfs: mounted This architecture does not have kernel memory protection. Run /bin/sh as init process /bin/sh: can't access tty; job control turned off random: fast init done / #</code> </pre> <br></div></div><br>  Wenn Sie das oben Gesagte manipulieren, erhalten wir <b>mindestens</b> ein <b>Gastsystem</b> , ohne Dinge wie <code>/proc</code> oder einen zugewiesenen Hostnamen.  Versuchen Sie beispielsweise die folgenden Befehle: <br><br> <code>- uname -av <br> - cat /proc/self/pid <br> - hostname</code> <br> <br>  Geben Sie zum Beenden des Gastsystems <code>exit</code> oder drücken Sie Strg-d.  Dies wird die Shell abschießen, gefolgt von Kernel-Panik: <br><br><pre> <code class="xml hljs">/ # exit Kernel panic - not syncing: Attempted to kill init! exitcode=0x00000000 fish: “./linux root=/dev/root rootflag…” terminated by signal SIGABRT (Abort)</code> </pre> <br>  Wir haben diese Kernel-Panik, weil der Linux-Kernel glaubt, dass der Initialisierungsprozess immer läuft.  Ohne sie kann das System nicht mehr funktionieren und fährt herunter.  Da dies jedoch ein Prozess im Benutzermodus ist, sendet sich das Ergebnis an <code>SIGABRT</code> , was zum Beenden führt. <br><br><h3>  Gastnetzwerk einrichten </h3><br>  Und hier bei uns läuft alles nicht nach Plan.  Im Netzwerk im Benutzermodus Linux beginnt das gesamte Konzept eines eingeschränkten „Benutzermodus“ auseinanderzufallen.  Schließlich ist das Netzwerk normalerweise auf Systemebene aus allen von uns eindeutigen Gründen auf <b>privilegierte</b> Ausführungsmodi beschränkt. <br><br>  <i>Hinweis</i>  <i>trans.: Weitere Informationen zu den verschiedenen Optionen für die Arbeit mit dem Netzwerk in UML finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> .</i> <br><br><h3>  Reise zum Slirp </h3><br>  Es gibt jedoch ein altes und fast nicht unterstütztes Tool namens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Slirp</a> , mit dem Linux im Benutzermodus mit dem Netzwerk interagieren kann.  Es funktioniert ungefähr wie ein TCP / IP-Stack auf Benutzerebene und erfordert keine Systemberechtigungen, um ausgeführt zu werden.  Dieses Tool wurde <b>1995</b> veröffentlicht und das neueste Update stammt aus dem Jahr <b>2006</b> .  Slirp ist sehr alt.  Für eine Zeit ohne Support und Updates sind Compiler so weit gegangen, dass dieses Tool nur noch als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">„Code Rot“ bezeichnet werden kann</a> . <br><br>  Lassen Sie uns also Slirp aus den Ubuntu-Repositories rollen und versuchen, es auszuführen: <br><br><pre> <code class="xml hljs">sudo apt-get install slirp /usr/bin/slirp Slirp v1.0.17 (BETA) Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500, 115200 baud] SLiRP Ready ... fish: “/usr/bin/slirp” terminated by signal SIGSEGV (Address boundary error)</code> </pre> <br>  Oh Götter.  Lassen Sie uns einen Debugger für Slirp installieren und sehen, ob wir herausfinden können, was hier vor sich geht: <br><br><pre> <code class="xml hljs">sudo apt-get install gdb slirp-dbgsym gdb /usr/bin/slirp GNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git Copyright (C) 2018 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">licenses</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gpl.html</span></span></span><span class="hljs-tag">&gt;</span></span> This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type "show copying" and "show warranty" for details. This GDB was configured as "x86_64-linux-gnu". Type "show configuration" for configuration details. For bug reporting instructions, please see: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">software</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gdb</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bugs</span></span></span><span class="hljs-tag">/&gt;</span></span>. Find the GDB manual and other documentation resources online at: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">software</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gdb</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">documentation</span></span></span><span class="hljs-tag">/&gt;</span></span>. For help, type "help". Type "apropos word" to search for commands related to "word"... Reading symbols from /usr/bin/slirp...Reading symbols from /usr/lib/debug/.build-id/c6/2e75b69581a1ad85f72ac32c0d7af913d4861f.debug...done. done. (gdb) run Starting program: /usr/bin/slirp Slirp v1.0.17 (BETA) Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500, 115200 baud] SLiRP Ready ... Program received signal SIGSEGV, Segmentation fault. ip_slowtimo () at ip_input.c:457 457 ip_input.c: No such file or directory.</code> </pre> <br>  Der Fehler schlägt in <a href="">dieser Zeile</a> .  Schauen wir uns Stacktrace an, vielleicht hilft uns dort etwas: <br><br><pre> <code class="xml hljs">(gdb) bt full #0 ip_slowtimo () at ip_input.c:457 fp = 0x55784a40 #1 0x000055555556a57c in main_loop () at ./main.c:980 so = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> so_next = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> timeout = {tv_sec = 0, tv_usec = 0} ret = 0 nfds = 0 ttyp = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> ttyp2 = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> best_time = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> tmp_time = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> #2 0x000055555555b116 in main (argc=1, argv=0x7fffffffdc58) at ./main.c:95 No locals.</code> </pre> <br>  Hier sehen wir, dass ein Fehler beim Start der Hauptschleife auftritt, wenn slirp versucht, Zeitüberschreitungen zu überprüfen.  Zu diesem Zeitpunkt musste ich den Versuch des Debuggens aufgeben.  Aber mal sehen, ob Slirp, das aus Sortierungen kompiliert wurde, funktioniert.  Ich habe das Archiv direkt von der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sourceforge-</a> Website neu geladen, da das Ziehen von dort über die Befehlszeile schmerzhaft ist: <br><br><pre> <code class="xml hljs">cd ~/dl wget https://xena.greedo.xeserv.us/files/slirp-1.0.16.tar.gz tar xf slirp-1.0.16.tar.gz cd slirp-1.0.16/src ./configure --prefix=$HOME/prefix/slirp make</code> </pre> <br>  Hier sehen wir Warnungen über undefinierte integrierte Funktionen, dh über die Unmöglichkeit, die resultierende Binärdatei zu verknüpfen.  Es scheint, dass gcc zwischen 2006 und diesem Moment aufgehört hat, Zeichen zu erstellen, die in den integrierten Funktionen von kompilierten Zwischendateien verwendet werden.  Versuchen wir, das <code>inline</code> durch einen leeren Kommentar zu ersetzen, und sehen wir uns das Ergebnis an: <br><br><pre> <code class="xml hljs">vi slirp.h :6 a <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">enter</span></span></span><span class="hljs-tag">&gt;</span></span> #define inline /**/ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">escape</span></span></span><span class="hljs-tag">&gt;</span></span> :wq make</code> </pre> <br>  Nein.  Dies funktioniert auch nicht.  Sie können die Zeichen für diese Funktionen immer noch nicht finden. <br><br>  Zu diesem Zeitpunkt gab ich auf und suchte nach <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Heroku-Build-Paketen</a> auf Github.  Meine Theorie basierte auf der Tatsache, dass einige Heroku-Build-Pakete die Binärdateien enthalten, die ich benötige.  Infolgedessen führte mich die Suche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hierher</a> .  Ich habe <code>uml.tar.gz</code> heruntergeladen und entpackt und Folgendes gefunden: <br><br><pre> <code class="xml hljs">total 6136 -rwxr-xr-x 1 cadey cadey 79744 Dec 10 2017 ifconfig* -rwxr-xr-x 1 cadey cadey 373 Dec 13 2017 init* -rwxr-xr-x 1 cadey cadey 149688 Dec 10 2017 insmod* -rwxr-xr-x 1 cadey cadey 66600 Dec 10 2017 route* -rwxr-xr-x 1 cadey cadey 181056 Jun 26 2015 slirp* -rwxr-xr-x 1 cadey cadey 5786592 Dec 15 2017 uml* -rwxr-xr-x 1 cadey cadey 211 Dec 13 2017 uml_run*</code> </pre> <br>  Dies ist eine binäre Slirp-Datei!  Arbeitet er <br><br><pre> <code class="xml hljs">./slirp Slirp v1.0.17 (BETA) FULL_BOLT Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500] SLiRP Ready ...</code> </pre><br>  Stürzt nicht ab - also sollte es funktionieren!  Lassen Sie uns diese Binärdatei in <code>~/bin/slirp</code> : <br><br><pre> <code class="xml hljs">cp slirp ~/bin/slirp</code> </pre> <br>  Für den Fall, dass der Ersteller des Pakets es entfernt, habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Spiegel gemacht</a> . <br><br><h3>  Netzwerkeinrichtung </h3><br>  Jetzt richten wir das Netzwerk auf unserem Gastkern ein.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Startoptionen aktualisieren</a> : <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ eth0=slirp,,$HOME/bin/slirp \ init=/bin/sh</code> </pre> <br>  Jetzt schalten wir das Netzwerk ein: <br><br><pre> <code class="xml hljs">mount -t proc proc proc/ mount -t sysfs sys sys/ ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 route add default gw 10.0.2.2</code> </pre> <br>  Die ersten beiden Konfigurationsbefehle <code>/proc</code> und <code>/sys</code> benötigt, damit <code>ifconfig</code> funktioniert. Dadurch wird eine Netzwerkschnittstelle für die Kommunikation mit Slirp eingerichtet.  Der Befehl <code>route</code> richtet eine Kernel-Routing-Tabelle ein, um den gesamten Datenverkehr durch den Slirp-Tunnel zu erzwingen.  Lassen Sie uns dies mit einer DNS-Abfrage überprüfen: <br><br><pre> <code class="xml hljs">nslookup google.com 8.8.8.8 Server: 8.8.8.8 Address 1: 8.8.8.8 dns.google Name: google.com Address 1: 172.217.12.206 lga25s63-in-f14.1e100.net Address 2: 2607:f8b0:4006:81b::200e lga25s63-in-x0e.1e100.net</code> </pre> <br>  Es funktioniert! <br><br>  <i>Hinweis: Anscheinend wurde der ursprüngliche Beitrag mit einer kabelgebundenen Netzwerkkarte oder einer anderen Konfiguration, für die keine zusätzlichen Treiber erforderlich sind, auf dem Desktop geschrieben.</i>  <i>Auf einem Laptop mit WiFi 8265 von Intel tritt beim Erhöhen des Netzwerks ein Fehler auf</i> <br><br><pre> <code class="bash hljs">/ <span class="hljs-comment"><span class="hljs-comment"># ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 slirp_tramp failed - errno = 2 ifconfig: ioctl 0x8914 failed: No such file or directory / #</span></span></code> </pre> <br>  <i>Anscheinend kann der Kernel nicht mit dem Netzwerktreiber kommunizieren.</i>  <i>Ein Versuch, Firmware in den Kernel zu kompilieren, konnte die Situation leider nicht beheben.</i>  <i>Zum Zeitpunkt der Veröffentlichung war es in dieser speziellen Konfiguration nicht möglich, eine Lösung zu finden.</i>  <i>Bei einfacheren Konfigurationen (z. B. in Virtualbox) steigt die Schnittstelle korrekt an.</i> <br><br>  Lassen Sie uns die Umleitung mithilfe des folgenden Shell-Skripts automatisieren: <br><br><pre> <code class="xml hljs">#!/bin/sh # init.sh mount -t proc proc proc/ mount -t sysfs sys sys/ ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 route add default gw 10.0.2.2 echo "networking set up" exec /tini /bin/sh</code> </pre> <br>  Und markieren Sie es als ausführbar: <br><br><pre> <code class="xml hljs">chmod +x init.sh</code> </pre> <br>  Nehmen Sie dann Änderungen an der Kernel-Befehlszeile vor: <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ eth0=slirp,,$HOME/bin/slirp \ init=/init.sh</code> </pre><br>  Und wiederhole: <br><br><pre> <code class="xml hljs">SLiRP Ready ... networking set up /bin/sh: can't access tty; job control turned off nslookup google.com 8.8.8.8 Server: 8.8.8.8 Address 1: 8.8.8.8 dns.google Name: google.com Address 1: 172.217.12.206 lga25s63-in-f14.1e100.net Address 2: 2607:f8b0:4004:800::200e iad30s09-in-x0e.1e100.net</code> </pre> <br>  Das Netzwerk ist stabil! <br><br><h3>  Docker-Datei </h3><br>       ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dockerfile</a> ,           .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> ,    ,    .   ,       . <br><br><hr><br>  ,      ,    .  - ,          ,    User Mode  Linux       .                .     Docker —    tar-,         <code>docker export</code> ,            . ,    shell-. <br><br>   Rkeene  #lobsters  Freenode.      Slirp      .    ,    Slackware    slirp,    Ubuntu  Alpine   slirp    Rkeene .     ,      -. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de459558/">https://habr.com/ru/post/de459558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de459542/index.html">Gamification Mechanics: Fähigkeitsbaum</a></li>
<li><a href="../de459544/index.html">Warum die Tschernobyl-Reihe die Kernenergie so schlecht beschrieb</a></li>
<li><a href="../de459550/index.html">Backup, Teil 5: Testen von Bacula und Veeam Backup für Linux</a></li>
<li><a href="../de459552/index.html">So verlieren Sie den Zugriff auf das Live-System, indem Sie einfach den Quellcode fummeln</a></li>
<li><a href="../de459554/index.html">Verfolgen Sie Dateiänderungen mithilfe von Alerting OpenDistro for Elasticsearch</a></li>
<li><a href="../de459560/index.html">Funktionen von Container-Rechenzentren: Fertige Vermittlungsstelle in Myanmar in 50 Tagen</a></li>
<li><a href="../de459562/index.html">Differenzierbare Programmierung</a></li>
<li><a href="../de459564/index.html">Was Entwickler über das Geschäft wissen müssen</a></li>
<li><a href="../de459568/index.html">Vertikaler Buchstabe in der modernen IT</a></li>
<li><a href="../de459570/index.html">Beeline zeigt Anzeigen für Google Bot. Bot unglücklich</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>