<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍✈️ 🕠 🦆 Parlons de la journalisation 🏞️ 👩‍👩‍👧‍👧 👩‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est inspiré du sujet du Go Forum lancé par Nate Finch. Ce post est axé sur Go, mais si vous dépassez cela, je pense que les idées présenté...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Parlons de la journalisation</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440200/">  Cet article est inspiré du sujet du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Go Forum</a> lancé par Nate Finch.  Ce post est axé sur Go, mais si vous dépassez cela, je pense que les idées présentées ici sont largement applicables. <br><br><h2>  Pourquoi n'y a-t-il pas d'amour? </h2><br>  Le package de journaux dans Go n'a pas de niveau pour les journaux; vous pouvez ajouter manuellement les préfixes DEBUG, INFO, WARN et ERROR.  En outre, le type d'enregistreur dans Go n'a pas la possibilité d'activer ou de désactiver ces niveaux séparément pour les packages sélectionnés.  À titre de comparaison, regardons quelques remplacements de développeurs tiers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/df2/fc3/3ed/df2fc33ed7ebb1457c25060bbb1f98a7.png" alt="image"><br><br>  Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">glog</a> a des niveaux: <br><br><ul><li>  Info </li><li>  Avertissement </li><li>  Erreur </li><li>  Fatal (termine le programme) </li></ul><br>  Regardons une autre bibliothèque, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">loggo</a> , développée pour Juju, les niveaux y sont disponibles: <br><br><ul><li>  Trace </li><li>  Déboguer </li><li>  Info </li><li>  Avertissement </li><li>  Erreur </li><li> Critique </li></ul><br>  Loggo a également la possibilité de définir le niveau de détail du journal pour les packages souhaités individuellement. <br><br>  Voici deux exemples, clairement créés sous l'influence d'autres bibliothèques pour se connecter dans d'autres langues. <br><br>  En fait, leur origine peut être retracée à syslog (3), peut-être même plus tôt.  Et je pense qu'ils ont tort. <br><br>  Je veux prendre une position controversée.  Je pense que toutes les bibliothèques de journaux sont mauvaises car elles offrent trop de fonctionnalités;  un ensemble étonnant de fonctionnalités qui stupéfie le programmeur au moment même où il doit penser clairement à la façon de communiquer avec le lecteur du futur, avec qui verra ces magazines. <br><br>  Je soutiens que les packages de journaux réussis nécessitent beaucoup moins de fonctionnalités et, bien sûr, moins de niveaux. <br><a name="habracut"></a><br><h2>  Parlons des avertissements (AVERTISSEMENT) </h2><br>  Commençons par le plus simple.  Personne n'a besoin du niveau de journalisation AVERTISSEMENT (avertissement). <br><br>  Personne ne lit les avertissements, car par définition, rien de mauvais ne s'est produit.  Peut-être que quelque chose va mal à l'avenir, mais cela ressemble à quelqu'un d'autre, pas à mon problème. <br><br>  De plus, si vous utilisez une sorte de journalisation à plusieurs niveaux, pourquoi devez-vous définir le niveau AVERTISSEMENT?  Vous définiriez le niveau sur INFO ou ERREUR.  La définition du niveau AVERTISSEMENT signifie que vous signalez probablement des erreurs au niveau AVERTISSEMENT. <br><br>  Exclure le niveau d'avertissement - il s'agit soit d'un message d'information, soit d'une erreur. <br><br><h2>  Parlons du niveau d'erreur fatale </h2><br>  Le niveau FATAL enregistre en fait le message, puis appelle os.Exit (1).  En principe, cela signifie: <br><br><ul><li>  les expressions différées dans d'autres routines (goroutines) ne sont pas exécutées; </li><li>  les tampons ne sont pas vidés; </li><li>  les fichiers et répertoires temporaires ne sont pas supprimés. </li></ul><br>  En substance, log.Fatal est moins verbeux, mais sémantiquement équivalent à la panique. <br><br>  Il est généralement admis que les bibliothèques ne doivent pas utiliser panic1, mais si l'appel à log.Fatal2 a le même effet, il doit également être désactivé. <br><br>  L'hypothèse selon laquelle ce problème de nettoyage peut être résolu en enregistrant des gestionnaires d'arrêt dans l'enregistreur fournit une relation étroite entre l'enregistreur utilisé et chaque endroit où les opérations de nettoyage se produisent.  Il viole également la séparation des intérêts. <br><br>  N'enregistrez pas de messages avec un niveau FATAL, préférez renvoyer une erreur à l'appelant à la place.  Si l'erreur atteint main.main, c'est le bon endroit pour effectuer un nettoyage avant de fermer le programme. <br><br><h2>  Parlons de l'erreur (niveau ERREUR) </h2><br>  La gestion des erreurs et la journalisation sont étroitement liées, par conséquent, à première vue, la journalisation du niveau d'erreur (ERREUR) devrait être facilement justifiée.  Je ne suis pas d'accord. <br><br>  Dans Go, si l'appel d'une fonction ou d'une méthode renvoie une valeur d'erreur, vous avez vraiment deux options: <br><br><ul><li>  gérer l'erreur. </li><li>  retourner une erreur à son appelant.  Vous pouvez magnifiquement emballer une erreur dans un emballage cadeau (emballage cadeau), mais ce n'est pas important pour cette discussion. </li></ul><br>  Si vous décidez de traiter l'erreur en l'écrivant dans le journal, alors par définition ce n'est plus une erreur - vous l'avez traitée.  Le fait d'enregistrer l'erreur elle-même est le traitement de l'erreur; il n'est donc plus conseillé de l'écrire dans le journal comme une erreur. <br><br>  Permettez-moi de vous convaincre avec ce morceau de code: <br><br><pre><code class="go hljs">err := somethingHard() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Error(<span class="hljs-string"><span class="hljs-string">"oops, something was too hard"</span></span>, err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err <span class="hljs-comment"><span class="hljs-comment">// what is this, Java ? }</span></span></code> </pre> <br>  Vous ne devez jamais enregistrer quoi que ce soit au niveau de l'erreur car vous devez soit gérer l'erreur, soit la transmettre à l'appelant. <br><br>  Vous devez comprendre clairement, je ne dis pas que vous ne devriez pas écrire dans le journal qu'un changement d'état s'est produit: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := planA(); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Infof(<span class="hljs-string"><span class="hljs-string">"could't open the foo file, continuing with plan b: %v"</span></span>, err) planB() }</code> </pre><br>  Mais en réalité, log.Info et log.Error ont le même objectif. <br><br>  Je ne dis pas "ne pas enregistrer d'erreurs"!  Au lieu de cela, je pose la question, quelle est la plus petite API possible pour la journalisation?  Et quand il s'agit d'erreurs, je crois que la grande majorité des choses enregistrées au niveau ERREUR sont simplement faites parce qu'elles sont liées à l'erreur.  En fait, ils sont juste informatifs, nous pouvons donc supprimer la journalisation au niveau des erreurs (ERROR) de notre API. <br><br><h2>  Que reste-t-il? </h2><br>  Nous avons exclu AVERTISSEMENT, soutenu que rien ne devrait être enregistré au niveau d'erreur (ERREUR) et montré que seule l'application de niveau supérieur devrait avoir une sorte de comportement log.Fatal.  Que reste-t-il? <br><br>  Je pense qu'il n'y a que deux choses que vous devez vous connecter: <br><br><ul><li>  les choses dont les développeurs se soucient lorsqu'ils développent ou déboguent un programme; </li><li>  les choses qui intéressent les utilisateurs lorsqu'ils utilisent votre programme. </li></ul><br>  De toute évidence, il s'agit des niveaux de débogage (DEBUG) et d'information (INFO), respectivement. <br><br>  log.Info devrait simplement écrire cette ligne dans la sortie du journal.  Il ne devrait pas être possible de le désactiver, car l'utilisateur ne devrait dire que ce qui lui est utile.  Si une erreur se produit qui ne peut pas être traitée, elle devrait apparaître dans main.main où le programme se termine.  L'inconvénient mineur d'avoir à insérer le préfixe FATAL avant le message de journal final ou à écrire directement dans os.Stderr à l'aide de fmt.Fprintf n'est pas une raison suffisante pour étendre le package avec la méthode log.Fatal. <br><br>  log.Debug, c'est une question complètement différente.  Un développeur ou un ingénieur de support en a besoin pour contrôler le programme.  Pendant le développement, les expressions de débogage doivent être nombreuses sans recourir au niveau de trace ou debug2 (vous savez qui vous êtes).  Le package de journalisation doit prendre en charge le contrôle granulaire pour activer ou désactiver les expressions de débogage pour les packages souhaités dans le package, ou peut-être même dans une portée plus étroite. <br><br><h2>  Conclusion </h2><br>  S'il s'agissait d'un sondage Twitter, je vous demanderais de choisir entre <br><br><ul><li>  la journalisation est importante </li><li>  la journalisation est difficile </li></ul><br>  Mais le fait est que la journalisation est à la fois.  La solution à ce problème DOIT être de détruire et de réduire sans pitié les distractions inutiles. <br><br>  Qu'en penses-tu?  Est-ce assez extravagant pour fonctionner, ou est-ce simplement extravagant? <br><br><h2>  Remarques </h2><br>  Certaines bibliothèques peuvent utiliser la panique / récupération comme mécanisme de flux de contrôle interne, mais le mantra principal est qu'elles ne devraient pas permettre à ces opérations de flux de contrôle de sortir de la limite du package. <br><br>  Ironiquement, bien qu'il n'ait pas de niveau de sortie DEBUG, le package de journalisation Go standard a des fonctionnalités Fatal et Panic.  Dans ce package, le nombre de fonctions qui conduisent à l'arrêt brutal du programme dépasse le nombre de celles qui ne le font pas. <br><br><h2>  À propos de l'auteur </h2><br>  L'auteur de cet article, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dave Cheney</a> , est l'auteur de nombreux packages populaires pour Go, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/pkg/errors</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://github.com/davecheney/">github.com/davecheney/httpstat</a> .  Vous pouvez évaluer vous-même l'autorité et l'expérience de l'auteur. <br><br><h2>  Du traducteur </h2><br>  De nombreux développeurs sont préoccupés par la journalisation, certains ont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">discuté de l'</a> ajout d'une interface Logger à la bibliothèque Go standard pour rationaliser la journalisation dans les bibliothèques et stimuler ainsi leurs développeurs.  Les gars ont même rédigé leur proposition et mis le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">document en</a> discussion. <br><br>  Plus la réflexion sur la présentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Avons-nous besoin d'un nouvel enregistreur et quel devrait-il être?</a>  de Chris Hines. <br><br>  Il existe plusieurs implémentations des idées de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">go-log</a> de Dave et un petit hors-sujet sur la question du niveau ERREUR et un package <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">logr</a> plus élaboré. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr440200/">https://habr.com/ru/post/fr440200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr440188/index.html">Atteindre les étoiles: maîtriser les opérateurs Ansible pour gérer les applications dans Kubernetes</a></li>
<li><a href="../fr440190/index.html">Connaissance du réseau neuronal le plus simple et de sa mise en œuvre pas à pas</a></li>
<li><a href="../fr440192/index.html">Comment créons-nous la radio d'entreprise pour</a></li>
<li><a href="../fr440196/index.html">Secrets d'esprit et mathématiques</a></li>
<li><a href="../fr440198/index.html">Nouvelles imprimantes 3D DWS pour les professionnels</a></li>
<li><a href="../fr440202/index.html">Contrôles proactifs OWASP: Liste des prérequis pour les développeurs de logiciels</a></li>
<li><a href="../fr440204/index.html">Routeur CNC de bricolage. Sciences humaines pour les sciences humaines</a></li>
<li><a href="../fr440206/index.html">Ampoules «toute l'année»</a></li>
<li><a href="../fr440208/index.html">Explorer les limites de bande passante de Kafka sur Dropbox</a></li>
<li><a href="../fr440210/index.html">Approche synesthésique de la machine pour détecter les attaques DDoS réseau. Partie 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>