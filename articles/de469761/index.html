<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤰🏻 🥧 🤞🏼 Wie implementiere ich Analysen und breche die Anwendung nicht? 👩🏿‍🏭 👩🏾‍💻 👨🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Ich heiße Sosnin Ilya. Ich arbeite bei Lamoda Android Entwickler. Ich male Schaltflächen, überspringe Listen und schreibe leider Analysen ... 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie implementiere ich Analysen und breche die Anwendung nicht?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/469761/"> Hallo!  Ich heiße Sosnin Ilya.  Ich arbeite bei Lamoda Android Entwickler.  Ich male Schaltflächen, überspringe Listen und schreibe leider Analysen ... <br><br>  Lamoda ist ein datengesteuertes Unternehmen, bei dem alle Entscheidungen auf der Grundlage des Benutzerverhaltens getroffen werden.  Zuerst beobachten wir und ziehen erst dann Schlussfolgerungen.  Daher ist es leicht zu erraten, dass wir Analysen haben und diese wirklich brauchen. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wenn ich</a> meinen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht von Mitap Mosdroid # 18 Argon</a> entschlüssele <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, erkläre</a> ich Ihnen, wie unser SDK <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">funktioniert</a> und warum Reflexion nicht immer schlecht ist.  Außerdem beantworte ich die Hauptfrage zu diesem Thema: "Wie implementiere ich Analysen, ohne die Anwendung zu beschädigen?". <br><img src="https://habrastorage.org/webt/l9/c8/yd/l9c8ydu-xkfvholrwahstcndmg0.png" alt="Bild"><br>  Zunächst stelle ich Ihnen eine einfache Frage: "Wie denken Sie, wie viele Installationen haben wir bei Google Play?" <br><a name="habracut"></a><br>  10 Millionen Installationen! <br><img src="https://habrastorage.org/webt/ta/vl/z8/tavlz80t36oelmjkxtmamhpbwwg.png" alt="Bild"><br>  <i>Indikator Anfang Juli 2019.</i> <i><br></i> <br>  Neben der Tatsache, dass wir auf der Grundlage der Benutzer Schlussfolgerungen ziehen, haben wir auch interne Kunden, die sich auch für Analysen interessieren. <br><img src="https://habrastorage.org/webt/u6/tk/st/u6tkstig2dyvpjlh3g3w44s305y.png" alt="Bild"><br><br>  Zuallererst benötigt Marketing Analysen für seine eigenen Forschungszwecke.  F &amp; E kontrolliert unsere Suchanfragen auf Kosten der Produkte, und Produkte werden mit neuen Funktionen ausgeführt. <br><br>  Zum Beispiel hatten wir eine Funktion, mit der wir das gesamte Bild als Ganzes erfassen konnten.  Das heißt, Sie können nicht nur das Hemd kaufen, das Ihnen am Modell gefallen hat, sondern auch Hosen vom selben Bild.  Wir haben uns entschlossen, es zunächst für IOS zu schreiben und dann darüber nachzudenken, ob wir es überhaupt brauchen.  Sie schrieben, schauten und stellten sicher, dass es den Benutzern nicht gefiel. <br><br><img src="https://habrastorage.org/webt/87/r6/rm/87r6rmysut2j8_r5lfdotrvufbu.png" alt="Bild"><br><br>  Was sollte Ihrer Meinung nach mit Funktionen getan werden, die die Benutzer nicht benötigen? <br><br>  <b>Richtig, wirf sie weg!</b>  Dies ist besonders dann sinnvoll, wenn die Funktion an externe Dienste gebunden ist, da diese Probleme erhalten oder möglicherweise bezahlt werden.  Dies geschah mit dieser Funktion.  Wir haben weder Android noch Desktop implementiert, sondern beschlossen, es weiterzuentwickeln.  (Vielleicht geht sie eines Tages in perfekterer Form zum Produkt). <br><br><h2>  Was ist die Schwierigkeit? </h2><br>  Unabhängig davon, wie lustig dies klingen mag, kann es bei der Einführung von Analysen <b>schwierig sein, mit den Analysten selbst zusammenzuarbeiten</b> .  In den meisten Fällen treten Konflikte auf, weil Sie nach Daten gefragt werden, über die Sie nicht verfügen.  Und es endet immer damit, dass Sie immer noch eine Reihe von Parametern durch 10 Bildschirme ziehen müssen, um ihnen ein kleines Ereignis zu senden.  Und das passiert ziemlich oft. <br><br>  Die zweite Herausforderung ist das <b>Sammeln von Analysen</b> .  Wir haben diesen Prozess in 7 Systemen durchgeführt. <br><br><img src="https://habrastorage.org/webt/7m/j2/ua/7mj2ua32vv5afydoioxpifcgi7o.png" alt="Bild"><br><br>  Einige Ereignisse gehen an ein System, andere an mehrere gleichzeitig ... Und es gibt eine solche Besonderheit, dass Ereignisse mit unterschiedlichen Parametern und in unterschiedlichen Formaten an unterschiedliche Systeme gesendet werden können.  Natürlich möchten wir all diese Abhängigkeiten nicht wirklich auflösen. <br><br><blockquote>  <i>LStat ist unser eigenes SDK (Lamoda Statistics).</i>  <i>Dies ist ein massives System, das mehr als 60% der verschiedenen Ereignisse umfasst.</i>  <i>Die Ereignisse, die weiter zu Google, Adjust, gehen, wurden häufig zunächst nur in LStat erfasst.</i> <br></blockquote><br><h2>  SDK </h2><br>  Unser SDK lautet wie folgt. <br><img src="https://habrastorage.org/webt/ne/ew/ah/neewahjaa6gb3tux9c0io9uyhe8.png" alt="Bild"><br><br>  Es ragt ein sauberer LStat heraus, der innen aus zwei Teilen besteht: Lagerung und Versand.  Wenn wir eine Veranstaltung abholen, senden wir sie nicht sofort.  Andernfalls würde es zu viele Ereignisse und Anfragen geben, was nicht sehr praktisch ist.  Deshalb legen wir alles in unsere kleine SQLite-Datenbank, in der wir alles speichern.  In einigen Abständen zieht unsere Netzwerkschicht die Daten aus der Datenbank und sendet sie. <br><br>  Nachdem wir vom Server eine Bestätigung erhalten haben, dass die Ereignisse eingetroffen sind, löschen wir unsere Datenbank.  Dieser Vorgang findet regelmäßig statt.  Dank dessen wächst unsere Basis nicht und wir garantieren die Lieferung aller Veranstaltungen.  Wenn das Ereignis aus irgendeinem Grund nicht eingetroffen ist, wird es in unserer Datenbank gespeichert, bis eine Antwort vom Server empfangen wird. <br><br><h2>  Sammler </h2><br>  Wie ich bereits sagte, haben wir 7 Sammler.  Sie bestehen aus solchen Methoden: benutzerdefinierte Annotation, EventHandler und AppStartEvent.  Was denkst du, verfolgt diese Veranstaltung? <br><img src="https://habrastorage.org/webt/_d/tw/lo/_dtwloqivw9wcguv-egiwjznvje.png" alt="Bild"><br><br>  Dies ist natürlich ein Kaltstart für die Anwendung.  Und die Hauptsache hier ist, dass wir eine AppStartEvent-Klasse haben, die von einer Ereignisschnittstelle erbt.  Und warum brauchen wir das, werde ich etwas später erzählen. <br><br>  Wie geht es dir  Hier beginnt der Schlag, das Brennen und das Nachdenken. <br><img src="https://habrastorage.org/webt/2t/cl/4y/2tcl4yjenftx0thk3plkagyrh4k.png" alt="Bild"><br><br>  Zuerst gehen wir alle unsere 7 Sammler durch.  Dann ziehen wir die Java-Klasse und den CollectorName heraus, die wir später zum Speichern benötigen. <br><br>  Außerdem nehmen wir aus dieser Java-Klasse alle unsere Methoden heraus, die in diesem Code enthalten sind.  Jetzt müssen wir überprüfen und sicherstellen, dass unsere Methode eine Track-Event-Methode ist, die für die Speicherung verantwortlich ist.  Zu diesem Zweck haben wir mehrere Parameter: Der erste ist, dass wir die Annotation @EventHandler haben, keine leere Liste von Parametern haben und ein Ereignis zur Eingabe kommt. <br><br>  Alle Bedingungen sind erfüllt, sodass wir davon ausgehen können, dass diese Funktion bei uns ein Ereignis sein wird.  Ich wickle es einfach in eine Hülle und sende es an unsere Sammlung. <br><br><h2>  Reflexion ist nicht immer schlecht </h2><br>  Ja, viele von Ihnen werden sagen, dass Reflexion schlecht, langsam und schrecklich ist. <br><img src="https://habrastorage.org/webt/cm/zz/k4/cmzzk4pcnh35oztvvtj7iglwc5a.png" alt="Bild"><br>  Zunächst kann es entweder langsam oder schnell sein.  Es gibt Methoden wie getFields, getConstructors, die im Vergleich zum Rest der Reflexion sehr schnell arbeiten.  Und es gibt zum Beispiel den Konstruktor newInstance, der sehr langsam arbeitet.  Mit dem Wort "langsam" meine ich den Unterschied zwischen der linken und der rechten Spalte in der obigen Tabelle um mehrere Größenordnungen (ungefähr hundertfacher Unterschied).  Wenn Sie also verstehen, was Sie tun, und im Voraus wissen, worauf Sie vorbereitet sein müssen, ist nicht alles so beängstigend. <br><br>  <b>Wir ziehen mehr als 500 Methoden aus 7 Klassen</b> .  Und wir machen das nur einmal pro Sitzung.  Die Zeit für eine Passage beträgt 40 Millisekunden.  Dies sind weniger als 3 Frames (im Splash-Screen-Stadium).  Und es war weit entfernt von einem Top-End-Gerät, sondern ein einfaches NTC für Android 6, das es schon seit vielen Jahren gibt. <br><br>  Natürlich funktioniert auf einem Top-End-Gerät alles schneller.  Und wenn wir über alte chinesische Telefone sprechen, beträgt die dort verbrachte Zeit 100 Millisekunden.  Benutzer solcher Telefone sind bereits daran gewöhnt, dass für sie alles langsam funktioniert, sodass ihnen 40 Millisekunden oder 100 Millisekunden dort zutiefst gleichgültig sind. Was ist der Unterschied?  Sie werden immer langsamer :) <br><br>  Und jetzt die Hauptfrage: Wie kann man Analysen implementieren, um die Architektur nicht zu beschädigen? <br><br><h2>  Architekt </h2><br>  Unsere Anwendung verwendet MVP. <br><img src="https://habrastorage.org/webt/pi/dm/ft/pidmft4pgrgukv_lirindko4qu4.png" alt="Bild"><br><br>  Dies ist unsere Art von Gottessenz, die auf ApplicationScope „lebt“ und genau dort injiziert wird, wo wir sie brauchen.  Zum Beispiel müssen wir onClick () einzahlen.  Um die Architektur nicht zu beschädigen, leiten wir das Ereignis nicht von der Ansichtsebene an Presenter weiter, damit es später irgendwohin geht.  Stattdessen erledigen wir alles direkt aus der Ansicht und übergeben den Track an den AnalyticsManager. <br><br>  Und jetzt ein bisschen über das Senden.  Bei AnalyticsManager sticht eine Methode hervor - dies ist die Track-Methode, die jede Ereignisklasse als Eingabe akzeptiert.  Und dann passiert schwarze Magie. <br><br><img src="https://habrastorage.org/webt/em/pi/kj/empikjusbjqotluav-_aclnwx94.png" alt="Bild"><br><br>  Diese Methode kann alle unsere Probleme lösen. <br><br>  Erstens wird es hilfreich sein, <b>in mehreren verschiedenen Systemen einzuzahlen</b> .  Handler sind alle unsere Ereignisse, die jemals gesammelt werden.  Als nächstes suchen wir hier nach der gewünschten Methode.  Wenn wir also ein Track-Ereignis beispielsweise in 4 Sammlern geschrieben haben, wird es in 4 Kopien gespeichert.  Das heißt, in 4 Durchgängen des Zyklus werden wir es finden und an alle 4 Systeme mit den entsprechenden Parametern senden. <br><br>  Zweitens <b>hilft es, das Problem mit einmaligen Ereignissen zu lösen</b> .  Dies sind solche Ereignisse, die für den gesamten Zyklus der Anwendung nur einmalig verpfändet werden müssen.  Markieren Sie e.once, die übliche boolesche Variable.  Wenn wir sagen, dass dies ein einmaliges Ereignis ist, löschen wir es einfach aus der Sammlung.  Was passiert als nächstes, wenn wir versuchen, es erneut zu verpfänden?  Offensichtlich werden wir es in dieser Sammlung einfach nicht finden.  Sie können versuchen, sich so viel in den Fuß zu schießen, wie Sie möchten, während Sie weiterhin analyseManager.track (AppStartEvent ()) schreiben. Es wird immer noch einmal gehen und es wird keine mehr geben. <br><br><h2>  Was ist der Gewinn? </h2><br>  1. <b>Wir brechen die Architektur unserer Anwendung nicht</b> , da der AnalyticsManager außerhalb der Architektur liegt und arbeitet.  Dies ermöglicht es uns, es in einen beliebigen Teil der Anwendung einzubetten. <br><br>  2. <b>Ermöglicht das Sammeln von Ereignissen in einer Zeile</b> in einer beliebigen Anzahl von Analysesystemen.  Dazu schreiben wir einfach: analyseManager.track (Event ()).  Denn dann entscheidet er selbst wo, in welcher Menge, mit welchen Parametern, wann und so weiter. <br><br>  3. <b>Löst das Problem der "einmaligen Ereignisse"</b> .  Jetzt müssen wir nicht mehr verschiedene Arten von Überprüfungen durchführen.  Einmal gesendet, entfernt, und wir werden ihn nicht wieder treffen. <br><br>  4. <b>Löst das Problem, dasselbe Element in verschiedenen Systemen zu sammeln</b> .  Aufgrund der Tatsache, dass wir alles in verschiedenen Sammlern geschrieben haben, ging es an verschiedene Sammler.  Sie müssen also nicht auf unnötige Gesten zurückgreifen.  Meiner Meinung nach ist das wunderbar. <br><br><h2>  Testen ... </h2><br>  Wir testen manuell.  Warum nicht automatisieren?  Und dann stellt sich eine traurige Sache heraus. <br><br>  Erstens werden Sie dies normalerweise normalerweise nicht mit einem Komponententest abdecken.  Da die meisten Probleme mit Ereignissen in der Analyse nicht auftreten, weil einige der Parameter nicht erfasst wurden.  Nach meiner persönlichen Erfahrung treten 90% der Probleme auf, weil Sie die Veranstaltung nicht dorthin gesendet haben, wo sie hingehört.  Solche Fälle können nur mit UI-Tests abgefangen werden, die wir für all dies noch nicht geschrieben haben. <br><br>  Und zweitens ruhen wir uns vorerst ein wenig auf der Tatsache aus, dass Analysten Ereignisse in einem ziemlich strengen Format (im Zusammenfluss) beschreiben, aber dieses Format ist kein striktes Spezifikationsformat wie Swagger.  Dementsprechend gibt es geringfügige Abweichungen, es gibt Duplikate (obwohl in diesem Fall häufig nur ein Link zu einer anderen Seite erstellt wird).  Dies schränkt uns bisher in den Möglichkeiten der Automatisierung von Testanalysen ein.  Aber wir arbeiten daran. <br><br><h2>  Schlussfolgerungen </h2><br>  Was kann mit dieser Entscheidung noch getan werden? <br><br>  1. <b>Schreiben Sie Autotests für die Analyse</b> .  Dies erfordert viel Vorarbeit.  Man kann aber nicht sagen, dass dies unmöglich ist. <br><br>  2. Die Plus-Minus-Track-Methoden sind ziemlich ähnlich.  In jedem generieren wir einige „universelle“ Parameter, die jeder benötigt.  Und sammeln Sie einfach die Karte der Werte.  Im Allgemeinen kann man <b>entweder ein Plug-In oder ein Dienstprogramm schreiben</b> .  Nicht wichtig.  Hauptsache sie generiert ein Track Event für die jeweiligen Klassen. <br><br>  Hier kann jedoch ein kleines Problem auftreten, wenn die Ereignisse etwas anders verschwinden (z. B. für verschiedene Analysesysteme).  Aus diesem Grund kann nicht alles angemessen gelöst werden.  Außerdem möchte ich keine unnötige Codegenerierung in einem Projekt erzeugen, das es in vielen Projekten auf Android so viele gibt (hallo Dagger, Moksi und andere, die an Codegen arbeiten). <br><br>  3. <b>Integration der Anwendung in die Spezifikationen der Analysten</b> .  Wahrscheinlich ist dies ein zu transzendentaler Traum, aber dennoch ... Wir möchten wirklich, dass unsere Analysten in einem strengen Format schreiben, und wir könnten ihre Kunstwerke analysieren und integrieren.  Dann würde Frieden und Harmonie kommen.  Jeder würde sich freuen :) <br><br>  Was möchte ich zu all dem sagen? <br><br>  Erstens ist noch eine Analyse erforderlich.  Weil Sie damit Geld, Ressourcen und Aufwand sparen können.  Dies erspart Ihnen das Schreiben von unnötigem Code oder das Löschen von Code, der nicht alt zu sein scheint, aber hier immer noch nicht benötigt wird.  Weniger Vermächtnis ist immer gut. <br><br>  Zweitens ist Reflexion nicht immer schlecht.  Ja, es ist langsam.  Aber manchmal verlieren wir sehr wenig an Leistung, aber wir bekommen viel, zum Beispiel im Bereich der Entwicklung und Fehlerbehandlung. <br><br>  Und drittens legen wir die Analyse in die Phase der Feature-Planung.  Aus diesem Grund können wir viel früher mit Analysten verhandeln und einen Kompromiss erzielen.  Außerdem haben wir die Möglichkeit, den Zeitaufwand für das Schreiben von Analysen im Voraus abzuschätzen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de469761/">https://habr.com/ru/post/de469761/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de469747/index.html">Oktober IT Event Digest (Teil 1)</a></li>
<li><a href="../de469749/index.html">UX mit der Tabulatortaste verbessern</a></li>
<li><a href="../de469753/index.html">Die 9 besten Open Source-Funde für September 2019</a></li>
<li><a href="../de469755/index.html">Wie man ein guter Programmierer ist</a></li>
<li><a href="../de469757/index.html">AR-Technologie im Dienste der Malerei</a></li>
<li><a href="../de469765/index.html">Lob entspannt sich und Kritik beleidigt - wie man die Arbeit eines anderen bewertet, damit es allen gut geht</a></li>
<li><a href="../de469767/index.html">Wie wir uns für ServiceDesk entschieden haben. Teil 1</a></li>
<li><a href="../de469771/index.html">Erstellen Sie eine Android-App. Aufgabe mit einem Sternchen</a></li>
<li><a href="../de469775/index.html">Zeichne einen Ton</a></li>
<li><a href="../de469779/index.html">Outdoor Future London Academy Treffen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>