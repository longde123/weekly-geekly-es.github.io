<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤸🏾 👆🏿 🤸 Auto-hébergement de ressources tierces: bonnes, mauvaises, mauvaises 🔒 🏓 🥝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ces dernières années, de plus en plus de plateformes d'optimisation de projets frontaux offrent des opportunités d'hébergement indépendant ou de proxy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Auto-hébergement de ressources tierces: bonnes, mauvaises, mauvaises</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/481574/">  Ces dernières années, de plus en plus de plateformes d'optimisation de projets frontaux offrent des opportunités d'hébergement indépendant ou de proxy de ressources tierces.  Akamai vous permet de définir <a href="https://community.akamai.com/customers/s/article/5-ways-to-prevent-slow-3rd-party-front-end-services%3Flanguage%3Den_US">des paramètres spécifiques</a> pour les URL auto-générées.  Cloudflare dispose de la technologie Edge Workers.  Fasterzine peut <a href="https-the-impact-on-your-loading-times/">réécrire les</a> URL des pages afin qu'elles pointent vers des ressources tierces situées sur le domaine principal du site. <br><br> <a href="https://habr.com/ru/company/ruvds/blog/481574/"><img src="https://habrastorage.org/webt/ak/ui/qp/akuiqpw02td9hovfkxqtbxgocck.png"></a> <br><br>  Si vous savez que les services tiers utilisés dans votre projet ne changent pas trop souvent et que le processus de leur livraison aux clients peut être amélioré, alors vous pensez probablement à utiliser ces services par procuration.  Avec cette approche, vous pouvez «rapprocher» ces ressources des utilisateurs et obtenir plus de contrôle sur leur mise en cache côté client.  De plus, cela vous permet de protéger les utilisateurs contre les problèmes causés par la «chute» d'un service tiers ou la dégradation de ses performances. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Bon: productivité accrue</font> </h2><br>  L'auto-hébergement des ressources d'autres personnes améliore les performances de manière très évidente.  Le navigateur n'a pas besoin d'accéder à nouveau au DNS, il n'a pas besoin d'établir une connexion TCP et d'effectuer une négociation TLS sur un domaine tiers.  La façon dont l'hébergement indépendant des ressources d'autres personnes affecte les performances peut être observée en comparant les deux figures suivantes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/828/0d5/2dd/8280d52dd448afd4d0be39a19ef9dbdb.png"></div><br>  <i><font color="#999999">Les ressources tierces sont téléchargées à partir de sources externes (prises à <a href="https://csswizardry.com/2019/05/self-host-your-static-assets/">partir d'ici</a> )</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cb/fb0/da2/8cbfb0da2fc370ddd2da10630c0bc40b.png"></div><br>  <i><font color="#999999">Les ressources tierces sont stockées au même endroit que le reste du matériel du site (extrait <a href="https://csswizardry.com/2019/05/self-host-your-static-assets/">d'ici</a> )</font></i> <br><br>  La situation est également améliorée par le fait que le navigateur utilisera les capacités de multiplexage et de hiérarchisation des données de connexion HTTP / 2, qui sont déjà établies avec le domaine principal. <br><br>  Si vous n'hébergez pas de ressources tierces, puis, puisqu'elles seront téléchargées à partir d'un domaine autre que le domaine principal, elles ne peuvent pas être hiérarchisées.  Cela les amènera à rivaliser pour la bande passante du client.  Cela peut conduire au fait que le temps de chargement des matériaux critiques pour la formation de la page sera beaucoup plus long que le temps réalisable dans un ensemble idéal de circonstances.  <a href="https://www.youtube.com/watch%3Fv%3DnOW-i6bbRdo">Voici un</a> exposé sur la hiérarchisation HTTP / 2 qui explique tout cela très bien. <br><br>  On peut supposer que l'utilisation d'attributs de <code>preconnect</code> dans les liens vers des ressources externes aidera à résoudre le problème.  Cependant, s'il existe trop de liens de ce type vers différents domaines, cela peut en fait surcharger la ligne de communication au moment le plus crucial. <br><br>  Si vous hébergez des ressources tierces par vous-même, vous pouvez contrôler la manière dont ces ressources sont données au client.  À savoir, nous parlons de ce qui suit: <br><br><ul><li>  Vous pouvez vous assurer que l'algorithme de compression de données le mieux adapté à chaque navigateur (Brotli / gzip) est appliqué. </li><li>  Vous pouvez augmenter le temps de mise en cache des ressources, qui ne sont généralement pas très grandes, même pour les fournisseurs les plus connus (par exemple, la valeur correspondante pour la balise GA est définie sur 30 minutes). </li></ul><br>  Vous pouvez même étendre le TTL pour une ressource, par exemple, jusqu'à un an en incluant les matériaux appropriés dans votre stratégie de gestion de la mise en cache (hachages d'URL, versioning, etc.).  Nous en parlerons ci-dessous. <br><br><h3>  <font color="#3AC1EF">▍ Protection contre les interruptions dans le fonctionnement des services tiers ou contre leur déconnexion</font> </h3><br>  Un autre aspect intéressant de l'hébergement indépendant de ressources tierces est que cela vous permet d'atténuer les risques associés aux interruptions dans le fonctionnement des services tiers.  Supposons que votre solution tierce pour les tests A / B soit implémentée en tant que script de blocage chargé dans la section d'en-tête de la page.  Ce script se charge lentement.  Si le script correspondant ne parvient pas à se charger, la page sera vide.  Si le chargement prend beaucoup de temps, la page apparaîtra avec un long délai.  Ou, supposons que le projet utilise une bibliothèque chargée à partir d'une ressource CDN tierce.  Imaginez que cette ressource se bloque ou soit bloquée dans un certain pays.  Une telle situation entraînera une violation de la logique du site. <br><br>  Afin de savoir comment fonctionne votre site dans des conditions d'inaccessibilité de certains services externes, vous pouvez utiliser la section SPOF sur <a href="https://www.webpagetest.org/">webpagetest.org</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bda/89e/935/bda89e935be22061d7f28f4833b00cac.png"></div><br>  <i><font color="#999999">Section SPOF sur webpagetest.org</font></i> <br><br><h3>  <font color="#3AC1EF">▍ Que diriez-vous des problèmes de mise en cache avec les navigateurs?</font>  <font color="#3AC1EF">(indice: c'est un mythe)</font> </h3><br>  Vous pourriez penser que l'utilisation de CDN accessibles au public entraînera automatiquement une meilleure performance des ressources, car ces services ont des réseaux raisonnablement bons et sont distribués dans le monde entier.  Mais tout, en fait, est un peu plus compliqué. <br><br>  Supposons que nous ayons plusieurs sites différents: website1.com, website2.com, website3.com.  Tous ces sites utilisent la bibliothèque jQuery.  Nous le connectons à eux à l'aide de CDN, par exemple googleapis.com.  Vous pouvez vous attendre à ce que le navigateur télécharge et mette en cache la bibliothèque une fois, puis l'utilise lorsque vous travaillez avec les trois sites.  Cela pourrait réduire la charge sur le réseau.  Cela permettra peut-être d'économiser de l'argent quelque part et d'améliorer la productivité des ressources.  D'un point de vue pratique, tout semble différent.  Par exemple, Safari implémente une fonctionnalité appelée <a href="https://webkit.org/blog/7675/intelligent-tracking-prevention/">Intelligent Tracking Prevention</a> : le cache utilise des clés doubles basées sur la source du document et la source d'une ressource tierce.  <a href="https://andydavies.me/blog/2018/09/06/safari-caching-and-3rd-party-resources/">Voici un</a> bon article sur ce sujet. <br><br>  De vieilles recherches sur <a href="https://yuiblog.com/blog/2007/01/04/performance-research-part-2/">Yahoo</a> et <a href="https://code.facebook.com/posts/964122680272229/web-performance-cache-efficiency-exercise/">Facebook</a> , ainsi que des <a href="httparchive.org/t/analyzing-resource-age-by-content-type/1659">recherches</a> plus récentes <a href="httparchive.org/t/analyzing-resource-age-by-content-type/1659">de</a> Paul Calvano, montrent que les ressources ne sont pas stockées dans les caches de navigateur aussi longtemps que nous le pensions: «Il y a un écart important entre le temps de mise en cache de nos propres ressources et celles des projets tiers.  Il s'agit de polices CSS et Web.  À savoir, la durée de mise en cache de 95% de leurs propres polices dépasse une semaine, tandis que la durée de mise en cache de 50% des polices tierces est inférieure à une semaine!  Cela donne aux développeurs Web une bonne raison d'auto-héberger des fichiers de polices! » <br><br>  Par conséquent, si vous hébergez des documents d'autres personnes, vous ne remarquerez pas de problèmes de performances causés par la mise en cache du navigateur. <br><br>  Maintenant que nous avons examiné les points forts des ressources tierces auto-hébergées, parlons de la façon de distinguer une bonne mise en œuvre de cette approche d'une mauvaise. <br><br><h2>  <font color="#3AC1EF">Mauvais: le diable est dans les détails</font> </h2><br>  Le déplacement de ressources tierces vers votre propre domaine ne peut pas être effectué automatiquement sans prendre soin de la mise en cache correcte de ces ressources. <br><br>  L'un des principaux problèmes ici est le temps de mise en cache.  Par exemple, les informations de version sont incluses dans les noms de script tiers comme ceci: <code>jquery-3.4.1.js</code> .  Un tel fichier ne changera pas à l'avenir, par conséquent, il ne causera aucun problème avec sa mise en cache. <br><br>  Mais si un certain schéma de version n'est pas appliqué lors de l'utilisation de fichiers, les scripts mis en cache, dont le contenu change lorsque le nom du fichier est inchangé, peuvent devenir obsolètes.  Cela peut devenir un problème grave, car, par exemple, il ne permet pas d'introduire automatiquement des correctifs de sécurité dans les scripts que les clients doivent recevoir dès que possible.  Le développeur devra faire un effort pour mettre à jour ces scripts dans le cache.  En outre, cela peut provoquer des plantages d'application car le code utilisé sur le client à partir du cache diffère de la dernière version du code pour laquelle la partie serveur du projet est conçue. <br><br>  Certes, si nous parlons de matériaux fréquemment mis à jour (gestionnaires de balises, solutions pour les tests A / B), leur mise en cache à l'aide de CDN est une tâche qui peut être résolue, mais elle est déjà beaucoup plus compliquée.  Des services comme le Commanders Act, des solutions de gestion des balises, utilisent des crochets Web pour publier de nouvelles versions.  Cela permet d'organiser le vidage du cache sur le CDN, ou, mieux encore, la possibilité d'appeler une mise à jour de hachage ou une version de l'URL. <br><br><h3>  <font color="#3AC1EF">▍ Livraison adaptative de matériaux aux clients</font> </h3><br>  De plus, lorsque nous parlons de mise en cache, nous devons également prendre en compte le fait que les paramètres de mise en cache utilisés sur le CDN peuvent ne pas convenir à certaines ressources tierces.  Par exemple, ces ressources peuvent utiliser la technologie de reniflage d'agent utilisateur, le service adaptatif, afin de fournir des versions de navigateur spécifiques de matériaux optimisés spécifiquement pour ces navigateurs.  Ces technologies, pour découvrir les capacités du navigateur, s'appuient sur des expressions régulières ou sur une base de données qui collecte des informations sur l'en <code>User-Agent</code> tête HTTP <code>User-Agent</code> .  En apprenant sur quel navigateur ils traitent, ils lui donnent du matériel conçu pour cela. <br><br>  Ici, vous pouvez rappeler deux services.  Le premier est googlefonts.com.  Le second est polyfill.io.  Le service Google Fonts fournit, pour une certaine ressource, divers codes CSS selon les capacités du navigateur (donnant des liens vers des ressources woff2 en utilisant la <code>unicode-range</code> ). <br><br>  Voici les résultats de quelques requêtes Google Fonts effectuées à partir de différents navigateurs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c7/ecc/36a/4c7ecc36ad0cd11dcc1455f3b59f1ab0.png"></div><br>  <i><font color="#999999">Résultat de la requête des polices Chrome</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d57/8b2/170/d578b2170268cd61bf608b7cc87120c4.png"></div><br>  <i><font color="#999999">Résultat de la requête Google Fonts à partir d'IE10</font></i> <br><br>  Polyfill.io ne donne au navigateur que les polyfills dont il a besoin.  Cette opération est effectuée pour des raisons de performances. <br><br>  Par exemple, regardez ce qui se passe si vous exécutez la demande suivante à partir de différents navigateurs: <a href="">https://polyfill.io/v3/polyfill.js?features=default</a> <br><br>  En réponse à une telle demande faite depuis IE10, 34 Ko de données viendront.  Et la réponse, faite à partir de Chrome, sera vide. <br><br><h2>  <font color="#3AC1EF">Angry: quelques considérations de confidentialité</font> </h2><br>  Cet article est le dernier en ordre, mais pas en importance.  Nous parlons du fait que l'hébergement indépendant de ressources tierces sur le domaine principal du projet ou sur son sous-domaine peut compromettre la confidentialité des utilisateurs et nuire au projet Web principal. <br><br>  Si votre système CDN n'est pas configuré correctement, il peut finir par envoyer des cookies de votre domaine à un service tiers.  Si un filtrage approprié n'est pas organisé au niveau CDN, vos cookies de session, qui en conditions normales ne peuvent pas être utilisés en JavaScript (avec l'attribut <code>httponly</code> ), peuvent être envoyés à un hôte étranger. <br><br>  C'est exactement ce qui peut arriver avec des trackers comme Eulerian ou Criteo.  Les trackers tiers peuvent définir un identifiant unique dans les cookies.  S'ils faisaient partie du matériel des sites, ils pouvaient lire l'identifiant à leur discrétion lors du travail de l'utilisateur avec différentes ressources web. <br><br>  De nos jours, la plupart des navigateurs incluent une protection contre un tel comportement des trackers.  En conséquence, les trackers utilisent désormais la technologie <a href="https://medium.com/nextdns/cname-cloaking-the-dangerous-disguise-of-third-party-trackers-195205dc522a">CNAME Cloaking</a> , se déguisant en leurs propres scripts pour divers projets.  À savoir, les trackers proposent aux propriétaires de sites d'ajouter CNAME à leurs paramètres de domaine pour un certain domaine, dont l'adresse ressemble généralement à un ensemble aléatoire de caractères. <br><br>  Bien qu'il ne soit pas recommandé que les cookies du site Web soient accessibles à tous les sous-domaines (par exemple, * .website.com), de nombreux sites le font.  Dans ce cas, ces cookies sont automatiquement envoyés au traqueur tiers déguisé.  Par conséquent, vous ne pouvez plus parler de confidentialité. <br><br>  De plus, la même chose se produit avec les en <a href="https://developers.google.com/web/updates/2015/09/automating-resource-selection-with-client-hints">-</a> têtes HTTP <a href="https://developers.google.com/web/updates/2015/09/automating-resource-selection-with-client-hints">Client-Hints</a> , qui sont envoyés uniquement au domaine principal, car ils peuvent être utilisés pour créer une <a href="http-extensions/issues/767">empreinte numérique de l'</a> utilisateur.  Veuillez vous assurer que le service CDN que vous utilisez filtre correctement ces en-têtes. <br><br><h2>  <font color="#3AC1EF">Résumé</font> </h2><br>  Si vous allez bientôt introduire un hébergement indépendant de ressources tierces - laissez-moi vous donner quelques conseils: <br><br><ul><li>  Hébergez vos bibliothèques, polices et fichiers CSS les plus importants.  Cela réduira le risque de défaillance du site ou de diminution de ses performances en raison du fait que la ressource vitale pour le fonctionnement du site n'était pas disponible en raison d'un service tiers. </li><li>  Avant de mettre en cache des ressources tierces sur un CDN, assurez-vous que vous utilisez un système de versioning pour nommer leurs fichiers, ou que vous pouvez contrôler le cycle de vie de ces ressources en vidant manuellement ou automatiquement le cache CDN lors de la publication d'une nouvelle version du script. </li><li>  Faites très attention aux paramètres de CDN, serveur proxy, cache.  Cela vous permettra d'empêcher l'envoi de cookies de votre projet ou d'en <code>Client-Hints</code> têtes <code>Client-Hints</code> à des services tiers. </li></ul><br>  <b>Chers lecteurs!</b>  Publiez-vous sur vos serveurs des documents d'autres personnes qui sont extrêmement importants pour vos projets? <br><br><div style="text-align:center;"> <a href="https://ruvds.com/ru-rub"><img src="https://habrastorage.org/webt/u9/qa/nk/u9qankiogj61jowwkrc-v8c8rgm.png"></a> </div><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481574/">https://habr.com/ru/post/fr481574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481564/index.html">PHP Digest n ° 170 (9-23 décembre 2019)</a></li>
<li><a href="../fr481566/index.html">LED d'adresse colorées pour la nouvelle année sans programmation ni soudure</a></li>
<li><a href="../fr481568/index.html">Événements numériques à Moscou du 23 au 29 décembre</a></li>
<li><a href="../fr481570/index.html">Aujourd'hui à 17h00, le webinaire DevOps: outils et numéros aura lieu</a></li>
<li><a href="../fr481572/index.html">Ma nouvelle pile de technologies Web pour 2020</a></li>
<li><a href="../fr481576/index.html">Frontend 2019: résultats de l'année</a></li>
<li><a href="../fr481578/index.html">Céphéides - «jalons» stellaires de l'Univers</a></li>
<li><a href="../fr481580/index.html">Concours NUC du Nouvel An. Sous-totaux et vote des spectateurs</a></li>
<li><a href="../fr481582/index.html">travail et plaisir de dev (damentals) # 2 Softskills sont bons. Juste quelqu'un les a mal compris</a></li>
<li><a href="../fr481584/index.html">Lorsque vous gérez une équipe, brisez toutes les règles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>