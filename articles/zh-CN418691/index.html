<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â†”ï¸ ğŸ“¤ ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ ç‰§åœºä¸»ï¼š5åˆ†é’Ÿå†…ä½¿ç”¨è£¸æœºè¿›è¡ŒKubernetes ğŸ–Šï¸ ğŸ¹ ğŸµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨äº¤å‰è·¯å£ï¼Œä¹é˜Ÿä¸å˜ã€‚ 

 åœ¨æˆ‘ç”±äºå¯¹Docker Swarmçš„ä¼ªç®€å•æ€§å’ŒæŒç»­ä¸æ–­çš„æ•´ç†å·¥ä½œï¼Œå¯¹åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ä¸å¤ªæ–¹ä¾¿çš„å·¥ä½œï¼Œç¨å¾®æ½®æ¹¿çš„Webç•Œé¢å’Œç‹­çª„çš„åŠŸèƒ½ä»¥åŠç¼ºä¹å¯¹â€œå³å¼€å³ç”¨â€çš„GitLabé›†æˆçš„æ”¯æŒè€Œå®Œå…¨åŒå€¦ä¹‹åï¼Œå†³å®šéƒ¨ç½²æ‚¨çš„Kubernetesç¾¤é›†åœ¨æ‚¨è‡ªå·±çš„ç¡¬ä»¶ä¸Šï¼Œå³é€šè¿‡éƒ¨ç½²Ranche...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç‰§åœºä¸»ï¼š5åˆ†é’Ÿå†…ä½¿ç”¨è£¸æœºè¿›è¡ŒKubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418691/"> åœ¨äº¤å‰è·¯å£ï¼Œä¹é˜Ÿä¸å˜ã€‚ <br><br> åœ¨æˆ‘ç”±äºå¯¹Docker Swarmçš„ä¼ªç®€å•æ€§å’ŒæŒç»­ä¸æ–­çš„æ•´ç†å·¥ä½œï¼Œå¯¹åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ä¸å¤ªæ–¹ä¾¿çš„å·¥ä½œï¼Œç¨å¾®æ½®æ¹¿çš„Webç•Œé¢å’Œç‹­çª„çš„åŠŸèƒ½ä»¥åŠç¼ºä¹å¯¹â€œå³å¼€å³ç”¨â€çš„GitLabé›†æˆçš„æ”¯æŒè€Œå®Œå…¨åŒå€¦ä¹‹åï¼Œå†³å®šéƒ¨ç½²æ‚¨çš„Kubernetesç¾¤é›†åœ¨æ‚¨è‡ªå·±çš„ç¡¬ä»¶ä¸Šï¼Œå³é€šè¿‡éƒ¨ç½²Rancher Management Server 2.0ã€‚ <br><br> å®‰è£…ç»éªŒï¼Œå®¹é”™æ–¹æ¡ˆï¼Œåœ¨haProxyä¸‹ä½¿ç”¨haProxyå’Œä¸¤ä¸ªä»ªè¡¨æ¿ï¼š <br><a name="habracut"></a><br>  <strong>è¾“å…¥æ•°æ®ï¼š</strong> <br><br> ä¸»æœºæœåŠ¡å™¨HP Proliant DL320e Gen8-2ä¸ªã€‚ <br>  VM UbuntuæœåŠ¡å™¨16.04ã€2Gb RAMï¼Œ2vCPUï¼Œ20Gb HDD-1ä¸ªã€‚ åœ¨æ¯ä¸ªä¸»æœºä¸Šï¼ˆVM-haProxyï¼‰ã€‚ <br>  VM UbuntuæœåŠ¡å™¨16.04ã€4Gb RAMï¼Œ4vCPUï¼Œ40Gb HDDï¼Œ20Gb SSD-3ä¸ª åœ¨æ¯ä¸ªä¸»æœºï¼ˆVM-*-ç¾¤é›†ï¼‰ä¸Šã€‚ <br>  VM UbuntuæœåŠ¡å™¨16.04ã€4Gb RAMï¼Œ4vCPUï¼Œ100Gb HDD-1ä¸ªã€‚ åœ¨ä»»ä½•ä¸»æœºï¼ˆVM-NFSï¼‰ä¸Šã€‚ <br><br> ç½‘ç»œå›¾ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">å›¾1</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ua/wg/ec/uawgecpkngtalxstr0i1fam-ok4.jpeg"><br></div></div><br>  <strong>å…¥é—¨ï¼š</strong> <br><br>  <em>VM-haProxy</em>å…·æœ‰haProxyï¼Œfail2banï¼Œiptablesè§„åˆ™ã€‚ å……å½“å…¶åé¢æ‰€æœ‰è®¡ç®—æœºçš„ç½‘å…³ã€‚ æˆ‘ä»¬æœ‰ä¸¤ä¸ªç½‘å…³ï¼Œä¸€æ—¦ä¸»æœºä¸Šçš„ç½‘å…³é€šä¿¡ä¸­æ–­ï¼Œæ‰€æœ‰æœºå™¨éƒ½å°†åˆ‡æ¢åˆ°å¦ä¸€ä¸ªã€‚ <br><br> è¿™äº›èŠ‚ç‚¹ï¼ˆVM-haProxyï¼‰çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ†é…å¯¹åç«¯çš„è®¿é—®ï¼Œå¹³è¡¡ï¼Œè½¬å‘ç«¯å£å¹¶æ”¶é›†ç»Ÿè®¡ä¿¡æ¯ã€‚ <br><br> æˆ‘çš„é€‰æ‹©å–å†³äºhaProxyï¼Œå®ƒæ˜¯æœ‰å…³å¹³è¡¡å’Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥çš„æ›´ç‹­focusedçš„å·¥å…·ã€‚ ä¸ºæ­¤ï¼Œæˆ‘å–œæ¬¢é…ç½®æŒ‡ä»¤çš„è¯­æ³•ï¼Œå¹¶ä½¿ç”¨IPç™½åå•å’Œé»‘åå•ï¼Œä»¥åŠä½¿ç”¨å¤šåŸŸSSLè¿æ¥ã€‚ <br><br>  HaProxyé…ç½®ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">haproxy.confä¸è¯„è®º</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">########################################################## #Global # ########################################################## global log 127.0.0.1 local0 notice maxconn 2000 user haproxy group haproxy tune.ssl.default-dh-param 2048 defaults log global mode http option httplog option dontlognull retries 3 option redispatch timeout connect 5000 timeout client 10000 timeout server 10000 option forwardfor option http-server-close ########################################################## #TCP # ########################################################## #    API  Kubernetes listen kube-api-tls bind *:6443 mode tcp option tcplog server VM-Master-Cluster Master:6443 ########################################################## #HTTP/HTTPS - Frontend and backend # ########################################################## #      "  ", frontend  backend. frontend http-in bind *:80 acl network_allowed src -f /path/allowed-ip #     IP.     . http-request deny if !network_allowed #       IP  . reqadd X-Forwarded-Proto:\ http mode http option httpclose acl is_haproxy hdr_end(host) -i haproxy.domain.ru acl is_rancher hdr_end(host) -i rancher.domain.ru acl is_kubernetes hdr_end(host) -i kubernetes.domain.ru use_backend kubernetes if is_kubernetes use_backend rancher if is_rancher use_backend haproxy if is_haproxy frontend https-in bind *:443 ssl crt-list /path/crt-list #    .        . acl network_allowed src -f /path/allowed-ip http-request deny if !network_allowed reqadd X-Forwarded-Proto:\ https acl is_rancher hdr_end(host) -i rancher.etraction.ru acl is_kubernetes hdr_end(host) -i kubernetes.etraction.ru use_backend kubernetes if is_kubernetes { ssl_fc_sni kubernetes.domain.ru } use_backend rancher if is_rancher { ssl_fc_sni rancher.domain.ru } # Backend  haProxy.    . backend haproxy stats enable stats uri /haproxy?stats stats realm Strictly\ Private stats auth login:passwd cookie SERVERID insert nocache indirect #  , , backend   dashboard rancher  kubernetes. backend rancher acl network_allowed src -f /path/allowed-ip http-request deny if !network_allowed mode http redirect scheme https if !{ ssl_fc } server master master:443 check ssl verify none backend kubernetes acl network_allowed src -f /path/allowed-ip http-request deny if !network_allowed mode http balance leastconn redirect scheme https if !{ ssl_fc } server master master:9090 check ssl verify none</span></span></code> </pre> <br></div></div><br>  <strong>é‡è¦ï¼š</strong>æ‰€æœ‰è®¡ç®—æœºéƒ½å¿…é¡»é€šè¿‡ä¸»æœºåç›¸äº’â€œäº†è§£â€ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">add-host-entry.ppç”¨äºåœ¨/ etc / hostsä¸­æ·»åŠ ä¸»æœºåçš„äººå¶æ¸…å•</b> <div class="spoiler_text"><pre> <code class="bash hljs">class host_entries { host { <span class="hljs-string"><span class="hljs-string">'proxy01'</span></span>: ip =&gt; <span class="hljs-string"><span class="hljs-string">'10.10.10.11'</span></span>, } host { <span class="hljs-string"><span class="hljs-string">'proxy02'</span></span>: ip =&gt; <span class="hljs-string"><span class="hljs-string">'10.10.10.12'</span></span>, } host { <span class="hljs-string"><span class="hljs-string">'master'</span></span>: ip =&gt; <span class="hljs-string"><span class="hljs-string">'10.10.10.100'</span></span>, } host { <span class="hljs-string"><span class="hljs-string">'node01'</span></span>: ip =&gt; <span class="hljs-string"><span class="hljs-string">'10.10.10.101'</span></span>, } host { <span class="hljs-string"><span class="hljs-string">'node02'</span></span>: ip =&gt; <span class="hljs-string"><span class="hljs-string">'10.10.10.102'</span></span>, } host { <span class="hljs-string"><span class="hljs-string">'node03'</span></span>: ip =&gt; <span class="hljs-string"><span class="hljs-string">'10.10.10.103'</span></span>, } host { <span class="hljs-string"><span class="hljs-string">'node04'</span></span>: ip =&gt; <span class="hljs-string"><span class="hljs-string">'10.10.10.104'</span></span>, } host { <span class="hljs-string"><span class="hljs-string">'node05'</span></span>: ip =&gt; <span class="hljs-string"><span class="hljs-string">'10.10.10.105'</span></span>, } host { <span class="hljs-string"><span class="hljs-string">'nfs'</span></span>: ip =&gt; <span class="hljs-string"><span class="hljs-string">'10.10.10.200'</span></span>, } }</code> </pre><br></div></div><br>  <em>VM-Master-Cluster</em>æ˜¯ä¸»æ§åˆ¶æœºã€‚ å®ƒä¸Puppet Masterï¼ŒGlusterFS Serverï¼ŒRancher Serverï¼ˆå®¹å™¨ï¼‰ï¼Œetcdï¼ˆå®¹å™¨ï¼‰ï¼Œæ§åˆ¶ç®¡ç†å™¨ï¼ˆå®¹å™¨ï¼‰ä¸åŒã€‚ å¦‚æœæ­¤ä¸»æœºæ–­å¼€è¿æ¥ï¼Œç”Ÿäº§æœåŠ¡å°†ç»§ç»­å·¥ä½œã€‚ <br>  <em>VM-Node-Cluster-</em>èŠ‚ç‚¹ï¼Œå·¥ä½œç¨‹åºã€‚ å·¥ä½œæœºå™¨ï¼Œå…¶èµ„æºå°†è¢«ç»„åˆåˆ°ä¸€ä¸ªå®¹é”™ç¯å¢ƒä¸­ã€‚ æ²¡ä»€ä¹ˆæœ‰è¶£çš„ã€‚ <br><br>  <em>VM-NFS</em> -NFSæœåŠ¡å™¨ï¼ˆnfs-kernel-serverï¼‰ã€‚ ä¸»è¦ä»»åŠ¡æ˜¯æä¾›ç¼“å†²åŒºç©ºé—´ã€‚ å­˜å‚¨é…ç½®æ–‡ä»¶å’Œæ‰€æœ‰æ–‡ä»¶ã€‚ ä¸å­˜å‚¨ä»»ä½•é‡è¦å†…å®¹ã€‚ å–å’–å•¡æ—¶ï¼Œå¯ä»¥ç¼“æ…¢åœ°çº æ­£å…¶è·Œè½ã€‚ <br><br>  <strong>é‡è¦æç¤ºï¼š</strong>æ‰€æœ‰ç¯å¢ƒæœºå™¨éƒ½å¿…é¡»å…·å¤‡ï¼šdocker.ioï¼Œnfs-commonï¼Œgluster-serverã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">must-have-packages.ppæœ¨å¶æ¸…å•ï¼Œç”¨äºå®‰è£…æ­£ç¡®çš„è½¯ä»¶</b> <div class="spoiler_text"><pre> <code class="bash hljs">class musthave { package { <span class="hljs-string"><span class="hljs-string">'docker.io'</span></span>: ensure =&gt; <span class="hljs-string"><span class="hljs-string">'installed'</span></span>, } package { <span class="hljs-string"><span class="hljs-string">'nfs-common'</span></span>: ensure =&gt; <span class="hljs-string"><span class="hljs-string">'installed'</span></span>, } package { <span class="hljs-string"><span class="hljs-string">'gluster-server'</span></span>: ensure =&gt; <span class="hljs-string"><span class="hljs-string">'installed'</span></span>, } }</code> </pre><br></div></div><br> ç”±äºå¤§é‡ä»‹ç»äº†nfs-volumeçš„å®‰è£…å’ŒGlusterFSçš„é…ç½®ï¼Œå› æ­¤æˆ‘å°†ä¸å¯¹å…¶è¿›è¡Œæè¿°ã€‚ <br><br> å¦‚æœæ‚¨åœ¨è§„æ ¼è¯´æ˜ä¸­æ³¨æ„åˆ°æœ‰SSDç£ç›˜ï¼Œåˆ™å®ƒä»¬ä¸ºGlusteråˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„è¿è¡Œåšå¥½äº†å‡†å¤‡ã€‚ åˆ›å»ºåˆ†åŒºï¼Œå¹¶å­˜å‚¨åœ¨é«˜é€Ÿç£ç›˜ä¸Šã€‚ <br><br>  <em>æ³¨æ„äº‹é¡¹</em> å®é™…ä¸Šï¼Œè¿è¡ŒRancherä¸éœ€è¦ç±»ä¼¼é•œåƒçš„ç¯å¢ƒã€‚ ä»¥ä¸Šæ‰€æœ‰éƒ½æ˜¯æˆ‘å¯¹é›†ç¾¤çš„çœ‹æ³•ä»¥åŠå¯¹æˆ‘éµå¾ªçš„å®è·µçš„æè¿°ã€‚ <br><br> è¦è¿è¡ŒRancherï¼Œ <strong>ä¸€</strong>å°è®¡ç®—æœºå°±è¶³å¤Ÿäº†ï¼Œå®ƒå…·æœ‰4CPUï¼Œ4Gb RAMå’Œ10Gb HDDã€‚ <br><br>  5åˆ†é’Ÿåˆ°Rancherã€‚ <br><br> åœ¨VM-Master-Clusterä¸Šï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><pre> <code class="bash hljs">sudo docker run -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher</code> </pre> <br> æ£€æŸ¥å¯ç”¨æ€§ï¼š <br><br><pre> <code class="bash hljs">curl -k https://localhost</code> </pre> <br> å¦‚æœæ‚¨çœ‹åˆ°äº†API-æ­å–œæ‚¨æˆåŠŸé€šè¿‡äº†ä¸€åŠã€‚ <br><br> å†æ¬¡æŸ¥çœ‹ç½‘ç»œå›¾ï¼Œæˆ‘ä»¬è®°å¾—æˆ‘ä»¬å°†ä»å¤–éƒ¨é€šè¿‡haProxyè¿›è¡Œå·¥ä½œï¼Œåœ¨é…ç½®ä¸­ï¼Œæˆ‘ä»¬å‘å¸ƒäº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">rancher.domain.ru</a>é“¾æ¥ï¼Œç»§ç»­ï¼Œè®¾ç½®æ‚¨çš„å¯†ç ã€‚ <br><br> ä¸‹ä¸€é¡µæ˜¯Kubernetesé›†ç¾¤åˆ›å»ºé¡µé¢ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å›¾2</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/1w/ke/xn/1wkexnv2z_lgd_epga3vx3foyv4.png"><br></div></div><br> ä»â€œç¾¤é›†é€‰é¡¹â€èœå•ä¸­ï¼Œé€‰æ‹©â€œç»’å¸ƒâ€ã€‚ æˆ‘æ²¡æœ‰ä¸å…¶ä»–ç½‘ç»œæä¾›å•†åˆä½œã€‚ æˆ‘ä¸å»ºè®®ã€‚ <br><br> å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœæ‚¨ä¸æ‰“ç®—åœ¨å·¥ä½œäººå‘˜æ¨¡å¼ä¸‹ä½¿ç”¨ç®¡ç†å™¨ï¼Œæˆ‘ä»¬å·²ç»å®‰è£…äº†etcdå’ŒControl Planeå¤é€‰æ¡†ï¼Œåˆ™æœªå®‰è£…å·¥ä½œç¨‹åºå¤é€‰æ¡†ã€‚ <br> æˆ‘ä»¬åœ¨å±€åŸŸç½‘å†…å·¥ä½œï¼Œåœ¨NICä¸Šä½¿ç”¨ç›¸åŒçš„åœ°å€ï¼Œå› æ­¤åœ¨â€œå…¬å…±å’Œå†…éƒ¨åœ°å€â€å­—æ®µä¸­æŒ‡ç¤ºç›¸åŒçš„IPã€‚ <br><br> å¤åˆ¶ä¸Šé¢çš„ç»“æœä»£ç ï¼Œç„¶ååœ¨æ§åˆ¶å°ä¸­è¿è¡Œã€‚ <br><br> ä¸€æ®µæ—¶é—´åï¼Œåœ¨Webç•Œé¢ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°æœ‰å…³æ·»åŠ èŠ‚ç‚¹çš„æ¶ˆæ¯ã€‚ ä¸€æ®µæ—¶é—´åï¼Œæ‚¨å°†å¯åŠ¨Kubernetesé›†ç¾¤ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å›¾3</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/lj/sn/kk/ljsnkkwx3eh2w0eg5vysblt8wpm.png"><br></div></div><br> è¦æ·»åŠ å·¥ä½œç¨‹åºï¼Œè¯·åœ¨Rancher Webç•Œé¢ä¸­ç¼–è¾‘é›†ç¾¤ï¼Œæ‚¨å°†çœ‹åˆ°ç”Ÿæˆè¿æ¥å‘½ä»¤çš„èœå•ã€‚ <br><br> ä»…å°†å¤é€‰æ¡†è®¾ç½®ä¸ºå·¥ä½œç¨‹åºä½ç½®ï¼ŒæŒ‡å®šå°†æ¥çš„å·¥ä½œç¨‹åºçš„IPï¼Œå¤åˆ¶å‘½ä»¤å¹¶åœ¨æ‰€éœ€èŠ‚ç‚¹çš„æ§åˆ¶å°ä¸­æ‰§è¡Œã€‚ <br><br> ä¸€æ®µæ—¶é—´åï¼Œç¾¤é›†åŠŸç‡å°†å¢åŠ ï¼Œå°±åƒèŠ‚ç‚¹æ•°ä¸€æ ·ã€‚ <br><br>  <strong>å®‰è£…Kubernetesä»ªè¡¨æ¿ï¼š</strong> <br><br> è½¬åˆ°â€œé¡¹ç›®/å‘½åç©ºé—´â€èœå•ã€‚ <br><br> å®‰è£…åï¼Œæ‚¨å°†çœ‹åˆ°ä¸Kubernetesç›¸å…³çš„åç§°ç©ºé—´å°†åŒ…å«åœ¨é¡¹ç›®å¤–éƒ¨ã€‚ è¦å®Œå…¨ä½¿ç”¨è¿™äº›å‘½åç©ºé—´ï¼Œå¿…é¡»å°†å®ƒä»¬æ”¾ç½®åœ¨é¡¹ç›®ä¸­ã€‚ <br><br> æ·»åŠ ä¸€ä¸ªé¡¹ç›®ï¼Œéšä¾¿å‘½åã€‚ ä½¿ç”¨â€œç§»åŠ¨â€ä¸Šä¸‹æ–‡èœå•å°†åç§°ç©ºé—´ï¼ˆç‰›ç³»ç»Ÿï¼Œå…¥å£nginxï¼Œkube-publicï¼Œkubeç³»ç»Ÿï¼‰ç§»è‡³æ‚¨åˆ›å»ºçš„é¡¹ç›®ã€‚ åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">å›¾4</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dz/qv/el/dzqvelzycrlwyj3bkwllq-pndqm.png"><br></div></div><br> ç›´æ¥å•å‡»é¡¹ç›®åç§°ï¼Œæ‚¨å°†è¢«å¸¦åˆ°å·¥ä½œè´Ÿè½½æ§åˆ¶é¢æ¿ã€‚ æˆ‘ä»¬å°†åœ¨è¿™é‡Œè®¨è®ºå¦‚ä½•åˆ›å»ºç®€å•æœåŠ¡ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å›¾5</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/q6/lp/5z/q6lp5znqlnhzkudjafjnr172n-g.png"><br></div></div><br> ç‚¹å‡»å³ä¸Šè§’çš„â€œå¯¼å…¥YAMLâ€ã€‚ å¤åˆ¶<a href="">æ­¤æ–‡ä»¶</a>çš„å†…å®¹å¹¶å°†å…¶ç²˜è´´åˆ°æ‰“å¼€çš„çª—å£çš„æ–‡æœ¬æ¡†ä¸­ï¼Œé€‰æ‹©åç§°ç©ºé—´â€œ kube-systemâ€ï¼Œå•å‡»â€œå¯¼å…¥â€ã€‚ <br><br> ä¸€æ®µæ—¶é—´åï¼Œpod kubernetes-dashboardå°†å¯åŠ¨ã€‚ <br><br> è½¬åˆ°podç¼–è¾‘ï¼Œæ‰“å¼€ç«¯å£å‘å¸ƒèœå•ï¼Œè®¾ç½®ä»¥ä¸‹å€¼ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">å›¾6</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/_p/2b/wk/_p2bwkxifynrhipap0imqddogfi.png"><br></div></div><br> åœ¨è¿è¡ŒPodçš„èŠ‚ç‚¹ä¸Šæ£€æŸ¥è®¿é—®æƒé™ã€‚ <br><br><pre> <code class="bash hljs">curl -k https://master:9090</code> </pre> <br> çœ‹åˆ°ç­”æ¡ˆäº†å—ï¼Ÿ å‡ºç‰ˆç‰©å·²å®Œæˆï¼Œå°šéœ€åˆ°è¾¾ç®¡ç†éƒ¨åˆ†ã€‚ <br><br> åœ¨Rancherçš„ç¾¤é›†ç®¡ç†ä¸»é¡µä¸Šï¼Œæœ‰éå¸¸æ–¹ä¾¿çš„å·¥å…·ï¼Œä¾‹å¦‚kubectlï¼ˆç¾¤é›†ç®¡ç†æ§åˆ¶å°ï¼‰å’ŒKubeconfig Fileï¼ˆåŒ…å«APIåœ°å€ï¼Œca.crtç­‰çš„é…ç½®æ–‡ä»¶ï¼‰ã€‚ <br><br> æˆ‘ä»¬è¿›å…¥kubectlå¹¶æ‰§è¡Œï¼š <br><br><pre> <code class="bash hljs">kubectl create serviceaccount cluster-admin-dashboard-sa kubectl create clusterrolebinding cluster-admin-dashboard-sa --clusterrole=cluster-admin --serviceaccount=default:cluster-admin-dashboard-sa</code> </pre><br> æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰æœ€é«˜ç‰¹æƒçš„æœåŠ¡å¸æˆ·ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä»¤ç‰Œæ¥è®¿é—®ä»ªè¡¨æ¿ã€‚ <br><br> æŸ¥æ‰¾åˆ›å»ºçš„å¸æˆ·çš„ç§˜å¯†ï¼š <br><br><pre> <code class="bash hljs">kubectl get secret | grep cluster-admin-dashboard-sa</code> </pre><br> æˆ‘ä»¬å°†åœ¨æœ«å°¾çœ‹åˆ°å¸¦æœ‰ç‰¹å®šå“ˆå¸Œçš„å¸æˆ·åç§°ï¼Œå°†å…¶å¤åˆ¶å¹¶æ‰§è¡Œï¼š <br><br><pre> <code class="bash hljs">kubectl describe secret cluster-admin-dashboard-sa-$( )</code> </pre><br> åŒæ ·ï¼Œæˆ‘ä»¬è®°å¾—æ‰€æœ‰å†…å®¹éƒ½å·²é€šè¿‡haProxyæˆåŠŸå‘å¸ƒã€‚ <br><br> æˆ‘ä»¬ç‚¹å‡»é“¾æ¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubernetes.domain.ru</a> ã€‚ è¾“å…¥æ”¶åˆ°çš„ä»¤ç‰Œã€‚ <br><br> æ¬¢å–œï¼š <br><br><div class="spoiler">  <b class="spoiler_title">å›¾7</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ps/1q/iw/ps1qiwgxivruyotas0fcb2slwfy.png"><br></div></div><br>  <em>èšè‹¯ä¹™çƒ¯</em> <br> æ€»çš„ç»“æœæ˜¯è¦æ„Ÿè°¢Rancheråˆ›å»ºäº†ä¸€ä¸ªç›´è§‚çš„ç•Œé¢ï¼Œä¸€ä¸ªæ˜“äºéƒ¨ç½²çš„å®ä¾‹ï¼Œç®€å•çš„æ–‡æ¡£ï¼Œå¿«é€Ÿç§»åŠ¨çš„èƒ½åŠ›ä»¥åŠåœ¨é›†ç¾¤çº§åˆ«çš„å¯ä¼¸ç¼©æ€§ã€‚ ä¹Ÿè®¸æˆ‘åœ¨å¸–å­å¼€å§‹æ—¶è®²å¾—å¤ªå°–é”ï¼ŒSwarmåŒå€¦äº†å®ƒï¼Œè€Œæ˜¯æ˜æ˜¾çš„å‘å±•è¶‹åŠ¿ï¼Œè¿™è®©æˆ‘å‡è§†ç€èº«è¾¹ï¼Œè€Œæ²¡æœ‰å®Œæˆæ— èŠçš„å·¥ä½œã€‚  Dockeråˆ›é€ äº†ä¸€ä¸ªå‘å±•æ—¶ä»£ã€‚ è€Œä¸”åˆ¤æ–­è¿™ä¸ªé¡¹ç›®å½“ç„¶ä¸é€‚åˆæˆ‘ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN418691/">https://habr.com/ru/post/zh-CN418691/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN418681/index.html">å‹è°Šæ—¥-ä¸ºæˆ‘ä»¬çš„æœ‹å‹æä¾›æ‰€æœ‰JetBrains IDEçš„50ï¼…ä¼˜æƒ </a></li>
<li><a href="../zh-CN418683/index.html">åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿå™¨è¡—æœºã€‚ ç¬¬äºŒéƒ¨åˆ†</a></li>
<li><a href="../zh-CN418685/index.html">ç¨‹åºå±‚ç”Ÿæˆ</a></li>
<li><a href="../zh-CN418687/index.html">3.5â€œé©å‘½ï¼šå¸¦æœ‰è’¸æ±½çš„è½¯ç›˜çš„å°ç¹è£çš„ç»†èŠ‚</a></li>
<li><a href="../zh-CN418689/index.html">å¦‚ä½•ä½¿ç”¨åœ¨çº¿æ‹å–çš„ç¤ºä¾‹åœ¨Figmaä¸­åˆ›å»ºç»„ä»¶åº“ï¼ŒèŠ‚çœé¢„ç®—</a></li>
<li><a href="../zh-CN418693/index.html">ä¸ºä»€ä¹ˆå¹¸ç¦å¾ˆéš¾åœ¨å¤§è„‘ä¸­å‘ç°</a></li>
<li><a href="../zh-CN418695/index.html">åç›—ç‰ˆæˆ˜äº‰-å¸å›½åå‡»</a></li>
<li><a href="../zh-CN418699/index.html">åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿå™¨è¡—æœºã€‚ ç¬¬ä¸‰éƒ¨åˆ†</a></li>
<li><a href="../zh-CN418701/index.html">æˆ‘ä»¬ç ”ç©¶ä¿„è¯­çš„è¯­æ³•åˆ†æå™¨</a></li>
<li><a href="../zh-CN418705/index.html">FutexåŸºç¡€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>