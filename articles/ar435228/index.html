<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐พ ๐ง๐ผ ๐ ูุฌููุนุฉ Kubernetes ููุงุจู 20 ุฏููุงุฑูุง ุดูุฑููุง ๐ท๏ธ ๐ง๐พ ๐คถ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL ุฏ 


 ูุญู ูุฑูุน ุงููุฌููุนุฉ ูุฎุฏูุฉ ุชุทุจููุงุช ุงูููุจ ุนุฏููุฉ ุงูุฌูุณูุฉ ูุน ุฅุฏุฎุงู ุ ูุชูุญ ููุชุดููุฑ ุ ุฏูู ุงุณุชุฎุฏุงู ุฃุฏูุงุช ุงูุชุดุบูู ุงูุขูู ูุซู kubespray ุ kubeadm ูุฃู ุฃุฏู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุฌููุนุฉ Kubernetes ููุงุจู 20 ุฏููุงุฑูุง ุดูุฑููุง</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iponweb/blog/435228/" style=";text-align:right;direction:rtl"><h1 id="tl-dr" style=";text-align:right;direction:rtl">  TL  ุฏ </h1><br><p style=";text-align:right;direction:rtl">  ูุญู ูุฑูุน ุงููุฌููุนุฉ ูุฎุฏูุฉ ุชุทุจููุงุช ุงูููุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนุฏููุฉ ุงูุฌูุณูุฉ</a> ูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุฏุฎุงู</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุชูุญ ููุชุดููุฑ</a> ุ ุฏูู ุงุณุชุฎุฏุงู ุฃุฏูุงุช ุงูุชุดุบูู ุงูุขูู ูุซู kubespray ุ kubeadm ูุฃู ุฃุฏูุงุช ุฃุฎุฑู. <br>  ููุช ุงููุฑุงุกุฉ: ~ 45-60 ุฏูููุฉ ุ ููุช ุงูุชุดุบูู: ูู 3 ุณุงุนุงุช. </p><br><h1 id="preambula" style=";text-align:right;direction:rtl">  ุงูุฏูุจุงุฌุฉ </h1><br><p style=";text-align:right;direction:rtl">  ููุฏ ุทููุจ ููู ูุชุงุจุฉ ููุงู ุนู ุงูุญุงุฌุฉ ุฅูู ูุฌููุนุชู ุงูุฎุงุตุฉ ูู kubernetes ููุชุฌุฑูุจ.  ูู ุชุนูู ุญููู ุงูุชุซุจูุช ูุงูุชูููู ุงูุชููุงุฆูุฉ ููุชูุญุฉ ุงููุตุฏุฑ ูู ุญุงูุชู ุ ุญูุซ ุฃููู ุงุณุชุฎุฏูุช ุชูุฒูุนุงุช Linux ุบูุฑ ุงูุณุงุฆุฏุฉ.  ูุดุฌุนู ุงูุนูู ุงูููุซู ูุน kubernetes ูู IPONWEB ุนูู ุงูุญุตูู ุนูู ูุซู ูุฐุง ุงููุธุงู ุงูุฃุณุงุณู ุ ูุญู ููุงูู ุจุทุฑููุฉ ูุฑูุญุฉ ุ ุจูุง ูู ุฐูู ุงููุดุงุฑูุน ุงูููุฒููุฉ. </p><br><h1 id="komponenty" style=";text-align:right;direction:rtl">  ููููุงุช </h1><br><p style=";text-align:right;direction:rtl">  ุณุชุธูุฑ ุงูููููุงุช ุงูุชุงููุฉ ูู ุงูููุงูุฉ: </p><br><p style=";text-align:right;direction:rtl">  - Linux <em>ุงูููุถู ูุฏูู</em> - ููุฏ ุงุณุชุฎุฏูุช Gentoo (ุงูุนูุฏุฉ 1: systemd / node-2: openrc) ุ Ubuntu 18.04.1. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฎุงุฏู Kubernetes</a> - kube-apiserver ุ kube-controller-manager ุ kube-scheduler ุ kubelet ุ kube-proxy. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Containerd</a> + <a href="">CNI Plugins (0.7.4)</a> - ูููู ุงูุญุงููุงุช ุ ุณูุชุฎุฐ containerd + CNI ุจุฏูุงู ูู ุนุงูู ูููุงุก (ุนูู ุงูุฑุบู ูู ุฃู ุงูุชูููู ุจุงููุงูู ุชู ุชุญูููู ุจุงููุงูู ุฅูู ุนุงูู ุงููููุงุก ุ ูุฐูู ูู ูููุน ุฃู ุดูุก ุงุณุชุฎุฏุงูู ุฅุฐุง ูุฒู ุงูุฃูุฑ). <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">CoreDNS</a> - ูุชูุธูู ุงูุชุดุงู ุงูุฎุฏูุฉ ููููููุงุช ุงูุนุงููุฉ ุฏุงุฎู ูุชูุฉ kubernetes.  ููุตู ุจุงุณุชุฎุฏุงู ุฅุตุฏุงุฑ ูุง ููู ุนู 1.2.5 ุ ูุฃูู ูุน ูุฐุง ุงูุฅุตุฏุงุฑ ุ ููุฌุฏ ุฏุนู ุนุงูู ูู coredns ููุนูู ูุนูููุฉ ุชุนูู ุฎุงุฑุฌ ุงููุชูุฉ. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุงูููุง</a> - ูุชูุธูู ููุฏุณ ุงูุดุจูุฉ ุ ูุชูุตูู ุงููููุฏ ูุงูุญุงููุงุช ูููุง ุจูููุง. <br>  - ุฏูุณูุจู <em>ุงูููุถู ูุฏูู</em> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/423/a71/5fc/423a715fc68fed1101c86d3335b0a8a8.jpg" alt="ููุฌููุน"></p><a name="habracut"></a><br><h1 id="ogranicheniya-i-dopuscheniya" style=";text-align:right;direction:rtl">  ุงููููุฏ ูุงูุงูุชุฑุงุถุงุช </h1><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ุชุจุญุซ ุงูููุงูุฉ ูู ุชูููุฉ ุญููู vps / vds ูู ุงูุณูู ุ ููุฐูู ุฅููุงููุฉ ูุดุฑ ุงูุฃุฌูุฒุฉ ุนูู ูุฐู ุงูุฎุฏูุงุช.  ูู ุงูููุชุฑุถ ุฃู ูุฏูู ุจุงููุนู ุดูุก ููุณุน ุ ุฃู ุฃูู ูุงุฏุฑ ุนูู ุงูููุงู ุจุฐูู ุจููุณู.  ุฃูุถูุง ุ ูุง ุชุชู ุชุบุทูุฉ ุชุซุจูุช / ุชูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูููุถูุฉ ูุฏูู ููุณุชูุฏุน ุงูุชุฎุฒูู ุงูุฎุงุต ุ ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช. </li><li style=";text-align:right;direction:rtl">  ูููููุง ุงุณุชุฎุฏุงู ูู ูู ุงูุฅุถุงูุงุช containerd + cni ูุงูุฅุฑุณุงุก.  ูุง ุชุนุชุจุฑ ูุฐู ุงูููุงูุฉ ุงุณุชุฎุฏุงู ุนุงูู ูููุงุก ูุฃุฏุงุฉ ุญุงููุฉ.  ุฅุฐุง ููุช ุชุฑุบุจ ูู ุงุณุชุฎุฏุงู ุนุงูู ูููุงุก ุ ูุณุชุชููู ูู ุชูููู <a href="">ุงููุงูููุง ููููุง ูุฐูู</a> ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุณุชุญุชุงุฌ ุฅูู ุชูููู kubelet ุ ุฃู ุฅุฒุงูุฉ ุฌููุน ุงูุฎูุงุฑุงุช ุงููุชุนููุฉ ุจุงูุญุงููุฉ.  ููุง ุฃูุถุญุช ุชุฌุงุฑุจู ุ ูุฅู ุนุงูู ุงูุฅุฑุณุงุก ูุงูุญุงููุฉ ุนูู ุนูุฏ ูุฎุชููุฉ ุญูุซ ุณุชุนูู ุงูุญุงููุงุช ุจุดูู ุตุญูุญ. </li><li style=";text-align:right;direction:rtl"> ูุง ูููููุง ุงุณุชุฎุฏุงู ุงููุงุฌูุฉ ุงูุฎูููุฉ <code>host-gw</code> ูููุงูููุง ุ ุงูุฑุฃ ูุณู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูููู ุงููุงูููุง</a> ููุฒูุฏ ูู ุงูุชูุงุตูู </li><li style=";text-align:right;direction:rtl">  ูู ูุณุชุฎุฏู ุฃู ุดูุก ูููุฑุงูุจุฉ ูุงููุณุฎ ุงูุงุญุชูุงุทู ูุญูุธ ูููุงุช ุงููุณุชุฎุฏู (ุงูุญุงูุฉ) ูุชุฎุฒูู ูููุงุช ุงูุชูููู ูุฑูุฒ ุงูุชุทุจูู (git / hg / svn / ุฅูุฎ) </li></ul><br><h1 id="vvedenie" style=";text-align:right;direction:rtl">  ููุฏูุฉ </h1><br><p style=";text-align:right;direction:rtl">  ูู ุณูุงู ุงูุนูู ุ ุงุณุชุฎุฏูุช ุนุฏุฏูุง ูุจูุฑูุง ูู ุงููุตุงุฏุฑ ุ ููููู ุฃูุฏ ุฃู ุฃุฐูุฑ ุจุดูู ูููุตู ุฏููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes</a> ุงูููุตู ุฅูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญุฏ ูุง</a> ุ ูุงูุฐู ูุบุทู ุญูุงูู 90ูช ูู ุงูุชูููู ุงูุฃุณุงุณู ูููุฌููุนุฉ ุงูุฎุงุตุฉ ุจู.  ุฅุฐุง ููุช ูุฏ ูุฑุฃุช ูุฐุง ุงูุฏููู ุจุงููุนู ุ ูููููู ุงููุชุงุจุนุฉ ุจุฃูุงู ูุจุงุดุฑุฉู ุฅูู ูุณู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูููู ุงููุงูููุง</a> . </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูุชุนูููุงุช</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><h2 id="spisok-terminov--glossariy" style=";text-align:right;direction:rtl">  ูุงุฆูุฉ ุงููุตุทูุญุงุช / ูุณุฑุฏ ุงููุตุทูุญุงุช </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  api-server - ุฌูุงุฒ ูุนูู ุฃู ุงูุชุฑุงุถู ุชูุฌุฏ ุนููู ูุฌููุนุฉ ูู ุงูุชุทุจููุงุช ููุชุดุบูู ูุงูุฃุฏุงุก ุงูุตุญูุญ kubernetes kube-apiserver.  ูุฃุบุฑุงุถ ูุฐู ุงูููุงูุฉ ุ ุฅููุง etcd ุ kube-apiserver ุ kube-controller-manager ุ kube-scheduler. </li><li style=";text-align:right;direction:rtl">  ุณูุฏ - ูุญุทุฉ ุนูู ูุฎุตุตุฉ ุฃู ุชุซุจูุช VPS ุ ูุฑุงุฏู ูุฎุงุฏู api. </li><li style=";text-align:right;direction:rtl">  node-X - ูุญุทุฉ ุนูู ูุฎุตุตุฉ ุฃู ุชุซุจูุช VPS ุ ุชุดูุฑ <code>X</code> ุฅูู ุงูุฑูู ุงูุชุณูุณูู ูููุญุทุฉ.  ูู ูุฐู ุงูููุงูุฉ ุ ุชููู ุฌููุน ุงูุฃุฑูุงู ูุฑูุฏุฉ ููููุฉ ูููู: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนูุฏุฉ 1 - ุฑูู ุงูุฌูุงุฒ 1 </li><li style=";text-align:right;direction:rtl">  ุนูุฏุฉ -2 - ุฑูู ุงูุฌูุงุฒ 2 </li></ul></li><li style=";text-align:right;direction:rtl">  vCPU - ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงูุงูุชุฑุงุถูุฉ ุ ูุงููุนุงูุฌ ุงูุฃุณุงุณูุฉ.  ุงูุฑูู ูุชูุงูู ูุน ุนุฏุฏ ุงูููู: 1vCPU - ูุงุญุฏ ุงูุฃุณุงุณูุฉ ุ 2vCPU - ุงุซููู ุ ูููู ุฌุฑุง. </li><li style=";text-align:right;direction:rtl">  ุงููุณุชุฎุฏู - ุงููุณุชุฎุฏู ุฃู ูุณุงุญุฉ ุงููุณุชุฎุฏู.  ุนูุฏ ุงุณุชุฎุฏุงู <code>user$</code> ูู ุชุนูููุงุช ุณุทุฑ ุงูุฃูุงูุฑ ุ ูุดูุฑ ุงููุตุทูุญ ุฅูู ุฃู ุฌูุงุฒ ุนููู. </li><li style=";text-align:right;direction:rtl">  ุงูุนุงูู - ุนูุฏุฉ ุงูุนูู ุงูุชู ุณูุชู ุฅุฌุฑุงุก ุงูุญุณุงุจุงุช ุงููุจุงุดุฑุฉ ุนูููุง ุ ุจุดูู ูุชุฒุงูู ูุน <code>node-X</code> </li><li style=";text-align:right;direction:rtl">  ุงูููุฑุฏ ูู ุงูููุงู ุงูุฐู ุชุนูู ุนููู ูุฌููุนุฉ Kubernetes.  ุชุชุถูู ููุงุฑุฏ Kubernetes ุนุฏุฏูุง ูุจูุฑูุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุงุช ุฐุงุช ุงูุตูุฉ</a> . </li></ul></div></div><br><h1 id="setevaya-arhitektura-resheniya" style=";text-align:right;direction:rtl">  ุญููู ููุฏุณุฉ ุงูุดุจูุงุช </h1><br><p style=";text-align:right;direction:rtl">  ูู ุนูููุฉ ุฑูุน ุงููุฌููุนุฉ ุ ูู ุฃูู ุจุชุนููู ูููุฉ ุชุญุณูู ููุงุฑุฏ ุงูุญุฏูุฏ ุจุทุฑููุฉ ุชูุงุณุจ ููุฒุงููุฉ 20 ุฏููุงุฑูุง ุดูุฑููุง.  ูุงู ูู ุงูุถุฑูุฑู ููุท ุชุฌููุน ูุฌููุนุฉ ุนูู ูุน ุนูุฏุชู ุนูู ุนูู ุงูุฃูู (ุนูุฏุชูู).  ูุฐูู ุ ุจุฏุง ูู ุงูุจุฏุงูุฉ ุงููุชูุฉ ูุซู ูุฐุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุฌูุงุฒ ูุน 2 vCPU / 4G RAM: api-server + node-1 [20 $] </li><li style=";text-align:right;direction:rtl">  ุงูุฌูุงุฒ ูุน 2 vCPU / 4G RAM: ุงูุนูุฏุฉ -2 [20 ุฏููุงุฑ] </li></ul><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฃู ุนููุช ุงููุณุฎุฉ ุงูุฃููู ูู ุงููุชูุฉ ุ ูุฑุฑุช ุฅุนุงุฏุฉ ุฅูุดุงุฆูุง ููุชูููุฒ ุจูู ุงูุนูุฏ ุงููุณุคููุฉ ุนู ุชุดุบูู ุงูุชุทุจููุงุช ุฏุงุฎู ุงููุชูุฉ (ุนูุฏ ุงูุนูู ุ ููู ุฃูุถูุง ุนูุงู) ููุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฎุงุตุฉ ุจุงูุฎุงุฏู ุงูุฑุฆูุณู. </p><br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉู ูุฐูู ุ ุญุตูุช ุนูู ุฅุฌุงุจุฉ ููุณุคุงู: "ููู ูููููู ุงูุญุตูู ุนูู ูุฌููุนุฉ ุฃูู ุชูููุฉ ุ ูููู ุชุนูู ุ ุฅุฐุง ููุช ูุง ุฃุฑุบุจ ูู ูุถุน ุฃูุซุฑ ุงูุชุทุจููุงุช ุณูููุง ููุงู". </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุฑุงุฑ 20 ุฏููุงุฑ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/216/89c/a88/21689ca889156d11108e5f5327c606cc.png" alt="ุชุตููู"><br>  (ุงููุฎุทุท ุฃู ูููู ูุซู ูุฐุง) </p></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Kubernetes ุงูุนูุงุฑุฉ ูุนูููุงุช ุนุงูุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/820/462/882/820462882e7cc92479190c067ac4a4f8.jpg" alt="ุชุตููู"><br>  (ุณุฑู ูู ุงูุฅูุชุฑูุช ุฅุฐุง ูุงู ุดุฎุต ูุง ูุฌุฃุฉ ูุง ุฒุงู ูุง ูุนุฑู ุฃู ูู ูุฑ) </p></div></div><br><h2 id="komponenty-i-ih-proizvoditelnost" style=";text-align:right;direction:rtl">  ุงูููููุงุช ูุฃุฏุงุฆูุง </h2><br><p style=";text-align:right;direction:rtl">  ูุงูุช ุงูุฎุทูุฉ ุงูุฃููู ูู ููู ุนุฏุฏ ุงูููุงุฑุฏ ุงูุชู ุฃุญุชุงุฌ ุฅูููุง ูุชุดุบูู ุญุฒู ุงูุจุฑุงูุฌ ุงููุฑุชุจุทุฉ ูุจุงุดุฑุฉ ุจุงููุชูุฉ.  ูู ูุนุท ุงูุจุญุซ ุนู "ูุชุทูุจุงุช ุงูุฃุฌูุฒุฉ" ูุชุงุฆุฌ ูุญุฏุฏุฉ ุ ูุฐูู ุงุถุทุฑุฑุช ุฅูู ุงูุชุนุงูู ูุน ุงููููุฉ ูู ูุฌูุฉ ูุธุฑ ุนูููุฉ.  ูููุงุณ ูู MEM ู CPU ุ ุฃุฎุฐุช ุฅุญุตุงุกุงุช ูู systemd - ูููููุง ุฃู ููุชุฑุถ ุฃู ุงูููุงุณุงุช ูุฏ ุฃุฌุฑูุช ุจุทุฑููุฉ ููุงุฉ ููุบุงูุฉ ุ ููู ูู ููู ูุฏูู ูููุฉ ุงูุญุตูู ุนูู ููู ุฏูููุฉ ุ ูุฃููู ูุง ุฒูุช ูุง ุฃุณุชุทูุน ุงูุนุซูุฑ ุนูู ุฎูุงุฑุงุช ุฃุฑุฎุต ูู 5 ุฏููุงุฑุงุช ููู ูุซูู. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุงุฐุง ุจุงูุถุจุท 5 ุฏููุงุฑุงุชุ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุงู ูู ุงููููู ุงูุนุซูุฑ ุนูู VPS / VDS ุฃุฑุฎุต ุนูุฏ ุงุณุชุถุงูุฉ ุงูุฎูุงุฏู ูู ุฑูุณูุง ุฃู ุฑุงุจุทุฉ ุงูุฏูู ุงููุณุชููุฉ ุ ูููู ุงููุตุต ุงููุญุฒูุฉ ุงููุฑุชุจุทุฉ ุจู ILV ูุฅุฌุฑุงุกุงุชูุง ุชุฎูู ูุฎุงุทุฑ ูุนููุฉ ูุชุซูุฑ ุฑุบุจุฉ ุทุจูุนูุฉ ูู ุชุฌูุจูุง. </p></div></div><br><p style=";text-align:right;direction:rtl">  ูุฐูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชูููู ุงูุฎุงุฏู / ุงูุฎุงุฏู ุงูุฑุฆูุณู (ุงูุนูุฏ ุงูุฑุฆูุณูุฉ): <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  etcd (3.2.17): 80 - 100M ุ ุชู ุฃุฎุฐ ุงูููุงููุณ ูู ููุช ุชู ุงุฎุชูุงุฑู ุนุดูุงุฆููุง.  ูุชูุณุท โโุงุณุชููุงู ุงูุฐุงูุฑุฉ ูุง ูุชุนุฏู 300 ูุชุฑ ุ </li><li style=";text-align:right;direction:rtl">  kube-apiserver (1.12.x - 1.13.0): 237.6M ~ 300M ุ </li><li style=";text-align:right;direction:rtl">  kube-controller-manager (1.12.x - 1.13.0): ุญูุงูู 90 ูุชุฑูุง ุ ูู ูุฑุชูุน ุนู 100 ูุชุฑ ุ </li><li style=";text-align:right;direction:rtl">  kube-scheduler (1.12.x - 1.13.0): ุญูุงูู 20 ููููููุง ุ ุงุณุชููุงู ุซุงุจุช ุฃุนูู ูู 30-50 ูุชุฑ. </li></ul></li><li style=";text-align:right;direction:rtl">  ุชูููู ุฎุงุฏู ุงูุนุงูู (ุนูุฏ ุงูุนุงูู): <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  kubelet (1.12.3 - 1.13.1): ุญูุงูู 35 ููุฌุง ุจุงูุช ุ ุงูุงุณุชููุงู ููู 50 ูุชุฑ ุบูุฑ ุซุงุจุช ุ </li><li style=";text-align:right;direction:rtl">  kube-proxy (1.12.3 - 1.13.1): ุญูุงูู 7.5 - 10M ุ </li><li style=";text-align:right;direction:rtl">  ุงููุงูููุง (0.10.0): ุญูุงูู 15-20 ูุชุฑ ุ </li><li style=";text-align:right;direction:rtl">  coredns (1.3.0): ุญูุงูู 25M ุ </li><li style=";text-align:right;direction:rtl">  ุงูุญุงููุฉ (1.2.1): ุงุณุชููุงู ุงูุญุงููุฉ ููุฎูุถ ุ ููู ุงูุฅุญุตุงุกุงุช ุชุธูุฑ ุฃูุถูุง ุนูููุงุช ุงูุญุงููุฉ ุงูุชู ุฃุทูููุง ุงูุจุฑูุงูุฌ ุงูุฎูู. </li></ul></li></ul><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูู containerd / ุนุงูู ูููุงุก ุงููุงุฒูุฉ ุนูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉุ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  <strong>ูุง ุ ููุณ ููุงู ุญุงุฌุฉ</strong> .  ูุง ุชุชุทูุจ ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุนุงูู ุดุญู ุฃู ุญุงููุฉ ูู ุญุฏ ุฐุงุชูุง ุ ุนูู ุงูุฑุบู ูู ูุฌูุฏ ุนุฏุฏ ูุจูุฑ ูู ุงููุชูุจุงุช ุนูู ุงูุฅูุชุฑูุช ุชุชุถูู ูุบุฑุถ ูุนูู ุฃู ุขุฎุฑ ุงุณุชุฎุฏุงู ุงูุจูุฆุฉ ููุชุญููู.  ูู ุงูุชูููู ูู ุงูุณุคุงู ุ ุชู ุฅููุงู containerd ุนู ุนูุฏ ูู ูุงุฆูุฉ ุงูุชุจุนูุงุช ุ ููุน ุฐูู ุ ูุง ุฃุณูุท ุงูุถูุก ุนูู ุฃู ูุฒุงูุง ูุงุถุญุฉ ููุฐุง ุงูููุฌ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุชูููู ุงููุฐููุฑ ุฃุนูุงู ุถุฆูู ููุงูู ูุจุฏุก ุงููุชูุฉ.  ูุง ููุฒู ุงุชุฎุงุฐ ุฅุฌุฑุงุก / ูููู ุฅุถุงูู ุ ุฅูุง ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฅุถุงูุฉ ุดูุก ููุง ูุญูู ูู. </p></div></div><br><p style=";text-align:right;direction:rtl">  ูุฅูุดุงุก ูุชูุฉ ุงุฎุชุจุงุฑ ุฃู ูุชูุฉ ูููุดุงุฑูุน ุงูููุฒููุฉ ุ ุณุชููู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู 1vCPU / 1G ูุงููุฉ ููู ุชุนูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ.  ุจุทุจูุนุฉ ุงูุญุงู ุ ุณูู ูุฎุชูู ุงูุญูู ุนูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุญุณุจ ุนุฏุฏ ุงูุนูุงู ุงููุนูููู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุชููุฑ ูุญุฌู ุทูุจุงุช ุงูุทุฑู ุงูุซุงูุซ ูุฎุงุฏู api. </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ูุฌุฑุช ุชููููุงุช ุงูุณูุฏ ูุงูุนุงูู ุนูู ุงููุญู ุงูุชุงูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  1X Master ูุน ุงูููููุงุช ุงููุซุจุชุฉ: etcd ุ kube-apiserver ุ kube-controller-manager ุ kube-scheduler </li><li style=";text-align:right;direction:rtl">  2x ุงูุนูุงู ูุน ุงูููููุงุช ุงููุซุจุชุฉ: containerd ุ coredns ุ ุงููุงูููุง ุ kubelet ุ kube-proxy </li></ul><br><h1 id="konfiguraciya" style=";text-align:right;direction:rtl">  ุงูุชูููู </h1><br><p style=";text-align:right;direction:rtl">  ูุชูููู ุงููุนุงูุฌ ุ ุชููู ุงูููููุงุช ุงูุชุงููุฉ ูุทููุจุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงูุฎ - ูุชุฎุฒูู ุงูุจูุงูุงุช ูุฎุงุฏู api ุ ููุฐูู ุงููุงูููุง ุ </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  kube-apiserver - ูู ุงููุงูุน ุ api-server ุ </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  kube-controller-manager - ูุชูููุฏ ููุนุงูุฌุฉ ุงูุฃุญุฏุงุซ ุ </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  kube-scheduler - ูุชูุฒูุน ุงูููุงุฑุฏ ุงููุณุฌูุฉ ูู ุฎูุงู api-server - ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููููุฏ</a> . <br>  ูุชูููู ุฃูุฑุงู ุงูุนูู ุ ุชููู ุงูููููุงุช ุงูุชุงููุฉ ูุทููุจุฉ: </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  kubelet - ูุชุดุบูู ุงููููุฏ ุ ูุชูููู ุฅุนุฏุงุฏุงุช ุงูุดุจูุฉ ุ </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  kube-proxy - ูุชูุธูู ุงูุชูุฌูู / ุชุญููู ุงูุชูุงุฒู ุจูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฎุฏูุงุช</a> kubernetes ุ </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  coredns - ูุงูุชุดุงู ุงูุฎุฏูุฉ ุฏุงุฎู ุญุงููุงุช ุงูุชุดุบูู ุ </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงููุงูููุง - ูุชูุธูู ุงููุตูู ุฅูู ุงูุดุจูุฉ ูู ุงูุญุงููุงุช ุงูุชู ุชุนูู ุนูู ุนูุฏ ูุฎุชููุฉ ุ ููุฐูู ููุชูุฒูุน ุงูุฏููุงูููู ููุดุจูุงุช ุจูู ุงูุนูุฏ ุงูุนูููุฏูุฉ (ุนูุฏุฉ kubernetes). </p><br></li></ul><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Coredns</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฅุฌุฑุงุก ุงุณุชุทุฑุงุฏ ุตุบูุฑ ููุง: ูููู ุฃูุถูุง ุชุดุบูู coredns ุนูู ุงูุฎุงุฏู ุงูุฑุฆูุณู.  ูุง ุชูุฌุฏ ูููุฏ ูู ุดุฃููุง ุฃู ุชุฌุจุฑ coredns ุนูู ุงูุนูู ุนูู ุนูุฏ ุงูุนูู ุ ุจุงุณุชุซูุงุก ูุงุฑู ุงูุชูููู corsns.service ุ ูุงูุฐู ุจุจุณุงุทุฉ ูุง ูุจุฏุฃ ุนูู ุฎุงุฏู Ubuntu ููุงุณู / ุบูุฑ ูุนุฏู ุจุณุจุจ ุชุนุงุฑุถ ูุน ุงูุฎุฏูุฉ ุงูุชู ุชู ุญููุง systemd.  ูู ุฃุญุงูู ุญู ูุฐู ุงููุดููุฉ ุ ูุธุฑูุง ูุฃู ุฎูุงุฏู 2 ns ุงูููุฌูุฏุฉ ุนูู ุงูุนูุฏ ุงูุนุงููุฉ ูุงูุช ุณุนูุฏุฉ ุฌุฏูุง ูุนู. </p></div></div><br><p style=";text-align:right;direction:rtl">  ุญุชู ูุง ุชุถูุน ุงูููุช ุงูุขู ูู ุงูุชุนุฑู ุนูู ุฌููุน ุชูุงุตูู ุนูููุฉ ุชูููู ุงูููููุงุช ุ ุฃูุชุฑุญ ุนููู ุฃู ุชุชุนุฑู ุนูููุง ูู ุฏููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes ุจุงูุทุฑููุฉ ุงูุตุนุจุฉ</a> .  ุณุฃุฑูุฒ ุนูู ุงูููุฒุงุช ุงููููุฒุฉ ูุฎูุงุฑ ุงูุชูููู ุงูุฎุงุต ุจู. </p><br><h2 id="fayly" style=";text-align:right;direction:rtl">  ุงููููุงุช </h2><br><p style=";text-align:right;direction:rtl">  ูุชู ูุถุน ุฌููุน ุงููููุงุช ุงูุฎุงุตุฉ <strong>ุจุชุดุบูู</strong> ููููุงุช ูุธุงู ุงููุฌููุนุฉ ูููุนุงูุฌ ูุนูุฏ ุงูุนูู ูู <strong>/ var / lib / kubernetes /</strong> ููุฑุงุญุฉ.  ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ููููู ูุถุนูุง ูู ุทุฑููุฉ ุฃุฎุฑู. </p><br><h2 id="sertifikaty" style=";text-align:right;direction:rtl">  ุงูุดูุงุฏุงุช </h2><br><p style=";text-align:right;direction:rtl">  ุฃุณุงุณ ุชูููุฏ ุงูุดูุงุฏุงุช ูุง ูุฒุงู ูู ููุณู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes ุจุงูุทุฑููุฉ ุงูุตุนุจุฉ</a> ุ ูุง ุชูุฌุฏ ุงุฎุชูุงูุงุช ูุจูุฑุฉ ุนูููุง.  ูุชุฌุฏูุฏ ุงูุดูุงุฏุงุช ุงูุซุงูููุฉ ุ ุชูุช ูุชุงุจุฉ ูุตูุต bash ุจุณูุทุฉ ุญูู ุชุทุจููุงุช <a href="">cfssl</a> - ูุงู ุฐูู ูููุฏูุง ููุบุงูุฉ ูู ุนูููุฉ ุชุตุญูุญ ุงูุฃุฎุทุงุก. </p><br><p style=";text-align:right;direction:rtl">  ููููู ุฅูุดุงุก ุดูุงุฏุงุช ูุงุญุชูุงุฌุงุชู ุจุงุณุชุฎุฏุงู ุงูุจุฑุงูุฌ ุงููุตูุฉ ุฃุฏูุงู ุ ูุตูุงุช ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes ุจุงูุทุฑููุฉ ุงูุตุนุจุฉ</a> ุฃู ุบูุฑูุง ูู ุงูุฃุฏูุงุช ุงูููุงุณุจุฉ. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชูููุฏ ุงูุดูุงุฏุฉ ุจุงุณุชุฎุฏุงู ุงูุจุฑุงูุฌ ุงููุตูุฉ ุจุงุด</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ููููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุญุตูู ุนูู</a> ุงูุจุฑุงูุฌ ุงููุตูุฉ ููุง: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">kubernetes bootstrap</a> .  ูุจู ุงูุจุฏุก ุ ูู ุจุชุญุฑูุฑ ุงูููู <a href="">certs / env.sh</a> ุ ูุน ุชุญุฏูุฏ ุฅุนุฏุงุฏุงุชู.  ูุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> certs <span class="hljs-comment"><span class="hljs-comment">#:   certs$ ./generate-keys.sh # ... certificate generate output #:  kubeconfig     certs$ ./generate-configkube.sh</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุงุณุชุฎุฏูุช <code>env.sh</code> ูุญุฏุฏุช ุฌููุน ุงููุนููุงุช ุจุดูู ุตุญูุญ ุ ููุง ุฏุงุนู ูููุณ ุงูุดูุงุฏุงุช ุงูุชู ุชู ุฅูุดุงุคูุง.  ุฅุฐุง ุงุฑุชูุจุช ุฎุทุฃ ูู ูุฑุญูุฉ ูุง ุ ููููู ุฅุนุงุฏุฉ ุฅุตุฏุงุฑ ุงูุดูุงุฏุงุช ูู ุฃุฌุฒุงุก.  ุงูุจุฑุงูุฌ ุงููุตูุฉ ููุจุงุด ุฃุนูุงู ุชุงููุฉ ุ ูุชุตููููุง ููุณ ุจุงูุฃูุฑ ุงูุตุนุจ. </p><br><p style=";text-align:right;direction:rtl">  ููุงุญุธุฉ ูููุฉ - ูุง ููุจุบู ูู ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุฅุนุงุฏุฉ ุฅูุดุงุก <code>ca.pem</code> ู <code>ca-key.pem</code> ุ ูุฃููุง ุดูุงุฏุงุช ุงูุฌุฐุฑ ูุฌููุน ุงูุดูุงุฏุงุช ุงููุงุญูุฉ ุ ุจูุนูู ุขุฎุฑ ุ ุณูููู ุนููู ุฅุนุงุฏุฉ ุฅูุดุงุก ุฌููุน ุงูุดูุงุฏุงุช ุงููุตุงุญุจุฉ ูุชุณููููุง ุฅูู ุฌููุน ุงูุขูุงุช ูุฌููุน ุงูุฃุฏูุฉ ุงููุงุฒูุฉ. </p></div></div><br><h3 id="master" style=";text-align:right;direction:rtl">  ุงูุณูุฏ </h3><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ูุถุน ุงูุดูุงุฏุงุช ุงููุงุฒูุฉ ูุจุฏุก ุชุดุบูู ุงูุฎุฏูุงุช ุนูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ูู <code>/var/lib/kubernetes/</code> : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ca.pem - ูุชู ุงุณุชุฎุฏุงู ูุฐู ุงูุดูุงุฏุฉ ูู ูู ููุงู ุ ููููู ุฅูุดุงุคูุง ูุฑุฉ ูุงุญุฏุฉ ููุท ุซู ุงุณุชุฎุฏุงููุง ุฏูู ุชุบููุฑุงุช ุ ูุฐูู ูู ุญุฐุฑูุง.  ุนูุฏ ุชุฌุฏูุฏู ุ ุณุชุญุชุงุฌ ุฅูู ูุณุฎู ุฅูู ุฌููุน ุงูุนูุฏ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุชุญุฏูุซ ูููุงุช kubeconfig ุจุงุณุชุฎุฏุงูู (ุฃูุถูุง ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ). </li><li style=";text-align:right;direction:rtl">  ca-key.pem ูู ููุณ ุงููุณุฎ ุนุจุฑ ุงูุนูุฏ. </li><li style=";text-align:right;direction:rtl">  kube-controller-manager.pem - ูุทููุจ ููุท ูู ุฃุฌู kube-controller-manager. </li><li style=";text-align:right;direction:rtl">  kube-controller-manager-key.pem - ูุทููุจ ููุท ูู ุฃุฌู kube-controller-manager. </li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  kubernetes.pem - ูุทููุจ ูู ุฃุฌู ุงููุงูููุง ุ coredns ุนูุฏ ุงูุงุชุตุงู ุจู etcd ุ kube-apiserver. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุฑุงุฌุน ูุธุฑู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุชุณุชูุฏ ูุฐู ุงูููุฒุฉ ุฅูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes</a> ููุทู ุงูุชูููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุงูุทุฑููุฉ ุงูุตุนุจุฉ</a> . <br>  ุจูุงุกู ุนูู ูุฐุง ุ ุณุชููู ููุงู ุญุงุฌุฉ ุฅูู ูุฐุง ุงูููู ูู ูู ููุงู - ุณูุงุก ุนูู ุงููุนุงูุฌ ุฃู ูู ุนูุฏ ุงูุนูู.  ูู ุฃุบูุฑ ุงูุทุฑููุฉ ุงูุชู ูููุฑูุง ุงูุฏููู ุงูุฃุตูู ุ ูุฃูู ุจูุณุงุนุฏุชู ูู ุงููููู ุชูุธูู ุนูููุฉ ุงููุชูุฉ ุจุดูู ุฃุณุฑุน ูุฃูุซุฑ ูุถูุญูุง ูููู ุงููุฌููุนุฉ ุงููุงููุฉ ูู ุงูุชุจุนูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุฑุฃูู ุงูุดุฎุตู ูู ุฃูู ุจุงููุณุจุฉ ุฅูู ุบูุฑูุง ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุดูุงุฏุงุช ูููุตูุฉ ูุง ุชุชุฏุงุฎู ูุน ุงูุดูุงุฏุงุช ุงููุณุชุฎุฏูุฉ ูู kubernetes. </p><br></div></div><br></li></ul><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  kubernetes-key.pem - ูุจูู ุนูู ุงูุฎูุงุฏู ุงูุฑุฆูุณูุฉ. </li><li style=";text-align:right;direction:rtl">  service-account.pem - ูุทููุจ ููุท ููุดูุงุทูู kube-controller-manager. </li><li style=";text-align:right;direction:rtl">  ุฎุฏูุฉ ุญุณุงุจ key.pem - ุจุงููุซู. </li></ul><br><h3 id="rabochie-uzly" style=";text-align:right;direction:rtl">  ูุญุฏุงุช ุงูุนูู </h3><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ca.pem - ุถุฑูุฑู ูุฌููุน ุงูุฎุฏูุงุช ุงููุนููุฉ ุจุนูุฏ ุงูุนูู (kubelet ุ kube-proxy) ุ ููุฐูู ููููุงููู ุ coredns.  ูู ุจูู ุฃุดูุงุก ุฃุฎุฑู ุ ูุชู ุชุถููู ูุญุชููุงุชู ูู ูููุงุช kubeconfig ุนูุฏูุง ูุชู ุฅูุดุงุคูุง ุจุงุณุชุฎุฏุงู kubectl. </li><li style=";text-align:right;direction:rtl">  kubernetes-key.pem - ูุทููุจ ููุท ููุงูููุง ู coredns ููุงุชุตุงู ุจู etcd ุ ุงูููุฌูุฏ ุนูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ูู api. </li><li style=";text-align:right;direction:rtl">  kubernetes.pem - ุนูู ุบุฑุงุฑ ุณุงุจูุชูุง ุ ูุง ูุญุชุงุฌ ุฅูุง ุฅูู ุงููุงูููุง ู coredns. </li><li style=";text-align:right;direction:rtl">  kubelet / node-1.pem - ููุชุงุญ ุชุฑุฎูุต ุงูุนูุฏุฉ -1. </li><li style=";text-align:right;direction:rtl">  kubelet / node-1-key.pem - ููุชุงุญ ุชุฑุฎูุต ุงูุนูุฏุฉ -1. </li></ul><br><p style=";text-align:right;direction:rtl">  <strong>ููู!</strong>  ุฅุฐุง ูุงู ูุฏูู ุฃูุซุฑ ูู ุนูุฏุฉ ูุงุญุฏุฉ ุ <code>node-X-key.pem</code> <code>node-X.pem</code> ู <code>node-X.kubeconfig</code> ููููุงุช <code>node-X.kubeconfig</code> ุฏุงุฎู kubelet. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุตุญูุญ ุงูุดูุงุฏุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><h4 id="otladka-sertifikatov" style=";text-align:right;direction:rtl">  ุชุตุญูุญ ุงูุดูุงุฏุฉ </h4><br><p style=";text-align:right;direction:rtl">  ูุฏ ุชุญุชุงุฌ ูู ุจุนุถ ุงูุฃุญูุงู ุฅูู ุงููุธุฑ ูู ููููุฉ ุชูููู ุงูุดูุงุฏุฉ ููุนุฑูุฉ ูุถููู IP / DNS ุงูุฐูู ุชู ุงุณุชุฎุฏุงููู ูุฅูุดุงุกูุง.  <code>cfssl-certinfo -cert &lt;cert&gt;</code> ุงูุฃูุฑ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุชุนูู ูุฐู ุงููุนูููุงุช <code>node-1.pem</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ cfssl-certinfo -cert node-1.pem</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"subject"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"common_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"system:node:node-1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>: <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"organization"</span></span>: <span class="hljs-string"><span class="hljs-string">"system:nodes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"organizational_unit"</span></span>: <span class="hljs-string"><span class="hljs-string">"Infrastructure Unit"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"locality"</span></span>: <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"province"</span></span>: <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-string"><span class="hljs-string">"system:nodes"</span></span>, <span class="hljs-string"><span class="hljs-string">"Infrastructure Unit"</span></span>, <span class="hljs-string"><span class="hljs-string">"system:node:node-1"</span></span> ] }, <span class="hljs-attr"><span class="hljs-attr">"issuer"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"common_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Kubernetes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>: <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"organization"</span></span>: <span class="hljs-string"><span class="hljs-string">"Kubernetes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"organizational_unit"</span></span>: <span class="hljs-string"><span class="hljs-string">"Infrastructure"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"locality"</span></span>: <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"province"</span></span>: <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"names"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-string"><span class="hljs-string">"Moscow"</span></span>, <span class="hljs-string"><span class="hljs-string">"Kubernetes"</span></span>, <span class="hljs-string"><span class="hljs-string">"Infrastructure"</span></span>, <span class="hljs-string"><span class="hljs-string">"Kubernetes"</span></span> ] }, <span class="hljs-attr"><span class="hljs-attr">"serial_number"</span></span>: <span class="hljs-string"><span class="hljs-string">"161113741562559533299282037709313751074033027073"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sans"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"w40k.net"</span></span>, <span class="hljs-string"><span class="hljs-string">"node-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"178.79.168.130"</span></span>, <span class="hljs-string"><span class="hljs-string">"192.168.164.230"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"not_before"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-01-04T14:24:00Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"not_after"</span></span>: <span class="hljs-string"><span class="hljs-string">"2029-01-01T14:24:00Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sigalg"</span></span>: <span class="hljs-string"><span class="hljs-string">"SHA256WithRSA"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"authority_key_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"6:C8:94:67:59:55:19:82:AD:ED:6D:50:F1:89:B:8D:46:78:FD:9A"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"subject_key_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"A1:5E:B3:3C:45:14:3D:C6:C:A:97:82:1:D5:2B:75:1A:A6:9D:B0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pem"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;pem content&gt;"</span></span> }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุถููู ูุงูุฉ ุงูุดูุงุฏุงุช ุงูุฃุฎุฑู ูู kubelet ู kube-proxy ูุจุงุดุฑุฉู ูู kubeconfig ุงูููุงุธุฑ. </p><br><h2 id="kubeconfig" style=";text-align:right;direction:rtl">  kubeconfig </h2><br><p style=";text-align:right;direction:rtl">  ูู ุงูููุจููููููุบ ุงูุถุฑูุฑู ูููู ุงูููุงู ุจู ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes ุจุงูุทุฑููุฉ ุงูุตุนุจุฉ</a> ุ ูููู ููุง ุชุจุฏุฃ ุจุนุถ ุงูุงุฎุชูุงูุงุช.  ูุณุชุฎุฏู ุงูุฏููู <code>kubedns</code> ู <code>cni bridge</code> ุ ููุง ุฃูู ูุบุทู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">coredns</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">flannel</a> .  ูุงุชูู ุงูุฎุฏูุชูู ุ ุจุฏูุฑู ุ ุงุณุชุฎุฏุงู <code>kubeconfig</code> ุฅูู ุงููุชูุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> certs <span class="hljs-comment"><span class="hljs-comment">#:  kubeconfig     certs$ ./generate-configkube.sh</span></span></code> </pre> <br><h3 id="master-1" style=";text-align:right;direction:rtl">  ุงูุณูุฏ </h3><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูููุนุงูุฌ ุ ููุงู ุญุงุฌุฉ ุฅูู ูููุงุช kubeconfig ุงูุชุงููุฉ (ููุง ูู ูุฐููุฑ ุฃุนูุงู ุ ุจุนุฏ ุฅูุดุงุก ูููู ุงูุชูุงุทูุง ูู <code>certs/kubeconfig</code> ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">master /var/lib/kubernetes/$ tree -L 2 . +-- kube-controller-manager.kubeconfig L-- kube-scheduler  L-- kube-scheduler.kubeconfig</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณุชููู ูุฐู ุงููููุงุช ูุทููุจุฉ ูุชุดุบูู ูู ูููู ูู ููููุงุช ุงูุฎุฏูุฉ. </p><br><h3 id="rabochie-uzly-1" style=";text-align:right;direction:rtl">  ูุญุฏุงุช ุงูุนูู </h3><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูุนูุฏ ุงูุนูู ุ ุชููู ูููุงุช kubeconfig ุงูุชุงููุฉ ูุทููุจุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">node-1 /var/lib/kubernetes/$ tree -L 2 . +-- coredns ยฆ  L-- coredns.kubeconfig +-- flanneld ยฆ  L-- flanneld.kubeconfig +-- kubelet ยฆ  L-- node-1.kubeconfig L-- kube-proxy  L-- kube-proxy.kubeconfig</code> </pre> <br><h2 id="zapusk-servisov" style=";text-align:right;direction:rtl">  ุฅุทูุงู ุงูุฎุฏูุฉ </h2><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูุฎุฏูุงุช</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุฃู ุนูุฏ ุงูุนูู ุงูุฎุงุต ุจู ูุณุชุฎุฏู ุฃูุธูุฉ ุชููุฆุฉ ูุฎุชููุฉ ุ ูุฅู ุงูุฃูุซูุฉ ููุณุชูุฏุน ุงูุชุฎุฒูู ูููุฑุงู ุฎูุงุฑุงุช ุจุงุณุชุฎุฏุงู systemd.  ูู ุฎูุงู ูุณุงุนุฏุชูู ุ ูููู ูู ุงูุฃุณูู ููู ุงูุนูููุฉ ุงูุชู ูุงููุนููุงุช ุงูุชู ุชุญุชุงุฌ ุฅูู ุงูุจุฏุก ุจูุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฌุจ ุฃูุง ูุชุณุจุจูุง ูู ูุดุงูู ูุจูุฑุฉ ุนูุฏ ุฏุฑุงุณุฉ ุงูุฎุฏูุงุช ุงูุชู ุชุญูู ุนูุงูุงุช ุงููุฌูุฉ. </p></div></div><br><p style=";text-align:right;direction:rtl">  ูุจุฏุก ุงูุฎุฏูุงุช ุ ุชุญุชุงุฌ ุฅูู ูุณุฎ <code>service-name.service</code> ุฅูู <code>/lib/systemd/system/</code> ุฃู ุฃู ุฏููู ุขุฎุฑ ุชูุฌุฏ ุจู ุฎุฏูุงุช systemd ุ ุซู ูู ุจุชุดุบูู ุงูุฎุฏูุฉ ูุจุฏุก ุชุดุบูููุง.  ูุซุงู ุนูู kube-apiserver: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> kube-apiserver.service $ systemctl start kube-apiserver.service</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุ ูุฌุจ ุฃู ุชููู ุฌููุน ุงูุฎุฏูุงุช <em>ุฎุถุฑุงุก</em> (ุฃู ุ ุชุนูู ูุชุนูู).  ุฅุฐุง ูุงุฌูุช ุฎุทุฃ ุ ูุฅู <code>journalct -xe</code> ุฃู <code>journal -f -t kube-apiserver</code> ุณุชุณุงุนุฏู ูู ููู ุงูุฎุทุฃ ุงูุฐู ุญุฏุซ ุจุงูุถุจุท. </p><br><p style=";text-align:right;direction:rtl">  ูุง ุชุชุนุฌู ูู ุจุฏุก ุชุดุบูู ุฌููุน ุงูุฎูุงุฏู ุฏูุนุฉ ูุงุญุฏุฉ ุ ูุงูุจุฏุงูุฉ ุณุชููู ูุงููุฉ ูุชูููู etcd ู kube-apiserver.  ุฅุฐุง ุณุงุฑุช ุงูุฃููุฑ ุนูู ูุง ูุฑุงู ุ ูุญุตูุช ุนูู ุงูููุฑ ุนูู ุฌููุน ุงูุฎุฏูุงุช ุงูุฃุฑุจุน ุนูู ุงููุนุงูุฌ ุ ูููู ุงุนุชุจุงุฑ ุชุดุบูู ุงููุนุงูุฌ ูุงุฌุญูุง. </p><br><h3 id="master-2" style=";text-align:right;direction:rtl">  ุงูุณูุฏ </h3><br><p style=";text-align:right;direction:rtl">  ููููู ุงุณุชุฎุฏุงู ุฅุนุฏุงุฏุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd</a> ุฃู ุฅูุดุงุก ุงูุจุฑุงูุฌ ุงููุตูุฉ ุงูุฃูููุฉ ููุชูููู ุงูุฐู ุชุณุชุฎุฏูู.  ููุง ุณุจู ุฐูุฑู ุ ููุณูุฏ ุชุญุชุงุฌ: </p><br><p style=";text-align:right;direction:rtl">  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd / ุงูุฎ</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd / kube-apiserver</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd / kube-controller-manager</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SYSTEMD / ููุจ ุงููุฌุฏูู</a> </p><br><h3 id="rabochie-uzly-2" style=";text-align:right;direction:rtl">  ูุญุฏุงุช ุงูุนูู </h3><br><p style=";text-align:right;direction:rtl">  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd / containerd</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd / kubelet</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd / kube-proxy</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd / coredns</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd / ุงููุงูููุง</a> </p><br><h3 id="klient" style=";text-align:right;direction:rtl">  ุงูุนููุงุก </h3><br><p style=";text-align:right;direction:rtl">  ููู ูุนูู ุงูุนููู ุ ูุง ุนููู ุณูู ูุณุฎ <code>certs/kubeconfig/admin.kubeconfig</code> (ุจุนุฏ <code>certs/kubeconfig/admin.kubeconfig</code> ุฃู ูุชุงุจุชู ุจููุณู) ุจู <code>${HOME}/.kube/config</code> </p><br><p style=";text-align:right;direction:rtl">  ูู ุจุชูุฒูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">kubectl</a> ูุชุญูู ูู ุชุดุบูู kube-apiserver.  ุงุณูุญูุง ูู ุฃู ุฃุฐูุฑู ูุฑุฉ ุฃุฎุฑู ุฃูู ูู ูุฐู ุงููุฑุญูุฉ ุ ููู ูุนูู kube-apiserver ุ ูุฌุจ ุฃู ูุนูู ููุท etcd.  ุณุชููู ููุงู ุญุงุฌุฉ ุฅูู ุงูููููุงุช ุงููุชุจููุฉ ููุชุดุบูู ุงููุงูู ูููุชูุฉ ูู ููุช ูุงุญู. </p><br><p style=";text-align:right;direction:rtl">  ุชุญูู ูู ุนูู kube-apiserver ู kubectl: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ kubectl version Client Version: version.Info{Major:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, Minor:<span class="hljs-string"><span class="hljs-string">"13"</span></span>, GitVersion:<span class="hljs-string"><span class="hljs-string">"v1.13.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"extra info"</span></span>: <span class="hljs-string"><span class="hljs-string">"..."</span></span>} Server Version: version.Info{Major:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, Minor:<span class="hljs-string"><span class="hljs-string">"13"</span></span>, GitVersion:<span class="hljs-string"><span class="hljs-string">"v1.13.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"extra info"</span></span>: <span class="hljs-string"><span class="hljs-string">"..."</span></span>}</code> </pre> <br><h1 id="konfiguraciya-flannel" style=";text-align:right;direction:rtl">  ุชูููู ุงููุงูููุง </h1><br><p style=";text-align:right;direction:rtl">  <code>vxlan</code> ุงููุงูููุง ุ ุงุณุชูุฑ ุนูู ุงููุงุฌูุฉ ุงูุฎูููุฉ ูู <code>vxlan</code> .  ูุฑุงุกุฉ ุงููุฒูุฏ ุนู ุงูุฎูููุฉ <a href="">ููุง</a> . </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุถูู ุบูุบุงูุงุท ูููุงุฐุง ูู ููุฌุญ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุฃููู ุนูู ุงูููุฑ ุฃู ุชุดุบูู ูุฌููุนุฉ kubernetes ุนูู VPS ูู ุงููุญุชูู ุฃู ูุญุฏู ูู ุงุณุชุฎุฏุงู ุงููุงุฌูุฉ ุงูุฎูููุฉ <code>host-gw</code> .  ูุง ุฃููู ูููุฏุณ ุดุจูุฉ ูุชูุฑุณูุง ุ ููุฏ ูุถูุช ุชุตุญูุญ ุงูุฃุฎุทุงุก ููุฏุฉ ููููู ูููู ุงููุดููุฉ ุงูุชู ุชููู ูู ุงุณุชุฎุฏุงููุง ูุน ูููุฑู ุฎุฏูุฉ VDS / VPS ุงูุฑุงุฆุฏูู. </p><br><p style=";text-align:right;direction:rtl">  ุชู ุงุฎุชุจุงุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Linode.com</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">digitalocean</a> .  ุฌููุฑ ุงููุดููุฉ ูู ุฃู ููุฏูู ุงูุฎุฏูุงุช ูุง ูููุฑูู L2 ุตุงุฏููุง ูุดุจูุฉ ุฎุงุตุฉ.  ููุฐุง ุจุฏูุฑู ูุฌุนู ูู ุงููุณุชุญูู ููู ุญุฑูุฉ ูุฑูุฑ ุงูุดุจูุฉ ุจูู ุงูุนูุฏ ูู ูุฐุง ุงูุชูููู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e0c/c7e/add/e0cc7eadd6253cf4921df17ca6fe5d47.png" alt="ุงููุฑูุฑ"></p><br><p style=";text-align:right;direction:rtl">  ููู ุชุนูู ุญุฑูุฉ ูุฑูุฑ ุงูุดุจูุฉ ุจูู ุงูุนูุฏ ุ ุณูููู ุงูุชูุฌูู ุงูุนุงุฏู.  ูุง ุชูุณู ุฃูู ูุฌุจ ุชุนููู net.ipv4.ip_forward ุนูู 1 ุ ููุฌุจ ุฃูุง ุชุญุชูู ุณูุณูุฉ FORWARD ูู ุฌุฏูู ุงูุชุฑุดูุญ ุนูู ููุงุนุฏ ุญุธุฑ ููุนูุฏ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">node1$ ip route add 10.200.12.0/24 via 192.168.1.2 node2$ ip route add 10.200.8.0/24 via 192.168.1.1</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[10.200.80.23 container-1]-&gt;[192.168.1.1 node-1]-&gt;[192.168.1.2 node-2]-&gt;[10.200.12.5 container-2]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุจุงูุถุจุท ูุง ูุง ูุนูู ุนูู VPS / VDS ุงููุดุงุฑ ุฅูููุง (ูุนูู ุงูุฃุฑุฌุญ ุ ุจุดูู ุนุงู ุนูู ุฌููุน). </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุฅุฐุง ูุงู ุชูููู ุญู ุจุฃุฏุงุก ุนุงูู ููุดุจูุฉ ุจูู ุงูุนูุฏ <strong>ููููุง ุจุงููุณุจุฉ</strong> ูู ุ ููุง ูุฒุงู ุนููู ุฅููุงู ุฃูุซุฑ ูู 20 ุฏููุงุฑูุง ูุชูุธูู ุงููุฌููุนุฉ. </p></div></div><br><p style=";text-align:right;direction:rtl">  ููููู ุงุณุชุฎุฏุงู <code>set-flannel-config.sh</code> ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">etc / flannel</a> ูุชุนููู ุชูููู ุงููุงูููุง ุงููุทููุจ.  <strong>ูู ุงูููู ุฃู ุชุชุฐูุฑ</strong> : ุฅุฐุง ูุฑุฑุช ุชุบููุฑ ุงูุฎูููุฉ ุ ูุณุชุญุชุงุฌ ุฅูู ุญุฐู ุงูุชูููู ูู etcd ูุฅุนุงุฏุฉ ุชุดุบูู ุฌููุน ุดูุงุทูู ุงููุงูููุง ุนูู ุฌููุน ุงูุนูุฏ ุ ูุฐูู ุงุฎุชุฑู ุจุญููุฉ.  ุงูุงูุชุฑุงุถู ูู vxlan. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">master$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ETCDCTL_CA_FILE=<span class="hljs-string"><span class="hljs-string">'/var/lib/kubernetes/ca.pem'</span></span> master$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ETCDCTL_CERT_FILE=<span class="hljs-string"><span class="hljs-string">'/var/lib/kubernetes/kubernetes.pem'</span></span> master$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ETCDCTL_KEY_FILE=<span class="hljs-string"><span class="hljs-string">'/var/lib/kubernetes/kubernetes-key.pem'</span></span> master$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ETCDCTL_ENDPOINTS=<span class="hljs-string"><span class="hljs-string">'https://127.0.0.1:2379'</span></span> master$ etcdctl ls /coreos.com/network/subnets/ /coreos.com/network/subnets/10.200.8.0-24 /coreos.com/network/subnets/10.200.12.0-24 master$ etcdctl get /coreos.com/network/subnets/10.200.8.0-24 {<span class="hljs-string"><span class="hljs-string">"PublicIP"</span></span>:<span class="hljs-string"><span class="hljs-string">"178.79.168.130"</span></span>,<span class="hljs-string"><span class="hljs-string">"BackendType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vxlan"</span></span>,<span class="hljs-string"><span class="hljs-string">"BackendData"</span></span>:{<span class="hljs-string"><span class="hljs-string">"VtepMAC"</span></span>:<span class="hljs-string"><span class="hljs-string">"22:ca:ac:15:71:59"</span></span>}}</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชุณุฌูู ุงูุชูููู ุงููุทููุจ ูู etcd ุ ุชุญุชุงุฌ ุฅูู ุชูููู ุงูุฎุฏูุฉ ูุชุดุบูููุง ุนูู ูู ูู ุงูุนูุฏ ุงูุนุงููุฉ. </p><br><h2 id="flannelservice" style=";text-align:right;direction:rtl">  ุงููุงูููุง </h2><br><p style=";text-align:right;direction:rtl">  ูููู ุฃุฎุฐ ูุซุงู ููุฎุฏูุฉ ููุง: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd / flannel</a> </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุงูููุง</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[Unit] Description=Flanneld overlay address etcd agent After=network.target [Service] Type=notify #: current host ip. don't change if ip have not changed Environment=PUBLIC_IP=178.79.168.130 Environment=FLANNEL_ETCD=https://192.168.153.60:2379 ExecStart=/usr/bin/flanneld \ -etcd-endpoints=${FLANNEL_ETCD} -etcd-prefix=${FLANNEL_ETCD_KEY} \ -etcd-cafile=/var/lib/kubernetes/ca.pem \ -etcd-certfile=/var/lib/kubernetes/kubernetes.pem \ -etcd-keyfile=/var/lib/kubernetes/kubernetes-key.pem \ -etcd-prefix=/coreos.com/network \ -healthz-ip=127.0.0.1 \ -subnet-file=/run/flannel/subnet.env \ -public-ip=${PUBLIC_IP} \ -kubeconfig-file=/var/lib/kubernetes/config/kubeconfig/flanneld.kubeconfig \ $FLANNEL_OPTIONS ExecStartPost=/usr/libexec/flannel/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/docker Restart=on-failure RestartSec=5 [Install] RequiredBy=docker.service</code> </pre> </div></div><br><h2 id="nastroyka" style=";text-align:right;direction:rtl">  ุงูุชุฎุตูุต </h2><br><p style=";text-align:right;direction:rtl">  ููุง ูู ููุถุญ ุณุงุจููุง ุ ูุญุชุงุฌ ุฅูู ูููุงุช ca.pem ู kubernetes.pem ู kubernetes-key.pem ููุชุฑุฎูุต ูู etcd.  ุฌููุน ุงููุนููุงุช ุงูุฃุฎุฑู ูุง ุชุญูู ุฃู ูุนูู ููุฏุณ.  ุงูุดูุก ุงููุญูุฏ ุงูููู ุญููุง ูู ุชูููู ุนููุงู IP ุงูุนูููู ุงูุฐู ุณูุชู ูู ุฎูุงูู ููู ุญุฒู ุงูุดุจูุฉ ุจูู ุงูุดุจูุงุช: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/037/e54/803/037e5480319cedd1e662c925bce23b3e.png" alt="ุงูุดุจูุงุช ุงููุงูููุง"><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฑุงูุจ ุงูุดุจูุงุช ูุชุนุฏุฏุฉ ุงููุถูููู ูุน ุงููุงูููุง</a> ) </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#:   node-1$ systemctl enable flanneld.service #:  node-1$ systemctl start flanneld</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุจุฏุก ุชุดุบูู flannel ุจูุฌุงุญ ุ ูุฌุจ ุฃู ุชุฌุฏ ูุงุฌูุฉ ุงูุดุจูุฉ flannel.N ุนูู ูุธุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">node-1$ ifconfig flannel.100: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1450 inet 10.200.8.0 netmask 255.255.255.255 broadcast 0.0.0.0 inet6 fe80::20ca:acff:fe15:7159 prefixlen 64 scopeid 0x20&lt;link&gt; ether 22:ca:ac:15:71:59 txqueuelen 0 (Ethernet) RX packets 18853 bytes 1077085 (1.0 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 11856 bytes 264331154 (252.0 MiB) TX errors 0 dropped 47 overruns 0 carrier 0 collisions 0</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุฃู ูุงุฌูุงุชู ุชุนูู ุจุดูู ุตุญูุญ ุนูู ุฌููุน ุงูุนูุฏ ุฃูุฑ ุจุณูุท ููุบุงูุฉ.  ูู ุญุงูุชู ุ ุชุญุชูู ุงูุนูุฏุฉ -1 ูุงูุนูุฏุฉ 2 ุนูู ุดุจูุงุช 10.200.8.0/24 ู 10.200.12.0/24 ุ ุนูู ุงูุชูุงูู ุ ูุจุงูุชุงูู ุ ุจุงุณุชุฎุฏุงู ุทูุจ icmp ุนุงุฏู ุ ุชุญูู ูู ุชููุฑูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#:  node-2  node-1 node-1 $ ping -c 1 10.200.12.0 PING 10.200.12.0 (10.200.12.0) 56(84) bytes of data. 64 bytes from 10.200.12.0: icmp_seq=1 ttl=64 time=4.58 ms #:  node-1  node-2 node-2 $ ping -c 1 10.200.8.0 PING 10.200.8.0 (10.200.8.0) 56(84) bytes of data. 64 bytes from 10.200.8.0: icmp_seq=1 ttl=64 time=1.44 ms</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ ุญุฏูุซ ุฃู ูุดุงูู ุ ููุตู ุจุงูุชุญูู ููุง ุฅุฐุง ูุงูุช ููุงู ููุงุนุฏ ูุทุน ูู iptables ุนุจุฑ UDP ุจูู ุงููุถูููู. </p><br><h1 id="konfiguraciya-containerd" style=";text-align:right;direction:rtl">  Containerd ุงูุชูููู </h1><br><p style=";text-align:right;direction:rtl">  ุถุน <a href="">etc / containerd / config.toml</a> ูู <code>/etc/containerd/config.toml</code> ุฃู ูู ุฃู ููุงู ููุงุณุจ ูู ุ ุงูุดูุก ุงูุฑุฆูุณู ูู ุชุฐูุฑ ุชุบููุฑ ุงููุณุงุฑ ุฅูู ููู ุงูุชูููู ูู ุงูุฎุฏูุฉ (containerd.service ุ ุงูููุถุญ ุฃุฏูุงู). </p><br><p style=";text-align:right;direction:rtl">  ุงูุชูููู ูุน ุจุนุถ ุงูุชุนุฏููุงุช ุนูู ุงููุนูุงุฑ.  <strong>ูู ุงูููู ุนุฏู ุชุนููู</strong> <code>enable_tls_streaming = true</code> ุฅุฐุง ููุช ูุง ุชููู ุณุจุจ ููุงูู ุจุฐูู.    <code>kubectl exec</code>        ,      . </p><br><h2 id="containerdservice" style=";text-align:right;direction:rtl"> containerd.service </h2><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">containerd.service</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[Unit] Description=containerd container runtime Documentation=https://containerd.io After=network.target [Service] ; uncomment this if your overlay module are built as module ; ExecStartPre=/sbin/modprobe overlay ExecStart=/usr/bin/containerd \ -c /etc/containerd/config.toml Restart=always RestartSec=5 Delegate=yes KillMode=process OOMScoreAdjust=-999 LimitNOFILE=1048576 LimitNPROC=infinity LimitCORE=infinity [Install] WantedBy=multi-user.target</code> </pre> </div></div><br><h2 id="nastroyka-1" style=";text-align:right;direction:rtl">  ุงูุชุฎุตูุต </h2><br><p style=";text-align:right;direction:rtl">  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">cri-tools</a> . <br>  <a href="">etc/crictl.yaml</a>  <code>/etc/crictl.yaml</code> .      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">node-1$ CONTAINERD_NAMESPACE=k8s.io crictl ps CONTAINER ID IMAGE CREATED STATE NAME ATTEMPT POD ID</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,    -    kubernetes , crictl       , ,    . </p><br><h1 id="konfiguraciya-cni-plugins" style=";text-align:right;direction:rtl">  CNI Plugins </h1><br><p style=";text-align:right;direction:rtl">  CNI    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a>   ,    ,   . </p><br><h1 id="nastroyka-2" style=";text-align:right;direction:rtl">  ุงูุชุฎุตูุต </h1><br><p style=";text-align:right;direction:rtl">       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">cni plugins</a>        <code>/opt/cni/bin/</code> </p><br><p style=";text-align:right;direction:rtl">  <a href="">/etc/cni/net.d</a>      : </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">/etc/cni/net.d/10-flannel.conflist</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{ "cniVersion": "0.3.0", "name": "cbr0", "plugins": [ { "type": "flannel", "name": "kubenet", "delegate": { "hairpinMode": true, "isDefaultGateway": true } }, { "type": "portmap", "capabilities": { "portMappings": true }, "externalSetMarkChain": "KUBE-MARK-MASQ" } ] }</code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">/etc/cni/net.d/99-loopback.conf</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{ "cniVersion": "0.3.0", "type": "loopback" }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">       ,    .  ,       ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Red Hat  Docker  Podman</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Intro to Podman</a> </p><br><h1 id="konfiguraciya-kubelet" style=";text-align:right;direction:rtl">  Kubelet </h1><br><p style=";text-align:right;direction:rtl">     kubelet  (     cni) โ    .   kubelet    hostname.         ,      ""   <code>kubectl logs</code> , <code>kubectl exec</code> , <code>kubectl port-forward</code> . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"> kubelet-config.yaml</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ,   <a href="">etc/kubelet-config.yaml</a>   ,        ,     .     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">systemReserved: cpu: 200m memory: 600Mi</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,        GO  kubernetes,  ,       .        .           0.2 vCPU  600 MB     . </p><br><p style=";text-align:right;direction:rtl">   ,  , kubelet, kube-proxy, coredns, flannel    . ,               โ     2 vCPU / 4G ram,           ,     kubernetes + postgresql . </p><br><p style=";text-align:right;direction:rtl">    - (micro nodes)        . </p></div></div><br><h2 id="kubeletservice" style=";text-align:right;direction:rtl"> kubelet.service </h2><br><p style=";text-align:right;direction:rtl">  service    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd/kubelet</a> </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">kubelet.service</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[Unit] Description=Kubernetes Kubelet Documentation=https://github.com/kubernetes/kubernetes Requires=containerd.service [Service] #Environment=NODE_IP=192.168.164.230 Environment=NODE_IP=178.79.168.130 #: node name given by env Environment=NODE_NAME=w40k.net ExecStart=kubelet \ --allow-privileged \ --root-dir=/var/lib/kubernetes/kubelet \ --config=/var/lib/kubernetes/kubelet/kubelet-config.yaml \ --kubeconfig=/var/lib/kubernetes/kubelet/node-1.kubeconfig \ --cni-bin-dir=/opt/cni/bin \ --cni-conf-dir=/etc/cni/net.d/ \ --network-plugin=cni \ --container-runtime=remote \ --container-runtime-endpoint=unix:///var/run/containerd/containerd.sock \ --image-pull-progress-deadline=10m \ --node-ip=${NODE_IP} \ --hostname-override=${NODE_NAME} \ --v=1 Restart=on-failure RestartSec=5 [Install] WantedBy=multi-user.target</code> </pre> </div></div><br><h2 id="nastroyka-3" style=";text-align:right;direction:rtl">  ุงูุชุฎุตูุต </h2><br><p style=";text-align:right;direction:rtl">      ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RBAC</a> ,                kubelet. </p><br><p style=";text-align:right;direction:rtl">  <a href="">etc/kubelet-default-rbac.yaml</a>  ,  kubelet        : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">user$ kubectl apply -f etc/kubelet-default-rbac.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,    ,        . </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#:   node-1$ systemctl enable kubelet.service #:  node-1$ systemctl start kubelet</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    ,           api : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ kubectl get nodes -o wide NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME w40k.net Ready &lt;none&gt; 5m v1.13.1 178.79.168.130 &lt;none&gt; Gentoo/Linux 4.18.16-x86_64-linode118 containerd://1.2.1</code> </pre> <br><h1 id="konfiguraciya-kube-proxy" style=";text-align:right;direction:rtl">  Kube Proxy </h1><br><p style=";text-align:right;direction:rtl"> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd/kubelet</a> .   ,   , <code>kube-proxy-config.yaml</code>     : <a href="">etc/kube-proxy</a> </p><br><h2 id="kube-proxyservice" style=";text-align:right;direction:rtl"> kube-proxy.service </h2><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">kube-proxy.service</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[Unit] Description=Kubernetes Proxy Documentation=https://github.com/kubernetes/kubernetes After=network.target [Service] ExecStart=kube-proxy \ --config=/var/lib/kubernetes/kube-proxy/kube-proxy-config.yaml Restart=on-failure RestartSec=5 [Install] WantedBy=multi-user.target</code> </pre> </div></div><br><h2 id="nastroyka-4" style=";text-align:right;direction:rtl">  ุงูุชุฎุตูุต </h2><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#:   node-1$ systemctl enable kube-proxy.service #:  node-1$ systemctl start kube-proxy</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   kube-proxy   ""   iptables,         ,   -   kubernetes  (- ).   . </p><br><h1 id="konfiguraciya-coredns" style=";text-align:right;direction:rtl">  CoreDNS </h1><br><p style=";text-align:right;direction:rtl"> Corefile   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">etc/coredns/Corefile</a> ,    : </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">/etc/coredns/Corefile</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">.:53 { errors log stdout health :8081 kubernetes cluster.local 10.200.0.0/16 { endpoint https://178.79.148.185:6443 tls /var/lib/kubernetes/kubernetes.pem /var/lib/kubernetes/kubernetes-key.pem /var/lib/kubernetes/ca.pem pods verified upstream /etc/resolv.conf kubeconfig /var/lib/kubernetes/config/kubeconfig/coredns.kubeconfig default } proxy . /etc/resolv.conf cache 30 }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">     coredns.kubeconfig  pem- (    )   worker . , coredns      systemd-resolved. ,         Ubuntu ,  ,  ,  ,  .        . </p><br><h2 id="corednsservice" style=";text-align:right;direction:rtl"> coredns.service </h2><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">coredns.service</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[Unit] Description=CoreDNS Documentation=https://coredns.io/ After=network.target [Service] ExecStart=/usr/bin/coredns -conf /etc/coredns/Corefile Restart=on-failure RestartSec=5 [Install] WantedBy=multi-user.target</code> </pre> </div></div><br><h2 id="nastroyka-5" style=";text-align:right;direction:rtl">  ุงูุชุฎุตูุต </h2><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#:   node-1$ systemctl enable coredns.service #:  node-1$ systemctl start coredns</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> ,   ,   : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">node-1$ dig kubernetes.default.svc.cluster.local @127.0.0.1 #:    ;kubernetes.default.svc.cluster.local. IN A ;; ANSWER SECTION: kubernetes.default.svc.cluster.local. 5 IN A 10.32.0.1</code> </pre> <br><p style=";text-align:right;direction:rtl">   , coredns   ip   kubernetes . <br> <strong></strong> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">kubernetes.default </a>   <strong></strong> kube-controller-manager,      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ kubectl get svc -n default NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.32.0.1 &lt;none&gt; 443/TCP 26h</code> </pre> <br><h1 id="nginx-ingress--cert-manager" style=";text-align:right;direction:rtl"> nginx-ingress &amp; cert-manager </h1><br><p style=";text-align:right;direction:rtl">   ,    .        nginx-ingress  cert-manager. </p><br><p style=";text-align:right;direction:rtl"> โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">nginx kubernetes ingress</a> (master),  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"> user$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/nginxinc/kubernetes-ingress.git user$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> kubernetes-ingress/deployments user$ kubectl apply -f common/ns-and-sa.yaml user$ kubectl apply -f common/nginx-config.yaml user$ kubectl apply -f common/default-server-secret.yaml user$ kubectl apply -f daemon-set/nginx-ingress.yaml user$ kubectl apply -f rbac/rbac.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl"> โ <a href="">cert manager</a> (v0.5.2) </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"> user$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/jetstack/cert-manager.git user$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> cert-manager &amp;&amp; git co v0.5.2 user$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> contrib/manifests/cert-manager user$ kubectl apply -f with-rbac.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,    ,  ,    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">NAMESPACE NAME READY STATUS RESTARTS AGE cert-manager cert-manager-554c76fbb7-t9762 1/1 Running 0 3h38m nginx-ingress nginx-ingress-sdztf 1/1 Running 0 10h nginx-ingress nginx-ingress-vrf85 1/1 Running 0 10h</code> </pre> <br><p style=";text-align:right;direction:rtl">  cert-manager  nginx-ingress    running state,   ,    .          ,         <code>Running</code> .            . </p><br><h1 id="zapuskaem-prilozhenie" style=";text-align:right;direction:rtl">   </h1><br><p style=";text-align:right;direction:rtl">   ,     .      ,   kubernetes resource : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">app/k8s</a> </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">user$ kube apply -f ns-and-sa.yaml user$ kube apply -f configmap.yaml <span class="hljs-comment"><span class="hljs-comment">#:  secret-example.yaml       #: secret.yaml user$ kube apply -f secret.yaml user$ kube apply -f tls-production.yaml user$ kube apply -f deployment.yaml user$ kube apply -f service.yaml user$ kube apply -f ingress-production.yaml</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   ,     - .  ,    (      kubernetes-example.w40k.net),     ,    ,  cert-manager    nginx-ingress              .   ,    ingress  tls/ssl. </p><br><p style=";text-align:right;direction:rtl">      : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=http://no-">http://no-https.kubernetes-example.w40k.net/</a> โ  ssl;  ,  -   ,     . </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://kubernetes-example.w40k.net/</a> โ   (,   ,   ),  ,     ,       kubernetes     . </li></ul><br><p style=";text-align:right;direction:rtl">       ,      -   .    -       ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> ,        . </p><br><h1 id="ssylki" style=";text-align:right;direction:rtl">  ุงููุฑุงุฌุน </h1><br><p style=";text-align:right;direction:rtl"> ,     ,   : </p><br><p style=";text-align:right;direction:rtl"> โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes the hard way</a> <br> โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Multi-Host Networking Overlay with Flannel</a> <br> โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Intro to Podman</a> <br> โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Stateless Applications</a> <br> โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">What is ingress</a> </p><br><p style=";text-align:right;direction:rtl">   : </p><br><p style=";text-align:right;direction:rtl"> โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes Networking: Behind the scenes</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> ) <br> โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">A Guide to the Kubernetes Networking Model</a> <br> โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Understanding kubernetes networking: services</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> ) </p><br><h1 id="qa" style=";text-align:right;direction:rtl"> Q&amp;A </h1><br><p style=";text-align:right;direction:rtl"> &lt;tbd&gt;,           . </p><br><h1 id="otladochnaya-informaciya" style=";text-align:right;direction:rtl">   </h1><br><p style=";text-align:right;direction:rtl">     , ,     .    ,       ,  -  ,    ,  . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"> </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><h2 id="api-server" style=";text-align:right;direction:rtl"> Api Server </h2><br><p style=";text-align:right;direction:rtl">   <code>kube-apiserver.service</code>    ,       api-server'   curl    http .            - . <br>     admin.kubeconfig  ${HOME}/.kube/config,   kubectl      api-server (kube-apiserver). </p><br><p style=";text-align:right;direction:rtl">    (   )  HTTP 200 OK + ,  api-server  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">curl -H "Authorization: Bearer e5qXNAtwwCHUUwyLilZmAoFPozrQwUpw" -k -L https://&lt;api-server-address&gt;:6443/api/v1/</code> </pre> <br><h2 id="kube-controller-manager" style=";text-align:right;direction:rtl"> Kube Controller Manager </h2><br><p style=";text-align:right;direction:rtl">  ,  controller manager   api    ,      .        ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">service account'</a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ kubectl get sa NAME SECRETS AGE default 1 19h</code> </pre> <br><p style=";text-align:right;direction:rtl">    ,   ,  kube-controller-manager  . </p><br><h2 id="kube-scheduler" style=";text-align:right;direction:rtl"> Kube Scheduler </h2><br><p style=";text-align:right;direction:rtl">       .  ,    ,    <a href="">debug/job.yaml</a>        <code>kubectl describe &lt;type/resource&gt;</code> . <br>    <strong> </strong>  ,  kube controller manager . </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#:   job user$ kubectl apply -f debug/job.yaml job.batch/app created #:  ,   job user$ kubectl get pods -l job-name=app NAME READY STATUS RESTARTS AGE app-9kr9z 0/1 Completed 0 54s #: ,        #:   user$ kubectl describe pods app-9kr9z # ...   ... Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 12s default-scheduler Successfully assigned example/app-9kr9z to w40k.net</code> </pre> <br><p style=";text-align:right;direction:rtl">   , default-scheduler   pod   w40k.net.    -  ,            โ    . </p><br><p style=";text-align:right;direction:rtl">              . , ,   , โ      "".       systemd        . </p><br><p style=";text-align:right;direction:rtl">   kube scheduler  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> </p><br><h2 id="kubelet" style=";text-align:right;direction:rtl"> Kubelet </h2><br><p style=";text-align:right;direction:rtl"> Kubelet    kubernetes     .  kubelet       .     kubernetes event ( <code>kubectl get events -o wide</code> )         . </p><br><p style=";text-align:right;direction:rtl">     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> ) </p><br><h2 id="kube-proxy-i-servisy" style=";text-align:right;direction:rtl"> Kube Proxy   </h2><br><p style=";text-align:right;direction:rtl">     kube-proxy    : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">      (     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> Flannel</a> ,      ); </li><li style=";text-align:right;direction:rtl">  iptables,   filter  nat . </li></ul><br><p style=";text-align:right;direction:rtl"> <strong></strong> , 10.32.0.0/24   "".  ,        .     iptables,     ,   ,     -    +.  <strong> </strong>  icmp    ,      ping'  .        ,     . </p><br><p style=";text-align:right;direction:rtl">  ,     kube-proxy,               : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#:    user$ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE backend ClusterIP 10.32.0.195 &lt;none&gt; 80/TCP 5m #:     user$ kubectl get pods -o wide #:     ' NAME READY STATUS RESTARTS AGE IP NODE backend-896584448-4r94s 1/1 Running 0 11h 10.200.8.105 w40k.net backend-896584448-np992 1/1 Running 0 11h 10.200.12.68 docker.grart.net #:  10   /status/ endpoint ,       #:       node-1$ for i in `seq 10`; do curl -L http://10.32.0.195/status/; done okokokokokokokokokok node-1$ conntrack -L -d 10.32.0.195 tcp 6 62 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62158 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62158 [ASSURED] mark=0 use=1 tcp 6 60 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62144 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62144 [ASSURED] mark=0 use=1 tcp 6 58 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62122 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62122 [ASSURED] mark=0 use=1 tcp 6 59 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62142 dport=80 src=10.200.8.105 dst=10.200.8.1 sport=8000 dport=62142 [ASSURED] mark=0 use=1 tcp 6 58 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62130 dport=80 src=10.200.8.105 dst=10.200.8.1 sport=8000 dport=62130 [ASSURED] mark=0 use=1 tcp 6 61 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62150 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62150 [ASSURED] mark=0 use=1 tcp 6 56 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62116 dport=80 src=10.200.8.105 dst=10.200.8.1 sport=8000 dport=62116 [ASSURED] mark=0 use=1 tcp 6 57 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62118 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62118 [ASSURED] mark=0 use=1 tcp 6 59 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62132 dport=80 src=10.200.12.68 dst=10.200.8.0 sport=8000 dport=62132 [ASSURED] mark=0 use=1 tcp 6 56 TIME_WAIT src=178.79.168.130 dst=10.32.0.195 sport=62114 dport=80 src=10.200.8.105 dst=10.200.8.1 sport=8000 dport=62114 [ASSURED] mark=0 use=1</code> </pre> <br><p style=";text-align:right;direction:rtl">      src/dst (9  10 ).   ,  src      : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> 10.200.8.105 </li><li style=";text-align:right;direction:rtl"> 10.200.12.68 </li></ul><br><p style=";text-align:right;direction:rtl">  ,    .      ,  -  ( ,    )  .         . </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#: node-1   10.200.8.105, node-2 10.200.12.68, #:      8000  #:  node-1 node-1$ curl -L http://10.200.8.105:8000/status/ ok node-1$ curl -L http://10.200.12.68:8000/status/ ok #:  node-2 node-2$ curl -L http://10.200.8.105:8000/status/ ok node-2$ curl -L http://10.200.12.68:8000/status/ ok</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    ,    ,    conntrack        ,  ,      kube-proxy.   ,       nat : </p><br><p style=";text-align:right;direction:rtl"> <code>node-1$ iptables -t nat -vnL</code> </p> <br><p style=";text-align:right;direction:rtl">          . </p><br><p style=";text-align:right;direction:rtl">                  .  ,    ,      .   ,       .  -       , ,   . </p><br><p style=";text-align:right;direction:rtl">     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> </p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar435228/">https://habr.com/ru/post/ar435228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar435214/index.html">ุชู ุฅุตุฏุงุฑ Linux 4.20 - ูุง ุงูุฐู ุชุบูุฑ ูู ุฅุตุฏุงุฑ kernel ุงูุฌุฏูุฏ</a></li>
<li><a href="../ar435216/index.html">ููููุฉ ุฌุนู 200 ูู ุณุทุฑูู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูููุงุฐุง ุชุญุชุงุฌ ุฅูู ุงูููุงู ุจุฐูู</a></li>
<li><a href="../ar435220/index.html">Kotlin Native: ุชุชุจุน ุงููููุงุช</a></li>
<li><a href="../ar435224/index.html">ููููุฉ ุงูุชูุงุตู ูู ููุชุจ ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ: 14 ุชุนุจูุฑุงุช ูููุฏุฉ</a></li>
<li><a href="../ar435226/index.html">ุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช ูู ููุทุฉ ุงูุตูุฑ</a></li>
<li><a href="../ar435234/index.html">ุฃูุซุฑ ุฐูุงุกู ูุฃูุซุฑ ุฏูุฉ: ููู ุชุบูุฑ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงูุฑุญูุงุช ุงูุฌููุฉ ุฅูู ุงููุถุงุก</a></li>
<li><a href="../ar435236/index.html">ุจุงูุช ุขูุฉ ุงูุญุตู (ูููุณ ููุท) ูู ุฃูุฑููุง ุงูุฃุตููุฉ (ุฌุฒุก 3)</a></li>
<li><a href="../ar435240/index.html">ุบูุฑ ูุงูุนู Engine4 - ุชุฃุซูุฑ ุงููุณุญ PostProcess</a></li>
<li><a href="../ar435242/index.html">ููุงุฐุง ุฃุฎุดู ุฃู ุฃุตุจุญ "ุฑุฌูุงู ุถุฎูุงู"</a></li>
<li><a href="../ar435244/index.html">ูุดุฑูุน ITER ูู ุนุงู 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>