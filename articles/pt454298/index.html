<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ∑Ô∏è üë≤üèæ ü§öüèΩ O impasse: como foi üîü ü•ã üôèüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sauda√ß√µes! Tendo visto interesse suficiente no que est√° acontecendo no The Standoff entre os defensores do PHDays 9, decidimos conversar sobre como a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O impasse: como foi</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/454298/"><img src="https://habrastorage.org/webt/ef/tx/b3/eftxb30vyae7fr5w6xkios-nl9q.jpeg"><br><br>  Sauda√ß√µes!  Tendo visto interesse suficiente no que est√° acontecendo no The Standoff entre os defensores do PHDays 9, decidimos conversar sobre como a prepara√ß√£o e o ‚Äúimpasse‚Äù ocorreram atrav√©s dos olhos do Jet CSIRT como parte da equipe de seguran√ßa do Jet. <br><a name="habracut"></a><br><h3>  Guo Standoff, eu criei </h3><br>  Algo assim, os colegas relataram que estamos novamente participando do The Standoff, e naturalmente concordamos. <br><br>  Vale ressaltar imediatamente que para os defensores deste ano o formato da competi√ß√£o mudou um pouco.  Todas as equipes receberam infra-estruturas de escrit√≥rio muito semelhantes, e isso possibilitou aos organizadores inserir uma classifica√ß√£o de defensores em certos papagaios.  E para a equipe de seguran√ßa do jato, esse foi o primeiro "confronto", onde o escrit√≥rio foi defendido, e n√£o a infraestrutura industrial. <br><br>  Temos acesso √† infraestrutura para nos preparar para a batalha cibern√©tica no final de abril.  Ap√≥s a auditoria da infraestrutura, um conjunto de defici√™ncias foi montado, aqui est√£o apenas algumas delas.  Absolutamente em toda a infraestrutura, n√£o havia patches reais.  As senhas de todos os usu√°rios podem ser obtidas atrav√©s do Ntds.dit em texto n√£o criptografado.  Al√©m disso, alguns usu√°rios tinham senhas da lista TOP-500 ou senhas com um hash facilmente revers√≠vel.  O endurecimento do sistema estava pr√≥ximo de nada ou nada.  Alguns hosts na DMZ tinham uma interface na sub-rede do servidor. <br><br>  Com base nos resultados da auditoria, desenvolvemos certas medidas de seguran√ßa. Por sua vez, os organizadores, ap√≥s aprova√ß√£o preliminar, nos permitiram aplicar as pol√≠ticas de que precis√°vamos e trazer todas as ferramentas e ferramentas de seguran√ßa que podem ser implantadas em um ambiente virtual.  Devido aos prazos apertados, algumas id√©ias sobre medidas de prote√ß√£o ca√≠ram no in√≠cio.  As principais configura√ß√µes e perfis do SPI foram realizados durante as f√©rias de maio (ol√° a todos que tiraram fotos dos piqueniques, tamb√©m te amamos), e alguns equipamentos de prote√ß√£o tiveram que ser ajustados logo antes do in√≠cio no site.  Al√©m disso, v√°rios servi√ßos foram proibidos de corrigir e reconfigurar fortemente.  Por exemplo, um deles era o Oracle Weblogic com CVE-2019-2725, que o PoC foi lan√ßado nos primeiros dias de maio de 2019. <br><br>  Bem, e uma lista do que trouxemos conosco: <br><br><ul><li>  Firewall (fornecido pelos organizadores foi substitu√≠do); </li><li>  Solu√ß√£o antiv√≠rus; </li><li>  WAF; </li><li>  EDR </li><li>  Algumas solu√ß√µes para enganar; </li><li>  Um par de scanners de vulnerabilidade; </li><li>  Pilha ELK para an√°lise adicional do Netflow; </li><li>  SIEM. </li></ul><br>  Tamb√©m devemos conversar sobre o que estava acontecendo no SIEM.  Como fontes de eventos, t√≠nhamos √† disposi√ß√£o os logs do Windows, Sysmon, Auditd e, como voc√™ pode imaginar, eventos do pr√≥prio SZI.  Se n√£o houve problemas especiais com os dois primeiros, e concordamos rapidamente com as mudan√ßas na pol√≠tica e na configura√ß√£o do Sysmon, tivemos que lutar com os organizadores para a configura√ß√£o do Auditd. <br><br>  Paralelamente, identificamos os principais vetores de ataque e, com base nisso, selecionamos e adaptamos cen√°rios e regras de correla√ß√£o relevantes - um total de cerca de 160 regras de correla√ß√£o.  Al√©m disso, um conjunto de pain√©is heterog√™neos foi montado para n√≥s cr√≠ticos, SZI e o que exigia aten√ß√£o especial na infraestrutura de jogos. <br><br><h3>  O impasse </h3><br>  No The Standoff, decidimos adotar o conceito de separar incidentes em externos e internos, pois havia um entendimento exato de que fora tentar√≠amos ativamente digitalizar e operar a web.  Os incidentes relacionados √† varredura e as tentativas de contornar o WAF foram monitorados separadamente, com uma prioridade mais baixa, o que nos permitiu focar em incidentes internos.  Os pain√©is do SPI foram distribu√≠dos entre os defensores nas √°reas de responsabilidade, e pelo menos 2 pessoas foram designadas para cada ferramenta - para a possibilidade de rota√ß√£o e descanso. <br><br>  Tudo aconteceu, como esper√°vamos.  O confronto come√ßou por volta das 10 horas da manh√£ e, assim que o in√≠cio foi iniciado, o sistema SIEM come√ßou a emitir um monte de incidentes relacionados a uma verifica√ß√£o externa e a tentativas dos invasores de explorar a web.  Em alguns casos, at√© o grupo n√£o salvou.  Junto com isso, os verificadores dos organizadores come√ßaram a trabalhar, verificando o status de v√°rios servi√ßos no escrit√≥rio, o que nos for√ßou a re-conduzir perfis at√© certo ponto para eliminar os falsos positivos associados a eles. <br><br>  Nas primeiras horas do jogo, a equipe do Hack.ERS conseguiu encontrar as credenciais padr√£o do administrador (admin / admin) no CMS de um dos recursos e detectar uma poss√≠vel vulnerabilidade de LFI.  Essas tentativas n√£o passaram despercebidas, nossos defensores deram uma resposta operacional e os atacantes no final n√£o puderam avan√ßar mais. <br><br>  At√© o final do primeiro dia de jogo, os m√©todos n√£o foram alterados, o WAF ainda superava todas as tentativas de enviar algo interessante para os sites da empresa, e os mesmos "endere√ßos externos", sem cessar, tentavam verificar nossos recursos. <br><br><img src="https://habrastorage.org/webt/k4/h2/je/k4h2jeeackujcdpdfydy2ci7i7s.png"><br><br>  No total, foram registrados 3.000 incidentes relacionados a tentativas de varredura, sem levar em conta o agrupamento de eventos em incidentes. <br><br><img src="https://habrastorage.org/webt/eo/c0/j-/eoc0j-v5ohyz-kbja5goxy9vzsi.png"><br><br>  E cerca de 2500 incidentes com tentativas de contornar o WAF, tamb√©m sem levar em conta o agrupamento de eventos em incidentes. <br><br>  √Ä noite, a intensidade de todas as atividades diminuiu - houve v√°rias raz√µes para isso.  Parte dos defensores e atacantes n√£o resistiu √† passagem de som e ao ensaio do concerto, que deveria ser realizado no dia seguinte.  Algumas equipes atacantes decidiram fazer uma pausa e continuar os ataques no final da manh√£, na esperan√ßa de que os defensores e o monitoramento tivessem menos recursos de monitoramento e alguma fadiga. <br><br>  Na manh√£ do segundo dia, os atacantes mudaram de t√°tica.  As informa√ß√µes de parte de seus funcion√°rios foram publicadas em um dos sites da empresa.  Os hackers aproveitaram essas informa√ß√µes e come√ßaram a coletar ativamente contas de usu√°rio por meio do Exchange (estat√≠sticas de tentativas na captura de tela). <br><br><img src="https://habrastorage.org/webt/ud/pp/z0/udppz0drbdk_woprerkpwz3xgos.png"><br><br>  Um pouco mais tarde, foram feitas tentativas inseguras para selecionar uma senha no gateway da VPN; as contas que n√£o estavam em nossa infraestrutura participaram da bruta.  Com alta probabilidade, os atacantes tentaram usar contas da infraestrutura j√° hackeada na esperan√ßa de que os organizadores as deixassem iguais em todos os lugares.  Como resultado, toda a situa√ß√£o com for√ßa bruta nos levou a criar um grupo de pain√©is sobre tend√™ncias em termos de autentica√ß√£o do usu√°rio.  Al√©m disso, refor√ßamos o monitoramento de incidentes relacionados a for√ßa bruta bem-sucedida, mas, felizmente, nenhum desses casos foi detectado. <br><br>  Aproximadamente uma hora antes do final do jogo, as tend√™ncias viram tentativas √∫nicas e bem-sucedidas de autenticar v√°rios usu√°rios, incluindo aqueles no Exchange; a an√°lise operacional mostrou que as fontes eram m√°quinas dos usu√°rios diretamente; a maioria dos eventos indicava que os organizadores efetuaram login no console da VMware Vcenter. <br><br>  Ao mesmo tempo, gravamos uma verifica√ß√£o interna de um n√≥ que foi conectado com √™xito via VPN.  Ap√≥s uma an√°lise operacional dos eventos relacionados ao incidente, ficou claro que os invasores conseguiram comprometer as credenciais de v√°rios usu√°rios e, a julgar pela aus√™ncia de tentativas de autentica√ß√£o sem √™xito, √© prov√°vel que os dados do usu√°rio tenham ‚Äúvazado‚Äù. <br><br>  As informa√ß√µes foram repassadas aos defensores.  Durante todo o tempo de resposta nos computadores pessoais dos usu√°rios comprometidos, a solu√ß√£o do terminal foi colocada em um modo de prote√ß√£o preventiva para diminuir a capacidade de ganhar uma posi√ß√£o no sistema.  As sess√µes de ataque no gateway da VPN foram eliminadas √† for√ßa e os atacantes foram expulsos do per√≠metro protegido.  No UZ comprometido, as senhas foram prontamente alteradas. <br><br>  Nesse exato momento, os caras da equipe True0xA3 subiram ao palco e usaram com sucesso o OSINT e relataram o comprometimento do escrit√≥rio da Behealthy, que est√° sob a prote√ß√£o de outra equipe.  Os invasores conseguiram comprometer o administrador do dom√≠nio.  Os organizadores foram notificados do nosso incidente e foram fornecidas provas. <br><br>  A √∫ltima hora foi especialmente quente devido ao s√∫bito OSINT, todo mundo estava esperando por mais alguns preparativos dos organizadores.  A equipe de monitoramento, por sua vez, monitorou todas as anomalias e incidentes suspeitos, mas ap√≥s uma tentativa malsucedida de penetrar em novas tentativas de invas√£o, ela n√£o se seguiu.  Portanto, os √∫ltimos minutos de jogo passaram e o sucesso do hacking do escrit√≥rio protegido pela equipe de seguran√ßa da Jet n√£o aconteceu. <br><br>  E algumas estat√≠sticas finais para dois dias de jogos: <br><br><ul><li>  1200 EPS em m√©dia e pouco menos de 3000 EPS no pico; </li><li>  Cerca de 7000 incidentes; </li><li>  Mais de 120 milh√µes de eventos. </li></ul><br><br><h3>  Fatores que nos ajudaram a vencer </h3><br><ul><li>  Distribui√ß√£o competente de pap√©is.  Cada um montou e esteve envolvido na maior parte do que ele faz nos projetos di√°rios.  Ningu√©m precisou estudar materiais da categoria "firewall para manequins". </li><li>  Perfil operacional de regras de correla√ß√£o.  Todos os falsos positivos foram processados ‚Äã‚Äãe efetuadas corre√ß√µes relacionadas aos recursos da infraestrutura de jogos. </li><li>  Resposta r√°pida.  Devido ao fato de v√°rias pessoas terem sido designadas para cada tipo de SZI e sistemas, n√£o tivemos problemas com o fato de a pessoa respons√°vel ter descansado ou simplesmente ter se afastado por alguns minutos.  Todas as informa√ß√µes do monitoramento foram processadas o mais r√°pido poss√≠vel. </li><li>  Experi√™ncia no fortalecimento e monitoramento de diversas infraestruturas. </li></ul><br>  PS Agradecimentos especiais a todos que vieram e fizeram perguntas, e pedimos desculpas √†queles que n√£o foram capazes de dizer algo no processo - a equipe estava esperando por ‚Äúcossacos maltratados‚Äù dos atacantes e n√£o p√¥de divulgar todos os detalhes. <br><br>  <i>Dmitry Lifanov, especialista no Centro de Monitoramento e Resposta a Incidentes de Seguran√ßa da Informa√ß√£o Jet CSIRT</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454298/">https://habr.com/ru/post/pt454298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454284/index.html">Desculpe, eu n√£o vou trabalhar porque √© inverno</a></li>
<li><a href="../pt454290/index.html">Princ√≠pio de responsabilidade √∫nica. N√£o √© t√£o simples quanto parece</a></li>
<li><a href="../pt454292/index.html">JS. Proxy. Armadilha para conhecer</a></li>
<li><a href="../pt454294/index.html">"Sem experimentos desnecess√°rios" ou como lan√ßamos um acelerador de banco</a></li>
<li><a href="../pt454296/index.html">Como uma escola em Porto Rico d√° vida √† qu√≠mica com o Minecraft: Education Edition</a></li>
<li><a href="../pt454300/index.html">Como os CTT diferem dos tubos de calor convencionais e como aplic√°-los</a></li>
<li><a href="../pt454302/index.html">Arquivos QVD - o que h√° dentro</a></li>
<li><a href="../pt454304/index.html">Impressora 3D 3D fa√ßa-voc√™-mesmo para cer√¢mica</a></li>
<li><a href="../pt454306/index.html">Cinco erros que cometi como desenvolvedor l√≠der</a></li>
<li><a href="../pt454308/index.html">AMA com Habr V.9.0. Podcast, Confer√™ncia e Conceitos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>