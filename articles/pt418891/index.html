<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñáÔ∏è üó®Ô∏è üêÆ Verificamos os c√≥digos-fonte do Android usando o PVS-Studio, ou ningu√©m √© perfeito ‚ùÑÔ∏è üï£ üëö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A. 
 O desenvolvimento de grandes projetos complexos √© imposs√≠vel sem o uso de metodologias e ferramentas de programa√ß√£o para ajudar a controlar a qua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verificamos os c√≥digos-fonte do Android usando o PVS-Studio, ou ningu√©m √© perfeito</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/418891/">  A. <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d66/7b5/688/d667b56886adb4c140b623e5c14d4fd5.png" alt="Android e Unicorn PVS-Studio"></div><br>  O desenvolvimento de grandes projetos complexos √© imposs√≠vel sem o uso de metodologias e ferramentas de programa√ß√£o para ajudar a controlar a qualidade do c√≥digo.  Antes de tudo, √© um padr√£o de codifica√ß√£o competente, revis√µes de c√≥digo, testes de unidade, analisadores de c√≥digo est√°tico e din√¢mico.  Tudo isso ajuda a identificar defeitos no c√≥digo nos est√°gios iniciais de desenvolvimento.  Este artigo demonstra os recursos do analisador est√°tico do PVS-Studio para detectar erros e poss√≠veis vulnerabilidades no c√≥digo do sistema operacional Android.  Esperamos que o artigo atraia leitores para a metodologia de an√°lise de c√≥digo est√°tica e que eles desejem implement√°-la no processo de desenvolvimento de seus pr√≥prios projetos. <br><a name="habracut"></a><br><h2>  1. Introdu√ß√£o </h2><br>  Um ano se passou desde a reda√ß√£o de um grande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> sobre erros no sistema operacional Tizen, e eu queria novamente conduzir um estudo igualmente interessante de algum tipo de sistema operacional.  A escolha caiu no Android. <br><br>  O c√≥digo do sistema operacional Android √© de qualidade, bem testado.  Durante o desenvolvimento, pelo menos um analisador de c√≥digo est√°tico do Coverity √© usado, conforme evidenciado pelos coment√°rios do formul√°rio: <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Coverity: [FALSE-POSITIVE error] intended fall through */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Missing break statement between cases in switch statement */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* fall through */</span></span></code> </pre> <br>  Em geral, este √© um projeto interessante e de alta qualidade, e encontrar erros nele √© um desafio para o nosso analisador est√°tico PVS-Studio. <br><br>  Penso que apenas pelo volume do artigo o leitor entende que o analisador PVS-Studio fez um excelente trabalho e encontrou muitos defeitos no c√≥digo deste sistema operacional. <br><br><h2>  Enumera√ß√£o de fraqueza comum </h2><br>  No artigo, voc√™ encontrar√° refer√™ncias √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Enumera√ß√£o de Fraqueza Comum</a> (CWE).  Explicamos o motivo da refer√™ncia a esta lista e por que √© importante do ponto de vista da seguran√ßa. <br><br>  Freq√ºentemente, a causa das vulnerabilidades nos programas n√£o √© um conjunto complicado de circunst√¢ncias, mas um erro banal de software.  Aqui ser√° apropriado citar esta cita√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">prqa.com</a> : <br><br>  O Instituto Nacional de Padr√µes e Tecnologia (NIST) relata que 64% das vulnerabilidades de software decorrem de erros de programa√ß√£o e n√£o da falta de recursos de seguran√ßa. <br><br>  Voc√™ pode ler no artigo ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como o PVS-Studio pode ajudar a encontrar vulnerabilidades?</a> ‚Äù Com alguns exemplos de erros simples que levaram a vulnerabilidades em projetos como MySQL, iOS, NAS, illumos-gate. <br><br>  Consequentemente, muitas vulnerabilidades podem ser eliminadas detectando erros comuns a tempo e corrigindo-os.  E aqui a Enumera√ß√£o Comum de Fraqueza entra em cena. <br><br>  Os erros s√£o diferentes e nem todos os erros s√£o perigosos do ponto de vista da seguran√ßa.  Os erros que podem causar vulnerabilidades s√£o coletados na Enumera√ß√£o de Fraqueza Comum.  Esta lista est√° sendo atualizada e provavelmente h√° erros que podem levar a vulnerabilidades, mas elas ainda n√£o foram inclu√≠das nesta lista. <br><br>  No entanto, se o erro for classificado de acordo com a CWE, significa que √© teoricamente poss√≠vel que possa ser explorado como uma vulnerabilidade ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE</a> ).  Sim, a probabilidade disso √© pequena.  Muito raramente, o CWE se transforma em CVE.  No entanto, se voc√™ deseja proteger seu c√≥digo contra vulnerabilidades, voc√™ deve, se poss√≠vel, encontrar o maior n√∫mero poss√≠vel de erros descritos no CWE e corrigi-los. <br><br>  Esquematicamente, o relacionamento entre PVS-Studio, erros, CWE e CVE √© mostrado na figura: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/06f/5b9/142/06f5b9142918167cf4e0951f3affbaa6.png" alt="CWE, CVE, Est√∫dio PVS"></div><br><br>  Alguns erros s√£o classificados como CWE.  O PVS-Studio pode detectar muitos desses erros, impedindo que alguns desses defeitos se tornem vulnerabilidades (CVE). <br><br>  Podemos dizer que o PVS-Studio identifica muitas vulnerabilidades em potencial antes que elas causem danos.  Assim, o PVS-Studio √© uma ferramenta est√°tica de teste de seguran√ßa de aplicativos ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SAST</a> ). <br><br>  Agora, penso, est√° claro por que, ao descrever os erros, considerei importante observar como eles s√£o classificados de acordo com a CWE.  Dessa forma, √© mais f√°cil mostrar a import√¢ncia do uso de um analisador de c√≥digo est√°tico em projetos cr√≠ticos, aos quais os sistemas operacionais se relacionam claramente. <br><br><h2>  Verifica√ß√£o Android </h2><br>  Para analisar o projeto, usei o analisador PVS-Studio vers√£o 6.24.  Atualmente, o analisador suporta os seguintes idiomas e compiladores: <br><br><ul><li>  Windows  Visual Studio 2010-2017 C, C ++, C ++ / CLI, C ++ / CX (WinRT), C # </li><li>  Windows  IAR Embedded Workbench, Compilador C / C ++ para ARM C, C ++ </li><li>  Windows / Linux  Keil ¬µVision, DS-MDK, Compilador ARM 5/6 C, C ++ </li><li>  Windows / Linux  Texas Instruments Code Composer Studio, Ferramentas de gera√ß√£o de c√≥digo ARM C, C ++ </li><li>  Windows / Linux / macOS.  Clang C, C ++ </li><li>  Linux / macOS.  GCC C, C ++ </li><li>  Windows  MinGW C, C ++ </li></ul><br>  Nota  Talvez alguns de nossos leitores tenham perdido as not√≠cias de que apoiamos o trabalho no ambiente macOS e estejam interessados ‚Äã‚Äãnesta publica√ß√£o: " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lan√ßamento do PVS-Studio para macOS: 64 pontos fracos no Apple XNU Kernel</a> ". <br><br>  O processo de verifica√ß√£o do c√≥digo-fonte do Android n√£o foi um problema, por isso n√£o vou insistir nele.  O problema, pelo contr√°rio, era minha preocupa√ß√£o com outras tarefas, motivo pelo qual n√£o encontrei tempo e energia para analisar o relat√≥rio com o m√°ximo cuidado que gostaria.  No entanto, mesmo uma r√°pida olhada foi mais que suficiente para reunir uma grande cole√ß√£o de erros interessantes para um artigo s√≥lido. <br><br>  Mais importante: pe√ßo aos desenvolvedores do Android n√£o apenas para corrigir os erros descritos no artigo, mas tamb√©m para realizar uma an√°lise independente mais cuidadosa.  Olhei para o relat√≥rio do analisador superficialmente e poderia ter perdido muitos erros s√©rios. <br><br>  No primeiro teste, o analisador produzir√° muitos falsos positivos, mas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">isso n√£o √© um problema</a> .  Nossa equipe est√° pronta para ajudar com recomenda√ß√µes sobre a configura√ß√£o do analisador para reduzir o n√∫mero de falsos positivos.  Tamb√©m estamos prontos para fornecer uma chave de licen√ßa por um m√™s ou mais, se necess√°rio.  Em geral, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">escreva-nos</a> , ajudaremos e informaremos. <br><br>  Agora vamos ver quais erros e poss√≠veis vulnerabilidades eu consegui encontrar.  Espero que voc√™ goste do que o analisador de c√≥digo est√°tico do PVS-Studio pode encontrar.  Boa leitura. <br><br><h2>  Compara√ß√µes sem sentido </h2><br>  O analisador considera as express√µes anormais se forem sempre verdadeiras ou falsas.  Esses avisos, de acordo com a Enumera√ß√£o de Fraqueza Comum, s√£o classificados como: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-570</a> : A express√£o √© sempre falsa </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-571</a> : Express√£o √© sempre verdadeira </li></ul><br>  O analisador gera muitos desses avisos e, infelizmente, a maioria deles √© falsa para o c√≥digo do Android.  Nesse caso, o analisador n√£o √© o culpado.  Apenas o c√≥digo est√° escrito assim. <br>  Vou demonstrar isso com um exemplo simples. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> GENERIC_TARGET const char alternative_config_path[] = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/data/nfc/"</span></span></span><span class="hljs-meta">; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> const char alternative_config_path[] = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> CNxpNfcConfig&amp; CNxpNfcConfig::GetInstance() { .... </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (alternative_config_path[0] != </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'\0'</span></span></span><span class="hljs-meta">) { .... }</span></span></code> </pre> <br>  Aqui, o analisador gera um aviso: A express√£o V547 CWE-570 'alternative_config_path [0]! =' \ 0 '' √© sempre falsa.  phNxpConfig.cpp 401 <br><br>  O fato √© que a macro <i>GENERIC_TARGET</i> n√£o est√° definida e, do ponto de vista do analisador, o c√≥digo se parece com o seguinte: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> alternative_config_path[] = <span class="hljs-string"><span class="hljs-string">""</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (alternative_config_path[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) {</code> </pre> <br>  O analisador √© simplesmente obrigado a emitir um aviso, uma vez que a linha est√° vazia e um terminal zero est√° sempre localizado no deslocamento de zero.  Assim, o analisador est√° formalmente certo ao emitir um aviso.  No entanto, do ponto de vista pr√°tico, n√£o h√° benef√≠cio com esse aviso. <br><br>  Infelizmente, nada pode ser feito com tais situa√ß√µes.  Teremos que revisar sistematicamente todos esses avisos e marcar muitos lugares como falsos positivos, para que o analisador n√£o emita mais mensagens nessas linhas.  Isso realmente precisa ser feito, porque, al√©m de mensagens sem sentido, muitos defeitos reais ser√£o encontrados. <br><br>  Admito sinceramente que n√£o estava interessado em examinar atentamente avisos desse tipo e os revisei superficialmente.  No entanto, mesmo isso ser√° suficiente para mostrar que esses diagn√≥sticos s√£o muito √∫teis e encontram erros interessantes. <br><br>  Quero come√ßar com a situa√ß√£o cl√°ssica quando a fun√ß√£o de comparar dois objetos √© implementada incorretamente.  Por que cl√°ssico?  Esse √© um padr√£o de erro t√≠pico que encontramos constantemente em uma variedade de projetos.  Provavelmente, existem tr√™s raz√µes para sua ocorr√™ncia: <br><br><ol><li>  As fun√ß√µes de compara√ß√£o s√£o simples e s√£o escritas ‚Äúautomaticamente‚Äù e usando a tecnologia Copy-Paste.  Ao escrever esse c√≥digo, uma pessoa √© desatenta e, muitas vezes, faz erros de digita√ß√£o. </li><li>  Normalmente, a revis√£o de c√≥digo n√£o √© executada para essas fun√ß√µes, pois √© muito pregui√ßoso olhar para fun√ß√µes simples e chatas. </li><li>  Testes de unidade geralmente n√£o s√£o realizados para essas fun√ß√µes.  Por pregui√ßa.  Al√©m disso, as fun√ß√µes s√£o simples e os programadores n√£o acreditam que sejam poss√≠veis erros nelas. </li></ol><br>  Esses pensamentos e exemplos s√£o descritos em mais detalhes no artigo "O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mal vive nas fun√ß√µes de compara√ß√£o</a> ". <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAudioPlaybackRateEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AudioPlaybackRate &amp;pr1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AudioPlaybackRate &amp;pr2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(pr1.mSpeed - pr2.mSpeed) &lt; AUDIO_TIMESTRETCH_SPEED_MIN_DELTA &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(pr1.mPitch - pr2.mPitch) &lt; AUDIO_TIMESTRETCH_PITCH_MIN_DELTA &amp;&amp; pr2.mStretchMode == pr2.mStretchMode &amp;&amp; pr2.mFallbackMode == pr2.mFallbackMode; }</code> </pre> <br>  Portanto, diante de n√≥s est√° a fun√ß√£o cl√°ssica de comparar dois objetos do tipo <i>AudioPlaybackRate</i> .  E, como penso, o leitor acha que est√° errado.  O analisador PVS-Studio percebe dois erros de digita√ß√£o imediatamente: <br><br><ul><li>  V501 CWE-571 Existem subexpress√µes id√™nticas √† esquerda e √† direita do operador '==': pr2.mStretchMode == pr2.mStretchMode AudioResamplerPublic.h 107 </li><li>  V501 CWE-571 Existem subexpress√µes id√™nticas √† esquerda e √† direita do operador '==': pr2.mFallbackMode == pr2.mFallbackMode AudioResamplerPublic.h 108 </li></ul><br>  O campo <i>pr2.mStretchMode</i> e o campo <i>pr2.mFallbackMode s√£o</i> comparados entre si.  Acontece que a fun√ß√£o n√£o compara objetos com precis√£o suficiente. <br><br>  A seguinte compara√ß√£o in√∫til reside em uma fun√ß√£o que armazena informa√ß√µes de impress√£o digital em um arquivo. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveFingerprint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">worker_thread_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* listener, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> idx)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ns = fwrite(&amp;listener-&gt;secureid[idx], <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, fp); .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nf = fwrite(&amp;listener-&gt;fingerid[idx], <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, fp); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ns != <span class="hljs-number"><span class="hljs-number">1</span></span> || ns !=<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= ALOGW("Corrupt emulator fingerprints storage; " "could not save fingerprints"); fclose(fp); return; }</span></span></code> </pre> <br>  Uma anomalia √© detectada neste c√≥digo por dois diagn√≥sticos ao mesmo tempo: <br><br><ul><li>  V501 CWE-570 Existem subexpress√µes id√™nticas √† esquerda e √† direita do '||'  operador: ns! = 1 ||  ns! = 1 impress√£o digital.c 126 </li><li>  V560 CWE-570 Uma parte da express√£o condicional √© sempre falsa: ns! = 1. fingerprint.c 126 </li></ul><br>  N√£o h√° como lidar com a situa√ß√£o quando a segunda chamada para a fun√ß√£o de grava√ß√£o n√£o pode gravar dados em um arquivo.  Em outras palavras, o valor da vari√°vel <i>nf</i> n√£o <i>√©</i> verificado.  A verifica√ß√£o correta deve ficar assim: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ns != <span class="hljs-number"><span class="hljs-number">1</span></span> || nf != <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Prosseguimos para o pr√≥ximo erro associado ao uso do operador <i>&amp;</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> O_RDONLY 00000000 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> O_WRONLY 00000001 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> O_RDWR 00000002 static ssize_t verity_read(fec_handle *f, ....) { .... </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* if we are in read-only mode and expect to read a zero block, skip reading and just return zeros */</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (f-&gt;mode &amp; O_RDONLY &amp;&amp; expect_zeros) { memset(data, 0, FEC_BLOCKSIZE); goto valid; } .... }</span></span></code> </pre> <br>  Aviso do PVS-Studio: V560 CWE-570 Uma parte da express√£o condicional √© sempre falsa: f-&gt; mode &amp; 00000000. fec_read.cpp 322 <br><br>  Observe que a constante <i>O_RDONLY</i> √© zero.  Isso torna a express√£o <i>f-&gt; mode &amp; O_RDONLY</i> in√∫til, como sempre √© 0. Acontece que a condi√ß√£o da <i>instru√ß√£o if</i> nunca <i>√©</i> satisfeita, e a declara√ß√£o true √© c√≥digo morto. <br><br>  A verifica√ß√£o correta deve ser assim: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f-&gt;mode == O_RDONLY &amp;&amp; expect_zeros) {</code> </pre> <br>  Agora, vamos olhar para um erro de digita√ß√£o cl√°ssico quando esquecemos de escrever parte da condi√ß√£o. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> { .... CHANGE_DISPLAY_INFO = <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>, .... }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> RotaryEncoderInputMapper::configure(<span class="hljs-keyword"><span class="hljs-keyword">nsecs_t</span></span> when, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InputReaderConfiguration* config, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> changes) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!changes || (InputReaderConfiguration::CHANGE_DISPLAY_INFO)) { .... }</code> </pre> <br>  PVS-Studio Warning: V768 CWE-571 A constante de enumera√ß√£o 'CHANGE_DISPLAY_INFO' √© usada como uma vari√°vel do tipo booleano.  InputReader.cpp 3016 <br><br>  A condi√ß√£o √© sempre verdadeira, pois o operando <i>InputReaderConfiguration :: CHANGE_DISPLAY_INFO</i> √© uma constante igual a 4. <br><br>  Se voc√™ observar como o c√≥digo √© escrito na vizinhan√ßa, fica claro que, de fato, a condi√ß√£o deve ser assim: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!changes || (changes &amp; InputReaderConfiguration::CHANGE_DISPLAY_INFO)) {</code> </pre> <br>  A compara√ß√£o a seguir, que n√£o faz sentido, eu conheci no operador de loop. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_printerAttributes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">ipp_t</span></span> *collection = ippGetCollection(attrptr, i); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>, attrptr = ippFirstAttribute(collection); (j &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp;&amp; (attrptr != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); attrptr = ippNextAttribute(collection)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, ippGetName(attrptr)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ....TopMargin = ippGetInteger(attrptr, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, ippGetName(attrptr)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ....BottomMargin = ippGetInteger(attrptr, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, ippGetName(attrptr)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ....LeftMargin = ippGetInteger(attrptr, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, ippGetName(attrptr)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ....RightMargin = ippGetInteger(attrptr, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } .... }</code> </pre> <br>  Aviso do PVS-Studio: V560 CWE-571 Uma parte da express√£o condicional √© sempre verdadeira: (j &lt;4).  ipphelper.c 926 <br><br>  Observe que o valor da vari√°vel <i>j</i> n√£o <i>√©</i> incrementado em nenhum lugar.  Isso significa que a subexpress√£o <i>(j &lt;4) √©</i> sempre verdadeira. <br><br>  O maior n√∫mero de opera√ß√µes √∫teis do analisador PVS-Studio, referentes a condi√ß√µes sempre verdadeiras / falsas, refere-se ao c√≥digo em que o resultado da cria√ß√£o de objetos √© verificado usando o <i>novo</i> operador.  Em outras palavras, o analisador detecta o seguinte padr√£o de c√≥digo: <br><br><pre> <code class="cpp hljs">T *p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> T; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR;</code> </pre> <br>  Tais verifica√ß√µes s√£o in√∫teis.  Se n√£o foi poss√≠vel alocar mem√≥ria para o objeto, uma exce√ß√£o do tipo <i>std :: bad_alloc</i> ser√° <i>lan√ßada</i> e ela n√£o chegar√° √† verifica√ß√£o do valor do ponteiro. <br><br>  Nota  O <i>novo</i> operador pode retornar <i>nullptr</i> escrevendo <i>new (std :: nothrow) T.</i>  No entanto, isso n√£o se aplica aos erros discutidos.  O analisador PVS-Studio leva em considera√ß√£o <i>(std :: nothrow)</i> e n√£o <i>emite</i> um aviso se o objeto for criado dessa maneira. <br><br>  Pode parecer que esses erros s√£o inofensivos.  Bem, pense bem, uma verifica√ß√£o extra que nunca funciona.  De qualquer forma, ser√° lan√ßada uma exce√ß√£o que ser√° processada em algum lugar.  Infelizmente, alguns desenvolvedores colocam na declara√ß√£o true as a√ß√µes <i>if da declara√ß√£o</i> que liberam recursos etc.  Como esse c√≥digo n√£o est√° em execu√ß√£o, pode levar a vazamentos de mem√≥ria e outros erros. <br><br>  Considere um desses casos que notei no c√≥digo do Android. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_apk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *target_package_name)</span></span></span><span class="hljs-function"> </span></span>{ .... FileMap *dataMap = zip-&gt;createEntryFileMap(entry); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataMap == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { ALOGW(<span class="hljs-string"><span class="hljs-string">"%s: failed to create FileMap\n"</span></span>, __FUNCTION__); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *buf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[uncompLen]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == buf) { ALOGW(<span class="hljs-string"><span class="hljs-string">"%s: failed to allocate %"</span></span> PRIu32 <span class="hljs-string"><span class="hljs-string">" byte\n"</span></span>, __FUNCTION__, uncompLen); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> dataMap; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } .... }</code> </pre> <br>  Aviso do PVS-Studio: V668 CWE-570 N√£o h√° sentido em testar o ponteiro 'buf' contra nulo, pois a mem√≥ria foi alocada usando o operador 'novo'.  A exce√ß√£o ser√° gerada no caso de erro de aloca√ß√£o de mem√≥ria.  scan.cpp 213 <br><br>  Observe que, se n√£o for poss√≠vel alocar um segundo bloco de mem√≥ria, o programador tenta liberar o primeiro bloco: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> dataMap;</code> </pre> <br>  Esse c√≥digo nunca ter√° controle.  Este √© um c√≥digo morto.  Se ocorrer uma exce√ß√£o, ocorrer√° um vazamento de mem√≥ria. <br><br>  Escrever esse c√≥digo √© fundamentalmente errado.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ponteiros inteligentes foram</a> inventados para esses casos. <br><br>  No total, o analisador PVS-Studio detectou <b>176</b> lugares no c√≥digo do Android em que o ponteiro √© verificado depois de criar objetos usando o <i>novo</i> .  N√£o entendi o qu√£o perigoso √© cada um desses lugares e, √© claro, n√£o vou encher o artigo com todos esses avisos.  Os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">interessados</a> podem ver outros avisos no arquivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Android_V668.txt</a> . <br><br><h2>  Desreferenciando um ponteiro nulo </h2><br>  O cancelamento da refer√™ncia a um ponteiro nulo leva a um comportamento indefinido do programa, por isso √© √∫til encontrar e corrigir esses locais.  Dependendo da situa√ß√£o, o analisador PVS-Studio pode classificar esses erros de acordo com a Enumera√ß√£o de fraqueza comum da seguinte maneira: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-119</a> : Restri√ß√£o impr√≥pria de opera√ß√µes dentro dos limites de um buffer de mem√≥ria </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-476</a> : Derefer√™ncia de ponteiro NULL </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-628</a> : Chamada de fun√ß√£o com argumentos especificados incorretamente </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CWE-690</a> : Valor de retorno n√£o verificado para desrefer√™ncia de ponteiro NULL </li></ul><br>  Costumo encontrar esses erros no c√≥digo respons√°vel por lidar com situa√ß√µes fora do padr√£o ou incorretas.  Ningu√©m testa esse c√≥digo, e o erro pode permanecer nele por um per√≠odo muito longo.  Apenas esse caso ser√° considerado agora. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseEffect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmlProxyLib == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { ALOGE(<span class="hljs-string"><span class="hljs-string">"effectProxy must contain a &lt;%s&gt;: %s"</span></span>, tag, dump(*xmlProxyLib)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } .... }</code> </pre> <br>  PVS-Studio Warning: V522 CWE-476 A desreferencia√ß√£o do ponteiro nulo 'xmlProxyLib' pode ocorrer.  EffectsConfig.cpp 205 <br><br>  Se o ponteiro <i>xmlProxyLib</i> for <i>nullptr</i> , o programador exibir√° uma mensagem de depura√ß√£o, para a qual √© necess√°rio desreferenciar esse ponteiro.  Opa ... <br><br>  Agora considere uma vers√£o mais interessante do erro. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">soinfo_unload_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(soinfo* root)</span></span></span><span class="hljs-function"> </span></span>{ .... soinfo* needed = find_library(si-&gt;get_primary_namespace(), library_name, RTLD_NOLOAD, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (needed != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= PRINT("warning: couldn't find %s needed by %s on unload.", library_name, si-&gt;get_realpath()); return; } else if (local_unload_list.contains(needed)) { return; } else if (needed-&gt;is_linked() &amp;&amp; // &lt;= needed-&gt;get_local_group_root() != root) { external_unload_list.push_back(needed); } else { unload_list.push_front(needed); } .... }</span></span></code> </pre> <br>  PVS-Studio Warning: V522 CWE-476 A desreferencia√ß√£o do ponteiro nulo 'necess√°rio' pode ocorrer.  linker.cpp 1847 <br><br>  Se o ponteiro <i>necess√°rio! = Nullptr</i> , √© emitido um aviso, que √© um comportamento muito suspeito do programa.  Finalmente, fica claro que o c√≥digo cont√©m um erro se voc√™ olhar abaixo e ver que, quando <i>necess√°rio == nullptr</i> , o ponteiro nulo ser√° desreferenciado na express√£o <i>needed-&gt; is_linked ()</i> . <br><br>  Muito provavelmente, os operadores! = E == est√£o simplesmente confusos aqui.  Se voc√™ substituir, o c√≥digo da fun√ß√£o faz sentido e o erro desaparece. <br><br>  A maior parte dos avisos sobre a desreferencia√ß√£o potencial de um ponteiro nulo se refere a uma situa√ß√£o do formul√°rio: <br><br><pre> <code class="cpp hljs">T *p = (T *) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span> (N); *p = x;</code> </pre> <br>  Fun√ß√µes como <i>malloc</i> , <i>strdup</i> etc. podem retornar <i>NULL</i> se a mem√≥ria n√£o puder ser alocada.  Portanto, n√£o √© poss√≠vel remover a refer√™ncia de ponteiros que retornam essas fun√ß√µes sem primeiro verificar o ponteiro. <br><br>  Existem muitos erros semelhantes, ent√£o darei apenas dois fragmentos de c√≥digo simples: o primeiro com <br>  <i>malloc</i> e o segundo com <i>strdup</i> . <br><br><pre> <code class="cpp hljs">DownmixerBufferProvider::DownmixerBufferProvider(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">effect_param_t</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> param = (<span class="hljs-keyword"><span class="hljs-keyword">effect_param_t</span></span> *) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(downmixParamSize); param-&gt;psize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">downmix_params_t</span></span>); .... }</code> </pre> <br>  Aviso do PVS-Studio: V522 CWE-690 Pode haver desreferencia√ß√£o de um potencial ponteiro nulo 'param'.  Verifique as linhas: 245, 244. BufferProviders.cpp 245 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">descriptorClassToDot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* str)</span></span></span><span class="hljs-function"> </span></span>{ .... newStr = strdup(lastSlash); newStr[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(lastSlash)<span class="hljs-number"><span class="hljs-number">-1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; .... }</code> </pre> <br>  Aviso do PVS-Studio: V522 CWE-690 Pode haver desreferencia√ß√£o de um ponteiro nulo potencial 'newStr'.  Verifique as linhas: 203, 202. DexDump.cpp 203 <br><br>  Algu√©m pode dizer que esses s√£o erros menores.  Se n√£o houver mem√≥ria suficiente, o programa simplesmente trava ao remover a refer√™ncia do ponteiro nulo, e isso √© normal.  Como n√£o h√° mem√≥ria, n√£o h√° nada para tentar lidar de alguma forma com essa situa√ß√£o. <br><br>  Essa pessoa est√° errada.  Os ponteiros devem ser verificados!  Examinei esse t√≥pico em detalhes no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Por que √© importante verificar o que a fun√ß√£o malloc retornou</a> ".  Eu recomendo que voc√™ o leia para todos que ainda n√£o o leram. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/923/793/0c5/9237930c52039f4f7e0542bee775ce72.png" alt="malloc"></div><br><br>  Em suma, o perigo √© que a grava√ß√£o na mem√≥ria n√£o ocorra necessariamente perto do endere√ßo zero.  √â poss√≠vel gravar dados em algum lugar muito distante em uma p√°gina de mem√≥ria que n√£o esteja protegida contra grava√ß√£o e, assim, causar um erro indescrit√≠vel ou, em geral, esse erro pode ser usado como uma vulnerabilidade.  Vamos ver o que quero dizer com o exemplo da fun√ß√£o <i>check_size</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">radio_metadata_buffer_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **metadata_ptr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size_int)</span></span></span><span class="hljs-function"> </span></span>{ .... metadata = <span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(metadata, new_size_int * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>)); memmove( (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *)metadata + new_size_int - (metadata-&gt;count + <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *)metadata + metadata-&gt;size_int - (metadata-&gt;count + <span class="hljs-number"><span class="hljs-number">1</span></span>), (metadata-&gt;count + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>)); .... }</code> </pre> <br>  Aviso do PVS-Studio: V769 CWE-119 O ponteiro '(uint32_t *) metadados' na express√£o '(uint32_t *) metadados + express√£o new_size_int' pode ser nullptr.  Nesse caso, o valor resultante ser√° insensato e n√£o deve ser usado.  Verifique as linhas: 91, 89. radio_metadata.c 91 <br><br>  Eu n√£o entendi a l√≥gica da fun√ß√£o, mas isso n√£o √© necess√°rio.  O principal √© que um novo buffer √© criado e os dados s√£o copiados para ele.  Se a fun√ß√£o <i>realloc</i> retornar <i>NULL</i> , os dados ser√£o copiados para o endere√ßo ((uint32_t *) NULL + metadados-&gt; tamanho_int - (metadados-&gt; contagem + 1)). <br><br>  Se o <i>valor de metadados-&gt; size_int for</i> grande, as consequ√™ncias ser√£o lament√°veis.  Acontece que os dados s√£o gravados em um peda√ßo aleat√≥rio de mem√≥ria. <br><br>  A prop√≥sito, existe outro tipo de cancelamento de refer√™ncia de ponteiro nulo, que o analisador PVS-Studio classifica n√£o como CWE-690, mas como CWE-628 (argumento inv√°lido). <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_tcp_ports</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *portstring, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ports)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *buffer; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *cp; buffer = strdup(portstring); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((cp = <span class="hljs-built_in"><span class="hljs-built_in">strchr</span></span>(buffer, <span class="hljs-string"><span class="hljs-string">':'</span></span>)) == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) .... }</code> </pre> <br>  Aviso do PVS-Studio: V575 CWE-628 O potencial ponteiro nulo √© passado para a fun√ß√£o 'strchr'.  Inspecione o primeiro argumento.  Verifique as linhas: 47, 46. libxt_tcp.c 47 <br><br>  O fato √© que a desreferencia√ß√£o do ponteiro ocorrer√° quando a fun√ß√£o <i>strchr</i> for <i>chamada</i> .  Portanto, o analisador interpreta essa situa√ß√£o como passando um valor incorreto para a fun√ß√£o. <br><br>  Os <b>194</b> avisos restantes deste tipo I s√£o listados no arquivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Android_V522_V575.txt</a> . <br><br>  A prop√≥sito, uma aten√ß√£o especial a todos esses erros √© dada pelos avisos discutidos anteriormente sobre a verifica√ß√£o do ponteiro ap√≥s chamar o <i>novo</i> operador.  Acontece que existem 195 chamadas para as <i>fun√ß√µes</i> <i>malloc</i> / <i>realloc</i> / <i>strdup</i> e assim por diante, quando o ponteiro n√£o est√° marcado.  Mas h√° 176 lugares em que o ponteiro √© verificado depois de chamar de <i>novo</i> .  Concordo, uma abordagem estranha! <br><br>  No final, resta considerar os avisos V595 e V1004, que tamb√©m est√£o associados ao uso de ponteiros nulos. <br><br>  O V595 detecta situa√ß√µes em que o ponteiro √© desreferenciado e depois verificado.  Exemplo sint√©tico: <br><br><pre> <code class="cpp hljs">p-&gt;foo(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!p) Error();</code> </pre> <br>  O V1004 revela a situa√ß√£o inversa quando o ponteiro foi verificado primeiro e depois se esqueceu de faz√™-lo.  Exemplo sint√©tico: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p) p-&gt;foo(); p-&gt;doo();</code> </pre> <br>  Vejamos alguns fragmentos do c√≥digo Android, onde houve erros desse tipo.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Explique especialmente que seus recursos n√£o s√£o necess√°rios. </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">PV_STATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RC_UpdateBuffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(VideoEncData *video, Int currLayer, Int num_skip)</span></span></span><span class="hljs-function"> </span></span>{ rateControl *rc = video-&gt;rc[currLayer]; MultiPass *pMP = video-&gt;pMP[currLayer]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (video == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || rc == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || pMP == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PV_FAIL; .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V595 CWE-476 O ponteiro 'video' foi utilizado antes de ser verificado no nullptr. </font><font style="vertical-align: inherit;">Verifique as linhas: 385, 388. rate_control.cpp 385</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resampler_reset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct resampler_itfe *resampler)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resampler</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rsmp</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resampler</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resampler</span></span></span><span class="hljs-class">;</span></span> rsmp-&gt;frames_in = <span class="hljs-number"><span class="hljs-number">0</span></span>; rsmp-&gt;frames_rq = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rsmp != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> &amp;&amp; rsmp-&gt;speex_resampler != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { speex_resampler_reset_mem(rsmp-&gt;speex_resampler); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V595 CWE-476 O ponteiro 'rsmp' foi utilizado antes de ser verificado no nullptr. </font><font style="vertical-align: inherit;">Verifique as linhas: 54, 57. resampler.c 54</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bta_gattc_disc_cmpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tBTA_GATTC_CLCB* p_clcb, UNUSED_ATTR tBTA_GATTC_DATA* p_data)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_clcb-&gt;status != GATT_SUCCESS) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_clcb-&gt;p_srcb) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;tBTA_GATTC_SERVICE&gt;().swap( p_clcb-&gt;p_srcb-&gt;srvc_cache); } bta_gattc_cache_reset(p_clcb-&gt;p_srcb-&gt;server_bda); } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V1004 CWE-476 O ponteiro 'p_clcb-&gt; p_srcb' foi usado sem seguran√ßa depois de ter sido verificado com nullptr. </font><font style="vertical-align: inherit;">Verifique as linhas: 695, 701. bta_gattc_act.cc 701 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o √© interessante considerar outros avisos desse tipo. </font><font style="vertical-align: inherit;">Entre eles, existem erros e avisos falsos que surgem devido a c√≥digos mal ou dificilmente escritos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escrevi uma d√∫zia de avisos √∫teis:</font></font><br><br><ul><li> V1004 CWE-476 The 'ain' pointer was used unsafely after it was verified against nullptr. Check lines: 101, 105. rsCpuIntrinsicBLAS.cpp 105 </li><li> V595 CWE-476 The 'outError' pointer was utilized before it was verified against nullptr. Check lines: 437, 450. Command.cpp 437 </li><li> V595 CWE-476 The 'out_last_reference' pointer was utilized before it was verified against nullptr. Check lines: 432, 436. AssetManager2.cpp 432 </li><li> V595 CWE-476 The 'set' pointer was utilized before it was verified against nullptr. Check lines: 4524, 4529. ResourceTypes.cpp 4524 </li><li> V595 CWE-476 The 'reply' pointer was utilized before it was verified against nullptr. Check lines: 126, 133. Binder.cpp 126 </li><li> V595 CWE-476 The 'video' pointer was utilized before it was verified against nullptr. Check lines: 532, 540. rate_control.cpp 532 </li><li> V595 CWE-476 The 'video' pointer was utilized before it was verified against nullptr. Check lines: 702, 711. rate_control.cpp 702 </li><li> V595 CWE-476 The 'pInfo' pointer was utilized before it was verified against nullptr. Check lines: 251, 254. ResolveInfo.cpp 251 </li><li> V595 CWE-476 The 'address' pointer was utilized before it was verified against nullptr. Check lines: 53, 55. DeviceHalHidl.cpp 53 </li><li> V595 CWE-476 The 'halAddress' pointer was utilized before it was verified against nullptr. Check lines: 55, 82. DeviceHalHidl.cpp 55 </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ent√£o fiquei entediado e filtrei avisos desse tipo. Portanto, eu nem sei quantos erros reais o analisador detectou. Esses avisos aguardam seu her√≥i, que os estudar√° cuidadosamente e far√° altera√ß√µes no c√≥digo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu s√≥ quero chamar a aten√ß√£o dos meus novos leitores para erros desse tipo:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NJ_EXTERN NJ_INT16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">njx_search_word</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NJ_CLASS *iwnn, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... NJ_PREVIOUS_SELECTION_INFO *prev_info = &amp;(iwnn-&gt;previous_selection); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (iwnn == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NJ_SET_ERR_VAL(NJ_FUNC_NJ_SEARCH_WORD, NJ_ERR_PARAM_ENV_NULL); } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V595 CWE-476 O ponteiro 'iwnn' foi utilizado antes de ser verificado no nullptr. </font><font style="vertical-align: inherit;">Verifique as linhas: 686, 689. ndapi.c 686 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algumas pessoas pensam que n√£o h√° erro aqui, porque "n√£o h√° desrefer√™ncia real do ponteiro". </font><font style="vertical-align: inherit;">O endere√ßo de uma vari√°vel inexistente √© simplesmente calculado. </font><font style="vertical-align: inherit;">Al√©m disso, se o ponteiro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iwnn for</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zero, a fun√ß√£o ser√° encerrada. </font><font style="vertical-align: inherit;">Portanto, nada de ruim aconteceu que anteriormente calculamos incorretamente o endere√ßo de um membro da classe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o, voc√™ n√£o pode falar assim. </font><font style="vertical-align: inherit;">Esse c√≥digo leva a um comportamento indefinido e, portanto, n√£o pode ser escrito assim. </font><font style="vertical-align: inherit;">O comportamento indefinido pode se manifestar, por exemplo, da seguinte maneira:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O compilador v√™ o ponteiro desreferenciado: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iwnn-&gt; previous_selection</font></font></i> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voc√™ n√£o pode desreferenciar um ponteiro nulo, porque esse √© um comportamento indefinido </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O compilador conclui que o ponteiro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iwnn √©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sempre diferente de zero</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O compilador remove a verifica√ß√£o extra: if (iwnn == NULL) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora, quando o programa √© executado, a verifica√ß√£o do ponteiro nulo n√£o √© executada e o trabalho come√ßa com o ponteiro incorreto para o membro da classe. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este t√≥pico √© descrito em mais detalhes no meu artigo "O </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cancelamento da refer√™ncia a um ponteiro nulo leva a um comportamento indefinido</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ".</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dados privados n√£o s√£o apagados na mem√≥ria </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Considere um tipo s√©rio de vulnerabilidade potencial que √© classificada de acordo com a Enumera√ß√£o de fraqueza comum como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-14</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Remo√ß√£o de c√≥digo do compilador para limpar buffers. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em resumo, a conclus√£o √© a seguinte: o compilador tem o direito de remover a chamada de fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se depois disso o buffer n√£o for mais usado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando escrevo sobre esse tipo de vulnerabilidade, os coment√°rios parecem necessariamente que essa √© apenas uma falha no compilador que precisa ser corrigida. </font><font style="vertical-align: inherit;">N√£o, isso n√£o √© uma falha. </font><font style="vertical-align: inherit;">E antes de se opor, leia os seguintes materiais:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roman Fomichev. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dados privados limpos com seguran√ßa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enumera√ß√£o de fraqueza comum. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-14</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descri√ß√£o do diagn√≥stico </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V597</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em geral, tudo √© s√©rio. </font><font style="vertical-align: inherit;">Existem tais erros no Android?</font></font> Claro que existe.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geralmente s√£o muitos onde existem: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos voltar ao c√≥digo do Android e ver o in√≠cio e o fim da fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FwdLockGlue_InitializeRoundKeys</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pois o meio n√£o √© interessante para n√≥s.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FwdLockGlue_InitializeRoundKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> keyEncryptionKey[KEY_SIZE]; .... <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(keyEncryptionKey, <span class="hljs-number"><span class="hljs-number">0</span></span>, KEY_SIZE); <span class="hljs-comment"><span class="hljs-comment">// Zero out key data. }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: V597 CWE-14 O compilador pode excluir a chamada de fun√ß√£o 'memset', usada para liberar o buffer 'keyEncryptionKey'. A fun√ß√£o memset_s () deve ser usada para apagar os dados privados. FwdLockGlue.c 102 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A matriz </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyEncryptionKey</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© criada na pilha e armazena informa√ß√µes particulares. No final da fun√ß√£o, eles desejam preencher essa matriz com zeros para que n√£o chegue acidentalmente onde n√£o deveria. Como as informa√ß√µes podem chegar onde n√£o deveriam, o artigo " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Substituir mem√≥ria - por qu√™?</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Dir√°</font></a><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para preencher uma matriz com informa√ß√µes privadas com zeros, a fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© usada </font><font style="vertical-align: inherit;">. O coment√°rio "Zerar dados importantes" confirma que entendemos tudo corretamente.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O problema √© que, com uma probabilidade muito alta, o compilador excluir√° a chamada de fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao criar a vers√£o de lan√ßamento </font><font style="vertical-align: inherit;">. Como o buffer ap√≥s a chamada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o </font><font style="vertical-align: inherit;">√© </font><font style="vertical-align: inherit;">usado, a chamada da fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do ponto de vista do compilador √© sup√©rflua. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avisos eu escrevi um arquivo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android_V597.txt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Houve outro erro em que a mem√≥ria n√£o foi substitu√≠da, embora neste caso a fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o </font><font style="vertical-align: inherit;">tenha </font><font style="vertical-align: inherit;">nada a ver com isso.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SHA1Transform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">], </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> buffer[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">64</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> a, b, c, d, e; .... <span class="hljs-comment"><span class="hljs-comment">/* Wipe variables */</span></span> a = b = c = d = e = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: V1001 CWE-563 A vari√°vel 'a' √© atribu√≠da, mas n√£o √© usada at√© o final da fun√ß√£o. </font><font style="vertical-align: inherit;">sha1.c 213 O </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio detectou uma anomalia relacionada ao fato de que, ap√≥s atribuir valores √†s vari√°veis, elas n√£o s√£o mais usadas. </font><font style="vertical-align: inherit;">O analisador classificou esse defeito como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-563</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Atribui√ß√£o a vari√°vel sem uso. </font><font style="vertical-align: inherit;">E, formalmente, ele est√° certo, embora, de fato, aqui estamos novamente lidando com o CWE-14. </font><font style="vertical-align: inherit;">O compilador descartar√° essas atribui√ß√µes, pois, do ponto de vista de C e C ++, elas s√£o sup√©rfluas. </font><font style="vertical-align: inherit;">Como resultado, a pilha ir√° permanecer os mesmos valores das vari√°veis de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o armazenamento de dados particular.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comportamento n√£o especificado / definido pela implementa√ß√£o </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enquanto voc√™ n√£o estiver cansado, vejamos um caso complexo que exigir√° uma descri√ß√£o completa da minha parte. </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> GGLfixed; <span class="hljs-function"><span class="hljs-function">GGLfixed </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gglFastDivx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GGLfixed n, GGLfixed d)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((d&gt;&gt;<span class="hljs-number"><span class="hljs-number">24</span></span>) &amp;&amp; ((d&gt;&gt;<span class="hljs-number"><span class="hljs-number">24</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>)) { n &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; d &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gglMulx(n, gglRecip(d)); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V793 √â estranho que o resultado da instru√ß√£o '(d &gt;&gt; 24) + 1' fa√ßa parte da condi√ß√£o. </font><font style="vertical-align: inherit;">Talvez essa afirma√ß√£o deva ter sido comparada com outra coisa. </font><font style="vertical-align: inherit;">fixed.cpp 75 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programador queria verificar que os 8 bits superiores da vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cont√©m a unidade, mas n√£o todos os bits de uma vez. </font><font style="vertical-align: inherit;">Em outras palavras, o programador queria verificar se qualquer valor diferente de 0x00 e 0xFF est√° no byte alto.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele abordou a solu√ß√£o desse problema desnecessariamente de forma criativa. Para come√ßar, ele verificou que os bits mais significativos s√£o diferentes de zero escrevendo uma express√£o (d &gt;&gt; 24). Existem reivindica√ß√µes para essa express√£o, mas √© mais interessante analisar o lado direito da express√£o: ((d &gt;&gt; 24) +1). O programador muda os oito bits altos para o byte baixo. Ao mesmo tempo, calcula que o bit de sinal mais significativo √© duplicado em todos os outros bits.</font></font> I.e.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se a vari√°vel d for 0b11111111'00000000'00000000'00000000, depois do turno obteremos o valor 0b11111111'11111111'11111111'11111111. Adicionando 1 ao valor 0xFFFFFFFF do tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o programador planeja obter 0. Ou seja: -1 + 1 = 0. Assim, usando a express√£o ((d &gt;&gt; 24) +1), ele verifica se nem todos os oito bits altos s√£o iguais a 1. Entendo que isso √© bastante dif√≠cil, portanto, n√£o se apresse e tente descobrir como e o que funciona :). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora vamos ver o que h√° de errado com este c√≥digo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao mudar, o bit de sinal mais significativo n√£o √© necessariamente "manchado". Aqui est√° o que o padr√£o diz sobre isso: ‚ÄúO valor de E1 &gt;&gt; E2 √© E1 com posi√ß√µes de bits E2 deslocadas √† direita. Se E1 tiver um tipo n√£o assinado ou E1 tiver um tipo assinado e um valor n√£o negativo, o valor do resultado ser√° parte integrante do quociente E1 / 2 ^ E2. Se E1 tiver um tipo assinado e um valor negativo, o valor resultante ser√° definido pela implementa√ß√£o. " </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A √∫ltima oferta √© importante para n√≥s. Ent√£o, conhecemos o comportamento definido pela implementa√ß√£o. O funcionamento desse c√≥digo depende da arquitetura do microprocessador e da implementa√ß√£o do compilador. Ap√≥s a mudan√ßa, os zeros podem aparecer nos bits mais significativos e, em seguida, a express√£o ((d &gt;&gt; 24) +1) ser√° sempre diferente de 0, ou seja, sempre ser√° um valor verdadeiro.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da√≠ a conclus√£o: n√£o √© preciso ser s√°bio. </font><font style="vertical-align: inherit;">O c√≥digo se tornar√° mais confi√°vel e compreens√≠vel se voc√™ escrever, por exemplo, assim:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">GGLfixed </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gglFastDivx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GGLfixed n, GGLfixed d)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> hibits = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>&gt;(d) &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hibits != <span class="hljs-number"><span class="hljs-number">0x00</span></span> &amp;&amp; hibits != <span class="hljs-number"><span class="hljs-number">0xFF</span></span>) { n &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; d &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gglMulx(n, gglRecip(d)); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Provavelmente, sugeri n√£o a op√ß√£o ideal, mas neste c√≥digo n√£o h√° comportamento definido pela implementa√ß√£o, e ser√° mais f√°cil para o leitor entender o que est√° sendo verificado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ merece uma x√≠cara de caf√© ou ch√°. </font><font style="vertical-align: inherit;">Distraia e continue: estamos aguardando um caso interessante de comportamento n√£o especificado.</font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f53/1a9/86b/f531a986b1bca57105eddf63d12bd50b.png" alt="aten√ß√£o"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na entrevista, como uma das primeiras perguntas ao solicitante, pergunto o seguinte: "O que a fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imprimir√° </font><font style="vertical-align: inherit;">e por qu√™?"</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d,%d"</span></span>, i++, i++)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A resposta correta: esse √© um comportamento n√£o especificado. </font><font style="vertical-align: inherit;">O procedimento para calcular os argumentos reais ao chamar a fun√ß√£o n√£o est√° definido. </font><font style="vertical-align: inherit;">Ocasionalmente, at√© demonstro que esse c√≥digo, compilado com a ajuda do Visual C ++, exibe "6,5" na tela, o que confunde os rec√©m-chegados que s√£o fracos em conhecimento e esp√≠rito a uma paralisa√ß√£o total :) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso pode parecer um problema absurdo. </font><font style="vertical-align: inherit;">Mas n√£o, esse c√≥digo pode ser encontrado em aplicativos s√©rios, por exemplo, no c√≥digo do Android.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ComposerClient::CommandReader::parseSetLayerCursorPosition( <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> length) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length != CommandWriterBase::kSetLayerCursorPositionLength) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> err = mHal.setLayerCursorPosition(mDisplay, mLayer, readSigned(), readSigned()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err != Error::NONE) { mWriter.setError(getCommandLoc(), err); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: V681 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-758</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O padr√£o da linguagem n√£o define uma ordem na qual as fun√ß√µes 'readSigned' ser√£o chamadas durante a avalia√ß√£o dos argumentos. </font><font style="vertical-align: inherit;">ComposerClient.cpp 836 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estamos interessados ‚Äã‚Äãnesta linha de c√≥digo:</font></font><br><br><pre> <code class="cpp hljs">mHal.setLayerCursorPosition(...., readSigned(), readSigned());</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chamando a fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readSigned</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">dois valores s√£o lidos. </font><font style="vertical-align: inherit;">Mas √© imposs√≠vel prever em que ordem os valores ser√£o lidos. </font><font style="vertical-align: inherit;">Este √© um caso cl√°ssico de comportamento n√£o especificado.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Benef√≠cios do uso de um analisador de c√≥digo est√°tico </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este artigo inteiro populariza a an√°lise de c√≥digo est√°tico em geral e nossa ferramenta PVS-Studio em particular. </font><font style="vertical-align: inherit;">No entanto, alguns erros s√£o perfeitos para demonstrar as possibilidades de an√°lise est√°tica. </font><font style="vertical-align: inherit;">Eles s√£o dif√≠ceis de identificar por revis√µes de c√≥digo e apenas um programa n√£o cansado os nota facilmente. </font><font style="vertical-align: inherit;">Considere alguns desses casos.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span>&gt; kBootReasonMap = { .... {<span class="hljs-string"><span class="hljs-string">"watchdog_sdi_apps_reset"</span></span>, <span class="hljs-number"><span class="hljs-number">106</span></span>}, {<span class="hljs-string"><span class="hljs-string">"smpl"</span></span>, <span class="hljs-number"><span class="hljs-number">107</span></span>}, {<span class="hljs-string"><span class="hljs-string">"oem_modem_failed_to_powerup"</span></span>, <span class="hljs-number"><span class="hljs-number">108</span></span>}, {<span class="hljs-string"><span class="hljs-string">"reboot_normal"</span></span>, <span class="hljs-number"><span class="hljs-number">109</span></span>}, {<span class="hljs-string"><span class="hljs-string">"oem_lpass_cfg"</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>}, <span class="hljs-comment"><span class="hljs-comment">// &lt;= {"oem_xpu_ns_error", 111}, // &lt;= {"power_key_press", 112}, {"hardware_reset", 113}, {"reboot_by_powerkey", 114}, {"reboot_verity", 115}, {"oem_rpm_undef_error", 116}, {"oem_crash_on_the_lk", 117}, {"oem_rpm_reset", 118}, {"oem_lpass_cfg", 119}, // &lt;= {"oem_xpu_ns_error", 120}, // &lt;= {"factory_cable", 121}, {"oem_ar6320_failed_to_powerup", 122}, {"watchdog_rpm_bite", 123}, {"power_on_cable", 124}, {"reboot_unknown", 125}, .... };</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Avisos do PVS-Studio: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V766 CWE-462 Um item com a mesma chave '"oem_lpass_cfg"' j√° foi adicionado. </font><font style="vertical-align: inherit;">bootstat.cpp 264</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V766 CWE-462 Um item com a mesma chave '"oem_xpu_ns_error"' j√° foi adicionado. </font><font style="vertical-align: inherit;">bootstat.cpp 265</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valores diferentes com as mesmas chaves s√£o inseridos no </font><font style="vertical-align: inherit;">cont√™iner associativo classificado ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">std :: map</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Em termos de enumera√ß√£o de fraqueza comum, esta √© a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-462</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : chave duplicada na lista associativa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O texto do programa √© reduzido e os erros s√£o marcados com coment√°rios; portanto, o erro parece √≥bvio, mas quando voc√™ l√™ esse c√≥digo apenas com os olhos, √© muito dif√≠cil encontrar esses erros. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Considere outro trecho de c√≥digo que √© muito dif√≠cil de ler, pois √© do mesmo tipo e desinteressante.</font></font><br><br><pre> <code class="cpp hljs">MtpResponseCode MyMtpDatabase::getDevicePropertyValue(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_INT8: packet.putInt8(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_UINT8: packet.putUInt8(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_INT16: packet.putInt16(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_UINT16: packet.putUInt16(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_INT32: packet.putInt32(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_UINT32: packet.putUInt32(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_INT64: packet.putInt64(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_UINT64: packet.putUInt64(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_INT128: packet.putInt128(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_UINT128: packet.putInt128(longValue); <span class="hljs-comment"><span class="hljs-comment">// &lt;= break; .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V525 </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-682</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O c√≥digo cont√©m a cole√ß√£o de blocos semelhantes. </font><font style="vertical-align: inherit;">Verifique os itens 'putInt8', 'putUInt8', 'putInt16', 'putUInt16', 'putInt32', 'putUInt32', 'putInt64', 'putUInt64', 'putInt128', 'putInt128' nas linhas 620, 623, 626, 629 , 632, 635, 638, 641, 644, 647. android_mtp_MtpDatabase.cpp 620 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MTP_TYPE_UINT128</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> teve que ser causada por fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">putUInt128</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , n√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">putInt128</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E o √∫ltimo desta se√ß√£o √© um √≥timo exemplo de Copy-Paste malsucedido.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btif_rc_upstreams_evt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AVRC_PDU_REQUEST_CONTINUATION_RSP: { BTIF_TRACE_EVENT( <span class="hljs-string"><span class="hljs-string">"%s() REQUEST CONTINUATION: target_pdu: 0x%02d"</span></span>, __func__, pavrc_cmd-&gt;continu.target_pdu); tAVRC_RESPONSE avrc_rsp; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_dev-&gt;rc_connected == TRUE) { <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;(avrc_rsp.continu), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tAVRC_NEXT_RSP)); avrc_rsp.continu.opcode = opcode_from_pdu(AVRC_PDU_REQUEST_CONTINUATION_RSP); avrc_rsp.continu.pdu = AVRC_PDU_REQUEST_CONTINUATION_RSP; avrc_rsp.continu.status = AVRC_STS_NO_ERROR; avrc_rsp.continu.target_pdu = pavrc_cmd-&gt;continu.target_pdu; send_metamsg_rsp(p_dev, <span class="hljs-number"><span class="hljs-number">-1</span></span>, label, ctype, &amp;avrc_rsp); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AVRC_PDU_ABORT_CONTINUATION_RSP: { BTIF_TRACE_EVENT( <span class="hljs-string"><span class="hljs-string">"%s() ABORT CONTINUATION: target_pdu: 0x%02d"</span></span>, __func__, pavrc_cmd-&gt;<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.target_pdu); tAVRC_RESPONSE avrc_rsp; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_dev-&gt;rc_connected == TRUE) { <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;(avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tAVRC_NEXT_RSP)); avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.opcode = opcode_from_pdu(AVRC_PDU_ABORT_CONTINUATION_RSP); avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.pdu = AVRC_PDU_ABORT_CONTINUATION_RSP; avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.status = AVRC_STS_NO_ERROR; avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.target_pdu = pavrc_cmd-&gt;continu.target_pdu; send_metamsg_rsp(p_dev, <span class="hljs-number"><span class="hljs-number">-1</span></span>, label, ctype, &amp;avrc_rsp); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Antes de ler o aviso do analisador e mais texto, sugiro procurar o erro. </font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83b/679/4ad/83b6794adb823b1fa52e18c91eff1ed2.png" alt="Distraindo imagem, Java"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para que voc√™ n√£o leia a resposta acidentalmente imediatamente, aqui est√° uma foto para voc√™ desviar a aten√ß√£o. </font><font style="vertical-align: inherit;">Se voc√™ est√° interessado no significado de um ovo com a inscri√ß√£o Java, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui est√°</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> voc√™ </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espero que voc√™ tenha gostado da busca por erros de digita√ß√£o. </font><font style="vertical-align: inherit;">Agora √© a hora de avisar o analisador: V778 CWE-682 Dois fragmentos de c√≥digo semelhantes foram encontrados. </font><font style="vertical-align: inherit;">Talvez seja um erro de digita√ß√£o e a vari√°vel 'abort' deva ser usada em vez de 'continu'. </font><font style="vertical-align: inherit;">btif_rc.cc 1554 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aparentemente, o c√≥digo foi escrito usando o m√©todo Copy-Paste, e uma pessoa, como sempre, n√£o p√¥de estar atenta no processo de edi√ß√£o do fragmento de c√≥digo copiado. </font><font style="vertical-align: inherit;">Como resultado, no final, ele n√£o substituiu " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " por " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">abort</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ".</font></font><br><br>  I.e.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no segundo bloco deve ser escrito: </font></font><br><br><pre> <code class="cpp hljs">avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.target_pdu = pavrc_cmd-&gt;<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.target_pdu;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa situa√ß√£o se enquadra completamente na defini√ß√£o de " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">efeito de √∫ltima linha</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ", pois um erro na substitui√ß√£o de nomes foi cometido no final.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Facepalm </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um bug muito engra√ßado est√° relacionado √† convers√£o entre os formatos de dados little-endian e big-endian (consulte </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ordem dos bytes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> uint32_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bswap32</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (((pData &amp; <span class="hljs-number"><span class="hljs-number">0xFF000000</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>) | ((pData &amp; <span class="hljs-number"><span class="hljs-number">0x00FF0000</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) | ((pData &amp; <span class="hljs-number"><span class="hljs-number">0x0000FF00</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) | ((pData &amp; <span class="hljs-number"><span class="hljs-number">0x000000FF</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ELFAttribute::merge(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> subsection_length = *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>*&gt;(subsection_data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (llvm::sys::IsLittleEndianHost != m_Config.targets().isLittleEndian()) bswap32(subsection_length); .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V530 CWE-252 O valor de retorno da fun√ß√£o 'bswap32' deve ser utilizado. </font><font style="vertical-align: inherit;">ELFAttribute.cpp 84 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h√°</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reclama√ß√µes </font><i><font style="vertical-align: inherit;">sobre a</font></i><font style="vertical-align: inherit;"> fun√ß√£o </font><i><font style="vertical-align: inherit;">bswap32</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mas √© usado incorretamente:</font></font><br><br><pre> <code class="cpp hljs">bswap32(subsection_length);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O autor sugeriu que a vari√°vel √© passada para a fun√ß√£o por refer√™ncia e √© alterada l√°. </font><font style="vertical-align: inherit;">No entanto, voc√™ deve usar o valor retornado pela fun√ß√£o. </font><font style="vertical-align: inherit;">Como resultado, nenhuma convers√£o de dados ocorre. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O analisador identificou esse erro como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-252</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Valor de retorno n√£o verificado. </font><font style="vertical-align: inherit;">Mas, de fato, √© mais apropriado chamar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-198</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Uso de pedidos de bytes incorretos aqui. </font><font style="vertical-align: inherit;">Infelizmente, o analisador n√£o consegue entender qual √© o erro do ponto de vista de alto n√≠vel. </font><font style="vertical-align: inherit;">No entanto, isso n√£o o impede de identificar esse defeito grave no c√≥digo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo correto √©:</font></font><br><br><pre> <code class="cpp hljs">subsection_length = bswap32(subsection_length);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Existem mais tr√™s lugares no c√≥digo do Android com o mesmo erro: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V530 CWE-252 O valor de retorno da fun√ß√£o 'bswap32' deve ser utilizado. </font><font style="vertical-align: inherit;">ELFAttribute.cpp 218</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V530 CWE-252 O valor de retorno da fun√ß√£o 'bswap32' deve ser utilizado. </font><font style="vertical-align: inherit;">ELFAttribute.cpp 346</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V530 CWE-252 O valor de retorno da fun√ß√£o 'bswap32' deve ser utilizado. </font><font style="vertical-align: inherit;">ELFAttribute.cpp 352</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para evitar esses erros, √© recomend√°vel usar o atributo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[[nodiscard]]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Este atributo √© usado para indicar que o valor de retorno de uma fun√ß√£o deve ser usado quando invocado. </font><font style="vertical-align: inherit;">Portanto, se voc√™ escrever assim:</font></font><br><br><pre> <code class="cpp hljs">[[nodiscard]] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> uint32_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bswap32</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData)</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o erro seria detectado mesmo na fase de compila√ß√£o do arquivo. </font><font style="vertical-align: inherit;">Voc√™ pode aprender mais sobre alguns novos atributos √∫teis do artigo do meu colega " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++ 17</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ".</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C√≥digo inacess√≠vel </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na teoria da programa√ß√£o e do compilador, o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo inacess√≠vel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© a parte do c√≥digo do programa que n√£o pode ser executada sob nenhuma circunst√¢ncia, pois √© inacess√≠vel no gr√°fico de fluxo de controle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do ponto de vista da enumera√ß√£o Common Weakness, √© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-561</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Dead Code.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> sp&lt;IEffect&gt; createEffect(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pDesc == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> effect; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (status != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { *status = BAD_VALUE; } } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V779 CWE-561 C√≥digo inacess√≠vel detectado. </font><font style="vertical-align: inherit;">√â poss√≠vel que haja um erro. </font><font style="vertical-align: inherit;">IAudioFlinger.cpp 733 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">declara√ß√£o de retorno</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deve estar explicitamente localizada abaixo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outros erros deste tipo:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V779 CWE-561 C√≥digo inacess√≠vel detectado. </font><font style="vertical-align: inherit;">√â poss√≠vel que haja um erro. </font><font style="vertical-align: inherit;">bta_hf_client_main.cc 612</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V779 CWE-561 C√≥digo inacess√≠vel detectado. </font><font style="vertical-align: inherit;">√â poss√≠vel que haja um erro. </font><font style="vertical-align: inherit;">android_media_ImageReader.cpp 468</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V779 CWE-561 C√≥digo inacess√≠vel detectado. </font><font style="vertical-align: inherit;">√â poss√≠vel que haja um erro. </font><font style="vertical-align: inherit;">AMPEG4AudioAssembler.cpp 187</font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quebrar </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interrup√ß√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> esquecida </font><font style="vertical-align: inherit;">dentro do </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">switch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© um erro cl√°ssico dos programadores de C e C ++. </font><font style="vertical-align: inherit;">Para combat√™-lo, uma anota√ß√£o √∫til apareceu no C ++ 17 como </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[[avan√ßo]]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voc√™ pode ler </font><font style="vertical-align: inherit;">mais sobre esse erro e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[[avan√ßo]]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no meu artigo " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avan√ßo e avan√ßo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas enquanto o mundo est√° cheio de c√≥digos antigos em que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[[avan√ßo]]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o </font><i><font style="vertical-align: inherit;">√©</font></i><font style="vertical-align: inherit;"> usado, o PVS-Studio √© √∫til para voc√™. </font><font style="vertical-align: inherit;">Considere alguns erros encontrados no Android. </font><font style="vertical-align: inherit;">De acordo com a Common Weakness Enumeration, esses erros s√£o classificados como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-484</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Omitted Break Statement no Switch.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> A2dpCodecConfigLdac::setCodecConfig(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTAV_A2DP_CODEC_SAMPLE_RATE_192000: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sampleRate &amp; A2DP_LDAC_SAMPLING_FREQ_192000) { result_config_cie.sampleRate = A2DP_LDAC_SAMPLING_FREQ_192000; codec_capability_.sample_rate = codec_user_config_.sample_rate; codec_config_.sample_rate = codec_user_config_.sample_rate; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTAV_A2DP_CODEC_SAMPLE_RATE_16000: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTAV_A2DP_CODEC_SAMPLE_RATE_24000: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTAV_A2DP_CODEC_SAMPLE_RATE_NONE: codec_capability_.sample_rate = BTAV_A2DP_CODEC_SAMPLE_RATE_NONE; codec_config_.sample_rate = BTAV_A2DP_CODEC_SAMPLE_RATE_NONE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V796 CWE-484 √â poss√≠vel que a instru√ß√£o 'break' esteja ausente na instru√ß√£o switch. </font><font style="vertical-align: inherit;">a2dp_vendor_ldac.cc 912 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acho que o erro n√£o precisa de explica√ß√£o. </font><font style="vertical-align: inherit;">Observo apenas que muitas vezes uma anomalia no c√≥digo √© detectada em mais de uma maneira. </font><font style="vertical-align: inherit;">Por exemplo, esse erro tamb√©m √© detectado pelos avisos da V519:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519 CWE-563 A vari√°vel 'codec_capability_.sample_rate' recebe valores duas vezes sucessivos. </font><font style="vertical-align: inherit;">Talvez isso seja um erro. </font><font style="vertical-align: inherit;">Verifique as linhas: 910, 916. a2dp_vendor_ldac.cc 916</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V519 CWE-563 A vari√°vel 'codec_config_.sample_rate' recebe valores duas vezes sucessivamente. </font><font style="vertical-align: inherit;">Talvez isso seja um erro. </font><font style="vertical-align: inherit;">Verifique as linhas: 911, 917. a2dp_vendor_ldac.cc 917</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E mais alguns erros: </font></font><br><br><pre> <code class="cpp hljs">Return&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; EffectsFactory::getAllDescriptors(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (status) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> -ENOSYS: { <span class="hljs-comment"><span class="hljs-comment">// Effect list has changed. goto restart; } case -ENOENT: { // No more effects available. result.resize(i); } default: { result.resize(0); retval = Result::NOT_INITIALIZED; } } .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V796 CWE-484 √â poss√≠vel que a instru√ß√£o 'break' esteja ausente na instru√ß√£o switch. </font><font style="vertical-align: inherit;">EffectsFactory.cpp 118</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Reverb_getParameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> REVERB_PARAM_REFLECTIONS_LEVEL: *(<span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> *)pValue = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> REVERB_PARAM_REFLECTIONS_DELAY: *(<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *)pValue = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> REVERB_PARAM_REVERB_DELAY: *(<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *)pValue = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V796 CWE-484 √â poss√≠vel que a instru√ß√£o 'break' esteja ausente na instru√ß√£o switch. </font><font style="vertical-align: inherit;">EffectReverb.cpp 1847</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> SLresult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IAndroidConfiguration_GetConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (IObjectToObjectID((thiz)-&gt;mThis)) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SL_OBJECTID_AUDIORECORDER: result = android_audioRecorder_getConfig( (CAudioRecorder *) thiz-&gt;mThis, configKey, pValueSize, pConfigValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SL_OBJECTID_AUDIOPLAYER: result = android_audioPlayer_getConfig( (CAudioPlayer *) thiz-&gt;mThis, configKey, pValueSize, pConfigValue); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: result = SL_RESULT_FEATURE_UNSUPPORTED; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V796 CWE-484 √â poss√≠vel que a instru√ß√£o 'break' esteja ausente na instru√ß√£o switch. </font><font style="vertical-align: inherit;">IAndroidConfiguration.cpp 90</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gerenciamento de mem√≥ria incorreto </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui eu compilei erros relacionados ao gerenciamento incorreto de mem√≥ria. </font><font style="vertical-align: inherit;">Esses avisos, de acordo com a Enumera√ß√£o de Fraqueza Comum, s√£o classificados como:</font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-401</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Libera√ß√£o incorreta da mem√≥ria antes de remover a √∫ltima refer√™ncia ('Vazamento de mem√≥ria')</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-562</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Retorno do endere√ßo vari√°vel da pilha</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-762</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Rotinas de gerenciamento de mem√≥ria incompat√≠veis</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vamos come√ßar com fun√ß√µes que retornam uma refer√™ncia a uma vari√°vel j√° destru√≠da. </font></font><br><br><pre> <code class="cpp hljs">TransformIterator&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>++(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { <span class="hljs-function"><span class="hljs-function">TransformIterator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; ++*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; } TransformIterator&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>--(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { <span class="hljs-function"><span class="hljs-function">TransformIterator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; --*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Avisos do PVS-Studio: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V558 A fun√ß√£o CWE-562 retorna a refer√™ncia ao objeto local tempor√°rio: tmp. </font><font style="vertical-align: inherit;">transform_iterator.h 77</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V558 A fun√ß√£o CWE-562 retorna a refer√™ncia ao objeto local tempor√°rio: tmp. </font><font style="vertical-align: inherit;">transform_iterator.h 92</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando as fun√ß√µes terminam sua execu√ß√£o, a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tmp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><font style="vertical-align: inherit;">destru√≠da, pois foi criada na pilha. </font><font style="vertical-align: inherit;">Conseq√ºentemente, as fun√ß√µes retornam uma refer√™ncia a um objeto j√° destru√≠do (inexistente). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A solu√ß√£o correta seria retornar um valor de:</font></font><br><br><pre> <code class="cpp hljs">TransformIterator <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>++(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { <span class="hljs-function"><span class="hljs-function">TransformIterator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; ++*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; } TransformIterator <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>--(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { <span class="hljs-function"><span class="hljs-function">TransformIterator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; --*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Considere um c√≥digo ainda mais triste que merece muita aten√ß√£o. </font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/619/b25/299/619b2529917e9570454e60bf9c27c3f8.png" alt="C√≥digo perigoso"></div><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register_socket_transport</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* serial, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> local)</span></span></span><span class="hljs-function"> </span></span>{ atransport* t = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> atransport(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!serial) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">32</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">snprintf</span></span>(buf, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf), <span class="hljs-string"><span class="hljs-string">"T-%p"</span></span>, t); serial = buf; } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: V507 CWE-562 O ponteiro para a matriz local 'buf' √© armazenado fora do escopo desta matriz. Esse ponteiro se tornar√° inv√°lido. transport.cpp 1030 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© um c√≥digo perigoso. Se o valor real do argumento </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serial</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for NULL, um buffer tempor√°rio na pilha deve ser usado. Quando o corpo da </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instru√ß√£o if</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> termina, o array </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deixa de existir. O local em que o buffer foi criado pode ser usado para armazenar outras vari√°veis ‚Äã‚Äãcriadas na pilha. Uma bagun√ßa infernal come√ßar√° nos dados, e as consequ√™ncias de tal erro s√£o mal previstas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os seguintes erros est√£o relacionados a m√©todos incompat√≠veis para criar e destruir objetos.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SensorService::SensorEventConnection::reAllocateCacheLocked(....) { <span class="hljs-keyword"><span class="hljs-keyword">sensors_event_t</span></span> *eventCache_new; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> new_cache_size = computeMaxCacheSizeLocked(); eventCache_new = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sensors_event_t</span></span>[new_cache_size]; .... <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> mEventCache; mEventCache = eventCache_new; mCacheSize += count; mMaxCacheSize = new_cache_size; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V611 CWE-762 A mem√≥ria foi alocada usando o operador 'new T []', mas foi liberada usando o operador 'delete'. Considere inspecionar este c√≥digo. Provavelmente √© melhor usar 'delete [] mEventCache;'. Verifique as linhas: 391, 384. SensorEventConnection.cpp 391 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tudo √© simples aqui. O buffer apontado por um membro da classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mEventCache</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© alocado usando o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operador </font><i><font style="vertical-align: inherit;">[]</font></i><font style="vertical-align: inherit;"> . E libere essa mem√≥ria usando o operador de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exclus√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Isso est√° incorreto e leva ao comportamento indefinido do programa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erro semelhante:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">aaudio_result_t</span></span> AAudioServiceEndpointCapture::open(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> mDistributionBuffer; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> distributionBufferSizeBytes = getStreamInternal()-&gt;getFramesPerBurst() * getStreamInternal()-&gt;getBytesPerFrame(); mDistributionBuffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>[distributionBufferSizeBytes]; .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V611 CWE-762 A mem√≥ria foi alocada usando o operador 'new T []', mas foi liberada usando o operador 'delete'. </font><font style="vertical-align: inherit;">Considere inspecionar este c√≥digo. </font><font style="vertical-align: inherit;">Provavelmente √© melhor usar 'delete [] mDistributionBuffer;'. </font><font style="vertical-align: inherit;">AAudioServiceEndpointCapture.cpp 50 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acho que o erro n√£o requer explica√ß√µes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O caso a seguir √© um pouco mais interessante, mas a ess√™ncia do erro √© exatamente a mesma.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeifFrameInfo</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... mIccData.reset(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>[iccSize]); .... } .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt; mIccData; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V554 CWE-762 Uso incorreto de unique_ptr. </font></font> A mem√≥ria alocada com 'new []' ser√° limpa usando 'delete'.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HeifDecoderAPI.h 62 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por padr√£o, a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ponteiro inteligente </font><i><font style="vertical-align: inherit;">std :: unique_ptr</font></i><font style="vertical-align: inherit;"> chama o operador de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exclus√£o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para destruir um objeto </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">No entanto, na fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definida</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a </font><font style="vertical-align: inherit;">mem√≥ria √© alocada usando o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operador </font><i><font style="vertical-align: inherit;">[]</font></i><font style="vertical-align: inherit;"> .</font></font><br><br>  A op√ß√£o correta: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>[]&gt; mIccData;</code> </pre> <br>  Outros erros: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V554 CWE-762 Uso incorreto de unique_ptr. </font></font> A mem√≥ria alocada com 'new []' ser√° limpa usando 'delete'.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atrace.cpp 949 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V554 CWE-762 Uso incorreto de unique_ptr. </font></font> A mem√≥ria alocada com 'new []' ser√° limpa usando 'delete'.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atrace.cpp 950 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V554 CWE-762 Uso incorreto de unique_ptr. </font></font> A mem√≥ria alocada com 'new []' ser√° limpa usando 'delete'.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HeifDecoderImpl.cpp 102 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V554 CWE-762 Uso incorreto de unique_ptr. </font></font> A mem√≥ria alocada com 'new []' ser√° limpa usando 'delete'.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HeifDecoderImpl.cpp 166 </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V554 CWE-762 Uso incorreto de unique_ptr. </font></font> A mem√≥ria alocada com 'new []' ser√° limpa usando 'delete'.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ColorSpace.cpp 360 </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os erros de vazamento de mem√≥ria concluir√£o esta se√ß√£o. </font><font style="vertical-align: inherit;">Uma surpresa desagrad√°vel √© que houve mais de 20 desses erros.Parece que esses defeitos podem ser muito dolorosos, levando a uma diminui√ß√£o gradual da mem√≥ria livre durante a opera√ß√£o cont√≠nua prolongada do sistema operacional.</font></font><br><br><pre> <code class="cpp hljs">Asset* Asset::createFromUncompressedMap(FileMap* dataMap, AccessMode mode) { _FileAsset* pAsset; <span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> result; pAsset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> _FileAsset; result = pAsset-&gt;openChunk(dataMap); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != NO_ERROR) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; pAsset-&gt;mAccessMode = mode; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pAsset; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aviso do PVS-Studio: V773 CWE-401 A fun√ß√£o foi encerrada sem liberar o ponteiro 'pAsset'. </font></font> √â poss√≠vel um vazamento de mem√≥ria.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asset.cpp 296 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ n√£o pode abrir um peda√ßo era, ent√£o a fun√ß√£o de sa√≠das sem destruir o objeto, um ponteiro para a qual √© armazenada na vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Como resultado, ocorrer√° um vazamento de mem√≥ria. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outros erros s√£o semelhantes, portanto n√£o vejo raz√£o para consider√°-los no artigo. </font><font style="vertical-align: inherit;">Os </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interessados</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> podem ver outros avisos no arquivo: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Android_V773.txt</font></a><font style="vertical-align: inherit;"> .</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Indo para o exterior uma matriz </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° um grande n√∫mero de padr√µes incorretos que levam ao estouro da matriz. </font><font style="vertical-align: inherit;">No caso do Android, detectamos apenas um padr√£o de erro do seguinte tipo:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || i &gt; MAX) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; A[i] = x;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em C e C ++, as c√©lulas da matriz s√£o numeradas de 0, portanto, o √≠ndice m√°ximo de um elemento na matriz deve ser um menor que o tamanho da pr√≥pria matriz. </font><font style="vertical-align: inherit;">A verifica√ß√£o correta deve ser assim:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || i &gt;= MAX) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; A[i] = x;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O overflow de uma </font><font style="vertical-align: inherit;">matriz, de acordo com a Common Weakness Enumeration, √© classificado como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-119</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Restri√ß√£o impr√≥pria de opera√ß√µes dentro dos limites de um buffer de mem√≥ria. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veja como esses erros aparecem no c√≥digo do Android.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">btif_hf_cb_t</span></span> btif_hf_cb[BTA_AG_MAX_NUM_CLIENTS]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsSlcConnected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RawAddress* bd_addr)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!bd_addr) { LOG(WARNING) &lt;&lt; __func__ &lt;&lt; <span class="hljs-string"><span class="hljs-string">": bd_addr is null"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idx = btif_hf_idx_by_bdaddr(bd_addr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || idx &gt; BTA_AG_MAX_NUM_CLIENTS) { LOG(WARNING) &lt;&lt; __func__ &lt;&lt; <span class="hljs-string"><span class="hljs-string">": invalid index "</span></span> &lt;&lt; idx &lt;&lt; <span class="hljs-string"><span class="hljs-string">" for "</span></span> &lt;&lt; *bd_addr; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> btif_hf_cb[idx].state == BTHF_CONNECTION_STATE_SLC_CONNECTED; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: √â poss√≠vel satura√ß√£o da matriz V557 CWE-119. </font><font style="vertical-align: inherit;">O valor do √≠ndice 'idx' pode chegar a 6. btif_hf.cc 277 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Op√ß√£o de verifica√ß√£o correta:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || idx &gt;= BTA_AG_MAX_NUM_CLIENTS) {</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Exatamente os mesmos erros foram encontrados mais duas coisas: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â poss√≠vel satura√ß√£o da matriz V557 CWE-119. </font><font style="vertical-align: inherit;">O valor do √≠ndice 'idx' pode chegar a 6. btif_hf.cc 869</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â poss√≠vel satura√ß√£o da matriz V557 CWE-119. </font><font style="vertical-align: inherit;">O valor do √≠ndice 'index' pode chegar a 6. btif_rc.cc 374</font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ciclos interrompidos </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem muitas maneiras de escrever um ciclo com defeito. </font><font style="vertical-align: inherit;">No c√≥digo do Android, encontrei erros que, de acordo com a Enumera√ß√£o de fraqueza comum, podem ser classificados como:</font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-20</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Valida√ß√£o de entrada incorreta</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-670</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Implementa√ß√£o do fluxo de controle sempre incorreta</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-691</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Gerenciamento insuficiente de fluxo de controle</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-834</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Itera√ß√£o Excessiva</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ao mesmo tempo, √© claro, existem outras maneiras de "dar um tiro na pr√≥pria perna" ao escrever ciclos, mas desta vez eles n√£o me conheceram. </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **argv)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%s is already in *.base_fs format, just ..... "</span></span>, ....); rewind(blk_alloc_file); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((c = fgetc(blk_alloc_file)) != EOF) { fputc(c, base_fs_file); } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: O V739 CWE-20 EOF n√£o deve ser comparado com um valor do tipo 'char'. O '(c = fgetc (blk_alloc_file))' deve ser do tipo 'int'. blk_alloc_to_base_fs.c 61 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O analisador detectou que a constante </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EOF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© </font><font style="vertical-align: inherit;">comparada com uma vari√°vel do tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Vamos ver por que esse c√≥digo est√° incorreto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A fun√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fgetc</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retorna um valor </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , a saber: pode retornar um n√∫mero de 0 a 255 ou EOF (-1). O valor de leitura √© colocado em uma vari√°vel do tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por esse motivo, um caractere com o valor 0xFF (255) se transforma em -1 e √© interpretado exatamente da mesma maneira que o final de um arquivo (EOF).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Devido a esses erros, os usu√°rios que usam c√≥digos ASCII estendidos √†s vezes encontram uma situa√ß√£o em que um dos caracteres do alfabeto √© processado incorretamente pelos programas. Por exemplo, a √∫ltima letra do alfabeto russo na codifica√ß√£o Windows-1251 possui apenas o c√≥digo 0xFF e √© percebida por alguns programas como o final do arquivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumindo, podemos dizer que a condi√ß√£o para interromper o ciclo est√° gravada incorretamente. Para corrigir a situa√ß√£o, a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> deve ser do </font><font style="vertical-align: inherit;">tipo int. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continuamos e consideramos erros mais familiares ao usar a instru√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> AudioPolicyManager::registerPolicyMixes(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; mixes.size(); i++) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; mHwModules.size(); j++) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (strcmp(AUDIO_HARDWARE_MODULE_ID_REMOTE_SUBMIX, mHwModules[j]-&gt;mName) == 0 &amp;&amp; mHwModules[j]-&gt;mHandle != 0) { rSubmixModule = mHwModules[j]; break; } .... } .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V534 CWE-691 √â prov√°vel que uma vari√°vel incorreta esteja sendo comparada dentro do operador 'for'. Considere revisar 'i'. AudioPolicyManager.cpp 2489 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por causa de um erro de digita√ß√£o em um loop aninhado, a condi√ß√£o usa a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , embora voc√™ deva usar a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Como resultado, a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j √©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> incrementada incontrolavelmente, o que, com o tempo, levar√° a matriz </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mHwModules a ficar fora dos limites</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O que acontecer√° a seguir √© imposs√≠vel prever, pois haver√° um comportamento indefinido do programa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A prop√≥sito, esse fragmento com erro foi completamente copiado para outra fun√ß√£o. Portanto, o analisador encontrou exatamente o mesmo erro aqui: AudioPolicyManager.cpp 2586.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem mais tr√™s trechos de c√≥digo que s√£o muito suspeitos para mim. </font><font style="vertical-align: inherit;">No entanto, n√£o pretendo dizer que esse c√≥digo seja definitivamente errado, pois existe uma l√≥gica complexa. </font><font style="vertical-align: inherit;">De qualquer forma, devo prestar aten√ß√£o a este c√≥digo para que o autor o verifique. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O primeiro fragmento:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ce_t3t_handle_check_cmd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; p_cb-&gt;cur_cmd.num_blocks; i++) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; T3T_MSG_NDEF_ATTR_INFO_SIZE; i++) { checksum += p_temp[i]; } .... } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V535 CWE-691 A vari√°vel 'i' est√° sendo usada para esse loop e para o loop externo. </font><font style="vertical-align: inherit;">Verifique as linhas: 398, 452. ce_t3t.cc 452 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe que a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i √©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usada para os ciclos externo e interno. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais dois gatilhos do analisador semelhantes:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V535 CWE-691 A vari√°vel 'xx' est√° sendo usada para esse loop e para o loop externo. </font><font style="vertical-align: inherit;">Verifique as linhas: 801, 807. sdp_db.cc 807</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V535 CWE-691 A vari√°vel 'xx' est√° sendo usada para esse loop e para o loop externo. </font><font style="vertical-align: inherit;">Verifique as linhas: 424, 438. nfa_hci_act.cc 438</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ n√£o est√° cansado ainda? </font><font style="vertical-align: inherit;">Sugiro pausar e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">baixar o PVS-Studio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para tentar verificar seu projeto.</font></font><br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30b/8e3/d36/30b8e3d36a2b05111cee2b76d981d89f.png" alt="Experimente o PVS-Studio"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora vamos continuar. </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NFA_HCI_LAST_PROP_GATE 0xFF tNFA_HCI_DYN_GATE* nfa_hciu_alloc_gate(uint8_t gate_id, tNFA_HANDLE app_handle) { .... for (gate_id = NFA_HCI_FIRST_HOST_SPECIFIC_GENERIC_GATE; gate_id </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;= NFA_HCI_LAST_PROP_GATE; gate_id++) { if (gate_id == NFA_HCI_CONNECTIVITY_GATE) gate_id++; if (nfa_hciu_find_gate_by_gid(gate_id) == NULL) break; } if (gate_id &gt; NFA_HCI_LAST_PROP_GATE) { LOG(ERROR) &lt;&lt; StringPrintf( "nfa_hci_alloc_gate - no free Gate ID: %u " "App Handle: 0x%04x", gate_id, app_handle); return (NULL); } .... }</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V654 CWE-834 A condi√ß√£o 'gate_id &lt;= 0xFF' do loop √© sempre verdadeira. </font><font style="vertical-align: inherit;">nfa_hci_utils.cc 248 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe o seguinte:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A constante </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NFA_HCI_LAST_PROP_GATE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© igual a 0xFF.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma vari√°vel do tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uint8_t √©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usada como um </font><i><font style="vertical-align: inherit;">contador de loop</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Portanto, o intervalo de valores dessa vari√°vel √© [0..0xFF].</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acontece que a condi√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gate_id &lt;= NFA_HCI_LAST_PROP_GATE √©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sempre verdadeira e n√£o pode parar a execu√ß√£o do loop. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O analisador classificou esse erro como CWE-834, mas tamb√©m pode ser interpretado como CWE-571: Express√£o √© sempre verdadeira. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O pr√≥ximo erro no loop est√° relacionado ao comportamento indefinido.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> SimpleDecodingSource::doRead(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> retries = <span class="hljs-number"><span class="hljs-number">0</span></span>; ++retries; ) { .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V654 CWE-834 A condi√ß√£o '++ tentativas' do loop √© sempre verdadeira. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aparentemente, o programador queria que a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tentativas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recebesse </font><font style="vertical-align: inherit;">todos os valores poss√≠veis para a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e somente ent√£o o loop terminou. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O loop deve parar quando a express√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">++ tenta novamente</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0. E isso s√≥ √© poss√≠vel se a vari√°vel estourar. </font><font style="vertical-align: inherit;">Como a vari√°vel √© do tipo assinado, seu estouro leva a um comportamento indefinido. </font><font style="vertical-align: inherit;">Portanto, esse c√≥digo est√° incorreto e pode levar a consequ√™ncias imprevis√≠veis. </font><font style="vertical-align: inherit;">Por exemplo, o compilador tem o direito total de remover a verifica√ß√£o e deixar apenas instru√ß√µes para incrementar o contador.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E o √∫ltimo erro nesta se√ß√£o. </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> Check(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&amp; source) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pass = <span class="hljs-number"><span class="hljs-number">1</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(rc) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: SLOGI(<span class="hljs-string"><span class="hljs-string">"Filesystem check completed OK"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: SLOGE(<span class="hljs-string"><span class="hljs-string">"Filesystem check failed (not a FAT filesystem)"</span></span>); errno = ENODATA; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pass++ &lt;= <span class="hljs-number"><span class="hljs-number">3</span></span>) { SLOGW(<span class="hljs-string"><span class="hljs-string">"Filesystem modified - rechecking (pass %d)"</span></span>, pass); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } SLOGE("Failing check after too many rechecks"); errno = EIO; return -1; case 8: SLOGE("Filesystem check failed (no filesystem)"); errno = ENODATA; return -1; default: SLOGE("Filesystem check failed (unknown exit code %d)", rc); errno = EIO; return -1; } } while (0); // &lt;= return 0; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V696 CWE-670 O operador 'continue' encerrar√° o loop 'do {...} while (FALSE)' porque a condi√ß√£o √© sempre falsa. </font><font style="vertical-align: inherit;">Verifique as linhas: 105, 121. Vfat.cpp 105 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antes de n√≥s, existe um loop do formul√°rio:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; .... } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para executar itera√ß√µes repetidas, o programador usa a instru√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font> Isto est√° errado.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A instru√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">continue</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o retoma o loop imediatamente, mas prossegue para verificar a condi√ß√£o. </font><font style="vertical-align: inherit;">Como a condi√ß√£o √© sempre falsa, em qualquer caso, o ciclo ser√° executado apenas uma vez. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para corrigir o erro, o c√≥digo pode ser reescrito, por exemplo, assim:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;;) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reatribui√ß√£o Vari√°vel </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erro</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muito </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">comum</font></a><font style="vertical-align: inherit;"> √© reescrever uma vari√°vel antes que o valor anterior fosse usado. </font><font style="vertical-align: inherit;">Na maioria das vezes, esses erros ocorrem devido a um erro de digita√ß√£o ou copiar e colar malsucedido. </font><font style="vertical-align: inherit;">De acordo com a Enumera√ß√£o de fraqueza comum, esses erros s√£o classificados como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-563</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Atribui√ß√£o a vari√°vel sem uso. </font><font style="vertical-align: inherit;">N√£o sem esses erros no Android.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> XMLNode::flatten_node(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;namespaceExt, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(namespaceExt)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mNamespacePrefix.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { namespaceExt.prefix.index = htodl(strings.offsetForString(mNamespacePrefix)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { namespaceExt.prefix.index = htodl((<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>)<span class="hljs-number"><span class="hljs-number">-1</span></span>); } namespaceExt.prefix.index = htodl(strings.offsetForString(mNamespacePrefix)); namespaceExt.uri.index = htodl(strings.offsetForString(mNamespaceUri)); .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: V519 CWE-563 A vari√°vel 'namespaceExt.prefix.index' recebe valores duas vezes sucessivos. </font><font style="vertical-align: inherit;">Talvez isso seja um erro. </font><font style="vertical-align: inherit;">Verifique as linhas: 1535, 1539. XMLNode.cpp 1539 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para destacar a ess√™ncia do erro, escreverei um pseudoc√≥digo:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) X = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> X = <span class="hljs-number"><span class="hljs-number">2</span></span>; X = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Independentemente da condi√ß√£o, </font><font style="vertical-align: inherit;">sempre ser√° atribu√≠do um valor </font><font style="vertical-align: inherit;">√† vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (no c√≥digo atual √© </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">namespaceExt.prefix.index</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> AudioFlinger::RecordThread::threadLoop() { .... <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> framesToRead = mBufferSize / mFrameSize; framesToRead = min(mRsmpInFramesOA - rear, mRsmpInFramesP2 / <span class="hljs-number"><span class="hljs-number">2</span></span>); .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: V519 CWE-563 A vari√°vel 'framesToRead' recebe valores duas vezes sucessivos. </font><font style="vertical-align: inherit;">Talvez isso seja um erro. </font><font style="vertical-align: inherit;">Verifique as linhas: 6341, 6342. Threads.cpp 6342 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o est√° claro por que foi necess√°rio inicializar a vari√°vel ao declarar, se outro valor √© imediatamente gravado nela. </font><font style="vertical-align: inherit;">Algo est√° errado aqui.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SchedulingLatencyVisitorARM::VisitArrayGet(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index-&gt;IsConstant()) { last_visited_latency_ = kArmMemoryLoadLatency; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (has_intermediate_address) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { last_visited_internal_latency_ += kArmIntegerOpLatency; } last_visited_internal_latency_ = kArmMemoryLoadLatency; } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V519 CWE-563 A vari√°vel 'last_visited_internal_latency_' recebe valores duas vezes sucessivos. </font><font style="vertical-align: inherit;">Talvez isso seja um erro. </font><font style="vertical-align: inherit;">Verifique as linhas: 680, 682. scheduler_arm.cc 682 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo muito estranho e sem sentido. </font><font style="vertical-align: inherit;">Atrevo-me a sugerir que deveria ter sido escrito:</font></font><br><br><pre> <code class="cpp hljs">last_visited_internal_latency_ += kArmMemoryLoadLatency;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E o √∫ltimo erro, demonstrando como o analisador encontra incansavelmente erros com maior probabilidade de serem ignorados, mesmo com uma revis√£o cuidadosa do c√≥digo. </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">multiprecision_fast_mod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* c, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> U; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> V; .... c[<span class="hljs-number"><span class="hljs-number">0</span></span>] += U; V = c[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt; U; c[<span class="hljs-number"><span class="hljs-number">1</span></span>] += V; V = c[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt; V; c[<span class="hljs-number"><span class="hljs-number">2</span></span>] += V; <span class="hljs-comment"><span class="hljs-comment">// V = c[2] &lt; V; // &lt;= c[2] += U; // V = c[2] &lt; U; // &lt;= c[3] += V; V = c[3] &lt; V; c[4] += V; V = c[4] &lt; V; c[5] += V; V = c[5] &lt; V; .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso PVS-Studio: V519 CWE-563 A vari√°vel 'V' recebe valores duas vezes sucessivamente. </font><font style="vertical-align: inherit;">Talvez isso seja um erro. </font><font style="vertical-align: inherit;">Verifique as linhas: 307, 309. p_256_multprecision.cc 309 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo √© t√£o "arranca os olhos" que eu n√£o quero entender. </font><font style="vertical-align: inherit;">Isso √© claramente vis√≠vel: h√° um erro de digita√ß√£o no c√≥digo, que destaquei com coment√°rios.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Outros bugs </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existem erros dispersos para os quais n√£o faz sentido criar cap√≠tulos separados. </font><font style="vertical-align: inherit;">No entanto, eles s√£o t√£o interessantes e trai√ßoeiros quanto os considerados anteriormente. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opera√ß√µes Priorit√°rias</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TagMonitor::parseTagsToMonitor(String8 tagNames) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::lock_guard&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::mutex&gt; lock(mMonitorMutex); <span class="hljs-comment"><span class="hljs-comment">// Expand shorthands if (ssize_t idx = tagNames.find("3a") != -1) { ssize_t end = tagNames.find(",", idx); char* start = tagNames.lockBuffer(tagNames.size()); start[idx] = '\0'; .... } .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V593 CWE-783 Considere revisar a express√£o do tipo 'A = B! = C'. A express√£o √© calculada da seguinte forma: 'A = (B! = C)'. TagMonitor.cpp 50 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enumera√ß√£o de fraqueza comum: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-783</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Erro de l√≥gica de preced√™ncia do operador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O programador concebeu o seguinte. A subcadeia ‚Äú3a‚Äù √© pesquisada e a </font><font style="vertical-align: inherit;">posi√ß√£o dessa subcadeia √© gravada na </font><font style="vertical-align: inherit;">vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se a substring for encontrada (idx! = -1), o c√≥digo come√ßar√° a ser executado, que usa o valor da vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infelizmente, o programador est√° confuso sobre as prioridades das opera√ß√µes. De fato, a verifica√ß√£o funciona assim:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> idx = (tagNames.find(<span class="hljs-string"><span class="hljs-string">"3a"</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span>))</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro, ele verifica se h√° uma subcadeia "3a" na string e o resultado false / true √© colocado na vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Como resultado, a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tem o valor 0 ou 1. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a condi√ß√£o for verdadeira (a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© 1), a l√≥gica que usa a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">idx</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> come√ßa a ser executada </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Uma vari√°vel sempre igual a 1 levar√° ao comportamento incorreto do programa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode corrigir o erro se fizer a inicializa√ß√£o da vari√°vel a partir da condi√ß√£o:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> idx = tagNames.find(<span class="hljs-string"><span class="hljs-string">"3a"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx != <span class="hljs-number"><span class="hljs-number">-1</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A nova vers√£o do C ++ 17 tamb√©m permite que voc√™ escreva: </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> idx = tagNames.find(<span class="hljs-string"><span class="hljs-string">"3a"</span></span>); idx != <span class="hljs-number"><span class="hljs-number">-1</span></span>)</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Construtor inv√°lido</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HearingDevice</span></span></span><span class="hljs-class"> {</span></span> .... HearingDevice() { HearingDevice(RawAddress::kEmpty, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } .... };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V603 CWE-665 O objeto foi criado, mas n√£o est√° sendo usado. Se voc√™ deseja chamar o construtor, 'this-&gt; HearingDevice :: HearingDevice (....)' deve ser usado. listening_aid.cc 176 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enumera√ß√£o de fraqueza comum: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-665</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : inicializa√ß√£o incorreta. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os programadores geralmente se enganam ao tentar chamar explicitamente um construtor para inicializar um objeto. Existem dois construtores na classe. Para reduzir o tamanho do c√≥digo fonte, o programador decidiu chamar um construtor de outro. Mas esse c√≥digo n√£o faz nada do que o desenvolvedor espera. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O seguinte acontece. Um novo objeto sem nome do tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HearingDevice √© criado</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e destru√≠do. Como resultado, os campos da classe permanecem n√£o inicializados.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para corrigir o erro, voc√™ pode usar o construtor de delega√ß√£o (esse recurso apareceu no C ++ 11). </font><font style="vertical-align: inherit;">O c√≥digo correto √©:</font></font><br><br><pre> <code class="cpp hljs">HearingDevice() : HearingDevice(RawAddress::kEmpty, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { }</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A fun√ß√£o n√£o retorna valor</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NET_RecvFrom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> len, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flags, struct sockaddr *from, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *fromlen)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">socklen_t</span></span> socklen = *fromlen; BLOCKING_IO_RETURN_INT( s, recvfrom(s, buf, len, flags, from, &amp;socklen) ); *fromlen = socklen; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: V591 CWE-393 A fun√ß√£o n√£o nula deve retornar um valor. </font><font style="vertical-align: inherit;">linux_close.cpp 139 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enumera√ß√£o de fraqueza comum: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-393</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Retorno do c√≥digo de status incorreto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A fun√ß√£o retornar√° um valor aleat√≥rio. </font><font style="vertical-align: inherit;">Outro erro: V591 CWE-393 A fun√ß√£o n√£o nula deve retornar um valor. </font><font style="vertical-align: inherit;">linux_close.cpp 158 C√°lculo </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incorreto do tamanho da estrutura</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MtpFfsHandle::handleControlRequest(....) { .... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mtp_device_status</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">st</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">reinterpret_cast</span></span></span><span class="hljs-class">&lt;struct mtp_device_status*&gt;(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">buf</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">());</span></span> st-&gt;wLength = htole16(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(st)); .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: V568 √â estranho que o operador 'sizeof ()' avalie o tamanho de um ponteiro para uma classe, mas n√£o o tamanho do objeto de classe 'st'. </font><font style="vertical-align: inherit;">MtpFfsHandle.cpp 251 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estou certo de que na vari√°vel membro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wLength</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> queria colocar o tamanho da estrutura, n√£o o tamanho do ponteiro. </font><font style="vertical-align: inherit;">Ent√£o o c√≥digo correto deve ser assim:</font></font><br><br><pre> <code class="cpp hljs">st-&gt;wLength = htole16(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(*st));</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Respostas semelhantes do analisador: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V568 √â estranho que o operador 'sizeof ()' avalie o tamanho de um ponteiro para uma classe, mas n√£o o tamanho do objeto de classe 'cacheinfo'. </font><font style="vertical-align: inherit;">NetlinkEvent.cpp 220</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V568 √â estranho que o operador 'sizeof ()' avalie o tamanho de um ponteiro para uma classe, mas n√£o o tamanho do objeto de classe 'page-&gt; next'. </font><font style="vertical-align: inherit;">linker_block_allocator.cpp 146</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V568 √â estranho que o argumento do operador sizeof () seja a express√£o '&amp; session_id'. </font><font style="vertical-align: inherit;">reference-ril.c 1775</font></font></li></ul><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opera√ß√µes de bits sem sentido</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EGL_CONTEXT_OPENGL_DEBUG_BIT_KHR 0x00000001 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EGL_CONTEXT_OPENGL_FORWARD_COMPATIBLE_BIT_KHR 0x00000002 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EGL_CONTEXT_OPENGL_ROBUST_ACCESS_BIT_KHR 0x00000004 EGLContext eglCreateContext(....) { .... case EGL_CONTEXT_FLAGS_KHR: </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> ((attrib_val | EGL_CONTEXT_OPENGL_DEBUG_BIT_KHR) || (attrib_val | EGL_CONTEXT_OPENGL_FORWARD_C....) || (attrib_val | EGL_CONTEXT_OPENGL_ROBUST_ACCESS_BIT_KHR)) { context_flags = attrib_val; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { RETURN_ERROR(EGL_NO_CONTEXT,EGL_BAD_ATTRIBUTE); } .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V617 CWE-480 Considere inspecionar a condi√ß√£o. </font><font style="vertical-align: inherit;">O argumento '0x00000001' do '|' </font><font style="vertical-align: inherit;">opera√ß√£o bit a bit cont√©m um valor diferente de zero. </font><font style="vertical-align: inherit;">egl.cpp 1329 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enumera√ß√£o de fraqueza comum: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-480</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Uso de operador incorreto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma express√£o do formul√°rio (A | 1) || </font><font style="vertical-align: inherit;">(A | 2) || </font><font style="vertical-align: inherit;">(A | 4) n√£o faz sentido, pois o resultado sempre ser√° verdadeiro. </font><font style="vertical-align: inherit;">De fato, voc√™ precisa usar o operador </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e o c√≥digo faz sentido:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((attrib_val &amp; EGL_CONTEXT_OPENGL_DEBUG_BIT_KHR) || (attrib_val &amp; EGL_CONTEXT_OPENGL_FORWARD_COMPATIBLE_BIT_KHR) || (attrib_val &amp; EGL_CONTEXT_OPENGL_ROBUST_ACCESS_BIT_KHR))</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erro semelhante: V617 CWE-480 Considere inspecionar a condi√ß√£o. O argumento '0x00000001' do '|' opera√ß√£o bit a bit cont√©m um valor diferente de zero. egl.cpp 1338 Mudan√ßa </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">incorreta de bits</font></font></b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AddressType&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegsInfo</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> saved_reg_map = <span class="hljs-number"><span class="hljs-number">0</span></span>; AddressType saved_regs[<span class="hljs-number"><span class="hljs-number">64</span></span>]; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> AddressType* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reg)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reg &gt; <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(saved_regs) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(AddressType)) { <span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>(); } saved_reg_map |= <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; reg; saved_regs[reg] = (*regs)[reg]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;(*regs)[reg]; } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V629 CWE-190 Considere inspecionar a express√£o '1 &lt;&lt; reg'. </font><font style="vertical-align: inherit;">Mudan√ßa de bit do valor de 32 bits com uma expans√£o subsequente para o tipo de 64 bits. </font><font style="vertical-align: inherit;">RegsInfo.h 47 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enumera√ß√£o de fraqueza comum: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-190</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Estouro de n√∫mero inteiro ou envolvente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com um deslocamento de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 &lt;&lt; reg, o</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> valor da vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reg</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fica no intervalo [0..63]. </font><font style="vertical-align: inherit;">A express√£o serve para obter diferentes graus de dois, come√ßando com 2 ^ 0 e terminando com 2 ^ 63. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo n√£o funciona. </font><font style="vertical-align: inherit;">O fato √© que o literal num√©rico 1 tem um tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 32 bits </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Portanto, n√£o funcionar√° para obter um valor maior que 1 ^ 31. </font><font style="vertical-align: inherit;">Uma mudan√ßa para um valor maior leva ao estouro da vari√°vel e ao surgimento de comportamento indefinido.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O c√≥digo correto √©: </font></font><br><br><pre> <code class="cpp hljs">saved_reg_map |= <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">1</span></span>) &lt;&lt; reg;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou: </font></font><br><br><pre> <code class="cpp hljs">saved_reg_map |= <span class="hljs-number"><span class="hljs-number">1U</span></span>LL &lt;&lt; reg;</code> </pre> <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As strings s√£o copiadas para elas mesmas.</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> PCLmGenerator::writeJobTicket() { <span class="hljs-comment"><span class="hljs-comment">// Write JobTicket char inputBin[256]; char outputBin[256]; if (!m_pPCLmSSettings) { return; } getInputBinString(m_pPCLmSSettings-&gt;userInputBin, &amp;inputBin[0]); getOutputBin(m_pPCLmSSettings-&gt;userOutputBin, &amp;outputBin[0]); strcpy(inputBin, inputBin); strcpy(outputBin, outputBin); .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Avisos do PVS-Studio: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V549 CWE-688 O primeiro argumento da fun√ß√£o 'strcpy' √© igual ao segundo argumento. </font><font style="vertical-align: inherit;">genPCLm.cpp 1181</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V549 CWE-688 O primeiro argumento da fun√ß√£o 'strcpy' √© igual ao segundo argumento. </font><font style="vertical-align: inherit;">genPCLm.cpp 1182</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De acordo com a classifica√ß√£o da Enumera√ß√£o de fraqueza comum: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-688</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Chamada de fun√ß√£o com vari√°vel incorreta ou refer√™ncia como argumento. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por algum motivo, as strings s√£o copiadas para elas mesmas. </font><font style="vertical-align: inherit;">Provavelmente, existem alguns erros de digita√ß√£o aqui. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando uma vari√°vel n√£o inicializada</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mca_set_cfg_by_tbl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ tMCA_DCB* p_dcb; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tL2CAP_FCR_OPTS* p_opt; tMCA_FCS_OPT fcs = MCA_FCS_NONE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_tbl-&gt;tcid == MCA_CTRL_TCID) { p_opt = &amp;mca_l2c_fcr_opts_def; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { p_dcb = mca_dcb_by_hdl(p_tbl-&gt;cb_idx); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_dcb) { p_opt = &amp;p_dcb-&gt;p_chnl_cfg-&gt;fcr_opt; fcs = p_dcb-&gt;p_chnl_cfg-&gt;fcs; } } <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(p_cfg, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tL2CAP_CFG_INFO)); p_cfg-&gt;mtu_present = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; p_cfg-&gt;mtu = p_tbl-&gt;my_mtu; p_cfg-&gt;fcr_present = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(&amp;p_cfg-&gt;fcr, p_opt, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tL2CAP_FCR_OPTS)); <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V614 CWE-824 Ponteiro potencialmente n√£o inicializado 'p_opt' usado. Considere verificar o segundo argumento real da fun√ß√£o 'memcpy'. mca_main.cc 252 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De acordo com a classifica√ß√£o do Weakness Enumeration do comum: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o CWE-824</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Acesso de ponteiro n√£o inicializado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p_tbl-&gt; tcid! = MCA_CTRL_TCID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p_dcb == nullptr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o ponteiro </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p_opt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permanecer√° n√£o inicializado. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uso mais estranho de vari√°vel n√£o inicializada</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">timespec</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__time_t</span></span> tv_sec; <span class="hljs-comment"><span class="hljs-comment">/* Seconds. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tv_nsec; <span class="hljs-comment"><span class="hljs-comment">/* Nanoseconds. */</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> timespec </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NsToTimespec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ns)</span></span></span><span class="hljs-function"> </span></span>{ timespec t; <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> remainder; t.tv_sec = ns / kNanosPerSecond; remainder = ns % kNanosPerSecond; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (remainder &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { t.tv_nsec--; remainder += kNanosPerSecond; } t.tv_nsec = remainder; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aviso do PVS-Studio: V614 CWE-457 Vari√°vel n√£o inicializada 't.tv_nsec' usada. </font><font style="vertical-align: inherit;">clock_ns.h 55 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enumera√ß√£o de fraqueza comum: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-457</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Uso de vari√°vel n√£o inicializada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No momento de decrementar a vari√°vel </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.tv_nsec,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ela n√£o √© inicializada. </font><font style="vertical-align: inherit;">A vari√°vel √© inicializada posteriormente: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.tv_nsec = restante;</font></font></i>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algo aqui est√° claramente confuso. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Super express√£o</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bta_dm_co_ble_io_req</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... *p_auth_req = bte_appl_cfg.ble_auth_req | (bte_appl_cfg.ble_auth_req &amp; <span class="hljs-number"><span class="hljs-number">0x04</span></span>) | ((*p_auth_req) &amp; <span class="hljs-number"><span class="hljs-number">0x04</span></span>); .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: V578 Detectada uma opera√ß√£o bit a bit. </font><font style="vertical-align: inherit;">Considere verificar isso. </font><font style="vertical-align: inherit;">bta_dm_co.cc 259 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta express√£o √© redundante. </font><font style="vertical-align: inherit;">Se voc√™ remover a subexpress√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bte_appl_cfg.ble_auth_req &amp; 0x04)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o resultado da express√£o n√£o ser√° alterado. </font><font style="vertical-align: inherit;">Talvez haja algum erro de digita√ß√£o aqui. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lidar com vazamento</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> RSReflectionCpp::genEncodedBitCode() { FILE *pfin = fopen(mBitCodeFilePath.c_str(), <span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pfin == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stderr</span></span>, <span class="hljs-string"><span class="hljs-string">"Error: could not read file %s\n"</span></span>, mBitCodeFilePath.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> read_length; mOut.indent() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"static const unsigned char __txt[] ="</span></span>; mOut.startBlock(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((read_length = fread(buf, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf), pfin)) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { mOut.indent(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; read_length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf2[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">snprintf</span></span>(buf2, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf2), <span class="hljs-string"><span class="hljs-string">"0x%02x,"</span></span>, buf[i]); mOut &lt;&lt; buf2; } mOut &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } mOut.endBlock(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); mOut &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aviso do PVS-Studio: V773 CWE-401 A fun√ß√£o foi encerrada sem liberar o identificador 'pfin'. </font></font> Um vazamento de recurso √© poss√≠vel.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">slang_rs_reflection_cpp.cpp 448 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O analisador classificou esse erro de acordo com a Enumera√ß√£o de fraqueza comum como: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-401</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : libera√ß√£o inadequada de mem√≥ria antes de remover a √∫ltima refer√™ncia ('vazamento de mem√≥ria'). </font><font style="vertical-align: inherit;">No entanto, seria mais correto aqui emitir o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWE-775</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : vers√£o ausente do descritor ou identificador de arquivo ap√≥s a vida √∫til efetiva. </font><font style="vertical-align: inherit;">Instruirei meus colegas a corrigir esse defeito no PVS-Studio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">identificador pfin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o </font><i><font style="vertical-align: inherit;">√©</font></i><font style="vertical-align: inherit;"> liberado </font><i><font style="vertical-align: inherit;">em</font></i><font style="vertical-align: inherit;"> nenhum lugar. </font><font style="vertical-align: inherit;">Esqueci de chamar a fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fclose</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no final </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Um erro desagrad√°vel que pode esgotar rapidamente todo o suprimento de descritores dispon√≠veis, ap√≥s o qual ser√° imposs√≠vel abrir novos arquivos.</font></font><br><br><h2>  Conclus√£o </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ pode ver, mesmo em um projeto t√£o conhecido e testado como o Android, o analisador PVS-Studio encontra facilmente muitos erros e poss√≠veis vulnerabilidades. </font><font style="vertical-align: inherit;">Para resumir quais fraquezas (poss√≠veis vulnerabilidades) foram encontradas:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-14: Remo√ß√£o de c√≥digo pelo compilador para limpar buffers </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-20: Valida√ß√£o de entrada incorreta </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-119: Restri√ß√£o impr√≥pria de opera√ß√µes dentro dos limites de um buffer de mem√≥ria </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-190: Estouro de n√∫mero inteiro ou envolvente </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-198: Uso de pedidos de bytes incorretos </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-393: Retorno do c√≥digo de status incorreto </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-401: Libera√ß√£o incorreta da mem√≥ria antes de remover a √∫ltima refer√™ncia ('Vazamento de mem√≥ria') </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-457: Uso de Vari√°vel N√£o Inicializada </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-462: Chave duplicada na lista associativa </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-480: Uso do operador incorreto </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-484: Declara√ß√£o de quebra omitida no comutador </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-561: C√≥digo Morto </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CWE-562: Retorno do endere√ßo vari√°vel da pilha </font></font></li><li> CWE-563: Assignment to Variable without Use </li><li> CWE-570: Expression is Always False </li><li> CWE-571: Expression is Always True </li><li> CWE-476: NULL Pointer Dereference </li><li> CWE-628: Function Call with Incorrectly Specified Arguments </li><li> CWE-665: Improper Initialization </li><li> CWE-670: Always-Incorrect Control Flow Implementation </li><li> CWE-682: Incorrect Calculation </li><li> CWE-688: Function Call With Incorrect Variable or Reference as Argument </li><li> CWE-690: Unchecked Return Value to NULL Pointer Dereference </li><li> CWE-691: Insufficient Control Flow Management </li><li> CWE-758: Reliance on Undefined, Unspecified, or Implementation-Defined Behavior </li><li> CWE-762: Mismatched Memory Management Routines </li><li> CWE-775: Missing Release of File Descriptor or Handle after Effective Lifetime </li><li> CWE-783: Operator Precedence Logic Error </li><li> CWE-824: Access of Uninitialized Pointer </li><li> CWE-834: Excessive Iteration </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No total, descrevi 490 poss√≠veis vulnerabilidades no artigo. </font><font style="vertical-align: inherit;">De fato, o analisador √© capaz de identificar mais deles, mas, como escrevi anteriormente, n√£o encontrei for√ßas para estudar o relat√≥rio com mais cuidado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tamanho da base de c√≥digo testada √© de cerca de 2.168.000 linhas de c√≥digo em C e C ++. </font><font style="vertical-align: inherit;">Destes, 14,4% s√£o coment√°rios. </font><font style="vertical-align: inherit;">No total, temos cerca de 1.855.000 linhas de c√≥digo limpo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, temos 490 CWEs para 1.855.000 linhas de c√≥digo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acontece que o analisador PVS-Studio √© capaz de detectar mais de uma fraqueza (vulnerabilidade potencial) para cada 4000 linhas de c√≥digo em um projeto Android. </font><font style="vertical-align: inherit;">Bom resultado para um analisador de c√≥digo, estou feliz.</font></font><br><br>  Obrigado pela aten√ß√£o!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Desejo a todos um c√≥digo sem c√≥digo e proponho o seguinte: </font></font><br><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fa√ßa o download do</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PVS-Studio e verifique o rascunho de trabalho.</font></font></li><li>  :      : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">     </a> . </li><li> ,        : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">twitter</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RSS</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vk.com</a> . </li></ol><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  Se voc√™ deseja compartilhar este artigo com um p√∫blico que fala ingl√™s, use o link para a tradu√ß√£o: Andrey Karpov. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">We Checked the Android Source Codes by PVS-Studio or Nothing is Perfect</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418891/">https://habr.com/ru/post/pt418891/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418879/index.html">M√©todo de teste de trocas e carteiras criptogr√°ficas</a></li>
<li><a href="../pt418883/index.html">GitLab no NAS</a></li>
<li><a href="../pt418885/index.html">Crispr pode acelerar processos naturais e mudar a forma como os alimentos s√£o cultivados</a></li>
<li><a href="../pt418887/index.html">Qu√£o r√°pido o universo est√° se expandindo?</a></li>
<li><a href="../pt418889/index.html">Guia de Teste de Aplica√ß√£o Manual: Benef√≠cios, Etapas e Metodologias</a></li>
<li><a href="../pt418895/index.html">Aprenda Intelig√™ncia Artificial para jogar um jogo</a></li>
<li><a href="../pt418897/index.html">CRDT: tipos de dados replicados sem conflitos</a></li>
<li><a href="../pt418899/index.html">Primeiras impress√µes e a√ß√µes ap√≥s a atualiza√ß√£o do MySQL da vers√£o 5.7 para 8.0.11</a></li>
<li><a href="../pt418901/index.html">Os russos conquistaram a maioria das medalhas de ouro na Olimp√≠ada Europeia de Ci√™ncia da Computa√ß√£o eJOI 2018</a></li>
<li><a href="../pt418903/index.html">Cientistas: n√£o h√° CO‚ÇÇ suficiente em Marte para aquecer a atmosfera. Explos√£o de p√≥lo n√£o vai ajudar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>