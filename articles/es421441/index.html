<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïï üçâ üëÇüèæ Embox comienza a escalar el monte Elbrus ü§õüèº üë©‚ÄçüöÄ üî±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Los que siguen nuestro proyecto pueden haber notado que una carpeta e2k ha aparecido en el directorio de arquitecturas, que contiene soporte para proc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Embox comienza a escalar el monte Elbrus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/421441/"><img src="https://habrastorage.org/webt/ic/4z/5o/ic4z5olelesc04boln85goculk4.png" align="right" width="320">  Los que siguen nuestro proyecto pueden haber notado que una carpeta e2k ha aparecido en el directorio de arquitecturas, que contiene soporte para procesadores dom√©sticos con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">arquitectura Elbrus</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Una serie de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culos</a> sobre portar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Embox</a> a plataformas dom√©sticas no estar√≠a completa sin una historia sobre esta arquitectura. <br><br>  Har√© un par de comentarios sobre el contenido del art√≠culo.  En primer lugar, el proceso de dominar esta arquitectura por nosotros est√° en la etapa inicial, logramos lanzar Embox en esta plataforma, pero a√∫n no hemos implementado muchas de las partes necesarias, que se discutir√°n en futuras publicaciones.  En segundo lugar, esta arquitectura es compleja y <br>  Una descripci√≥n detallada requiere mucho m√°s texto del que permite el formato <br>  un articulo  Por lo tanto, sugerimos tomar este art√≠culo como introducci√≥n, <br>  que contiene un m√≠nimo de informaci√≥n t√©cnica sobre la arquitectura en s√≠. <br><br>  Empecemos <br><a name="habracut"></a><br><h3>  Objeto de investigaci√≥n: dise√±o del sistema integrado en Elbrus </h3><br>  Dado que estamos involucrados en Embox (y si alguien no lo sabe, se centra en los sistemas integrados), nos interes√≥ principalmente la opci√≥n de posicionar el MTsST en s√≠, incluso para los sistemas integrados.  En cuanto al MCST, descubrimos que la compa√±√≠a est√° interesada en usar sus procesadores para sistemas integrados.  Una de las √∫ltimas soluciones para este segmento es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la placa E4C-COM</a> .  En el proceso de comunicaci√≥n con el MCST, qued√≥ claro que para portar y dominar la arquitectura, puede usar cualquiera de las m√°quinas disponibles, y nos dieron una computadora llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Temperamento</a> para uso temporal.  En general, un monocubo no es exactamente lo que estamos acostumbrados en los sistemas integrados.  Por lo general, los sistemas integrados utilizan computadoras de una sola placa, un chip, un sistema en un chip o incluso un microcontrolador, pero el monocubo es una computadora completa, pero dado que ha sido probado en "clima y mec√°nica", todav√≠a puede considerarse un sistema integrado. <br><br><h3>  Compilador, compilar, llenar imagen </h3><br>  Despu√©s de recibir la unidad del sistema, naturalmente surgi√≥ la pregunta: c√≥mo completar la imagen.  El MCST utiliza su propio BIOS (cargador de arranque del sistema de primer nivel).  Por defecto, el sistema operativo Elbrus est√° instalado (es decir, Debian con modificaciones).  Estamos interesados ‚Äã‚Äãen lanzar nuestra propia imagen.  Afortunadamente, el cargador MTST puede ejecutar im√°genes a trav√©s de la red.  Para hacer esto, use el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">protocolo ATA sobre Ethernet</a> . <br><br>  Despu√©s de que nos ayudaron a configurar un stand y lanzar una imagen externa a trav√©s de la red, comenzamos a desarrollar nuestra propia imagen.  Para hacer esto, necesit√°bamos un compilador.  No encontramos el compilador en el dominio p√∫blico, pero desde que firmamos el NDA, nos dieron binarios para Linux.  El compilador result√≥ ser bastante compatible con gcc, y no tuvimos que cambiar nada, por supuesto, con la excepci√≥n de los indicadores de compilaci√≥n, que pusimos en un archivo de configuraci√≥n separado.  Lo cual es muy predecible, porque Linux, aunque con modificaciones, es ensamblado por este compilador. <br><br><h3>  Un par de preguntas t√©cnicas. </h3><br>  Aquellos que se dedican a actividades tan espec√≠ficas como portar el sistema operativo a una plataforma saben que lo primero que debe hacer es colocar correctamente el c√≥digo del programa en la memoria.  Es decir, escriba un script vinculador (lds) e implemente el c√≥digo de inicio.  R√°pidamente descubrimos el script del enlazador, pero al implementar el c√≥digo de inicio, nos encontramos con la primera magia, que no entendimos completamente.  El hecho es que Elbrus tiene un modo de compatibilidad x86 y en 0x00FF0000 hay un c√≥digo al que simplemente le dar√© un <a href="">enlace</a> , ya que lo tomamos prestado del ejemplo MCST.  El script de enlazador contiene <br><br><pre><code class="hljs pgsql">.bootinfo : { _bootinfo_start = .; <span class="hljs-comment"><span class="hljs-comment">/* . = 0x1000000 - 0x10000; */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* 0x00FF0000 */</span></span> *(.x86_boot) . = _bootinfo_start + <span class="hljs-number"><span class="hljs-number">0x10000</span></span>; _bootinfo_end = .; } SECTION_REGION(bootinfo) .text : { _start = .; <span class="hljs-comment"><span class="hljs-comment">/* 0x01000000 */</span></span> *(.e2k_entry);</code> </pre> <br>  El c√≥digo de inicio en s√≠ mismo ni siquiera est√° escrito en ensamblador, sino simplemente en <a href="">C.</a>  Se coloca en la secci√≥n ubicada en 0x01000000, que, por cierto, corresponde a la direcci√≥n de inicio de las m√°quinas x86 normales: all√≠ el encabezado de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">arranque m√∫ltiple</a> u otro encabezado se encuentra en esa direcci√≥n. <br><br>  Para asegurarse de que el c√≥digo de inicio y las direcciones sean correctos, necesita obtener alg√∫n resultado.  Si puede imprimir cualquier car√°cter, lo m√°s probable es que no haya problemas con la salida de las cadenas.  Usando esta salida, ya ser√° posible usar printf () para la depuraci√≥n.  Adem√°s, la mayor√≠a de las plataformas proporcionan la capacidad de generar caracteres al hacer una entrada simple en un registro espec√≠fico (ya que el gestor de arranque probablemente ha configurado UART seg√∫n sea necesario). <br><br>  Nuestra computadora usa el controlador de puerto serie am85c30 (tambi√©n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conocido</a> como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">z85c30</a> , lo suficientemente r√°pido como encontramos la impresi√≥n de un car√°cter, y esto es suficiente para que nuestro printf funcione. Inmediatamente enfrentamos un problema extra√±o: algunos de los caracteres impresos por printf parec√≠an duplicados, pero a veces confundido. Por ejemplo, cuando trat√© de generar Hello, world! Result√≥ algo as√≠ como Hhelellloo ,, woworrlldd. Ahora parece obvio que el asunto es multin√∫cleo, pero al principio hurgamos en el controlador. En nuestro monocub hay un Elbrus-2C de doble n√∫cleo. + (1891VM7YA) (  cuatro n√∫cleos DSP no cuentan) y el gestor de arranque activa todos los n√∫cleos del procesador. Como resultado, para no meterse con multin√∫cleo (SMP), todos los n√∫cleos, excepto el primero, se env√≠an a un bucle infinito. Para hacer esto, introdujimos una variable para el n√∫mero de procesador y la incrementamos usando la suma at√≥mica Zero core contin√∫a funcionando, mientras que otros n√∫cleos se repiten. <br><br><pre> <code class="hljs cpp"> cpuid = __e2k_atomic32_add(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;last_cpuid); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cpuid &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* XXX currently we support only single core */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/* copy of trap table */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)<span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;_t_entry, <span class="hljs-number"><span class="hljs-number">0x1800</span></span>); kernel_start();</code> </pre> <br>  La llamada kernel_start () ya es una transferencia de control a nuestro c√≥digo. <br>  Tambi√©n tomamos prestada una suma at√≥mica, para nosotros parece m√°gica.  Pero, como sabes, funciona, ¬°no lo toques! <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> WMB_AFTER_ATOMIC </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">".word 0x00008001\n"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">".word 0x30000084\n"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __e2k_atomic32_add(__val, __addr) \ ({ \ int __rval; \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n1:"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tldw,0 %[addr], %[rval], mas=0x7"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tadds %[rval], %[val], %[rval]"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\t{"</span></span></span><span class="hljs-meta">\ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tstw,2 %[addr], %[rval], mas=0x2"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tibranch 1b ? %%MLOCK"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\t}"</span></span></span><span class="hljs-meta"> \ WMB_AFTER_ATOMIC \ : [rval] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"=&amp;r"</span></span></span><span class="hljs-meta"> (__rval), [addr] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"+m"</span></span></span><span class="hljs-meta"> (*(__addr)) \ : [val] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ir"</span></span></span><span class="hljs-meta"> (__val) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"memory"</span></span></span><span class="hljs-meta">); \ __rval; \ })</span></span></code> </pre> <br>  Otra magia que tuve que pedir prestado es un c√≥digo, que se requiere para todos los n√∫cleos.  A saber <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e2k_wait_all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ _Pragma (<span class="hljs-string"><span class="hljs-string">"no_asm_inline"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">asm</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">volatile</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"wait \ttrap = %0, ma_c = %1, fl_c = %2, ld_c = %3, "</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"st_c = %4, all_e = %5, all_c = %6"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> : : </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">) : </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"memory"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; }</code> </pre> <br>  Como resultado, despu√©s de escribir el c√≥digo de inicio, no solo mostramos los mensajes usando printk, sino que tambi√©n comenzamos a cargar m√≥dulos, lo que generalmente no es muy trivial para compiladores no bastante est√°ndar.  As√≠ que una vez m√°s noto que esta vez la compatibilidad con gcc fue muy satisfactoria. <br><br>  El siguiente paso generalmente es iniciar el controlador de interrupci√≥n y el temporizador, pero pensando que tendremos que implementar no solo soporte para estos dispositivos, sino tambi√©n el c√≥digo arquitect√≥nico para los manejadores de interrupciones, decidimos que podemos comenzar desde la periferia.  El monocub tiene un bus PCIe, para los programadores parece un PCI normal.  Est√°bamos principalmente interesados ‚Äã‚Äãen dos dispositivos: un controlador de pantalla y un controlador de red. <br><br>  El monocubo utiliza un controlador gr√°fico de la serie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sm750</a> .  Este es un controlador de gr√°ficos para aplicaciones integradas, tiene soporte integrado para gr√°ficos 2D.  El chip se suelda directamente a la placa base, seg√∫n tengo entendido.  Las fuentes para el controlador para Linux se pueden encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  Despu√©s de encontrar el controlador, parec√≠a que nuestros problemas hab√≠an terminado, solo quedaba implementar el controlador para PCI.  m√°s precisamente, operaciones de lectura / escritura del espacio de configuraci√≥n PCI para conocer los par√°metros.  La implementaci√≥n de estas funciones tuvo que ser prestada nuevamente.  Como resultado, la lectura de registros se redujo a macros como <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Do load with specified MAS */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _E2K_READ_MAS(addr, mas, type, size_letter, chan_letter) \ ({ \ register type res; \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ld"</span></span></span><span class="hljs-meta"> #size_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">","</span></span></span><span class="hljs-meta"> #chan_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" \t0x0, [%1] %2, %0"</span></span></span><span class="hljs-meta"> \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"=r"</span></span></span><span class="hljs-meta"> (res) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((__e2k_ptr_t) (addr)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i"</span></span></span><span class="hljs-meta"> (mas)); \ res; \ }) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _E2K_WRITE_MAS(addr, val, mas, type, size_letter, chan_letter) \ ({ \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"st"</span></span></span><span class="hljs-meta"> #size_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">","</span></span></span><span class="hljs-meta"> #chan_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" \t0x0, [%0] %2, %1"</span></span></span><span class="hljs-meta"> \ : \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((__e2k_ptr_t) (addr)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((type) (val)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i"</span></span></span><span class="hljs-meta"> (mas) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"memory"</span></span></span><span class="hljs-meta">); \ })</span></span></code> </pre><br>  Hay cierta comprensi√≥n de lo que est√° sucediendo.  Elbrus tiene varios espacios de direcciones alternativos, como, por ejemplo, en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">arquitectura SPARC</a> .  La identificaci√≥n se realiza utilizando el identificador de espacio de direcciones.  Es decir, el mismo comando ld llega a diferentes direcciones internas, tambi√©n genera operaciones de lectura de diferentes longitudes (8, 16, 32, 64 bits).  Si en SPARC este es un comando lda / sta separado, entonces en Elbrus debido a los par√°metros, este es el comando ld.  Las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ventanas de registro se</a> tomaron prestadas de la arquitectura SPARC.  Pospondr√© una historia m√°s detallada para art√≠culos posteriores. <br><br>  Como resultado, todo result√≥ con PCI.  Pudimos obtener todos los datos necesarios, transferimos el controlador de gr√°ficos a nosotros mismos, pero luego nos encontramos con el siguiente problema.  Para dibujar una imagen en la memoria de video, ten√≠a que escribir dos veces.  Todo apuntaba al cach√©.  Para resolver este problema, fue necesario lidiar con MMU, y esto, como dicen, no se puede resolver con el condachka, ya que, en principio, hay muchos otros problemas que encontramos y que encontraremos m√°s de una vez durante el desarrollo de esta arquitectura. <br><br>  Hemos progresado en otras direcciones: interrupciones y llamadas al sistema, pero tambi√©n hablaremos de esto en los pr√≥ximos art√≠culos de esta subserie.  Al final de este art√≠culo, simplemente llevar√© la salida a la consola (a trav√©s del puerto serie). <br><img src="https://habrastorage.org/webt/uc/un/u2/ucunu20_gi-newvjygt_hfiygpe.png"><br><br><h3>  Conclusiones </h3><br>  Como dije en la introducci√≥n, quiero centrarme principalmente no en detalles t√©cnicos, sino en sentimientos generales.  Entonces, los sentimientos son contradictorios, aunque ciertamente m√°s positivos.  Por un lado, el procesador existe y es muy interesante en t√©rminos de caracter√≠sticas arquitect√≥nicas.  Basado en este procesador, se producen sistemas inform√°ticos, hay un software de bastante alta calidad.  Como dije, no hubo quejas sobre el compilador (hasta cierto punto, que describir√© un poco m√°s adelante), hay un Linux completo (SO "Elbrus").  Personalmente, vi c√≥mo en el propio ICST, el desarrollador cre√≥ directamente en el escritorio con la arquitectura Elbrus. <br><br>  Pero, por otro lado, no entiendo por qu√© con tanta persistencia est√°n tratando de hacer un reemplazo banal de Intel x86 de este procesador.  De hecho, en ninguna parte del mundo usan procesadores basados ‚Äã‚Äãen la arquitectura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VLIW</a> como computadoras personales universales.  VLIW, debido a sus caracter√≠sticas arquitect√≥nicas, es una "trituradora de n√∫meros" genial, hacen DSP en ella, hicieron servidores de itanium, hicieron tarjetas gr√°ficas.  No, con una excavadora, por supuesto, puedes cavar un hoyo para plantar un √°rbol, pero vale la pena. <br><br>  El principal problema que impide el desarrollo de la arquitectura, en mi opini√≥n, es la naturaleza cerrada de todo el ecosistema.  S√≠, para obtener una descripci√≥n del sistema de comando, solo necesita firmar el NDA, pero esto no es suficiente.  La arquitectura es desconocida y muy compleja.  S√≠, siempre pens√© que alg√∫n software b√°sico deber√≠a desarrollarse directamente del fabricante del procesador, bien, o en estrecha colaboraci√≥n con √©l.  De acuerdo con este principio, una PC en Elbrus tiene un paquete de software con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el sistema operativo Elbrus</a> .  Pero a√∫n as√≠ es demasiado ingenuo creer que una compa√±√≠a, incluso una grande, puede proporcionar soporte de calidad a todos los componentes: un procesador, un compilador, herramientas de desarrollo y depuraci√≥n, software del sistema (varios SO), software de aplicaci√≥n, ...  incluso Intel no puede hacer eso.  El mundo lleva mucho tiempo avanzando hacia la llamada colaboraci√≥n o desarrollo conjunto. <br><br>  D√©jame darte un ejemplo de un problema de compilaci√≥n con el que nos topamos.  El controlador del puerto serie en alg√∫n momento dej√≥ de mostrar caracteres y, a primera vista, nada ha cambiado.  Result√≥ que eliminamos la funci√≥n de depuraci√≥n no utilizada, que insertamos para comprender a trav√©s del desensamblador c√≥mo pasar argumentos a la funci√≥n en ensamblador.  Es decir, si la funci√≥n est√° presente, todo est√° bien, si no, entonces la salida desaparece.  Al principio, pecaron por la alineaci√≥n, pero result√≥ que la funci√≥n se puede transferir al final de C-Schnick, por lo que todos los personajes del controlador estaban en los mismos lugares que antes, pero el problema se reprodujo.  Si bien este problema no se ha resuelto, continuamos investigando para mostrar a los desarrolladores del compilador del MCST o para entender d√≥nde cometimos un error. <br><br>  El problema anterior, en mi opini√≥n, podr√≠a haberse evitado si hubiera m√°s usuarios de terceros.  Como m√≠nimo, el problema habr√≠a salido a la luz antes, o uno podr√≠a googlear lo que hicimos mal. <br><br>  El ICST tambi√©n es consciente del problema del cierre, ya que el proceso de descubrir cosas no clasificadas ha comenzado.  Por ejemplo, vi a Alt-Linux trabajar en varias PC Elbrus en varias conferencias.  Aqu√≠ hay fotos de la exhibici√≥n de una de las conferencias de este a√±o (perd√≥n por ver mal, estaba oscuro).  Tambi√©n nos conectamos con el desarrollo.  Esperamos que seamos √∫tiles para el ICST, porque, como resultado, algunos de los aspectos m√°s destacados de la arquitectura de Elbrus no pueden ser compatibles con Linux (o los costos son muy grandes), por ejemplo, memoria etiquetada. <br><br><img src="https://habrastorage.org/webt/yy/e9/jr/yye9jr5eg1nw99rppron_47drlw.jpeg" align="right" width="50%"><br><br><img src="https://habrastorage.org/webt/ki/n1/vk/kin1vkulag_gynsmlebiv146das.jpeg" align="left" width="50%">  Otro punto importante cuando discutimos el problema del cierre con los desarrolladores del MCST, objetaron que, por ejemplo, las fuentes del kernel de Linux estuvieron abiertas durante mucho tiempo, pero solo nosotros y los desarrolladores de Dolomant hicimos preguntas y las usamos de alguna manera. <br><br>  Adem√°s, seg√∫n mi informaci√≥n, el MCST organizar√° un stand <br>  accesible de forma remota.  En el cual ser√° posible ensamblar y ejecutar software en una PC con arquitectura Elbrus.  Si existe un inter√©s similar y desea utilizar el soporte, debe comunicarse, por ejemplo, conmigo: describa c√≥mo se planea usarlo, cu√°nto tiempo lleva, etc., porque para compartir con el cambio de software, debe organizar un cronograma.  Transferir√© los datos al ICST o conectar√© a quienes deseen con los organizadores. <br><br><hr><br>  Enlaces utiles: <br><br>  La direcci√≥n de correo de los usuarios es user [at] mcst.ru <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Una breve descripci√≥n de la arquitectura de Elbrus.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuentes de embox</a> <br><br>  PD: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mostraremos a</a> todos los que quieran lo que obtuvimos en el festival <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TechTrain</a> IT <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">del</a> 1 al 2 de septiembre. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421441/">https://habr.com/ru/post/es421441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421429/index.html">LSTM - Precios din√°micos ANN en el comercio minorista de art√≠culos para el hogar</a></li>
<li><a href="../es421431/index.html">Gesti√≥n del tiempo o gesti√≥n eficaz del caos</a></li>
<li><a href="../es421433/index.html">Quedaba exactamente un d√≠a antes de que se iniciara el servidor.</a></li>
<li><a href="../es421435/index.html">"¬øPor qu√© estamos haciendo esto?" - Creador de Prisma y ex l√≠der del proyecto VK sobre su nuevo proyecto secreto.</a></li>
<li><a href="../es421439/index.html">Los japoneses presentaron un prototipo de procesador para la supercomputadora exaflops: c√≥mo funciona el chip</a></li>
<li><a href="../es421443/index.html">Nuevo en nuestro mercado: Descripci√≥n general de los tel√©fonos IP Snom D385 y D785</a></li>
<li><a href="../es421445/index.html">Estamos escribiendo un traductor simple en Lisp - II</a></li>
<li><a href="../es421447/index.html">Meetup de Redmadrobot para iOS</a></li>
<li><a href="../es421451/index.html">C√≥mo proteger a su hijo de la basura en YouTube y crear un reproductor personalizado con una lista blanca de canales</a></li>
<li><a href="../es421453/index.html">Situaci√≥n: Sonos se hizo p√∫blico y puede "salir de la habitaci√≥n"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>