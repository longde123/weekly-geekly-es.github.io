<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤§ ğŸ‘¦ ğŸ™‹ ä¿æŠ¤Zimbra OSEå…å—æš´åŠ›å’ŒDoSæ”»å‡» ğŸµ ğŸŒˆ ğŸ§€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zimbra Collaboration Suiteå¼€æºç‰ˆåœ¨å…¶å·¥å…·åº“ä¸­æä¾›äº†è®¸å¤šç”¨äºç¡®ä¿ä¿¡æ¯å®‰å…¨çš„å¼ºå¤§å·¥å…·ã€‚ å…¶ä¸­ï¼Œ Postscreenæ˜¯ä¸€ç§ä¿æŠ¤é‚®ä»¶æœåŠ¡å™¨å…å—åƒµå°¸ç½‘ç»œæ”»å‡»çš„è§£å†³æ–¹æ¡ˆï¼› ClamAVæ˜¯ä¸€ç§é˜²ç—…æ¯’è½¯ä»¶ï¼Œå¯ä»¥æ‰«æä¼ å…¥æ–‡ä»¶å’Œä¿¡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æ¶æ„è½¯ä»¶æ„ŸæŸ“ï¼Œè€ŒSpamAssassinæ˜¯è¿„ä»Šä¸ºæ­¢...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä¿æŠ¤Zimbra OSEå…å—æš´åŠ›å’ŒDoSæ”»å‡»</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/zimbra/blog/476640/">  Zimbra Collaboration Suiteå¼€æºç‰ˆåœ¨å…¶å·¥å…·åº“ä¸­æä¾›äº†è®¸å¤šç”¨äºç¡®ä¿ä¿¡æ¯å®‰å…¨çš„å¼ºå¤§å·¥å…·ã€‚ å…¶ä¸­ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Postscreen</a>æ˜¯ä¸€ç§ä¿æŠ¤é‚®ä»¶æœåŠ¡å™¨å…å—åƒµå°¸ç½‘ç»œæ”»å‡»çš„è§£å†³æ–¹æ¡ˆï¼› ClamAVæ˜¯ä¸€ç§é˜²ç—…æ¯’è½¯ä»¶ï¼Œå¯ä»¥æ‰«æä¼ å…¥æ–‡ä»¶å’Œä¿¡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æ¶æ„è½¯ä»¶æ„ŸæŸ“ï¼Œè€Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SpamAssassin</a>æ˜¯è¿„ä»Šä¸ºæ­¢æœ€å¥½çš„åƒåœ¾é‚®ä»¶è¿‡æ»¤å™¨ä¹‹ä¸€ã€‚ ä½†æ˜¯ï¼Œè¿™äº›å·¥å…·æ— æ³•ä¿æŠ¤Zimbra OSEå…å—æš´åŠ›æ”»å‡»ã€‚ åœ¨ç‰¹æ®Šè¯å…¸ä¸­ï¼Œå¯†ç å¹¶ä¸æ˜¯æœ€ä¼˜é›…çš„æ–¹æ³•ï¼Œä½†ä»ç„¶éå¸¸æœ‰æ•ˆåœ°æšä¸¾ï¼Œä¸ä»…å……æ»¡äº†æˆåŠŸç ´è§£æ‰€æœ‰åç»§åæœçš„å¯èƒ½æ€§ï¼Œè€Œä¸”è¿˜å¸¦æ¥äº†æœåŠ¡å™¨ä¸Šå¤§é‡è´Ÿè½½çš„åˆ›å»ºï¼Œè¯¥è´Ÿè½½å¤„ç†äº†æ‰€æœ‰ä½¿ç”¨Zimbra OSEç ´è§£æœåŠ¡å™¨çš„æœªæˆåŠŸå°è¯•ã€‚ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e98/93d/7d9/e9893d7d9f995c2a24dce02df7fa5d51.png" alt="å›¾ç‰‡"><br><a name="habracut"></a><br> åŸåˆ™ä¸Šï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ ‡å‡†Zimbra OSEå·¥å…·ä¿æŠ¤è‡ªå·±å…å—æš´åŠ›ä¾µå®³ã€‚ å¯†ç å®‰å…¨ç­–ç•¥è®¾ç½®å…è®¸æ‚¨è®¾ç½®å¯†ç å°è¯•å¤±è´¥çš„æ¬¡æ•°ï¼Œæ­¤åå°†é˜»æ­¢å¯èƒ½å—åˆ°æ”»å‡»çš„å¸æˆ·ã€‚ è¿™ç§æ–¹æ³•çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™æ ·çš„æƒ…å†µï¼šä¸€ä¸ªæˆ–å¤šä¸ªå‘˜å·¥çš„å¸æˆ·å¯èƒ½ç”±äºæš´åŠ›æ”»å‡»è€Œè¢«å°é”ï¼Œè€Œä»–ä»¬å¯¹æ­¤æ¯«æ— å…³ç³»ï¼Œå¹¶ä¸”å‘˜å·¥çš„ç®€å•å·¥ä½œå¯èƒ½ç»™å…¬å¸å¸¦æ¥å·¨å¤§æŸå¤±ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ€å¥½ä¸è¦é‡‡ç”¨è¿™ç§é˜²æ­¢æš´åŠ›çš„é€‰æ‹©ã€‚ <br><br><img src="https://habrastorage.org/webt/gz/cn/kg/gzcnkguoq2isuxplbgetg-y1ft4.png"><br><br> ä¸ºäº†é˜²æ­¢æš´åŠ›ï¼ŒZimbra OSEå†…ç½®äº†ä¸€ä¸ªç§°ä¸ºDoSFilterçš„ç‰¹æ®Šå·¥å…·ï¼Œå®ƒå¯ä»¥é€šè¿‡HTTPè‡ªåŠ¨ä¸Zimbra OSEæ–­å¼€è¿æ¥ã€‚ æ¢å¥è¯è¯´ï¼ŒDoSFilterçš„æ“ä½œåŸç†ç±»ä¼¼äºPostScreençš„æ“ä½œåŸç†ï¼Œä»…ç”¨äºå…¶ä»–åè®®ã€‚ æœ€åˆæ—¨åœ¨é™åˆ¶å•ä¸ªç”¨æˆ·å¯ä»¥æ‰§è¡Œçš„æ“ä½œæ•°é‡ï¼ŒDoSFilterä¹Ÿå¯ä»¥æä¾›é’ˆå¯¹æš´åŠ›çš„ä¿æŠ¤ã€‚ å®ƒä¸Zimbraå†…ç½®å·¥å…·çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œç»è¿‡ä¸€å®šæ¬¡æ•°çš„ä¸æˆåŠŸå°è¯•åï¼Œå®ƒä¸ä¼šé˜»æ­¢ç”¨æˆ·æœ¬äººï¼Œè€Œæ˜¯é˜»æ­¢è¿›è¡Œå¤šæ¬¡å°è¯•ç™»å½•åˆ°ä¸€ä¸ªæˆ–å¦ä¸€ä¸ªå¸æˆ·çš„IPåœ°å€ã€‚ å› æ­¤ï¼Œç³»ç»Ÿç®¡ç†å‘˜ä¸ä»…å¯ä»¥ä¿æŠ¤è‡ªå·±å…å—æš´åŠ›ä¾µå®³ï¼Œè¿˜å¯ä»¥é€šè¿‡ç®€å•åœ°å°†å…¶å…¬å¸çš„å†…éƒ¨ç½‘ç»œæ·»åŠ åˆ°å—ä¿¡ä»»çš„IPåœ°å€å’Œå­ç½‘åˆ—è¡¨ä¸­æ¥é¿å…é˜»æ­¢å…¬å¸å‘˜å·¥ã€‚ <br><br>  DoSFilterçš„ä¸€å¤§ä¼˜ç‚¹æ˜¯ï¼Œé™¤äº†å¤šæ¬¡å°è¯•ç™»å½•ä¸€ä¸ªæˆ–å¦ä¸€ä¸ªå¸æˆ·å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ­¤å·¥å…·è‡ªåŠ¨é˜»æ­¢é‚£äº›æ‹¥æœ‰å‘˜å·¥èº«ä»½éªŒè¯æ•°æ®çš„ç½‘ç»œç½ªçŠ¯ï¼Œç„¶åæˆåŠŸç™»å½•å…¶å¸æˆ·å¹¶å¼€å§‹å‘æœåŠ¡å™¨å‘é€æ•°ç™¾ä¸ªè¯·æ±‚ã€‚ <br><br> æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ§åˆ¶å°å‘½ä»¤é…ç½®DoSFilterï¼š <br><br><ul><li>  <b>zimbraHttpDosFilterMaxRequestsPerSec-</b>ä½¿ç”¨æ­¤å‘½ä»¤å¯ä»¥è®¾ç½®ä¸€ä¸ªç”¨æˆ·å…è®¸çš„æœ€å¤§è¿æ¥æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤å€¼ä¸º30ä¸ªè¿æ¥ã€‚ </li><li>  <b>zimbraHttpDosFilterDelayMillis-</b>ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œå¯ä»¥è®¾ç½®è¶…å‡ºä¸Šä¸€å‘½ä»¤è®¾ç½®çš„é™åˆ¶çš„è¿æ¥çš„å»¶è¿Ÿï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚ é™¤äº†æ•´æ•°å€¼ä¹‹å¤–ï¼Œç®¡ç†å‘˜è¿˜å¯ä»¥æŒ‡å®š0ä»¥ä¾¿æ ¹æœ¬æ²¡æœ‰å»¶è¿Ÿï¼Œè¿˜å¯ä»¥æŒ‡å®š-1ä»¥ä¾¿ç®€å•åœ°ä¸­æ–­æ‰€æœ‰è¶…è¿‡æŒ‡å®šé™åˆ¶çš„è¿æ¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤å€¼ä¸º-1ã€‚ </li><li> <b>zimbraHttpThrottleSafeIPs-</b>ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œç®¡ç†å‘˜å¯ä»¥æŒ‡å®šä¸å—ä¸Šè¿°é™åˆ¶å½±å“çš„å—ä¿¡ä»»IPåœ°å€å’Œå­ç½‘ã€‚ è¯·æ³¨æ„ï¼Œæ­¤å‘½ä»¤çš„è¯­æ³•å¯èƒ½ä¼šæ ¹æ®æ‰€éœ€ç»“æœè€Œæœ‰æ‰€ä¸åŒã€‚ å› æ­¤ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡è¾“å…¥å‘½ä»¤<b>zmprov mcf zimbraHttpThrottleSafeIPs 127.0.0.1</b> ï¼Œæ‚¨å¯ä»¥å®Œå…¨é‡å†™æ•´ä¸ªåˆ—è¡¨ï¼Œå¹¶åœ¨å…¶ä¸­ä»…ä¿ç•™ä¸€ä¸ªIPåœ°å€ã€‚ å¦‚æœè¾“å…¥å‘½ä»¤<b>zmprov mcf + zimbraHttpThrottleSafeIPs 127.0.0.1</b> ï¼Œåˆ™è¾“å…¥çš„IPåœ°å€å°†æ·»åŠ åˆ°ç™½åå•ä¸­ã€‚ åŒæ ·ï¼Œä½¿ç”¨å‡å·ï¼Œæ‚¨å¯ä»¥ä»å…è®¸çš„åˆ—è¡¨ä¸­åˆ é™¤ä»»ä½•IPã€‚ </li></ul><br> è¯·æ³¨æ„ï¼Œä½¿ç”¨Zextras Suite Proæ‰©å±•ç¨‹åºæ—¶ï¼ŒDoSFilterå¯èƒ½ä¼šå¯¼è‡´è®¸å¤šé—®é¢˜ã€‚ ä¸ºäº†é¿å…å®ƒä»¬ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨å‘½ä»¤<b>zmprov mcf zimbraHttpDosFilterMaxRequestsPerSec 100</b>å°†åŒæ—¶è¿æ¥çš„æ•°é‡ä»30 <b>å¢åŠ åˆ°100</b> ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬å»ºè®®å°†ä¼ä¸šçš„å†…éƒ¨ç½‘ç»œæ·»åŠ åˆ°å…è®¸çš„åˆ—è¡¨ä¸­ã€‚ å¯ä»¥ä½¿ç”¨å‘½ä»¤<b>zmprov mcf + zimbraHttpThrottleSafeIPs 192.168.0.0/24</b>æ¥å®Œæˆã€‚ å¯¹DoSFilterè¿›è¡Œä»»ä½•æ›´æ”¹ä¹‹åï¼Œè¯·ç¡®ä¿ä½¿ç”¨<b>zmmailboxdctl restart</b>å‘½ä»¤é‡æ–°å¯åŠ¨é‚®ä»¶æœåŠ¡å™¨ã€‚ <br><br>  DoSFilterçš„ä¸»è¦ç¼ºç‚¹æ˜¯å®ƒå¯ä»¥åœ¨åº”ç”¨ç¨‹åºçº§åˆ«è¿è¡Œï¼Œå› æ­¤åªèƒ½é™åˆ¶æ”»å‡»è€…åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œå„ç§æ“ä½œçš„èƒ½åŠ›ï¼Œè€Œä¸èƒ½é™åˆ¶è¿æ¥åˆ°åŒ—æ–¹çš„èƒ½åŠ›ã€‚ å› æ­¤ï¼Œå°½ç®¡è®¤è¯è¯·æ±‚æˆ–å‘é€ç»™æœåŠ¡å™¨çš„ä¿¡ä»¶æ˜¾ç„¶æ˜¯å¤±è´¥çš„ï¼Œä½†å®ƒä»¬ä»å°†æ˜¯ä¸€ç§å¾ˆå¥½çš„æ—§DoSæ”»å‡»ï¼Œæ— æ³•åœ¨å¦‚æ­¤é«˜çš„çº§åˆ«ä¸Šé˜»æ­¢ã€‚ <br><br> ä¸ºäº†ä½¿ç”¨Zimbra OSEå®Œå…¨ä¿æŠ¤å…¬å¸æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨Fail2banä¹‹ç±»çš„è§£å†³æ–¹æ¡ˆï¼Œè¯¥æ¡†æ¶å¯ä»¥ä¸æ–­ç›‘è§†ä¿¡æ¯ç³»ç»Ÿæ—¥å¿—ä¸­æ˜¯å¦å­˜åœ¨é‡å¤æ“ä½œï¼Œå¹¶é€šè¿‡æ›´æ”¹é˜²ç«å¢™è®¾ç½®æ¥é˜»æ­¢å…¥ä¾µè€…ã€‚ å¦‚æ­¤ä½çš„é˜»æ­¢æ°´å¹³å¯è®©æ‚¨åœ¨ä¸æœåŠ¡å™¨çš„IPè¿æ¥é˜¶æ®µç«‹å³ç¦ç”¨æ”»å‡»è€…ã€‚ å› æ­¤ï¼ŒFail2Banå¯ä»¥å®Œç¾è¡¥å……ä½¿ç”¨DoSFilteræ„å»ºçš„ä¿æŠ¤ã€‚ è®©æˆ‘ä»¬äº†è§£å¦‚ä½•ä½¿ç”¨Zimbra OSEç»“è¯†Fail2Banæœ‹å‹ï¼Œä»è€Œæé«˜ä¼ä¸šITåŸºç¡€æ¶æ„çš„å®‰å…¨æ€§ã€‚ <br><br> åƒä»»ä½•å…¶ä»–ä¼ä¸šçº§åº”ç”¨ç¨‹åºä¸€æ ·ï¼ŒZimbra Collaboration Suiteå¼€æºç‰ˆç»´æŠ¤å…¶å·¥ä½œçš„è¯¦ç»†æ—¥å¿—ã€‚ å®ƒä»¬å¤§å¤šæ•°ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨<b>/ opt / zimbra / log /</b>æ–‡ä»¶å¤¹ä¸­ã€‚ è¿™é‡Œåªæ˜¯å…¶ä¸­ä¸€äº›ï¼š <br><br><ul><li>  Mailbox.log-ç å¤´é‚®ä»¶æœåŠ¡æ—¥å¿— </li><li>  audit.log-èº«ä»½éªŒè¯æ—¥å¿— </li><li>  clamd.log-é˜²ç—…æ¯’æ—¥å¿— </li><li>  freshclam.log-é˜²ç—…æ¯’æ›´æ–°æ—¥å¿— </li><li>  convertd.log-é™„ä»¶è½¬æ¢å™¨æ—¥å¿— </li><li>  zimbrastats.csv-æœåŠ¡å™¨æ€§èƒ½æ—¥å¿— </li></ul><br>  Zimbraæ—¥å¿—ä¹Ÿå¯ä»¥åœ¨<b>/var/log/zimbra.log</b>æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œè¯¥æ–‡ä»¶ä¸­ç»´æŠ¤äº†Postfixå’ŒZimbraæœ¬èº«çš„æ—¥å¿—ã€‚ <br><br> ä¸ºäº†ä¿æŠ¤æˆ‘ä»¬çš„ç³»ç»Ÿå…å—æš´åŠ›ä¾µå®³ï¼Œæˆ‘ä»¬å°†ç›‘è§†<b>mailbox.log</b> ï¼Œ <b>audit.log</b>å’Œ<b>zimbra.log</b> ã€‚ <br><br> ä¸ºäº†ä½¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œå¿…é¡»ä½¿ç”¨Zimbra OSEåœ¨æ‚¨çš„æœåŠ¡å™¨ä¸Šå®‰è£…Fail2Banå’Œiptablesã€‚ å¦‚æœä½¿ç”¨Ubuntuï¼Œåˆ™å¯ä»¥ä½¿ç”¨<b>dpkg -s fail2banå‘½ä»¤</b>æ‰§è¡Œæ­¤<b>æ“ä½œ</b> ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨CentOSï¼Œåˆ™å¯ä»¥ä½¿ç”¨<b>å®‰è£…</b>çš„<b>yum list fail2banå‘½ä»¤è¿›è¡ŒéªŒè¯</b> ã€‚ å¦‚æœæ‚¨æ²¡æœ‰å®‰è£…Fail2Banï¼Œåˆ™å®‰è£…å®ƒä¸ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºè¯¥è½¯ä»¶åŒ…å‡ ä¹åœ¨æ‰€æœ‰æ ‡å‡†å­˜å‚¨åº“ä¸­ã€‚ <br><br> å®‰è£…æ‰€æœ‰å¿…éœ€çš„è½¯ä»¶ä¹‹åï¼Œæ‚¨å¯ä»¥ç»§ç»­é…ç½®Fail2Banã€‚ ä¸ºæ­¤ï¼Œåˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶<b>/etc/fail2ban/filter.d/zimbra.conf</b> ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬ä¸ºZimbra OSEæ—¥å¿—ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å°†å¯¹åº”äºé”™è¯¯çš„ç™»å½•å°è¯•å¹¶è§¦å‘Fail2Banæœºåˆ¶ã€‚ è¿™æ˜¯zimbra.confå†…å®¹çš„ç¤ºä¾‹ï¼Œå…¶ä¸­åŒ…å«ä¸€ç»„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒä»¬å¯¹åº”äºèº«ä»½éªŒè¯å°è¯•å¤±è´¥æ—¶Zimbra OSEç”Ÿæˆçš„å„ç§é”™è¯¯ï¼š <br><br><pre><code class="plaintext hljs"># Fail2Ban configuration file [Definition] failregex = \[ip=&lt;HOST&gt;;\] account - authentication failed for .* \(no such account\)$ \[ip=&lt;HOST&gt;;\] security - cmd=Auth; .* error=authentication failed for .*, invalid password;$ ;oip=&lt;HOST&gt;;.* security - cmd=Auth; .* protocol=soap; error=authentication failed for .* invalid password;$ ;oip=&lt;HOST&gt;;.* security - cmd=Auth; .* protocol=imap; error=authentication failed for .* invalid password;$ \[oip=&lt;HOST&gt;;.* SoapEngine - handler exception: authentication failed for .*, account not found$ WARN .*;ip=&lt;HOST&gt;;ua=ZimbraWebClient .* security - cmd=AdminAuth; .* error=authentication failed for .*;$ ignoreregex =</code> </pre> <br> ç¼–è¯‘Zimbra OSEçš„æ­£åˆ™è¡¨è¾¾å¼åï¼Œè¯¥å¼€å§‹ç¼–è¾‘Fail2banæœ¬èº«çš„é…ç½®äº†ã€‚ è¯¥å®ç”¨ç¨‹åºçš„è®¾ç½®ä½äº<b>/etc/fail2ban/jail.conf</b>æ–‡ä»¶ä¸­ã€‚ ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<b>cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.conf.bak</b>å‘½ä»¤<b>å¯¹å…¶è¿›è¡Œå¤‡ä»½</b> ã€‚ ä¹‹åï¼Œè®©æˆ‘ä»¬å°†è¯¥æ–‡ä»¶è½¬æ¢ä¸ºä»¥ä¸‹æ ¼å¼ï¼š <br><br><pre> <code class="plaintext hljs"># Fail2Ban configuration file [DEFAULT] ignoreip = 192.168.0.1/24 bantime = 600 findtime = 600 maxretry = 5 backend = auto [ssh-iptables] enabled = false filter = sshd action = iptables[name=SSH, port=ssh, protocol=tcp] sendmail-whois[name=SSH, dest=admin@company.ru, sender=fail2ban@company.ru] logpath = /var/log/messages maxretry = 5 [sasl-iptables] enabled = false filter = sasl backend = polling action = iptables[name=sasl, port=smtp, protocol=tcp] sendmail-whois[name=sasl, dest=support@company.ru] logpath = /var/log/zimbra.log [ssh-tcpwrapper] enabled = false filter = sshd action = hostsdeny sendmail-whois[name=SSH, dest=support@ company.ru] ignoreregex = for myuser from logpath = /var/log/messages [zimbra-account] enabled = true filter = zimbra action = iptables-allports[name=zimbra-account] sendmail[name=zimbra-account, dest=support@company.ru ] logpath = /opt/zimbra/log/mailbox.log bantime = 600 maxretry = 5 [zimbra-audit] enabled = true filter = zimbra action = iptables-allports[name=zimbra-audit] sendmail[name=Zimbra-audit, dest=support@company.ru] logpath = /opt/zimbra/log/audit.log bantime = 600 maxretry = 5 [zimbra-recipient] enabled = true filter = zimbra action = iptables-allports[name=zimbra-recipient] sendmail[name=Zimbra-recipient, dest=support@company.ru] logpath = /var/log/zimbra.log bantime = 172800 maxretry = 5 [postfix] enabled = true filter = postfix action = iptables-multiport[name=postfix, port=smtp, protocol=tcp] sendmail-buffered[name=Postfix, dest=support@company.ru] logpath = /var/log/zimbra.log bantime = -1 maxretry = 5</code> </pre> <br> å°½ç®¡æ­¤ç¤ºä¾‹ç›¸å½“é€šç”¨ï¼Œä½†å€¼å¾—è§£é‡Šä¸€ä¸‹è‡ªå·±è®¾ç½®Fail2Banæ—¶å¯èƒ½è¦æ›´æ”¹çš„ä¸€äº›å‚æ•°ï¼š <br><br><ul><li>  <b>Ignoreip-</b>ä½¿ç”¨æ­¤å‚æ•°ï¼Œæ‚¨å¯ä»¥æŒ‡å®šç‰¹å®šçš„IPæˆ–å­ç½‘ï¼Œå³ä¸åº”è¯¥ä»ä¸­æ£€æŸ¥Fail2Bançš„åœ°å€ã€‚ é€šå¸¸ï¼Œä¼ä¸šçš„å†…éƒ¨ç½‘ç»œå’Œå…¶ä»–å—ä¿¡ä»»åœ°å€å°†æ·»åŠ åˆ°å¿½ç•¥åˆ—è¡¨ä¸­ã€‚ </li><li>  <b>ç¦æ­¢</b>æ—¶é—´-å…¥ä¾µè€…å°†è¢«ç¦æ­¢çš„æ—¶é—´ã€‚ ä»¥ç§’ä¸ºå•ä½ã€‚ å€¼-1è¡¨ç¤ºæ— é™åˆ¶ã€‚ </li><li>  <b>Maxretry-</b>ä¸€ä¸ªIPåœ°å€å¯ä»¥å°è¯•è®¿é—®æœåŠ¡å™¨çš„æœ€å¤§æ¬¡æ•°ã€‚ </li><li>  <b>Sendmail-</b>ä¸€ç§è®¾ç½®ï¼Œä½¿æ‚¨å¯ä»¥è‡ªåŠ¨å‘é€æœ‰å…³Fail2Banæ“ä½œçš„ç”µå­é‚®ä»¶è­¦æŠ¥ã€‚ </li><li>  <b>Findtime-</b>ä¸€ç§è®¾ç½®ï¼Œå…è®¸æ‚¨è®¾ç½®æ—¶é—´é—´éš”ï¼Œåœ¨è¯¥æ—¶é—´é—´éš”å†…ï¼Œå°è¯•å¤±è´¥çš„æœ€å¤§æ¬¡æ•°å·²ç”¨å®Œä¹‹åï¼ŒIPåœ°å€å¯ä»¥å†æ¬¡å°è¯•è®¿é—®æœåŠ¡å™¨ï¼ˆmaxretryå‚æ•°ï¼‰ </li></ul><br> ä½¿ç”¨Fail2Banè®¾ç½®ä¿å­˜æ–‡ä»¶åï¼Œä»…ä½¿ç”¨<b>service fail2ban restartå‘½ä»¤</b>é‡æ–°å¯åŠ¨æ­¤å®ç”¨ç¨‹åºã€‚ é‡æ–°å¯åŠ¨åï¼Œå°†è¿ç»­ç›‘è§†Zimbraä¸»æ—¥å¿—ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ å› æ­¤ï¼Œç®¡ç†å‘˜å‡ ä¹å¯ä»¥æ¶ˆé™¤å…¥ä¾µè€…è¿›å…¥Zimbra Collaboration Suiteå¼€æºç‰ˆé‚®ç®±çš„ä»»ä½•å¯èƒ½æ€§ï¼Œè€Œä¸”è¿˜å¯ä»¥ä¿æŠ¤Zimbra OSEå†…è¿è¡Œçš„æ‰€æœ‰æœåŠ¡ï¼Œå¹¶çŸ¥é“è¿›è¡Œæœªç»æˆæƒè®¿é—®çš„ä»»ä½•å°è¯•ã€‚ <br><br> æœ‰å…³Zextras Suiteçš„æ‰€æœ‰é—®é¢˜ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç”µå­é‚®ä»¶katerina@zextras.comä¸Zextrasä»£è¡¨è”ç³»ï¼ŒEkaterina Triandafilidiã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN476640/">https://habr.com/ru/post/zh-CN476640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN476620/index.html">SP701 + PCAM-5C + 15åˆ†é’Ÿ+ VITIS = FPGAä¸Šçš„ç®€æ˜“MIPI</a></li>
<li><a href="../zh-CN476624/index.html">ç§»åŠ¨å¼€å‘ä¸­çš„è´¨é‡ç®¡é“ï¼Œç¬¬1éƒ¨åˆ†ï¼šAndroid</a></li>
<li><a href="../zh-CN476626/index.html">äº‘ä¸­çš„PVS-Studioï¼šGitLab CI / CD</a></li>
<li><a href="../zh-CN476628/index.html">PVS-Studioèµ°å‘äº‘ç«¯ï¼šGitLab CI / CD</a></li>
<li><a href="../zh-CN476636/index.html">è°ƒæ•´Firebirdå’ŒLinuxï¼Œä»¥å®¹çº³691 GBçš„æ•°æ®åº“ï¼Œå¯å®¹çº³1000å¤šä¸ªç”¨æˆ·</a></li>
<li><a href="../zh-CN476644/index.html">è¯­è¨€å±‚</a></li>
<li><a href="../zh-CN476646/index.html">åœ¨werfä¸­è¿›è¡Œ3ç§æ–¹å¼åˆå¹¶ï¼šåœ¨Heberä¸Šéƒ¨ç½²Kubernetesï¼Œâ€œåœ¨ç±»å›ºé†‡ä¸Šâ€</a></li>
<li><a href="../zh-CN476648/index.html">è”æƒ³åœ¨FINOPOLIS 2019</a></li>
<li><a href="../zh-CN476650/index.html">æšä¸¾åœ¨å½“ä»Šç¬æ¯ä¸‡å˜çš„ä¸–ç•Œä¸­çš„åœ°ä½</a></li>
<li><a href="../zh-CN476656/index.html">11æœˆ26æ—¥ï¼Œè«æ–¯ç§‘-Alfa JS MeetUPï¼ƒ3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>