<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÖæÔ∏è üêÅ üà∏ ChipWhisperer: Energy Attack on Magma üë≥ ü§æüèø üéÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Publicado por rakf 





 Como parte del Summer of Hack 2019 en Digital Security, enfrent√© un ataque de poder y trabaj√© con ChipWhisperer. 
 Que es es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ChipWhisperer: Energy Attack on Magma</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/477730/"><p>  Publicado por <a href="https://habr.com/ru/users/rakf/" class="user_link">rakf</a> </p><br><p><img src="https://habrastorage.org/webt/t1/qx/44/t1qx44fuppd2dlfmn-vvb6fsriq.jpeg"></p><br><p>  Como parte del Summer of Hack 2019 en Digital Security, enfrent√© un ataque de poder y trabaj√© con ChipWhisperer. </p><br><h2 id="chto-eto">  Que es esto </h2><br><p>  El an√°lisis de energ√≠a es un tipo de ataque a trav√©s de canales de terceros.  Es decir, ataques que usan informaci√≥n que aparece como resultado de la implementaci√≥n f√≠sica del sistema. </p><br><p>  Qu√© informaci√≥n puede ser √∫til para un atacante: </p><br><ul><li>  tiempo de conversi√≥n criptogr√°fica; </li><li>  consumo de energ√≠a; </li><li>  campos electromagneticos; </li><li>  ruido etc. </li></ul><br><p>  Un ataque de energ√≠a se considera el m√°s universal. </p><a name="habracut"></a><br><h2 id="pochemu-rabotaet">  Por que funciona </h2><br><p>  Los microprocesadores, microcontroladores, RAM y muchos otros circuitos l√≥gicos se basan en la tecnolog√≠a CMOS.  El consumo de energ√≠a de los circuitos CMOS consta de dos componentes: est√°tico y din√°mico.  El consumo de energ√≠a est√°tica es muy peque√±o, lo cual es una de las razones de la monopolizaci√≥n de la tecnolog√≠a.  La potencia din√°mica se debe a la conmutaci√≥n de los transistores y depende de los datos procesados ‚Äã‚Äãy las operaciones realizadas.  Dado que el componente est√°tico es principalmente constante, el cambio en la potencia total se debe exclusivamente a la potencia din√°mica y, por lo tanto, el consumo total de energ√≠a se puede utilizar para el an√°lisis. </p><br><h2 id="instrumentariy">  Kit de herramientas </h2><br><p>  <a href="https://newae.com/tools/chipwhisperer/">ChipWhisperer</a> , utilic√© la versi√≥n de 2 partes: </p><br><p><img src="https://habrastorage.org/webt/56/p3/p4/56p3p4nq89l3drktqn9c0eo1mta.jpeg" alt="ChipWhisperer versi√≥n de 2 partes"></p><br><p>  ChipWhisperer es un kit de herramientas de c√≥digo abierto para investigar la seguridad de los dispositivos integrados.  Permite an√°lisis de energ√≠a y ataques basados ‚Äã‚Äãen errores. </p><br><p>  La tarifa costar√° $ 250.  Los desarrolladores lo posicionan como una soluci√≥n revolucionaria, porque tales complejos, seg√∫n los creadores, cuestan desde $ 30k.  El dispositivo consta de 2 tableros: objetivo y tablero de captura. </p><br><p>  Hay otras versiones, con sus ventajas (pero tambi√©n a un gran costo), tambi√©n puede comprar por separado varias placas de destino, tarjetas de expansi√≥n, sondear para un an√°lisis completo de sus dispositivos y usar ChipWhisperer solo para su eliminaci√≥n. </p><br><p>  ChipWhisperer tiene una excelente <a href="https://wiki.newae.com/Main_Page">wiki</a> , peque√±os <a href="https://chipwhisperer.readthedocs.io/en/latest/tutorials.html">laboratorios de</a> desarrollo, y para la quinta versi√≥n incluso hicieron una buena <a href="https://chipwhisperer.readthedocs.io/en/latest/api.html">documentaci√≥n de</a> API.  Las pistas se eliminan del dispositivo conectado utilizando su software y se registran como una matriz NumPy. </p><br><p>  Primero debe escribir el firmware para el dispositivo de destino.  Como parte del laboratorio, se consideran los cifrados AES, DES, TEA.  Para ellos, ya hay configuraciones y firmware listos para eliminar rastros (el n√∫mero de muestras a tomar, compensaci√≥n, frecuencia de ADC, etc.).  Para la investigaci√≥n independiente, los ajustes deber√°n seleccionarse experimentalmente. </p><br><p>  Como se mencion√≥ anteriormente, puede provocar una falla de la placa de destino: causar un mal funcionamiento de la se√±al del reloj, omitir instrucciones y extraer informaci√≥n secreta. </p><br><p>  En complejos grandes, se utiliza un osciloscopio para rastrear pistas. </p><br><h2 id="analiz">  An√°lisis </h2><br><p>  Existen varios m√©todos de an√°lisis b√°sicos: </p><br><ul><li>  an√°lisis de potencia simple (SPA); </li><li>  an√°lisis de potencia diferencial (DPA); </li><li> an√°lisis de correlaci√≥n de potencia (CPA). </li></ul><br><p>  Un an√°lisis de potencia simple incluye un an√°lisis visual del gr√°fico de potencia.  Por ejemplo, se puede obtener una contrase√±a de un car√°cter a la vez observando el perfil de potencia cuando se ingresa el car√°cter correcto y compar√°ndolo con el incorrecto. </p><br><p><img src="https://habrastorage.org/webt/ep/rf/tg/eprftggxt26idk5tq4uccp3p9kq.png" alt="An√°lisis de potencia de contrase√±a"></p><br><p>  O puede ver las rondas de cifrado en las pistas.  No son suficientes datos para obtener una clave, pero se puede suponer qu√© algoritmo se ejecuta.  La figura muestra claramente 10 rondas de AES. </p><br><p><img src="https://habrastorage.org/webt/ib/pl/e7/ibple7hxooxtxb1bkah2d1k-i_s.png" alt="AES SPA"></p><br><p>  El an√°lisis diferencial (DPA) es mucho m√°s eficiente que el an√°lisis simple, ya que se basa en m√©todos de an√°lisis estad√≠stico para detectar diferencias en los rastros de potencia.  Sin embargo, una herramienta muy efectiva para "abrir" la llave requerir√° una gran cantidad de rutas.  No utilic√© este m√©todo para el an√°lisis, pero al final dar√© algunos enlaces a fuentes donde est√° bien descrito. </p><br><p>  La base del an√°lisis de correlaci√≥n es un aparato estad√≠stico para determinar la clave secreta de cifrado.  A veces se a√≠sla en un tipo separado, a veces denominado DPA.  Este m√©todo requiere menos trazas que DPA, lo us√© para el an√°lisis de potencia.  Te contar√© m√°s al respecto. </p><br><p>  La tarea principal es construir un modelo preciso de consumo de energ√≠a del dispositivo en estudio.  Si se construye un modelo preciso, hay una correlaci√≥n notable entre el valor predicho y el real. </p><br><p>  Uno de los modelos de potencia que se puede utilizar es el modelo de peso Hamming.  El peso de Hamming es el n√∫mero de valores distintos de cero en la representaci√≥n binaria.  La suposici√≥n de este modelo es que el n√∫mero de bits establecidos en el registro se correlacionar√° con la energ√≠a consumida por el dispositivo.  El peso de Hamming en s√≠ se usa en adelante como una unidad convencional de energ√≠a.  Tambi√©n se usa el modelo de distancia de Hamming: el n√∫mero de bits diferentes en 2 valores. </p><br><p>  Para comparar el modelo de peso de Hamming y el consumo de energ√≠a real, se utiliza un coeficiente lineal de Pearson.  Muestra la dependencia lineal de una cantidad con otra.  Con un modelo construido correctamente, este coeficiente tender√° a 1. </p><br><p>  El algoritmo de CPA generalizado consta de los siguientes pasos principales: </p><br><ul><li>  eliminar el consumo de energ√≠a al convertir mensajes en una clave desconocida; </li><li>  creamos un modelo de consumo de energ√≠a del chip al convertir los mismos mensajes en todas las variantes posibles del subbloque clave (256 opciones para cada byte); </li><li>  Encontramos el coeficiente de correlaci√≥n lineal para el consumo de energ√≠a simulado y real.  En el caso de una clave verdadera, el coeficiente tender√° a 1; </li><li>  el algoritmo se repite para los subbloques clave restantes. </li></ul><br><p>  Como resultado, la clave se restaura secuencialmente, en partes peque√±as.  Si atacamos un byte de la clave a la vez, entonces usamos 2 <sup>8</sup> intentos para cada clave.  Por ejemplo, si elige AES - 128, entonces el n√∫mero total de intentos para 16 bytes de la clave ser√° 2 <sup>12</sup> , que es mucho mejor que presionar 2 <sup>128</sup> . </p><br><h3 id="analiz-shifra-magma">  An√°lisis de cifrado de magma </h3><br><p>  Magma es un c√≥digo que se define en GOST R 34.12-2015, de hecho, el mismo GOST 28147-89, solo de perfil.  El bloque encriptado pasa por 32 rondas en las cuales ocurren algunas transformaciones.  La clave consta de 256 bits, cada clave redonda es parte del original. </p><br><p><img src="https://habrastorage.org/webt/il/lf/jg/illfjg84nei10xf2xgboiifkmjy.png" alt="Funci√≥n Feistel GOST"></p><br><p>  Analizaremos los datos obtenidos utilizando el m√©todo de CPA. </p><br><p>  Primero, debe elegir un valor intermedio del algoritmo, que depende de los datos conocidos y una peque√±a parte de la clave y puede calcularse mediante transformaciones simples.  Por lo general, este valor es la salida de S-box (Magma ahora tiene 1 tabla de sustituci√≥n, por lo que es m√°s f√°cil llevar a cabo tales ataques) de la primera (se conocen textos abiertos) o la √∫ltima ronda (se conocen los textos cifrados). </p><br><p>  Investigu√© una clave con textos abiertos bien conocidos, por lo tanto, esta opci√≥n se considerar√° m√°s a fondo.  En el algoritmo Magma, a diferencia de DES, AES, la adici√≥n de un bloque de 32 bits con una clave redonda se produce en el m√≥dulo 2 <sup>32</sup> , por lo tanto, es mejor comenzar el an√°lisis desde las √∫ltimas salidas de S-box, ya que agregar los valores m√°s altos no afecta a los m√°s j√≥venes.  Consideramos la salida de cada S-box: primero 8, luego 8, 7 y as√≠ sucesivamente hasta el primero.  La eliminaci√≥n de pistas se realiz√≥ en un microcontrolador de 8 bits, y podemos suponer que funcion√≥ con cajas S dobles.  Por lo tanto, atacar√© inmediatamente por 1 byte. </p><br><p>  C√°lculo del modelo de energ√≠a para el √∫ltimo byte clave: </p><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> kguess <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">256</span></span>): <span class="hljs-comment"><span class="hljs-comment">#Initialize arrays &amp; variables to zero sumnum = np.zeros(numpoint) sumden1 = np.zeros(numpoint) sumden2 = np.zeros(numpoint) hyp = np.zeros(numtraces) for tnum in range(numtraces): hyp[tnum] = HW[leak("Gost28147_tc26_ParamZ", kguess, block2ns(text[tnum])[0], 0)]</span></span></code> </pre> <br><p>  donde la funci√≥n de fuga simplemente devuelve la salida de S-box del √∫ltimo byte. </p><br><p>  Calculamos el coeficiente lineal de Pearson para los valores simulados y reales de acuerdo con la f√≥rmula: </p><br><p><img src="https://habrastorage.org/webt/yt/wd/f-/ytwdf-ah0p0fshbi-i83_tldkvs.png" alt="Correlaci√≥n"></p><br><pre> <code class="python hljs"> cpaoutput = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> maxcpa = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> <span class="hljs-comment"><span class="hljs-comment">#Mean of hypothesis meanh = np.mean(hyp, dtype=np.float64) #Mean of all points in trace meant = np.mean(traces, axis=0, dtype=np.float64) #For each trace, do the following for tnum in range(0, numtraces): hdiff = (hyp[tnum] - meanh) tdiff = traces[tnum,:] - meant sumnum = sumnum + (hdiff*tdiff) sumden1 = sumden1 + hdiff*hdiff sumden2 = sumden2 + tdiff*tdiff cpaoutput[kguess] = sumnum / np.sqrt( sumden1 * sumden2 ) maxcpa[kguess] = max(abs(cpaoutput[kguess]))</span></span></code> </pre> <br><p>  Al elegir una subclave verdadera, el coeficiente de correlaci√≥n tendr√° un aumento significativo: </p><br><p><img src="https://habrastorage.org/webt/8o/7j/8z/8o7j8zrfxosgutb_eymflrxxhp0.png" alt="Correlaci√≥n1"></p><br><p>  Por lo tanto, se analiza cada byte de la tecla redonda. </p><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bnum <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): cpaoutput = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> maxcpa = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> kguess <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">256</span></span>): best_round_key = kguess &lt;&lt; (bnum * <span class="hljs-number"><span class="hljs-number">8</span></span>) | best_round ...</code> </pre> <br><p>  Dada la tecla de la primera ronda, podemos calcular las teclas redondas 2 y posteriores de la misma manera.  Se puede obtener una llave Magma completa sacando 8 llaves redondas. </p><br><p>  En el proceso de resolver este problema, surgen varios matices.  A diferencia de los cifrados AES, DES, Grasshopper, la adici√≥n de una clave redonda de texto sin formato se produce en el m√≥dulo 2 <sup>32</sup> .  La adici√≥n de bits bajos afecta a los altos, a diferencia de XORa.  Al calcular cada subclave posterior, debe tener en cuenta los resultados del pasado.  Del mismo modo con llaves redondas.  Los datos son muy sensibles.  Si uno de los valores se calcula incorrectamente, el c√°lculo adicional de la clave completa ser√° incorrecto. </p><br><p>  Tambi√©n vale la pena considerar que ahora es bastante dif√≠cil encontrar un chip que tenga una arquitectura de cuatro bits: la mayor√≠a de los chips tienen ocho bits.  Por supuesto, hay chips criptogr√°ficos especializados que est√°n dise√±ados para un algoritmo de conversi√≥n de seguridad espec√≠fico (o varios algoritmos) y tienen la arquitectura m√°s eficiente. </p><br><p>  Para ejecutar el cifrado DES, dicho criptoprocesador puede tener una arquitectura de seis bits, para Magma, una de cuatro bits, que permite que cada S-box se procese por separado.  Mi dispositivo objetivo es de 8 bits, y en el caso de "Magma", la conversi√≥n se realizar√° en ocho bits en un enfoque, es decir.  el reemplazo se realizar√° en 2 S-box, se considerar√° el consumo de energ√≠a para 2 S-box.  Si una de las cajas S, senior o junior, coincide con la clave verdadera y la otra no coincide, pueden producirse r√°fagas de alta correlaci√≥n. </p><br><p>  Dado todo lo anterior, en la salida tenemos el siguiente script para el an√°lisis de las rutas de consumo de energ√≠a para el cifrado Magma: </p><br><div class="spoiler">  <b class="spoiler_title">Script de Python</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np path = <span class="hljs-string"><span class="hljs-string">r'C:\Users\user\chipwhisperer\projects\gost_10000_2_data\traces\2019.08.11-19.53.25_'</span></span> traces = np.load(path + <span class="hljs-string"><span class="hljs-string">'traces.npy'</span></span>) text = np.load(path + <span class="hljs-string"><span class="hljs-string">'textin.npy'</span></span>) keys = np.load(path + <span class="hljs-string"><span class="hljs-string">'keylist.npy'</span></span>) HW = [bin(n).count(<span class="hljs-string"><span class="hljs-string">"1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">256</span></span>)] SBOXES = {<span class="hljs-string"><span class="hljs-string">"Gost28147_tc26_ParamZ"</span></span>: ( (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>), (<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>), (<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>), (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), )} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_K</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s, _in)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" S-box substitution :param s: S-box :param _in: 32-bit word :returns: substituted 32-bit word """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( (s[<span class="hljs-number"><span class="hljs-number">0</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">1</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">2</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">3</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">12</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">4</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">5</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">20</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">20</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">6</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">7</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">28</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">28</span></span>) ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block2ns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Convert block to N1 and N2 integers """</span></span> data = bytearray(data) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( data[<span class="hljs-number"><span class="hljs-number">7</span></span>] | data[<span class="hljs-number"><span class="hljs-number">6</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span> | data[<span class="hljs-number"><span class="hljs-number">5</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span> | data[<span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span>, data[<span class="hljs-number"><span class="hljs-number">3</span></span>] | data[<span class="hljs-number"><span class="hljs-number">2</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span> | data[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span> | data[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span>, ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addmod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y, mod=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ** </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">32</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Modulo adding of two integers """</span></span> r = x + int(y) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r &lt; mod <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> r - mod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_shift11</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" 11-bit cyclic shift """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((x &lt;&lt; <span class="hljs-number"><span class="hljs-number">11</span></span>) &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">32</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>)) | ((x &gt;&gt; (<span class="hljs-number"><span class="hljs-number">32</span></span> - <span class="hljs-number"><span class="hljs-number">11</span></span>)) &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">32</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">round</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sbox, key, data, byte)</span></span></span><span class="hljs-function">:</span></span> s = SBOXES[sbox] _in = addmod(data, key) sbox_leak = _K(s, _in); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (sbox_leak &gt;&gt; (<span class="hljs-number"><span class="hljs-number">8</span></span> * byte)) &amp; <span class="hljs-number"><span class="hljs-number">0xFF</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Feistel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sbox, key, data, nround)</span></span></span><span class="hljs-function">:</span></span> s = SBOXES[sbox] w = bytearray(key) x = [ w[<span class="hljs-number"><span class="hljs-number">3</span></span> + i * <span class="hljs-number"><span class="hljs-number">4</span></span>] | w[<span class="hljs-number"><span class="hljs-number">2</span></span> + i * <span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span> | w[<span class="hljs-number"><span class="hljs-number">1</span></span> + i * <span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span> | w[<span class="hljs-number"><span class="hljs-number">0</span></span> + i * <span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">8</span></span>) ] n1, n2 = block2ns(data) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(nround): n1, n2 = _shift11(_K(s, addmod(n1, x[i]))) ^ n2, n1 <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n1 numtraces = len(traces) numpoint = np.shape(traces)[<span class="hljs-number"><span class="hljs-number">1</span></span>] bestguess = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">32</span></span> round_data = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * numtraces <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(numtraces): round_data[i] = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rnum <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>): best_round = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tnum_r <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(numtraces): round_data[tnum_r][rnum] = Feistel(<span class="hljs-string"><span class="hljs-string">"Gost28147_tc26_ParamZ"</span></span>, bestguess, text[tnum_r], rnum) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bnum <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): cpaoutput = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> maxcpa = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> kguess <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">256</span></span>): <span class="hljs-comment"><span class="hljs-comment">#Initialize arrays &amp; variables to zero best_round_key = kguess &lt;&lt; (bnum * 8) | best_round sumnum = np.zeros(numpoint) sumden1 = np.zeros(numpoint) sumden2 = np.zeros(numpoint) hyp = np.zeros(numtraces) for tnum in range(numtraces): hyp[tnum] = HW[round("Gost28147_tc26_ParamZ", best_round_key, round_data[tnum][rnum], bnum)] #Mean of hypothesis meanh = np.mean(hyp, dtype=np.float64) #Mean of all points in trace meant = np.mean(traces, axis=0, dtype=np.float64) #For each trace, do the following for tnum in range(0, numtraces): hdiff = (hyp[tnum] - meanh) tdiff = traces[tnum,:] - meant sumnum = sumnum + (hdiff*tdiff) sumden1 = sumden1 + hdiff*hdiff sumden2 = sumden2 + tdiff*tdiff cpaoutput[kguess] = sumnum / np.sqrt( sumden1 * sumden2 ) maxcpa[kguess] = max(abs(cpaoutput[kguess])) best_round = best_round | (np.argmax(maxcpa) &lt;&lt; (bnum * 8)) bestguess[((rnum + 1) * 4)-bnum - 1] = np.argmax(maxcpa) print "Best Key Guess: " for b in bestguess: print "%02x "%b,</span></span></code> </pre> </div></div><br><p>  <a href="https://github.com/rakf/ChipWhisperer/tree/master/GOST">Repositorio de resultados de GitHub</a> </p><br><h2 id="vyvody">  Conclusiones </h2><br><p>  Como parte del estudio, trabaj√© con ChipWhisperer.  A pesar de que no prob√© todas las herramientas (por ejemplo, fallas t√©cnicas), definitivamente encuentro √∫til ChipWhisperer, especialmente si no desea comprar hardware especial costoso. </p><br><p>  En cuanto al an√°lisis de nuestro cifrado para consumo de energ√≠a, es m√°s resistente a este ataque que los cifrados descritos anteriormente, pero con suficientes datos, la clave se puede obtener sin problemas. </p><br><p>  Materiales interesantes: </p><br><ul><li>  An√°lisis de potencia diferencial de P. Kocher </li><li>  "Ataques de an√°lisis de poder: revelando los secretos de las tarjetas inteligentes" </li><li>  <a href="https://xakep.ru/2015/01/29/crypto-i-keys/">Criptograf√≠a a punta de pistola I: buscando claves de algoritmos criptogr√°ficos</a> R. Korkikyan. </li><li>  <a href="https://xakep.ru/2015/01/27/kriptogry-191/">Criptograf√≠a a punta de pistola II: an√°lisis nutricional diferencial</a> R. Korkikyan. </li><li>  <a href="https://xakep.ru/2015/01/27/kriptogry-191/">Informe con ZeroNights 2014</a> R. Korkikyan. </li><li>  <a href="http://2014.zeronights.org/assets/files/slides/cryptocodingv2.pdf">cryptocoding v2</a> con ZeroNights 2014 sobre implementaci√≥n de software. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/477730/">https://habr.com/ru/post/477730/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../477716/index.html">Los matem√°ticos que usan el ejemplo de "etiqueta" calculan c√≥mo ocurre la aleatoriedad</a></li>
<li><a href="../477718/index.html">Capa convolucional: convoluci√≥n r√°pida seg√∫n el m√©todo de Shmuel Vinograd</a></li>
<li><a href="../477722/index.html">Gu√≠a de estilo de Google en C ++. Parte 8</a></li>
<li><a href="../477724/index.html">Seminario de marca de recursos humanos: sobre talentos, caza y contenido</a></li>
<li><a href="../477728/index.html">Qu√© hacer l√≠der del equipo para que el equipo no se agote</a></li>
<li><a href="../477732/index.html">Clasificaci√≥n incorrecta de los dedos de los sistemas de navegaci√≥n subacu√°tica</a></li>
<li><a href="../477734/index.html">Comprensi√≥n de UICollectionViewLayout con la aplicaci√≥n Fotos</a></li>
<li><a href="../477736/index.html">El camino del probador: del "freno de mano" a la automatizaci√≥n</a></li>
<li><a href="../477738/index.html">iKassa o c√≥mo domesticamos al "cajero digital"</a></li>
<li><a href="../477740/index.html">¬øY d√≥nde mirar este telescopio con tu ojo?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>