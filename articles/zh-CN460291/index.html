<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ»â€ğŸŒ¾ ğŸ’¹ ğŸ¥¢ è¯·æ±‚çš„æ‰¹å¤„ç†é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼ˆç¬¬1éƒ¨åˆ†ï¼‰ ğŸ’ªğŸ» ğŸ“€ ğŸ™…ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å‡ ä¹æ‰€æœ‰ç°ä»£è½¯ä»¶äº§å“éƒ½åŒ…å«å¤šç§æœåŠ¡ã€‚ é€šå¸¸ï¼Œè¾ƒé•¿çš„æœåŠ¡é—´é€šé“å“åº”æ—¶é—´ä¼šæˆä¸ºæ€§èƒ½é—®é¢˜çš„æ ¹æºã€‚ è§£å†³æ­¤ç±»é—®é¢˜çš„æ ‡å‡†æ–¹æ³•æ˜¯å°†å¤šä¸ªæœåŠ¡é—´è¯·æ±‚æ‰“åŒ…åˆ°ä¸€ä¸ªåŒ…ä¸­ï¼Œè¿™ç§°ä¸ºæ‰¹å¤„ç†ã€‚ 

 å¦‚æœä½¿ç”¨æ‰¹å¤„ç†ï¼Œåˆ™å¯èƒ½å¯¹æ€§èƒ½æˆ–ä»£ç å¯ç†è§£æ€§ä¸æ»¡æ„ã€‚ å¯¹äºå‘¼å«è€…æ¥è¯´ï¼Œæ­¤æ–¹æ³•å¹¶ä¸åƒæ‚¨æƒ³è±¡çš„é‚£ä¹ˆå®¹æ˜“ã€‚ å¯¹äºä¸åŒçš„ç›®çš„å’Œæƒ…å†µï¼Œå†³ç­–å¯èƒ½...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è¯·æ±‚çš„æ‰¹å¤„ç†é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼ˆç¬¬1éƒ¨åˆ†ï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/custis/blog/460291/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/0r/ap/sb0raprlu2jwllu3gasyznuom40.jpeg"></div> å‡ ä¹æ‰€æœ‰ç°ä»£è½¯ä»¶äº§å“éƒ½åŒ…å«å¤šç§æœåŠ¡ã€‚ é€šå¸¸ï¼Œè¾ƒé•¿çš„æœåŠ¡é—´é€šé“å“åº”æ—¶é—´ä¼šæˆä¸ºæ€§èƒ½é—®é¢˜çš„æ ¹æºã€‚ è§£å†³æ­¤ç±»é—®é¢˜çš„æ ‡å‡†æ–¹æ³•æ˜¯å°†å¤šä¸ªæœåŠ¡é—´è¯·æ±‚æ‰“åŒ…åˆ°ä¸€ä¸ªåŒ…ä¸­ï¼Œè¿™ç§°ä¸ºæ‰¹å¤„ç†ã€‚ <br><br> å¦‚æœä½¿ç”¨æ‰¹å¤„ç†ï¼Œåˆ™å¯èƒ½å¯¹æ€§èƒ½æˆ–ä»£ç å¯ç†è§£æ€§ä¸æ»¡æ„ã€‚ å¯¹äºå‘¼å«è€…æ¥è¯´ï¼Œæ­¤æ–¹æ³•å¹¶ä¸åƒæ‚¨æƒ³è±¡çš„é‚£ä¹ˆå®¹æ˜“ã€‚ å¯¹äºä¸åŒçš„ç›®çš„å’Œæƒ…å†µï¼Œå†³ç­–å¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„ä¸åŒã€‚ åœ¨å…·ä½“ç¤ºä¾‹ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå‡ ç§æ–¹æ³•çš„åˆ©å¼Šã€‚ <br><a name="habracut"></a><br><h2> ç¤ºèŒƒé¡¹ç›® </h2><br> ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œè¯·è€ƒè™‘æˆ‘å½“å‰æ­£åœ¨å¤„ç†çš„åº”ç”¨ç¨‹åºä¸­çš„ä¸€é¡¹æœåŠ¡çš„ç¤ºä¾‹ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æœ‰å…³ç¤ºä¾‹å¹³å°é€‰æ‹©çš„è¯´æ˜</b> <div class="spoiler_text"> æ€§èƒ½ä¸ä½³çš„é—®é¢˜éå¸¸æ™®éï¼Œä¸é€‚ç”¨äºä»»ä½•ç‰¹å®šçš„è¯­è¨€å’Œå¹³å°ã€‚ æœ¬æ–‡å°†ä½¿ç”¨Spring + Kotlinä»£ç ç¤ºä¾‹æ¥æ¼”ç¤ºä»»åŠ¡å’Œè§£å†³æ–¹æ¡ˆã€‚  Kotlinå¯¹Javaå’ŒCï¼ƒå¼€å‘äººå‘˜åŒæ ·å¯ä»¥ç†è§£ï¼ˆæˆ–éš¾ä»¥ç†è§£ï¼‰ï¼Œæ­¤å¤–ï¼Œä¸Javaç›¸æ¯”ï¼Œä»£ç æ›´ç´§å‡‘ï¼Œæ›´æ˜“äºç†è§£ã€‚ ä¸ºäº†ä¿ƒè¿›å¯¹çº¯Javaå¼€å‘äººå‘˜çš„ç†è§£ï¼Œæˆ‘å°†é¿å…Kotliné»‘é­”æ³•ï¼Œè€Œåªä½¿ç”¨ç™½è‰²ï¼ˆæŒ‰ç…§Lombokçš„ç²¾ç¥ï¼‰ã€‚ å°†ä¼šæœ‰ä¸€äº›æ‰©å±•æ–¹æ³•ï¼Œä½†æ˜¯å®é™…ä¸Šæ‰€æœ‰Javaç¨‹åºå‘˜éƒ½å°†å®ƒä»¬ç§°ä¸ºé™æ€æ–¹æ³•ï¼Œå› æ­¤è¿™å°†æ˜¯ä¸€ç‚¹ç‚¹ç³–ï¼Œå¹¶ä¸”ä¸ä¼šç ´åèœçš„å‘³é“ã€‚ </div></div><br> æœ‰æ–‡ä»¶æ‰¹å‡†æœåŠ¡ã€‚ æœ‰äººåˆ›å»ºä¸€ä¸ªæ–‡æ¡£å¹¶å°†å…¶æäº¤è¿›è¡Œè®¨è®ºï¼Œç„¶åè¿›è¡Œç¼–è¾‘ï¼Œæœ€ç»ˆä½¿æ–‡æ¡£ä¿æŒä¸€è‡´ã€‚ åè°ƒæœåŠ¡æœ¬èº«å¯¹æ–‡ä»¶ä¸€æ— æ‰€çŸ¥ï¼šå®ƒåªæ˜¯åè°ƒå‘˜çš„èŠå¤©ï¼Œå¸¦æœ‰ä¸€äº›é™„åŠ åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¸äºˆè€ƒè™‘ã€‚ <br><br> å› æ­¤ï¼Œå­˜åœ¨èŠå¤©å®¤ï¼ˆå¯¹åº”äºæ–‡æ¡£ï¼‰ï¼Œæ¯ä¸ªèŠå¤©å®¤ä¸­éƒ½æœ‰ä¸€ç»„é¢„å®šä¹‰çš„å‚ä¸è€…ã€‚ ä¸å¸¸è§„èŠå¤©ä¸€æ ·ï¼Œæ¶ˆæ¯åŒ…å«æ–‡æœ¬å’Œæ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥ä½œä¸ºç­”å¤å’Œè½¬å‘ï¼š <br><br> <code><font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="3f7f5f">// nullable      persist <br></font> <font color="3f7f5f">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>Long</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">author</font> : <font color="3e7eff"><b>UserReference</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**  */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">message</font> : <font color="3e7eff"><b>String</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="3f7f5f">// -   JPA+    null,    <br></font> <font color="3f7f5f">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">files</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">&gt;</font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">replyTo</font> : <font color="3e7eff"><b>ChatMessage</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">forwardFrom</font> : <font color="3e7eff"><b>ChatMessage</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null <br></b></font> <font color="000066">)</font></code> <br> <br> æŒ‡å‘æ–‡ä»¶å’Œç”¨æˆ·çš„é“¾æ¥æ˜¯æŒ‡å‘å…¶ä»–åŸŸçš„é“¾æ¥ã€‚ å®ƒåƒè¿™æ ·ä¸æˆ‘ä»¬ä¸€èµ·ç”Ÿæ´»ï¼š <br><br> <code><font color="7f0055"><b>typealias</b></font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">=</font> <font color="3e7eff"><b>Long <br></b></font> <font color="7f0055"><b>typealias</b></font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">=</font> <font color="3e7eff"><b>Long <br></b></font></code> <br> ç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨Keycloakä¸­ï¼Œå¹¶é€šè¿‡RESTæ£€ç´¢ã€‚ æ–‡ä»¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼šæ–‡ä»¶å’Œæœ‰å…³å®ƒä»¬çš„å…ƒä¿¡æ¯ä½äºå•ç‹¬çš„æ–‡ä»¶å­˜å‚¨æœåŠ¡ä¸­ã€‚ <br><br> å¯¹è¿™äº›æœåŠ¡çš„æ‰€æœ‰å‘¼å«éƒ½æ˜¯<strong>ç¹é‡çš„è¯·æ±‚</strong> ã€‚ è¿™æ„å‘³ç€ä¼ è¾“è¿™äº›è¯·æ±‚çš„å¼€é”€è¿œè¿œå¤§äºç¬¬ä¸‰æ–¹æœåŠ¡å¤„ç†è¿™äº›è¯·æ±‚æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚ åœ¨æˆ‘ä»¬çš„æµ‹è¯•å°ä¸Šï¼Œæ­¤ç±»æœåŠ¡çš„å…¸å‹å‘¼å«æ—¶é—´ä¸º100æ¯«ç§’ï¼Œå› æ­¤å°†æ¥æˆ‘ä»¬å°†ä½¿ç”¨è¿™äº›æ•°å­—ã€‚ <br><br> æˆ‘ä»¬éœ€è¦åˆ¶ä½œä¸€ä¸ªç®€å•çš„RESTæ§åˆ¶å™¨ï¼Œä»¥æ¥æ”¶åŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯çš„æœ€åNæ¡æ¶ˆæ¯ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è®¤ä¸ºåœ¨å‰ç«¯ï¼Œæ¶ˆæ¯æ¨¡å‹å‡ ä¹ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å‘é€æ‰€æœ‰æ•°æ®ã€‚ å‰ç«¯æ¨¡å‹ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼Œæ–‡ä»¶å’Œç”¨æˆ·éœ€è¦ä»¥ç•¥å¾®è§£å¯†çš„å½¢å¼æ˜¾ç¤ºä»¥ä½¿å…¶é“¾æ¥ï¼š <br><br> <code><font color="395da1">/**          */ <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>ReferenceUI</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="395da1">/**   url */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">ref</font> : <font color="3e7eff"><b>String</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">name</font> : <font color="3e7eff"><b>String <br></b></font> <font color="000066">) <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>Long</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">author</font> : <font color="3e7eff"><b>ReferenceUI</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**  */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">message</font> : <font color="3e7eff"><b>String</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**    */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">files</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>ReferenceUI</b></font> <font color="333333">&gt;, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">replyTo</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="395da1">/**   ,     */ <br></font> <font color="395da1">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">forwardFrom</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> ? <font color="333333">=</font> <font color="7f0055"><b>null <br></b></font> <font color="000066">)</font></code> <br> <br> æˆ‘ä»¬éœ€è¦å®ç°ä»¥ä¸‹å†…å®¹ï¼š <br><br> <code><font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>ChatRestApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">&gt; <br></font> <font color="000066">}</font></code> <br> <br>  Postfix UIæ„å‘³ç€å‰ç«¯çš„DTOæ¨¡å‹ï¼Œå³æˆ‘ä»¬å¿…é¡»é€šè¿‡RESTæä¾›çš„æ¨¡å‹ã€‚ <br><br> åœ¨è¿™é‡Œæˆ‘ä»¬ä¼¼ä¹æ²¡æœ‰ä¼ é€’ä»»ä½•èŠå¤©æ ‡è¯†ç¬¦ï¼Œç”šè‡³åœ¨ChatMessage / ChatMessageUIæ¨¡å‹ä¸­ä¹Ÿæ²¡æœ‰ä¼ é€’ä»»ä½•èŠå¤©æ ‡è¯†ç¬¦ï¼Œè¿™ä¼¼ä¹ä»¤äººæƒŠè®¶ã€‚ æˆ‘è¿™æ ·åšæ˜¯æœ‰æ„çš„ï¼Œä»¥å…å¼„ä¹±ç¤ºä¾‹çš„ä»£ç ï¼ˆèŠå¤©æ˜¯å­¤ç«‹çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å‡è®¾æˆ‘ä»¬åªæœ‰ä¸€ä¸ªï¼‰ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å“²å­¦é™ä¿®</b> <div class="spoiler_text">  ChatMessageUIç±»å’ŒChatRestApi.getLastæ–¹æ³•éƒ½ä½¿ç”¨Listæ•°æ®ç±»å‹ï¼Œè€Œå®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªæœ‰åºSetã€‚ åœ¨JDKä¸­ï¼Œè¿™éƒ½æ˜¯ä¸å¥½çš„äº‹æƒ…ï¼Œå› æ­¤åœ¨æ¥å£çº§åˆ«å£°æ˜å…ƒç´ çš„é¡ºåºï¼ˆæ·»åŠ å’Œæå–æ—¶ä¿æŒé¡ºåºï¼‰å°†å¤±è´¥ã€‚ å› æ­¤ï¼Œåœ¨éœ€è¦æœ‰åºSetçš„æƒ…å†µä¸‹ï¼ˆä»ç„¶æœ‰LinkedHashSetï¼Œä½†è¿™ä¸æ˜¯æ¥å£ï¼‰ï¼Œé€šå¸¸ä½¿ç”¨Listã€‚ </div></div><br>  <b>ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼š</b>æˆ‘ä»¬å‡è®¾æ²¡æœ‰é•¿ä¹…çš„å“åº”æˆ–è½¬å‘é“¾ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬æ˜¯ï¼Œä½†æ˜¯å®ƒä»¬çš„é•¿åº¦ä¸è¶…è¿‡ä¸‰ä¸ªæ¶ˆæ¯ã€‚ å‰ç«¯æ¶ˆæ¯é“¾å¿…é¡»å®Œæ•´ä¼ è¾“ã€‚ <br><br> è¦ä»å¤–éƒ¨æœåŠ¡æ¥æ”¶æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹APIï¼š <br><br> <code><font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>ChatMessageRepository</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>findLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">&gt; <br></font> <font color="000066">} <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>FileReference</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">name</font> : <font color="3e7eff"><b>String <br></b></font> <font color="000066">) <br></font> <font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>FileRemoteApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadById</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>FileReference</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>FileHeadRemote <br></b></font> <font color="3e7eff"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadsByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="333333">&gt; <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadsByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="333333">&gt; <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getHeadsByChat</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>FileHeadRemote</b></font> <font color="333333">&gt; <br></font> <font color="000066">} <br></font> <font color="7f0055"><b>data class</b></font> <font color="3e7eff"><b>UserRemote</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">id</font> : <font color="3e7eff"><b>UserReference</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>val</b></font> <font color="566874">name</font> : <font color="3e7eff"><b>String <br></b></font> <font color="000066">) <br></font> <font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>UserRemoteApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUserById</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>UserReference</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>UserRemote <br></b></font> <font color="3e7eff"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; <br></font> <font color="000066">}</font></code> <br> <br> å¯ä»¥çœ‹å‡ºï¼Œæ‰¹å¤„ç†æœ€åˆæ˜¯åœ¨å¤–éƒ¨æœåŠ¡ä¸­æä¾›çš„ï¼Œåœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼šé€šè¿‡Setï¼ˆä¸ä¿ç•™å…ƒç´ çš„é¡ºåºï¼Œä½¿ç”¨å”¯ä¸€é”®ï¼‰å’Œé€šè¿‡Listï¼ˆå¯èƒ½æœ‰é‡å¤é¡¹-ä¿ç•™äº†é¡ºåºï¼‰ã€‚ <br><br><h2> ç®€å•çš„å®ç° </h2><br><h4> å¤©çœŸçš„å®ç° </h4><br> åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„RESTæ§åˆ¶å™¨çš„ç¬¬ä¸€ä¸ªå¤©çœŸçš„å®ç°å°†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br> <code><font color="7f0055"><b>class</b></font> <font color="3e7eff"><b>ChatRestController</b></font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>private val</b></font> <font color="566874">messageRepository</font> : <font color="3e7eff"><b>ChatMessageRepository</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>private val</b></font> <font color="566874">userRepository</font> : <font color="3e7eff"><b>UserRemoteApi</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="7f0055"><b>private val</b></font> <font color="566874">fileRepository</font> : <font color="3e7eff"><b>FileRemoteApi <br></b></font> <font color="000066">)</font> : <font color="3e7eff"><b>ChatRestApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>override fun</b></font> <font color="170591"><b>getLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="566874">messageRepository</font> <font color="333333">.</font> <font color="170591">findLast</font> <font color="000066">(</font> <font color="000066"><i>n</i></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <font color="000066"><i>it</i></font> <font color="333333">.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b><br></b></font> <font color="000066"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>private fun</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">.</font> <font color="170591"><b>toFrontModel</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="170591">ChatMessageUI</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">id =</font> <font color="566874">id</font> ?: <font color="7f0055"><b>throw</b></font> <font color="170591">IllegalStateException</font> <font color="000066">(</font> <b>"</b> <font color="333333"><b>$</b></font> <font color="7f0055"><b>this</b></font> <b>must be persisted"</b> <font color="000066">)</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">author =</font> <font color="566874">userRepository</font> <font color="333333">.</font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="566874">author</font> <font color="000066">)</font> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">message =</font> <font color="566874">message</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">files =</font> <font color="566874">files</font> <font color="333333">?.</font> <i><b>let</b></i> <font color="000066"><b>{</b></font> <font color="000066"><i>files</i></font> <font color="000066"><b>-&gt; <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="566874">fileRepository</font> <font color="333333">.</font> <font color="170591">getHeadsByIds</font> <font color="000066">(</font> <font color="000066"><i>files</i></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>}</b></font> ?: <i><b>listOf</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">forwardFrom =</font> <font color="566874">forwardFrom</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">replyTo =</font> <font color="566874">replyTo</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">() <br></font> <font color="000066">) <br></font> <font color="000066">} <br></font></code> <br> ä¸€åˆ‡éƒ½éå¸¸æ¸…æ¥šï¼Œè¿™æ˜¯ä¸€å¤§ä¼˜ç‚¹ã€‚ <br><br> æˆ‘ä»¬ä½¿ç”¨æ‰¹å¤„ç†ï¼Œå¹¶æ‰¹é‡æ¥æ”¶æ¥è‡ªå¤–éƒ¨æœåŠ¡çš„æ•°æ®ã€‚ ä½†æ˜¯æ€§èƒ½å¦‚ä½•ï¼Ÿ <br><br> å¯¹äºæ¯æ¡æ¶ˆæ¯ï¼Œå°†å¯¹UserRemoteApiè¿›è¡Œä¸€æ¬¡è°ƒç”¨ä»¥è·å–ä½œè€…å­—æ®µä¸­çš„æ•°æ®ï¼Œè€Œå¯¹FileRemoteApiè¿›è¡Œä¸€æ¬¡è°ƒç”¨ä»¥æ¥æ”¶æ‰€æœ‰é™„ä»¶ã€‚ ä¼¼ä¹å…¨éƒ¨ã€‚ å‡å®šå·²è·å–ChatMessageçš„forwardFromå’ŒReplyToå­—æ®µï¼Œå› æ­¤ä¸éœ€è¦é¢å¤–çš„è°ƒç”¨ã€‚ ä½†æ˜¯å°†å®ƒä»¬è½¬æ¢ä¸ºChatMessageUIå°†å¯¼è‡´é€’å½’ï¼Œå³å‘¼å«è®¡æ•°çš„æ€§èƒ½å¯ä»¥å¤§å¤§æé«˜ã€‚ æ­£å¦‚æˆ‘ä»¬å‰é¢æåˆ°çš„ï¼Œå‡è®¾æˆ‘ä»¬æ²¡æœ‰å¤ªå¤šçš„åµŒå¥—ï¼Œå¹¶ä¸”é“¾æ¡ä»…é™äºä¸‰å°é‚®ä»¶ã€‚ <br><br> ç»“æœï¼Œæ¯ä¸ªæ¶ˆæ¯ä»ä¸¤ä¸ªåˆ°å…­ä¸ªå¤–éƒ¨æœåŠ¡è°ƒç”¨ï¼Œåˆ°æ•´ä¸ªæ¶ˆæ¯åŒ…çš„ä¸€ä¸ªJPAè°ƒç”¨ã€‚ é€šè¯æ€»æ•°ä»2 * N +1åˆ°6 * N +1ã€‚ å®é™…å•ä½æ˜¯å¤šå°‘ï¼Ÿ å‡è®¾æ‚¨éœ€è¦20ä¸ªå¸–å­æ‰èƒ½å‘ˆç°ä¸€ä¸ªé¡µé¢ã€‚ è¦è·å¾—å®ƒä»¬ï¼Œæ‚¨éœ€è¦4åˆ°10 sã€‚ ç³Ÿé€äº† æˆ‘æƒ³æ»¡è¶³500æ¯«ç§’ã€‚ å¹¶ä¸”ç”±äºå‰ç«¯æ¢¦æƒ³å®ç°æ— ç¼æ»šåŠ¨ï¼Œå› æ­¤è¯¥ç«¯ç‚¹çš„æ€§èƒ½è¦æ±‚å¯ä»¥æé«˜ä¸€å€ã€‚ <br><br>  <b>ä¼˜ç‚¹ï¼š</b> <br><br><ol><li> è¯¥ä»£ç ç®€æ´æ˜äº†ä¸”å…·æœ‰è‡ªæˆ‘è®°å½•åŠŸèƒ½ï¼ˆæ”¯æŒè€…çš„æ¢¦æƒ³ï¼‰ã€‚ </li><li> ä»£ç å¾ˆç®€å•ï¼Œå› æ­¤å‡ ä¹æ²¡æœ‰æœºä¼šå‡ºæ‰‹ã€‚ </li><li> æ‰¹å¤„ç†çœ‹èµ·æ¥å¹¶ä¸é™Œç”Ÿï¼Œå¹¶ä¸”æœ‰æœºåœ°é€‚åˆé€»è¾‘ã€‚ </li><li> é€»è¾‘æ›´æ”¹å°†å¾ˆå®¹æ˜“è¿›è¡Œï¼Œå¹¶ä¸”å°†æ˜¯æœ¬åœ°çš„ã€‚ </li></ol><br>  <b>å‡å·ï¼š</b> <br><br> ç”±äºåŒ…è£…å¾ˆå°ï¼Œå› æ­¤æ€§èƒ½å¾ˆå·®ã€‚ <br><br> è¿™ç§æ–¹æ³•é€šå¸¸å¯ä»¥åœ¨ç®€å•çš„æœåŠ¡æˆ–åŸå‹ä¸­çœ‹åˆ°ã€‚ å¦‚æœå˜æ›´çš„é€Ÿåº¦å¾ˆé‡è¦ï¼Œåˆ™å‡ ä¹ä¸å€¼å¾—ä½¿ç³»ç»Ÿå¤æ‚åŒ–ã€‚ åŒæ—¶ï¼Œç”±äºæˆ‘ä»¬çš„æœåŠ¡éå¸¸ç®€å•ï¼Œå› æ­¤æ€§èƒ½å¾ˆå·®ï¼Œå› æ­¤è¿™ç§æ–¹æ³•çš„é€‚ç”¨èŒƒå›´éå¸¸ç‹­çª„ã€‚ <br><br><h4> å¤©çœŸçš„å¹¶è¡Œå¤„ç† </h4><br> æ‚¨å¯ä»¥å¼€å§‹å¹¶è¡Œå¤„ç†æ‰€æœ‰æ¶ˆæ¯-è¿™å°†æ¶ˆé™¤æ—¶é—´çš„çº¿æ€§å¢é•¿ï¼Œå…·ä½“å–å†³äºæ¶ˆæ¯çš„æ•°é‡ã€‚ è¿™ä¸æ˜¯ä¸€ä¸ªç‰¹åˆ«å¥½çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´å¤–éƒ¨æœåŠ¡ä¸Šçš„è¾ƒå¤§å³°å€¼è´Ÿè½½ã€‚ <br><br> å®ç°å¹¶è¡Œå¤„ç†éå¸¸ç®€å•ï¼š <br><br> <code><font color="7f0055"><b>override fun</b></font> <font color="170591"><b>getLast</b></font> <font color="000066">(</font> <font color="000066"><i>n</i></font> : <font color="3e7eff"><b>Int</b></font> <font color="000066">)</font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="566874">messageRepository</font> <font color="333333">.</font> <font color="170591">findLast</font> <font color="000066">(</font> <font color="000066"><i>n</i></font> <font color="000066">)</font> <font color="333333">.</font> <font color="170591">parallelStream</font> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <font color="170591">map</font> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="333333">.</font> <font color="170591">collect</font> <font color="000066">(</font> <font color="170591">toList</font> <font color="000066">())</font></code> <br> <br> ä½¿ç”¨å¹¶è¡Œæ¶ˆæ¯å¤„ç†ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—300-700 msï¼Œè¿™æ¯”å•çº¯çš„å®ç°è¦å¥½å¾—å¤šï¼Œä½†ä»ç„¶ä¸å¤Ÿå¿«ã€‚ <br><br> ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå¯¹userRepositoryå’ŒfileRepositoryçš„è¯·æ±‚å°†åŒæ­¥æ‰§è¡Œï¼Œè¿™ä¸æ˜¯å¾ˆæœ‰æ•ˆã€‚ è¦è§£å†³æ­¤é—®é¢˜ï¼Œæ‚¨å°†ä¸å¾—ä¸å¤§é‡æ›´æ”¹è°ƒç”¨é€»è¾‘ã€‚ ä¾‹å¦‚ï¼Œé€šè¿‡CompletionStageï¼ˆåˆåCompletableFutureï¼‰ï¼š <br><br> <code><font color="7f0055"><b>private fun</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">.</font> <font color="170591"><b>toFrontModel</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <font color="3e7eff"><b>CompletableFuture</b></font> <font color="333333">.</font> <font color="170591">supplyAsync</font> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="566874">userRepository</font> <font color="333333">.</font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="566874">author</font> <font color="000066">)</font> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">thenCombine</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="566874">files</font> <font color="333333">?.</font> <i><b>let</b></i> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="3e7eff"><b>CompletableFuture</b></font> <font color="333333">.</font> <font color="170591">supplyAsync</font> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="566874">fileRepository</font> <font color="333333">.</font> <font color="170591">getHeadsByIds</font> <font color="000066">(</font> files <font color="000066">)</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>}</b></font> ?: <font color="3e7eff"><b>CompletableFuture</b></font> <font color="333333">.</font> <font color="170591">completedFuture</font> <font color="000066">(</font> <i><b>listOf</b></i> <font color="000066">()) <br></font> <font color="000066">)</font> <font color="000066"><b>{</b></font> <font color="000066"><i>author</i></font> <font color="333333">,</font> <font color="000066"><i>files</i></font> <font color="000066"><b>-&gt; <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="170591">ChatMessageUI</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">id =</font> <font color="566874">id</font> ?: <font color="7f0055"><b>throw</b></font> <font color="170591">IllegalStateException</font> <font color="000066">(</font> <b>"</b> <font color="333333"><b>$</b></font> <font color="7f0055"><b>this</b></font> <b>must be persisted"</b> <font color="000066">)</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">author =</font> <font color="000066"><i>author</i></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">message =</font> <font color="566874">message</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">files =</font> <font color="000066"><i>files</i></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">forwardFrom =</font> <font color="566874">forwardFrom</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">replyTo =</font> <font color="566874">replyTo</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">() <br></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">get</font> <font color="000066">()</font> <font color="333333">!!</font></code> <br> <br> å¯ä»¥çœ‹å‡ºï¼Œæœ€åˆç®€å•çš„æ˜ å°„ä»£ç å˜å¾—ä¸å¤ªæ¸…æ¥šã€‚ è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¿…é¡»å°†å¤–éƒ¨æœåŠ¡è°ƒç”¨ä¸ä½¿ç”¨ç»“æœçš„ä½ç½®åˆ†å¼€ã€‚ è¿™æœ¬èº«è¿˜ä¸é”™ã€‚ ä½†æ˜¯è°ƒç”¨çš„ç»„åˆçœ‹èµ·æ¥å¹¶ä¸ä¼˜é›…ï¼Œç±»ä¼¼äºå…¸å‹çš„å“åº”å¼â€œé¢æ¡â€ã€‚ <br><br> å¦‚æœæ‚¨ä½¿ç”¨åç¨‹ï¼Œä¸€åˆ‡çœ‹èµ·æ¥ä¼šæ›´åŠ ä½“é¢ï¼š <br><br> <code><font color="7f0055"><b>private fun</b></font> <font color="3e7eff"><b>ChatMessage</b></font> <font color="333333">.</font> <font color="170591"><b>toFrontModel</b></font> <font color="000066">()</font> : <font color="3e7eff"><b>ChatMessageUI</b></font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <i><b>join</b></i> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><b>{</b></font> <font color="566874">userRepository</font> <font color="333333">.</font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="566874">author</font> <font color="000066">)</font> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>}</b></font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><b>{</b></font> <font color="566874">files</font> <font color="333333">?.</font> <i><b>let</b></i> <font color="000066"><b>{</b></font> <font color="566874">fileRepository</font> <font color="333333">.</font> <font color="170591">getHeadsByIds</font> <font color="000066">(</font> files <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <i><b>map</b></i> <font color="000066"><b>{</b></font> <b>it</b> <font color="333333">.</font> <i><b>toFrontReference</b></i> <font color="000066">()</font> <font color="000066"><b>} }</b></font> ?: <i><b>listOf</b></i> <font color="000066">()</font> <font color="000066"><b>} <br></b></font> <font color="000066"><b>&nbsp;&nbsp;</b></font> <font color="000066">)</font> <font color="333333">.</font> <i><b>let</b></i> <font color="000066"><b>{</b></font> <font color="000066">(</font> <font color="170591">author</font> <font color="333333">,</font> <font color="170591">files</font> <font color="000066">)</font> <font color="000066"><b>-&gt; <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="170591">ChatMessageUI</font> <font color="000066">( <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">id =</font> <font color="566874">id</font> ?: <font color="7f0055"><b>throw</b></font> <font color="170591">IllegalStateException</font> <font color="000066">(</font> <b>"</b> <font color="333333"><b>$</b></font> <font color="7f0055"><b>this</b></font> <b>must be persisted"</b> <font color="000066">)</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">author =</font> <font color="170591">author</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">message =</font> <font color="566874">message</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">files =</font> <font color="170591">files</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">forwardFrom =</font> <font color="566874">forwardFrom</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">()</font> <font color="333333">, <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="4a86e8">replyTo =</font> <font color="566874">replyTo</font> <font color="333333">?.</font> <i><b>toFrontModel</b></i> <font color="000066">() <br></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font></code> <br> <br> å…¶ä¸­ï¼š <br><br> <code><font color="7f0055"><b>fun</b></font> <font color="333333">&lt;</font> <font color="000066"><i>A</i></font> <font color="333333">,</font> <font color="000066"><i>B</i></font> <font color="333333">&gt;</font> <font color="170591"><b>join</b></font> <font color="000066">(</font> <font color="000066"><i>a</i></font> : <font color="000066">() -&gt;</font> <font color="000066"><i>A</i></font> <font color="333333">,</font> <font color="000066"><i>b</i></font> : <font color="000066">() -&gt;</font> <font color="000066"><i>B</i></font> <font color="000066">)</font> <font color="333333">= <br></font> <font color="333333">&nbsp;&nbsp;</font> <i><b>runBlocking</b></i> <font color="000066">(</font> <font color="05314d"><b>IO</b></font> <font color="000066">)</font> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <i><b>awaitAll</b></i> <font color="000066">(</font> <i><b>async</b></i> <font color="000066"><b>{</b></font> <font color="3e7eff"><b>a</b></font> <font color="000066">()</font> <font color="000066"><b>}</b></font> <font color="333333">,</font> <i><b>async</b></i> <font color="000066"><b>{</b></font> <font color="3e7eff"><b>b</b></font> <font color="000066">()</font> <font color="000066"><b>}</b></font> <font color="000066">) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <i><b>let</b></i> <font color="000066"><b>{ <br></b></font> <font color="000066"><b>&nbsp;&nbsp;&nbsp;&nbsp;</b></font> <font color="000066"><i>it</i></font> <font color="000066">[</font> <font color="333333"><b>0</b></font> <font color="000066">]</font> <font color="7f0055"><b>as</b></font> <font color="000066"><i>A</i></font> <i><b>to</b></i> <font color="000066"><i>it</i></font> <font color="000066">[</font> <font color="333333"><b>1</b></font> <font color="000066">]</font> <font color="7f0055"><b>as</b></font> <font color="000066"><i>B <br></i></font> <font color="000066"><i>&nbsp;&nbsp;</i></font> <font color="000066"><b>}</b></font></code> <br> <br> ä»ç†è®ºä¸Šè®²ï¼Œä½¿ç”¨è¿™ç§å¹¶è¡Œå¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°200-400æ¯«ç§’ï¼Œè¿™å·²ç»æ¥è¿‘æˆ‘ä»¬çš„é¢„æœŸã€‚ <br><br> ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§è‰¯å¥½çš„å¹¶è¡ŒåŒ–å¹¶æ²¡æœ‰å‘ç”Ÿï¼Œå¹¶ä¸”å›æŠ¥éå¸¸æ®‹é…·ï¼šåªæœ‰å°‘æ•°ç”¨æˆ·åŒæ—¶å·¥ä½œæ—¶ï¼ŒæœåŠ¡ä¸Šä¼šå‡ºç°å¤§é‡è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚ä»ç„¶ä¸ä¼šå¹¶è¡Œå¤„ç†ï¼Œå› æ­¤æˆ‘ä»¬å°†è¿”å›4sã€‚ <br><br> ä½¿ç”¨è¿™ç§æœåŠ¡æ—¶ï¼Œæˆ‘çš„ç»“æœæ˜¯å¤„ç†20æ¡æ¶ˆæ¯çš„æ—¶é—´ä¸º1300-1700æ¯«ç§’ã€‚ è¿™æ¯”ç¬¬ä¸€ä¸ªå®ç°è¦å¿«ï¼Œä½†æ˜¯ä»ç„¶ä¸èƒ½è§£å†³é—®é¢˜ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å¹¶è¡ŒæŸ¥è¯¢çš„æ›¿ä»£ç”¨æ³•</b> <div class="spoiler_text"> å¦‚æœç¬¬ä¸‰æ–¹æœåŠ¡æœªæä¾›æ‰¹å¤„ç†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥éšè—æ¥å£æ–¹æ³•å†…éƒ¨ç¼ºå°‘æ‰¹å¤„ç†çš„å®ç°ï¼š <br><br> <code><font color="7f0055"><b>interface</b></font> <font color="3e7eff"><b>UserRemoteApi</b></font> <font color="000066">{ <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUserById</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>UserReference</b></font> <font color="000066">)</font> : <font color="3e7eff"><b>UserRemote <br></b></font> <font color="3e7eff"><b>&nbsp;&nbsp;</b></font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>Set</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; = <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><i>id</i></font> <font color="333333">.</font> <font color="170591">parallelStream</font> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <font color="170591">map</font> <font color="000066"><b>{</b></font> <font color="170591">getUserById</font> <font color="000066">(</font> <b>it</b> <font color="000066">)</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">collect</font> <font color="000066">(</font> <font color="170591">toSet</font> <font color="000066">()) <br></font> <font color="000066">&nbsp;&nbsp;</font> <font color="7f0055"><b>fun</b></font> <font color="170591"><b>getUsersByIds</b></font> <font color="000066">(</font> <font color="000066"><i>id</i></font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserReference</b></font> <font color="333333">&gt;</font> <font color="000066">)</font> : <font color="3e7eff"><b>List</b></font> <font color="333333">&lt;</font> <font color="3e7eff"><b>UserRemote</b></font> <font color="333333">&gt; = <br></font> <font color="333333">&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="000066"><i>id</i></font> <font color="333333">.</font> <font color="170591">parallelStream</font> <font color="000066">() <br></font> <font color="000066">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font> <font color="333333">.</font> <font color="170591">map</font> <font color="000066"><b>{</b></font> <font color="170591">getUserById</font> <font color="000066">(</font> <font color="000066"><i>it</i></font> <font color="000066">)</font> <font color="000066"><b>}</b></font> <font color="333333">.</font> <font color="170591">collect</font> <font color="000066">(</font> <font color="170591">toList</font> <font color="000066">()) <br></font> <font color="000066">}</font></code> <br> <br> å¦‚æœå¸Œæœ›æ‰¹å¤„ç†å°†åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å‡ºç°ï¼Œè¿™æ˜¯æœ‰é“ç†çš„ã€‚ </div></div><br>  <b>ä¼˜ç‚¹ï¼š</b> <br><br><ol><li> è½»æ¾å®ç°å¹¶å‘æ¶ˆæ¯å¤„ç†ã€‚ </li><li> è‰¯å¥½çš„å¯æ‰©å±•æ€§ã€‚ </li></ol><br>  <b>ç¼ºç‚¹ï¼š</b> <br><br><ol><li> éœ€è¦åœ¨å¯¹ä¸åŒæœåŠ¡çš„å¹¶è¡Œå¤„ç†è¯·æ±‚ä¸­å°†æ•°æ®çš„æ¥æ”¶ä¸å…¶å¤„ç†åˆ†å¼€ã€‚ </li><li> ç¬¬ä¸‰æ–¹æœåŠ¡çš„è´Ÿè½½å¢åŠ ã€‚ </li></ol><br> å¯ä»¥çœ‹å‡ºï¼Œé€‚ç”¨èŒƒå›´ä¸å¹¼ç¨šæ–¹æ³•å¤§è‡´ç›¸åŒã€‚ å¦‚æœç”±äºä»–äººçš„æ— æƒ…åˆ©ç”¨è€Œæƒ³è¦å¤šæ¬¡æé«˜æœåŠ¡æ€§èƒ½ï¼Œåˆ™ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢æ–¹æ³•æ‰æœ‰æ„ä¹‰ã€‚ åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œç”Ÿäº§ç‡æé«˜äº†2.5å€ï¼Œä½†è¿™æ˜¾ç„¶æ˜¯ä¸å¤Ÿçš„ã€‚ <br><br><h4> å¿«å– </h4><br> æ‚¨å¯ä»¥ä¸ºå¤–éƒ¨æœåŠ¡æ‰§è¡ŒJPAæ ·å¼çš„ç¼“å­˜ï¼Œå³åœ¨ä¼šè¯ä¸­å­˜å‚¨æ¥æ”¶åˆ°çš„å¯¹è±¡ï¼Œä»¥å…å†æ¬¡æ¥æ”¶åˆ°å®ƒä»¬ï¼ˆåŒ…æ‹¬åœ¨æ‰¹å¤„ç†æœŸé—´ï¼‰ã€‚ æ‚¨å¯ä»¥è‡ªå·±æ‰§è¡Œè¿™äº›ç¼“å­˜ï¼Œå¯ä»¥å°†Springä¸å…¶@Cacheableç»“åˆä½¿ç”¨ï¼Œå¹¶ä¸”å§‹ç»ˆå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨åƒEhCacheè¿™æ ·çš„ç°æˆç¼“å­˜ã€‚ <br><br> ä¸€èˆ¬çš„é—®é¢˜å°†ä¸ä»¥ä¸‹äº‹å®æœ‰å…³ï¼šåªæœ‰åœ¨å‘½ä¸­æ—¶ï¼Œç¼“å­˜æ‰å…·æœ‰è‰¯å¥½çš„æ„Ÿè§‰ã€‚ åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œææœ‰å¯èƒ½åœ¨â€œä½œè€…â€å­—æ®µä¸Šå‘½ä¸­ï¼ˆä¾‹å¦‚50ï¼…ï¼‰ï¼Œå¹¶ä¸”æ ¹æœ¬æ²¡æœ‰æ–‡ä»¶å‘½ä¸­ã€‚ è¿™ç§æ–¹æ³•å°†å¸¦æ¥ä¸€äº›æ”¹è¿›ï¼Œä½†æ˜¯æ€§èƒ½ä¸ä¼šå‘ç”Ÿæ ¹æœ¬å˜åŒ–ï¼ˆæˆ‘ä»¬éœ€è¦çªç ´ï¼‰ã€‚ <br><br> ä¼šè¯ï¼ˆé•¿ï¼‰ç¼“å­˜éœ€è¦å¤æ‚çš„å¤±æ•ˆé€»è¾‘ã€‚ é€šå¸¸ï¼Œè¶Šæ™šè§£å†³ä¼šè¯é—´ç¼“å­˜çš„æ€§èƒ½é—®é¢˜å°±è¶Šå¥½ã€‚ <br><br>  <b>ä¼˜ç‚¹ï¼š</b> <br><br><ol><li> å®ç°ç¼“å­˜è€Œä¸æ›´æ”¹ä»£ç ã€‚ </li><li> æ€§èƒ½æé«˜äº†æ•°å€ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹ï¼‰ã€‚ </li></ol><br>  <b>ç¼ºç‚¹ï¼š</b> <br><br><ol><li> å¦‚æœä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šé™ä½æ€§èƒ½ </li><li> å¤§é‡çš„å†…å­˜å¼€é”€ï¼Œå°¤å…¶æ˜¯é•¿ç¼“å­˜æ—¶ã€‚ </li><li> å¤æ‚çš„å¤±æ•ˆï¼Œé”™è¯¯å°†å¯¼è‡´è¿è¡Œæ—¶å‡ºç°éš¾é¢˜ã€‚ </li></ol><br> é€šå¸¸ï¼Œç¼“å­˜ä»…ç”¨äºå¿«é€Ÿä¿®è¡¥è®¾è®¡é—®é¢˜ã€‚ è¿™å¹¶ä¸æ„å‘³ç€ä¸éœ€è¦ä½¿ç”¨å®ƒä»¬ã€‚ ä½†æ˜¯ï¼Œå§‹ç»ˆå€¼å¾—è°¨æ…å¯¹å¾…å®ƒä»¬ï¼Œé¦–å…ˆè¯„ä¼°æœ€ç»ˆçš„æ€§èƒ½æå‡ï¼Œç„¶åå†åšå‡ºå†³å®šã€‚ <br><br> åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œç¼“å­˜çš„æ€§èƒ½å°†æé«˜çº¦25ï¼…ã€‚ åŒæ—¶ï¼Œç¼“å­˜ä¹Ÿæœ‰å¾ˆå¤šç¼ºç‚¹ï¼Œå› æ­¤æˆ‘åœ¨è¿™é‡Œä¸ä½¿ç”¨å®ƒä»¬ã€‚ <br><br><h4> æ€»ç»“ </h4><br> å› æ­¤ï¼Œæˆ‘ä»¬ç ”ç©¶äº†ä½¿ç”¨æ‰¹å¤„ç†çš„æœåŠ¡çš„ç®€å•å®ç°ï¼Œä»¥åŠä¸€äº›åŠ é€Ÿå®ƒçš„ç®€å•æ–¹æ³•ã€‚ <br><br> æ‰€æœ‰è¿™äº›æ–¹æ³•çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ç®€å•ï¼Œç”±æ­¤å¸¦æ¥è®¸å¤šä»¤äººæ„‰æ‚¦çš„ç»“æœã€‚ <br><br> è¿™äº›æ–¹æ³•çš„ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯æ€§èƒ½ä¸‹é™ï¼Œè¿™ä¸»è¦æ˜¯ç”±äºæ•°æ®åŒ…å¤§å°æ‰€è‡´ã€‚ å› æ­¤ï¼Œå¦‚æœè¿™äº›è§£å†³æ–¹æ¡ˆä¸é€‚åˆæ‚¨ï¼Œåˆ™å€¼å¾—è€ƒè™‘é‡‡ç”¨æ›´æ¿€è¿›çš„æ–¹æ³•ã€‚ <br><br> æ‚¨å¯ä»¥åœ¨ä¸¤ä¸ªä¸»è¦é¢†åŸŸä¸­å¯»æ‰¾è§£å†³æ–¹æ¡ˆï¼š <br><br><ul><li> æ•°æ®å¼‚æ­¥å¤„ç†ï¼ˆéœ€è¦è¿›è¡ŒèŒƒå¼è½¬æ¢ï¼Œå› æ­¤ä¸è€ƒè™‘æœ¬æ–‡ï¼‰ </li><li> åœ¨ä¿æŒåŒæ­¥å¤„ç†çš„åŒæ—¶æ‰©å¤§åŒ…è£…ã€‚ </li></ul><br> æ†ç»‘è½¯ä»¶çš„æ‰©å¤§å°†å¤§å¤§å‡å°‘å¤–éƒ¨è°ƒç”¨çš„æ¬¡æ•°ï¼ŒåŒæ—¶ä½¿ä»£ç ä¿æŒåŒæ­¥ã€‚ æœ¬æ–‡çš„ä¸‹ä¸€éƒ¨åˆ†å°†ä¸“é—¨è®¨è®ºè¯¥ä¸»é¢˜ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN460291/">https://habr.com/ru/post/zh-CN460291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN460275/index.html">æ‚¨ä¸ºä»€ä¹ˆä¸éœ€è¦å®Œç¾çš„è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN460279/index.html">100äº¿ç¾å…ƒåˆåŒï¼šè°å°†ä¸ºäº”è§’å¤§æ¥¼åº”å¯¹äº‘</a></li>
<li><a href="../zh-CN460281/index.html">UX Writerå¦‚ä½•å¸®åŠ©æ”¹å–„äº§å“</a></li>
<li><a href="../zh-CN460283/index.html">æ–°çš„è‡ªå·±åŠ¨æ‰‹ç¼–ç¨‹è¯­è¨€</a></li>
<li><a href="../zh-CN460285/index.html">æˆ‘ä»¬æ­£åœ¨å‡†å¤‡PHPã€‚ foreachï¼Œarray_walkå’Œå…¶ä»–ä¸€äº›ä»¤äººææƒ§çš„å•è¯çš„æ—¶é—´å¦‚ä½•</a></li>
<li><a href="../zh-CN460295/index.html">åœ¨Rustä¸­ï¼Œä¸å®‰å…¨æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN460297/index.html">WeakRef-æ·»åŠ åˆ°ECMAScriptæ ‡å‡†çš„å»ºè®®</a></li>
<li><a href="../zh-CN460301/index.html">æ–°ä¸€ä»£å¤§åŠŸç‡LEDç¯</a></li>
<li><a href="../zh-CN460305/index.html">AERODISKå¼•æ“ï¼šç¾éš¾æ€§çš„ã€‚ ç¬¬2éƒ¨åˆ†ã€‚Metrocluster</a></li>
<li><a href="../zh-CN460307/index.html">æ¥è‡ªComputer Vision Mail.ruå›¢é˜Ÿçš„å»ºæ¨¡ç»éªŒ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>