<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌰 🌖 👩🏻‍🏫 Cara membuat coroutine di Unity sedikit lebih nyaman 🤵🏿 👕 👩‍❤️‍👩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setiap pengembang menemukan kelebihan dan kekurangan menggunakan coroutine di Unity. Dan dia memutuskan di mana skenario untuk menerapkannya, dan di m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara membuat coroutine di Unity sedikit lebih nyaman</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442622/"><p>  Setiap pengembang menemukan kelebihan dan kekurangan menggunakan coroutine di Unity.  Dan dia memutuskan di mana skenario untuk menerapkannya, dan di mana untuk memberikan preferensi terhadap alternatif. </p><br><p>  Dalam latihan sehari-hari, saya sering menggunakan coroutine untuk berbagai jenis tugas.  Suatu kali, saya menyadari bahwa sayalah yang mengganggu dan menolak banyak pendatang baru di dalamnya. </p><a name="habracut"></a><br><h2 id="koshmarnyy-interfeys">  Antarmuka mimpi buruk </h2><br><p>  Mesin hanya menyediakan beberapa metode dan beberapa kelebihannya untuk bekerja dengan coroutine: </p><br><p>  <strong>Luncurkan</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumen</a> ) </p><br><ul><li><code>StartCoroutine(string name, object value = null)</code> </li> <li> <code>StartCoroutine(IEnumerator routine)</code> </li> </ul><br><p>  <strong>Stop</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumen</a> ) </p><br><ul><li> <code>StopCoroutine(string methodName)</code> </li> <li> <code>StopCoroutine(IEnumerator routine)</code> </li> <li> <code>StopCoroutine(Coroutine routine)</code> </li> </ul><br><p>  Overload dengan parameter string (meskipun mudah menipu) dapat segera <del>  kirim ke tempat sampah </del>  lupakan setidaknya tiga alasan. </p><br><ul><li>  Penggunaan nama metode string secara eksplisit akan mempersulit analisis kode di masa mendatang, debugging, dan lainnya. </li><li>  Menurut dokumentasi, string overload membutuhkan waktu lebih lama dan hanya memungkinkan satu parameter tambahan untuk diteruskan. </li><li>  Dalam latihan saya, cukup sering ternyata tidak ada yang terjadi ketika string <code>StopCoroutine</code> overload <code>StopCoroutine</code> .  Corutin terus dieksekusi. </li></ul><br><p>  Di satu sisi, metode yang disediakan cukup untuk memenuhi kebutuhan dasar.  Namun seiring waktu, saya mulai memperhatikan bahwa dengan penggunaan aktif saya harus menulis sejumlah besar kode boilerplate - ini melelahkan, dan merusak keterbacaannya. </p><br><h2 id="blizhe-k-suti">  Lebih dekat ke intinya </h2><br><p>  Pada artikel ini saya ingin menjelaskan bungkus kecil yang telah saya gunakan untuk waktu yang lama.  Berkat dia, dengan pemikiran tentang coroutine, potongan-potongan kode templat tidak lagi muncul di kepalaku yang dengannya aku harus menari di sekitar mereka.  Selain itu, seluruh tim menjadi lebih mudah membaca dan memahami komponen-komponen di mana coroutine digunakan. </p><br><p>  Misalkan kita memiliki tugas berikut - untuk menulis komponen yang memungkinkan Anda untuk memindahkan objek ke titik tertentu. </p><br><p>  Pada saat ini, tidak masalah metode apa yang akan digunakan untuk bergerak dan koordinat apa.  Hanya satu dari banyak opsi yang akan saya pilih - ini adalah interpolasi dan koordinat global. </p><br><p>  Harap dicatat bahwa sangat disarankan untuk tidak memindahkan objek dengan mengubah koordinatnya “di dahi”, yaitu, <code>transform.position = newPosition</code> jika komponen <code>RigidBody</code> digunakan dengannya (terutama dalam metode <code>Update</code> ) ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">docs</a> ). </p><br><h3 id="standartnaya-realizaciya">  Implementasi standar </h3><br><p>  Saya mengusulkan opsi implementasi berikut untuk komponen yang diperlukan: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) StartCoroutine(MoveRoutine()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Sedikit tentang kode</b> <div class="spoiler_text"><p>  Dalam metode <code>Move</code> , sangat penting untuk menjalankan coroutine hanya ketika belum dijalankan.  Kalau tidak, mereka dapat diluncurkan sebanyak yang diinginkan dan masing-masing dari mereka akan memindahkan objek. </p><br><p>  <code>threshold</code> - toleransi.  Dengan kata lain, jarak ke titik, mendekati yang akan kita asumsikan bahwa kita telah mencapai tujuan. </p><br><p>  <strong>Untuk apa ini?</strong> </p><br><p>  Mengingat bahwa semua komponen ( <code>x</code> , <code>y</code> , <code>z</code> ) dari struktur <code>Vector3</code> adalah tipe <code>float</code> , menggunakan hasil dari memeriksa kesetaraan jarak ke target dan toleransi sebagai kondisi loop adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ide yang buruk</a> . </p><br><p>  Kami memeriksa jarak ke target untuk lebih / kurang, yang memungkinkan kami untuk menghindari masalah ini. </p><br><p>  Selain itu, jika diinginkan, Anda dapat menggunakan metode <code>Mathf.Approximately</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">docs</a> ) untuk pemeriksaan <em>perkiraan</em> kesetaraan.  Perlu dicatat bahwa dengan beberapa metode bergerak, kecepatan mungkin berubah menjadi cukup besar sehingga objek "melompat" target dalam satu bingkai.  Maka siklus tidak akan pernah berakhir.  Misalnya, jika Anda menggunakan metode <code>Vector3.MoveTowards</code> . </p><br><p>  <code>Vector3</code> saya tahu, di mesin Unity untuk struktur <code>Vector3</code> , operator <code>Vector3</code> sudah didefinisikan ulang sedemikian rupa sehingga <code>Mathf.Approximately</code> dipanggil untuk memeriksa kesetaraan komponen-bijaksana. </p></div></div><br><p>  Itu saja untuk saat ini, komponen kami cukup sederhana.  Dan saat ini tidak ada masalah.  Tapi, apa komponen ini yang memungkinkan Anda untuk memindahkan objek ke suatu titik, tetapi tidak memberikan kesempatan untuk menghentikannya.  Mari kita perbaiki ketidakadilan ini. </p><br><p>  Karena Anda dan saya memutuskan untuk tidak pergi ke sisi jahat, dan tidak menggunakan kelebihan dengan parameter string, sekarang kita perlu menyimpan suatu tempat tautan ke coroutine yang sedang berjalan.  Kalau tidak, bagaimana cara menghentikannya? </p><br><p>  Tambahkan bidang: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Coroutine moveRoutine;</code> </pre> <br><p>  Perbaiki <code>Move</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) moveRoutine = StartCoroutine(MoveRoutine()); }</code> </pre> <br><p>  Tambahkan metode stop motion: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) StopCoroutine(moveRoutine); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Seluruh kode</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Coroutine moveRoutine; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) moveRoutine = StartCoroutine(MoveRoutine()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) StopCoroutine(moveRoutine); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> </div></div><br><p>  Masalah yang sama sekali berbeda! <del>  Setidaknya berlaku untuk luka. </del></p><br><p>  Jadi  Kami memiliki komponen kecil yang melakukan tugas.  Apa geramanku? </p><br><h3 id="problemy-i-ih-reshenie">  Masalah dan solusinya </h3><br><p>  Seiring waktu, proyek tumbuh, dan bersamanya jumlah komponen, termasuk yang menggunakan coroutine.  Dan setiap kali, hal-hal ini semakin menghantuiku: </p><br><ul><li>  Panggilan Sandwich yang sedang berlangsung </li></ul><br><pre> <code class="cs hljs">StartCoroutine(MoveRoutine());</code> </pre> <br><pre> <code class="cs hljs">StopCoroutine(moveRoutine);</code> </pre> <br><p>  Hanya dengan melihat mereka membuat mata saya berkedut, dan membaca kode seperti itu adalah kesenangan yang meragukan (saya setuju, ini bisa lebih buruk).  Tetapi akan jauh lebih bagus dan lebih visual untuk memiliki sesuatu seperti itu: </p><br><pre> <code class="cs hljs">moveRoutine.Start();</code> </pre> <br><pre> <code class="cs hljs">moveRoutine.Stop();</code> </pre> <br><ul><li>  Setiap kali Anda menelepon <code>StartCoroutine</code> Anda harus ingat untuk menyimpan nilai pengembalian: </li></ul><br><pre> <code class="cs hljs">moveRoutine = StartCoroutine(MoveRoutine());</code> </pre> <br><p>  Kalau tidak, karena kurangnya referensi ke coroutine, Anda tidak bisa menghentikannya. </p><br><ul><li>  Pemeriksaan konstan: </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>)</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)</code> </pre> <br><ul><li>  Dan satu lagi hal jahat yang harus selalu Anda ingat (dan yang saya <del>  lupa lagi </del>  terlewatkan).  Di akhir coroutine dan sebelum setiap keluar dari itu (misalnya, menggunakan <code>yield break</code> ), perlu untuk mengatur ulang nilai bidang. <br><pre> <code class="cs hljs">moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> </li></ul><br><p>  Jika Anda lupa, Anda akan menerima coroutine satu kali.  Setelah jalankan pertama di <code>moveRoutine</code> , tautan ke coroutine akan tetap, dan jalankan baru tidak akan berfungsi. </p><br><p>  Dengan cara yang sama, Anda harus melakukannya jika berhenti secara paksa: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { StopCoroutine(moveRoutine); moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Kode dengan semua perubahan</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Coroutine moveRoutine; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { moveRoutine = StartCoroutine(MoveRoutine()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { StopCoroutine(moveRoutine); moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.localPosition = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> </div></div><br><p>  Pada satu titik, saya benar-benar ingin sekali menyapu seluruh penyamaran ini di suatu tempat, dan meninggalkan sendiri hanya metode yang diperlukan: <code>Start</code> , <code>Stop</code> dan beberapa lagi acara dan properti. </p><br><p>  <strong>Akhirnya mari kita lakukan!</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Owner { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Coroutine Coroutine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func&lt;IEnumerator&gt; Routine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsProcessing =&gt; Coroutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CoroutineObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour owner, Func&lt;IEnumerator&gt; routine</span></span></span><span class="hljs-function">)</span></span> { Owner = owner; Routine = routine; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Stop(); Coroutine = Owner.StartCoroutine(Process()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsProcessing) { Owner.StopCoroutine(Coroutine); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Tanya jawab</b> <div class="spoiler_text"><p>  <code>Owner</code> - tautan ke instance <code>MonoBehaviour</code> yang akan dilampirkan coroutine.  Seperti yang Anda ketahui, itu harus dijalankan dalam konteks komponen tertentu, karena <code>StopCoroutine</code> <code>StartCoroutine</code> dan metode <code>StopCoroutine</code> .  Karenanya, kita memerlukan tautan ke komponen yang akan menjadi pemilik coroutine. </p><br><p>  <code>Coroutine</code> - analog dari bidang <code>moveRoutine</code> di komponen <code>MoveToPoint</code> , berisi tautan ke coroutine saat ini. </p><br><p>  <code>Routine</code> - delegasi dengan siapa metode bertindak sebagai coroutine akan dikomunikasikan. </p><br><p>  <code>Process()</code> adalah pembungkus kecil di atas metode <code>Routine</code> utama.  Hal ini diperlukan agar dapat dilacak ketika eksekusi coroutine selesai, setel ulang tautannya dan jalankan kode lain pada saat itu (jika perlu). </p><br><p>  <code>IsProcessing</code> - memungkinkan Anda untuk mengetahui apakah coroutine sedang berjalan. </p></div></div><br><p>  Dengan demikian, kami menghilangkan sejumlah besar sakit kepala, dan komponen kami memiliki tampilan yang sangat berbeda: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CoroutineObject moveRoutine; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { moveRoutine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CoroutineObject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, MoveRoutine); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; moveRoutine.Start(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; moveRoutine.Stop(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><p>  Yang tersisa hanyalah coroutine itu sendiri dan beberapa baris kode untuk bekerja dengannya.  Secara signifikan lebih baik. </p><br><p>  Misalkan tugas baru telah tiba - Anda perlu menambahkan kemampuan untuk mengeksekusi kode apa pun setelah objek telah mencapai tujuannya. </p><br><p>  Dalam versi asli, kita harus menambahkan parameter delegasi tambahan ke masing-masing coroutine yang dapat ditarik setelah selesai. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">System.Action callback</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span> callback?.Invoke(); }</code> </pre> <br><p>  Dan teleponlah sebagai berikut: </p><br><pre> <code class="cs hljs">moveRoutine = StartCoroutine(moveRoutine(CallbackHandler)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallbackHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// do something }</span></span></code> </pre> <br><p>  Dan jika ada beberapa lambda sebagai pawang, maka itu terlihat lebih buruk. </p><br><p>  Dengan pembungkus kami, cukup menambahkan acara ini hanya sekali. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action Finish;</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Finish?.Invoke(); }</code> </pre> <br><p>  Dan kemudian, jika perlu, berlangganan. </p><br><pre> <code class="cs hljs">moveRoutine.Finished += OnFinish; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnFinish</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// do something }</span></span></code> </pre> <br><p>  Saya percaya bahwa Anda telah memperhatikan bahwa versi pembungkus saat ini menyediakan kemampuan untuk bekerja hanya dengan coroutine tanpa parameter.  Oleh karena itu, kita dapat menulis pembungkus umum untuk coroutine dengan satu parameter.  Sisanya dilakukan dengan analogi. </p><br><p>  Tapi, demi kebaikan, alangkah baiknya untuk pertama-tama memasukkan kode, yang akan sama untuk semua pembungkus, ke beberapa kelas dasar, agar tidak menulis hal yang sama.  Kami sedang melawan ini. </p><br><p>  Kami menghapusnya: </p><br><ul><li>  <code>Owner</code> Properti, <code>Coroutine</code> , sedang <code>IsProcessing</code> </li><li>  Acara <code>Finished</code> </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Action = System.Action; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObjectBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Owner { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Coroutine Coroutine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsProcessing =&gt; Coroutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action Finished; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Pembungkus tanpa parameter setelah refactoring</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObject</span></span> : <span class="hljs-title"><span class="hljs-title">CoroutineObjectBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func&lt;IEnumerator&gt; Routine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action Finished; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CoroutineObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour owner, Func&lt;IEnumerator&gt; routine</span></span></span><span class="hljs-function">)</span></span> { Owner = owner; Routine = routine; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Finished?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Stop(); Coroutine = Owner.StartCoroutine(Process()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(IsProcessing) { Owner.StopCoroutine(Coroutine); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> </div></div><br><p>  Dan sekarang, pada kenyataannya, pembungkus untuk coroutine dengan satu parameter: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObject</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">CoroutineObjectBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func&lt;T, IEnumerator&gt; Routine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action Finished; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CoroutineObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour owner, Func&lt;T, IEnumerator&gt; routine</span></span></span><span class="hljs-function">)</span></span> { Owner = owner; Routine = routine; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T arg</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(arg); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Finished?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T arg</span></span></span><span class="hljs-function">)</span></span> { Stop(); Coroutine = Owner.StartCoroutine(Process(arg)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(IsProcessing) { Owner.StopCoroutine(Coroutine); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><p>  Seperti yang Anda lihat, kodenya hampir sama.  Hanya di beberapa tempat ditambahkan fragmen, tergantung pada jumlah argumen. </p><br><p>  Misalkan kita diminta untuk memperbarui komponen MoveToPoint sehingga titik tersebut tidak dapat ditetapkan melalui jendela <code>Inspector</code> di editor, tetapi dengan kode ketika metode <code>Move</code> dipanggil. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CoroutineObject&lt;Vector3&gt; moveRoutine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsMoving =&gt; moveRoutine.IsProcessing; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { moveRoutine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CoroutineObject&lt;Vector3&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, MoveRoutine); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 target</span></span></span><span class="hljs-function">)</span></span> =&gt; moveRoutine.Start(target); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; moveRoutine.Stop(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 target</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.localPosition = Vector3.Lerp(transform.position, target, speed); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><p>  Ada banyak opsi untuk memperluas fungsionalitas pembungkus ini sebanyak mungkin: menambahkan peluncuran yang tertunda, acara dengan parameter, pelacakan kemungkinan kemajuan coroutine, dan banyak lagi.  Tapi saya sarankan berhenti pada tahap ini. </p><br><p>  Tujuan artikel ini adalah keinginan untuk berbagi masalah mendesak yang saya temui dan mengusulkan solusi kepada mereka, dan bukan untuk menutupi kemungkinan kebutuhan semua pengembang. </p><br><p>  Saya berharap bahwa kawan pemula dan yang berpengalaman akan mendapat manfaat dari pengalaman saya.  Mungkin mereka akan membagikan komentar mereka atau menunjukkan kesalahan yang bisa saya lakukan. </p><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id442622/">https://habr.com/ru/post/id442622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id442612/index.html">Mesin kardus untuk permainan papan listrik. Bagaimana kami membawanya lebih dekat dengan kenyataan</a></li>
<li><a href="../id442614/index.html">CI / CD menggunakan Jenkins di Kubernetes</a></li>
<li><a href="../id442616/index.html">Kami mempercepat pemrosesan acara menjadi 1,6 juta per detik</a></li>
<li><a href="../id442618/index.html">Tidak untuk selfie: uji immunosorbent terkait-enzim digital menggunakan chip baru yang tertanam dalam smartphone</a></li>
<li><a href="../id442620/index.html">Pembelajaran mesin dalam pemantauan TI</a></li>
<li><a href="../id442624/index.html">Buku “Algoritma Sempurna. Dasar-Dasar</a></li>
<li><a href="../id442626/index.html">Habraiting: membangun awan kata-kata berbahasa Rusia pada contoh header Habra</a></li>
<li><a href="../id442630/index.html">Daya tahan lampu LED dan output cahaya berkurang</a></li>
<li><a href="../id442632/index.html">Energi panas bumi: bagaimana panas Bumi diubah menjadi sumber energi yang efisien</a></li>
<li><a href="../id442636/index.html">Apakah Anda membawa berita buruk kepada manajemen?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>