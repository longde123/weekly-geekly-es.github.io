<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤳🏾 🐠 🚴🏽 为NES调试游戏：今天如何发生 🧕🏿 🚇 🌪️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="如果您曾经参与编程，那么您将熟悉错误的概念。 如果他们不打扰我们，那么开发过程将变得更快，更有趣。 但是这些错误只是在等待破坏我们的代码，工作进度和创意流程的时刻。 幸运的是，即使在复古游戏程序员的代码中，也有许多工具和策略可以消除错误。 

 调试工具 
 调试代码的最佳方法之一是使用调试器。 F...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>为NES调试游戏：今天如何发生</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466653/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/4b4/b16/5ec4b4b16c4a29c8669a5dea88746758.gif" alt="图片"></div><br> 如果您曾经参与编程，那么您将熟悉错误的概念。 如果他们不打扰我们，那么开发过程将变得更快，更有趣。 但是这些错误只是在等待破坏我们的代码，工作进度和创意流程的时刻。 幸运的是，即使在复古游戏程序员的代码中，也有许多工具和策略可以消除错误。 <br><br><h3> 调试工具 </h3><br> 调试代码的最佳方法之一是使用调试器。  FCEUX和Mesen仿真器的某些版本具有内置的调试器，可让您随时中断程序以检查代码的运行状况。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea6/3aa/a59/ea63aaa59021320ef8bdbdb928f2bf8f.png"></div><br>  <i>FCEUX仿真器调试器</i> <br><br> 值得注意的是，此方法更适合使用汇编语言的高级程序员。 但是我们是新手，所以我们将用C（cc65）编写。 当然，编译器将按照自己的规则运行，并且我们很难处理从C代码编译的机器代码。 <br><a name="habracut"></a><br><h5> 十六进制编辑器FCEUX </h5><br> 假设我们需要观察某种变量或数组。  <code>-Ln labels.txt</code>添加到链接器选项（ld65）：- <code>-Ln labels.txt</code> <br><br> 编译项目后， <code>labels.txt</code>文件将出现在其文件夹中。 只需在用于查看文本的任何程序中打开它，然后查找我们要观察的变量的名称即可。 <br><br>  （ <em>注意：如果声明了静态变量，则该变量将不包含在此列表中。因此， <code>static unsigned char playerX</code>使用<code>unsigned char playerX</code>代替<code>static unsigned char playerX</code> <code>unsigned char playerX</code></em> ） <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc1/949/8d0/dc19498d02f665f3f9c4b797ab74de5b.png"></div><br> 现在我们知道所需变量的地址，还不错。 让我们在调试器中找到它。 在FCEUX仿真器中运行ROM游戏。 在“调试”菜单中，选择“十六进制编辑器”，然后在打开的窗口中按Ctrl + G并输入变量的地址： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/495/ce0/085/495ce0085c38bf77a9941c76c28e9f92.png"></div><br> 按确定，光标将移动到变量所在的地址。 让我们看一下： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ec/4b4/b16/5ec4b4b16c4a29c8669a5dea88746758.gif"></div><br> 这对于检查数组是否正确填充或跟踪特定变量的更改很有用。 此外，仔细观察您的代码，您会感觉像个老大哥。 <br><br> 查看其他有用的FCEUX仿真器Debug菜单工具，例如PPU Viewer，Name table Viewer等。 <br><br><h3> 简化调试过程 </h3><br> 如果我们不想每次都运行调试器来观察变量？ 一种更高级的方法是编写一个将值显示在屏幕上的过程。 让我们尝试使用界面中的分数来显示玩家在Y轴上的位置： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9dd/4cb/3ca/9dd4cb3caac2ebb53331df53b565365d.gif"></div><br> 完美的作品！ <br><br>  Retro-coder和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">nesdoug博客所有者</a> Doug Fraker创建了一种类似的方法，用于将屏幕可视化用于调试目的。 下面显示的过程在屏幕上创建了一条灰色线，清楚地表明了CPU负载的程度： <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// void gray_line(void); // For debugging. Insert at the end of the game loop, to see how much frame is left. // Will print a gray line on the screen. Distance to the bottom = how much is left. // No line, possibly means that you are in v-blank. _gray_line: lda &lt;PPU_MASK_VAR and #$1f ;no color emphasis bits ora #1 ;yes gray bit sta PPU_MASK ldx #20 ;wait @loop2: dex bne @loop2 lda &lt;PPU_MASK_VAR ;normal sta PPU_MASK rts</span></span></code> </pre> <br> 您可以简单地将此过程复制到代码中，或将nesdoug.h库包含在项目中。 游戏周期结束后必须调用该过程，然后屏幕上将显示一个灰色条。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca6/11a/007/ca611a0072771688eb1618922b14d8f2.gif"></div><br> 它起作用了，但是看起来我还有一个错误！ 我们稍后将摆脱他。 同时，让我们继续前进。 <br><br><h3> 宏的力量 </h3><br> 宏也可以是有用的调试工具。 它们将使您能够在代码中找到已成为该错误源的位置。 <br><br> 让我们创建一种宏，它可以在正确的时间为我们提供信号，例如，播放声音或选择具有必要值的零调色板。 我们有几个宏可以将零调色板更改为红色，蓝色和随机颜色，并可以再现声音： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/343/886/d8e/343886d8e09643d4a35df968e094ac85.png"></div><br> 如何运作？ 假设您已成功编译了一个项目，则使用游戏启动了仿真器，单击“开始”按钮，然后... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/220/6ff/9e52206ffadd67162cf8e9893d3e7c4f.gif"></div><br> 似乎只有白色的屏幕。 此外，某些仿真器可能会在状态栏中报告“ CPU卡塞！”。 接下来要做什么？ <br><br> 首先，您需要本地化发生错误的代码。 在这里，我的声音宏开始发挥作用。 <br><br> 我们肯定知道主菜单正在工作。 让我们看看之后会发生什么： <br><br><pre> <code class="cpp hljs">playMainMenu(); player.lives = <span class="hljs-number"><span class="hljs-number">9</span></span>; points = <span class="hljs-number"><span class="hljs-number">0</span></span>; gameFlags = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(current_level&lt;<span class="hljs-number"><span class="hljs-number">7</span></span> &amp;&amp; player.lives&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { set_world(current_world); debugSound; playCurrentLevel(); }</code> </pre> <br> 我怀疑<code>set_world</code>过程时游戏会崩溃。 让我们检查一下这种预感。 在检查完程序后，我只需在下一行输入宏名称。 <br><br> 我们开始该项目，然后……我听到声音了！ 也就是说，此过程成功完成，我们需要检查以下内容： <code>playCurrentLevel</code> 。 让我们将调试宏移到下面： <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(current_level&lt;<span class="hljs-number"><span class="hljs-number">7</span></span> &amp;&amp; player.lives&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { set_world(); playCurrentLevel(): debugSound; }</code> </pre> <br> 我再次启动该项目，但听不到声音。 这意味着该过程尚未完成，并且内部发生故障。 <br><br> 在这种情况下，您应该打开过程代码并继续应用此技术，直到可以缩小搜索范围内可能的错误位置为止。 <br><br> 更改调色板的宏也可用于检查条件。 例如，我们的代码对以下几种情况执行复杂的测试： <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (getTile(objX, objY+<span class="hljs-number"><span class="hljs-number">16</span></span>) || collide16() ) || (objsOX[i] &amp;&amp; objY&gt;objsOX[i])) { debugRed; objsSTATE[i]=THWOMP_SMASH; objY=objsY[i]-=<span class="hljs-number"><span class="hljs-number">4</span></span>; objsFRM[i]=<span class="hljs-number"><span class="hljs-number">0</span></span>; sfx_play(SFX_THWOMP_SLAM_DOWN,<span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre> <br> 如果在这里更改调色板的颜色，我们将查看条件是否满足： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/196/db1/654/196db16543e8be8a6e7e02f01316a84f.gif"></div><br> 这只鸡似乎还可以。 但是，如果该标志不起作用，则不满足条件之一。 在这种情况下，您需要分别检查它们，然后，也许会发现另一个错误。 <br><br><h3> 核选项 </h3><br> 我最近发现我游戏中的一个鬼魂表现出某种可疑的行为。 他不时拒绝攻击玩家。 <br><br> 看看这个被bug击中的幽灵-它仅在角色靠近屏幕中心时才会攻击： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f17/bd9/e30/f17bd9e300807a706298c64d8113c5f1.gif"></div><br> 无论我多么努力地研究此过程的代码，我都无法弄清楚该错误的隐藏位置，所以我决定采取极端措施并在现代开发环境中测试该代码的工作。 <br><br> 我拿走了我需要的所有东西：屏幕图，具有元文件属性的数组，过程代码，然后将它们简单地插入Visual Studio 2017中： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/383/d8f/d69/383d8fd6900e550652513f43fb70b6ff.png"></div><br> 在PC上，代码的工作原理完全相同。 事实证明，该漏洞隐藏在一个程序中，该程序填充了缓存以查找玩家与敌人之间的障碍。 数组填充不正确。 我确定应该是0而不是0x80。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f0/225/8c5/2f02258c52bbc8c4e2bf59b9e9aab8b4.png"></div><br> 因此，我将尝试逐步调试代码以找出发生这种情况的原因。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d23/678/2db/d236782dbf4473e6bee4c7460782fec9.gif"></div><br> 这很有趣，但是看起来我按错误的顺序进行了操作。 让我们修复它，然后再次检查阵列！ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c7/b01/54b/4c7b0154b745c486715e4af208ff0068.png"></div><br> 现在看来该数组正在正确填充。 也就是说，我只需要修复cc65代码并再次编译NES项目即可。 <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1NRqqPzOoSg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> 因此，现代开发工具可以帮助调试算法和修复错误。 <br><br><h3> 冷静地消除错误 </h3><br> 错误很烦人，代码也很烦人。 保持镇定，不要失去控制，并使用所有可用工具来搜索和消除这些害虫。 您的代码质量和高枕无忧。 <br><br>  <em>是否想直接从复古设计专业人士那里获得技巧？</em>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener noreferrer">欢迎来到我们的不和谐！</a></em> <em><br><br></em>  <em><em>我们的游戏肉食<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里</a>可用！</em></em> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN466653/">https://habr.com/ru/post/zh-CN466653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN466641/index.html">作为C＃的傻瓜教。 第一部分</a></li>
<li><a href="../zh-CN466643/index.html">＃314移动开发人员的有趣材料摘要（9月2日至8日）</a></li>
<li><a href="../zh-CN466647/index.html">没有钢琴家的马和乐团的电话。 如何在前端提出运动任务</a></li>
<li><a href="../zh-CN466649/index.html">周末电动车</a></li>
<li><a href="../zh-CN466651/index.html">以Java / Spring / H2为例，在XML和SQL之间进行选择以滚动LiquiBase脚本</a></li>
<li><a href="../zh-CN466657/index.html">动态细节：编译器秘密游戏，内存泄漏，性能差异</a></li>
<li><a href="../zh-CN466659/index.html">Kubecost审查可在云端的Kubernetes上省钱</a></li>
<li><a href="../zh-CN466661/index.html">国外远程硕士学位：论文发表前的注意事项</a></li>
<li><a href="../zh-CN466663/index.html">使用STM32F103微控制器（Blue Tablet）进行的简单实验</a></li>
<li><a href="../zh-CN466665/index.html">CSS溢出和数据丢失</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>