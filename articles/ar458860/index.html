<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ค ๐จโ๐ง ๐จ๐ปโโ๏ธ ุถุจุท ูุนููุงุช kernel Linux ูุชุญุณูู PostgreSQL ๐ ๐ฉ๐พ ๐ช</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุนุชูุฏ ุงูุฃุฏุงุก ุงูุฃูุซู ูู PostgreSQL ุนูู ูุนููุงุช ูุธุงู ุงูุชุดุบูู ุงููุนุฑูุฉ ุจุดูู ุตุญูุญ. ูููู ุฃู ุชุคุฏู ูุนููุงุช kernel OS ุงููุถุจูุทุฉ ุจุดูู ุณูุฆ ุฅูู ุงูุฎูุงุถ ุฃุฏุงุก ุฎุงุฏู ูุงุนุฏ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุถุจุท ูุนููุงุช kernel Linux ูุชุญุณูู PostgreSQL</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458860/" style=";text-align:right;direction:rtl"><img width="30%" align="left" src="https://habrastorage.org/webt/dy/qf/mh/dyqfmhq5wntmbisfsdahfiwc_-y.jpeg">  ูุนุชูุฏ ุงูุฃุฏุงุก ุงูุฃูุซู ูู PostgreSQL ุนูู ูุนููุงุช ูุธุงู ุงูุชุดุบูู ุงููุนุฑูุฉ ุจุดูู ุตุญูุญ.  ูููู ุฃู ุชุคุฏู ูุนููุงุช kernel OS ุงููุถุจูุทุฉ ุจุดูู ุณูุฆ ุฅูู ุงูุฎูุงุถ ุฃุฏุงุก ุฎุงุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ูุฐูู ุ ูู ุงูุถุฑูุฑู ุชูููู ูุฐู ุงููุนููุงุช ููููุง ูุฎุงุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุนุจุก ุงูุนูู ุงูุฎุงุต ุจู.  ูู ูุฐุง ุงูููุดูุฑ ุ ุณููุงูุด ุจุนุถ ูุนููุงุช Linux kernel ุงููููุฉ ุงูุชู ูููู ุฃู ุชุคุซุฑ ุนูู ุฃุฏุงุก ุฎุงุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููููุฉ ุถุจุทูุง. <br><br><h2 style=";text-align:right;direction:rtl">  SHMMAX / SHMALL </h2><br>  <b>SHMMAX</b> ูู ูุนููุฉ kernel ุชูุณุชุฎุฏู ูุชุญุฏูุฏ ุงูุญุฏ ุงูุฃูุตู ูุญุฌู ุดุฑูุญุฉ ุฐุงูุฑุฉ ูุดุชุฑูุฉ ูุงุญุฏุฉ ูููู ูุนูููุฉ Linux ุชุฎุตูุตูุง.  ูุจู ุงูุฅุตุฏุงุฑ 9.2 ุ ุงุณุชุฎุฏู PostgreSQL ูุธุงู V (SysV) ุ ูุงูุฐู ูุชุทูุจ ุชูููู SHMMAX.  ุจุนุฏ 9.2 ุ ุชุญููุช ุจูุณุชุฌุฑุณ ุฅูู POSIX ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ.  ุญุชู ุงูุขู ุฃูู ุจุงูุช ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ูููุธุงู V ูุทููุจุฉ. <br><br>  ูุจู ุงูุฅุตุฏุงุฑ 9.3 ุ ูุงู SHMMAX ุฃูู ูุนููุฉ kernel.  ูุชู ุชุญุฏูุฏ ูููุฉ SHMMAX ุจุงูุจุงูุช. <br><a name="habracut"></a><br>  ูุจุงููุซู ุ <b>SHMALL</b> ูู ูุนููุฉ kernel ุฃุฎุฑู ุชูุณุชุฎุฏู <b>ูุชุญุฏูุฏูุง</b> <br>  ุตูุญุงุช ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ุนูู ูุณุชูู ุงููุธุงู.  ุงุณุชุฎุฏู ุงูุฃูุฑ <i>ipcs</i> ูุนุฑุถ <i>ููู</i> SHMMAX ุฃู SHMALL ุฃู SHMMIN ุงูุญุงููุฉ. <br><br>  <sup><b>SHM * ุงูุชูุงุตูู - Linux</b></sup> <br><br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">$ ipcs -lm ------ Shared Memory Limits -------- max number of segments = 4096 max seg size (kbytes) = 1073741824 max total shared memory (kbytes) = 17179869184 min seg size (bytes) = 1</code> </pre> <br>  <sup><b>SHM * ุชูุงุตูู - MacOS X</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ ipcs -M IPC status from as of Thu Aug 16 22:20:35 PKT 2018 shminfo: shmmax: 16777216 (max shared memory segment size) shmmin: 1 (min shared memory segment size) shmmni: 32 (max number of shared memory identifiers) shmseg: 8 (max shared memory segments per process) shmall: 1024 (max amount of shared memory <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> pages)</code> </pre><br>  ูุณุชุฎุฏู PostgreSQL <b>ูุธุงู V IPC</b> ูุชุฎุตูุต ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ.  ูุฐู ุงููุนููุฉ ูู ูุงุญุฏุฉ ูู ุฃูู ูุนููุงุช kernel.  ูููุง ุชูููุช ุฑุณุงุฆู ุงูุฎุทุฃ ุงูุชุงููุฉ ุ ููุฐุง ูุนูู ุฃู ูุฏูู ุฅุตุฏุงุฑูุง ุฃูุฏู ูู PostgreSQL ูุฃู ูุฏูู ูููุฉ SHMMAX ููุฎูุถุฉ ุฌุฏูุง.  ูู ุงููุชููุน ุฃู ูููู ุงููุณุชุฎุฏููู ุจุถุจุท ูุฒูุงุฏุฉ ุงููููุฉ ููููุง ููุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ุงูุชู ุณูุณุชุฎุฏููููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุฃุฎุทุงุก ุงูุชูููู ุงููุญุชููุฉ </h3><br>  ุฅุฐุง ูู ูุชู ุชูููู SHMMAX ุจุดูู ุตุญูุญ ุ ููุฏ ุชุชููู ุฎุทุฃ ุนูุฏ ูุญุงููุฉ ุชููุฆุฉ ูุชูุฉ PostgreSQL ุจุงุณุชุฎุฏุงู ุฃูุฑ <i>initdb</i> . <br><br>  <sup><b>ูุดู initdb</b></sup> <br> <code>DETAIL: Failed system call was shmget(key=1, size=2072576, 03600). <br> <br> HINT: This error usually means that PostgreSQL's request for a shared memory segment exceeded your kernel's SHMMAX parameter. <br> You can either reduce the request size or reconfigure the kernel with larger SHMMAX. To reduce the request size (currently 2072576 bytes), <br> reduce PostgreSQL's shared memory usage, perhaps by reducing shared_buffers or max_connections. <br> <br> If the request size is already small, it's possible that it is less than your kernel's SHMMIN parameter, <br> in which case raising the request size or reconfiguring SHMMIN is called for. <br> <br> The PostgreSQL documentation contains more information about shared memory configuration. child process exited with exit code 1</code> <br> <br>  ูุจุงููุซู ุ ูุฏ ุชุชููู ุฎุทุฃ ุนูุฏ ุจุฏุก ุชุดุบูู ุฎุงุฏู PostgreSQL ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ <i>pg_ctl</i> . <br><br>  <sup><b>ูุดู pg_ctl</b></sup> <br> <code>DETAIL: Failed system call was shmget(key=5432001, size=14385152, 03600). <br> <br> HINT: This error usually means that PostgreSQL's request for a shared memory segment exceeded your kernel's SHMMAX parameter. <br> <br> You can either reduce the request size or reconfigure the kernel with larger SHMMAX.; To reduce the request size (currently 14385152 bytes), reduce PostgreSQL's shared memory usage, perhaps by reducing shared_buffers or max_connections. <br> <br> If the request size is already small, it's possible that it is less than your kernel's SHMMIN parameter, <br> in which case raising the request size or reconfiguring SHMMIN is called for. <br> <br> The PostgreSQL documentation contains more information about shared memory configuration.</code> <br> <br><h3 style=";text-align:right;direction:rtl">  ููู ุงูุงุฎุชูุงูุงุช ูู ุงูุชุนุงุฑูู </h3><br>  ูุฎุชูู ุชุนุฑูู ูุนููุงุช SHMMAX / SHMALL ููููุงู ูู ูุธุงูู Linux ู MacOS X: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Linux: kernel.shmmaxุ kernel.shmall </li><li style=";text-align:right;direction:rtl">  MacOS X: kern.sysv.shmmaxุ kern.sysv.shmall </li></ul><br>  ูููู ุงุณุชุฎุฏุงู ุงูุฃูุฑ <i>sysctl</i> ูุชุบููุฑ ุงููููุฉ ูุคูุชูุง.  ูุชุนููู ููู ุซุงุจุชุฉ ุ ุฃุถู ุฅุฏุฎุงููุง ูู <i>/etc/sysctl.conf</i> .  ูุชุฑุฏ ุงูุชูุงุตูู ุฃุฏูุงู. <br><br>  <sup><b>ุชุบููุฑ ุฅุนุฏุงุฏุงุช kernel ุนูู MacOS X</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Get the value of SHMMAX sudo sysctl kern.sysv.shmmax kern.sysv.shmmax: 4096 # Get the value of SHMALL sudo sysctl kern.sysv.shmall kern.sysv.shmall: 4096 # Set the value of SHMMAX sudo sysctl -w kern.sysv.shmmax=16777216 kern.sysv.shmmax: 4096 -&gt; 16777216 # Set the value of SHMALL sudo sysctl -w kern.sysv.shmall=16777216 kern.sysv.shmall: 4096 -&gt; 16777216</code> </pre> <br>  <sup><b>ุชุบููุฑ ูุนููุงุช Linux kernel</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># Get the value of SHMMAX sudo sysctl kernel.shmmax kernel.shmmax: 4096 # Get the value of SHMALL sudo sysctl kernel.shmall kernel.shmall: 4096 # Set the value of SHMMAX sudo sysctl -w kernel.shmmax=16777216 kernel.shmmax: 4096 -&gt; 16777216 # Set the value of SHMALL sudo sysctl -w kernel.shmall=16777216 kernel.shmall: 4096 -&gt; 16777216</code> </pre> <br>  <sub><b>ุชุฐูุฑ</b> : ูุฌุนู ุงูุชุบููุฑุงุช ุฏุงุฆูุฉ ุ ุฃุถู ูุฐู ุงูููู ุฅูู <font color="blue">/etc/sysctl.conf</font></sub> <br><br><h2 style=";text-align:right;direction:rtl">  ุตูุญุงุช ูุจูุฑุฉ (ุตูุญุงุช ุถุฎูุฉ) </h2><br>  ูุชู ุงุณุชุฎุฏุงู Linux ุงูุชุฑุงุถููุง ุตูุญุงุช 4K ุ ููุณุชุฎุฏู BSD <i>ุงูุตูุญุงุช ุงููุงุฆูุฉ</i> ุ ููุณุชุฎุฏู Windows <i>ุงูุตูุญุงุช ุงููุจูุฑุฉ</i> .  ุงูุตูุญุฉ ูู ุฌุฒุก ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุงููุฎุตุตุฉ ูุนูููุฉ.  ูููู ุฃู ุชุญุชูู ุงูุนูููุฉ ุนูู ุนุฏุฉ ุตูุญุงุช ุ ุญุณุจ ูุชุทูุจุงุช ุงูุฐุงูุฑุฉ.  ูููุง ุฒุงุฏุช ุงูุฐุงูุฑุฉ ุงูุชู ุชุญุชุงุฌูุง ุงูุนูููุฉ ุ ุฒุงุฏ ุนุฏุฏ ุงูุตูุญุงุช ุงููุฎุตุตุฉ ููุง.  ูุฏุนู ูุธุงู ุงูุชุดุบูู ุฌุฏูู ุชุฎุตูุต ุตูุญุงุช ููุนูููุงุช.  ูููุง ูุงู ุญุฌู ุงูุตูุญุฉ ุฃุตุบุฑ ุ ูููุง ูุงู ุงูุฌุฏูู ุฃูุจุฑ ุ ูููุง ุทุงู ุงูููุช ููุนุซูุฑ ุนูู ุตูุญุฉ ูู ุฌุฏูู ุงูุตูุญุฉ ูุฐุง.  ูุฐูู ุ ุชุณูุญ ูู ุงูุตูุญุงุช ุงููุจูุฑุฉ ุจุงุณุชุฎุฏุงู ููุฏุงุฑ ูุจูุฑ ูู ุงูุฐุงูุฑุฉ ูุน ุงูุฎูุงุถ ุงูุญูู ุ  ุนุฏุฏ ูุฑุงุช ุนุฑุถ ุงูุตูุญุฉ ุ ุนุฏุฏ ุฃูู ูู ุฃุฎุทุงุก ุงูุตูุญุฉ ุ ุนูููุงุช ูุฑุงุกุฉ / ูุชุงุจุฉ ุฃุณุฑุน ุนุจุฑ ุงููุฎุงุฒู ุงููุคูุชุฉ ุงููุจูุฑุฉ.  ูุงููุชูุฌุฉ ูู ุชุญุณูู ุงูุฃุฏุงุก. <br><br>  PostgreSQL ูุฏุนู ุงูุตูุญุงุช ุงููุจูุฑุฉ ููุท ุนูู ูุธุงู Linux.  ุงูุชุฑุงุถููุง ุ ูุณุชุฎุฏู Linux ุตูุญุงุช ุฐุงูุฑุฉ 4 ููููุจุงูุช ุ ูุฐูู ุฅุฐุง ูุงู ูุฏูู ุงููุซูุฑ ูู ุนูููุงุช ุงูุฐุงูุฑุฉ ุ ููุฌุจ ุนููู ุชุซุจูุช ุตูุญุงุช ุฃูุจุฑ.  ููุงู ุฒูุงุฏุฉ ูู ุงูุฃุฏุงุก ุนูุฏ ุงุณุชุฎุฏุงู ุงูุตูุญุงุช ุงููุจูุฑุฉ ุจุณุนุฉ 2 ููุฌุงุจุงูุช ูุญุชู 1 ุฌูุฌุง ุจุงูุช.  ูููู ุถุจุท ุญุฌู ุงูุตูุญุฉ ุงููุจูุฑ ูู ููุช ุงูุชูููุฏ.  ููููู ุจุณูููุฉ ุงูุชุญูู ูู ูุนููุงุช ุงูุตูุญุฉ ุงููุจูุฑุฉ ูุงุณุชุฎุฏุงููุง ุนูู ููุจููุชุฑ Linux ุงูุฎุงุต ุจู ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ <i>cat / proc / meminfo |</i>  <i>grep - ุฃูุง ุถุฎูุฉ</i> . <br><br>  <sup><b>ุงูุญุตูู ุนูู ูุนูููุงุช ุญูู ุงูุตูุญุงุช ุงููุจูุฑุฉ (Linux ููุท)</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">Note: This is only <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Linux, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> other OS this operation is ignored$ cat /proc/meminfo | grep -i huge AnonHugePages:        0 kB ShmemHugePages:       0 kB HugePages_Total:      0 HugePages_Free:       0 HugePages_Rsvd:       0 HugePages_Surp:       0 Hugepagesize:      2048 kB</code> </pre> <br>  ูู ูุฐุง ุงููุซุงู ุ ุนูู ุงูุฑุบู ูู ุถุจุท ุญุฌู ุงูุตูุญุฉ ุงููุจูุฑุฉ ุนูู 2048 (2 ููุบุงุจุงูุช) ุ ูุฅู ุฅุฌูุงูู ุนุฏุฏ ุงูุตูุญุงุช ุงููุจูุฑุฉ ูู 0. ููุฐุง ูุนูู ุฃู ุงูุตูุญุงุช ุงููุจูุฑุฉ ูุนุทูุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุจุฑูุงูุฌ ุงููุตู ูุชุญุฏูุฏ ุนุฏุฏ ุงูุตูุญุงุช ุงููุจูุฑุฉ </h3><br>  ูุนุฑุถ ูุฐุง ุงูุจุฑูุงูุฌ ุงููุตู ุงูุจุณูุท ุงูุนุฏุฏ ุงููุทููุจ ูู ุงูุตูุญุงุช ุงููุจูุฑุฉ.  ูู ุจุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู ุนูู ุฎุงุฏู Linux ุฃุซูุงุก ุชุดุบูู PostgreSQL.  ุชุญูู ูู ุชุนููู ุฏููู ุจูุงูุงุช PostgreSQL ููุชุบูุฑ ุจูุฆุฉ <i>$ PGDATA</i> . <br><br>  <sup><b>ุงูุญุตูู ุนูู ุนุฏุฏ ุงูุตูุญุงุช ุงููุจูุฑุฉ ุงููุทููุจุฉ</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash pid=`head -1 $PGDATA/postmaster.pid` echo "Pid:           $pid" peak=`grep ^VmPeak /proc/$pid/status | awk '{ print $2 }'` echo "VmPeak:          $peak kB" hps=`grep ^Hugepagesize /proc/meminfo | awk '{ print $2 }'` echo "Hugepagesize:  $hps kB" hp=$((peak/hps)) echo Set Huge Pages:    $hp</span></span></code> </pre> <br>  ุฅุฎุฑุงุฌ ุงูุจุฑูุงูุฌ ุงููุตู ููุง ููู: <br><br>  <sup><b>ุฅุฎุฑุงุฌ ุงูุจุฑูุงูุฌ ุงููุตู</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">Pid:           12737 VmPeak:        180932 kB Hugepagesize:  2048 kB Set Huge Pages: 88</code> </pre> <br>  ุงููููุฉ ุงูููุตู ุจูุง ููุตูุญุงุช ุงููุจูุฑุฉ ูู 88 ุ ูุฐูู ูุฌุจ ุชุนููููุง ุนูู 88. <br><br>  <sup><b>ุชุซุจูุช ุงูุตูุญุงุช ุงููุจูุฑุฉ</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">sysctl -w vm.nr_hugepages=88</code> </pre> <br>  ุชุญูู ูู ุงูุตูุญุงุช ุงููุจูุฑุฉ ุงูุขู ุ ุณุชุฑู ุฃูู ูุง ูุชู ุงุณุชุฎุฏุงู ุงูุตูุญุงุช ุงููุจูุฑุฉ (HugePages_Free = HugePages_Total). <br><br>  <sup><b>ูุนูููุงุช ุญูู ุงูุตูุญุงุช ุงููุจูุฑุฉ ูุฑุฉ ุฃุฎุฑู (Linux ููุท)</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ cat /proc/meminfo | grep -i huge AnonHugePages:        0 kB ShmemHugePages:       0 kB HugePages_Total:     88 HugePages_Free:      88 HugePages_Rsvd:       0 HugePages_Surp:       0 Hugepagesize:      2048 kB</code> </pre> <br>  ุงูุขู ูู ุจุชุนููู huge_pages "on" ุนูู $ PGDATA / postgresql.conf ูุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู. <br><br>  <sup><b>ููุฑุฉ ุฃุฎุฑู ุ ูุนูููุงุช ุญูู ุงูุตูุญุงุช ุงููุจูุฑุฉ (Linux ููุท)</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ cat /proc/meminfo | grep -i huge AnonHugePages:        0 kB ShmemHugePages:       0 kB HugePages_Total:     88 HugePages_Free:      81 HugePages_Rsvd:       64 HugePages_Surp:       0 Hugepagesize:      2048 kB</code> </pre> <br>  ุงูุขู ููููู ุฃู ุชุฑู ุฃูู ูุชู ุงุณุชุฎุฏุงู ุนุฏุฏ ูููู ุฌุฏูุง ูู ุงูุตูุญุงุช ุงููุจูุฑุฉ.  ุฏุนูุง ุงูุขู ูุญุงูู ุฅุถุงูุฉ ุจุนุถ ุงูุจูุงูุงุช ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. <br><br>  <sup><b>ุจุนุถ ุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅุนุงุฏุฉ ุชุฏููุฑ ุงูุตูุญุงุช ุงููุจูุฑุฉ</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">postgres=<span class="hljs-comment"><span class="hljs-comment"># CREATE TABLE foo(a INTEGER); CREATE TABLE postgres=# INSERT INTO foo VALUES(generate_Series(1,10000000)); INSERT 0 10000000</span></span></code> </pre> <br>  ุฏุนููุง ูุฑู ูุง ุฅุฐุง ููุง ูุณุชุฎุฏู ุงููุฒูุฏ ูู ุงูุตูุญุงุช ุงููุจูุฑุฉ ุงูุขู ูู ูุจู. <br><br>  <sup><b>ูุฑุฉ ุฃุฎุฑู ุงููุนูููุงุช ุนูู ุงูุตูุญุงุช ุงููุจูุฑุฉ (Linux ููุท)</b></sup> <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ cat /proc/meminfo | grep -i huge AnonHugePages:        0 kB ShmemHugePages:       0 kB HugePages_Total:     88 HugePages_Free:      18 HugePages_Rsvd:       1 HugePages_Surp:       0 Hugepagesize:      2048 kB</code> </pre> <br>  ุงูุขู ููููู ุฃู ุชุฑู ุฃู ูุนุธู ุงูุตูุญุงุช ุงููุจูุฑุฉ ููุฏ ุงูุงุณุชุฎุฏุงู. <br><br>  <sub>ููุงุญุธุฉ: ุงููููุฉ ุงูุชูุฑูุจูุฉ ูู HugePages ุงููุณุชุฎุฏูุฉ ููุง ููุฎูุถุฉ ุฌุฏูุง ุ ููู ููุณุช ูููุฉ ุทุจูุนูุฉ ููุฌูุงุฒ ูู ุจูุฆุฉ ุงูุบุฐุงุก.</sub>  <sub>ูุฑุฌู ุชูููู ุงูุนุฏุฏ ุงููุทููุจ ูู ุงูุตูุญุงุช ููุธุงูู ูุชุนููููุง ููููุง ููุญูู ูุงูููุงุฑุฏ.</sub> <br><br><h3 style=";text-align:right;direction:rtl">  vm.swappiness </h3><br>  <b>vm.swappiness</b> ูู ูุนููุฉ kernel ุฃุฎุฑู ูููู ุฃู ุชุคุซุฑ ุนูู ุฃุฏุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ุชูุณุชุฎุฏู ูุฐู ุงููุนููุฉ ููุชุญูู ูู ุณููู ุงูุชุจุงุฏููุฉ (ุชุจุฏูู ุงูุตูุญุงุช ูู ูุฅูู ุงูุฐุงูุฑุฉ) ุนูู Linux.  ุชุชุฑุงูุญ ุงููููุฉ ูู 0 ุฅูู 100. ููู ุชุญุฏุฏ ููุฏุงุฑ ุงูุฐุงูุฑุฉ ุงูุชู ุณูุชู ุฅูุบุงุก ุชุญููููุง ุฃู ุฅูุบุงุก ุชุญููููุง.  ุงูุตูุฑ ูุนูู ุชุนุทูู ุงูุชุจุงุฏู ุ ู 100 ุชุนูู ุงูุชุจุงุฏู ุงูุนุฏูุงูู. <br><br>  ููููู ุงูุญุตูู ุนูู ุฃุฏุงุก ุฌูุฏ ูู ุฎูุงู ุชุญุฏูุฏ ููู ุฃูู. <br><br>  ูุฏ ูุคุฏู ุชุนููู ุงููููุฉ ุฅูู 0 ูู ุฃุญุฏุซ ุงูููู ุฅูู OOM Killer (ุนูููุฉ ุชูุธูู ุฐุงูุฑุฉ Linux) ููุชู ุงูุนูููุฉ.  ูุจุงูุชุงูู ุ ููููู ุถุจุท ุงููููุฉ ุจุฃูุงู ุนูู 1 ุฅุฐุง ููุช ุชุฑูุฏ ุชูููู ุงูุชุจุงุฏู.  ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ุนูู Linux ูู 60. ุงููููุฉ ุงูุฃุนูู ุชุฌุนู MMU (ูุญุฏุฉ ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ) ุชุณุชุฎุฏู ูุณุงุญุฉ ุชุฑุญูู ุตูุญุงุช ุฃูุจุฑ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุ ูู ุญูู ุฃู ุงููููุฉ ุงูุฃูู ุชููุฑ ุงููุฒูุฏ ูู ุงูุจูุงูุงุช / ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ุงูุฐุงูุฑุฉ. <br><br>  ุงููููุฉ ุงูุฃูู ูู ุฑูุงู ุฌูุฏ ุนูู ุชุญุณูู ุงูุฃุฏุงุก ูู PostgreSQL. <br><br><h3 style=";text-align:right;direction:rtl">  vm.overcommit_memory / vm.overcommit_ratio </h3><br>  ุชููู ุงูุชุทุจููุงุช ุงูุฐุงูุฑุฉ ูุชุญุฑูุฑูุง ุนูุฏูุง ูู ุชุนุฏ ููุงู ุญุงุฌุฉ ุฅูููุง.  ููู ูู ุจุนุถ ุงูุญุงูุงุช ุ ูุญุตู ุงูุชุทุจูู ุนูู ุงููุซูุฑ ูู ุงูุฐุงูุฑุฉ ููุง ูุญุฑุฑู.  ูุฐุง ูููู ุฃู ูุณุจุจ ูุงุชู OOM.  ูููุง ููู ุงูููู ุงููุญุชููุฉ ูููุนููุฉ <b>vm.overcommit_memory</b> ูุน ูุตู ููู ูููุง: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฑูุงู ุงูุฅุฑูุงู (ุงูุงูุชุฑุงุถู) ุ  ูุฑุชูุฒ ุนูู ุฃุณุงุณ ุงูููุงุฉ </li><li style=";text-align:right;direction:rtl">  ุงูุณูุงุญ ุจุงูุฅูุฑุงุท ุนูู ุฃู ุญุงู </li><li style=";text-align:right;direction:rtl">  ูุง ุชุจุงูุบู ุ ูุง ุชุชุฌุงูุฒ ูุณุจุฉ ุงูุฅุฑูุงู. </li></ol><br>  <i>ุงูุฑุงุจุท: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://www.kernel.org/doc/Documentation/vm/overcommit-accounting</a></i> <br><br>  <b>vm.overcommit_ratio</b> - ูุณุจุฉ ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุงููุชุงุญุฉ <b>ููุญูููุฉ</b> ุงูุฒุงุฆุฏุฉ.  ูููู ููููุฉ 50ูช ูู ูุธุงู ุจู ุฐุงูุฑุฉ ูุตูู ุนุดูุงุฆู ุณุนุชูุง 2 ุฌูุฌุงุจุงูุช ุชุฎุตูุต ูุง ูุตู ุฅูู 3 ุฌูุฌุงุจุงูุช ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู. <br><br>  ุชููุฑ ูููุฉ 2 ูู vm.overcommit_memory ุฃุฏุงุก ุฃูุถู ูู PostgreSQL.  ุชุฒูุฏ ูุฐู ุงููููุฉ ูู ุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู (RAM) ูู ุฎูุงู ุนูููุฉ ุงูุฎุงุฏู ุฏูู ุฃู ุฎุทุฑ ูุจูุฑ ูู ุงูุชุนุฑุถ ูููุชู ูู ุฎูุงู ุนูููุฉ ุงููุงุชู OOM.  ุณูุชููู ุงูุชุทุจูู ูู ุฅุนุงุฏุฉ ุงูุชุดุบูู ุ ูููู ููุท ูู ุญุฏูุฏ ุงูุฅููุงู ุงูุฒุงุฆุฏ ุ ููุง ูููู ูู ุฎุทุฑ ููุงู ูุงุชู OOM ุจูุชู ุงูุนูููุฉ.  ูุฐูู ุ ูุฅู ุงููููุฉ 2 ุชุนุทู ุฃุฏุงุก ุฃูุถู ูู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ููู 0. ููุน ุฐูู ุ ูููู ุชุญุณูู ุงูููุซูููุฉ ูู ุฎูุงู ุถูุงู ุนุฏู ุฒูุงุฏุฉ ุชุญููู ุงูุฐุงูุฑุฉ ุฎุงุฑุฌ ุงููุทุงู ุงูููุจูู.  ูุฐุง ููุบู ุฎุทุฑ ูุชู ุงูุนูููุฉ ุนูู ูุฏ ูุงุชู OOM. <br><br>  ุนูู ุฃูุธูุฉ ุบูุฑ ุงูุชุฑุญูู ุ ูุฏ ุชุญุฏุซ ูุดููุฉ ูุน vm.overcommit_memory ุชุณุงูู 2. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://www.postgresql.org/docs/current/static/kernel-resources.html#LINUX-MEMORY-OVERCOMMIT</a> <br><br><h3 style=";text-align:right;direction:rtl">  vm.dirty_background_ratio / vm.dirty_background_bytes </h3><br>  <b>vm.dirty_background_ratio</b> ูู ุงููุณุจุฉ ุงููุฆููุฉ ููุฐุงูุฑุฉ ุงูููููุกุฉ ุจุตูุญุงุช ูุชุณุฎุฉ ุชุญุชุงุฌ ุฅูู ูุชุงุจุชูุง ุฅูู ุงููุฑุต.  ุฅุนุงุฏุฉ ุชุนููู ุฅูู ุงููุฑุต ูู ุงูุฎูููุฉ.  ุชุชุฑุงูุญ ูููุฉ ูุฐู ุงููุนููุฉ ูู 0 ุฅูู 100 ุ  ููุน ุฐูู ุ ูุฏ ุชููู ุงููููุฉ ุฃูู ูู 5 ุบูุฑ ูุนุงูุฉ ุ ูุจุนุถ ุงูุญุจุงุช ูุง ุชุฏุนููุง.  10 ูู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู ูุนุธู ุฃูุธูุฉ Linux.  ููููู ุชุญุณูู ุงูุฃุฏุงุก ูุนูููุงุช ุงูุชุณุฌูู ุงูููุซูุฉ ุจูุนุฏู ุฃูู ุ ููุง ูุนูู ุฃู Linux ุณูููู ุจุฅููุงุก ุตูุญุงุช ูุชุณุฎุฉ ูู ุงูุฎูููุฉ. <br><br>  ุชุญุชุงุฌ ุฅูู ุชุนููู ูููุฉ <b>vm.dirty_background_bytes</b> ููููุง ูุณุฑุนุฉ ุงููุฑุต. <br><br>  ูุง ุชูุฌุฏ ููู "ุฌูุฏุฉ" ููุงุชูู ุงููุนููุชูู ุ ุญูุซ ุฃู ููุงููุง ูุนุชูุฏุงู ุนูู ุงูุฃุฌูุฒุฉ.  ููุน ุฐูู ุ ูุคุฏู ุชุนููู vm.dirty_background_ratio ุฅูู 5 ู vm.dirty_background_bytes ุจูุนุฏู 25ูช ูู ุณุฑุนุฉ ุงููุฑุต ุฅูู ุฒูุงุฏุฉ ุงูุฃุฏุงุก ุฅูู 25ูช ุชูุฑูุจูุง ูู ูุนุธู ุงูุญุงูุงุช. <br><br><h3 style=";text-align:right;direction:rtl">  vm.dirty_ratio / dirty_bytes </h3><br>  ูุฐุง ูู ููุณ <b>vm.dirty_background_ratio / dirty_background_bytes</b> ุ ุจุงุณุชุซูุงุก ุฃูู ูุชู ุชูููุฐ ุฅุนุงุฏุฉ <b>ุงูุชุนููู</b> ูู ุฌูุณุฉ ุนูู ุ ูุน ุญุธุฑ ุงูุชุทุจูู.  ูุฐูู ุ ูุฌุจ ุฃู ูููู <b>vm.dirty_ratio</b> ุฃุนูู ูู <b>vm.dirty_background_ratio</b> .  ูุฐุง ูุถูู ุฃู ุนูููุงุช ุงูุฎูููุฉ ุณุชุจุฏุฃ ูู ููุช ูุจูุฑ ูู ุฃุฌู ุชุฌูุจ ุญุธุฑ ุงูุชุทุจูู ูุฏุฑ ุงูุฅููุงู.  ููููู ุถุจุท ุงููุฑู ุจูู ูุงุชูู ุงููุณุจุชูู ุงุนุชูุงุฏูุง ุนูู ุงููุฑุต I / O ุงูุญูู. <br><br><h2 style=";text-align:right;direction:rtl">  ูุคุฏู </h2><br>  ููููู ุชูููู ูุนููุงุช ุฃุฎุฑู ูุฒูุงุฏุฉ ุงูุฅูุชุงุฌูุฉ ุ ููู ุงูุชุญุณููุงุช ุณุชููู ุถุฆููุฉ ููู ุชุญุตู ุนูู ูุงุฆุฏุฉ ูุจูุฑุฉ.  ูุฌุจ ุฃู ูุชุฐูุฑ ุฃูู ูุง ุชูุทุจู ุฌููุน ุงููุนููุงุช ุนูู ุฌููุน ุฃููุงุน ุงูุชุทุจููุงุช.  ุชุนูู ุจุนุถ ุงูุชุทุจููุงุช ุจุดูู ุฃูุถู ุนูุฏูุง ูููู ุจุชูููู ุจุนุถ ุงูุฅุนุฏุงุฏุงุช ุ ูุจุนุถูุง ูุง ูุนูู.  ูุฌุจ ุฃู ุชุฌุฏ ุงูุชูุงุฒู ุงูุตุญูุญ ุจูู ุชููููุงุช ูุฐู ุงููุนููุงุช ูุญุฌู ุงูุนูู ุงููุชููุน ูููุน ุงูุชุทุจูู ุ ูุนูุฏ ุงูุฅุนุฏุงุฏ ุ ูุฌุจ ุฃู ุชุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุณููู ูุธุงู ุงูุชุดุบูู.  ุชูููู ูุนููุงุช kernel ููุณ ุณููุงู ูุซู ุถุจุท ูุนููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช: ูู ุงูุตุนุจ ุชูุฏูู ุชูุตูุงุชู ููุง. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar458860/">https://habr.com/ru/post/ar458860/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar458846/index.html">ููููุฉ ุชุทููุฑ ููุตุฉ ุฃุฎุฑู ุจุงุณุชุฎุฏุงู ุงููุญุฏุฉ. ุจุฑูุงูุฌ ุชุนูููู ุขุฎุฑ</a></li>
<li><a href="../ar458848/index.html">ุตุฏุฃ 1.36.0 ุงูุฅุตุฏุงุฑ: ุณูุฉ ุงููุณุชูุจู ุ ูุชุฎุตูุต ุงูุชุฎุตูุต ู MaybeUninit <T></a></li>
<li><a href="../ar458850/index.html">ุชุนูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ุจุซูู ุจุฎุณ ูููุงุกุฉ. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar458854/index.html">MotionLayout: ุงูุฑุณูู ุงููุชุญุฑูุฉ ุฃูุถู ูุฃูู ุฑูุฒูุง</a></li>
<li><a href="../ar458856/index.html">ุจุทุงุฑูุงุช AAA ุฑุฎูุตุฉ ูููููุฉ</a></li>
<li><a href="../ar458864/index.html">ุจูุช ูุทูุฑู ูุณุงุจูุฉ ู TamTam</a></li>
<li><a href="../ar458866/index.html">ููู ูุนูู ููุงุฒู ุงููุฑูู ูู World of Tanks Blitz</a></li>
<li><a href="../ar458868/index.html">ุงูุถูุถุงุก ูู ุงูุจูุงูุงุช ุงููุจูุฑุฉ. ุชุญููู ุงูุงูุชุฑูุจูุง</a></li>
<li><a href="../ar458870/index.html">ูุนุธู ูุดุงูู ุงูููุจููุชุฑ ุงูุดุนุจูุฉ ุงูุชู ููุงุฌููุง ูู ููู</a></li>
<li><a href="../ar458874/index.html">ASO ุงููุฑุฌุนูุฉ: ุงููุต ุงูุฃูุซู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>