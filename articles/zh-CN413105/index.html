<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👦‍👦 👨🏾‍🎓 🏌️ 物联网提供商的说明。 LoraWAN中的激活和安全性 🤷 🤨 🤱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="您好亲爱的物联网爱好者。 延续说明物联网提供商。 
 第一部分 > || > 第二部分 > || > 第三部分 > || > 第四部分 



 今天是时候讨论LoRaWAN的安全性了。 有很多谣言和传说。 我们将尝试弄清楚它是如何工作的以及存在哪些风险。 

 为了继续讨论安全性主题，您将不得不做...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>物联网提供商的说明。 LoraWAN中的激活和安全性</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413105/"><p> 您好亲爱的物联网爱好者。 延续说明物联网提供商。 </p><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第一部分</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第二部分</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第三部分</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第四部分</a> <br><br><p> 今天是时候讨论LoRaWAN的安全性了。 有很多谣言和传说。 我们将尝试弄清楚它是如何工作的以及存在哪些风险。 <br><br> 为了继续讨论安全性主题，您将不得不做一个简短的介绍，并讨论网络上无线电模块的初始初始化。  LoRaWAN中的此过程称为激活。 </p><br><p> 为简便起见，我将在下面列出我们需要的术语。 如果您感到有些困惑-您可以回到这里进行检查。 您可能必须回来，因为 许多术语的缩写非常相似。 另外，在本说明中，我将进行类比，以便您大致了解可以与该术语进行比较的内容。 并非总是可以选择精确的类比，因此，请不要对本专栏进行严格的判断。 </p><br><img src="https://habrastorage.org/webt/z4/v-/68/z4v-68a8ov1o-2rz2chxuprmpto.png"><br><a name="habracut"></a><p> 因此，可以通过空中（OTAA）或预设（ABP）完成LoRaWAN中的激活。 </p><br><h2>  OTAA（空中激活） </h2><br><p> 在空中激活的情况下，必须在我们的无线电模块上设置三个参数。 它的唯一标识符（DevEUI），服务器标识符（AppEUI）和服务器密钥（AppKey）。 </p><br><p> 在服务器端，还必须注册无线电模块标识符，服务器标识符和密钥。 即 服务器最初应该知道将尝试加入该设备的设备。 如果我们知道标识符和服务器密钥，但是我们的DevEUI未在其数据库中注册，则连接将失败。 </p><br><p> 初始加电后，无线电会以三个预定义的连接频率之一在空中发送join_request数据包。 带着这个包裹，他问附近是否有一个网络可以“认出他”。 以下是join_request包的组成。 如您所见，它包含了非常好的DevEUI和AppEUI以及DevNonce。 </p><br><img src="https://habrastorage.org/webt/6p/gh/kd/6pghkd5kbylskdzbcasmwylqdnq.png"><br><p>  DevNonce是随机变量。 服务器将其存储在内存中一段时间​​，如果join_request到达的DevNonce与之前的其中一个相同，则服务器将忽略此请求。 当攻击者可以写下激活请求然后从他的设备中重复激活请求时，这可以防止重复攻击。 顺便说一句，并不是所有的物联网标准都能为这种攻击提供保护。 </p><br><p> 该消息中没有直接使用AppKey，而是通过它来考虑帧末尾的MIC校验和。 <br> 在来自join_accept服务器的响应消息中，我们将进一步需要此密钥。 </p><br><p>  Join_request未加密传输。 </p><br><p> 如果服务器知道AppEUI和DevEUI，并且DevNonce字段中没有匹配项，并且MIC没有问题，则将接收Join_accept。 如果通过所有检查，则服务器将生成join_accept响应消息。 其组成如下图所示。 </p><br><img src="https://habrastorage.org/webt/w7/tv/j7/w7tvj7iwfjeynonywqmtqlrwmac.png"><br><p> 实际上，会生成两个会话密钥-网络服务器（NwkSKey）和应用程序服务器（AppSKey）。 这些密钥以及其他信息由AppKey加密，然后发送到无线电模块。 此外，所有消息传递都使用会话密钥进行双重加密（除了使用MAC命令的数据包以外，它们不使用应用程序服务器密钥进行加密）。  NwkSKey不会仅使用数据（没有命令）参与数据包加密，而是通过它考虑校验和。 <br>  NwkSkey和AppSKey对于每个单独的无线电模块都是唯一的。 </p><br><p> 两个键用于附加信息保护。 每次来自无线电模块的数据包到达我们的系统时，都会对网络服务器和应用程序服务器进行部分加密。 即 网络服务器将只能解密发给它的那些消息（各种服务消息）。 应用服务器将仅看到数据包的有用部分（实际上是正在转发的数据）。 这是必需的，因为有99％概率的网络服务器将在提供者处。 但是应用服务器很可能由客户端托管。 双重加密使提供者很难发现数据包的内容。 </p><br><p> 除了这两个键外，OTAA上的join_accept还有另外一件重要的事情-扩展频率列表（CFList）。 让我提醒您，无线电模块最初只知道它可以工作的三个频率。 激活后，会注册其他频率以进行通信。 <br><br> 如果不确切知道设备将在哪个网络中工作，这将非常方便。 我们可以同意，在所有网络中，三个频率（+ RX2）将始终重合，其余五个由提供商自行决定。 <br><br> 此外，为了将来与大量设备一起使用，CFList可用于群集 <br><br> 这是将网络分为多个群集，并且在群集内进行频率规划的时候。 假设我们的无线电模块知道三个频率F1，F2和F3。 它以其中一个频率激活，如果它在cluster1中，则它会收到一个附加的频率表，形式为F4-1，F5-1和F6-1。 对于群集2，他将获得完全不同的F4-2，F5-2，F6-2。 同时，我们可以用相同的方式配置所有的无线电模块，而不用真正地考虑哪一个将落入哪个集群。 并且在相邻集群中，碰撞的可能性将急剧降低。 </p><br><h2>  ABP（通过个性化激活） </h2><br><p> 将会话密钥立即连接到无线电模块并最初在服务器端注册时的简化过程。 无线电模块很方便，无需激活，可以立即使用。 没有什么比这更方便了，因为 在这种情况下，安全性一般。 另外，您不能从服务器上拉频率。 我从未见过任何实际使用的案例。 我们不会考虑它，以下所有内容都是关于OTAA的。 </p><br><h2> 那么安全性呢？ </h2><br><p> 因此，从本质上讲，我们对网络服务器和应用程序服务器的会话密钥负有主要的加密负担。 <br><br> 仔细考虑它们。 </p><br><p> 批评LoRaWAN标准的主要抱怨是，当设备在网络上激活时，我们有两个密钥，然后可以保持几个月不变。 更准确地说，在重新激活设备之前，它们可能不会改变多年。 在正常情况下，我们激活并忘记了无线电模块，因此三到四年的密钥寿命是非常现实的前景。 实际上，从安装到使电池电量为零。 <br> 我们的钥匙有多可靠？ </p><br><p> 该规范说它们符合神秘的RFC4493。 <br> 这是什么 这是一种加密算法，通常称为AES-CMAC。 <br><br> 让我们不要陷入密码学的混乱之中，而将自己局限于对图片的共识。 如下图所示。 </p><br><img src="https://habrastorage.org/webt/kv/zs/7k/kvzs7k4joixbwltc1wkfxkpmotw.png"><br><p>  AES-CMAC的原理大致如下：加密的消息分为128位块。 每个块均使用AES密钥分别加密。 此外，当加密第二块时，除了密钥之外，还使用第一块的加密结果。 当加密第三者时-第二者和（间接地）第一者的结果。 这样的并发症链。 </p><br><p> 这个原则有多可靠？ </p><br><p> 非常可靠。 该算法于十多年前问世。 从那以后，他遭到了许多不同的攻击，最后，从理论上讲，他们证明了他可以被黑客入侵，问题是需要大量的数据包样本才能破坏它。 然后就有机会了解加密块中的内容。 </p><br><p> 如果我们正在谈论拦截LoRaWAN数据包，具有必要知识的攻击者能否获得此样本？ 让我们估计一下。 让包裹每小时走一次。 在一个月内，将有720个数据包从无线电模块发送出去。 还不够 <br><br> 对于真正的威胁，我们需要一个非常有耐心的患者，他将编写几个月的软件包。 而且他仍然可以破解算法并获得宝贵的密钥，这并不是事实。 不要忘记，需要分别针对每个无线电模块显示这种耐心。 请记住，每小时发送一次数据包非常频繁。 实际上，时间间隔要长得多-六个小时，甚至一天。 </p><br><p> 但是，即使在1.1版发布后，这种虚假的机会现在也已关闭，在该版本中实现了重新激活和联接服务器命令。 让我们以某种方式谈论此规范。 现在，我回想起上一篇文章的想法：当标准开放并且具有社区时，所有漏洞都可见。 在升级期间，开发人员确切地知道首先要看什么。 </p><br><p> 结果，我们发现安全威胁相当虚幻。 在深层理论的某个地方，可以进行黑客入侵，但实际上这是不现实的。 现在乘以接收到的信息的值。 我们的攻击者是否会开始写包数月以找出计数器？ 不太可能。 <br><br>  LoRaWAN达到了合理的性价比。 我们知道可以加强保护。 但这是最终的计算能力，这是电池的额外负担，有可能增加数据包的大小或减少有效负载。 <br><br> 对我来说，这不仅仅是遥测任务。 </p><br><p> 在评论中，我很高兴听到我的反对者和支持者。 请记住，安全性主题始终需要进行讨论，并且切勿以任何人的观点为依托。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN413105/">https://habr.com/ru/post/zh-CN413105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN413095/index.html">神经网络技术的应用：软件开发</a></li>
<li><a href="../zh-CN413097/index.html">基于企业级软件，经过了数百万次测试：openSUSE Leap 15已发布</a></li>
<li><a href="../zh-CN413099/index.html">Macbook上的降频RAM</a></li>
<li><a href="../zh-CN413101/index.html">Raspberry Pi外形尺寸的STM32F4调试板</a></li>
<li><a href="../zh-CN413103/index.html">3CX v15.5 Update 5 Beta和REST与AmoCRM集成发布</a></li>
<li><a href="../zh-CN413107/index.html">Svelto.ECS项目Wiki的翻译。 适用于Unity3D的ECS框架</a></li>
<li><a href="../zh-CN413109/index.html">如何构建SaaS产品集成平台：Poster Cloud Checkout体验</a></li>
<li><a href="../zh-CN413111/index.html">STM32 + NetBeans =？</a></li>
<li><a href="../zh-CN413113/index.html">类JavaScript JavaScript序列化支持</a></li>
<li><a href="../zh-CN413117/index.html">如何在bash中安全编程</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>