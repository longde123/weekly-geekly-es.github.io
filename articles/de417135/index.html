<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤘🏼 🧜🏿 🙅🏾 Unity3D: Wie kann man den Beleuchtungsgrad eines Punktes in einer Szene herausfinden? 🙎🏼 ☮️ 🚮</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Grüße! 

 Ich weiß, und im Grunde wissen Sie, was Ihre Kartenspiele oder Drei-in-Eins-Spiele fehlen. Stealth-Systeme! 

 Und natürlich sollte jedes St...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unity3D: Wie kann man den Beleuchtungsgrad eines Punktes in einer Szene herausfinden?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417135/">  Grüße! <br><br>  Ich weiß, und im Grunde wissen Sie, was Ihre Kartenspiele oder Drei-in-Eins-Spiele fehlen.  Stealth-Systeme! <br><br>  Und natürlich sollte jedes Stealth-System mit Selbstachtung in der Lage sein, die Beleuchtung der Umgebung um den Spieler herum zu berücksichtigen.  Ich war erstaunt, das Thema zu vertiefen und eine ungewöhnlich kleine Menge an Informationen zu finden.  Deshalb beeile ich mich, die Früchte zu teilen. <br><br>  Heute werden wir kein vollwertiges Stealth-System für den Spieler entwickeln, sondern nur Interaktionen mit der Beleuchtung betrachten. <br><a name="habracut"></a><br><h3>  Methode 1: Collider </h3><br>  Ein einfacher und nicht sehr ressourcenintensiver Weg. <br><br>  Wir fügen jeder Lichtquelle einen sphärischen Collider hinzu.  Wir machen es zum Auslöser.  Wir setzen die Abmessungen ungefähr gleich dem Lichtradius. <br><br>  Der Rest ist klar wie ein Schatten.  Wir schreiben ein einfaches Skript, in dem wir in OnTriggerEnter () die Aktivierung der Lichtberechnung platzieren (damit die Lichtquellen nicht im Leerlauf funktionieren, wenn sich der Player nicht in der Nähe befindet). <br><br>  Die Beleuchtungsberechnung selbst befindet sich in Update ().  Im Wesentlichen ist dies die übliche Physik.Raycast ().  Wenn es den Spieler trifft, befindet sich der Spieler in der Lichtzone.  Wenn es nicht fällt, bedeutet dies, dass sich der Spieler hinter Hindernissen und damit im Schatten befindet. <br><br>  Sie können hier auch die Berechnung der Entfernung zwischen dem Player und der Lichtquelle hinzufügen.  Um die Beleuchtung zu bestimmen, verwenden wir einen einfachen Schwimmer, der je nach Abstand zu den Lichtquellen variiert.  Und Sie können es verwenden, wo immer Ihr Herz es wünscht. <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/c9/nu/43/c9nu43wv6trcy2hg28eijiq4j_o.png"><br>  <i>Bei Punkt 1 ist die Beleuchtung nahezu maximal.</i>  <i>Bei Punkt 2 ist die Beleuchtung minimal - es gibt ein Hindernis zwischen dem Licht und dem Punkt.</i>  <i>Bei Punkt 3 ist die Beleuchtung durchschnittlich.</i> <br></div></div><br>  Und das ist noch nicht alles!  Sie können verschiedenen „Schattenzonen“, in denen sich der Spieler verstecken muss, Trigger-Collider hinzufügen.  In den besten Traditionen von Manhunt.  Ebenso können Sie die hellen Zonen mit dem Collider markieren und beispielsweise das Licht eines Scheinwerfers simulieren. <br><br><h4>  Vorteile: </h4><br><ul><li>  Einfache Anpassung von Punktlichtern. </li><li>  Sehr sparsam in Bezug auf Ressourcen, wenn Sie keine Lichtquellen spammen. </li></ul><br><h4>  Nachteile: </h4><br><ul><li>  Das Spotlicht und das Richtungslicht sind stark abgestimmt.  Wenn es für das erste ausreicht, den Collider im Lichtfeld zu positionieren (um die Sichtbarkeit des Spielers am Eingang zu erhöhen), ist das zweite ein echtes Grauen.  Sie müssen entweder Kollider an jedem Schatten platzieren (um die Sichtbarkeit des Spielers am Eingang zu verringern) oder ständig mit Physics.Raycast () zwischen dem Spieler und der „Sonne“ prüfen - er befindet sich unter den Strahlen oder im Schatten. </li><li>  Eine große Anzahl von Kollidern überfrachtet die Szene und erschwert die Physik. </li><li>  Bei sich kreuzenden Lichtquellen ist Vorsicht geboten. </li><li>  Dynamisches Licht (bewegte oder sich ändernde Intensität) muss separat über Skripte hinzugefügt werden. </li></ul><br><h3>  Methode 2: RenderTexture </h3><br>  Was machen wir hier?  Tatsächlich erhalten wir einen „Screenshot“ von der Kamera und nicht unbedingt von der Hauptkamera.  Und dann analysieren wir die Farbe des Screenshots, um herauszufinden, wie hell das Licht auf das Motiv fällt. <br><br>  Zunächst brauchen wir ein Objekt, von dem wir das Licht "lesen" werden.  Erstellen Sie eine regelmäßige Kugel oder Ebene, machen Sie sie klein (Skala 0,1), platzieren Sie sie nahe am Boden, machen Sie sie weiß, entfernen Sie den Collider: <br><br><div class="spoiler">  <b class="spoiler_title">Versteckter Text</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hb/ri/7o/hbri7op9p5lyq091ia1ozgeiasc.png"><br></div></div><br>  Fügen Sie eine Kamera hinzu (entfernen Sie unbedingt den Audio-Listener und stellen Sie sicher, dass sich das MainCamera-Tag nicht lohnt).  Binden Sie es an unser Objekt.  Wir legen es etwas höher, wir lenken es nach unten.  Wir belichten in den Einstellungen nicht die Hauptanzeige.  Es orthographisch zu machen ist für Ihren Geschmack. <br><br>  Am Ende positionieren wir es so, dass es auf unser Objekt und nur auf es schaut. <br><br><div class="spoiler">  <b class="spoiler_title">Versteckter Text</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/uv/de/3y/uvde3ygsuysuvuysojxbsvmbml8.png"><br></div></div><br>  Konfigurieren Sie am Ende die Culling-Maske der primären und sekundären Kamera so, dass die primäre unsere „hellen“ Objekte nicht anzeigt, während die sekundären nur sie sehen, ohne etwas anderes zu überladen. <br><br>  Und hier beginnt der Spaß.  Wir hängen das Skript an die Kamera an: <br><br><pre><code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">public</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Camera</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cam</span></span>; //   <span class="hljs-selector-tag"><span class="hljs-selector-tag">RenderTexture</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tex</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">Texture2D</span></span> _<span class="hljs-selector-tag"><span class="hljs-selector-tag">tex</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Start</span></span> () { //    "". // ,       -   . // Depth   0   -   . tex = new RenderTexture (1, 1, 8); // RenderTexture "" , //   ,    . _tex = new Texture2D (1, 1, TextureFormat.RGB24, false); } <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Update</span></span> () { //   ""  cam.targetTexture = tex; cam.Render (); //     RenderTexture.active = tex; //   Texture2D _tex.ReadPixels (new Rect (0, 0, 1, 1), 0, 0); _tex.Apply (); Color col = _tex.GetPixel (0, 0); float vis = (col.r + col.g + col.b) / 3; }</code> </pre> <br>  Am Ausgang erhalten wir ein Float Vis, das im Wesentlichen eine numerische Darstellung des auf unser Objekt einfallenden Beleuchtungsniveaus ist.  Wenn die Quelle nahe ist - das Objekt ist weiß - vis ist 1. Wenn es dunkel ist - ist das Objekt schwarz - vis ist ~ 0. <br><br>  Wir müssen die obige Operation nicht in jedem Frame ausführen, daher binden wir einen kleinen zweiten Timer ein: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">interval</span></span> = 0; <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Update</span></span> () { interval += Time.deltaTime; if (interval &lt; 1) return; interval = 0; //   }</code> </pre> <br>  Als nächstes binden wir unser gesamtes System an den Spieler, so dass es sich mit ihm bewegt.  Und unsere vis-Variable gibt automatisch Licht um den Player zurück! <br><br>  Dieses System kann nicht nur in Verbindung mit dem Player verwendet werden.  Sie können es überall und nach Belieben platzieren und so eine Art Lichtsensor erstellen.  In der Regel gibt es effektivere Möglichkeiten, sie umzusetzen, aber ist es immer schön, Alternativen zu haben? <br><br>  Die Vorteile liegen auf der Hand, lassen Sie uns über die Nachteile sprechen. <br><br><h4>  Nachteile </h4><br><ul><li>  Jeder „Lichtdetektor“ (wenn es mehr als einen gibt) benötigt eine separate Kamera. </li><li>  Texture2D.ReadPixels () - na ja, extrem langsam.  Selbst wenn Sie dies einmal pro Sekunde tun und nicht jedes Bild, auch wenn Sie die Funktionen zum Schreiben und Lesen von Texturen in verschiedene Bilder aufteilen, gibt es immer noch Layouts mit 40 bis 110 ms. </li><li>  Dieses System berücksichtigt einige seltene Fälle nicht.  Zum Beispiel leuchtet eine Taschenlampe auf einen Charakter.  Der Charakter ist gut beleuchtet, aber das Licht fällt auf ihn und hinter ihn und nicht nach unten. Unser Lichtdetektor zeigt eine geringe Beleuchtungsstärke.  Sie können das Problem beispielsweise lösen, indem Sie den Detektor nicht auf dem Boden, sondern auf der Höhe der Brust des Charakters platzieren.  Dann müssen Sie zwei Kameras auf gegenüberliegenden Seiten platzieren, um das Licht von beiden Seiten abzulesen.  Was wird das System um die Hälfte verlangsamen. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de417135/">https://habr.com/ru/post/de417135/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de417123/index.html">Integration von Spark Streaming und Kafka</a></li>
<li><a href="../de417125/index.html">RTC Meetup .Net: Zum ersten Meeting einladen</a></li>
<li><a href="../de417127/index.html">Tesla unterzeichnet Vereinbarung zum Bau von Gigafactory 3 in China</a></li>
<li><a href="../de417129/index.html">Universum des Geistes</a></li>
<li><a href="../de417131/index.html">Wie man Transaktionen in MongoDB jetzt fühlt</a></li>
<li><a href="../de417137/index.html">Winkel: Erstellen Sie eine Komponente mit mehreren Kontrollkästchen, die zur Wiederverwendung geeignet ist</a></li>
<li><a href="../de417139/index.html">Beweise, die Wissenschaftler jahrzehntelang getäuscht haben</a></li>
<li><a href="../de417141/index.html">Es ist nie zu früh, an 6G zu denken</a></li>
<li><a href="../de417143/index.html">Beweise in der Wissenschaft? Sie sind nicht da</a></li>
<li><a href="../de417145/index.html">Burger King App: Verspotten Sie Ihre Privatsphäre. Korrigieren wir?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>