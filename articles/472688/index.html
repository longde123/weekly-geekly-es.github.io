<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≤üèº ‚úäüèæ üí© C√≥mo funciona la renderizaci√≥n de juegos en 3D: procesamiento de v√©rtices üëçüèª üçì üë®üèº‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este post consideraremos la etapa de trabajo con v√©rtices. Es decir, nuevamente tendremos que obtener los libros de texto sobre matem√°ticas y recor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo funciona la renderizaci√≥n de juegos en 3D: procesamiento de v√©rtices</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472688/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/070/e30/bd5/070e30bd57f6af2d7c1e36abe15f949b.jpg" alt="imagen"></div><br>  En este post consideraremos la etapa de trabajo con v√©rtices.  Es decir, nuevamente tendremos que obtener los libros de texto sobre matem√°ticas y recordar √°lgebra lineal, matrices y trigonometr√≠a.  ¬°Hurra! <br><br>  Descubriremos c√≥mo se transforman los modelos 3D y se tienen en cuenta las fuentes de luz.  Tambi√©n explicaremos en detalle la diferencia entre v√©rtices y sombreadores geom√©tricos, y descubrir√° en qu√© etapa es el lugar para la teselaci√≥n.  Para facilitar la comprensi√≥n, utilizamos diagramas y ejemplos de c√≥digo que demuestran c√≥mo el juego realiza c√°lculos y procesa valores. <br><br>  La captura de pantalla al comienzo de la publicaci√≥n muestra el juego GTA V en modo de visualizaci√≥n de estructura al√°mbrica.  Comp√°relo con la estructura mucho menos compleja de Half-Life 2. Las im√°genes fueron creadas por thalixte con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ReShade</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c4/562/7ee/4c45627ee9916f0bcdce6858b510b6a6.jpg"></div><a name="habracut"></a><br><h2>  Cual es el punto? </h2><br>  En el mundo de las matem√°ticas, un punto es simplemente un lugar en el espacio geom√©trico.  No hay nada m√°s peque√±o que un punto, no tiene un tama√±o, por lo que los puntos se pueden usar para especificar la ubicaci√≥n exacta del comienzo y el final de los objetos, como segmentos de l√≠nea, planos y vol√∫menes. <br><br>  Para los gr√°ficos en 3D, dicha informaci√≥n es de importancia cr√≠tica, la apariencia de todo depende de ella, porque todos los objetos se muestran como conjuntos de segmentos de l√≠nea, planos, etc.  La siguiente imagen muestra una captura de pantalla de Bethesda 2015 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fallout 4</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/87b/33c/f82/87b33cf825a8ed9d87b7c8a7cc873e69.jpg"></div><br>  Puede que no sea f√°cil para usted ver que esto es solo un gran grupo de puntos y l√≠neas, por lo que le mostraremos c√≥mo se ve la misma escena en modo de estructura al√°mbrica.  En este modo, el motor de renderizado 3D omite las texturas y los efectos realizados en la etapa de p√≠xeles y dibuja solo l√≠neas multicolores que conectan los puntos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/430/8a0/f67/4308a0f6729ff459c600275d8755f12c.jpg"></div><br>  Ahora todo parece completamente diferente, pero vemos c√≥mo se combinan todas las l√≠neas para formar varios objetos, entornos y fondos.  Algunos consisten en solo docenas de l√≠neas, por ejemplo, piedras en primer plano, mientras que otras contienen tantas l√≠neas que parecen s√≥lidas. <br><br>  Cada punto al principio y al final de cada l√≠nea se procesa realizando un mont√≥n de c√°lculos.  Algunos c√°lculos son muy simples y r√°pidos, otros son mucho m√°s complicados.  Al procesar puntos en grupos, especialmente en forma de tri√°ngulos, puede lograr un aumento significativo en la productividad, as√≠ que echemos un vistazo m√°s de cerca. <br><br><h2>  ¬øQu√© se necesita para un tri√°ngulo? </h2><br>  El nombre del <em>tri√°ngulo</em> deja en claro que la figura tiene tres esquinas internas;  Para hacer esto, necesita tres puntos de esquina y tres segmentos que los conectan.  Es correcto llamar a un punto de esquina <em>v√©rtice (v√©rtice)</em> (en plural - v√©rtices);  cada v√©rtice est√° definido por un punto.  Como estamos en un mundo geom√©trico tridimensional, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sistema de coordenadas cartesianas se</a> usa para los puntos.  Por lo general, las coordenadas se escriben en forma de tres valores, por ejemplo, (1, 8, -3) o gen√©ricamente ( <em>x, y, z</em> ). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64c/b9e/77f/64cb9e77ffcc16159b4d201026a4ba04.png"></div><br>  A continuaci√≥n, podemos agregar dos v√©rtices m√°s para formar un tri√°ngulo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/732/482/c6b/732482c6b6faef01c7a7281f9b30da31.png"></div><br>  Tenga en cuenta que las l√≠neas que se muestran son opcionales: podemos establecer los puntos y decirle al sistema que estos tres v√©rtices forman un tri√°ngulo.  Todos los datos de v√©rtices se almacenan en un bloque contiguo de memoria llamado <em>b√∫fer de v√©rtices</em> ;  La informaci√≥n sobre la figura que forman se codifica directamente en el programa de representaci√≥n o se almacena en otro bloque de memoria llamado <em>b√∫fer de √≠ndice</em> . <br><br>  Si la informaci√≥n se codifica en un programa de representaci√≥n, las diversas formas que pueden formarse mediante v√©rtices se denominan <em>primitivas</em> .  Direct3D sugiere usar una lista para ellos, tiras y abanicos en forma de puntos, l√≠neas y tri√°ngulos.  Cuando se usan correctamente, las franjas de tri√°ngulos usan v√©rtices para m√°s de un tri√°ngulo, lo que mejora la productividad.  En el siguiente ejemplo, vemos que para crear dos tri√°ngulos conectados entre s√≠, solo se necesitan cuatro v√©rtices; si est√°n separados, entonces necesitamos seis v√©rtices. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/41e/9cb/a1e/41e9cba1ee23a0b9787994ef7249d6ff.png"></div><br>  <i>De izquierda a derecha: lista de puntos, lista de l√≠neas y franja de tri√°ngulos.</i> <br><br>  Si necesitamos procesar un conjunto m√°s grande de v√©rtices, por ejemplo, en un modelo de NPC del juego, entonces es mejor usar un objeto llamado <em>malla</em> , otro bloque de memoria, pero que consta de varios b√∫feres (v√©rtices, √≠ndices, etc.) y recursos de textura del modelo .  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n en l√≠nea</a> de Microsoft tiene una breve explicaci√≥n de c√≥mo usar estos b√∫feres. <br><br>  Por ahora, concentr√©monos en lo que les sucede a estos v√©rtices en un juego en 3D al renderizar cada nuevo cuadro.  En resumen, realizan una de dos operaciones: <br><br><ul><li>  El v√©rtice se mueve a una nueva posici√≥n. </li><li>  Cambios de color en el v√©rtice </li></ul><br>  Listo para las matematicas?  Excelente, porque lo necesitamos. <br><br><h2>  Vector aparece en el escenario. </h2><br>  Imagine que tiene un tri√°ngulo en la pantalla y presiona una tecla para moverlo hacia la izquierda.  Naturalmente, esperamos que los n√∫meros ( <em>x, y, z</em> ) de cada v√©rtice cambien en consecuencia;  eso es lo que sucede, pero es una forma bastante inesperada <em>de</em> implementar cambios.  En lugar de simplemente cambiar las coordenadas, la gran mayor√≠a de los sistemas de representaci√≥n de gr√°ficos en 3D utilizan una herramienta matem√°tica especial: nos referimos a <em>vectores</em> . <br><br>  Un vector se puede representar como una flecha que apunta a un punto espec√≠fico en el espacio y que tiene la longitud deseada.  Los v√©rtices generalmente se establecen usando vectores basados ‚Äã‚Äãen coordenadas cartesianas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c5/5e4/79d/1c55e479dbf4da359cfa6ef7e3d55e8f.png"></div><br>  Observe que la flecha azul comienza en un lugar (en este caso, el <em>punto de origen</em> ) y se extiende hasta la parte superior.  Para establecer el vector, usamos un <em>registro en una columna</em> , pero es bastante posible usar un <em>registro en una fila</em> .  Es posible que haya notado que hay otro cuarto valor, com√∫nmente llamado <em>componente w</em> .  Se utiliza para mostrar lo que significa el vector: posici√≥n del punto ( <em>vector de posici√≥n</em> ) o direcci√≥n general (vector de <em>direcci√≥n</em> ).  En el caso de un vector de direcci√≥n, se ver√° as√≠: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb2/73e/525/bb273e52588aa21666075a11a34ee32d.png"></div><br>  Este vector apunta en la misma direcci√≥n y tiene la misma longitud que el vector de posici√≥n anterior, es decir, los valores ( <em>x, y, z</em> ) ser√°n los mismos;  sin embargo, el componente <em>w</em> no es 1, sino cero.  Explicaremos el uso de vectores de direcci√≥n m√°s adelante, pero por ahora, recuerde el hecho de que todos los v√©rtices en la escena 3D se describir√°n de esta manera.  Por qu√©  Porque en este formato es mucho m√°s f√°cil moverlos. <br><br><h2>  Matem√°ticas, matem√°ticas y nuevamente matem√°ticas </h2><br>  Recuerde que tenemos un tri√°ngulo simple y queremos moverlo hacia la izquierda.  Cada v√©rtice se describe mediante un vector de posici√≥n, por lo tanto, las "matem√°ticas de movimiento" (llamadas <em>transformaciones</em> ) deben funcionar con estos vectores.  Aparece una nueva herramienta: <em>matrices</em> ( <em>matriz</em> en singular).  Esta es una matriz de valores escritos en un formato similar a una hoja de c√°lculo de Excel, con filas y columnas. <br><br>  Para cada tipo de transformaci√≥n hay una matriz correspondiente, y para una transformaci√≥n es suficiente simplemente multiplicar la matriz de transformaci√≥n y el vector de posici√≥n.  No entraremos en detalles sobre c√≥mo y por qu√© sucede esto, sino que veremos c√≥mo se ve. <br><br>  Mover un v√©rtice en el espacio 3D se llama <em>traducci√≥n</em> y requiere el siguiente c√°lculo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/530/c9b/eca/530c9beca19d9b0c8d61db78ecb8682a.png"></div><br>  Valores <em>x <sub>0</sub></em> , etc.  representa las coordenadas originales del vector;  <em>Los</em> valores <em>delta</em> - <em>x</em> representan la cantidad en la cual el v√©rtice necesita ser movido.  La multiplicaci√≥n de la matriz y el vector lleva al hecho de que simplemente resumen (tenga en cuenta que el componente <em>w</em> permanece sin cambios para que la respuesta final siga siendo el vector de posici√≥n como antes). <br><br>  Adem√°s de movernos, es posible que tambi√©n necesitemos rotar el tri√°ngulo o cambiar su escala; para estas operaciones, tambi√©n hay transformaciones. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fc/ba4/d0b/1fcba4d0b2a678e94c17c49a09af0591.png"></div><br>  <i>Esta transformaci√≥n gira el v√©rtice alrededor del eje z en el plano XY</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5eb/1d5/26e/5eb1d526eb15b522f3fddb0dadffa8cf.png"></div><br>  <em>Y esto se usa si necesita cambiar la escala de la figura</em> <br><br>  Podemos usar la herramienta de gr√°ficos basada en WebGL de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Renderizado en tiempo real</a> para visualizar estos c√°lculos para toda la figura.  Comencemos con el cuadro en posici√≥n est√°ndar: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/220/5d7/3d2/2205d73d2920758e3fb11f6829cb924d.jpg"></div><br>  En esta herramienta en l√≠nea, el punto del modelo es el vector de posici√≥n, la matriz mundial es la matriz de transformaci√≥n y el punto del espacio mundial es el vector de posici√≥n para el v√©rtice transformado. <br><br>  Apliquemos varias transformaciones al cuadro: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/820/d7b/5d6/820d7b5d618f68de9446d0ee005a50da.jpg"></div><br>  En la imagen de arriba, la figura se <em>movi√≥</em> 5 unidades a lo largo de cada eje.  Estos valores se pueden ver en la √∫ltima columna de la matriz grande del medio.  El vector de posici√≥n original (4, 5, 3, 1) permanece igual que deber√≠a, pero el v√©rtice transformado ahora se mueve a (9, 10, 8, 1). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9a1/8c4/6fd/9a18c46fd6df9936f3632fd4e4b2a287.jpg"></div><br>  En esta transformaci√≥n, todo fue escalado por un factor de 2: ahora los lados de la caja se han vuelto dos veces m√°s largos.  Finalmente, mira el ejemplo de rotaci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21c/beb/340/21cbeb3409b55b736d2dd1322a1d80b0.jpg"></div><br><br>  El paralelep√≠pedo se rot√≥ a trav√©s de un √°ngulo de 45 ¬∞, pero el <em>seno</em> y el <em>coseno de</em> este √°ngulo se utilizan en la matriz.  Despu√©s de verificar una calculadora cient√≠fica, podemos ver que <em>sin (45 ¬∞)</em> = 0.7071 ..., que se redondea al valor mostrado de 0.71.  Obtenemos la misma respuesta para el valor del <em>coseno</em> . <br><br>  Las matrices y los vectores son opcionales;  Una alternativa popular para ellos, especialmente cuando manejan giros complejos, es el uso de n√∫meros complejos y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cuaterniones</a> .  Estos c√°lculos son muy diferentes de los vectores, por lo que no los consideraremos y continuaremos trabajando con las transformaciones. <br><br><h2>  Vertex Shader Power </h2><br>  En esta etapa, debemos entender que todo esto lo hacen personas que programan el c√≥digo de representaci√≥n.  Si un desarrollador de juegos usa un motor de terceros (por ejemplo, Unity o Unreal), entonces todo esto ya se ha hecho por √©l;  pero si alguien hace su motor desde cero, tendr√° que realizar todos estos c√°lculos con v√©rtices. <br><br>  Pero, ¬øc√≥mo se ve todo esto en t√©rminos de c√≥digo? <br><br>  Para entender esto, utilizaremos ejemplos del incre√≠ble <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio</a> web de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Braynzar Soft</a> .  Si desea comenzar a trabajar con la programaci√≥n 3D, este es el lugar adecuado para aprender los conceptos b√°sicos, as√≠ como cosas m√°s complejas ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/726/99f/664/72699f66423a8f3094cb911bc99a18e2.png"></div><br>  Este es un ejemplo de una transformaci√≥n todo en uno.  Crea las matrices de transformaci√≥n apropiadas basadas en la entrada del teclado, y luego las aplica al vector de posici√≥n original en una operaci√≥n.  Tenga en cuenta que esto siempre se hace en el orden dado (escalado - rotaci√≥n - transferencia), porque cualquier otra forma arruinar√° completamente el resultado. <br><br>  Dichos bloques de c√≥digo se denominan <em>sombreadores de v√©rtices</em> , su complejidad y tama√±o pueden variar enormemente.  El ejemplo anterior es simple, es <em>solo un</em> sombreador de v√©rtices que no utiliza la naturaleza programable completa de los sombreadores.  Una secuencia m√°s compleja de sombreadores podr√≠a transformar objetos en el espacio 3D, procesar su apariencia desde el punto de vista de la c√°mara de escena y luego transferir datos a la siguiente etapa del proceso de renderizado.  Considerando el orden del procesamiento de v√©rtices, estudiaremos otros ejemplos. <br><br>  Por supuesto, se pueden usar para mucho m√°s, as√≠ que cuando juegues un juego en 3D, no olvides que todo el movimiento que ves es realizado por una GPU que ejecuta comandos de sombreador de v√©rtices. <br><br>  Sin embargo, este no fue siempre el caso.  Si regresa a mediados de la d√©cada de 1990, entonces las tarjetas gr√°ficas de esa √©poca no ten√≠an la capacidad de procesar v√©rtices y primitivas de forma independiente, solo el procesador central hizo todo esto. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/954/1d1/c15/9541d1c150a6ef926d98449addf51206.jpg"></div><br>  Uno de los primeros procesadores con su propia aceleraci√≥n de hardware de este proceso fue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nvidia GeForce, lanzada en 2000</a> , y esta funcionalidad se llam√≥ <em>Hardware Transform and Lighting</em> (para abreviar, Hardware TnL).  Los procesos que este equipo pod√≠a manejar eran muy limitados en t√©rminos de equipos, pero con el lanzamiento de nuevos chips, la situaci√≥n cambi√≥ r√°pidamente.  Hoy en d√≠a, no hay un equipo separado para procesar v√©rtices, y un dispositivo hace todo a la vez: puntos, primitivas, p√≠xeles, texturas, etc. <br><br>  Por cierto, sobre la <em>iluminaci√≥n</em> : vale la pena se√±alar que vemos todo gracias a la luz, as√≠ que veamos c√≥mo se puede procesar en la etapa de v√©rtice.  Para hacer esto, debemos aprovechar lo que hablamos antes. <br><br><h2>  ¬°Luz, c√°mara, motor! </h2><br>  Imagine esta imagen: el jugador est√° parado en una habitaci√≥n oscura, iluminada por una fuente de luz a la derecha.  En el medio de la habitaci√≥n hay una gran tetera.  Es posible que necesite ayuda con esto, as√≠ que usemos el sitio web de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">representaci√≥n en tiempo real</a> y veamos c√≥mo se ve: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1a/6a4/5f4/b1a6a45f47e81bec587c4f7bda1bf3ae.jpg"></div><br>  No olvides que este objeto es un conjunto de tri√°ngulos planos conectados entre s√≠;  es decir, el plano de cada tri√°ngulo se dirigir√° en cierta direcci√≥n.  Algunos de ellos est√°n dirigidos hacia la c√°mara, algunos - al otro, algunos estar√°n distorsionados.  La luz de la fuente cae en cada plano y se refleja en un √°ngulo determinado. <br><br>  Dependiendo de d√≥nde se refleje la luz, el color y el brillo del avi√≥n pueden cambiar, y para que el color del objeto se vea bien, todo esto debe calcularse y tenerse en cuenta. <br><br>  Para comenzar, necesitamos descubrir hacia d√≥nde se dirige cada plano, y para esto necesitamos <em>el vector normal del</em> plano.  Esta es otra flecha, pero a diferencia del vector de posici√≥n, su tama√±o no es importante (de hecho, despu√©s de calcular la escala de los vectores normales siempre disminuye para que tengan una longitud de 1), y siempre se dirige <em>perpendicular</em> (en √°ngulo recto) al plano. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/228/84c/836/22884c83697e201f3b00bb7d06f6f95f.png"></div><br>  La normal al plano de cada tri√°ngulo se calcula determinando el producto vectorial de dos vectores de direcci√≥n (mostrados arriba de <strong>py</strong> <strong>q</strong> ) que forman los lados del tri√°ngulo.  De hecho, es mejor calcularlos para cada v√©rtice, y no para un tri√°ngulo, pero dado que siempre hay m√°s de los primeros que de los √∫ltimos, ser√° m√°s r√°pido calcular las normales para los tri√°ngulos. <br><br>  Habiendo recibido lo normal en la superficie, puede comenzar a considerar la fuente de luz y la c√°mara.  En la representaci√≥n 3D, las fuentes de luz pueden ser de diferentes tipos, pero en este art√≠culo consideraremos solo fuentes <em>direccionales</em> , por ejemplo, focos.  Al igual que el plano del tri√°ngulo, el foco y la c√°mara apuntar√°n en cierta direcci√≥n, algo as√≠: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a8/f24/b91/3a8f24b915d631a9608faaf106b04300.png"></div><br>  El vector de fuente de luz y el vector normal pueden usarse para calcular el √°ngulo en el que la luz cae sobre la superficie (usando la relaci√≥n entre el producto escalar de los vectores y el producto de su tama√±o).  Los v√©rtices del tri√°ngulo contendr√°n informaci√≥n adicional sobre su color y material.  El material describe lo que le sucede a la luz cuando golpea la superficie. <br><br>  Una superficie met√°lica lisa reflejar√° casi toda la luz incidente en el √°ngulo en el que cay√≥, y apenas cambiar√° el color del objeto.  El material mate √°spero dispersa la luz de una manera menos predecible y cambia ligeramente de color.  Para tener esto en cuenta, debe agregar valores adicionales a los v√©rtices: <br><br><ul><li>  Color base original </li><li>  Atributo de material ambiental: un valor que determina cu√°nta iluminaci√≥n de "fondo" puede absorber y reflejar un v√©rtice </li><li>  El atributo del material difuso es otro valor, pero esta vez determina la "rugosidad" del v√©rtice, lo que, a su vez, afecta la cantidad de absorci√≥n y reflexi√≥n de la luz dispersa. </li><li>  Atributos del material especular: dos valores que especifican el brillo del v√©rtice </li></ul><br>  Los diferentes modelos de iluminaci√≥n utilizan diferentes f√≥rmulas matem√°ticas para agrupar todos estos atributos, y el resultado del c√°lculo es el vector de iluminaci√≥n saliente.  En combinaci√≥n con el vector de la c√°mara, le permite determinar la apariencia general del tri√°ngulo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/627/648/a21/627648a213ed357982314f7ed7fdd915.jpg"></div><br>  <i>Una fuente de luz direccional ilumina muchas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">demostraciones</a> diferentes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nvidia</a></i> <br><br>  Omitimos muchos detalles detallados, y por una buena raz√≥n: abra cualquier tutorial de renderizado 3D, y ver√° que cap√≠tulos completos est√°n dedicados a este proceso.  Sin embargo, en los juegos modernos, la mayor parte de todos los c√°lculos de iluminaci√≥n y efectos de materiales se realizan en la etapa de procesamiento de p√≠xeles, por lo que volveremos a ellos en el pr√≥ximo art√≠culo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7c/8b7/3b0/d7c8b73b0185c20eb23b2a9fdee1cba6.png"></div><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥digo de ejemplo</a> B. Anguelov que muestra c√≥mo se puede procesar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">modelo de reflexi√≥n de luz de Phong</a> en el sombreador de v√©rtices.</i> <br><br>  Todo lo que examinamos arriba es hecho por sombreadores de v√©rtices, y parece que nada es imposible para ellos;  desafortunadamente esto no es as√≠.  Los sombreadores de v√©rtices no pueden crear nuevos v√©rtices, y cada sombreador debe procesar cada v√©rtice individual.  Ser√≠a conveniente si pudiera usar el c√≥digo para crear nuevos tri√°ngulos entre los que ya tenemos (para mejorar la calidad visual), y tener un sombreador que procese una primitiva completa (para acelerar el procesamiento).  Bueno, ¬°en las GPU modernas podemos hacerlo! <br><br><h2>  Por favor se√±or, quiero m√°s (tri√°ngulos) </h2><br>  Los chips gr√°ficos modernos son extremadamente potentes y capaces de realizar millones de c√°lculos de vectores de matriz por segundo;  se las arreglan f√°cilmente con una gran pila de picos a la vez.  Por otro lado, la creaci√≥n de modelos altamente detallados para renderizar es un proceso muy largo, y si el modelo se encuentra a cierta distancia de la escena, todos estos detalles se desperdiciar√°n. <br><br>  Es decir, necesitamos ordenar de alguna manera al procesador que divida una primitiva grande, por ejemplo, un tri√°ngulo plano en un conjunto de tri√°ngulos m√°s peque√±os ubicados dentro del original.  Tal proceso se llama <em>teselaci√≥n,</em> y los chips gr√°ficos ya han aprendido a realizarlo muy bien;  A lo largo de los a√±os de desarrollo, el grado de control que los programadores tienen sobre este proceso ha aumentado. <br><br>  Para ver esto en acci√≥n, utilizaremos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramienta de referencia Heaven del motor Unigine</a> , porque nos permite aplicar diferentes valores de teselaci√≥n a los modelos utilizados en la prueba. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d11/630/5fd/d116305fd0fa789635bc3631a4463829.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para comenzar, tomemos un lugar en el punto de referencia y estudiemos sin usar la teselaci√≥n. </font><font style="vertical-align: inherit;">Tenga en cuenta que los adoquines en el suelo se ven muy poco naturales: la textura utilizada es efectiva, pero parece incorrecta. </font><font style="vertical-align: inherit;">Apliquemos el mosaico a la escena: el motor Unigine lo aplica solo a partes individuales, pero la diferencia ser√° significativa.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1c/8fb/399/e1c8fb3998d448711164832c4b3af2ff.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El terreno, los bordes de los edificios y la puerta se ven mucho m√°s realistas. </font><font style="vertical-align: inherit;">Podemos ver c√≥mo se logr√≥ esto al comenzar el proceso nuevamente, pero esta vez con la selecci√≥n de todas las primitivas (es decir, en modo de estructura al√°mbrica):</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c2/691/fec/0c2691fec046708d4c65058ed3cec016.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se ve claramente por qu√© la tierra se ve tan extra√±a: ¬°es completamente plana! La puerta se fusiona con las paredes, y los bordes del edificio son paralelep√≠pedos simples. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En Direct3D, las primitivas se pueden dividir en un grupo de partes m√°s peque√±as (este proceso se denomina </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subdivisi√≥n)</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> realizando un proceso de tres pasos. Primero, los programadores escriben un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sombreador de superficie (sombreador de casco)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; de hecho, este c√≥digo crea una estructura llamada </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parche de geometr√≠a</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Puede pensarlo como un mapa que le dice al procesador d√≥nde aparecer√°n nuevos puntos y l√≠neas dentro de la primitiva inicial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luego, el bloque de teselador dentro de la GPU aplica este parche a la primitiva. Al final, se ejecuta un </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sombreador de dominio.</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calcular las posiciones de todos los v√©rtices nuevos. Si es necesario, estos datos se pueden transferir nuevamente al b√∫fer de v√©rtices para que los c√°lculos de iluminaci√≥n se puedan realizar nuevamente, pero esta vez con mejores resultados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo se ve? Vamos a lanzar la versi√≥n al√°mbrica de la escena teselada:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c0/ca9/5af/3c0ca95af3ce89f1ae854706dfd04adc.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Honestamente, establecemos un alto grado de teselaci√≥n para que la explicaci√≥n del proceso sea m√°s visible. No importa cu√°n buenos sean los chips gr√°ficos modernos, esto no se debe hacer en todas las escenas; mire, por ejemplo, la l√°mpara al lado de la puerta. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En las im√°genes con la estructura al√°mbrica desactivada, dif√≠cilmente encontrar√° diferencias a esta distancia, y vemos que tal nivel de teselaci√≥n agreg√≥ tantos tri√°ngulos que es dif√≠cil separarlos entre s√≠. Sin embargo, cuando se usa correctamente, esta funci√≥n de procesamiento de v√©rtices puede crear efectos visuales fant√°sticos, especialmente al simular colisiones de cuerpos blandos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veamos c√≥mo podr√≠a verse en t√©rminos de c√≥digo Direct3D; para esto usamos el ejemplo de otro gran sitio web, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RasterTek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqu√≠ hay un tri√°ngulo verde simple teselado en muchos tri√°ngulos peque√±os ... </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13a/3bd/3d4/13a3bd3d482f26404d92d3ab60694fa3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El </font><font style="vertical-align: inherit;">procesamiento de </font><font style="vertical-align: inherit;">v√©rtices </font><font style="vertical-align: inherit;">se realiza mediante tres sombreadores separados (vea el </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ejemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> del </font><a href=""><font style="vertical-align: inherit;">c√≥digo</font></a><font style="vertical-align: inherit;"> ): un sombreador de v√©rtices que prepara un tri√°ngulo para la teselaci√≥n, un sombreador de superficie que genera un parche y un sombreador de dominio que procesa nuevos v√©rtices. </font><font style="vertical-align: inherit;">El resultado es bastante comprensible, pero el ejemplo de Unigine demuestra tanto los beneficios potenciales como los peligros del uso generalizado de la teselaci√≥n.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Hierro" no puede soportarlo! </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øRecuerdas que dijimos que los sombreadores de v√©rtices siempre procesan cada v√©rtice de una escena? Es f√°cil entender que la teselaci√≥n puede ser un problema serio aqu√≠. Y hay muchos efectos visuales en los que necesita procesar diferentes versiones de una primitiva, pero sin crearlos desde el principio, por ejemplo, cabello, pelaje, hierba y part√≠culas de explosiones. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afortunadamente, especialmente para tales cosas, hay otro sombreador: un </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sombreador geom√©trico</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Esta es una versi√≥n m√°s limitada del sombreador de v√©rtices, pero se puede aplicar a toda la primitiva. En combinaci√≥n con la teselaci√≥n, les da a los programadores un mayor control sobre grandes grupos de v√©rtices.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/602/97d/f09/60297df09a132ab07b00140fa2a07b77.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3DMark Vantage de UL Benchmark: los sombreadores geom√©tricos procesan part√≠culas y banderas</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direct3D, como todas las API de gr√°ficos modernos, le permiten realizar muchos c√°lculos con v√©rtices. Los datos terminados pueden transferirse a la siguiente etapa del proceso de renderizado ( </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rasterizaci√≥n</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) o devolverse al grupo de memoria para que el procesador central los vuelva a </font><font style="vertical-align: inherit;">procesar </font><font style="vertical-align: inherit;">o leer para otros fines. Como dice la documentaci√≥n de Microsoft en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Direct3D</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , esto se puede implementar como una secuencia de datos:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/638/134/de2/638134de2960977f2847aab27c88df84.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paso de salida de flujo es</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> opcional, especialmente porque solo puede transferir primitivas enteras (en lugar de v√©rtices individuales) al ciclo de renderizado, pero es √∫til para efectos que requieren una gran cantidad de part√≠culas. Se puede realizar el mismo truco usando un </font><font style="vertical-align: inherit;">b√∫fer de v√©rtices </font><font style="vertical-align: inherit;">variable o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">din√°mico</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero es mejor mantener los b√∫feres de entrada sin cambios, porque cuando se abren para modificaci√≥n, el rendimiento se reduce. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El procesamiento de v√©rtices es una parte cr√≠tica del renderizado, porque determina c√≥mo se ver√° la escena desde la perspectiva de una c√°mara. En los juegos modernos, se pueden usar millones de tri√°ngulos para construir mundos, y cada uno de estos v√©rtices se transforma e ilumina de alguna manera.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bdd/760/829/bdd760829e81753b4938fd8ff3076b6d.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tri√°ngulos </font><font style="vertical-align: inherit;">Hay millones de ellos. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El procesamiento de todos estos c√°lculos y matem√°ticas puede parecer una pesadilla log√≠stica, pero los procesadores gr√°ficos (GPU) y las API est√°n dise√±ados con todo esto en mente: imagine una f√°brica que funciona perfectamente y que pasa un producto a la vez a trav√©s de la tuber√≠a de producci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">programadores</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> experimentados de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">renderizado de juegos en 3D</font></a><font style="vertical-align: inherit;"> tienen conocimientos fundamentales en matem√°ticas y f√≠sica; </font><font style="vertical-align: inherit;">usan todos los trucos y herramientas posibles para optimizar las operaciones, comprimiendo la etapa de procesamiento de v√©rtices a solo unos pocos milisegundos. </font><font style="vertical-align: inherit;">Pero esto es solo el comienzo de la construcci√≥n de un marco 3D: la siguiente etapa es la rasterizaci√≥n, luego el procesamiento extremadamente complejo de p√≠xeles y texturas, y solo entonces la imagen llega al monitor.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/472688/">https://habr.com/ru/post/472688/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../472674/index.html">Variables de entorno para proyectos de Python</a></li>
<li><a href="../472676/index.html">Creamos el departamento de jones para ayudar a los equipos principales, utilizando solo Slack, Jira y la cinta aislante azul.</a></li>
<li><a href="../472682/index.html">Retrasando el envejecimiento con sinergias de drogas en C. elegans</a></li>
<li><a href="../472684/index.html">Sorpresa fsync () PostgreSQL</a></li>
<li><a href="../472686/index.html">Video Studio basado en i486</a></li>
<li><a href="../472690/index.html">Novedades de Zabbix 4.4</a></li>
<li><a href="../472694/index.html">M√°s que Ceph: MCS Block Cloud Storage</a></li>
<li><a href="../472702/index.html">JH Rainwater "C√≥mo pastar gatos": razas de programadores y caracter√≠sticas de su cr√≠a</a></li>
<li><a href="../472708/index.html">Imperva revel√≥ detalles t√©cnicos del hack de Cloud WAF</a></li>
<li><a href="../472714/index.html">D√≥nde buscar trabajadores y no enamorarse del trabajador front-end: Telegram, Slack y no solo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>