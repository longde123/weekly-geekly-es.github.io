<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíé ‚õìÔ∏è üêØ Bonsai: moteur wiki familial üçü üå•Ô∏è ‚ÜôÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction lyrique 
 Un soir, mettant les choses en ordre dans un placard, je suis tomb√© sur une grande bo√Æte en carton. Elle a surv√©cu √† deux d√©m√©n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bonsai: moteur wiki familial</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438622/"><h4>  Introduction lyrique </h4><br>  Un soir, mettant les choses en ordre dans un placard, je suis tomb√© sur une grande bo√Æte en carton.  Elle a surv√©cu √† deux d√©m√©nagements et n'a pas ouvert pendant tant d'ann√©es que j'ai compl√®tement oubli√© ce qui y √©tait stock√©.  Il s'est av√©r√© qu'il y avait des photos - dans des albums, dans des enveloppes d'un magasin, et certaines √©taient comme √ßa. <br><br>  De nombreuses photographies ont √©t√© prises il y a plus de soixante-dix ans.  L'un √©tait un grand-p√®re - dans ses ann√©es d'√©tudes, encore jeune et beau, dans des lunettes absolument <i>destructrices</i> .  ¬´Wow, mon grand-p√®re portait des v√™tements hipster avant m√™me qu'ils ne deviennent courants¬ª, ai-je pens√© et j'ai involontairement souri.  Je l'ai reconnu tout de suite, mais je suis ensuite all√© voir les photos de personnes dont je ne me souviens de rien.  Dans les traits du visage, vous pouvez vaguement deviner la relation - et c'est tout. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/030/417/94a/03041794abba8a11f5c660bb249ec9fb.png"><br><br>  Quand j'avais quinze ans, ma grand-m√®re a montr√© √† plusieurs reprises ces cartes et a parl√© de ceux qui y sont repr√©sent√©s.  Malheureusement, la valeur de telles histoires n'est comprise que lorsqu'il n'y a personne pour les raconter.  √Ä cette √©poque, pour la dixi√®me fois, c'√©tait absolument inint√©ressant pour moi d'√©couter des contes moussus sur les ann√©es d'avant-guerre, je les ai fait signe et pass√© les oreilles.  Maintenant, soudain, r√©alisant pleinement qu'une partie de mon histoire familiale √©tait irr√©m√©diablement perdue, j'ai eu l'id√©e de syst√©matiser et de pr√©server ce qui restait. <br><br>  La solution id√©ale pour stocker des donn√©es familiales me semblait √™tre un hybride d'un moteur wiki et d'un album photo.  Il n'y avait pas de solutions adapt√©es toutes faites, j'ai donc d√ª √©crire la mienne.  Il s'appelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bonsai</a> et est open source sous la licence MIT.  Ensuite, il y aura une histoire sur la fa√ßon dont il est organis√© et comment l'utiliser, ainsi que l'histoire de son d√©veloppement et un peu de <i>DRAMA</i> . <a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b82/efe/8e3/b82efe8e382a652be0aa4882f500dff5.jpg"><br><br><h4>  Un autre v√©lo? </h4><br>  Aujourd'hui, il existe de nombreux outils qui vous permettent de faire des arbres g√©n√©alogiques et de cataloguer les informations sur les proches.  Ils sont conditionnellement divis√©s en deux grandes cat√©gories - les services en ligne et les applications de bureau. <br><br>  Dans le cas d'une application de bureau, la base de donn√©es est g√©n√©ralement stock√©e sous forme de fichier sur disque.  Vous ouvrez l'application et la r√©approvisionnez en mode mono-utilisateur.  Si n√©cessaire, les donn√©es peuvent √™tre export√©es pour la sauvegarde ou le transfert vers un autre syst√®me (par exemple, au format <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GEDCOM</a> ).  Parmi ceux que j'ai regard√©s, les plus agr√©ables √† utiliser semblaient <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gramps</a> (gratuit) et l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">arbre de vie</a> domestique (n√©cessite un achat unique). <br><br>  Le c√¥t√© oppos√© du spectre est les services Web.  Ils stockent vos donn√©es sur des serveurs distants et facturent des frais d'utilisation p√©riodiques.  Puisqu'il s'agit d'un produit commercial avec une base centralis√©e et une bonne mon√©tisation, les services de ce plan vous donnent la possibilit√©, par exemple, de rechercher des proches perdus par test ADN ou archives. <br><br>  Les avantages et les inconv√©nients des deux options sont assez √©vidents.  Dans le premier cas, vous stockez la base de donn√©es localement et contr√¥lez enti√®rement son acc√®s et la cr√©ation de sauvegardes.  Si l'application est open source, si n√©cessaire, vous pouvez m√™me y ajouter des fonctionnalit√©s suppl√©mentaires.  Cependant, travailler avec une telle base de donn√©es ensemble ou afficher les donn√©es d'un autre appareil sera difficile.  Dans le second, au contraire, l'acc√®s se fait depuis n'importe quel appareil, mais vous donnez vos donn√©es √† des tiers et esp√©rez leur d√©cence.  Dans l'histoire de ma famille, il n'y a pas de secrets compromettants et terribles, cependant, je consid√®re toujours ces informations comme purement personnelles et, en principe, je ne veux que personne d'autre les stocke ou les analyse. <br><br>  Compte tenu des lacunes de ces deux approches, nous pouvons formuler une liste d'exigences pour le moteur "id√©al": <br><br><ol><li>  Application Web h√©berg√©e sur votre propre serveur </li><li>  Cr√©ation d'articles sur les personnes, les animaux domestiques, les lieux, les √©v√©nements, etc.  comme un wiki </li><li>  T√©l√©charger les m√©dias </li><li>  Marques de personnes sur les photos et vid√©os </li><li>  Construction automatique de l'arbre g√©n√©alogique </li><li>  Calendrier avec toutes les dates importantes. </li><li>  Outils de co√©dition et de remplissage </li></ol><br>  Pour √™tre honn√™te, j'ai r√©ussi √† trouver plusieurs projets avec une impl√©mentation auto-h√©berg√©e, mais ils √©taient dans un √©tat d√©plorable: l'apparence s'est fig√©e au niveau du milieu des ann√©es 2000, il n'y avait pas un ensemble complet des fonctionnalit√©s n√©cessaires, mais je ne voulais pas creuser dans les scripts h√©rit√©s en PHP.  De plus, le pr√©c√©dent projet pour animaux de compagnie √©tait termin√© et il y avait un d√©sir de prendre quelque chose de nouveau. <br><br>  La r√®gle d'or dit: <i>si vous voulez bien faire, faites-le vous-m√™me!</i> <br><br>  Les technologies utilis√©es ont √©t√© s√©lectionn√©es selon trois crit√®res: mon exp√©rience avec elles, leur popularit√© et leur ouverture.  Voici le r√©sultat: <br><br><ul><li>  <b>Rantime</b> : .NET Core 2.1 </li><li>  <b>Backend</b> : ASP.NET Core MVC </li><li>  <b>Base de donn√©es</b> : PostgreSQL </li><li>  <b>Logique frontend</b> : partiellement Vue, partiellement jQuery. </li><li>  <b>Styles frontaux</b> : Bootstrap + Sass </li></ul><br>  Les r√¥les de support incluent Elasticsearch pour la recherche en texte int√©gral et ffmpeg pour prendre des captures d'√©cran de la vid√©o. <br><br><h4>  Sch√©ma de donn√©es </h4><br>  Les principaux objets de la base de donn√©es Bonsai sont une <i>page</i> et un <i>fichier multim√©dia</i> .  Ils sont reli√©s par une relation plusieurs-√†-plusieurs √† travers des <i>marques</i> .  Un tag peut avoir un titre sans lien - par exemple, si vous avez besoin de taguer quelqu'un sur une photo, mais il n'y a pas d'informations sur une page compl√®te √† ce sujet. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b7/c75/f0c/8b7c75f0c97b58cee523f9984000e37f.png"><br><br>  En plus du texte libre, la page peut contenir des <i>faits</i> entr√©s dans des champs sp√©ciaux du panneau d'administration.  Des faits suppl√©mentaires sont calcul√©s sur les faits: par exemple, si vous indiquez la date de naissance de la personne, elle sera indiqu√©e sur le calendrier, et sa page affichera l'√¢ge actuel (ou l'esp√©rance de vie, si la date de d√©c√®s est √©galement indiqu√©e), le sexe peut √™tre utilis√© pour d√©terminer le nom correct de la relation (`` p√®re ¬ªOu¬´ m√®re ¬ªau lieu des¬´ parents ¬ªcourants), etc.  Les faits sont stock√©s dans la base de donn√©es en tant que document JSON. <br><br>  Vous avez le choix entre cinq types de pages: personne, animal, √©v√©nement, lieu, etc.  La liste des faits disponibles d√©pend du type de page: par exemple, ¬´l'√©ducation¬ª n'est pertinente que pour une personne, ¬´la date de naissance¬ª est pour une personne et un animal, et ¬´l'adresse¬ª est uniquement pour un lieu. <br><br>  Les pages sont interconnect√©es par des <i>relations</i> : ¬´parent¬ª, ¬´conjoint¬ª, ¬´ami¬ª, ¬´propri√©taire¬ª, ¬´r√©sident¬ª et bien d'autres.  Certaines relations peuvent √™tre limit√©es dans le temps (conjoint, propri√©taire, r√©sident), d'autres sont consid√©r√©es comme permanentes. <br><br>  Lorsque vous enregistrez une page ou une relation, la coh√©rence du mod√®le r√©sultant est v√©rifi√©e.  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les ann√©es de vie des conjoints doivent se chevaucher</a> , une personne ne peut pas avoir plus d‚Äôun parent biologique de chaque sexe et vous ne pouvez pas non plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">devenir votre propre p√®re</a> .  Les mariages homosexuels sont cependant autoris√©s. <br><br>  La modification d'une page, d'un fichier multim√©dia ou d'une relation enregistre la <i>modification</i> dans la base de donn√©es.  Cela vous permet de sauvegarder l'historique des modifications et de les restaurer si n√©cessaire. <br><br><h4>  Relation </h4><br>  La parent√© est l'un des concepts les plus anciens de la soci√©t√©.  D√©j√† dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">langue pr√©-indo-europ√©enne,</a> il y avait beaucoup de noms pour eux, qui, sous une forme l√©g√®rement modifi√©e, ont migr√© vers les langues modernes de divers groupes: le mot ¬´m√®re¬ª sera compris par le russe, l'anglais et le chinois. <br><br>  Il existe de nombreuses options de parent√©, mais les options de base sont trois: <i>parent</i> , <i>enfant</i> et <i>conjoint</i> .  Ils vous permettent de construire un graphique dirig√© √† partir de la famille o√π ces relations sont des ar√™tes et les personnes sont des n≈ìuds.  Dans cette colonne, vous pouvez exprimer toute autre relation, en connaissant le chemin entre les participants et leur sexe: par exemple, pour identifier le grand-p√®re de quelqu'un, vous devez d'abord trouver son parent (n'importe quel sexe), puis le parent de ce parent (homme), etc. <br><br>  Dans le panneau d'administration Bonsai, vous pouvez saisir les relations de ces trois types de base.  L'inverse sera automatiquement cr√©√© pour chaque relation - parent pour enfant, conjoint pour conjoint, propri√©taire pour animal de compagnie.  Toutes les relations suppl√©mentaires sont calcul√©es par le moteur et affich√©es dans la barre lat√©rale de la page: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/242/d23/4a4/242d234a49a7c7a75788e384d82b8950.png"><br><br>  Pour calculer la relation, un parcours de graphe √©l√©mentaire est utilis√© et les noms de relation sont d√©finis sous la forme d'un DSL sp√©cial: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> RelationDefinition[] ParentRelations = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Child:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Child:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Parent:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Parent Parent:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) };</code> </pre> <br>  M√™me une personne peut avoir de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nombreux</a> parents directs.  Bonsai divise les liens dans les groupes suivants: <br><br><ol><li>  <b>La relation de sang la plus proche</b> est la famille dans laquelle la personne a grandi: m√®re et p√®re, grands-parents, fr√®res et s≈ìurs.  Si vous regardez le graphique, c'est le chemin 1-2 √©tapes vers le haut et 1 lat√©ralement. </li><li>  <b>Propre famille</b> : un groupe pour chaque conjoint et ses enfants.  Cela comprend √©galement les proches du conjoint - belle-m√®re, beau-fr√®re et autres. </li><li>  <b>Autre</b> : parents plus √©loign√©s (petits-enfants, oncles, tantes) et liens de parent√© (amis, coll√®gues). </li></ol><br>  Parfois, une fa√ßon de d√©terminer l'appartenance √† un groupe n'est pas suffisante.  Les donn√©es peuvent √™tre incompl√®tes, mais elles doivent encore √™tre pr√©sent√©es de mani√®re aussi ad√©quate que possible.  Consid√©rez le graphique fr√®re suivant: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a2a/47a/9c7/a2a47a9c749012092d863bcb52c399bf.png"><br><br>  Comme nous le voyons, deux femmes (Vera et Galina) et un fils (Boris) sont indiqu√©s pour Alexander, mais nous ne savons pas laquelle des femmes est la m√®re de l'enfant - c'est peut-√™tre une sorte de troisi√®me femme, mais elle n'a pas encore √©t√© ajout√©e.  Dans de tels cas, plusieurs chemins peuvent √™tre indiqu√©s qui devraient exister ou ne pas exister, et ils sont marqu√©s respectivement par les signes <code>+</code> et <code>-</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Spouse Child+Child"</span></span>, <span class="hljs-string"><span class="hljs-string">"||"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Spouse Child-Child:m"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RelationDefinition(<span class="hljs-string"><span class="hljs-string">"Spouse Child-Child:f"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)</code> </pre><br><h4>  Arbre g√©n√©alogique </h4><br>  Tout moteur de g√©n√©alogie d√©cent devrait pouvoir construire un arbre g√©n√©alogique.  C'est le moyen le plus visuel de montrer des informations g√©n√©rales sur les personnes et leurs relations familiales.  Les donn√©es sont stock√©es dans la base de donn√©es sous la forme d'un graphique dirig√© et, en th√©orie, elles devraient √™tre faciles √† visualiser.  En pratique, c'est avec l'√©talage de l'arbre que la plupart des difficult√©s sont apparues. <br><br>  Voici quelques exemples de ce √† quoi pourraient ressembler les arbres g√©n√©alogiques: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eab/d88/aad/eabd88aadfe933595863249db8a269d5.png"><br><br>  Arbre g√©n√©alogique de Targaryenov.  Tr√®s compact, car il est fait √† la main.  La g√©n√©ration d'un tel arbre √† partir de donn√©es arbitraires sera extr√™mement difficile automatiquement. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9bd/be7/d2d/9bdbe7d2dd44d9ade8a9906e4b93fdd5.png"><br><br>  Dieux grecs.  La repr√©sentation graphique est g√©n√©r√©e √† partir d'une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">syntaxe de d√©marque sp√©ciale</a> , dans laquelle vous devez toujours organiser manuellement tous les blocs et dessiner les liens entre eux.  Un peu comme l'art ASCII. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d2/6d7/11b/7d26d711b2ca68ac6f9b0f364fe30f3a.png"><br><br>  Pr√©sentation d'un arbre sous forme de diagramme semi-circulaire.  G√©n√©r√© facilement et automatiquement, mais ne prend en compte que les anc√™tres directs. <br><br>  J'ai examin√© de nombreuses options.  Le plus esth√©tique est sur le site MyHeritage: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/42b/0e9/73b/42b0e973bd48a5faaab3ee06758358d9.png"><br><br>  Le rendu d'un tel arbre peut √™tre divis√© en trois √©tapes conditionnelles: obtenir des donn√©es de la base de donn√©es, organiser des blocs / lignes de connexion et les afficher directement sur la page.  Si tout √©tait trivial avec les premi√®re et troisi√®me √©tapes, alors dans la seconde j'ai tr√©buch√©. <br><br>  Les tentatives de lancer une solution faite √† la h√¢te se sont sold√©es par un fiasco complet.  Un arrangement comp√©tent des √©l√©ments graphiques est un domaine si complexe que les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dissertations sont √©crites</a> dessus, et les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">composants finis</a> sont comme un appartement √† Moscou.  D'accord, vous ne pourrez pas vous √©crire, mais il existe s√ªrement des solutions gratuites d√©centes? <br><br>  La plupart de mes espoirs √©taient dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que D3.js.</a>  C'est peut-√™tre la premi√®re chose qui vous vient √† l'esprit si vous devez dessiner un graphique ou un graphique sur une page Web.  H√©las, parmi plus de trois cents (!) Exemples sur le wiki, il n'y en avait pas un de plus ou moins similaire √† un arbre avec MyHeritage. <br><br>  L'√©tape suivante consistait √† plonger dans des biblioth√®ques qui n'√©taient pas impliqu√©es dans le rendu, mais dans le calcul de la disposition optimale des √©l√©ments dans le graphique.  La plupart d'entre eux proposent ce que l'on appelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la mise en page Force</a> .  Il s'agit d'une approche tr√®s simple, bas√©e sur des formules physiques: les n≈ìuds du graphe sont repr√©sent√©s par des corps √©lastiques, et les lignes de connexion sont repr√©sent√©es par des ressorts.  Il peut √™tre facilement reconnu par son animation caract√©ristique - le graphique semble "se redresser" en cours de route, et ce n'est pas une caract√©ristique suppl√©mentaire, mais une cons√©quence in√©vitable de la nature de simulation de l'algorithme.  L'approche force-layout est bonne pour visualiser des donn√©es sans hi√©rarchie claire (par exemple, les connexions dans les r√©seaux sociaux), mais l'arbre g√©n√©alogique sous cette forme semble d√©fectueux. <br><br>  Une autre option envisag√©e est la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Graphviz</a> .  Le r√©sultat de son travail peut √™tre facilement reconnu par les fl√®ches caract√©ristiques.  Un langage sp√©cial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DOT est</a> utilis√© pour d√©crire le graphique.  Les cas de test semblent encore plus ou moins, mais des probl√®mes surviennent avec des donn√©es r√©elles: les fl√®ches se "cassent" et se connectent √† des angles √©tranges, le graphique grimpe et vous ne pouvez pas l'ajuster et vous ne pourrez pas le contourner. <br><br>  N'ayant pas trouv√© de solution adapt√©e par moi-m√™me, j'ai d√©cid√© de la commander en freelance, puis le <i>DRAMA a</i> commenc√©. <br><br>  La commande a √©t√© pass√©e dans la matin√©e du 22 octobre et en moins d'une heure, elle a re√ßu plusieurs r√©ponses.  L'un des r√©pondants s'appelait Vladislav;  il a envoy√© un exemple d'une solution similaire et a promis de terminer la t√¢che en <i>une journ√©e</i> .  Cette vitesse me paraissait suspecte, mais j'esp√©rais son exp√©rience et √† moi-m√™me donn√© au gars une erreur d'une semaine.  Les premiers jours, Vladislav a pos√© des questions suppl√©mentaires, sans cesse me surprendre par une immersion profonde dans le projet et une attitude attentive aux d√©tails, puis il a disparu.  Il s'est r√©veill√© le 1er novembre, s'est excus√© pour la disparition forc√©e pour des raisons familiales et a envoy√© un lien avec une version b√™ta qui ressemblait assez √† ce qu'il voulait s'il n'y avait pas le n≈ìud dans les lignes de connexion au centre: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/79e/402/bda/79e402bda04af7142d02273b7969ff1c.png"><br><br>  La disparition de l'interpr√®te est toujours un r√©veil, mais on ne sait jamais, il se passe quelque chose, car il a fait quelque chose.  Laissez-le continuer!  J'ai envoy√© un pr√©paiement et j'ai commenc√© √† attendre des am√©liorations.  Apr√®s quelques jours, Vladislav a √©crit qu'il ne pouvait pas r√©soudre le probl√®me, puis a de nouveau disparu - cette fois pendant trois semaines.  Pendant ce temps, il n'a rien fait et a refus√© de rembourser l'avance, car "la t√¢che a en fait √©t√© accomplie par un <i>stupide ex-ami</i> qui l'a laiss√© tomber et n'a pas rendu son argent".  Apr√®s quelques √©claircissements, le malheureux d√©l√©gu√© a cess√© d'essayer de s'excuser et s'est simplement tut.  Alors maintenant, nous vivons - de temps en temps, je lui rappelle la dette, et en r√©ponse, il envoie une capture d'√©cran de l'application bancaire - ils disent: "il n'y a pas d'argent, mais d√®s que - donc tout de suite".  Je souhaite √† Vladislav de r√©ussir en affaires et de devenir riche plus rapidement! <br><br>  <i>Jet√© l'enfant - moins dans le karma!</i> <br><br>  Perdre de l'argent n'√©tait pas si ennuyeux, mais un mois s'est √©coul√©, et la t√¢che n'a pas d√©coll√©, et maintenant il n'y avait nulle part o√π attendre de l'aide.  Tout d'abord, j'√©tais en col√®re contre moi-m√™me: j'ai pris le chemin de la moindre r√©sistance, viol√© la <i>r√®gle d'or</i> - et voici le r√©sultat.  Rempli de col√®re juste, je me suis de nouveau assis pour √©tudier les biblioth√®ques pour dessiner des graphiques et - voil√†!  - soudainement trouv√© exactement ce dont vous avez besoin. <br><br>  La biblioth√®que s'appelait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Eclipse Layout Kernel</a> , en abr√©g√© ELK.  Comme vous pouvez le deviner, il est utilis√© pour afficher des diagrammes dans l'IDE Eclipse, mais il peut √©galement √™tre utilis√© de mani√®re autonome.  En g√©n√©ral, il est √©crit en Java, mais il existe une version diffus√©e en JS.  Oui, son code est un <a href="">cauchemar</a> et p√®se un an et demi m√©gaoctets, mais ces lacunes peuvent √™tre pardonn√©es pour le fait que cela <i>fonctionne</i> et fait exactement la bonne chose.  L'interface est √©l√©mentaire: les n≈ìuds, les bords et les param√®tres sont transmis √† l'entr√©e, et √† la sortie, nous obtenons les coordonn√©es.  Vous pouvez dessiner un arbre en les utilisant de n'importe quelle mani√®re pratique: j'ai choisi SVG pour relier les lignes et les divisions avec un positionnement absolu pour les blocs. <br><br>  L'int√©gration de la biblioth√®que et la s√©lection des param√®tres optimaux ont pris deux nuits sur la force.  Bien s√ªr, ce n'est pas ¬´un jour¬ª, comme l'a promis mon pigiste malchanceux et arrogant, mais assez proche.  En cons√©quence, Bonsai a pu afficher l'arbre sous cette forme approximative: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57a/f67/bdc/57af67bdcd299bb1f995aa73e09d0fd5.png"><br><br>  Maintenant, le seul probl√®me qui reste est le temps de traitement.  ELK utilise un algorithme it√©ratif: vous pouvez vous rapprocher d'un placement optimal en passant du temps suppl√©mentaire.  Sur un arbre de 20-30 √©l√©ments, un bon r√©sultat n√©cessite environ 5 secondes.  Pour cette raison, une page avec un arbre s'ouvre √† chaque fois pendant longtemps, et elle commence rapidement √† ennuyer.  Par la prochaine version, le calcul sera transf√©r√© au backend afin qu'il puisse √™tre fait une fois lors du changement de page et de la mise en cache. <br><br><h4>  Recherche plein texte </h4><br>  Un syst√®me de stockage d'informations textuelles serait inutile sans une recherche en texte int√©gral pratique.  Bonsai utilise la base de donn√©es PostgreSQL, donc la premi√®re chose que j'ai d√©cid√© a √©t√© de v√©rifier ce qu'il pouvait offrir d√®s le d√©part.  Autre d√©ception: <code>tsvector</code> les mots ordinaires, mais refuse de rechercher la chose la plus importante - les noms et pr√©noms: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> to_tsvector(<span class="hljs-string"><span class="hljs-string">''</span></span>) @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-comment"><span class="hljs-comment">-- true to_tsvector('') @@ to_tsquery(''), -- false to_tsvector('') @@ to_tsquery(''), -- false to_tsvector('') @@ to_tsquery(''), -- false to_tsvector('  ') @@ to_tsquery('') -- false</span></span></code> </pre><br>  Les trigrammes ne donnent rien de bon non plus.  Au final, j'ai opt√© pour une option plut√¥t attendue: ElasticSearch + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Russian Morphology</a> .  Il s'est av√©r√© tr√®s g√™nant de travailler avec .NET, cependant, il fait face √† la recherche d'un cinq solide avec son nom complet. <br><br><h4>  Imperfection consciente </h4><br>  Lorsque l'on travaille sur un projet, des situations se produisent r√©guli√®rement lorsqu'un <i>perfectionniste interne</i> est furieux de la solution choisie.  Le sujet est plut√¥t atypique et les ¬´bonnes mani√®res¬ª g√©n√©ralement accept√©es ne fonctionnent pas toujours. <br><br>  Par exemple, que se passe-t-il lorsque nous ouvrons une page? <br><br><ol><li>  Le texte de la page est compil√© de Markdown en HTML.  Si le texte contient des liens vers d'autres pages et fichiers multim√©dias, vous devrez vous rendre dans la base de donn√©es pour plus d'informations. </li><li>  Les faits sont d√©s√©rialis√©s du JSON dans lequel ils sont stock√©s dans la base de donn√©es, dans le mod√®le de vue. </li><li>  Les relations sont d√©termin√©es.  Pour ce faire, √† partir de la base de donn√©es qui souffre depuis longtemps, il est n√©cessaire d'obtenir l' <i>int√©gralit√© du graphique de connexion</i> et d'y trouver des n≈ìuds selon une liste de chemins pr√©c√©demment connue. </li></ol><br>  √Ä premi√®re vue, cela semble √™tre une op√©ration terriblement difficile, mais en fait ce n'est pas √† cause de la quantit√© relativement faible de donn√©es.  De combien de parents vous souvenez-vous et voulez-vous √©crire?  Essayez de les raconter par int√©r√™t et trouvez qu'il sera tr√®s difficile de composer au moins une centaine.  Et combien de personnes veulent donner acc√®s?  M√™me un nombre astronomiquement √©lev√© pour une famille, c'est mille personnes!  - Selon les standards des bases de donn√©es modernes, cela reste ridicule. <br><br>  Bien s√ªr, le mod√®le de vue de page compil√© est toujours mis en cache la premi√®re fois qu'il est ouvert et r√©utilis√© sur les mod√®les suivants, principalement parce qu'il √©tait tr√®s facile √† impl√©menter.  La r√®gle d'invalidation du cache pour les modifications dans le panneau d'administration est √©galement prise aussi simple que possible: si nous ne modifions que le texte et certains faits <i>locaux</i> (liste des langues, type de sang, couleur des cheveux, etc.), il suffit de r√©initialiser cette page sp√©cifique.  Avec tout autre changement - nom de la page, date de naissance ou sexe, ajout ou modification d'une connexion - le cache est <i>compl√®tement</i> r√©initialis√©.  Oui, ce n'est pas le moyen le plus intelligent de nettoyer.  Oui, bien s√ªr, vous pourriez √©crire un algorithme complexe qui ne r√©initialiserait que ce dont vous avez besoin - mais pour ce projet, cela ne justifierait pas les co√ªts. <br><br>  Le projet ne prend pas en charge la localisation et le changement d'apparence, l'autorisation fonctionne sur OAuth sur Facebook \ Google, et le panneau d'administration est fait sur les formulaires habituels, et pas sur un cadre SPA bas√© sur la derni√®re mode.  Tout cela <i>pourrait √™tre</i> r√©alis√© ou am√©lior√©, mais cela n'aurait r√©solu aucun probl√®me, et donc du temps aurait √©t√© perdu. <br><br><h4>  Un regard vers l'avenir </h4><br>  Une autre raison pour laquelle cela n'a aucun sens d'investir dans la complexit√© du dispositif moteur est la nature √©ph√©m√®re de la mise en ≈ìuvre par rapport aux donn√©es qu'il stocke.  R√©fl√©chissez un instant: le Web dans sa forme actuelle existe depuis pr√®s de vingt ans, et l'histoire de la famille existe depuis <i>des si√®cles</i> .  Personne n'a encore r√©solu ce probl√®me simplement parce que l'industrie des technologies de l'information elle-m√™me existe beaucoup moins.  Que peut-on faire? <br><br>  Le moteur devra √™tre r√©√©crit r√©guli√®rement √† partir de z√©ro - tout comme pendant des milliers d'ann√©es, les moines ont √©t√© durs pour copier des textes de livres d√©labr√©s vers de nouveaux.  La seule diff√©rence est que le livre peut mentir cent ans avec une bonne manipulation et l'application - sur la force de 15-20 ans.  J'esp√®re que dans vingt ans, je pourrai encore le faire moi-m√™me, mais dans vingt ans, mes enfants ou petits-enfants devront le faire.  Je voudrais leur laisser une source simple, compr√©hensible et document√©e. <br><br>  Aux toutes premi√®res √©tapes de la conception, j'ai voulu int√©grer un certain langage de type SQL dans le moteur, √† l'aide duquel j'ai pu obtenir des r√©ponses √† des questions sp√©cifiques: ¬´quel est le pourcentage de mes anc√™tres aux yeux bleus¬ª, ¬´quand Ivan a achet√© la premi√®re voiture¬ª et ainsi de suite.  Cette id√©e a d√ª √™tre abandonn√©e car il faudrait au lieu du texte brut entrer toutes les informations sous une forme formalis√©e, et seule une description de ce type prendrait des ann√©es.  D'un autre c√¥t√©, la compr√©hension du langage naturel prend de l'ampleur.  Je ne serai pas surpris si dans dix ou deux ans il sera possible de demander √† Siri de lire le texte pour vous, de suivre les liens et, par cons√©quent, de pr√©senter un extrait des faits.  Les gars, poussez! <br><br><h4>  Comment essayer? </h4><br>  Malheureusement, je ne peux pas fournir de lien vers la d√©mo termin√©e: aucun serveur ne peut r√©sister √† l‚Äôeffet habra.  Mais il y a quelques captures d'√©cran visuelles (les images sont cliquables). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/161/06a/0d0/16106a0d0a093a140c5095b472f847b5.png"></a> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/92e/c5b/798/92ec5b798673b928cf0e7ad6755bbc0d.png"></a> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/350/041/c9d/350041c9d3943b630474931f60f794bf.png"></a> <br><br>  Si Bonsai vous a sembl√© utile et que vous souhaitez l'ex√©cuter vous-m√™me, le code source peut √™tre t√©l√©charg√© depuis Github: <br><br>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/impworks/bonsai</a></strong> <br><br>  Des instructions d'installation d√©taill√©es sont fournies dans le fichier Lisez-moi.  Vous en aurez besoin: <br><br><ol><li>  .NET Core 2.1+ </li><li>  PostgreSQL 10+ </li><li>  ElasticSearch 5.x et le plugin russe de morphologie </li><li>  Application Facebook ou Google pour l'autorisation oAuth </li></ol><br>  Apr√®s le premier lancement, plusieurs pages de test et photos sont cr√©√©es dans la base de donn√©es.  Pour la production, ce comportement n'est pas n√©cessaire et est d√©sactiv√© par l'indicateur dans les param√®tres. <br><br>  Il y a tout juste un mois, j'ai lanc√© ma propre instance et j'ai commenc√© √† l'ex√©cuter, obtenant des donn√©es r√©elles.  Une certaine rugosit√© est rencontr√©e, mais sinon je suis compl√®tement satisfait du r√©sultat.  Maintenant, le projet sera progressivement d√©velopp√© et finalis√©.  Les t√¢ches principales consistent √† acc√©l√©rer l'affichage de l'arborescence, √† permettre le t√©l√©chargement de documents sous forme de PDF et √† affiner les droits d'acc√®s.  Ce serait bien d'am√©liorer la convivialit√© du panneau d'administration √† certains endroits ou de reconna√Ætre automatiquement les visages sur la photo - <i>mais ce n'est pas exact</i> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438622/">https://habr.com/ru/post/fr438622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438606/index.html">D√©gradation gracieuse. Signaler Yandex.Taxi</a></li>
<li><a href="../fr438610/index.html">Mod√®les Figma r√©actifs: cr√©ation d'un composant de conception flexible pour la navigation mobile iOS</a></li>
<li><a href="../fr438614/index.html">Qu'est-ce qu'une animation inactive de qualit√©? Les d√©veloppeurs partagent leurs exemples pr√©f√©r√©s.</a></li>
<li><a href="../fr438618/index.html">Faire un projecteur laser de texte bricolage</a></li>
<li><a href="../fr438620/index.html">Mon chemin en tant que d√©veloppeur de jeux novice</a></li>
<li><a href="../fr438624/index.html">Nous programmons le passage par passage. MicroPython sur esp8266 (sonoff) avec OTA. Partie 1</a></li>
<li><a href="../fr438626/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 284 (28 janvier - 3 f√©vrier)</a></li>
<li><a href="../fr438628/index.html">Notification d'√©tat de changement de composant SharedState</a></li>
<li><a href="../fr438630/index.html">Google+ Sic transit gloria mundi ...</a></li>
<li><a href="../fr438632/index.html">Hardcore 2D RPG Gamedev Diaries, vol.0 - INTRO, ou "Comment je suis arriv√© ici"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>