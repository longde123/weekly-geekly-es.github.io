<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüíª üëá üßöüèª Como o Trojan Gustuff Android remove o creme (decreto e criptografia) de suas contas üéÖ üë®‚Äçüë®‚Äçüëß‚Äçüë¶ üî∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Outro dia, o Group-IB informou sobre a atividade do Trojan Gustuff para celular Android. Trabalha exclusivamente nos mercados internacionais, atacando...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o Trojan Gustuff Android remove o creme (decreto e criptografia) de suas contas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/446948/"><img src="https://habrastorage.org/webt/b9/hn/wr/b9hnwrlclblkmurq29bkezeanui.png"><br><br>  Outro dia, o Group-IB <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">informou</a> sobre a atividade do Trojan Gustuff para celular Android.  Trabalha exclusivamente nos mercados internacionais, atacando clientes dos 100 maiores bancos estrangeiros, usu√°rios de 32 carteiras criptogr√°ficas m√≥veis, al√©m de grandes recursos de com√©rcio eletr√¥nico.  Mas o desenvolvedor do Gustuff √© um cibercriminoso de l√≠ngua russa sob o apelido de Bestoffer.  At√© recentemente, ele elogiava seu cavalo de Troia como "um produto s√©rio para pessoas com conhecimento e experi√™ncia". <br><br>  <b>Ivan Pisarev,</b> especialista em an√°lise de c√≥digos maliciosos do Group-IB, em sua pesquisa, detalhadamente sobre como o Gustuff funciona e qual √© o seu perigo. <a name="habracut"></a><br><br><h2>  Quem est√° procurando Gustuff? </h2><br>  Gustuff √© uma nova gera√ß√£o de malware com recursos totalmente automatizados.  Segundo o desenvolvedor, o trojan se tornou uma nova vers√£o aprimorada do malware AndyBot, que desde novembro de 2017 ataca telefones Android e rouba dinheiro por meio de formul√°rios da web de phishing que se disfar√ßam de aplicativos m√≥veis de bancos e sistemas de pagamento internacionais conhecidos.  Bestoffer informou que o pre√ßo do aluguel do Gustuff Bot era de US $ 800 por m√™s. <br><br>  A an√°lise da amostra Gustuff mostrou que o Trojan √© potencialmente direcionado a clientes que usam aplicativos m√≥veis dos maiores bancos, como Bank of America, Bank of Scotland, JPMorgan, Wells Fargo, Capital One, TD Bank, PNC Bank, al√©m de Bitcoin Wallet, BitPay Wallet e Crypto Wallet. , Cryptopay, Coinbase, etc. <br><br>  Originalmente criada como um Trojan banc√°rio cl√°ssico, a vers√£o atual do Gustuff expandiu significativamente a lista de poss√≠veis alvos para ataques.  Al√©m dos aplicativos Android de bancos, empresas de fintech e servi√ßos de criptografia, o Gustuff √© voltado para usu√°rios de aplicativos de mercado, lojas on-line, sistemas de pagamento e mensagens instant√¢neas.  Em particular, PayPal, Western Union, eBay, Walmart, Skype, WhatsApp, Gett Taxi, Revolut e outros. <br><br><h2>  Ponto de entrada: c√°lculo para infec√ß√£o em massa </h2><br>  Gustuff √© caracterizado pelo vetor "cl√°ssico" de penetra√ß√£o em smartphones Android atrav√©s de envio por SMS com links para APKs.  Se o dispositivo Android estiver infectado com um trojan ao comando do servidor, o Gustuff poder√° se espalhar ainda mais pelo banco de dados de contatos do telefone infectado ou pelo banco de dados do servidor.  A funcionalidade do Gustuff foi projetada para infec√ß√µes maci√ßas e capitaliza√ß√£o m√°xima dos neg√≥cios de suas operadoras - ela tem uma fun√ß√£o exclusiva de "preenchimento autom√°tico" em aplicativos banc√°rios m√≥veis leg√≠timos e cripto-carteiras, o que permite acelerar e escalar o roubo de dinheiro. <br><br>  O estudo do Trojan mostrou que a fun√ß√£o de preenchimento autom√°tico foi implementada usando o Servi√ßo de Acessibilidade - um servi√ßo para pessoas com defici√™ncia.  O Gustuff n√£o √© o primeiro cavalo de Troia que ignora com √™xito a prote√ß√£o contra a intera√ß√£o com os elementos da janela de outros aplicativos usando este servi√ßo Android.  No entanto, o uso do Servi√ßo de Acessibilidade em conjunto com o carregamento autom√°tico ainda √© bastante raro. <br><br>  Depois de baixar a v√≠tima para o telefone, o Gustuff, usando o Servi√ßo de Acessibilidade, tem a oportunidade de interagir com os elementos da janela de outros aplicativos (banco, criptomoeda, al√©m de aplicativos para compras online, mensagens etc.), executando as a√ß√µes necess√°rias para os atacantes.  Por exemplo, ao comando do servidor, o trojan pode clicar nos bot√µes e alterar os valores dos campos de texto nos aplicativos banc√°rios.  O uso do mecanismo do Servi√ßo de Acessibilidade permite que o trojan ignore os mecanismos de prote√ß√£o usados ‚Äã‚Äãpelos bancos para combater os cavalos de Troia m√≥veis da gera√ß√£o anterior, bem como as mudan√ßas na pol√≠tica de seguran√ßa introduzida pelo Google nas novas vers√µes do sistema operacional Android.  Portanto, Gustuff "sabe como" desativar a prote√ß√£o do Google Protect: de acordo com o autor, essa fun√ß√£o funciona em 70% dos casos. <br><br><img src="https://habrastorage.org/webt/ih/x4/1k/ihx41k2p4hqubcaaisklwvdyoy8.png"><br><br>  O Gustuff tamb√©m pode exibir notifica√ß√µes falsas de PUSH com √≠cones de aplicativos m√≥veis leg√≠timos.  O usu√°rio clica na notifica√ß√£o PUSH e v√™ uma janela de phishing baixada do servidor, onde ele pr√≥prio insere os dados solicitados de um cart√£o banc√°rio ou carteira criptogr√°fica.  Em outro cen√°rio do Gustuff, um aplicativo √© aberto em nome do qual uma notifica√ß√£o PUSH foi exibida.  Nesse caso, o programa malicioso, sob o comando do servidor por meio do Servi√ßo de Acessibilidade, pode preencher os campos do formul√°rio do aplicativo banc√°rio para uma transa√ß√£o fraudulenta. <br><br>  A funcionalidade do Gustuff tamb√©m inclui o envio de informa√ß√µes sobre um dispositivo infectado ao servidor, a capacidade de ler / enviar mensagens SMS, enviar solicita√ß√µes USSD, iniciar o SOCKS5 Proxy, seguir o link, enviar arquivos (incluindo digitaliza√ß√µes de documentos, capturas de tela, fotos) para o servidor redefina o dispositivo para as configura√ß√µes de f√°brica. <br><br><h2>  An√°lise de malware </h2><br>  Antes de instalar um aplicativo mal-intencionado, o Android OS exibe ao usu√°rio uma janela contendo uma lista dos direitos solicitados pelo Gustuff: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ku/th/ac/kuthacuzh0webqtrwhgktysougi.png" alt="imagem alt"></div><br>  A instala√ß√£o do aplicativo ocorrer√° somente ap√≥s a obten√ß√£o do consentimento do usu√°rio.  Depois de iniciar o aplicativo, o trojan mostrar√° ao usu√°rio uma janela: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hj/uq/xa/hjuqxaw2ezubek_xmd3clywhpsw.png" alt="imagem alt"></div><br>  Em seguida, ele excluir√° seu √≠cone. <br><br>  Gustuff √© empacotado, de acordo com o autor, por um empacotador de FTT.  Ap√≥s o in√≠cio, o aplicativo acessa periodicamente o servidor CnC para receber comandos.  Em v√°rios dos arquivos que examinamos, o endere√ßo IP <b>88.99.171 [.] 105 foi</b> usado como servidor de controle (a seguir, o designaremos como <b>&lt;% CnC%&gt;</b> ). <br><br>  Ap√≥s o in√≠cio, o programa come√ßa a enviar mensagens para o servidor <b>http: // &lt;% CnC%&gt; /api/v1/get.php</b> . <br><br>  Como resposta, o JSON √© esperado no seguinte formato: <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"results"</span></span> : <span class="hljs-string"><span class="hljs-string">"OK"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;%id%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt;%command%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt;%Server Timestamp%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>:{ &lt;%Command parameters as JSON%&gt; }, }, }</code> </pre> <br>  Sempre que o aplicativo envia informa√ß√µes sobre um dispositivo infectado.  O formato da mensagem √© apresentado abaixo.  Vale ressaltar que os campos <b>completos</b> , <b>extras</b> , <b>aplicativos</b> e <b>permiss√£o</b> s√£o opcionais e ser√£o enviados apenas no caso de um comando de solicita√ß√£o do CnC. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"info"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"info"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"cell"</span></span>:&lt;%Sim operator name%&gt;, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>:&lt;%Country ISO%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%IMEI%&gt;, <span class="hljs-attr"><span class="hljs-attr">"number"</span></span>:&lt;%Phone number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"line1Number"</span></span>:&lt;%Phone number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"advertisementId"</span></span>:&lt;%ID%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"state"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"admin"</span></span>:&lt;%Has admin rights%&gt;, <span class="hljs-attr"><span class="hljs-attr">"source"</span></span>:&lt;%String%&gt;, <span class="hljs-attr"><span class="hljs-attr">"needPermissions"</span></span>:&lt;%Application needs permissions%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accesByName"</span></span>:&lt;%Boolean%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accesByService"</span></span>:&lt;%Boolean%&gt;, <span class="hljs-attr"><span class="hljs-attr">"safetyNet"</span></span>:&lt;%String%&gt;, <span class="hljs-attr"><span class="hljs-attr">"defaultSmsApp"</span></span>:&lt;%Default Sms Application%&gt;, <span class="hljs-attr"><span class="hljs-attr">"isDefaultSmsApp"</span></span>:&lt;%Current application is Default Sms Application%&gt;, <span class="hljs-attr"><span class="hljs-attr">"dateTime"</span></span>:&lt;%Current date time%&gt;, <span class="hljs-attr"><span class="hljs-attr">"batteryLevel"</span></span>:&lt;%Battery level%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"socks"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%Proxy module ID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"enabled"</span></span>:&lt;%Is enabled%&gt;, <span class="hljs-attr"><span class="hljs-attr">"active"</span></span>:&lt;%Is active%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"versionName"</span></span>:&lt;%Package Version Name%&gt;, <span class="hljs-attr"><span class="hljs-attr">"versionCode"</span></span>:&lt;%Package Version Code%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lastUpdateTime"</span></span>:&lt;%Package Last Update Time%&gt;, <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>:&lt;%Tag, default value: <span class="hljs-string"><span class="hljs-string">"TAG"</span></span>%&gt;, <span class="hljs-attr"><span class="hljs-attr">"targetSdkVersion"</span></span>:&lt;%Target Sdk Version%&gt;, <span class="hljs-attr"><span class="hljs-attr">"buildConfigTimestamp"</span></span>:<span class="hljs-number"><span class="hljs-number">1541309066721</span></span> }, }, <span class="hljs-attr"><span class="hljs-attr">"full"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%Device Model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"localeCountry"</span></span>:&lt;%Country%&gt;, <span class="hljs-attr"><span class="hljs-attr">"localeLang"</span></span>:&lt;%Locale language%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accounts"</span></span>:&lt;%JSON array, contains from <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> and <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> of accounts%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lockType"</span></span>:&lt;%Type of lockscreen password%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"serial"</span></span>:&lt;%Build serial number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"board"</span></span>:&lt;%Build Board%&gt;, <span class="hljs-attr"><span class="hljs-attr">"brand"</span></span>:&lt;%Build Brand%&gt;, <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>:&lt;%Build User%&gt;, <span class="hljs-attr"><span class="hljs-attr">"device"</span></span>:&lt;%Build Device%&gt;, <span class="hljs-attr"><span class="hljs-attr">"display"</span></span>:&lt;%Build Display%&gt;, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%Build ID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"manufacturer"</span></span>:&lt;%Build manufacturer%&gt;, <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%Build model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>:&lt;%Build product%&gt;, <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span>:&lt;%Build tags%&gt;, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:&lt;%Build type%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%imei%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imsi"</span></span>:&lt;%imsi%&gt;, <span class="hljs-attr"><span class="hljs-attr">"line1number"</span></span>:&lt;%phonenumber%&gt;, <span class="hljs-attr"><span class="hljs-attr">"iccid"</span></span>:&lt;%Sim serial number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"mcc"</span></span>:&lt;%Mobile country code of operator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"mnc"</span></span>:&lt;%Mobile network codeof operator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"cellid"</span></span>:&lt;%GSM-data%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lac"</span></span>:&lt;%GSM-data%&gt;, <span class="hljs-attr"><span class="hljs-attr">"androidid"</span></span>:&lt;%Android Id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"ssid"</span></span>:&lt;%Wi-Fi SSID%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"apps"</span></span>:{&lt;%List of installed applications%&gt;}, <span class="hljs-attr"><span class="hljs-attr">"permission"</span></span>:&lt;%List of granted permissions%&gt; }</code> </pre> <br><h3>  Armazenamento de Dados de Configura√ß√£o </h3><br>  O Gustuff armazena informa√ß√µes importantes sobre o trabalho em um arquivo de prefer√™ncias.  O nome do arquivo, assim como os nomes dos par√¢metros, √© o resultado do c√°lculo da soma MD5 da linha <b>15413090667214.6.1 &lt;% name%&gt;</b> , onde <b>&lt;% name%&gt;</b> √© o valor do nome original.  Interpreta√ß√£o Python da fun√ß√£o de gera√ß√£o de nome: <br><br><pre> <code class="json hljs"> nameGenerator(input): output = md<span class="hljs-number"><span class="hljs-number">5</span></span>(<span class="hljs-string"><span class="hljs-string">"15413090667214.6.1"</span></span> + input)</code> </pre> <br>  A seguir, iremos <b>denot√°-</b> lo como <b>nameGenerator (input)</b> . <br><br>  Portanto, o nome do primeiro arquivo √©: <b>nameGenerator ("API_SERVER_LIST")</b> , cont√©m valores com os seguintes nomes: <br><br><table><tbody><tr><th width="400">  <b>Nome da vari√°vel</b> </th><th>  <b>Valor</b> </th></tr><tr><td>  <b>nameGenerator ("API_SERVER_LIST")</b> </td><td>  Cont√©m uma lista de endere√ßos CnC como uma matriz. </td></tr><tr><td>  <b>nameGenerator ("API_SERVER_URL")</b> </td><td>  Cont√©m um endere√ßo CnC. </td></tr><tr><td>  <b>nameGenerator ("SMS_UPLOAD")</b> </td><td>  O sinalizador √© definido por padr√£o.  Se o sinalizador estiver definido - envia mensagens SMS para o CnC. </td></tr><tr><td>  <b>nameGenerator ("SMS_ROOT_NUMBER")</b> </td><td>  O n√∫mero de telefone para o qual as mensagens SMS recebidas pelo dispositivo infectado ser√£o enviadas.  O padr√£o √© nulo. </td></tr><tr><td>  <b>nameGenerator ("SMS_ROOT_NUMBER_RESEND")</b> </td><td>  O sinalizador √© limpo por padr√£o.  Se instalado, quando um dispositivo infectado receber um SMS, ele ser√° enviado para o n√∫mero raiz. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_APP_SMS")</b> </td><td>  O sinalizador √© limpo por padr√£o.  Se esse sinalizador estiver definido, o aplicativo processar√° as mensagens SMS recebidas. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_ADMIN")</b> </td><td>  O sinalizador √© limpo por padr√£o.  Se o sinalizador estiver definido, o aplicativo ter√° direitos de administrador. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_ACCESSIBILITY")</b> </td><td>  O sinalizador √© limpo por padr√£o.  Se o sinalizador estiver definido, um servi√ßo usando o Servi√ßo de Acessibilidade ser√° iniciado. </td></tr><tr><td>  <b>nameGenerator ("APPS_CONFIG")</b> </td><td>  O objeto JSON cont√©m uma lista de a√ß√µes que devem ser executadas quando o evento Acessibilidade associado a um aplicativo espec√≠fico √© acionado. </td></tr><tr><td>  <b>nameGenerator ("APPS_INSTALLED")</b> </td><td>  Armazena uma lista de aplicativos instalados no dispositivo. </td></tr><tr><td>  <b>nameGenerator ("IS_FIST_RUN")</b> </td><td>  O sinalizador √© redefinido na primeira partida. </td></tr><tr><td>  <b>nameGenerator ("UNIQUE_ID")</b> </td><td>  Cont√©m um identificador exclusivo.  √â gerado no primeiro lan√ßamento do bot. </td></tr></tbody></table><br><h3>  M√≥dulo de processamento de comandos do servidor </h3><br>  O aplicativo armazena os endere√ßos dos servidores CnC como uma matriz de <b>seq√º√™ncias</b> codificadas <b>Base85</b> .  A lista de servidores CnC pode ser alterada ap√≥s o recebimento do comando apropriado; nesse caso, os endere√ßos ser√£o armazenados em um arquivo de prefer√™ncias. <br><br>  Em resposta √† solicita√ß√£o, o servidor envia um comando para o aplicativo.  Vale ressaltar que os comandos e par√¢metros s√£o apresentados no formato JSON.  Um aplicativo pode processar os seguintes comandos: <br><table><tbody><tr><th width="150">  <b>A equipe</b> </th><th>  <b>Descri√ß√£o do produto</b> </th></tr><tr><td>  <b>forwardStart</b> </td><td>  Comece a enviar mensagens SMS recebidas pelo dispositivo infectado para o servidor CnC. </td></tr><tr><td>  <b>forwardStop</b> </td><td>  Pare de enviar mensagens SMS recebidas pelo dispositivo infectado para o servidor CnC. </td></tr><tr><td>  <b>ussdRun</b> </td><td>  Execute a solicita√ß√£o USSD.  O n√∫mero para o qual voc√™ deseja fazer uma solicita√ß√£o USSD est√° no campo JSON "number". </td></tr><tr><td>  <b>sendSms</b> </td><td>  Envie uma mensagem SMS (se necess√°rio, a mensagem √© "dividida" em partes).  Como par√¢metro, o comando usa um objeto JSON que cont√©m os campos "para" - o n√∫mero de destino e "corpo" - o corpo da mensagem. </td></tr><tr><td>  <b>sendSmsAb</b> </td><td>  Envie mensagens SMS (se necess√°rio, a mensagem ser√° "dividida" em partes) para todos da lista de contatos do dispositivo infectado.  O intervalo entre o envio de mensagens √© de 10 segundos.  O corpo da mensagem est√° no campo JSON "body" </td></tr><tr><td>  <b>sendSmsMass</b> </td><td>  Envie mensagens SMS (se necess√°rio, a mensagem √© "dividida" em partes) para os contatos especificados nos par√¢metros de comando.  O intervalo entre o envio de mensagens √© de 10 segundos.  Como par√¢metro, o comando aceita uma matriz JSON (campo "sms"), cujos elementos cont√™m os campos "a" - o n√∫mero de destino e "corpo" - o corpo da mensagem. </td></tr><tr><td>  <b>changeServer</b> </td><td>  Este comando como par√¢metro pode ter um valor com a chave "url" - ent√£o o bot alterar√° o valor de nameGenerator ("SERVER_URL") ou "array" - ent√£o o bot gravar√° o array em nameGenerator ("API_SERVER_LIST"). Assim, o aplicativo altera o endere√ßo dos servidores CnC. </td></tr><tr><td>  <b>adminNumber</b> </td><td>  O comando foi projetado para funcionar com o n√∫mero raiz.  O comando aceita um objeto JSON com os seguintes par√¢metros: "number" - altere nameGenerator ("ROOT_NUMBER") para o valor recebido, "reenvie" - altere nameGenerator ("SMS_ROOT_NUMBER_RESEND"), "sendId" - envie para nameGenerator ("ROOT_NUMBER") ID exclusivo. </td></tr><tr><td>  <b>updateInfo</b> </td><td>  Envie informa√ß√µes sobre um dispositivo infectado para o servidor. </td></tr><tr><td>  <b>wipeData</b> </td><td>  O comando foi projetado para excluir dados do usu√°rio.  Dependendo do nome do aplicativo que foi iniciado, os dados s√£o completamente apagados com a reinicializa√ß√£o do dispositivo (usu√°rio principal) ou apenas os dados do usu√°rio s√£o exclu√≠dos (usu√°rio secund√°rio). </td></tr><tr><td>  <b>socksStart</b> </td><td>  Inicie o m√≥dulo proxy.  A opera√ß√£o do m√≥dulo √© descrita em uma se√ß√£o separada. </td></tr><tr><td>  <b>meias</b> </td><td>  Pare o m√≥dulo proxy. </td></tr><tr><td>  <b>openLink</b> </td><td>  Siga o link.  O link est√° localizado no par√¢metro JSON pela chave "url".  Para abrir o link, use "android.intent.action.VIEW". </td></tr><tr><td>  <b>uploadAllSms</b> </td><td>  Envie ao servidor todas as mensagens SMS recebidas pelo dispositivo. </td></tr><tr><td>  <b>uploadAllPhotos</b> </td><td>  Envie imagens de um dispositivo infectado para o URL.  O URL vem como um par√¢metro. </td></tr><tr><td>  <b>uploadFile</b> </td><td>  Envie o arquivo para o URL do dispositivo infectado.  O URL vem como um par√¢metro. </td></tr><tr><td>  <b>uploadPhoneNumbers</b> </td><td>  Envie n√∫meros de telefone da lista de contatos para o servidor.  Se um objeto JSON com a tecla "ab" vier como par√¢metro, o aplicativo receber√° a lista de contatos da lista telef√¥nica.  Se um objeto JSON com a tecla "sms" vier como par√¢metro, o aplicativo ler√° a lista de contatos dos remetentes das mensagens SMS. </td></tr><tr><td>  <b>changeArchive</b> </td><td>  O aplicativo baixa o arquivo do endere√ßo, que vem como par√¢metro com a chave "url".  O arquivo baixado √© salvo com o nome "archive.zip".  Depois disso, o aplicativo descompactar√° o arquivo, se necess√°rio, usando a senha do arquivo ‚Äúb5jXh37gxgHBrZhQ4j3D‚Äù.  Arquivos descompactados s√£o salvos no diret√≥rio [armazenamento externo] / hgps.  Nesse diret√≥rio, o aplicativo armazena falsifica√ß√µes na Web (descritas posteriormente). </td></tr><tr><td>  <b>a√ß√µes</b> </td><td>  O comando foi projetado para funcionar com o Servi√ßo de A√ß√£o, descrito em uma se√ß√£o separada. </td></tr><tr><td>  <b>teste</b> </td><td>  N√£o faz nada. </td></tr><tr><td>  <b>baixar</b> </td><td>  O comando foi projetado para baixar um arquivo de um servidor remoto e salv√°-lo no diret√≥rio Downloads.  A URL e o nome do arquivo v√™m como par√¢metro, os campos no par√¢metro do objeto JSON, respectivamente: "url" e "fileName". </td></tr><tr><td>  <b>remover</b> </td><td>  Exclui um arquivo do diret√≥rio Downloads.  O nome do arquivo vem no par√¢metro JSON com a chave "fileName".  O nome do arquivo padr√£o √© "tmp.apk". </td></tr><tr><td>  <b>notifica√ß√£o</b> </td><td>  Mostrar uma notifica√ß√£o com os textos de descri√ß√£o e t√≠tulo definidos pelo servidor de gerenciamento. </td></tr></tbody></table><br>  O formato do comando de <b>notifica√ß√£o</b> √©: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"results"</span></span> : <span class="hljs-string"><span class="hljs-string">"OK"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: &lt;%id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"notification"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>:&lt;%Server Timestamp%&gt;, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"openApp"</span></span>:&lt;%Open original app or not%&gt;, <span class="hljs-attr"><span class="hljs-attr">"array"</span></span>:[ {<span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:&lt;%Title text%&gt;, <span class="hljs-attr"><span class="hljs-attr">"desc"</span></span>:&lt;%Description text%&gt;, <span class="hljs-attr"><span class="hljs-attr">"app"</span></span>:&lt;%Application name%&gt;} ] }, }, }</code> </pre> <br>  A notifica√ß√£o gerada pelo arquivo investigado parece id√™ntica √†s notifica√ß√µes criadas pelo aplicativo especificado no campo do <b>aplicativo</b> .  Se o valor do campo <b>openApp</b> for True, quando a notifica√ß√£o for aberta, o aplicativo especificado no campo do <b>aplicativo</b> ser√° iniciado.  Se o valor do campo <b>openApp</b> for False, ent√£o: <br><br><ul><li>  uma janela de phishing √© aberta, cujo conte√∫do √© baixado do diret√≥rio <b>&lt;% external storage%&gt; / hgps / &lt;% filename%&gt;</b> </li><li>  uma janela de phishing √© aberta, cujo conte√∫do √© baixado do servidor <b>&lt;% url%&gt;? id = &lt;% Bot id%&gt; &amp; app = &lt;% Application name%&gt;</b> </li><li>  Uma janela de phishing disfar√ßada de cart√£o do Google Play √© aberta, com a capacidade de inserir informa√ß√µes do cart√£o. </li></ul><br>  O aplicativo envia o resultado da execu√ß√£o de qualquer comando para <b>&lt;% CnC%&gt; \ set_state.php</b> como um objeto JSON do seguinte formato: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:&lt;%command%&gt;, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%command_id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"state"</span></span>:&lt;%command_state%&gt; } <span class="hljs-string"><span class="hljs-string">"id"</span></span>:&lt;%bot_id%&gt; }</code> </pre> <br>  <b>ActionsService</b> <br><br>  A lista de comandos que o aplicativo processa inclui <b>a√ß√£o</b> .  Ap√≥s o recebimento de um comando, o m√≥dulo de processamento de comandos acessa esse servi√ßo para executar um comando estendido.  O servi√ßo aceita um objeto JSON como par√¢metro.  Um servi√ßo pode executar os seguintes comandos: <br><br>  <b>1.</b> <b>PARAMS_ACTION</b> - ap√≥s o recebimento de um comando, o servi√ßo recebe antes do par√¢metro JSON o valor pela chave Type, pode ser o seguinte: <br><br><ul><li>  <b>serviceInfo</b> - o subcomando recebe do par√¢metro JSON o valor da chave <b>includeNotImportant</b> .  Se o sinalizador for True, o aplicativo define o sinalizador <b>FLAG_ISOLATED_PROCESS</b> como um servi√ßo que usa o Servi√ßo de Acessibilidade.  Assim, o servi√ßo ser√° lan√ßado em um processo separado. </li><li>  <b>root</b> - obtenha e envie ao servidor informa√ß√µes sobre a janela, que agora est√° em foco.  Um aplicativo recupera informa√ß√µes usando a classe AccessibilityNodeInfo. </li><li>  <b>admin</b> - solicite direitos de administrador. </li><li>  <b>atraso</b> - suspenda o ActionsService pelo n√∫mero de milissegundos especificado no par√¢metro com a chave "data". </li><li>  <b>windows</b> - envie uma lista de janelas vis√≠veis para o usu√°rio. </li><li>  <b>instalar</b> - instale o aplicativo em um dispositivo infectado.  O nome do pacote - archive est√° na chave "fileName".  O pr√≥prio arquivo est√° localizado no diret√≥rio Downloads. </li><li>  <b>global</b> - o subcomando foi projetado para fazer a transi√ß√£o da janela atual: <br><ul><li>  no menu Configura√ß√µes r√°pidas </li><li>  de volta </li><li>  casa </li><li>  para notifica√ß√µes </li><li>  para a janela de aplicativos abertos recentemente </li></ul><br></li><li>  <b>iniciar</b> - inicia o aplicativo.  O nome do aplicativo vem como par√¢metro pela chave de <b>dados</b> . </li><li>  <b>sons</b> - altere o modo de som para silenciar. </li><li>  <b>desbloquear</b> - ativa a luz de fundo da tela e do teclado com brilho total.  O aplicativo executa esta a√ß√£o usando WakeLock, a string [Application lable]: INFO </li><li>  <b>permissionOverlay</b> - a fun√ß√£o n√£o est√° implementada (a resposta √† execu√ß√£o do comando √© {"message": "Not support"} ou {"message": "low sdk"}) </li><li>  <b>gesto</b> - a fun√ß√£o n√£o est√° implementada (a resposta √† execu√ß√£o do comando √© {"message": "Not support"} ou {"message": "Low API"}) </li><li>  <b>permiss√µes</b> - este comando √© necess√°rio para solicitar permiss√µes para o aplicativo.  No entanto, a fun√ß√£o de consulta n√£o est√° implementada, portanto, o comando n√£o faz sentido.  A lista de direitos solicitados √© fornecida como uma matriz JSON com a chave "permiss√µes".  Lista padr√£o: <br><br><ul><li>  android.permission.READ_PHONE_STATE </li><li>  android.permission.READ_CONTACTS </li><li>  android.permission.CALL_PHONE </li><li>  android.permission.RECEIVE_SMS </li><li>  android.permission.SEND_SMS </li><li>  android.permission.READ_SMS </li><li>  android.permission.READ_EXTERNAL_STORAGE </li><li>  android.permission.WRITE_EXTERNAL_STORAGE </li></ul><br></li><li>  <b>aberto</b> - exibe uma janela de phishing.  Dependendo do par√¢metro vindo do servidor, o aplicativo pode exibir as seguintes janelas de phishing: <br><br><ul><li>  Mostra uma janela de phishing, cujo conte√∫do est√° gravado no arquivo no diret√≥rio <b>&lt;% diret√≥rio externo%&gt; / hgps / &lt;% param_filename%&gt;</b> .  O resultado da intera√ß√£o do usu√°rio com a janela ser√° enviado para <b>&lt;% CnC%&gt; / records.php</b> </li><li>  Mostrar uma janela de phishing cujo conte√∫do √© pr√©-carregado a partir do endere√ßo <b>&lt;% url_param%&gt;? Id = &lt;% bot_id%&gt; &amp; app = &lt;% packagename%&gt;</b> .  O resultado da intera√ß√£o do usu√°rio com a janela ser√° enviado para <b>&lt;% CnC%&gt; / records.php</b> </li><li>  Mostrar janela de phishing disfar√ßada como um cart√£o do Google Play. </li></ul></li><li>  <b>interativo</b> - o comando foi projetado para interagir com os elementos da janela de outros aplicativos usando o AcessibilityService.  Para intera√ß√£o, um servi√ßo especial √© implementado no programa.  O aplicativo em estudo pode interagir com as janelas: <br><ul><li>  Ativo no momento.  Nesse caso, o par√¢metro cont√©m o ID ou o texto (nome) do objeto com o qual √© necess√°rio interagir. </li><li>  Vis√≠vel para o usu√°rio no momento em que o comando √© executado.  O aplicativo seleciona janelas por ID. </li></ul><br>  Ap√≥s receber objetos <b>AccessibilityNodeInfo</b> para elementos de janela de interesse, o aplicativo, dependendo dos par√¢metros, pode executar a√ß√µes: <br><ul><li>  focus - defina o foco para o objeto. </li><li>  clique - clique em um objeto. </li><li>  actionId - execute uma a√ß√£o por ID. </li><li>  setText - altera o texto do objeto.  √â poss√≠vel alterar o texto de duas maneiras: execute a a√ß√£o <b>ACTION_SET_TEXT</b> (se a vers√£o Android do dispositivo infectado for mais jovem ou igual a <b>LOLLIPOP</b> ) ou colocando uma linha na √°rea de transfer√™ncia e colando-a no objeto (para vers√µes anteriores).  Este comando pode ser usado para alterar dados em um aplicativo banc√°rio. </li></ul></li></ul><br>  <b>2.</b> <b>PARAMS_ACTIONS</b> - o mesmo que <b>PARAMS_ACTION</b> , somente a matriz de comandos JSON vem. <br><br>  Parece que muitos estar√£o interessados ‚Äã‚Äãem saber como √© a fun√ß√£o de interagir com os elementos da janela de outro aplicativo.  √â assim que essa funcionalidade √© implementada no Gustuff: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interactiveAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List aiList, JSONObject action, JsonObject res)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = action.optInt(<span class="hljs-string"><span class="hljs-string">"repeat"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); Iterator aiListIterator = ((Iterable)aiList).iterator(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(aiListIterator.hasNext()) { Object ani = aiListIterator.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;= count) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(index = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; ++index) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"focus"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(<span class="hljs-number"><span class="hljs-number">1</span></span>)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"click"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(<span class="hljs-number"><span class="hljs-number">16</span></span>)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"actionId"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(action.optInt(<span class="hljs-string"><span class="hljs-string">"actionId"</span></span>))) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"setText"</span></span>)) { customHeader ch = CustomAccessibilityService.a; Context context = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getApplicationContext(); String text = action.optString(<span class="hljs-string"><span class="hljs-string">"setText"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(performSetTextAction(ch, context, ((AccessibilityNodeInfo)ani), text)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(index == count) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } ((AccessibilityNodeInfo)ani).recycle(); } res.addPropertyNumber(<span class="hljs-string"><span class="hljs-string">"res"</span></span>, Integer.valueOf(count)); }</code> </pre> <br>  Fun√ß√£o de substitui√ß√£o de texto: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performSetTextAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AccessibilityNodeInfo ani, String text)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Build$VERSION.SDK_INT &gt;= <span class="hljs-number"><span class="hljs-number">21</span></span>) { Bundle b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); b.putCharSequence(<span class="hljs-string"><span class="hljs-string">"ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE"</span></span>, ((CharSequence)text)); result = ani.performAction(<span class="hljs-number"><span class="hljs-number">0x200000</span></span>, b); <span class="hljs-comment"><span class="hljs-comment">// ACTION_SET_TEXT } else { Object clipboard = context.getSystemService("clipboard"); if(clipboard != null) { ((ClipboardManager)clipboard).setPrimaryClip(ClipData.newPlainText("autofill_pm", ((CharSequence)text))); result = ani.performAction(0x8000); // ACTION_PASTE } else { result = false; } } return result; }</span></span></code> </pre> <br>  Assim, se o servidor de controle estiver configurado corretamente, o Gustuff poder√° preencher os campos de texto no aplicativo banc√°rio e clicar nos bot√µes necess√°rios para a transa√ß√£o.  O Trojan nem precisa ser autorizado no aplicativo - basta enviar um comando para demonstrar a notifica√ß√£o PUSH, seguido pela abertura do aplicativo banc√°rio instalado anteriormente.  O usu√°rio passar√° pela autoriza√ß√£o, ap√≥s a qual o Gustuff poder√° preencher automaticamente. <br><br><h3>  M√≥dulo de processamento de SMS </h3><br>  O aplicativo define o manipulador de eventos para aceitar mensagens SMS pelo dispositivo infectado.  O aplicativo em estudo pode receber comandos do operador que chegam no corpo das mensagens SMS.  Os comandos v√™m no formato: <br><br>  <b>7! 5 = &lt;% comando codificado em Base64%&gt;</b> <br><br>  O aplicativo procura em todas as mensagens SMS recebidas a sequ√™ncia <b>7! 5 =</b> , se detectar uma sequ√™ncia, decodifica uma sequ√™ncia Base64 no deslocamento 4 e executa o comando.  Os comandos s√£o semelhantes aos comandos do CnC.  O resultado da execu√ß√£o √© enviado para o mesmo n√∫mero do qual o comando veio.  Formato da resposta: <br><br>  <b>7 * 5 = &lt;% codifica√ß√£o Base64 de "comando result_code"%&gt;</b> <br><br>  Opcionalmente, o aplicativo pode enviar todas as mensagens recebidas para o n√∫mero raiz.  Para fazer isso, um n√∫mero Raiz deve ser especificado no arquivo de prefer√™ncias e o sinalizador de redirecionamento de mensagem √© definido.  Uma mensagem SMS √© enviada para o n√∫mero do invasor no formato: <br><br>  <b>&lt;% Do n√∫mero%&gt; - &lt;% Hora, formato: dd / MM / aaaa HH: mm: ss%&gt; &lt;% SMS corpo%&gt;</b> <br><br>  Tamb√©m, opcionalmente, o aplicativo pode enviar mensagens para o CnC.  A mensagem SMS √© enviada ao servidor no formato JSON: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%BotID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"sms"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"text"</span></span>:&lt;%SMS body%&gt;, <span class="hljs-attr"><span class="hljs-attr">"number"</span></span>:&lt;%From number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>:&lt;%Timestamp%&gt; } }</code> </pre> <br>  Se o sinalizador <b>nameGenerator ("DEFAULT_APP_SMS")</b> estiver definido, o aplicativo interromper√° o processamento de mensagens SMS e limpar√° a lista de mensagens recebidas. <br><br><h3>  M√≥dulo proxy </h3><br>  No aplicativo em estudo, existe um m√≥dulo Proxy Backconnect (doravante denominado m√≥dulo Proxy), que possui uma classe separada que inclui campos est√°ticos com configura√ß√£o.  Os dados de configura√ß√£o s√£o armazenados na amostra em formato aberto: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/4f/mi/g-4fmidam6alfsjuhw1ltmcodhy.png" alt="imagem alt"></div><br><br>  Todas as a√ß√µes executadas pelo m√≥dulo proxy s√£o registradas nos arquivos.  Para fazer isso, o aplicativo em Armazenamento externo cria um diret√≥rio chamado "logs" (o campo ProxyConfigClass.logsDir na classe de configura√ß√£o), no qual os arquivos de log s√£o armazenados.  O log ocorre em arquivos com nomes: <br><br><ol><li>  <b>main.txt</b> - essa classe <b>registra a</b> opera√ß√£o da classe com o nome CommandServer.  O registro adicional da string str neste arquivo ser√° indicado como mainLog (str). </li><li>  <b>sess√£o - &lt;% id%&gt;. txt</b> - os dados do log associados a uma sess√£o de proxy espec√≠fica s√£o salvos neste arquivo.  O registro adicional da string str nesse arquivo ser√° chamado de sessionLog (str). </li><li>  <b>server.txt</b> - esses dados registram todos os dados gravados nos arquivos acima. </li></ol><br>  Formato de dados de log: <br><br>  &lt;% Date%&gt; [Thread [&lt;% thread id%&gt;], id []]: sequ√™ncia de log <br><br>  Exce√ß√µes que ocorrem durante a opera√ß√£o do m√≥dulo Proxy tamb√©m s√£o registradas em um arquivo.  Para isso, o aplicativo gera um objeto JSON do formato: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"uncaughtException"</span></span>:&lt;%short description of throwable%&gt; <span class="hljs-string"><span class="hljs-string">"thread"</span></span>:&lt;%thread%&gt; <span class="hljs-string"><span class="hljs-string">"message"</span></span>:&lt;%detail message of throwable%&gt; <span class="hljs-string"><span class="hljs-string">"trace"</span></span>: //Stack trace info [ { <span class="hljs-attr"><span class="hljs-attr">"ClassName"</span></span>: <span class="hljs-string"><span class="hljs-string">"FileName"</span></span>: <span class="hljs-string"><span class="hljs-string">"LineNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"MethodName"</span></span>: }, { <span class="hljs-attr"><span class="hljs-attr">"ClassName"</span></span>: <span class="hljs-string"><span class="hljs-string">"FileName"</span></span>: <span class="hljs-string"><span class="hljs-string">"LineNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"MethodName"</span></span>: } ] }</code> </pre> <br>  Em seguida, ele o converte em uma representa√ß√£o e logs de string. <br><br>  O m√≥dulo proxy √© iniciado ap√≥s o recebimento da equipe apropriada.  Quando chega um comando para iniciar o m√≥dulo Proxy, o aplicativo inicia um servi√ßo chamado <b>MainService</b> , respons√°vel por controlar a opera√ß√£o do m√≥dulo Proxy - seu in√≠cio e parada. <br><br>  Etapas de in√≠cio do servi√ßo: <br><br>  <b>1.</b> Inicia um cron√¥metro que funciona uma vez por minuto e verifica a atividade do m√≥dulo proxy.  Se o m√≥dulo n√£o estiver ativo, ele ser√° iniciado. <br>  Al√©m disso, quando o evento <b>android.net.conn.CONNECTIVITY_CHANGE</b> √© acionado, o m√≥dulo Proxy √© iniciado. <br><br>  <b>2. O</b> aplicativo cria um despertador com o par√¢metro <b>PARTIAL_WAKE_LOCK</b> e o captura.  Portanto, n√£o permite que a CPU do dispositivo entre no modo de suspens√£o. <br><br>  <b>3.</b> Executa a classe de processamento de comandos do m√≥dulo proxy registrando a linha mainLog <b>(‚Äústart server‚Äù)</b> e <br><br>  <b>Servidor :: start () host [&lt;% proxy_cnc%&gt;], commandPort [&lt;% command_port%&gt;], proxyPort [&lt;% proxy_port%&gt;]</b> <br><br>  onde <b>proxy_cnc, command_port e proxy_port</b> s√£o os par√¢metros obtidos na configura√ß√£o do servidor proxy. <br><br>  A classe de processamento de comandos √© chamada <b>CommandConnection</b> .  Imediatamente ap√≥s o lan√ßamento, ele executa as seguintes a√ß√µes: <br><br>  <b>4.</b> Conecta-se ao <b>ProxyConfigClass.host</b> : <b>ProxyConfigClass.commandPort</b> e envia os dados sobre o dispositivo infectado no formato JSON: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%imei%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imsi"</span></span>:&lt;%imsi%&gt;, <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"manufacturer"</span></span>:&lt;%manufacturer%&gt;, <span class="hljs-attr"><span class="hljs-attr">"androidVersion"</span></span>:&lt;%androidVersion%&gt;, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>:&lt;%country%&gt;, <span class="hljs-attr"><span class="hljs-attr">"partnerId"</span></span>:&lt;%partnerId%&gt;, <span class="hljs-attr"><span class="hljs-attr">"packageName"</span></span>:&lt;%packageName%&gt;, <span class="hljs-attr"><span class="hljs-attr">"networkType"</span></span>:&lt;%networkType%&gt;, <span class="hljs-attr"><span class="hljs-attr">"hasGsmSupport"</span></span>:&lt;%hasGsmSupport%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simReady"</span></span>:&lt;%simReady%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simCountry"</span></span>:&lt;%simCountry%&gt;, <span class="hljs-attr"><span class="hljs-attr">"networkOperator"</span></span>:&lt;%networkOperator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simOperator"</span></span>:&lt;%simOperator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>:&lt;%version%&gt; }</code> </pre> <br>  Onde: <br><br><ul><li>  id - identificador, tentando obter o valor com o campo "id" do arquivo de prefer√™ncias compartilhadas com o nome "x".  Se este valor n√£o puder ser obtido, ele gera um novo.  , Proxy-  ÃÜ , ÃÜ   Bot ID. </li><li> imei ‚Äî IMEI ÃÜ.        ‚Äî         . </li><li> imsi ‚Äî International Mobile Subscriber Identity ÃÜ.        ‚Äî         . </li><li> model ‚Äî The end-user-visible name for the end product. </li><li> manufacturer ‚Äî The manufacturer of the product/hardware (Build.MANUFACTURER). </li><li> androidVersion ‚Äî    "&lt;%release_version%&gt; (&lt;%os_version%&gt;),&lt;%sdk_version%&gt;" </li><li> country ‚Äî   ÃÜ. </li><li> partnerId ‚Äì  . </li><li> packageName ‚Äì package name. </li><li> networkType ‚Äî     (: ¬´WIFI¬ª, ¬´MOBILE¬ª).     null. </li><li> hasGsmSupport ‚Äì true ‚Äì    GSM,  false. </li><li> simReady ‚Äì  SIM-. </li><li> simCountry ‚Äî ISO-  (  ÃÜ -). </li><li> networkOperator ‚Äî  .        ‚Äî         . </li><li> simOperator ‚Äî The Service Provider Name (SPN).        ‚Äî         . </li><li> version ‚Äî     -,   ÃÜ     ¬´1.6¬ª. </li></ul><br> <b>5.</b>       .      : <br><br><ul><li> 0 offset ‚Äì command </li><li> 1 offset ‚Äì sessionId </li><li> 2 offset ‚Äì length </li><li> 4 offset ‚Äî data </li></ul><br>     : <br><br> <b>mainLog(¬´Header { sessionId&lt;%id%&gt;], type[&lt;%command%&gt;], length[&lt;%length%&gt;] }¬ª)</b> <br><br>     : <br><br><table><tbody><tr><th> Name </th><th> Command </th><th> Data </th><th>  Descri√ß√£o do produto </th></tr><tr><td> <b>connectionId</b> </td><td>  0 0 </td><td> Connection ID </td><td>    </td></tr><tr><td> <b>SLEEP</b> </td><td>  3 </td><td>  Tempo </td><td>   Proxy- </td></tr><tr><td> <b>PING_PONG</b> </td><td>  4 </td><td>  - </td><td>  PONG- </td></tr></tbody></table><br> PONG-   4     : <b>0x04000000</b> . <br><br>    connectionId (   ) <b>CommandConnection</b>    <b>ProxyConnection</b> . <br><br><ul><li>      : <b>ProxyConnection</b>  <b>end</b> .    <b>ProxyConnection</b>     <b>ProxyConfigClass.host</b> : <b>ProxyConfigClass.proxyPort</b>   JSON-: </li></ul><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%connectionId%&gt; }</code> </pre> <br>     SOCKS5-,     ,     . ÃÜ       <b>end</b> .       : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hz/ed/y7/hzedy7sapdijp20ayiacbiwarc8.png" alt="imagem alt"></div><br><h2>  ÃÜ </h2><br>       ÃÜ  CnC-        SSL.             JSON-.       : <br><br><ul><li> <b>http://&lt;%CnC%&gt;/api/v1/set_state.php</b> ‚Äî   . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/get.php</b> ‚Äî  . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/load_sms.php</b> ‚Äî  SMS-ÃÜ   ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/load_ab.php</b> ‚Äî      ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/aevents.php</b> ‚Äì     ,   preference-ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/set_card.php</b> ‚Äî  ,    -,   Google Play Market. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/logs.php</b> ‚Äì  -. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/records.php</b> ‚Äì  ,     . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/set_error.php</b> ‚Äì   ÃÜ . </li></ul><br><h2>  </h2><br>              ,          ,     . <br><br>              ,    .               ,   ,             . <br><br>    ‚Äì   - ,      ,      -,    , ,     ,       ,     . <br><br><h3>    : </h3><br><ul><li>         Android  - ,  Google Play; </li><li>     <b> </b>    ; </li><li>     Android; </li><li>      ; </li><li>    ; </li><li>    ,   SMS-. </li></ul><br>   <b> </b> ,          Group-IB. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt446948/">https://habr.com/ru/post/pt446948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt446932/index.html">TDMS Fairway e BIM</a></li>
<li><a href="../pt446938/index.html">Sistema de part√≠culas em Core Animation. Hist√≥ria de natal</a></li>
<li><a href="../pt446940/index.html">QA no prod. Por que isso √© legal?</a></li>
<li><a href="../pt446942/index.html">Servidor, voc√™ pode me ouvir? Ataque do BROP ao exemplo da tarefa NeoQUEST-2019</a></li>
<li><a href="../pt446944/index.html">Por que investir em empresas n√£o lucrativas?</a></li>
<li><a href="../pt446950/index.html">76% dos fabricantes n√£o t√™m experi√™ncia em implementar aditivos - por que √© bom</a></li>
<li><a href="../pt446952/index.html">Crie histogramas animados usando R</a></li>
<li><a href="../pt446956/index.html">√â prejudicial √† luz ou como manter a carga de uma bateria de carro</a></li>
<li><a href="../pt446958/index.html">Tricky Perl Quine</a></li>
<li><a href="../pt446960/index.html">A casa que Jack construiu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>