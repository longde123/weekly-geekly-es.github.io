<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôéüèæ üôÖüèø ü§öüèº V8: un an avec Spectre üòø üõå üï¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le 3 janvier 2018, Google Project Zero et d'autres ont r√©v√©l√© les trois premiers d'une nouvelle classe de vuln√©rabilit√©s qui affectent les processeurs...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>V8: un an avec Spectre</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449546/"> Le 3 janvier 2018, Google Project Zero et d'autres ont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©v√©l√© les</a> trois premiers d'une nouvelle classe de vuln√©rabilit√©s qui affectent les processeurs d'ex√©cution sp√©culative.  Ils s'appelaient <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Spectre</a> (1 et 2) et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Meltdown</a> .  √Ä l'aide de m√©canismes d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ex√©cution sp√©culatifs du</a> processeur, un attaquant peut contourner temporairement les contr√¥les de s√©curit√© logiciels explicites et implicites qui emp√™chent les programmes de lire des donn√©es inaccessibles en m√©moire.  Alors que l'ex√©cution sp√©culative √©tait con√ßue dans le cadre de la microarchitecture, invisible au niveau architectural, des programmes soigneusement con√ßus pouvaient lire des informations inaccessibles dans un bloc sp√©culatif et les r√©v√©ler par des canaux lat√©raux, tels que le temps d'ex√©cution d'un fragment de programme. <br><br>  Lorsqu'il a √©t√© d√©montr√© que les attaques Spectre sont possibles en utilisant JavaScript, l'√©quipe V8 a particip√© √† la r√©solution du probl√®me.  Nous avons form√© une √©quipe d'intervention d'urgence et travaill√© en √©troite collaboration avec d'autres √©quipes Google, nos autres partenaires de navigation et nos partenaires mat√©riels.  Avec eux, nous avons men√© de mani√®re proactive √† la fois des recherches offensives (conception de modules d'attaque pour prouver le concept) et d√©fensives (att√©nuation des attaques potentielles). <br><a name="habracut"></a><br>  L'attaque Spectre se compose de deux parties: <br><br><ul><li>  <i>Fuite de donn√©es autrement inaccessibles dans l'√©tat latent du CPU</i> .  Toutes les attaques Spectre connues utilisent la sp√©culation pour transf√©rer des bits de donn√©es inaccessibles vers des caches CPU. <br></li><li>  <i>R√©cup√©ration d'un √©tat masqu√©</i> pour restaurer des donn√©es inaccessibles.  Pour cela, un attaquant a besoin d'une montre d'une pr√©cision suffisante.  (Pr√©cision √©tonnamment faible, en particulier avec des m√©thodes telles que le seuillage des bords - comparer avec un seuil le long d'un contour s√©lectionn√©). </li></ul><br>  Th√©oriquement, il suffirait de bloquer l'une des deux composantes de l'attaque.  √âtant donn√© que nous ne savons comment bloquer compl√®tement aucun d'entre eux, nous avons d√©velopp√© et d√©ploy√© des att√©nuations qui r√©duisent consid√©rablement la quantit√© d'informations qui fuient dans les caches de processeur et les att√©nuations qui rendent difficile la r√©cup√©ration d'un √©tat masqu√©. <br><br><h1>  Minuteries de haute pr√©cision </h1><br>  De minuscules changements d'√©tat qui subsistent apr√®s l'ex√©cution sp√©culative produisent des diff√©rences temporelles minuscules, presque incroyablement minuscules - de l'ordre du milliardi√®me de seconde.  Pour d√©tecter directement ces diff√©rences individuelles, l'attaquant a besoin d'une minuterie de haute pr√©cision.  Les processeurs proposent de tels temporisateurs, mais la plate-forme Web ne les d√©finit pas.  Le minuteur le plus pr√©cis de la plate-forme Web <code>performance.now()</code> avait une r√©solution de plusieurs microsecondes, ce qui √©tait initialement consid√©r√© comme inadapt√© √† cette fin.  Cependant, il y a deux ans, un groupe de recherche sp√©cialis√© dans les attaques microarchitecturales a publi√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article</a> sur les minuteries sur une plateforme web.  Ils ont conclu que la m√©moire partag√©e mutable simultan√©e et diverses m√©thodes de r√©cup√©ration de r√©solution permettent la cr√©ation de minuteries de r√©solution encore plus √©lev√©e, jusqu'√† la nanoseconde.  Ces temporisateurs sont suffisamment pr√©cis pour d√©tecter les coups s√ªrs et manqu√©s du cache L1.  C'est lui qui est g√©n√©ralement utilis√© pour capturer des informations dans les attaques Spectre. <br><br><h1>  Protection minuterie </h1><br>  Pour perturber la capacit√© de d√©tecter de petites diff√©rences de temps, les d√©veloppeurs de navigateurs ont choisi une approche multilat√©rale.  Dans tous les navigateurs, la r√©solution de <code>performance.now()</code> √©t√© r√©duite (dans Chrome de 5 microsecondes √† 100) et une gigue al√©atoire a √©t√© introduite pour emp√™cher la restauration de la r√©solution.  Apr√®s des consultations entre les d√©veloppeurs de tous les navigateurs, nous avons d√©cid√© ensemble de franchir une √©tape sans pr√©c√©dent: d√©sactiver imm√©diatement et r√©troactivement l'API <code>SharedArrayBuffer</code> dans tous les navigateurs pour emp√™cher la cr√©ation d'une minuterie nanoseconde. <br><br><h1>  Gain </h1><br>  Au d√©but de nos recherches offensives, il est devenu clair que les att√©nuations de temporisation √† elles seules ne suffisent pas.  L'une des raisons est qu'un attaquant peut simplement ex√©cuter son code √† plusieurs reprises, de sorte que la diff√©rence de temps cumul√©e est bien plus qu'un hit ou un cache manquant.  Nous avons pu construire des ¬´gadgets¬ª fiables qui utilisent plusieurs lignes de cache √† la fois, jusqu'√† la capacit√© de cache enti√®re, ce qui donne une diff√©rence de temps allant jusqu'√† 600 microsecondes.  Plus tard, nous avons d√©couvert des m√©thodes d'amplification arbitraires qui ne sont pas limit√©es par la capacit√© du cache.  Ces m√©thodes d'amplification sont bas√©es sur des tentatives r√©p√©t√©es de lecture de donn√©es secr√®tes. <br><br><h1>  Protection JIT </h1><br>  Pour lire des donn√©es inaccessibles √† l'aide de Spectre, un attaquant force le CPU √† ex√©cuter de mani√®re sp√©culative du code qui lit des donn√©es normalement inaccessibles et les place dans le cache.  La protection peut √™tre envisag√©e de deux c√¥t√©s: <br><br><ol><li>  Emp√™cher l'ex√©cution de code sp√©culatif. <br></li><li>  Pr√©vention de la lecture des donn√©es inaccessibles du pipeline sp√©culatif. </li></ol><br>  Nous avons exp√©riment√© la premi√®re option en ins√©rant des instructions recommand√©es pour emp√™cher la sp√©culation, comme le <code>LFENCE</code> d'Intel, sur chaque branche conditionnelle critique et en utilisant des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">retpolins</a> pour les branches indirectes.  Malheureusement, de telles mesures d'att√©nuation r√©duisent consid√©rablement la productivit√© (ralentissement de 2 √† 3 fois par rapport √† l'indice de r√©f√©rence Octane).  Au lieu de cela, nous avons adopt√© la deuxi√®me approche en ins√©rant des s√©quences d'att√©nuation qui emp√™chent la lecture des donn√©es sensibles en raison d'une sp√©culation incorrecte.  Permettez-moi d'illustrer la technique avec l'extrait de code suivant: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (condition) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a[i]; }</code> </pre> <br>  Pour simplifier, nous supposons que la condition <code>0</code> ou <code>1</code> .  Le code ci-dessus est vuln√©rable si le CPU lit sp√©culativement √† partir d' <code>a[i]</code> lorsque <code>i</code> est hors de port√©e, acc√©dant √† des donn√©es normalement inaccessibles.  Une observation importante est que dans ce cas, la sp√©culation essaie de lire <code>a[i]</code> lorsque la condition est <code>0</code> .  Notre att√©nuation r√©√©crit ce programme afin qu'il se comporte exactement de la m√™me mani√®re que le programme d'origine, mais ne laisse aucune fuite de donn√©es sp√©culativement charg√©es. <br><br>  Nous r√©servons un registre CPU, que nous appelons ¬´poison¬ª, pour savoir si le code s'ex√©cute dans une branche mal interpr√©t√©e.  Le registre anti-poison est pris en charge dans toutes les branches et tous les appels du code g√©n√©r√©, de sorte que toute branche incorrectement interpr√©t√©e fait que le registre anti-poison devient <code>0</code> .  Ensuite, nous mesurons tous les acc√®s √† la m√©moire afin qu'ils masquent inconditionnellement le r√©sultat de tous les t√©l√©chargements avec la valeur actuelle du registre antipoison.  Cela n'emp√™che pas le processeur de pr√©dire (ou d'interpr√©ter de mani√®re erron√©e) les branches, mais cela d√©truit les informations (potentiellement hors des limites) des valeurs charg√©es en raison de branches mal interpr√©t√©es.  Le code de l'outil est illustr√© ci-dessous ( <code>a</code> est un tableau de nombres). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> poison = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ if (condition) { poison *= condition; return a[i] * poison; }</span></span></code> </pre> <br>  Le code suppl√©mentaire n'affecte pas le comportement normal (d√©fini par l'architecture) du programme.  Il n'affecte l'√©tat micro-architectural que lorsque vous travaillez sur un processeur avec une ex√©cution sp√©culative.  Si vous instrumentez un programme au niveau du code source, les optimisations avanc√©es des compilateurs modernes peuvent supprimer une telle instrumentation.  Dans la version 8, nous emp√™chons le compilateur de supprimer les att√©nuations en les ins√©rant √† un stade tr√®s avanc√© de la compilation. <br><br>  Nous utilisons √©galement cette technique d'empoisonnement pour √©viter les fuites de branches indirectes dans la boucle de bytecode de l'interpr√©teur et dans la s√©quence d'appels de fonction JavaScript.  Dans l'interpr√©teur, nous mettons le poison √† <code>0</code> si le gestionnaire de bytecode (c'est-√†-dire une s√©quence de code machine qui interpr√®te un bytecode) ne correspond pas au bytecode actuel.  Pour les appels JavaScript, nous transmettons la fonction cible en tant que param√®tre (dans le registre) et d√©finissons le poison sur <code>0</code> au d√©but de chaque fonction si la fonction cible entrante ne correspond pas √† la fonction actuelle.  Avec cet assouplissement, nous observons un ralentissement de moins de 20% de l'indice de r√©f√©rence Octane. <br><br>  L'att√©nuation pour WebAssembly est plus simple, car le contr√¥le de s√©curit√© principal consiste √† s'assurer que l'acc√®s √† la m√©moire est dans les limites.  Pour les plates-formes 32 bits, en plus des v√©rifications de limites habituelles, nous remplissons toute la m√©moire √† la puissance suivante de deux et masquons inconditionnellement tous les bits sup√©rieurs de l'index de m√©moire utilisateur.  Les plates-formes 64 bits n'ont pas besoin d'une telle att√©nuation, car l'impl√©mentation utilise la protection de la m√©moire virtuelle pour les contr√¥les de bordure.  Nous avons exp√©riment√© la compilation d'instructions switch / case en code de recherche binaire au lieu d'utiliser une branche indirecte potentiellement vuln√©rable, mais c'est trop cher pour certaines charges de travail.  Les appels indirects sont prot√©g√©s par des retpolins. <br><br><h1>  Protection logicielle - peu fiable </h1><br>  Heureusement ou malheureusement, nos recherches offensives ont progress√© beaucoup plus rapidement que sur la d√©fensive, et nous avons rapidement constat√© qu'il √©tait impossible d'att√©nuer par programme toutes les fuites possibles lors des attaques Spectre.  Il y a plusieurs raisons √† cela.  Premi√®rement, les efforts d'ing√©nierie pour combattre Spectre sont disproportionn√©s par rapport au niveau de menace.  Dans la V8, nous rencontrons de nombreux autres risques de s√©curit√© qui sont bien pires, de la lecture directement en dehors des fronti√®res en raison de bogues courants (ce qui est plus rapide et plus facile que Spectre), de l'√©criture en dehors des fronti√®res (cela est impossible avec Spectre et pire) et du potentiel distant ex√©cution de code (impossible avec Spectre et bien pire).  Deuxi√®mement, les mesures d'att√©nuation de plus en plus sophistiqu√©es que nous avons d√©velopp√©es et mises en ≈ìuvre comportaient une complexit√© importante, ce qui est une obligation technique et peut en fait augmenter la surface d'attaque et les frais g√©n√©raux de performance.  Troisi√®mement, tester et maintenir l'att√©nuation des fuites microarchitecturales est encore plus difficile que de concevoir les gadgets eux-m√™mes pour une attaque, car il est difficile d'√™tre s√ªr que les att√©nuations continuent de fonctionner comme elles ont √©t√© con√ßues.  Au moins une fois, d'importantes att√©nuations ont √©t√© effectivement annul√©es par les optimisations ult√©rieures du compilateur.  Quatri√®mement, nous avons constat√© que l'att√©nuation efficace de certaines options de Spectre, en particulier l'option 4, n'est tout simplement pas possible dans le logiciel, m√™me apr√®s les efforts h√©ro√Øques de nos partenaires Apple pour r√©soudre le probl√®me dans leur compilateur JIT. <br><br><h1>  Isolement du site </h1><br>  Nos recherches ont abouti √† la conclusion: en principe, le code non fiable peut lire l'int√©gralit√© de l'espace d'adressage d'un processus en utilisant Spectre et les canaux lat√©raux.  Les att√©nuations logicielles r√©duisent l'efficacit√© de nombreux gadgets potentiels, mais ne sont ni efficaces ni compl√®tes.  La seule mesure efficace consiste √† d√©placer les donn√©es sensibles en dehors de l'espace d'adressage du processus.  Heureusement, Chrome essaie depuis de nombreuses ann√©es de s√©parer les sites en diff√©rents processus afin de r√©duire la surface d'attaque en raison de vuln√©rabilit√©s courantes.  Ces investissements ont port√© leurs fruits et, en mai 2018, nous sommes pass√©s au stade de pr√©paration et avons √©tendu l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">isolement des sites</a> sur le nombre maximal de plates-formes.  Ainsi, le mod√®le de s√©curit√© Chrome n'assume plus la confidentialit√© de la langue pendant le processus de rendu. <br><br>  Spectre a parcouru un long chemin et a soulign√© les m√©rites de la collaboration des d√©veloppeurs dans l'industrie et le monde universitaire.  Jusqu'√† pr√©sent, les chapeaux blancs sont en avance sur les chapeaux noirs.  Nous ne connaissons toujours pas une seule v√©ritable attaque, √† l'exception des exp√©rimentateurs curieux et des chercheurs professionnels qui d√©veloppent des gadgets pour prouver le concept.  De nouvelles variantes de ces vuln√©rabilit√©s continuent d'appara√Ætre et cela continuera pendant un certain temps.  Nous continuons de surveiller ces menaces et de les prendre au s√©rieux. <br><br>  Comme de nombreux programmeurs, nous avons √©galement pens√© que les langages s√ªrs fournissent la bonne fronti√®re pour l'abstraction, emp√™chant les programmes bien typ√©s de lire la m√©moire arbitraire.  Il est triste que cela se soit av√©r√© √™tre une erreur - cette garantie ne correspond pas √† l'√©quipement d'aujourd'hui.  Bien s√ªr, nous pensons toujours que les langages s√ªrs ont plus d'avantages en mati√®re d'ing√©nierie, et l'avenir leur appartient, mais ... sur les √©quipements d'aujourd'hui, ils fuient un peu. <br><br>  Les lecteurs int√©ress√©s peuvent approfondir le sujet et obtenir des informations plus d√©taill√©es dans notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article scientifique</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr449546/">https://habr.com/ru/post/fr449546/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr449536/index.html">iOS Digest n ¬∞ 4 (5 avril - 26 avril)</a></li>
<li><a href="../fr449538/index.html">D√©placement du portail Web: de l'architecture monolithique √† l'architecture microservice</a></li>
<li><a href="../fr449540/index.html">Effet de shader Doodle</a></li>
<li><a href="../fr449542/index.html">La m√©decine se d√©place vers le Web, les forums de discussion et les applications mobiles. Conversation avec BestDoctor</a></li>
<li><a href="../fr449544/index.html">Le monde moderne repose sur l'API</a></li>
<li><a href="../fr449548/index.html">Centre de donn√©es spatiales. Reportage vid√©o du lancement</a></li>
<li><a href="../fr449552/index.html">Cryptage asym√©trique en pratique</a></li>
<li><a href="../fr449554/index.html">Mozilla va utiliser WASI pour tous les appareils, ordinateurs et syst√®mes d'exploitation</a></li>
<li><a href="../fr449556/index.html">Blazor est pass√© de l'exp√©rience √† l'aper√ßu</a></li>
<li><a href="../fr449558/index.html">L'apprentissage automatique pour tous ceux qui ont √©tudi√© les math√©matiques en huiti√®me ann√©e</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>