<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öîÔ∏è üî¢ üîî Conception instantan√©e üåÇ ü§¥üèº üî∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les gens apprennent l'architecture √† partir de vieux livres √©crits pour Java. Les livres sont bons, mais ils apportent une solution aux probl√®mes de l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conception instantan√©e</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/447308/">  Les gens apprennent l'architecture √† partir de vieux livres √©crits pour Java.  Les livres sont bons, mais ils apportent une solution aux probl√®mes de l'√©poque avec des instruments de l'√©poque.  Le temps a chang√©, C # ressemble plus √† Scala l√©ger qu'√† Java, et il y a peu de nouveaux bons livres. <br><br>  Dans cet article, nous examinerons les crit√®res de bon code et de mauvais code, comment et quoi mesurer.  Nous verrons un aper√ßu des t√¢ches et des approches typiques, nous analyserons les avantages et les inconv√©nients.  √Ä la fin, il y aura des recommandations et des meilleures pratiques pour la conception d'applications Web. <br><br>  Cet article est une transcription de mon rapport de la conf√©rence DotNext 2018 √† Moscou.  En plus du texte, il y a une vid√©o et un lien vers les diapositives sous la coupe. <br><br><img src="https://habrastorage.org/webt/qu/ur/ih/quurihchxowghlgnkanhvmb5o7e.jpeg"><br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qJPwSvDLmQE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Diapositives</b></a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page de rapport sur le site</a> . </blockquote>  En bref: je viens de Kazan, je travaille pour le groupe High Tech.  Nous d√©veloppons des logiciels pour les entreprises.  R√©cemment, j'ai enseign√© √† l'Universit√© f√©d√©rale de Kazan un cours intitul√© D√©veloppement de logiciels d'entreprise.  De temps en temps, j'√©cris toujours des articles sur Habr sur les pratiques d'ing√©nierie, sur le d√©veloppement de logiciels d'entreprise. <br><br>  Comme vous l'avez probablement devin√©, je parlerai aujourd'hui du d√©veloppement de logiciels d'entreprise, √† savoir comment structurer des applications web modernes: <br><br><ul><li>  les crit√®res </li><li>  une br√®ve histoire du d√©veloppement de la pens√©e architecturale (ce qui √©tait, ce qui est devenu, quels sont les probl√®mes); </li><li>  aper√ßu des d√©fauts de l'architecture de bouff√©e classique </li><li>  la d√©cision </li><li>  analyse √©tape par √©tape de la mise en ≈ìuvre sans plonger dans les d√©tails </li><li>  r√©sultats. </li></ul><br><h1>  Crit√®res </h1><br>  Nous formulons les crit√®res.  Je n'aime vraiment pas quand on parle de design dans le style de "mon kung-fu est plus fort que votre kung-fu".  Une entreprise a, en principe, un crit√®re sp√©cifique appel√© argent.  Tout le monde sait que le temps c'est de l'argent, donc ces deux composantes sont le plus souvent les plus importantes. <br><br><img src="https://habrastorage.org/webt/pu/2e/fh/pu2efhyhoibrcu9lav6fzdg48da.jpeg"><br><br>  Donc, les crit√®res.  En principe, l'entreprise nous demande le plus souvent ¬´autant de fonctionnalit√©s que possible par unit√© de temps¬ª, mais avec une mise en garde - ces fonctionnalit√©s devraient fonctionner.  Et la premi√®re √©tape o√π il pourrait se casser est la r√©vision du code.  Autrement dit, il semble que le programmeur a dit: "Je le ferai dans trois heures."  Trois heures se sont √©coul√©es, l'examen est entr√© dans le code, et le chef d'√©quipe a dit: "Oh, non, refaites-le."  Il y en a trois de plus - et combien d'it√©rations la revue de code a pass√©, tellement vous devez multiplier trois heures. <br><br>  Le point suivant est le retour de l'√©tape du test d'acceptation.  La m√™me chose.  Si la fonction ne fonctionne pas, alors ce n'est pas fait, ces trois heures s'√©tendent sur une semaine, deux - enfin, comme d'habitude.  Le dernier crit√®re est le nombre de r√©gressions et de bugs qui, malgr√© les tests et l'acceptation, ont n√©anmoins travers√© la production.  C'est aussi tr√®s mauvais.  Il y a un probl√®me avec ce crit√®re.  Il est difficile de suivre, car le lien entre le fait que nous poussions quelque chose dans le r√©f√©rentiel et le fait que quelque chose s'est cass√© apr√®s deux semaines peut √™tre difficile √† suivre.  Mais, n√©anmoins, c'est possible. <br><br><h1>  D√©veloppement d'architecture </h1><br>  Il √©tait une fois, quand les programmeurs commen√ßaient √† peine √† √©crire des programmes, il n'y avait toujours pas d'architecture, et tout le monde faisait tout ce qu'il voulait. <br><br><img src="https://habrastorage.org/webt/27/l7/oq/27l7oqmpgjyxndbw-4trowmrmem.jpeg"><br><br>  Par cons√©quent, nous avons obtenu un tel style architectural.  C'est ce qu'on appelle le ¬´code de nouilles¬ª ici, ils disent ¬´code de spaghetti¬ª √† l'√©tranger.  Tout est li√© √† tout: on change quelque chose au point A - √ßa casse au point B, il est compl√®tement impossible de comprendre ce qui est connect√© √† quoi.  Naturellement, les programmeurs ont rapidement r√©alis√© que cela ne fonctionnerait pas, et une certaine structure devait √™tre faite, et ont d√©cid√© que certaines couches nous aideraient.  Maintenant, si vous imaginez que la viande hach√©e est du code et que la lasagne est de telles couches, voici une illustration de l'architecture en couches.  La viande hach√©e est rest√©e hach√©e, mais maintenant la viande hach√©e de la couche n ¬∞ 1 ne peut pas simplement aller parler √† la viande hach√©e de la couche n ¬∞ 2. Nous avons donn√© une forme au code: m√™me sur l'image, vous pouvez voir que l'escalade est plus cadr√©e. <br><br><img src="https://habrastorage.org/webt/yx/_j/cu/yx_jcumnfvnensrmrbjwi9lyyqa.jpeg"><br><br>  Tout le monde conna√Æt probablement l' <b>architecture en couches classique</b> : il existe une interface utilisateur, une logique m√©tier et une couche d'acc√®s aux donn√©es.  Il existe encore toutes sortes de services, fa√ßades et couches, du nom de l'architecte qui a quitt√© l'entreprise, il peut y en avoir un nombre illimit√©. <br><br><img src="https://habrastorage.org/webt/dd/28/qj/dd28qjfaycsftyr71tczg5ykxjo.jpeg"><br><br>  L'√©tape suivante a √©t√© la soi-disant <b>architecture de l'oignon</b> .  Il semblerait qu'il y ait une √©norme diff√©rence: avant cela, il y avait un petit carr√©, et ici il y avait des cercles.  Cela semble √™tre compl√®tement diff√©rent. <br><br><img src="https://habrastorage.org/webt/pe/8r/rx/pe8rrxifll2tswmz63paezukklq.jpeg"><br><br>  Pas vraiment.  La diff√©rence est que quelque part √† cette √©poque, les principes de SOLID ont √©t√© formul√©s, et il s'est av√©r√© que dans l'oignon classique, il y a un probl√®me avec l'inversion de d√©pendance, car le code de domaine abstrait d√©pend pour une raison quelconque de la mise en ≈ìuvre, de l'acc√®s aux donn√©es, nous avons donc d√©cid√© de d√©ployer l'acc√®s aux donn√©es et que l'acc√®s aux donn√©es d√©pend du domaine. <br><br><img src="https://habrastorage.org/webt/8o/eb/we/8oebwed-cag1f-zvake5t9lmhl8.jpeg"><br><br>  Ici, j'ai pratiqu√© le dessin et dessin√© l'architecture de l'oignon, mais pas de fa√ßon classique avec les ¬´anneaux¬ª.  J'ai quelque chose entre un polygone et des cercles.  Je l'ai fait pour montrer simplement que si vous rencontriez les mots ¬´oignon¬ª, ¬´hexagonal¬ª ou ¬´ports et adaptateurs¬ª - ce sont tous une seule et m√™me chose.  Le fait est que le domaine est au centre, il est envelopp√© dans des services, ils peuvent √™tre des services de domaine ou d'application, comme vous le souhaitez.  Et le monde ext√©rieur sous forme d'interface utilisateur, de tests et d'infrastructure o√π DAL a d√©m√©nag√© - ils communiquent avec le domaine via cette couche de service. <br><br><h2>  Un exemple simple.  Mise √† jour par e-mail </h2><br>  Voyons √† quoi ressemblerait un cas d'utilisation simple dans un tel paradigme - la mise √† jour de l'adresse e-mail de l'utilisateur. <br><br><img src="https://habrastorage.org/webt/ta/fg/x-/tafgx-5pwfraeofdjg323ewoova.jpeg"><br><br>  Nous devons envoyer une demande, valider, mettre √† jour la valeur dans la base de donn√©es, envoyer une notification √† un nouvel e-mail: "Tout est en ordre, vous avez chang√© votre e-mail, nous savons que tout va bien", et r√©pondre au navigateur "200" - tout va bien. <br><br><img src="https://habrastorage.org/webt/xs/vm/0f/xsvm0f4b6zhpypwnixjazbv3ufi.jpeg"><br><br>  Le code peut ressembler √† ceci.  Ici, nous avons la validation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ASP.NET</a> MVC standard, il y a ORM pour lire et mettre √† jour les donn√©es, et il y a une sorte d'exp√©diteur d'email qui envoie une notification.  Il semble que tout va bien, non?  Une mise en garde - dans un monde id√©al. <br><br>  Dans le monde r√©el, la situation est l√©g√®rement diff√©rente.  Le but est d'ajouter l'autorisation, la v√©rification des erreurs, le formatage, la journalisation et le profilage.  Tout cela n'a rien √† voir avec notre cas d'utilisation, mais cela devrait l'√™tre.  Et ce petit morceau de code est devenu gros et effrayant: avec beaucoup d'imbrication, avec beaucoup de code, avec le fait qu'il est difficile √† lire, et surtout, qu'il y a plus de code d'infrastructure que de code de domaine. <br><br><img src="https://habrastorage.org/webt/lh/xr/xd/lhxrxdbyaacgxsxrjcsoinbq-c8.jpeg"><br><br>  "O√π sont les services?"  - dites-vous.  J'ai √©crit toute la logique aux contr√¥leurs.  Bien s√ªr, c'est un probl√®me, maintenant j'ajouterai des services, et tout ira bien. <br><br><img src="https://habrastorage.org/webt/c6/nd/ca/c6ndcaxmuebeyawelqctgsh19ig.jpeg"><br><br>  Nous ajoutons des services, et √ßa va vraiment mieux, parce qu'au lieu d'un grand footcloth, nous avons obtenu une petite belle ligne. <br><br>  Cela s'est-il am√©lior√©?  C'est devenu!  Et maintenant, nous pouvons r√©utiliser cette m√©thode dans diff√©rents contr√¥leurs.  Le r√©sultat est √©vident.  Examinons la mise en ≈ìuvre de cette m√©thode. <br><br><img src="https://habrastorage.org/webt/up/xx/rx/upxxrx8d_fc-5qmzbk-d0afuht4.jpeg"><br><br>  Mais ici, tout n'est pas si bon.  Ce code est toujours l√†.  Nous venons de transf√©rer la m√™me chose aux services.  Nous avons d√©cid√© de ne pas r√©soudre le probl√®me, mais simplement de le d√©guiser et de le transf√©rer dans un autre endroit.  C‚Äôest tout. <br><br><img src="https://habrastorage.org/webt/m0/bo/fj/m0bofjvz471nmxub7ubqhshqwgi.jpeg"><br><br>  En plus de cela, d'autres questions se posent.  Faut-il faire la validation dans le contr√¥leur ou ici?  Eh bien, un peu comme dans le contr√¥leur.  Et si vous devez aller dans la base de donn√©es et voir qu'il existe un tel ID ou qu'il n'y a pas d'autre utilisateur avec un tel e-mail?  Hmm, enfin au service.  Mais la gestion des erreurs ici?  Cette gestion des erreurs est probablement l√†, et la gestion des erreurs qui r√©pondra au navigateur du contr√¥leur.  Et la m√©thode SaveChanges, est-elle dans le service ou devez-vous la transf√©rer vers le contr√¥leur?  Il peut en √™tre ainsi, car si un service est appel√©, il est plus logique d'appeler le service, et si vous avez trois m√©thodes de services dans le contr√¥leur qui doivent √™tre appel√©es, vous devez l'appeler en dehors de ces services pour que la transaction soit une.  Ces r√©flexions sugg√®rent que les couches ne r√©solvent peut-√™tre aucun probl√®me. <br><br><img src="https://habrastorage.org/webt/9d/s6/gd/9ds6gdwecmtqyjjv3rko5l-rccg.jpeg"><br><br>  Et cette id√©e est venue √† plus d'une personne.  Si vous google, au moins trois de ces maris respectables √©crivent sur la m√™me chose.  De haut en bas: Stephen .NET Junkie (malheureusement, je ne connais pas son nom de famille, car elle n'appara√Æt nulle part sur Internet), l'auteur du conteneur IoC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Simple Injector</a> .  Jimmy Bogard est l'auteur d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AutoMapper</a> .  Et en bas se trouve Scott Vlashin, auteur de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">F # pour le plaisir et le profit</a> . <br><br><img src="https://habrastorage.org/webt/pu/lt/rz/pultrzyz_24mf5fycqif--zcbpe.jpeg"><br><br>  Toutes ces personnes parlent de la m√™me chose et sugg√®rent de cr√©er des applications non pas sur la base de couches, mais sur la base de cas d'utilisation, c'est-√†-dire des exigences que l'entreprise nous demande.  Par cons√©quent, le cas d'utilisation en C # peut √™tre d√©termin√© √† l'aide de l'interface IHandler.  Il a des valeurs d'entr√©e, il y a des valeurs de sortie et il y a une m√©thode elle-m√™me qui ex√©cute r√©ellement ce cas d'utilisation. <br><br><img src="https://habrastorage.org/webt/9m/lj/hw/9mljhwhphjkuckh2r5tvegoyzg0.jpeg"><br><br>  Et √† l'int√©rieur de cette m√©thode, il peut y avoir soit un mod√®le de domaine, soit un mod√®le d√©normalis√© pour la lecture, peut-√™tre avec Dapper ou avec Elastic Search, si vous avez besoin de chercher quelque chose, et peut-√™tre que vous avez Legacy -syst√®me avec des proc√©dures stock√©es - pas de probl√®me, ainsi que des requ√™tes r√©seau - enfin, en g√©n√©ral, tout ce dont vous pourriez avoir besoin.  Mais s'il n'y a pas de couches, que faire? <br><br><img src="https://habrastorage.org/webt/lg/iw/se/lgiwseqpyf9krjfkv4j9ciluxri.jpeg"><br><br>  Pour commencer, d√©barrassons-nous de UserService.  Nous supprimons la m√©thode et cr√©ons une classe.  Et nous allons le supprimer, et nous le supprimerons √† nouveau.  Et puis prenez et retirez la classe. <br><br><img src="https://habrastorage.org/webt/xx/tv/z1/xxtvz10bmxyzpefudhd2cw7892y.jpeg"><br><br>  Pensons, ces classes sont-elles √©quivalentes ou non?  La classe GetUser renvoie des donn√©es et ne change rien sur le serveur.  Ceci, par exemple, √† propos de la demande "Donnez-moi l'ID utilisateur".  Les classes UpdateEmail et BanUser renvoient le r√©sultat de l'op√©ration et modifient l'√©tat.  Par exemple, lorsque nous disons au serveur: "Veuillez changer l'√©tat, vous devez changer quelque chose." <br><br><img src="https://habrastorage.org/webt/yj/qs/tn/yjqstnlgzw9lwrk8s1nr0j2s47u.jpeg"><br><br>  Regardons le protocole HTTP.  Il existe une m√©thode GET qui, selon la sp√©cification du protocole HTTP, devrait renvoyer des donn√©es et ne pas changer l'√©tat du serveur. <br><br><img src="https://habrastorage.org/webt/uq/ql/7i/uqql7icixrsmjce88qwxwuxouss.jpeg"><br><br>  Et il existe d'autres m√©thodes qui peuvent modifier l'√©tat du serveur et renvoyer le r√©sultat de l'op√©ration. <br><br><img src="https://habrastorage.org/webt/zu/u3/l6/zuu3l6-bulai-mgo4fozlyru8ci.jpeg"><br><br>  Le paradigme CQRS semble √™tre sp√©cifiquement con√ßu pour le protocole HTTP.  Les requ√™tes sont des op√©rations GET et les commandes sont PUT, POST, DELETE - pas besoin d'inventer quoi que ce soit. <br><br><img src="https://habrastorage.org/webt/2t/wk/yp/2twkypfgr9s5xxslujdjfelkkx4.jpeg"><br><br>  Nous red√©finissons notre gestionnaire et d√©finissons des interfaces suppl√©mentaires.  IQueryHandler, qui ne diff√®re que par le fait que nous avons suspendu la contrainte que le type de valeurs d'entr√©e est IQuery.  IQuery est une interface de marqueur, il n'y a rien d'autre que ce g√©n√©rique.  Nous avons besoin du g√©n√©rique afin de mettre une contrainte dans le QueryHandler, et maintenant, en d√©clarant QueryHandler, nous ne pouvons pas y passer pas Query, mais en passant l'objet Query l√†, nous connaissons sa valeur de retour.  C'est pratique si vous n'avez qu'une seule interface, vous n'avez donc pas √† chercher leur impl√©mentation dans le code, et encore pour ne pas g√¢cher.  Vous √©crivez IQueryHandler, y √©crivez une impl√©mentation et dans TOut vous ne pouvez pas remplacer un autre type de valeur de retour.  Il ne compile tout simplement pas.  Ainsi, vous pouvez imm√©diatement voir quelles valeurs d'entr√©e correspondent √† quelles donn√©es d'entr√©e. <br><br><img src="https://habrastorage.org/webt/e5/k9/pd/e5k9pdmjpohmvppi9j5mco2lpz8.jpeg"><br><br>  La situation est compl√®tement similaire pour CommandHandler √† une exception pr√®s: ce g√©n√©rique est n√©cessaire pour une autre astuce, que nous verrons un peu plus loin. <br><br><h3>  Impl√©mentation du gestionnaire </h3><br>  Les gestionnaires, avons-nous annonc√©, quelle est leur mise en ≈ìuvre? <br><br><img src="https://habrastorage.org/webt/xb/ye/no/xbyeno8s7xry4tv5n1t2sgig4fk.jpeg"><br><br>  Y a-t-il un probl√®me, oui?  Quelque chose semble avoir √©chou√©. <br><br><h3>  Les d√©corateurs se pr√©cipitent √† la rescousse </h3> <br>  Mais cela n'a pas aid√©, parce que nous sommes encore au milieu de la route, nous devons finaliser un peu plus, et cette fois nous devons utiliser le motif de d√©coration, √† savoir sa merveilleuse fonctionnalit√© de mise en page.  Le d√©corateur peut √™tre envelopp√© dans un d√©corateur, envelopp√© dans un d√©corateur, envelopp√© dans un d√©corateur - continuez jusqu'√† ce que vous vous ennuyiez. <br><br><img src="https://habrastorage.org/webt/pj/oj/m2/pjojm2jkr9q2q3of-rgouuydrjc.jpeg"><br><br>  Ensuite, tout ressemblera √† ceci: il y a une entr√©e Dto, elle entre dans le premier d√©corateur, la deuxi√®me, la troisi√®me, puis nous entrons dans le gestionnaire et la quittons √©galement, parcourons tous les d√©corateurs et retournons Dto dans le navigateur.  Nous d√©clarons une classe de base abstraite afin d'h√©riter plus tard, le corps de Handler est pass√© au constructeur, et nous d√©clarons la m√©thode abstraite Handle, dans laquelle une logique de d√©corateur suppl√©mentaire sera suspendue. <br><br><img src="https://habrastorage.org/webt/4k/df/ha/4kdfha-rrtuvomibpp8tuadhcrw.jpeg"><br><br>  Maintenant, avec l'aide de d√©corateurs, vous pouvez construire un pipeline entier.  Commen√ßons par les √©quipes.  Qu'avions-nous?  Valeurs d'entr√©e, validation, v√©rification des droits d'acc√®s, la logique elle-m√™me, certains √©v√©nements qui se produisent √† la suite de cette logique et valeurs de retour. <br><br><img src="https://habrastorage.org/webt/zp/yw/3i/zpyw3iastzi8ggkluwnk_dhdes0.jpeg"><br><br>  Commen√ßons par la validation.  Nous d√©clarons un d√©corateur.  IEnumerable des validateurs de type T entre dans le constructeur de ce d√©corateur. Nous les ex√©cutons tous, v√©rifions si la validation √©choue et le type de retour est <code>IEnumerable&lt;validationresult&gt;</code> , puis nous pouvons le renvoyer car les types correspondent.  Et s'il s'agit d'un autre Hander, eh bien, vous devez lever une exception, car il n'y a pas de r√©sultat ici, le type d'une autre valeur de retour. <br><br><img src="https://habrastorage.org/webt/wp/pi/bp/wppibp3w6wzoylmbhx8nsop6lda.jpeg"><br><br>  La prochaine √©tape est la s√©curit√©.  Nous d√©clarons √©galement le d√©corateur, r√©alisons la m√©thode CheckPermission et v√©rifions.  Si tout √† coup quelque chose tournait mal, tout, on ne continue pas.  Maintenant, apr√®s avoir termin√© tous les contr√¥les et √™tre s√ªrs que tout va bien, nous pouvons remplir notre logique. <br><br><h3>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Obsession des primitifs</a> </h3><br>  Avant de montrer l'impl√©mentation de la logique, je veux commencer un peu plus t√¥t, √† savoir avec les valeurs d'entr√©e qui y viennent. <br><br><img src="https://habrastorage.org/webt/gl/y5/ro/gly5roxocvdausjqf9dztn69jjk.jpeg"><br><br>  Maintenant, si nous choisissons une telle classe, alors le plus souvent, elle peut ressembler √† ceci.  Au moins le code que je vois dans le travail quotidien. <br><br><img src="https://habrastorage.org/webt/is/e4/6r/ise46rxpz-gsrqeqpqjwac-ir58.jpeg"><br><br>  Pour que la validation fonctionne, nous ajoutons ici quelques attributs qui vous indiquent de quel type de validation il s'agit.  Cela aidera du point de vue de la structure des donn√©es, mais ne facilitera pas une telle validation comme la v√©rification des valeurs dans la base de donn√©es.  C'est simplement EmailAddress, on ne sait pas comment, o√π v√©rifier comment utiliser ces attributs pour acc√©der √† la base de donn√©es.  Au lieu d'attributs, vous pouvez passer √† des types sp√©ciaux, puis ce probl√®me sera r√©solu. <br><br><img src="https://habrastorage.org/webt/oq/6b/3x/oq6b3xuwdmc5xh_04v71g02jkmo.jpeg"><br><br>  Au lieu de la primitive <code>int</code> , nous d√©clarons un type Id qui a un g√©n√©rique que c'est une certaine entit√© avec une cl√© int.  Et nous passons cette entit√© au constructeur, ou passons son Id, mais en m√™me temps nous devons passer une fonction que par Id peut prendre et retourner, v√©rifier si elle est nulle l√† ou non nulle. <br><br><img src="https://habrastorage.org/webt/tt/fk/ut/ttfkutansz1nzthl3x5adtxftde.jpeg"><br><br>  Nous faisons de m√™me avec le courrier √©lectronique.  Convertissez tous les e-mails en ligne de fond afin que tout se ressemble pour nous.  Ensuite, nous prenons l'attribut Email, le d√©clarons statique pour la compatibilit√© avec la validation ASP.NET, et ici nous l'appelons simplement.  Autrement dit, cela peut √©galement √™tre fait.  Pour que l'infrastructure ASP.NET intercepte tout cela, vous devez modifier l√©g√®rement la s√©rialisation et / ou ModelBinding.  Il n'y a pas beaucoup de code, c'est relativement simple, donc je ne m'arr√™terai pas l√†. <br><br><img src="https://habrastorage.org/webt/md/5k/zi/md5kzigojhdaybdbizxrvby2p5w.jpeg"><br><br>  Apr√®s ces modifications, au lieu des types primitifs, des types sp√©cialis√©s apparaissent ici: Id et Email.  Et apr√®s que ces ModelBinder et le d√©s√©rialiseur mis √† jour ont fonctionn√©, nous savons avec certitude que ces valeurs sont correctes, y compris que ces valeurs sont dans la base de donn√©es.  "Invariants" <br><br><img src="https://habrastorage.org/webt/hu/ew/ul/huewulf5m8-mwkha62fbu3dm5sy.jpeg"><br><br>  Le point suivant sur lequel je voudrais m'attarder est l'√©tat des invariants dans la classe, car tr√®s souvent un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le an√©mique</a> est utilis√©, dans lequel il n'y a qu'une classe, de nombreux getter-setters, on ne sait pas tr√®s bien comment ils devraient travailler ensemble.  Nous travaillons avec une logique m√©tier complexe, il est donc important pour nous que le code soit auto-document√©.  Au lieu de cela, il est pr√©f√©rable de d√©clarer le vrai constructeur avec vide pour ORM, il peut √™tre d√©clar√© prot√©g√© de sorte que les programmeurs dans leur code d'application ne puissent pas l'appeler, et ORM le pourrait.  Ici, nous ne transmettons pas le type primitif, mais le type Email, il est d√©j√† correctement correct, s'il est nul, nous lan√ßons toujours une exception.  Vous pouvez utiliser un peu de Fody, PostSharp, mais C # 8 arrive bient√¥t. Par cons√©quent, il y aura un type de r√©f√©rence non nul, et il est pr√©f√©rable d'attendre son support dans le langage.  Le moment suivant, si nous voulons changer le nom et le pr√©nom, nous voulons tr√®s probablement les changer ensemble, donc il doit y avoir une m√©thode publique appropri√©e qui les change ensemble. <br><br><img src="https://habrastorage.org/webt/p8/ze/vw/p8zevw3bkth4ialnrabvlsk3hru.jpeg"><br><br>  Dans cette m√©thode publique, nous v√©rifions √©galement que la longueur de ces lignes correspond √† ce que nous utilisons dans la base de donn√©es.  Et si quelque chose ne va pas, arr√™tez l'ex√©cution.  Ici, j'utilise la m√™me astuce.  Je d√©clare un attribut sp√©cial et je l'appelle simplement dans le code d'application. <br><br><img src="https://habrastorage.org/webt/tj/ae/mi/tjaemirkcgpbgkmknl9acjkhioa.jpeg"><br><br>  De plus, ces attributs peuvent √™tre r√©utilis√©s dans Dto.  Maintenant, si je veux changer le nom et le pr√©nom, je peux avoir une telle commande de changement.  Vaut-il la peine d'ajouter un constructeur sp√©cial ici?  Cela semble valoir le coup.  Cela ira mieux, personne ne changera ces valeurs, ne les cassera pas, elles auront exactement raison. <br><br><img src="https://habrastorage.org/webt/lt/hq/r1/lthqr1w63fzepclzgrcl6ykwaik.jpeg"><br><br>  En fait, pas vraiment.  Le fait est que les Dto ne sont pas vraiment des objets.  C'est un tel dictionnaire dans lequel nous mettons des donn√©es d√©s√©rialis√©es.  Autrement dit, ils pr√©tendent √™tre des objets, bien s√ªr, mais ils n'ont qu'une seule responsabilit√© - c'est d'√™tre s√©rialis√© et d√©s√©rialis√©.  Si nous essayons de lutter contre cette structure, nous commencerons √† annoncer des ModelBinders avec les concepteurs, faire quelque chose comme √ßa est incroyablement fatigant et, surtout, cela rompra avec les nouvelles versions de nouveaux frameworks.  Tout cela a √©t√© bien d√©crit par Mark Simon dans l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Aux fronti√®res du programme ne sont pas orient√©s objet¬ª</a> , si c'est int√©ressant, il vaut mieux lire son billet, l√† c'est d√©crit en d√©tail. <br><br><img src="https://habrastorage.org/webt/mf/bw/he/mfbwhegqg7nbmsw4iwj0y8w99c0.jpeg"><br><br>  En bref, nous avons un monde externe sale, nous mettons des v√©rifications √† l'entr√©e, le convertissons en notre mod√®le propre, puis le transf√©rons tous √† la s√©rialisation, au navigateur, √† nouveau au monde externe sale. <br><br><h3>  Gestionnaire </h3><br>  Apr√®s tous ces changements, √† quoi ressemblera le Hander ici? <br><br><img src="https://habrastorage.org/webt/o-/ov/wl/o-ovwlxyrkjuv2murrbk4ifttr4.jpeg"><br><br>  J'ai √©crit deux lignes ici afin de le rendre plus pratique √† lire, mais en g√©n√©ral, il peut √™tre √©crit en une seule.  Les donn√©es sont exactement correctes, car nous avons un syst√®me de type, il y a une validation, c'est-√†-dire que les donn√©es sont en b√©ton arm√©, vous n'avez pas besoin de les v√©rifier √† nouveau.  Un tel utilisateur existe √©galement, il n'y a pas d'autre utilisateur avec un email aussi charg√©, tout peut √™tre fait.  Cependant, il n'y a toujours pas d'appel √† la m√©thode SaveChanges, il n'y a pas de notification et il n'y a pas de journaux et de profileurs, non?  Nous continuons. <br><a name="events"></a><br><h3>  Les √©v√©nements </h3><br>  √âv√©nements de domaine. <br><br><img src="https://habrastorage.org/webt/fo/s8/tq/fos8tqpb3kq5ealyvsm3qu9ayhm.jpeg"><br><br>  Probablement la premi√®re fois que ce concept a √©t√© popularis√© par Udi Dahan dans son article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´√âv√©nements de domaine - Salut¬ª</a> .  L√†, il sugg√®re simplement de d√©clarer une classe statique avec la m√©thode Raise et de lancer de tels √©v√©nements.  Un peu plus tard, Jimmy Bogard a propos√© une meilleure impl√©mentation, elle s'appelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Un meilleur mod√®le d'√©v√©nements de domaine"</a> . <br><br><img src="https://habrastorage.org/webt/lq/e_/hq/lqe_hqerzlvb_vi4less4xr6lg4.jpeg"><br><br>  Je vais montrer la s√©rialisation de Bogard avec un petit changement, mais important.  Au lieu de lancer des √©v√©nements, nous pouvons d√©clarer une liste, et dans les endroits o√π une sorte de r√©action devrait avoir lieu, directement √† l'int√©rieur de l'entit√© pour enregistrer ces √©v√©nements.  Dans ce cas, cet getter de <code>email</code> est √©galement une classe User, et cette classe, cette propri√©t√© ne pr√©tend pas √™tre une propri√©t√© avec des getters et des setters automatiques, mais ajoute vraiment quelque chose √† cela.  Autrement dit, il s'agit d'une v√©ritable encapsulation, pas de blasph√®mes.  Lors du changement, nous v√©rifions que l'e-mail est diff√©rent et lan√ßons un √©v√©nement.  Cet √©v√©nement n'est encore arriv√© nulle part, nous ne l'avons que dans la liste interne des entit√©s. <br><br><img src="https://habrastorage.org/webt/ge/4c/nd/ge4cndzro2vbjuhb4qeujuot1qq.jpeg"><br><br>  De plus, au moment o√π nous appellerons la m√©thode SaveChanges, nous prenons ChangeTracker, voir s'il existe des entit√©s qui impl√©mentent l'interface, si elles ont des √©v√©nements de domaine.  Et s'il y en a, prenons tous ces √©v√©nements de domaine et envoyons-les √† un r√©partiteur qui sait quoi en faire. <br><br>  L'impl√©mentation de ce r√©partiteur est un sujet pour une autre discussion, il y a quelques difficult√©s avec la r√©partition multiple en C #, mais cela se fait √©galement.  Avec cette approche, il y a un autre avantage non √©vident.  Maintenant, si nous avons deux d√©veloppeurs, l'un peut √©crire du code qui modifie cet e-mail, et l'autre peut faire un module de notification.  Ils ne sont absolument pas connect√©s entre eux, ils √©crivent un code diff√©rent, ils ne sont connect√©s qu'au niveau de cet √©v√©nement de domaine d'une classe Dto.  Le premier d√©veloppeur jette simplement cette classe √† un moment donn√©, le second y r√©pond et sait qu'elle doit √™tre envoy√©e par e-mail, SMS, notifications push au t√©l√©phone et tous les autres millions de notifications, en tenant compte des pr√©f√©rences des utilisateurs qui se produisent g√©n√©ralement. <br><br><img src="https://habrastorage.org/webt/pb/-r/op/pb-ropw5rupxtrrbdfes8_lvp6q.jpeg"><br><br>  Voici le point le plus petit mais le plus important.  L'article de Jimmy utilise une surcharge de la m√©thode SaveChanges, et il vaut mieux ne pas le faire.  Et il vaut mieux le faire dans le d√©corateur, car si nous surchargeons la m√©thode SaveChanges et que nous avions besoin de dbContext dans le gestionnaire, nous obtiendrons des d√©pendances circulaires.  Vous pouvez travailler avec cela, mais les solutions sont un peu moins pratiques et un peu moins belles.  Par cons√©quent, si le pipeline est construit sur des d√©corateurs, je ne vois aucune raison de le faire diff√©remment. <br><br><h3>  Journalisation et profilage </h3><br><img src="https://habrastorage.org/webt/bg/nq/m_/bgnqm_jchmmhwbbl7bsvb-binni.jpeg"><br><br>  L'imbrication du code est rest√©e, mais dans l'exemple initial, nous avons d'abord utilis√© MiniProfiler, puis essayez catch, puis if.  Au total, il y avait trois niveaux d'imbrication, maintenant chacun ce niveau d'imbrication est dans son propre d√©corateur.  Et √† l'int√©rieur du d√©corateur, qui est responsable du profilage, nous n'avons qu'un seul niveau d'imbrication, le code est parfaitement lu.  De plus, il est clair que chez ces d√©corateurs il n'y a qu'une seule responsabilit√©.  Si le d√©corateur est responsable de la journalisation, il ne se connectera que, si pour le profilage, respectivement, uniquement le profil, tout le reste est ailleurs. <br><br><h3>  R√©ponse </h3><br>  Une fois que tout le pipeline a fonctionn√©, nous ne pouvons que prendre Dto et l'envoyer au navigateur, s√©rialiser JSON. <br><br><img src="https://habrastorage.org/webt/wc/tt/0h/wctt0hneqcetsw0pjtya_s5p5eg.jpeg"><br><br>  Mais encore une petite chose, une chose qui est parfois oubli√©e: √† chaque √©tape, une exception peut se produire ici, et en fait vous devez en quelque sorte les g√©rer. <br><br><img src="https://habrastorage.org/webt/rh/ns/lh/rhnslhowdccmndavybt1a9pyfmy.jpeg"><br><br>  Je ne peux pas ne pas mentionner encore Scott Vlashin et son rapport <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Programmation ax√©e sur les chemins de fer¬ª</a> .  Pourquoi?  Le rapport original est enti√®rement consacr√© √† travailler avec les erreurs dans le langage F #, comment organiser le flux un peu diff√©remment et pourquoi une telle approche peut √™tre pr√©f√©rable √† l'utilisation d'Exception'ov.  En F #, cela fonctionne vraiment tr√®s bien, car F # est un langage fonctionnel, et Scott utilise les fonctionnalit√©s d'un langage fonctionnel. <br><br><img src="https://habrastorage.org/webt/wd/-7/gg/wd-7ggf6-mg0y1orcgz-2si45ci.jpeg"><br><br>  Puisque, probablement, la plupart d'entre vous √©crivent toujours en C #, si vous √©crivez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un analogue en C #</a> , cette approche ressemblera √† ceci.  Au lieu de lever des exceptions, nous d√©clarons une classe Result qui a une branche r√©ussie et une branche non r√©ussie.  En cons√©quence, deux designers.  Une classe ne peut √™tre que dans un seul √©tat.  Cette classe est un cas particulier de type union, union discrimin√©e de F #, mais r√©√©crite en C #, car il n'y a pas de support int√©gr√© en C #. <br><br><img src="https://habrastorage.org/webt/jo/xu/p2/joxup2i8w_uziwqyawnwp6cty8e.jpeg"><br><br>  Au lieu de d√©clarer des getters publics que quelqu'un pourrait ne pas v√©rifier la null dans le code, la correspondance de mod√®le est utilis√©e.  Encore une fois, en F #, ce serait un langage de correspondance de motifs int√©gr√©, en C #, nous devons √©crire une m√©thode distincte dans laquelle nous passerons une fonction qui sait quoi faire avec le r√©sultat r√©ussi de l'op√©ration, comment le convertir plus loin dans la cha√Æne, et cela avec une erreur.  Autrement dit, quelle que soit la branche qui a fonctionn√© pour nous, nous devons convertir cela en un seul r√©sultat renvoy√©.  En F #, tout cela fonctionne tr√®s bien, car il y a une composition fonctionnelle, eh bien, et tout le reste que j'ai d√©j√† r√©pertori√©.  Dans .NET, cela fonctionne un peu moins bien, car d√®s que vous avez plusieurs r√©sultats, mais beaucoup - et presque toutes les m√©thodes peuvent √©chouer pour une raison ou une autre - presque tous vos types de fonctions r√©sultants deviennent des types de r√©sultats, et vous en avez besoin en tant que pour combiner quelque chose. <br><br><img src="https://habrastorage.org/webt/vb/s8/wd/vbs8wdzd81uocge3l2louammnwa.jpeg"><br><br>  La fa√ßon la plus simple de les combiner consiste √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utiliser LINQ</a> , car en fait LINQ fonctionne non seulement avec IEnumerable, si vous red√©finissez les m√©thodes SelectMany et Select de la bonne mani√®re, le compilateur C # verra que vous pouvez utiliser la syntaxe LINQ pour ces types.  En g√©n√©ral, il s'av√®re que du papier calque avec la notation Haskell do ou avec les m√™mes expressions de calcul en F #.  Comment lire cela?  Ici, nous avons trois r√©sultats de l'op√©ration, et si tout va bien dans les trois cas, prenez ces r√©sultats r1 + r2 + r3 et ajoutez-les.  Le type de la valeur r√©sultante sera √©galement Result, mais le nouveau Result, que nous d√©clarons dans Select.  En g√©n√©ral, c'est m√™me une approche de travail, sinon une, mais. <br><br><img src="https://habrastorage.org/webt/ez/8d/lw/ez8dlwqtpilfzqbpsp_8zg1udvw.jpeg"><br><br>  Pour tous les autres d√©veloppeurs, d√®s que vous commencez √† √©crire un tel code en C #, vous commencez √† ressembler √† ceci.  ¬´Ce sont de mauvaises exceptions effrayantes, ne les √©crivez pas!  Ils sont mauvais!  Mieux vaut √©crire du code que personne ne comprend et ne peut pas d√©boguer! ¬ª <br><br><img src="https://habrastorage.org/webt/v4/v4/vd/v4v4vdhq2reierp3a0diyhtm-ws.jpeg"><br><br>  C # n'est pas F #, il est quelque peu diff√©rent, il n'y a pas de concepts diff√©rents sur la base desquels cela se fait, et lorsque nous essayons de tirer un hibou sur le globe, il s'av√®re, pour le dire doucement, inhabituel. <br><br><img src="https://habrastorage.org/webt/ns/w3/q7/nsw3q7lbpx2xqiewao1619j-t1s.jpeg"><br><br>  Au lieu de cela, vous pouvez utiliser les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">outils normaux int√©gr√©s</a> qui sont document√©s, que tout le monde conna√Æt et qui ne provoqueront pas de dissonance cognitive chez les d√©veloppeurs.  ASP.NET a une exception de gestionnaire globale. <br><br><img src="https://habrastorage.org/webt/i8/9i/vk/i89ivkfdyr5w8xmemg2by9qz0zs.jpeg"><br><br>  Nous savons que s'il y a des probl√®mes de validation, vous devez retourner le code 400 ou 422 (Entit√© non traitable).  S'il y a un probl√®me d'authentification et d'autorisation, il y a 401 et 403. Si quelque chose s'est mal pass√©, alors quelque chose s'est mal pass√©.  Et si quelque chose s'est mal pass√© et que vous voulez dire exactement √† l'utilisateur quoi, d√©finissez votre type d'exception, dites que c'est IHasUserMessage, d√©clarez un getter de message dans cette interface et v√©rifiez simplement: si cette interface est impl√©ment√©e, alors vous pouvez prendre un message d'Exception et le transmettre en JSON √† l'utilisateur.  Si cette interface n'est pas impl√©ment√©e, il y a une sorte d'erreur syst√®me, et nous disons simplement aux utilisateurs que quelque chose s'est mal pass√©, nous le faisons d√©j√†, nous le savons tous - comme d'habitude. <br><br><h3>  Pipeline de requ√™te </h3><br>  Nous concluons cela avec les √©quipes et examinons ce que nous avons dans la pile de lecture.  Quant √† la demande, la validation, la r√©ponse directe - c'est √† peu pr√®s la m√™me chose, nous ne nous arr√™terons pas s√©par√©ment.  Il peut toujours y avoir un cache suppl√©mentaire, mais en g√©n√©ral il n'y a pas non plus de gros probl√®mes avec le cache. <br><br><h3>  La s√©curit√© </h3><br>  Regardons mieux un contr√¥le de s√©curit√©.  Il peut √©galement y avoir le m√™me d√©corateur de s√©curit√©, qui v√©rifie si cette demande peut √™tre faite ou non: <br><br><img src="https://habrastorage.org/webt/9k/y7/dr/9ky7drwhf3o5tk_r6wcapy4nqaw.jpeg"><br><br>  Mais il y a un autre cas o√π nous affichons plus d'un enregistrement et affichons des listes, et pour certains utilisateurs, nous devons afficher une liste compl√®te (par exemple, pour certains super administrateurs), et pour d'autres utilisateurs, nous devons r√©pertorier des listes limit√©es, troisi√®me - limit√© √† l'autre, et comme c'est souvent le cas dans les applications d'entreprise, les droits d'acc√®s peuvent √™tre extr√™mement sophistiqu√©s, vous devez donc √™tre s√ªr que les donn√©es qui ne ciblent pas ces utilisateurs ne se glissent pas dans ces listes. <br><br>  Le probl√®me est r√©solu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tout simplement</a> .  Nous pouvons red√©finir l'interface (IPermissionFilter) dans laquelle arrive la requ√™te originale et renvoie la requ√™te.  La diff√©rence est que pour l'interrogable qui retourne, nous avons d√©j√† impos√© des conditions suppl√©mentaires o√π, v√©rifi√© l'utilisateur actuel et dit: ¬´Ici, ne renvoyez que ces donn√©es √† cet utilisateur ...¬ª - et puis toute votre logique li√©e aux autorisations .  Encore une fois, si vous avez deux programmeurs, un programmeur va √©crire des autorisations, il sait qu'il a besoin d'√©crire juste beaucoup de permissionFilters et de v√©rifier qu'ils fonctionnent correctement pour toutes les entit√©s.  Et d'autres programmeurs ne savent rien de l'autorisation, dans leur liste, les donn√©es correctes passent toujours, c'est tout.  Parce qu'ils re√ßoivent √† l'entr√©e non plus la requ√™te originale de dbContext, mais limit√©e aux filtres.  Un tel permissionFilter a √©galement une propri√©t√© de mise en page, nous pouvons ajouter et appliquer tous les permissionFilters.  Par cons√©quent, nous obtenons le permissionFilter r√©sultant, qui restreindra la s√©lection des donn√©es au maximum, en tenant compte de toutes les conditions qui conviennent √† cette entit√©. <br><br><img src="https://habrastorage.org/webt/25/2o/xj/252oxjpxf1p7zd_aq3nt55cenyi.jpeg"><br><br>  Pourquoi ne pas le faire avec les outils int√©gr√©s ORM, par exemple, les filtres globaux dans un framework d'entit√©?  Encore une fois, afin de ne pas cr√©er de d√©pendances cycliques pour vous-m√™me et de ne pas faire glisser d'historique suppl√©mentaire sur votre couche m√©tier dans son contexte. <br><br><h3>  Pipeline de requ√™te.  Lire le mod√®le </h3><br>  Reste √† regarder le mod√®le de lecture.  Le paradigme CQRS n'utilise pas le mod√®le de domaine dans la pile de lecture, au lieu de cela, nous cr√©ons juste imm√©diatement le Dto dont le navigateur a besoin pour le moment. <br><br><img src="https://habrastorage.org/webt/2s/kc/0y/2skc0ygq4rmh9rs6cyg5czxa5rm.jpeg"><br><br>  Si nous √©crivons en C #, il est fort probable que nous utilisons LINQ, s'il n'y a pas que des exigences de performance monstrueuses, et s'il y en a, alors vous n'aurez peut-√™tre pas d'application d'entreprise.  En g√©n√©ral, ce probl√®me peut √™tre r√©solu une fois pour toutes avec un tel LinqQueryHandler.  Voici une contrainte assez effrayante sur le g√©n√©rique: c'est Query, qui renvoie une liste de projections, et il peut toujours filtrer ces projections et trier ces projections.  Elle ne travaille √©galement qu'avec certains types d'entit√©s et sait comment convertir ces entit√©s en projections et renvoyer la liste de ces projections sous forme de Dto au navigateur. <br><br><img src="https://habrastorage.org/webt/8e/vz/ax/8evzaxkzbhqx0mgxfadxacpek24.jpeg"><br><br>  La mise en ≈ìuvre de la m√©thode Handle peut √™tre assez simple.  Au cas o√π, v√©rifiez si ce filtre TQuery impl√©mente pour l'entit√© d'origine.  De plus, nous faisons une projection, c'est l'extension interrogeable AutoMapper.  Si quelqu'un ne le sait toujours pas, AutoMapper peut cr√©er des projections dans LINQ, c'est-√†-dire celles qui cr√©eront la m√©thode Select et ne la mapperont pas en m√©moire. <br><br>  Ensuite, nous appliquons le filtrage, le tri et affichons le tout dans le navigateur.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment exactement tout cela est fait, j'ai dit √† Saint-P√©tersbourg sur DotNext, ceci est un autre rapport entier, il est d√©j√† disponible gratuitement et </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©chiffr√© dans le Habr√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , vous pouvez √©couter, voir, lire comment √©crire le filtrage, le tri et la projection en utilisant expression'ov pour quoi que ce soit une fois, puis r√©utilis√©.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes les expressions ne sont pas √©galement </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiles</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> traduites en SQL</font></font></h3><br>  .  ,       DotNext', ‚Äî      SQL.    Select , ,      ,  queryable-   . <br><br><img src="https://habrastorage.org/webt/3j/ns/3b/3jns3bzz_ebriubturd0ewzzwqg.jpeg"><br><br>      ,    .     ,    Title,  Title      ,     .      ,  .        SubTitle,      ,   ,     -      ,    queryable-   .    ,        . <br><br>      ,    .  ,    ,     .    ,   , .     ¬´JsonIgnore¬ª,     .    ,   ,  Dto.    ,     ,      .       JSON,  ,  Created  LastUpdated   ,  SubTitle ‚Äî   ,   .    ,   ,        ,   , ,       .          ,  -     . <br><br><img src="https://habrastorage.org/webt/uy/el/go/uyelgoxsnf7dzhsv6arfq0q16ly.jpeg"><br><br>      . ,  -,      ,    .    ,  pipeline,     .      ‚Äî      , ,  . ,      SaveChanges,   Query    SaveChanges.      ,    ,          ,   NuGet,         . <br><br>         .     ,    -  ,     ,     .   , ,   , , ,       ‚Äî   . ,  ,      : ¬´    ¬ª, ‚Äî   .  . <br><br><h2>   </h2><br>    ,    ? <br><br><img src="https://habrastorage.org/webt/rj/px/0i/rjpx0ig2zyqa7d9g47vibhbeccy.jpeg"><br><br>    -  .   . <br><br><img src="https://habrastorage.org/webt/d6/ag/p7/d6agp7a_t3m2ppxscq9vb7piagq.jpeg"><br><br>  , ,    ,     .   MediatR  ,         . ,    ,    ‚Äî ,    MediatR   pipeline behaviour.    ,      Request/Response, RequestHandler'      .    Simple Injector,    ‚Äî    . <br><br><img src="https://habrastorage.org/webt/qd/et/4g/qdet4g_b9ezljfr1mx9moe_m18y.jpeg"><br><br>       , ,  ,       ,  TIn: ICommand. <br><br><img src="https://habrastorage.org/webt/su/nb/vn/sunbvndlkmxley6clq7hs4hj70s.jpeg"><br><br>   Simple Injector'      constraint' .     ,    , ,     constraint',        Handler',     constraint. ,     constraint ICommand,      SaveChanges   constraint'  ICommand,  Simple Injector  ,    constraint' ,         Handler'. ,      ,          ,     . <br><br>  ? Simple Injector  MeriatR ‚Äî  ,       ,    Autofac', -,          ,    ,  .  , . <br><br><h2>   ,    </h2><br>          ,   ¬´¬ª. <br><br><img src="https://habrastorage.org/webt/8m/1l/lj/8m1lljzfrx2amaidftyjnthd3yc.jpeg"><br><br>   ,   ¬´Clean architecture¬ª.             . <br><br><img src="https://habrastorage.org/webt/ch/gm/jq/chgmjq7gihsvthnvinnydngrtcw.jpeg"><br><br>  - -     ,   MVC,   ,    . <br><br><img src="https://habrastorage.org/webt/g8/70/wz/g870wzkcrbvqeplit3m_i69uru4.jpeg"><br><br>  ,   ,   ,     Angular, ,       ,      ,    .  ,  : ¬´ ‚Äî MVC-¬ª,  : ¬´    Features,    :     ,    Blog     - Import,    -  ¬ª. <br><br>  , , ,  ,   MVC-,  ,   -  , .    MVC  .    ,   ,      ‚Äî     .       . <br><br><img src="https://habrastorage.org/webt/ix/8v/qo/ix8vqotanjad8uljd2rfz17xygg.jpeg"><br><br><img src="https://habrastorage.org/webt/xq/lj/bv/xqljbvd8zk59n6pdn1-q-x4czhc.jpeg"><br><br>    -     ,  -   -,        . <br><br> -,     ,   .            ,   .   ,          -   ,         User Service,   pull request',     ,       User Service    ,   .    ,      - ,     -  , . -       ,             . <br><br>  .         ,          .  ,    ,             ,   . , ,  ,  ,   ,     ,    ,     -   .    ,      (    ,    ),     ,    ¬´Delete¬ª:   ,      ,  .  . <br><br>          ‚Äî  ¬´¬ª, ,   ,       ,   .          ,    :   ,    ,     ,      .           ,   .      ,    ,   .      ,      ,      . <br><br>   :        .    ¬´ ¬ª,        :     ,     ,         . ,    ,    ,       , ,    ,  ,   .        ,   .  ,   - pull request    ,    ‚Äî  ,    ‚Äî -   ,    .          VCS    :     -  ,    ?       ,    -  ,         ,    . <br><br><img src="https://habrastorage.org/webt/ie/g2/i6/ieg2i6gpy-mp6nsmrvdvxot3x6o.jpeg"><br><br>   , ,    ,   .  :     .        ,     .  ,    ,      ,  ,   .    , ,    ,      . ,  , .    ¬´ ¬ª,        ,     .  ,   ,      ‚Äî  ,      ,   . <br><br>      :    , - , .           .  -      ,    ,  ,   ,  .       -        ,  -        ,      , ,      ,    .    . <br><br><img src="https://habrastorage.org/webt/8g/7g/3h/8g7g3htn43hhoprdfj2thj86wre.jpeg"><br><br> .         ,       IHandler     .    . <br><br>   IHandler    ICommandHandler  IQueryHandler  ,    .    ,     ,       .  ,   CommandHandler,      CommandHandler',       . <br><br>  Pourquoi      ,    Query   ,   Query ‚Äî   .      ,     ,  ,    Hander,    CommandHandler  QueryHandler,   -  use case,     . <br><br>  ‚Äî     ,      ,  ,    ,     :  ,  . <br><br>      ,  .         ,    .    ,       -. <br><br>      C# 8,   nullable reference type      .  , , ,     ,  . <br><br>         ChangeTracker' ORM. <br><br>  Exception' ‚Äî     ,     F#,     C#.  ,   -     ,    -   , .        ,   ,      Exception', ,      LINQ,   ,  ,    ,     ,    , Dapper  - , ,  ,   .NET. <br><br>          ,  LINQ,  , permission' ‚Äî   . ,    ,   - ,    ,       .      ,     ‚Äî   . <br><br>        .  : <br><br><hr><br><ul><li> Vertical Slices <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.youtube.com/watch?v=SUiWfhAhgQw</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.cuttingedge.it/blogs/steven/pivot/entry.php?id=91</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cuttingedge.it/blogs/steven/pivot/entry.php?id=92</a> </li></ul></li><li>   <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/post/266937</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/post/205088</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/post/205108</a> </li></ul></li><li> Domain Events <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">udidahan.com/2009/06/14/domain-events-salvation</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lostechies.com/jimmybogard/2014/05/13/a-better-domain-events-pattern</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">enterprisecraftsmanship.com/2017/10/03/domain-events-simple-and-reliable-solution</a> </li></ul></li><li> DDD <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/post/334126</a> </li></ul></li><li> ROP <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fsharpforfunandprofit.com/rop</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/post/339606</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/post/347284</a> </li></ul></li><li> LINQ  Expressions: <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/jugru/blog/423891</a> </li></ul></li><li> Clean Architecture <br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.youtube.com/watch?v=JEeEic-c0D4</a> </li></ul></li></ul><br><img src="https://habrastorage.org/webt/fm/ik/wu/fmikwu49krcbqw7xbefe1vm6tsq.jpeg"><br><br>   ‚Äî   .      .   ‚Äî     ¬´Domain Modeling Made Functional¬ª,   F#,          F#,      ,     ,     ,        ,      .       C# ,    ,         Exception'. <br><br>  ,  ,   ‚Äî  ¬´Entity Framework Core In Action¬ª.      ,    Entity Framework,         ,     DDD  ORM,   ,   ORM      DDD    . <br><br><blockquote>  Minute de publicit√©. 15-16  2019  .NET- DotNext Piter,      .   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447308/">https://habr.com/ru/post/fr447308/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447298/index.html">Gestion des connaissances gr√¢ce √† des mod√®les de comp√©tences</a></li>
<li><a href="../fr447300/index.html">Cr√©ation de VirtualBox pour Windows</a></li>
<li><a href="../fr447302/index.html">Syst√®me d'exploitation Week-end</a></li>
<li><a href="../fr447304/index.html">Avaricious ne paie pas deux fois - nous configurons la m√©moire sur la plate-forme AMD B450 et obtenons des performances gratuites</a></li>
<li><a href="../fr447306/index.html">Transformateur Tesla sur une carte de pouce carr√©</a></li>
<li><a href="../fr447310/index.html">Comment nous sommes pass√©s du d√©veloppement Web au d√©veloppement de jeux</a></li>
<li><a href="../fr447314/index.html">Ce que j'ai compris de la cr√©ation d'une entreprise apr√®s avoir travaill√© sept ans chez Airbnb</a></li>
<li><a href="../fr447318/index.html">Gadgets d'un march√© aux puces: pourquoi acheter un ordinateur portable Packard Bell de 20 ans pour 10 euros</a></li>
<li><a href="../fr447322/index.html">Principes de construction d'une API REST JSON</a></li>
<li><a href="../fr447324/index.html">Comment l'ordinateur fonctionne √† l'int√©rieur de Hayabusa-2, qui a largu√© une bombe sur Ryuga. Et des photos de ses d√©veloppeurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>