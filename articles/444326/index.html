<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèâ ü§ûüèª üö∂üèæ Monitoreo por SMS del peso de tres colmenas por $ 30 üéÑ üßñüèø üë®‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No, esta no es una oferta comercial, tal es el costo de los componentes del sistema que puede recopilar despu√©s de leer el art√≠culo. 


 Un poco de hi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoreo por SMS del peso de tres colmenas por $ 30</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444326/"><p><img src="https://habrastorage.org/getpro/habr/post_images/f9b/e29/cd3/f9be29cd3be301fe1554f261ae6d0dcb.jpg" alt="Mi logo"></p><br><p>  No, esta no es una oferta comercial, tal es el costo de los componentes del sistema que puede recopilar despu√©s de leer el art√≠culo. </p><br><p>  Un poco de historia: </p><br><p>  Hace alg√∫n tiempo, decid√≠ conseguir abejas, y aparecieron ... durante toda la temporada, pero no salieron del invierno. <br>  Y esto a pesar del hecho de que todo parec√≠a estar funcionando bien: se√±uelo oto√±al, calent√°ndose antes del fr√≠o. <br>  La colmena era un cl√°sico sistema Dadan de madera con 10 cuadros de una tabla de 40 mm. <br>  Pero ese invierno, incluso los apicultores experimentados perdieron mucho m√°s de lo habitual debido a los cambios de temperatura. </p><br><p>  Entonces surgi√≥ la idea de un sistema de monitoreo del estado de la colmena. <br>  Despu√©s de la publicaci√≥n de varios art√≠culos sobre Habr-e y la comunicaci√≥n en el foro de los apicultores, decid√≠ pasar de lo simple a lo complejo. <br>  El peso es el √∫nico par√°metro indiscutible, pero por regla general, los sistemas existentes monitorean solo una colmena de "referencia". <br>  Si algo sale mal con √©l (por ejemplo, el vuelo de un enjambre, la enfermedad de las abejas), entonces los indicadores se vuelven irrelevantes. </p><br><p>  Por lo tanto, se decidi√≥ controlar el cambio de peso de tres colmenas a la vez con un microcontrolador y agregar los otros "bollos" despu√©s. <br>  El resultado es un sistema aut√≥nomo con un tiempo de ejecuci√≥n de aproximadamente un mes con una sola carga de la bater√≠a 18650 y enviando estad√≠sticas una vez al d√≠a. <br>  Trat√© de simplificar el dise√±o tanto como sea posible, para que pudiera repetirse incluso sin esquemas, seg√∫n una fotograf√≠a. </p><br><p>  La l√≥gica del trabajo es la siguiente: en el primer inicio / reinicio, las lecturas de los sensores instalados debajo de las colmenas se almacenan en la EEPROM. <br>  Adem√°s, todos los d√≠as, despu√©s del atardecer, el sistema "se despierta", lee el testimonio y env√≠a SMS con un cambio de peso por d√≠a y desde el momento en que se enciende. <br>  Adem√°s, el valor de voltaje de la bater√≠a se transmite, y cuando se baja a 3.5 V, se emite una advertencia sobre la necesidad de cargar, porque debajo de 3.4 V el m√≥dulo de comunicaci√≥n no se enciende y las indicaciones de peso ya est√°n "flotando". </p><a name="habracut"></a><br><p>  "¬øRecuerdas c√≥mo empez√≥ todo? Todo fue la primera y la otra vez". <br><img src="https://habrastorage.org/getpro/habr/post_images/2f2/432/274/2f24322742ff9b620f05bb2804a5bb03.jpg" alt="¬øC√≥mo comienza?"><br>  S√≠, originalmente era un conjunto de "hierro", aunque solo las celdas de carga y los cables sobrevivieron a la versi√≥n final, pero lo primero es lo primero. <br>  De hecho, el compartimento para cables no es necesario, simplemente result√≥ tener el mismo precio que 30 m de plano. </p><br><p>  Si no tiene miedo de desmantelar 3 LED smd y medio centenar de puntos de soldadura normal (de salida), ¬°vaya! </p><br><p>  Por lo tanto, necesitamos el siguiente conjunto de equipos / materiales: </p><br><ol><li>  Arduino Pro Mini 3V <br>  Debe prestar atenci√≥n al microchip convertidor lineal (debe ser exactamente 3,3 V) en el chip de marcado KB 33 / LB 33 / DE A10: los chinos han mezclado algo conmigo y todo el lote <br>  Las placas de circuito en la tienda resultaron ser con reguladores de 5 voltios y cuarzo de 16MHz. </li><li>  USB-Ttl en un chip CH340: puede incluso 5 voltios, pero luego, durante el firmware del microcontrolador, Arduino deber√° desconectarse del m√≥dulo GSM para no quemar el √∫ltimo. <br>  Las placas en el chip PL2303 no funcionan en Windows 10. </li><li>  M√≥dulo de comunicaci√≥n GSM Goouu Tech IOT GA-6-B o AI-THINKER A-6 Mini. <br>  ¬øPor qu√© te detuviste?  Neoway M590, un dise√±ador que requiere bailes separados con panderetas, GSM SIM800L, no le gust√≥ el nivel l√≥gico no est√°ndar de 2.8V, que requiere coordinaci√≥n incluso con un arduino de tres voltios. <br>  Adem√°s, la soluci√≥n de AiThinker tiene un consumo m√≠nimo de energ√≠a (al enviar SMS, no vi una corriente superior a 100 mA). </li><li>  Antena GSM GPRS 3DBI (en la foto de arriba - una bufanda rectangular con una "cola", durante 9 horas) </li><li>  Paquete de inicio para un operador que tiene una buena cobertura en la ubicaci√≥n de su colmenar. <br>  S√≠, el paquete debe activarse primero en un tel√©fono normal, DESHABILITAR la SOLICITUD DE PIN en la entrada y reponer la cuenta. <br>  Ahora hay muchas opciones con nombres en el estilo de "Sensor", "IoT": tienen tarifas mensuales ligeramente m√°s bajas. </li><li>  cable dupont 20cm madre madre - 3 piezas  (para conectar Arduino a USB-TTL) </li><li>  3 piezas  HX711 - ADC para b√°sculas </li><li>  6 c√©lulas de carga que pesan hasta 50 kg </li><li>  15 metros de cable telef√≥nico de 4 hilos - para conectar m√≥dulos de pesas con ARDUINO. </li><li>  Fotorresistencia GL5528 (esto es importante, con una resistencia oscura de 1MOhm y una resistencia a la luz de 10-20kOhm) y dos resistencias convencionales de 20k </li><li>  Un trozo de cinta adhesiva de doble cara de 18x18 mm de grosor para unir el arduino al m√≥dulo de comunicaci√≥n. </li><li>  El soporte de la bater√≠a 18650 y, de hecho, la bater√≠a en s√≠ misma ~ 2600mAh. </li><li>  Un poco de cera o parafina (vela de tableta con l√°mpara de aroma) - para protecci√≥n contra la humedad HX711 </li><li>  Una pieza de viga de madera de 25x50x300mm para la base de las celdas de carga. </li><li>  Una docena de tornillos autorroscantes con una arandela de presi√≥n de 4.2x19 mm para montar los sensores en la base. </li></ol><br><p>  La bater√≠a se puede extraer del desmontaje de las computadoras port√°tiles, muchas veces m√°s baratas que una nueva, y la capacidad ser√° mucho mayor que la del UltraFire chino. Obtuve 1,500 versus 450 (esto es del firewall 6800 ;-) </p><br><p>  Adem√°s, requerir√° manos torcidas, un soldador EPSN-25, colofonia y soldadura POS-60. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0a9/222/e6a/0a9222e6acd4d43631f777dfa995dcab.jpg" alt="Soldador"></p><br><p>  Incluso hace 5 a√±os, us√© un soldador sovi√©tico con una picadura de cobre (no obtuve estaciones de soldadura, lo tom√© para una prueba de manejo y termin√© con el circuito EPSN). <br>  Pero despu√©s de su fracaso y varios monstruos chinos bajo (d) √°rboles de Navidad, este √∫ltimo se llam√≥ Esparta, algo tan severo como que el nombre se detuvo. <br>  en un producto con un controlador de temperatura. </p><br><p>  ¬°Entonces vamos! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/eba/218/027/eba21802786557630e811458e9a07eaa.jpg" alt="GSM A6"></p><br><p>  Para comenzar, se sueldan dos LED del m√≥dulo GSM (el lugar donde se rodearon en un √≥valo naranja) <br>  Insertamos la tarjeta SIM con las almohadillas en la placa de circuito impreso, la esquina biselada en la foto se indica con la flecha. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/463/027/4e6/4630274e63f3710ea1b69f94a3d2dd8b.jpg" alt="Arduino Pro Mini 3v"></p><br><p>  Luego realizamos un procedimiento similar con el LED en la placa Arduino (el √≥valo a la izquierda del chip cuadrado), <br>  Suelde el peine en cuatro contactos (1), <br>  Tomamos dos resistencias de 20k, giramos los cables en un lado, soldamos el cable en el orificio de contacto A5, los cables restantes en el arduinki RAW y GND (2), <br>  Acortamos el fotorresistor a 10 mm y lo soldamos a las conclusiones de las placas GND y D2 (3). </p><br><p>  Ahora es tiempo <del>  cinta aislante azul </del>  cinta de doble cara: p√©guela en el soporte de la tarjeta SIM del m√≥dulo de comunicaci√≥n y, en la parte superior, arduino, el bot√≥n rojo (plateado) est√° frente a nosotros y se encuentra sobre la tarjeta SIM. </p><br><p>  Suelde la potencia: m√°s desde el condensador del m√≥dulo de comunicaci√≥n (4) al pin RAW arduino. <br>  El hecho es que el m√≥dulo de comunicaci√≥n en s√≠ mismo requiere 3.4-4.2V para su fuente de alimentaci√≥n, y su contacto PWR est√° conectado a un convertidor reductor, por lo que para la operaci√≥n del voltaje de iones de litio debe aplicarse sin pasar por esta parte del circuito. </p><br><p>  En arduino, por el contrario, iniciamos la fuente de alimentaci√≥n a trav√©s de un convertidor lineal: a bajas corrientes, la ca√≠da de voltaje de ca√≠da es de 0.1V. <br>  Pero al aplicar voltaje estabilizado a los m√≥dulos HX711, eliminamos la necesidad de refinarlos a un voltaje m√°s bajo (y al mismo tiempo aumentar el ruido como resultado de esta operaci√≥n). </p><br><p>  Luego soldamos los puentes (5) entre los contactos de PWR-A1, URX-D4 y UTX-D5, la tierra GND-G (6) y finalmente la energ√≠a del soporte de la bater√≠a 18650 (7), conectamos la antena (8). <br>  Ahora tomamos el convertidor USB-TTL y conectamos los contactos RXD-TXD y TXD-RXD, GND-GND con los cables Dupont a ARDUINO (peine 1): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/651/7dc/8ff/6517dc8ffbb81e4be9f1793db3eb66aa.jpg" alt="Primera versi√≥n"></p><br><p>  En la foto de arriba, la primera versi√≥n (de tres) del sistema, que se utiliz√≥ para la depuraci√≥n. </p><br><p>  Y ahora, por un tiempo, nos alejamos del soldador y pasamos a la parte del software. <br>  Describir√© la secuencia de acciones para Windows: <br>  En primer lugar, debe descargar e instalar / descomprimir el programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Arduino IDE</a> : la versi√≥n actual es 1.8.9, pero uso 1.6.4 </p><br><p>  Por simplicidad, desempaquetamos el archivo en la carpeta C: \ arduino- "your_version_number", dentro tendremos las carpetas / dist, drivers, ejemplos, hardware, java, lib, bibliotecas, referencias, herramientas, as√≠ como el archivo ejecutable arduino (entre otros). </p><br><p>  Ahora necesitamos una biblioteca para trabajar con el ADC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HX711</a> - el bot√≥n verde "clonar o descargar" - descargar ZIP. <br>  El contenido (carpeta HX711-master) se coloca en el directorio C: \ arduino- "your_version_number" \ bibliotecas </p><br><p>  Y, por supuesto, el controlador para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">USB-TTL es</a> del mismo github: desde el archivo desempaquetado, simplemente se inicia el archivo de instalaci√≥n del instalador. </p><br><p>  Ok, ejecuta y configura el programa C: \ arduino- "your_version_number" \ arduino </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2fd/429/2d5/2fd4292d54f67c31052b54ca853be5b3.jpg" alt="Interfaz de programa"></p><br><p>  Vamos al elemento "Herramientas": seleccione la placa "Arduino Pro o Pro Mini", el procesador Atmega 328 3.3V 8 MHz, el puerto es el n√∫mero distinto del sistema COM1 (aparece despu√©s de instalar el controlador CH340 con el adaptador USB-TTL conectado) </p><br><p>  Ok, copie el siguiente boceto (programa) y p√©guelo en la ventana Arduino IDE </p><br><pre><code class="plaintext hljs">char phone_no[]="+123456789012"; // Your phone number that receive SMS with counry code #include &lt;avr/sleep.h&gt; // ARDUINO sleep mode library #include &lt;SoftwareSerial.h&gt; // Sofrware serial library #include "HX711.h" // HX711 lib. https://github.com/bogde/HX711 #include &lt;EEPROM.h&gt; // EEPROM lib. HX711 scale0(10, 14); HX711 scale1(11, 14); HX711 scale2(12, 14); #define SENSORCNT 3 HX711 *scale[SENSORCNT]; SoftwareSerial mySerial(5, 4); // Set I/O-port TXD, RXD of GSM-shield byte pin2sleep=15; // Set powerON/OFF pin float delta00; // delta weight from start float delta10; float delta20; float delta01; // delta weight from yesterday float delta11; float delta21; float raw00; //raw data from sensors on first start float raw10; float raw20; float raw01; //raw data from sensors on yesterday float raw11; float raw21; float raw02; //actual raw data from sensors float raw12; float raw22; word calibrate0=20880; //calibration factor for each sensor word calibrate1=20880; word calibrate2=20880; word daynum=0; //numbers of day after start int notsunset=0; boolean setZero=false; float readVcc() { // Read battery voltage function long result1000; float rvcc; result1000 = analogRead(A5); rvcc=result1000; rvcc=6.6*rvcc/1023; return rvcc; } void setup() { // Setup part run once, at start pinMode(13, OUTPUT); // Led pin init pinMode(2, INPUT_PULLUP); // Set pullup voltage Serial.begin(9600); mySerial.begin(115200); // Open Software Serial port to work with GSM-shield pinMode(pin2sleep, OUTPUT);// Itit ON/OFF pin for GSM digitalWrite(pin2sleep, LOW); // Turn ON modem delay(16000); // Wait for its boot scale[0] = &amp;scale0; //init scale scale[1] = &amp;scale1; scale[2] = &amp;scale2; scale0.set_scale(); scale1.set_scale(); scale2.set_scale(); delay(200); setZero=digitalRead(2); if (EEPROM.read(500)==EEPROM.read(501) || setZero) // first boot/reset with hiding photoresistor //if (setZero) { raw00=scale0.get_units(16); //read data from scales raw10=scale1.get_units(16); raw20=scale2.get_units(16); EEPROM.put(500, raw00); //write data to eeprom EEPROM.put(504, raw10); EEPROM.put(508, raw20); for (int i = 0; i &lt;= 24; i++) { //blinking LED13 on reset/first boot digitalWrite(13, HIGH); delay(500); digitalWrite(13, LOW); delay(500); } } else { EEPROM.get(500, raw00); // read data from eeprom after battery change EEPROM.get(504, raw10); EEPROM.get(508, raw20); digitalWrite(13, HIGH); // turn on LED 13 on 12sec. delay(12000); digitalWrite(13, LOW); } delay(200); // Test SMS at initial boot // mySerial.println("AT+CMGF=1"); // Send SMS part delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.println("INITIAL BOOT OK"); mySerial.print("V Bat= "); mySerial.println(readVcc()); if (readVcc()&lt;3.5) {mySerial.print("!!! CHARGE BATTERY !!!");} delay(500); mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); // raw02=raw00; raw12=raw10; raw22=raw20; //scale0.power_down(); //power down all scales //scale1.power_down(); //scale2.power_down(); } void loop() { attachInterrupt(0, NULL , RISING); // Interrupt on high lewel set_sleep_mode(SLEEP_MODE_PWR_DOWN); //Set ARDUINO sleep mode digitalWrite(pin2sleep, HIGH); // Turn OFF GSM-shield delay(2200); digitalWrite(pin2sleep, LOW); // Turn OFF GSM-shield delay(2200); digitalWrite(pin2sleep, HIGH); digitalWrite(13, LOW); scale0.power_down(); //power down all scales scale1.power_down(); scale2.power_down(); delay(90000); sleep_mode(); // Go to sleep detachInterrupt(digitalPinToInterrupt(0)); // turn off external interrupt notsunset=0; for (int i=0; i &lt;= 250; i++){ if ( !digitalRead(2) ){ notsunset++; } //is a really sunset now? you shure? delay(360); } if ( notsunset==0 ) { digitalWrite(13, HIGH); digitalWrite(pin2sleep, LOW); // Turn-ON GSM-shield scale0.power_up(); //power up all scales scale1.power_up(); scale2.power_up(); raw01=raw02; raw11=raw12; raw21=raw22; raw02=scale0.get_units(16); //read data from scales raw12=scale1.get_units(16); raw22=scale2.get_units(16); daynum++; delta00=(raw02-raw00)/calibrate0; // calculate weight changes delta01=(raw02-raw01)/calibrate0; delta10=(raw12-raw10)/calibrate1; delta11=(raw12-raw11)/calibrate1; delta20=(raw22-raw20)/calibrate2; delta21=(raw22-raw21)/calibrate2; delay(16000); mySerial.println("AT+CMGF=1"); // Send SMS part delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.print("Turn "); mySerial.println(daynum); mySerial.print("Hive1 "); mySerial.print(delta01); mySerial.print(" "); mySerial.println(delta00); mySerial.print("Hive2 "); mySerial.print(delta11); mySerial.print(" "); mySerial.println(delta10); mySerial.print("Hive3 "); mySerial.print(delta21); mySerial.print(" "); mySerial.println(delta20); mySerial.print("V Bat= "); mySerial.println(readVcc()); if (readVcc()&lt;3.5) {mySerial.print("!!! CHARGE BATTERY !!!");} delay(500); mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); } }</code> </pre> <br><p>  En la primera l√≠nea, entre comillas char phone_no [] = "+ 123456789012";  - en lugar de 123456789012 ponemos nuestro n√∫mero de tel√©fono con el c√≥digo del pa√≠s al que se enviar√°n los SMS. </p><br><p>  Ahora haga clic en el bot√≥n de verificaci√≥n (arriba del n√∫mero uno en la captura de pantalla anterior) - si est√° debajo (debajo del triple en la captura de pantalla) "La compilaci√≥n est√° completa" - entonces podemos flashear el microcontrolador. </p><br><p>  Entonces, USB-TTL est√° conectado al ARDUINO y a la computadora, colocamos la bater√≠a cargada en el soporte (generalmente en un nuevo arduino, el LED comienza a parpadear una vez por segundo). </p><br><p>  Ahora el firmware, estamos entrenando para presionar el bot√≥n rojo (plateado) del microcontrolador, ¬°esto tendr√° que hacerse estrictamente en un momento determinado! <br>  Hay  Haga clic en el bot√≥n "Cargar" (arriba de los dos en la captura de pantalla) y mire cuidadosamente la l√≠nea en la parte inferior de la interfaz (debajo de las tres pantallas). <br>  Tan pronto como la inscripci√≥n "compilaci√≥n" cambie a "inicio" - presione el bot√≥n rojo (reiniciar) - si todo est√° bien - el adaptador USB-TTL parpadea alegremente y la inscripci√≥n "Descargado" parpadea en la parte inferior de la interfaz </p><br><p>  Ahora, mientras esperamos que llegue el SMS de prueba al tel√©fono, le dir√© c√≥mo funciona el programa: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/bb0/555/3f9/bb05553f9fb11ef00ae30a92be52839b.jpg" alt="La segunda versi√≥n del soporte de depuraci√≥n"></p><br><p>  En la foto, la segunda versi√≥n del soporte de depuraci√≥n. </p><br><p>  La primera vez que se enciende el sistema, verifica los bytes 500 y 501 de la EEPROM; si son iguales, entonces los datos de calibraci√≥n no se han registrado y el algoritmo pasa a la secci√≥n de configuraci√≥n. <br>  Lo mismo sucede si, cuando se enciende, el fotorresistor est√° sombreado (con una tapa de un bol√≠grafo): se activa el modo de restablecimiento de par√°metros. </p><br><p>  Los medidores de tensi√≥n ya deber√≠an estar instalados debajo de las colmenas, ya que simplemente fijamos el nivel inicial de cero y luego medimos el cambio de peso (ahora vendr√°n ceros, ya que todav√≠a no hemos conectado nada). <br>  En arduino, el LED incorporado del pin 13 parpadear√°. <br>  Si no se produce el reinicio, el LED se ilumina durante 12 segundos. <br>  Despu√©s de eso, se env√≠a un SMS de prueba con el mensaje "INITIAL BOOT OK" y el voltaje de la bater√≠a. <br>  El m√≥dulo de comunicaci√≥n se apaga, y despu√©s de 3 minutos, la placa Arduino pone las placas ADC HX711 en modo de suspensi√≥n y se queda dormida por s√≠ misma. <br>  Tal demora se realiz√≥ para no detectar interferencias de un m√≥dulo GSM en funcionamiento (despu√©s de apagarlo, se "fuente" durante alg√∫n tiempo). </p><br><p>  Adem√°s, tenemos una interrupci√≥n en el fotosensor que funciona en el segundo pin (m√°s la elevaci√≥n est√° habilitada por la funci√≥n pullup). <br>  En este caso, despu√©s de disparar durante otros 3 minutos, se verifica el estado del fotorresistor para excluir los positivos repetidos / falsos. <br>  Lo que es caracter√≠stico, sin ning√∫n ajuste, el sistema funciona 10 minutos despu√©s del atardecer astron√≥mico en tiempo nublado y despu√©s de 20 en tiempo despejado. <br>  S√≠, para que cada vez que el sistema no se reinicie, al menos el primer m√≥dulo HX711 debe estar conectado (pines DT-D10, SCK-A0) </p><br><p>  Luego se toman las lecturas de la celda de carga, se calcula el cambio de peso de la operaci√≥n anterior (el primer n√∫mero en la l√≠nea despu√©s de Hive) y desde el primer inicio, se verifica el voltaje de la bater√≠a y esta informaci√≥n se env√≠a en forma de SMS: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c05/360/360/c05360360e4ac01a63cd0daa0f138a99.png" alt="Sistema de muestra"></p><br><p>  Por cierto, ¬ørecibiste SMS?  Felicidades  Estamos a medio camino!  Si bien la bater√≠a se puede quitar del soporte, ya no necesitaremos una computadora. </p><br><p>  Por cierto, el centro de control de vuelo result√≥ ser tan compacto que puede caber en un frasco de mayonesa, en mi caso, una caja transl√∫cida de 30x60x100mm de tama√±o (de tarjetas de presentaci√≥n) encaja perfectamente. </p><br><p>  S√≠, el sistema inactivo consume ~ 2.3mA - 90% debido al m√≥dulo de comunicaci√≥n - no se apaga por completo, pero entra en modo de espera. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/26b/994/07e/26b99407efab87e00ffe017eea588666.jpg" alt="No houston"></p><br><p>  Procedemos a la fabricaci√≥n de sensores, para empezar, veamos el dise√±o de los sensores: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/182/43b/cec/18243bcecc904c4018d7b2217cc72d9b.jpg" alt="Ubicaci√≥n del sensor"></p><br><p>  Este es el plan de la colmena: vista superior. </p><br><p>  Cl√°sicamente, se instalan 4 sensores en las esquinas (1,2,3,4) </p><br><p>  Mediremos de manera diferente.  O m√°s bien, incluso en el tercero.  Como los chicos de BroodMinder hacen diferente: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b49/fbe/1f3/b49fbe1f378d3e5b4b7320bf6ac83520.jpg" alt="Broodminder"></p><br><p>  En este dise√±o, los sensores se instalan en las posiciones 1 y 2, los puntos 3.4 se basan en el haz. <br>  Entonces solo la mitad del peso cae sobre los sensores. <br>  S√≠, tal m√©todo tiene menos precisi√≥n, pero es dif√≠cil imaginar que las abejas construyeron todos los marcos con "lenguas" de los panales a lo largo de una pared de la colmena. </p><br><p>  Por lo tanto, propongo reducir los sensores al punto 5 por completo, entonces no hay necesidad de proteger el sistema, y ‚Äã‚Äãcuando se usan colmenas ligeras, es completamente necesario hacerlo con un sensor. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/67b/10b/4cc/67b10b4ccdaf51f4f81574927ac21ca3.jpg" alt="Sensor y opciones de sensor"></p><br><p>  En general, probamos dos tipos de m√≥dulos en el HX711, dos tipos de sensores y dos opciones para conectarlos: con un puente Wheatstone completo (2 sensores) y medio cuando la segunda parte se complementa con resistencias 1k con una tolerancia de 0.1%. <br>  Pero este √∫ltimo m√©todo no es deseable y no es recomendado incluso por los fabricantes de sensores, por lo que describir√© solo el primero. </p><br><p>  Entonces, en una colmena, instalaremos dos celdas de carga y un m√≥dulo HX711, el diagrama de cableado es el siguiente: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6d2/39b/bef/6d239bbef099b427b0f6127a323a7e69.jpg"></p><br><p>  Desde la placa ADC hasta el arduino hay 5 metros de un cable telef√≥nico de 4 n√∫cleos; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">recordamos c√≥mo a las abejas no les gustan los dispositivos GSM en la colmena</a> . </p><br><p>  En general, en los sensores dejamos "colas" de 8 cm, limpiamos el par trenzado y soldamos todo como en la foto de arriba. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/30d/ab9/f9c/30dab9f9cc87cd43929d9b86fec36f62.jpg" alt="¬°Observa la polaridad!"></p><br><p>  Repito una vez m√°s: ¬°observe la polaridad! </p><br><p>  Si el cable negro de la celda de carga est√° conectado al E + de la placa HX711, entonces el rojo va a A + </p><br><p>  De lo contrario, en lugar de aumentar de peso, recibir√° una reducci√≥n, pero no importa, en este caso, es suficiente intercambiar los cables rojos de las celdas de carga (A + y A-) en la placa ADC. </p><br><p>  Antes de comenzar la carpinter√≠a, coloque cera / parafina en un recipiente adecuado para derretir en un ba√±o de agua. </p><br><p>  Ahora tomamos nuestro haz y lo dividimos en tres segmentos de 100 mm. </p><br><p>  A continuaci√≥n, marque una ranura longitudinal de 25 mm de ancho, 7-8 mm de profundidad, con una sierra para metales y un cincel eliminamos el exceso; debe salir un perfil en forma de U. </p><br><p>  Cera calentada?  - sumergemos nuestros tableros de ADC all√≠ - esto los proteger√° de la humedad / niebla: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/672/7f1/a576727f1b4385933b640b0dd1ef2a01.jpg" alt="Protecci√≥n ADC contra la humedad"></p><br><p>  Lo tenemos todo sobre una base de madera (es necesario tratarlo con un antis√©ptico contra la descomposici√≥n): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/a6b/347/a57a6b34743c1f8b8add453e729fadea.jpg" alt="Asamblea"></p><br><p>  Y finalmente, arreglamos los sensores con tornillos: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/94d/e43/541/94de435418f3d001e47b181935612e5f.jpg" alt="Sensor listo"></p><br><p>  Hab√≠a otra opci√≥n con una cinta aislante azul, pero por razones de humanidad no la traigo ;-) </p><br><p>  Desde el lado de Arduino hacemos lo siguiente: </p><br><p>  Limpiamos nuestros cables telef√≥nicos, retorcemos los cables de colores, met√°lico. </p><br><p>  Despu√©s de eso, soldamos a los contactos de la placa como en la foto: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a0c/6fc/0fe/a0c6fc0fedd0bc6a1c4f1e6929d5e4bc.jpg" alt="Final"></p><br><p>  Eso es todo, ahora para la verificaci√≥n final, coloque los sensores en los sectores del c√≠rculo, en la parte superior: un trozo de madera contrachapada, ponga a cero el controlador (colocamos la bater√≠a con la tapa en el fotodiodo de la pluma). </p><br><p>  En este caso, el LED del arduino deber√≠a parpadear y deber√≠a aparecer un SMS de prueba. </p><br><p>  Luego retiramos las tapas de la fotoc√©lula, y vamos a recoger agua en una botella de pl√°stico de 1,5 litros. <br>  Ponemos la botella en madera contrachapada y, si ya han pasado varios minutos desde que la encendimos, volvemos a colocar la tapa en la fotorresistencia (simulando una puesta de sol). </p><br><p>  Despu√©s de tres minutos, el LED del arduino se iluminar√° y deber√≠a recibir un SMS con un valor de peso de aproximadamente 1 kg en todas las posiciones. </p><br><p>  Felicidades  ¬°El sistema se ha ensamblado con √©xito! </p><br><p>  Si ahora hacemos que el sistema vuelva a funcionar, entonces en la primera columna del peso obtenemos ceros. </p><br><p>  S√≠, en condiciones reales es deseable orientar la fotorresistencia verticalmente hacia arriba. </p><br><p>  Ahora dar√© un breve manual sobre el uso de: </p><br><ol><li>  Instale medidores de tensi√≥n debajo de las paredes traseras de las colmenas (debajo de la parte delantera sustituya una viga / tabla de ~ 30 mm de espesor) </li><li>  Sombree el fotorresistor y coloque la bater√≠a: el LED deber√≠a parpadear y deber√≠a aparecer un SMS de prueba con el texto "INICIAL INICIAL" </li><li>  Coloque la unidad central lo m√°s lejos posible de las colmenas y de modo que los cables no interfieran cuando trabaje con abejas. <br>  Cada tarde, despu√©s del atardecer, los SMS llegar√°n con un cambio de peso por d√≠a y desde el momento del lanzamiento. <br>  Cuando el voltaje de la bater√≠a alcanza los 3.5V, el SMS terminar√° con la l√≠nea "¬°¬°¬°CARGUE LA BATER√çA !!!" <br>  El tiempo de funcionamiento de una bater√≠a con una capacidad de 2600 mAh es de aproximadamente un mes. <br>  En el caso de reemplazar la bater√≠a, no se recuerdan los cambios diarios en el peso de las colmenas. </li></ol><br><p>  Que sigue </p><br><ol><li>  Para descubrir c√≥mo poner todo esto en un proyecto para github </li><li>  Comienza 3 familias de abejas en las colmenas del sistema Palivoda (o personas con cuernos) </li><li>  Agregue "bollos", una medida de humedad, temperatura y, lo m√°s importante, un an√°lisis del zumbido de las abejas. </li></ol><br><p>  Vamos a ocuparlo todo, sinceramente suyo, apicultor el√©ctrico Andrey </p><br><p>  PD Para nuevas publicaciones sobre este tema, vea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">beefree.xyz</a> <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/444326/">https://habr.com/ru/post/444326/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444316/index.html">Cartas de las redes sociales: ¬øes su privacidad lo suficientemente buena? Dos problemas y su soluci√≥n.</a></li>
<li><a href="../444318/index.html">Historia de √©xito de Nginx, o "¬°Todo es posible, pru√©balo!"</a></li>
<li><a href="../444320/index.html">L√°piz ex√≥tico: detectando un segundo sonido en grafito ordinario</a></li>
<li><a href="../444322/index.html">Siguiendo el rastro de las calculadoras: SpeedCrunch</a></li>
<li><a href="../444324/index.html">Siguiendo los pasos de las calculadoras: SpeedCrunch</a></li>
<li><a href="../444328/index.html">El redise√±o de la interfaz de usuario suele ser una p√©rdida de tiempo</a></li>
<li><a href="../444330/index.html">El CMS sin servidor es finalmente un digno competidor para Wordpress</a></li>
<li><a href="../444332/index.html">Seguridad de la informaci√≥n y restauraci√≥n: c√≥mo piensan los gerentes acerca de los productos de TI</a></li>
<li><a href="../444336/index.html">Listas de captura r√°pida: ¬øcu√°l es la diferencia entre enlaces d√©biles, fuertes y no propios?</a></li>
<li><a href="../444338/index.html">Encapsulaci√≥n en Python 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>