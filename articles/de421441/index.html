<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•î üîë ü•© Embox beginnt den Mount Elbrus zu besteigen ‚è© üòÖ üë≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Diejenigen, die unser Projekt verfolgen, haben m√∂glicherweise bemerkt, dass im Verzeichnis mit Architekturen ein e2k-Ordner angezeigt wurde, der Unter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Embox beginnt den Mount Elbrus zu besteigen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/421441/"><img src="https://habrastorage.org/webt/ic/4z/5o/ic4z5olelesc04boln85goculk4.png" align="right" width="320">  Diejenigen, die unser Projekt verfolgen, haben m√∂glicherweise bemerkt, dass im Verzeichnis mit Architekturen ein e2k-Ordner angezeigt wurde, der Unterst√ºtzung f√ºr inl√§ndische Prozessoren mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Elbrus-Architektur enth√§lt</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eine Reihe von</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikeln</a> zur Portierung von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Embox</a> auf inl√§ndische Plattformen w√§re ohne eine Geschichte √ºber diese Architektur nicht vollst√§ndig. <br><br>  Ich werde einige Kommentare zum Inhalt des Artikels abgeben.  Erstens befindet sich der Prozess der Beherrschung dieser Architektur durch uns in der Anfangsphase. Wir haben es geschafft, Embox auf dieser Plattform zu starten, aber wir haben noch nicht viele der erforderlichen Teile implementiert, die in zuk√ºnftigen Ver√∂ffentlichungen er√∂rtert werden.  Zweitens ist diese Architektur komplex und <br>  Eine detaillierte Beschreibung erfordert viel mehr Text als das Format zul√§sst <br>  ein Artikel.  Daher empfehlen wir, diesen Artikel als Einf√ºhrung zu nehmen. <br>  mit einem Minimum an technischen Informationen √ºber die Architektur selbst. <br><br>  Fangen wir an. <br><a name="habracut"></a><br><h3>  Forschungsobjekt - Eingebettetes Systemlayout auf Elbrus </h3><br>  Da wir uns mit Embox besch√§ftigen (und wenn jemand nicht wei√ü, dass es sich um eingebettete Systeme handelt), waren wir haupts√§chlich an der Option interessiert, dass das MTsST selbst positioniert ist, auch f√ºr eingebettete Systeme.  Beim MCST haben wir festgestellt, dass das Unternehmen daran interessiert ist, seine Prozessoren f√ºr eingebettete Systeme einzusetzen.  Eine der neuesten L√∂sungen f√ºr dieses Segment ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die E4C-COM-Karte</a> .  W√§hrend der Kommunikation mit dem MCST wurde klar, dass Sie zum Portieren und Beherrschen der Architektur alle verf√ºgbaren Maschinen verwenden k√∂nnen, und wir erhielten einen Computer namens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Temperament</a> zur vor√ºbergehenden Verwendung.  Im Allgemeinen ist ein Monocube nicht ganz das, was wir in eingebetteten Systemen gewohnt sind.  In der Regel verwenden eingebettete Systeme Einplatinencomputer, einen Chip - ein System auf einem Chip oder sogar einen Mikrocontroller. Der Monocube ist jedoch ein vollwertiger Computer. Da er jedoch in ‚ÄûKlima und Mechanik‚Äú getestet wurde, kann er dennoch als eingebettetes System betrachtet werden. <br><br><h3>  Compiler, Build, F√ºllbild </h3><br>  Nach Erhalt der Systemeinheit stellte sich nat√ºrlich die Frage, wie das Bild ausgef√ºllt werden soll.  Das MCST verwendet ein eigenes BIOS (First Level System Boot Loader).  Standardm√§√üig ist das Elbrus-Betriebssystem installiert (d. H. Debian mit √Ñnderungen).  Wir sind daran interessiert, unser eigenes Image zu starten.  Gl√ºcklicherweise kann der MTST-Loader Bilder √ºber das Netzwerk ausf√ºhren.  Verwenden Sie dazu das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ATA over Ethernet-Protokoll</a> . <br><br>  Nachdem uns geholfen wurde, einen Stand einzurichten und ein externes Image √ºber das Netzwerk zu starten, begannen wir mit der Entwicklung unseres eigenen Images.  Dazu brauchten wir einen Compiler.  Wir haben den Compiler nicht √∂ffentlich gefunden, aber seit wir die NDA unterzeichnet haben, haben wir Bin√§rdateien f√ºr Linux erhalten.  Der Compiler erwies sich als ziemlich gcc-kompatibel, und wir mussten nat√ºrlich nichts √§ndern, mit Ausnahme der Kompilierungsflags, die wir in einer separaten Konfigurationsdatei ver√∂ffentlicht haben.  Das ist sehr vorhersehbar, da Linux, wenn auch mit Modifikationen, von diesem Compiler zusammengestellt wird. <br><br><h3>  Ein paar technische Fragen </h3><br>  Diejenigen, die an bestimmten Aktivit√§ten wie dem Portieren des Betriebssystems auf eine Plattform beteiligt sind, wissen, dass das erste, was zu tun ist, darin besteht, den Programmcode korrekt im Speicher abzulegen.  Schreiben Sie also ein Linker-Skript (lds) und implementieren Sie den Startcode.  Wir haben das Linker-Skript schnell herausgefunden, aber als wir den Startcode implementiert haben, waren wir mit der ersten Magie konfrontiert, die wir nicht vollst√§ndig verstanden haben.  Tatsache ist, dass Elbrus einen x86-Kompatibilit√§tsmodus hat und bei 0x00FF0000 gibt es einen Code, zu dem ich einfach einen <a href="">Link geben werde</a> , da wir ihn aus dem MCST-Beispiel ausgeliehen haben.  Linker-Skript enth√§lt <br><br><pre><code class="hljs pgsql">.bootinfo : { _bootinfo_start = .; <span class="hljs-comment"><span class="hljs-comment">/* . = 0x1000000 - 0x10000; */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* 0x00FF0000 */</span></span> *(.x86_boot) . = _bootinfo_start + <span class="hljs-number"><span class="hljs-number">0x10000</span></span>; _bootinfo_end = .; } SECTION_REGION(bootinfo) .text : { _start = .; <span class="hljs-comment"><span class="hljs-comment">/* 0x01000000 */</span></span> *(.e2k_entry);</code> </pre> <br>  Der Startercode selbst ist nicht einmal in Assembler geschrieben, sondern einfach in <a href="">C.</a>  Es befindet sich in dem Abschnitt 0x01000000, der √ºbrigens der Startadresse regul√§rer x86-Maschinen entspricht - dort liegt der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Multiboot-</a> Header oder ein anderer Header an dieser Adresse. <br><br>  Um sicherzustellen, dass der Startcode und die Adressen korrekt sind, m√ºssen Sie eine Ausgabe erhalten.  Wenn Sie ein Zeichen drucken k√∂nnen, gibt es h√∂chstwahrscheinlich keine Probleme mit der Ausgabe von Zeichenfolgen.  Mit dieser Ausgabe ist es bereits m√∂glich, das bekannte printf () zum Debuggen zu verwenden.  Dar√ºber hinaus bieten die meisten Plattformen die M√∂glichkeit, Zeichen auszugeben, indem sie einen einfachen Eintrag in ein bestimmtes Register vornehmen (da der Bootloader h√∂chstwahrscheinlich UART nach Bedarf konfiguriert hat). <br><br>  Unser Computer verwendet den seriellen Port-Controller <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">am85c30</a> (auch bekannt als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">z85c30).</a> Wir haben schnell genug herausgefunden, wie ein Zeichen gedruckt werden kann, und dies reicht aus, damit unser printf funktioniert. Wir hatten sofort ein seltsames Problem - einige der von printf gedruckten Zeichen schienen doppelt vorhanden zu sein, aber Manchmal verwechselt. Zum Beispiel, als ich versuchte, Hello, world! + (1891VM7YA) (  vier DSP-Kerne z√§hlen nicht) und der Bootloader aktiviert alle Prozessorkerne. Um nicht mit Multicore (SMP) in Konflikt zu geraten, werden alle Kerne mit Ausnahme des ersten an eine Endlosschleife gesendet. Dazu haben wir eine Variable f√ºr die Prozessornummer eingef√ºhrt und diese mithilfe der atomaren Addition erh√∂ht Der Zero Core funktioniert weiterhin, w√§hrend andere Kernel eine Schleife ausf√ºhren. <br><br><pre> <code class="hljs cpp"> cpuid = __e2k_atomic32_add(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;last_cpuid); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cpuid &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* XXX currently we support only single core */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/* copy of trap table */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)<span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;_t_entry, <span class="hljs-number"><span class="hljs-number">0x1800</span></span>); kernel_start();</code> </pre> <br>  Der Aufruf von kernel_start () ist bereits eine √úbertragung der Kontrolle auf unseren Code. <br>  Wir haben uns auch Atomzus√§tze geliehen, f√ºr uns sieht es nach Magie aus.  Aber wie Sie wissen, funktioniert es - nicht anfassen! <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> WMB_AFTER_ATOMIC </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">".word 0x00008001\n"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">".word 0x30000084\n"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __e2k_atomic32_add(__val, __addr) \ ({ \ int __rval; \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n1:"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tldw,0 %[addr], %[rval], mas=0x7"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tadds %[rval], %[val], %[rval]"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\t{"</span></span></span><span class="hljs-meta">\ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tstw,2 %[addr], %[rval], mas=0x2"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\tibranch 1b ? %%MLOCK"</span></span></span><span class="hljs-meta"> \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\n\t}"</span></span></span><span class="hljs-meta"> \ WMB_AFTER_ATOMIC \ : [rval] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"=&amp;r"</span></span></span><span class="hljs-meta"> (__rval), [addr] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"+m"</span></span></span><span class="hljs-meta"> (*(__addr)) \ : [val] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ir"</span></span></span><span class="hljs-meta"> (__val) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"memory"</span></span></span><span class="hljs-meta">); \ __rval; \ })</span></span></code> </pre> <br>  Eine andere Magie, die ich ausleihen musste, ist ein Code, der f√ºr alle Kerne ben√∂tigt wird.  N√§mlich <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e2k_wait_all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ _Pragma (<span class="hljs-string"><span class="hljs-string">"no_asm_inline"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">asm</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">volatile</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"wait \ttrap = %0, ma_c = %1, fl_c = %2, ld_c = %3, "</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"st_c = %4, all_e = %5, all_c = %6"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> : : </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">), </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"i"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">) : </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"memory"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; }</code> </pre> <br>  Infolgedessen wurden nach dem Schreiben des Startcodes nicht nur Nachrichten mit printk angezeigt, sondern auch Module geladen, was f√ºr nicht ganz Standard-Compiler im Allgemeinen nicht sehr trivial ist.  Ich stelle also noch einmal fest, dass diesmal die Kompatibilit√§t mit gcc sehr zufrieden war. <br><br>  Der n√§chste Schritt besteht normalerweise darin, den Interrupt-Controller und den Timer zu starten. Da wir jedoch nicht nur die Unterst√ºtzung f√ºr diese Ger√§te, sondern auch den Architekturcode f√ºr die Interrupt-Handler implementieren m√ºssen, haben wir beschlossen, von der Peripherie aus zu starten.  Der Monocub verf√ºgt √ºber einen PCIe-Bus, f√ºr Programmierer sieht er aus wie eine normale PCI.  Wir waren haupts√§chlich an zwei Ger√§ten interessiert: einem Display-Controller und einem Netzwerk-Controller. <br><br>  Der Monocube verwendet einen Grafikcontroller aus der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sm750-</a> Serie.  Dies ist ein Grafikcontroller f√ºr eingebettete Anwendungen, der integrierte Unterst√ºtzung f√ºr 2D-Grafiken bietet.  Der Chip ist, wie ich es verstehe, direkt auf das Motherboard gel√∂tet.  Quellen f√ºr den Treiber f√ºr Linux finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Nachdem der Treiber gefunden wurde, schien es, dass unsere Probleme vorbei waren, es blieb nur die Implementierung des Controllers f√ºr PCI.  Genauer gesagt, Lese- / Schreibvorg√§nge des PCI-Konfigurationsraums, um die Parameter herauszufinden.  Die Implementierung dieser Funktionen musste erneut ausgeliehen werden.  Infolgedessen kam das Lesen von Datens√§tzen auf Makros wie <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Do load with specified MAS */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _E2K_READ_MAS(addr, mas, type, size_letter, chan_letter) \ ({ \ register type res; \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ld"</span></span></span><span class="hljs-meta"> #size_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">","</span></span></span><span class="hljs-meta"> #chan_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" \t0x0, [%1] %2, %0"</span></span></span><span class="hljs-meta"> \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"=r"</span></span></span><span class="hljs-meta"> (res) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((__e2k_ptr_t) (addr)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i"</span></span></span><span class="hljs-meta"> (mas)); \ res; \ }) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _E2K_WRITE_MAS(addr, val, mas, type, size_letter, chan_letter) \ ({ \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"st"</span></span></span><span class="hljs-meta"> #size_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">","</span></span></span><span class="hljs-meta"> #chan_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" \t0x0, [%0] %2, %1"</span></span></span><span class="hljs-meta"> \ : \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((__e2k_ptr_t) (addr)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((type) (val)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i"</span></span></span><span class="hljs-meta"> (mas) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"memory"</span></span></span><span class="hljs-meta">); \ })</span></span></code> </pre><br>  Es gibt ein gewisses Verst√§ndnis daf√ºr, was passiert.  Elbrus verf√ºgt √ºber mehrere alternative Adressr√§ume, beispielsweise in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SPARC-Architektur</a> .  Die Identifizierung erfolgt anhand der Adressraumkennung.  Das hei√üt, der gleiche ld-Befehl gelangt zu verschiedenen internen Adressen und generiert auch Leseoperationen unterschiedlicher L√§nge (8, 16, 32, 64 Bit).  Wenn dies in SPARC ein separater lda / sta-Befehl ist, ist dies in Elbrus aufgrund der Parameter der ld-Befehl.  Die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Registerfenster wurden</a> aus der SPARC-Architektur entlehnt.  Ich werde eine detailliertere Geschichte f√ºr nachfolgende Artikel verschieben. <br><br>  Infolgedessen stellte sich mit PCI alles heraus.  Wir konnten alle erforderlichen Daten abrufen, den Grafiktreiber an uns selbst √ºbertragen, stie√üen dann aber auf das folgende Problem.  Um ein Bild im Videospeicher zu zeichnen, musste man zweimal schreiben.  Alles zeigte auf Cache.  Um dieses Problem zu l√∂sen, war es notwendig, sich mit MMU zu befassen, und dies kann, wie sie sagen, nicht mit der Condachka gel√∂st werden, wie im Prinzip viele andere Probleme, auf die wir bei der Entwicklung dieser Architektur mehr als einmal gesto√üen sind und sto√üen werden. <br><br>  Wir sind in andere Richtungen vorangekommen: Unterbrechungen und Systemaufrufe, aber dar√ºber werden wir auch in den n√§chsten Artikeln dieser Unterreihe sprechen.  Am Ende dieses Artikels werde ich einfach die Ausgabe auf die Konsole bringen (√ºber die serielle Schnittstelle). <br><img src="https://habrastorage.org/webt/uc/un/u2/ucunu20_gi-newvjygt_hfiygpe.png"><br><br><h3>  Schlussfolgerungen </h3><br>  Wie ich in der Einleitung sagte, m√∂chte ich mich in erster Linie nicht auf technische Details konzentrieren, sondern auf allgemeine Gef√ºhle.  Die Gef√ºhle sind also widerspr√ºchlich, wenn auch sicherlich positiver.  Einerseits existiert der Prozessor und ist hinsichtlich der architektonischen Merkmale sehr interessant.  Basierend auf diesem Prozessor werden Computersysteme hergestellt, es gibt Software von ziemlich hoher Qualit√§t.  Wie gesagt, es gab keine Beschwerden √ºber den Compiler (bis zu einem bestimmten Punkt, den ich etwas sp√§ter beschreiben werde), gibt es ein vollwertiges Linux (OS "Elbrus").  Ich pers√∂nlich habe gesehen, wie der Entwickler im ICST selbst direkt auf dem Desktop mit Elbrus-Architektur erstellt hat. <br><br>  Andererseits verstehe ich nicht, warum sie mit solcher Beharrlichkeit versuchen, Intel x86 von diesem Prozessor banal zu ersetzen.  Nirgendwo auf der Welt verwenden sie Prozessoren, die auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VLIW-</a> Architektur basieren, als universelle PCs.  VLIW ist aufgrund seiner architektonischen Merkmale ein cooler ‚ÄûZahlenbrecher‚Äú, sie machen DSP darauf, sie haben itanium Server gemacht, sie haben Grafikkarten gemacht.  Nein, mit einem Bagger k√∂nnen Sie nat√ºrlich ein Loch graben, um einen Baum zu pflanzen, aber es lohnt sich. <br><br>  Das Hauptproblem, das meiner Meinung nach die Entwicklung der Architektur behindert, ist die geschlossene Natur des gesamten √ñkosystems.  Ja, um eine Beschreibung des Befehlssystems zu erhalten, m√ºssen Sie nur die NDA unterschreiben, dies reicht jedoch nicht aus.  Die Architektur ist ungewohnt und sehr komplex.  Ja, ich habe immer gedacht, dass einige grundlegende Software direkt vom Prozessorhersteller oder in enger Zusammenarbeit mit ihm entwickelt werden sollte.  Nach diesem Prinzip verf√ºgt ein PC auf Elbrus √ºber ein Softwarepaket mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dem Betriebssystem Elbrus</a> .  Dennoch ist es zu naiv zu glauben, dass ein Unternehmen, auch ein gro√ües, allen Komponenten Qualit√§tsunterst√ºtzung bieten kann: einem Prozessor, einem Compiler, Entwicklungs- und Debugging-Tools, Systemsoftware (verschiedene Betriebssysteme), Anwendungssoftware, ...  Selbst Intel kann das nicht.  Die Welt bewegt sich seit langem in Richtung der sogenannten Zusammenarbeit oder gemeinsamen Entwicklung. <br><br>  Lassen Sie mich ein Beispiel f√ºr ein Compiler-Problem geben, auf das wir gesto√üen sind.  Der Treiber f√ºr die serielle Schnittstelle zeigte irgendwann keine Zeichen mehr an, und auf den ersten Blick hat sich nichts ge√§ndert.  Es stellte sich heraus, dass wir die nicht verwendete Debugging-Funktion entfernt haben, die wir eingef√ºgt haben, um durch den Disassembler zu verstehen, wie Argumente an die Funktion in Assembler √ºbergeben werden.  Das hei√üt, wenn die Funktion vorhanden ist, ist alles in Ordnung, wenn nicht, verschwindet die Ausgabe.  Zuerst s√ºndigten sie f√ºr die Ausrichtung, aber es stellte sich heraus, dass die Funktion auf das Ende von C-Schnick √ºbertragen werden kann, sodass sich alle Zeichen des Fahrers an denselben Stellen wie zuvor befanden, aber das Problem wurde reproduziert.  Obwohl dieses Problem nicht gel√∂st wurde, untersuchen wir weiterhin, um den Entwicklern des Compilers aus dem MCST zu zeigen oder um zu verstehen, wo wir einen Fehler gemacht haben. <br><br>  Das obige Problem h√§tte meiner Meinung nach vermieden werden k√∂nnen, wenn es mehr Drittanbieter gegeben h√§tte.  Zumindest w√§re das Problem fr√ºher ans Licht gekommen, oder man k√∂nnte einfach googeln, was wir falsch gemacht haben. <br><br>  Das ICST ist sich auch des Problems der Schlie√üung bewusst, da der Prozess der Entdeckung nicht klassifizierter Dinge dennoch begonnen hat.  Zum Beispiel habe ich gesehen, wie Alt-Linux auf mehreren Konferenzen auf mehreren Elbrus-PCs funktioniert.  Hier sind Bilder des Displays von einer der Konferenzen in diesem Jahr (leider schlecht zu sehen, es war dunkel).  Wir haben uns auch mit der Entwicklung verbunden.  Wir hoffen, dass wir f√ºr das ICST n√ºtzlich sein werden, da, wie sich herausstellt, einige der Highlights der Elbrus-Architektur unter Linux nicht unterst√ºtzt werden k√∂nnen (oder die Kosten sehr hoch sind), z. B. mit Tags versehener Speicher. <br><br><img src="https://habrastorage.org/webt/yy/e9/jr/yye9jr5eg1nw99rppron_47drlw.jpeg" align="right" width="50%"><br><br><img src="https://habrastorage.org/webt/ki/n1/vk/kin1vkulag_gynsmlebiv146das.jpeg" align="left" width="50%">  Ein weiterer wichtiger Punkt, als wir das Problem der Schlie√üung mit den Entwicklern des MCST diskutierten, war, dass beispielsweise die Linux-Kernelquellen lange offen waren, aber nur wir und die Dolomant-Entwickler Fragen stellten und sie irgendwie verwendeten. <br><br>  Au√üerdem wird das MCST nach meinen Informationen einen Stand organisieren <br>  Fernzugriff.  Auf dem es m√∂glich sein wird, Software auf einem PC mit Elbrus-Architektur zusammenzustellen und auszuf√ºhren.  Wenn es ein √§hnliches Interesse gibt und Sie den Stand nutzen m√∂chten, sollten Sie sich zum Beispiel an mich wenden: Beschreiben Sie, wie die Nutzung geplant ist, wie lange es dauert und so weiter, da Sie zum Teilen mit dem √Ñndern der Software einen Zeitplan organisieren m√ºssen.  Ich werde die Daten an das ICST √ºbertragen oder diejenigen, die dies w√ºnschen, mit den Organisatoren verbinden. <br><br><hr><br>  N√ºtzliche Links: <br><br>  Die Postanschrift f√ºr Benutzer lautet user [at] mcst.ru. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eine kurze Beschreibung der Architektur von Elbrus</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Embox-Quellen</a> <br><br>  PS Wir werden allen zeigen, die wollen, was wir beim <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TechTrain</a> IT Festival <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">am</a> 1. und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2.</a> September bekommen haben. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de421441/">https://habr.com/ru/post/de421441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de421429/index.html">LSTM - ANN Dynamische Preisgestaltung im Haushaltswareneinzelhandel</a></li>
<li><a href="../de421431/index.html">Zeitmanagement oder effektives Chaosmanagement</a></li>
<li><a href="../de421433/index.html">Es dauerte genau einen Tag, bis der Server gestartet wurde.</a></li>
<li><a href="../de421435/index.html">"Warum machen wir das alle?" - Prisma-Sch√∂pfer und ehemaliger VK-Projektleiter √ºber sein neues geheimes Projekt</a></li>
<li><a href="../de421439/index.html">Die Japaner stellten einen Prototyp-Prozessor f√ºr Exaflops-Supercomputer vor: Wie der Chip funktioniert</a></li>
<li><a href="../de421443/index.html">Neu in unserem Markt: √úbersicht √ºber Snom D385- und D785-IP-Telefone</a></li>
<li><a href="../de421445/index.html">Wir schreiben einen einfachen √úbersetzer in Lisp - II</a></li>
<li><a href="../de421447/index.html">Redmadrobot iOS Meetup</a></li>
<li><a href="../de421451/index.html">So sch√ºtzen Sie Ihr Kind auf YouTube vor M√ºll und erstellen einen benutzerdefinierten Player mit einer wei√üen Liste von Kan√§len</a></li>
<li><a href="../de421453/index.html">Situation: Sonos ging an die √ñffentlichkeit und kann ‚Äûden Raum verlassen‚Äú</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>