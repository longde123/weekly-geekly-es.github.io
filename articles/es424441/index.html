<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïû üÖ±Ô∏è üë®üèº‚Äç‚öñÔ∏è Novedades en el primer CTP de SQL Server 2019 üë∫ ‚ùÑÔ∏è üßõüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La primera edici√≥n del CTP de SQL Server 2019 se present√≥ el 24 de septiembre, y perm√≠tanme decir que est√° llena de todo tipo de mejoras y nuevas cara...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Novedades en el primer CTP de SQL Server 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424441/">  La primera edici√≥n del CTP de SQL Server 2019 se present√≥ el 24 de septiembre, y perm√≠tanme decir que est√° llena de todo tipo de mejoras y nuevas caracter√≠sticas (muchas de las cuales se pueden encontrar en el formulario de vista previa en la base de datos SQL de Azure).  Tuve una oportunidad excepcional de conocer esto un poco antes, lo que me permiti√≥ ampliar mi comprensi√≥n de los cambios, incluso superficialmente.  Tambi√©n puede leer las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">√∫ltimas publicaciones del equipo de SQL Server</a> y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n actualizada</a> . <br><br>  Sin entrar en detalles, voy a discutir las siguientes caracter√≠sticas nuevas del kernel: rendimiento, soluci√≥n de problemas, seguridad, disponibilidad y desarrollo.  Por el momento, tengo un poco m√°s de detalles que otros, y algunos de ellos ya est√°n preparados para su publicaci√≥n.  Regresar√© a esta secci√≥n, as√≠ como a muchos otros art√≠culos y documentaci√≥n, y los publicar√©.  Me apresuro a informarle que esta no es una revisi√≥n exhaustiva, sino solo una parte de la funcionalidad que logr√© ‚Äútocar‚Äù, hasta CTP 2.0.  Todav√≠a hay mucho de qu√© hablar. <br><a name="habracut"></a><br><h2>  Rendimiento </h2><br><h4>  Variables de la tabla: construcci√≥n del plan retrasado </h4><br>  Las variables de la tabla tienen una reputaci√≥n no muy buena, principalmente en el campo de la estimaci√≥n de costos.  De forma predeterminada, SQL Server supone que una variable de tabla puede contener solo una fila, lo que a veces conduce a una elecci√≥n inadecuada del plan cuando la variable contendr√° muchas m√°s filas.  OPTION (RECOMPILE) generalmente se usa como una soluci√≥n alternativa, pero esto requiere cambios de c√≥digo y es un desperdicio, en relaci√≥n con los recursos, realizar la reconstrucci√≥n cada vez, mientras que el n√∫mero de l√≠neas suele ser el mismo.  Para emular la reconstrucci√≥n, se introdujo el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">indicador de traza 2453</a> , pero tambi√©n requiere un lanzamiento con el indicador, y solo funciona cuando se produce un cambio significativo en las l√≠neas. <br><br>  En el nivel de compatibilidad 150, la construcci√≥n diferida se realiza si las variables de la tabla est√°n presentes y el plan de consulta no se construye hasta que la variable de la tabla se complete una vez.  El costo se estimar√° en funci√≥n de los resultados del primer uso de la variable de tabla, sin m√°s reconstrucci√≥n.  Este es un compromiso entre la reconstrucci√≥n constante para obtener el costo exacto y la ausencia total de reconstrucci√≥n con un costo constante 1. Si el n√∫mero de filas permanece relativamente constante, este es un buen indicador (y a√∫n mejor si el n√∫mero excede 1), pero puede ser menos rentable si Hay una gran variaci√≥n en el n√∫mero de filas. <br><br>  Present√© un an√°lisis m√°s profundo en un art√≠culo reciente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Variables tabulares: compilaci√≥n demorada en SQL Server</a> , y Brent Ozar tambi√©n habl√≥ sobre esto en el art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Variables tabulares r√°pidas (y nuevos problemas de an√°lisis de par√°metros)</a> . <br><br><h4>  Comentarios de asignaci√≥n de memoria en modo de cadena </h4><br>  SQL Server 2017 tiene comentarios de asignaci√≥n de memoria por lotes, que se describe en detalle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Esencialmente, para cualquier asignaci√≥n de memoria asociada con un plan de consulta que incluya declaraciones de modo por lotes, SQL Server evaluar√° la memoria utilizada por la consulta y la comparar√° con la memoria solicitada.  Si la memoria solicitada es demasiado peque√±a o demasiado, lo que provocar√° drenajes en tempdb o un desperdicio de memoria, en el pr√≥ximo inicio se ajustar√° la memoria asignada para el plan de consulta correspondiente.  Este comportamiento reducir√° el volumen asignado y expandir√° la concurrencia, o lo aumentar√°, para mejorar el rendimiento. <br><br>  Ahora obtenemos el mismo comportamiento para las consultas en modo de cadena, bajo el nivel de compatibilidad 150. Si la consulta se vio obligada a fusionar datos en el disco, para lanzamientos posteriores se aumentar√° la memoria asignada.  Si al completar la solicitud se requer√≠a la mitad de la memoria de la asignada, entonces, para solicitudes posteriores, se ajustar√° hacia abajo.  Bretn Ozar describe esto con m√°s detalle en su art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Asignaci√≥n de memoria condicional</a> . <br><br><h4>  Modo por lotes para almacenamiento l√≠nea por l√≠nea </h4><br>  A partir de SQL Server 2012, las tablas de consulta con √≠ndices de columna se han beneficiado del rendimiento mejorado del modo por lotes.  Las mejoras de rendimiento se deben a un procesador de consultas que realiza un procesamiento por lotes en lugar de un procesamiento por filas.  Las l√≠neas tambi√©n son procesadas por el n√∫cleo de almacenamiento en paquetes, lo que evita las declaraciones de intercambio de concurrencia.  Paul White ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@SQL_Kiwi</a> ) me record√≥ que si usa una tabla vac√≠a con almacenamiento de columna para hacer posibles las operaciones por lotes, las filas procesadas se recopilar√°n en paquetes mediante una declaraci√≥n invisible.  Sin embargo, esta muleta puede negar cualquier mejora recibida del procesamiento por lotes.  Alguna informaci√≥n sobre esto est√° en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">respuesta a Stack Exchange</a> . <br><br>  En el nivel de compatibilidad 150, SQL Server 2019 seleccionar√° autom√°ticamente el modo por lotes como un punto medio en ciertos casos, incluso cuando no hay √≠ndices de columnas.  Podr√≠as pensar que ¬øpor qu√© no simplemente crear un √≠ndice de columna y un sombrero?  ¬øO seguir usando la muleta mencionada anteriormente?  Este enfoque tambi√©n se extendi√≥ a los objetos tradicionales con almacenamiento de filas, porque los √≠ndices de columna, por varias razones, no siempre son posibles, incluidas las limitaciones funcionales (por ejemplo, los desencadenantes), la sobrecarga durante las operaciones de actualizaci√≥n o eliminaci√≥n altamente cargadas, y la falta de soporte de fabricantes externos.  Y no se puede esperar nada bueno de esa muleta. <br>  Cre√© una tabla muy simple con 10 millones de filas y un √≠ndice agrupado en una columna entera y ejecut√© esta consulta: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sa5, sa2, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i1), <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(i2), <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.FactTable <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> i1 &gt; <span class="hljs-number"><span class="hljs-number">100000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> sa5, sa2 <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> sa5, sa2;</code> </pre> <br>  El plan muestra claramente b√∫squedas de √≠ndice agrupadas y concurrencia, pero ni una palabra sobre el √≠ndice de columna (como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lo</a> muestra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SentryOne Plan Explorer</a> ): <br><br><img src="https://habrastorage.org/webt/se/cp/6u/secp6uhnmrnslv_estaiqavexbm.png"><br><br>  Pero si profundiza un poco m√°s, puede ver que casi todos los operadores se ejecutaron en modo por lotes, incluso la clasificaci√≥n y los c√°lculos escalares: <br><br><img src="https://habrastorage.org/webt/0t/uu/lf/0tuulfjwod55k5fufwksdyvauae.png"><br><br>  Puede deshabilitar esta funci√≥n manteni√©ndose en un nivel de compatibilidad m√°s bajo cambiando la configuraci√≥n de la base de datos o utilizando el indicador DISALLOW_BATCH_MODE en la consulta: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">OPTION</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> HINT (<span class="hljs-string"><span class="hljs-string">'DISALLOW_BATCH_MODE'</span></span>));</code> </pre> <br>  En este caso, aparece un operador de intercambio adicional, todos los operadores se ejecutan en modo l√≠nea por l√≠nea y el tiempo de ejecuci√≥n de la consulta casi se triplica. <br><br><img src="https://habrastorage.org/webt/0n/v9/k9/0nv9k9ihqq1_jprzfth_o3wwrqs.png"><br><br>  Hasta cierto nivel, puede ver esto en el diagrama, pero en el √°rbol de detalles del plan tambi√©n puede ver la influencia de una condici√≥n de selecci√≥n que no puede excluir filas hasta que se haya ordenado: <br><br><img src="https://habrastorage.org/webt/ek/p6/6c/ekp66cg3v8b1nfezgsyspmxgkbc.png"><br><br>  La elecci√≥n del modo por lotes no siempre es un buen paso: la heur√≠stica incluida en el algoritmo de toma de decisiones tiene en cuenta la cantidad de l√≠neas, los tipos de operadores propuestos y los beneficios esperados del modo por lotes. <br><br><h4>  <font color="#004d71">APPROX_COUNT_DISTINCT</font> </h4><br>  Esta nueva funci√≥n agregada est√° dise√±ada para escenarios de almacenamiento de datos y es el equivalente de COUNT (DISTINCT ()).  Sin embargo, en lugar de realizar clasificaciones costosas para determinar la cantidad real, la nueva funci√≥n se basa en estad√≠sticas para obtener datos relativamente precisos.  Debe comprender que el error se encuentra dentro del 2% de la cantidad exacta, y en el 97% de los casos que son la norma para el an√°lisis de alto nivel, estos son los valores que se muestran en los indicadores o se usan para estimaciones r√°pidas. <br><br>  En mi sistema, cre√© una tabla con columnas enteras que inclu√≠an valores √∫nicos en el rango de 100 a 1,000,000, y columnas de fila, con valores √∫nicos en el rango de 100 a 100,000. No ten√≠a √≠ndices excepto la clave primaria agrupada en la primera columna entera  Estos son los resultados de ejecutar COUNT (DISTINCT ()) y APPROX_COUNT_DISTINCT () en estas columnas, desde las cuales puede ver ligeras discrepancias (pero siempre dentro del 2%): <br><br><img src="https://habrastorage.org/webt/ou/a5/1x/oua51xwiabvnyltf75s-pjtqdn0.png"><br><br>  La ganancia es enorme si hay limitaciones de memoria, lo que se aplica a la mayor√≠a de nosotros.  Si observa los planes de consulta, en este caso particular, puede ver una gran diferencia en el consumo de memoria por parte del operador de coincidencia hash: <br><br><img src="https://habrastorage.org/webt/xk/tl/sn/xktlsnekpwpu--xaebgb_ndkcn8.png"><br><br>  Tenga en cuenta que generalmente solo notar√° mejoras significativas en el rendimiento si ya est√° vinculado a la memoria.  En mi sistema, la ejecuci√≥n dur√≥ un poco m√°s debido a la alta utilizaci√≥n de la CPU de la nueva funci√≥n: <br><br><img src="https://habrastorage.org/webt/d9/nl/n8/d9nln84mrqh-kfmumdca_u8tt8u.png"><br><br>  Quiz√°s la diferencia ser√≠a m√°s significativa si tuviera tablas m√°s grandes, menos memoria disponible para SQL Server, mayor concurrencia o alguna combinaci√≥n de lo anterior. <br><br><h4>  <font color="#004d71">Consejos para usar el nivel de compatibilidad dentro de una consulta</font> </h4><br>  ¬øTiene una consulta especial que funciona mejor bajo un cierto nivel de compatibilidad, diferente de la base de datos actual?  Esto ahora es posible gracias a las nuevas sugerencias de consulta que admiten seis niveles diferentes de compatibilidad y cinco modelos diferentes para estimar el n√∫mero de elementos.  Los siguientes son los niveles de compatibilidad disponibles, una sintaxis de ejemplo y un modelo de nivel de compatibilidad que se utiliza en cada caso.  Vea c√≥mo esto afecta las calificaciones, incluso para las vistas del sistema: <br><br><img src="https://habrastorage.org/webt/gn/0n/g1/gn0ng1ar9z_cxpi7mt8_kaiqkmu.png"><br><br>  En resumen: ya no es necesario recordar las marcas de rastreo, o preguntarse si debe preocuparse si el parche TF 4199 para el optimizador de consultas est√° distribuido o si fue cancelado por alg√∫n otro paquete de servicios.  Tenga en cuenta que estos consejos adicionales tambi√©n se han agregado recientemente para SQL Server 2017 en la actualizaci√≥n acumulativa # 10 (consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el blog de Pedro L√≥pez para m√°s</a> detalles).  Puede ver todas las sugerencias disponibles con el siguiente comando: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.dm_exec_valid_use_hints;</code> </pre> <br>  Pero no olvide que las sugerencias son una medida excepcional, a menudo son adecuadas para salir de una situaci√≥n dif√≠cil, pero no deben planificarse para su uso a largo plazo, ya que su comportamiento puede cambiar con las actualizaciones posteriores. <br><br><h2>  <font color="#c30">Soluci√≥n de problemas</font> </h2><br><h4>  <font color="#004d71">Perfiles predeterminados simplificados</font> </h4><br>  Comprender esta mejora requiere algunos puntos para recordar.  SQL Server 2014 introdujo la vista DMV sys.dm_exec_query_profiles, que permite al usuario que ejecuta la consulta recopilar informaci√≥n de diagn√≥stico sobre todas las declaraciones en todas las partes de la consulta.  La informaci√≥n recopilada est√° disponible despu√©s de completar la consulta y le permite determinar qu√© operadores realmente gastaron los recursos principales y por qu√©.  Cualquier usuario que no cumpli√≥ una solicitud espec√≠fica podr√≠a recibir estos datos para cualquier sesi√≥n en la que se incluyera la declaraci√≥n ESTAD√çSTICAS XML o ESTAD√çSTICA PERFIL, o para todas las sesiones, utilizando el evento query_post_execution_showplan extendido, aunque este evento, en particular, puede afectar el rendimiento general. <br><br>  En Management Studio 2016, se ha agregado una funcionalidad que le permite mostrar flujos de datos que pasan por el plan de consulta en tiempo real en funci√≥n de la informaci√≥n recopilada del DMV, lo que lo hace a√∫n m√°s potente para la resoluci√≥n de problemas.  Plan Explorer tambi√©n ofrece la capacidad de visualizar datos que pasan a trav√©s de la consulta, tanto en tiempo real como en modo de reproducci√≥n. <br><br>  A partir de SQL Server 2016 Service Pack 1 (SP1), tambi√©n puede habilitar una versi√≥n ligera de la recopilaci√≥n de estos datos para todas las sesiones utilizando el indicador de seguimiento 7412 o la propiedad query_thread_profile avanzada, que le permite obtener informaci√≥n actualizada sobre cualquier sesi√≥n, sin necesidad de nada. incluirlo expl√≠citamente (en particular, cosas que afectan negativamente el rendimiento).  Esto se describe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">con</a> m√°s detalle en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">blog de Pedro L√≥pez</a> . <br><br>  En SQL Server 2019, esta caracter√≠stica est√° habilitada de manera predeterminada, por lo que no necesita ejecutar ninguna sesi√≥n con eventos extendidos ni usar ning√∫n indicador de seguimiento o declaraciones ESTAD√çSTICAS en ninguna consulta.  Simplemente mire los datos del DMV en cualquier momento para todas las sesiones concurrentes.  Pero es posible deshabilitar este modo usando LIGHTWEIGHT_QUERY_PROFILING, sin embargo, esta sintaxis no funciona en CTP 2.0 y se solucionar√° en futuras ediciones. <br><br><h4>  <font color="#004d71">Las estad√≠sticas de √≠ndice de columnas agrupadas ahora est√°n disponibles en bases de datos clonadas</font> </h4><br>  En las versiones actuales de SQL Server, cuando se clona una base de datos, solo se usan las estad√≠sticas del objeto original de los √≠ndices de columnas agrupadas, excluyendo las actualizaciones realizadas en la tabla despu√©s de su creaci√≥n.  Si usa un clon para configurar consultas y otras pruebas de rendimiento, que se basan en clasificaciones de potencia, entonces estos ejemplos pueden no funcionar.  Parikshit Savyani describi√≥ las limitaciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en esta publicaci√≥n</a> y proporcion√≥ una soluci√≥n temporal: antes de crear el clon, debe crear un script que ejecute DBCC SHOW_STATISTICS ... WITH STATS_STREAM para cada objeto.  Es caro y, por supuesto, f√°cil de olvidar. <br><br>  En SQL Server 2019, estas estad√≠sticas actualizadas estar√°n disponibles autom√°ticamente en el clon, por lo que puede probar varios escenarios de consulta y obtener planes objetivos basados ‚Äã‚Äãen estad√≠sticas reales, sin ejecutar STATS_STREAM manualmente para todas las tablas. <br><br><h4>  <font color="#004d71">Pron√≥stico de compresi√≥n para almacenamiento de columnas</font> </h4><br>  En las versiones actuales, el procedimiento sys.sp_estimate_data_compression_savings tiene la siguiente verificaci√≥n: <br><br><pre> <code class="sql hljs">if (@data_compression not in ('NONE', 'ROW', 'PAGE'))</code> </pre> <br>  Esto significa que le permite verificar la compresi√≥n de una l√≠nea o p√°gina (o ver el resultado de eliminar la compresi√≥n actual).  En SQL Server 2019, esta verificaci√≥n ahora se ve as√≠: <br><br><pre> <code class="sql hljs">if (@data_compression not in ('NONE', 'ROW', 'PAGE', 'COLUMNSTORE', 'COLUMNSTORE_ARCHIVE'))</code> </pre> <br>  Esta es una gran noticia porque le permite predecir aproximadamente el efecto de agregar un √≠ndice de columna a una tabla que no lo tiene, o convertir tablas o particiones a un formato de almacenamiento de columna a√∫n m√°s comprimido, sin tener que restaurar la tabla a otro sistema.  Ten√≠a una tabla con 10 millones de l√≠neas, para lo cual realic√© un procedimiento almacenado con cada uno de los cinco par√°metros: <br><br><pre> <code class="sql hljs">EXEC sys.sp_estimate_data_compression_savings @schema_name = N'dbo', @object_name = N'FactTable', @index_id = NULL, @partition_number = NULL, @data_compression = N'NONE'; <span class="hljs-comment"><span class="hljs-comment">-- repeat for ROW, PAGE, COLUMNSTORE, COLUMNSTORE_ARCHIVE</span></span></code> </pre> <br>  Resultados: <br><br><img src="https://habrastorage.org/webt/d6/xu/uy/d6xuuythndwrwogn22ljt83w8y4.png"><br><br>  Al igual que con otros tipos de compresi√≥n, la precisi√≥n depende completamente de las filas disponibles y la representatividad del resto de los datos.  Sin embargo, esta es una forma bastante poderosa de obtener resultados predecibles sin mucha dificultad. <br><br><h4>  <font color="#004d71">Nueva funci√≥n para obtener informaci√≥n de la p√°gina.</font> </h4><br>  Durante mucho tiempo, DBCC PAGE y DBCC IND se utilizaron para recopilar informaci√≥n sobre p√°ginas que contienen una secci√≥n, √≠ndice o tabla.  Pero no est√°n documentados ni tienen soporte, y puede ser tedioso automatizar la soluci√≥n de tareas asociadas con m√∫ltiples √≠ndices o p√°ginas. <br><br>  M√°s tarde, apareci√≥ una funci√≥n administrativa din√°mica (DMF) sys.dm_db_database_page_allocations, que devuelve un conjunto que representa todas las p√°ginas del objeto especificado.  Todav√≠a no est√° documentado y tiene fallas que pueden convertirse en un problema real en tablas grandes: incluso para obtener informaci√≥n sobre una p√°gina, debe leer toda la estructura, lo que puede ser bastante costoso. <br><br>  En SQL Server 2019, apareci√≥ otro DMF: sys.dm_db_page_info.  B√°sicamente, devuelve toda la informaci√≥n de la p√°gina, sin la sobrecarga de la distribuci√≥n DMF.  Sin embargo, para usar la funci√≥n en las compilaciones actuales, necesita saber de antemano el n√∫mero de la p√°gina que est√° buscando.  Quiz√°s este paso fue tomado intencionalmente, porque  Esta es la √∫nica forma de garantizar el rendimiento.  Entonces, si est√° tratando de identificar todas las p√°ginas en un √≠ndice o tabla, entonces todav√≠a necesita usar la distribuci√≥n DMF.  En el pr√≥ximo art√≠culo describir√© esta pregunta con m√°s detalle. <br><br><h2>  <font color="#c30">Seguridad</font> </h2><br><h4>  <font color="#004d71">Cifrado permanente utilizando un entorno seguro (enclave)</font> </h4><br>  Por el momento, el cifrado permanente protege los datos confidenciales durante la transmisi√≥n y en la memoria mediante el cifrado / descifrado en cada extremo del proceso.  Desafortunadamente, esto a menudo conlleva serias limitaciones cuando se trabaja con datos, como la imposibilidad de realizar c√°lculos y filtros, por lo que debe transferir todo el conjunto de datos al lado del cliente para realizar, por ejemplo, una b√∫squeda de rango. <br><br>  Un entorno seguro (enclave) es un √°rea protegida de memoria donde se pueden delegar tales c√°lculos y filtros (Windows usa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">seguridad basada en virtualizaci√≥n</a> ): los datos permanecen cifrados en el n√∫cleo, pero se pueden descifrar o cifrar de forma segura en un entorno seguro.  Solo necesita agregar el par√°metro ENCLAVE_COMPUTATIONS a la clave primaria usando SSMS, por ejemplo, marcando la casilla "Permitir c√°lculos en un entorno seguro": <br><br><img src="https://habrastorage.org/webt/do/ia/tp/doiatpb0ne_kpxgb5pbdep8ua5m.png"><br><br>  Ahora puede cifrar datos casi instant√°neamente, en comparaci√≥n con el m√©todo anterior (en el que el asistente, el cmdlet Set-SqlColumnEncyption o su aplicaci√≥n, tendr√≠a que obtener completamente el conjunto completo de la base de datos, cifrarlo y enviarlo de vuelta): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.Patients <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> SSN <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- currently not encrypted! ENCRYPTED WITH ( COLUMN_ENCRYPTION_KEY = ColumnEncryptionKeyName, ENCRYPTION_TYPE = Randomized, ALGORITHM = 'AEAD_AES_256_CBC_HMAC_SHA_256' ) NOT NULL;</span></span></code> </pre> <br>  Creo que para muchas organizaciones esta mejora ser√° la principal noticia, pero en el CTP actual algunos de estos subsistemas todav√≠a se est√°n mejorando, por lo tanto, est√°n desactivados de forma predeterminada, pero <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> puede ver c√≥mo activarlos. <br><br><h4>  <font color="#004d71">Gesti√≥n de certificados en Configuration Manager</font> </h4><br>  La administraci√≥n de certificados SSL y TLS siempre ha sido una tarea dif√≠cil, y muchas personas se han visto obligadas a realizar el tedioso trabajo de crear sus propios scripts para implementar y mantener sus certificados empresariales.  El Administrador de configuraci√≥n actualizado para SQL Server 2019 lo ayudar√° a ver y verificar r√°pidamente los certificados de cualquier instancia, encontrar los certificados que vencen pronto y sincronizar las implementaciones de certificados en todas las r√©plicas en el grupo de disponibilidad o en todos los nodos en la instancia del cl√∫ster de conmutaci√≥n por error. <br><br>  No he intentado todas estas operaciones, pero deber√≠an funcionar para versiones anteriores de SQL Server si la administraci√≥n proviene del Administrador de configuraci√≥n de SQL Server 2019. <br><br><h4>  <font color="#004d71">Clasificaci√≥n y auditor√≠a de datos incorporados.</font> </h4><br>  El equipo de desarrollo de SQL Server ha agregado la capacidad de clasificar datos en SSMS 17.5, lo que le permite identificar cualquier columna que pueda contener informaci√≥n confidencial o que contradiga varios est√°ndares (HIPAA, SOX, PCI y GDPR, por supuesto).  El asistente utiliza un algoritmo que ofrece columnas que se supone que causan problemas, pero puede ajustar su oraci√≥n eliminando estas columnas de la lista o agregar la suya propia.  Para almacenar la clasificaci√≥n, se utilizan propiedades avanzadas;  El informe SSMS incorporado utiliza la misma informaci√≥n para mostrar sus datos.  Fuera del informe, estas propiedades no son tan obvias. <br><br>  SQL Server 2019 introdujo una nueva declaraci√≥n para estos metadatos, ya disponible en la Base de datos SQL de Azure, y se llam√≥ A√ëADIR CLASIFICACI√ìN DE SENSIBILIDAD.  Le permite hacer lo mismo que el asistente en SSMS, pero la informaci√≥n ya no se almacena en la propiedad extendida, y cualquier acceso a estos datos se muestra autom√°ticamente en la auditor√≠a como una nueva columna XML data_sensitivity_information.  Contiene todo tipo de informaci√≥n que se vio afectada durante la auditor√≠a. <br><br>  Como ejemplo r√°pido, supongamos que tengo una tabla para contratistas externos: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.Contractors ( FirstName sysname, LastName sysname, SSN <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>), HourlyRate <span class="hljs-built_in"><span class="hljs-built_in">decimal</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) );</code> </pre> <br>  Al observar dicha estructura, queda claro que las cuatro columnas son potencialmente vulnerables a las fugas o deber√≠an ser accesibles solo para un c√≠rculo limitado de personas.  Aqu√≠ puede pasar con permisos, pero al menos debe centrarse en ellos.  Por lo tanto, podemos clasificar estas columnas de diferentes maneras: <br><br><pre> <code class="sql hljs">ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.FirstName, dbo.Contractors.LastName <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Confidential √¢‚Ç¨‚Äú GDPR'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'Personal Info'</span></span>); ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.SSN <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Highly Confidential'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'National ID'</span></span>); ADD SENSITIVITY CLASSIFICATION TO dbo.Contractors.HourlyRate <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (LABEL = <span class="hljs-string"><span class="hljs-string">'Highly Confidential'</span></span>, INFORMATION_TYPE = <span class="hljs-string"><span class="hljs-string">'Financial'</span></span>);</code> </pre> <br>  Ahora, en lugar de mirar sys.extended_properties, puede verlos en sys.sensitivity_classifications: <br><br><img src="https://habrastorage.org/webt/xs/4u/bx/xs4ubxognfau0yxlbl_g8caqujm.png"><br><br>  Y si llevamos a cabo un muestreo de auditor√≠a (o DML) para esta tabla, no necesitamos cambiar espec√≠ficamente nada;  despu√©s de crear la clasificaci√≥n, <code>SELECT *</code> registrar√° en el registro de auditor√≠a un registro de este tipo de informaci√≥n en una nueva columna data_sensitivity_information: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attributes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Confidential - GDPR"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Personal Info"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Highly Confidential"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"National ID"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attribute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Highly Confidential"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">information_type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Financial"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sensitivity_attributes</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Por supuesto, esto no resuelve todos los problemas de cumplimiento de las normas, pero puede dar una ventaja real.  El uso del asistente para identificar columnas autom√°ticamente y traducir las llamadas de propiedad sp_addextended a los comandos AGREGAR CLASIFICACI√ìN DE SENSIBILIDAD puede simplificar enormemente la tarea de cumplir con los est√°ndares.  M√°s tarde, escribir√© un art√≠culo separado sobre esto. <br><br>  Tambi√©n puede automatizar la creaci√≥n (o actualizaci√≥n) de permisos en funci√≥n de la etiqueta en los metadatos: la creaci√≥n de un script SQL din√°mico que proh√≠be el acceso a todas las columnas confidenciales (GDPR), lo que le permitir√° administrar usuarios, grupos o rolesb.  Trabajar√© en este tema en el futuro. <br><br><h2>  <font color="#c30">Disponibilidad</font> </h2><br><h4>  <font color="#004d71">Creaci√≥n de √≠ndice renovable en tiempo real</font> </h4><br>  En SQL Server 2017, fue posible suspender y reanudar la reconstrucci√≥n del √≠ndice en tiempo real, lo que puede ser muy √∫til si necesita cambiar la cantidad de procesadores utilizados, continuar desde el momento de la suspensi√≥n despu√©s de una falla o simplemente cerrar la brecha entre las ventanas de servicio.  Habl√© sobre esta caracter√≠stica en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo anterior</a> . <br><br>  En SQL Server 2019, puede usar la misma sintaxis para crear √≠ndices en tiempo real, pausar y continuar, y tambi√©n para limitar el tiempo de ejecuci√≥n (establecer el tiempo de pausa): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar(blat) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">RESUMABLE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, MAX_DURATION = <span class="hljs-number"><span class="hljs-number">10</span></span> MINUTES);</code> </pre> <br>  Si esta consulta funciona durante demasiado tiempo, para hacer una pausa, puede ejecutar ALTER INDEX en otra sesi√≥n (incluso si el √≠ndice a√∫n no existe f√≠sicamente): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar PAUSE;</code> </pre> <br>  En las compilaciones actuales, el grado de paralelismo durante la renovaci√≥n no se puede reducir, como es el caso con la reconstrucci√≥n.  Al intentar reducir la DOP: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar <span class="hljs-keyword"><span class="hljs-keyword">RESUME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (MAXDOP = <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre> <br>  Obtenemos lo siguiente: <br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">10666</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>, State <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-type"><span class="hljs-type">Line</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> Cannot resume <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> build <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> required DOP <span class="hljs-number"><span class="hljs-number">4</span></span> (DOP operation was started <span class="hljs-keyword"><span class="hljs-keyword">with</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> available. Please ensure sufficient DOP <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> available <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span> existing <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> operation <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> try again. The <span class="hljs-keyword"><span class="hljs-keyword">statement</span></span> has been terminated.</code> </pre> <br>  De hecho, si intenta hacer esto y luego ejecuta el comando sin par√°metros adicionales, obtendr√° el mismo error, al menos en las compilaciones actuales.  Creo que el intento de renovaci√≥n se grab√≥ en alguna parte y el sistema quer√≠a usarlo nuevamente.  Para continuar, debe especificar el valor DOP correcto (o superior): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.bar <span class="hljs-keyword"><span class="hljs-keyword">RESUME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (MAXDOP = <span class="hljs-number"><span class="hljs-number">4</span></span>);</code> </pre> <br>  Para que quede claro: puede aumentar la DOP al reanudar una creaci√≥n de √≠ndice en pausa, pero no disminuirla. <br><br>  Un beneficio adicional de todo esto es que puede configurar la creaci√≥n y / o renovaci√≥n de √≠ndices en tiempo real como el modo predeterminado utilizando las cl√°usulas ELEVATE_ONLINE y ELEVATE_RESUMABLE para la nueva base de datos. <br><br><h4>  <font color="#004d71">Creaci√≥n / reconstrucci√≥n en tiempo real de √≠ndices de columnas agrupadas</font> </h4><br>  Adem√°s de la creaci√≥n de √≠ndices renovables, tambi√©n tenemos la oportunidad de crear o reconstruir √≠ndices de columnas agrupadas en tiempo real.  Este es un cambio significativo, que le permite no pasar m√°s tiempo de las ventanas de servicio en el mantenimiento de dichos √≠ndices o (para mayor certeza) para convertir los √≠ndices de fila a columna: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> CLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> CLUSTERED COLUMNSTORE <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (DROP_EXISTING = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una advertencia: si se cre√≥ un √≠ndice agrupado tradicional existente en tiempo real, entonces su conversi√≥n a un √≠ndice de columna agrupada tambi√©n es posible solo en este modo. </font><font style="vertical-align: inherit;">Si es parte de la clave primaria, incorporada o no ...</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Splunge PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> CLUSTERED (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ); GO <span class="hljs-comment"><span class="hljs-comment">-- or after the fact -- ALTER TABLE dbo.splunge ADD CONSTRAINT PK_Splunge PRIMARY KEY CLUSTERED(id);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recibimos el siguiente error: </font></font><br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">1907</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> Cannot recreate <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-string"><span class="hljs-string">'PK_Splunge'</span></span>. The <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> definition does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> match the <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> being enforced <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> the existing <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Primero debe eliminar la restricci√≥n para convertirla en un √≠ndice de columna agrupada, pero ambas operaciones se pueden realizar en tiempo real: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>); GO <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> CLUSTERED COLUMNSTORE <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> PK_Splunge <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.splunge <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ONLINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto funciona, pero es probable que las tablas grandes tarden m√°s que si la clave principal se implementara como un √≠ndice agrupado √∫nico. </font><font style="vertical-align: inherit;">No puedo decir con certeza si se trata de una restricci√≥n intencional o simplemente una limitaci√≥n del CTP actual.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redireccionar una conexi√≥n de replicaci√≥n de un servidor secundario a uno primario </font></font><br></font> </h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta funci√≥n le permite configurar la redirecci√≥n sin escuchar, por lo que puede cambiar la conexi√≥n al servidor primario, incluso si el secundario se especifica directamente en la cadena de conexi√≥n. </font><font style="vertical-align: inherit;">Esta funci√≥n se puede usar cuando la tecnolog√≠a de agrupaci√≥n en cl√∫ster no admite la escucha, cuando se utilizan AG sin un cl√∫ster o cuando hay un esquema de redireccionamiento complejo en un escenario con m√∫ltiples subredes. </font><font style="vertical-align: inherit;">Esto evitar√° que la conexi√≥n, por ejemplo, intente escribir operaciones para la replicaci√≥n en modo de solo lectura (y fallas, respectivamente).</font></font><br><br><h2>  <font color="#c30">Desarrollo</font> </h2><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caracter√≠sticas adicionales del gr√°fico.</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las relaciones de gr√°ficos ahora admiten la instrucci√≥n MERGE para un nodo o tablas de l√≠mites que utilizan predicados MERGE; </font><font style="vertical-align: inherit;">Ahora un operador puede actualizar un borde existente o insertar uno nuevo. </font><font style="vertical-align: inherit;">La nueva restricci√≥n de borde le permite determinar qu√© nodos puede conectar el borde.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Utf-8</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server 2012 agreg√≥ soporte para UTF-16 y caracteres adicionales al configurar la clasificaci√≥n especificando un nombre con el sufijo _SC, como Latin1_General_100_CI_AI_SC, para usar columnas Unicode (nchar / nvarchar). En SQL Server 2017, puede importar y exportar datos UTF-8 desde y hacia estas columnas utilizando herramientas como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BCP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BULK INSERT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En SQL Server 2019, hay nuevas opciones de intercalaci√≥n para admitir la retenci√≥n forzada de datos UTF-8 en su forma original. </font><font style="vertical-align: inherit;">Por lo tanto, puede crear f√°cilmente columnas char o varchar y almacenar datos UTF-8 correctamente utilizando la nueva clasificaci√≥n con el sufijo _SC_UTF8, como Latin1_General_100_CI_AI_SC_UTF8. </font><font style="vertical-align: inherit;">Esto puede ayudar a mejorar la compatibilidad con aplicaciones externas y DBMS, sin el costo de procesar y almacenar nvarchar.</font></font><br><br><h4> <font color="#004d71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Huevo de pascua que encontr√©</font></font></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hasta donde recuerdo, los usuarios de SQL Server se quejan de este vago mensaje de error: </font></font><br><br><pre> <code class="hljs vbscript">Msg <span class="hljs-number"><span class="hljs-number">8152</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> binary data would be truncated.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En las compilaciones de CTP con las que experiment√©, se not√≥ un mensaje de error interesante que no estaba all√≠ antes: </font></font><br><br><pre> <code class="hljs pgsql">Msg <span class="hljs-number"><span class="hljs-number">2628</span></span> String <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> binary data would be truncated <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span>. Truncated <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: <span class="hljs-string"><span class="hljs-string">'%.*ls'</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No creo que se necesite nada m√°s aqu√≠; Esta es una gran mejora (aunque muy tard√≠a) y promete hacer felices a muchos. Sin embargo, esta funcionalidad no estar√° disponible en CTP 2.0; Solo te doy la oportunidad de mirar un poco m√°s adelante. Brent Ozar enumer√≥ todos los mensajes nuevos que encontr√≥ en el CTP actual y los </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sazon√≥</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con algunos comentarios √∫tiles en su art√≠culo </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">sys.messages: descubriendo caracter√≠sticas adicionales</font></a><font style="vertical-align: inherit;"> .</font></font><br><br><h2>  <font color="#c30">Conclusi√≥n</font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL Server 2019 ofrece buenas caracter√≠sticas adicionales que ayudar√°n a mejorar el trabajo con su plataforma de base de datos relacional favorita, y hay una serie de cambios de los que no he hablado. La memoria de bajo consumo de energ√≠a, la agrupaci√≥n para servicios de aprendizaje autom√°tico, la replicaci√≥n y las transacciones distribuidas en Linux, Kubernetes, los conectores para Oracle / Teradata / MongoDB, las replicaciones sincronizadas de AG han aumentado para admitir Java (la implementaci√≥n es similar a Python / R) y, lo que es m√°s importante, un nuevo salto, titulado Big Data Cluster. Para usar algunas de estas caracter√≠sticas, debe registrarse utilizando </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este formulario EAP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El pr√≥ximo libro de Bob Ward, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pro SQL Server en Linux: incluida la implementaci√≥n basada en contenedores con Docker y Kubernetes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puede dar algunas pistas sobre una serie de otras cosas que vendr√°n pronto. </font><font style="vertical-align: inherit;">Y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta publicaci√≥n de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Brent Ozar habla sobre una posible soluci√≥n para una funci√≥n escalar definida por el usuario. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero incluso en este primer CTP p√∫blico, hay algo significativo para casi todos, ¬°y te insto a que lo pruebes t√∫ mismo!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es424441/">https://habr.com/ru/post/es424441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es424429/index.html">Ciencia Arte y Sonido: 4 proyectos impresionantes</a></li>
<li><a href="../es424431/index.html">Valve revela la clasificaci√≥n de Steam Game Controller</a></li>
<li><a href="../es424433/index.html">¬øPor qu√© los hackers Mikrotik y c√≥mo escond√≠ 100 mil RouterOS de una botnet?</a></li>
<li><a href="../es424435/index.html">Zoo de perforaci√≥n petrolera: poner las cosas en orden</a></li>
<li><a href="../es424437/index.html">Olmo C√≥modo e inc√≥modo. Json.Encoder y Json.Decoder</a></li>
<li><a href="../es424443/index.html">Vivaldi 2.0 a nuestro favor</a></li>
<li><a href="../es424445/index.html">La traducci√≥n de Neil Ford de Microservicios como una arquitectura evolutiva</a></li>
<li><a href="../es424447/index.html">Lisp con sabor a Pascal o al lenguaje de programaci√≥n 8501</a></li>
<li><a href="../es424453/index.html">Aprende OpenGL. Lecci√≥n 6.2 - Representaci√≥n basada en la f√≠sica. Fuentes de luz analiticas</a></li>
<li><a href="../es424455/index.html">Intel Optane: ahora 1,5 terabytes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>