<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¼â€ğŸ³ â™ ï¸ ğŸˆ³ CUBAä¸­çš„Spring JPAå­˜å‚¨åº“ ğŸ© ğŸ¡ ğŸ–±ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ¬æ–‡çš„ä¸»é¢˜ä»…æ˜¯ç‹­ä¹‰çš„ï¼Œä½†æ˜¯å¯¹äºé‚£äº›æ­£åœ¨å¼€å‘è‡ªå·±çš„æ•°æ®ä»“åº“å¹¶è€ƒè™‘ä¸Spring Frameworké›†æˆçš„äººæ¥è¯´å¯èƒ½å¾ˆæœ‰ç”¨ã€‚ 
 èƒŒæ™¯çŸ¥è¯† 


 å¼€å‘äººå‘˜é€šå¸¸ä¸å–œæ¬¢æ”¹å˜å…¶ä¹ æƒ¯ï¼ˆé€šå¸¸ï¼Œæ¡†æ¶ä¹ŸåŒ…å«åœ¨ä¹ æƒ¯åˆ—è¡¨ä¸­ï¼‰ã€‚ å½“æˆ‘å¼€å§‹ä½¿ç”¨CUBAæ—¶ ï¼Œæˆ‘ä¸å¿…å­¦ä¹ å¤ªå¤šçš„æ–°çŸ¥è¯†ï¼Œå‡ ä¹å¯ä»¥ç«‹å³ç§¯æå‚ä¸è¯¥é¡¹ç›®çš„å·¥ä½œã€‚ ä½†æ˜¯æœ‰...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CUBAä¸­çš„Spring JPAå­˜å‚¨åº“</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/436216/"><p><img src="https://habrastorage.org/webt/_8/cc/h0/_8cch0_nvkzgoi2u1vailg4oiio.png"></p><br><p>  <em>æœ¬æ–‡çš„ä¸»é¢˜ä»…æ˜¯ç‹­ä¹‰çš„ï¼Œä½†æ˜¯å¯¹äºé‚£äº›æ­£åœ¨å¼€å‘è‡ªå·±çš„æ•°æ®ä»“åº“å¹¶è€ƒè™‘ä¸Spring Frameworké›†æˆçš„äººæ¥è¯´å¯èƒ½å¾ˆæœ‰ç”¨ã€‚</em> </p><br><h3 id="predposylki"> èƒŒæ™¯çŸ¥è¯† </h3><br><p> å¼€å‘äººå‘˜é€šå¸¸ä¸å–œæ¬¢æ”¹å˜å…¶ä¹ æƒ¯ï¼ˆé€šå¸¸ï¼Œæ¡†æ¶ä¹ŸåŒ…å«åœ¨ä¹ æƒ¯åˆ—è¡¨ä¸­ï¼‰ã€‚ å½“æˆ‘å¼€å§‹ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBAæ—¶</a> ï¼Œæˆ‘ä¸å¿…å­¦ä¹ å¤ªå¤šçš„æ–°çŸ¥è¯†ï¼Œå‡ ä¹å¯ä»¥ç«‹å³ç§¯æå‚ä¸è¯¥é¡¹ç›®çš„å·¥ä½œã€‚ ä½†æ˜¯æœ‰ä¸€ä»¶äº‹æˆ‘ä¸å¾—ä¸åæ›´é•¿çš„æ—¶é—´-å®ƒæ­£åœ¨å¤„ç†æ•°æ®ã€‚ </p><a name="habracut"></a><br><p>  Springæœ‰å‡ ä¸ªå¯ç”¨äºæ•°æ®åº“çš„åº“ï¼Œæœ€æµè¡Œçš„åº“ä¹‹ä¸€æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">spring-data-jpa</a> ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥åº“ä¸å…è®¸æ‚¨ç¼–å†™SQLæˆ–JPQLã€‚ æ‚¨åªéœ€è¦ä½¿ç”¨ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç‰¹æ®Šæ–¹å¼</a>å‘½åçš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªç‰¹æ®Šæ¥å£ï¼ŒSpringå°±ä¼šä¸ºæ‚¨ç”Ÿæˆå¹¶å®Œæˆå…¶ä½™å·¥ä½œï¼Œä»¥ä»æ•°æ®åº“ä¸­è·å–æ•°æ®å¹¶åˆ›å»ºå®ä½“å¯¹è±¡çš„å®ä¾‹ã€‚ </p><br><p> ä»¥ä¸‹æ˜¯ç•Œé¢ï¼Œå…¶ä¸­åŒ…å«ä¸€ç§ç”¨äºè®¡ç®—å…·æœ‰ç»™å®šå§“æ°çš„å®¢æˆ·çš„æ–¹æ³•ã€‚ </p><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Customer</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span></span>; }</code> </pre> <br><p> è¯¥æ¥å£å¯ä»¥ç›´æ¥åœ¨SpringæœåŠ¡ä¸­ä½¿ç”¨ï¼Œè€Œæ— éœ€åˆ›å»ºä»»ä½•å®ç°ï¼Œä»è€Œå¤§å¤§åŠ å¿«äº†å·¥ä½œé€Ÿåº¦ã€‚ </p><br><p>  CUBAå…·æœ‰ç”¨äºå¤„ç†æ•°æ®çš„APIï¼Œè¯¥APIåŒ…æ‹¬å„ç§åŠŸèƒ½ï¼Œä¾‹å¦‚éƒ¨åˆ†åŠ è½½çš„å®ä½“æˆ–å¯¹æ•°æ®åº“è¡¨ä¸­å®ä½“å±æ€§å’Œè¡Œå…·æœ‰è®¿é—®æ§åˆ¶çš„æ£˜æ‰‹çš„å®‰å…¨ç³»ç»Ÿã€‚ ä½†æ˜¯æ­¤APIä¸Spring Dataæˆ–JPA / Hibernateä¸­å¼€å‘äººå‘˜æ‰€ä½¿ç”¨çš„APIç•¥æœ‰ä¸åŒã€‚ </p><br><p> ä¸ºä»€ä¹ˆCUBAä¸­æ²¡æœ‰JPAå­˜å‚¨åº“ï¼Œæˆ‘å¯ä»¥æ·»åŠ å®ƒä»¬å—ï¼Ÿ </p><br><h3 id="rabota-s-dannymi-v-cuba"> åœ¨CUBAä¸­å¤„ç†æ•°æ® </h3><br><p> åœ¨CUBAä¸­ï¼Œæœ‰ä¸‰ä¸ªä¸»è¦çš„ç±»è´Ÿè´£å¤„ç†æ•°æ®ï¼šDataStoreï¼ŒEntityManagerå’ŒDataManagerã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DataStore</a>æ˜¯ä»»ä½•æ•°æ®å­˜å‚¨çš„é«˜çº§æŠ½è±¡ï¼šæ•°æ®åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿæˆ–äº‘å­˜å‚¨ã€‚ é€šè¿‡æ­¤APIï¼Œæ‚¨å¯ä»¥å¯¹æ•°æ®æ‰§è¡ŒåŸºæœ¬æ“ä½œã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé™¤éå¼€å‘è‡ªå·±çš„å­˜å‚¨åº“ï¼Œæˆ–è€…éœ€è¦å¯¹å­˜å‚¨åº“ä¸­çš„æ•°æ®è¿›è¡ŒæŸäº›éå¸¸ç‰¹æ®Šçš„è®¿é—®ï¼Œå¦åˆ™å¼€å‘äººå‘˜æ— éœ€ç›´æ¥ä½¿ç”¨DataStoreã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">EntityManager</a>æ˜¯è‘—åçš„JPA EntityManagerçš„å‰¯æœ¬ã€‚ ä¸æ ‡å‡†å®ç°ä¸åŒï¼Œå®ƒå…·æœ‰ç”¨äºå¤„ç†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBAè¡¨ç¤º</a> ï¼Œâ€œè½¯â€ï¼ˆé€»è¾‘ï¼‰åˆ é™¤æ•°æ®ä»¥åŠç”¨äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBAä¸­çš„æŸ¥è¯¢çš„</a>ç‰¹æ®Šæ–¹æ³•ã€‚ ä¸DataStoreä¸€æ ·ï¼Œåœ¨90ï¼…çš„é¡¹ç›®ä¸­ï¼Œæ™®é€šå¼€å‘äººå‘˜å°†ä¸å¿…å¤„ç†EntityManagerï¼Œé™¤éæœ‰å¿…è¦ç»•è¿‡æ•°æ®è®¿é—®é™åˆ¶ç³»ç»Ÿæ¥æ»¡è¶³æŸäº›è¯·æ±‚ã€‚ </p><br><p>  DataManageræ˜¯åœ¨CUBAä¸­å¤„ç†æ•°æ®çš„ä¸»è¦ç±»ã€‚ æä¾›ç”¨äºæ•°æ®æ“ä½œçš„APIï¼Œå¹¶æ”¯æŒæ•°æ®è®¿é—®æ§åˆ¶ï¼ŒåŒ…æ‹¬å¯¹å±æ€§å’Œè¡Œçº§é™åˆ¶çš„è®¿é—®ã€‚  DataManageréšå¼ä¿®æ”¹åœ¨CUBAä¸­è¿è¡Œçš„æ‰€æœ‰æŸ¥è¯¢ã€‚ ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ä»<code>select</code>è¯­å¥ä¸­æ’é™¤å½“å‰ç”¨æˆ·æ— æƒè®¿é—®çš„è¡¨å­—æ®µï¼Œå¹¶åœ¨<code>where</code>æ·»åŠ æ¡ä»¶ä»¥ä»é€‰æ‹©ä¸­æ’é™¤è¡¨è¡Œã€‚ è¿™ä½¿å¼€å‘äººå‘˜çš„å·¥ä½œå˜å¾—æ›´åŠ è½»æ¾ï¼Œå› ä¸ºæ‚¨ä¸å¿…è€ƒè™‘å¦‚ä½•æ­£ç¡®è€ƒè™‘è®¿é—®æƒé™æ¥ç¼–å†™æŸ¥è¯¢ï¼ŒCUBAä¼šæ ¹æ®æ•°æ®åº“æœåŠ¡è¡¨ä¸­çš„æ•°æ®è‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œã€‚ </p><br><p> ä¸‹å›¾æ˜¯é€šè¿‡DataManageræå–æ•°æ®æ‰€æ¶‰åŠçš„CUBAç»„ä»¶ä¹‹é—´çš„äº¤äº’å…³ç³»å›¾ã€‚ </p><br><p><img src="https://habrastorage.org/webt/vy/e7/e1/vye7e1axlvkzuky3raw6an4ttl0.png"></p><br><p> ä½¿ç”¨DataManagerï¼Œæ‚¨å¯ä»¥ç›¸å¯¹è½»æ¾åœ°ä½¿ç”¨CUBAè§†å›¾åŠ è½½å®ä½“å’Œå®ä½“çš„æ•´ä¸ªå±‚æ¬¡ç»“æ„ã€‚ ä»¥æœ€ç®€å•çš„å½¢å¼ï¼ŒæŸ¥è¯¢å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="java hljs">dataManager.load(Customer.class).list();</code> </pre> <br><p> å¦‚å‰æ‰€è¿°ï¼ŒDataManagerå°†è¿‡æ»¤æ‰â€œé€»è¾‘åˆ é™¤â€çš„è®°å½•ï¼Œä»è¯·æ±‚ä¸­åˆ é™¤ç¦æ­¢çš„å±æ€§ï¼Œå¹¶è‡ªåŠ¨æ‰“å¼€å’Œå…³é—­äº‹åŠ¡ã€‚ </p><br><p> ä½†æ˜¯ï¼Œæ¶‰åŠæ›´å¤æ‚çš„æŸ¥è¯¢æ—¶ï¼Œæ‚¨å¿…é¡»åœ¨CUBAä¸­ç¼–å†™JPQLã€‚ </p><br><p> ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨éœ€è¦è®¡ç®—å…·æœ‰ç»™å®šå§“æ°çš„å®¢æˆ·ï¼ˆå¦‚ä¸Šä¸€èŠ‚ä¸­çš„ç¤ºä¾‹æ‰€ç¤ºï¼‰ï¼Œåˆ™éœ€è¦ç¼–å†™ç±»ä¼¼ä»¥ä¸‹ä»£ç çš„å†…å®¹ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataManager .loadValue(<span class="hljs-string"><span class="hljs-string">"select count(c) from sample$Customer c where c.lastName = :lastName"</span></span>, Long.class) .parameter(<span class="hljs-string"><span class="hljs-string">"lastName"</span></span>, lastName) .one(); }</code> </pre> <br><p> æˆ–è¯¸å¦‚æ­¤ç±»ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span><span class="hljs-function"> </span></span>{ LoadContext&lt;Customer&gt; loadContext = LoadContext.create(Customer.class); loadContext .setQueryString(<span class="hljs-string"><span class="hljs-string">"select c from sample$Customer c where c.lastName = :lastName"</span></span>) .setParameter(<span class="hljs-string"><span class="hljs-string">"lastName"</span></span>, lastName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataManager.getCount(loadContext); }</code> </pre> <br><p> åœ¨CUBA APIä¸­ï¼Œæ‚¨éœ€è¦å°†JPQLè¡¨è¾¾å¼ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ï¼ˆå°šä¸æ”¯æŒCriteria APIï¼‰ï¼Œè¿™æ˜¯åˆ›å»ºæŸ¥è¯¢çš„å¯è¯»ä¸”å¯ç†è§£çš„æ–¹å¼ï¼Œä½†æ˜¯è°ƒè¯•æ­¤ç±»æŸ¥è¯¢ä¼šå¸¦æ¥å¾ˆå¤šä¹è¶£ã€‚ å¦å¤–ï¼Œåœ¨å®¹å™¨åˆå§‹åŒ–æœŸé—´ï¼Œç¼–è¯‘å™¨å’ŒSpringæ¡†æ¶éƒ½ä¸ä¼šéªŒè¯JPQLå­—ç¬¦ä¸²ï¼Œè¿™åªä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ã€‚ </p><br><p> å°†æ­¤ä¸Spring JPAè¿›è¡Œæ¯”è¾ƒï¼š </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Customer</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span></span>; }</code> </pre> <br><p> è¯¥ä»£ç çŸ­ä¸‰å€ï¼Œå¹¶ä¸”æ²¡æœ‰è¡Œã€‚ å¦å¤–ï¼Œåœ¨Springå®¹å™¨åˆå§‹åŒ–æœŸé—´æ£€æŸ¥æ–¹æ³•åç§°<code>countByLastName</code> ã€‚ å¦‚æœè¾“å…¥é”™è¯¯ï¼Œå¹¶ä¸”æ‚¨å†™äº†<code>countByLastNsme</code> ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºå°†åœ¨éƒ¨ç½²æœŸé—´å´©æºƒå¹¶æ˜¾ç¤ºé”™è¯¯ï¼š </p><br><pre> <code class="plaintext hljs">Caused by: org.springframework.data.mapping.PropertyReferenceException: No property LastNsme found for type Customer!</code> </pre> <br><p>  CUBAæ˜¯å›´ç»•Springæ¡†æ¶æ„å»ºçš„ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨ä½¿ç”¨CUBAç¼–å†™çš„åº”ç”¨ç¨‹åºä¸­æ’å…¥spring-data-jpaåº“ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªå°é—®é¢˜-è®¿é—®æ§åˆ¶ã€‚  Spring CrudRepositoryå®ç°ä½¿ç”¨å…¶EntityManagerã€‚ å› æ­¤ï¼Œæ‰€æœ‰æŸ¥è¯¢å°†ç»•è¿‡DataManageræ‰§è¡Œã€‚ å› æ­¤ï¼Œè¦åœ¨CUBAä¸­ä½¿ç”¨JPAå­˜å‚¨åº“ï¼Œæ‚¨éœ€è¦å°†æ‰€æœ‰EntityManagerè°ƒç”¨æ›¿æ¢ä¸ºDataManagerè°ƒç”¨ï¼Œå¹¶æ·»åŠ å¯¹CUBAè§†å›¾çš„æ”¯æŒã€‚ </p><br><p> ä¹Ÿè®¸æœ‰äººä¼šè¯´spring-data-jpaæ˜¯ä¸€ä¸ªä¸å—æ§åˆ¶çš„é»‘åŒ£å­ï¼Œå¹¶ä¸”å§‹ç»ˆæœ€å¥½ç¼–å†™çº¯JPQLç”šè‡³SQLã€‚ è¿™æ˜¯ä¾¿åˆ©ä¸æŠ½è±¡çº§åˆ«ä¹‹é—´å–å¾—å¹³è¡¡çš„æ°¸æ’é—®é¢˜ã€‚ æ¯ä¸ªäººéƒ½å¯ä»¥é€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ–¹æ³•ï¼Œä½†æ˜¯æ‹¥æœ‰åœ¨æ­¦å™¨åº“ä¸­å¤„ç†æ•°æ®çš„å…¶ä»–æ–¹å¼æ°¸è¿œä¸ä¼šå—åˆ°ä¼¤å®³ã€‚ å¯¹äºé‚£äº›éœ€è¦æ›´å¤šæ§åˆ¶æƒçš„äººï¼ŒSpring <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥</a>ä¸ºJPAå­˜å‚¨åº“æ–¹æ³•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®šä¹‰è‡ªå·±çš„è¯·æ±‚</a> ã€‚ </p><br><h2 id="realizaciya"> å®ä½œ </h2><br><p>  JPAå­˜å‚¨åº“ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">spring-data-commons</a>åº“å®ç°ä¸ºCUBAæ¨¡å—ã€‚ æˆ‘ä»¬æ”¾å¼ƒäº†ä¿®æ”¹spring-data-jpaçš„æƒ³æ³•ï¼Œå› ä¸ºä¸ç¼–å†™æˆ‘ä»¬è‡ªå·±çš„æŸ¥è¯¢ç”Ÿæˆå™¨ç›¸æ¯”ï¼Œå·¥ä½œé‡è¦å¤§å¾—å¤šã€‚ ç‰¹åˆ«æ˜¯ç”±äºspring-data-commonså®Œæˆäº†å¤§éƒ¨åˆ†å·¥ä½œã€‚ ä¾‹å¦‚ï¼Œè§£ææ–¹æ³•åç§°å¹¶å°†åç§°ä¸ç±»å’Œå±æ€§ç›¸å…³è”å®Œå…¨åœ¨æ­¤åº“ä¸­å®Œæˆã€‚  Spring-data-commonsåŒ…å«ç”¨äºå®ç°è‡ªå·±çš„å­˜å‚¨åº“çš„æ‰€æœ‰å¿…éœ€åŸºç±»ï¼Œå¹¶ä¸”æ— éœ€èŠ±è´¹å¾ˆå¤šç²¾åŠ›å³å¯å®ç°ã€‚ ä¾‹å¦‚ï¼Œè¯¥åº“åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">spring-data-mongodbä¸­ä½¿ç”¨</a> ã€‚ </p><br><p> æœ€å›°éš¾çš„äº‹æƒ…æ˜¯åŸºäºå¯¹è±¡çš„å±‚æ¬¡ç»“æ„-è§£ææ–¹æ³•åç§°çš„ç»“æœæ¥å‡†ç¡®åœ°å®ç°JPQLç”Ÿæˆã€‚ ä½†æ˜¯ï¼Œå¹¸è¿çš„æ˜¯ï¼Œå·²ç»åœ¨Apache Igniteä¸­å®ç°äº†ç±»ä¼¼çš„ä»»åŠ¡ï¼Œå› æ­¤ä»é‚£é‡Œè·å–äº†ä»£ç ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ä»¥ç”ŸæˆJPQLè€Œä¸æ˜¯SQLï¼Œå¹¶æ”¯æŒ<code>delete</code>è¿ç®—ç¬¦ã€‚ </p><br><p>  Spring-data-commonsä½¿ç”¨ä»£ç†æ¥åŠ¨æ€åˆ›å»ºæ¥å£å®ç°ã€‚ åˆå§‹åŒ–CUBAåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ—¶ï¼Œæ‰€æœ‰åˆ°æ¥å£çš„é“¾æ¥éƒ½æ›¿æ¢ä¸ºåˆ°è¯¥ä¸Šä¸‹æ–‡ä¸­å‘å¸ƒçš„ä»£ç†å®¹å™¨çš„é“¾æ¥ã€‚ è°ƒç”¨æ¥å£æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¢«ç›¸åº”çš„ä»£ç†å¯¹è±¡æ‹¦æˆªã€‚ ç„¶åï¼Œè¯¥å¯¹è±¡é€šè¿‡æ–¹æ³•åç§°ç”ŸæˆJPQLæŸ¥è¯¢ï¼Œæ›¿æ¢å‚æ•°å¹¶å°†å¸¦æœ‰å‚æ•°çš„æŸ¥è¯¢å‘é€åˆ°DataManagerä»¥æ‰§è¡Œã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†æ¨¡å—å…³é”®ç»„ä»¶ä¹‹é—´äº¤äº’çš„ç®€åŒ–è¿‡ç¨‹ã€‚ </p><br><p><img src="https://habrastorage.org/webt/zh/cd/1l/zhcd1lasrsrz4vwcedkgtnsiz2m.png"></p><br><h2 id="ispolzovanie-repozitoriev-v-cuba"> åœ¨CUBAä¸­ä½¿ç”¨å­˜å‚¨åº“ </h2><br><p> è¦åœ¨CUBAä¸­ä½¿ç”¨å­˜å‚¨åº“ï¼Œæ‚¨åªéœ€è¦åœ¨é¡¹ç›®æ„å»ºæ–‡ä»¶ä¸­è¿æ¥æ¨¡å—å³å¯ï¼š </p><br><pre> <code class="plaintext hljs"> appComponent("com.haulmont.addons.cuba.jpa.repositories:cuba-jpa-repositories-global:0.1-SNAPSHOT")</code> </pre> <br><p> æ‚¨å¯ä»¥ä½¿ç”¨XMLé…ç½®æ¥â€œå¯ç”¨â€å­˜å‚¨åº“ï¼š </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans:beans</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:beans</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/context"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:repositories</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.cuba-platform.org/schema/data/jpa"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd http://www.cuba-platform.org/schema/data/jpa http://www.cuba-platform.org/schema/data/jpa/cuba-repositories.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Annotation-based beans --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context:component-scan</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base-package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.company.sample"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repositories:repositories</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base-package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.company.sample.core.repositories"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans:beans</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥ä½¿ç”¨æ‰¹æ³¨ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableCubaRepositories</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//Configuration here }</span></span></code> </pre> <br><p> æ¿€æ´»å­˜å‚¨åº“æ”¯æŒåï¼Œå¯ä»¥æŒ‰é€šå¸¸çš„å½¢å¼åˆ›å»ºå®ƒä»¬ï¼Œä¾‹å¦‚ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CubaJpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Customer</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UUID</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;Customer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByNameIsIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; names)</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@CubaView</span></span>(<span class="hljs-string"><span class="hljs-string">"_minimal"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@JpqlQuery</span></span>(<span class="hljs-string"><span class="hljs-string">"select c from sample$Customer c where c.name like concat(:name, '%')"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Customer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByNameStartingWith</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span></span>; }</code> </pre> <br><p> å¯¹äºæ¯ç§æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æ³¨é‡Šï¼š </p><br><ul><li>  <code>@CubaView</code>è®¾ç½®è¦åœ¨DataManagerä¸­ä½¿ç”¨çš„CUBAè§†å›¾ </li><li>  <code>@JpqlQuery</code>æŒ‡å®šå°†æ‰§è¡Œçš„JPQLæŸ¥è¯¢ï¼Œè€Œä¸ç®¡æ–¹æ³•åç§°å¦‚ä½•ã€‚ </li></ul><br><p> æ­¤æ¨¡å—åœ¨CUBAæ¡†æ¶çš„<code>global</code>æ¨¡å—ä¸­ä½¿ç”¨ï¼Œå› æ­¤ï¼Œå­˜å‚¨åº“å¯åœ¨<code>core</code>æ¨¡å—å’Œ<code>web</code> ã€‚ æ‚¨å”¯ä¸€éœ€è¦è®°ä½çš„æ˜¯æ¿€æ´»ä¸¤ä¸ªæ¨¡å—çš„é…ç½®æ–‡ä»¶ä¸­çš„å­˜å‚¨åº“ã€‚ </p><br><p> åœ¨CUBAæœåŠ¡ä¸­ä½¿ç”¨å­˜å‚¨åº“çš„ç¤ºä¾‹ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span>(CustomerService.NAME) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerServiceBean</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CustomerRepository customerRepository; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Date&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomersBirthDatesByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> customerRepository.findByNameStartingWith(name) .stream().map(Customer::getBirthDate).collect(Collectors.toList()); } }</code> </pre> <br><h3 id="zaklyuchenie"> ç»“è®º </h3><br><p>  CUBAæ˜¯ä¸€ä¸ªçµæ´»çš„æ¡†æ¶ã€‚ å¦‚æœè¦å‘å…¶ä¸­æ·»åŠ æŸäº›å†…å®¹ï¼Œåˆ™æ— éœ€è‡ªå·±ä¿®å¤å†…æ ¸æˆ–ç­‰å¾…æ–°ç‰ˆæœ¬ã€‚ æˆ‘å¸Œæœ›è¯¥æ¨¡å—å¯ä»¥ä½¿CUBAå¼€å‘æ›´é«˜æ•ˆï¼Œæ›´å¿«ã€‚ è¯¥æ¨¡å—çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Šæä¾›</a> ï¼Œå¹¶åœ¨CUBA 6.10ç‰ˆ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸Š</a>è¿›è¡Œäº†æµ‹è¯• <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN436216/">https://habr.com/ru/post/zh-CN436216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN436202/index.html">æˆ‘å¯¹å‘å±•å¤±å»ä¿¡å¿ƒï¼Œç²¾ç–²åŠ›å°½ï¼Œä½†å·¥å…·å´‡æ‹œæ•‘äº†æˆ‘</a></li>
<li><a href="../zh-CN436206/index.html">å¦‚ä½•æ— ç—›åœ°å°†è‰ºæœ¯ä¸Javaï¼ŒJavaScriptå’Œå›¾å½¢ç»“åˆèµ·æ¥ï¼Œæˆ–è€…å¦‚ä½•åˆ›å»ºäº¤äº’å¼å‰§é™¢äº§å“èƒŒåçš„æ•…äº‹</a></li>
<li><a href="../zh-CN436208/index.html">æ–°çš„æ´ªæµä¸å†å‡ºç°åœ¨æµ·ç›—æ¹¾</a></li>
<li><a href="../zh-CN436210/index.html">åŒå››å…ƒæ•°</a></li>
<li><a href="../zh-CN436212/index.html">ä½¿ç”¨PCå’Œç°æˆçš„æ¥æ”¶å™¨æ¥æ”¶çŸ­æ³¢ä¼ çœŸ</a></li>
<li><a href="../zh-CN436218/index.html">æµè¡Œåœ¨çº¿åª’ä½“ä¸­çš„å†…å®¹è¥é”€ï¼šåº”é¿å…çš„5ä¸ªè¯¯åŒº</a></li>
<li><a href="../zh-CN436220/index.html">è®¡åˆ†å¦‚ä½•åœ¨æ±½è½¦å…±äº«è¡Œä¸šä¸­å‘æŒ¥ä½œç”¨ã€‚ ç¬¬2éƒ¨åˆ†ã€‚åœ¨5ç§’å†…ç¡®å®šä¸€åæ¿€è¿›çš„é©¾é©¶å‘˜</a></li>
<li><a href="../zh-CN436224/index.html">æˆ‘ä»¬ç¼–å†™ç¼–ç¨‹è¯­è¨€ï¼Œç¬¬4éƒ¨åˆ†ï¼šç»“æ„å’Œç±»çš„è¡¨ç¤ºå½¢å¼ï¼Œåˆ†é…å™¨çš„ç”Ÿæˆ</a></li>
<li><a href="../zh-CN436226/index.html">WiresharkæŒ‡å—å’Œå¤‡å¿˜å•</a></li>
<li><a href="../zh-CN436228/index.html">å»ºç«‹ä¸€ä¸ªä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„å›¢é˜Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>