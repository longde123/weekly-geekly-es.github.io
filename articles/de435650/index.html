<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äç‚öïÔ∏è üë¶üèª üßñüèº So binden Sie eine C-Bibliothek in ein Swift-Framework ein üõÄ üë©‚Äçüë©‚Äçüë¶‚Äçüë¶ üïµüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="2014 wurde Swift eingef√ºhrt, eine neue Sprache f√ºr die Entwicklung der √ñkosystemanwendungen von Apple. Die Neuheit brachte nicht nur neue Features und...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So binden Sie eine C-Bibliothek in ein Swift-Framework ein</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/435650/"><img src="https://habrastorage.org/webt/gg/tp/h0/ggtph083gn7erbdli6yhp2kxh_k.jpeg"><br><br>  2014 wurde Swift eingef√ºhrt, eine neue Sprache f√ºr die Entwicklung der √ñkosystemanwendungen von Apple.  Die Neuheit brachte nicht nur neue Features und Funktionen mit sich, sondern auch Probleme - f√ºr diejenigen, die die guten alten C-Bibliotheken nutzen wollten.  In diesem Artikel werde ich eine davon diskutieren - die B√ºndelung von C-Bibliotheken im Swift-Framework.  Es gibt verschiedene M√∂glichkeiten, dies zu l√∂sen.  In diesem Fall werde ich erkl√§ren, wie dies mit clang expliziten Modulen gemacht wird. <br><br>  Zum Beispiel nehmen wir die externe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">libgif</a> C-Bibliothek und binden sie in unser Swift GifSwift Framework ein.  Wenn Sie das Ergebnis sofort sehen m√∂chten, k√∂nnen Sie das vollst√§ndige Projekt hier anzeigen. <br><a name="habracut"></a><br><h1>  Libgif vorbereiten </h1><br>  Bevor Sie die libgif-Bibliothek in unser Projekt einbetten, m√ºssen Sie sie aus der Quelle kompilieren. <br><br><ol><li>  Laden Sie hier den neuesten Tarball herunter. <br></li><li>  Entpacken Sie das Archiv √ºber die Konsole, wechseln Sie in den Ordner und f√ºhren Sie Folgendes aus: <br><br><pre><code class="plaintext hljs">./configure &amp;&amp; make check</code> </pre> <br>  <b>Hinweis: Der</b> Einfachheit halber kompilieren wir eine Bibliothek f√ºr die x86-64-Plattform und daher funktioniert sie nur im iOS-Simulator oder unter macOS.  Das Erstellen einer statischen Bibliothek mit mehreren Architekturen ist ein separates Thema, das ich in diesem Artikel nicht anspreche.  N√ºtzliche Anweisungen finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br></li><li>  Wenn alles fehlerfrei verl√§uft, finden Sie die Bibliotheksdateien in <code>${lib_gif_source}/lib/.libs</code> .  Wir interessieren uns f√ºr zwei Dateien: <br><br><pre> <code class="plaintext hljs">lib/.libs/libgif.a #   lib/gif_lib.h # </code> </pre></li></ol><br><h1>  Projekteinrichtung </h1><br>  Jetzt werden wir das Projekt an unsere Bed√ºrfnisse anpassen. <br><br><ol><li>  Erstellen Sie ein neues Projekt mit der Cocoa Touch Framework-Vorlage und geben Sie ihr den Namen <i>GifSwift</i> . <br></li><li>  F√ºgen Sie die von uns erstellten <i>libgif-</i> Bibliotheksdateien einer separaten Gruppe innerhalb des Projekts hinzu. <br></li><li>  F√ºgen Sie dem Projekt ein neues Ziel f√ºr die Testanwendung hinzu, um das Ergebnis anzuzeigen. <br></li></ol><br>  Die endg√ºltige Struktur des Projekts sollte ungef√§hr so ‚Äã‚Äãaussehen: <br><br><img src="https://habrastorage.org/webt/jz/7_/fw/jz7_fw3f9ht0opyxv5moxnr8v18.png"><br><br><h1>  In Swift importieren </h1><br>  Um eine C-Bibliothek in Swift zu importieren, m√ºssen wir sie als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Modul beschreiben</a> .  Die Beschreibung ist eine <b>.modulemap-</b> Datei, die eine Liste von Header-Dateien f√ºr den Import und statische Bibliotheken zum Verkn√ºpfen enth√§lt.  Das resultierende Modul kann (mit <code>@import</code> ) in <code>@import</code> oder Objective-C-Code <code>@import</code> . <br><br>  Diese Methode zum Importieren der Bibliothek in das Framework funktioniert in den meisten F√§llen (lesen Sie hier mehr √ºber diesen Ansatz).  Es funktioniert hervorragend, wenn Sie ein internes Framework erstellen oder Ihre Anwendung nur in Module aufteilen.  Diese Methode hat aber auch Nachteile.  Zum Beispiel ist es unwirksam, wenn Sie Ihre Bibliothek an jemanden √ºbertragen m√∂chten, der Karthago, Cocoapods oder ein bin√§res Artefakt verwendet.  Der Grund daf√ºr ist, dass das resultierende Framework im Allgemeinen nicht portierbar ist, da es beim Kompilieren an einen bestimmten Speicherort der Header-Dateien und -Bibliotheken aus der Modulzuordnung auf Ihrem Computer gebunden ist. <br><br><h1>  Explizites Modul </h1><br>  Um diese Einschr√§nkungen zu umgehen, verwenden wir einen anderen Weg - das <b>explizite</b> Modul f√ºr die Bibliothek.  Ein explizites Modul ist ein Modul, das mit dem <i>expliziten</i> Schl√ºsselwort als Submodul deklariert wird, im √ºbergeordneten Modul platziert und <i>nicht</i> automatisch <i>importiert wird</i> .  Es funktioniert √§hnlich wie <code>*_Private.h</code> f√ºr Objective-C-Frameworks.  Wenn Sie die darin deklarierte API verwenden m√∂chten, m√ºssen Sie das Modul <b>explizit (explizit)</b> importieren <b>.</b> <br><br>  Wir erstellen ein explizites Modul f√ºr die C-Bibliothek innerhalb des Frameworks.  Dazu m√ºssen wir das generierte Xcode-Modul neu definieren.  Beachten Sie au√üerdem, dass wir die Bibliothek libgif.a nicht f√ºr den Link (link gif) angeben, sondern dies direkt im Projekt √ºber die Xcode-Schnittstelle tun. <br><br>  <i>Hinweis: Um mehr √ºber explizite Module zu erfahren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, klicken Sie hier.</a></i> <br><br><ol><li>  F√ºgen Sie dem <i>Stammordner</i> des Projekts eine Datei mit dem Namen <i>GifSwift.modulemap</i> hinzu: <br><br><pre> <code class="plaintext hljs">framework module GifSwift { umbrella header "GifSwift.h" explicit module CLibgif { private header "gif_lib.h" } export * }</code> </pre><br>  Diese Datei enth√§lt die Spezifikation f√ºr das explizite <i>CLibgif-</i> Modul und besteht aus einer deklarierten Header-Datei (da es nur eine in unserer Bibliothek gibt).  Die Datei wird in das resultierende Modul f√ºr das Framework geladen. <br></li><li>  Die Modulbeschreibungsdatei muss nicht zum Framework hinzugef√ºgt werden, sondern muss in den Zieleinstellungen angegeben werden: <br><br><pre> <code class="plaintext hljs">Build Settings ‚Äî Packaging ‚Äî Module Map (MODULEMAP_FILE) = $SRCROOT/GifSwift/GifSwift.modulemap</code> </pre> </li><li>  libgif-Dateien sollten dem Framework-Ziel als privater Header ( <i>gif_lib.h</i> ) und statische Bibliothek ( <i>libgif.a</i> ) <i>hinzugef√ºgt werden</i> .  Bitte beachten Sie, dass die Header-Datei f√ºr die C-Bibliothek dem Ziel als privat hinzugef√ºgt wurde.  Dies ist f√ºr unser explizites Modul erforderlich.  Nichts hindert das Hinzuf√ºgen dieser Header-Datei als √∂ffentlich, aber unsere Aufgabe ist es, Implementierungsdetails so einfach wie m√∂glich zu verbergen. <br><br><img src="https://habrastorage.org/webt/7d/jm/vv/7djmvvleep47_kqy7za8yys17f8.png"><br></li><li>  Jetzt k√∂nnen Sie das explizite Modul mit <code>import GifSwift.CLibgif</code> in das Framework <code>import GifSwift.CLibgif</code> <br></li></ol><br><h1>  Schnelle Verpackung </h1><br>  Jetzt k√∂nnen Sie die Schnittstelle unseres Frameworks erstellen.  Eine Klasse ist genug, was ein GIF mit ein paar Eigenschaften ist: <br><br><pre> <code class="plaintext hljs">import Foundation import GifSwift.CLibgif public class GifFile { private let path: URL private let fileHandlePtr: UnsafeMutablePointer&lt;GifFileType&gt; private var fileHandle: GifFileType { return self.fileHandlePtr.pointee } deinit { DGifCloseFile(self.fileHandlePtr, nil) } // MARK: - API public init?(path: URL) { self.path = path let errorCode = UnsafeMutablePointer&lt;Int32&gt;.allocate(capacity: 1) if let handle = path.path.withCString({ DGifOpenFileName($0, errorCode) }) { self.fileHandlePtr = handle DGifSlurp(handle) } else { debugPrint("Error opening file \(errorCode.pointee)") return nil } } public var size: CGSize { return CGSize(width: Double(fileHandle.SWidth), height: Double(fileHandle.SHeight)) } public var imagesCount: Int { return Int(fileHandle.ImageCount) } }</code> </pre> <br>  <code>GifFile.swift</code> Programmierschnittstellen auf niedriger Ebene f√ºr die Verarbeitung von Dateien und greift auf einige Eigenschaften zu, um sie bequemeren Foundation-Typen <code>GifFile.swift</code> . <br><br><h1>  √úberpr√ºfen Sie </h1><br>  Um unsere Bibliothek zu testen, habe ich dem <i>Projekt die</i> Datei <i>cat.gif</i> hinzugef√ºgt: <br><br><pre> <code class="plaintext hljs">import UIKit import GifSwift class ViewController: UIViewController {   override func viewDidLoad() {       super.viewDidLoad()       if let file = GifFile(path: Bundle.main.url(forResource: "cat", withExtension: "gif")!) {           debugPrint("Image has size: \(file.size) and contains \(file.imagesCount) images")       }   } }</code> </pre> <br>  Wenn wir diesen Code in der Konsole ausf√ºhren, sehen wir Folgendes: <br><br>  <b>" <i>Bild hat Gr√∂√üe: (250.0, 208.0) und enth√§lt 44 Bilder"</i></b> <b><br><br></b> <h1>  <b>Schlussfolgerungen</b> </h1> <b><br></b>  Das resultierende Framework enth√§lt alles, was Sie verwenden m√ºssen, verf√ºgt √ºber eine Swift-Oberfl√§che und verbirgt standardm√§√üig den C-Code vor Clients.  Dies ist jedoch nicht ganz richtig.  Wie ich oben geschrieben habe, erhalten Sie durch den Import von <i>GifSwift.CLibgif</i> Zugriff auf alle privaten Module. Standardm√§√üig reicht diese Kapselungsmethode jedoch aus, um die Details der Framework-Implementierung zu verbergen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de435650/">https://habr.com/ru/post/de435650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de435640/index.html">Die Zusammenfassung der Ereignisse f√ºr HR-Experten im Bereich IT f√ºr Januar 2019</a></li>
<li><a href="../de435642/index.html">Pentax Auto 110: "In welcher Faust befindet sich die Kamera?"</a></li>
<li><a href="../de435644/index.html">Zoo AFL Phaser</a></li>
<li><a href="../de435646/index.html">NB-IoT, Schmalband-Internet der Dinge. Allgemeine Informationen, technologische Merkmale</a></li>
<li><a href="../de435648/index.html">Bot generiert Tutorials aus Wikipedia-Artikeln</a></li>
<li><a href="../de435652/index.html">Wie man keine Passw√∂rter in Python-Skripten verwendet</a></li>
<li><a href="../de435654/index.html">Fallstricke von benutzerdefinierten CSS-Eigenschaften</a></li>
<li><a href="../de435656/index.html">Roller Rolls Royce - Ninebot KickScooter ES4 von Segway</a></li>
<li><a href="../de435662/index.html">"Zuverl√§ssigkeit und Zuverl√§ssigkeit wie bei Google" - und nicht nur: √úbersetzung des Artikels "Berechnung der Servicezuverl√§ssigkeit"</a></li>
<li><a href="../de435664/index.html">Google-Suchmaschinen-Spoofing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>