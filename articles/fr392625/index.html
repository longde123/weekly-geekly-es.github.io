<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>◼️ 🏥 🤗 Lecteur Arduino ZX Spectrum AY 👩🏽‍🚒 🐋 📔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lecteur autonome de morceaux de l'ordinateur ZX Spectrum sur l'Arduino avec un minimum de détails.
 
 
 
 
 Il semble que les mélodies Spectrum rester...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lecteur Arduino ZX Spectrum AY</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/392625/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lecteur autonome de morceaux de l'ordinateur ZX Spectrum sur l'Arduino avec un minimum de détails.</font></font><br>
<br>
<img src="https://habrastorage.org/files/b15/c09/984/b15c099840234dd18181db73933d5c45.jpg"><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il semble que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les mélodies Spectrum</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resteront à jamais dans mon cœur, car j'écoute régulièrement mes chansons préférées en utilisant le merveilleux </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lecteur Bulb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/files/dd6/79b/970/dd679b970b76471db74f587bbe6b7709.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais ce n'est pas très pratique d'être lié à un ordinateur. </font><font style="vertical-align: inherit;">J'ai temporairement résolu ce problème en utilisant le non moins merveilleux EEE PC. </font><font style="vertical-align: inherit;">Mais je voulais encore plus de miniature. </font></font><br>
<br>
<img src="https://habrastorage.org/files/cfb/fbd/b2e/cfbfbdb2e9b74206a9ad15e1cac6c858.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les recherches sur Internet ont conduit aux beautés suivantes:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joueur AY "XZ-80".</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sonnette musicale sur le coprocesseur sonore AY8910</font></font></a></li>
</ul><br>
<img src="https://habrastorage.org/files/4b1/1f4/2d4/4b11f42d4a824bad809d47ac07c3ee3f.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ils sont ravissants pour leur base élémentaire, qui évoque des souvenirs nostalgiques, mais j'ai réalisé que ma paresse ne me permettrait pas de mener à bien un tel projet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'avais besoin de quelque chose de petit. Et maintenant - un candidat presque idéal: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVR AY-player</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
 - lit les fichiers * .PSG </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - système de fichiers pris en charge FAT16 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - nombre de répertoires à la racine du disque 32 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - nombre de fichiers dans le répertoire 42 (total 32 * 42 = 1344 fichiers) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - tri des répertoires et des fichiers dans répertoires par les deux premières lettres du nom</font></font><br>
<br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/6Bj6zMlTw10%3Ffeature%3Doembed&amp;usg=ALkJrhgTEp0xetGUZtbvGUYlfN6Rig-A7w" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le schéma semble assez acceptable en taille: </font></font><br>
<img src="https://habrastorage.org/files/bb5/bf2/f04/bb5bf2f040304c99918d9d7aebe0e0b5.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
bien sûr, il y avait une </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faille fatale</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui a gâché l'idylle: il n'y a pas de mode de sélection aléatoire pour la composition. </font><font style="vertical-align: inherit;">(peut-être devriez-vous simplement demander à l'auteur d'ajouter cette fonction au firmware?). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jva de l'année, je cherchais une option adaptée, ma patience était finie et j'ai décidé d'agir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la base de ma paresse fantastique, j'ai choisi les gestes minimum: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Nous prenons l'Arduino Mini Pro, pour ne pas gâcher le harnais. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Vous avez besoin d'une carte SD pour stocker de la musique quelque part. </font><font style="vertical-align: inherit;">Prenez donc le bouclier SD. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Besoin d'un coprocesseur musical. </font><font style="vertical-align: inherit;">Le plus petit est AY-3-8912. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y avait une autre option pour émuler le coprocesseur par programmation, mais je voulais un «son de tube chaud», presque de toute façon.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour la lecture, nous utiliserons le format PSG.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Structure de format PSG</font></font></b><div class="spoiler_text">Offset Number of byte Description<br>
+0 3 Identifier 'PSG'<br>
+3 1 Marker “End of Text” (1Ah)<br>
+4 1 Version number<br>
+5 1 Player frequency (for versions 10+)<br>
+6 10 Data<br>
<br>
Data —      .<br>
  —   ( 0  0x0F),  — .<br>
      : 0xFF, 0xFE  0xFD<br>
0xFD —  .<br>
0xFF —  20 .<br>
0xFE —        80 .</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment convertir en PSG</font></font></b><div class="spoiler_text">1.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>.<br>
2.    <b>[PL]</b>.<br>
3.    .<br>
4.    ,    ,   <b>Convert to PSG...</b><br>
5.       8 ,      ~1..</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commençons par connecter une carte SD. </font><font style="vertical-align: inherit;">La paresse a suggéré de prendre une connexion de blindage SD standard et d'utiliser une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bibliothèque standard pour travailler avec la carte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La seule différence est que pour plus de commodité, j'ai utilisé la 10e sortie comme signal pour choisir une carte: </font></font><br>
<img src="https://habrastorage.org/files/869/04d/632/86904d632edf47dfb98863d669529126.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour les tests, nous prenons un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">croquis standard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liste de fichiers d'esquisse sur la carte</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SD.h&gt;</span></span></span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  Serial.print(<span class="hljs-string"><span class="hljs-string">"Initializing SD card..."</span></span>);<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!SD.begin(<span class="hljs-number"><span class="hljs-number">10</span></span>)) {<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"initialization failed!"</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
  }<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"initialization done."</span></span>);<font></font>
<font></font>
  File root = SD.open(<span class="hljs-string"><span class="hljs-string">"/"</span></span>);<font></font>
  printDirectory(root);<font></font>
<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"done!"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printDirectory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File dir)</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
    File entry =  dir.openNextFile();<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!entry)  <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
    Serial.print(entry.name());<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!entry.isDirectory()) {<font></font>
      Serial.print(<span class="hljs-string"><span class="hljs-string">"\t\t"</span></span>);<font></font>
      Serial.println(entry.size(), DEC);<font></font>
    }<font></font>
    entry.close();<font></font>
  }<font></font>
}<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On formate la carte, on y écrit plusieurs fichiers, aux lancements ... ça ne marche pas! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, je l'ai toujours - la tâche la plus standard - et immédiatement les jambages. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous prenons un autre lecteur flash - (c'était un ancien sur 32 Mo, nous en prenons un nouveau sur 2 Go) - oui, cela a fonctionné, mais après un certain temps. Une demi-heure de gratter le front, de réorganiser les connexions plus près de la carte (afin que les conducteurs soient plus courts), un condensateur d'isolement pour la nutrition - et il a commencé à fonctionner dans 100% des cas. Bon, </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
passons à autre </font><font style="vertical-align: inherit;">chose ... </font><font style="vertical-align: inherit;">Maintenant, nous devons obtenir un coprocesseur - il a besoin d'une fréquence d'horloge de 1,75 MHz. Au lieu de souder un générateur sur du quartz 14 MHz et de régler un diviseur, nous passons une demi-journée à lire les </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quais sur le microcontrôleur</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et découvrons qu'il est possible de faire dur 1,77 (7) MHz en utilisant un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWM rapide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs">  pinMode(<span class="hljs-number"><span class="hljs-number">3</span></span>, OUTPUT);<font></font>
  TCCR2A = <span class="hljs-number"><span class="hljs-number">0x23</span></span>;<font></font>
  TCCR2B = <span class="hljs-number"><span class="hljs-number">0x09</span></span>;<font></font>
  OCR2A = <span class="hljs-number"><span class="hljs-number">8</span></span>;<font></font>
  OCR2B = <span class="hljs-number"><span class="hljs-number">3</span></span>; 
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous remettons le processeur de musique à la broche 2, le quartet inférieur du bus de données à A0-A3, le supérieur à 4,5,6,7, BC1 à la broche 8, BDIR à la broche 9. Pour plus de simplicité, nous connectons les sorties audio en mode mono: </font></font><br>
<br>
<img src="https://habrastorage.org/files/89c/d1f/045/89cd1f045d3e468b97fddf155db61673.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la maquette:</font></font><br>
<img src="https://habrastorage.org/files/c9f/c30/758/c9fc30758f5343e0bfd7cbae53fa5e74.jpg"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplissez le croquis d'essai (je ne me souviens pas d'où j'ai fait glisser le tableau)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resetAY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  pinMode(A0, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">// D0</span></span><font></font>
  pinMode(A1, OUTPUT);<font></font>
  pinMode(A2, OUTPUT);<font></font>
  pinMode(A3, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">// D3</span></span><font></font>
  <font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">4</span></span>, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">// D4</span></span>
  pinMode(<span class="hljs-number"><span class="hljs-number">5</span></span>, OUTPUT);<font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">6</span></span>, OUTPUT);<font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">7</span></span>, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">// D7</span></span><font></font>
  <font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">8</span></span>, OUTPUT);  <span class="hljs-comment"><span class="hljs-comment">// BC1</span></span>
  pinMode(<span class="hljs-number"><span class="hljs-number">9</span></span>, OUTPUT);  <span class="hljs-comment"><span class="hljs-comment">// BDIR</span></span><font></font>
  <font></font>
  digitalWrite(<span class="hljs-number"><span class="hljs-number">8</span></span>,LOW);<font></font>
  digitalWrite(<span class="hljs-number"><span class="hljs-number">9</span></span>,LOW);<font></font>
  <font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, OUTPUT);<font></font>
  digitalWrite(<span class="hljs-number"><span class="hljs-number">2</span></span>, LOW);<font></font>
  delay(<span class="hljs-number"><span class="hljs-number">100</span></span>);<font></font>
  digitalWrite(<span class="hljs-number"><span class="hljs-number">2</span></span>, HIGH);<font></font>
  delay(<span class="hljs-number"><span class="hljs-number">100</span></span>);<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>;i++) ay_out(i,<span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupAYclock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">3</span></span>, OUTPUT);<font></font>
  TCCR2A = <span class="hljs-number"><span class="hljs-number">0x23</span></span>;<font></font>
  TCCR2B = <span class="hljs-number"><span class="hljs-number">0x09</span></span>;<font></font>
  OCR2A = <span class="hljs-number"><span class="hljs-number">8</span></span>;<font></font>
  OCR2B = <span class="hljs-number"><span class="hljs-number">3</span></span>; <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  setupAYclock();<font></font>
  resetAY();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ay_out</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data)</span></span></span></span>{<font></font>
  PORTB = PORTB &amp; B11111100;<font></font>
<font></font>
  PORTC = port &amp; B00001111;<font></font>
  PORTD = PORTD &amp; B00001111;<font></font>
<font></font>
  PORTB = PORTB | B00000011;<font></font>
  delayMicroseconds(<span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
  PORTB = PORTB &amp; B11111100;<font></font>
<font></font>
  PORTC = data &amp; B00001111;<font></font>
  PORTD = (PORTD &amp; B00001111) | (data &amp; B11110000);<font></font>
<font></font>
  PORTB = PORTB | B00000010;<font></font>
  delayMicroseconds(<span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
  PORTB = PORTB &amp; B11111100;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cb = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
<font></font>
byte rawData[] = {<font></font>
    <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x1A</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x10</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x0B</span></span>, <span class="hljs-number"><span class="hljs-number">0x47</span></span>, <span class="hljs-number"><span class="hljs-number">0x0D</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x77</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x3A</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0D</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x5E</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0C</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x32</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x1E</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0B</span></span>, <span class="hljs-number"><span class="hljs-number">0x0D</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x77</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x5E</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x3E</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x36</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x33</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x0B</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x0D</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x77</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x5E</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x3B</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x1B</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x33</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x0B</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0B</span></span>, <span class="hljs-number"><span class="hljs-number">0x0B</span></span>, <span class="hljs-number"><span class="hljs-number">0x23</span></span>, <span class="hljs-number"><span class="hljs-number">0x0D</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x77</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x5E</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x3B</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x1B</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x18</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x0B</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x77</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x77</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0D</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x5E</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x5E</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0C</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, 
    <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x30</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x77</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>,
    <span class="hljs-number"><span class="hljs-number">0xFF</span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> pseudoInterrupt(){
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (rawData[cb]&lt;<span class="hljs-number"><span class="hljs-number">0xFF</span></span>) {<font></font>
   ay_out(rawData[cb],rawData[cb+<span class="hljs-number"><span class="hljs-number">1</span></span>]);<font></font>
   cb++;<font></font>
   cb++;<font></font>
 }<font></font>
 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rawData[cb]==<span class="hljs-number"><span class="hljs-number">0xff</span></span>) cb++;<font></font>
 <font></font>
 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cb&gt;<span class="hljs-number"><span class="hljs-number">20</span></span>*<span class="hljs-number"><span class="hljs-number">12</span></span>)  cb=<span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  delay(<span class="hljs-number"><span class="hljs-number">20</span></span>);<font></font>
  pseudoInterrupt();<font></font>
}<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous entendons une demi-seconde d'une belle mélodie! </font><font style="vertical-align: inherit;">(en fait, je suis ici pendant encore deux heures à chercher comment j'ai oublié de libérer la réinitialisation après l'initialisation). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur ce point, la partie en fer est terminée, et dans le logiciel nous ajoutons des interruptions de 50 Hz, en lisant le fichier et en écrivant dans les registres du coprocesseur.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version finale du programme</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SD.h&gt;</span></span></span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resetAY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  pinMode(A0, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">// D0</span></span><font></font>
  pinMode(A1, OUTPUT);<font></font>
  pinMode(A2, OUTPUT);<font></font>
  pinMode(A3, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">// D3</span></span><font></font>
  <font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">4</span></span>, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">// D4</span></span>
  pinMode(<span class="hljs-number"><span class="hljs-number">5</span></span>, OUTPUT);<font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">6</span></span>, OUTPUT);<font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">7</span></span>, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">// D7</span></span><font></font>
  <font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">8</span></span>, OUTPUT);  <span class="hljs-comment"><span class="hljs-comment">// BC1</span></span>
  pinMode(<span class="hljs-number"><span class="hljs-number">9</span></span>, OUTPUT);  <span class="hljs-comment"><span class="hljs-comment">// BDIR</span></span><font></font>
  <font></font>
  digitalWrite(<span class="hljs-number"><span class="hljs-number">8</span></span>,LOW);<font></font>
  digitalWrite(<span class="hljs-number"><span class="hljs-number">9</span></span>,LOW);<font></font>
  <font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, OUTPUT);<font></font>
  digitalWrite(<span class="hljs-number"><span class="hljs-number">2</span></span>, LOW);<font></font>
  delay(<span class="hljs-number"><span class="hljs-number">100</span></span>);<font></font>
  digitalWrite(<span class="hljs-number"><span class="hljs-number">2</span></span>, HIGH);<font></font>
  delay(<span class="hljs-number"><span class="hljs-number">100</span></span>);<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>;i++) ay_out(i,<span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupAYclock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">3</span></span>, OUTPUT);<font></font>
  TCCR2A = <span class="hljs-number"><span class="hljs-number">0x23</span></span>;<font></font>
  TCCR2B = <span class="hljs-number"><span class="hljs-number">0x09</span></span>;<font></font>
  OCR2A = <span class="hljs-number"><span class="hljs-number">8</span></span>;<font></font>
  OCR2B = <span class="hljs-number"><span class="hljs-number">3</span></span>; <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  randomSeed(analogRead(<span class="hljs-number"><span class="hljs-number">4</span></span>)+analogRead(<span class="hljs-number"><span class="hljs-number">5</span></span>));<font></font>
<font></font>
  initFile();<font></font>
<font></font>
  setupAYclock();<font></font>
  resetAY();<font></font>
  setupTimer();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  cli();<font></font>
  <font></font>
  TCCR1A = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  TCCR1B = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  TCNT1  = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  OCR1A = <span class="hljs-number"><span class="hljs-number">1250</span></span>;<font></font>
<font></font>
  TCCR1B |= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; WGM12);<font></font>
  TCCR1B |= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; CS12);<font></font>
  TIMSK1 |= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; OCIE1A);<font></font>
<font></font>
  sei();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ay_out</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data)</span></span></span></span>{<font></font>
  PORTB = PORTB &amp; B11111100;<font></font>
<font></font>
  PORTC = port &amp; B00001111;<font></font>
  PORTD = PORTD &amp; B00001111;<font></font>
<font></font>
  PORTB = PORTB | B00000011;<font></font>
  delayMicroseconds(<span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
  PORTB = PORTB &amp; B11111100;<font></font>
<font></font>
  PORTC = data &amp; B00001111;<font></font>
  PORTD = (PORTD &amp; B00001111) | (data &amp; B11110000);<font></font>
<font></font>
  PORTB = PORTB | B00000010;<font></font>
  delayMicroseconds(<span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
  PORTB = PORTB &amp; B11111100;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> playPos = <span class="hljs-number"><span class="hljs-number">0</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fillPos = <span class="hljs-number"><span class="hljs-number">0</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bufSize = <span class="hljs-number"><span class="hljs-number">200</span></span>;<font></font>
byte playBuf[bufSize]; <span class="hljs-comment"><span class="hljs-comment">// 31 bytes per frame max, 50*31 = 1550 per sec, 155 per 0.1 sec</span></span><font></font>
<font></font>
File fp;<font></font>
boolean playFinished = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  fillBuffer();<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (playFinished){<font></font>
    fp.close();<font></font>
    openRandomFile();<font></font>
    playFinished = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillBuffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fillSz = <span class="hljs-number"><span class="hljs-number">0</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freeSz = bufSize;
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fillPos&gt;playPos) {<font></font>
    fillSz = fillPos-playPos;<font></font>
    freeSz = bufSize - fillSz;<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (playPos&gt;fillPos) {<font></font>
    freeSz = playPos - fillPos;<font></font>
    fillSz = bufSize - freeSz;<font></font>
  }<font></font>
  <font></font>
  freeSz--; <span class="hljs-comment"><span class="hljs-comment">// do not reach playPos</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (freeSz&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){<font></font>
    byte b = <span class="hljs-number"><span class="hljs-number">0xFD</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fp.available()){<font></font>
      b = fp.read();<font></font>
    }<font></font>
    playBuf[fillPos] = b;<font></font>
    fillPos++;<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fillPos==bufSize) fillPos=<span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
    freeSz--;<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *fname)</span></span></span></span>{<font></font>
  Serial.print(<span class="hljs-string"><span class="hljs-string">"prepare ["</span></span>);<font></font>
  Serial.print(fname);<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"]..."</span></span>);<font></font>
  <font></font>
  fp = SD.open(fname);<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!fp){<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"error opening music file"</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
  }  <font></font>
    <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (fp.available()) {<font></font>
    byte b = fp.read();<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b==<span class="hljs-number"><span class="hljs-number">0xFF</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
  }<font></font>
 <font></font>
  fillPos = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  playPos = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  cli();  <font></font>
  fillBuffer();<font></font>
  resetAY();<font></font>
  sei();<font></font>
}<font></font>
<font></font>
File root;<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fileCnt = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openRandomFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sel = random(<span class="hljs-number"><span class="hljs-number">0</span></span>,fileCnt<span class="hljs-number"><span class="hljs-number">-1</span></span>);<font></font>
<font></font>
  Serial.print(<span class="hljs-string"><span class="hljs-string">"File selection = "</span></span>);<font></font>
  Serial.print(sel, DEC);<font></font>
  Serial.println();<font></font>
  <font></font>
  root.rewindDirectory();<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
    File entry =  root.openNextFile();<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!entry)  <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
<font></font>
    Serial.print(entry.name());<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!entry.isDirectory()) {<font></font>
      Serial.print(<span class="hljs-string"><span class="hljs-string">"\t\t"</span></span>);<font></font>
      Serial.println(entry.size(), DEC);<font></font>
      <font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i==sel) prepareFile(entry.name());<font></font>
      i++;<font></font>
    }<font></font>
    entry.close();<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  Serial.print(<span class="hljs-string"><span class="hljs-string">"Initializing SD card..."</span></span>);<font></font>
  pinMode(<span class="hljs-number"><span class="hljs-number">10</span></span>, OUTPUT);<font></font>
  digitalWrite(<span class="hljs-number"><span class="hljs-number">10</span></span>, HIGH);<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!SD.begin(<span class="hljs-number"><span class="hljs-number">10</span></span>)) {<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"initialization failed!"</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
  }<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"initialization done."</span></span>);<font></font>
<font></font>
  root = SD.open(<span class="hljs-string"><span class="hljs-string">"/"</span></span>);<font></font>
<font></font>
  <span class="hljs-comment"><span class="hljs-comment">// reset AY</span></span><font></font>
<font></font>
  fileCnt = countDirectory(root);<font></font>
  Serial.print(<span class="hljs-string"><span class="hljs-string">"Files cnt = "</span></span>);<font></font>
  Serial.print(fileCnt, DEC);<font></font>
  Serial.println();<font></font>
  openRandomFile();<font></font>
<font></font>
  Serial.print(<span class="hljs-string"><span class="hljs-string">"Buffer size = "</span></span>);<font></font>
  Serial.print(bufSize, DEC);<font></font>
  Serial.println();<font></font>
  <font></font>
  Serial.print(<span class="hljs-string"><span class="hljs-string">"fillPos = "</span></span>);<font></font>
  Serial.print(fillPos, DEC);<font></font>
  Serial.println();<font></font>
<font></font>
  Serial.print(<span class="hljs-string"><span class="hljs-string">"playPos = "</span></span>);<font></font>
  Serial.print(playPos, DEC);<font></font>
  Serial.println();<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;bufSize;i++){<font></font>
    Serial.print(playBuf[i],HEX);<font></font>
    Serial.print(<span class="hljs-string"><span class="hljs-string">"-"</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i%<span class="hljs-number"><span class="hljs-number">16</span></span>==<span class="hljs-number"><span class="hljs-number">15</span></span>) Serial.println();<font></font>
  }<font></font>
<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"done!"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countDirectory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File dir)</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> res = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  root.rewindDirectory();<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
<font></font>
    File entry =  dir.openNextFile();<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!entry)  <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
<font></font>
    Serial.print(entry.name());<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!entry.isDirectory()) {<font></font>
      Serial.print(<span class="hljs-string"><span class="hljs-string">"\t\t"</span></span>);<font></font>
      Serial.println(entry.size(), DEC);<font></font>
      res++;<font></font>
    }<font></font>
    entry.close();<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res;<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> skipCnt = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
<font></font>
ISR(TIMER1_COMPA_vect){<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (skipCnt&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){<font></font>
    skipCnt--;<font></font>
  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fillSz = <span class="hljs-number"><span class="hljs-number">0</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freeSz = bufSize;
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fillPos&gt;playPos) {<font></font>
      fillSz = fillPos-playPos;<font></font>
      freeSz = bufSize - fillSz;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (playPos&gt;fillPos) {<font></font>
      freeSz = playPos - fillPos;<font></font>
      fillSz = bufSize - freeSz;<font></font>
    }<font></font>
<font></font>
    boolean ok = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> p = playPos;
    <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (fillSz&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){<font></font>
      byte b = playBuf[p];<font></font>
      p++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p==bufSize) p=<span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
      fillSz--;<font></font>
      <font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b==<span class="hljs-number"><span class="hljs-number">0xFF</span></span>){ ok = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b==<span class="hljs-number"><span class="hljs-number">0xFD</span></span>){ <font></font>
        ok = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <font></font>
        playFinished = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;
        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>;i++) ay_out(i,<span class="hljs-number"><span class="hljs-number">0</span></span>);
        <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <font></font>
      }<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b==<span class="hljs-number"><span class="hljs-number">0xFE</span></span>){ 
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fillSz&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){<font></font>
          skipCnt = playBuf[p];<font></font>
          p++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p==bufSize) p=<span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
          fillSz--;<font></font>
          <font></font>
          skipCnt = <span class="hljs-number"><span class="hljs-number">4</span></span>*skipCnt;<font></font>
          ok = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; 
          <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <font></font>
        } <font></font>
      }<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b&lt;=<span class="hljs-number"><span class="hljs-number">252</span></span>){
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fillSz&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){<font></font>
          byte v = playBuf[p];<font></font>
          p++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p==bufSize) p=<span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
          fillSz--;<font></font>
          <font></font>
          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>) ay_out(b,v);<font></font>
        } <font></font>
      }<font></font>
    } <span class="hljs-comment"><span class="hljs-comment">// while (fillSz&gt;0)</span></span><font></font>
  <font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ok){<font></font>
      playPos = p;<font></font>
    }<font></font>
  } <span class="hljs-comment"><span class="hljs-comment">// else skipCnt </span></span><font></font>
}<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour une autonomie complète, j'ai également ajouté un amplificateur au TDA2822M, le lecteur lui-même consomme 90 mA, avec l'amplificateur il consomme environ 200 mA, si vous le souhaitez, il peut être alimenté par des piles. </font></font><br>
<br>
<img src="https://habrastorage.org/files/c52/21f/2e1/c5221f2e12294767af40d5c5aaee0176.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les deux maquettes ensemble: </font></font><br>
<img src="https://habrastorage.org/files/4a9/028/62b/4a902862b97844d3967655e2bbd1be7f.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À ce stade, je me suis arrêté pour l'instant, écoutant la musique de la maquette, réfléchissant au cas où je voudrais l'assembler. </font><font style="vertical-align: inherit;">J'ai pensé à connecter un indicateur, mais je n'en ressens pas le besoin. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La mise en œuvre est encore humide, car </font><font style="vertical-align: inherit;">l'appareil est en cours de développement, mais parce que </font><font style="vertical-align: inherit;">Je peux l'abandonner pendant quelques années dans cet état, j'ai décidé d'écrire un article en pleine poursuite. </font><font style="vertical-align: inherit;">Questions, suggestions, commentaires, corrections - bienvenue dans les commentaires. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Littérature utilisée:</font></font><br>
<br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Générer une horloge 1-4 MHz sur Arduino</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jouer des chiptunes avec un YM2149 et optimiser un Arduino</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Générateur de sons YM2149, Arduino et commutation rapide des broches</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adaptateur ZX Spectrum AY</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Old school, hardcore, AY-3-8912. </font><font style="vertical-align: inherit;">Iron Chiptune avec entrée série</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le son d'une puce AY-3-8910 (ou Yamaha YM2149F) provient du ZX Spectrum sur un PC via un port LPT</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bouclier de carte SD fait maison pour Arduino</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lecteurs logiciels AY</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AY38910 contrôlé par Arduino - Connexions de base</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Émulateur AY sur Arduino</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lecteur AY sur AVR Atmega8 [ASM / Algorithm Builder]</font></font></a></li>
</ul></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr392625/">https://habr.com/ru/post/fr392625/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr392611/index.html">Le nouveau navigateur brave du cofondateur de Mozilla paiera les utilisateurs pour la visualisation des publicités</a></li>
<li><a href="../fr392613/index.html">L'histoire de la façon dont nous avons copter essayé d'enregistrer</a></li>
<li><a href="../fr392615/index.html">Notre espace jusqu'en 2025 et au-delà</a></li>
<li><a href="../fr392619/index.html">Les réseaux de neurones ont appris à colorier des photos en noir et blanc.</a></li>
<li><a href="../fr392621/index.html">Un rover de 12 ans Opportunity coincé sur une colline escarpée</a></li>
<li><a href="../fr392627/index.html">Les scientifiques ont trouvé un trou noir géant dans une galaxie ordinaire</a></li>
<li><a href="../fr392629/index.html">Respirez plus profondément: les astronomes ont trouvé une naine blanche avec une atmosphère d'oxygène pur</a></li>
<li><a href="../fr392631/index.html">Swipebuster propose des services de suivi des utilisateurs de Tinder</a></li>
<li><a href="../fr392633/index.html">Journée de la cosmonautique 2016: événements par ville</a></li>
<li><a href="../fr392635/index.html">С днём рождения, лэптоп! 35 лет первому коммерчески успешному портативному компьютеру</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>