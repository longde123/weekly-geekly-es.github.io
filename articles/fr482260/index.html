<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍕 ↔️ 🕺🏼 TelegramBot. La fonctionnalité de base. Autocollants et émoticônes. (Partie 3) 🎄 👩🏽‍🤝‍👨🏿 🤸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'une des questions qui revient souvent dans les MP est de savoir comment travailler avec des sourires (emojis) et des autocollants. 

 Comment travai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TelegramBot. La fonctionnalité de base. Autocollants et émoticônes. (Partie 3)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482260/"> L'une des questions qui revient souvent dans les MP est de savoir comment travailler avec des sourires (emojis) et des autocollants. <br><br>  Comment travailler avec eux, quels outils j'utilise, etc. <br><br>  Dans cette partie, nous considérerons de telles choses: comment créer un message avec un autocollant, comment traiter un message reçu avec un autocollant, comment trouver toutes les émoticônes (emoji) dans le texte du message, comment créer un message à l'aide d'émoticônes. <br><br>  Peu importe, s'il vous plaît, sous le chat. <br><a name="habracut"></a><br>  Par tradition, nous commençons l'article avec un lien vers la source :) <br><br>  Tout le code discuté dans l'article est compilé dans la <a href="https://github.com/dp-ua/TelegramBotBase/tree/Part3-Stick_and_Emoji">branche Part3-Stick_and_Emoji</a> . <br><br><h3>  Autocollants </h3><br>  L'une des choses que j'aimais tant dans le télégramme dès qu'il est apparu était les autocollants.  Ils sont cool, confortables, gratuits.  Et toute cette grande variété d'autocollants que nous voulons naturellement utiliser dans le bot.  En fait, cette procédure est très simple.  Pour envoyer un autocollant à un utilisateur, il suffit de connaître l'identifiant de l'autocollant et rien d'autre. <br>  Habituellement, pour les autocollants, je crée moi-même une telle classe d'assistant, où je stocke des données sur les autocollants utilisés dans le bot: <br><br>  <a href="">Stickers.java</a> <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.telegram.telegrambots.api.methods.send.SendSticker; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Stickers { FUNNY_JIM_CARREY(<span class="hljs-string"><span class="hljs-string">"CAADBQADiQMAAukKyAPZH7wCI2BwFxYE"</span></span>), ; String stickerId; Stickers(String stickerId) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stickerId = stickerId; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SendSticker </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSendSticker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String chatId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">""</span></span>.equals(chatId)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"ChatId cant be null"</span></span>); SendSticker sendSticker = getSendSticker(); sendSticker.setChatId(chatId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sendSticker; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SendSticker </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSendSticker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SendSticker sendSticker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendSticker(); sendSticker.setSticker(stickerId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sendSticker; } }</code> </pre> <br>  Ici, tout est simple.  Nous donnons à l'autocollant un nom qui nous est compréhensible.  Et avec quelques méthodes, nous obtenons un objet prêt à l'emploi pour l'envoi à l'utilisateur. <br><br>  Afin de répondre à la question: «Où puis-je obtenir l'ID de l'autocollant?», Écrivons-nous un assistant qui nous fournira ces données dans notre bot. <br><br>  Nous avons les fonctionnalités de base que nous avons créées ici: <br>  <a href="https://habr.com/ru/post/481354/">TelegramBot.</a>  <a href="https://habr.com/ru/post/481354/">La fonctionnalité de base.</a>  <a href="https://habr.com/ru/post/481354/">(2e partie)</a> <br>  Pour que notre robot commence à traiter les autocollants acceptés, nous avons besoin de: <br><br><ul><li>  Déterminez qu'ils nous ont envoyé un autocollant </li><li>  Indiquez quel gestionnaire est responsable du traitement des messages avec des autocollants </li><li>  Exécutez un gestionnaire qui générera un message à l'utilisateur en réponse </li></ul><br>  <b>Tâche</b> : lors de la réception d'un autocollant dans le chat, le bot doit envoyer un message texte avec l'ID de l'autocollant en réponse. <br><br>  Nous avons ajouté la commande <a href="">STICKER</a> à la liste des commandes <br><br>  Dans l'analyseur de la mise à jour envoyée, nous allons essayer de déterminer si nous avons un SMS ou s'il contient un autocollant: <br><br>  <a href="">MessageReciever.java ligne 57</a> <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message.hasText()) { parsedCommand = parser.getParsedCommand(message.getText()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Sticker sticker = message.getSticker(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sticker != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { parsedCommand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ParsedCommand(Command.STICKER, sticker.getFileId()); } }</code> </pre> <br>  Parce que  nous n'avons pas besoin de faire un traitement complexe du message envoyé, alors nous confierons le traitement des messages contenant l'autocollant au gestionnaire existant chargé de gérer les soi-disant «messages système»: <br>  <a href="">MessageReciever.java ligne 86</a> <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> START: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> HELP: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ID: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> STICKER: SystemHandler systemHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SystemHandler(bot); log.info(<span class="hljs-string"><span class="hljs-string">"Handler for command["</span></span> + command.toString() + <span class="hljs-string"><span class="hljs-string">"] is: "</span></span> + systemHandler); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> systemHandler;</code> </pre> <br>  En conséquence, dans <b>SystemHandler,</b> nous devons spécifier comment traiter la commande <b>STICKER</b> reçue: <br>  <a href="">SystemHandler.java ligne 31</a> <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> STICKER: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"StickerID: "</span></span> + parsedCommand.getText();</code> </pre> <br>  En conséquence, lors de l'envoi de tout autocollant à notre bot, nous recevrons son ID en réponse: <br><br><img src="https://habrastorage.org/webt/3i/56/dy/3i56dyf1gkch2j-xgy9o-gjk8si.png"><br><br><h3>  Émoticônes ou Emoji </h3><br>  Ils ont été standardisés, presque tous les appareils et systèmes d'exploitation les comprennent et sont capables de les afficher.  Ils sont très pratiques à utiliser pour décorer les messages.  Ils regardent succinctement les boutons sous les messages.  Qu'on le veuille ou non - certains avantages. <br><br>  Par exemple, dans le <a href="https://t.me/EventCheckPlanner_Bot">bot du planificateur d'événements</a> <br><br><img src="https://habrastorage.org/webt/r3/bq/bd/r3bqbdspnrch4-qy28vppzwxiks.png"><br><br>  En utilisant les mêmes icônes sur les boutons et dans le texte du message, vous permettez à l'utilisateur de comprendre intuitivement et votre interface, encombrant le message et les boutons avec un excès de texte. <br><br>  Pour afficher les emojis dans un message ou sur un bouton, vous devez connaître son Unicode.  Internet regorge de sources où vous pouvez trouver toutes les émoticônes listées, où leurs balises, codes sont indiqués. <br>  Pour ma part, j'ai choisi cette façon de travailler avec les émojis: il est plus pratique de regarder et de sélectionner des émoticônes dans le télégramme lui-même. <br><br>  Eh bien, bien sûr, par analogie avec les autocollants, écrivons un petit assistant pour nous qui nous montrera les codes nécessaires et même si nous sommes garantis de les traiter correctement. <br><br>  Tout d'abord, ajoutez la dépendance suivante à <a href="">pom.xml</a> : <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.vdurmont<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>emoji-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.3.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Honnêtement, je ne me souviens pas d'où je l'ai rencontré, mais depuis lors je ne l'utilise que si j'ai besoin de faire quelque chose avec des émoticônes dans mon bot. <br><br>  La bibliothèque contient de nombreux outils différents: <br><br><img src="https://habrastorage.org/webt/ri/4e/qm/ri4eqmdo2uiyrnwoxck1trfklim.png"><br><br>  Curieux et curieux seront où se retourner :) <br><br>  Que faut-il pour envoyer une émoticône à l'aide d'un bot?  Vous devez incorporer les emoji souhaités dans le texte du message Unicode. <br><br>  Oui, vous pouvez trouver des ressources qui donnent des listes Unicode avec des emojis, montrent différents tableaux récapitulatifs de l'apparence des émoticônes sur différents smartphones. <br><br>  Je veux vous montrer un moyen qui s'est avéré être le plus pratique pour travailler avec des sourires pour moi. <br><br>  Voyons d'abord comment utiliser les sourires dans le télégramme lui-même.  Vous pouvez appeler une boîte de dialogue où toutes les émoticônes sont répertoriées et les ajouter au message, simplement en cliquant sur leurs icônes.  Des émoticônes peuvent également être ajoutées au message à l'aide de balises. <br><br>  Les balises doivent être encadrées de deux points et contenir une sorte de texte unique indiquant le smiley souhaité. <br><br>  Si dans le champ de saisie d'un message vous commencez à taper un message commençant par deux points, le télégramme lui-même commencera à montrer quels emojis contiennent le texte saisi de la balise: <br><br><img src="https://habrastorage.org/webt/hr/s4/1o/hrs41orsvl1k4mkpt7mxlja-bnm.png"><br><br>  Et lorsque vous entrez la bonne balise d'émoticône et mettez un autre deux-points - le texte se transformera en un smiley.  Les balises sont également affichées si vous maintenez le bouton gauche de la souris sur l'émoticône. <br><br><img src="https://habrastorage.org/webt/t-/ib/ya/t-ibya9mw4829qau8wnz9h8uxwq.png"><br><br>  Et maintenant, la bibliothèque vient à notre aide, dont nous avons ajouté la dépendance ci-dessus.  Elle sait comment travailler avec des balises d'émoticônes.  Ceci est pratique principalement pour vous, car les balises sont plus lisibles, elles ont une sorte de sens. <br><br>  Et nous, connaissant la balise, pouvons obtenir l'émoticône Unicode comme ceci: <br><br><pre> <code class="java hljs">String emoji_kissing = EmojiParser.parseToUnicode(<span class="hljs-string"><span class="hljs-string">":kissing:"</span></span>);</code> </pre> <br>  Vous pouvez vous faire une classe séparée dans laquelle vous garderez les émoticônes que vous utilisez dans le bot.  Sur l'exemple du même <a href="https://t.me/EventCheckPlanner_Bot">planificateur d'événements</a> , il a ces sourires dans son arsenal: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vdurmont.emoji.EmojiParser; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Icon { PLUS(<span class="hljs-string"><span class="hljs-string">":heavy_plus_sign:"</span></span>), MINUS(<span class="hljs-string"><span class="hljs-string">":heavy_minus_sign:"</span></span>), CHECK(<span class="hljs-string"><span class="hljs-string">":white_check_mark:"</span></span>), NOT(<span class="hljs-string"><span class="hljs-string">":x:"</span></span>), DOUBT(<span class="hljs-string"><span class="hljs-string">":zzz:"</span></span>), FLAG(<span class="hljs-string"><span class="hljs-string">":checkered_flag:"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EmojiParser.parseToUnicode(value); } Icon(String value) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = value; } }</code> </pre> <br>  Et voici à quoi ressemblera le code en utilisant cette classe et une émoticône spécifique: <br><br><pre> <code class="java hljs"> row.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InlineKeyboardButton() .setText(Icon.CHECK.get() + <span class="hljs-string"><span class="hljs-string">" I'm going"</span></span>)</code> </pre> <br>  Voici le code de ce bouton: <br><br><img src="https://habrastorage.org/webt/bc/lw/ou/bclwou1ukoe0nosc7iyfnqw6zki.png"><br><br>  J'ai remarqué une nuance de cette bibliothèque.  Toutes les émoticônes contenues dans un télégramme ne peuvent pas être reconnues par la bibliothèque.  Par conséquent, faites attention aux nouvelles versions de la bibliothèque. <br><br>  Eh bien, pour savoir exactement quels sourires nous pouvons montrer et lesquels non, nous confierons cette tâche à notre assistante. <br><br>  <b>Tâche:</b> si le message envoyé ne contient aucune commande spécifique, mais contient des sourires dans le texte, affichez ces sourires à l'écran sous forme de message à l'utilisateur et indiquez leurs attributs (balise et description). <br><br>  Ajoutez la commande <b>TEXT_CONTAIN_EMOJI</b> à la liste des commandes <br>  <a href="">Command.java ligne 8</a> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Command { ... TEXT_CONTAIN_EMOJI, ... }</code> </pre> <br>  Dans l'analyseur qui détermine le type de commande contenu dans notre message, ajoutez le texte suivant: <br><br>  <a href="">Parser.java ligne 38</a> <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.getCommand() == Command.NONE) { List&lt;String&gt; emojiContainsInText = EmojiParser.extractEmojis(result.getText()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (emojiContainsInText.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) result.setCommand(Command.TEXT_CONTAIN_EMOJI); }</code> </pre> <br>  Si nous déterminons que le message ne contient aucune commande spécifique, mais qu'il contient des émoticônes, nous renvoyons que nous avons analysé la commande TEXT_CONTAIN_EMOJI. <br><br>  Créez un gestionnaire distinct qui ne traitera que cette commande: <br>  <a href="">EmojiHandler.java</a> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.example.telegrambot.bot.Bot; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.example.telegrambot.command.ParsedCommand; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vdurmont.emoji.Emoji; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vdurmont.emoji.EmojiManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.vdurmont.emoji.EmojiParser; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.log4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.telegram.telegrambots.api.objects.Update; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashSet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Set; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmojiHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = Logger.getLogger(EmojiHandler.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmojiHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bot bot)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(bot); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String chatId, ParsedCommand parsedCommand, Update update)</span></span></span><span class="hljs-function"> </span></span>{ String text = parsedCommand.getText(); StringBuilder result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); Set&lt;String&gt; emojisInTextUnique = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;&gt;(EmojiParser.extractEmojis(text)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (emojisInTextUnique.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) result.append(<span class="hljs-string"><span class="hljs-string">"Parsed emojies from message:"</span></span>).append(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String emojiUnicode : emojisInTextUnique) { Emoji byUnicode = EmojiManager.getByUnicode(emojiUnicode); log.debug(byUnicode.toString()); String emoji = byUnicode.getUnicode() + <span class="hljs-string"><span class="hljs-string">" "</span></span> + byUnicode.getAliases() + <span class="hljs-string"><span class="hljs-string">" "</span></span> + byUnicode.getDescription(); result.append(emoji).append(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.toString(); } }</code> </pre> <br>  Ce code sélectionne uniquement les émoticônes dans le texte du message, forme un ensemble avec des émoticônes uniques, sélectionne les balises et la description de leurs propriétés et génère un message texte à partir de cela. <br><br>  Le résultat du travail ressemble à ceci: <br><br><img src="https://habrastorage.org/webt/ia/wy/sx/iawysxkxh3utfud9znjifqrgosm.png"><br><br>  Entre crochets, nous obtenons des balises que nous pouvons utiliser pour insérer des émoticônes.  Vous pouvez voir que plus d'une balise fait parfois référence à une émoticône. <br><br>  Et aussi, avec l'aide de cet assistant, nous pouvons comprendre précisément quelles émoticônes notre bibliothèque comprend et lesquelles elle ignore. <br><br>  Comme, par exemple, vous pouvez voir ici: <br><br><img src="https://habrastorage.org/webt/bz/f9/5i/bzf95i9alj3uqweuzdxfqg9ost0.png"><br><br>  Souriez avec le code <i>: face_with_monocle:</i> pour une raison quelconque, il n'est pas détecté par cette bibliothèque. <br><br>  Nous avons donc un gestionnaire.  Comment lui passer la tâche? <br><br>  Parce que  nous savons déjà qu'un message texte contenant des émoticônes est détecté en tant que commande TEXT_CONTAIN_EMOJI - dans MessageReciever, nous devons indiquer qu'un gestionnaire EmojiHandler distinct est responsable du traitement de cette commande. <br><br>  <a href="">MessageReciever.java ligne 94</a> <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TEXT_CONTAIN_EMOJI: EmojiHandler emojiHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmojiHandler(bot); log.info(<span class="hljs-string"><span class="hljs-string">"Handler for command["</span></span> + command.toString() + <span class="hljs-string"><span class="hljs-string">"] is: "</span></span> + emojiHandler); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> emojiHandler;</code> </pre> <br>  Programmez avec plaisir et n'hésitez pas à poser des questions :) <br><br>  PS <br>  Vous pouvez sentir le bot avec cette fonctionnalité ici: <a href="https://t.me/test_habr_bot">https://t.me/test_habr_bot</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482260/">https://habr.com/ru/post/fr482260/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482250/index.html">Une machine d'état simple pour VueJS</a></li>
<li><a href="../fr482252/index.html">Toilette automatique pour chats - suite</a></li>
<li><a href="../fr482254/index.html">Expérience VonmoTrade. Partie 3: Livre des mandats. Traitement et stockage des informations commerciales</a></li>
<li><a href="../fr482256/index.html">L'IA et l'avenir du travail: perspectives d'emploi dans un avenir proche</a></li>
<li><a href="../fr482258/index.html">Comment fonctionnent les réseaux de neurones et pourquoi ils ont commencé à rapporter beaucoup d'argent</a></li>
<li><a href="../fr482262/index.html">Comment se connecter à Talend Open Studio</a></li>
<li><a href="../fr482264/index.html">Brésil, magie noire, Mortal Kombat, Mars et 15 000 personnes. Résultats de l'année Ontiko</a></li>
<li><a href="../fr482268/index.html">Mégastructures du futur: la sphère Dyson, le moteur stellaire et la «bombe du trou noir»</a></li>
<li><a href="../fr482272/index.html">Choisir un entrepôt de données pour Prometheus: Thanos vs VictoriaMetrics</a></li>
<li><a href="../fr482274/index.html">5 raisons pour lesquelles vous devriez cesser d'utiliser System.Drawing dans ASP.NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>