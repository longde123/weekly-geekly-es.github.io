<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥„ ğŸ‘©ğŸ¾â€ğŸŒ¾ ğŸˆ² Flutteråº”ç”¨ç¨‹åºæ¶æ„101ï¼šé¦™è‰ï¼ŒèŒƒå›´æ¨¡å‹ï¼ŒBLoC ğŸ›³ï¸ ğŸ˜” ğŸ™ˆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ï¼ˆæœ€åˆåœ¨Mediumä¸Šå‘å¸ƒï¼‰ 


 Flutteræä¾›äº†ä¸€ä¸ªç°ä»£çš„ååº”å¼æ¡†æ¶ï¼Œä¸°å¯Œçš„å°éƒ¨ä»¶é›†åˆå’Œå·¥å…·ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆç±»ä¼¼äºAndroidçš„åº”ç”¨ç¨‹åºæ¶æ„æŒ‡å— ã€‚ 


 ç¡®å®ï¼Œæ²¡æœ‰æœ€ç»ˆçš„æ¶æ„å¯ä»¥æ»¡è¶³æ‰€æœ‰å¯èƒ½çš„è¦æ±‚ï¼Œä½†æ˜¯è®©æˆ‘ä»¬é¢å¯¹è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œæˆ‘ä»¬æ­£åœ¨å¼€å‘çš„å¤§å¤šæ•°ç§»åŠ¨åº”ç”¨ç¨‹åºè‡³å°‘å…·æœ‰ä»¥ä¸‹æŸäº›åŠŸèƒ½ï¼š 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Flutteråº”ç”¨ç¨‹åºæ¶æ„101ï¼šé¦™è‰ï¼ŒèŒƒå›´æ¨¡å‹ï¼ŒBLoC</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438524/"><p><img src="https://habrastorage.org/webt/2j/2p/yu/2j2pyudr-kde4fqeczqoic_9lpq.png"></p><br><p>  ï¼ˆæœ€åˆåœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mediumä¸Š</a>å‘å¸ƒï¼‰ </p><br><p>  Flutteræä¾›äº†ä¸€ä¸ªç°ä»£çš„ååº”å¼æ¡†æ¶ï¼Œä¸°å¯Œçš„å°éƒ¨ä»¶é›†åˆå’Œå·¥å…·ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆç±»ä¼¼äºAndroidçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åº”ç”¨ç¨‹åºæ¶æ„æŒ‡å—</a> ã€‚ </p><br><p> ç¡®å®ï¼Œæ²¡æœ‰æœ€ç»ˆçš„æ¶æ„å¯ä»¥æ»¡è¶³æ‰€æœ‰å¯èƒ½çš„è¦æ±‚ï¼Œä½†æ˜¯è®©æˆ‘ä»¬é¢å¯¹è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œæˆ‘ä»¬æ­£åœ¨å¼€å‘çš„å¤§å¤šæ•°ç§»åŠ¨åº”ç”¨ç¨‹åºè‡³å°‘å…·æœ‰ä»¥ä¸‹æŸäº›åŠŸèƒ½ï¼š </p><br><ol><li> å‘/å‘ç½‘ç»œè¯·æ±‚/ä¸Šä¼ æ•°æ®ã€‚ </li><li> æ˜ å°„ï¼Œè½¬æ¢ï¼Œå‡†å¤‡æ•°æ®å¹¶å°†å…¶å‘ˆç°ç»™ç”¨æˆ·ã€‚ </li><li> å°†æ•°æ®æ”¾å…¥æ•°æ®åº“æˆ–ä»æ•°æ®åº“è·å–æ•°æ®ã€‚ </li></ol><br><p> è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå®ƒä½¿ç”¨ä¸‰ç§ä¸åŒçš„ä½“ç³»ç»“æ„æ–¹æ³•æ¥è§£å†³å®Œå…¨ç›¸åŒçš„é—®é¢˜ã€‚ <a name="habracut"></a></p><br><p> å±å¹•ä¸­å¤®å°†ä¸ºç”¨æˆ·æ˜¾ç¤ºâ€œåŠ è½½ç”¨æˆ·æ•°æ®â€æŒ‰é’®ã€‚ å½“ç”¨æˆ·å•å‡»æŒ‰é’®æ—¶ï¼Œå°†è§¦å‘å¼‚æ­¥æ•°æ®åŠ è½½ï¼Œå¹¶å°†è¯¥æŒ‰é’®æ›¿æ¢ä¸ºåŠ è½½æŒ‡ç¤ºå™¨ã€‚ åŠ è½½æ•°æ®åï¼Œå°†åŠ è½½æŒ‡ç¤ºå™¨æ›¿æ¢ä¸ºæ•°æ®ã€‚ </p><br><p> è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ </p><br><p><img src="https://habrastorage.org/webt/c5/by/8g/c5by8gjmz_oov-ukuy4_dwo4njs.gif"></p><br><h2 id="data"> èµ„æ–™ </h2><br><p>ä¸ºç®€å•èµ·è§ï¼Œæˆ‘åˆ›å»ºäº†<code>Repository</code>ç±»ï¼Œå…¶ä¸­åŒ…å«æ¨¡æ‹Ÿå¼‚æ­¥ç½‘ç»œè°ƒç”¨å¹¶è¿”å›å¸¦æœ‰ç¡¬ç¼–ç å€¼çš„<code>Future&lt;User&gt;</code>å¯¹è±¡çš„<code>getUser()</code>æ–¹æ³•ã€‚ </p><br><p> å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰Dartä¸­çš„Futureså’Œå¼‚æ­¥ç¼–ç¨‹ï¼Œåˆ™å¯ä»¥é€šè¿‡é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ•™ç¨‹</a>å¹¶é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a>æ¥è¿›ä¸€æ­¥äº†è§£å®ƒã€‚ </p><br><pre> <code class="plaintext hljs">class Repository { Future&lt;User&gt; getUser() async { await Future.delayed(Duration(seconds: 2)); return User(name: 'John', surname: 'Smith'); } }</code> </pre> <br><pre> <code class="plaintext hljs">class User { User({ @required this.name, @required this.surname, }); final String name; final String surname; }</code> </pre> <br><h2 id="vanilla"> é¦™è‰å‘³ </h2><br><p> è®©æˆ‘ä»¬ä»¥å¤§å¤šæ•°å¼€å‘äººå‘˜åœ¨é˜…è¯»Flutterå®˜æ–¹æ–‡æ¡£åä¼šåšçš„æ–¹å¼æ„å»ºåº”ç”¨ç¨‹åºã€‚ </p><br><p> ä½¿ç”¨<code>Navigator</code>å¯¼èˆªåˆ°<code>VanillaScreen</code>å±å¹• </p><br><pre> <code class="plaintext hljs">Navigator.push( context, MaterialPageRoute( builder: (context) =&gt; VanillaScreen(_repository), ), );</code> </pre> <br><p> ç”±äºå°éƒ¨ä»¶çš„çŠ¶æ€åœ¨å°éƒ¨ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­å¯èƒ½ä¼šæ”¹å˜å‡ æ¬¡ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥æ‰©å±•<code>StatefulWidget</code> ã€‚ å®ç°æœ‰çŠ¶æ€çš„çª—å£å°éƒ¨ä»¶è¿˜éœ€è¦å…·æœ‰<code>State</code>ç±»ã€‚  <code>_VanillaScreenState</code>ç±»ä¸­çš„<code>bool _isLoading</code>å’Œ<code>User _user</code>å­—æ®µè¡¨ç¤ºå°éƒ¨ä»¶çš„çŠ¶æ€ã€‚ åœ¨è°ƒç”¨<code>build(BuildContext context)</code>æ–¹æ³•ä¹‹å‰ï¼Œå°†åˆå§‹åŒ–è¿™ä¸¤ä¸ªå­—æ®µã€‚ </p><br><pre> <code class="plaintext hljs">class VanillaScreen extends StatefulWidget { VanillaScreen(this._repository); final Repository _repository; @override State&lt;StatefulWidget&gt; createState() =&gt; _VanillaScreenState(); } class _VanillaScreenState extends State&lt;VanillaScreen&gt; { bool _isLoading = false; User _user; @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: const Text('Vanilla'), ), body: SafeArea( child: _isLoading ? _buildLoading() : _buildBody(), ), ); } Widget _buildBody() { if (_user != null) { return _buildContent(); } else { return _buildInit(); } } Widget _buildInit() { return Center( child: RaisedButton( child: const Text('Load user data'), onPressed: () { setState(() { _isLoading = true; }); widget._repository.getUser().then((user) { setState(() { _user = user; _isLoading = false; }); }); }, ), ); } Widget _buildContent() { return Center( child: Text('Hello ${_user.name} ${_user.surname}'), ); } Widget _buildLoading() { return const Center( child: CircularProgressIndicator(), ); } }</code> </pre> <br><p> å½“åˆ›å»ºçª—å£å°éƒ¨ä»¶çŠ¶æ€å¯¹è±¡æ—¶ï¼Œå°†è°ƒç”¨<code>build(BuildContext context)</code>æ–¹æ³•æ¥æ„å»ºUIã€‚ æœ‰å…³åº”æ„å»ºä¸ºä»£è¡¨å½“å‰çŠ¶æ€çš„å°éƒ¨ä»¶çš„æ‰€æœ‰å†³å®šå‡åœ¨UIå£°æ˜ä»£ç ä¸­åšå‡ºã€‚ </p><br><pre> <code class="plaintext hljs">body: SafeArea( child: _isLoading ? _buildLoading() : _buildBody(), )</code> </pre> <br><p> ä¸ºäº†åœ¨ç”¨æˆ·å•å‡»â€œåŠ è½½ç”¨æˆ·è¯¦ç»†ä¿¡æ¯â€æŒ‰é’®æ—¶æ˜¾ç¤ºè¿›åº¦æŒ‡ç¤ºå™¨ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚ </p><br><pre> <code class="plaintext hljs">setState(() { _isLoading = true; });</code> </pre> <br><blockquote> è°ƒç”¨setStateï¼ˆï¼‰ä¼šé€šçŸ¥æ¡†æ¶æ­¤å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å·²æ›´æ”¹ï¼Œè¯¥æ–¹å¼å¯èƒ½ä¼šå½±å“æ­¤å­æ ‘ä¸­çš„ç”¨æˆ·ç•Œé¢ï¼Œè¿™å°†å¯¼è‡´æ¡†æ¶ä¸ºè¯¥Stateå¯¹è±¡å®‰æ’æ„å»ºã€‚ </blockquote><p> è¿™æ„å‘³ç€åœ¨è°ƒç”¨<code>setState()</code>æ–¹æ³•åï¼Œæ¡†æ¶å°†å†æ¬¡è°ƒç”¨<code>build(BuildContext context)</code>æ–¹æ³•ï¼Œå¹¶<strong>é‡æ–°æ„å»ºæ•´ä¸ªå°éƒ¨ä»¶æ ‘</strong> ã€‚ ç”±äº<code>_isLoading</code>ç°åœ¨è®¾ç½®ä¸º<code>true</code> <code>_buildLoading()</code>å°†è°ƒç”¨<code>_buildBody()</code>è€Œä¸æ˜¯<code>_buildBody()</code>å¹¶ä¸”å°†åœ¨å±å¹•ä¸Šæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ã€‚ å½“æˆ‘ä»¬å¤„ç†<code>getUser()</code>å›è°ƒå¹¶è°ƒç”¨<code>setState()</code>é‡æ–°åˆ†é…<code>_isLoading</code>å’Œ<code>_user</code>å­—æ®µæ—¶ï¼Œæƒ…å†µ<code>_user</code> ã€‚ </p><br><pre> <code class="plaintext hljs">widget._repository.getUser().then((user) { setState(() { _user = user; _isLoading = false; }); });</code> </pre> <br><h3 id="pros"> ä¼˜ç‚¹ </h3><br><ol><li> æ˜“äºå­¦ä¹ å’Œç†è§£ã€‚ </li><li> ä¸éœ€è¦ç¬¬ä¸‰æ–¹åº“ã€‚ </li></ol><br><h3 id="cons"> ç¼ºç‚¹ </h3><br><ol><li> æ¯æ¬¡å°éƒ¨ä»¶çŠ¶æ€æ›´æ”¹æ—¶ï¼Œæ•´ä¸ªå°éƒ¨ä»¶æ ‘éƒ½ä¼šé‡æ–°æ„å»ºã€‚ </li><li> è¿™æ‰“ç ´äº†å•ä¸€è´£ä»»åŸåˆ™ã€‚  Widgetä¸ä»…è´Ÿè´£æ„å»ºUIï¼Œè¿˜è´Ÿè´£æ•°æ®åŠ è½½ï¼Œä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†ã€‚ </li><li> åœ¨UIå£°æ˜ä»£ç ä¸­åšå‡ºæœ‰å…³åº”å¦‚ä½•è¡¨ç¤ºå½“å‰çŠ¶æ€çš„å†³å®šã€‚ å¦‚æœæˆ‘ä»¬æœ‰ä¸€äº›æ›´å¤æ‚çš„çŠ¶æ€ä»£ç ï¼Œåˆ™å¯è¯»æ€§å°†é™ä½ã€‚ </li></ol><br><h2 id="scoped-model"> èŒƒå›´æ¨¡å‹ </h2><br><p> èŒƒå›´æ¨¡å‹æ˜¯Flutteræ¡†æ¶ä¸­æœªåŒ…å«<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„ç¬¬ä¸‰æ–¹ç¨‹åºåŒ…</a> ã€‚ è¿™æ˜¯èŒƒå›´æ¨¡å‹çš„å¼€å‘è€…å¦‚ä½•æè¿°å®ƒï¼š </p><br><blockquote> ä¸€ç»„å®ç”¨ç¨‹åºï¼Œå¯è®©æ‚¨è½»æ¾åœ°å°†æ•°æ®æ¨¡å‹ä»çˆ¶Widgetä¼ é€’åˆ°å…¶åä»£ã€‚ æ­¤å¤–ï¼Œå½“æ›´æ–°æ¨¡å‹æ—¶ï¼Œå®ƒè¿˜ä¼šé‡å»ºä½¿ç”¨è¯¥æ¨¡å‹çš„æ‰€æœ‰å­ä»£ã€‚ è¯¥åº“æœ€åˆæ˜¯ä»Fuchsiaä»£ç åº“ä¸­æå–çš„ã€‚ </blockquote><p> è®©æˆ‘ä»¬ä½¿ç”¨èŒƒå›´æ¨¡å‹æ„å»ºç›¸åŒçš„å±å¹•ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>pubspec.yaml</code>éƒ¨åˆ†çš„<code>pubspec.yaml</code>æ·»åŠ <code>scoped_model</code>ä¾èµ–é¡¹æ¥å®‰è£…Scoped Modelè½¯ä»¶åŒ…ã€‚ </p><br><pre> <code class="plaintext hljs">scoped_model: ^1.0.1</code> </pre> <br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>UserModelScreen</code>å°éƒ¨ä»¶ï¼Œå¹¶å°†å…¶ä¸ä¹‹å‰æœªä½¿ç”¨èŒƒå›´æ¨¡å‹æ„å»ºçš„ç¤ºä¾‹è¿›è¡Œæ¯”è¾ƒã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹UserModelScreenå°éƒ¨ä»¶ï¼Œå¹¶å°†å…¶ä¸ä¹‹å‰æœªä½¿ç”¨èŒƒå›´æ¨¡å‹æ„å»ºçš„ç¤ºä¾‹è¿›è¡Œæ¯”è¾ƒã€‚ å½“æˆ‘ä»¬æƒ³è®©æ¨¡å‹å¯¹æ‰€æœ‰å°éƒ¨ä»¶çš„åä»£å¯ç”¨æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨é€šç”¨çš„ScopedModelåŒ…è£…å®ƒï¼Œå¹¶æä¾›ä¸€ä¸ªå°éƒ¨ä»¶å’Œä¸€ä¸ªæ¨¡å‹ã€‚ </p><br><pre> <code class="plaintext hljs">class UserModelScreen extends StatefulWidget { UserModelScreen(this._repository); final Repository _repository; @override State&lt;StatefulWidget&gt; createState() =&gt; _UserModelScreenState(); } class _UserModelScreenState extends State&lt;UserModelScreen&gt; { UserModel _userModel; @override void initState() { _userModel = UserModel(widget._repository); super.initState(); } @override Widget build(BuildContext context) { return ScopedModel( model: _userModel, child: Scaffold( appBar: AppBar( title: const Text('Scoped model'), ), body: SafeArea( child: ScopedModelDescendant&lt;UserModel&gt;( builder: (context, child, model) { if (model.isLoading) { return _buildLoading(); } else { if (model.user != null) { return _buildContent(model); } else { return _buildInit(model); } } }, ), ), ), ); } Widget _buildInit(UserModel userModel) { return Center( child: RaisedButton( child: const Text('Load user data'), onPressed: () { userModel.loadUserData(); }, ), ); } Widget _buildContent(UserModel userModel) { return Center( child: Text('Hello ${userModel.user.name} ${userModel.user.surname}'), ); } Widget _buildLoading() { return const Center( child: CircularProgressIndicator(), ); } }</code> </pre> <br><p> åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå½“çª—å£å°éƒ¨ä»¶çš„çŠ¶æ€æ›´æ”¹æ—¶ï¼Œæ•´ä¸ªçª—å£å°éƒ¨ä»¶æ ‘éƒ½å·²é‡å»ºã€‚ ä½†æ˜¯æˆ‘ä»¬å®é™…ä¸Šæ˜¯å¦éœ€è¦é‡å»ºæ•´ä¸ªå±å¹•ï¼Ÿ ä¾‹å¦‚AppBaræ ¹æœ¬ä¸åº”è¯¥æ›´æ”¹ï¼Œå› æ­¤é‡å»ºå®ƒæ¯«æ— æ„ä¹‰ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥åªé‡å»ºé‚£äº›å·²æ›´æ–°çš„å°éƒ¨ä»¶ã€‚ èŒƒå›´æ¨¡å‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¯¥é—®é¢˜ã€‚ </p><br><p>  <code>ScopedModelDescendant&lt;UserModel&gt;</code>å°éƒ¨ä»¶ç”¨äºåœ¨å°éƒ¨ä»¶æ ‘ä¸­æŸ¥æ‰¾<code>UserModel</code> ã€‚ æ¯å½“<code>UserModel</code>é€šçŸ¥å·²å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨é‡å»ºã€‚ </p><br><p> å¦ä¸€ä¸ªæ”¹è¿›æ˜¯<code>UserModelScreen</code>ä¸å†è´Ÿè´£çŠ¶æ€ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘ã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>UserModel</code>ä»£ç ã€‚ </p><br><pre> <code class="plaintext hljs">class UserModel extends Model { UserModel(this._repository); final Repository _repository; bool _isLoading = false; User _user; User get user =&gt; _user; bool get isLoading =&gt; _isLoading; void loadUserData() { _isLoading = true; notifyListeners(); _repository.getUser().then((user) { _user = user; _isLoading = false; notifyListeners(); }); } static UserModel of(BuildContext context) =&gt; ScopedModel.of&lt;UserModel&gt;(context); }</code> </pre> <br><p> ç°åœ¨ï¼Œ <code>UserModel</code>ä¿ç•™å¹¶ç®¡ç†çŠ¶æ€ã€‚ ä¸ºäº†é€šçŸ¥ä¾¦å¬å™¨ï¼ˆå’Œé‡å»ºåä»£ï¼‰æ›´æ”¹å·²å‘ç”Ÿï¼Œåº”è°ƒç”¨<code>notifyListeners()</code>æ–¹æ³•ã€‚ </p><br><h3 id="pros-1"> ä¼˜ç‚¹ </h3><br><ol><li> ä¸šåŠ¡é€»è¾‘ï¼ŒçŠ¶æ€ç®¡ç†å’ŒUIä»£ç åˆ†ç¦»ã€‚ </li><li> ç®€å•æ˜“å­¦ã€‚ <br><h3 id="cons"> ç¼ºç‚¹ </h3></li><li> éœ€è¦ç¬¬ä¸‰æ–¹åº“ã€‚ </li><li> éšç€æ¨¡å‹å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¾ˆéš¾è·Ÿè¸ªä½•æ—¶åº”è°ƒç”¨<code>notifyListeners()</code> ã€‚ </li></ol><br><h2 id="bloc"> ä¿¡ç”¨è¯ </h2><br><p>  BLoCï¼ˆå•†åŠ¡é€»è¾‘ç»„ä»¶ï¼‰æ˜¯Googleå¼€å‘äººå‘˜æ¨èçš„æ¨¡å¼ã€‚ å®ƒåˆ©ç”¨æµåŠŸèƒ½æ¥ç®¡ç†å’Œä¼ æ’­çŠ¶æ€æ›´æ”¹ã€‚ </p><br><p>  <strong>å¯¹äºAndroidå¼€å‘äººå‘˜ï¼š</strong>æ‚¨å¯ä»¥å°†<code>Bloc</code>å¯¹è±¡è§†ä¸º<code>ViewModel</code>è€Œå°†<code>StreamController</code>è§†ä¸º<code>LiveData</code> ã€‚ ç”±äºæ‚¨å·²ç»ç†Ÿæ‚‰è¿™äº›æ¦‚å¿µï¼Œå› æ­¤è¿™å°†ä½¿ä»¥ä¸‹ä»£ç éå¸¸ç®€å•ã€‚ </p><br><pre> <code class="plaintext hljs">class UserBloc { UserBloc(this._repository); final Repository _repository; final _userStreamController = StreamController&lt;UserState&gt;(); Stream&lt;UserState&gt; get user =&gt; _userStreamController.stream; void loadUserData() { _userStreamController.sink.add(UserState._userLoading()); _repository.getUser().then((user) { _userStreamController.sink.add(UserState._userData(user)); }); } void dispose() { _userStreamController.close(); } } class UserState { UserState(); factory UserState._userData(User user) = UserDataState; factory UserState._userLoading() = UserLoadingState; } class UserInitState extends UserState {} class UserLoadingState extends UserState {} class UserDataState extends UserState { UserDataState(this.user); final User user; }</code> </pre> <br><p> çŠ¶æ€æ›´æ”¹æ—¶ï¼Œä¸éœ€è¦å…¶ä»–æ–¹æ³•è°ƒç”¨å³å¯é€šçŸ¥è®¢æˆ·ã€‚ </p><br><p> æˆ‘åˆ›å»ºäº†3ä¸ªç±»æ¥è¡¨ç¤ºå±å¹•çš„å¯èƒ½çŠ¶æ€ï¼š </p><br><p> ç”¨æˆ·æ‰“å¼€çŠ¶æ€ä¸ºä¸­é—´å¸¦æœ‰æŒ‰é’®çš„å±å¹•æ—¶ï¼Œä¸ºçŠ¶æ€çš„<code>UserInitState</code> ã€‚ </p><br><p> çŠ¶æ€çš„<code>UserLoadingState</code> ï¼Œåœ¨åŠ è½½æ•°æ®æ—¶æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºç¬¦æ—¶ã€‚ </p><br><p> æ•°æ®åŠ è½½å¹¶æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶çš„çŠ¶æ€çš„<code>UserDataState</code> ã€‚ </p><br><p> ä»¥è¿™ç§æ–¹å¼ä¼ æ’­çŠ¶æ€æ›´æ”¹ï¼Œä½¿æˆ‘ä»¬å¯ä»¥æ‘†è„±UIå£°æ˜ä»£ç ä¸­çš„æ‰€æœ‰é€»è¾‘ã€‚ åœ¨ä½¿ç”¨èŒƒå›´æ¨¡å‹çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»åœ¨æ£€æŸ¥UIå£°æ˜ä»£ç ä¸­<code>_isLoading</code>æ˜¯å¦ä¸º<code>true</code> ï¼Œä»¥ç¡®å®šåº”è¯¥å‘ˆç°å“ªä¸ªå°éƒ¨ä»¶ã€‚ å¦‚æœä½¿ç”¨BLoCï¼Œæˆ‘ä»¬å°†ä¼ æ’­å±å¹•çŠ¶æ€ï¼Œè€Œ<code>UserBlocScreen</code>å°éƒ¨ä»¶çš„å”¯ä¸€è´£ä»»æ˜¯å‘ˆç°æ­¤çŠ¶æ€çš„UIã€‚ </p><br><pre> <code class="plaintext hljs">class UserBlocScreen extends StatefulWidget { UserBlocScreen(this._repository); final Repository _repository; @override State&lt;StatefulWidget&gt; createState() =&gt; _UserBlocScreenState(); } class _UserBlocScreenState extends State&lt;UserBlocScreen&gt; { UserBloc _userBloc; @override void initState() { _userBloc = UserBloc(widget._repository); super.initState(); } @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: const Text('Bloc'), ), body: SafeArea( child: StreamBuilder&lt;UserState&gt;( stream: _userBloc.user, initialData: UserInitState(), builder: (context, snapshot) { if (snapshot.data is UserInitState) { return _buildInit(); } if (snapshot.data is UserDataState) { UserDataState state = snapshot.data; return _buildContent(state.user); } if (snapshot.data is UserLoadingState) { return _buildLoading(); } }, ), ), ); } Widget _buildInit() { return Center( child: RaisedButton( child: const Text('Load user data'), onPressed: () { _userBloc.loadUserData(); }, ), ); } Widget _buildContent(User user) { return Center( child: Text('Hello ${user.name} ${user.surname}'), ); } Widget _buildLoading() { return const Center( child: CircularProgressIndicator(), ); } @override void dispose() { _userBloc.dispose(); super.dispose(); } }</code> </pre> <br><p> ä¸å‰é¢çš„ç¤ºä¾‹ç›¸æ¯”ï¼Œ <code>UserBlocScreen</code>ä»£ç å˜å¾—æ›´åŠ ç®€å•ã€‚ è¦å¬çŠ¶æ€æ›´æ”¹çš„å˜åŒ–ï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">StreamBuilder</a> ã€‚  <code>StreamBuilder</code>æ˜¯ä¸€ä¸ª<code>StatefulWidget</code> ï¼Œå®ƒåŸºäºä¸<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Stream</a>äº¤äº’çš„æœ€æ–°å¿«ç…§æ„å»ºè‡ªèº«ã€‚ </p><br><h3 id="pros-2"> ä¼˜ç‚¹ </h3><br><p> æ— éœ€ç¬¬ä¸‰æ–¹åº“ã€‚ <br> ä¸šåŠ¡é€»è¾‘ï¼ŒçŠ¶æ€ç®¡ç†å’ŒUIé€»è¾‘åˆ†ç¦»ã€‚ <br> å®ƒæ˜¯ååº”æ€§çš„ã€‚ ä¸éœ€è¦åƒScoped Modelçš„<code>notifyListeners()</code>é‚£æ ·çš„å…¶ä»–è°ƒç”¨ã€‚ </p><br><h3 id="cons-1"> ç¼ºç‚¹ </h3><br><p> éœ€è¦å…·æœ‰ä½¿ç”¨æµæˆ–rxdartçš„ç»éªŒã€‚ </p><br><h2 id="links"> å‹æƒ…é“¾æ¥ </h2><br><p> æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»æ­¤githubå­˜å‚¨åº“ä¸­</a>æ£€å‡ºä»¥ä¸Šç¤ºä¾‹çš„æºä»£ç <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ã€‚</a> </p><br><p> æœ€åˆæ–‡ç« å‘è¡¨åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Medium</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN438524/">https://habr.com/ru/post/zh-CN438524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN438512/index.html">éœå¤«æ›¼æ•°æ®å‹ç¼©</a></li>
<li><a href="../zh-CN438514/index.html">æˆ‘å¦‚ä½•åœ¨Sberbankå‘†äº†ä¸€å¹´</a></li>
<li><a href="../zh-CN438516/index.html">ä½•æ—¶å°†æ•°ç»„çš„é•¿åº¦ä¿å­˜åˆ°Cï¼ƒä¸­çš„å±€éƒ¨å˜é‡ä¸­</a></li>
<li><a href="../zh-CN438518/index.html">åˆ›å»ºæ‚¨çš„jsfiddleï¼Œç¬¬2éƒ¨åˆ†</a></li>
<li><a href="../zh-CN438522/index.html">æˆ˜ç•¥å‡è¡¡å™¨</a></li>
<li><a href="../zh-CN438526/index.html">äººå·¥ç¥ç»ç½‘ç»œåƒå¤§è„‘ä¸€æ ·ç”Ÿé•¿å¯¼èˆªç»†èƒ</a></li>
<li><a href="../zh-CN438530/index.html">æ—¶é«¦æ’­å®¢ï¼ƒ1</a></li>
<li><a href="../zh-CN438534/index.html">ä¿„ç½—æ–¯å¾®æ§åˆ¶å™¨K1986BE92QIä¸Šçš„Modbus</a></li>
<li><a href="../zh-CN438536/index.html">èŠå¤©æœºå™¨äººçš„å†…å¹•ï¼šRocketBotå¯ä»¥åšä»€ä¹ˆä»¥åŠå¦‚ä½•å·¥ä½œ</a></li>
<li><a href="../zh-CN438538/index.html">Teamlead Conf 2019 Mskï¼šå…³äºå¦ä¸€ç§é€šè®¯æ ¼å¼</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>