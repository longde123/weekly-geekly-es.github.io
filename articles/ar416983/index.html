<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ต ๐บ ๐ ุฅูุดุงุก ุชุธููู ุงูููุงู ุงููุฑุชูู ููููุจ. ุงูุฌุฒุก 2 ๐จ๐ฟโ๐ ๐๏ธ ๐ฉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุงูุฌุฒุก ุงูุฃูู ุ ูุธุฑูุง ูู ุฅุนุฏุงุฏ ุงูุจูุฆุฉ ูุณุทุญ ุงููุงุก. ูู ูุฐุง ุงูุฌุฒุก ุ ุณูุนุทู ุงูุทูู ููุฃุฌุณุงู ุ ููุถูู ุฎุทูุท ูุงุฆูุฉ ุนูู ุงูุณุทุญ ูููุดุฆ ุฎุทูุทูุง ุฑุบููุฉ ุจูุฎุฒู ุนูู ุญูู ุญุฏ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฅูุดุงุก ุชุธููู ุงูููุงู ุงููุฑุชูู ููููุจ. ุงูุฌุฒุก 2</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416983/" style=";text-align:right;direction:rtl"> ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก ุงูุฃูู ุ</a> ูุธุฑูุง ูู ุฅุนุฏุงุฏ ุงูุจูุฆุฉ ูุณุทุญ ุงููุงุก.  ูู ูุฐุง ุงูุฌุฒุก ุ ุณูุนุทู ุงูุทูู ููุฃุฌุณุงู ุ ููุถูู ุฎุทูุท ูุงุฆูุฉ ุนูู ุงูุณุทุญ ูููุดุฆ ุฎุทูุทูุง ุฑุบููุฉ ุจูุฎุฒู ุนูู ุญูู ุญุฏูุฏ ุงูุฃุฌุณุงู ุงููุชูุงุทุนุฉ ูุน ุงูุณุทุญ. <br><br>  ูุฌุนู ุงููุดูุฏ ูุจุฏู ุฃูุถู ููููุงู ุ ุฃุฌุฑูุช ุชุบููุฑุงุช ุทูููุฉ ุนููู.  ููููู ุชุฎุตูุต ุงููุดูุฏ ุงูุฎุงุต ุจู ุจุงูุทุฑููุฉ ุงูุชู ุชุฑูุฏูุง ุ ููููู ูุนูุช ูุง ููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุงุฐุฌ ูุถุงูุฉ ูููุงุฑุฉ ูุฃุฎุทุจูุท. </li><li style=";text-align:right;direction:rtl"> ุชูุช ุฅุถุงูุฉ ูููุฐุฌ ุฃุฑุถู ุจููู <code>#FFA457</code> . </li><li style=";text-align:right;direction:rtl">  ุชูุช ุฅุถุงูุฉ ููู <code>#6CC8FF</code> . </li><li style=";text-align:right;direction:rtl">  ุชูุช ุฅุถุงูุฉ ููู ุงูุฅุถุงุกุฉ ุงูุฎูููุฉ <code>#FFC480</code> ุฅูู ุงููุดูุฏ (ูููู ุงูุนุซูุฑ ุนูู ูุฐู ุงููุนููุงุช ูู ุฅุนุฏุงุฏุงุช ุงููุดูุฏ). </li></ul><br>  ูุจุฏู ุงููุดูุฏ ุงูุฃุตูู ุงูุขู ูุซู ูุฐุง. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/bc2/2fa/0d5/bc22fa0d57b5120e75cced6f105bebd2.png"></div><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ุงูุทูู </h2><br>  ุฃุณูู ุทุฑููุฉ ูุฅูุดุงุก ุงูุทูู ูู ุงุณุชุฎุฏุงู ุจุฑูุงูุฌ ูุตู ูุฏูุน ุงูุฃุดูุงุก ูุฃุนูู ููุฃุณูู.  ูู ุจุฅูุดุงุก ุจุฑูุงูุฌ ูุตู <strong>Buoyancy.js</strong> ุฌุฏูุฏ ููู ุจุชุนููู ูุง ููู ูู ุงูุชููุฆุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">Buoyancy.prototype.initialize = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.initialPosition = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entity.getPosition().clone(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.initialRotation = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entity.getEulerAngles().clone(); <span class="hljs-comment"><span class="hljs-comment">//     ,  //        //     this.time = Math.random() * 2 * Math.PI; };</span></span></code> </pre> <br>  ุงูุขู ูู ุงูุชุญุฏูุซ ูููู ุจุชุดุบูู ุฒูุงุฏุฉ ุงูููุช ูุชุฏููุฑ ุงููุงุฆู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">Buoyancy.prototype.update = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dt</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.time += <span class="hljs-number"><span class="hljs-number">0.1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      var pos = this.entity.getPosition().clone(); pos.y = this.initialPosition.y + Math.cos(this.time) * 0.07; this.entity.setPosition(pos.x,pos.y,pos.z); //    var rot = this.entity.getEulerAngles().clone(); rot.x = this.initialRotation.x + Math.cos(this.time * 0.25) * 1; rot.z = this.initialRotation.z + Math.sin(this.time * 0.5) * 2; this.entity.setLocalEulerAngles(rot.x,rot.y,rot.z); };</span></span></code> </pre> <br>  ุชุทุจูู ูุฐุง ุงูุจุฑูุงูุฌ ุงููุตู ุนูู ุงููุงุฑุจ ููุฑู ููู ูููุฒ ุตุนูุฏุง ููุจูุทุง ูู ุงููุงุก!  ููููู ุชุทุจูู ูุฐุง ุงูุจุฑูุงูุฌ ุงููุตู ุนูู ุนุฏุฉ ูุงุฆูุงุช (ุจูุง ูู ุฐูู ุงููุงููุฑุง - ุฌุฑุจูุง)! <br><br><h2 style=";text-align:right;direction:rtl">  ูุณูุฌ ุงูุณุทุญ </h2><br>  ุจูููุง ูููููุง ุฑุคูุฉ ุงูุฃููุงุฌ ุ ููุธุฑ ุฅูู ุญูุงู ุณุทุญ ุงููุงุก.  ุฅุถุงูุฉ ูุงุฏุฉ ุณุชุฌุนู ุญุฑูุฉ ุงูุณุทุญ ุฃูุซุฑ ูุถูุญูุง.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููู ุทุฑููุฉ ููุฎูุถุฉ ุงูุชูููุฉ ููุญุงูุงุฉ ุงูุงูุนูุงุณุงุช ูุงูููุงุฏ ุงููุงููุฉ. <br><br>  ููููู ูุญุงููุฉ ุงูุนุซูุฑ ุนูู ุจุนุถ ุงูููุงุฏ ุงููุงููุฉ ุฃู ุฅูุดุงุก ูุงุญุฏ ุจููุณู.  ููุฏ ุฑุณูุช ูุณูุฌูุง ูู Gimp ููููู ุงุณุชุฎุฏุงูู ุจุญุฑูุฉ.  ุฃู ูุณูุฌ ููุงุณุจ ุ ุจุดุฑุท ุฃูู ูููู ุชุฌุงูุจู ุจุฏูู ููุงุตู ููุญูุธุฉ. <br><br>  ุจุนุฏ ุงุฎุชูุงุฑ ุงููุณูุฌ ุงูุฐู ุชุฑูุฏู ุ ุงุณุญุจู ุฅูู ูุงูุฐุฉ ุงูุฃุตูู ูู ูุดุฑูุนู.  ูุญุชุงุฌ ุฅูู ุงูุฅุดุงุฑุฉ ุฅูู ูุฐุง ุงููุณูุฌ ูู ุงูุจุฑูุงูุฌ ุงููุตู Water.js ุ ูุฐูู ุฏุนููุง ููุดุฆ ุณูุฉ ูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">Water.attributes.add(<span class="hljs-string"><span class="hljs-string">'surfaceTexture'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'asset'</span></span>, <span class="hljs-attr"><span class="hljs-attr">assetType</span></span>: <span class="hljs-string"><span class="hljs-string">'texture'</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Surface Texture'</span></span> });</code> </pre> <br>  ุซู ูู ุจุชุนูููู ูู ุงููุญุฑุฑ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/672/61e/32f/67261e32f145eda9dab99d1866181ced.png"></div><br>  ุงูุขู ูุญู ุจุญุงุฌุฉ ูุชูุฑูุฑูุง ุฅูู ุชุธููู.  ุงูุชูู ุฅูู <strong>Water.js</strong> ููู ุจุชุนููู ุฏุงูุฉ <code>CreateWaterMaterial</code> ูุนููุฉ ุฌุฏูุฏุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">material.setParameter(<span class="hljs-string"><span class="hljs-string">'uSurfaceTexture'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.surfaceTexture.resource);</code> </pre> <br>  ุนุฏ ุงูุขู ุฅูู <strong>Water.frag</strong> ูุฃุนูู ุนู ุฒู ุฌุฏูุฏ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">uniform sampler2D uSurfaceTexture;</code> </pre> <br>  ููุฏ ุงูุชูููุง ุชูุฑูุจุง.  ูุชูุฏูู ูุณูุฌ ุนูู ูุณุชูู ุ ูุญุชุงุฌ ุฅูู ูุนุฑูุฉ ููุงู ูู ุจูุณู ูู ุงูุดุจูุฉ.  ุฃู ุฃููุง ุจุญุงุฌุฉ ุฅูู ููู ุงูุจูุงูุงุช ูู ุฌูุงุฒ ุชุธููู ุงูุฑุฃุณ ุฅูู ุงูุฌุฒุก. <br><br><h3 style=";text-align:right;direction:rtl">  ูุชุบูุฑุงุช ูุชุบูุฑุฉ </h3><br>  ุชุณูุญ ูู ุงููุชุบูุฑุงุช ุงููุชุบูุฑุฉ ุจููู ุงูุจูุงูุงุช ูู ุชุธููู ุงูุฑุฃุณ ุฅูู ุงูุฌุฒุก.  ูุฐุง ูู ุงูููุน ุงูุซุงูุซ ูู ุงููุชุบูุฑุงุช ุงูุฎุงุตุฉ ุงูุชู ูููู ุงุณุชุฎุฏุงููุง ูู ุงูุชุธููู (ุงูุฃููุงู <em>ูุชุฌุงูุณุงู</em> <em>ูุณูุฉ</em> ).  ูุชู ุชุนููู ูุชุบูุฑ ููู ููุฉ ููููู ููู ุจูุณู ุงููุตูู ุฅููู.  ูุธุฑูุง ููุฌูุฏ ุนุฏุฏ ุฃูุจุฑ ุจูุซูุฑ ูู ูุญุฏุงุช ุงูุจูุณู ูู ุงูููู ุ ูุชู ุฅูุญุงู ุงููููุฉ ุจูู ุงูููู (ููู ููุง ูุฃุชู ุงุณู "ูุชุบูุฑ" - ููู ููุญุฑู ุนู ุงูููู ุงูุชู ูุชู ุชูุฑูุฑูุง ุฅููู). <br><br>  ูุงุฎุชุจุงุฑู ูู ุงูุชุดุบูู ุ ุฃุนูู ุนู ูุชุบูุฑ ุฌุฏูุฏ ูู <strong>Water.vert ุนูู</strong> ุฃูู ูุชุบูุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">varying vec2 ScreenPosition;</code> </pre> <br>  ุซู ูู ุจุชุนููู ุงููููุฉ <code>gl_Position</code> ุจุนุฏ ุญุณุงุจูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">ScreenPosition = gl_Position.xyz;</code> </pre> <br>  ุงูุขู ุนุฏูุง ุฅูู <strong>Water.frag</strong> ูุฃุนูู ููุณ ุงููุชุบูุฑ.  ูุง ูููููุง ุงูุญุตูู ุนูู ุฅุฎุฑุงุฌ ุจูุงูุงุช ุชุตุญูุญ ุงูุฃุฎุทุงุก ูู ุฌูุงุฒ ุชุธููู ุ ูููู ูููููุง ุงุณุชุฎุฏุงู ุงูููู ูุชุตุญูุญ ุงูุฃุฎุทุงุก ุงูุจุตุฑูุฉ.  ุฅููู ููููุฉ ุงูููุงู ุจุฐูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">uniform sampler2D uSurfaceTexture; varying vec3 ScreenPosition; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { vec4 color = vec4(<span class="hljs-number"><span class="hljs-number">0.0</span></span>,<span class="hljs-number"><span class="hljs-number">0.7</span></span>,<span class="hljs-number"><span class="hljs-number">1.0</span></span>,<span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    varying- color = vec4(vec3(ScreenPosition.x),1.0); gl_FragColor = color; }</span></span></code> </pre> <br>  ูุฌุจ ุฃู ูุจุฏู ุงููุณุชูู ุงูุขู ุจุงูููููู ุงูุฃุจูุถ ูุงูุฃุณูุฏ ุ ูุณูุฐูุจ ุฎุท ุชูุณูู ุงูููู ุญูุซ <code>ScreenPosition.x</code> = 0. ุชุชุบูุฑ ููู ุงูููู ููุท ูู 0 ุฅูู 1 ุ ูููู ุงูููู ุงูููุฌูุฏุฉ ูู <code>ScreenPosition</code> ูููู ุฃู ุชููู ุฎุงุฑุฌ ูุฐุง ุงููุงุตู ุงูุฒููู.  ูุชู ุชูููุฏูุง ุชููุงุฆููุง ุ ูุฐูู ุ ุนูุฏูุง ุชุฑู ุงูููู ุงูุฃุณูุฏ ุ ูููู ุฃู ูููู 0 ุฃู ุฑูููุง ุณูุจููุง. <br><br>  ูุง ูููุง ุจู ููุชู ูู ุชูุฑูุฑ ููุถุน ุงูุดุงุดุฉ ููู ููุฉ ุฅูู ูู ุจูุณู.  ููููู ุฃู ุชุฑู ุฃู ุงูุฎุท ุงูุฐู ููุตู ุจูู ุงูุฌุงูุจูู ุงูุฃุณูุฏ ูุงูุฃุจูุถ ุณููุฑ ุฏุงุฆููุง ูู ูุณุท ุงูุดุงุดุฉ ุ ุจุบุถ ุงููุธุฑ ุนู ููุงู ุงูุณุทุญ ุงููุนูู ูู ุงูุนุงูู. <br><br><blockquote style=";text-align:right;direction:rtl">  <em>ุงููููุฉ 1: ูู ุจุฅูุดุงุก ูุชุบูุฑ ูุชุบูุฑ ุฌุฏูุฏ ูููู ุงููููุน ูู ุงูุนุงูู ุจุฏูุงู ูู ููุถุน ุงูุดุงุดุฉ.</em>  <em>ุชุตูุฑ ุฐูู ุจููุณ ุงูุทุฑููุฉ.</em>  <em>ุฅุฐุง ูู ูุชุบูุฑ ุงูููู ูุน ุญุฑูุฉ ุงููุงููุฑุง ุ ูุณูุชู ูู ุดูุก ุจุดูู ุตุญูุญ.</em> </blockquote><br><h3 style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="external">ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ</a> ูู ุงูุฅุญุฏุงุซูุงุช ุซูุงุฆูุฉ ุงูุฃุจุนุงุฏ ููู ููุฉ ูู ุงูุดุจูุฉ ุ ููุชู ุชุทุจูุนูุง ูู 0 ุฅูู 1. ููู ุถุฑูุฑูุฉ ูุฃุฎุฐ ุงูุนููุงุช ุงูุตุญูุญุฉ ูู ุงููุณูุฌ ุฅูู ุงููุณุชูู ุ ููุฏ ูููุง ุจุงููุนู ุจุชูููููุง ูู ุงูุฌุฒุก ุงูุณุงุจู. <br><br>  <strong>ุณูุนูู ุนู</strong> ุณูุฉ ุฌุฏูุฏุฉ ูู <strong>Water.vert</strong> (ูุฐุง ุงูุงุณู ูุฃุฎูุฐ ูู ุชุนุฑูู shader ูู Water.js): <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">attribute vec2 aUv0;</code> </pre> <br>  ูุงูุขู ูุญุชุงุฌ ููุท ุฅูู ุชูุฑูุฑูุง ุฅูู ุฌูุงุฒ ุชุธููู ุงูุฃุฌุฒุงุก ุ ูุฐุง ูู ููุท ุจุฅูุดุงุก ูุชุบูุฑ ูุชุนููู ูููุฉ ุงูุณูุฉ ูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  Water.vert //        varying vec2 vUv0; // .. //        //  varying,        vUv0 = aUv0;</span></span></code> </pre> <br>  ุงูุขู ุณูุนูู ููุณ ุงููุชุบูุฑ ุงููุชุบูุฑ ูู ุชุธููู ุงูุดุธูุฉ.  ููุชุฃูุฏ ูู ุฃู ูู ุดูุก ูุนูู ุ ูููููุง ุชุตูุฑ ุงูุชุตุญูุญ ููุง ูุงู ูู ูุจู ุ ููู ุซู ุณุชุจุฏู Water.frag ุนูู ุงููุญู ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">uniform sampler2D uSurfaceTexture; varying vec2 vUv0; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { vec4 color = vec4(<span class="hljs-number"><span class="hljs-number">0.0</span></span>,<span class="hljs-number"><span class="hljs-number">0.7</span></span>,<span class="hljs-number"><span class="hljs-number">1.0</span></span>,<span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  UV color = vec4(vec3(vUv0.x),1.0); gl_FragColor = color; }</span></span></code> </pre> <br>  ูู ุงูููุชุฑุถ ุฃู ุชุฑู ุชุฏุฑุฌูุง ูุคูุฏ ุฃู ูุฏููุง ูููุฉ 0 ูู ุฌูุฉ ููุงุญุฏุฉ ูู ุฌูุฉ ุฃุฎุฑู.  ุงูุขู ูุชุฌุฑุจุฉ ุงููููุณ ุจุดูู ุญูููู ุ ูู ูุง ุนูููุง ุงูููุงู ุจู ูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">color = texture2D(uSurfaceTexture,vUv0);</code> </pre> <br>  ุจุนุฏ ุฐูู ุ ุณูุฑู ุงููููุณ ุนูู ุงูุณุทุญ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f49/9bf/ae2/f499bfae266b0aa16709bbea0280df6f.png"></div><br><h3 style=";text-align:right;direction:rtl">  ุชุตููู ุงููููุณ </h3><br>  ุจุฏูุงู ูู ูุฌุฑุฏ ุชุนููู ุงููุณูุฌ ูููู ุฌุฏูุฏ ุ ุฏุนูุง ูุฌูุนู ูุน ุงูููู ุงูุฃุฒุฑู ุงูุญุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">uniform sampler2D uSurfaceTexture; varying vec2 vUv0; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { vec4 color = vec4(<span class="hljs-number"><span class="hljs-number">0.0</span></span>,<span class="hljs-number"><span class="hljs-number">0.7</span></span>,<span class="hljs-number"><span class="hljs-number">1.0</span></span>,<span class="hljs-number"><span class="hljs-number">0.5</span></span>); vec4 WaterLines = texture2D(uSurfaceTexture,vUv0); color.rgba += WaterLines.r; gl_FragColor = color; }</code> </pre> <br>  ูุนูู ูุฐุง ูุฃู ููู ุงููููุณ ุฃุณูุฏ (0) ูู ูู ููุงู ุจุงุณุชุซูุงุก ุฎุทูุท ุงูููุงู.  ุจุฅุถุงูุชู ุ ูุง ูุบูุฑ ุงูููู ุงูุฃุฒุฑู ุงูุฃููู ุ ุจุงุณุชุซูุงุก ุงูุฃูุงูู ุฐุงุช ุงูุฎุทูุท ุงูุชู ุชุตุจุญ ุฃูุชุญ. <br><br>  ููุน ุฐูู ุ ูุฐู ููุณุช ุงูุทุฑููุฉ ุงููุญูุฏุฉ ูุฏูุฌ ุงูุฃููุงู. <br><br><blockquote style=";text-align:right;direction:rtl">  <em>ุงููููุฉ 2: ูู ููููู ุฏูุฌ ุงูุฃููุงู ููุญุตูู ุนูู ุงูุชุฃุซูุฑ ุงูุฃุถุนู ุงูููุถุญ ุฃุฏูุงูุ</em> </blockquote><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a3d/e18/22a/a3de1822a348656f47e5bd6cfa6cbed5.png"></div><br><h3 style=";text-align:right;direction:rtl">  ุชุญุฑูู ุงููููุณ </h3><br>  ูุชุฃุซูุฑ ููุงุฆู ุ ูุฑูุฏ ุฃู ุชุชุญุฑู ุงูุฎุทูุท ุนูู ุทูู ุงูุณุทุญ ููุง ุชุจุฏู ุซุงุจุชุฉ ุฌุฏูุง.  ููููุงู ุจุฐูู ุ ุณูู ูุณุชููุฏ ูู ุญูููุฉ ุฃู ุฃู ูููุฉ ุฎุงุฑุฌ ุงููุงุตู ุงูุฒููู ูู 0 ุฅูู 1 ุ ุชู ุชูุฑูุฑูุง ุฅูู ุฏุงูุฉ <code>texture2D</code> ุ ุณูุชู ููููุง (ุนูู ุณุจูู ุงููุซุงู ุ ูู ูู 1.5 ู 2.5 ุชุตุจุญ ูุณุงููุฉ ูู 0.5).  ูุฐูู ุ ูููููุง ุฒูุงุฏุฉ ููุถุนูุง ูู ุฎูุงู ุงููุชุบูุฑ ุงูุฒููู ุงูููุญุฏ ุงูุฐู ุญุฏุฏูุงู ุจุงููุนู ูุฒูุงุฏุฉ ุฃู ุชูููู ูุซุงูุฉ ุงูุฎุทูุท ุนูู ุงูุณุทุญ ุ ูุงูุชู ุณุชุนุทู ุดุธูุฉ ุงูุฌุฒุก ุงูููุงุฆู ูุฐุง ุงูุดูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">uniform sampler2D uSurfaceTexture; uniform float uTime; varying vec2 vUv0; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { vec4 color = vec4(<span class="hljs-number"><span class="hljs-number">0.0</span></span>,<span class="hljs-number"><span class="hljs-number">0.7</span></span>,<span class="hljs-number"><span class="hljs-number">1.0</span></span>,<span class="hljs-number"><span class="hljs-number">0.5</span></span>); vec2 pos = vUv0; <span class="hljs-comment"><span class="hljs-comment">//      1 //     pos *= 2.0; //   ,      pos.y += uTime * 0.02; vec4 WaterLines = texture2D(uSurfaceTexture,pos); color.rgba += WaterLines.r; gl_FragColor = color; }</span></span></code> </pre> <br><h2 style=";text-align:right;direction:rtl">  ุฎุทูุท ุงูุฑุบูุฉ ูุนุงุฒู ุงูุนูู </h2><br>  ุฅู ุฌุนู ุฎุทูุท ุงูุฑุบูุฉ ุญูู ุงูุฃุดูุงุก ูู ุงููุงุก ูุฌุนู ูู ุงูุฃุณูู ุจูุซูุฑ ุฑุคูุฉ ูุฏู ุบูุฑ ุงูุฃุฌุณุงู ูุฃูู ุชุชูุงุทุน ูุน ุงูุณุทุญ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุชุตุจุญ ููุงููุง ุจูุฐู ุงูุทุฑููุฉ ุฃูุซุฑ ุชุตุฏูููุง.  ูุชุญููู ุฎุทูุท ุงูุฑุบูุฉ ุ ูุญุชุงุฌ ุฅูู ุญุฏ ูุง ุฅูู ูุนุฑูุฉ ููุงู ุญุฏูุฏ ูู ูุงุฆู ุ ูุงูููุงู ุจุฐูู ุจุดูู ูุนุงู. <br><br><h3 style=";text-align:right;direction:rtl">  ุฎุฏุนุฉ </h3><br>  ูุญู ุจุญุงุฌุฉ ุฅูู ูุนุฑูุฉ ููููุฉ ุชุญุฏูุฏ ูุง ุฅุฐุง ูุงูุช ุงูุจูุณู ุนูู ุณุทุญ ุงููุงุก ูุฑูุจุฉ ูู ุงูุฌุณู.  ุฅุฐุง ูุงู ุงูุฃูุฑ ูุฐูู ุ ููููููุง ุทูุงุฆู ุจููู ุงูุฑุบูุฉ.  ูุง ุชูุฌุฏ ุทุฑู ุจุณูุทุฉ ูุญู ูุฐู ุงููุดููุฉ (ุนูู ุญุฏ ุนููู).  ูุฐูู ุ ูุญููุง ุ ุฃุณุชุฎุฏู ุชูููุฉ ูููุฏุฉ ูุญู ุงููุดุงูู: ุณุขุฎุฐ ูุซุงููุง ูุนุฑู ุงูุฅุฌุงุจุฉ ุนูู ููุฑู ูุง ุฅุฐุง ูุงู ุจุฅููุงููุง ุชุนูููู. <br><br>  ุฃูู ูุธุฑุฉ ุนูู ุงูุตูุฑุฉ ุฃุฏูุงู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/4d0/0e7/eec/4d00e7eec8714a365c110aea67df9fab.png"></div><br>  ูุง ูู ุงูุจูุณูุงุช ุงูุชู ูุฌุจ ุฃู ุชููู ุฌุฒุกูุง ูู ุงูุฑุบูุฉุ  ูุญู ูุนูู ุฃูู ูุฌุจ ุฃู ูุจุฏู ุดูุก ูุซู ูุฐุง: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/1a8/541/c4f/1a8541c4f8fdd65879966b909805c484.png"></div><br>  ูุฐูู ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ูุญุฏุชู ุจูุณู ูุญุฏุฏุชูู.  ุฃุฏูุงู ููุช ุจุชูููุฒูุง ุจุนูุงูุงุช ูุฌููุฉ.  ุณูููู ุงูุฃุณูุฏ ุนูู ุงูุฑุบูุฉ ุ ููู ูููู ุงูุฃุญูุฑ.  ููู ูููุฒูู ูู ุชุธูููุ <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/012/d35/fb2/012d35fb25d42c19a86adaa081048237.png"></div><br>  ูุญู ูุนูู ุฃูู ุนูู ุงูุฑุบู ูู ุฃู ูุฐูู ุงูุจููุณููู ูู ูุณุงุญุฉ ุงูุดุงุดุฉ ูุฑูุจุงู ูู ุจุนุถููุง ุงูุจุนุถ (ููุงููุง ูุธูุฑุงู ุฃุนูู ุงูููุงุฑุฉ) ุ ุฅูุง ุฃูููุง ูู ุงููุงูุน ุจุนูุฏุงู ุฌุฏูุง ูู ูุณุงุญุฉ ุงูุนุงูู.  ูููููุง ุงูุชุญูู ูู ุฐูู ูู ุฎูุงู ุงููุธุฑ ุฅูู ููุณ ุงููุดูุฏ ูู ุฒุงููุฉ ูุฎุชููุฉ. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/cd3/5a0/31b/cd35a031bbd18805128ebd44ed1c1279.png"></div><br>  ูุงุญุธ ุฃู ุงููุฌู ุงูุฃุญูุฑ ููุณ ููุฌูุฏูุง ูู ุงูููุงุฑุฉ ุ ููุง ุจุฏุง ููุง ุ ููู ุงููุฌู ุงูุฃุณูุฏ ููุฌูุฏ ุจุงููุนู.  ูููููุง ุงูุชูููุฒ ุจูู ุงุณุชุฎุฏุงู ุงููุณุงูุฉ ุฅูู ุงููุงููุฑุง ุ ูุงูุชู ุชุณูู ุนุงุฏุฉู "ุงูุนูู".  ุงูุนูู 1 ูุนูู ุฃู ุงูููุทุฉ ูุฑูุจุฉ ุฌุฏูุง ูู ุงููุงููุฑุง ุ ูุงูุนูู 0 ูุนูู ุฃููุง ุจุนูุฏุฉ ุฌุฏูุง.  ูููู ูุฐู ููุณุช ูุณุฃูุฉ ูุณุงูุงุช ูุทููุฉ ูู ุงูุนุงูู ุฃู ุงูุนูู ุฃู ุงููุงููุฑุง.  ุงูุนูู <em>ุจุงููุณุจุฉ ููุจูุณู ูุฑุงุกู</em> ููู. <br><br>  ุงูุธุฑ ูุฑุฉ ุฃุฎุฑู ุฅูู ุงูุนุฑุถ ุงูุฃูู.  ูููุชุฑุถ ุฃู ูููู ุงูููุงุฑุฉ ูู ูููุฉ ุนูู 0.5.  ุนูู ุงููุฌู ุงูุฃุณูุฏ ุณูููู ูุฑูุจูุง ุฌุฏูุง ูู 0.5.  ุฃู ุฃููุง ูุจูุณู ุชุญุชูุง ููุง ููู ุนูู ูุฑูุจุฉ ุฌุฏูุง.  ูู ูุงุญูุฉ ุฃุฎุฑู ุ ุณูููู ููุนูุงูุฉ ุงููุฌููุฉ ุงูุญูุฑุงุก ุนูู ุฃูุจุฑ ุจูุซูุฑ ุ ูุฃููุง ุฃูุฑุจ ุฅูู ุงููุงููุฑุง ุ ุนูู ุณุจูู ุงููุซุงู 0.7.  ูุนูู ุงูุฑุบู ูู ุฃู ุงูุจูุณู ุงูููุฌูุฏ ุฎูููุง ูุง ูุฒุงู ูู ุงูููุงุฑุฉ ุ ุฅูุง ุฃูู ูุญุชูู ุนูู ูููุฉ ุนูู 0.5 ุ ุฃู ุฃู ููุงู ุงููุฒูุฏ ูู ุงูุงุฎุชูุงู. <br><br>  ูุฐู ูู ุงูุญููุฉ.  <em>ุนูุฏูุง ูููู ุนูู ุงูุจูุณู ุนูู ุณุทุญ ุงููุงุก ูุฑูุจูุง ูู ุนูู ุงูุจูุณู ุงูุฐู ูุชู ุฑุณูู ูููู ุ ูุฅููุง ูุฑูุจูู ุฌุฏูุง ูู ุญุฏูุฏ ุจุนุถ ุงูุฃุดูุงุก</em> ููููููุง ุฃู ูุฌุนู ุงูุจูุณู ูุซู ุงูุฑุบูุฉ. <br><br>  ุฃู ุฃููุง ุจุญุงุฌุฉ ุฅูู ูุนูููุงุช ุฃูุซุฑ ูู ุฃู ุจูุณู.  ูุญู ุจุญุงุฌุฉ ุจุทุฑููุฉ ูุง ุฅูู ูุนุฑูุฉ ุนูู ุงูุจูุณู ุงูุฐู ูุฌุจ ุฑุณูู ูููู.  ูููุง ุงูุนุงุฒูุฉ ุงูุนูู ูููุฏุฉ ููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุนุงุฒูุฉ ุงูุนูู </h3><br>  ููููู ุงูุชูููุฑ ูู ูุฎุฒู ูุคูุช ููุฅุทุงุฑ ุฃู ูุฎุฒู ูุคูุช ููุฅุทุงุฑ ุนูู ุฃูู ุนุฑุถ ุฃู ูุณูุฌ ูุฏู ุฎุงุฑุฌ ุงูุดุงุดุฉ.  ุนูุฏูุง ูุญุชุงุฌ ุฅูู ูุฑุงุกุฉ ุงูุจูุงูุงุช ุ ูุญุชุงุฌ ุฅูู ุงูุนุฑุถ ุฎุงุฑุฌ ุงูุดุงุดุฉ.  ูุชู ุงุณุชุฎุฏุงู ูุฐู ุงูุชูููุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="external">ุชุฃุซูุฑ ุงูุฏุฎุงู</a> . <br><br>  ุงููุฎุฒู ุงููุคูุช ููุนูู ูู ุนุฑุถ ูุฏู ุฎุงุต ูุญุชูู ุนูู ูุนูููุงุช ุญูู ููู ุนูู ูู ุจูุณู.  ูุง ุชูุณ ุฃู ุงููููุฉ ูู <code>gl_Position</code> ุงููุญุณูุจุฉ ูู ุชุธููู ุงูุฑุฃุณ ูุงูุช ูููุฉ ูุณุงุญุฉ ุงูุดุงุดุฉ ุ ูููู ููุง ุฃูุถูุง <code>gl_Position</code> ุซุงูุซูุง - ูููุฉ Z. ูุชู ุงุณุชุฎุฏุงู ูุฐู ุงููููุฉ ูุญุณุงุจ ุงูุนูู ุ ุงูุฐู ูุชู ูุชุงุจุชู ุฅูู ุงููุฎุฒู ุงููุคูุช ููุนูู. <br><br>  ุชู ุชุตููู ุงููุฎุฒู ุงููุคูุช ููุนูู ูุชูุฏูู ุงูุนุฑุถ ุงูุตุญูุญ ูููุดูุฏ ุฏูู ุงูุญุงุฌุฉ ุฅูู ูุฑุฒ ุงููุงุฆูุงุช ูู ุงูุฎูู ุฅูู ุงูุฃูุงู.  ูููู ูู ุจูุณู ูุชู ุฑุณูู ุฃููุงู ุจูุญุต ุงููุฎุฒู ุงููุคูุช ููุนูู.  ุฅุฐุง ูุงูุช ูููุฉ ุนูููุง ุฃูุจุฑ ูู ุงููููุฉ ุงูููุฌูุฏุฉ ูู ุงููุฎุฒู ุงููุคูุช ุ ูุณูุชู ุฑุณููุง ุ ูุชุณุชุจุฏู ูููุชูุง ุงูุฎุงุตุฉ ุจูุง ูููุฉ ุงููุฎุฒู ุงููุคูุช.  ุฎูุงู ุฐูู ุ ูุชู ุงูุชุฎูุต ููู (ูุฃูู ูุนูู ูุฌูุฏ ูุงุฆู ุขุฎุฑ ุฃูุงูู). <br><br>  ูู ุงููุงูุน ุ ููููู ุชุนุทูู ุงููุชุงุจุฉ ูู ุงููุฎุฒู ุงููุคูุช ููุนูู ูุชุฑู ููู ุณูุจุฏู ูู ุดูุก ุจุฏูููุง.  ุฏุนููุง ูุญุงูู ุงูููุงู ุจุฐูู ูู Water.js: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">material.depthTest = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br>  ุณุชูุงุญุธ ุฃู ุงูููุงู ุณุชุณุญุจ ุฏุงุฆููุง ูู ุงูุฃุนูู ุ ุญุชู ูู ูุงูุช ุฎูู ุฃุฌุณุงู ุบูุฑ ุดูุงูุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุชุตูุฑ ุงููุฎุฒู ุงููุคูุช ุงูุนูู </h3><br>  ุฏุนููุง ูุถูู ุทุฑููุฉ ูุชูุฏูู ุงููุฎุฒู ุงููุคูุช ุงูุนูู ูุฃุบุฑุงุถ ุงูุชุตุญูุญ.  ุฅูุดุงุก ุจุฑูุงูุฌ ูุตู <strong>DepthVisualize.js</strong> ุฌุฏูุฏ.  ูู ุจุชูุตููู ุจุงููุงููุฑุง. <br><br>  ูููุตูู ุฅูู ุงููุฎุฒู ุงููุคูุช ููุนูู ูู PlayCanvas ุ ุงูุชุจ ูุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entity.camera.camera.requestDepthMap();</code> </pre> <br>  ูุฐูู ูููู ุชููุงุฆููุง ุจุถุฎ ุงููุชุบูุฑ ุงูููุญุฏ ูู ุฌููุน ุฃุฌูุฒุฉ ุชุธููููุง ุ ูุงูุชู ูููููุง ุงุณุชุฎุฏุงููุง ุนู ุทุฑูู ุงูุฅุนูุงู ุนููุง ุนูู ุงููุญู ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">uniform sampler2D uDepthMap;</code> </pre> <br>  ููุฌุฏ ุฃุฏูุงู ูุซุงู ูููุต ุงูุจุฑูุฌู ูุทูุจ ุฎุฑูุทุฉ ุชูุตูููุฉ ููุนุฑุถูุง ูู ุฃุนูู ุงููุดูุฏ.  ููุฏ ูุงู ุจุชูููู ุฅุนุงุฏุฉ ุชุดุบูู ุณุงุฎูุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> DepthVisualize = pc.createScript(<span class="hljs-string"><span class="hljs-string">'depthVisualize'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  initialize,       DepthVisualize.prototype.initialize = function() { this.entity.camera.camera.requestDepthMap(); this.antiCacheCount = 0; //    ,         this.SetupDepthViz(); }; DepthVisualize.prototype.SetupDepthViz = function(){ var device = this.app.graphicsDevice; var chunks = pc.shaderChunks; this.fs = ''; this.fs += 'varying vec2 vUv0;'; this.fs += 'uniform sampler2D uDepthMap;'; this.fs += ''; this.fs += 'float unpackFloat(vec4 rgbaDepth) {'; this.fs += ' const vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);'; this.fs += ' float depth = dot(rgbaDepth, bitShift);'; this.fs += ' return depth;'; this.fs += '}'; this.fs += ''; this.fs += 'void main(void) {'; this.fs += ' float depth = unpackFloat(texture2D(uDepthMap, vUv0)) * 30.0; '; this.fs += ' gl_FragColor = vec4(vec3(depth),1.0);'; this.fs += '}'; this.shader = chunks.createShaderFromCode(device, chunks.fullscreenQuadVS, this.fs, "renderDepth" + this.antiCacheCount); this.antiCacheCount ++; //     ,        this.command = new pc.Command(pc.LAYER_FX, pc.BLEND_NONE, function () { pc.drawQuadWithShader(device, null, this.shader); }.bind(this)); this.command.isDepthViz = true; //    ,      this.app.scene.drawCalls.push(this.command); }; //  update,     DepthVisualize.prototype.update = function(dt) { }; //  swap,      //      DepthVisualize.prototype.swap = function(old) { this.antiCacheCount = old.antiCacheCount; //      for(var i=0;i&lt;this.app.scene.drawCalls.length;i++){ if(this.app.scene.drawCalls[i].isDepthViz){ this.app.scene.drawCalls.splice(i,1); break; } } //    this.SetupDepthViz(); }; //      ,  : // http://developer.playcanvas.com/en/user-manual/scripting/</span></span></code> </pre> <br>  ุญุงูู ูุณุฎ ุงูุฑูุฒ ูุงูุชุนููู ุนููู / ุฅูุบุงุก ุชุนููู ุงูุณุทุฑ <code>this.app.scene.drawCalls.push(this.command);</code>  ูุชูููู / ุชุนุทูู ุนุฑุถ ุงูุนูู.  ูุฌุจ ุฃู ุชุจุฏู ูุฐู ุงูุตูุฑุฉ ุฃุฏูุงู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c09/93a/c4f/c0993ac4f8ed7a4c739658bbff69e455.png"></div><br><blockquote style=";text-align:right;direction:rtl">  <em>ุงููููุฉ 3: ูุง ูุชู ุณุญุจ ุณุทุญ ุงููุงุก ุฅูู ุงููุฎุฒู ุงููุคูุช ููุนูู.</em>  <em>ูููู ูุญุฑู PlayCanvas ุจุฐูู ุนู ูุตุฏ.</em>  <em>ูู ููููู ูุนุฑูุฉ ุงูุณุจุจุ</em>  <em>ูุง ุงูุฐู ูููุฒ ููุงุฏ ุงูููุงูุ</em>  <em>ูุจุนุจุงุฑุฉ ุฃุฎุฑู ุ ุจุงููุธุฑ ุฅูู ููุงุนุฏูุง ุงูุฎุงุตุฉ ุจูุญุต ุงูุฃุนูุงู ุ ูุงุฐุง ุณูุญุฏุซ ุฅุฐุง ุชูุช ูุชุงุจุฉ ุจูุณูุงุช ุงูููุงู ุฅูู ุงููุฎุฒู ุงููุคูุช ููุนููุ</em> </blockquote><br>  <em>ุชูููุญ: ููููู ุชุบููุฑ ุณุทุฑ ูุงุญุฏ ูู Water.js ุ ููุง ูุณูุญ ูู ุจูุชุงุจุฉ ุงููุงุก ุฅูู ุงููุฎุฒู ุงููุคูุช ููุนูู.</em> <br><br>  ูุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฃูุถูุง ุฅูู ุฃูู ูู ุฏุงูุฉ ุงูุชููุฆุฉ ุ ุฃููู ุจุถุฑุจ ูููุฉ ุงูุนูู ูู 30. ููุฐุง ุถุฑูุฑู ูุฑุคูุชู ุจูุถูุญ ุ ูุฅูุง ุณูููู ูุทุงู ุงูููู ุตุบูุฑูุง ุฌุฏูุง ูุนุฑุถ ุฏุฑุฌุงุช ุงูุฃููุงู. <br><br><h3 style=";text-align:right;direction:rtl">  ุชูููุฐ ุฎุฏุนุฉ </h3><br>  ููุงู ุงูุนุฏูุฏ ูู ุงููุธุงุฆู ุงููุณุงุนุฏุฉ ูู ูุญุฑู PlayCanvas ููุนูู ุจููู ุงูุนูู ุ ูููู ูู ููุช ูุชุงุจุฉ ูุฐุง ุงูุชูุฑูุฑ ุ ูู ูุชู ุฅุตุฏุงุฑูุง ูู ุงูุฅูุชุงุฌ ุ ูุฐูู ุณูุชุนูู ุนูููุง ุชูููููุง ุจุฃููุณูุง. <br><br>  <strong>ูุญุฏุฏ</strong> ุงููุชุบูุฑุงุช <strong>ุงูููุชุธูุฉ</strong> ุงูุชุงููุฉ ูู <strong>Water.frag</strong> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   uniform-    PlayCanvas uniform sampler2D uDepthMap; uniform vec4 uScreenSize; uniform mat4 matrix_view; //      uniform vec4 camera_params;</span></span></code> </pre> <br>  ูุญุฏุฏ ูุฐู ุงููุธุงุฆู ุงููุณุงุนุฏุฉ ุนูู ุงููุธููุฉ ุงูุฑุฆูุณูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">#ifdef GL2 float linearizeDepth(float z) { z = z * <span class="hljs-number"><span class="hljs-number">2.0</span></span> - <span class="hljs-number"><span class="hljs-number">1.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span> / (camera_params.z * z + camera_params.w); } #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> #ifndef UNPACKFLOAT #define UNPACKFLOAT float unpackFloat(vec4 rgbaDepth) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> vec4 bitShift = vec4(<span class="hljs-number"><span class="hljs-number">1.0</span></span> / (<span class="hljs-number"><span class="hljs-number">256.0</span></span> * <span class="hljs-number"><span class="hljs-number">256.0</span></span> * <span class="hljs-number"><span class="hljs-number">256.0</span></span>), <span class="hljs-number"><span class="hljs-number">1.0</span></span> / (<span class="hljs-number"><span class="hljs-number">256.0</span></span> * <span class="hljs-number"><span class="hljs-number">256.0</span></span>), <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-number"><span class="hljs-number">256.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dot(rgbaDepth, bitShift); } #endif #endif float getLinearScreenDepth(vec2 uv) { #ifdef GL2 <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> linearizeDepth(texture2D(uDepthMap, uv).r) * camera_params.y; #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> unpackFloat(texture2D(uDepthMap, uv)) * camera_params.y; #endif } float getLinearDepth(vec3 pos) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -(matrix_view * vec4(pos, <span class="hljs-number"><span class="hljs-number">1.0</span></span>)).z; } float getLinearScreenDepth() { vec2 uv = gl_FragCoord.xy * uScreenSize.zw; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getLinearScreenDepth(uv); }</code> </pre> <br>  ุณูููู ุจุชูุฑูุฑ ูุนูููุงุช ุชุธููู ุนู ุงููุงููุฑุง ูู <strong>Water.js</strong> .  ุงูุตู ูุฐุง ุฅูู ุญูุซ ููููู ุชูุฑูุฑ ุงููุชุบูุฑุงุช ุงูููุญุฏุฉ ุงูุฃุฎุฑู ูุซู uTime: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.camera){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.camera = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.app.root.findByName(<span class="hljs-string"><span class="hljs-string">"Camera"</span></span>).camera; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> camera = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.camera; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n = camera.nearClip; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f = camera.farClip; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> camera_params = [ <span class="hljs-number"><span class="hljs-number">1</span></span>/f, f, (<span class="hljs-number"><span class="hljs-number">1</span></span>-f / n) / <span class="hljs-number"><span class="hljs-number">2</span></span>, (<span class="hljs-number"><span class="hljs-number">1</span></span> + f / n) / <span class="hljs-number"><span class="hljs-number">2</span></span> ]; material.setParameter(<span class="hljs-string"><span class="hljs-string">'camera_params'</span></span>, camera_params);</code> </pre> <br>  ุฃุฎูุฑูุง ุ ูุญุชุงุฌ ุฅูู ููุถุน ูู ุงูุนุงูู ููู ุจูุณู ูุชุธููู ุงูุฃุฌุฒุงุก.  ุนูููุง ุงูุญุตูู ุนููู ูู ุชุธููู ุงูุฑุฃุณ.  ูุฐูู ุ <strong>ุณูุญุฏุฏ</strong> ูุชุบูุฑูุง ูุชุบูุฑูุง ูู <strong>Water.frag</strong> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">varying vec3 WorldPosition;</code> </pre> <br>  ุญุฏุฏ ููุณ ุงููุชุบูุฑ ุงููุชุบูุฑ ูู <strong>Water.vert</strong> .  ุซู ูุนููู ููุถุนูุง ูุดูููุง ูู ุฌูุงุฒ ุชุธููู ุงูุฑุฃุณ ุจุญูุซ ูุจุฏู ุงูุฑูุฒ ุงููุงูู ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">attribute vec3 aPosition; attribute vec2 aUv0; varying vec2 vUv0; varying vec3 WorldPosition; uniform mat4 matrix_model; uniform mat4 matrix_viewProjection; uniform float uTime; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { vUv0 = aUv0; vec3 pos = aPosition; pos.y += cos(pos.z*<span class="hljs-number"><span class="hljs-number">5.0</span></span>+uTime) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> * sin(pos.x * <span class="hljs-number"><span class="hljs-number">5.0</span></span> + uTime); gl_Position = matrix_viewProjection * matrix_model * vec4(pos, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); WorldPosition = pos; }</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ูุฏุฑู ุฎุฏุนุฉ ุญููููุฉ </h3><br>  ุงูุขู ูุญู ุฌุงูุฒูู ุฃุฎูุฑูุง ูุชุทุจูู ุงูุชูููุฉ ุงูููุถุญุฉ ูู ุจุฏุงูุฉ ูุฐุง ุงููุณู.  ูุฑูุฏ ููุงุฑูุฉ ุนูู ุงูุจูุณู ุงูุฐู ูุญู ููู ูุน ุนูู ุงูุจูุณู ุชุญุชู.  ุงูุจูุณู ุงูููุฌูุฏ ูู ุงูุตูุฑุฉ ูุฃุฎูุฐ ูู ููุถุน ูู ุงูุนุงูู ุ ููุชู ุงูุญุตูู ุนูู ุงูุจูุณู ุงูููุฌูุฏ ุชุญุชู ูู ููุถุน ุงูุดุงุดุฉ.  ูุฐูู ุ ูุฃุฎุฐ ูุฐูู ุงูุนูููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">float worldDepth = getLinearDepth(WorldPosition); float screenDepth = getLinearScreenDepth();</code> </pre> <br><blockquote style=";text-align:right;direction:rtl">  <em>ุงููููุฉ 4: ูู ุชููู ุฅุญุฏู ูุฐู ุงูููู ุฃูุจุฑ ูู ุงูุฃุฎุฑู ุฃุจุฏูุง (ุจุงูุชุฑุงุถ deepTest = true).</em>  <em>ูู ููููู ุชุญุฏูุฏ ุฃู ูุงุญุฏุ</em> </blockquote><br>  ูุญู ูุนูู ุฃู ุงูุฑุบูุฉ ุณุชููู ุญูุซ ุชููู ุงููุณุงูุฉ ุจูู ุงููููุชูู ุตุบูุฑุฉ.  ูุฐูู ุ ุฏุนููุง ูุฌุนู ูุฐุง ุงูุงุฎุชูุงู ููู ุจูุณู.  ูู ุจูุตู ูุฐุง ูู ููุงูุฉ ุงูุชุธููู (ููู ุจุฅููุงู ุงูุจุฑูุงูุฌ ุงููุตู ูุชุตูุฑ ุงูุนูู ูู ุงููุณู ุงูุณุงุจู): <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">color = vec4(vec3(screenDepth - worldDepth),<span class="hljs-number"><span class="hljs-number">1.0</span></span>); gl_FragColor = color;</code> </pre> <br>  ููุฌุจ ุฃู ูุจุฏู ุดูุก ูุซู ูุฐุง: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ad2/173/883/ad2173883ebe214bbec6c97921810755.png"></div><br>  ุฃู ุฃููุง ูุฎุชุงุฑ ุจุดูู ุตุญูุญ ุญุฏูุฏ ุฃู ูุงุฆู ูุบููุฑ ูู ุงููุงุก ูู ุงูููุช ุงูุญูููู!  ุจุงูุทุจุน ุ ููููู ููุงุณ ุงููุฑู ูุฌุนู ุงูุฑุบูุฉ ุฃูุซุฑ ุณูููุง ุฃู ุฃูู ุดููุนูุง. <br><br>  ูุฏููุง ุงูุขู ุงูุนุฏูุฏ ูู ุงูุฎูุงุฑุงุช ูุฏูุฌ ูุฐุง ุงููุงุชุฌ ูุน ุณุทุญ ุงููุงุก ูุฅูุดุงุก ุฎุทูุท ุฌูููุฉ ูู ุงูุฑุบูุฉ.  ููููู ุชุฑููุง ุจุชุฏุฑุฌ ุฃู ุงุณุชุฎุฏุงููุง ูุฃุฎุฐ ุนููุงุช ูู ูุณูุฌ ูุฎุชูู ุฃู ุชุนููู ููู ูุนูู ููุง ุฅุฐุง ูุงู ุงููุฑู ุฃูู ูู ุฃู ูุณุงูู ูููุฉ ุญุฏ ูุนููุฉ. <br><br>  ุฃูุซุฑ ูุง ุฃุนุฌุจูู ูู ุชุนููู ููู ูุดุงุจู ูุฎุทูุท ุงูููุงู ุงูุณุงููุฉ ุ ูุฐูู ุชุจุฏู ูุธููุชู ุงูุฑุฆูุณูุฉ ุงูููุงุฆูุฉ ุนูู ุงููุญู ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { vec4 color = vec4(<span class="hljs-number"><span class="hljs-number">0.0</span></span>,<span class="hljs-number"><span class="hljs-number">0.7</span></span>,<span class="hljs-number"><span class="hljs-number">1.0</span></span>,<span class="hljs-number"><span class="hljs-number">0.5</span></span>); vec2 pos = vUv0 * <span class="hljs-number"><span class="hljs-number">2.0</span></span>; pos.y += uTime * <span class="hljs-number"><span class="hljs-number">0.02</span></span>; vec4 WaterLines = texture2D(uSurfaceTexture,pos); color.rgba += WaterLines.r * <span class="hljs-number"><span class="hljs-number">0.1</span></span>; float worldDepth = getLinearDepth(WorldPosition); float screenDepth = getLinearScreenDepth(); float foamLine = clamp((screenDepth - worldDepth),<span class="hljs-number"><span class="hljs-number">0.0</span></span>,<span class="hljs-number"><span class="hljs-number">1.0</span></span>) ; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(foamLine &lt; <span class="hljs-number"><span class="hljs-number">0.7</span></span>){ color.rgba += <span class="hljs-number"><span class="hljs-number">0.2</span></span>; } gl_FragColor = color; }</code> </pre> <br><h2 style=";text-align:right;direction:rtl">  ูุชูุฎูุต </h2><br>  ุงุจุชูุฑูุง ุทูู ุงูุฃุฌุณุงู ุงููุบููุฑุฉ ูู ุงููุงุก ุ ูุทุจููุง ูุณูุฌูุง ูุชุญุฑููุง ุนูู ุงูุณุทุญ ููุญุงูุงุฉ ุงูููุงุฏ ุงููุงููุฉ ุ ูุชุนูููุง ููููุฉ ุงุณุชุฎุฏุงู ุงููุฎุฒู ุงููุคูุช ููุนูู ูุฅูุดุงุก ุฎุทูุท ุฑุบูุฉ ุฏููุงููููุฉ. <br><br>  ูู ุงูุฌุฒุก ุงูุซุงูุซ ูุงูุฃุฎูุฑ ุ ุณูุถูู ุชุฃุซูุฑุงุช ูุง ุจุนุฏ ุงููุนุงูุฌุฉ ููุชุนูู ููููุฉ ุงุณุชุฎุฏุงููุง ูุฎูู ุชุฃุซูุฑ ุงูุชุดููู ุชุญุช ุงููุงุก. <br><br><h2 style=";text-align:right;direction:rtl">  ููุฏ ุงููุตุฏุฑ </h2><br>  ูููู ุงูุนุซูุฑ ุนูู ูุดุฑูุน PlayCanvas ุงูููุงุฆู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="external">ููุง</a> .  ูุญุชูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="external">ูุณุชูุฏุนูุง</a> ุฃูุถูุง ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="external">ูููุฐ ูุดุฑูุน ุชุญุช Three.js</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar416983/">https://habr.com/ru/post/ar416983/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar416963/index.html">ููุง ูุนููุง BelAZ. ุงูุฌุฒุก 2 - ุงูุงุฎุชุจุงุฑุงุช ุงููุนูููุฉ</a></li>
<li><a href="../ar416967/index.html">ููุง ูุนููุง BelAZ. ุงูุฌุฒุก 3 - ุงูุชูููู ุงูููุทุนู</a></li>
<li><a href="../ar416969/index.html">ุงูุชุจุฑูุฑ ุงูุฑูุงุถู ููุซุงุบูุฑุณ ูููููุงุณ ุงูููุณููู</a></li>
<li><a href="../ar416979/index.html">ุณูุฑูู ูููุฑู ุงููุจุฑู: ููู LeSS 2018</a></li>
<li><a href="../ar416981/index.html">ููู ูููู ุซูุงููุฉ ุฃุดุฎุงุต ุจููุงุณ ูุดุฑูุน ุญูููุฉ ุนุงููุฉ. ุชุฌุฑุจุฉ Unsplash</a></li>
<li><a href="../ar416985/index.html">ุฅูู ุฃูุฑุจ ูุงุฆุฉ: ุฃูุถู 10 ุชูุงุฑูุฑ SmartData 2017</a></li>
<li><a href="../ar416987/index.html">ุฌุงุฑุชูุฑ: ุงูุดูุก ุงูุฑุฆูุณู ูู ุณูู IaaS ูู 2018</a></li>
<li><a href="../ar416989/index.html">Festo bionic robots: ุงูุนูุงูุจ ูุงูุฃุฎุทุจูุทุงุช ูู ูุตุงูุน ุงููุณุชูุจูุ</a></li>
<li><a href="../ar416991/index.html">ุชุณุฌูู ุงูููุฏูู ูู ุดุงุดุชู ููุณ ุณุฑุง. ุฅุตุฏุงุฑุงุช ุจุฑุฌุฑ ููุฌ ู ุฃุจุณู</a></li>
<li><a href="../ar416993/index.html">ุชุนุฑูู ุนูู ุตูููุง: ุฑูุจูุช ูุง ูููู ุชูููุฒู ุชูุฑูุจูุง ุนู ุงูุจุดุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>