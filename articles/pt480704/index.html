<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÖ üò™ üíê Fazendo o carregamento de conte√∫do responsivo no site üëßüèæ üôç üë©üèø‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! 

 Estou criando um site para o meu projeto. No site, voc√™ precisa mostrar muitos gifs ao mesmo tempo, cada um pesando muito bem. Se voc√™ mo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fazendo o carregamento de conte√∫do responsivo no site</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480704/">  Ol√° Habr! <br><br>  Estou criando um site para o meu projeto.  No site, voc√™ precisa mostrar muitos gifs ao mesmo tempo, cada um pesando muito bem.  Se voc√™ mostrar tudo de uma vez, a p√°gina ser√° carregada por um per√≠odo muito longo.  Ao mesmo tempo, √© imposs√≠vel fornecer a p√°gina sem GIFs (para que possam ser baixados l√°). <br><br>  Quem estiver interessado em como eu lidei com esse problema, pe√ßo um gato. <br><a name="habracut"></a><br><h2>  Na verdade, o problema </h2><br>  Como eu disse, existem MUITOS gifs no site, bons e diferentes.  Voc√™ pode ver por si mesmo quantos deles: <a href="https://reface.tech/">reface.tech</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/468/0e4/bb9/4680e4bb9c37c109cfbb02929ac29633.jpg" alt="imagem"><br><br>  Assim que vi a vers√£o beta do pouso, tive imediatamente um problema com o carregamento: para alguns usu√°rios, as p√°ginas estavam carregando por um longo tempo.  Para um neg√≥cio s√©rio, √© claro que n√£o √© esse o caso. <br><br>  Era necess√°rio resolver isso de alguma forma.  Era imposs√≠vel sobreviver com a simples compacta√ß√£o sem perdas, pois j√° naquele tempo todo o conte√∫do da m√≠dia j√° havia sido conduzido pelo <a href="https://compressor.io/">compressor.io</a> .  Portanto, era necess√°rio comprimir com perdas e dar GIFs com pior qualidade. <br><br>  Mas divulgar conte√∫do de m√≠dia ruim para usu√°rios com boa Internet √© uma esp√©cie de sacril√©gio.  Portanto, foi decidido determinar de alguma forma a velocidade da sua Internet e dependendo da velocidade para diminuir a qualidade apropriada. <br><br><h2>  N√≥s fazemos um esbo√ßo </h2><br>  Teremos uma matriz com uma descri√ß√£o do conte√∫do da m√≠dia a ser carregada. <br><br>  Um exemplo: <br><br><pre><code class="json hljs">[ { <span class="hljs-attr"><span class="hljs-attr">"large"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0.6211118698120117</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"gifs/control/large/control_1.gif"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"middle"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0.5330495834350586</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"gifs/control/middle/control_1.gif"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"small"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0.4901447296142578</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"gifs/control/small/control_1.gif"</span></span> } } ]</code> </pre> <br>  Aqui, no b√°sico para o grau adequado de qualidade, est√£o o URL e o tamanho do arquivo. <br><br>  Simplesmente: <br><br><ol><li>  Percorra a matriz (ao carregar a p√°gina) </li><li>  Leia o tamanho total carregado para cada grau de qualidade </li><li>  Determine se ele carregar√° tudo em 4 segundos (este √© o per√≠odo que me incomoda pessoalmente) </li></ol><br>  Por conseguinte, √© necess√°rio: <br><br><ol><li>  Vi algum tipo de coisa que criar√° uma matriz para que tudo n√£o conte com canetas (em python) </li><li>  Vi a velocidade da Internet </li></ol><br><h2>  Serrar o medidor de velocidade </h2><br>  Ser√° relativamente simples.  <a href="httpbin.org/stream-bytes/51200">Digitamos</a> na barra de endere√ßo do seu navegador <a href="httpbin.org/stream-bytes/51200">eu.httpbin.org/stream-bytes/51200</a> .  Um arquivo com um comprimento de 51200 bytes √© baixado.  N√≥s o empurramos para n√≥s mesmos em p√∫blico (para medir a velocidade de uma hospedagem). <br><br>  Agora precisamos verificar quanto o arquivo oscila.  Arquivaremos uma fun√ß√£o simples para isso, que retornar√° a velocidade em megabytes por segundo para n√≥s. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> checkDownloadSpeed(baseUrl, fileSizeInBytes) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, _</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> startTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> axios.get(baseUrl).then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> endTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> duration = (endTime - startTime) / <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bytesPerSecond = (fileSizeInBytes / duration); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> megabytesPerSecond = (bytesPerSecond / <span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-number"><span class="hljs-number">1000</span></span>); resolve(megabytesPerSecond); }); }).catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(error); }); }</code> </pre><br>  Ou seja, registramos o hor√°rio de in√≠cio do download, o hor√°rio de t√©rmino, medimos a diferen√ßa e, como sabemos o tamanho do arquivo, simplesmente o dividimos. <br><br>  Agora, escreveremos uma fun√ß√£o que far√° algo nessa velocidade espec√≠fica: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> getNetworkDownloadSpeed() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> baseUrl = process.env.PUBLIC_URL + <span class="hljs-string"><span class="hljs-string">'/51200'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fileSize = <span class="hljs-number"><span class="hljs-number">51200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> speed = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkDownloadSpeed(baseUrl, fileSize); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Network speed: "</span></span> + speed); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (speed.mbps === <span class="hljs-string"><span class="hljs-string">"Infinity"</span></span>) { SpeedMeasure.speed = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SpeedMeasure.speed = speed * <span class="hljs-number"><span class="hljs-number">5</span></span>; } }</code> </pre><br>  Em geral, h√° um problema com este c√≥digo: √© que a velocidade exata da conex√£o n√£o √© determinada devido ao tamanho pequeno do arquivo.  Mas baixar algo mais √© muito caro para n√≥s, ent√£o simplesmente multiplicamos a velocidade resultante por 5. Mesmo com uma margem, n√≥s a aceitamos, porque, na realidade, a velocidade ser√° ainda maior. <br><br>  Agora arquivaremos uma fun√ß√£o que, dependendo da velocidade, reduzir√° a qualidade correspondente: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> getResolution(gifsArray) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> totalSizeLevel1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> totalSizeLevel2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> totalSizeLevel3 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; gifsArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; a &lt; gifsArray[i].length; a++) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> element = gifsArray[i][a]; totalSizeLevel1 += element.small.size; totalSizeLevel2 += element.middle.size; totalSizeLevel3 += element.large.size; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">isNaN</span></span>(SpeedMeasure.speed)) { SpeedMeasure.speed = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timeLevel1 = totalSizeLevel1 / SpeedMeasure.speed; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timeLevel2 = totalSizeLevel2 / SpeedMeasure.speed; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timeLevel3 = totalSizeLevel3 / SpeedMeasure.speed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timeLevel3 &lt; APPROPRIATE_TIME_LIMIT) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"large"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timeLevel2 &lt; APPROPRIATE_TIME_LIMIT) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"middle"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"small"</span></span>; } }</code> </pre><br>  Como a fun√ß√£o que conta a velocidade √© ass√≠ncrona para n√≥s, o SpeedMeasure.speed pode ser zero.  Por padr√£o, acreditamos que a velocidade da conex√£o √© de 1 megabyte por segundo.  Quando a fun√ß√£o calcula a velocidade, apenas renderizamos novamente o cont√™iner. <br><br>  Passamos uma matriz de matrizes para a fun√ß√£o getResolution.  Porque  Como se tivermos v√°rios cont√™ineres na p√°gina, √© mais conveniente transferir o conte√∫do correspondente para cada um deles em uma matriz, mas precisamos considerar a velocidade do download de uma s√≥ vez. <br><br><h2>  Exemplo de uso </h2><br>  Aqui est√° um exemplo de uso (em React): <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> runFunction() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> speedMeasure = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpeedMeasure(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> speedMeasure.getNetworkDownloadSpeed(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.forceUpdate() } componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.runFunction(); } render() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quality = SpeedMeasure.getResolution([ Control.getControlArray(), Health.getHealthArray() ]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div className="app"&gt; &lt;Presentation /&gt; &lt;Control quality={quality} /&gt; &lt;Health quality={quality} /&gt; &lt;/div&gt; ); }</code> </pre><br>  Assim, quando nossa determina√ß√£o de velocidade √© carregada, o cont√™iner ser√° renderizado novamente. <br>  Dentro do cont√™iner (por exemplo, dentro de Control), voc√™ apenas pega o GIF correspondente da matriz (por √≠ndice), obt√©m um objeto por qualidade e obt√©m um link por URL.  Tudo √© simples. <br><br><h2>  Escrevendo um script Python </h2><br>  Agora, precisamos de alguma forma compactar automaticamente os gifs e gerar a matriz com a descri√ß√£o do conte√∫do. <br><br>  Para come√ßar, vamos escrever um script para compacta√ß√£o.  Vamos usar gifsicle.  Para conte√∫do de compacta√ß√£o m√©dia, o n√≠vel de compacta√ß√£o ser√° 80 (em 200), para um recurso muito poderoso ser√° 160. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os GIFS_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//Landingv2/"</span></span> COMPRESSOR_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//gifsicle-static"</span></span> NOT_OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"not_optimized"</span></span> OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"optimized"</span></span> GIF_RESIZED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_not_optimized_resized"</span></span> GIF_COMPRESSED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_compressed"</span></span> COMPRESSION_TYPE = [<span class="hljs-string"><span class="hljs-string">"middle"</span></span>, <span class="hljs-string"><span class="hljs-string">"small"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (root, dirs, files) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(GIFS_DIR, topdown=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(files) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> GIF_RESIZED_DIR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: path = root + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + file <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> compression <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> COMPRESSION_TYPE: final_path = path.replace(GIF_RESIZED_DIR, GIF_COMPRESSED_DIR + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + compression + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + OPTIMIZED_DIR) print(path, final_path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> compression == COMPRESSION_TYPE[<span class="hljs-number"><span class="hljs-number">0</span></span>]: rate = <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: rate = <span class="hljs-number"><span class="hljs-number">160</span></span> os.system(<span class="hljs-string"><span class="hljs-string">"echo 0 &gt; "</span></span> + final_path) os.system(COMPRESSOR_DIR + <span class="hljs-string"><span class="hljs-string">" -O3 --lossy={} -o {} {}"</span></span>.format(rate, final_path, path))</code> </pre><br>  Para tornar os caminhos dos arquivos compreens√≠veis, eis a descri√ß√£o do diret√≥rio de arquivos com gifs: <br><br><ol><li>  NOT_OPTIMIZED_DIR - GIFs n√£o otimizados </li><li>  GIF_RESIZED_DIR - GIFs n√£o otimizados, mas redimensionados de acordo com o tamanho do cont√™iner para eles </li><li>  GIF_COMPRESSED_DIR - GIFs compactados </li></ol><br>  Dentro das pastas, existem pastas com nomes de categorias GIF.  Dentro de uma pasta com uma pasta espec√≠fica cont√©m "grande", "m√©dio" e "pequeno" (nos tipos de arquivos compactados). <br><br>  No script, passamos pelo diret√≥rio com gifs e, para cada arquivo, fazemos dois tipos de compacta√ß√£o, chamando o comando de linha de comando correspondente. <br><br>  Agora vamos ao script para criar uma matriz com informa√ß√µes. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os GIFS_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//Landingv2/"</span></span> COMPRESSOR_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//gifsicle-static"</span></span> NOT_OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"not_optimized"</span></span> OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"optimized"</span></span> GIF_RESIZED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_not_optimized_resized"</span></span> GIF_COMPRESSED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_compressed"</span></span> COMPRESSION_TYPE = [<span class="hljs-string"><span class="hljs-string">"large"</span></span>, <span class="hljs-string"><span class="hljs-string">"middle"</span></span>, <span class="hljs-string"><span class="hljs-string">"small"</span></span>] OUTPUT = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (root, dirs, files) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(GIFS_DIR, topdown=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(files) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> GIF_COMPRESSED_DIR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> NOT_OPTIMIZED_DIR <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root: files.sort() type = root.split(GIFS_DIR)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(GIF_COMPRESSED_DIR)[<span class="hljs-number"><span class="hljs-number">0</span></span>].replace(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) print(type) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> OUTPUT: OUTPUT[type] = [] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(OUTPUT[type]) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: OUTPUT[type].append( { <span class="hljs-string"><span class="hljs-string">"large"</span></span>: { <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">"middle"</span></span>: { <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">"small"</span></span>: { <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } }) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: full_path = root + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + file bytes_size = os.path.getsize(full_path) kilobytes_size = bytes_size / <span class="hljs-number"><span class="hljs-number">1000</span></span> megabytes_size = kilobytes_size / <span class="hljs-number"><span class="hljs-number">1000</span></span> index = int(file.split(<span class="hljs-string"><span class="hljs-string">"_"</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].replace(<span class="hljs-string"><span class="hljs-string">".gif"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> typer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> COMPRESSION_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> typer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root: local_type = typer new_url = <span class="hljs-string"><span class="hljs-string">"gifs/"</span></span> + full_path.replace(GIFS_DIR, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"/"</span></span> + GIF_COMPRESSED_DIR, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"/"</span></span> + OPTIMIZED_DIR, <span class="hljs-string"><span class="hljs-string">""</span></span>) OUTPUT[type][index][local_type][<span class="hljs-string"><span class="hljs-string">'url'</span></span>] = new_url OUTPUT[type][index][local_type][<span class="hljs-string"><span class="hljs-string">'size'</span></span>] = megabytes_size print(OUTPUT) print(json.dumps(OUTPUT, indent=<span class="hljs-number"><span class="hljs-number">4</span></span>, sort_keys=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>))</code> </pre><br>  Aqui, examinamos as pastas com os arquivos, determinamos o tamanho do arquivo, descobrimos o tipo de compacta√ß√£o e colocamos as informa√ß√µes gerais na matriz OUTPUT.  E ent√£o produzimos essa matriz no console para copi√°-la. <br><br><h2>  Conclus√£o </h2><br>  Espero que este artigo ajude voc√™ com alguma coisa.  Tenha uma boa codifica√ß√£o, pessoal. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt480704/">https://habr.com/ru/post/pt480704/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt480690/index.html">Gerenciamos cortinas de polegada mais baratas</a></li>
<li><a href="../pt480692/index.html">MobX ou Redux: Qual √© melhor para o gerenciamento de estado de rea√ß√£o?</a></li>
<li><a href="../pt480694/index.html">Podemos parar de chamar a acessibilidade e usabilidade do UX?</a></li>
<li><a href="../pt480700/index.html">Usamos console.log () no Chrome ao m√°ximo</a></li>
<li><a href="../pt480702/index.html">RH e talentos, especialistas e criativos: como foi o oitavo Habraseminar</a></li>
<li><a href="../pt480710/index.html">Refatorando jogos SFML</a></li>
<li><a href="../pt480712/index.html">O v√¥o com um dos√≠metro no bolso</a></li>
<li><a href="../pt480714/index.html">Como adicionar codec ao FFmpeg</a></li>
<li><a href="../pt480716/index.html">Matlab vs. Julia vs. Python</a></li>
<li><a href="../pt480724/index.html">Idiomas transcompilados: projetos de convers√£o de c√≥digo em c√≥digo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>