<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🏫 🈷️ 😽 Badoo Jira API Client: Magie in Jira in PHP 🌟 👩🏻‍🚒 🔚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wenn Sie bei Habré „Jira Badoo“ in den Suchtext eingeben, wird das Ergebnis mehr als eine Seite umfassen: Wir erwähnen es fast überall, da es eine wic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Badoo Jira API Client: Magie in Jira in PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/475840/">  Wenn Sie bei Habré „Jira Badoo“ in den Suchtext eingeben, wird das Ergebnis mehr als eine Seite umfassen: Wir erwähnen es fast überall, da es eine wichtige Rolle in unseren Prozessen spielt.  Und jeder von uns möchte ein bisschen anders als sie. <br><br><img src="https://habrastorage.org/webt/xy/8u/z0/xy8uz0gbqfd5idb0tokgpsxvdqs.jpeg"><br><br>  Der Entwickler, der die Aufgabe für die Überprüfung erhalten hat, erwartet, dass in der Aufgabe ein Zweig angegeben ist, Links zu diff und das Änderungsprotokoll vorhanden sind.  Der Entwickler, der den Code geschrieben hat, erwartet, dass nach der Überprüfung Kommentare in Jira angezeigt werden.  Der Tester, der die Aufgabe erhält, möchte die Testergebnisse sehen und die erforderlichen Baugruppen ausführen können, ohne zu anderen Schnittstellen zu wechseln.  Produktmanager möchten in der Regel zehn Entwicklungsaufgaben gleichzeitig auf Knopfdruck erstellen. <br><br>  Und das alles ist heute verfügbar und geschieht automatisch.  Wir haben den größten Teil der Magie in PHP implementiert, indem wir die sich ständig weiterentwickelnde Jira-API und ihren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Webhook verwendet haben</a> .  Und heute möchten wir der Community unsere Version des Clients für diese API mitteilen. <br><br>  Zuerst wollten wir nur über die Ideen und Ansätze sprechen, die wir verwenden, und stellten dann fest, dass es aus Gründen der Klarheit definitiv nicht genug Code für einen solchen Artikel gibt.  Es gab also eine Open-Source-Version von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Badoo Jira PHP Client</a> .  Vielen Dank an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ShaggyRatte</a> für ihre Hilfe bei der Beschreibung.  Und willkommen bei kat! <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Weitere Details und Kontext.</b> <div class="spoiler_text">  Wenn Sie weitere Informationen über unsere Arbeit mit Jira benötigen, finden Sie diese in unseren anderen Artikeln: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/de/company/badoo/blog/169417</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/de/company/badoo/blog/433540</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/de/company/badoo/blog/424655</a> <br></div></div><br><h2>  Was kann er tun </h2><br>  Tatsächlich besteht Badoo Jira PHP Client aus einer Reihe vorgefertigter Wrapper-Klassen für Jira API-Antworten, von denen sich die meisten wie ActiveRecord verhalten können: Sie wissen, wie sie Daten über sich selbst abrufen und auf dem Server aktualisieren, verzögerte Initialisierung und Daten-Caching auf der Ebene unterstützen Code.  Alle Jira-Entitäten, mit denen Sie ständig arbeiten müssen, werden umbrochen: <b>Problem, Status, Priorität, Änderungsprotokoll, Benutzer, Version, Komponente</b> usw. (fast alles, was Sie in der Benutzeroberfläche sehen). <br><br>  Zusätzlich bietet Badoo Jira PHP Client eine einzige Klassenhierarchie für alle benutzerdefinierten Jira-Felder und kann Klassendefinitionen für jedes von Ihnen benötigte benutzerdefinierte Feld generieren. <br><br><pre><code class="php hljs">$Issue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Badoo\Jira\Issue(<span class="hljs-string"><span class="hljs-string">'SMPL-1'</span></span>); $Issue-&gt;addComment(<span class="hljs-string"><span class="hljs-string">'Sample comment text'</span></span>); $Issue-&gt;attachFile(<span class="hljs-string"><span class="hljs-string">'kitten.jpeg'</span></span>, <span class="hljs-string"><span class="hljs-string">'pretty!'</span></span>, <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($Issue-&gt;getStatus()-&gt;getName() === <span class="hljs-string"><span class="hljs-string">'Open'</span></span>) { $Issue-&gt;step(<span class="hljs-string"><span class="hljs-string">'In Progress'</span></span>); }</code> </pre> <br><pre> <code class="php hljs">$DeveloperField = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Example\CustomFields\Developer($Issue); $DeveloperField-&gt;setValue(<span class="hljs-string"><span class="hljs-string">'username'</span></span>)-&gt;save();</code> </pre><br><pre> <code class="php hljs">$User = \Badoo\Jira\User::get(<span class="hljs-string"><span class="hljs-string">'username'</span></span>); $User-&gt;watchIssue(<span class="hljs-string"><span class="hljs-string">'SMPL-1'</span></span>); $User-&gt;assign(<span class="hljs-string"><span class="hljs-string">'SMPL-2'</span></span>);</code> </pre><br>  Dadurch wird die Interaktion mit der API von PHP einfacher und bequemer, und die Dokumentation für Ihren Jira wechselt direkt in den Code, sodass Sie die automatische Vervollständigung in der IDE für viele Standardaktionen verwenden können. <br><br>  Aber das Wichtigste zuerst. <br><br><h2>  API-Funktionen, auf die wir gestoßen sind </h2><br>  Als wir damit begannen, die Jira-API aktiv zu nutzen, war sie nur über das SOAP-Protokoll verfügbar.  Die REST-Version erschien später, und wir waren unter den ersten Benutzern.  Zu dieser Zeit gab es nur sehr wenige öffentlich verfügbare REST-Clients, die in PHP geschrieben waren.  Es war noch schwieriger, etwas zu finden, das sich leicht in unsere Codebasis integrieren ließ, und schrittweise von SOAP zu REST überzugehen.  Wir hatten also keine andere Wahl: Wir beschlossen, unseren eigenen Kunden weiterzuentwickeln. <br><br>  Wir lebten also davon, alle möglichen Hacks und Krücken vom SOAP-Client zu ziehen und abzulegen und aufgrund der Besonderheiten von REST neue zu beschaffen.  Infolgedessen haben wir einige sehr kühne Klassen mit einem Haufen duplizierten Codes erweitert, und es besteht die Notwendigkeit, dieses Durcheinander zu beseitigen. <br><br>  Benutzerdefinierte Felder waren für uns schon immer die schmerzlichste Stelle: Wir haben mehr als 300 davon (zum Zeitpunkt des Schreibens dieses Artikels - 338), und diese Zahl wächst langsam. <br><br><h3>  Seltsame Fehlermeldungen </h3><br>  In der langen Geschichte der Interaktion mit der API haben wir viele verschiedene Dinge gesehen.  Die meisten Fehlermeldungen sind ausreichend, aber es gibt solche, bei denen Sie Ihr Gehirn stark belasten müssen. <br><br>  Wenn Jira beispielsweise plötzlich einen Roboter in Ihrem Benutzer erkennt, zeigt sie ihm ein Captcha.  In diesem Fall ignoriert es beim Zugriff auf die API schamlos den Header <i>Accept-Encoding: application / json</i> und gibt HTML aus.  Natürlich ist der Client, der auf JSON wartet, möglicherweise nicht bereit für dieses "Hallo". <br><br>  Und hier ist ein Beispiel für die Arbeit mit einem benutzerdefinierten Feld: <br><br><img width="600" src="https://habrastorage.org/webt/sc/xt/xe/scxtxekex33vyguynhxr9hjpp_m.png"><br><br>  Wenn Sie Code schreiben und "jetzt testen", ist es sehr einfach zu verstehen, dass customfield_12664 <b>Entwickler ist</b> .  Und wenn ein solcher Fehler irgendwo in der Produktion auftritt (z. B. weil jemand die Konfiguration geändert und die Liste der zulässigen Werte für das Select-Feld geändert hat), besteht die einzige Möglichkeit, das Feld zu identifizieren, darin, in Jira nach dem Namen zu suchen.  Darüber hinaus werden in der Benutzeroberfläche keine IDs angezeigt, sondern nur Namen. <br><br>  Es stellt sich heraus, dass Sie den Namen des Feldes, das zum Fehler geführt hat, herausfinden und dessen Konfiguration korrigieren möchten, indem Sie entweder eine Anforderung an die API senden oder andere nicht offensichtliche Methoden anwenden: Durchsuchen Sie den Quellcode der Seite und öffnen Sie die Einstellungen für ein beliebiges Feld und Korrigieren der URL in der Adressleiste usw. Dieser Vorgang kann nicht als bequem bezeichnet werden, und jedes Mal dauert es zu lange, bis eine so einfache Aufgabe erledigt ist. <br><br>  Obskure Feldnamen sind jedoch nicht auf Probleme beschränkt.  So sieht die Interaktion mit der API aus, wenn Sie in der Datenstruktur einen Fehler beim Aktualisieren des Felds machen: <br><br><img width="600" src="https://habrastorage.org/webt/v_/ab/jo/v_abjobegilkmh8tjdoh2sigius.png"><br><img width="600" src="https://habrastorage.org/webt/pr/nr/fg/prnrfg7hbhxtge1pwejzmuvrgsq.png"><br><br><h3>  Viele verschiedene Datenformate </h3><br>  Und vergessen Sie nicht, dass für die Aktualisierung von Feldern unterschiedlichen Typs unterschiedliche Datenstrukturen erforderlich sind. <br><br><pre> <code class="php hljs">$Jira-&gt;issue()-&gt;edit( <span class="hljs-string"><span class="hljs-string">'SMPL-1'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'customfield_10200'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'denkoren'</span></span>], <span class="hljs-string"><span class="hljs-string">'customfield_10300'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'PHP'</span></span>], <span class="hljs-string"><span class="hljs-string">'customfield_10400'</span></span> =&gt; [[<span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Android'</span></span>], [<span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'iOS'</span></span>]], <span class="hljs-string"><span class="hljs-string">'security'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">100500</span></span>], <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Just text'</span></span>, ], );</code> </pre><br>  Die API-Antworten für sie sind natürlich auch unterschiedlich. <br><br>  Dies kann nur berücksichtigt werden, wenn Sie ständig mit der Jira-API arbeiten und nicht lange durch die Lösung anderer Probleme abgelenkt werden.  Andernfalls gehen diese Funktionen innerhalb weniger Wochen verloren.  Darüber hinaus müssen Sie sich den Typ des Feldes merken, den Sie benötigen, um es mit der richtigen Struktur zu „füttern“.  Wenn Sie Hunderte von benutzerdefinierten Feldern haben, müssen Sie entweder im Code nachsehen, wo er noch verwendet wurde, oder Sie müssen in das Jira-Administrationsfenster wechseln. <br><br>  Bevor wir unseren Kunden schrieben, waren Stack Overflow und Atlassian Community meine besten Freunde bei der Aktualisierung benutzerdefinierter Felder.  Diese Informationen lassen sich jetzt einfach und schnell googeln, aber wir haben zu der REST-API gewechselt, als sie noch recht neu und aktiv war: Es dauerte zehn Minuten, bis eine geeignete cURL-Anforderung in Google gefunden wurde, und dann mussten Sie diese Klammern mit Ihren Augen analysieren und konvertieren in die richtige Struktur für PHP, die beim ersten Versuch oft nicht funktionierte. <br><br>  Im Allgemeinen ist die Interaktion mit benutzerdefinierten Feldern der Prozess, dessen Reorganisation an erster Stelle erforderlich war. <br><br><h2>  Woraus besteht der Kunde? </h2><br><h3>  Klassen für die Arbeit mit benutzerdefinierten Feldern </h3><br>  Zunächst wollten wir uns nicht mehr an Datenstrukturen für die Interaktion mit der API erinnern und lesbare Feldnamen abrufen, wenn Fehler auftraten. <br><br>  Aus diesem Grund haben wir für alle benutzerdefinierten Felder eine einzige Klassenhierarchie erstellt.  Es stellte sich heraus, drei Schichten: <br><br><ol><li>  Ein gemeinsames abstraktes übergeordnetes <b>Element</b> für alle <b>Benutzer</b> : <b>\ Badoo \ Jira \ CustomFields \ CustomField</b> . </li><li>  Durch eine abstrakte Klasse für jeden <b>Feldtyp</b> : <b>SelectField, UserField, TextField</b> usw. </li><li>  Nach Klasse für jedes bestimmte Feld: z. B. <b>Entwickler</b> oder <b>Prüfer</b> . </li></ol><br>  Diese Klassen können unabhängig voneinander geschrieben oder mithilfe eines speziellen Skriptgenerators automatisch erstellt werden (wir werden darauf zurückkommen). <br><img src="https://habrastorage.org/webt/1p/zz/eu/1pzzeucvu78qctdq-12elpstlkm.png"><br><br>  Dank dieser Struktur genügt es, eine von <b>SelectField</b> geerbte PHP-Klasse zu erstellen, um dem Code beizubringen, den Wert Ihres benutzerdefinierten Felds vom Typ <b>Select List (Multiple Choice) zu</b> <b>aktualisieren</b> .  Tatsächlich wird jedes benutzerdefinierte Jira-Feld zu einem regulären ActiveRecord in PHP-Code. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> \<span class="hljs-title"><span class="hljs-title">Example</span></span>\<span class="hljs-title"><span class="hljs-title">CustomFields</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Developer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Badoo</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Jira</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomFields</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleUserField</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ID = <span class="hljs-string"><span class="hljs-string">'customfield_10200'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> NAME = <span class="hljs-string"><span class="hljs-string">'Developer'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// ,  ,  !</span></span></code> </pre><br><br>  In derselben Klasse speichern wir Informationen über das Feld: Standardmäßig ist dies eine ID, der Name des Felds und eine Liste der verfügbaren Werte, sofern diese begrenzt sind (z. B. für <b>Kontrollkästchen</b> und <b>Auswählen</b> ). <br><br><div class="spoiler">  <b class="spoiler_title">Beispiele für Felder in der Jira-Oberfläche und der zugehörigen Klasse</b> <div class="spoiler_text"><img width="500" src="https://habrastorage.org/webt/ea/dd/bf/eaddbfm0cphjpqionp16hqstxg0.png"><br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IssueFor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Badoo</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Jira</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomFields</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleSelectField</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ID = <span class="hljs-string"><span class="hljs-string">'customfield_10662'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> NAME = <span class="hljs-string"><span class="hljs-string">'Issue for'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Available field values. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_BI = <span class="hljs-string"><span class="hljs-string">'BI'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_C_C = <span class="hljs-string"><span class="hljs-string">'C\C++'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_HTML_CSS = <span class="hljs-string"><span class="hljs-string">'HTML\CSS'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_JS = <span class="hljs-string"><span class="hljs-string">'JS'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_OTHER = <span class="hljs-string"><span class="hljs-string">'Other'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_PHP = <span class="hljs-string"><span class="hljs-string">'PHP'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUE_TRANSLATION = <span class="hljs-string"><span class="hljs-string">'Translation'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VALUES = [ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_BI, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_C_C, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_HTML_CSS, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_JS, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_OTHER, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_PHP, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::VALUE_TRANSLATION, ]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemsList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::VALUES; } }</code> </pre><br></div></div><br>  Es stellt sich heraus, dass diese Art von Dokumentation für Ihren Jira ist und sich direkt im PHP-Code befindet.  Wenn es so nah ist, ist es sehr praktisch und beschleunigt die Entwicklung erheblich, während die Anzahl der Fehler verringert wird. <br><br>  Außerdem werden Fehlermeldungen deutlicher: Anstatt nichts <b>zu sagen,</b> stürzt <b>'customfield_12664'</b> beispielsweise folgendermaßen ab: <br><br><pre> <code class="plaintext hljs">Uncaught Badoo\Jira\Exception\CustomField: User 'asdkljfh' not found in Jira. Can't change 'Developer' field value.</code> </pre><br><h3>  Klassen zum Arbeiten mit Systemobjekten </h3><br>  Jira hat viele Daten mit einer komplexen Struktur: zum Beispiel die Felder <b>Status</b> und <b>Sicherheitssystem</b> , Verknüpfungen zwischen Aufgaben, Benutzern, Versionen, Anhängen (Dateien). <br><br>  Wir haben sie auch in Klassen eingepackt: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   $Status = $Issue-&gt;getStatus(); $Status-&gt;getName(); $Status-&gt;getId();</span></span></code> </pre><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// changelog  $History = \Badoo\Jira\Issue\History::forIssue('SMPL-1'); $seconds_in_status = $History-&gt;getTimeInStatus('Open');</span></span></code> </pre><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  Jira $User = new \Badoo\Jira\User('sampleuser'); $User-&gt;assign('SMPL-1');</span></span></code> </pre><br>  Mit solchen Wrappern kann Ihre IDE erkennen, welche Daten verfügbar sind, und Sie können die Funktionsschnittstellen in Ihrem Code streng formalisieren.  Wir verwenden aktiv Typdeklarationen. Dank der Hervorhebung der IDE können wir fast immer einen Fehler sehen, auch wenn wir Code schreiben.  Und wenn Sie den Fehler dennoch übersehen haben, wird er genau an der Stelle ausgegeben, an der er zuerst aufgetreten ist, und nicht an der Stelle, an der Sie den Code endgültig abgelegt haben. <br><br>  Es gibt immer noch statische Methoden, mit denen Sie ein Objekt anhand einiger Kriterien schnell ermitteln können: <br><br><pre> <code class="php hljs">$users = \Badoo\Jira\User::search(<span class="hljs-string"><span class="hljs-string">'&lt;pattern&gt;'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    login, email  display name $Version = \Badoo\Jira\Version::byName('&lt;project&gt;', '&lt;version name&gt;'); //        $components = \Badoo\Jira\Component::forProject('&lt;project&gt;'); //     </span></span></code> </pre><br>  Diese Methoden befolgen die allgemeinen Regeln, damit sie leicht zu finden sind: <br><ul><li>  <i>:: search ()</i> , wenn Sie Objekte nach mehreren Feldern <i>suchen</i> müssen: \ Badoo \ Jira \ Issue :: search () sucht mit JQL nach Tasks, in denen Sie viele Suchkriterien angeben können, und \ Badoo \ Jira \ User :: search () sucht den Benutzer gleichzeitig nach <i>'Name'</i> (Login), <i>'E-Mail'</i> und <i>'displayName'</i> (dem Namen, der im Web <i>angezeigt</i> wird); </li><li>  <i>:: by * ()</i> , wenn Sie das Objekt nicht nach ID, sondern nach einem anderen Kriterium abrufen müssen: \ Badoo \ Jira \ User :: byEmail () sucht einen Benutzer anhand seiner E-Mail-Adresse; </li><li>  <i>:: for * ()</i> sucht nach allen Objekten, die mit etwas verbunden sind: \ Badoo \ Jira \ Version :: forProject <br>  gibt alle Versionen aus einem bestimmten Projekt an; </li><li>  <i>:: fromStdClass ()</i> erstellt ein Objekt aus Rohdaten mit einer geeigneten Struktur, die jedoch nicht von der API, sondern beispielsweise vom <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Webhook empfangen werden</a> : Im Hauptteil der POST-Anforderung sendet Jira JSON verschiedene Informationen zum Ereignis, einschließlich des Hauptteils der Aufgabe einschließlich aller Felder.  Anhand dieser Daten können Sie das Objekt \ Badoo \ Jira \ Issue erstellen und wie gewohnt verwenden. </li></ul><br><h3>  Class \ Badoo \ Jira \ Issue </h3><br>  Es scheint mir, dass der folgende Screenshot von PhpStorm an sich ziemlich beredt ist: <br><br><img width="600" src="https://habrastorage.org/webt/ox/_m/jz/ox_mjzztnjrjtzexiudykocfkwc.png"><br><br>  Im Wesentlichen bindet das <b>\ Badoo \ Jira \ Issue-</b> Objekt alles, was oben beschrieben wurde, in ein einziges System.  Es speichert alle Informationen über die Aufgabe, verfügt über Methoden für den schnellen Zugriff auf die am häufigsten verwendeten Daten, zum Übertragen von Aufgaben zwischen Status usw. <br><br>  Um im einfachsten Fall ein Objekt zu erstellen, genügt es, nur den Schlüssel der Aufgabe zu kennen. <br><br><div class="spoiler">  <b class="spoiler_title">Erstellen Sie ein Objekt mit nur einem Aufgabenschlüssel in Ihrer Tasche</b> <div class="spoiler_text"><pre> <code class="php hljs">$Issue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Badoo\Jira\Issue(<span class="hljs-string"><span class="hljs-string">'SMPL-1'</span></span>);</code> </pre><br></div></div><br>  Sie können auch jeden fragmentierten Datensatz verwenden.  Beispielsweise enthält die Verknüpfungsinformation zwischen Aufgaben, die von der API ankommen, nur einige Felder: ID, Zusammenfassung, Status, Priorität und Ausgabetyp.  <b>Mit \ Badoo \ Jira \ Issue</b> können Sie ein Objekt aus diesen Daten sammeln, damit es sofort zurückgegeben werden kann, und im Übrigen auf die API zugreifen. <br><br><div class="spoiler">  <b class="spoiler_title">Erstellen Sie ein Objekt und speichern Sie Werte für einige Felder</b> <div class="spoiler_text"><pre> <code class="php hljs"> $IssueFromLink = \Badoo\Jira\Issue::fromStdClass( $LinkInfo, [ <span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'key'</span></span>, <span class="hljs-string"><span class="hljs-string">'summary'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>, <span class="hljs-string"><span class="hljs-string">'priority'</span></span>, <span class="hljs-string"><span class="hljs-string">'issuetype'</span></span>, ] );</code> </pre><br></div></div><br>  Dies wird durch verzögerte Initialisierung und Zwischenspeicherung von Daten im Code erreicht.  Dieser Ansatz ist besonders praktisch, da Sie nur <b>\ Badoo \ Jira \ Issue-</b> Objekte in Ihrem Code austauschen können, unabhängig davon, mit welchen Feldern sie erstellt wurden. <br><br><div class="spoiler">  <b class="spoiler_title">Holen Sie sich die fehlenden Aufgabendaten</b> <div class="spoiler_text"><pre> <code class="php hljs">$IssueFromLink-&gt;getSummary(); <span class="hljs-comment"><span class="hljs-comment">//    API,    $IssueFromLink-&gt;getDescription(); //  API    description</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Wie wir zur API gehen</b> <div class="spoiler_text">  In der Jira-API können nicht alle Felder für eine Aufgabe abgerufen werden, sondern nur die Felder, die derzeit benötigt werden, z. B. nur Schlüssel und Zusammenfassung.  Wir gehen jedoch absichtlich nicht für nur ein Feld im Getter nach Jira.  Im obigen Beispiel aktualisiert getDescription () Informationen zu allen Feldern gleichzeitig.  Da <b>\ Badoo \ Jira \ Issue</b> nicht die geringste Ahnung hat, was Sie als Nächstes benötigen, ist es rentabler, alles sofort von der API abzurufen, da wir sowieso dorthin gegangen sind.  Ja, die Abfrage "Nur Beschreibung abrufen" und die Abfrage "Standardmäßig alle Felder abrufen" für ein paar Hundert Tickets dauert unterschiedlich lange, aber für ein Ticket ist dieser Unterschied nicht so auffällig. <br><br><pre> <code class="plaintext hljs">//Time for single field: 0.40271635055542 (second) //Time for all default fields: 0.84159119129181 (second)</code> </pre><br>  Aus den Zahlen geht klar hervor, dass es rentabler ist, wenn nur drei Felder (eines in der Anfrage) empfangen werden, alles auf einmal abzurufen, anstatt für jedes die API aufzurufen.  Das Ergebnis dieser Messung hängt in der Tat von der Konfiguration von Jira und dem Server ab, auf dem es ausgeführt wird.  Von Aufgabe zu Aufgabe und von Messung zu Messung ändern sich die Zahlen, und die <b>Zeit für alle Standardfelder</b> beträgt stabil weniger als drei <b>Zeit für ein einzelnes Feld</b> und häufig sogar weniger als zwei. <br><br>  Bei der Arbeit mit einer großen Anzahl von Aufgaben kann die Differenz jedoch in Sekunden gemessen werden.  Wenn Sie wissen, dass Sie nur Schlüssel und Beschreibung für 500 Tickets benötigen, bleibt die Möglichkeit, diese mit einer effektiven Abfrage <b>abzurufen, in den Methoden</b> <b>\ Badoo \ Jira \ Issue :: search ()</b> und <b>\ Badoo \ Jira \ Issue :: byKeys () erhalten</b> . <br><br></div></div><br>  <b>\ Badoo \ Jira \ Issue</b> - im Allgemeinen über Aufgaben in einem abstrakten Jira.  Aber Ihre (wie unsere) Jira ist nicht abstrakt - sie verfügt über eine Reihe von benutzerdefinierten Feldern und einen eigenen Workflow.  Du benutzt einige der Felder und Übergänge verdammt oft, deshalb ist es nicht sehr bequem, sie alle weit zu verfolgen.  Daher kann <b>\ Badoo \ Jira \ Issue</b> problemlos mit eigenen Methoden erweitert werden, die für eine bestimmte Jira-Konfiguration spezifisch sind. <br><br><div class="spoiler">  <b class="spoiler_title">Ein Beispiel für eine Klassenerweiterung durch eine Methode zum schnellen Abrufen eines benutzerdefinierten Felds</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> \<span class="hljs-title"><span class="hljs-title">Deploy</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Issue</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Badoo</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Jira</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Issue</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// … /** * Get 'Developer' custom field as object */ function getDeveloperField() : \Deploy\CustomFields\Developer { return $this-&gt;getCustomField(\Deploy\CustomFields\Developer::class); } // ... }</span></span></code> </pre><br></div></div><br><br><h3>  Erstellen Sie die Anforderung </h3><br>  Das Erstellen einer Aufgabe in Jira ist ein ziemlich komplizierter Vorgang.  Wenn Sie dies über die Webschnittstelle tun, wird ein spezieller Bildschirm (Bildschirm erstellen) mit einer Reihe von Feldern angezeigt.  Einige davon können Sie einfach ausfüllen, weil Sie möchten, und andere sind als obligatorisch gekennzeichnet.  Gleichzeitig kann Create Screen für jedes Projekt und sogar für verschiedene Aufgabentypen in einem Projekt eindeutig sein.  Es gibt also alle möglichen Einschränkungen hinsichtlich der Feldwerte und der Möglichkeit, den Feldwert beim Erstellen der Aufgabe festzulegen. <br><br>  Das Unangenehmste für Entwickler in dieser Situation ist, dass diese Einschränkungen für die API gelten.  Letzteres hat eine spezielle Anforderung ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">create-meta ist</a> in der REST-API seit Version 5.0 verfügbar), mit der Sie eine Liste der Feldeinstellungen abrufen können, die beim Erstellen einer Aufgabe verfügbar sind.  Ein Entwickler, der "im Moment nur eine einfache Sache machen" muss, wird sich jedoch höchstwahrscheinlich nicht darum kümmern. <br><br>  Infolgedessen ist es so gekommen: Da die Anforderung zum Erstellen einer Aufgabe sehr umfangreich sein kann, haben wir ihr häufig nach und nach Daten hinzugefügt, und beim Versuch, alles an Jira zu senden, ist ein Fehler aufgetreten.  Danach musste ich im Code nach allen Stellen suchen, an denen sich etwas in der Anfrage geändert hatte, und nach einem langen und mühsamen Versuch, zu verstehen, was genau schief gelaufen war. <br><br>  Daher haben wir <b>\ Badoo \ Jira \ Issue \ CreateRequest</b> .  Sie können den Fehler früher sehen, genau an der Stelle, an der Sie versuchen, etwas falsches zu machen: Geben Sie dem Feld einen gekrümmten Wert oder ändern Sie das nicht verfügbare Feld.  Wenn Sie beispielsweise versuchen, einer Aufgabe eine Komponente mitzuteilen, die nicht im Projekt vorhanden ist, stürzt die Ausnahme an der Stelle ab, an der Sie sie ausgeführt haben, und nicht an der Stelle, an der Sie die Anforderung letztendlich an die API gesendet haben. <br><br><div class="spoiler">  <b class="spoiler_title">Der Arbeitsfluss mit CreateRequest sieht ungefähr so ​​aus</b> <div class="spoiler_text"><pre> <code class="php hljs">$Request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Badoo\Jira\Issue\CreateRequest(<span class="hljs-string"><span class="hljs-string">'DD'</span></span>, <span class="hljs-string"><span class="hljs-string">'Task'</span></span>, $Client); $Request -&gt;setSummary(<span class="hljs-string"><span class="hljs-string">'summary'</span></span>) -&gt;setDescription(<span class="hljs-string"><span class="hljs-string">'description'</span></span>) -&gt;setFieldValue(<span class="hljs-string"><span class="hljs-string">'For QA'</span></span>, <span class="hljs-string"><span class="hljs-string">'custom field with some comments for QA who will check the issue'</span></span>); $Request-&gt;send();</code> </pre><br></div></div><br><h3>  Arbeiten Sie direkt mit der API </h3><br>  Die oben beschriebenen Klassen decken die meisten Anforderungen ab.  Wir sind uns jedoch bewusst, dass die Mehrheit weit von allem entfernt ist.  Daher haben wir auch einen kleinen Client für die direkte Arbeit mit der API - <b>\ Badoo \ Jira \ REST \ Client</b> . <br><br><div class="spoiler">  <b class="spoiler_title">Anwendungsfall für Kunden</b> <div class="spoiler_text"><pre> <code class="php hljs">$Jira = \Badoo\Jira\REST\Client::instance(); $Jira-&gt;setJiraUrl(<span class="hljs-string"><span class="hljs-string">'https://jira.example.com/'</span></span>); $Jira-&gt;setAuth(<span class="hljs-string"><span class="hljs-string">'user'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>) $IssueInfo = $Jira-&gt;issue()-&gt;get(<span class="hljs-string"><span class="hljs-string">'SMPL-1'</span></span>);</code> </pre><br></div></div><br><h2>  Klassengenerator für benutzerdefinierte Felder </h2><br>  Um die Arbeit mit benutzerdefinierten Feldern zu vereinfachen, muss jedes Feld eine eigene Klasse im Code haben.  Wir haben sie bei Bedarf manuell erstellt, aber vor dem Veröffentlichen des Clients entschieden wir, dass dieser Ansatz für neue Benutzer möglicherweise nicht sehr praktisch ist.  Aus diesem Grund haben wir einen speziellen Generator erstellt, mit dem Sie in der Jira-API eine Liste der benutzerdefinierten Felder anzeigen und Vorlagenklassen für die bekannten Feldtypen erstellen können. <br><br>  Wir glauben, dass es für die meisten Aufgaben ausreicht, das <b>bin / generate-</b> CLI-Skript aus unserem Repository zu verwenden.  Sie können ihn bitten, mit der Option <b>--help / -h etwas</b> über sich zu erzählen: <br><br><pre> <code class="bash hljs">./bin/generate --<span class="hljs-built_in"><span class="hljs-built_in">help</span></span></code> </pre><br>  Im einfachsten Fall reicht es für die Generierung aus, die URL Ihres Jira, den Benutzer, sein Passwort, den Namespace für die Klassen und das Verzeichnis anzugeben, in dem der Code abgelegt werden soll: <br><br><pre> <code class="bash hljs">./bin/generate -u user -p password --jira-url https://jira.mlan --target-dir custom-fields --namespace CustomFields</code> </pre><br>  Wir haben auch die Möglichkeit implementiert, eigene Vorlagen hinzuzufügen und Klassen für einzelne Felder zu generieren.  Dies finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> . <br><br><h2>  Fazit </h2><br>  Wir mögen was wir haben.  Mit diesem Konzept - unseren eigenen Klassen für benutzerdefinierte Felder, Wrappern für Status, Versionen, Benutzer usw. - leben wir seit mehr als einem Jahr und fühlen uns großartig.  Vor der Veröffentlichung des Codes haben wir sogar die Funktionalität erweitert und wundervolle Dinge hinzugefügt, die lange Zeit nicht in Ihre Hände kamen, um den Client zu verwenden. So haben wir beispielsweise die Möglichkeit hinzugefügt, mehrere Felder in Issue in einer Anfrage zu aktualisieren, und einen Klassengenerator für benutzerdefinierte Felder geschrieben. <br><br>  Unserer Meinung nach hat es sich als eine gute Sache erwiesen, die auf jeden Fall verstanden werden sollte, ob sie Ihren Aufgaben und Anforderungen entspricht.  Unter unserer - einfach fit. <br><br>  Link nochmal: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/badoo/jira-client</a> . <br><br>  Vielen Dank für das Lesen bis zum Ende.  Wir hoffen, dass dieser Code jetzt nicht nur für uns von Nutzen ist und Zeit spart. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de475840/">https://habr.com/ru/post/de475840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de475826/index.html">Warum Amazon (und andere) Bewertungen nicht vertrauenswürdig sind</a></li>
<li><a href="../de475830/index.html">Tragbare Retro-Konsole zum Selbermachen</a></li>
<li><a href="../de475834/index.html">Scrum wird dir nicht helfen. Wir verstehen warum</a></li>
<li><a href="../de475836/index.html">Interview mit Arthur Khachuyan: Wie berechnet man einen Milliardär in sozialen Netzwerken?</a></li>
<li><a href="../de475838/index.html">Menschen verändern. Oder ... Menschen verändern. Informationen zum „Abheben“ des Transformationsprojekts</a></li>
<li><a href="../de475842/index.html">Aktions-URL & URI in SIP-Telefonen ersetzen oder über Websockets verwalten?</a></li>
<li><a href="../de475848/index.html">Wie die Yandex.Market-Suche funktioniert und was passiert, wenn einer der Server abstürzt</a></li>
<li><a href="../de475850/index.html">So starten Sie eine Karriere in der IT, wenn Sie noch keine Erfahrung haben</a></li>
<li><a href="../de475854/index.html">JDBC-Pools und effizientes File-Handling: Java mitap 3. Dezember in St. Petersburg</a></li>
<li><a href="../de475856/index.html">Google App Script, Mikrotik, Telegram und VPNBook haben begonnen, ein Quartett zu spielen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>