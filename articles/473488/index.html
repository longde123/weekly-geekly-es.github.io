<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§® üíº ü¶ë Navegaci√≥n multiplataforma: por qu√© NavController derrot√≥ a angular / router en Ionic 4 üê∑ üïµüèø üêä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Mi nombre es Nikita Zhigamovsky, programador de KitApp, y quiero hablar sobre mi experiencia en la construcci√≥n de navegaci√≥n en Ionic 4...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Navegaci√≥n multiplataforma: por qu√© NavController derrot√≥ a angular / router en Ionic 4</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473488/"><img src="https://habrastorage.org/webt/mh/yf/fb/mhyffbqhpfmzktzggykl-34trg8.png"><br><br>  Hola a todos!  Mi nombre es Nikita Zhigamovsky, programador de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">KitApp,</a> y quiero hablar sobre mi experiencia en la construcci√≥n de navegaci√≥n en Ionic 4: el problema que encontr√© y su soluci√≥n. <br><br>  He estado desarrollando soluciones multiplataforma para aplicaciones m√≥viles desde 2018.  Sol√≠a ‚Äã‚Äãtrabajar en la tercera versi√≥n de Ionic, pero, a medida que pasa el tiempo, la funcionalidad se est√° desarrollando, decid√≠ cambiar a una versi√≥n m√°s nueva, y los molestos momentos y errores del modelo anterior en Ionic 4 ya se han solucionado. <br><a name="habracut"></a><br>  Parecer√≠a que lo que podr√≠a salir mal.  Finalmente, tenemos la funcionalidad de un enrutamiento angular normal, y no el antiguo NavController con todas sus deficiencias.  Incluso en el sitio web oficial de Ionic, la gu√≠a de enrutamiento indica que vale la pena navegar por las p√°ginas mediante programaci√≥n utilizando los m√©todos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">angulares</a> / enrutadores.  Pero hab√≠a algo que me hizo volver al antiguo NavController. <br><br><h4>  La esencia del problema </h4><br>  Se not√≥ un error interesante.  Supongamos que tiene un men√∫ lateral, lo hizo usando ion-split-pane.  Tambi√©n tiene p√°ginas separadas del men√∫ y desea pasar de ellas a otras p√°ginas que est√°n en el men√∫.  Navegue usando Router.navigateByUrl ('/ menu / ...').  Luego, llamamos a la p√°gina del men√∫ A, y la p√°gina separada del men√∫ - B. ¬°Pero hay una <b>PERO!</b> <br><br>  Supongamos que, en la p√°gina A, se activa una cierta l√≥gica en el evento ngOnInit.  Navega a la p√°gina B con el enrutador y observa que la p√°gina del men√∫ todav√≠a est√° activa, no se ha eliminado.  En consecuencia, si vuelve a la p√°gina A, el evento ngOnInit no funcionar√°, ya que el evento ngOnDestroy de esta p√°gina no funcion√≥.  Parece que todo es l√≥gico.  En esos momentos, generalmente recurren a uno de los m√©todos del ciclo de vida, no el angular, sino el i√≥nico: ionViewWillEnter.  Se dispara cuando va a la p√°gina tan pronto como se activa.  Todo parece estar bien, encaja perfectamente, pero hay un cierto n√∫mero de convenciones. <br><br>  Ninguna de las opciones para una acci√≥n adecuada en la p√°gina A funcionar√° cuando vaya a ella, si esta transici√≥n no es de p√°ginas que est√°n en el men√∫.  No podr√° realizar un seguimiento de la transici√≥n a esta p√°gina porque, repito, todav√≠a est√° abierta y funciona silenciosamente en otras p√°ginas, por ejemplo, en la p√°gina B. <br><br>  Algunos ejemplos ilustrativos: <br><br>  ionViewWillEnter funcionar√° si tiene la siguiente estructura de p√°gina: <br><br>  1) p√°ginas separadas <br><br>  <i>- p√°gina1</i> <i><br></i>  <i>- p√°gina2</i> <i><br></i>  <i>- p√°gina3</i> <br><br>  En este ejemplo, cuando voy a cada p√°gina, ionViewWillEnter funcionar√° perfectamente.  (p√°gina1 =&gt; p√°gina2, p√°gina2 =&gt; p√°gina3, etc.) <br><br>  2) Men√∫ / Pesta√±as <br><br>  <i>- men√∫</i> <i><br></i>  <i>- menuPage1</i> <i><br></i>  <i>- menuPage2</i> <i><br></i>  <i>- menuPage3</i> <br>  En este ejemplo, todo estar√° bien: el m√©todo ionViewWillEnter se activar√° cada vez que vaya a cualquiera de las p√°ginas (menuPage1 =&gt; menuPage2, menuPage1 =&gt; menuPage3, etc.). <br><br>  Pero en el ejemplo a continuaci√≥n, todo es m√°s complicado: <br><br>  <i>- men√∫</i> <i><br></i>  <i>- menuPage1</i> <i><br></i>  <i>- menuPage2</i> <i><br></i>  <i>- menuPage3</i> <i><br></i>  <i>- loginPage</i> <i><br></i>  <i>- p√°gina de registro</i> <br><br>  Aqu√≠ es donde comienzan los problemas del enrutamiento angular est√°ndar.  Al navegar dentro de las p√°ginas del men√∫ (menuPage1 =&gt; menuPage2 =&gt; menuPage3): el m√©todo ionViewWillEnter funcionar√° como de costumbre, de la misma manera cuando se navega entre p√°ginas individuales (loginPage =&gt; signupPage).  Pero tan pronto como comenzamos a movernos entre p√°ginas separadas y p√°ginas de men√∫ (loginPage =&gt; menu / menuPage1 o menu / menuPage3 =&gt; signupPage), ni el m√©todo ngOnInit ni ionViewWillEnter funcionan.  ngOnInit no funcionar√° porque la p√°gina no ha sido destruida, lo cual es l√≥gico.  Pero, ¬øpor qu√© no funcion√≥ ionViewWillEnter? <br><br>  Seg√∫n la documentaci√≥n, ionViewWillEnter funciona dentro de pilas de enrutamiento separadas (la palabra clave "individual") o entre p√°ginas individuales, o dentro de men√∫s / pesta√±as.  Pero no en la estructura mixta de p√°ginas individuales y men√∫s / pesta√±as.  Extra√±o, pero esto se considera comportamiento normal.  Al mismo tiempo, este no es exactamente el comportamiento que los usuarios esperan, especialmente cuando se considera el nombre de los ganchos del ciclo de vida :). <br><br><h4>  Entonces, ¬øc√≥mo resolver este problema? </h4><br>  Despu√©s de haber visitado muchos foros, pero no haber visto una soluci√≥n normal y haber visto algunos trucos de vida dudosos que no siempre funcionan, queda claro que se necesita algo m√°s.  Algo que cambiar√° la funcionalidad de transici√≥n entre p√°ginas de cualquier tipo. <br><br>  ¬øQu√© hacer en este caso?  Por supuesto, lanza el Router al infierno y olv√≠date de √©l, porque todav√≠a existe nuestro NavController odiado y ahora tan bueno. <br><br>  La principal diferencia entre el m√©todo NavController.navigateRoot () es que despu√©s de cambiar a otra p√°gina, ¬°la anterior se destruye autom√°ticamente!  Y cuando lo cambies de nuevo, ¬°tanto el m√©todo ngOnInit como ionViewWillEnter funcionar√°n!  De hecho, esta es la soluci√≥n perfecta, sin muletas y dudosas funciones autoescritas. <br><br>  Lo mejor es que funciona con cualquier estructura de p√°gina: incluso entre normal, incluso dentro del men√∫, incluso de tipo mixto, como en el √∫ltimo ejemplo. <br><br>  Resuma los aspectos positivos: <br><br><ol><li>  NavController elimina la p√°gina anterior de la pila, respectivamente, cuando vuelve a ella: se actualiza, los m√©todos ionViewWillEnter y ngOnInit funcionan, y puede llamar a la l√≥gica en ellos nuevamente y actualizar la informaci√≥n en las p√°ginas, por ejemplo. </li><li>  Olv√≠date de los viejos m√©todos push (), setRoot () y pop (), as√≠ como navegar por los elementos de la clase.  Despu√©s de todo, esto fue lo que cre√≥ muchos problemas.  Ahora navCtrl ha actualizado los m√©todos, que pasan la misma ruta que en los m√©todos del enrutador. </li></ol><br>  Hay una advertencia, donde prescindir de "PERO" :) <br><br>  Si agregamos un controlador de eventos al bot√≥n de "atr√°s" del hardware en el Android y en este controlador tratamos de ir a alg√∫n lugar usando Router o navController, obtenemos el siguiente error en la consola: 'Navegaci√≥n activada fuera de la zona angular'. <br><br>  S√≠, la navegaci√≥n funcionar√°, la p√°gina se abrir√°, pero nada funcionar√° en ella, ni la inicializaci√≥n de las propiedades, ni los m√©todos del ciclo de vida.  Desafortunadamente, la navegaci√≥n presionando el bot√≥n Atr√°s se activa fuera de la zona angular y, de hecho, abre solo la plantilla: sin vincular variables a la plantilla, sin funciones, ganchos, m√©todos de ciclo de vida, sin nada. <br><br>  La soluci√≥n es muy simple, en realidad.  Simplemente forzamos expl√≠citamente la navegaci√≥n dentro de la zona angular. <br><br>  <u>Un ejemplo:</u> <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Component, NgZone } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { NavController } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@ionic/angular'</span></span>; @Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'app-root'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'app.component.html'</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private navCtrl: NavController, private ngZone: NgZone){} <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ngZone.run(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.navCtrl.navigateForward(<span class="hljs-string"><span class="hljs-string">'menu'</span></span>)).then();  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ngZone.run(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.router.navigateByUrl(<span class="hljs-string"><span class="hljs-string">'/menu/my-orders'</span></span>)).then(); }</code> </pre> <br>  ¬°Y ahora todo funciona bien! <br><br>  Hay muchos art√≠culos interesantes sobre ngZone, le aconsejo que lea.  Buena suerte <br><br><h4>  Un poco sobre los m√©todos de navController: </h4><br><br><ul><li>  this.navCtrl.setDirection ('root'): establece la p√°gina ra√≠z en la pila, eliminando todas las anteriores. </li><li>  this.navCtrl.navigateRoot ('homePage') - similar a navCtrl.setDirection ('root') + router.navigateByUrl ('homePage'), pero con la eliminaci√≥n obligatoria de la p√°gina anterior en la pila (que es lo que necesitamos). </li><li>  this.navCtrl.navigateForward ('examplePage') - similar a router.navigateByUrl ('/ examplePage), pero con una indicaci√≥n expl√≠cita de d√≥nde ir + puede eliminar la p√°gina anterior en la pila. </li><li>  this.navCtrl.back (): similar a location.back (), pero con animaci√≥n. </li><li>  this.navCtrl.navigateBack ('backPage') - similar a navCtrl.setDirection ('back') + router.navigateByUrl ('backPage'). </li></ul><br>  Supongamos que ahora estamos en menu / page1, <br><br><img src="https://habrastorage.org/webt/va/kf/cr/vakfcrknhruiqpwwqc5rm4wgyp8.png" alt="imagen"><br><br>  y tenemos una pila de men√∫ separada y, despu√©s de pasar del men√∫ / p√°gina1 a la p√°gina de inicio de sesi√≥n, necesitamos eliminar la p√°gina men√∫ / p√°gina1 para que despu√©s de cambiar de nuevo, tengamos alg√∫n tipo de l√≥gica trabajando en ngOnInit o ionViewWillEnter.  Si usamos router.navigateByUrl ('inicio de sesi√≥n) para la transici√≥n, luego estaremos en la p√°gina de inicio de sesi√≥n, pero tambi√©n tendremos una p√°gina de men√∫, <br><br><img src="https://habrastorage.org/webt/n6/7t/iu/n67tiuqk8b-jif83jwpjtln0fsq.png"><br><br>  en consecuencia, despu√©s de cambiar de inicio de sesi√≥n a menu / page1, ni ngOnInit ni ionViewWillEnter funcionar√°n. <br><br>  Si utiliza nuestro navCtrl.navigateRoot ('inicio de sesi√≥n') para navegar, luego de abrir la p√°gina de inicio de sesi√≥n, se elimina la p√°gina anterior.  Y los m√©todos ngOnInit e ionViewWillEnter funcionar√°n. <br><br><img src="https://habrastorage.org/webt/lb/st/gl/lbstgl0seo_rh1s-dseb1k2uzva.png"><br><br>  Esta es la belleza de usar navController: el <u>comportamiento esperado es totalmente consistente con el actual</u> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/473488/">https://habr.com/ru/post/473488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../473470/index.html">GitLab 12.4 con solicitud de fusi√≥n mejorada y dependencias de API de auditor√≠a</a></li>
<li><a href="../473476/index.html">Comprobaci√≥n del contenedor OpenCvSharp sobre OpenCV con PVS-Studio</a></li>
<li><a href="../473478/index.html">Comprobaci√≥n del OpenCvSharp Wrapper para OpenCV con PVS-Studio</a></li>
<li><a href="../473482/index.html">Los √©xitos de la campa√±a saudita, Halloween-PR y un poco sobre las campa√±as publicitarias de Japan Airlines</a></li>
<li><a href="../473484/index.html">Curso C ++ en el centro CS, segunda parte</a></li>
<li><a href="../473490/index.html">¬øPor qu√© los mejores f√≠sicos adoran la teor√≠a de cuerdas?</a></li>
<li><a href="../473500/index.html">Aplicaci√≥n en TSD y comunicaci√≥n con 1C: Enterprise 8.3 a trav√©s del servicio HTTP. Parte 1 (Elecci√≥n de un m√©todo de intercambio. Descripci√≥n de la API)</a></li>
<li><a href="../473502/index.html">¬øLinux mat√≥ a Unix comercial?</a></li>
<li><a href="../473510/index.html">Estamos escribiendo un programa para una c√°mara con reconocimiento facial.</a></li>
<li><a href="../473512/index.html">Noticias del mundo de OpenStreetMap No. 482 (10/08/2019 - 10/10/2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>