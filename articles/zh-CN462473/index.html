<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤µğŸ¿ ğŸ‘¨ğŸ¿â€ğŸ”§ ğŸ§“ğŸ½ æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªä½¿ç”¨å¾®æœåŠ¡çš„ç¯å¢ƒã€‚ ç¬¬1éƒ¨åˆ†åœ¨è£¸æœºä¸Šå®‰è£…Kubernetes HAï¼ˆDebianï¼‰ ğŸ‘µğŸ½ ğŸ˜« ğŸ•º</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ‚¨å¥½ï¼ŒHabräº²çˆ±çš„è¯»è€…ä»¬ï¼ 


 åœ¨æœ¬å‡ºç‰ˆç‰©ä¸­ï¼Œæˆ‘æƒ³å¼€å§‹æ’°å†™ä¸€ç³»åˆ—æœ‰å…³ä½¿ç”¨Kuberneteså®¹å™¨éƒ¨ç½²åŠŸèƒ½å®Œå–„çš„ç¼–æ’ç¯å¢ƒçš„æ–‡ç« ï¼Œä»¥å‡†å¤‡è¿›è¡Œæ“ä½œå’Œå¯åŠ¨åº”ç”¨ç¨‹åºã€‚ 
 æˆ‘ä¸ä»…è¦è®²è¿°å¦‚ä½•éƒ¨ç½²Kubernetesé›†ç¾¤ï¼Œè¿˜æƒ³è®²è¿°å®‰è£…åå¦‚ä½•é…ç½®é›†ç¾¤ï¼Œå¦‚ä½•å‘å…¶æ·»åŠ ä¾¿æ·çš„å·¥å…·å’Œé™„åŠ ç»„ä»¶ä»¥ä½¿ç”¨å¾®æœåŠ¡æ¶æ„ã€‚ 
 æ­¤...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªä½¿ç”¨å¾®æœåŠ¡çš„ç¯å¢ƒã€‚ ç¬¬1éƒ¨åˆ†åœ¨è£¸æœºä¸Šå®‰è£…Kubernetes HAï¼ˆDebianï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462473/"><p><img src="https://habrastorage.org/webt/aq/dx/l3/aqdxl3a5akxfl3rh9b7bzc_kqji.jpeg"></p><br><h4> æ‚¨å¥½ï¼ŒHabräº²çˆ±çš„è¯»è€…ä»¬ï¼ </h4><br><p> åœ¨æœ¬å‡ºç‰ˆç‰©ä¸­ï¼Œæˆ‘æƒ³å¼€å§‹æ’°å†™ä¸€ç³»åˆ—æœ‰å…³ä½¿ç”¨Kuberneteså®¹å™¨éƒ¨ç½²åŠŸèƒ½å®Œå–„çš„ç¼–æ’ç¯å¢ƒçš„æ–‡ç« ï¼Œä»¥å‡†å¤‡è¿›è¡Œæ“ä½œå’Œå¯åŠ¨åº”ç”¨ç¨‹åºã€‚ <br> æˆ‘ä¸ä»…è¦è®²è¿°å¦‚ä½•éƒ¨ç½²Kubernetesé›†ç¾¤ï¼Œè¿˜æƒ³è®²è¿°å®‰è£…åå¦‚ä½•é…ç½®é›†ç¾¤ï¼Œå¦‚ä½•å‘å…¶æ·»åŠ ä¾¿æ·çš„å·¥å…·å’Œé™„åŠ ç»„ä»¶ä»¥ä½¿ç”¨å¾®æœåŠ¡æ¶æ„ã€‚ </p><br><h2> æ­¤å‘¨æœŸè‡³å°‘åŒ…å«å››ç¯‡æ–‡ç« ï¼š </h2><br><ol><li> åœ¨å®ƒä»¬çš„ç¬¬ä¸€ç¯‡ä¸­ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨å¦‚ä½•åœ¨è£¸é“ä¸Šå®‰è£…æ•…éšœå®‰å…¨kubernetesé›†ç¾¤ï¼Œå¦‚ä½•å®‰è£…æ ‡å‡†ä»ªè¡¨æ¿å¹¶é…ç½®å¯¹å…¶çš„è®¿é—®æƒé™ï¼Œå¦‚ä½•å®‰è£…å…¥å£æ§åˆ¶å™¨ã€‚ </li><li> åœ¨ç¬¬äºŒç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•éƒ¨ç½²Cephæ•…éšœè½¬ç§»ç¾¤é›†ä»¥åŠå¦‚ä½•åœ¨Kubernetesç¾¤é›†ä¸­å¼€å§‹ä½¿ç”¨RBDå·ã€‚ æˆ‘è¿˜å°†ä»‹ç»å…¶ä»–ç±»å‹çš„å­˜å‚¨ï¼ˆå­˜å‚¨ï¼‰ï¼Œå¹¶æ›´è¯¦ç»†åœ°è€ƒè™‘æœ¬åœ°å­˜å‚¨ã€‚ æ­¤å¤–ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨å¦‚ä½•æ ¹æ®åˆ›å»ºçš„CEPHé›†ç¾¤ç»„ç»‡S3å®¹é”™å­˜å‚¨ </li><li> åœ¨ç¬¬ä¸‰ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä»‹ç»å¦‚ä½•åœ¨Kubernetesé›†ç¾¤ï¼ˆå³Kubernetesä¸Šçš„Percona XtraDBé›†ç¾¤ï¼‰ä¸­éƒ¨ç½²æ•…éšœè½¬ç§»é›†ç¾¤MySqlã€‚ å¦å¤–ï¼Œæˆ‘è¿˜å°†æè¿°å½“æˆ‘ä»¬å†³å®šå°†æ•°æ®åº“è½¬ç§»åˆ°kubernetesæ—¶é‡åˆ°çš„æ‰€æœ‰é—®é¢˜ã€‚ </li><li> åœ¨ç¬¬å››ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å°è¯•å°†æ‰€æœ‰å†…å®¹æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶å‘Šè¯‰æ‚¨å¦‚ä½•éƒ¨ç½²å’Œè¿è¡Œå°†ä½¿ç”¨æ•°æ®åº“å’Œcephå·çš„åº”ç”¨ç¨‹åºã€‚ æˆ‘å°†å‘Šè¯‰æ‚¨å¦‚ä½•é…ç½®å…¥å£æ§åˆ¶å™¨ä»¥ä»å¤–éƒ¨è®¿é—®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä»¥åŠæ¥è‡ªLet's Encryptçš„è‡ªåŠ¨è¯ä¹¦è®¢è´­æœåŠ¡ã€‚ å¦ä¸€ä¸ªæ˜¯å¦‚ä½•è‡ªåŠ¨ç»´æŠ¤è¿™äº›è¯ä¹¦çš„æœ€æ–°çŠ¶æ€ã€‚ åœ¨è®¿é—®æ§åˆ¶é¢æ¿çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬è¿˜æ¶‰åŠRBACã€‚ æˆ‘å°†ç®€è¦ä»‹ç»HelmåŠå…¶å®‰è£…ã€‚ <br> å¦‚æœæ‚¨å¯¹è¿™äº›å‡ºç‰ˆç‰©ä¸­çš„ä¿¡æ¯æ„Ÿå…´è¶£ï¼Œæ¬¢è¿æ‚¨ï¼ <a name="habracut"></a></li></ol><br><h2> å‚èµ›ä½œå“ï¼š </h2><br><p> è¿™äº›æ–‡ç« é€‚ç”¨äºè°ï¼Ÿ é¦–å…ˆï¼Œå¯¹äºé‚£äº›åˆšåˆšå¼€å§‹ç ”ç©¶Kubernetesçš„äººã€‚ è€Œä¸”ï¼Œå¯¹äºæ­£è€ƒè™‘ä»æ•´ä½“å¼æœåŠ¡è½¬å‘å¾®æœåŠ¡çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¯¥å‘¨æœŸå°†éå¸¸æœ‰ç”¨ã€‚ æ‰€æè¿°çš„ä¸€åˆ‡éƒ½æ˜¯æˆ‘çš„ç»éªŒï¼ŒåŒ…æ‹¬å°†å¤šä¸ªé¡¹ç›®ä»æ•´ä½“ç¿»è¯‘ä¸ºKubernetesæ—¶è·å¾—çš„ç»éªŒã€‚ æœ‰ç»éªŒçš„å·¥ç¨‹å¸ˆå¯èƒ½ä¼šå¯¹å‡ºç‰ˆç‰©çš„æŸäº›éƒ¨åˆ†æ„Ÿå…´è¶£ã€‚ </p><br><h4> åœ¨æœ¬ç³»åˆ—å‡ºç‰ˆç‰©ä¸­ï¼Œæˆ‘å°†ä¸ä½œè¯¦ç»†ä»‹ç»çš„å†…å®¹ï¼š </h4><br><ul><li> è¯¦ç»†è§£é‡Šä»€ä¹ˆæ˜¯kubernetesåŸè¯­ï¼Œä¾‹å¦‚ï¼špodï¼Œéƒ¨ç½²ï¼ŒæœåŠ¡ï¼Œå…¥å£ç­‰ã€‚ </li><li> æˆ‘å°†éå¸¸è‚¤æµ…åœ°è€ƒè™‘CNIï¼ˆå®¹å™¨ç½‘ç»œæ¥å£ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨callicoï¼Œå› æ­¤ä»…åˆ—å‡ºå…¶ä»–è§£å†³æ–¹æ¡ˆã€‚ </li><li>  dockeræ˜ åƒæ„å»ºè¿‡ç¨‹ã€‚ </li><li>  CI \ CDè¿›ç¨‹ã€‚  ï¼ˆä¹Ÿè®¸æ˜¯å•ç‹¬çš„å‡ºç‰ˆç‰©ï¼Œä½†åœ¨æ•´ä¸ªå‘¨æœŸä¹‹åï¼‰ </li><li> æŒèˆµ å…³äºä»–çš„æ–‡ç« å¾ˆå¤šï¼Œæˆ‘åªæ¶‰åŠåœ¨ç¾¤é›†ä¸­å®‰è£…å®ƒå’Œè®¾ç½®å®¢æˆ·ç«¯çš„è¿‡ç¨‹ã€‚ </li></ul><br><h4> æˆ‘æƒ³è¯¦ç»†è€ƒè™‘çš„æ˜¯ï¼š </h4><br><ul><li>  Kubernetesé›†ç¾¤éƒ¨ç½²çš„åˆ†æ­¥è¿‡ç¨‹ã€‚ æˆ‘å°†ä½¿ç”¨kubeadmã€‚ ä½†æ˜¯åŒæ—¶ï¼Œæˆ‘å°†é€æ­¥è¯¦ç»†åœ°ä»‹ç»åœ¨è£¸æœºä¸Šå®‰è£…é›†ç¾¤ï¼Œå„ç§ç±»å‹çš„ETCDå®‰è£…ä»¥åŠä¸ºkube adminaé…ç½®æ–‡ä»¶çš„è¿‡ç¨‹ã€‚ æˆ‘å°†å°è¯•é˜æ˜Ingressæ§åˆ¶å™¨çš„æ‰€æœ‰å¹³è¡¡é€‰é¡¹ä»¥åŠå·¥ä½œèŠ‚ç‚¹å¯¹æœåŠ¡å™¨apiçš„å„ç§è®¿é—®æ–¹æ¡ˆçš„å·®å¼‚ã€‚ <br> æˆ‘çŸ¥é“ä»Šå¤©æœ‰å¾ˆå¤šå¾ˆæ£’çš„å·¥å…·æ¥éƒ¨ç½²kubernetesï¼Œä¾‹å¦‚kubesprayæˆ–åŒä¸€ä¸ªç‰§åœºä¸»ã€‚ ä¹Ÿè®¸æœ‰äººä½¿ç”¨å®ƒä»¬ä¼šæ›´æ–¹ä¾¿ã€‚ ä½†æ˜¯ï¼Œæˆ‘è®¤ä¸ºï¼Œæœ‰å¾ˆå¤šå·¥ç¨‹å¸ˆæƒ³æ›´è¯¦ç»†åœ°è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚ </li><li>  CEPHæœ¯è¯­å’ŒCEPHç¾¤é›†çš„é€æ­¥å®‰è£…ï¼Œä»¥åŠå°†cephå­˜å‚¨è¿æ¥åˆ°Kubernetesåˆ›å»ºçš„ç¾¤é›†çš„é€æ­¥è¯´æ˜ã€‚ </li><li> æœ¬åœ°å­˜å‚¨ï¼Œä¸kubernetesé›†ç¾¤çš„è¿æ¥ä»¥åŠä¸hostpathç­‰è¿æ¥çš„åŒºåˆ« </li><li>  kubernetesæ“ä½œå‘˜å’ŒPercona XtraDB Clusterçš„éƒ¨ç½²åœ¨æ“ä½œå‘˜çš„å¸®åŠ©ä¸‹ï¼Œå¹¶åœ¨å…­ä¸ªæœˆçš„ç”Ÿäº§ç»éªŒåå°è¯•è°ˆè®ºè¿™ç§è§£å†³æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ã€‚ æˆ‘è¿˜å°†åˆ†äº«ä¸€äº›æœ€ç»ˆç¡®å®šperconaæ“ä½œå‘˜çš„è®¡åˆ’ã€‚ </li></ul><br><h2> ç›®å½•ï¼š </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸»æœºï¼Œä¸»æœºèµ„æºï¼Œæ“ä½œç³»ç»Ÿå’Œè½¯ä»¶ç‰ˆæœ¬çš„åˆ—è¡¨</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetesé›†ç¾¤HAå›¾</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¼€å§‹ä¹‹å‰æˆ–å¼€å§‹ä¹‹å‰</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¡«å†™create-config.shæ–‡ä»¶</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ“ä½œç³»ç»Ÿå†…æ ¸æ›´æ–°</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‡†å¤‡èŠ‚ç‚¹å®‰è£…Kubeletï¼ŒKubectlï¼ŒKubeadmå’ŒDocker</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…ETCDï¼ˆå„ç§é€‰ä»¶ï¼‰</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯åŠ¨ç¬¬ä¸€ä¸ªKuberneteså‘å¯¼</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CNI Callicoå®‰è£…</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯åŠ¨ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªkuberneteså‘å¯¼</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†å·¥ä½œèŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨ç”¨äºHAçš„å·¥ä½œç¨‹åºèŠ‚ç‚¹ä¸Šå®‰è£…haproxy</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…å…¥å£æ§åˆ¶å™¨</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…Web UIï¼ˆä»ªè¡¨æ¿ï¼‰</a> </li></ol><br><a name="vm"></a><br><h2> ä¸»æœºåˆ—è¡¨å’Œç›®çš„åœ° </h2><br><p> æˆ‘é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å°†ä½äºè™šæ‹Ÿæœºä¸Šï¼Œè¯¥è™šæ‹Ÿæœºä¸Šé¢„è£…æœ‰Debian 9 Stretchç³»ç»Ÿï¼Œå†…æ ¸ä¸º4.19.0-0.bpo.5-amd64ã€‚ å¯¹äºè™šæ‹ŸåŒ–ï¼Œæˆ‘ä½¿ç”¨Proxmox VEã€‚ </p><br><h4> è¡¨VMåŠå…¶æ€§èƒ½ç‰¹å¾ï¼š </h4><br><div class="scrollable-table"><table><tbody><tr><th>  <b>åç§°</b> </th><th>  <b>IPåœ°å€</b> </th><th>  <b>ç•™è¨€</b> </th><th>  <b>ä¸­å¤®å¤„ç†å™¨</b> </th><th>  <b>m</b> </th><th>  <b>ç£ç›˜1</b> </th><th>  <b>ç¢Ÿ2</b> </th></tr><tr><td>  master01 </td><td>  10.73.71.25 </td><td> ä¸»èŠ‚ç‚¹ </td><td>  4vcpu </td><td>  4GB </td><td> ç¡¬ç¢Ÿ </td><td>  --- </td></tr><tr><td>  master02 </td><td>  10.73.71.26 </td><td> ä¸»èŠ‚ç‚¹ </td><td>  4vcpu </td><td>  4GB </td><td> ç¡¬ç¢Ÿ </td><td>  --- </td></tr><tr><td> å¤§å¸ˆ03 </td><td>  10.73.71.27 </td><td> ä¸»èŠ‚ç‚¹ </td><td>  4vcpu </td><td>  4GB </td><td> ç¡¬ç¢Ÿ </td><td>  --- </td></tr><tr><td>  worknode01 </td><td>  10.73.75.241 </td><td> å·¥ä½œèŠ‚ç‚¹ </td><td>  4vcpu </td><td>  4GB </td><td> ç¡¬ç¢Ÿ </td><td> å›ºæ€ç¡¬ç›˜ </td></tr><tr><td>  worknode02 </td><td>  10.73.75.242 </td><td> å·¥ä½œèŠ‚ç‚¹ </td><td>  4vcpu </td><td>  4GB </td><td> ç¡¬ç¢Ÿ </td><td> å›ºæ€ç¡¬ç›˜ </td></tr><tr><td>  worknode03 </td><td>  10.73.75.243 </td><td> å·¥ä½œèŠ‚ç‚¹ </td><td>  4vcpu </td><td>  4GB </td><td> ç¡¬ç¢Ÿ </td><td> å›ºæ€ç¡¬ç›˜ </td></tr></tbody></table></div><br><p> ä¸å¿…åªå…·æœ‰è¿™æ ·çš„æœºå™¨é…ç½®ï¼Œä½†æ˜¯æˆ‘ä»ç„¶å»ºè®®æ‚¨éµå®ˆ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£</a>çš„å»ºè®®ï¼Œå¯¹äºä¸»æœåŠ¡å™¨ï¼Œè¯·å°†RAMçš„å®¹é‡å¢åŠ åˆ°è‡³å°‘4GBã€‚ å±•æœ›æœªæ¥ï¼Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œåœ¨CNI Callicoçš„å·¥ä½œä¸­ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›å°é—®é¢˜ <br> åœ¨å†…å­˜å’Œç£ç›˜æ€§èƒ½æ–¹é¢ï¼ŒCephä¹Ÿéå¸¸è´ªå©ªã€‚ <br> æˆ‘ä»¬çš„ç”Ÿäº§å®‰è£…æ— éœ€ä½¿ç”¨è£¸æœºè™šæ‹ŸåŒ–å³å¯å·¥ä½œï¼Œä½†æˆ‘çŸ¥é“è®¸å¤šç¤ºä¾‹ï¼Œå…¶ä¸­å…·æœ‰ç›¸å½“é€‚åº¦èµ„æºçš„è™šæ‹Ÿæœºå°±è¶³å¤Ÿäº†ã€‚ è¿™å®Œå…¨å–å†³äºæ‚¨çš„éœ€æ±‚å’Œå·¥ä½œé‡ã€‚ </p><br><h2> æ¸…å•å’Œè½¯ä»¶ç‰ˆæœ¬ </h2><br><div class="scrollable-table"><table><tbody><tr><th>  <b>åç§°</b> </th><th>  <b>ç‰ˆæœ¬å·</b> </th></tr><tr><td>  Kubernetes </td><td>  1.15.1 </td></tr><tr><td> ç å¤´å·¥äºº </td><td>  19.3.1 </td></tr></tbody></table></div><br><p> ä»1.14ç‰ˆå¼€å§‹ï¼ŒKubeadmä¸å†æ”¯æŒv1alpha3 APIç‰ˆæœ¬ï¼Œå¹¶å®Œå…¨åˆ‡æ¢åˆ°äº†v1beta1 APIç‰ˆæœ¬ï¼Œå®ƒå°†åœ¨ä¸ä¹…çš„å°†æ¥æ”¯æŒè¯¥ç‰ˆæœ¬ï¼Œå› æ­¤åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä»…è®¨è®ºv1beta1ã€‚ <br> å› æ­¤ï¼Œæˆ‘ä»¬ç›¸ä¿¡æ‚¨å·²ç»ä¸ºkubernetesé›†ç¾¤å‡†å¤‡äº†æœºå™¨ã€‚ å®ƒä»¬éƒ½å¯ä»¥é€šè¿‡ç½‘ç»œç›¸äº’è®¿é—®ï¼Œå¹¶å…·æœ‰ä¸Internetçš„â€œ Internetè¿æ¥â€ï¼Œå¹¶ä¸”å·²å®‰è£…â€œå¹²å‡€â€æ“ä½œç³»ç»Ÿã€‚ <br> å¯¹äºæ¯ä¸ªå®‰è£…æ­¥éª¤ï¼Œæˆ‘å°†é˜æ˜å‘½ä»¤æˆ–å‘½ä»¤å—åœ¨å“ªäº›æœºå™¨ä¸Šæ‰§è¡Œã€‚ é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™ä»¥rootç”¨æˆ·èº«ä»½æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ã€‚ <br> æ‰€æœ‰é…ç½®æ–‡ä»¶ä»¥åŠå‡†å¤‡è„šæœ¬å‡å¯ä»¥åœ¨æˆ‘çš„<a href="">githubä¸­</a>ä¸‹è½½ <br> å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚ </p><br><a name="ha-image"></a><br><h2>  Kubernetesé›†ç¾¤HAå›¾ </h2><br><p><img src="https://habrastorage.org/webt/ch/mx/pg/chmxpgzdyk0bvxwx7-6lawqfmvo.jpeg"><br>  HAç¾¤é›†çš„è¿‘ä¼¼å›¾ã€‚ è€å®è¯´ï¼Œæˆ‘çš„ç”»å®¶å¾ˆä¸€èˆ¬ï¼Œä½†æˆ‘ä¼šå°è¯•ç®€å•åœ°è¿›è¡Œç®€å•åœ°è§£é‡Šï¼Œè€Œæ— éœ€ç‰¹åˆ«ç ”ç©¶ç†è®ºã€‚ <br> å› æ­¤ï¼Œæˆ‘ä»¬çš„é›†ç¾¤å°†ç”±ä¸‰ä¸ªä¸»èŠ‚ç‚¹å’Œä¸‰ä¸ªå·¥ä½œèŠ‚ç‚¹ç»„æˆã€‚ åœ¨æ¯ä¸ªkubernetesä¸»èŠ‚ç‚¹ä¸Šï¼Œetcdï¼ˆå›¾ä¸­çš„ç»¿è‰²ç®­å¤´ï¼‰å’ŒkubernetesæœåŠ¡éƒ¨ä»¶å°†ä¸ºæˆ‘ä»¬å·¥ä½œã€‚ è®©æˆ‘ä»¬é€šç§°å®ƒä»¬-kubeapiã€‚ <br> é€šè¿‡etcdä¸»ç¾¤é›†ï¼ŒèŠ‚ç‚¹äº¤æ¢kubernetesç¾¤é›†çš„çŠ¶æ€ã€‚ æˆ‘å°†æŒ‡ç¤ºä¸ç”¨äºå¤–éƒ¨æµé‡çš„å…¥å£æ§åˆ¶å™¨å…¥å£ç‚¹ç›¸åŒçš„åœ°å€ï¼ˆå›¾ä¸­çš„çº¢è‰²ç®­å¤´ï¼‰ <br> åœ¨å·¥ä½œç¨‹åºèŠ‚ç‚¹ä¸Šï¼Œkubeletä¸ºæˆ‘ä»¬å·¥ä½œï¼Œå®ƒé€šè¿‡åœ¨æ¯ä¸ªå·¥ä½œç¨‹åºèŠ‚ç‚¹ä¸Šæœ¬åœ°å®‰è£…çš„haproxyä¸kubernetes apiæœåŠ¡å™¨é€šä¿¡ã€‚ ä½œä¸ºkubeletçš„æœåŠ¡å™¨apiåœ°å€ï¼Œæˆ‘å°†ä½¿ç”¨localhost 127.0.0.1:6443ï¼Œè€Œroundrobinä¸Šçš„haproxyä¼šå°†è¯·æ±‚åˆ†æ•£åˆ°ä¸‰ä¸ªä¸»èŠ‚ç‚¹ä¸Šï¼Œå®ƒè¿˜å°†æ£€æŸ¥ä¸»èŠ‚ç‚¹çš„å¯ç”¨æ€§ã€‚ è¯¥æ–¹æ¡ˆå°†å…è®¸æˆ‘ä»¬åˆ›å»ºHAï¼Œå¹¶ä¸”åœ¨ä¸»èŠ‚ç‚¹ä¹‹ä¸€å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼Œå·¥ä½œèŠ‚ç‚¹å°†æ‚„æ‚„åœ°å‘å…¶ä½™ä¸¤ä¸ªä¸»èŠ‚ç‚¹å‘é€è¯·æ±‚ã€‚ </p><br><a name="begin"></a><br><h2> å¼€å§‹ä¹‹å‰ </h2><br><p> åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¼€å§‹å·¥ä½œä¹‹å‰ï¼Œæˆ‘ä»¬å°†æä¾›éœ€è¦å·¥ä½œçš„è½¯ä»¶åŒ…ï¼š </p><br><pre><code class="plaintext hljs">apt-get update &amp;&amp; apt-get install -y curl apt-transport-https git</code> </pre> <br><p> åœ¨ä¸»èŠ‚ç‚¹ä¸Šï¼Œä½¿ç”¨é…ç½®æ¨¡æ¿å¤åˆ¶å­˜å‚¨åº“ </p><br><pre> <code class="plaintext hljs">sudo -i git clone https://github.com/rjeka/kubernetes-ceph-percona.git</code> </pre> <br><p> æ£€æŸ¥å‘å¯¼ä¸Šä¸»æœºçš„ipåœ°å€æ˜¯å¦ä¸kubernetesæœåŠ¡å™¨å°†åœ¨å…¶ä¸Šä¾¦å¬çš„IPåœ°å€åŒ¹é… </p><br><pre> <code class="plaintext hljs">hostname &amp;&amp; hostname -i master01 10.73.71.25</code> </pre> <br><p> å¯¹äºæ‰€æœ‰ä¸»èŠ‚ç‚¹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ </p><br><p> ç¡®ä¿ç¦ç”¨SWAPï¼Œå¦åˆ™kubeadmå°†å¼•å‘é”™è¯¯ </p><br><pre> <code class="plaintext hljs">[ERROR Swap]: running with swap on is not supported. Please disable swap</code> </pre> <br><p> æ‚¨å¯ä»¥ç¦ç”¨å‘½ä»¤ </p><br><pre> <code class="plaintext hljs">swapoff -a</code> </pre> <br><p> è®°å¾—åœ¨/ etc / fstabä¸­å‘è¡¨è¯„è®º </p><br><a name="create-config"></a><br><h2> å¡«å†™create-config.shæ–‡ä»¶ </h2><br><p> ä¸ºäº†è‡ªåŠ¨å¡«å†™å®‰è£…kubernetesé›†ç¾¤æ‰€éœ€çš„é…ç½®ï¼Œæˆ‘ä¸Šä¼ äº†ä¸€ä¸ªå°è„šæœ¬create-config.shã€‚ æ‚¨å®é™…ä¸Šéœ€è¦å¡«å†™8è¡Œã€‚ æŒ‡ç¤ºä¸»æœºçš„IPåœ°å€å’Œä¸»æœºåã€‚ å¹¶ä¸”è¿˜æŒ‡å®šetcd tockenï¼Œæ‚¨ä¸èƒ½æ›´æ”¹å®ƒã€‚ æˆ‘å°†åœ¨è„šæœ¬çš„ä¸‹é¢æä¾›æ‚¨éœ€è¦è¿›è¡Œæ›´æ”¹çš„éƒ¨åˆ†ã€‚ </p><br><pre> <code class="plaintext hljs">#!/bin/bash ####################################### # all masters settings below must be same ####################################### # master01 ip address export K8SHA_IP1=10.73.71.25 # master02 ip address export K8SHA_IP2=10.73.71.26 # master03 ip address export K8SHA_IP3=10.73.71.27 # master01 hostname export K8SHA_HOSTNAME1=master01 # master02 hostname export K8SHA_HOSTNAME2=master02 # master03 hostname export K8SHA_HOSTNAME3=master03 #etcd tocken: export ETCD_TOKEN=9489bf67bdfe1b3ae077d6fd9e7efefd #etcd version export ETCD_VERSION="v3.3.10"</code> </pre><br><a name="kernel"></a><br><h2> æ“ä½œç³»ç»Ÿå†…æ ¸æ›´æ–° </h2><br><p> æ­¤æ­¥éª¤æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºéœ€è¦ä»åç«¯å£æ›´æ–°å†…æ ¸ï¼Œè€Œè¿™æ ·åšçš„é£é™©å’Œé£é™©ç”±æ‚¨è‡ªå·±æ‰¿æ‹…ã€‚ ä¹Ÿè®¸æ‚¨æ°¸è¿œä¸ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸”å¦‚æœè¿™æ ·åšï¼Œå³ä½¿éƒ¨ç½²äº†kubernetesï¼Œä¹Ÿå¯ä»¥æ›´æ–°å†…æ ¸ã€‚ é€šå¸¸ï¼Œç”±æ‚¨å†³å®šã€‚ <br> éœ€è¦å†…æ ¸æ›´æ–°æ‰èƒ½ä¿®å¤æ—§çš„Dockeré”™è¯¯ï¼Œè¯¥é”™è¯¯ä»…åœ¨Linuxå†…æ ¸ç‰ˆæœ¬4.18ä¸­å¾—åˆ°ä¿®å¤ã€‚ æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a>é˜…è¯»æœ‰å…³æ­¤é”™è¯¯çš„æ›´å¤šä¿¡æ¯ã€‚ åœ¨kubernetesèŠ‚ç‚¹ä¸Šç½‘ç»œæ¥å£çš„å®šæœŸæŒ‚èµ·ä¸­è¡¨è¾¾äº†ä¸€ä¸ªé”™è¯¯ï¼Œé”™è¯¯ä¸ºï¼š </p><br><pre> <code class="plaintext hljs">waiting for eth0 to become free. Usage count = 1</code> </pre> <br><p> å®‰è£…æ“ä½œç³»ç»Ÿåï¼Œæˆ‘çš„å†…æ ¸ç‰ˆæœ¬ä¸º4.9 </p><br><pre> <code class="bash hljs">uname -a Linux master01 4.9.0-7-amd64 <span class="hljs-comment"><span class="hljs-comment">#1 SMP Debian 4.9.110-3+deb9u2 (2018-08-13) x86_64 GNU/Linux</span></span></code> </pre> <br><p> åœ¨æ¯å°æœºå™¨ä¸Šæ‰§è¡Œkubernetes <br> æ­¥éª¤1 <br> å°†ç«¯å£æ·»åŠ å›æºåˆ—è¡¨ </p><br><pre> <code class="plaintext hljs">echo deb http://ftp.debian.org/debian stretch-backports main &gt; /etc/apt/sources.list apt-get update apt-cache policy linux-compiler-gcc-6-x86</code> </pre> <br><p> æ­¥éª¤2 <br> å¥—ä»¶å®‰è£… </p><br><pre> <code class="plaintext hljs">apt install -y -t stretch-backports linux-image-amd64 linux-headers-amd64</code> </pre> <br><p> æ­¥éª¤3 <br> é‡æ–°å¼€æœº </p><br><pre> <code class="plaintext hljs">reboot</code> </pre> <br><p> æ£€æŸ¥ä¸€åˆ‡æ­£å¸¸ </p><br><pre> <code class="plaintext hljs">uname -a Linux master01 4.19.0-0.bpo.5-amd64 #1 SMP Debian 4.19.37-4~bpo9+1 (2019-06-19) x86_64 GNU/Linux</code> </pre><br><a name="kubelet"></a><br><h2> å‡†å¤‡èŠ‚ç‚¹å®‰è£…Kubeletï¼ŒKubectlï¼ŒKubeadmå’ŒDocker </h2><br><h4> å®‰è£…Kubeletï¼ŒKubectlï¼ŒKubeadm </h4><br><p> æ ¹æ®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubernetes</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£ï¼Œ</a>æˆ‘ä»¬æ”¾ç½®äº†é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ </p><br><pre> <code class="plaintext hljs">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF apt-get update apt-get install -y kubelet kubeadm kubectl apt-mark hold kubelet kubeadm kubectl</code> </pre> <br><h4> å®‰è£…Docker </h4><br><p> æ ¹æ®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£ä¸­</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯´æ˜</a>å®‰è£…docker <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><br></a> </p><br><pre> <code class="plaintext hljs">apt-get remove docker docker-engine docker.io containerd runc apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common</code> </pre> <br><pre> <code class="plaintext hljs">curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add - apt-key fingerprint 0EBFCD88</code> </pre> <br><pre> <code class="plaintext hljs">add-apt-repository \ "deb [arch=amd64] https://download.docker.com/linux/debian \ $(lsb_release -cs) \ stable"</code> </pre> <br><pre> <code class="plaintext hljs">apt-get update apt-get install docker-ce docker-ce-cli containerd.io</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å®‰è£…ä½¿ç”¨Ansibleå®‰è£…Kubeletï¼ŒKubectlï¼ŒKubeadmå’Œdocker</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">git clone https://github.com/rjeka/kubernetes-ceph-percona.git cd kubernetes-ceph-percona/playbooks vim masters.ini</code> </pre> <br><p> åœ¨mastersç»„ä¸­ï¼Œæ³¨å†Œip masterã€‚ <br> åœ¨workerç»„ä¸­ï¼Œç¼–å†™å·¥ä½œèŠ‚ç‚¹çš„ipã€‚ </p><br><pre> <code class="plaintext hljs"># sudo c  ansible-playbook -i hosts.ini kubelet.yaml -K ansible-playbook -i hosts.ini docker.yaml -K # sudo  ansible-playbook -i hosts.ini kubelet.yaml ansible-playbook -i hosts.ini docker.yaml</code> </pre> </div></div><br><p> å¦‚æœå‡ºäºæŸç§åŸå› æ‚¨ä¸æƒ³ä½¿ç”¨dockerï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»»ä½•CRIã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a>é˜…è¯»æœ‰å…³å†…å®¹ï¼Œä½†æ˜¯è¯¥ä¸»é¢˜ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´ä¹‹å†…ã€‚ </p><br><a name="etcd"></a><br><h2>  ETCDå®‰è£… </h2><br><p> ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä¸ä¼šæ·±å…¥åˆ°ç†è®ºä¸Šï¼šetcdæ˜¯ä¸€ç§å¼€æºçš„åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ã€‚  etcdå®é™…ä¸Šæ˜¯ç”¨GOç¼–å†™çš„ï¼Œå¹¶åœ¨kubernetesä¸­ç”¨ä½œå­˜å‚¨é›†ç¾¤çŠ¶æ€çš„æ•°æ®åº“ã€‚ æœ‰å…³æ›´è¯¦ç»†çš„è¯„è®ºï¼Œè¯·å‚é˜…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubernetesæ–‡æ¡£</a> ã€‚ <br>  etcdå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®‰è£…ã€‚ æ‚¨å¯ä»¥åœ¨æœ¬åœ°å®‰è£…å®ƒå¹¶ä½œä¸ºå®ˆæŠ¤ç¨‹åºè¿è¡Œï¼Œå¯ä»¥åœ¨dockerå®¹å™¨ä¸­è¿è¡Œå®ƒï¼Œç”šè‡³å¯ä»¥å°†å…¶å®‰è£…ä¸ºkubernetes podã€‚ æ‚¨å¯ä»¥æ‰‹åŠ¨å®‰è£…å®ƒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨kubeadmå®‰è£…å®ƒï¼ˆæˆ‘æ²¡æœ‰å°è¯•è¿‡è¿™ç§æ–¹æ³•ï¼‰ã€‚ å¯ä»¥å®‰è£…åœ¨ç¾¤é›†è®¡ç®—æœºæˆ–å•ä¸ªæœåŠ¡å™¨ä¸Šã€‚ <br> æˆ‘å°†åœ¨ä¸»èŠ‚ç‚¹ä¸Šæœ¬åœ°å®‰è£…etcdå¹¶é€šè¿‡systemdä½œä¸ºå®ˆæŠ¤ç¨‹åºè¿è¡Œï¼Œä»¥åŠè€ƒè™‘åœ¨dockerä¸­å®‰è£…ã€‚ æˆ‘ä½¿ç”¨æ²¡æœ‰TLSçš„etcdï¼Œå¦‚æœæ‚¨éœ€è¦TLSï¼Œè¯·å‚è€ƒetcdæˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubernetesæœ¬èº«</a>çš„æ–‡æ¡£ <br> åŒæ ·åœ¨æˆ‘çš„githubä¸­å°†æœ‰ä¸€ä¸ªansible-playbookï¼Œç”¨äºé€šè¿‡systemdå¯åŠ¨å®‰è£…etcdã€‚ </p><br><h4> é€‰ä»¶ç¼–å·1 <br> æœ¬åœ°å®‰è£…ï¼Œé€šè¿‡systemdè¿è¡Œ </h4><br><p> åœ¨æ‰€æœ‰ä¸»æœåŠ¡å™¨ä¸Šï¼šï¼ˆåœ¨é›†ç¾¤çš„å·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œæ— éœ€æ‰§è¡Œæ­¤æ­¥éª¤ï¼‰ <br> æ­¥éª¤1 <br> ä½¿ç”¨etcdä¸‹è½½æ¡£æ¡ˆå¹¶è§£å‹ç¼©ï¼š </p><br><pre> <code class="plaintext hljs">mkdir archives cd archives export etcdVersion=v3.3.10 wget https://github.com/coreos/etcd/releases/download/$etcdVersion/etcd-$etcdVersion-linux-amd64.tar.gz tar -xvf etcd-$etcdVersion-linux-amd64.tar.gz -C /usr/local/bin/ --strip-components=1</code> </pre> <br><p> æ­¥éª¤2 <br> ä¸ºETCDåˆ›å»ºé…ç½®æ–‡ä»¶ </p><br><pre> <code class="plaintext hljs">cd .. ./create-config.sh etcd</code> </pre> <br><p> è¯¥è„šæœ¬æ¥å—etcdçš„å€¼ä½œä¸ºè¾“å…¥ï¼Œå¹¶åœ¨etcdç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚ è„šæœ¬è¿è¡Œåï¼Œå®Œæˆçš„é…ç½®æ–‡ä»¶å°†ä½äºetcdç›®å½•ä¸­ã€‚ <br> å¯¹äºæ‰€æœ‰å…¶ä»–é…ç½®ï¼Œè„šæœ¬æŒ‰ç›¸åŒåŸç†å·¥ä½œã€‚ å®ƒéœ€è¦ä¸€äº›è¾“å…¥å¹¶åœ¨ç‰¹å®šç›®å½•ä¸­åˆ›å»ºé…ç½®ã€‚ </p><br><p> æ­¥éª¤3 <br> æˆ‘ä»¬å¯åŠ¨etcdé›†ç¾¤å¹¶æ£€æŸ¥å…¶æ€§èƒ½ </p><br><pre> <code class="plaintext hljs">systemctl start etcd</code> </pre> <br><p> æ£€æŸ¥å®ˆæŠ¤ç¨‹åºçš„æ€§èƒ½ </p><br><pre> <code class="plaintext hljs">systemctl status etcd â— etcd.service - etcd Loaded: loaded (/etc/systemd/system/etcd.service; disabled; vendor preset: enabled) Active: active (running) since Sun 2019-07-07 02:34:28 MSK; 4min 46s ago Docs: https://github.com/coreos/etcd Main PID: 7471 (etcd) Tasks: 14 (limit: 4915) CGroup: /system.slice/etcd.service â””â”€7471 /usr/local/bin/etcd --name master01 --data-dir /var/lib/etcd --listen-client-urls http://0.0.0.0:2379,http://0.0.0.0:4001 --advertise-client-urls http://10.73.71.25:2379,http://10.73.71. Jul 07 02:34:28 master01 etcd[7471]: b11e73358a31b109 [logterm: 1, index: 3, vote: 0] cast MsgVote for f67dd9aaa8a44ab9 [logterm: 2, index: 5] at term 554 Jul 07 02:34:28 master01 etcd[7471]: raft.node: b11e73358a31b109 elected leader f67dd9aaa8a44ab9 at term 554 Jul 07 02:34:28 master01 etcd[7471]: published {Name:master01 ClientURLs:[http://10.73.71.25:2379 http://10.73.71.25:4001]} to cluster d0979b2e7159c1e6 Jul 07 02:34:28 master01 etcd[7471]: ready to serve client requests Jul 07 02:34:28 master01 etcd[7471]: serving insecure client requests on [::]:4001, this is strongly discouraged! Jul 07 02:34:28 master01 systemd[1]: Started etcd. Jul 07 02:34:28 master01 etcd[7471]: ready to serve client requests Jul 07 02:34:28 master01 etcd[7471]: serving insecure client requests on [::]:2379, this is strongly discouraged! Jul 07 02:34:28 master01 etcd[7471]: set the initial cluster version to 3.3 Jul 07 02:34:28 master01 etcd[7471]: enabled capabilities for version 3.3 lines 1-19</code> </pre> <br><p> é›†ç¾¤æœ¬èº«çš„å¥åº·çŠ¶å†µï¼š </p><br><pre> <code class="plaintext hljs">etcdctl cluster-health member 61db137992290fc is healthy: got healthy result from http://10.73.71.27:2379 member b11e73358a31b109 is healthy: got healthy result from http://10.73.71.25:2379 member f67dd9aaa8a44ab9 is healthy: got healthy result from http://10.73.71.26:2379 cluster is healthy etcdctl member list 61db137992290fc: name=master03 peerURLs=http://10.73.71.27:2380 clientURLs=http://10.73.71.27:2379,http://10.73.71.27:4001 isLeader=false b11e73358a31b109: name=master01 peerURLs=http://10.73.71.25:2380 clientURLs=http://10.73.71.25:2379,http://10.73.71.25:4001 isLeader=false f67dd9aaa8a44ab9: name=master02 peerURLs=http://10.73.71.26:2380 clientURLs=http://10.73.71.26:2379,http://10.73.71.26:4001 isLeader=true</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">ä½¿ç”¨Ansibleåœ¨æœ¬åœ°å®‰è£…etcdï¼Œå¹¶é€šè¿‡systemdè¿è¡Œ</b> <div class="spoiler_text"><p> ä½¿ç”¨githubï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»£ç å°†å­˜å‚¨åº“å…‹éš†åˆ°å°†è¦ä»å…¶è¿è¡Œå‰§æœ¬çš„æœºå™¨ä¸Šã€‚ è¿™å°æœºå™¨åº”è¯¥å¯¹å°†æ¥çš„é›†ç¾¤çš„ä¸»æœåŠ¡å™¨å…·æœ‰sshè®¿é—®æƒé™ã€‚ </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/rjeka/kubernetes-ceph-percona.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> kubernetes-ceph-percona/playbooks vim masters.ini</code> </pre> <br><p> åœ¨mastersç»„ä¸­ï¼Œæ³¨å†Œip masterã€‚ <br>  etcd_versionæ˜¯etcdçš„ç‰ˆæœ¬ã€‚ æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨github</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">etcdé¡µé¢</a>ä¸Šçœ‹åˆ°å®ƒã€‚ åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæˆ‘æ­£åœ¨ä½¿ç”¨v3.3.10ç‰ˆæœ¬ã€‚ <br>  etcdToken-æ‚¨å¯ä»¥ä¿ç•™åŸæ ·ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç”Ÿæˆã€‚ <br> ç»è¥å‰§æœ¬å›¢é˜Ÿ </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sudo c  ansible-playbook -i hosts.ini -l masters etcd.yaml -K BECOME password: &lt;sudo &gt; # sudo  ansible-playbook -i hosts.ini -l masters etcd.yaml</span></span></code> </pre> </div></div><br><p> å¦‚æœè¦åœ¨dockerä¸­è¿è¡Œetcdï¼Œåˆ™æ‰°æµæ¿ä¸‹é¢æœ‰ä¸€æ¡æŒ‡ä»¤ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä½¿ç”¨docker-composeå®‰è£…etcdï¼Œåœ¨dockerä¸­å¯åŠ¨</b> <div class="spoiler_text"><p> è¿™äº›å‘½ä»¤å¿…é¡»åœ¨æ‰€æœ‰ç¾¤é›†ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚ <br> ä½¿ç”¨githubï¼Œæˆ‘ä»¬ä½¿ç”¨ä»£ç å…‹éš†å­˜å‚¨åº“ </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/rjeka/kubernetes-ceph-percona.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> kubernetes-ceph-percona</code> </pre> <br><p>  etcd_versionæ˜¯etcdçš„ç‰ˆæœ¬ã€‚ æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨github</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">etcdé¡µé¢</a>ä¸Šçœ‹åˆ°å®ƒã€‚ åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæˆ‘æ­£åœ¨ä½¿ç”¨v3.3.10ç‰ˆæœ¬ã€‚ <br>  etcdToken-æ‚¨å¯ä»¥ä¿ç•™åŸæ ·ï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç”Ÿæˆã€‚ </p><br><p> æˆ‘ä»¬æŠŠdocker-compose </p><br><pre> <code class="plaintext hljs">apt-get install -y docker-compose</code> </pre> <br><p> æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªé…ç½® </p><br><pre> <code class="plaintext hljs">./create-config.sh docker</code> </pre> <br><p> åœ¨Dockerä¸­è¿è¡Œetcdé›†ç¾¤çš„å®‰è£… </p><br><pre> <code class="plaintext hljs">docker-compose --file etcd-docker/docker-compose.yaml up -d</code> </pre> <br><p> æ£€æŸ¥å®¹å™¨æ˜¯å¦å·²è£…å¥½ </p><br><pre> <code class="plaintext hljs">docker ps</code> </pre> <br><p> å’Œé›†ç¾¤çŠ¶æ€ç­‰ </p><br><pre> <code class="plaintext hljs">root@master01:~/kubernetes-ceph-percona# docker exec -ti etcd etcdctl cluster-health member 61db137992290fc is healthy: got healthy result from http://10.73.71.27:2379 member b11e73358a31b109 is healthy: got healthy result from http://10.73.71.25:2379 member f67dd9aaa8a44ab9 is healthy: got healthy result from http://10.73.71.26:2379 cluster is healthy root@master01:~/kubernetes-ceph-percona# docker exec -ti etcd etcdctl member list 61db137992290fc: name=etcd3 peerURLs=http://10.73.71.27:2380 clientURLs=http://10.73.71.27:2379,http://10.73.71.27:4001 isLeader=false b11e73358a31b109: name=etcd1 peerURLs=http://10.73.71.25:2380 clientURLs=http://10.73.71.25:2379,http://10.73.71.25:4001 isLeader=true f67dd9aaa8a44ab9: name=etcd2 peerURLs=http://10.73.71.26:2380 clientURLs=http://10.73.71.26:2379,http://10.73.71.26:4001 isLeader=false</code> </pre> <br><p> å¦‚æœå‡ºäº†ä»€ä¹ˆé—®é¢˜ </p><br><pre> <code class="plaintext hljs">docker logs etcd</code> </pre> </div></div><br><a name="master-one"></a><br><h2> å¯åŠ¨ç¬¬ä¸€ä¸ªKuberneteså‘å¯¼ </h2><br><p> é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸ºkubeadminç”Ÿæˆä¸€ä¸ªé…ç½® </p><br><pre> <code class="plaintext hljs">./create-config.sh kubeadm</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">æˆ‘ä»¬åæ±‡ç¼–kubeadmçš„é…ç½®</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">apiVersion: kubeadm.k8s.io/v1beta1 kind: InitConfiguration localAPIEndpoint: advertiseAddress: 10.73.71.25 #    API- --- apiVersion: kubeadm.k8s.io/v1beta1 kind: ClusterConfiguration kubernetesVersion: stable #      apiServer: #    kubeadm   certSANs: - 127.0.0.1 - 10.73.71.25 - 10.73.71.26 - 10.73.71.27 controlPlaneEndpoint: 10.73.71.25 #     etcd: #  etc external: endpoints: - http://10.73.71.25:2379 - http://10.73.71.26:2379 - http://10.73.71.27:2379 networking: podSubnet: 192.168.0.0/16 #   ,   CNI  .</code> </pre> <br><p> æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubernetesæ–‡æ¡£ä¸­é˜…è¯»</a>æœ‰å…³CNIå­ç½‘çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¿¡æ¯ã€‚</a> <br> è¿™æ˜¯æœ€ä½é™åº¦çš„é…ç½®ã€‚ å¯¹äºå…·æœ‰ä¸‰ä¸ªå‘å¯¼çš„ç¾¤é›†ï¼Œå¯ä»¥å°†å…¶æ›´æ”¹ä¸ºç¾¤é›†çš„é…ç½®ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœè¦ä½¿ç”¨2ä¸ªå‘å¯¼ï¼Œåˆ™åªéœ€åœ¨certSANä¸­æŒ‡å®šä¸¤ä¸ªåœ°å€ã€‚ <br> æ‰€æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é…ç½®</a>å‚æ•°éƒ½å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubeadm APIè¯´æ˜ä¸­æ‰¾åˆ°</a> ã€‚ </p></div></div><br><p> æˆ‘ä»¬å‘èµ·ç¬¬ä¸€ä¸ªå¤§å¸ˆ </p><br><pre> <code class="plaintext hljs">kubeadm init --config=kubeadmin/kubeadm-init.yaml</code> </pre> <br><p> å¦‚æœkubeadmæ­£å¸¸è¿è¡Œï¼Œé‚£ä¹ˆåœ¨è¾“å‡ºå¤„ï¼Œæˆ‘ä»¬å°†è·å¾—å¤§çº¦ä»¥ä¸‹è¾“å‡ºï¼š </p><br><pre> <code class="plaintext hljs">You can now join any number of control-plane nodes by copying certificate authorities and service account keys on each node and then running the following as root: kubeadm join 10.73.71.25:6443 --token ivwoap.259retezqf34amx8 \ --discovery-token-ca-cert-hash sha256:b5c93e32457c8e6478782ff62e8ef77acf72738dda59cd603cdf4821abe12ca3 \ --control-plane Then you can join any number of worker nodes by running the following on each as root: kubeadm join 10.73.71.25:6443 --token ivwoap.259retezqf34amx8 \ --discovery-token-ca-cert-hash sha256:b5c93e32457c8e6478782ff62e8ef77acf72738dda59cd603cdf4821abe12ca3</code> </pre> <br><a name="callica"></a><br><h2>  CNI Calicoå®‰è£… </h2><br><p> ç°åœ¨æ˜¯æ—¶å€™å»ºç«‹ä¸€ä¸ªæˆ‘ä»¬çš„podå¯ä»¥åœ¨å…¶ä¸­å·¥ä½œçš„ç½‘ç»œã€‚ æˆ‘ä½¿ç”¨å°èŠ±å¸ƒï¼Œæˆ‘ä»¬ä¼šæ”¾ä¸Šå®ƒã€‚ <br> å¯¹äºåˆå­¦è€…ï¼Œè¯·é…ç½®kubeletçš„è®¿é—®æƒé™ã€‚ æˆ‘ä»¬åœ¨master01ä¸Šæ‰§è¡Œæ‰€æœ‰å‘½ä»¤ <br> å¦‚æœæ‚¨ä»¥rootèº«ä»½è¿è¡Œ </p><br><pre> <code class="plaintext hljs">export KUBECONFIG=/etc/kubernetes/admin.conf</code> </pre> <br><p> å¦‚æœæ¥è‡ªç®€å•ç”¨æˆ· </p><br><pre> <code class="plaintext hljs">mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config</code> </pre> <br><p> æ‚¨ä¹Ÿå¯ä»¥ä»ç¬”è®°æœ¬ç”µè„‘æˆ–ä»»ä½•æœ¬åœ°è®¡ç®—æœºä¸Šç®¡ç†ç¾¤é›†ã€‚ ä¸ºæ­¤ï¼Œè¯·å°†/etc/kubernetes/admin.confæ–‡ä»¶å¤åˆ¶åˆ°ä¾¿æºå¼è®¡ç®—æœºæˆ–$ HOME / .kube / configä¸­çš„ä»»ä½•å…¶ä»–è®¡ç®—æœºä¸Š </p><br><p> æˆ‘ä»¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ ¹æ®Kubernetesæ–‡æ¡£æ”¾ç½®äº†</a> CNI <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><br></a> </p><br><pre> <code class="plaintext hljs">kubectl apply -f https://docs.projectcalico.org/v3.8/manifests/calico.yaml</code> </pre> <br><p> æˆ‘ä»¬ç­‰åˆ°æ‰€æœ‰è±†èšå‡èµ· </p><br><pre> <code class="plaintext hljs">watch -n1 kubectl get pods -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system calico-kube-controllers-59f54d6bbc-psr2z 1/1 Running 0 96s kube-system calico-node-hm49z 1/1 Running 0 96s kube-system coredns-5c98db65d4-svcx9 1/1 Running 0 77m kube-system coredns-5c98db65d4-zdlb8 1/1 Running 0 77m kube-system kube-apiserver-master01 1/1 Running 0 76m kube-system kube-controller-manager-master01 1/1 Running 0 77m kube-system kube-proxy-nkdqn 1/1 Running 0 77m kube-system kube-scheduler-master01 1/1 Running 0 77m</code> </pre> <br><a name="mastes-other"></a><br><h2> å¯åŠ¨ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªkuberneteså‘å¯¼ </h2><br><p> åœ¨å¯åŠ¨master02å’Œmaster03ä¹‹å‰ï¼Œæ‚¨éœ€è¦ä½¿ç”¨åˆ›å»ºé›†ç¾¤æ—¶kubeadmç”Ÿæˆçš„master01å¤åˆ¶è¯ä¹¦ã€‚ æˆ‘å°†é€šè¿‡scpå¤åˆ¶ <br> åœ¨master01ä¸Š </p><br><pre> <code class="plaintext hljs">export master02=10.73.71.26 export master03=10.73.71.27 scp -r /etc/kubernetes/pki $master02:/etc/kubernetes/ scp -r /etc/kubernetes/pki $master03:/etc/kubernetes/</code> </pre> <br><p> åœ¨master02å’Œmaster03ä¸Š <br> ä¸ºkubeadmåˆ›å»ºé…ç½® </p><br><pre> <code class="plaintext hljs">./create-config.sh kubeadm</code> </pre> <br><p> å¹¶å°†master02å’Œmaster03æ·»åŠ åˆ°é›†ç¾¤ </p><br><pre> <code class="plaintext hljs">kubeadm init --config=kubeadmin/kubeadm-init.yaml</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å‡ ä¸ªç½‘ç»œæ¥å£å‡ºç°æ¯›åˆºï¼</b> <div class="spoiler_text"><p> åœ¨ç”Ÿäº§ä¸­ï¼Œæˆ‘ä½¿ç”¨kubernetes v1.13.5å’Œcalico v3.3ã€‚ è€Œä¸”æˆ‘æ²¡æœ‰è¿™æ ·çš„æ•…éšœã€‚ <br> ä½†æ˜¯åœ¨å‡†å¤‡æœ¬æ–‡å¹¶ä½¿ç”¨ç¨³å®šç‰ˆæœ¬æ—¶ï¼ˆåœ¨æ’°å†™æœ¬æ–‡æ—¶ä¸ºv1.15.1 kuberneteså’Œ3.8ç‰ˆcallicoï¼‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œè¯¥é—®é¢˜è¡¨ç¤ºä¸ºCNIå¯åŠ¨é”™è¯¯ </p><br><pre> <code class="plaintext hljs">root@master01:~/kubernetes-ceph-percona# kubectl get pods -A -w NAMESPACE NAME READY STATUS RESTARTS AGE kube-system calico-kube-controllers-658558ddf8-t6gfs 0/1 ContainerCreating 0 11s kube-system calico-node-7td8g 1/1 Running 0 11s kube-system calico-node-dthg5 0/1 CrashLoopBackOff 1 11s kube-system calico-node-tvhkq 0/1 CrashLoopBackOff 1 11s</code> </pre> <br><p> å½“æœåŠ¡å™¨å…·æœ‰å¤šä¸ªç½‘ç»œæ¥å£æ—¶ï¼Œè¿™æ˜¯calicoå®ˆæŠ¤ç¨‹åºè®¾ç½®æ•…éšœ <br> åœ¨githabä¸Šï¼Œæ­¤æ•…éšœæœ‰ä¸€ä¸ªé—®é¢˜<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/projectcalico/calico/issues/2720</a> <br> é€šè¿‡ç¼–è¾‘å®ˆæŠ¤ç¨‹åºé›†calico-nodeå¹¶å°†IP_AUTODETECTION_METHODå‚æ•°æ·»åŠ åˆ°envæ¥è§£å†³æ­¤é—®é¢˜ã€‚ </p><br><pre> <code class="plaintext hljs">kubectl edit -n kube-system ds calico-node</code> </pre> <br><p> æ·»åŠ IP_AUTODETECTION_METHODå‚æ•°ä»¥åŠè¯¥å‘å¯¼åœ¨å…¶ä¸Šè¿è¡Œçš„æ¥å£çš„åç§°ï¼› åœ¨æˆ‘çš„æƒ…å†µä¸‹æ˜¯ens19 </p><br><pre> <code class="plaintext hljs">- name: IP_AUTODETECTION_METHOD value: ens19</code> </pre> <br><p><img src="https://habrastorage.org/webt/xe/pq/7h/xepq7hbpjwhgowfk0hkc6-ryw8a.png"><br> æ£€æŸ¥é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å‡å·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œ </p><br><pre> <code class="plaintext hljs"># kubectl get nodes NAME STATUS ROLES AGE VERSION master01 Ready master 28m v1.15.1 master02 Ready master 26m v1.15.1 master03 Ready master 18m v1.15.1</code> </pre> <br><p> æ´»ç€çš„æ°§åŒ–é’™æ˜¯ä»€ä¹ˆ </p><br><pre> <code class="plaintext hljs"># kubectl get pods -A -o wide | grep calico kube-system calico-kube-controllers-59f54d6bbc-5lxgn 1/1 Running 0 27m kube-system calico-node-fngpz 1/1 Running 1 24m kube-system calico-node-gk7rh 1/1 Running 0 8m55s kube-system calico-node-w4xtt 1/1 Running 0 25m</code> </pre> </div></div><br><a name="worknodes"></a><br><h2> å°†å·¥ä½œèŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤ </h2><br><p> ç›®å‰ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé›†ç¾¤ï¼Œå…¶ä¸­æ­£åœ¨è¿è¡Œä¸‰ä¸ªä¸»èŠ‚ç‚¹ã€‚ ä½†æ˜¯ä¸»èŠ‚ç‚¹æ˜¯è¿è¡Œkubernetesé›†ç¾¤çš„apiï¼Œè°ƒåº¦ç¨‹åºå’Œå…¶ä»–æœåŠ¡çš„æœºå™¨ã€‚ ä¸ºäº†è¿è¡ŒPodï¼Œæˆ‘ä»¬éœ€è¦æ‰€è°“çš„å·¥ä½œç¨‹åºèŠ‚ç‚¹ã€‚ <br> å¦‚æœèµ„æºæœ‰é™ï¼Œåˆ™å¯ä»¥åœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿è¡ŒPodï¼Œä½†æˆ‘ä¸ªäººä¸å»ºè®®è¿™æ ·åšã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿è¡Œå£ç‚‰</b> <div class="spoiler_text"><p> ä¸ºäº†å…è®¸åœ¨ä¸»èŠ‚ç‚¹ä¸Šå¯åŠ¨å£ç‚‰ï¼Œè¯·åœ¨ä»»ä½•å‘å¯¼ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ </p><br><pre> <code class="plaintext hljs">kubectl taint nodes --all node-role.kubernetes.io/master-</code> </pre> </div></div><br><p> ä¸ä¸»èŠ‚ç‚¹ä¸Šä¸€æ ·ï¼Œåœ¨å·¥ä½œæœåŠ¡å™¨ä¸Šå®‰è£…kubeletï¼Œkubeadmï¼Œkubectlå’ŒdockerèŠ‚ç‚¹ </p><br><div class="spoiler">  <b class="spoiler_title">å®‰è£…kubeletï¼Œkubeadmï¼Œkubectlå’Œdocker</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF apt-get update apt-get install -y kubelet kubeadm kubectl apt-mark hold kubelet kubeadm kubectl</code> </pre> <br><h4> å®‰è£…Docker </h4><br><p> æ ¹æ®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£ä¸­</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯´æ˜</a>å®‰è£…docker <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><br></a> </p><br><pre> <code class="plaintext hljs">apt-get remove docker docker-engine docker.io containerd runc apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common</code> </pre> <br><pre> <code class="plaintext hljs">curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add - apt-key fingerprint 0EBFCD88</code> </pre> <br><pre> <code class="plaintext hljs">add-apt-repository \ "deb [arch=amd64] https://download.docker.com/linux/debian \ $(lsb_release -cs) \ stable"</code> </pre> <br><pre> <code class="plaintext hljs">apt-get update apt-get install docker-ce docker-ce-cli containerd.io</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å®‰è£…ä½¿ç”¨Ansibleå®‰è£…Kubeletï¼ŒKubectlï¼ŒKubeadmå’Œdocker</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">git clone https://github.com/rjeka/kubernetes-ceph-percona.git cd kubernetes-ceph-percona/playbooks vim masters.ini</code> </pre> <br><p> åœ¨mastersç»„ä¸­ï¼Œæ³¨å†Œip masterã€‚ <br> åœ¨workerç»„ä¸­ï¼Œç¼–å†™å·¥ä½œèŠ‚ç‚¹çš„ipã€‚ </p><br><pre> <code class="plaintext hljs"># sudo c  ansible-playbook -i hosts.ini kubelet.yaml -K ansible-playbook -i hosts.ini docker.yaml -K # sudo  ansible-playbook -i hosts.ini kubelet.yaml ansible-playbook -i hosts.ini docker.yaml</code> </pre> </div></div></div></div><br><p> ç°åœ¨è¯¥å›åˆ°æˆ‘ä»¬å®‰è£…ä¸»èŠ‚ç‚¹æ—¶kubeadmç”Ÿæˆçš„è¡Œäº†ã€‚ <br> å¥¹å¯¹æˆ‘æ¥è¯´åƒè¿™æ ·ã€‚ </p><br><pre> <code class="plaintext hljs">kubeadm join 10.73.71.25:6443 --token ivwoap.259retezqf34amx8 \ --discovery-token-ca-cert-hash sha256:b5c93e32457c8e6478782ff62e8ef77acf72738dda59cd603cdf4821abe12ca3</code> </pre> <br><p> å¿…é¡»åœ¨æ¯ä¸ªå·¥ä½œç¨‹åºèŠ‚ç‚¹ä¸Šæ‰§è¡Œæ­¤å‘½ä»¤ã€‚ <br> å¦‚æœæ‚¨å°šæœªç¼–å†™ä»¤ç‰Œï¼Œåˆ™å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ä»¤ç‰Œ </p><br><pre> <code class="plaintext hljs">kubeadm token create --print-join-command --ttl=0</code> </pre> <br><p>  kubeadmå·¥ä½œåï¼Œæ‚¨çš„æ–°èŠ‚ç‚¹å°†è¿›å…¥é›†ç¾¤å¹¶å‡†å¤‡å·¥ä½œ </p><br><pre> <code class="plaintext hljs">This node has joined the cluster: * Certificate signing request was sent to apiserver and a response was received. * The Kubelet was informed of the new secure connection details. Run 'kubectl get nodes' on the control-plane to see this node join the cluster.</code> </pre> <br><p> ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç»“æœ </p><br><pre> <code class="plaintext hljs">root@master01:~# kubectl get nodes NAME STATUS ROLES AGE VERSION master01 Ready master 10d v1.15.1 master02 Ready master 10d v1.15.1 master03 Ready master 10d v1.15.1 worknode01 Ready &lt;none&gt; 5m44s v1.15.1 worknode02 Ready &lt;none&gt; 59s v1.15.1 worknode03 Ready &lt;none&gt; 51s v1.15.1</code> </pre> <br><a name="haproxy"></a><br><h2> åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šå®‰è£…haproxy </h2><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªä¸»èŠ‚ç‚¹å’Œä¸‰ä¸ªå·¥ä½œèŠ‚ç‚¹çš„å·¥ä½œé›†ç¾¤ã€‚ <br> é—®é¢˜æ˜¯ç°åœ¨æˆ‘ä»¬çš„å·¥ä½œèŠ‚ç‚¹æ²¡æœ‰HAæ¨¡å¼ã€‚ <br> å¦‚æœæŸ¥çœ‹kubeleté…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æˆ‘ä»¬çš„å·¥ä½œèŠ‚ç‚¹ä»…è®¿é—®ä¸‰ä¸ªä¸»èŠ‚ç‚¹ä¹‹ä¸€ã€‚ </p><br><pre> <code class="plaintext hljs">root@worknode01:~# cat /etc/kubernetes/kubelet.conf | grep server: server: https://10.73.71.27:6443</code> </pre> <br><p> å°±æˆ‘è€Œè¨€ï¼Œè¿™æ˜¯master03ã€‚ ä½¿ç”¨æ­¤é…ç½®ï¼Œå¦‚æœmaster03å´©æºƒï¼Œåˆ™å·¥ä½œç¨‹åºèŠ‚ç‚¹å°†å¤±å»ä¸é›†ç¾¤APIæœåŠ¡å™¨çš„é€šä¿¡ã€‚ ä¸ºäº†ä½¿æˆ‘ä»¬çš„é›†ç¾¤å®Œå…¨å…·å¤‡é«˜å¯ç”¨æ€§ï¼Œæˆ‘ä»¬å°†åœ¨æ¯ä¸ªå·¥ä½œæœåŠ¡å™¨ä¸Šå®‰è£…ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼ˆHaproxyï¼‰ï¼Œæ ¹æ®å¾ªç¯æœºåˆ¶ï¼Œå®ƒå°†åˆ†æ•£å¯¹ä¸‰ä¸ªä¸»èŠ‚ç‚¹çš„è¯·æ±‚ï¼Œåœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šçš„kubeleté…ç½®ä¸­ï¼Œæˆ‘ä»¬ä¼šå°†æœåŠ¡å™¨åœ°å€æ›´æ”¹ä¸º127.0.0.1:6443 <br> é¦–å…ˆï¼Œåœ¨æ¯ä¸ªå·¥ä½œç¨‹åºèŠ‚ç‚¹ä¸Šå®‰è£…HAProxyã€‚ <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰ä¸€ä¸ªå¾ˆå¥½çš„å¤‡å¿˜å•å¯ä¾›å®‰è£…</a> </p><br><pre> <code class="plaintext hljs">curl https://haproxy.debian.net/bernat.debian.org.gpg | \ apt-key add - echo deb http://haproxy.debian.net stretch-backports-2.0 main | \ tee /etc/apt/sources.list.d/haproxy.list apt-get update apt-get install haproxy=2.0.\*</code> </pre> <br><p> å®‰è£…HAproxyä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå…¶åˆ›å»ºé…ç½®ã€‚ <br> å¦‚æœåœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šæ²¡æœ‰åŒ…å«é…ç½®æ–‡ä»¶çš„ç›®å½•ï¼Œåˆ™æˆ‘ä»¬å°†å…¶å…‹éš† </p><br><pre> <code class="plaintext hljs">git clone https://github.com/rjeka/kubernetes-ceph-percona.git cd kubernetes-ceph-percona/</code> </pre> <br><p> å¹¶ä½¿ç”¨haproxyæ ‡å¿—è¿è¡Œé…ç½®è„šæœ¬ </p><br><pre> <code class="plaintext hljs">./create-config.sh haproxy</code> </pre> <br><p> è¯¥è„šæœ¬å°†é…ç½®å¹¶é‡æ–°å¯åŠ¨haproxyã€‚ <br> æ£€æŸ¥haproxyæ˜¯å¦å¼€å§‹ä¾¦å¬ç«¯å£6443ã€‚ </p><br><pre> <code class="plaintext hljs">root@worknode01:~/kubernetes-ceph-percona# netstat -alpn | grep 6443 tcp 0 0 127.0.0.1:6443 0.0.0.0:* LISTEN 30675/haproxy tcp 0 0 10.73.75.241:6443 0.0.0.0:* LISTEN 30675/haproxy</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰kubeletè®¿é—®localhostè€Œä¸æ˜¯ä¸»èŠ‚ç‚¹ã€‚ ä¸ºæ­¤ï¼Œè¯·åœ¨æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹ä¸Šçš„/etc/kubernetes/kubelet.confå’Œ/etc/kubernetes/bootstrap-kubelet.confæ–‡ä»¶ä¸­ç¼–è¾‘æœåŠ¡å™¨å€¼ã€‚ </p><br><pre> <code class="plaintext hljs">vim /etc/kubernetes/kubelet.conf vim nano /etc/kubernetes/bootstrap-kubelet.conf</code> </pre> <br><p> æœåŠ¡å™¨å€¼åº”é‡‡ç”¨ä»¥ä¸‹å½¢å¼ï¼š </p><br><pre> <code class="plaintext hljs">server: https://127.0.0.1:6443</code> </pre> <br><p> è¿›è¡Œæ›´æ”¹åï¼Œé‡æ–°å¯åŠ¨kubeletå’ŒdockeræœåŠ¡ </p><br><pre> <code class="plaintext hljs">systemctl restart kubelet &amp;&amp; systemctl restart docker</code> </pre> <br><p> æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ </p><br><pre> <code class="plaintext hljs">kubectl get nodes NAME STATUS ROLES AGE VERSION master01 Ready master 29m v1.15.1 master02 Ready master 27m v1.15.1 master03 Ready master 26m v1.15.1 worknode01 Ready &lt;none&gt; 25m v1.15.1 worknode02 Ready &lt;none&gt; 3m15s v1.15.1 worknode03 Ready &lt;none&gt; 3m16s v1.15.1</code> </pre> <br><p> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬é›†ç¾¤ä¸­æ²¡æœ‰ç”¨äºæµ‹è¯•HAçš„åº”ç”¨ç¨‹åºã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹ä¸Šåœæ­¢kubeletçš„æ“ä½œï¼Œå¹¶ç¡®ä¿æˆ‘ä»¬çš„é›†ç¾¤ä¿æŒè¿è¡ŒçŠ¶æ€ã€‚ </p><br><pre> <code class="plaintext hljs">systemctl stop kubelet &amp;&amp; systemctl stop docker</code> </pre> <br><p> ä»ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹æ£€æŸ¥ </p><br><pre> <code class="plaintext hljs">root@master02:~# kubectl get nodes NAME STATUS ROLES AGE VERSION master01 NotReady master 15h v1.15.1 master02 Ready master 15h v1.15.1 master03 Ready master 15h v1.15.1 worknode01 Ready &lt;none&gt; 15h v1.15.1 worknode02 Ready &lt;none&gt; 15h v1.15.1 worknode03 Ready &lt;none&gt; 15h v1.15.1</code> </pre> <br><p> é™¤äº†åœæ­¢æœåŠ¡çš„èŠ‚ç‚¹ä»¥å¤–ï¼Œæ‰€æœ‰èŠ‚ç‚¹å‡æ­£å¸¸è¿è¡Œã€‚ <br> ä¸è¦å¿˜è®°åœ¨ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹ä¸Šå›é€€kubernetesæœåŠ¡ </p><br><pre> <code class="plaintext hljs">systemctl start kubelet &amp;&amp; systemctl start docker</code> </pre> <br><a name="ingress"></a><br><h2> å®‰è£…å…¥å£æ§åˆ¶å™¨ </h2><br><p> å…¥å£æ§åˆ¶å™¨æ˜¯Kubernetesé™„åŠ ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»å¤–éƒ¨è®¿é—®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ è¯¦ç»†çš„æè¿°åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kuberbnetesæ–‡æ¡£ä¸­</a> ã€‚ æœ‰å¾ˆå¤šæ§åˆ¶å™¨å…¥å£ï¼Œæˆ‘ä½¿ç”¨Nginxçš„æ§åˆ¶å™¨ã€‚ æˆ‘å°†è®¨è®ºå…¶å®‰è£…ã€‚  Nginxæä¾›çš„æœ‰å…³Ingressæ§åˆ¶å™¨çš„æ“ä½œï¼Œé…ç½®å’Œå®‰è£…çš„æ–‡æ¡£å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹ç½‘ç«™</a>ä¸Šé˜…è¯» </p><br><p> è®©æˆ‘ä»¬å¼€å§‹å®‰è£…ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½å¯ä»¥ä½¿ç”¨master01æ‰§è¡Œã€‚ <br> è‡ªè¡Œå®‰è£…æ§åˆ¶å™¨ </p><br><pre> <code class="plaintext hljs">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/mandatory.yaml</code> </pre> <br><p> ç°åœ¨-ä¸€é¡¹å¯é€šè¿‡å…¶è®¿é—®çš„æœåŠ¡ <br> ä¸ºæ­¤ï¼Œè¯·å‡†å¤‡é…ç½® </p><br><pre> <code class="plaintext hljs">./create-config.sh ingress</code> </pre> <br><p> å¹¶å°†å…¶å‘é€åˆ°æˆ‘ä»¬çš„é›†ç¾¤ </p><br><pre> <code class="plaintext hljs">kubectl apply -f ingress/service-nodeport.yaml</code> </pre> <br><p> æ£€æŸ¥æˆ‘ä»¬çš„Ingressæ˜¯å¦åœ¨æ­£ç¡®çš„åœ°å€ä¸Šæ­£å¸¸å·¥ä½œï¼Œå¹¶åœ¨æ­£ç¡®çš„ç«¯å£ä¸Šè¿›è¡Œä¾¦å¬ã€‚ </p><br><pre> <code class="plaintext hljs"># kubectl get svc -n ingress-nginx NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE ingress-nginx NodePort 10.99.35.95 10.73.71.25,10.73.71.26,10.73.71.27 80:31669/TCP,443:31604/TCP 10m</code> </pre> <br><pre> <code class="plaintext hljs"> kubectl describe svc -n ingress-nginx ingress-nginx Name: ingress-nginx Namespace: ingress-nginx Labels: app.kubernetes.io/name=ingress-nginx app.kubernetes.io/part-of=ingress-nginx Annotations: kubectl.kubernetes.io/last-applied-configuration: {"apiVersion":"v1","kind":"Service","metadata":{"annotations":{},"labels":{"app.kubernetes.io/name":"ingress-nginx","app.kubernetes.io/par... Selector: app.kubernetes.io/name=ingress-nginx,app.kubernetes.io/part-of=ingress-nginx Type: NodePort IP: 10.99.35.95 External IPs: 10.73.71.25,10.73.71.26,10.73.71.27 Port: http 80/TCP TargetPort: 80/TCP NodePort: http 31669/TCP Endpoints: 192.168.142.129:80 Port: https 443/TCP TargetPort: 443/TCP NodePort: https 31604/TCP Endpoints: 192.168.142.129:443 Session Affinity: None External Traffic Policy: Cluster Events: &lt;none&gt;</code> </pre> <br><a name="dashboard"></a><br><h2> å®‰è£…Web UIï¼ˆä»ªè¡¨æ¿ï¼‰ </h2><br><p>  Kubernetesæœ‰ä¸€ä¸ªæ ‡å‡†çš„Web UIï¼Œé€šè¿‡å®ƒæœ‰æ—¶å¯ä»¥æ–¹ä¾¿åœ°å¿«é€ŸæŸ¥çœ‹é›†ç¾¤æˆ–å…¶å„ä¸ªéƒ¨åˆ†çš„çŠ¶æ€ã€‚ åœ¨æˆ‘çš„å·¥ä½œä¸­ï¼Œæˆ‘ç»å¸¸ä½¿ç”¨ä»ªè¡¨æ¿è¿›è¡Œéƒ¨ç½²çš„åˆå§‹è¯Šæ–­æˆ–é›†ç¾¤å„éƒ¨åˆ†çš„çŠ¶æ€ã€‚ <br> è¯¥æ–‡æ¡£çš„é“¾æ¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½äºkubernetesç½‘ç«™ä¸Š</a> <br> å®‰è£…æ–¹å¼ æˆ‘æ­£åœ¨ä½¿ç”¨ç¨³å®šç‰ˆæœ¬ï¼Œä½†å°šæœªå°è¯•2.0ã€‚ </p><br><pre> <code class="plaintext hljs">#  kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml # 2.0 kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta1/aio/deploy/recommended.yaml</code> </pre> <br><p> åœ¨å°†é¢æ¿å®‰è£…åˆ°é›†ç¾¤ä¸­ä¹‹åï¼Œè¯¥é¢æ¿åœ¨ä»¥ä¸‹ä½ç½®å¯ç”¨ </p><br><pre> <code class="plaintext hljs">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/.</code> </pre> <br><p> ä½†æ˜¯ï¼Œä¸ºäº†è¾¾åˆ°ç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨kubectlä»£ç†ä»æœ¬åœ°è®¡ç®—æœºè½¬å‘ç«¯å£ã€‚ å¯¹æˆ‘æ¥è¯´ï¼Œè¿™ç§æ–¹æ¡ˆä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚ å› æ­¤ï¼Œæˆ‘å°†æ›´æ”¹æ§åˆ¶é¢æ¿çš„æœåŠ¡ï¼Œä»¥ä½¿ä»ªè¡¨æ¿åœ¨ç«¯å£30443ä¸Šä»»ä½•ç¾¤é›†èŠ‚ç‚¹çš„åœ°å€ä¸Šå¯ç”¨ã€‚è¿˜æœ‰å…¶ä»–è®¿é—®ä»ªè¡¨æ¿çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡å…¥å£ã€‚ ä¹Ÿè®¸æˆ‘ä¼šåœ¨ä»¥ä¸‹å‡ºç‰ˆç‰©ä¸­è€ƒè™‘è¿™ç§æ–¹æ³•ã€‚ <br> è¦æ›´æ”¹æœåŠ¡ï¼Œè¯·è¿è¡Œå·²æ›´æ”¹æœåŠ¡çš„éƒ¨ç½² </p><br><pre> <code class="plaintext hljs">kubectl apply -f dashboard/service-nodeport.yaml</code> </pre> <br><p> å‰©ä¸‹åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·å’Œä»¤ç‰Œä»¥é€šè¿‡ä»ªè¡¨æ¿è®¿é—®é›†ç¾¤çš„è¿‡ç¨‹ </p><br><pre> <code class="plaintext hljs">kubectl apply -f dashboard/rbac.yaml kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')</code> </pre> <br><p> ä¹‹åï¼Œæ‚¨å¯ä»¥ç™»å½•åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://10.73.71.25:30443</a>çš„æ§åˆ¶é¢æ¿ã€‚ <br><img src="https://habrastorage.org/webt/p7/zu/8q/p7zu8qv47mwdsmdydtvyo7gs_y4.png"><br> ä»ªè¡¨æ¿ä¸»å±å¹• <br><img src="https://habrastorage.org/webt/h2/ks/jq/h2ksjq_7egqatf4ulnl0zkwqvqk.png"></p><br><p> æ­å–œä½ ï¼ å¦‚æœæ‚¨å·²å®Œæˆæ­¤æ­¥éª¤ï¼Œé‚£ä¹ˆæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªå¯ç”¨çš„Kubernetes HAé›†ç¾¤ï¼Œè¯¥é›†ç¾¤å¯ç”¨äºéƒ¨ç½²åº”ç”¨ç¨‹åºã€‚ <br> Kubernetes    ,      .          . <br>       ,  GitHub,    ,    . <br> C ,  . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN462473/">https://habr.com/ru/post/zh-CN462473/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN462461/index.html">GOES-17äº‹æ•…è°ƒæŸ¥ç»“æœ</a></li>
<li><a href="../zh-CN462465/index.html">ä½¿ç”¨è‹¹æœçš„æ•…ä¹¡</a></li>
<li><a href="../zh-CN462467/index.html">å‰ç«¯æ¯å‘¨æ‘˜è¦ï¼ˆ2019å¹´7æœˆ29æ—¥è‡³8æœˆ4æ—¥ï¼‰</a></li>
<li><a href="../zh-CN462469/index.html">Rä¸­é’ˆå¯¹â€œä¼ä¸šâ€ä»»åŠ¡çš„å¹¶è¡Œè®¡ç®—çš„å‡ ç‚¹æ³¨æ„äº‹é¡¹</a></li>
<li><a href="../zh-CN462471/index.html">ä½¿ç”¨pwnable.kr 16è§£å†³å·¥ä½œ-UAFã€‚ é‡Šæ”¾æ¼æ´åä½¿ç”¨</a></li>
<li><a href="../zh-CN462475/index.html">é˜¿åˆ—å…‹è°¢Â·è¨ç“¦æ·æ·å¤«ï¼ˆAlexey Savvateevï¼‰ï¼šå¦‚ä½•å€ŸåŠ©æ•°å­¦æ‰“å‡»è…è´¥ï¼ˆ2016å¹´è¯ºè´å°”ç»æµå­¦å¥–ï¼‰</a></li>
<li><a href="../zh-CN462477/index.html">ç§‘å­¦å®¶å£°ç§°AIæ˜¯ä¸€é¡¹æ–°ä¸“åˆ©çš„ä½œè€…ï¼Œå¹¶æ­£åœ¨è¯•å›¾æ”¹å˜ä¸“åˆ©æ³•</a></li>
<li><a href="../zh-CN462479/index.html">Steam Windowså®¢æˆ·ç«¯æœ¬åœ°ç‰¹æƒå‡çº§0å¤©</a></li>
<li><a href="../zh-CN462481/index.html">ç±»å‹ç³»ç»Ÿå¸¸è§é—®é¢˜</a></li>
<li><a href="../zh-CN462483/index.html">åŠŸèƒ½ç¼–ç¨‹ï¼šä¸€ç§å¤æ€ªçš„ç©å…·ï¼Œä¼šé™ä½åŠ³åŠ¨ç”Ÿäº§ç‡ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>