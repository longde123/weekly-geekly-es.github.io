<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘·ğŸ¼ ğŸ ğŸŒ“ ä½¿ç”¨å¯„å­˜å™¨è¿›è¡Œç±»å‹å®‰å…¨çš„å·¥ä½œï¼Œè€Œåœ¨C ++ 17ä¸­æ²¡æœ‰å¼€é”€ï¼šåŸºäºå€¼çš„å…ƒç¼–ç¨‹ ğŸ’ªğŸ¼ ğŸ§‘ğŸ¾â€ğŸ¤â€ğŸ§‘ğŸ¼ ğŸ‘¨ğŸ¾â€ğŸŒ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="C ++ç”±äºå…¶ä¸¥æ ¼çš„ç±»å‹è¾“å…¥ï¼Œå¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µä¸ºç¨‹åºå‘˜æä¾›å¸®åŠ©ã€‚ è¯¥ä¸­å¿ƒä¸Šå·²ç»æœ‰å¾ˆå¤šæ–‡ç« æè¿°äº†å¦‚ä½•ä½¿ç”¨ç±»å‹æ¥å®ç°æ­¤ç›®æ ‡ï¼Œè¿™å¾ˆå¥½ã€‚ ä½†æ˜¯æˆ‘æ‰€è¯»çš„ä¹¦éƒ½æœ‰ä¸€ä¸ªç¼ºé™·ã€‚ ä¸å¾®æ§åˆ¶å™¨ç¼–ç¨‹é¢†åŸŸä¸­ç†Ÿæ‚‰çš„++æ–¹æ³•å’Œä½¿ç”¨CMSISçš„Cæ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼š 


some_stream.set (Direction::to_pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨å¯„å­˜å™¨è¿›è¡Œç±»å‹å®‰å…¨çš„å·¥ä½œï¼Œè€Œåœ¨C ++ 17ä¸­æ²¡æœ‰å¼€é”€ï¼šåŸºäºå€¼çš„å…ƒç¼–ç¨‹</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483378/"><p>  C ++ç”±äºå…¶ä¸¥æ ¼çš„ç±»å‹è¾“å…¥ï¼Œå¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µä¸ºç¨‹åºå‘˜æä¾›å¸®åŠ©ã€‚ è¯¥ä¸­å¿ƒä¸Šå·²ç»æœ‰å¾ˆå¤šæ–‡ç« æè¿°äº†å¦‚ä½•ä½¿ç”¨ç±»å‹æ¥å®ç°æ­¤ç›®æ ‡ï¼Œè¿™å¾ˆå¥½ã€‚ ä½†æ˜¯æˆ‘æ‰€è¯»çš„ä¹¦éƒ½æœ‰ä¸€ä¸ªç¼ºé™·ã€‚ ä¸å¾®æ§åˆ¶å™¨ç¼–ç¨‹é¢†åŸŸä¸­ç†Ÿæ‚‰çš„++æ–¹æ³•å’Œä½¿ç”¨CMSISçš„Cæ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼š </p><br><pre><code class="cpp hljs">some_stream.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (Direction::to_periph) SOME_STREAM-&gt;CR |= DMA_SxCR_DIR_0 .inc_memory() | DMA_SxCR_MINC_Msk .size_memory (DataSize::word16) | DMA_SxCR_MSIZE_0 .size_periph (DataSize::word16) | DMA_SxCR_PSIZE_0 .enable_transfer_complete_interrupt(); | DMA_SxCR_TCIE_Msk;</code> </pre> <br><p> æ˜¾è€Œæ˜“è§ï¼ŒC ++æ–¹æ³•æ›´å…·å¯è¯»æ€§ï¼Œå¹¶ä¸”ç”±äºæ¯ä¸ªå‡½æ•°éƒ½å…·æœ‰ä¸€ç§ç‰¹å®šçš„ç±»å‹ï¼Œå› æ­¤ä¸ä¼šå‡ºé”™ã€‚  Cè¯­è¨€æ–¹æ³•ä¸æ£€æŸ¥æ•°æ®çš„æœ‰æ•ˆæ€§ï¼Œè€Œæ˜¯ç”±ç¨‹åºå‘˜è´Ÿè´£ã€‚ é€šå¸¸ï¼Œä»…åœ¨è°ƒè¯•æœŸé—´æ‰è¯†åˆ«é”™è¯¯ã€‚ ä½†æ˜¯c ++æ–¹æ³•ä¸æ˜¯å…è´¹çš„ã€‚ å®é™…ä¸Šï¼Œæ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„å¯„å­˜å™¨è®¿é—®æƒé™ï¼Œè€Œåœ¨Cè¯­è¨€ä¸­ï¼Œç”±äºè¿™äº›éƒ½æ˜¯å¸¸é‡ï¼Œå› æ­¤åœ¨ç¼–è¯‘é˜¶æ®µé¦–å…ˆä»æ‰€æœ‰å‚æ•°ä¸­æ”¶é›†æ©ç ï¼Œç„¶åå°†å…¶ç«‹å³å†™å…¥å¯„å­˜å™¨ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘å°†æè¿°å¦‚ä½•åœ¨æœ€å°åŒ–æ¡ˆä¾‹è®¿é—®çš„æƒ…å†µä¸‹å°†ç±»å‹å®‰å…¨æ€§ä¸++ç›¸ç»“åˆã€‚ æ‚¨ä¼šå‘ç°å®ƒæ¯”å¬èµ·æ¥ç®€å•å¾—å¤šã€‚ </p><a name="habracut"></a><br><p> é¦–å…ˆï¼Œæˆ‘å°†ä¸¾ä¾‹è¯´æ˜æˆ‘çš„å¤–è§‚ã€‚ å¸Œæœ›è¿™ä¸å·²ç»ç†Ÿæ‚‰çš„C ++æ–¹æ³•æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚ </p><br><pre> <code class="cpp hljs">some_stream.<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>( dma_stream::direction::to_periph , dma_stream::inc_memory , dma_stream::memory_size::byte16 , dma_stream::periph_size::byte16 , dma_stream::transfer_complete_interrupt::enable );</code> </pre> <br><p>  setæ–¹æ³•ä¸­çš„æ¯ä¸ªå‚æ•°éƒ½æ˜¯å•ç‹¬çš„ç±»å‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¯¥ç±»å‹äº†è§£è¦åœ¨å“ªä¸ªå¯„å­˜å™¨ä¸­å†™å…¥è¯¥å€¼ï¼Œè¿™æ„å‘³ç€åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å¯ä»¥ä¼˜åŒ–å¯¹å¯„å­˜å™¨çš„è®¿é—®ã€‚ è¯¥æ–¹æ³•æ˜¯å¯å˜å‚æ•°çš„ï¼Œå› æ­¤å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œä½†æ˜¯å¿…é¡»æ£€æŸ¥æ‰€æœ‰å‚æ•°éƒ½å±äºè¯¥å¤–å›´è®¾å¤‡ã€‚ </p><br><p> æ—©äº›æ—¶å€™ï¼Œå¯¹äºæˆ‘æ¥è¯´ï¼Œè¿™é¡¹ä»»åŠ¡ä¼¼ä¹ç›¸å½“å¤æ‚ï¼Œç›´åˆ°æˆ‘<a href="https://youtu.be/ZUmc45Njs9U" rel="nofollow">è§‚çœ‹äº†æœ‰å…³åŸºäºä»·å€¼çš„å…ƒç¼–ç¨‹çš„è§†é¢‘</a> ã€‚ é€šè¿‡è¿™ç§å…ƒç¼–ç¨‹æ–¹æ³•ï¼Œæ‚¨å¯ä»¥åƒç¼–å†™æ™®é€šä»£ç ä¸€æ ·ç¼–å†™é€šç”¨ç®—æ³•ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä»…æä¾›è§£å†³é—®é¢˜çš„æœ€å¿…è¦è§†é¢‘ï¼Œå…¶ä¸­æœ‰æ›´å¤šé€šç”¨çš„ç®—æ³•ã€‚ </p><br><p> æˆ‘å°†ä»¥æŠ½è±¡æ–¹å¼è§£å†³æ­¤é—®é¢˜ï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç‰¹å®šå¤–å›´è®¾å¤‡ã€‚ å› æ­¤ï¼Œæœ‰å‡ ä¸ªå¯„å­˜å™¨å­—æ®µï¼Œæˆ‘å°†æœ‰æ¡ä»¶åœ°å°†å®ƒä»¬å†™ä¸ºæšä¸¾ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum1</span></span></span><span class="hljs-class"> {</span></span> _0, _1, _2, _3 }; <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum2</span></span></span><span class="hljs-class"> {</span></span> _0, _1, _2, _3 }; <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum3</span></span></span><span class="hljs-class"> {</span></span> _0, _1, _2, _3, _4 }; <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum4</span></span></span><span class="hljs-class"> {</span></span> _0, _1, _2, _3 };</code> </pre> <br><p> å‰ä¸‰ä¸ªä¸ä¸€ä¸ªå¤–å›´æœ‰å…³ï¼Œç¬¬å››ä¸ªä¸å¦ä¸€ä¸ªå¤–å›´æœ‰å…³ã€‚ å› æ­¤ï¼Œå¦‚æœå°†ç¬¬å››æšä¸¾çš„å€¼è¾“å…¥åˆ°ç¬¬ä¸€å¤–å›´çš„æ–¹æ³•ä¸­ï¼Œåˆ™åº”è¯¥å­˜åœ¨ç¼–è¯‘é”™è¯¯ï¼Œæœ€å¥½æ˜¯å¯ä»¥ç†è§£çš„ã€‚ åŒæ ·ï¼Œå‰2ä¸ªåˆ—è¡¨å°†ä¸ä¸€ä¸ªå¯„å­˜å™¨ç›¸å…³ï¼Œç¬¬ä¸‰ä¸ªåˆ—è¡¨ä¸å¦ä¸€ä¸ªç›¸å…³ã€‚ </p><br><p> ç”±äºæšä¸¾çš„å€¼é™¤å®é™…å€¼å¤–ä¸å­˜å‚¨ä»»ä½•å†…å®¹ï¼Œå› æ­¤éœ€è¦å¦å¤–ä¸€ç§ç±»å‹ï¼Œè¯¥ç±»å‹å°†å­˜å‚¨ä¾‹å¦‚æ©ç ï¼Œä»¥ç¡®å®šå°†è¯¥æšä¸¾å†™å…¥å¯„å­˜å™¨çš„å“ªä¸€éƒ¨åˆ†ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum1_traits</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask = <span class="hljs-number"><span class="hljs-number">0b00111</span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum2_traits</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask = <span class="hljs-number"><span class="hljs-number">0b11000</span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum3_traits</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask = <span class="hljs-number"><span class="hljs-number">0b00111</span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum4_traits</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> mask = <span class="hljs-number"><span class="hljs-number">0b00111</span></span>; };</code> </pre> <br><p> ä»ç„¶å¯ä»¥è¿æ¥è¿™ä¸¤ç§ç±»å‹ã€‚ åœ¨è¿™é‡Œï¼Œè¯¥<a href="https://en.cppreference.com/w/cpp/types/type_identity" rel="nofollow">èŠ¯ç‰‡å·²ç»å¯¹20ç§æ ‡å‡†</a>æœ‰ç”¨ï¼Œä½†å®ƒæ˜¯å¾®ä¸è¶³é“çš„ï¼Œæ‚¨å¯ä»¥è‡ªå·±å®ç°ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_identity</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> type = T; }; <span class="hljs-comment"><span class="hljs-comment">//    constexpr auto some_type = type_identity&lt;Some_type&gt;{}; //      using some_type_t = typename decltype(some_type)::type; #define TYPE(type_identity) typename decltype(type_identity)::type</span></span></code> </pre> <br><p> æœ€é‡è¦çš„æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•ç±»å‹çš„å€¼å¹¶å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚ è¿™æ˜¯åŸºäºå€¼çš„å…ƒç¼–ç¨‹æ–¹æ³•çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæ‚¨åº”è¯¥å°è¯•å°†ç±»å‹ä¿¡æ¯ä¼ é€’ç»™å€¼ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ¨¡æ¿å‚æ•°ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªå®ï¼Œä½†æ˜¯åœ¨c ++ä¸­æˆ‘æ˜¯å®ƒä»¬çš„å¯¹æ‰‹ã€‚ ä½†æ˜¯ä»–å…è®¸è¿›ä¸€æ­¥å†™ä½œã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä¸ºä¸€ä¸ªå‡½æ•°å’Œå¦ä¸€ä¸ªå®æä¾›é“¾æ¥æšä¸¾åŠå…¶å±æ€§ï¼Œè¯¥å®å¯ä»¥å‡å°‘å¤åˆ¶ç²˜è´´çš„æ•°é‡ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">traits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type_identity&lt;Enum1&gt;)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> type_identity&lt;Enum1_traits&gt;{}; } <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAKE_TRAITS_WITH_MASK(enum, mask_) struct enum##_traits { \ static constexpr std::size_t mask = mask_; \ }; \ constexpr auto traits(type_identity</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;enum&gt;) { \ return type_identity&lt;enum##_traits&gt;{}; \ }</span></span></span></span></code> </pre> <br><p> å¿…é¡»å°†å­—æ®µä¸ç›¸åº”çš„å¯„å­˜å™¨å…³è”ã€‚ æˆ‘é€šè¿‡ç»§æ‰¿é€‰æ‹©å…³ç³»ï¼Œå› ä¸ºè¯¥æ ‡å‡†å·²ç»å…·æœ‰å…ƒå‡½æ•°<code>std::is_base_of</code> ï¼Œå®ƒå°†å…è®¸æ‚¨ä»¥é€šç”¨å½¢å¼å®šä¹‰å­—æ®µä¸å¯„å­˜å™¨ä¹‹é—´çš„å…³ç³»ã€‚ æ‚¨ä¸èƒ½ä»æšä¸¾ç»§æ‰¿ï¼Œå› æ­¤æˆ‘ä»¬ä»å…¶å±æ€§ç»§æ‰¿ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register1</span></span></span><span class="hljs-class"> :</span></span> Enum1_traits, Enum2_traits { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset = <span class="hljs-number"><span class="hljs-number">0x0</span></span>; };</code> </pre> <br><p> å¯„å­˜å™¨æ‰€åœ¨çš„åœ°å€å­˜å‚¨ä¸ºä»å¤–å›´å¼€å§‹çš„åç§»é‡ã€‚ </p><br><p> åœ¨æè¿°å¤–å›´ä¹‹å‰ï¼Œæœ‰å¿…è¦è®¨è®ºåŸºäºå€¼çš„å…ƒç¼–ç¨‹ä¸­çš„ç±»å‹åˆ—è¡¨ã€‚ è¿™æ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„ç»“æ„ï¼Œå…è®¸æ‚¨ä¿å­˜å‡ ç§ç±»å‹å¹¶æŒ‰å€¼ä¼ é€’å®ƒä»¬ã€‚ æœ‰ç‚¹åƒ<code>type_identity</code> ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç±»å‹ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_pack</span></span></span><span class="hljs-class">{</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> empty_pack = type_pack&lt;&gt;;</code> </pre> <br><p> æ‚¨å¯ä»¥ä¸ºæ­¤åˆ—è¡¨å®ç°è®¸å¤šconstexprå‡½æ•°ã€‚ ä¸è‘—åçš„Alexandrescuç±»å‹åˆ—è¡¨ï¼ˆLokiåº“ï¼‰ç›¸æ¯”ï¼Œå®ƒä»¬çš„å®ç°æ›´å®¹æ˜“ç†è§£ã€‚ ä»¥ä¸‹æ˜¯ç¤ºä¾‹ã€‚ </p><br><p> å¤–è®¾çš„ç¬¬äºŒä¸ªé‡è¦å±æ€§åº”è¯¥æ˜¯å°†å…¶å®šä½åœ¨ç‰¹å®šåœ°å€ï¼ˆåœ¨å¾®æ§åˆ¶å™¨ä¸­ï¼‰å¹¶åŠ¨æ€ä¼ é€’è¯¥åœ°å€ä»¥è¿›è¡Œæµ‹è¯•çš„èƒ½åŠ›ã€‚ å› æ­¤ï¼Œå¤–å›´è®¾å¤‡çš„ç»“æ„å°†æ˜¯æ ·æ¿ï¼Œå¹¶ä¸”å°†åœ¨å€¼å­—æ®µä¸­å­˜å‚¨å¤–å›´è®¾å¤‡çš„ç‰¹å®šåœ°å€çš„ç±»å‹ä½œä¸ºå‚æ•°ã€‚  templateå‚æ•°å°†ç”±æ„é€ å‡½æ•°ç¡®å®šã€‚ å¥½äº†ï¼Œå‰é¢æåˆ°çš„setæ–¹æ³•ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Periph1</span></span></span><span class="hljs-class"> {</span></span> Periph1(Address) {} <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> registers = type_pack&lt;Register1, Register2&gt;{}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">set</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">args</span></span></span><span class="hljs-class">) {</span></span> ::<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(registers, Address::value, args...); } };</code> </pre> <br><p>  setæ–¹æ³•æ‰€åšçš„å…¨éƒ¨å·¥ä½œå°±æ˜¯è°ƒç”¨ä¸€ä¸ªè‡ªç”±å‡½æ•°ï¼Œå¹¶å‘å…¶ä¸­ä¼ é€’é€šç”¨ç®—æ³•æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚ </p><br><p> æˆ‘å°†ä¸¾ä¾‹è¯´æ˜ä¸ºå¤–å›´è®¾å¤‡æä¾›åœ°å€çš„ç±»å‹ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    struct Address { static constexpr std::size_t value = SOME_PERIPH_BASE; }; //    ,    struct Address { static inline std::size_t value; template&lt;class Pointer&gt; Address(Pointer address) { value = reinterpret_cast&lt;std::size_t&gt;(address); } };</span></span></code> </pre> <br><p> å‡†å¤‡äº†é€šç”¨ç®—æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä»è¦æ‰§è¡Œã€‚ æˆ‘å°†ç»™å‡ºæ­¤åŠŸèƒ½çš„æ–‡å­—ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Registers</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Args</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">set</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_pack</span></span></span><span class="hljs-class">&lt;Registers...&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">registers</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> address, Args...args) { <span class="hljs-comment"><span class="hljs-comment">//       ,  value based  constexpr auto args_traits = make_type_pack(traits(type_identity&lt;Args&gt;{})...); //              static_assert(all_of(args_traits, [](auto arg){ return (std::is_base_of_v&lt;TYPE(arg), Registers&gt; || ...); }), "one of arguments in set method don`t belong to periph type"); //   ,      constexpr auto registers_for_write = filter(registers, [](auto reg){ return any_of(args_traits, [](auto arg){ //       o  reg? return std::is_base_of_v&lt;TYPE(arg), TYPE(reg)&gt;; }); }); //           foreach(registers_for_write, [=](auto reg){ auto value = register_value(reg, args...); auto offset = decltype(reg)::type::offset; write(address + offset, value); }); };</span></span></code> </pre> <br><p> å®ç°å°†å‚æ•°ï¼ˆç‰¹å®šçš„å¯„å­˜å™¨å­—æ®µï¼‰è½¬æ¢ä¸º<code>type_pack</code>å‡½æ•°éå¸¸ç®€å•ã€‚ è®©æˆ‘æé†’æ‚¨ï¼Œæ¨¡æ¿ç±»å‹åˆ—è¡¨çš„çœç•¥å·æ˜¾ç¤ºäº†ç”¨é€—å·åˆ†éš”çš„ç±»å‹åˆ—è¡¨ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_type_pack</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_identity</span></span></span><span class="hljs-class">&lt;Ts&gt;...) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> type_pack&lt;Ts...&gt;{}; }</code> </pre> <br><p> ä¸ºäº†éªŒè¯æ‰€æœ‰å‚æ•°éƒ½ä¸ä¼ è¾“çš„å¯„å­˜å™¨æœ‰å…³ï¼Œå¹¶å› æ­¤ä¸ç‰¹å®šçš„å¤–è®¾æœ‰å…³ï¼Œæœ‰å¿…è¦å®ç°all_ofç®—æ³•ã€‚ ä¸æ ‡å‡†åº“ç±»ä¼¼ï¼Œè¯¥ç®—æ³•æ¥æ”¶ç±»å‹åˆ—è¡¨å’Œè°“è¯å‡½æ•°ä½œä¸ºè¾“å…¥ã€‚ æˆ‘ä»¬ä½¿ç”¨lambdaä½œä¸ºå‡½æ•°ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">all_of</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_pack</span></span></span><span class="hljs-class">&lt;Ts...&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (f(type_identity&lt;Ts&gt;{}) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> ...); }</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨<a href="https://ru.cppreference.com/w/cpp/language/fold" rel="nofollow">17æ ‡å‡†</a>çš„<a href="https://ru.cppreference.com/w/cpp/language/fold" rel="nofollow">æ‰«æè¡¨è¾¾å¼</a> ã€‚ æ­£æ˜¯è¿™ç§åˆ›æ–°æå¤§åœ°ç®€åŒ–äº†å–œæ¬¢å…ƒç¼–ç¨‹çš„äººä»¬çš„ç”Ÿæ´»ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå‡½æ•°fåº”ç”¨äºåˆ—è¡¨Tsä¸­çš„æ¯ä¸ªç±»å‹ï¼Œå°†å…¶è½¬æ¢ä¸º<code>type_identity</code> ï¼Œå¹¶ä¸”æ¯ä¸ªè°ƒç”¨çš„ç»“æœç”±Iæ”¶é›†ã€‚ </p><br><p> åœ¨<code>static_assert</code>å†…éƒ¨ï¼Œå°†åº”ç”¨æ­¤ç®—æ³•ã€‚ åŒ…è£…åœ¨<code>type_identity</code>ä¸­çš„<code>type_identity</code>ä¼ é€’ç»™lambdaã€‚ åœ¨lambdaå†…éƒ¨ï¼Œä½¿ç”¨äº†æ ‡å‡†çš„å…ƒå‡½æ•°std :: is_base_ofï¼Œä½†æ˜¯ç”±äºå¯ä»¥æœ‰å¤šä¸ªå¯„å­˜å™¨ï¼Œå› æ­¤å°†æ ¹æ®ORé€»è¾‘ä½¿ç”¨æ‰«æè¡¨è¾¾å¼å¯¹æ¯ä¸ªå¯„å­˜å™¨æ‰§è¡Œè¯¥è¡¨è¾¾å¼ã€‚ ç»“æœï¼Œå¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°çš„å±æ€§å¯¹äºè‡³å°‘ä¸€ä¸ªå¯„å­˜å™¨ä¸æ˜¯åŸºæœ¬çš„ï¼Œåˆ™<code>static assert</code>å°†èµ·ä½œç”¨å¹¶æ˜¾ç¤ºä¸€æ¡æ˜ç¡®çš„é”™è¯¯æ¶ˆæ¯ã€‚ å¾ˆå®¹æ˜“ç†è§£é”™è¯¯çš„å‡ºå¤„ï¼ˆå°†é”™è¯¯çš„å‚æ•°ä¼ é€’ç»™<code>set</code>æ–¹æ³•ï¼‰å¹¶è¿›è¡Œä¿®å¤ã€‚ </p><br><p> ç¨åå°†éœ€è¦çš„<code>any_of</code>ç®—æ³•çš„å®ç°éå¸¸ç›¸ä¼¼ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">any_of</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_pack</span></span></span><span class="hljs-class">&lt;Ts...&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (f(type_identity&lt;Ts&gt;{}) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ...); }</code> </pre> <br><p> é€šç”¨ç®—æ³•çš„ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯ç¡®å®šéœ€è¦å†™å…¥å“ªäº›å¯„å­˜å™¨ã€‚ ä¸ºæ­¤ï¼Œè¯·è¿‡æ»¤å¯„å­˜å™¨çš„åˆå§‹åˆ—è¡¨ï¼Œå¹¶ä»…ä¿ç•™å‡½æ•°ä¸­åŒ…å«å‚æ•°çš„é‚£äº›å¯„å­˜å™¨ã€‚ æˆ‘ä»¬éœ€è¦ä¸€ä¸ª<code>filter</code>ç®—æ³•ï¼Œè¯¥ç®—æ³•é‡‡ç”¨åŸå§‹çš„<code>type_pack</code> ï¼Œå¯¹åˆ—è¡¨ä¸­çš„æ¯ç§ç±»å‹åº”ç”¨è°“è¯å‡½æ•°ï¼Œå¦‚æœè°“è¯è¿”å›trueï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°æ–°åˆ—è¡¨ä¸­ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filter</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_pack</span></span></span><span class="hljs-class">&lt;Ts...&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> filter_one = [](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> v, <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> f) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> T = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decltype</span></span>(v)::type; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f(v))</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">return</span></span></span><span class="hljs-function"> type_pack&lt;T&gt;</span></span>{}; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> empty_pack{}; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (empty_pack{} + ... + filter_one(type_identity&lt;Ts&gt;{}, f)); }</code> </pre> <br><p> é¦–å…ˆï¼Œæè¿°äº†ä¸€ä¸ªlambdaï¼Œè¯¥lambdaåœ¨ä¸€ç§ç±»å‹ä¸Šæ‰§è¡Œè°“è¯çš„åŠŸèƒ½ï¼Œå¦‚æœè°“è¯è¿”å›trueï¼Œåˆ™è¿”å›<code>type_pack</code>å¦‚æœè°“è¯è¿”å›<code>false</code>åˆ™è¿”å›ç©ºçš„<code>type_pack</code> ã€‚ æœ€åä¸€ä¸ªä¼˜ç‚¹çš„å¦ä¸€ä¸ªæ–°åŠŸèƒ½åœ¨è¿™é‡Œæœ‰å¸®åŠ©-constexpr ifã€‚ å…¶å®è´¨æ˜¯åœ¨ç»“æœä»£ç ä¸­åªæœ‰ä¸€ä¸ªifåˆ†æ”¯ï¼Œç¬¬äºŒä¸ªæŠ›å‡ºã€‚ è€Œä¸”ç”±äºä¸åŒçš„ç±»å‹åœ¨ä¸åŒçš„åˆ†æ”¯ä¸­è¿”å›ï¼Œå¦‚æœæ²¡æœ‰constexprï¼Œå°†å‡ºç°ç¼–è¯‘é”™è¯¯ã€‚ å†æ¬¡æ„Ÿè°¢<code>type_pack</code>è¡¨è¾¾å¼ï¼Œå¯¹åˆ—è¡¨ä¸­æ¯ç§ç±»å‹æ‰§è¡Œæ­¤lambdaçš„ç»“æœè¢«åˆå¹¶ä¸ºä¸€ä¸ªç»“æœ<code>type_pack</code> ã€‚  <code>type_pack</code>çš„åŠ æ³•è¿ç®—ç¬¦æ²¡æœ‰è¶³å¤Ÿçš„é‡è½½ã€‚ å®ƒçš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Us</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operator</span></span></span><span class="hljs-class">+ (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_pack</span></span></span><span class="hljs-class">&lt;Ts...&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_pack</span></span></span><span class="hljs-class">&lt;Us...&gt;) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> type_pack&lt;Ts..., Us...&gt;{}; }</code> </pre> <br><p> å°†æ–°ç®—æ³•åº”ç”¨äºå¯„å­˜å™¨åˆ—è¡¨æ—¶ï¼Œæ–°åˆ—è¡¨ä»…ä¿ç•™é‚£äº›åº”å†™å…¥ä¼ è¾“å‚æ•°çš„å¯„å­˜å™¨ã€‚ </p><br><p> ä¸‹ä¸€ä¸ªéœ€è¦çš„ç®—æ³•æ˜¯<code>foreach</code> ã€‚ å®ƒåªæ˜¯å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºåˆ—è¡¨ä¸­çš„æ¯ç§ç±»å‹ï¼Œå°†å…¶åŒ…è£…åœ¨<code>type_identity</code> ã€‚ åœ¨æ­¤ï¼Œæ‰«æè¡¨è¾¾å¼ä¸­ä½¿ç”¨äº†é€—å·è¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦æ‰§è¡Œé€—å·æè¿°çš„æ‰€æœ‰åŠ¨ä½œå¹¶è¿”å›ä¸Šä¸€ä¸ªåŠ¨ä½œçš„ç»“æœã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foreach</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_pack</span></span></span><span class="hljs-class">&lt;Ts...&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">) {</span></span> (f(type_identity&lt;Ts&gt;{}), ...); }</code> </pre> <br><p> è¯¥åŠŸèƒ½ä½¿æ‚¨å¯ä»¥è®¿é—®è¦å†™å…¥çš„æ¯ä¸ªå¯„å­˜å™¨ã€‚  lambdaè®¡ç®—è¦å†™å…¥å¯„å­˜å™¨çš„å€¼ï¼Œç¡®å®šè¦å†™å…¥çš„åœ°å€ï¼Œç„¶åç›´æ¥å†™å…¥å¯„å­˜å™¨ã€‚ </p><br><p> ä¸ºäº†è®¡ç®—ä¸€ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œéœ€è¦è®¡ç®—è¯¥å¯„å­˜å™¨æ‰€å±çš„æ¯ä¸ªè‡ªå˜é‡çš„å€¼ï¼Œç„¶åå°†ç»“æœé€šè¿‡â€œæˆ–â€è¿›è¡Œç»„åˆã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Args</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> register_value(type_identity&lt;Register&gt; reg, Args...args) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (arg_value(reg, args) | ...); }</code> </pre> <br><p> åªèƒ½ä¸ºç»§æ‰¿è¯¥å¯„å­˜å™¨çš„å‚æ•°æ‰§è¡Œç‰¹å®šå­—æ®µå€¼çš„è®¡ç®—ã€‚ å¯¹äºè‡ªå˜é‡ï¼Œæˆ‘ä»¬ä»å…¶å±æ€§ä¸­æå–æ©ç ï¼Œå¹¶ç¡®å®šå¯„å­˜å™¨ä¸­å€¼ä¸æ©ç ä¹‹é—´çš„åç§»é‡ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arg</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> arg_value(type_identity&lt;Register&gt;, Arg arg) { <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> arg_traits = traits(type_identity&lt;Arg&gt;{}); <span class="hljs-comment"><span class="hljs-comment">//   ,     if constexpr (not std::is_base_of_v&lt;TYPE(arg_traits), Register&gt;) return 0; constexpr auto mask = decltype(arg_traits)::type::mask; constexpr auto arg_shift = shift(mask); return static_cast&lt;std::size_t&gt;(arg) &lt;&lt; arg_shift; }</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥è‡ªå·±ç¼–å†™ç”¨äºç¡®å®šé®ç½©åç§»çš„ç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä½¿ç”¨äº†ç°æœ‰çš„å†…ç½®å‡½æ•°ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shift</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mask)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __builtin_ffs(mask) - <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br><p> ä¿ç•™å°†å€¼å†™å…¥ç‰¹å®šåœ°å€çš„æœ€åä¸€ä¸ªå‡½æ•°ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> address, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v)</span></span></span><span class="hljs-function"> </span></span>{ *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>*&gt;(address) |= v; }</code> </pre> <br><p> ä¸ºäº†æµ‹è¯•ä»»åŠ¡ï¼Œç¼–å†™äº†ä¸€ä¸ªå°æµ‹è¯•ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ,    volatile std::size_t arr[3]; int main() { //     ( ) //   ,         auto address = Address{arr}; auto mock_periph = Periph1{address}; //  1      //  3       3 //  4      //     0b00011001 (25) //    0b00000100 (4) mock_periph.set(Enum1::_1, Enum2::_3, Enum3::_4); // all ok // mock_periph.set(Enum4::_0); // must be compilation error }</span></span></code> </pre> <br><p> è¿™é‡Œæ‰€å†™çš„ä¸€åˆ‡éƒ½è¢«ç»„åˆåœ¨ä¸€èµ·å¹¶<a href="https://godbolt.org/z/9KTJLN" rel="nofollow">ç¼–æˆäº†èºæ “</a> ã€‚ é‚£é‡Œçš„ä»»ä½•äººéƒ½å¯ä»¥å°è¯•è¿™ç§æ–¹æ³•ã€‚ å¯ä»¥çœ‹åˆ°ç›®æ ‡å·²å®ç°ï¼šæ²¡æœ‰ä¸å¿…è¦çš„å†…å­˜è®¿é—®ã€‚ åœ¨ç¼–è¯‘é˜¶æ®µè®¡ç®—éœ€è¦å†™å…¥å¯„å­˜å™¨çš„å€¼ï¼š </p><br><pre> <code class="cpp hljs">main: mov QWORD PTR Address::value[rip], OFFSET FLAT:arr <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> QWORD PTR arr[rip], <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> QWORD PTR arr[rip+<span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-number"><span class="hljs-number">4</span></span> mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span> ret</code> </pre> <br><hr><br><p>  PSï¼š <br> æ„Ÿè°¢å¤§å®¶çš„è¯„è®ºï¼Œæ„Ÿè°¢ä»–ä»¬ï¼Œæˆ‘å¯¹æ–¹æ³•è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ã€‚ æ‚¨å¯ä»¥åœ¨<a href="https://godbolt.org/z/d6xt_A" rel="nofollow">æ­¤å¤„</a>çœ‹åˆ°æ–°é€‰é¡¹<a href="https://godbolt.org/z/d6xt_A" rel="nofollow">ã€‚</a> </p><br><ul><li> åˆ é™¤è¾…åŠ©ç±»å‹* _traitsï¼Œå¯ä»¥ç›´æ¥åœ¨åˆ—è¡¨ä¸­ä¿å­˜æ©ç ã€‚ <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enum1</span></span></span><span class="hljs-class"> {</span></span> _0, _1, _2, _3, mask = <span class="hljs-number"><span class="hljs-number">0b00111</span></span> };</code> </pre> </li><li> ç°åœ¨ä¸é€šè¿‡ç»§æ‰¿è¿›è¡Œå¸¦æœ‰å‚æ•°çš„å¯„å­˜å™¨è¿æ¥ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªé™æ€å¯„å­˜å™¨å­—æ®µ <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> params = type_pack&lt;Enum1, Enum2&gt;{};</code> </pre> </li><li> ç”±äºè¿æ¥ä¸å†é€šè¿‡ç»§æ‰¿è¿›è¡Œï¼Œå› æ­¤æˆ‘ä¸å¾—ä¸ç¼–å†™containså‡½æ•°ï¼š <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">contains</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_pack</span></span></span><span class="hljs-class">&lt;Ts...&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_identity</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">v</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((type_identity&lt;Ts&gt;{} == v) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ...); }</code> </pre> </li><li> æ²¡æœ‰å¤šä½™çš„ç±»å‹ï¼Œæ‰€æœ‰å®éƒ½æ¶ˆå¤±äº† </li><li> æˆ‘é€šè¿‡æ¨¡æ¿å‚æ•°å°†å‚æ•°ä¼ é€’ç»™æ–¹æ³•ï¼Œä»¥åœ¨constexprä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å®ƒä»¬ </li><li> ç°åœ¨åœ¨setæ–¹æ³•ä¸­ï¼Œconstexpré€»è¾‘ä¸è®°å½•æœ¬èº«çš„é€»è¾‘æ˜æ˜¾åˆ†å¼€ <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>...args&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> values_for_write = extract(registers, args...); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> [value, offset] : values_for_write) { write(Address::value + offset, value); } }</code> </pre> </li><li> æå–å‡½æ•°åœ¨constexprä¸­åˆ†é…ä¸€ä¸ªå€¼æ•°ç»„ï¼Œä»¥å†™å…¥å¯„å­˜å™¨ã€‚ å®ƒçš„å®ç°ä¸å…ˆå‰çš„setå‡½æ•°éå¸¸ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä¸ç›´æ¥å†™å…¥å¯„å­˜å™¨ã€‚ </li><li> æˆ‘å¿…é¡»æ·»åŠ å¦ä¸€ä¸ªæ ¹æ®lambdaå‡½æ•°å°†type_packè½¬æ¢ä¸ºæ•°ç»„çš„å…ƒå‡½æ•°ã€‚ <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">...</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ts</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to_array</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type_pack</span></span></span><span class="hljs-class">&lt;Ts...&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pack</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">array</span></span>{f(type_identity&lt;Ts&gt;{})...}; }</code> </pre> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483378/">https://habr.com/ru/post/zh-CN483378/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483366/index.html">äº’è”ç½‘å†å²è®°å½•ï¼šç½‘ç»œ</a></li>
<li><a href="../zh-CN483368/index.html">ä¸ºLinuxåˆ›å»ºx86_64 ELFæ–‡ä»¶æ‰“åŒ…å™¨</a></li>
<li><a href="../zh-CN483372/index.html">å¦‚ä½•ä½¿ç”¨GPUåœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šè®­ç»ƒDeepPavlovç¥ç»ç½‘ç»œ</a></li>
<li><a href="../zh-CN483374/index.html">REST APIå»ºè®®-Javaå’ŒSpringä¸­çš„WebæœåŠ¡è®¾è®¡ç¤ºä¾‹</a></li>
<li><a href="../zh-CN483376/index.html">åœ¨é»‘æ´çš„è¡¨é¢</a></li>
<li><a href="../zh-CN483380/index.html">å¾®æœåŠ¡ï¼šå¦‚ä½•éµå®ˆåˆåŒ</a></li>
<li><a href="../zh-CN483382/index.html">å¡åˆ©Linux 2020.1</a></li>
<li><a href="../zh-CN483384/index.html">æˆ‘ä»¬æœ€ç»å¸¸è¯¯ä»¥ä¸ºæ˜¯ITè¯å…¸çš„å“ªäº›è‹±è¯­å•è¯</a></li>
<li><a href="../zh-CN483386/index.html">é“¶æ²³ç³»å³å°†æ¥ä¸´çš„é“¶æ²³ç¢°æ’å·²ç»å­•è‚²äº†æ–°æ˜Ÿ</a></li>
<li><a href="../zh-CN483388/index.html">æˆ‘çš„å¥³æœ‹å‹å’Œç¬¬ä¸€ä¸ªç”µå­æ¸¸æˆã€‚ ç»Ÿä¸€å¼€å‘ã€‚ ç¬¬äºŒéƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>