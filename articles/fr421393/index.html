<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👇🏻 👨🏻‍🏫 👩🏻‍⚕️ Panier Mailchimp abandonné: un guide pour les paresseux 🏳️ 👩🏽‍🏭 🥜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D'abord, un peu délirant :) Tôt ou tard, toute boutique en ligne se pose la question de mettre en place un panier abandonné. Les statistiques et le se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Panier Mailchimp abandonné: un guide pour les paresseux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421393/">  D'abord, un peu délirant :) Tôt ou tard, toute boutique en ligne se pose la question de mettre en place un panier abandonné.  Les statistiques et le sentiment de perte d'argent en suçant l'estomac n'épargnent personne. <br><br><h4>  Pourcentage de paniers abandonnés de 2006 à 2017 </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/a39/77d/91a/a3977d91a0ebd3217886009fec230985.jpg" alt="Pourcentage de paniers abandonnés de 2006 à 2017"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  Pourcentage de paniers abandonnés pour le premier trimestre de 2018 par industrie: <br><img src="https://habrastorage.org/getpro/habr/post_images/633/2b5/be6/6332b5be64d04bbd4ca0d1defe9e7b14.jpg" alt="Pourcentage de paniers abandonnés pour le premier trimestre de 2018 par industrie"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  Dans le même temps, malgré les statistiques généralement disponibles, la plupart des boutiques en ligne n'utilisent pas les fonctionnalités disponibles et ne connectent pas un panier abandonné.  Une récente étude «à domicile» d'EmailSoldiers montre clairement que la plupart des magasins ne s'en soucient pas du tout. <br><a name="habracut"></a><br><h4>  Statistiques actuelles pour les paniers abandonnés connectés </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/fd4/b56/83f/fd4b5683f724d5004046e14523b95f69.jpg" alt="Recherche de soldats"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  Dans le même temps, tout le monde (et nous aussi, nous ne sommes pas des saints) rattrape le trafic, publie des publicités et des créations, mais n'essaye même pas de rendre la personne qui s'est cassée au dernier moment. <br><br>  Mais dans la première itération, vous pouvez obtenir une augmentation des commandes en utilisant une lettre sans contenu dynamique, il vous suffit de la configurer.  Ne faites un effort qu'une seule fois pour qu'en arrière plan cela rapporte de l'argent - n'est-ce pas un conte de fées? <br><br>  Naturellement, une lettre au contenu dynamique dans lequel les marchandises du panier sont tirées peut fonctionner mieux.  Ou peut-être qu'un autre chaton aux yeux tristes aura plus d'influence sur votre public.  Ou vous tirez les marchandises recommandées vers les marchandises dans le panier et voyez qu'elles sont achetées plus souvent à partir de lettres et augmentez le chèque moyen.  Ou vous aurez la possibilité de créer une série de lettres à partir de laquelle la conversion sera encore plus importante. <br><br>  Vous pouvez améliorer et tester des lettres d'un panier abandonné vers un idéal inaccessible, mais toute lettre une fois configurée est déjà incomparablement meilleure que rien. <br><br><h4>  Conversion pour un panier abandonné selon RetailRocket </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/df2/2f9/684/df22f968450761e23695591fcd2931af.jpg" alt="Conversion de panier abandonné RetailRocket"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  Et donc, le camarade <a href="">Artem Aleksandrov et moi avons</a> commencé l'introduction du panier de deux côtés. <br><br><h2>  Implémentation technique </h2><br><h4>  TOR pour l'intégration </h4><br>  Décrivez brièvement l'essence de la tâche. <br><br>  Tâche: connecter un panier abandonné pour le site xxx.xx avec le service de messagerie Mailchimp <br><br>  Nous distribuons tout le matériel nécessaire. <br><br>  Clé API: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-usXX <br><br>  Où trouver la clé? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9f/511/fc0/f9f511fc0d1ff7d44d41d19463cd362e.jpg" alt="Où trouver la clé?"><br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nous donnons un lien vers la documentation</a> <br><br>  ID de la feuille à laquelle nous connectons le magasin: XXXXXXXXXX <br><br>  Où puis-je obtenir l'ID de la feuille? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/215/996/6cb/2159966cb62dc60e25079b86c5905aca.jpg" alt="Où puis-je obtenir l'ID de la feuille?"><br><br>  Un service de messagerie doit être créé à l'avance.  Dès que la demande d'API est reçue par le service de mailing, le message est généré automatiquement et le destinataire est ajouté à la file d'attente pour l'envoi. <br><br>  Pour notre cas, nous avons choisi la logique suivante pour l'envoi d'un panier abandonné: <br>  un utilisateur autorisé sur le site ajoute des marchandises au panier, ne termine pas la transaction et ne termine pas la commande, le panier reste inchangé pendant 1 heure.  Après cela, une demande est envoyée à Mailchimp, dans laquelle un e-mail, la composition de la commande de l'utilisateur, des images de produits, le prix des marchandises et un lien vers le panier de l'utilisateur sont transmis. <br><br><h4>  Modèle de mise en page </h4><br>  Lors de la création de l'automatisation d'un panier abandonné, le mailchim demande immédiatement s'il y aura une lettre ou plusieurs et suggère de choisir un magasin connecté. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12d/288/b80/12d288b80aed84cc9ac1b3b81b4d3d6d.jpg" alt="Créer une automatisation pour un panier abandonné dans Mailchimp"><br><br>  Dans les modèles de base, mch propose un choix de trois pièces: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f2/402/d62/7f2402d625f7174f3a18f42849080bea.jpg" alt="Sélectionnez des lettres pour un panier Mailchimp abandonné"><br><ol><li>  Panier abandonné avec des produits dynamiques </li><li>  Panier abandonné avec recommandations d'épicerie (doit être configuré séparément) </li><li>  Panier abandonné sans marchandise (juste une lettre texte) </li></ol><br>  Dans les meilleures traditions, si vous avez le temps, vous pouvez composer vous-même le panier. <br><br>  Les produits dynamiques sans styles ressemblent à ceci (oubliez l'indentation, ils sont laids ici): <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> *|ABANDONED_CART:[$total=3]|* <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|CART:URL|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:TITLE|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_blank"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:IMAGE_URL|*"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> *|PRODUCT:TITLE|* — *|PRODUCT:PRICE|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Il semblerait que si vous modifiez le nombre dans la variable <b>* | ABANDONED_CART: [$ total = 3] | *</b> , alors la lettre affichera une quantité différente de marchandises, mais non, mettez au moins 5, au moins 100, le mch refuse d'afficher une autre quantité. <br><br>  Et, ce qui est également un peu étrange, la variable <b>* | PRODUCT: PRICE | *</b> est remplacée par des valeurs de format RUB288, et pour une raison quelconque, il est également impossible de changer cela, mais plus à ce sujet plus tard. <br><br>  Pour changer, nous avons essayé de substituer des variables au nombre de jeux et au coût total de la commande, que nous transmettons via l'API, mais le mailchimp ici a dit non.  Eh bien, tant pis. <br><br><h4>  Un mot au programmeur :) </h4><br>  Avec mailchimp, il y a eu une expérience historique d'intégration avec leur mandrill de service tiers, tout y est simple et clair.  Documentation très sympathique (bien sûr, en anglais), mais il n'y avait pas de bords rugueux et cela a fonctionné dès le premier coup de pied. <br><br>  De plus, un mécanisme d'abonnement via des formulaires spéciaux a été introduit sur notre site.  Ici, nous avons pleinement ressenti l'euphémisme et l'ambiguïté de la documentation de mailchimp.  L'anglais n'est pas un problème pour un développeur expérimenté, mais la connaissance du dialecte Klingon n'est pas implicite par défaut. <br><br>  Les données initiales sont: le langage php7 et le framework yii2, qui a déjà connu une croissance écrasante avec son écosystème.  C'est-à-dire  Nous avons déjà 6 petits projets qui essaient d'utiliser des composants communs à la fois sur le backend et le front-end.  En conséquence, la mise en œuvre de toute tâche nécessite de résoudre son projet de manière indépendante, mais cela n'implique pas l'indépendance du cadre, car  il faut le payer avec des heures humaines, dont il y a toujours une pénurie. <br><br>  Ayant reçu la tâche de l'intégration, nous devons d'abord regarder autour de nous.  Qu'est-ce qui nous est donné?  Tout d'abord, le service mailchimp avec lequel vous devez vous lier d'amitié.  Nous allons dans le github et voyons qu'il y a beaucoup d'implémentations.  Mais le choix est simple - le package le plus populaire de 1,5 k étoiles ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">drewm / mailchimp-api</a> ). <br><br>  Le package fournit un wrapper simple sur l'interaction de repos avec un mailchimp.  Nous ne pouvons l'acquérir qu'avec notre logique. <br><br>  Deuxièmement, nous recevons de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> .  Sur la base de la documentation, nous avons une ressource Store avec des ressources imbriquées: panier, client, commande, produit, règle de promotion.  Pour un panier abandonné sans produits recommandés, nous n'avons besoin que du produit, du panier et du client.  Le chariot, à son tour, se compose de l'ensemble de lignes du panier et le produit contient des variantes de produit. <br><br>  Nous avons décomposé la tâche comme suit: <br><br><ol><li>  Charger les données du magasin dans les magasins </li><li>  Téléchargez tous les produits achetables sur Produits </li><li>  Configurer le chargement des paniers avec les utilisateurs selon un calendrier </li></ol><br>  Ok, allons-y.  Tout d'abord, nous prenons l'essence du «magasin».  Nous avons décidé d'utiliser immédiatement la version test et combat de la boutique et, selon la variable d'environnement responsable du mode maiden / prod, nous avons travaillé soit avec une boutique soit avec une autre. <br><br>  Pour télécharger les données du magasin, nous frappons à une demande de publication sur / ecommerce / stores avec l'ensemble de paramètres suivant: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'list_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'****'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'*** - test'</span></span>, <span class="hljs-string"><span class="hljs-string">'domain'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'admin@***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'primary_locale'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'money_format'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'₽'</span></span>, ]</code> </pre> <br>  Il existe plusieurs autres options, mais tout dépend des besoins.  Parce que  nous n'allions pas utiliser les coordonnées du magasin dans des lettres, nous n'avons pas rempli les champs téléphone, adresse, fuseau horaire, etc. <br>  Mais une petite surprise nous attendait.  Le champ money_format semble être spécialement créé pour la possibilité de présenter le prix dans un format qui nous convient.  Mais lors de la construction d'un modèle de panier abandonné, la puce électronique remplace obstinément RUB avant le numéro.  Mailchimp, arrêtez! <br><br>  Après le téléchargement, nous pouvons vérifier les données en utilisant la requête get à l'adresse / ecommerce / stores pour voir tous les magasins chargés, ou / ecommerce / stores / {id} pour obtenir des données sur un magasin particulier. <br><br>  Vous pouvez maintenant ajouter toutes les autres données, car le magasin est le point racine de notre arbre de données, car  nous téléchargerons toutes les autres données dans un magasin spécifique. <br><br>  Donc, pour que L'HME puisse remplacer les marchandises dans un panier abandonné, il doit nourrir ces marchandises.  Pour ce faire, nous avons l'adresse / ecommerce / stores / {store_id} / products, où nous envoyons des post-demandes de création de produits dans le système. <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'handle'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'kastrulya'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' —    .  ,       .  ,        !           !'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'vendor'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'variants'</span></span> =&gt; [ [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">890</span></span>, <span class="hljs-string"><span class="hljs-string">'sku'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'KA453'</span></span>, <span class="hljs-string"><span class="hljs-string">'inventory_quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'visibility'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'visible'</span></span>, ], ], ]</code> </pre><br>  Qu'est-ce qui est si remarquable?  Eh bien, premièrement, chaque produit doit comprendre au moins une offre de produit.  En substance, le produit est un conteneur pour le chargement des offres de produits.  De plus, l'ID du produit et de l'offre de produits peut se recouper, car ce sont des ressources différentes dans l'API MCH. <br><br>  Et c'est là que la sous-estimation de la documentation de L'HME a commencé.  Je devais deviner, même si ce n'était pas difficile, mais vous pouviez le faire normalement, et pas comme toujours. <br><br>  Le champ poignée a été décrit comme «la poignée d'un produit».  Ok, après consultation, nous avons décidé que cela faisait partie de l'URL liée au produit lui-même (cnc).  Mais cela n'a été confirmé que lors des tests. <br><br>  Vous pouvez également joindre un tableau d'images au produit, mais nous avons décidé qu'il ne nous serait pas utile et que seule l'image principale était chargée à la fois sur le produit et sur chaque offre de produit. <br><br>  Et ici, nous avons eu un problème, pour une raison quelconque, les marchandises n'apparaissaient pas dans les modèles de diagramme de courrier. <br><br>  Nous avons commencé à creuser dans le quai pour le produit.  Et ils ont trouvé un champ de visibilité avec une description luxueuse: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/525/123/aae/525123aae8eff2a8a1a595072d92b2f6.jpg" alt="description du champ de visibilité"><br><br>  Eh bien, tapez String!  Et que peut-on y transférer?  Pourquoi est-il impossible de décrire toutes les significations possibles?!  Je peux y envoyer, par exemple, "montrez-moi les pls!". <br><br>  Heureusement, il existe un exemple de demande! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57b/e08/dbe/57be08dbe97502fc302cc4de5dc0e4bf.jpg" alt="exemple de demande"><br><br>  Eh bien, cela n'annule pas le problème.  Je ne sais pas quelles autres valeurs peuvent être utiles. <br><br>  Tout le monde a fait face à ça!  Désormais, le responsable du marketing par e-mail peut vérifier la disponibilité des produits dans le système en créant un modèle avec la participation des produits ou tout au long des mêmes requêtes get à l'aide de la console. <br><br>  Ensuite, nous sommes confrontés à la tâche de charger des paniers abandonnés dans l'HME.  Au départ, 2 options me sont venues à l'esprit: <br><br><ol><li>  Chaque fois que vous changez le panier (ajouter / supprimer des marchandises), nous répétons cette action dans MCH.  Parmi les inconvénients - un grand nombre de demandes à un service externe se suggère immédiatement. </li><li>  Toutes les n minutes, regardez les paniers qui n'ont pas changé depuis plus d'une heure.  Ensuite, nous les envoyons à L'HME.  Il n'y a qu'un seul problème: garder une trace des paniers qui ont été repris après leur passage à l'HME. </li></ol><br>  Tout d'abord, nous demandons à notre base de données (ci-après dénommée la DB) nos données dans une fenêtre de 1 heure à 3. Pourquoi 3?  Une heure après le dernier changement, nous envoyons le panier au système.  Dans l'HME, l'intervalle minimum possible pour l'envoi du panier est de 1 heure.  Par conséquent, en théorie, après 2 heures ± 5 minutes, une lettre sera envoyée.  Donc 3 heures est une valeur même avec une marge. <br><br>  Après avoir reçu les données de la base de données, nous faisons une demande d'obtention à l'adresse / ecommerce / stores / {store_id} / carts.  Ainsi, nous obtenons tous les paniers qui se trouvent dans le système de commerce électronique et attendent leur tour d'envoyer (ou ont déjà été envoyés).  Pourquoi en avons-nous besoin?  Il est nécessaire pour la synchronisation avec nos données.  Nous enverrons tous les paniers reçus de la base de données, mais nous devons supprimer ceux qui ne sont plus dans la plage de 1 à 3 heures.  Après 3x - données déjà non pertinentes.  Jusqu'à une heure - des paniers qui pourraient être renouvelés à nouveau ou passer une commande. <br><br>  Pour supprimer, il suffit de trouver la différence entre les deux tableaux / collections de paniers. <br>  Après avoir reçu les paniers à supprimer, nous envoyons une demande de suppression / ecommerce / stores / {store_id} / carts / {cart_id}. <br><br>  Ensuite, nous prenons les paniers à télécharger et les envoyons par post-requêtes au système dans un cycle. <br><br>  Les paramètres du panier ressemblent à ceci: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> ? //***.Ru/cart/abandoned/ panier = eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0% 253D', <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> </pre><br>  Et encore une fois, notre rubrique préférée est «devinez comment ces champs fonctionnent».  Par exemple, par la méthode de piquer scientifique, il a été révélé qu'il est possible de ne pas créer un acheteur avec une demande distincte.  Il est nécessaire de transférer l'ensemble minimal de champs requis, et il sera automatiquement créé s'il n'était pas dans le système.  Dans notre cas, nous nous sommes limités à id, email, opt_in_status.  Le dernier paramètre est responsable de l'état de l'abonnement utilisateur dans notre fiche.  Si c'est vrai, cela signifie que l'état est souscrit, sinon transactionnel. <br><br>  La liste des produits est chargée sans problème via le tableau Cart Lines, qui à son tour est une ressource de l'entité Cart.  C'est-à-dire  nous pouvons gérer séparément cet ensemble avec des demandes de repos. <br><br>  Eh bien, c'est tout, semble-t-il?  Mais non. <br><br>  Lors des tests, nous avons remarqué qu'envoyant le même panier, il n'est envoyé qu'une seule fois.  Bien que nous l'avons supprimé du système et téléchargé à nouveau.  Rien n'est dit nulle part, pas un seul mot!  En conséquence, empiriquement, avec l'aide d'une mère, nous avons pris comme hypothèse qu'un panier avec le même identifiant ne peut être envoyé qu'une seule fois. <br><br>  Ici, je suis entièrement d'accord avec les créateurs que cette restriction nous évite de spammer les utilisateurs.  Mais écris à ce sujet!  Nous n'avons pas besoin de quêtes, nous avons assez de nos erreurs mystiques dans le code que nous écrivons. <br><br>  Après avoir fait tout cela, L'HME a commencé à nous envoyer de belles lettres sur le panier abandonné.  Et puis une deuxième question est apparue.  Si l'utilisateur a jeté le panier et est revenu de la lettre sur son propre compte, c'est-à-dire qu'il a été autorisé au moment de cliquer sur le lien, il rentrera sans problème dans son panier.  Et il s'avère que la lettre dit «on!  prenez votre panier! », et quand nous le traversons, nous disons:« Oups, quelque chose a été perdu!  Nous n'avons rien touché!  C'est lui-même! " <br><br>  Il a été décidé de coder la composition du panier en une chaîne et de la transmettre à checkout_url lors de l'envoi du panier au MCH.  Et quand vous allez sur le site, attrapez cette ligne, décodez et jetez toutes les marchandises dans le panier, sans oublier de le réinitialiser complètement avant cela. <br><br>  Ainsi, quel que soit le navigateur auquel nous envoyons l'utilisateur, il obtient son panier, comme nous l'avions promis.  Le seul point négatif est qu'il ne peut que se connecter.  Mais autoriser via un lien est une mauvaise manière, et c'est en effet une entreprise dangereuse, tout d'abord pour nos clients. <br>  Quel est le résultat?  En principe, il n'y a pas eu de problème particulier lors de la mise en œuvre, car très souvent les réponses MCH ont permis de corriger les erreurs liées à la validation des champs transférés.  Mais il y en aurait encore moins s'ils décrivaient normalement humainement toutes ces subtilités du travail de L'HME et décrivaient les champs plus en détail. <br><br><h2>  Configuration du rapport dans Google.Analytics </h2><br>  Pour suivre le succès de l'ensemble de l'opération, vous devrez configurer et consulter périodiquement le rapport dans l'analyse.  Imaginez que tout le monde, comme les adultes, ait un commerce électronique connecté, sinon un miracle ne fonctionnera pas :) <br><br>  Pour collecter un nouveau rapport pour un panier abandonné, accédez à "Mes rapports": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afe/749/f87/afe749f87d1c6bd4e5a0810dab40b4ef.jpg" alt="Mes rapports"><br><br>  "Ajouter un rapport": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/288/8bd/ba2/2888bdba2a5749ccc90c88c3f5c80f49.jpg" alt="Ajouter un rapport"><br><br>  Et après cela, nous ajoutons les paramètres que nous suivrons.  Nous avons décidé de regarder le panier abandonné dans le contexte des villes, vous avez peut-être une vision différente. <br><br>  Pour un mailchamp, la campagne standard pour un panier abandonné est ABANDONED_CART_EMAIL, nous le remplaçons dans le filtre et obtenons un rapport. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca0/a77/b25/ca0a77b256b42242851ceaed308e02c7.jpg" alt="image"><br><br>  Ce sont toutes des fourchettes! <br><br>  Vous êtes maintenant configuré pour envoyer le panier abandonné et un rapport par lequel vous pouvez regarder l'échappement de celui-ci.  Et test, test, test!  ;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr421393/">https://habr.com/ru/post/fr421393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr421383/index.html">Epic Growth Conference Autumn 2018 - conférence de marketing de produit à Moscou</a></li>
<li><a href="../fr421385/index.html">Apprenez OpenGL. Leçon 5.10 - Occlusion ambiante de l'espace d'écran</a></li>
<li><a href="../fr421387/index.html">Entretien avec Lennart Pottering sur Linux Piter sur les changements dans Linux, sur systemd et pourquoi assister à des conférences</a></li>
<li><a href="../fr421389/index.html">Séparation des pouvoirs administratifs à Zimbra</a></li>
<li><a href="../fr421391/index.html">HackThings - un grand hackathon sur l'Internet des objets du 7 au 9 septembre à Skoltech</a></li>
<li><a href="../fr421395/index.html">Rapport du Club de Rome 2018, chapitre 3.7: «Climat: bonne nouvelle mais gros problèmes»</a></li>
<li><a href="../fr421397/index.html">Lancez la Mini AI Cup # 3. Bataille mécanique dans des espaces confinés</a></li>
<li><a href="../fr421399/index.html">Analyse de la porte dérobée de Turla Cybergroup Outlook</a></li>
<li><a href="../fr421401/index.html">Anatomie des systèmes de recommandation. Deuxième partie</a></li>
<li><a href="../fr421403/index.html">Semaine de la sécurité 32: drame Fortnite-Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>