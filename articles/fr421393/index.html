<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëáüèª üë®üèª‚Äçüè´ üë©üèª‚Äç‚öïÔ∏è Panier Mailchimp abandonn√©: un guide pour les paresseux üè≥Ô∏è üë©üèΩ‚Äçüè≠ ü•ú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D'abord, un peu d√©lirant :) T√¥t ou tard, toute boutique en ligne se pose la question de mettre en place un panier abandonn√©. Les statistiques et le se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Panier Mailchimp abandonn√©: un guide pour les paresseux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421393/">  D'abord, un peu d√©lirant :) T√¥t ou tard, toute boutique en ligne se pose la question de mettre en place un panier abandonn√©.  Les statistiques et le sentiment de perte d'argent en su√ßant l'estomac n'√©pargnent personne. <br><br><h4>  Pourcentage de paniers abandonn√©s de 2006 √† 2017 </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/a39/77d/91a/a3977d91a0ebd3217886009fec230985.jpg" alt="Pourcentage de paniers abandonn√©s de 2006 √† 2017"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  Pourcentage de paniers abandonn√©s pour le premier trimestre de 2018 par industrie: <br><img src="https://habrastorage.org/getpro/habr/post_images/633/2b5/be6/6332b5be64d04bbd4ca0d1defe9e7b14.jpg" alt="Pourcentage de paniers abandonn√©s pour le premier trimestre de 2018 par industrie"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  Dans le m√™me temps, malgr√© les statistiques g√©n√©ralement disponibles, la plupart des boutiques en ligne n'utilisent pas les fonctionnalit√©s disponibles et ne connectent pas un panier abandonn√©.  Une r√©cente √©tude ¬´√† domicile¬ª d'EmailSoldiers montre clairement que la plupart des magasins ne s'en soucient pas du tout. <br><a name="habracut"></a><br><h4>  Statistiques actuelles pour les paniers abandonn√©s connect√©s </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/fd4/b56/83f/fd4b5683f724d5004046e14523b95f69.jpg" alt="Recherche de soldats"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  Dans le m√™me temps, tout le monde (et nous aussi, nous ne sommes pas des saints) rattrape le trafic, publie des publicit√©s et des cr√©ations, mais n'essaye m√™me pas de rendre la personne qui s'est cass√©e au dernier moment. <br><br>  Mais dans la premi√®re it√©ration, vous pouvez obtenir une augmentation des commandes en utilisant une lettre sans contenu dynamique, il vous suffit de la configurer.  Ne faites un effort qu'une seule fois pour qu'en arri√®re plan cela rapporte de l'argent - n'est-ce pas un conte de f√©es? <br><br>  Naturellement, une lettre au contenu dynamique dans lequel les marchandises du panier sont tir√©es peut fonctionner mieux.  Ou peut-√™tre qu'un autre chaton aux yeux tristes aura plus d'influence sur votre public.  Ou vous tirez les marchandises recommand√©es vers les marchandises dans le panier et voyez qu'elles sont achet√©es plus souvent √† partir de lettres et augmentez le ch√®que moyen.  Ou vous aurez la possibilit√© de cr√©er une s√©rie de lettres √† partir de laquelle la conversion sera encore plus importante. <br><br>  Vous pouvez am√©liorer et tester des lettres d'un panier abandonn√© vers un id√©al inaccessible, mais toute lettre une fois configur√©e est d√©j√† incomparablement meilleure que rien. <br><br><h4>  Conversion pour un panier abandonn√© selon RetailRocket </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/df2/2f9/684/df22f968450761e23695591fcd2931af.jpg" alt="Conversion de panier abandonn√© RetailRocket"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Source</a></i> <br><br>  Et donc, le camarade <a href="">Artem Aleksandrov et moi avons</a> commenc√© l'introduction du panier de deux c√¥t√©s. <br><br><h2>  Impl√©mentation technique </h2><br><h4>  TOR pour l'int√©gration </h4><br>  D√©crivez bri√®vement l'essence de la t√¢che. <br><br>  T√¢che: connecter un panier abandonn√© pour le site xxx.xx avec le service de messagerie Mailchimp <br><br>  Nous distribuons tout le mat√©riel n√©cessaire. <br><br>  Cl√© API: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-usXX <br><br>  O√π trouver la cl√©? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9f/511/fc0/f9f511fc0d1ff7d44d41d19463cd362e.jpg" alt="O√π trouver la cl√©?"><br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nous donnons un lien vers la documentation</a> <br><br>  ID de la feuille √† laquelle nous connectons le magasin: XXXXXXXXXX <br><br>  O√π puis-je obtenir l'ID de la feuille? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/215/996/6cb/2159966cb62dc60e25079b86c5905aca.jpg" alt="O√π puis-je obtenir l'ID de la feuille?"><br><br>  Un service de messagerie doit √™tre cr√©√© √† l'avance.  D√®s que la demande d'API est re√ßue par le service de mailing, le message est g√©n√©r√© automatiquement et le destinataire est ajout√© √† la file d'attente pour l'envoi. <br><br>  Pour notre cas, nous avons choisi la logique suivante pour l'envoi d'un panier abandonn√©: <br>  un utilisateur autoris√© sur le site ajoute des marchandises au panier, ne termine pas la transaction et ne termine pas la commande, le panier reste inchang√© pendant 1 heure.  Apr√®s cela, une demande est envoy√©e √† Mailchimp, dans laquelle un e-mail, la composition de la commande de l'utilisateur, des images de produits, le prix des marchandises et un lien vers le panier de l'utilisateur sont transmis. <br><br><h4>  Mod√®le de mise en page </h4><br>  Lors de la cr√©ation de l'automatisation d'un panier abandonn√©, le mailchim demande imm√©diatement s'il y aura une lettre ou plusieurs et sugg√®re de choisir un magasin connect√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12d/288/b80/12d288b80aed84cc9ac1b3b81b4d3d6d.jpg" alt="Cr√©er une automatisation pour un panier abandonn√© dans Mailchimp"><br><br>  Dans les mod√®les de base, mch propose un choix de trois pi√®ces: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f2/402/d62/7f2402d625f7174f3a18f42849080bea.jpg" alt="S√©lectionnez des lettres pour un panier Mailchimp abandonn√©"><br><ol><li>  Panier abandonn√© avec des produits dynamiques </li><li>  Panier abandonn√© avec recommandations d'√©picerie (doit √™tre configur√© s√©par√©ment) </li><li>  Panier abandonn√© sans marchandise (juste une lettre texte) </li></ol><br>  Dans les meilleures traditions, si vous avez le temps, vous pouvez composer vous-m√™me le panier. <br><br>  Les produits dynamiques sans styles ressemblent √† ceci (oubliez l'indentation, ils sont laids ici): <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> *|ABANDONED_CART:[$total=3]|* <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|CART:URL|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:TITLE|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_blank"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:IMAGE_URL|*"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> *|PRODUCT:TITLE|* ‚Äî *|PRODUCT:PRICE|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Il semblerait que si vous modifiez le nombre dans la variable <b>* | ABANDONED_CART: [$ total = 3] | *</b> , alors la lettre affichera une quantit√© diff√©rente de marchandises, mais non, mettez au moins 5, au moins 100, le mch refuse d'afficher une autre quantit√©. <br><br>  Et, ce qui est √©galement un peu √©trange, la variable <b>* | PRODUCT: PRICE | *</b> est remplac√©e par des valeurs de format RUB288, et pour une raison quelconque, il est √©galement impossible de changer cela, mais plus √† ce sujet plus tard. <br><br>  Pour changer, nous avons essay√© de substituer des variables au nombre de jeux et au co√ªt total de la commande, que nous transmettons via l'API, mais le mailchimp ici a dit non.  Eh bien, tant pis. <br><br><h4>  Un mot au programmeur :) </h4><br>  Avec mailchimp, il y a eu une exp√©rience historique d'int√©gration avec leur mandrill de service tiers, tout y est simple et clair.  Documentation tr√®s sympathique (bien s√ªr, en anglais), mais il n'y avait pas de bords rugueux et cela a fonctionn√© d√®s le premier coup de pied. <br><br>  De plus, un m√©canisme d'abonnement via des formulaires sp√©ciaux a √©t√© introduit sur notre site.  Ici, nous avons pleinement ressenti l'euph√©misme et l'ambigu√Øt√© de la documentation de mailchimp.  L'anglais n'est pas un probl√®me pour un d√©veloppeur exp√©riment√©, mais la connaissance du dialecte Klingon n'est pas implicite par d√©faut. <br><br>  Les donn√©es initiales sont: le langage php7 et le framework yii2, qui a d√©j√† connu une croissance √©crasante avec son √©cosyst√®me.  C'est-√†-dire  Nous avons d√©j√† 6 petits projets qui essaient d'utiliser des composants communs √† la fois sur le backend et le front-end.  En cons√©quence, la mise en ≈ìuvre de toute t√¢che n√©cessite de r√©soudre son projet de mani√®re ind√©pendante, mais cela n'implique pas l'ind√©pendance du cadre, car  il faut le payer avec des heures humaines, dont il y a toujours une p√©nurie. <br><br>  Ayant re√ßu la t√¢che de l'int√©gration, nous devons d'abord regarder autour de nous.  Qu'est-ce qui nous est donn√©?  Tout d'abord, le service mailchimp avec lequel vous devez vous lier d'amiti√©.  Nous allons dans le github et voyons qu'il y a beaucoup d'impl√©mentations.  Mais le choix est simple - le package le plus populaire de 1,5 k √©toiles ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">drewm / mailchimp-api</a> ). <br><br>  Le package fournit un wrapper simple sur l'interaction de repos avec un mailchimp.  Nous ne pouvons l'acqu√©rir qu'avec notre logique. <br><br>  Deuxi√®mement, nous recevons de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> .  Sur la base de la documentation, nous avons une ressource Store avec des ressources imbriqu√©es: panier, client, commande, produit, r√®gle de promotion.  Pour un panier abandonn√© sans produits recommand√©s, nous n'avons besoin que du produit, du panier et du client.  Le chariot, √† son tour, se compose de l'ensemble de lignes du panier et le produit contient des variantes de produit. <br><br>  Nous avons d√©compos√© la t√¢che comme suit: <br><br><ol><li>  Charger les donn√©es du magasin dans les magasins </li><li>  T√©l√©chargez tous les produits achetables sur Produits </li><li>  Configurer le chargement des paniers avec les utilisateurs selon un calendrier </li></ol><br>  Ok, allons-y.  Tout d'abord, nous prenons l'essence du ¬´magasin¬ª.  Nous avons d√©cid√© d'utiliser imm√©diatement la version test et combat de la boutique et, selon la variable d'environnement responsable du mode maiden / prod, nous avons travaill√© soit avec une boutique soit avec une autre. <br><br>  Pour t√©l√©charger les donn√©es du magasin, nous frappons √† une demande de publication sur / ecommerce / stores avec l'ensemble de param√®tres suivant: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'list_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'****'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'*** - test'</span></span>, <span class="hljs-string"><span class="hljs-string">'domain'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'admin@***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'primary_locale'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'money_format'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'‚ÇΩ'</span></span>, ]</code> </pre> <br>  Il existe plusieurs autres options, mais tout d√©pend des besoins.  Parce que  nous n'allions pas utiliser les coordonn√©es du magasin dans des lettres, nous n'avons pas rempli les champs t√©l√©phone, adresse, fuseau horaire, etc. <br>  Mais une petite surprise nous attendait.  Le champ money_format semble √™tre sp√©cialement cr√©√© pour la possibilit√© de pr√©senter le prix dans un format qui nous convient.  Mais lors de la construction d'un mod√®le de panier abandonn√©, la puce √©lectronique remplace obstin√©ment RUB avant le num√©ro.  Mailchimp, arr√™tez! <br><br>  Apr√®s le t√©l√©chargement, nous pouvons v√©rifier les donn√©es en utilisant la requ√™te get √† l'adresse / ecommerce / stores pour voir tous les magasins charg√©s, ou / ecommerce / stores / {id} pour obtenir des donn√©es sur un magasin particulier. <br><br>  Vous pouvez maintenant ajouter toutes les autres donn√©es, car le magasin est le point racine de notre arbre de donn√©es, car  nous t√©l√©chargerons toutes les autres donn√©es dans un magasin sp√©cifique. <br><br>  Donc, pour que L'HME puisse remplacer les marchandises dans un panier abandonn√©, il doit nourrir ces marchandises.  Pour ce faire, nous avons l'adresse / ecommerce / stores / {store_id} / products, o√π nous envoyons des post-demandes de cr√©ation de produits dans le syst√®me. <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'handle'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'kastrulya'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' ‚Äî    .  ,       .  ,        !           !'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'vendor'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'variants'</span></span> =&gt; [ [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">890</span></span>, <span class="hljs-string"><span class="hljs-string">'sku'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'KA453'</span></span>, <span class="hljs-string"><span class="hljs-string">'inventory_quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'visibility'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'visible'</span></span>, ], ], ]</code> </pre><br>  Qu'est-ce qui est si remarquable?  Eh bien, premi√®rement, chaque produit doit comprendre au moins une offre de produit.  En substance, le produit est un conteneur pour le chargement des offres de produits.  De plus, l'ID du produit et de l'offre de produits peut se recouper, car ce sont des ressources diff√©rentes dans l'API MCH. <br><br>  Et c'est l√† que la sous-estimation de la documentation de L'HME a commenc√©.  Je devais deviner, m√™me si ce n'√©tait pas difficile, mais vous pouviez le faire normalement, et pas comme toujours. <br><br>  Le champ poign√©e a √©t√© d√©crit comme ¬´la poign√©e d'un produit¬ª.  Ok, apr√®s consultation, nous avons d√©cid√© que cela faisait partie de l'URL li√©e au produit lui-m√™me (cnc).  Mais cela n'a √©t√© confirm√© que lors des tests. <br><br>  Vous pouvez √©galement joindre un tableau d'images au produit, mais nous avons d√©cid√© qu'il ne nous serait pas utile et que seule l'image principale √©tait charg√©e √† la fois sur le produit et sur chaque offre de produit. <br><br>  Et ici, nous avons eu un probl√®me, pour une raison quelconque, les marchandises n'apparaissaient pas dans les mod√®les de diagramme de courrier. <br><br>  Nous avons commenc√© √† creuser dans le quai pour le produit.  Et ils ont trouv√© un champ de visibilit√© avec une description luxueuse: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/525/123/aae/525123aae8eff2a8a1a595072d92b2f6.jpg" alt="description du champ de visibilit√©"><br><br>  Eh bien, tapez String!  Et que peut-on y transf√©rer?  Pourquoi est-il impossible de d√©crire toutes les significations possibles?!  Je peux y envoyer, par exemple, "montrez-moi les pls!". <br><br>  Heureusement, il existe un exemple de demande! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57b/e08/dbe/57be08dbe97502fc302cc4de5dc0e4bf.jpg" alt="exemple de demande"><br><br>  Eh bien, cela n'annule pas le probl√®me.  Je ne sais pas quelles autres valeurs peuvent √™tre utiles. <br><br>  Tout le monde a fait face √† √ßa!  D√©sormais, le responsable du marketing par e-mail peut v√©rifier la disponibilit√© des produits dans le syst√®me en cr√©ant un mod√®le avec la participation des produits ou tout au long des m√™mes requ√™tes get √† l'aide de la console. <br><br>  Ensuite, nous sommes confront√©s √† la t√¢che de charger des paniers abandonn√©s dans l'HME.  Au d√©part, 2 options me sont venues √† l'esprit: <br><br><ol><li>  Chaque fois que vous changez le panier (ajouter / supprimer des marchandises), nous r√©p√©tons cette action dans MCH.  Parmi les inconv√©nients - un grand nombre de demandes √† un service externe se sugg√®re imm√©diatement. </li><li>  Toutes les n minutes, regardez les paniers qui n'ont pas chang√© depuis plus d'une heure.  Ensuite, nous les envoyons √† L'HME.  Il n'y a qu'un seul probl√®me: garder une trace des paniers qui ont √©t√© repris apr√®s leur passage √† l'HME. </li></ol><br>  Tout d'abord, nous demandons √† notre base de donn√©es (ci-apr√®s d√©nomm√©e la DB) nos donn√©es dans une fen√™tre de 1 heure √† 3. Pourquoi 3?  Une heure apr√®s le dernier changement, nous envoyons le panier au syst√®me.  Dans l'HME, l'intervalle minimum possible pour l'envoi du panier est de 1 heure.  Par cons√©quent, en th√©orie, apr√®s 2 heures ¬± 5 minutes, une lettre sera envoy√©e.  Donc 3 heures est une valeur m√™me avec une marge. <br><br>  Apr√®s avoir re√ßu les donn√©es de la base de donn√©es, nous faisons une demande d'obtention √† l'adresse / ecommerce / stores / {store_id} / carts.  Ainsi, nous obtenons tous les paniers qui se trouvent dans le syst√®me de commerce √©lectronique et attendent leur tour d'envoyer (ou ont d√©j√† √©t√© envoy√©s).  Pourquoi en avons-nous besoin?  Il est n√©cessaire pour la synchronisation avec nos donn√©es.  Nous enverrons tous les paniers re√ßus de la base de donn√©es, mais nous devons supprimer ceux qui ne sont plus dans la plage de 1 √† 3 heures.  Apr√®s 3x - donn√©es d√©j√† non pertinentes.  Jusqu'√† une heure - des paniers qui pourraient √™tre renouvel√©s √† nouveau ou passer une commande. <br><br>  Pour supprimer, il suffit de trouver la diff√©rence entre les deux tableaux / collections de paniers. <br>  Apr√®s avoir re√ßu les paniers √† supprimer, nous envoyons une demande de suppression / ecommerce / stores / {store_id} / carts / {cart_id}. <br><br>  Ensuite, nous prenons les paniers √† t√©l√©charger et les envoyons par post-requ√™tes au syst√®me dans un cycle. <br><br>  Les param√®tres du panier ressemblent √† ceci: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> ? //***.Ru/cart/abandoned/ panier = eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0% 253D', <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> </pre><br>  Et encore une fois, notre rubrique pr√©f√©r√©e est ¬´devinez comment ces champs fonctionnent¬ª.  Par exemple, par la m√©thode de piquer scientifique, il a √©t√© r√©v√©l√© qu'il est possible de ne pas cr√©er un acheteur avec une demande distincte.  Il est n√©cessaire de transf√©rer l'ensemble minimal de champs requis, et il sera automatiquement cr√©√© s'il n'√©tait pas dans le syst√®me.  Dans notre cas, nous nous sommes limit√©s √† id, email, opt_in_status.  Le dernier param√®tre est responsable de l'√©tat de l'abonnement utilisateur dans notre fiche.  Si c'est vrai, cela signifie que l'√©tat est souscrit, sinon transactionnel. <br><br>  La liste des produits est charg√©e sans probl√®me via le tableau Cart Lines, qui √† son tour est une ressource de l'entit√© Cart.  C'est-√†-dire  nous pouvons g√©rer s√©par√©ment cet ensemble avec des demandes de repos. <br><br>  Eh bien, c'est tout, semble-t-il?  Mais non. <br><br>  Lors des tests, nous avons remarqu√© qu'envoyant le m√™me panier, il n'est envoy√© qu'une seule fois.  Bien que nous l'avons supprim√© du syst√®me et t√©l√©charg√© √† nouveau.  Rien n'est dit nulle part, pas un seul mot!  En cons√©quence, empiriquement, avec l'aide d'une m√®re, nous avons pris comme hypoth√®se qu'un panier avec le m√™me identifiant ne peut √™tre envoy√© qu'une seule fois. <br><br>  Ici, je suis enti√®rement d'accord avec les cr√©ateurs que cette restriction nous √©vite de spammer les utilisateurs.  Mais √©cris √† ce sujet!  Nous n'avons pas besoin de qu√™tes, nous avons assez de nos erreurs mystiques dans le code que nous √©crivons. <br><br>  Apr√®s avoir fait tout cela, L'HME a commenc√© √† nous envoyer de belles lettres sur le panier abandonn√©.  Et puis une deuxi√®me question est apparue.  Si l'utilisateur a jet√© le panier et est revenu de la lettre sur son propre compte, c'est-√†-dire qu'il a √©t√© autoris√© au moment de cliquer sur le lien, il rentrera sans probl√®me dans son panier.  Et il s'av√®re que la lettre dit ¬´on!  prenez votre panier! ¬ª, et quand nous le traversons, nous disons:¬´ Oups, quelque chose a √©t√© perdu!  Nous n'avons rien touch√©!  C'est lui-m√™me! " <br><br>  Il a √©t√© d√©cid√© de coder la composition du panier en une cha√Æne et de la transmettre √† checkout_url lors de l'envoi du panier au MCH.  Et quand vous allez sur le site, attrapez cette ligne, d√©codez et jetez toutes les marchandises dans le panier, sans oublier de le r√©initialiser compl√®tement avant cela. <br><br>  Ainsi, quel que soit le navigateur auquel nous envoyons l'utilisateur, il obtient son panier, comme nous l'avions promis.  Le seul point n√©gatif est qu'il ne peut que se connecter.  Mais autoriser via un lien est une mauvaise mani√®re, et c'est en effet une entreprise dangereuse, tout d'abord pour nos clients. <br>  Quel est le r√©sultat?  En principe, il n'y a pas eu de probl√®me particulier lors de la mise en ≈ìuvre, car tr√®s souvent les r√©ponses MCH ont permis de corriger les erreurs li√©es √† la validation des champs transf√©r√©s.  Mais il y en aurait encore moins s'ils d√©crivaient normalement humainement toutes ces subtilit√©s du travail de L'HME et d√©crivaient les champs plus en d√©tail. <br><br><h2>  Configuration du rapport dans Google.Analytics </h2><br>  Pour suivre le succ√®s de l'ensemble de l'op√©ration, vous devrez configurer et consulter p√©riodiquement le rapport dans l'analyse.  Imaginez que tout le monde, comme les adultes, ait un commerce √©lectronique connect√©, sinon un miracle ne fonctionnera pas :) <br><br>  Pour collecter un nouveau rapport pour un panier abandonn√©, acc√©dez √† "Mes rapports": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afe/749/f87/afe749f87d1c6bd4e5a0810dab40b4ef.jpg" alt="Mes rapports"><br><br>  "Ajouter un rapport": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/288/8bd/ba2/2888bdba2a5749ccc90c88c3f5c80f49.jpg" alt="Ajouter un rapport"><br><br>  Et apr√®s cela, nous ajoutons les param√®tres que nous suivrons.  Nous avons d√©cid√© de regarder le panier abandonn√© dans le contexte des villes, vous avez peut-√™tre une vision diff√©rente. <br><br>  Pour un mailchamp, la campagne standard pour un panier abandonn√© est ABANDONED_CART_EMAIL, nous le rempla√ßons dans le filtre et obtenons un rapport. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca0/a77/b25/ca0a77b256b42242851ceaed308e02c7.jpg" alt="image"><br><br>  Ce sont toutes des fourchettes! <br><br>  Vous √™tes maintenant configur√© pour envoyer le panier abandonn√© et un rapport par lequel vous pouvez regarder l'√©chappement de celui-ci.  Et test, test, test!  ;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr421393/">https://habr.com/ru/post/fr421393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr421383/index.html">Epic Growth Conference Autumn 2018 - conf√©rence de marketing de produit √† Moscou</a></li>
<li><a href="../fr421385/index.html">Apprenez OpenGL. Le√ßon 5.10 - Occlusion ambiante de l'espace d'√©cran</a></li>
<li><a href="../fr421387/index.html">Entretien avec Lennart Pottering sur Linux Piter sur les changements dans Linux, sur systemd et pourquoi assister √† des conf√©rences</a></li>
<li><a href="../fr421389/index.html">S√©paration des pouvoirs administratifs √† Zimbra</a></li>
<li><a href="../fr421391/index.html">HackThings - un grand hackathon sur l'Internet des objets du 7 au 9 septembre √† Skoltech</a></li>
<li><a href="../fr421395/index.html">Rapport du Club de Rome 2018, chapitre 3.7: ¬´Climat: bonne nouvelle mais gros probl√®mes¬ª</a></li>
<li><a href="../fr421397/index.html">Lancez la Mini AI Cup # 3. Bataille m√©canique dans des espaces confin√©s</a></li>
<li><a href="../fr421399/index.html">Analyse de la porte d√©rob√©e de Turla Cybergroup Outlook</a></li>
<li><a href="../fr421401/index.html">Anatomie des syst√®mes de recommandation. Deuxi√®me partie</a></li>
<li><a href="../fr421403/index.html">Semaine de la s√©curit√© 32: drame Fortnite-Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>