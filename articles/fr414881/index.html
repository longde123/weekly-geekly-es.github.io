<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏿 👩‍❤️‍💋‍👩 👩🏿‍🎨 Un peu de VK dans les coulisses 💓 ☎️ 📇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En prévision du Siberian HighLoad ++, nous avons discuté avec l'un de nos intervenants, Yuri Nasretdinov, pour lui demander s'il fonctionnait bien sur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un peu de VK dans les coulisses</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/414881/"> En prévision du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Siberian HighLoad ++,</a> nous avons discuté avec l'un de nos intervenants, Yuri Nasretdinov, pour lui demander s'il fonctionnait bien sur VKontakte, tout en ouvrant en même temps le voile du secret sur la cuisine interne du réseau social. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dd8/bf5/262/dd8bf526210478b0312431ee75a96903.jpg"><br><br>  Dans le cadre de la conférence, Yuri expliquera comment un réseau social insère des données dans ClickHouse à partir de dizaines de milliers de serveurs, que nous venons d'évoquer dans la conversation en cours. <br><a name="habracut"></a><br>  <b>- Parlez-nous de votre travail.</b> <br><br>  Actuellement, je travaille sur VK.  C'est vrai, pas si longtemps - depuis le début de cette année.  Je suis engagé dans l'infrastructure vidéo et l'infrastructure du site.  Le site est principalement écrit en PHP, et je développe des services et utilitaires en PHP et Go. <br><br>  <b>- Qu'est-ce qui vous a poussé à travailler chez VK?</b> <br><br>  J'ai été invité à travailler chez VK.  Et j'ai pensé - pourquoi pas?  VKontakte est le site le plus chargé en Russie et l'un des plus grands sites sur Internet.  J'ai toujours été intéressé à travailler sur un projet d'une telle envergure - à participer au développement du site et de l'application mobile.  Peut-être même affecter leur développement, améliorer en quelque sorte.  C'est probablement le facteur le plus motivant - VKontakte que tout le monde connaît et utilise.  Et c'est très agréable de travailler sur un tel produit, pour l'aider à s'améliorer. <br><br>  <b>- Avant cela, avez-vous dû faire face à quelque chose d'échelle similaire?</b> <br><br>  Oui, pendant environ cinq ans, j'ai travaillé chez Badoo dans un poste similaire - dans le développement des infrastructures.  Mais la charge en VK est d'un ordre de grandeur supérieur. <br><br>  <b>- Avez-vous rencontré des problèmes lors du passage à VK?</b> <br><br>  Le bureau de VKontakte est situé à Saint-Pétersbourg.  Et avant cela, je vivais en banlieue, donc j'ai dû déménager.  Le déménagement lui-même a été assez facile - l'entreprise aide.  Mais à Saint-Pétersbourg, il fait très froid en hiver.  C'était probablement la chose la plus difficile à affronter. <br><br>  <b>- Il n'y a aucun sentiment que la vie est restée quelque part à l'intérieur du périphérique de Moscou?</b> <br><br>  Au début, cela me semblait vraiment le cas, malgré le fait que j'aie été auparavant dans d'autres villes de Russie, en plus de Moscou.  Mais en fait, j'aime Saint-Pétersbourg, probablement même plus que Moscou.  Il est plus calme - moins de gens, ils ne sont pas pressés, et c'est bien. <br><br>  <b>- Et du point de vue des technologies utilisées dans le travail - qu'est-ce qui était fondamentalement nouveau pour vous?</b> <br><br>  VKontakte est très grand, respectivement, il y a vraiment quelques nuances ici que je n'ai pas rencontrées auparavant.  Par exemple, à Badoo, il n'y a pratiquement pas de profils très populaires qu'un pourcentage important de personnes visitent.  VKontakte l'a, car il existe un certain nombre d'outils intéressants qui vous permettent de mettre à l'échelle rapidement des comptes très populaires. <br><br>  De plus, VKontakte est différent en ce que, pour des raisons historiques, presque tout est là.  Contrairement, par exemple, à Badoo, qui utilise principalement MySQL et Memcache (plus ses services), VKontakte utilise ses propres bases de données et même sa propre version de Memcache.  Les développeurs VK pourraient se permettre de créer des services plus hautement efficaces (dans le contexte du même MySQL) qui fonctionnent bien à une telle échelle.  La plupart des outils finis sans fichier ne peuvent pas être utilisés dans une infrastructure qui comprend des dizaines de milliers de serveurs, comme VK, et cela crée des difficultés importantes. <br><br>  <b>- A-t-il été difficile de pénétrer rapidement dans de tels outils "internes"?</b> <br><br>  Je travaille au département des infrastructures, et il n'y a pas beaucoup de choses non standard ici.  Fondamentalement, c'est une pile encore plus standard que celle avec laquelle j'ai travaillé auparavant.  Mais si je travaillais, par exemple, dans un département qui s'occupe des fonctionnalités principales, alors, bien sûr, il y aurait une connaissance utile de la façon dont le système Highload est essentiellement construit, mais pas de détails spécifiques.  Dans de telles situations, des pages pour les nouveaux employés, des descriptions des mécanismes internes aident. <br><br>  En principe, une partie tangible de l'infrastructure VK a été publiée par Pavel Durov en open source avec la documentation.  Tout le monde peut le lire, lire comment tout cela fonctionne.  Mais, bien sûr, il est beaucoup plus facile de le percevoir dans le contexte de son utilisation en interne.  Vous venez et commencez à faire des tâches, en étudiant progressivement ce qui est nécessaire pour les résoudre.  Voyez comment cela est déjà fait et faites de même.  Et ça suffit.  Après tout, même si vous maîtrisez la lecture de toute la documentation sur l'infrastructure VK, jusqu'à ce que vous commenciez à l'utiliser, vous ne comprendrez probablement pas comment tout cela fonctionne en détail. <br><br>  Je note que tout ce qui précède s'applique à mon département (dans d'autres, il peut être différent). <br><br>  <b>- Avez-vous une spécialisation au sein de VK?</b>  <b>À quelles tâches avez-vous réussi à participer?</b> <br><br>  Il n'y a pas de spécialisation en tant que telle.  Je fais ce qui est actuellement requis. <br>  Je travaille dans un département dont les activités affectent différentes parties de l'infrastructure des réseaux sociaux, et c'est un énorme projet (il faut beaucoup de temps pour bien comprendre l'appareil VK avec compréhension). <br><br>  Par exemple, j'ai participé à une mise à niveau partielle vers PHP7.  Ceci, en principe, s'applique à l'ensemble du site, mais ne s'applique pas en même temps à des détails spécifiques. <br><br>  Un autre exemple est le problème de la collecte des journaux, pour la solution duquel nous avons utilisé ClickHouse.  J'en parlerai dans HighLoad ++. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02b/ab0/b88/02bab0b88c3afe4212bb71fdfbc17ed8.jpg"><br><br>  <b>- Donnons un petit spoiler - quelle était la caractéristique de ce problème?</b> <br><br>  La capture était une combinaison de deux facteurs: d'une part, nous avons beaucoup de journaux écrits, et d'autre part, nous devons les parcourir rapidement. <br><br>  En fait, le système existant ne pouvait pas stocker de grandes quantités de données, ne donnant rapidement que les dernières informations.  Pour obtenir l'histoire, vous avez dû effectuer manuellement des requêtes très lourdes. <br><br>  <b>- Les lecteurs peuvent être intéressés par la raison pour laquelle la colonne ClickHouse a été utilisée pour la solution?</b> <br><br>  Colonne - en raison des spécificités du travail.  Souvent, lors de la recherche d'informations dans les journaux, nous devons filtrer par serveur ou utilisateur.  En ce qui concerne la lecture à partir du disque, une base de données de colonnes vous permet d'accélérer la lecture plusieurs fois (dans le contexte de la ligne), ce qui est obtenu en lisant uniquement les colonnes nécessaires et une compression bit à bit plus efficace.  De plus, ClickHouse parallélise bien les requêtes à travers les noyaux.  C'est-à-dire  contrairement aux bases de données classiques, il peut effectuer une seule requête même sur un cluster entier, en utilisant presque toutes les ressources du processeur et du disque.  Ces bases de données, notamment gratuites, ne sont pas très nombreuses, voire inexistantes.  ClickHouse est très bien venu pour la tâche de stockage des journaux. <br><br>  Je note également qu'avant mon arrivée, ClickHouse était utilisé par les administrateurs de VK dans une tâche plutôt hautement spécialisée - comme outil principal pour Grafana.  Il s'agit d'un système de collecte de données et de représentation graphique pour les serveurs.  Certes, seuls quelques serveurs avec ClickHouse ont été déployés, c'est-à-dire qu'ils n'étaient pas disponibles pour les programmeurs. <br><br>  Après avoir pris la décision d'utiliser ClickHouse pour stocker les journaux, j'ai aidé à créer l'infrastructure appropriée afin qu'elle soit pratique et compréhensible pour tout le monde. <br><br>  <b>- VK utilise-t-il des solutions tierces en quantité importante (en plus de celles mentionnées ci-dessus)?</b> <br><br>  Bien sûr utilisé.  Par exemple, Linux, sur lequel tout cela tourne.  Ne sous-estimez pas la part du travail que le système d'exploitation fait pour nous. <br><br>  Curieusement, PHP est utilisé.  Nous avons un moteur propriétaire appelé KittenPHP, qui traduit PHP en C ++, mais pour un certain nombre de tâches, y compris la production, PHP standard est également utilisé. <br><br>  Utilisé par nginx.  Jusqu'à présent, MySQL est impliqué dans certains endroits, mais progressivement nous le refusons - nous utilisons une base de données auto-écrite. <br><br>  <b>- Et comment se construit le processus de développement?</b> <br><br>  Je ne vois pas de grandes différences entre les processus en VK et ce qui est accepté dans l'industrie.  Nous avons un traqueur de bogues, des départements qui traitent de différentes fonctionnalités, responsables de leur partie du projet;  il y a des sprints responsables des composants, etc. <br><br>  <b>- Au lieu des résultats, est-il possible d'indiquer la direction dans laquelle se développe le département dans lequel vous travaillez?</b> <br><br>  Pour autant que je sache, avant le département dans lequel je travaille maintenant se composait de 1-2 personnes. <br>  Et nous avons commencé à nous lancer dans l'infrastructure sous la forme dans laquelle elle se fait maintenant (probablement, elle ressemble à DevOps) il n'y a pas si longtemps.  Par conséquent, il est trop tôt pour parler de plans - nous résolvons les problèmes existants et jusqu'à présent, nous avons suffisamment de travail.  Et puis on verra. <br><br><hr><br>  Yuri vous en dira plus sur les composants internes de VK, en utilisant ClickHouse et d'autres détails dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">son discours</a> à Siberian HighLoad ++ les 25 et 26 juin.  Vous serez également certainement intéressé par ces rapports: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Réplication de données en temps réel de MySQL vers ClickHouse pour une migration en douceur des analyses de MySQL vers ClickHouse</a> (Vladislav Klimenko, Valery Panov) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apprendre à classer un peu</a> (Andrey Aksenov) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'évolution des outils et des services à Badoo: nos critères de sélection et leurs</a> retombées (Anton Turetsky) </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414881/">https://habr.com/ru/post/fr414881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414871/index.html">La tempête de poussière sur Mars a atteint l'échelle planétaire, même la curiosité est affectée</a></li>
<li><a href="../fr414873/index.html">IDisposable - que votre maman n'a pas parlé de libérer des ressources. Partie 1</a></li>
<li><a href="../fr414875/index.html">L'intégration Kubernetes Container remplace Docker prêt pour la production</a></li>
<li><a href="../fr414877/index.html">Un objectif inhabituel pour un appareil photo ordinaire ou comment arrêter de penser à la mise au point</a></li>
<li><a href="../fr414879/index.html">Pourquoi 2 extrudeuses dans une imprimante 3D?</a></li>
<li><a href="../fr414883/index.html">Les souvenirs résonnaient d'une manière nouvelle: la BBC a mis à jour les archives sonores du projet RemArc</a></li>
<li><a href="../fr414885/index.html">Nous traitons les erreurs et les «béquilles» dans le Registre d'État unifié des entités juridiques - le registre d'État des entités juridiques</a></li>
<li><a href="../fr414887/index.html">Création d'un crochet pour chat dans Unity. Partie 1</a></li>
<li><a href="../fr414889/index.html">Quand les agences numériques ont besoin de l'IaaS</a></li>
<li><a href="../fr414891/index.html">Habitudes des développeurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>