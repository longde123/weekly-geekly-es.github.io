<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘‚ğŸ¿ ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘© ğŸ‘©ğŸ¿â€ğŸ¨ Un peu de VK dans les coulisses ğŸ’“ â˜ï¸ ğŸ“‡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En prÃ©vision du Siberian HighLoad ++, nous avons discutÃ© avec l'un de nos intervenants, Yuri Nasretdinov, pour lui demander s'il fonctionnait bien sur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un peu de VK dans les coulisses</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/414881/"> En prÃ©vision du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Siberian HighLoad ++,</a> nous avons discutÃ© avec l'un de nos intervenants, Yuri Nasretdinov, pour lui demander s'il fonctionnait bien sur VKontakte, tout en ouvrant en mÃªme temps le voile du secret sur la cuisine interne du rÃ©seau social. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dd8/bf5/262/dd8bf526210478b0312431ee75a96903.jpg"><br><br>  Dans le cadre de la confÃ©rence, Yuri expliquera comment un rÃ©seau social insÃ¨re des donnÃ©es dans ClickHouse Ã  partir de dizaines de milliers de serveurs, que nous venons d'Ã©voquer dans la conversation en cours. <br><a name="habracut"></a><br>  <b>- Parlez-nous de votre travail.</b> <br><br>  Actuellement, je travaille sur VK.  C'est vrai, pas si longtemps - depuis le dÃ©but de cette annÃ©e.  Je suis engagÃ© dans l'infrastructure vidÃ©o et l'infrastructure du site.  Le site est principalement Ã©crit en PHP, et je dÃ©veloppe des services et utilitaires en PHP et Go. <br><br>  <b>- Qu'est-ce qui vous a poussÃ© Ã  travailler chez VK?</b> <br><br>  J'ai Ã©tÃ© invitÃ© Ã  travailler chez VK.  Et j'ai pensÃ© - pourquoi pas?  VKontakte est le site le plus chargÃ© en Russie et l'un des plus grands sites sur Internet.  J'ai toujours Ã©tÃ© intÃ©ressÃ© Ã  travailler sur un projet d'une telle envergure - Ã  participer au dÃ©veloppement du site et de l'application mobile.  Peut-Ãªtre mÃªme affecter leur dÃ©veloppement, amÃ©liorer en quelque sorte.  C'est probablement le facteur le plus motivant - VKontakte que tout le monde connaÃ®t et utilise.  Et c'est trÃ¨s agrÃ©able de travailler sur un tel produit, pour l'aider Ã  s'amÃ©liorer. <br><br>  <b>- Avant cela, avez-vous dÃ» faire face Ã  quelque chose d'Ã©chelle similaire?</b> <br><br>  Oui, pendant environ cinq ans, j'ai travaillÃ© chez Badoo dans un poste similaire - dans le dÃ©veloppement des infrastructures.  Mais la charge en VK est d'un ordre de grandeur supÃ©rieur. <br><br>  <b>- Avez-vous rencontrÃ© des problÃ¨mes lors du passage Ã  VK?</b> <br><br>  Le bureau de VKontakte est situÃ© Ã  Saint-PÃ©tersbourg.  Et avant cela, je vivais en banlieue, donc j'ai dÃ» dÃ©mÃ©nager.  Le dÃ©mÃ©nagement lui-mÃªme a Ã©tÃ© assez facile - l'entreprise aide.  Mais Ã  Saint-PÃ©tersbourg, il fait trÃ¨s froid en hiver.  C'Ã©tait probablement la chose la plus difficile Ã  affronter. <br><br>  <b>- Il n'y a aucun sentiment que la vie est restÃ©e quelque part Ã  l'intÃ©rieur du pÃ©riphÃ©rique de Moscou?</b> <br><br>  Au dÃ©but, cela me semblait vraiment le cas, malgrÃ© le fait que j'aie Ã©tÃ© auparavant dans d'autres villes de Russie, en plus de Moscou.  Mais en fait, j'aime Saint-PÃ©tersbourg, probablement mÃªme plus que Moscou.  Il est plus calme - moins de gens, ils ne sont pas pressÃ©s, et c'est bien. <br><br>  <b>- Et du point de vue des technologies utilisÃ©es dans le travail - qu'est-ce qui Ã©tait fondamentalement nouveau pour vous?</b> <br><br>  VKontakte est trÃ¨s grand, respectivement, il y a vraiment quelques nuances ici que je n'ai pas rencontrÃ©es auparavant.  Par exemple, Ã  Badoo, il n'y a pratiquement pas de profils trÃ¨s populaires qu'un pourcentage important de personnes visitent.  VKontakte l'a, car il existe un certain nombre d'outils intÃ©ressants qui vous permettent de mettre Ã  l'Ã©chelle rapidement des comptes trÃ¨s populaires. <br><br>  De plus, VKontakte est diffÃ©rent en ce que, pour des raisons historiques, presque tout est lÃ .  Contrairement, par exemple, Ã  Badoo, qui utilise principalement MySQL et Memcache (plus ses services), VKontakte utilise ses propres bases de donnÃ©es et mÃªme sa propre version de Memcache.  Les dÃ©veloppeurs VK pourraient se permettre de crÃ©er des services plus hautement efficaces (dans le contexte du mÃªme MySQL) qui fonctionnent bien Ã  une telle Ã©chelle.  La plupart des outils finis sans fichier ne peuvent pas Ãªtre utilisÃ©s dans une infrastructure qui comprend des dizaines de milliers de serveurs, comme VK, et cela crÃ©e des difficultÃ©s importantes. <br><br>  <b>- A-t-il Ã©tÃ© difficile de pÃ©nÃ©trer rapidement dans de tels outils "internes"?</b> <br><br>  Je travaille au dÃ©partement des infrastructures, et il n'y a pas beaucoup de choses non standard ici.  Fondamentalement, c'est une pile encore plus standard que celle avec laquelle j'ai travaillÃ© auparavant.  Mais si je travaillais, par exemple, dans un dÃ©partement qui s'occupe des fonctionnalitÃ©s principales, alors, bien sÃ»r, il y aurait une connaissance utile de la faÃ§on dont le systÃ¨me Highload est essentiellement construit, mais pas de dÃ©tails spÃ©cifiques.  Dans de telles situations, des pages pour les nouveaux employÃ©s, des descriptions des mÃ©canismes internes aident. <br><br>  En principe, une partie tangible de l'infrastructure VK a Ã©tÃ© publiÃ©e par Pavel Durov en open source avec la documentation.  Tout le monde peut le lire, lire comment tout cela fonctionne.  Mais, bien sÃ»r, il est beaucoup plus facile de le percevoir dans le contexte de son utilisation en interne.  Vous venez et commencez Ã  faire des tÃ¢ches, en Ã©tudiant progressivement ce qui est nÃ©cessaire pour les rÃ©soudre.  Voyez comment cela est dÃ©jÃ  fait et faites de mÃªme.  Et Ã§a suffit.  AprÃ¨s tout, mÃªme si vous maÃ®trisez la lecture de toute la documentation sur l'infrastructure VK, jusqu'Ã  ce que vous commenciez Ã  l'utiliser, vous ne comprendrez probablement pas comment tout cela fonctionne en dÃ©tail. <br><br>  Je note que tout ce qui prÃ©cÃ¨de s'applique Ã  mon dÃ©partement (dans d'autres, il peut Ãªtre diffÃ©rent). <br><br>  <b>- Avez-vous une spÃ©cialisation au sein de VK?</b>  <b>Ã€ quelles tÃ¢ches avez-vous rÃ©ussi Ã  participer?</b> <br><br>  Il n'y a pas de spÃ©cialisation en tant que telle.  Je fais ce qui est actuellement requis. <br>  Je travaille dans un dÃ©partement dont les activitÃ©s affectent diffÃ©rentes parties de l'infrastructure des rÃ©seaux sociaux, et c'est un Ã©norme projet (il faut beaucoup de temps pour bien comprendre l'appareil VK avec comprÃ©hension). <br><br>  Par exemple, j'ai participÃ© Ã  une mise Ã  niveau partielle vers PHP7.  Ceci, en principe, s'applique Ã  l'ensemble du site, mais ne s'applique pas en mÃªme temps Ã  des dÃ©tails spÃ©cifiques. <br><br>  Un autre exemple est le problÃ¨me de la collecte des journaux, pour la solution duquel nous avons utilisÃ© ClickHouse.  J'en parlerai dans HighLoad ++. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/02b/ab0/b88/02bab0b88c3afe4212bb71fdfbc17ed8.jpg"><br><br>  <b>- Donnons un petit spoiler - quelle Ã©tait la caractÃ©ristique de ce problÃ¨me?</b> <br><br>  La capture Ã©tait une combinaison de deux facteurs: d'une part, nous avons beaucoup de journaux Ã©crits, et d'autre part, nous devons les parcourir rapidement. <br><br>  En fait, le systÃ¨me existant ne pouvait pas stocker de grandes quantitÃ©s de donnÃ©es, ne donnant rapidement que les derniÃ¨res informations.  Pour obtenir l'histoire, vous avez dÃ» effectuer manuellement des requÃªtes trÃ¨s lourdes. <br><br>  <b>- Les lecteurs peuvent Ãªtre intÃ©ressÃ©s par la raison pour laquelle la colonne ClickHouse a Ã©tÃ© utilisÃ©e pour la solution?</b> <br><br>  Colonne - en raison des spÃ©cificitÃ©s du travail.  Souvent, lors de la recherche d'informations dans les journaux, nous devons filtrer par serveur ou utilisateur.  En ce qui concerne la lecture Ã  partir du disque, une base de donnÃ©es de colonnes vous permet d'accÃ©lÃ©rer la lecture plusieurs fois (dans le contexte de la ligne), ce qui est obtenu en lisant uniquement les colonnes nÃ©cessaires et une compression bit Ã  bit plus efficace.  De plus, ClickHouse parallÃ©lise bien les requÃªtes Ã  travers les noyaux.  C'est-Ã -dire  contrairement aux bases de donnÃ©es classiques, il peut effectuer une seule requÃªte mÃªme sur un cluster entier, en utilisant presque toutes les ressources du processeur et du disque.  Ces bases de donnÃ©es, notamment gratuites, ne sont pas trÃ¨s nombreuses, voire inexistantes.  ClickHouse est trÃ¨s bien venu pour la tÃ¢che de stockage des journaux. <br><br>  Je note Ã©galement qu'avant mon arrivÃ©e, ClickHouse Ã©tait utilisÃ© par les administrateurs de VK dans une tÃ¢che plutÃ´t hautement spÃ©cialisÃ©e - comme outil principal pour Grafana.  Il s'agit d'un systÃ¨me de collecte de donnÃ©es et de reprÃ©sentation graphique pour les serveurs.  Certes, seuls quelques serveurs avec ClickHouse ont Ã©tÃ© dÃ©ployÃ©s, c'est-Ã -dire qu'ils n'Ã©taient pas disponibles pour les programmeurs. <br><br>  AprÃ¨s avoir pris la dÃ©cision d'utiliser ClickHouse pour stocker les journaux, j'ai aidÃ© Ã  crÃ©er l'infrastructure appropriÃ©e afin qu'elle soit pratique et comprÃ©hensible pour tout le monde. <br><br>  <b>- VK utilise-t-il des solutions tierces en quantitÃ© importante (en plus de celles mentionnÃ©es ci-dessus)?</b> <br><br>  Bien sÃ»r utilisÃ©.  Par exemple, Linux, sur lequel tout cela tourne.  Ne sous-estimez pas la part du travail que le systÃ¨me d'exploitation fait pour nous. <br><br>  Curieusement, PHP est utilisÃ©.  Nous avons un moteur propriÃ©taire appelÃ© KittenPHP, qui traduit PHP en C ++, mais pour un certain nombre de tÃ¢ches, y compris la production, PHP standard est Ã©galement utilisÃ©. <br><br>  UtilisÃ© par nginx.  Jusqu'Ã  prÃ©sent, MySQL est impliquÃ© dans certains endroits, mais progressivement nous le refusons - nous utilisons une base de donnÃ©es auto-Ã©crite. <br><br>  <b>- Et comment se construit le processus de dÃ©veloppement?</b> <br><br>  Je ne vois pas de grandes diffÃ©rences entre les processus en VK et ce qui est acceptÃ© dans l'industrie.  Nous avons un traqueur de bogues, des dÃ©partements qui traitent de diffÃ©rentes fonctionnalitÃ©s, responsables de leur partie du projet;  il y a des sprints responsables des composants, etc. <br><br>  <b>- Au lieu des rÃ©sultats, est-il possible d'indiquer la direction dans laquelle se dÃ©veloppe le dÃ©partement dans lequel vous travaillez?</b> <br><br>  Pour autant que je sache, avant le dÃ©partement dans lequel je travaille maintenant se composait de 1-2 personnes. <br>  Et nous avons commencÃ© Ã  nous lancer dans l'infrastructure sous la forme dans laquelle elle se fait maintenant (probablement, elle ressemble Ã  DevOps) il n'y a pas si longtemps.  Par consÃ©quent, il est trop tÃ´t pour parler de plans - nous rÃ©solvons les problÃ¨mes existants et jusqu'Ã  prÃ©sent, nous avons suffisamment de travail.  Et puis on verra. <br><br><hr><br>  Yuri vous en dira plus sur les composants internes de VK, en utilisant ClickHouse et d'autres dÃ©tails dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">son discours</a> Ã  Siberian HighLoad ++ les 25 et 26 juin.  Vous serez Ã©galement certainement intÃ©ressÃ© par ces rapports: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RÃ©plication de donnÃ©es en temps rÃ©el de MySQL vers ClickHouse pour une migration en douceur des analyses de MySQL vers ClickHouse</a> (Vladislav Klimenko, Valery Panov) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apprendre Ã  classer un peu</a> (Andrey Aksenov) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'Ã©volution des outils et des services Ã  Badoo: nos critÃ¨res de sÃ©lection et leurs</a> retombÃ©es (Anton Turetsky) </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414881/">https://habr.com/ru/post/fr414881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414871/index.html">La tempÃªte de poussiÃ¨re sur Mars a atteint l'Ã©chelle planÃ©taire, mÃªme la curiositÃ© est affectÃ©e</a></li>
<li><a href="../fr414873/index.html">IDisposable - que votre maman n'a pas parlÃ© de libÃ©rer des ressources. Partie 1</a></li>
<li><a href="../fr414875/index.html">L'intÃ©gration Kubernetes Container remplace Docker prÃªt pour la production</a></li>
<li><a href="../fr414877/index.html">Un objectif inhabituel pour un appareil photo ordinaire ou comment arrÃªter de penser Ã  la mise au point</a></li>
<li><a href="../fr414879/index.html">Pourquoi 2 extrudeuses dans une imprimante 3D?</a></li>
<li><a href="../fr414883/index.html">Les souvenirs rÃ©sonnaient d'une maniÃ¨re nouvelle: la BBC a mis Ã  jour les archives sonores du projet RemArc</a></li>
<li><a href="../fr414885/index.html">Nous traitons les erreurs et les Â«bÃ©quillesÂ» dans le Registre d'Ã‰tat unifiÃ© des entitÃ©s juridiques - le registre d'Ã‰tat des entitÃ©s juridiques</a></li>
<li><a href="../fr414887/index.html">CrÃ©ation d'un crochet pour chat dans Unity. Partie 1</a></li>
<li><a href="../fr414889/index.html">Quand les agences numÃ©riques ont besoin de l'IaaS</a></li>
<li><a href="../fr414891/index.html">Habitudes des dÃ©veloppeurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>