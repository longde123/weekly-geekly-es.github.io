<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêõ üëõ ‚úãüèø Lidamos com interfaces no Go ‚úâÔ∏è üôéüèæ üë®üèø‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nos √∫ltimos meses, tenho conduzido um estudo perguntando √†s pessoas o que √© dif√≠cil para elas entenderem no Go. E notei que o conceito de interfaces e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lidamos com interfaces no Go</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/463063/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/_f/w7/1l/_fw71luza3o_kj1bh6t015wlp4c.jpeg"></div><br>  Nos √∫ltimos meses, tenho conduzido um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estudo</a> perguntando √†s pessoas o que √© dif√≠cil para elas entenderem no Go.  E notei que o conceito de interfaces era mencionado regularmente nas respostas.  Go foi a primeira linguagem de interface que usei, e lembro que naquele momento esse conceito parecia muito confuso.  E neste guia, quero fazer o seguinte: <br><br><ol><li>  Explicar na linguagem humana o que s√£o interfaces. </li><li>  Explique como eles s√£o √∫teis e como voc√™ pode us√°-los no seu c√≥digo. </li><li> Fale sobre o que √© a <code>interface{}</code> (uma interface vazia). </li><li>  E percorra alguns tipos de interface √∫teis que voc√™ pode encontrar na biblioteca padr√£o. </li></ol><a name="habracut"></a><br><h2>  Ent√£o, o que √© uma interface? </h2><br>  O tipo de interface no Go √© um tipo de <i>defini√ß√£o</i> .  Ele define e descreve os m√©todos espec√≠ficos que <i>algum outro tipo deve ter</i> . <br><br>  Um dos tipos de interface da biblioteca padr√£o √© a interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fmt.Stringer</a> : <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Stringer <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { String() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> }</code> </pre> <br>  Dizemos que algo <i>satisfaz essa interface</i> (ou <i>implementa essa interface</i> ) se esse "algo" tiver um m√©todo com um valor espec√≠fico de string de assinatura <code>String()</code> . <br><br>  Por exemplo, o tipo <code>Book</code> satisfaz a interface porque possui o m√©todo <code>String()</code> : <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Book <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Title <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Author <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b Book)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">String</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt.Sprintf(<span class="hljs-string"><span class="hljs-string">"Book: %s - %s"</span></span>, b.Title, b.Author) }</code> </pre> <br>  N√£o importa que tipo de <code>Book</code> ou o que faz.  Tudo o que importa √© que ele possui um m√©todo chamado <code>String()</code> que retorna um valor de string. <br><br>  Aqui est√° outro exemplo.  O tipo <code>Count</code> tamb√©m <i>satisfaz a interface</i> <code>fmt.Stringer</code> <i>,</i> pois possui um m√©todo com o mesmo valor da string de assinatura <code>String()</code> . <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Count <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Count)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">String</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> strconv.Itoa(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(c)) }</code> </pre> <br>  √â importante entender aqui que temos dois tipos diferentes de <code>Book</code> e <code>Count</code> , que agem de maneira diferente.  Mas eles est√£o unidos pelo fato de que ambos satisfazem a interface <code>fmt.Stringer</code> . <br><br>  Voc√™ pode olhar do outro lado.  Se voc√™ souber que o objeto atende √† interface <code>fmt.Stringer</code> , pode assumir que ele possui um m√©todo com o valor da cadeia de assinatura <code>String()</code> que voc√™ pode chamar. <br><br>  E agora a coisa mais importante. <br><br>  <i>Quando voc√™ v√™ uma declara√ß√£o em Go (de uma vari√°vel, par√¢metro de fun√ß√£o ou campo de estrutura) que possui um tipo de interface, voc√™ pode usar um objeto de qualquer tipo, desde que satisfa√ßa a interface.</i> <br><br>  Digamos que temos uma fun√ß√£o: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s fmt.Stringer)</span></span></span></span> { log.Println(s.String()) }</code> </pre> <br>  Como <code>WriteLog()</code> usa o tipo de interface <code>fmt.Stringer</code> na <code>fmt.Stringer</code> par√¢metro, podemos passar qualquer objeto que satisfa√ßa a interface <code>fmt.Stringer</code> .  Por exemplo, podemos passar os tipos <code>Book</code> e <code>Count</code> que criamos anteriormente no m√©todo <code>WriteLog()</code> , e o c√≥digo funcionar√° bem. <br><br>  Al√©m disso, como o objeto passado satisfaz a interface <code>fmt.Stringer</code> , <i>sabemos</i> que ele possui um m√©todo <code>String()</code> , que pode ser chamado com seguran√ßa pela fun√ß√£o <code>WriteLog()</code> . <br><br>  Vamos juntar tudo em um exemplo, demonstrando o poder das interfaces. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"strconv"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> ) <span class="hljs-comment"><span class="hljs-comment">//   Book,    fmt.Stringer. type Book struct { Title string Author string } func (b Book) String() string { return fmt.Sprintf("Book: %s - %s", b.Title, b.Author) } //   Count,    fmt.Stringer. type Count int func (c Count) String() string { return strconv.Itoa(int(c)) } //   WriteLog(),    , //   fmt.Stringer   . func WriteLog(s fmt.Stringer) { log.Println(s.String()) } func main() { //   Book    WriteLog(). book := Book{"Alice in Wonderland", "Lewis Carrol"} WriteLog(book) //   Count    WriteLog(). count := Count(3) WriteLog(count) }</span></span></code> </pre> <br>  Isso √© demais.  Na fun√ß√£o principal, criamos diferentes tipos de <code>Book</code> e <code>Count</code> , mas os passamos para a <i>mesma</i> fun√ß√£o <code>WriteLog()</code> .  E ela chamou as fun√ß√µes apropriadas <code>String()</code> e escreveu os resultados no log. <br><br>  Se voc√™ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">executar o c√≥digo</a> , obter√° um resultado semelhante: <br><br><pre> <code class="plaintext hljs">2009/11/10 23:00:00 Book: Alice in Wonderland - Lewis Carrol 2009/11/10 23:00:00 3</code> </pre> <br>  N√£o vamos nos deter sobre isso em detalhes.  O principal a lembrar: usando o tipo de interface na declara√ß√£o da fun√ß√£o <code>WriteLog()</code> , tornamos a fun√ß√£o indiferente (ou flex√≠vel) ao <i>tipo do</i> objeto recebido.  O que importa √© <i>que m√©todos ele tem</i> . <br><br><h2>  O que s√£o interfaces √∫teis? </h2><br>  Existem v√°rias raz√µes pelas quais voc√™ pode come√ßar a usar interfaces no Go.  E, na minha experi√™ncia, os mais importantes s√£o: <br><br><ol><li>  As interfaces ajudam a reduzir a duplica√ß√£o, ou seja, a quantidade de c√≥digo padr√£o. </li><li>  Eles facilitam o uso de stubs em testes de unidade, em vez de objetos reais. </li><li>  Sendo uma ferramenta de arquitetura, as interfaces ajudam a desatar partes de sua base de c√≥digo. </li></ol><br>  Vamos dar uma olhada mais de perto nessas maneiras de usar interfaces. <br><br><h3>  Reduza a quantidade de c√≥digo padr√£o </h3><br>  Suponha que tenhamos uma estrutura de <code>Customer</code> contendo algum tipo de dados do cliente.  Em uma parte do c√≥digo, queremos gravar essas informa√ß√µes em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bytes.Buffer</a> , e na outra parte, queremos gravar dados do cliente no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">os.File</a> no disco.  Mas, nos dois casos, queremos primeiro serializar a estrutura <code>ustomer</code> para JSON. <br><br>  Nesse cen√°rio, podemos reduzir a quantidade de c√≥digo padr√£o usando as interfaces Go. <br><br>  Go tem um tipo de interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">io.Writer</a> : <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Writer <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Write(p []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) (n <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, err error) }</code> </pre> <br>  E podemos aproveitar o fato de que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bytes.Buffer</a> e o tipo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">os.File</a> satisfazem essa interface, porque eles possuem os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√©todos bytes.Buffer.Write ()</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">os.File.Write ()</a> , respectivamente. <br><br>  Implementa√ß√£o simples: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"encoding/json"</span></span> <span class="hljs-string"><span class="hljs-string">"io"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"os"</span></span> ) <span class="hljs-comment"><span class="hljs-comment">//   Customer. type Customer struct { Name string Age int } //   WriteJSON,   io.Writer   . //    ustomer  JSON,     // ,     Write()  io.Writer. func (c *Customer) WriteJSON(w io.Writer) error { js, err := json.Marshal(c) if err != nil { return err } _, err = w.Write(js) return err } func main() { //   Customer. c := &amp;Customer{Name: "Alice", Age: 21} //    Buffer    WriteJSON var buf bytes.Buffer err := c.WriteJSON(buf) if err != nil { log.Fatal(err) } //   . f, err := os.Create("/tmp/customer") if err != nil { log.Fatal(err) } defer f.Close() err = c.WriteJSON(f) if err != nil { log.Fatal(err) } }</span></span></code> </pre> <br>  Obviamente, este √© apenas um exemplo fict√≠cio (podemos estruturar o c√≥digo de maneira diferente para obter o mesmo resultado).  Mas ilustra bem as vantagens do uso de interfaces: podemos criar o m√©todo <code>Customer.WriteJSON()</code> uma vez e cham√°-lo toda vez que precisamos gravar em algo que satisfa√ßa a interface <code>io.Writer</code> . <br><br>  Mas se voc√™ √© novo no Go, ter√° algumas perguntas: ‚Äú <i>Como sei se a interface io.Writer existe?</i>  <i>E como voc√™ sabe de antem√£o que ele est√° satisfeito com <code>bytes.Buffer</code> e <code>os.File</code> ?</i>  " <br><br>  Receio que n√£o haja uma solu√ß√£o simples.  Voc√™ s√≥ precisa adquirir experi√™ncia, se familiarizar com as interfaces e os diferentes tipos da biblioteca padr√£o.  Isso ajudar√° a ler a documenta√ß√£o desta biblioteca e a visualizar o c√≥digo de outra pessoa.  E para refer√™ncia r√°pida, adicionei os tipos mais √∫teis de tipos de interface ao final do artigo. <br><br>  Mas mesmo se voc√™ n√£o usar interfaces da biblioteca padr√£o, nada o impede de criar e usar <i>seus pr√≥prios tipos de interface</i> .  Falaremos sobre isso abaixo. <br><br><h3>  Teste de unidade e stubs </h3><br>  Para entender como as interfaces ajudam nos testes de unidade, vejamos um exemplo mais complexo. <br><br>  Suponha que voc√™ tenha uma loja e informa√ß√µes sobre vendas e o n√∫mero de clientes no PostgreSQL.  Voc√™ deseja escrever um c√≥digo que calcule o compartilhamento de vendas (n√∫mero espec√≠fico de vendas por cliente) do √∫ltimo dia, arredondado para duas casas decimais. <br><br>  Uma implementa√ß√£o m√≠nima seria assim: <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// : main.go package main import ( "fmt" "log" "time" "database/sql" _ "github.com/lib/pq" ) type ShopDB struct { *sql.DB } func (sdb *ShopDB) CountCustomers(since time.Time) (int, error) { var count int err := sdb.QueryRow("SELECT count(*) FROM customers WHERE timestamp &gt; $1", since).Scan(&amp;count) return count, err } func (sdb *ShopDB) CountSales(since time.Time) (int, error) { var count int err := sdb.QueryRow("SELECT count(*) FROM sales WHERE timestamp &gt; $1", since).Scan(&amp;count) return count, err } func main() { db, err := sql.Open("postgres", "postgres://user:pass@localhost/db") if err != nil { log.Fatal(err) } defer db.Close() shopDB := &amp;ShopDB{db} sr, err := calculateSalesRate(shopDB) if err != nil { log.Fatal(err) } fmt.Printf(sr) } func calculateSalesRate(sdb *ShopDB) (string, error) { since := time.Now().Sub(24 * time.Hour) sales, err := sdb.CountSales(since) if err != nil { return "", err } customers, err := sdb.CountCustomers(since) if err != nil { return "", err } rate := float64(sales) / float64(customers) return fmt.Sprintf("%.2f", rate), nil }</span></span></code> </pre> <br>  Agora, queremos criar um teste de unidade para a fun√ß√£o <code>calculateSalesRate()</code> para verificar se os c√°lculos est√£o corretos. <br><br>  Agora √© problem√°tico.  Precisamos configurar uma inst√¢ncia de teste do PostgreSQL, al√©m de criar e excluir scripts para preencher o banco de dados com dados falsos.  Temos muito trabalho a fazer se realmente queremos testar nossos c√°lculos. <br><br>  E as interfaces v√™m em socorro! <br><br>  <code>CountSales()</code> nosso pr√≥prio tipo de interface que descreve os <code>CountSales()</code> e <code>CountCustomers()</code> , nos quais a fun√ß√£o <code>CountCustomers()</code> baseia.  Em seguida, atualize a assinatura <code>*ShopDB</code> <code>calculateSalesRate()</code> para usar esse tipo de interface como par√¢metro, em vez do tipo <code>*ShopDB</code> prescrito. <br><br>  Assim: <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// : main.go package main import ( "fmt" "log" "time" "database/sql" _ "github.com/lib/pq" ) //    ShopModel.     //     ,     //  -,     . type ShopModel interface { CountCustomers(time.Time) (int, error) CountSales(time.Time) (int, error) } //  ShopDB    ShopModel,   //       -- CountCustomers()  CountSales(). type ShopDB struct { *sql.DB } func (sdb *ShopDB) CountCustomers(since time.Time) (int, error) { var count int err := sdb.QueryRow("SELECT count(*) FROM customers WHERE timestamp &gt; $1", since).Scan(&amp;count) return count, err } func (sdb *ShopDB) CountSales(since time.Time) (int, error) { var count int err := sdb.QueryRow("SELECT count(*) FROM sales WHERE timestamp &gt; $1", since).Scan(&amp;count) return count, err } func main() { db, err := sql.Open("postgres", "postgres://user:pass@localhost/db") if err != nil { log.Fatal(err) } defer db.Close() shopDB := &amp;ShopDB{db} sr := calculateSalesRate(shopDB) fmt.Printf(sr) } //       ShopModel    //    *ShopDB. func calculateSalesRate(sm ShopModel) string { since := time.Now().Sub(24 * time.Hour) sales, err := sm.CountSales(since) if err != nil { return "", err } customers, err := sm.CountCustomers(since) if err != nil { return "", err } rate := float64(sales) / float64(customers) return fmt.Sprintf("%.2f", rate), nil }</span></span></code> </pre> <br>  Depois de fazer isso, apenas criaremos um esbo√ßo que satisfa√ßa a interface do <code>ShopModel</code> .  Em seguida, voc√™ pode us√°-lo durante o teste de unidade da opera√ß√£o correta da l√≥gica matem√°tica na fun√ß√£o <code>calculateSalesRate()</code> .  Assim: <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// : main_test.go package main import ( "testing" ) type MockShopDB struct{} func (m *MockShopDB) CountCustomers() (int, error) { return 1000, nil } func (m *MockShopDB) CountSales() (int, error) { return 333, nil } func TestCalculateSalesRate(t *testing.T) { //  . m := &amp;MockShopDB{} //     calculateSalesRate(). sr := calculateSalesRate(m) // ,        //   . exp := "0.33" if sr != exp { t.Fatalf("got %v; expected %v", sr, exp) } }</span></span></code> </pre> <br>  Agora execute o teste e tudo funciona bem. <br><br><h3>  Arquitetura de aplicativos </h3><br>  No exemplo anterior, vimos como voc√™ pode usar interfaces para desacoplar determinadas partes do c√≥digo de tipos espec√≠ficos.  Por exemplo, a fun√ß√£o <code>ShopModel</code> <code>calculateSalesRate()</code> n√£o importa o que voc√™ passa para ela, desde que satisfa√ßa a interface <code>ShopModel</code> . <br><br>  Voc√™ pode expandir essa ideia e criar n√≠veis "desatados" inteiros em grandes projetos. <br>  Suponha que voc√™ esteja criando um aplicativo Web que interaja com um banco de dados.  Se voc√™ criar uma interface que descreva certos m√©todos para interagir com o banco de dados, poder√° consult√°-la em vez de um tipo espec√≠fico atrav√©s de manipuladores HTTP.  Como os manipuladores HTTP se referem apenas √† interface, isso ajudar√° a dissociar o n√≠vel HTTP e o n√≠vel de intera√ß√£o com o banco de dados.  Ser√° mais f√°cil trabalhar com n√≠veis de forma independente e, no futuro, voc√™ poder√° substituir alguns n√≠veis sem afetar o trabalho de outros. <br><br>  Eu escrevi sobre esse padr√£o em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um dos posts anteriores</a> , h√° mais detalhes e exemplos pr√°ticos. <br><br><h2>  O que √© uma interface vazia? </h2><br>  Se voc√™ est√° programando o Go h√° algum tempo, provavelmente encontrou uma <i>interface do tipo de interface vazia</i> <code>interface{}</code> .  Vou tentar explicar o que √©.  No come√ßo deste artigo, escrevi: <br><br><blockquote>  O tipo de interface no Go √© um tipo de <i>defini√ß√£o</i> .  Ele define e descreve os m√©todos espec√≠ficos que <i>algum outro tipo deve ter</i> . </blockquote><br>  Um tipo de interface vazio <i>n√£o descreve m√©todos</i> .  Ele n√£o tem regras.  E assim, qualquer objeto satisfaz uma interface vazia. <br><br>  Em ess√™ncia, o tipo de interface vazia <code>interface{}</code> √© um tipo de curinga.  Se voc√™ o encontrou em uma declara√ß√£o (vari√°vel, par√¢metro de fun√ß√£o ou campo de estrutura), poder√° usar um objeto de <i>qualquer tipo</i> . <br><br>  Considere o c√≥digo: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { person := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{}, <span class="hljs-number"><span class="hljs-number">0</span></span>) person[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"Alice"</span></span> person[<span class="hljs-string"><span class="hljs-string">"age"</span></span>] = <span class="hljs-number"><span class="hljs-number">21</span></span> person[<span class="hljs-string"><span class="hljs-string">"height"</span></span>] = <span class="hljs-number"><span class="hljs-number">167.64</span></span> fmt.Printf(<span class="hljs-string"><span class="hljs-string">"%+v"</span></span>, person) }</code> </pre> <br>  Aqui inicializamos o mapa para <code>person</code> , que usa um tipo de string para chaves e uma interface vazia do tipo de <code>interface{}</code> para valores.  Atribu√≠mos tr√™s tipos diferentes como valores de mapa (string, n√∫mero inteiro e float32), e n√£o h√° problema.  Como objetos de qualquer tipo atendem √† interface vazia, o c√≥digo funciona muito bem. <br><br>  Voc√™ pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">executar este c√≥digo aqui</a> , ver√° um resultado semelhante: <br><br><pre> <code class="plaintext hljs">map[age:21 height:167.64 name:Alice]</code> </pre> <br>  Quando se trata de extrair e usar valores de um mapa, √© importante ter isso em mente.  Suponha que voc√™ queira obter o valor da <code>age</code> e aument√°-lo em 1. Se voc√™ escrever um c√≥digo semelhante, ele n√£o ser√° compilado: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { person := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{}, <span class="hljs-number"><span class="hljs-number">0</span></span>) person[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"Alice"</span></span> person[<span class="hljs-string"><span class="hljs-string">"age"</span></span>] = <span class="hljs-number"><span class="hljs-number">21</span></span> person[<span class="hljs-string"><span class="hljs-string">"height"</span></span>] = <span class="hljs-number"><span class="hljs-number">167.64</span></span> person[<span class="hljs-string"><span class="hljs-string">"age"</span></span>] = person[<span class="hljs-string"><span class="hljs-string">"age"</span></span>] + <span class="hljs-number"><span class="hljs-number">1</span></span> fmt.Printf(<span class="hljs-string"><span class="hljs-string">"%+v"</span></span>, person) }</code> </pre> <br>  Voc√™ receber√° uma mensagem de erro: <br><br><pre> <code class="plaintext hljs">invalid operation: person["age"] + 1 (mismatched types interface {} and int)</code> </pre> <br>  O motivo √© que o valor armazenado no mapa pega o tipo de <code>interface{}</code> e perde seu tipo int base original.  E como o valor n√£o √© mais inteiro, n√£o podemos adicionar 1 a ele. <br><br>  Para contornar isso, voc√™ precisa tornar o valor inteiro novamente e s√≥ ent√£o us√°-lo: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { person := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{}, <span class="hljs-number"><span class="hljs-number">0</span></span>) person[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"Alice"</span></span> person[<span class="hljs-string"><span class="hljs-string">"age"</span></span>] = <span class="hljs-number"><span class="hljs-number">21</span></span> person[<span class="hljs-string"><span class="hljs-string">"height"</span></span>] = <span class="hljs-number"><span class="hljs-number">167.64</span></span> age, ok := person[<span class="hljs-string"><span class="hljs-string">"age"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !ok { log.Fatal(<span class="hljs-string"><span class="hljs-string">"could not assert value to int"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } person[<span class="hljs-string"><span class="hljs-string">"age"</span></span>] = age + <span class="hljs-number"><span class="hljs-number">1</span></span> log.Printf(<span class="hljs-string"><span class="hljs-string">"%+v"</span></span>, person) }</code> </pre> <br>  Se voc√™ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">executar isso</a> , tudo funcionar√° conforme o esperado: <br><br><pre> <code class="plaintext hljs">2009/11/10 23:00:00 map[age:22 height:167.64 name:Alice]</code> </pre> <br>  Ent√£o, quando voc√™ deve usar um tipo de interface vazia? <br><br>  Talvez <i>n√£o com muita frequ√™ncia</i> .  Se voc√™ chegar a esse ponto, pare e pense se √© correto usar a <code>interface{}</code> .  Como conselho geral, posso dizer que ser√° mais claro, mais seguro e mais produtivo usar tipos espec√≠ficos, ou seja, tipos de interface n√£o vazios.  No exemplo acima, era melhor definir uma estrutura de <code>Person</code> com campos adequadamente digitados: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Person <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Age <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Height <span class="hljs-keyword"><span class="hljs-keyword">float32</span></span> }</code> </pre> <br>  Uma interface vazia, por outro lado, √© √∫til quando voc√™ precisa acessar e trabalhar com tipos imprevis√≠veis ou definidos pelo usu√°rio.  Por algum motivo, essas interfaces s√£o usadas em locais diferentes da biblioteca padr√£o, por exemplo, nas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fun√ß√µes gob.Encode</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fmt.Print</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">template.Execute</a> . <br><br><h2>  Tipos de interface √∫teis </h2><br>  Aqui est√° uma pequena lista dos tipos de interface mais solicitados e √∫teis da biblioteca padr√£o.  Se voc√™ ainda n√£o estiver familiarizado com eles, recomendo a leitura da documenta√ß√£o relevante. <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">builtin.Error</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fmt.Stringer</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">io.Reader</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">io.Writer</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">io.ReadWriteCloser</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://golang.org/pkg/net/">http.ResponseWriter</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://golang.org/pkg/net/">http.Handler</a> <br></li></ul><br>  Uma lista mais longa de bibliotecas padr√£o tamb√©m est√° dispon√≠vel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt463063/">https://habr.com/ru/post/pt463063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt463045/index.html">Detecta automaticamente emo√ß√µes em conversas de texto usando redes neurais</a></li>
<li><a href="../pt463055/index.html">Sobre administradores, devops, confus√£o sem fim e transforma√ß√£o de DevOps na empresa</a></li>
<li><a href="../pt463057/index.html">Direitos personalizados da estrutura 2 do Yii</a></li>
<li><a href="../pt463059/index.html">Tr√™s vidas em TI e n√£o apenas</a></li>
<li><a href="../pt463061/index.html">Regras para preparar layouts em Figma</a></li>
<li><a href="../pt463067/index.html">Primeiro a frente e depois as costas (algum dia)</a></li>
<li><a href="../pt463069/index.html">Guia animado b√°sico de React</a></li>
<li><a href="../pt463071/index.html">Qual o impacto das interrup√ß√µes na Internet?</a></li>
<li><a href="../pt463073/index.html">QUIC em a√ß√£o: como o Uber o implementou para otimizar o desempenho</a></li>
<li><a href="../pt463075/index.html">Novas licen√ßas de c√≥digo aberto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>