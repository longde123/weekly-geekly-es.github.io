<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤶🏼 💆🏼 ⛹️ Penyelundupan Permintaan HTTP - pendekatan baru 🧛🏽 👸🏻 🧙🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada tanggal 7 Oktober 2019, direktur penelitian di PortSwigger (produsen BurpSuite) menerbitkan penelitian tentang pendekatan baru untuk penyelundupa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Penyelundupan Permintaan HTTP - pendekatan baru</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468489/"><p>  Pada tanggal 7 Oktober 2019, direktur penelitian di PortSwigger (produsen BurpSuite) menerbitkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://portswigger.net/blog/">penelitian</a> tentang pendekatan baru untuk penyelundupan Permintaan HTTP.  Dengan bantuan mereka, dia menghasilkan sekitar $ 70.000 di bugbounty.  Pada artikel ini, kami secara singkat mengetahui inti dari serangan, alat, dan juga metode meneliti server web yang rentan terhadap kerentanan ini. </p><a name="habracut"></a><br><h4 id="chto-takoe-http-request-smuggling">  Apa itu Penyelundupan Permintaan HTTP </h4><br><p>  Penyelundupan Permintaan HTTP - serangan yang ditujukan untuk menyinkronkan frontend server web dan backend server web, sebagai akibatnya penyerang dapat menyelundupkan permintaan HTTP melewati server frontend.  Gambar dari artikel asli berfungsi sebagai demonstrasi yang bagus: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/747/263/e2d/747263e2d0149330227e70267106fffc.svg" alt="gambar"></p><br><p>  Serangan semacam itu dapat menyebabkan berbagai konsekuensi - pengenalan XSS di sesi pengguna lain, mengarahkan pengguna ke sumber daya pihak ketiga, meracuni cache server, kemiripan dengan SSRF, dan sejumlah lainnya. </p><br><p>  Dalam Penjelmaan Penyelundupan 2019 tahun 2019, James Kettle mengeksploitasi pemrosesan header server web yang salah </p><br><pre><code class="plaintext hljs">Transfer-Encoding: chunked</code> </pre> <br><p>  menunjukkan bahwa isi pesan akan dikirim dalam bagian ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RFC</a> ).  Karena beberapa server web tidak mendukung transmisi yang terpotong, atau menangani tajuk secara berbeda, frontend akan “melihat” hanya satu permintaan, dan backend akan mengenalinya sebagai dua.  Rincian lebih lanjut tentang rincian serangan dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://portswigger.net/blog/">artikel asli</a> , ada juga tugas praktis di mana Anda dapat berlatih untuk menemukan kerentanan secara manual. </p><br><p>  Untuk pencarian cepat, James mengembangkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://github.com/portswigger/">plug-in</a> untuk BurpSuit, yang menerima permintaan untuk input dan membuat catatan tentang kerentanan layanan (jika ada) di output. </p><br><h4 id="primery-uyazvimyh-veb-serverov">  Contoh server web yang rentan </h4><br><p>  Saya harus mengatakan bahwa masalah penyelundupan dan kerentanan lainnya yang terkait dengan pengoperasian server web telah lama ditangani oleh peneliti lain dengan nama panggilan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">regilero</a> .  Selama tiga tahun terakhir, ia telah menerbitkan tiga artikel yang menggambarkan kerentanan yang ia temukan di server web populer, yang sebagian besar ditugaskan CVE dengan tingkat kekritisan sedang dan tinggi.  Di antara server yang rentan adalah Apache Traffic Server, Jetty, Apsis. </p><br><p>  Setelah tertarik pada masalah ini, peneliti lain, Nathan Davison, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://nathandavison.com/blog/haproxy-">menemukan</a> kerentanan di HAProxy, yang mengabaikan header yang salah bentuk. </p><br><pre> <code class="plaintext hljs">Transfer-Encoding:[\x0b]chunked</code> </pre> <br><p>  dan mengubahnya menjadi bentuk berikut: </p><br><pre> <code class="plaintext hljs">Transfer-Encoding: chunked</code> </pre> <br><p>  Tapi server backend - gunicorn, proksi aplikasi pada Flask, baca header, yang memancing kerentanan. </p><br><p>  Beberapa saat kemudian, sejumlah peneliti lain menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kerentanan</a> (ditugaskan CVE-2019-16276) dalam implementasi server http golang - server menormalkan header jika ada ruang sebelum tanduk. <br>  Minta: </p><br><p><img src="https://habrastorage.org/webt/6o/xo/9s/6oxo9supeccvs3tjbzs2gjuiyfa.png" alt="gambar"></p><br><p>  Setelah diproses oleh server: </p><br><p><img src="https://habrastorage.org/webt/-3/uv/5-/-3uv5-g2-druizng90mzidgvqyw.png" alt="gambar"></p><br><p>  Kerentanan dapat dieksploitasi jika server frontend mengabaikan header dengan spasi, dan menggunakan Content-Length untuk menghitung ukuran permintaan. </p><br><p>  Server web Caddy yang ditulis dalam Go juga rentan karena menggunakan pustaka net / http yang sama.  Pengembang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengkonfirmasi</a> bahwa setelah memperbarui GO dan membangun kembali paket, masalahnya hilang. </p><br><p>  Penulis artikel ini menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://redmine.lig">masalah</a> serupa di server lighthttpd (tidak ada CVE yang ditugaskan).  Tangkapan layar menunjukkan bahwa server menerima dan memproses tajuk yang berisi spasi: </p><br><p><img src="https://habrastorage.org/webt/v7/gy/67/v7gy67qzws5izqqsavhl78qusim.png" alt="gambar"></p><br><p>  Pengembang tidak cukup setuju dengan RFC 7230 (dan penulis juga), dan percaya bahwa tanggung jawab untuk pemrosesan header yang salah terletak pada proksi yang meneruskan permintaan tanpa menormalkan dan memeriksanya.  Namun, bug akan diperbaiki pada rilis baru: </p><br><blockquote>  Secara default, lighttpd mem-parsing (dan menormalkan) permintaan sebelum mem-reverse-proxy ke backend  Melakukan hal itu menggagalkan serangan yang disebutkan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://portswigger.net/research/">https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn</a> ke server di hulu dari lighttpd. <br>  Namun, seperti yang disebutkan oleh stbuehler di atas, proksi downstream dari lighttpd mungkin meneruskan apa saja ke lighttpd. <br>  Perubahan yang akan dilakukan pada rilis lighttpd berikutnya adalah menolak permintaan dengan spasi atau tab setelah nama-bidang dan sebelum titik dua, tetapi hanya ketika lighttpd dikonfigurasi dalam mode (default) mode parsing header http ketat. </blockquote><p>  Bug yang sama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ditemukan</a> di server web cheroot yang digunakan oleh kerangka kerja cherrypy.  Kerangka kerja mini ini ditemukan di startup, sering digunakan untuk menulis API.  Laporan bug tergantung pada status yang dibuka. </p><br><h4 id="neobhodimye-i-dostatochnye-usloviya-dlya-uyazvimosti">  Diperlukan dan kondisi yang cukup untuk kerentanan </h4><br><p>  Jadi, apa kondisi yang diperlukan untuk memeriksa dan mengeksploitasi kerentanan: </p><br><ul><li>  Permintaan POST.  Meskipun RFC tidak secara eksplisit melarang penggunaan header Content-Length dan Transfer-Encoding untuk permintaan GET, pada kenyataannya mereka hanya digunakan dalam permintaan POST. </li><li>  Kehadiran server frontend dan backend - jika tidak ada, tidak akan ada yang disinkronkan. </li><li>  Server web harus menguraikan header Transfer-Encoding secara berbeda, yaitu, seseorang harus "membacanya", dan yang kedua harus diabaikan. </li></ul><br><h3 id="testirovanie-v-laboratornyh-usloviyah">  Pengujian laboratorium </h3><br><p>  Untuk pemahaman dan pemecahan masalah yang lebih baik di server web dan proksi yang ada, sebaiknya gunakan lingkungan pengujian secara lokal menggunakan Docker. </p><br><p>  Contoh diagram lingkungan pengujian: </p><br><p><img src="https://habrastorage.org/webt/vw/ta/al/vwtaalo8yv5w_aecwkxjygplca8.png" alt="gambar"></p><br><p>  Kode Aplikasi: </p><br><pre> <code class="plaintext hljs">from flask import Flask, request, jsonify app = Flask(__name__) @app.route('/', methods=['GET', 'POST']) def main(): # the next line is required for Transfer-Encoding support in the request request.environ['wsgi.input_terminated'] = True headers = {} for header in request.headers: headers[header[0]] = header[1] print (request.data) print (headers) return jsonify(body=str(request.data), headers=headers)</code> </pre> <br><p>  File dengan pengaturan frontend, misalnya, caddy: </p><br><pre> <code class="plaintext hljs">localhost:80 log ../access.log proxy / host.docker.internal:8888</code> </pre> <br><p>  Maka semuanya sederhana, jalankan aplikasi: </p><br><pre> <code class="plaintext hljs">gunicorn --keep-alive 10 -k gevent --bind 0.0.0.0:8888 -w 4 backend:app</code> </pre> <br><p>  Dan wadah: </p><br><pre> <code class="plaintext hljs">docker run -d -t --name caddy -p 80:80 -p 443:443 -v /Users/sun/work/caddyfile:/etc/Caddyfile abiosoft/caddy:latest</code> </pre> <br><p>  Dari toko Burp kami menginstal Permintaan HTTP Smuggler dan Logger ++ untuk kenyamanan debugging.  Selanjutnya di Repeater kami membentuk permintaan sederhana, misalnya ini: </p><br><pre> <code class="plaintext hljs">POST / HTTP/1.1 Host: localhost Content-Length: 8 Connection: close body=123</code> </pre> <br><p>  Dan kirimkan untuk memeriksa apakah semuanya sudah terkonfigurasi dengan benar: </p><br><pre> <code class="plaintext hljs">HTTP/1.1 200 OK Content-Length: 202 Content-Type: application/json Date: Mon, 07 Oct 2019 13:17:18 GMT Server: Caddy Server: gunicorn/19.9.0 Connection: close {"body":"b'body=123'","headers":{"Accept-Encoding":"gzip","Connection":"close","Content-Length":"8","Host":"host.docker.internal:8888","User-Agent":"Go-http-client/1.1","X-Forwarded-For":"172.17.0.1"}}</code> </pre> <br><p>  Sekarang luncurkan Launch Smuggle Probe dan lihat jawabannya. </p><br><p><img src="https://habrastorage.org/webt/27/y4/_p/27y4_p-eozetpwnyp3wd4_tuzj0.gif" alt="gambar"></p><br><p>  Yang paling menarik dimulai pada saat ini.  Penting untuk menganalisis permintaan dan tanggapan untuk memahami apakah layanan rentan atau tidak.  Bagian ini dibiarkan bagi pembaca yang ingin tahu. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id468489/">https://habr.com/ru/post/id468489/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id468471/index.html">Tinjauan Umum AngularConnect 2019. Bagian 1</a></li>
<li><a href="../id468479/index.html">“Orang-orang berpikir bahwa gratis itu tidak berharga. Sepertinya saya bisa meyakinkan mereka ”- Yuri Yartsev tentang sekolah Russol</a></li>
<li><a href="../id468481/index.html">Bagaimana S7 adalah yang pertama di Rusia yang menjual tiket pesawat secara online</a></li>
<li><a href="../id468485/index.html">Ketika Anda menginginkan GUI yang indah, tetapi GPU tidak</a></li>
<li><a href="../id468487/index.html">Apa yang bisa terjadi (Vektor serangan tipikal)</a></li>
<li><a href="../id468491/index.html">Kutukan karma Habra</a></li>
<li><a href="../id468493/index.html">Struktur pandangan udara proyek Ilmu Data</a></li>
<li><a href="../id468497/index.html">Timer menyikat waktu 3 menit</a></li>
<li><a href="../id468501/index.html">Bagaimana saya membuat filter yang tidak merusak gambar bahkan setelah jutaan berjalan</a></li>
<li><a href="../id468503/index.html">Mail tidak melangkah lebih jauh 500 mil - FAQ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>