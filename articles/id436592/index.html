<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😮 🐩 👩🏼‍🎤 Backend di Komponen File Tunggal VueJS 🚢 👩🏼‍⚖️ 🤙🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suatu hari, ketika membaca dokumentasi Vue Loader, saya menemukan inovasi yang menarik di versi 15. Kita berbicara tentang blok khusus yang dapat tert...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Backend di Komponen File Tunggal VueJS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436592/"><p>  Suatu hari, ketika membaca dokumentasi Vue Loader, saya menemukan inovasi yang menarik di versi 15.  Kita berbicara tentang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">blok khusus</a> yang dapat tertanam dalam komponen file tunggal Vue.  Contoh menunjukkan bagaimana Anda dapat mengakses konten blok ini secara langsung di komponen.  Pada awalnya, saya sepertinya tidak terlalu menghargai kesempatan ini, tetapi kemudian saya berpikir, hmm ... dan jika saya mengisi back-end yang terhubung dengan bagian depan ini ... Dan itu dimulai ... </p><a name="habracut"></a><br><p> Pencadangan pada waktu itu (setahun yang lalu) ada di <u>php</u> .  Untuk memulai, saya memutuskan untuk melihat bagaimana editor PhpStorm favorit saya menangani memasukkan kode php ke dalam blok ini.  Tidak peduli bagaimana saya mencoba, tidak ada pembicaraan tentang penyorotan kode atau fungsi pelengkapan otomatis lainnya.  Saya pikir saya akan menulis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">masalah</a> pada mereka yang mendukung JetBrains.  Setelah beberapa saat, saya menerima jawaban negatif tentang kemungkinan untuk mengkonfigurasi ini, tetapi mereka mengirim instruksi tentang cara mengkonfigurasinya untuk javascript.  Yah, saya pikir oke, Anda masih perlu mencoba menerapkan ide.  Saya belum pernah mengembangkan apa pun untuk Webpack sebelumnya.  Saya mempelajari dokumentasi untuk hari itu, dan selama dua malam berikutnya saya mengembangkan Loader dan plugin.  Semua ini berhasil, tetapi tanpa penyorotan sintaks dasar dalam blok .vue kustom, kode php hanya membawa rasa sakit ... </p><br><p>  Waktu berlalu.  Perlahan berkenalan dengan nodejs dan mengikuti perubahan log perubahan dalam versi baru, menemukan solusi yang berguna dan siap pakai untuk diri saya sendiri, saya mulai memahami bahwa ketika memilih apa yang akan didukung, saya masih akan menggunakan node.  Menjalankan banyak salinan aplikasi pada node dan membongkar muatan pada salinan ini menggunakan ngnix memberikan hasil yang lebih baik.  Baru-baru ini saya kembali ke topik ini dan menyelesaikan loader dan plugin. </p><br><p>  Saya akan mulai dengan template </p><br><h2 id="shablon-dlya-bekenda">  Templat Backend </h2><br><p>  Templat ini kosong di mana bagian backend dari blok khusus file vue akan jatuh.  Semua ini setelah diproses disimpan dalam file yang dihasilkan.  Contoh template: </p><br><div class="spoiler">  <b class="spoiler_title">Templat backend</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> WEB_PORT = <span class="hljs-number"><span class="hljs-number">314</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Koa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'koa'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Router = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'koa-router'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Koa(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> router = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Router(); app .use(router.routes()) .use(router.allowedMethods()); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> body = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'koa-json-body'</span></span>)({ <span class="hljs-attr"><span class="hljs-attr">limit</span></span>: <span class="hljs-string"><span class="hljs-string">'10kb'</span></span> }); app.listen(WEB_PORT); app.context.db = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../lib/db.js'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*{{endpoints}}*/</span></span></code> </pre> </div></div><br><p>  <code>/*{{endpoints}}*/</code> - ini adalah tempat kode dari blok khusus akan dimasukkan </p><br><h2 id="webpack-loader">  Webpack loader </h2><br><div class="spoiler">  <b class="spoiler_title">Kode bootloader</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> loaderUtils = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"loader-utils"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = <span class="hljs-string"><span class="hljs-string">'gavrilow_backend_plugin'</span></span>; exports.default = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cacheable(); <span class="hljs-comment"><span class="hljs-comment">//      // !!!   ,         this.async()(null, ''); //    .   . const _source = source.replace(/^\n/img, ''); //       Custom Block [blockType=backend] const file_path = this.resourcePath; // this._compiler -  ,     if (this._compiler[id] === undefined) this._compiler[id] = { change: true, arr: [] }; var fp_exists = false; //         Custom Blocks vue //   -   . for (let i = this._compiler[id].arr.length - 1; i &gt;= 0; i--) { if (this._compiler[id].arr[i].file_path === file_path) { fp_exists = true; //  ,     . if (this._compiler[id].arr[i].data !== _source) { //             ,    this._compiler[id].arr[i].data = _source; this._compiler[id].change = true; } break; } } if (fp_exists) return; //         ,   //     ,   Custom Blocks      //    [ change = true ]     . this._compiler[id].change = true; this._compiler[id].arr.push({ file_path: file_path, data: _source }); };</span></span></code> </pre> </div></div><br><p>  File * .vue yang berisi blok-blok khusus masuk ke bootloader.  Nama blok khusus dapat Anda atur sendiri. </p><br><h2 id="webpack-plugin">  Plugin webpack </h2><br><div class="spoiler">  <b class="spoiler_title">Kode plugin</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> util = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'util'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> readFile = util.promisify(fs.readFile); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> writeFile = util.promisify(fs.writeFile); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> footer_header_template; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gavrilow_backend_plugin</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(options) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options = options; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.logMess = <span class="hljs-string"><span class="hljs-string">''</span></span>; } endLog(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.logMess = <span class="hljs-string"><span class="hljs-string">'------ gavrilow-backend-plugin ------------------------------------------------------------------\n'</span></span> +<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.logMess; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addLogMess(<span class="hljs-string"><span class="hljs-string">'-------------------------------------------------------------------------------------------------'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.logMess); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.logMess = <span class="hljs-string"><span class="hljs-string">''</span></span>; } addLogMess(mess){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.logMess += mess+<span class="hljs-string"><span class="hljs-string">'\n'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> prepareTemplate(){ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (footer_header_template === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> contents = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> readFile(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.backend_template, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); footer_header_template = contents.split(<span class="hljs-regexp"><span class="hljs-regexp">/^\/\*+?{{.*endpoints.*}}+?\*\/$/img</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (footer_header_template.length !== <span class="hljs-number"><span class="hljs-number">2</span></span>) { footer_header_template = <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addLogMess(<span class="hljs-string"><span class="hljs-string">'     .'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.endLog(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { footer_header_template = <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> err; } } apply(compiler) { compiler.hooks.emit.tapAsync( <span class="hljs-string"><span class="hljs-string">'gavrilow_backend_plugin'</span></span>, (compilation, callback) =&gt; { callback(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.backend_template === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.backend_template === <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addLogMess(<span class="hljs-string"><span class="hljs-string">'  /  -  ...'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.endLog(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.backend_output === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.backend_output === <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addLogMess(<span class="hljs-string"><span class="hljs-string">'     js   ...'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.endLog(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!compiler.gavrilow_backend_plugin) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.addLogMess(<span class="hljs-string"><span class="hljs-string">'         [ &lt;backend&gt;...&lt;/backend&gt; ].'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.endLog(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } (<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> ()=&gt;{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   if (!await this.prepareTemplate()) return; //        -  if (!compiler.gavrilow_backend_plugin.change) return; //       //   compiler.gavrilow_backend_plugin.change = false; if (compiler.gavrilow_backend_plugin.arr.length === 0) { this.addLogMess(' -      [ &lt;backend&gt;...&lt;/backend&gt; ]'); this.endLog(); return; } this.addLogMess(' beckend: "'+this.options.backend_output+'"\n...'); //     /*{{endpoints}}*/   var backend_js = footer_header_template[0]+"\n"; //     Custom Blocks for (let i = 0; i &lt; compiler.gavrilow_backend_plugin.arr.length; i++) { backend_js +=compiler.gavrilow_backend_plugin.arr[i].data+"\n"; this.addLogMess('['+compiler.gavrilow_backend_plugin.arr[i].file_path+']'); } //     /*{{endpoints}}*/   backend_js += footer_header_template[1]; //    await writeFile(this.options.backend_output, backend_js); } catch (err) { throw err; } finally { this.endLog(); } })(); } ); } } gavrilow_backend_plugin.loader = require.resolve('./loader'); module.exports = gavrilow_backend_plugin;</span></span></code> </pre> </div></div><br><p>  Plugin dipicu setelah selesainya perakitan proyek.  Template disiapkan dengan memecahnya menjadi 2 bagian: sebelum <code>/*{{endpoints}}*/</code> dan setelah <code>/*{{endpoints}}*/</code> Jika bendera untuk mengubah array oleh loader telah ditetapkan, skrip akhir dirakit dari semua bagian yang tersedia. </p><br><hr><br><h2 id="kak-eto-vsyo-poprobovat">  Cara mencoba semuanya </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Proyek banjir di github</a> . </p><br><p>  Ada juga deskripsi pengaturan. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id436592/">https://habr.com/ru/post/id436592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id436578/index.html">Harga keamanan pribadi untuk direktur perusahaan IT besar per tahun</a></li>
<li><a href="../id436584/index.html">Hukum Manajemen Runet - implementasi ketentuan dan bidang tanggung jawab</a></li>
<li><a href="../id436586/index.html">Pertempuran JS: bagaimana saya menulis eval saya ()</a></li>
<li><a href="../id436588/index.html">MegaSlerm di Moskow pada awal Juni: pengumuman dan diskon pertama</a></li>
<li><a href="../id436590/index.html">Kiat untuk pelanggan fungsional. Tekan Δ untuk membaca</a></li>
<li><a href="../id436594/index.html">Selamat tinggal Chevy Volt: Cerita dan Legenda Hibrida yang Dapat Diisi Ulang</a></li>
<li><a href="../id436596/index.html">Pengembang tumpukan penuh sebenarnya terjebak di tingkat menengah. Bebaskan diri Anda dari penderitaan - jangan menempuh jalan itu</a></li>
<li><a href="../id436598/index.html">Satu langkah raksasa untuk mesin catur</a></li>
<li><a href="../id436600/index.html">Hak cipta diambil alih dan dikoreografikan: Pembuat Fortnite dituntut karena karakter tarian</a></li>
<li><a href="../id436602/index.html">Modul kargo fajar: 20 tahun di orbit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>