<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëµ üçÅ ‚è±Ô∏è Clicker DIY ü§±üèº üë®üèæ‚Äç‚öïÔ∏è ‚è±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, un ami m'a demand√© d'aider avec une t√¢che: contr√¥ler un ordinateur avec un lecteur audio install√© sur un ordinateur portable Windows √† l'ai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Clicker DIY</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422203/"><p>  R√©cemment, un ami m'a demand√© d'aider avec une t√¢che: contr√¥ler un ordinateur avec un lecteur audio install√© sur un ordinateur portable Windows √† l'aide d'une petite t√©l√©commande mat√©rielle.  J'ai demand√© √† toutes sortes de t√©l√©commandes IR de ne pas offrir.  Et pour fabriquer l'AVR-e, dont il lui reste un nombre consid√©rable, il faut le fixer lentement. </p><a name="habracut"></a><br><h2 id="postanovka-zadachi">  √ânonc√© du probl√®me </h2><br><p>  La t√¢che est √©videmment divis√©e en deux parties: </p><br><ul><li>  Mat√©riel du microcontr√¥leur, et </li><li>  Logiciel qui s'ex√©cute sur un ordinateur et contr√¥le ce qui s'y trouve. </li></ul><br><p>  Puisque nous travaillons avec AVR, alors pourquoi pas Arduino? </p><br><p>  Nous posons le probl√®me. <br>  Plateforme mat√©rielle: <br>  HW1.  La gestion s'effectue par boutons sans fixation; <br>  HW2.  Nous servons 3 boutons (en g√©n√©ral, combien ne me d√©range pas); <br>  HW3.  On consid√®re que le fait de maintenir le bouton enfonc√© pendant au moins 100 millisecondes; <br>  HW4.  Les pressions plus longues sont ignor√©es.  Le traitement de plus d'un bouton √† la fois n'est pas effectu√©; <br>  HW5.  Lorsqu'un bouton est enfonc√©, une certaine action est lanc√©e sur l'ordinateur; <br>  HW6.  Fournir une interface de communication avec un ordinateur via le convertisseur s√©rie / USB int√©gr√©; <br>  Plateforme logicielle: <br>  SW1.  Fournir une interface de communication avec un ordinateur via un port s√©rie s√©lectionnable; <br>  SW2.  Convertissez les commandes provenant de l'interface de communication en √©v√©nements du syst√®me d'exploitation transmis au lecteur audio souhait√©. <br>  SW3.  Suspendre le traitement des commandes.  Y compris une commande de la t√©l√©commande. </p><br><p>  Eh bien, il y a une exigence suppl√©mentaire: si cela n'introduit pas un investissement s√©rieux en temps, rendez les solutions aussi universelles que possible. </p><br><h2 id="proektirovanie-i-reshenie">  Conception et solution </h2><br><h3 id="hw1">  Hw1 </h3><br><p>  Les boutons du bouton restent en position "enfonc√©e" pendant un court instant.  De plus, les boutons peuvent vibrer (c'est-√†-dire g√©n√©rer de nombreux d√©clencheurs en peu de temps en raison d'un contact instable). <br>  Cela n'a aucun sens de les connecter √† des interruptions - les mauvais temps de r√©ponse sont n√©cessaires pour s'en occuper.  Nous lirons leur statut √† partir de broches num√©riques.  Pour assurer une lecture stable du bouton √† l'√©tat non press√©, il est n√©cessaire de connecter la broche d'entr√©e √† la masse (pull-down) ou √† l'alimentation (pull-up) via une r√©sistance pull-up.  En utilisant la r√©sistance de rappel int√©gr√©e, nous ne ferons pas d'√©l√©ment discret suppl√©mentaire dans le circuit.  D'une part, nous connectons le bouton √† notre entr√©e, l'autre - au sol.  Voici le r√©sultat: <br><img src="https://habrastorage.org/webt/7p/_o/so/7p_osowau3spzfyc9oob6bi4gku.png" alt="Sch√©ma de connexion des boutons"><br>  Et donc - pour chaque bouton. </p><br><h3 id="hw2">  Hw2 </h3><br><p> Il y a plusieurs boutons, nous avons donc besoin d'une certaine quantit√© d'enregistrements uniformes sur la fa√ßon d'interroger les boutons et ce qu'il faut faire si vous appuyez dessus.  Nous regardons vers l'encapsulation et faisons la classe <code>Button</code> du <code>Button</code> , qui contient le num√©ro de la broche √† partir de laquelle l'enqu√™te est men√©e (et l'initialise elle-m√™me), et la commande qui doit √™tre envoy√©e au port.  Nous traiterons de la composition de l'√©quipe plus tard. </p><br><p>  La classe de boutons ressemblera √† ceci: </p><br><div class="spoiler">  <b class="spoiler_title">Code de classe de bouton</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Button</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Button(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pin, ::Command command) : pin(pin), command(command) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Begin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ pinMode(pin, INPUT); digitalWrite(pin, <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !digitalRead(pin); } ::<span class="hljs-function"><span class="hljs-function">Command </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> command; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pin; ::Command command; };</code> </pre> </div></div><br><p>  Apr√®s cette √©tape, nos boutons sont devenus universels et sans visage, mais vous pouvez travailler avec eux de la m√™me mani√®re. </p><br><p>  Assemblez les boutons et assignez-leur des broches </p><br><pre> <code class="cpp hljs">Button buttons[] = { Button(A0, Command::Previous), Button(A1, Command::PauseResume), Button(A2, Command::Next), };</code> </pre> <br><p>  L'initialisation de tous les boutons se fait en appelant la m√©thode <code>Begin()</code> pour chaque bouton: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;button : buttons) { button.Begin(); }</code> </pre> <br><p>  Afin de d√©terminer quel bouton est press√©, nous allons parcourir les boutons et v√©rifier si quelque chose est press√©.  Nous retournons l'index du bouton, ou l'une des valeurs sp√©ciales: "rien n'est press√©" et "plus d'un bouton est press√©".  Bien entendu, les valeurs sp√©ciales ne peuvent pas se chevaucher avec des num√©ros de bouton valides. </p><br><div class="spoiler">  <b class="spoiler_title">GetPressed ()</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = PressedNothing; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (byte i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; ButtonsCount; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buttons[i].IsPressed()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index == PressedNothing) { index = i; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PressedMultiple; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> index; }</code> </pre> </div></div><br><h3 id="hw3">  Hw3 </h3><br><p>  Les boutons seront interrog√©s avec une certaine p√©riode (disons, 10 ms), et nous supposerons que la presse a eu lieu si le m√™me bouton (et exactement un) a √©t√© maintenu pendant un nombre donn√© de cycles d'interrogation.  Divisez le temps de fixation (100 ms) par la p√©riode d'interrogation (10 ms), nous obtenons 10. <br>  Nous allons commencer un compteur de d√©cr√©mentation, dans lequel nous √©crivons 10 √† la premi√®re fixation de pressage, et d√©cr√©mentons √† chaque p√©riode.  D√®s qu'il passe de 1 √† 0, nous commen√ßons le traitement (voir HW5) </p><br><h3 id="hw4">  Hw4 </h3><br><p>  Si le compteur est d√©j√† 0, aucune action n'est effectu√©e. </p><br><h3 id="hw5">  Hw5 </h3><br><p>  Comme mentionn√© ci-dessus, une commande ex√©cutable est associ√©e √† chaque bouton.  Il doit √™tre transmis via l'interface de communication. </p><br><p>  √Ä ce stade, vous pouvez impl√©menter une strat√©gie de clavier. </p><br><div class="spoiler">  <b class="spoiler_title">Impl√©mentation de la boucle principale</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleButtons</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CurrentButton = PressedNothing; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> byte counter; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> button = GetPressed(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (button == PressedMultiple || button == PressedNothing) { CurrentButton = button; counter = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (button == CurrentButton) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (counter &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (--counter == <span class="hljs-number"><span class="hljs-number">0</span></span>) { InvokeCommand(buttons[button]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { CurrentButton = button; counter = PressInterval / TickPeriod; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ HandleButtons(); delay(TickPeriod); }</code> </pre> </div></div><br><h3 id="hw6">  Hw6 </h3><br><p>  L'interface de communication doit √™tre claire pour l'exp√©diteur et le destinataire.  √âtant donn√© que l'interface s√©rie a une unit√© de transfert de donn√©es de 1 octet et dispose d'une synchronisation d'octets, il est peu logique de cl√¥turer quelque chose de compliqu√© et de nous limiter √† transmettre un octet par commande.  Pour faciliter le d√©bogage, nous transf√©rerons un caract√®re ASCII par commande. </p><br><h3 id="realizaciya-na-arduino">  Impl√©mentation Arduino </h3><br><p>  Maintenant, nous collectons.  Le code d'impl√©mentation complet est indiqu√© ci-dessous sous le spoiler.  Pour la d√©velopper, il suffit de sp√©cifier le code ASCII de la nouvelle commande et d'y attacher un bouton. <br>  Bien s√ªr, il serait possible simplement d'indiquer explicitement un code symbole pour chaque bouton, mais nous ne le ferons pas: la d√©nomination des commandes nous sera utile lors de l'impl√©mentation d'un client pour un PC. </p><br><div class="spoiler">  <b class="spoiler_title">Mise en ≈ìuvre compl√®te</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TickPeriod = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-comment"><span class="hljs-comment">//ms const int PressInterval = 100; //ms enum class Command : char { None = 0, Previous = 'P', Next = 'N', PauseResume = 'C', SuspendResumeCommands = '/', }; class Button { public: Button(uint8_t pin, Command command) : pin(pin), command(command) {} void Begin() { pinMode(pin, INPUT); digitalWrite(pin, 1); } bool IsPressed() { return !digitalRead(pin); } Command GetCommand() const { return command; } private: uint8_t pin; Command command; }; Button buttons[] = { Button(A0, Command::Previous), Button(A1, Command::PauseResume), Button(A2, Command::Next), Button(12, Command::SuspendResumeCommands), }; const byte ButtonsCount = sizeof(buttons) / sizeof(buttons[0]); void setup() { for (auto &amp;button : buttons) { button.Begin(); } Serial.begin(9600); } enum { PressedNothing = -1, PressedMultiple = -2, }; int GetPressed() { int index = PressedNothing; for (byte i = 0; i &lt; ButtonsCount; ++i) { if (buttons[i].IsPressed()) { if (index == PressedNothing) { index = i; } else { return PressedMultiple; } } } return index; } void InvokeCommand(const class Button&amp; button) { Serial.write((char)button.GetCommand()); } void HandleButtons() { static int CurrentButton = PressedNothing; static byte counter; int button = GetPressed(); if (button == PressedMultiple || button == PressedNothing) { CurrentButton = button; counter = -1; return; } if (button == CurrentButton) { if (counter &gt; 0) { if (--counter == 0) { InvokeCommand(buttons[button]); return; } } } else { CurrentButton = button; counter = PressInterval / TickPeriod; } } void loop() { HandleButtons(); delay(TickPeriod); }</span></span></code> </pre> </div></div><br><p>  Et oui, j'ai fait un autre bouton pour pouvoir suspendre le transfert des commandes au client. </p><br><h3 id="klient-dlya-pk">  Client pour PC </h3><br><p>  Nous passons √† la deuxi√®me partie. <br>  Comme nous n'avons pas besoin d'une interface complexe et d'une liaison √† Windows, nous pouvons aller de diff√©rentes mani√®res, comme vous le souhaitez: WinAPI, MFC, Delphi, .NET (Windows Forms, WPF, etc.), ou des consoles sur les m√™mes plates-formes ( bien, sauf pour MFC). </p><br><h3 id="sw1">  SW1 </h3><br><p>  Cette exigence est ferm√©e par la communication avec le port s√©rie sur la plate-forme logicielle s√©lectionn√©e: se connecter au port, lire les octets, traiter les octets. </p><br><h3 id="sw2">  SW2 </h3><br><p>  Peut-√™tre que tout le monde a vu des claviers avec des touches multim√©dias.  Chaque touche du clavier, y compris la touche multim√©dia, a son propre code.  La solution la plus simple √† notre probl√®me est de simuler les frappes de touches multim√©dias sur le clavier.  Les codes cl√©s se trouvent dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">source d'origine - MSDN</a> .  Reste √† savoir comment les envoyer au syst√®me.  Ce n'est pas non plus difficile: il existe une fonction SendInput dans WinAPI. <br>  Chaque frappe correspond √† deux √©v√©nements: appuyer et rel√¢cher. <br>  Si nous utilisons C / C ++, nous pouvons simplement inclure les fichiers d'en-t√™te.  Dans d'autres langues, le renvoi d'appel doit √™tre effectu√©.  Ainsi, par exemple, lors du d√©veloppement sur .NET, vous devrez importer la fonction sp√©cifi√©e et d√©crire les arguments.  J'ai choisi .NET pour la commodit√© de d√©velopper une interface. <br>  Je n'ai s√©lectionn√© dans le projet que la partie substantielle, qui se r√©sume √† une classe: les <code>Internals</code> . <br>  Voici son code: </p><br><div class="spoiler">  <b class="spoiler_title">Internes de code de classe</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Internals</span></span> { [StructLayout(LayoutKind.Sequential)] [DebuggerDisplay(<span class="hljs-string"><span class="hljs-string">"{Type} {Data}"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> INPUT { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Type; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KEYBDINPUT Data; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Keyboard = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Size = Marshal.SizeOf(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(INPUT)); } [StructLayout(LayoutKind.Sequential)] [DebuggerDisplay(<span class="hljs-string"><span class="hljs-string">"Vk={Vk} Scan={Scan} Flags={Flags} Time={Time} ExtraInfo={ExtraInfo}"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> KEYBDINPUT { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> Vk; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> Scan; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Flags; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Time; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IntPtr ExtraInfo; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> spare; } [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>, SetLastError = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">uint</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numberOfInputs, INPUT[] inputs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sizeOfInputStructure</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> INPUT[] inputs = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> INPUT { Type = INPUT.Keyboard, Data = { Flags = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">// Push } }, new INPUT { Type = INPUT.Keyboard, Data = { Flags = 2 // Release } } }; public static void SendKey(Keys key) { inputs[0].Data.Vk = (ushort) key; inputs[1].Data.Vk = (ushort) key; SendInput(2, inputs, INPUT.Size); } }</span></span></code> </pre> </div></div><br><p>  Tout d'abord, il d√©crit les structures de donn√©es (seul ce qui est li√© √† l'entr√©e au clavier est coup√©, car nous le <code>SendInput</code> ), et l'importation <code>SendInput</code> . <br>  Le champ de <code>inputs</code> est un tableau de deux √©l√©ments qui sera utilis√© pour g√©n√©rer des √©v√©nements de clavier.  Cela n'a aucun sens de l'allouer dynamiquement si l'architecture de l'application suppose que <code>SendKey</code> ne sera pas <code>SendKey</code> dans plusieurs threads. <br>  En fait, la question technique est plus loin: nous remplissons les champs de structure correspondants avec le code de cl√© virtuelle et l'envoyons √† la file d'attente d'entr√©e du syst√®me d'exploitation. </p><br><h3 id="sw3">  SW3 </h3><br><p>  L'exigence se termine tr√®s simplement.  Le drapeau est lev√© et une autre commande est trait√©e d'une mani√®re sp√©ciale: le drapeau passe √† l'√©tat logique oppos√©.  S'il est d√©fini, les autres commandes sont ignor√©es. </p><br><h2 id="vmesto-zaklyucheniya">  Au lieu d'une conclusion </h2><br><p>  L'am√©lioration peut se faire √† l'infini, mais c'est une autre histoire.  Je ne pr√©sente pas ici un projet client Windows, car il permet une grande envol√©e d'imagination. <br>  Pour contr√¥ler le lecteur multim√©dia, nous envoyons un ensemble de ¬´frappes¬ª de touches, si vous avez besoin de g√©rer des pr√©sentations, un autre.  Vous pouvez cr√©er des modules de contr√¥le, les assembler soit statiquement, soit sous forme de plug-ins.  En g√©n√©ral, beaucoup de choses sont possibles.  L'essentiel est le d√©sir. </p><br><p>  Merci de votre attention. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422203/">https://habr.com/ru/post/fr422203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422191/index.html">Comment j'ai cr√©√© une application de reconnaissance de texte Android rentable</a></li>
<li><a href="../fr422195/index.html">L'utilisation d'ACS dans les mines</a></li>
<li><a href="../fr422197/index.html">Nous disons un mot sur le relais</a></li>
<li><a href="../fr422199/index.html">Security Week 33: par qui le moniteur oscille-t-il?</a></li>
<li><a href="../fr422201/index.html">Chine, laissez-moi radier?</a></li>
<li><a href="../fr422205/index.html">Richard Hamming: Chapitre 13. Th√©orie de l'information</a></li>
<li><a href="../fr422207/index.html">Monstres apr√®s les vacances: AMD Threadripper 2990WX 32-Core et 2950X 16-Core (partie 4)</a></li>
<li><a href="../fr422209/index.html">Monstres apr√®s les vacances: AMD Threadripper 2990WX 32-Core et 2950X 16-Core (partie 5)</a></li>
<li><a href="../fr422211/index.html">Belle structure de composants dans le cloud Microsoft Azure</a></li>
<li><a href="../fr422213/index.html">Un jour sans JavaScript: qu'est-ce qui pourrait mal tourner?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>