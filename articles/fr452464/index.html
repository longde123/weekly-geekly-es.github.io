<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüëß‚Äçüëß üëéüèø ‚èØÔ∏è Si votre projet est "Th√©√¢tre", utilisez des acteurs üö∂üèº üìú üéº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a une histoire sur une exp√©rience d'utilisation du mod√®le d'acteur dans un projet int√©ressant de d√©veloppement d'un syst√®me de contr√¥le automatiq...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Si votre projet est "Th√©√¢tre", utilisez des acteurs</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452464/"><p>  Il y a une histoire sur une exp√©rience d'utilisation du mod√®le d'acteur dans un projet int√©ressant de d√©veloppement d'un syst√®me de contr√¥le automatique pour un th√©√¢tre.  Ci-dessous, je vais dire mes impressions, pas plus que cela. </p><a name="habracut"></a><br><p> Il n'y a pas si longtemps, j'ai particip√© √† une t√¢che passionnante: la modernisation du syst√®me de contr√¥le automatique (ACS) pour les palans √† latte, mais en fait, c'√©tait le d√©veloppement d'un nouvel ACS. </p><br><p>  Un th√©√¢tre moderne (surtout s'il est grand) est une organisation tr√®s complexe.  Il existe de nombreuses personnes, divers m√©canismes et syst√®mes.  Un de ces syst√®mes est ACS pour la manipulation de levage et de d√©pose du paysage.  Les performances modernes, comme les op√©ras et les ballets, utilisent d'ann√©e en ann√©e des moyens de plus en plus techniques.  Le d√©cor est activement utilis√© par les r√©alisateurs du spectacle et joue m√™me son propre r√¥le important.  C'√©tait fascinant de d√©couvrir ce qui se passe derri√®re les rideaux car les spectateurs ordinaires ne peuvent voir que des actions sur la sc√®ne. </p><br><p>  Mais ceci est un article technique, et je veux partager mon exp√©rience de l'utilisation du mod√®le d'acteur pour √©crire un syst√®me de contr√¥le.  Et partagez mes impressions sur l'utilisation de l'un des frameworks d'acteurs pour C ++: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SObjectizer</a> . </p><br><p>  Pourquoi avons-nous choisi ce cadre?  Nous le regardons depuis longtemps.  Il y a beaucoup d'articles en russe, et il a une documentation merveilleuse et beaucoup d'exemples.  Le projet ressemble √† un projet mature.  Un bref aper√ßu des exemples a montr√© que les d√©veloppeurs de SObjectizer utilisent les m√™mes termes (√©tats, temporisateurs, √©v√©nements, etc.) et nous ne nous attendions pas √† de gros probl√®mes pour l'√©tudier et l'utiliser.  Et encore un autre facteur important: l'√©quipe de SObjectizer est utile et toujours pr√™te √† nous aider.  Nous avons donc d√©cid√© d'essayer. </p><br><h1 id="what-were-doing">  On fait quoi? </h1><br><p>  Parlons de la cible de notre projet.  Le syst√®me de palans √† lattes comprend 62 lattes (tubes m√©talliques).  Chaque latte est aussi longue que toute la sc√®ne.  Ils sont suspendus sur des cordes en parall√®le avec des espaces de 30 √† 40 cm, √† partir du bord avant de la sc√®ne.  Chaque latte peut √™tre relev√©e ou abaiss√©e.  Certains d'entre eux sont utilis√©s dans un spectacle de d√©cors.  Le d√©cor est fix√© sur latte et est d√©plac√© vers le haut / bas pendant la repr√©sentation.  Les commandes des op√©rateurs d√©clenchent le mouvement.  Un syst√®me de "contrepoids corde-moteur" est similaire √† celui utilis√© dans les ascenseurs des b√¢timents r√©sidentiels.  Les moteurs sont plac√©s √† l'ext√©rieur de la sc√®ne, donc les spectateurs ne les voient pas.  Tous les moteurs sont divis√©s en 8 groupes, et chaque groupe dispose de 3 convertisseurs de fr√©quence (FC).  Au plus trois moteurs peuvent √™tre utilis√©s en m√™me temps dans un groupe, chacun d'eux est connect√© √† un FC s√©par√©.  Nous avons donc un syst√®me de 62 moteurs et 24 FC, et nous devons contr√¥ler ce syst√®me. </p><br><p>  Notre t√¢che √©tait de d√©velopper une interface homme-machine (IHM) pour contr√¥ler ce syst√®me et mettre en ≈ìuvre des algorithmes de contr√¥le.  Le syst√®me comprend trois stations de contr√¥le.  Deux d'entre eux sont plac√©s juste au-dessus de la sc√®ne, et un dans la salle des machines (ce poste est utilis√© par un √©lectricien de service).  Il y a aussi des blocs de contr√¥le avec des contr√¥leurs dans la salle des machines.  Ces contr√¥leurs ex√©cutent des commandes de contr√¥le, effectuent une modulation de largeur d'impulsion (PWM), allument ou √©teignent les moteurs, contr√¥lent la position des lattes.  Deux postes de commande au-dessus de la sc√®ne ont des √©crans, des unit√©s syst√®me et des boules de commande comme dispositifs de pointage.  Les stations de contr√¥le sont connect√©es via Ethernet.  Chaque poste de commande est connect√© √† des blocs de commande par canal RS485.  Les deux stations situ√©es au-dessus de la sc√®ne peuvent √™tre utilis√©es pour contr√¥ler le syst√®me en m√™me temps, mais une seule station peut √™tre active.  La station active est s√©lectionn√©e par un op√©rateur;  la deuxi√®me station sera passive;  la station passive a son canal RS485 d√©sactiv√©. </p><br><h1 id="why-actors">  Pourquoi les acteurs? </h1><br><p>  Du point de vue des algorithmes, le syst√®me est construit au-dessus des √©v√©nements.  Donn√©es des capteurs, actions de l'op√©rateur, expiration des temporisations ... Ce sont tous des exemples d'√©v√©nements.  Le mod√®le d'acteur fonctionne bien pour de tels algorithmes: les acteurs g√®rent les √©v√©nements entrants et forment des actions sortantes en fonction de leur √©tat actuel.  Ces m√©canismes sont disponibles dans SObjectizer juste √† la sortie de la bo√Æte. </p><br><p>  Les principes de base de ces syst√®mes sont les suivants: les acteurs interagissent via des messages asynchrones, les acteurs ont des √©tats et passent d'un √©tat √† un autre, seuls les messages significatifs pour l'√©tat actuel sont trait√©s. </p><br><p>  Il est int√©ressant de noter que les acteurs sont d√©coupl√©s des threads de travail dans SObjectizer.  Cela signifie que vous pouvez d'abord impl√©menter et d√©boguer vos acteurs et ensuite seulement d√©cider quel thread de travail sera utilis√© pour chaque acteur.  Il existe des "r√©partiteurs" qui impl√©mentent diverses strat√©gies li√©es aux threads.  Par exemple, il existe un r√©partiteur qui fournit un thread de travail distinct pour chaque acteur;  il existe un r√©partiteur de pool de threads qui fournit un pool de threads de travail de taille fixe;  il y a un r√©partiteur qui ex√©cute tous les acteurs sur le m√™me thread. </p><br><p>  La pr√©sence de r√©partiteurs offre un moyen tr√®s flexible de r√©gler un syst√®me d'acteurs pour nos besoins.  On peut regrouper certains acteurs pour travailler sur le m√™me contexte.  Nous pouvons changer le type de r√©partiteur par une seule ligne de code.  Les d√©veloppeurs de SObjectizer disent que l'√©criture d'un r√©partiteur personnalis√© n'est pas une t√¢che complexe.  Mais il n'√©tait pas n√©cessaire d'√©crire notre propre r√©partiteur dans ce projet;  tout ce dont nous avions besoin a √©t√© trouv√© dans SObjectizer. </p><br><p>  Encore une autre caract√©ristique int√©ressante est la coop√©ration des acteurs.  Une coop√©ration est un groupe d'acteurs qui peut exister si et seulement si tous les acteurs ont d√©marr√© avec succ√®s.  La coop√©ration ne peut pas d√©marrer si au moins l'un de ses acteurs n'a pas d√©marr√©.  Il semble qu'il y ait une analogie entre les coop√©rations de SObjectizer et les pods de Kubernetes, mais il semble √©galement que les coop√©rations de SObjectizer soient apparues plus t√¥t ... </p><br><p>  Lorsqu'un acteur est cr√©√©, il est ajout√© √† la coop√©ration (la coop√©ration peut contenir un seul acteur) et est li√© √† un r√©partiteur.  Il est facile de cr√©er dynamiquement des coop√©rations et des acteurs et les d√©veloppeurs de SObjectizer disent que c'est une op√©ration plut√¥t bon march√©. </p><br><p>  Tous les acteurs interagissent entre eux via des "bo√Ætes de message" (mbox).  C'est encore un autre concept int√©ressant et puissant de SObjectizer.  Il offre un moyen flexible de traitement des messages. </p><br><p>  Au d√©but, il peut y avoir plusieurs destinataires derri√®re une mbox.  C'est assez utile.  Par exemple, il peut y avoir une mbox utilis√©e par les capteurs pour publier de nouvelles donn√©es.  Les acteurs peuvent cr√©er des abonnements pour cette mbox, et les acteurs abonn√©s recevront les donn√©es qu'ils souhaitent.  Cela permet de travailler de mani√®re "Publier / S'abonner". </p><br><p>  Dans un second temps, les d√©veloppeurs de SObjectizer ont envisag√© la possibilit√© de cr√©er une mbox personnalis√©e.  Il est relativement facile de cr√©er une mbox personnalis√©e avec un traitement sp√©cial des messages entrants (comme le filtrage ou la r√©partition entre plusieurs abonn√©s en fonction du contenu du message). </p><br><p>  Il existe √©galement une mbox personnelle pour chaque acteur et les acteurs peuvent transmettre une r√©f√©rence √† cette mbox dans les messages aux autres acteurs (qui permet de r√©pondre directement √† un acteur sp√©cifique). </p><br><p>  Dans notre projet, nous avons divis√© tous les objets contr√¥l√©s en huit groupes (un groupe pour chaque bo√Ætier de commande).  Trois threads de travail ont √©t√© cr√©√©s pour chaque groupe (c'est parce que seuls trois moteurs peuvent fonctionner en m√™me temps).  Cela nous a permis d'avoir une ind√©pendance entre les groupes de moteurs.  Il a √©galement permis de travailler de mani√®re asynchrone avec les moteurs de chaque groupe. </p><br><p>  Il est n√©cessaire de mentionner que SObjectizer-5 ne dispose d'aucun m√©canisme d'interaction interprocessus et / et r√©seau.  Il s'agit d'une d√©cision consciente des d√©veloppeurs de SObjectizer;  ils voulaient rendre SObjectizer aussi l√©ger que possible.  De plus, la prise en charge transparente de la mise en r√©seau existait dans certaines versions pr√©c√©dentes de SObjectizer mais a √©t√© supprim√©e.  Cela ne nous a pas d√©rang√©s car un m√©canisme de mise en r√©seau d√©pend fortement d'une t√¢che, des protocoles utilis√©s et d'autres conditions.  Il n'y a pas de solution universelle unique pour tous les cas. </p><br><p>  Dans notre cas, nous avons utilis√© notre ancienne biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libuniset2</a> pour les communications r√©seau et interprocessus.  En cons√©quence, libuniset2 prend en charge les communications avec les capteurs et les blocs de contr√¥le, et SObjectizer prend en charge les acteurs et les interactions entre les acteurs au sein d'un m√™me processus. </p><br><p>  Comme je l'ai dit plus t√¥t, il y a 62 moteurs.  Chaque moteur peut √™tre connect√© √† un FC (convertisseur de fr√©quence);  une coordonn√©e de destination peut √™tre sp√©cifi√©e pour la latte correspondante;  la vitesse de d√©placement de la latte peut √©galement √™tre sp√©cifi√©e.  Et en plus de cela, chaque moteur a les √©tats suivants: </p><br><ul><li>  pr√™t √† travailler; </li><li>  connect√©; </li><li>  travailler; </li><li>  dysfonctionnement; </li><li>  connexion (un √©tat de transition); </li><li>  d√©connexion (un √©tat de transition); </li></ul><br><p> Chaque moteur est repr√©sent√© dans le syst√®me par un acteur qui impl√©mente la transition entre les √©tats, g√®re les donn√©es des capteurs et √©met des commandes.  Il n'est pas difficile de cr√©er un acteur dans SObjectizer: h√©ritez simplement votre classe du type <code>so_5::agent_t</code> .  Le premier argument du constructeur de l'acteur doit √™tre de type <code>context_t</code> , tous les autres arguments peuvent √™tre d√©finis comme le souhaite un d√©veloppeur. </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Drive_A</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Drive_A( <span class="hljs-keyword"><span class="hljs-keyword">context_t</span></span> ctx, ... ); ... }</code> </pre> <br><p>  Je ne montrerai pas la description d√©taill√©e des classes et des m√©thodes car ce n'est pas un tutoriel.  Je veux juste montrer √† quel point tout cela peut √™tre fait facilement dans SObjectizer (en quelques lignes litt√©ralement).  Permettez-moi de vous rappeler que SObjectizer poss√®de une excellente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> et de nombreux exemples. </p><br><h1 id="what-is-the-state-of-an-actor-what-are-we-talking-about">  Quel est "l'√©tat" d'un acteur?  De quoi parle-t-on? </h1><br><p>  L'utilisation des √©tats et la transition entre eux est un ¬´sujet natif¬ª pour les syst√®mes de contr√¥le.  Ce concept est tr√®s bon pour la gestion d'√©v√©nements.  Ce concept est pris en charge dans SObjectizer au niveau de l'API.  Les √©tats sont d√©clar√©s dans la classe de l'acteur: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Drive_A</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Drive_A( <span class="hljs-keyword"><span class="hljs-keyword">context_t</span></span> ctx, ... ); <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Drive_A(); <span class="hljs-comment"><span class="hljs-comment">//  state_t st_base {this}; state_t st_disabled{ initial_substate_of{st_base}, "disabled" }; state_t st_preinit{ substate_of{st_base}, "preinit" }; state_t st_off{ substate_of{st_base}, "off" }; state_t st_connecting{ substate_of{st_base}, "connecting" }; state_t st_disconnecting{ substate_of{st_base}, "disconnecting" }; state_t st_connected{ substate_of{st_base}, "connected" }; ... }</span></span></code> </pre> <br><p>  puis les gestionnaires d'√©v√©nements sont d√©finis pour chaque √©tat.  Parfois, il est n√©cessaire de faire quelque chose √† l'entr√©e ou √† la sortie d'un √âtat.  Ceci est √©galement pris en charge dans SObjectizer via les gestionnaires on_enter / on_exit.  Il semble que les d√©veloppeurs de SObjectizer aient une exp√©rience dans le d√©veloppement de syst√®mes de contr√¥le. </p><br><h1 id="event-handlers">  Gestionnaires d'√©v√©nements </h1><br><p>  Un gestionnaire d'√©v√©nements est un endroit o√π votre logique d'application est impl√©ment√©e.  Comme je l'ai dit plus t√¥t, un abonnement est cr√©√© pour une mbox particuli√®re et un √©tat sp√©cifique.  Si un acteur n'a pas d'√©tats explicitement sp√©cifi√©s, il se trouve dans un "√©tat_par d√©faut" sp√©cial. </p><br><p>  Diff√©rents gestionnaires peuvent √™tre d√©finis pour le m√™me √©v√©nement dans diff√©rents √©tats.  Si vous ne d√©finissez pas de gestionnaire pour un √©v√©nement, cet √©v√©nement sera ignor√© (un acteur ne le saura pas). </p><br><p>  Il existe une syntaxe simple pour d√©finir les gestionnaires d'√©v√©nements.  Vous sp√©cifiez une m√©thode et il n'est pas n√©cessaire de sp√©cifier des types ou des param√®tres de mod√®le suppl√©mentaires.  Par exemple: </p><br><pre> <code class="cpp hljs">so_subscribe(drv-&gt;so_mbox()) .in(st_base) .event( &amp;Drive_A::on_get_info ) .event( &amp;Drive_A::on_control ) .event( &amp;Drive_A::off_control );</code> </pre> <br><p>  C'est un exemple d'abonnement aux √©v√©nements d'une mbox sp√©cifique dans l'√©tat st_base.  Il convient de mentionner que st_base est un √©tat de base pour certains autres √©tats et que l'abonnement sera h√©rit√© par les √©tats d√©riv√©s.  Cette approche permet de se d√©barrasser du copier-coller pour des gestionnaires d'√©v√©nements similaires dans diff√©rents √©tats.  Mais le gestionnaire d'√©v√©nements h√©rit√© peut √™tre red√©fini pour un √©tat particulier ou un √©v√©nement peut √™tre compl√®tement d√©sactiv√© ("supprim√©"). </p><br><p>  Une autre fa√ßon de d√©finir les gestionnaires d'√©v√©nements consiste √† utiliser les fonctions lambda.  C'est un moyen tr√®s pratique car les gestionnaires d'√©v√©nements contiennent souvent juste une ou deux lignes de code: un envoi de quelque chose quelque part ou un changement d'√©tat: </p><br><pre> <code class="cpp hljs">so_subscribe(drv-&gt;so_mbox()) .in(st_disconnecting) .event([<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">msg_disconnected_t</span></span>&amp; m) { ... st_off.activate(); }) .event([<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>]( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">msg_failure_t</span></span>&amp; m ) { ... st_protection.activate(); });</code> </pre> <br><p>  Cette syntaxe semble complexe au d√©but, mais elle devient famili√®re juste apr√®s quelques jours de codage actif et vous commencez m√™me √† l'aimer.  C'est parce que toute la logique d'un acteur peut √™tre concise et plac√©e sur un seul √©cran.  Dans l'exemple illustr√© ci-dessus, il existe des transitions de st_disconnected √† st_off ou st_protection.  Ce code est facile √† lire. </p><br><p>  BTW, pour les cas simples, o√π une simple transition d'√©tat est n√©cessaire, il existe une syntaxe sp√©ciale: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> mbox = drv-&gt;so_mbox(); st_off .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_connected_t</span></span>&gt;(mbox, st_connected) .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_failure_t</span></span>&gt;(mbox, st_protection) .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_on_limit_t</span></span>&gt;(mbox, st_protection) .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_on_t</span></span>&gt;(mbox, st_on);</code> </pre> <br><h1 id="the-control">  Le contr√¥le </h1><br><p>  Comment le contr√¥le est-il organis√©?  Comme mentionn√© ci-dessus, il existe deux postes de contr√¥le pour contr√¥ler le mouvement des lattes.  Chaque station de contr√¥le a un √©cran, un dispositif de pointage (trackball) et un r√©gleur de vitesse (et nous ne comptons pas un ordinateur √† l'int√©rieur de la station et quelques accessoires suppl√©mentaires). </p><br><p>  Il existe deux modes de contr√¥le: manuel et "mode sc√©nario".  Le "mode sc√©nario" sera discut√© plus tard, et maintenant parlons du mode manuel.  Dans ce mode, un op√©rateur s√©lectionne une latte, la pr√©pare pour le mouvement (connecte le moteur √† un FC), d√©finit la marque cible pour la latte, et lorsque la vitesse est r√©gl√©e au-dessus de z√©ro, la latte commence √† se d√©placer. </p><br><p>  Le r√©gulateur de vitesse est un accessoire physique sous la forme d'un "potentiom√®tre avec poign√©e", mais il en existe √©galement un virtuel sur l'√©cran de la station.  Plus il est tourn√©, plus la vitesse de d√©placement est √©lev√©e.  La vitesse maximale est limit√©e √† 1,5 m√®tre par seconde.  Le r√©gleur de vitesse est un pour tous les lattes.  Cela signifie que tous les liteaux s√©lectionn√©s se d√©placent √† la m√™me vitesse.  Les lattes peuvent se d√©placer dans des directions oppos√©es (cela d√©pend de la s√©lection de l'op√©rateur).  Il est √©vident qu'il est difficile pour un humain de contr√¥ler plus de quelques lattes.  De ce fait, seuls de petits groupes de lattes sont trait√©s en mode manuel.  Les op√©rateurs peuvent contr√¥ler les lattes √† partir de deux postes de contr√¥le en m√™me temps.  Il y a donc un r√©gleur de vitesse s√©par√© pour chaque station. </p><br><p>  Du point de vue de l'impl√©mentation, il n'y a pas de logique sp√©cifique en mode manuel.  Une commande "connecter le moteur" va de l'interface graphique, est transform√©e en un message correspondant √† un acteur, puis est g√©r√©e par cet acteur.  L'acteur passe de l'√©tat "d√©sactiv√©" √† "se connecter", puis √† l'√©tat "connect√©".  Des choses similaires se produisent avec les commandes de positionnement d'une latte et de r√©glage de la vitesse de d√©placement.  Toutes ces commandes sont transmises √† un acteur sous forme de messages.  Mais il convient de mentionner que "interface graphique" et "processus de contr√¥le" sont des processus distincts et libuniset2 est utilis√© pour IPC. </p><br><h1 id="the-scenario-mode-are-there-actors-again">  Le mode sc√©nario (y a-t-il encore des acteurs?) </h1><br><p>  En pratique, le mode manuel n'est utilis√© que pour les cas tr√®s simples ou lors des r√©p√©titions.  Le mode de contr√¥le principal est le "mode sc√©nario".  Dans ce mode, chaque latte est d√©plac√©e vers une position sp√©cifique avec une vitesse particuli√®re en fonction des param√®tres du sc√©nario.  Un op√©rateur dispose de deux commandes simples dans ce mode: </p><br><ul><li>  pr√©parer (un groupe de moteurs est connect√© au FC); </li><li>  allez (le mouvement du groupe commence). </li></ul><br><p>  L'ensemble du sc√©nario est divis√© en "agendas".  Un ¬´agenda¬ª d√©crit un seul mouvement d'un groupe de lattes.  Cela signifie qu'un "agenda" comprend des lattes et contient des destinations cibles et des vitesses pour elles.  En r√©alit√©, un sc√©nario se compose d'actes, les actes se composent d'images, l'image se compose d'agendas et l'agenda se compose de cibles pour les lattes.  Mais du point de vue du contr√¥le, cela n'a pas d'importance, car seuls les agendas contiennent les param√®tres pr√©cis du mouvement de la latte. </p><br><p>  Le mod√®le Actor s'adapte parfaitement √† ce cas.  Nous avons d√©velopp√© un "joueur de sc√©nario" qui cr√©e un groupe d'acteurs sp√©ciaux et les d√©marre.  Nous avons d√©velopp√© deux types d'acteurs: les acteurs ex√©cuteurs (ils contr√¥lent le mouvement des lattes) et les acteurs coordinateurs (ils r√©partissent les t√¢ches entre ex√©cuteurs).  Les ex√©cuteurs sont cr√©√©s √† la demande: lorsqu'il n'y a pas d'ex√©cuteurs libres, un nouvel ex√©cuteur sera cr√©√©.  Le coordinateur g√®re le pool d'ex√©cuteurs disponibles.  Par cons√©quent, le contr√¥le ressemble approximativement √† ceci: </p><br><ul><li>  un op√©rateur charge un sc√©nario; </li><li>  le "fait d√©filer" jusqu'√† l'agenda requis; </li><li>  appuie sur le bouton "pr√©parer" au moment appropri√©.  √Ä ce moment, un message est envoy√© √† un coordinateur.  Ce message contient des donn√©es pour chaque latte de l'agenda; </li><li>  le coordinateur examine son pool d'ex√©cuteurs et r√©partit les t√¢ches entre les ex√©cuteurs libres (de nouveaux ex√©cuteurs sont cr√©√©s, si n√©cessaire); </li><li>  chaque ex√©cuteur re√ßoit une t√¢che et effectue des actions de pr√©paration (connecte un moteur √† un FC, puis attend la commande "go"); </li><li>  l'op√©rateur appuie sur le bouton "go" au moment appropri√©; </li><li>  la commande "go" va au coordinateur, et elle distribue la commande entre tous les ex√©cuteurs en cours d'utilisation. </li></ul><br><p>  Il y a quelques param√®tres suppl√©mentaires dans les agendas.  Comme "d√©marrer le mouvement uniquement apr√®s un d√©lai de N secondes" ou "d√©marrer le mouvement uniquement apr√®s une commande suppl√©mentaire d'un op√©rateur".  Pour cette raison, la liste des √©tats d'un ex√©cuteur est assez longue: "pr√™t pour la prochaine commande", "pr√™t pour le mouvement", "retard du mouvement", "en attente de la commande de l'op√©rateur", "en mouvement", "termin√©", "√©chec". </p><br><p>  Lorsqu'une latte a r√©ussi √† atteindre la marque cible (ou en cas d'√©chec), l'ex√©cuteur signale au coordinateur la fin de la t√¢che.  Le coordinateur r√©pond par une commande d'arr√™t du moteur (si la latte ne participe plus √† l'agenda) ou envoie une nouvelle t√¢che √† l'ex√©cuteur testamentaire.  L'ex√©cuteur √©teint le moteur et passe √† l'√©tat "en attente" ou commence √† traiter la nouvelle commande. </p><br><p>  Parce que SObjectizer a une API assez r√©fl√©chie et pratique pour travailler avec les √©tats, le code d'impl√©mentation s'est av√©r√© assez concis.  Par exemple, un d√©lai avant le mouvement est d√©crit par une simple ligne de code: </p><br><pre> <code class="cpp hljs">st_delay.time_limit( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::chrono::milliseconds{target-&gt;delay()}, st_moving ); st_delay.activate(); ...</code> </pre> <br><p>  La m√©thode <code>time_limit</code> sp√©cifie la dur√©e de s√©jour dans l'√©tat et quel √©tat doit √™tre activ√© ensuite ( <code>st_moving</code> dans cet exemple). </p><br><h1 id="protection-actors">  Acteurs de la protection </h1><br><p>  Certes, des √©checs peuvent survenir.  Il existe des exigences pour g√©rer correctement ces √©checs.  Les acteurs sont √©galement utilis√©s pour de telles t√¢ches.  Regardons quelques exemples: </p><br><ul><li>  protection contre les surintensit√©s; </li><li>  protection contre le dysfonctionnement du capteur; </li><li>  protection contre les mouvements dans la direction oppos√©e (cela peut arriver s'il y a un probl√®me avec les capteurs ou les actionneurs); </li><li>  protection contre les mouvements spontan√©s (sans ordre); </li><li>  contr√¥le de l'ex√©cution de la commande (le mouvement d'une latte doit √™tre v√©rifi√©). </li></ul><br><p>  Nous pouvons voir que tous ces cas sont autosuffisants, mais ils devraient √™tre contr√¥l√©s ensemble, en m√™me temps.  Cela signifie que tout √©chec peut se produire.  Mais chaque v√©rification a sa logique: parfois il faut v√©rifier un timeout, parfois il faut analyser certaines valeurs pr√©c√©dentes d'un capteur.  Pour cette raison, la protection est mise en ≈ìuvre sous la forme de petits acteurs.  Ces acteurs s'ajoutent √† la coop√©ration de l'acteur principal qui met en ≈ìuvre la logique de contr√¥le.  Cette approche permet d'ajouter facilement de nouveaux cas de protection: il suffit d'ajouter un autre acteur protecteur √† la coop√©ration.  Le code d'un tel acteur est g√©n√©ralement concis et facile √† comprendre, car il ne met en ≈ìuvre qu'une seule fonction. </p><br><p>  Les acteurs protecteurs ont √©galement plusieurs √âtats.  Habituellement, ils sont allum√©s quand un moteur est allum√© ou quand une latte commence son mouvement.  Lorsqu'un protecteur d√©tecte une panne / un dysfonctionnement, il publie une notification (avec le code de protection et quelques d√©tails suppl√©mentaires √† l'int√©rieur).  L'acteur principal r√©agit √† cette notification et effectue les actions n√©cessaires (comme √©teindre le moteur et passer √† l'√©tat prot√©g√©). </p><br><h1 id="as-the-conclusion">  Comme conclusion ... </h1><br><p>  ... cet article n'est pas une perc√©e bien s√ªr.  Le mod√®le d'acteur est utilis√© dans plusieurs syst√®mes diff√©rents depuis assez longtemps.  Mais c'√©tait ma premi√®re exp√©rience d'utilisation du mod√®le d'acteur pour construire un syst√®me de contr√¥le automatique dans un projet assez petit.  Et cette exp√©rience s'est av√©r√©e tr√®s r√©ussie.  J'esp√®re avoir montr√© que les acteurs sont bien adapt√©s aux algorithmes de contr√¥le: il y a des places pour les acteurs litt√©ralement partout. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nous</a> avions impl√©ment√© quelque chose de similaire dans les projets pr√©c√©dents (je veux dire les √©tats, l'√©change de messages, la gestion des threads de travail, etc.), mais ce n'√©tait pas une approche unifi√©e.  En utilisant SObjectizer, nous avons obtenu un petit outil l√©ger qui r√©sout beaucoup de probl√®mes.  Nous n'avons plus besoin (explicitement) d'utiliser des m√©canismes de synchronisation de bas niveau (comme les mutex), il n'y a pas de gestion manuelle des threads, plus de statecharts manuscrits.  Tout cela est fourni par le cadre, connect√© de mani√®re logique et exprim√© sous la forme d'une API pratique, mais vous ne perdez pas le contr√¥le des d√©tails.  Ce fut donc une exp√©rience passionnante.  Si vous avez encore des doutes, je vous recommande de jeter un ≈ìil au mod√®le d'acteur et au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SObjectizer</a> en particulier.  Cela laisse des √©motions positives. </p><br><p>  Le mod√®le d'acteur fonctionne vraiment!  Surtout au th√©√¢tre. </p><br><p>  Article original en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">russe</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452464/">https://habr.com/ru/post/fr452464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452454/index.html">Connexion √† Azure DevOps √† l'aide de vos informations d'identification GitHub</a></li>
<li><a href="../fr452456/index.html">Microsoft Kaizala permet √† Indian Railways de connecter ses trois millions d'employ√©s aux services de sant√©</a></li>
<li><a href="../fr452458/index.html">Watch Dogs dans la vraie vie, ou de graves vuln√©rabilit√©s dans ACS</a></li>
<li><a href="../fr452460/index.html">Pr√©sentation de Windows Terminal</a></li>
<li><a href="../fr452462/index.html">√Ä propos de la POO</a></li>
<li><a href="../fr452466/index.html">Clavier braille</a></li>
<li><a href="../fr452468/index.html">"Si vous devez tuer quelqu'un, alors vous √™tes venu √† l'adresse"</a></li>
<li><a href="../fr452474/index.html">Analyse des ondelettes. 2e partie</a></li>
<li><a href="../fr452478/index.html">Cr√©ation de tableaux dans le syst√®me de conception Figma et impl√©mentation dans le Storybook (React)</a></li>
<li><a href="../fr452480/index.html">Phoenix LiveView: lorsque vous n'avez plus besoin de JavaScript *</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>