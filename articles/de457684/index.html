<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëâüèΩ üëêüèª üë®‚Äçüë©‚Äçüëß‚Äçüëß Erfahrung in der Integration von Atol Cash Desk in den eigenen CRM-Handel üë©‚Äçüé® üíü üë¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor kurzem an der Online-Abendkasse, wilde Aufregung, am 1. Juli 2019, endet die letzte Verschiebung, also musste ich mich mit diesem Problem befassen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erfahrung in der Integration von Atol Cash Desk in den eigenen CRM-Handel</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457684/">  Vor kurzem an der Online-Abendkasse, wilde Aufregung, am 1. Juli 2019, endet die letzte Verschiebung, also musste ich mich mit diesem Problem befassen.  Diejenigen, die 1C oder ein anderes System haben, k√∂nnen sich nicht anstrengen, aber wenn Sie Ihr eigenes selbstgeschriebenes System haben, f√§llt Ihnen auch die Integration in Online-Registrierkassen auf die Schultern. <br><br>  Meine Erfahrung ist n√ºtzlich f√ºr die Integration mit Atol-Kassen im Netzwerkdatenaustauschmodus. Ihr Programm kann Daten sowohl auf dem lokalen Host als auch im lokalen Netzwerk an den Atol-Webserver senden. Sie k√∂nnen sie sogar √ºber den AJAX-Browser senden, sogar vom Server √ºber CURL. Unabh√§ngig davon, in welcher Sprache Ihre Unternehmenssoftware geschrieben ist, ist alles plattform√ºbergreifend. <br><a name="habracut"></a><br>  Ich bin auf das Atol 30f-Ticketb√ºro gesto√üen - es ist eine so einfache Schreibmaschine mit einer Black Box (FN), dass es genau richtig ist, wenn die gesamte Bestelllogik auf externer Software und nicht auf der in der Kasse integrierten Software basiert.  Dar√ºber hinaus sind Ger√§te dieses Typs im Vergleich zu Android-Gegenst√ºcken relativ kosteng√ºnstig. <br><br>  Ich m√∂chte auch darauf hinweisen, dass die ‚ÄûSpezialisten‚Äú einiger am Support beteiligter Unternehmen √ºberhaupt nicht wissen, dass Atoll mit Version 10 einen integrierten Webserver im Treiber hat, der JSON-Jobs akzeptiert. Dar√ºber hinaus kann dieser Treiber auch unter Linux installiert werden Aufgrund der Anzahl der vorgefertigten L√∂sungen f√ºr die Himbeeren kann ich davon ausgehen, dass sie auch dort installiert werden k√∂nnen, bei der Verteilung der 10. Version des Treibers ist der Installer f√ºr Arm vorhanden. <br><br>  Das geplante Schema sieht ungef√§hr so ‚Äã‚Äãaus: Es gibt CRM, das auf dem Server im lokalen Netzwerk ausgef√ºhrt wird, es wird √ºber Browser ge√∂ffnet, von der Serverseite werden Schecks √ºber Curl an PHP gesendet und an der Registrierkasse gedruckt.  Die Kasse selbst ist mit jedem Computer unter Windows im selben Netzwerk verbunden. <br><br>  Sie sagen, wenn Sie den Kassierer nicht aktivieren, kann er im Druckermodus arbeiten und drucken, dass der Scheck ung√ºltig ist, aber ich konnte ihn nicht √ºberpr√ºfen. Ich musste Penny Sales und Retouren durchf√ºhren. <br><br>  Der Treiber der zehnten Version wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> heruntergeladen. <br><br>  Vor der Installation m√ºssen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java mit</a> der gleichen Bittiefe wie der Treiber installieren. Andernfalls ist der Kontrollk√§stchen-Webserver nicht verf√ºgbar. Wenn Sie den 64-Bit-KKT-Treiber installieren, dann Java x64. <br><br>  Es scheint, dass Sie logischerweise einen 64-Bit-Treiber auf einem 64-Bit-System installieren m√ºssen, aber einige 32-Bit-Software kann nicht damit arbeiten (dies gilt f√ºr 1C, wenn es 32-Bit ist). <br><br><img src="https://habrastorage.org/webt/nf/fn/uk/nffnukvhkzk3za8vpcrn567wygi.png"><br><br>  Am Ende der Installation befindet sich ein H√§kchen. Um den Webserver zu konfigurieren, m√ºssen Sie, wenn er nicht installiert wurde, unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">127.0.0.1</a> : 16732 / settings zum Browser wechseln, das Kontrollk√§stchen "Server aktivieren" aktivieren und speichern. <br><br><img src="https://habrastorage.org/webt/gv/fm/9l/gvfm9lfbrzxyntshlyhn7fmx-pc.png"><br><br><img src="https://habrastorage.org/webt/dy/so/pq/dysopqgomkepetfvn-de5vgdj3q.png"><br><br>  Danach m√ºssen Sie den Server √ºber START-&gt; ATOL-&gt; Neustart neu starten ... <br><br>  Ich m√∂chte Sie auch sofort warnen, dass lokale Anwendungen beim Starten des Webservers nicht auf die CCP zugreifen k√∂nnen. Ich arbeite lange, installiere den Treiber, f√ºhre den Cct-Treiber-Test aus und er teilt mir mit, dass der Port belegt ist und das war es. Ich habe dort den technischen Support des lokalen Verk√§ufers angerufen Sie sagten, wir wissen nicht, was wir tun sollen, dann habe ich den Computer zehnmal √ºberlastet, den Treiber neu installiert, nichts hilft. <br><br>  Nachdem Sie den Server aktiviert und neu gestartet haben und zuvor den Server ausgeschaltet und das Drucken von Klartext √ºber das mitgelieferte Dienstprogramm √ºberpr√ºft oder nur die Verbindung √ºberpr√ºft haben, k√∂nnen Sie im Allgemeinen fortfahren. <br><br>  Dieser Webdienst verf√ºgt √ºber keinen Kennwortschutz. Daher m√ºssen Sie die Windows-Firewall oder andere Software sofort so konfigurieren, dass nur die erforderlichen Computer auf Port 16732 zugreifen k√∂nnen. In meiner Situation ist dies der Server, auf dem CRM ausgef√ºhrt wird. <br><br>  <b>Die Kommunikation mit dem Webdienst ist in der Regel ein eigenst√§ndiges Thema, sehr interessant ...</b> <br><br><ol><li>  Generieren Sie eine eindeutige UUID f√ºr den Job </li><li>  Wir senden die Aufgabe mit der POST-Methode </li><li>  Wir st√ºrzen beim Webdienst ab und warten mit unserer UUID auf das Ergebnis der Aufgabe. Es kann sein, dass unsere Aufgabe einige Sekunden lang einen Wartestatus hat oder ein Fehler auftritt, wenn in der Anforderung etwas nicht stimmt ... </li></ol><br>  Und dann gebe ich eine funktionierende Version. Sie eignet sich f√ºr Situationen, in denen die Zahlung nur eine Methode ist und nicht so sehr in bar und teilweise bargeldlos. Au√üerdem wird das Standardsteuersystem verwendet. Die Mehrwertsteuer wird noch nicht berechnet. Ich wollte den Code hinzuf√ºgen und dann verteilen Ich denke, es gibt immer noch Leute, die diese Informationen vor dem 1. Juli brauchen als danach.  Ich muss sofort sagen, dass die Klasse verfeinert werden muss, viel roh, keine Fehlerbehandlung, alles wurde in ein paar Stunden erledigt, ohne das Lesen der Dokumentation zu ber√ºcksichtigen. Dieser Code ist eher ein Beispiel und ich rate Ihnen, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> detailliert zu studieren und an Ihre spezifischen Prozesse anzupassen. <br><br><div class="spoiler">  <b class="spoiler_title">PHP-Code f√ºr ein Beispiel f√ºr die Arbeit mit API (nur f√ºr Bildungszwecke verwendet)</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">Class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AtolWebDriver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $addr=<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>,$port=<span class="hljs-string"><span class="hljs-string">"16732"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $timeout = <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  public $operator; function __construct($addr=false,$port=false) { if ($addr!==false) $this-&gt;addr=$addr; if ($port!==false) $this-&gt;port=$port; } public function CallAPI($method, $data,$_url="/requests") { $url = "http://".$this-&gt;addr.":".$this-&gt;port.$_url; $curl = curl_init($url); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); curl_setopt($curl,CURLOPT_TIMEOUT, $this-&gt;timeout); $headers = ['Content-Type: application/json']; curl_setopt($curl,CURLOPT_HTTPHEADER, $headers); curl_setopt($curl, CURLOPT_CUSTOMREQUEST, $method); curl_setopt($curl, CURLOPT_POSTFIELDS, json_encode($data)); $resp = curl_exec($curl); $data = json_decode($resp,1); $code = curl_getinfo($curl, CURLINFO_HTTP_CODE); curl_close($curl); $res= [$data,$code,$resp]; print_r($res); return $res; } //   public function get_res($uuid) { $ready = false; $cnt=0; $res_url = '/requests/'.$uuid; while (!$ready &amp;&amp; ++$cnt&lt;60) { usleep(500000); // ,     list($res,$code,$resp) = $this-&gt;CallAPI('GET',[],$res_url); $ready = ($res['results'][0]['status'] == 'ready'); if ($ready) return $res; } return false; //    } //  public function add_req($uuid,$req) { return $this-&gt;CallAPI('POST', ['uuid'=&gt;$uuid,'request'=&gt;$req]); } //  id   public function gen_uuid() { return exec('uuidgen -r'); } //      public function atol_task($type,$req=[]) { $req['type'] = $type; $uuid = $this-&gt;gen_uuid(); $req = $this-&gt;add_req($uuid,$req); if ($req[1]!='201') return false; //  $res = $this-&gt;get_res($uuid); //  if ($res===false || !isset($res['results'][0])) return false; return $res['results'][0]; } /*    */ //  public function get_shift_status() { $res = $this-&gt;atol_task('getShiftStatus'); if ($res===false) return false; //closed / opened / expired return $res['result']['shiftStatus']['state']; } //  public function open_shift() { $status = $this-&gt;get_shift_status(); //e ,    if ($status=="expired") $this-&gt;close_shift(); if ($status=="opened") return "    "; $res = $this-&gt;atol_task('openShift',['operator'=&gt;$this-&gt;operator]); } //  public function close_shift() { $status = $this-&gt;get_shift_status(); if ($status=="closed") return "    "; $res = $this-&gt;atol_task('closeShift',['operator'=&gt;$this-&gt;operator]); } public function items_prepare($items) { $res_items = []; $summ = 0; while ($item = array_shift($items)) { $res_item = $item; if (!isset($item['type'])) $res_item['type']="position"; if (isset($item['price']) &amp;&amp; isset($item['quantity'])) { $res_item['amount'] = $item['price']*$item['quantity']; $res_item['tax'] = ['type'=&gt;'none']; $summ+=$res_item['amount']; } $res_items[] = $res_item; } return [$res_items,$summ]; } // sell,  sellReturn public function fiskal($type_op="sell",$items,$pay_type="cash") { $data = []; $data['operator'] = $this-&gt;operator; $data['payments'] = []; list($data['items'],$summ) = $this-&gt;items_prepare($items); //+++       $data['payments'][] = ['type'=&gt;$pay_type,'sum'=&gt;$summ]; $res = $this-&gt;atol_task($type_op,$data); } } //  ip   web-  ,      $atol = new AtolWebDriver('192.168.100.10'); //    $atol-&gt;operator = ['name'=&gt;'.']; //       $items = []; $items[] = ['name'=&gt;' ','price'=&gt;0.7,'quantity'=&gt;1]; $items[] = ['name'=&gt;' ','price'=&gt;0.4,'quantity'=&gt;1]; //  $atol-&gt;open_shift(); //  $atol-&gt;fiskal("sell",$items); sleep(10); // ,     //     , ..    $atol-&gt;fiskal("sellReturn",$items); //     sleep(20); // ,   $atol-&gt;close_shift();</span></span></code> </pre> <br></div></div><br>  Hier gibt es einige Fehler, die ich beheben werde <br><br><ol><li>  Rundungsbr√ºche bei der Berechnung der Betr√§ge m√ºssen auf Cent gerundet werden, andernfalls erhalten Sie 1.000000001 oder 0.999999999 </li><li>  Bei korrekter Schreibweise der restlichen Programmlogik tritt dies normalerweise nicht auf, aber w√§hrend der Tests stellte ich fest, dass die Aufgabe ein Fehlerergebnis zur√ºckgab und ich darauf wartete, dass sie fertig war </li></ol><br>  Nun, w√§hrend des Implementierungsprozesses habe ich Angst, viele weitere Fehler zu erkennen. Wenn beispielsweise eine Aufgabe l√§ngere Zeit im Wartestatus h√§ngt, ist es besser, sie aus der Warteschlange zu entfernen. Andernfalls h√§ngen die nachfolgenden Aufgaben einige Minuten lang. Ich habe einmal einen solchen Fehler festgestellt. Ich hatte nicht gehofft, dass sie gedruckt wird und hier sitze ich, aber es h√ºpft und druckt sofort zwei Schecks hintereinander, die fr√ºher gesendet wurden ... <br><br>  Im Allgemeinen ist es m√∂glich, in Zukunft Akquisitionen von der Website zu sammeln, wenn keine Online-Schecks vorhanden sind, bis Sie sich f√ºr eine Akquisition entschieden haben.  Aber die L√∂sung ist, eher als Idee f√ºr eine L√∂sung, die Zeit wird zeigen, wie diese Abendkasse Wurzeln schlagen wird. <br><br>  <b>Achtung</b> : Wenn Sie den Artikel unaufmerksam lesen und in Sicherheitsfragen nicht sehr kompetent sind - <b>dieser Webdienst verf√ºgt nicht √ºber eine Verschl√ºsselung (https) und keine Berechtigung</b> , auch wenn er nur im lokalen Netzwerk verwendet wird - konfigurieren Sie den Schutz f√ºr den Zugriff auf den Port. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de457684/">https://habr.com/ru/post/de457684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de457652/index.html">So organisieren Sie 120.000 Fotos, damit das Team keine Tryndets mit unterschiedlichen Zugriffsebenen erh√§lt</a></li>
<li><a href="../de457658/index.html">Union MS-11: Ein Unfall, den es nicht gab?</a></li>
<li><a href="../de457660/index.html">So sparen Sie in 5 Minuten 58 US-Dollar: Lassen Sie uns in jedem Land unterschiedliche Preise gegen Vermarkter verwenden</a></li>
<li><a href="../de457666/index.html">Alternativen zum Raspberry Pi</a></li>
<li><a href="../de457680/index.html">Minimale CentOS / Fedora / RedHat-Installation</a></li>
<li><a href="../de457686/index.html">Wie die Sberbank die Zustimmung zur Verarbeitung von Biometrie einholt</a></li>
<li><a href="../de457690/index.html">Paranoides Video von Yandex.Money metap</a></li>
<li><a href="../de457692/index.html">√úberlegungen zu nationalen NB-Fi-Standard- und Abrechnungssystemen</a></li>
<li><a href="../de457694/index.html">Die Gefahren der Verwendung von Konstanten mit mehreren Zeichen</a></li>
<li><a href="../de457696/index.html">Die Gefahren der Verwendung von Konstanten mit mehreren Zeichen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>