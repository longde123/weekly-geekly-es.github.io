<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍❤️‍💋‍👨 ⚒️ 🤲 TensorFlow.js und clmtrackr.js: Verfolgen der Blickrichtung des Benutzers im Browser 🚵🏽 💒 🕺🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der Autor des Artikels, dessen Übersetzung wir veröffentlichen, bietet an, über die Lösung von Problemen aus dem Bereich der Bildverarbeitung ausschli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TensorFlow.js und clmtrackr.js: Verfolgen der Blickrichtung des Benutzers im Browser</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/426055/">  Der Autor des Artikels, dessen Übersetzung wir veröffentlichen, bietet an, über die Lösung von Problemen aus dem Bereich der Bildverarbeitung ausschließlich über einen Webbrowser zu sprechen.  Die Lösung eines solchen Problems ist dank der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TensorFlow-</a> JavaScript-Bibliothek nicht so schwierig.  Anstatt unser eigenes Modell zu schulen und es den Benutzern als Teil des fertigen Produkts anzubieten, bieten wir ihnen die Möglichkeit, unabhängig Daten zu sammeln und das Modell direkt in einem Browser auf unserem eigenen Computer zu trainieren.  Bei diesem Ansatz ist eine serverseitige Datenverarbeitung völlig unnötig. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1n/6k/57/1n6k57nn-wdkux5hhohvjnyadve.jpeg"></div><br>  Hier können Sie erfahren, wofür dieses Material bestimmt ist.  Dazu benötigen Sie einen modernen Browser, eine Webcam und eine Maus.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier ist der</a> Quellcode des Projekts.  Er ist nicht für die Arbeit mit Mobilgeräten ausgelegt. Der Autor des Materials gibt an, dass er keine Zeit für entsprechende Verbesserungen hatte.  Darüber hinaus stellt er fest, dass die hier betrachtete Aufgabe komplizierter wird, wenn Sie den Videostream von einer sich bewegenden Kamera verarbeiten müssen. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Idee</font> </h2><br>  Lassen Sie uns mithilfe der Technologie des maschinellen Lernens genau herausfinden, wohin der Benutzer schaut, wenn er eine Webseite betrachtet.  Wir tun dies, indem wir seine Augen mit einer Webcam beobachten. <br><br>  Es ist sehr einfach, im Browser auf die Webcam zuzugreifen.  Wenn wir davon ausgehen, dass das gesamte Bild von der Kamera als Eingabe für das neuronale Netzwerk verwendet wird, können wir sagen, dass es für diese Zwecke zu groß ist.  Das System muss viel Arbeit leisten, um die Stelle im Bild zu bestimmen, an der sich die Augen befinden.  Dieser Ansatz kann sich gut zeigen, wenn es sich um ein Modell handelt, das der Entwickler selbst trainiert und auf dem Server bereitstellt. Wenn wir jedoch über das Training und die Verwendung des Modells in einem Browser sprechen, ist dies zu viel. <br><br>  Um die Aufgabe des Netzwerks zu erleichtern, können wir ihm nur einen Teil des Bildes zur Verfügung stellen - den, der die Augen des Benutzers und einen kleinen Bereich um ihn herum enthält.  Dieser Bereich, bei dem es sich um ein Rechteck handelt, das die Augen umgibt, kann mithilfe einer Bibliothek eines Drittanbieters identifiziert werden.  Daher sieht der erste Teil unserer Arbeit folgendermaßen aus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pg/fc/fp/pgfcfppfo3_6wddvm58zikfoqlw.png"></div><br>  <i><font color="#999999">Webcam-Eingabe, Gesichtserkennung, Augenerkennung, zugeschnittenes Bild</font></i> <br><br>  Um das Gesicht im Bild zu erkennen, habe ich eine Bibliothek namens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">clmtrackr verwendet</a> .  Es ist nicht perfekt, unterscheidet sich jedoch durch geringe Größe, gute Leistung und bewältigt seine Aufgabe im Allgemeinen mit Würde. <br><br>  Wenn ein kleines, aber intelligent ausgewähltes Bild als Eingabe für ein einfaches neuronales Faltungsnetzwerk verwendet wird, kann das Netzwerk problemlos lernen.  So sieht dieser Prozess aus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yh/k_/th/yhk_thr05faoc09immbn8fz1vou.png"></div><br>  <i><font color="#999999">Das Eingabebild, das Modell, ist ein Faltungsnetzwerk, Koordinaten, der Ort, den das Netzwerk auf der Seite, auf der der Benutzer sucht, vorhersagt.</font></i> <br><br>  Eine voll funktionsfähige Mindestimplementierung der in diesem Abschnitt diskutierten Ideen wird hier beschrieben.  Das Projekt, dessen Code sich in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem</a> Repository befindet, verfügt über viele zusätzliche Funktionen. <br><br><h2>  <font color="#3AC1EF">Vorbereitung</font> </h2><br>  <code>clmtrackr.js</code> aus dem entsprechenden <a href="">Repository</a> <code>clmtrackr.js</code> .  Wir werden die Arbeit mit einer leeren HTML-Datei beginnen, die jQuery, TensorFlow.js, clmtrackr.js und die Datei <code>main.js</code> mit unserem Code <code>main.js</code> , an dem wir etwas später arbeiten werden: <br><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://code.jquery.com/jquery-3.3.1.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.12.0"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clmtrackr.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Empfangen Sie einen Videostream von einer Webcam</font> </h2><br>  Um die Webcam zu aktivieren und den Videostream auf der Seite anzuzeigen, benötigen wir die Benutzerberechtigung.  Hier stelle ich keinen Code zur Verfügung, der die Kompatibilitätsprobleme des Projekts mit verschiedenen Browsern löst.  Wir gehen davon aus, dass unsere Nutzer mit der neuesten Version von Google Chrome im Internet arbeiten. <br><br>  Fügen Sie der HTML-Datei den folgenden Code hinzu.  Es sollte sich innerhalb des <code>&lt;body&gt;</code> , jedoch über den <code>&lt;script&gt;</code> -Tags: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"webcam"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoplay</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Lassen Sie uns nun mit der Datei <code>main.js</code> : <br><br><pre> <code class="hljs javascript">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> video = $(<span class="hljs-string"><span class="hljs-string">'#webcam'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStreaming</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">) </span></span>{   video.srcObject = stream; } navigator.mediaDevices.getUserMedia({ <span class="hljs-attr"><span class="hljs-attr">video</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }).then(onStreaming); });</code> </pre> <br>  Probieren Sie diesen Code selbst aus.  Wenn Sie die Seite öffnen, sollte der Browser um Erlaubnis bitten, und dann wird ein Bild von der Webcam auf dem Bildschirm angezeigt. <br><br>  Später werden wir den Code der Funktion <code>onStreaming()</code> . <br><br><h2>  <font color="#3AC1EF">Gesichtssuche</font> </h2><br>  Verwenden wir nun die Bibliothek clmtrackr.js, um nach Gesichtern im Video zu suchen.  Initialisieren Sie zunächst das Gesichtsverfolgungssystem, indem Sie nach <code>const video = ...</code> den folgenden Code hinzufügen: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ctrack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> clm.tracker(); ctrack.init();</code> </pre> <br>  In der Funktion <code>onStreaming()</code> verbinden wir nun das Gesichtssuchsystem, indem wir dort den folgenden Befehl hinzufügen: <br><br><pre> <code class="hljs pgsql">ctrack.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>(video);</code> </pre> <br>  Das ist alles was wir brauchen.  Jetzt kann das System das Gesicht im Videostream erkennen. <br><br>  Glaubst du nicht?  Zeichnen wir eine "Maske" um Ihr Gesicht, um sicherzustellen, dass dies wahr ist. <br>  Dazu müssen wir das Bild über dem Element anzeigen, das für die Anzeige des Videos verantwortlich ist.  Mit dem <code>&lt;canvas&gt;</code> können Sie etwas auf HTML-Seiten zeichnen.  Daher erstellen wir ein solches Element, indem wir es dem Element überlagern, das das Video anzeigt.  Der folgende Code hilft uns dabei, der der HTML-Datei unter dem bereits vorhandenen <code>&lt;video&gt;</code> -Element hinzugefügt werden muss: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"overlay"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#webcam</span></span></span><span class="css">, </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#overlay</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">top</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">left</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Wenn Sie möchten, können Sie den Inline-Stil in eine separate CSS-Datei verschieben. <br><br>  Hier haben wir der Seite ein <code>&lt;canvas&gt;</code> der gleichen Größe wie das <code>&lt;video&gt;</code> -Element hinzugefügt.  Dass sich die Elemente an derselben Position befinden, wird durch die hier verwendeten Stile bereitgestellt. <br><br>  Jedes Mal, wenn der Browser das nächste Bild des Videos anzeigt, zeichnen wir etwas auf das <code>&lt;canvas&gt;</code> .  Die Ausführung eines beliebigen Codes während der Ausgabe jedes Frames erfolgt mithilfe des <code>requestAnimationLoop()</code> -Mechanismus.  Bevor wir etwas an das <code>&lt;canvas&gt;</code> ausgeben, müssen wir das, was zuvor darauf war, entfernen und löschen.  Wir können dann <code>clmtrackr</code> vorschlagen, um die Grafik direkt an das <code>&lt;canvas&gt;</code> auszugeben. <br><br>  Hier ist der Code, der implementiert, worüber wir gerade gesprochen haben.  Fügen Sie es unter dem Befehl <code>ctrack.init()</code> : <br><br><pre> <code class="hljs matlab">const overlay = $(<span class="hljs-string"><span class="hljs-string">'#overlay'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const overlayCC = overlay.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trackingLoop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { // ,     , //     -   . </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestAnimationFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(trackingLoop)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentPosition</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ctrack</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlayCC</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearRect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0, 0, 400, 300)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(currentPosition)</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ctrack</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(overlay)</span></span></span><span class="hljs-function">; } }</span></span></code> </pre> <br>  Rufen Sie nun die Funktion <code>onStreaming()</code> Funktion <code>onStreaming()</code> unmittelbar nach <code>ctrack.start()</code> .  Diese Funktion plant selbst einen eigenen Neustart in jedem Frame. <br><br>  Aktualisieren Sie die Seite und sehen Sie sich die Webcam an.  Sie sollten im Videofenster eine grüne „Maske“ um Ihr Gesicht sehen.  Manchmal muss der Kopf leicht im Rahmen bewegt werden, damit das System das Gesicht richtig erkennt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/394/ab1/98a/394ab198a25c82f7a6c03eefdbe7c73c.png"></div><br>  <i><font color="#999999">Gesichtserkennungsergebnisse</font></i> <br><br><h2>  <font color="#3AC1EF">Identifizieren Sie den Bereich des Bildes, der die Augen enthält</font> </h2><br>  Jetzt müssen wir den rechteckigen Bereich des Bildes finden, in dem sich die Augen befinden, und ihn auf einem separaten <code>&lt;canvas&gt;</code> . <br><br>  Glücklicherweise gibt uns cmltracker nicht nur Informationen über die Position des Gesichts, sondern auch 70 Kontrollpunkte.  Wenn Sie sich die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> zu cmltracker ansehen, können Sie genau die Kontrollpunkte auswählen, die wir benötigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e7/334/c6f/6e7334c6fa51c5c55ebd66b45d0d8dd8.png"></div><br>  <i><font color="#999999">Kontrollpunkte</font></i> <br><br>  Wir entscheiden, dass die Augen der rechteckige Teil des Bildes sind, dessen Ränder die Punkte 23, 28, 24 und 26 berühren, die in jeder Richtung um 5 Pixel erweitert sind.  Dieses Rechteck sollte alles enthalten, was für uns wichtig ist, es sei denn, der Benutzer neigt seinen Kopf zu stark. <br><br>  Bevor wir dieses Fragment des Bildes verwenden können, benötigen wir ein weiteres <code>&lt;canvas&gt;</code> für seine Ausgabe.  Die Abmessungen betragen 50 x 25 Pixel.  Ein Rechteck mit Augen passt in dieses Element.  Eine leichte Bildverformung ist kein Problem. <br><br>  Fügen Sie diesen Code der HTML-Datei hinzu, die das <code>&lt;canvas&gt;</code> , das den Teil des Bildes enthält, der Augen hat: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eyes"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"50"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#eyes</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">top</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">right</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Die folgende Funktion gibt die <code>x</code> und <code>y</code> Koordinaten sowie die Breite und Höhe des die Augen umgebenden Rechtecks ​​zurück.  Als Eingabe nimmt es eine Reihe von <code>positions</code> die von clmtrackr empfangen wurden.  Beachten Sie, dass jede von clmtrackr empfangene Koordinate die Komponenten <code>x</code> und <code>y</code> .  Diese Funktion muss zu <code>main.js</code> hinzugefügt <code>main.js</code> : <br><br><pre> <code class="hljs markdown">function getEyesRectangle(positions) { const minX = positions[<span class="hljs-string"><span class="hljs-string">23</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">0</span></span>] - 5; const maxX = positions[<span class="hljs-string"><span class="hljs-string">28</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">0</span></span>] + 5; const minY = positions[<span class="hljs-string"><span class="hljs-string">24</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">1</span></span>] - 5; const maxY = positions[<span class="hljs-string"><span class="hljs-string">26</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">1</span></span>] + 5; const width = maxX - minX; const height = maxY - minY; return [minX, minY, width, height]; }</code> </pre> <br>  Jetzt extrahieren wir in jedem Frame ein Rechteck mit Augen aus dem Videostream, kreisen es mit einer roten Linie auf dem <code>&lt;canvas&gt;</code> , das dem <code>&lt;video&gt;</code> -Element überlagert ist, und kopieren es dann in das neue <code>&lt;canvas&gt;</code> .  Bitte beachten Sie, dass wir die Indikatoren <code>resizeFactorX</code> und <code>resizeFactorY</code> berechnen, um den von uns benötigten Bereich korrekt zu identifizieren. <br><br>  Ersetzen Sie den <code>if</code> Block in der Funktion <code>trackingLoop()</code> durch den folgenden Code: <br><br><pre> <code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentPosition) { //  ,     //   &lt;canvas&gt;,    &lt;video&gt; ctrack.draw(overlay); //  ,  ,    //   const eyesRect = getEyesRectangle(currentPosition); overlayCC.strokeStyle = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; overlayCC.strokeRect(eyesRect[<span class="hljs-number"><span class="hljs-number">0</span></span>], eyesRect[<span class="hljs-number"><span class="hljs-number">1</span></span>], eyesRect[<span class="hljs-number"><span class="hljs-number">2</span></span>], eyesRect[<span class="hljs-number"><span class="hljs-number">3</span></span>]); //      , //        //      const resizeFactorX = video.videoWidth / video.width; const resizeFactorY = video.videoHeight / video.height; //          //    &lt;canvas&gt; const eyesCanvas = <span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const eyesCC = eyesCanvas.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>); eyesCC.drawImage(   video,   eyesRect[<span class="hljs-number"><span class="hljs-number">0</span></span>] * resizeFactorX, eyesRect[<span class="hljs-number"><span class="hljs-number">1</span></span>] * resizeFactorY,   eyesRect[<span class="hljs-number"><span class="hljs-number">2</span></span>] * resizeFactorX, eyesRect[<span class="hljs-number"><span class="hljs-number">3</span></span>] * resizeFactorY,   <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, eyesCanvas.width, eyesCanvas.height ); }</code> </pre> <br>  Nachdem Sie die Seite jetzt neu geladen haben, sollten Sie ein rotes Rechteck um die Augen sehen. Dieses Rechteck befindet sich im entsprechenden <code>&lt;canvas&gt;</code> .  Wenn Ihre Augen größer als meine sind, experimentieren Sie mit der Funktion <code>getEyeRectangle</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c8/29e/5a3/6c829e5a354575ed9c269bebf20c5a5a.png"></div><br>  <i><font color="#999999">&lt;canvas&gt; -Element, das ein Rechteck mit dem Bild der Augen des Benutzers zeichnet</font></i> <br><br><h2>  <font color="#3AC1EF">Datenerfassung</font> </h2><br>  Es gibt viele Möglichkeiten, Daten zu sammeln.  Ich habe mich entschieden, die Informationen zu verwenden, die über Maus und Tastatur abgerufen werden können.  In unserem Projekt sieht die Datenerfassung so aus. <br><br>  Der Benutzer bewegt den Cursor über die Seite, beobachtet ihn mit den Augen und drückt jedes Mal die <code></code> auf der Tastatur, wenn das Programm ein weiteres Sample aufnehmen muss.  Mit diesem Ansatz ist es einfach, schnell einen großen Datensatz für das Training des Modells zu erfassen. <br><br><h3>  <font color="#3AC1EF">▍Mausverfolgung</font> </h3><br>  Um genau herauszufinden, wo sich der Mauszeiger auf der Webseite befindet, benötigen wir einen <code>document.onmousemove</code> Ereignishandler.  Unsere Funktion normalisiert außerdem die Koordinaten so, dass sie in den Bereich [-1, 1] passen: <br><br><pre> <code class="hljs pgsql">//   : const mouse = { x: <span class="hljs-number"><span class="hljs-number">0</span></span>, y: <span class="hljs-number"><span class="hljs-number">0</span></span>, handleMouseMove: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(event) {   //      ,    [<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]   mouse.x = (event.clientX / $(<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>).width()) * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>;   mouse.y = (event.clientY / $(<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>).height()) * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>; }, } document.onmousemove = mouse.handleMouseMove;</code> </pre> <br><h3>  <font color="#3AC1EF">▍ Bilderfassung</font> </h3><br>  Um das vom <code>&lt;canvas&gt;</code> angezeigte Bild zu erfassen und als Tensor zu speichern, bietet TensorFlow.js die <code>tf.fromPixels()</code> .  Wir verwenden es, um das Bild aus dem <code>&lt;canvas&gt;</code> zu speichern und dann zu normalisieren, das ein Rechteck mit den Augen des Benutzers anzeigt: <br><br><pre> <code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { //       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tf.tidy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   const image = tf.fromPixels($(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]);   //  &lt;i&gt;&lt;font color=<span class="hljs-string"><span class="hljs-string">"#999999"</span></span>&gt;&lt;/font&gt;&lt;/i&gt;:   const batchedImage = image.expandDims(<span class="hljs-number"><span class="hljs-number">0</span></span>);   //    :   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> batchedImage.toFloat().div(tf.scalar(<span class="hljs-number"><span class="hljs-number">127</span></span>)).<span class="hljs-built_in"><span class="hljs-built_in">sub</span></span>(tf.scalar(<span class="hljs-number"><span class="hljs-number">1</span></span>)); }); }</code> </pre> <br>  Beachten Sie, dass die Funktion <code>tf.tidy()</code> verwendet wird, um nach Abschluss zu bereinigen. <br><br>  Wir könnten einfach alle Proben in einem großen Trainingssatz speichern. Beim maschinellen Lernen ist es jedoch wichtig, die Qualität des Modelltrainings zu überprüfen.  Aus diesem Grund müssen wir einige Proben in einer separaten Kontrollprobe speichern.  Danach können wir das Verhalten des Modells anhand neuer Daten überprüfen und feststellen, ob das Modell übermäßig trainiert wurde.  Zu diesem Zweck sind 20% der Gesamtzahl der Proben in der Kontrollprobe enthalten. <br><br>  Hier ist der Code, der zum Sammeln von Daten und Beispielen verwendet wird: <br><br><pre> <code class="hljs pgsql">const dataset = { train: {   n: <span class="hljs-number"><span class="hljs-number">0</span></span>,   x: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,   y: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, }, val: {   n: <span class="hljs-number"><span class="hljs-number">0</span></span>,   x: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,   y: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, }, } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> captureExample() { //            tf.tidy(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() {   const image = getImage();   const mousePos = tf.tensor1d([mouse.x, mouse.y]).expandDims(<span class="hljs-number"><span class="hljs-number">0</span></span>);   // ,    (  )     const subset = dataset[Math.random() &gt; <span class="hljs-number"><span class="hljs-number">0.2</span></span> ? <span class="hljs-string"><span class="hljs-string">'train'</span></span> : <span class="hljs-string"><span class="hljs-string">'val'</span></span>];   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (subset.x == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) {     //        subset.x = tf.keep(image);     subset.y = tf.keep(mousePos);   } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {     //          const oldX = subset.x;     const oldY = subset.y;     subset.x = tf.keep(oldX.concat(image, <span class="hljs-number"><span class="hljs-number">0</span></span>));     subset.y = tf.keep(oldY.concat(mousePos, <span class="hljs-number"><span class="hljs-number">0</span></span>));   }   //     subset.n += <span class="hljs-number"><span class="hljs-number">1</span></span>; }); }</code> </pre> <br>  Und schließlich müssen wir diese Funktion an die <code></code> binden: <br><br><pre> <code class="hljs matlab">$(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).keyup(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span><span class="hljs-function"> { //         </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event.keyCode == 32)</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">captureExample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">; } });</span></span></code> </pre> <br>  Jedes Mal, wenn Sie die <code></code> , werden das Augenbild und die Koordinaten des Mauszeigers zu einem der Datensätze hinzugefügt. <br><br><h2>  <font color="#3AC1EF">Modelltraining</font> </h2><br>  Erstellen Sie ein einfaches neuronales Faltungsnetzwerk.  TensorFlow.js bietet zu diesem Zweck eine API, die an Keras erinnert.  Das Netzwerk sollte eine <code>conv2d</code> Schicht, eine <code>maxPooling2d</code> Schicht und schließlich eine <code>dense</code> Schicht mit zwei Ausgabewerten haben (sie repräsentieren die Bildschirmkoordinaten).  Unterwegs habe ich dem Netzwerk eine <code>dropout</code> Ebene und eine <code>flatten</code> als Regularisierer hinzugefügt, um zweidimensionale Daten in eindimensionale zu konvertieren.  Das Netzwerktraining wird mit dem Adam-Optimierer durchgeführt. <br><br>  Bitte beachten Sie, dass ich mich nach dem Experimentieren mit meinem MacBook Air für die hier verwendeten Netzwerkeinstellungen entschieden habe.  Sie können auch Ihre eigene Konfiguration des Modells wählen. <br><br>  Hier ist der Modellcode: <br><br><pre> <code class="hljs powershell">let currentModel; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { const model = tf.sequential(); model.add(tf.layers.conv2d({   kernelSize: <span class="hljs-number"><span class="hljs-number">5</span></span>,   filters: <span class="hljs-number"><span class="hljs-number">20</span></span>,   strides: <span class="hljs-number"><span class="hljs-number">1</span></span>,   activation: <span class="hljs-string"><span class="hljs-string">'relu'</span></span>,   inputShape: [<span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)<span class="hljs-type"><span class="hljs-type">.height</span></span>(), <span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)<span class="hljs-type"><span class="hljs-type">.width</span></span>(), <span class="hljs-number"><span class="hljs-number">3</span></span>], })); model.add(tf.layers.maxPooling2d({   poolSize: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>],   strides: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], })); model.add(tf.layers.flatten()); model.add(tf.layers.dropout(<span class="hljs-number"><span class="hljs-number">0.2</span></span>)); //    x  y model.add(tf.layers.dense({   units: <span class="hljs-number"><span class="hljs-number">2</span></span>,   activation: <span class="hljs-string"><span class="hljs-string">'tanh'</span></span>, })); //   Adam     <span class="hljs-number"><span class="hljs-number">0.0005</span></span>     MSE model.compile({   optimizer: tf.train.adam(<span class="hljs-number"><span class="hljs-number">0.0005</span></span>),   loss: <span class="hljs-string"><span class="hljs-string">'meanSquaredError'</span></span>, }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model; }</code> </pre> <br>  Bevor wir mit dem Training des Netzwerks beginnen, legen wir eine feste Anzahl von Epochen und eine variable Paketgröße fest (da wir wahrscheinlich mit sehr kleinen Datenmengen arbeiten werden). <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fitModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> batchSize = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(dataset.train.n * <span class="hljs-number"><span class="hljs-number">0.1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (batchSize &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) {   batchSize = <span class="hljs-number"><span class="hljs-number">4</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (batchSize &gt; <span class="hljs-number"><span class="hljs-number">64</span></span>) {   batchSize = <span class="hljs-number"><span class="hljs-number">64</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentModel == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) {   currentModel = createModel(); } currentModel.fit(dataset.train.x, dataset.train.y, {   <span class="hljs-attr"><span class="hljs-attr">batchSize</span></span>: batchSize,   <span class="hljs-attr"><span class="hljs-attr">epochs</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>,   <span class="hljs-attr"><span class="hljs-attr">shuffle</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,   <span class="hljs-attr"><span class="hljs-attr">validationData</span></span>: [dataset.val.x, dataset.val.y], }); }</code> </pre> <br>  Fügen Sie nun der Seite eine Schaltfläche hinzu, um mit dem Lernen zu beginnen.  Dieser Code geht in die HTML-Datei: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"train"</span></span></span><span class="hljs-tag">&gt;</span></span>Train!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#train</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">top</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">left</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">transform</span></span></span><span class="css">: </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">translate</span></span></span><span class="css">(-50%, -50%);       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">font-size</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">24pt</span></span></span><span class="css">;   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Dieser Code muss der JS-Datei hinzugefügt werden: <br><br><pre> <code class="hljs matlab">$(<span class="hljs-string"><span class="hljs-string">'#train'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fitModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; });</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Wo sucht der Benutzer?</font> </h2><br>  Nachdem wir die Daten sammeln und das Modell vorbereiten können, können wir beginnen, die Stelle auf der Seite vorherzusagen, an der der Benutzer sucht.  Wir zeigen mit Hilfe eines grünen Kreises auf diesen Ort, der sich auf dem Bildschirm bewegt. <br><br>  Fügen Sie der Seite zunächst einen Kreis hinzu: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#target</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-color</span></span></span><span class="css">: lightgreen;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border-radius</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">height</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">40px</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">width</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">40px</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">transition</span></span></span><span class="css">: all </span><span class="hljs-number"><span class="css"><span class="hljs-number">0.1s</span></span></span><span class="css"> ease;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">box-shadow</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">20px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">10px</span></span></span><span class="css"> white;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">4px</span></span></span><span class="css"> solid </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">rgba</span></span></span><span class="css">(0,0,0,0.5);   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Um es auf der Seite zu verschieben, senden wir regelmäßig das aktuelle Bild der Augen des neuronalen Netzwerks und stellen ihr eine Frage, wohin der Benutzer schaut.  Das Antwortmodell erzeugt zwei Koordinaten, entlang derer der Kreis verschoben werden soll: <br><br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moveTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(currentModel == null)</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tf</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tidy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function()</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prediction</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentModel</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image)</span></span></span><span class="hljs-function">;   //          </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetWidth</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#target')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outerWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetHeight</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#target')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outerHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prediction.get(0, 0)</span></span></span><span class="hljs-function"> + 1) / 2 * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetWidth</span></span></span><span class="hljs-function">);   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prediction.get(0, 1)</span></span></span><span class="hljs-function"> + 1) / 2 * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetHeight</span></span></span><span class="hljs-function">);   //     :   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#target')</span></span></span><span class="hljs-function">;   $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">css</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('left', x + 'px')</span></span></span><span class="hljs-function">;   $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">css</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('top', y + 'px')</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setInterval</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(moveTarget, 100)</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br>  Ich habe das Intervall auf 100 Millisekunden eingestellt.  Wenn Ihr Computer nicht so leistungsfähig ist wie meiner, können Sie ihn vergrößern. <br><br><h2>  <font color="#3AC1EF">Zusammenfassung</font> </h2><br>  Jetzt haben wir alles, was wir brauchen, um die am Anfang dieses Materials vorgestellte Idee umzusetzen.  Erleben Sie, was wir getan haben.  Bewegen Sie den Mauszeiger seinen Augen und drücken Sie die Leertaste.  Klicken Sie dann auf die Schaltfläche Training starten. <br><br>  Sammeln Sie weitere Daten und klicken Sie erneut auf die Schaltfläche.  Nach einer Weile beginnt sich der grüne Kreis nach Ihrem Blick auf dem Bildschirm zu bewegen.  Zuerst ist es nicht besonders gut, an den Ort zu gelangen, an dem Sie suchen, aber ab etwa 50 gesammelten Proben nach mehreren Trainingsphasen, und wenn Sie Glück haben, bewegt es sich ziemlich genau zu dem Punkt auf der Seite, den Sie betrachten .  Den vollständigen Code des in diesem Material analysierten Beispiels finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Obwohl das, was wir getan haben, bereits sehr interessant aussieht, können noch viele Verbesserungen vorgenommen werden.  Was ist, wenn der Benutzer seinen Kopf bewegt oder seine Position vor der Kamera ändert?  Unser Projekt würde die Möglichkeiten hinsichtlich der Auswahl der Größe, Position und des Winkels des Rechtecks, das den Bildbereich begrenzt, in dem sich die Augen befinden, nicht beeinträchtigen.  Tatsächlich sind in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vollversion des</a> hier diskutierten Beispiels einige zusätzliche Funktionen implementiert.  Hier sind einige davon: <br><br><ul><li>  Die oben beschriebenen Optionen zum Anpassen des augenbegrenzenden Rechtecks. </li><li>  Konvertieren Sie ein Bild in Graustufen. </li><li>  Verwenden von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CoordConv</a> . </li><li>  Eine Heatmap, mit der überprüft werden kann, wo das Modell eine gute Leistung erbracht hat und wo nicht. </li><li>  Möglichkeit zum Speichern und Laden von Datensätzen. </li><li>  Möglichkeit zum Speichern und Laden von Modellen. </li><li>  Erhaltung der Gewichte, die nach dem Training einen minimalen Trainingsverlust zeigten. </li><li>  Verbesserte Benutzeroberfläche mit kurzen Anweisungen für die Arbeit mit dem System. </li></ul><br>  <b>Liebe Leser!</b>  Verwenden Sie TensorFlow? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de426055/">https://habr.com/ru/post/de426055/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de426041/index.html">Symbolische Lösung linearer Differentialgleichungen und -systeme durch die Laplace-Transformationsmethode mit SymPy</a></li>
<li><a href="../de426045/index.html">Besondere Ausnahmen in .NET und wie man sie vorbereitet</a></li>
<li><a href="../de426047/index.html">10 großartige Bücher für Anfänger in Englisch</a></li>
<li><a href="../de426051/index.html">Verbesserung der Fähigkeiten zum Debuggen von Software - einige Tipps</a></li>
<li><a href="../de426053/index.html">Caching von Ereignishandlern und Verbesserung der Anwendungsleistung</a></li>
<li><a href="../de426059/index.html">Tutu PHP Meetup # 2: Sprachvideo</a></li>
<li><a href="../de426061/index.html">Microsoft tritt dem Open Invention Network bei und gewährt 60.000 Lizenzen</a></li>
<li><a href="../de426063/index.html">HPE MSA-Array-Innovationen der Einstiegsklasse: günstigeres Flash-Array und umfassende Lösungsintegration</a></li>
<li><a href="../de426065/index.html">Smart TV, das selbst den interessantesten Kanal bestimmt, oder eine ungewöhnliche Sudoku-Lösung für Videoinhalte</a></li>
<li><a href="../de426067/index.html">Bewegen Sie sich wie zwei Feuer? Noch einmal über Personalumzug</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>