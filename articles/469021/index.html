<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè• üì∑ üé† Desarrollo en un monorepository. Informe Yandex üêô üèáüèø üçΩÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mi nombre es Azat Razetdinov, llevo 12 a√±os en Yandex, administro el servicio de desarrollo de interfaces en Y. Real Estate. Hoy me gustar√≠a hablar de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desarrollo en un monorepository. Informe Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/469021/">  Mi nombre es Azat Razetdinov, llevo 12 a√±os en Yandex, administro el servicio de desarrollo de interfaces en Y. Real Estate.  Hoy me gustar√≠a hablar de un monorepository.  Si solo tiene un repositorio en el trabajo, felicidades, ya vive en un √∫nico repositorio.  Ahora sobre por qu√© otros lo necesitan. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/v_/vr/gi/v_vrgiiye4emmloccesmmogxlim.jpeg"></a> <br><br><blockquote>  Seg√∫n Marina Pereskokova, directora del servicio de desarrollo de API Yandex.Map, mi abuelo plant√≥ una monorepa, y una monorepa ha crecido mucho. </blockquote><br><a name="habracut"></a>  - En Yandex probamos diferentes formas de trabajar con varios servicios y nos dimos cuenta: tan pronto como tiene m√°s de un servicio, inevitablemente comienzan a aparecer partes comunes: modelos, utilidades, herramientas, c√≥digos, plantillas, componentes.  La pregunta es: ¬ød√≥nde poner todo esto?  Por supuesto, puedes copiar y pegar, podemos hacerlo, pero lo quiero maravillosamente. <br><br>  Incluso probamos una entidad como SVN externos para aquellos que recuerdan.  Intentamos subm√≥dulos git.  Intentamos paquetes npm cuando aparecieron.  Pero todo esto fue de alguna manera largo, o algo as√≠.  Admite cualquier paquete, encuentra un error, realiza correcciones.  Luego, necesita lanzar una nueva versi√≥n, pasar por los servicios, actualizar a esta versi√≥n, verificar que todo funcione, ejecutar las pruebas, encontrar el error, volver al repositorio de la biblioteca, corregir el error, lanzar la nueva versi√≥n, pasar por los servicios, actualizar, etc. c√≠rculo  Simplemente se convirti√≥ en dolor. <br><br><img src="https://habrastorage.org/webt/rq/ie/uo/rqieuoverzzoq6wrhpujf4qz8vw.jpeg"><br><br>  Luego pensamos si deber√≠amos unirnos en un repositorio.  Tome todos nuestros servicios y bibliotecas, transfi√©ralos y desarrolle en un solo repositorio.  Hubo muchas ventajas.  No estoy diciendo que este enfoque sea ideal, pero desde el punto de vista de la empresa e incluso del departamento de varios grupos, aparecen ventajas significativas. <br><br>  Para m√≠ personalmente, lo m√°s importante es la atomicidad de los commits, que como desarrollador, puedo arreglar la biblioteca, omitir todos los servicios, hacer cambios, ejecutar pruebas, verificar que todo funcione, empujarlo al maestro y todo esto con un solo cambio.  No es necesario reconstruir, publicar, actualizar nada. <br><br>  Pero si todo est√° tan bien, ¬øpor qu√© no se han mudado todos al repositorio mono todav√≠a?  Por supuesto, tambi√©n hay desventajas en ello. <br><br><img src="https://habrastorage.org/webt/bb/1u/pv/bb1upvyscjzd_csjkvxce0yh9a0.jpeg"><br><br>  Seg√∫n Marina Pereskokova, directora del servicio de desarrollo de API Yandex.Map, mi abuelo plant√≥ una monorepa, y una monorepa ha crecido mucho.  Esto es un hecho, no una broma.  Si re√∫ne muchos servicios en un solo repositorio, inevitablemente crece.  Y si estamos hablando de git, que extrae todos los archivos m√°s su historial completo durante toda la existencia de su c√≥digo, este es un espacio en disco bastante grande. <br><br>  El segundo problema es la inyecci√≥n en el maestro.  Usted prepar√≥ una solicitud de grupo, realiz√≥ una revisi√≥n, est√° listo para fusionarla.  Y resulta que alguien logr√≥ adelantarse a usted y usted necesita resolver conflictos.  Resolvi√≥ los conflictos, nuevamente listo para entrar, y nuevamente no tuvo tiempo.  Este problema se est√° resolviendo, hay sistemas de colas de fusi√≥n, cuando un robot especial automatiza este trabajo, las solicitudes de grupos de carriles, intenta resolver conflictos, si puede.  Si no puede, llama al autor.  Sin embargo, tal problema existe.  Hay soluciones que lo nivelan, pero debe tenerlo en cuenta. <br><br>  Estos son puntos t√©cnicos, pero tambi√©n hay puntos organizativos.  Supongamos que tiene varios equipos que hacen varios servicios diferentes.  Cuando se trasladan a un √∫nico repositorio, su responsabilidad comienza a erosionarse.  Debido a que hicieron un lanzamiento, se lanzaron en producci√≥n, algo se rompi√≥.  Comenzamos el interrogatorio.  Resulta que es un desarrollador de otro equipo que ha comprometido algo con el c√≥digo general, lo sacamos, no lo lanzamos, no lo vimos, todo se rompi√≥.  Y no est√° claro qui√©n es responsable.  Es importante comprender y utilizar todos los m√©todos posibles: pruebas unitarias, pruebas de integraci√≥n, linter: todo lo que sea posible para reducir este problema de la influencia de un c√≥digo en todos los dem√°s servicios. <br><br>  Curiosamente, ¬øqui√©n m√°s adem√°s de Yandex y otros jugadores usa el mono-repositorio?  Mucha gente  Estos son React, Jest, Babel, Ember, Meteor, Angular.  La gente entiende: es m√°s f√°cil, m√°s barato, m√°s r√°pido desarrollar y publicar paquetes npm desde un √∫nico repositorio que desde varios repositorios peque√±os.  Lo m√°s interesante es que, junto con este proceso, comenzaron a desarrollarse herramientas para trabajar con un monorepository.  Solo sobre ellos y quiero hablar. <br><br>  Todo comienza con la creaci√≥n de un monorepository.  La herramienta de front-end m√°s famosa del mundo para esto se llama lerna. <br><br><img src="https://habrastorage.org/webt/2a/n9/my/2an9myv3k_dokzcizjfhshporh0.jpeg"><br><br>  Simplemente abra su repositorio, ejecute npx lerna init, le har√° algunas preguntas sugerentes y agregar√° algunas entidades a su copia de trabajo.  La primera entidad es la configuraci√≥n lerna.json, que indica al menos dos campos: la versi√≥n de extremo a extremo de todos sus paquetes y la ubicaci√≥n de sus paquetes en el sistema de archivos.  De forma predeterminada, todos los paquetes se agregan a la carpeta de paquetes, pero puede configurar esto como lo desee, incluso puede agregarlos a la ra√≠z, lerna tambi√©n puede recogerlo. <br><br>  El siguiente paso es c√≥mo agregar sus repositorios al repositorio mono, ¬øc√≥mo transferirlos? <br><br>  ¬øQu√© queremos lograr?  Lo m√°s probable es que ya tenga alg√∫n tipo de repositorio, en este caso A y B. <br><br><img src="https://habrastorage.org/webt/gd/yl/d0/gdyld0xwsgytno9mhaz7g-t-ikc.jpeg"><br><br>  Estos son dos servicios, cada uno en su propio repositorio, y queremos transferirlos al nuevo mono-repositorio en la carpeta de paquetes, preferiblemente con un historial de confirmaciones, para que pueda culpar a git, git log, etc. <br><br><img src="https://habrastorage.org/webt/rd/td/z1/rdtdz1-3hqxrjvgsgf4tb4wq5fy.jpeg"><br><br>  Hay una herramienta de importaci√≥n de lerna para esto.  Simplemente especifique la ubicaci√≥n de su repositorio, y lerna lo transfiere a su monorepo.  Al mismo tiempo, ella, en primer lugar, toma una lista de todas las confirmaciones, modifica cada confirmaci√≥n, cambia la ruta a los archivos desde la ra√≠z a paquetes / nombre_paquete, y los aplica uno tras otro, los impone en su mono-repositorio.  De hecho, cada confirmaci√≥n se prepara, cambiando las rutas de los archivos.  Esencialmente, lerna hace magia para ti.  Si lee el c√≥digo fuente, simplemente los comandos git se ejecutan en una secuencia determinada. <br><br>  Esta es la primera forma.  Tiene un inconveniente: si trabaja en una empresa donde hay procesos de producci√≥n, donde la gente ya est√° escribiendo alg√∫n tipo de c√≥digo y los va a traducir a un monorep, es poco probable que lo haga en un d√≠a.  Tendr√° que averiguar, configurar, verificar que todo comience, las pruebas.  Pero las personas no tienen trabajo, contin√∫an haciendo algo. <br><br><img src="https://habrastorage.org/webt/u5/w4/je/u5w4jenpjqspns44ok1grkidxug.jpeg"><br><br>  Para una transici√≥n m√°s suave al mono-rap, existe una herramienta como git subtree.  Esto es algo m√°s sofisticado, pero al mismo tiempo nativo de git, que le permite no solo importar repositorios individuales en un repositorio mono mediante alg√∫n tipo de prefijo, sino tambi√©n intercambiar cambios de un lado a otro.  Es decir, el equipo que realiza el servicio puede desarrollarse f√°cilmente en su propio repositorio, mientras que puede extraer sus cambios a trav√©s de git subtree pull, realizar sus propios cambios y hacerlos retroceder a trav√©s de git subtree push.  Y vive as√≠ en el per√≠odo de transici√≥n todo el tiempo que quieras. <br><br>  Y cuando configur√≥ todo, verific√≥ que todas las pruebas se est√°n ejecutando, la implementaci√≥n funciona, se configur√≥ todo el CI / CD, puede decir que es hora de seguir adelante.  Para el per√≠odo de transici√≥n, una gran soluci√≥n, lo recomiendo. <br><br>  Bueno, trasladamos nuestros repositorios a un mono-repositorio, pero ¬ød√≥nde est√° la magia en alguna parte?  Pero queremos resaltar las partes comunes y usarlas de alguna manera.  Y para esto hay un mecanismo de "vinculaci√≥n de dependencia".  ¬øQu√© es el enlace de dependencia?  Hay una herramienta de arranque de lerna, un comando que es similar a npm install, solo ejecuta npm install en todos sus paquetes. <br><br><img src="https://habrastorage.org/webt/kh/tg/cw/khtgcwjnzf2kjxoy61wgmkevopo.jpeg"><br><br>  Pero eso no es todo.  Adem√°s, ella est√° buscando dependencias internas.  Puede usar otro en un paquete dentro de su repositorio.  Por ejemplo, si tiene el paquete A, que depende de Jest en este caso, existe el paquete B, que depende de Jest y el paquete A. Si el paquete A es una herramienta com√∫n, un componente com√∫n, entonces el paquete B es un servicio que lo tiene usos. <br><br>  Lerna define tales dependencias internas y reemplaza f√≠sicamente esta dependencia con un enlace simb√≥lico en el sistema de archivos. <br><br><img src="https://habrastorage.org/webt/or/lk/am/orlkampii1gcc_kxupnpc5k-hxy.jpeg"><br><br><img src="https://habrastorage.org/webt/ia/dp/oo/iadpoole-lvonlr_o30aqvbc8no.jpeg"><br><br>  Despu√©s de ejecutar lerna bootstrap, justo dentro de la carpeta node_modules, en lugar de la carpeta f√≠sica A, aparece un enlace simb√≥lico que conduce a la carpeta con el paquete A. Esto es muy conveniente porque puede editar el c√≥digo dentro del paquete A e inmediatamente comprobar el resultado en el paquete B , ejecuta pruebas, integraci√≥n, unidades, lo que quieras.  El desarrollo se simplifica enormemente, ya no necesita volver a ensamblar el paquete A, publicar, conectar el paquete B. Simplemente se soluciona aqu√≠, se verifica all√≠. <br><br>  Tenga en cuenta que si mira las carpetas node_modules, y all√≠ y all√≠ es broma, hemos duplicado el m√≥dulo instalado.  En general, es mucho tiempo cuando inicia lerna bootstrap, espere hasta que todo se detenga, debido al hecho de que hay mucho trabajo repetido, se obtienen dependencias duplicadas en cada paquete. <br><br>  Para acelerar la instalaci√≥n de dependencias, se utiliza el mecanismo para aumentar las dependencias.  La idea es muy simple: puede llevar las dependencias generales a la ra√≠z node_modules. <br><br><img src="https://habrastorage.org/webt/so/lj/kr/soljkrixddhlkrth4w95b1bk5ek.jpeg"><br><br>  Si especifica la opci√≥n --hoist (esta es una actualizaci√≥n del ingl√©s), casi todas las dependencias simplemente se mover√°n a la ra√≠z node_modules.  Y casi siempre funciona.  Noda est√° tan dispuesta que si no ha encontrado las dependencias a su nivel, comienza a buscar un nivel m√°s alto, si no all√≠, otro nivel m√°s alto, etc.  Casi nada cambia.  Pero, de hecho, tomamos y deduplicamos nuestras dependencias, transferimos las dependencias a la ra√≠z. <br><br>  Al mismo tiempo, lerna es lo suficientemente inteligente.  Si hay alg√∫n conflicto, por ejemplo, si el paquete A usa la versi√≥n 1 de Jest y el paquete B usa la versi√≥n 2, entonces uno de ellos aparecer√° y el segundo permanecer√° en su nivel.  Esto es aproximadamente lo que npm est√° haciendo realmente dentro de la carpeta normal node_modules, tambi√©n trata de deduplicar las dependencias y, al m√°ximo, llevarlas a la ra√≠z. <br><br>  Desafortunadamente, esta magia no siempre funciona, especialmente con herramientas, con Babel, con Jest.  A menudo sucede que comienza, porque Jest tiene su propio sistema para resolver m√≥dulos, Noda comienza a retrasarse, arroja un error.  Especialmente para tales casos cuando la herramienta no hace frente a las dependencias que se han ido a la ra√≠z, existe la opci√≥n de nohoist, que le permite se√±alar que estos paquetes no se transfieren a la ra√≠z, d√©jelos en su lugar. <br><br><img src="https://habrastorage.org/webt/2z/sx/9z/2zsx9zvtkofxy_2uk4au8x1uxbu.jpeg"><br><br>  Si especifica --nohoist = jest, todas las dependencias, excepto jest, ir√°n a la ra√≠z y jest permanecer√° en el nivel del paquete.  No es de extra√±ar que haya dado ese ejemplo: es una broma que tiene problemas con este comportamiento, y nohoist ayuda con esto. <br><br>  Otra ventaja de la recuperaci√≥n de dependencias: <br><br><img src="https://habrastorage.org/webt/yp/1n/ur/yp1nurrr-zokokzjy7rgzvmozzi.jpeg"><br><br>  Si antes de eso ten√≠a un paquete-lock.json separado para cada servicio, para cada paquete, entonces, cuando est√© listo, todo se mueve hacia arriba y queda el √∫nico paquete-lock.json.  Esto es conveniente desde el punto de vista de verter en el maestro, resolviendo conflictos.  Una vez que todos fueron asesinados, y eso es todo. <br><br>  ¬øPero c√≥mo lerna logra esto?  Ella es bastante agresiva con npm.  Cuando especifica el polipasto, toma su package.json en la ra√≠z, lo respalda, lo sustituye por otro, agrega todas sus dependencias, ejecuta npm install, casi todo se coloca en la ra√≠z.  Entonces este paquete temporal.json elimina, restaura el tuyo.  Si despu√©s de eso ejecuta alg√∫n comando con npm, por ejemplo, npm remove, npm no entender√° lo que sucedi√≥, por qu√© todas las dependencias aparecieron repentinamente en la ra√≠z.  Lerna viola el nivel de abstracci√≥n, se mete en la herramienta, que est√° por debajo de su nivel. <br><br>  Los chicos de Yarn fueron los primeros en darse cuenta de este problema y dijeron: qu√© estamos atormentando, d√©jenos hacer todo por usted de forma nativa, para que todo salga de la caja. <br><br><img src="https://habrastorage.org/webt/4l/0q/yb/4l0qybezxp0nwi_fulfgleb11oe.jpeg"><br><br>  Yarn ya puede hacer lo mismo fuera de la caja: dependencias vinculadas, si ve que el paquete B depende del paquete A, har√° un enlace simb√≥lico por usted, de forma gratuita.  √âl sabe c√≥mo aumentar las dependencias, lo hace por defecto, todo se suma a la ra√≠z.  Al igual que lerna, puede dejar el √∫nico hilo.lock en la ra√≠z del repositorio.  Todos los dem√°s hilados.lock que ya no necesitas. <br><br><img src="https://habrastorage.org/webt/wj/bu/e7/wjbue7nf67iucirzohdpfxk75xe.jpeg"><br><br>  Est√° configurado de manera similar.  Desafortunadamente, yarn asume que todas las configuraciones se agregan a package.json, s√© que hay personas que intentan quitar todas las configuraciones de las herramientas desde all√≠, dejando solo un m√≠nimo.  Desafortunadamente, yarn a√∫n no ha aprendido a especificar esto en otro archivo, solo package.json.  Hay dos nuevas opciones, una nueva y otra obligatoria.  Dado que se supone que el repositorio ra√≠z nunca se publicar√°, yarn requiere que private = true se especifique all√≠. <br><br>  Pero la configuraci√≥n de los espacios de trabajo se almacena en la misma clave.  La configuraci√≥n es muy similar a la configuraci√≥n de lerna, hay un campo de paquetes donde especificas la ubicaci√≥n de tus paquetes y hay una opci√≥n de nohoist, muy similar a la opci√≥n de nohoist en lerna.  Simplemente especifique estas configuraciones y obtenga la misma estructura que en lerna.  Todas las dependencias comunes fueron a la ra√≠z, y las especificadas en la clave nohoist se mantuvieron en su nivel. <br><br><img src="https://habrastorage.org/webt/6w/rj/8c/6wrj8cm-b68sgcbsm0gstgmwzm8.jpeg"><br><br>  La mejor parte es que lerna puede trabajar con hilo y recoger su configuraci√≥n.  Es suficiente especificar dos campos en lerna.json, lerna inmediatamente comprender√° que est√° utilizando hilo, vaya a package.json, obtenga todos los ajustes desde all√≠ y trabaje con ellos.  Estas dos herramientas ya se conocen entre s√≠ y trabajan juntas. <br><br><img src="https://habrastorage.org/webt/q5/hs/em/q5hsemi5za3meeg_s7zjj0sak4g.jpeg"><br><br>  ¬øY por qu√© todav√≠a no se ha brindado soporte en npm si tantas grandes empresas usan un mono-repositorio? <br><br><img src="https://habrastorage.org/webt/h1/al/n6/h1aln6qeuati1bbhmojwgtao1xo.jpeg"><br><h5>  <sup><sub><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sub></sup> </h5><br>  Dicen que todo lo ser√°, pero en la s√©ptima versi√≥n.  Soporte b√°sico en el s√©ptimo, extendido - en el octavo.  Esta publicaci√≥n se lanz√≥ hace un mes, pero al mismo tiempo, a√∫n se desconoce la fecha en que se lanzar√° la s√©ptima npm.  Estamos esperando que finalmente se ponga al d√≠a con el hilo. <br><br>  Cuando tiene varios servicios en un mono-repositorio, inevitablemente surge la pregunta de c√≥mo administrarlos para no ir a cada carpeta, no ejecutar comandos.  Hay operaciones masivas para esto. <br><br><img src="https://habrastorage.org/webt/8f/9z/lk/8f9zlkf-hdow1itwrmkiczqm5pk.jpeg"><br><br><img src="https://habrastorage.org/webt/ux/z_/ed/uxz_edv1rkl4bjlydo8q8pndty8.jpeg"><br><br>  Yarn tiene un comando de espacio de trabajo de hilo, seguido del nombre del paquete y el nombre del comando.  Dado que yarn from the box, a diferencia de npm, puede hacer las tres cosas: ejecutar sus propios comandos, agregar una dependencia en jest, ejecutar scripts desde package.json, como test, y tambi√©n puede ejecutar archivos ejecutables desde la carpeta node_modules / .bin.  √âl te ense√±ar√° con la ayuda de la heur√≠stica, √©l comprender√° lo que quieres.  Es muy conveniente utilizar el espacio de trabajo de hilo para operaciones puntuales en un paquete. <br><br>  Hay un comando similar que le permite ejecutar un comando en todos los paquetes que tenga. <br><br><img src="https://habrastorage.org/webt/-e/yn/vd/-eynvdikhrjyxn0we1fkw0loqcw.jpeg"><br><br>  Indique solo sus comandos con todos los argumentos. <br><br><img src="https://habrastorage.org/webt/qk/_t/lx/qk_tlxutn7it2owurvm5ne444o8.jpeg"><br><br>  De los profesionales, es muy conveniente dirigir diferentes equipos.  De los inconvenientes, por ejemplo, es imposible ejecutar comandos de shell.  Supongamos que quiero eliminar todas las carpetas de m√≥dulos de nodo, no puedo ejecutar espacios de trabajo de hilo ejecutar rm. <br>  Es imposible especificar una lista de paquetes, por ejemplo, quiero eliminar la dependencia en solo dos paquetes, solo a su vez o individualmente. <br><br>  Bueno, se estrella con el primer error.  Si quiero eliminar la dependencia de todos los paquetes, y de hecho, solo dos de ellos la tienen, pero no quiero pensar d√≥nde est√°, pero solo quiero eliminarla, entonces el hilo no lo permitir√°, se bloquear√° en la primera situaci√≥n donde este paquete no est√° en las dependencias.  Esto no es muy conveniente, a veces desea ignorar los errores, ejecutar todos los paquetes. <br><br><img src="https://habrastorage.org/webt/gv/bj/ax/gvbjax1gepdak6jwcxpf7q9u8ea.jpeg"><br><br>  Lerna tiene un kit de herramientas mucho m√°s interesante, hay dos comandos separados de ejecuci√≥n y ejecuci√≥n.  Run puede ejecutar scripts desde package.json, y a diferencia del hilo, puede filtrar todo por paquete, puede especificar --scope, puede usar asteriscos, globos, todo es bastante universal.  Puede ejecutar estas operaciones en paralelo, puede ignorar los errores a trav√©s del interruptor --no-bail. <br><br><img src="https://habrastorage.org/webt/j9/f_/km/j9f_kmpn1tkhfr88nsjykrunm5g.jpeg"><br><br>  Exec es muy similar.  A diferencia de yarn, le permite no solo ejecutar archivos ejecutables desde node_modules.bin, sino tambi√©n ejecutar cualquier comando de shell arbitrario.  Por ejemplo, puede eliminar node_modules o ejecutar alguna marca, lo que quiera.  Y la misma opci√≥n es compatible. <br><br><img src="https://habrastorage.org/webt/t4/f4/tv/t4f4tv2z0646cgezhzwamag6qgm.jpeg"><br><br>  Herramientas muy convenientes, algunas ventajas.  Este es el caso cuando Lerna rasga el hilo, est√° en el nivel correcto de abstracci√≥n.  Esto es exactamente lo que lerna necesita: simplificar el trabajo con varios paquetes en monorepe. <br><br>  Con monoreps hay un menos m√°s.  Cuando tiene un CI / CD, no puede optimizarlo.  Cuantos m√°s servicios tenga, m√°s tardar√° todo.  Suponga que comienza a probar todos los servicios para cada solicitud de grupo, y cuanto m√°s haya, m√°s tiempo llevar√° el trabajo.  Las operaciones selectivas se pueden utilizar para optimizar este proceso.  Voy a nombrar tres formas diferentes.  Los dos primeros se pueden usar no solo en monorep, sino tambi√©n en sus proyectos, si por alguna raz√≥n no usa estos m√©todos. <br><br>  El primero es lint-stage, que le permite ejecutar linter, pruebas, todo lo que desee, solo a los archivos que han cambiado o ser√°n confirmados en este commit.  Ejecute toda la pelusa no en todo su proyecto, sino solo en los archivos que han cambiado. <br><br><img src="https://habrastorage.org/webt/7v/qj/4z/7vqj4zxxvjc3fyt_bs5nfbk85nc.jpeg"><br><br><img src="https://habrastorage.org/webt/dx/if/eu/dxifeu43kvhxy7kthspwefr2o8m.jpeg"><br><br>  La configuraci√≥n es muy simple.  Ponga enganchados con pelusa, husky, pre-commit-hooks y diga que al cambiar cualquier archivo js necesita ejecutar eslint.  Por lo tanto, la verificaci√≥n previa a la confirmaci√≥n se acelera enormemente.  Especialmente si tiene muchos servicios, un mono-repositorio muy grande.  Luego, ejecutar eslint en todos los archivos es demasiado costoso, y puede optimizar los enlaces de precompromiso en lint de esta manera. <br><br><img src="https://habrastorage.org/webt/x9/n7/dg/x9n7dgdih-y-zepifpkfd9czys8.jpeg"><br><br>  Si escribe pruebas en Jest, tambi√©n tiene herramientas para ejecutar pruebas selectivamente. <br><br><img src="https://habrastorage.org/webt/gd/fp/op/gdfpopeopfjlht4excpli5ec0d8.jpeg"><br><br>  Esta opci√≥n le permite darle una lista de archivos de origen y encontrar todas las pruebas que afectan de una forma u otra a estos archivos.  ¬øQu√© se puede usar junto con pelusa puesta en escena?  ,      js-,   .    js-   ,   .  findRelatedTests          ,   . <br><br>   ,    .  lerna,   ,        .      ,    CI/CD: Travis   ,   . <br><br><img src="https://habrastorage.org/webt/bn/is/ij/bnisijuykjzbkbi6-mhd19lwvmq.jpeg"><br><br><img src="https://habrastorage.org/webt/ul/d4/u2/uld4u2saou9lwemuj2ky4usffyu.jpeg"><br><br>   run  exec   since,        ,    - .      ,      .    ,      CI/CD     -,      . <br><br>  lerna     ,      .     ,     ,     , lerna  . ,      .    ,   C   ‚Äî ,      .  lerna      . <br><br>   ,    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c lerna</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  yarn workspaces   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>      . <br><br>  ,   .  ,   .    .  ?    ,        ,       ,   .  ,         ,     .    ,   -      . ,      Babel.     ,   ,     .                  .     ,           . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quiero agradecer a mis colegas: Misha </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mishanga</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Troshev y Gosha Besedin. </font><font style="vertical-align: inherit;">Pasaron bastante tiempo estudiando las herramientas que revisamos hoy y compartieron su experiencia y conocimiento. </font><font style="vertical-align: inherit;">Eso es todo, gracias.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/469021/">https://habr.com/ru/post/469021/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../469007/index.html">RubyRussia 2019. Nikita Shilnikov sobre los efectos algebraicos</a></li>
<li><a href="../469009/index.html">Culto a la carga en el desarrollo de software</a></li>
<li><a href="../469011/index.html">11 mitos sobre USB tipo C</a></li>
<li><a href="../469015/index.html">Slurm: Mosc√∫ intensivo por Kubernetes y otros anuncios</a></li>
<li><a href="../469019/index.html">SPA Meetup 5: integraci√≥n de Jest con QA, potente UIKit, bibliotecas de componentes, DI para escalado, comandos de plataforma</a></li>
<li><a href="../469023/index.html">C√≥mo encontrar un trabajo con la reubicaci√≥n en Europa: una gu√≠a pr√°ctica para profesionales de TI</a></li>
<li><a href="../469025/index.html">¬°Enfr√≠e el vino r√°pidamente! Invento ruso</a></li>
<li><a href="../469027/index.html">Ivanovo! Mitap: ¬øC√≥mo construir una carrera en Digital?</a></li>
<li><a href="../469031/index.html">12 nuevas inteligencia artificial de Azure Media Services</a></li>
<li><a href="../469033/index.html">Lanzamiento de la plataforma Elbrus para redes neuronales PuzzleLib</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>