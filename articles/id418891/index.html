<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôìÔ∏è üë∂üèΩ üë©üèæ‚Äçü§ù‚Äçüë©üèº Kami memeriksa kode sumber Android menggunakan PVS-Studio, atau tidak ada yang sempurna ‚õîÔ∏è üïµüèø ü§∑üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A. 
 Pengembangan proyek kompleks besar tidak mungkin tanpa menggunakan metodologi dan alat pemrograman untuk membantu mengontrol kualitas kode. Perta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami memeriksa kode sumber Android menggunakan PVS-Studio, atau tidak ada yang sempurna</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/418891/">  A. <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d66/7b5/688/d667b56886adb4c140b623e5c14d4fd5.png" alt="Android dan Unicorn PVS-Studio"></div><br>  Pengembangan proyek kompleks besar tidak mungkin tanpa menggunakan metodologi dan alat pemrograman untuk membantu mengontrol kualitas kode.  Pertama-tama, ini adalah standar pengkodean yang kompeten, ulasan kode, pengujian unit, penganalisa kode statis dan dinamis.  Semua ini membantu mengidentifikasi cacat dalam kode pada tahap awal pengembangan.  Artikel ini menunjukkan kemampuan analisa statis PVS-Studio untuk mendeteksi kesalahan dan kerentanan potensial dalam kode sistem operasi Android.  Kami berharap bahwa artikel ini akan menarik pembaca ke metodologi analisis kode statis dan mereka ingin mengimplementasikannya dalam proses pengembangan proyek mereka sendiri. <br><a name="habracut"></a><br><h2>  Pendahuluan </h2><br>  Setahun telah berlalu sejak penulisan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> besar tentang kesalahan pada sistem operasi Tizen, dan saya ingin sekali lagi melakukan penelitian yang sama menariknya dari beberapa sistem operasi.  Pilihannya jatuh pada Android. <br><br>  Kode sistem operasi Android berkualitas, teruji dengan baik.  Selama pengembangan, setidaknya penganalisa kode statis Coverity digunakan, sebagaimana dibuktikan oleh komentar dari formulir: <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Coverity: [FALSE-POSITIVE error] intended fall through */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Missing break statement between cases in switch statement */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* fall through */</span></span></code> </pre> <br>  Secara umum, ini adalah proyek yang menarik, berkualitas tinggi, dan menemukan kesalahan di dalamnya merupakan tantangan bagi analisa statis PVS-Studio kami. <br><br>  Saya berpikir bahwa hanya dengan volume artikel pembaca mengerti bahwa penganalisa PVS-Studio melakukan pekerjaan yang sangat baik dan menemukan banyak cacat dalam kode sistem operasi ini. <br><br><h2>  Enumerasi kelemahan umum </h2><br>  Dalam artikel ini Anda akan menemukan referensi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Common Weakness Enumeration</a> (CWE).  Mari kita jelaskan alasan untuk merujuk ke daftar ini dan mengapa ini penting dari sudut pandang keamanan. <br><br>  Seringkali penyebab kerentanan dalam program bukanlah beberapa keadaan rumit, tetapi kesalahan perangkat lunak dangkal.  Di sini akan tepat mengutip kutipan ini dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">prqa.com</a> : <br><br>  Institut Nasional Standar dan Teknologi (NIST) melaporkan bahwa 64% kerentanan perangkat lunak berasal dari kesalahan pemrograman dan bukan kurangnya fitur keamanan. <br><br>  Anda dapat membaca di artikel ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagaimana PVS-Studio dapat membantu menemukan kerentanan?</a> ‚Äù Dengan beberapa contoh kesalahan sederhana yang menyebabkan kerentanan dalam proyek-proyek seperti MySQL, iOS, NAS, illumos-gate. <br><br>  Oleh karena itu, banyak kerentanan dapat dihilangkan dengan mendeteksi kesalahan umum dalam waktu dan memperbaikinya.  Dan di sini Enumerasi Kelemahan Umum memasuki lokasi. <br><br>  Kesalahan berbeda, dan tidak semua kesalahan berbahaya dari sudut pandang keamanan.  Kesalahan yang berpotensi menyebabkan kerentanan dikumpulkan dalam Penghitungan Kelemahan Umum.  Daftar ini sedang diperbarui, dan mungkin ada kesalahan yang dapat menyebabkan kerentanan, tetapi mereka belum dimasukkan dalam daftar ini. <br><br>  Namun, jika kesalahan diklasifikasikan menurut CWE, maka itu berarti bahwa secara teori dimungkinkan bahwa itu dapat dieksploitasi sebagai kerentanan ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CVE</a> ).  Ya, kemungkinan ini kecil.  Sangat jarang, CWE berubah menjadi CVE.  Namun, jika Anda ingin melindungi kode Anda dari kerentanan, Anda harus, jika mungkin, menemukan sebanyak mungkin bug yang dijelaskan dalam CWE dan memperbaikinya. <br><br>  Secara skematis, hubungan antara PVS-Studio, kesalahan, CWE dan CVE ditunjukkan pada gambar: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/06f/5b9/142/06f5b9142918167cf4e0951f3affbaa6.png" alt="CWE, CVE, PVS-Studio"></div><br><br>  Beberapa kesalahan diklasifikasikan sebagai CWE.  PVS-Studio dapat mendeteksi banyak kesalahan ini, sehingga mencegah beberapa cacat ini menjadi kerentanan (CVE). <br><br>  Kita dapat mengatakan bahwa PVS-Studio mengidentifikasi banyak kerentanan potensial sebelum menyebabkan kerusakan.  Dengan demikian, PVS-Studio adalah alat pengujian keamanan aplikasi statis ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SAST</a> ). <br><br>  Sekarang, saya pikir, jelas mengapa, ketika menggambarkan kesalahan, saya menganggap penting untuk mencatat bagaimana mereka diklasifikasikan menurut CWE.  Dengan cara ini lebih mudah untuk menunjukkan pentingnya menggunakan penganalisa kode statis dalam proyek-proyek penting, yang berhubungan dengan sistem operasi. <br><br><h2>  Cek Android </h2><br>  Untuk menganalisis proyek, saya menggunakan penganalisa PVS-Studio versi 6.24.  Penganalisa saat ini mendukung bahasa dan kompiler berikut: <br><br><ul><li>  Windows  Visual Studio 2010-2017 C, C ++, C ++ / CLI, C ++ / CX (WinRT), C # </li><li>  Windows  IAR Embedded Workbench, C / C ++ Compiler untuk ARM C, C ++ </li><li>  Windows / Linux  Keil ŒºVision, DS-MDK, ARM Compiler 5/6 C, C ++ </li><li>  Windows / Linux  Studio Komposer Kode Texas Instruments, Alat Pembuatan Kode ARM C, C ++ </li><li>  Windows / Linux / macOS.  Dentang C, C ++ </li><li>  Linux / macOS.  GCC C, C ++ </li><li>  Windows  MinGW C, C ++ </li></ul><br>  Catatan  Mungkin beberapa pembaca kami telah ketinggalan berita bahwa kami mendukung pekerjaan di lingkungan macOS dan mereka akan tertarik dengan publikasi ini: " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">rilis PVS-Studio untuk macOS: 64 kelemahan di Apple XNU Kernel</a> ". <br><br>  Proses memeriksa kode sumber Android tidak menjadi masalah, jadi saya tidak akan membahasnya.  Masalahnya, alih-alih, adalah keasyikan saya dengan tugas-tugas lain, itulah sebabnya saya tidak menemukan waktu dan energi untuk melihat laporan dengan hati-hati seperti yang saya inginkan.  Namun, bahkan melihat sekilas lebih dari cukup untuk mengumpulkan banyak koleksi kesalahan menarik untuk artikel yang solid. <br><br>  Yang paling penting: Saya meminta pengembang Android tidak hanya untuk memperbaiki kesalahan yang dijelaskan dalam artikel, tetapi juga untuk melakukan analisis independen yang lebih hati-hati.  Saya melihat laporan analisa secara dangkal dan bisa melewatkan banyak kesalahan serius. <br><br>  Pada tes pertama, penganalisa akan menghasilkan banyak positif palsu, tetapi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini bukan masalah</a> .  Tim kami siap membantu dengan rekomendasi untuk mengonfigurasi analisator untuk mengurangi jumlah positif palsu.  Kami juga siap memberikan kunci lisensi selama sebulan atau lebih, jika perlu.  Secara umum, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kirim surat kepada kami</a> , kami akan membantu dan memberi tahu Anda. <br><br>  Sekarang mari kita lihat kesalahan apa dan potensi kerentanan yang berhasil saya temukan.  Saya harap Anda menikmati apa yang dapat ditemukan oleh penganalisa kode statis PVS-Studio.  Selamat membaca. <br><br><h2>  Perbandingan tidak berarti </h2><br>  Penganalisa menganggap ekspresi tidak normal jika selalu benar atau salah.  Peringatan tersebut, menurut Penghitungan Kelemahan Umum, diklasifikasikan sebagai: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-570</a> : Ekspresi Selalu Salah </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-571</a> : Ekspresi Selalu Benar </li></ul><br>  Penganalisis menghasilkan banyak peringatan seperti itu, dan, sayangnya, sebagian besar dari mereka salah untuk kode Android.  Dalam hal ini, penganalisa tidak bisa disalahkan.  Hanya kodenya yang ditulis seperti itu. <br>  Saya akan menunjukkan ini dengan contoh sederhana. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> GENERIC_TARGET const char alternative_config_path[] = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/data/nfc/"</span></span></span><span class="hljs-meta">; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> const char alternative_config_path[] = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> CNxpNfcConfig&amp; CNxpNfcConfig::GetInstance() { .... </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (alternative_config_path[0] != </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'\0'</span></span></span><span class="hljs-meta">) { .... }</span></span></code> </pre> <br>  Di sini penganalisis menghasilkan peringatan: V547 CWE-570 Ekspresi 'alternative_config_path [0]! =' \ 0 '' selalu salah.  phNxpConfig.cpp 401 <br><br>  Faktanya adalah bahwa makro <i>GENERIC_TARGET</i> tidak didefinisikan, dan dari sudut pandang penganalisa, kode terlihat seperti ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> alternative_config_path[] = <span class="hljs-string"><span class="hljs-string">""</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (alternative_config_path[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) {</code> </pre> <br>  Penganalisa hanya berkewajiban untuk mengeluarkan peringatan, karena jalurnya kosong, dan terminal nol selalu berada di nol offset.  Dengan demikian, penganalisa secara formal benar dalam mengeluarkan peringatan.  Namun, dari sudut pandang praktis, tidak ada manfaat dari peringatan ini. <br><br>  Sayangnya, tidak ada yang bisa dilakukan dengan situasi seperti itu.  Kami harus meninjau secara sistematis semua peringatan semacam itu dan menandai banyak tempat sebagai positif palsu sehingga penganalisa tidak lagi mengeluarkan pesan pada baris ini.  Ini benar-benar perlu dilakukan, karena, selain pesan yang tidak berarti, banyak kesalahan nyata akan ditemukan. <br><br>  Jujur saya akui bahwa saya tidak tertarik hati-hati melihat peringatan jenis ini, dan saya pergi mereka secara dangkal.  Namun, bahkan ini akan cukup untuk menunjukkan bahwa diagnostik seperti itu sangat berguna dan menemukan kesalahan yang menarik. <br><br>  Saya ingin memulai dengan situasi klasik ketika fungsi membandingkan dua objek salah diimplementasikan.  Mengapa klasik?  Ini adalah pola kesalahan khas yang terus-menerus kita temui dalam berbagai proyek.  Kemungkinan besar, ada tiga alasan terjadinya: <br><br><ol><li>  Fungsi perbandingannya sederhana dan ditulis "secara otomatis" dan menggunakan teknologi Copy-Paste.  Saat menulis kode seperti itu, seseorang lalai dan sering membuat kesalahan ketik. </li><li>  Biasanya, peninjauan kode tidak dilakukan untuk fungsi-fungsi seperti itu, karena terlalu malas untuk melihat fungsi-fungsi yang sederhana dan membosankan. </li><li>  Tes unit biasanya tidak dilakukan untuk fungsi tersebut.  Karena malas.  Selain itu, fungsinya sederhana, dan pemrogram tidak berpikir bahwa ada kemungkinan kesalahan di dalamnya. </li></ol><br>  Pikiran-pikiran dan contoh-contoh ini dijelaskan secara lebih rinci dalam artikel " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Jahat hidup dalam fungsi perbandingan</a> ." <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAudioPlaybackRateEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AudioPlaybackRate &amp;pr1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AudioPlaybackRate &amp;pr2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(pr1.mSpeed - pr2.mSpeed) &lt; AUDIO_TIMESTRETCH_SPEED_MIN_DELTA &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">fabs</span></span>(pr1.mPitch - pr2.mPitch) &lt; AUDIO_TIMESTRETCH_PITCH_MIN_DELTA &amp;&amp; pr2.mStretchMode == pr2.mStretchMode &amp;&amp; pr2.mFallbackMode == pr2.mFallbackMode; }</code> </pre> <br>  Jadi, sebelum kita adalah fungsi klasik membandingkan dua objek bertipe <i>AudioPlaybackRate</i> .  Dan, seperti yang saya pikirkan, pembaca menduga itu salah.  Analyzer PVS-Studio segera mengetahui dua kesalahan ketik: <br><br><ul><li>  V501 CWE-571 Ada sub-ekspresi yang identik ke kiri dan ke kanan operator '==': pr2.mStretchMode == pr2.mStretchMode AudioResamplerPublic.h 107 </li><li>  V501 CWE-571 Ada sub-ekspresi identik ke kiri dan ke kanan operator '==': pr2.mFallbackMode == pr2.mFallbackMode AudioResamplerPublic.h 108 </li></ul><br>  Bidang <i>pr2.mStretchMode</i> dan bidang <i>pr2.mFallbackMode</i> dibandingkan dengan mereka sendiri.  Ternyata fungsinya tidak membandingkan objek dengan cukup akurat. <br><br>  Perbandingan tidak berguna berikut ini hidup dalam fungsi yang menyimpan informasi sidik jari dalam file. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveFingerprint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">worker_thread_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* listener, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> idx)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ns = fwrite(&amp;listener-&gt;secureid[idx], <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, fp); .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nf = fwrite(&amp;listener-&gt;fingerid[idx], <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, fp); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ns != <span class="hljs-number"><span class="hljs-number">1</span></span> || ns !=<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= ALOGW("Corrupt emulator fingerprints storage; " "could not save fingerprints"); fclose(fp); return; }</span></span></code> </pre> <br>  Anomali terdeteksi dalam kode ini oleh dua diagnostik sekaligus: <br><br><ul><li>  V501 CWE-570 Ada sub-ekspresi yang identik ke kiri dan ke kanan '||'  operator: ns! = 1 ||  ns! = 1 sidik jari.c 126 </li><li>  V560 CWE-570 Bagian dari ekspresi kondisional selalu salah: ns! = 1. fingerprint.c 126 </li></ul><br>  Tidak ada penanganan situasi ketika panggilan kedua ke fungsi <i>fwrite</i> tidak dapat menulis data ke file.  Dengan kata lain, nilai variabel <i>nf</i> tidak dicentang.  Cek yang benar akan terlihat seperti ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ns != <span class="hljs-number"><span class="hljs-number">1</span></span> || nf != <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Kami melanjutkan ke kesalahan berikutnya yang terkait dengan penggunaan <i>&amp;</i> operator. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> O_RDONLY 00000000 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> O_WRONLY 00000001 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> O_RDWR 00000002 static ssize_t verity_read(fec_handle *f, ....) { .... </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* if we are in read-only mode and expect to read a zero block, skip reading and just return zeros */</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (f-&gt;mode &amp; O_RDONLY &amp;&amp; expect_zeros) { memset(data, 0, FEC_BLOCKSIZE); goto valid; } .... }</span></span></code> </pre> <br>  Peringatan PVS-Studio: V560 CWE-570 Bagian dari ekspresi kondisional selalu salah: mode f-&gt; &amp; 00000000. fec_read.cpp 322 <br><br>  Perhatikan bahwa konstanta <i>O_RDONLY</i> adalah nol.  Ini membuat ekspresi <i>f-&gt; mode &amp; O_RDONLY</i> tidak berguna, karena selalu 0. Ternyata kondisi <i>pernyataan if</i> tidak pernah puas, dan statement-true adalah kode mati. <br><br>  Cek yang benar harus seperti ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f-&gt;mode == O_RDONLY &amp;&amp; expect_zeros) {</code> </pre> <br>  Sekarang mari kita lihat salah ketik klasik ketika kita lupa untuk menulis bagian dari kondisinya. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> { .... CHANGE_DISPLAY_INFO = <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>, .... }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> RotaryEncoderInputMapper::configure(<span class="hljs-keyword"><span class="hljs-keyword">nsecs_t</span></span> when, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InputReaderConfiguration* config, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> changes) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!changes || (InputReaderConfiguration::CHANGE_DISPLAY_INFO)) { .... }</code> </pre> <br>  Peringatan PVS-Studio: V768 CWE-571 Konstanta penghitungan 'CHANGE_DISPLAY_INFO' digunakan sebagai variabel tipe-Boolean.  InputReader.cpp 3016 <br><br>  <i>Syaratnya</i> selalu benar, karena operan <i>InputReaderConfiguration :: CHANGE_DISPLAY_INFO</i> adalah konstanta sama dengan 4. <br><br>  Jika Anda melihat bagaimana kode ditulis di lingkungan, menjadi jelas bahwa sebenarnya kondisinya harus seperti ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!changes || (changes &amp; InputReaderConfiguration::CHANGE_DISPLAY_INFO)) {</code> </pre> <br>  Perbandingan berikut, yang tidak masuk akal, saya temui di loop operator. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_printerAttributes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">ipp_t</span></span> *collection = ippGetCollection(attrptr, i); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j = <span class="hljs-number"><span class="hljs-number">0</span></span>, attrptr = ippFirstAttribute(collection); (j &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp;&amp; (attrptr != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); attrptr = ippNextAttribute(collection)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, ippGetName(attrptr)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ....TopMargin = ippGetInteger(attrptr, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, ippGetName(attrptr)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ....BottomMargin = ippGetInteger(attrptr, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, ippGetName(attrptr)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ....LeftMargin = ippGetInteger(attrptr, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, ippGetName(attrptr)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ....RightMargin = ippGetInteger(attrptr, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } .... }</code> </pre> <br>  Peringatan PVS-Studio: V560 CWE-571 Bagian dari ekspresi kondisional selalu benar: (j &lt;4).  ipphelper.c 926 <br><br>  Perhatikan bahwa nilai variabel <i>j</i> tidak bertambah di mana pun.  Ini berarti bahwa subekspresi <i>(j &lt;4)</i> selalu benar. <br><br>  Jumlah terbesar dari operasi yang berguna dari analisa PVS-Studio, mengenai selalu kondisi benar / salah, mengacu pada kode di mana hasil dari membuat objek diperiksa menggunakan operator <i>baru</i> .  Dengan kata lain, alat analisa mendeteksi pola kode berikut: <br><br><pre> <code class="cpp hljs">T *p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> T; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ERROR;</code> </pre> <br>  Pemeriksaan semacam itu tidak ada gunanya.  Jika tidak memungkinkan untuk mengalokasikan memori untuk objek, pengecualian dari tipe <i>std :: bad_alloc dilemparkan,</i> dan itu hanya tidak akan sampai ke pengecekan nilai pointer. <br><br>  Catatan  Operator <i>baru</i> dapat mengembalikan <i>nullptr dengan</i> menulis <i>baru (std :: nothrow) T.</i>  Namun, ini tidak berlaku untuk kesalahan yang dibahas.  Alat analisis PVS-Studio memperhitungkan <i>(std :: nothrow)</i> dan tidak memberikan peringatan jika objek dibuat dengan cara ini. <br><br>  Tampaknya kesalahan semacam itu tidak berbahaya.  Nah, pikirkan itu, pemeriksaan ekstra yang tidak pernah berhasil.  Pokoknya, akan ada pengecualian yang akan diproses di suatu tempat.  Sayangnya, beberapa pengembang menempatkan pernyataan-benar dari tindakan <i>pernyataan if</i> yang membebaskan sumber daya, dll.  Karena kode ini tidak dieksekusi, maka dapat menyebabkan kebocoran memori dan kesalahan lainnya. <br><br>  Pertimbangkan salah satu dari kasus ini yang saya perhatikan dalam kode Android. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_apk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *target_package_name)</span></span></span><span class="hljs-function"> </span></span>{ .... FileMap *dataMap = zip-&gt;createEntryFileMap(entry); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataMap == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { ALOGW(<span class="hljs-string"><span class="hljs-string">"%s: failed to create FileMap\n"</span></span>, __FUNCTION__); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *buf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[uncompLen]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == buf) { ALOGW(<span class="hljs-string"><span class="hljs-string">"%s: failed to allocate %"</span></span> PRIu32 <span class="hljs-string"><span class="hljs-string">" byte\n"</span></span>, __FUNCTION__, uncompLen); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> dataMap; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } .... }</code> </pre> <br>  Peringatan PVS-Studio: V668 CWE-570 Tidak ada gunanya menguji pointer 'buf' terhadap null, karena memori dialokasikan menggunakan operator 'baru'.  Pengecualian akan dihasilkan jika terjadi kesalahan alokasi memori.  scan.cpp 213 <br><br>  Harap dicatat bahwa jika tidak mungkin mengalokasikan blok memori kedua, programmer mencoba membebaskan blok pertama: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> dataMap;</code> </pre> <br>  Kode ini tidak akan pernah mendapatkan kontrol.  Ini kode mati.  Jika pengecualian terjadi, kebocoran memori akan terjadi. <br><br>  Menulis kode seperti itu pada dasarnya salah.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pointer pintar</a> diciptakan untuk kasus seperti itu. <br><br>  Secara total, penganalisa PVS-Studio mendeteksi <b>176</b> tempat dalam kode Android di mana pointer diperiksa setelah membuat objek menggunakan yang <i>baru</i> .  Saya tidak mengerti betapa berbahayanya tempat-tempat ini, dan, tentu saja, saya tidak akan mengacaukan artikel dengan semua peringatan ini.  Mereka yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tertarik</a> dapat melihat peringatan lain di file <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Android_V668.txt</a> . <br><br><h2>  Mendereferensi pointer nol </h2><br>  Mendereferensi pointer nol mengarah ke perilaku program yang tidak terdefinisi, sehingga berguna untuk menemukan dan memperbaiki tempat-tempat tersebut.  Bergantung pada situasinya, penganalisis PVS-Studio dapat mengklasifikasikan kesalahan ini menurut Penghitungan Kelemahan Umum sebagai berikut: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-119</a> : Pembatasan Operasi yang Tidak Tepat dalam Batas-Batas Penyangga Memori </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-476</a> : NULL Pointer Dereference </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-628</a> : Function Call dengan Argumen yang Tidak Benar </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-690</a> : Nilai Pengembalian Tidak Dicentang ke NULL Pointer Dereference </li></ul><br>  Saya sering menemukan kesalahan dalam kode yang bertanggung jawab untuk menangani situasi yang tidak standar atau salah.  Tidak ada yang menguji kode seperti itu, dan kesalahan dapat hidup di dalamnya untuk waktu yang sangat lama.  Kasus seperti itu akan dipertimbangkan sekarang. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseEffect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmlProxyLib == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { ALOGE(<span class="hljs-string"><span class="hljs-string">"effectProxy must contain a &lt;%s&gt;: %s"</span></span>, tag, dump(*xmlProxyLib)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } .... }</code> </pre> <br>  Peringatan PVS-Studio: V522 CWE-476 Dereferencing dari null pointer 'xmlProxyLib' mungkin terjadi.  EffectsConfig.cpp 205 <br><br>  Jika pointer <i>xmlProxyLib</i> adalah <i>nullptr</i> , maka programmer akan menampilkan pesan debug, yang perlu dilakukan dereferensi pointer ini.  Ups ... <br><br>  Sekarang pertimbangkan versi kesalahan yang lebih menarik. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">soinfo_unload_impl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(soinfo* root)</span></span></span><span class="hljs-function"> </span></span>{ .... soinfo* needed = find_library(si-&gt;get_primary_namespace(), library_name, RTLD_NOLOAD, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (needed != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= PRINT("warning: couldn't find %s needed by %s on unload.", library_name, si-&gt;get_realpath()); return; } else if (local_unload_list.contains(needed)) { return; } else if (needed-&gt;is_linked() &amp;&amp; // &lt;= needed-&gt;get_local_group_root() != root) { external_unload_list.push_back(needed); } else { unload_list.push_front(needed); } .... }</span></span></code> </pre> <br>  Peringatan PVS-Studio: V522 CWE-476 Dereferencing dari null pointer 'diperlukan' mungkin terjadi.  linker.cpp 1847 <br><br>  Jika pointer <i>diperlukan! = Nullptr</i> , maka peringatan dikeluarkan, yang merupakan perilaku program yang sangat mencurigakan.  Akhirnya menjadi jelas bahwa kode berisi kesalahan jika Anda melihat di bawah dan melihat bahwa ketika <i>diperlukan == nullptr</i> , pointer nol akan <i>ditinjau kembali</i> dalam ekspresi yang <i>diperlukan-&gt; is_linked ()</i> . <br><br>  Kemungkinan besar, operator! = Dan == benar-benar bingung di sini.  Jika Anda mengganti, kode fungsi itu masuk akal, dan kesalahannya hilang. <br><br>  Sebagian besar peringatan tentang potensi dereferencing dari pointer nol mengacu pada situasi formulir: <br><br><pre> <code class="cpp hljs">T *p = (T *) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span> (N); *p = x;</code> </pre> <br>  Fungsi seperti <i>malloc</i> , <i>strdup,</i> dan sebagainya dapat mengembalikan <i>NULL</i> jika memori tidak dapat dialokasikan.  Oleh karena itu, Anda tidak dapat menentukan pointer yang mengembalikan fungsi-fungsi ini tanpa terlebih dahulu memeriksa pointer. <br><br>  Ada banyak kesalahan serupa, jadi saya hanya akan memberikan dua fragmen kode sederhana: yang pertama dengan <br>  <i>malloc</i> dan yang kedua dengan <i>strdup</i> . <br><br><pre> <code class="cpp hljs">DownmixerBufferProvider::DownmixerBufferProvider(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">effect_param_t</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> param = (<span class="hljs-keyword"><span class="hljs-keyword">effect_param_t</span></span> *) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(downmixParamSize); param-&gt;psize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">downmix_params_t</span></span>); .... }</code> </pre> <br>  Peringatan PVS-Studio: V522 CWE-690 Mungkin ada dereferensi dari 'param' penunjuk null potensial.  Periksa baris: 245, 244. BufferProviders.cpp 245 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">descriptorClassToDot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* str)</span></span></span><span class="hljs-function"> </span></span>{ .... newStr = strdup(lastSlash); newStr[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(lastSlash)<span class="hljs-number"><span class="hljs-number">-1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; .... }</code> </pre> <br>  Peringatan PVS-Studio: V522 CWE-690 Mungkin ada referensi negatif tentang potensi pointer nol 'newStr'.  Periksa baris: 203, 202. DexDump.cpp 203 <br><br>  Seseorang mungkin mengatakan bahwa ini adalah kesalahan kecil.  Jika tidak ada cukup memori, maka program hanya akan crash ketika mendereferensi pointer nol, dan ini normal.  Karena tidak ada memori, tidak ada yang bisa dilakukan untuk mengatasi situasi ini. <br><br>  Orang seperti itu salah.  Pointer harus diperiksa!  Saya memeriksa topik ini secara rinci dalam artikel " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengapa penting untuk memeriksa apa fungsi malloc dikembalikan</a> ".  Saya sangat menyarankan Anda membacanya untuk semua orang yang belum membacanya. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/923/793/0c5/9237930c52039f4f7e0542bee775ce72.png" alt="malloc"></div><br><br>  Singkatnya, bahayanya adalah bahwa menulis ke memori mungkin tidak selalu terjadi di dekat alamat nol.  Dimungkinkan untuk menulis data di suatu tempat yang sangat jauh ke dalam halaman memori yang tidak dilindungi tulis, dan dengan demikian menyebabkan kesalahan yang sulit dipahami, atau secara umum kesalahan ini dapat digunakan sebagai kerentanan.  Mari kita lihat apa yang saya maksud dengan contoh fungsi <i>check_size</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">radio_metadata_buffer_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **metadata_ptr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size_int)</span></span></span><span class="hljs-function"> </span></span>{ .... metadata = <span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>(metadata, new_size_int * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>)); memmove( (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *)metadata + new_size_int - (metadata-&gt;count + <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *)metadata + metadata-&gt;size_int - (metadata-&gt;count + <span class="hljs-number"><span class="hljs-number">1</span></span>), (metadata-&gt;count + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>)); .... }</code> </pre> <br>  Peringatan PVS-Studio: V769 CWE-119 Penunjuk '(uint32_t *) metadata' dalam ekspresi '(uint32_t *) metadata + new_size_int' bisa berupa nullptr.  Dalam kasus seperti itu, nilai yang dihasilkan akan menjadi tidak masuk akal dan tidak boleh digunakan.  Periksa baris: 91, 89. radio_metadata.c 91 <br><br>  Saya tidak mengerti logika fungsi, tetapi ini tidak perlu.  Yang utama adalah bahwa buffer baru dibuat dan data disalin di sana.  Jika fungsi <i>realloc</i> mengembalikan <i>NULL</i> , maka data akan disalin ke alamat ((uint32_t *) NULL + metadata-&gt; size_int - (metadata-&gt; count + 1)). <br><br>  Jika nilai <i>metadata-&gt; size_int</i> besar, maka konsekuensinya akan disesalkan.  Ternyata data ditulis ke memori acak. <br><br>  Ngomong-ngomong, ada jenis lain dari null pointer dereferencing, yang digolongkan oleh analyzer PVS-Studio bukan sebagai CWE-690, tetapi sebagai CWE-628 (argumen tidak valid). <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_tcp_ports</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *portstring, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ports)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *buffer; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *cp; buffer = strdup(portstring); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((cp = <span class="hljs-built_in"><span class="hljs-built_in">strchr</span></span>(buffer, <span class="hljs-string"><span class="hljs-string">':'</span></span>)) == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) .... }</code> </pre> <br>  Peringatan PVS-Studio: V575 CWE-628 Potensi null pointer dilewatkan ke fungsi 'strchr'.  Periksa argumen pertama.  Periksa baris: 47, 46. libxt_tcp.c 47 <br><br>  Faktanya adalah bahwa pointer dereferencing akan terjadi ketika fungsi <i>strchr dipanggil</i> .  Oleh karena itu, penganalisa mengartikan situasi ini sebagai memberikan nilai yang salah ke fungsi. <br><br>  Sisa <b>194</b> peringatan dari daftar tipe I ini dalam file <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Android_V522_V575.txt</a> . <br><br>  Omong-omong, perhatian khusus untuk semua kesalahan ini diberikan oleh peringatan yang dibahas sebelumnya tentang memeriksa pointer setelah memanggil operator <i>baru</i> .  Ternyata ada 195 panggilan ke fungsi <i>malloc</i> / <i>realloc</i> / <i>strdup,</i> dan seterusnya, ketika pointer tidak dicentang.  Tetapi ada 176 tempat di mana pointer diperiksa setelah memanggil <i>baru</i> .  Setuju, pendekatan aneh! <br><br>  Pada akhirnya, kita hanya perlu mempertimbangkan peringatan V595 dan V1004, yang juga terkait dengan penggunaan pointer nol. <br><br>  V595 mendeteksi situasi di mana pointer dereferenced dan kemudian diperiksa.  Contoh sintetis: <br><br><pre> <code class="cpp hljs">p-&gt;foo(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!p) Error();</code> </pre> <br>  V1004 mengungkapkan situasi terbalik ketika pointer diperiksa terlebih dahulu, dan kemudian lupa melakukannya.  Contoh sintetis: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p) p-&gt;foo(); p-&gt;doo();</code> </pre> <br>  Mari kita lihat beberapa fragmen kode Android, di mana ada kesalahan jenis ini.      . <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">PV_STATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RC_UpdateBuffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(VideoEncData *video, Int currLayer, Int num_skip)</span></span></span><span class="hljs-function"> </span></span>{ rateControl *rc = video-&gt;rc[currLayer]; MultiPass *pMP = video-&gt;pMP[currLayer]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (video == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || rc == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || pMP == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PV_FAIL; .... }</code> </pre> <br>  PVS-Studio: V595 CWE-476 The 'video' pointer was utilized before it was verified against nullptr. Check lines: 385, 388. rate_control.cpp 385 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resampler_reset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct resampler_itfe *resampler)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resampler</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rsmp</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resampler</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resampler</span></span></span><span class="hljs-class">;</span></span> rsmp-&gt;frames_in = <span class="hljs-number"><span class="hljs-number">0</span></span>; rsmp-&gt;frames_rq = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rsmp != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> &amp;&amp; rsmp-&gt;speex_resampler != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { speex_resampler_reset_mem(rsmp-&gt;speex_resampler); } }</code> </pre> <br>  PVS-Studio: V595 CWE-476 The 'rsmp' pointer was utilized before it was verified against nullptr. Check lines: 54, 57. resampler.c 54 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bta_gattc_disc_cmpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tBTA_GATTC_CLCB* p_clcb, UNUSED_ATTR tBTA_GATTC_DATA* p_data)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_clcb-&gt;status != GATT_SUCCESS) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_clcb-&gt;p_srcb) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;tBTA_GATTC_SERVICE&gt;().swap( p_clcb-&gt;p_srcb-&gt;srvc_cache); } bta_gattc_cache_reset(p_clcb-&gt;p_srcb-&gt;server_bda); } .... }</code> </pre> <br>  PVS-Studio: V1004 CWE-476 The 'p_clcb-&gt;p_srcb' pointer was used unsafely after it was verified against nullptr. Check lines: 695, 701. bta_gattc_act.cc 701 <br><br>      .     ,    ,   -     . <br><br>     : <br><br><ul><li> V1004 CWE-476 The 'ain' pointer was used unsafely after it was verified against nullptr. Check lines: 101, 105. rsCpuIntrinsicBLAS.cpp 105 </li><li> V595 CWE-476 The 'outError' pointer was utilized before it was verified against nullptr. Check lines: 437, 450. Command.cpp 437 </li><li> V595 CWE-476 The 'out_last_reference' pointer was utilized before it was verified against nullptr. Check lines: 432, 436. AssetManager2.cpp 432 </li><li> V595 CWE-476 The 'set' pointer was utilized before it was verified against nullptr. Check lines: 4524, 4529. ResourceTypes.cpp 4524 </li><li> V595 CWE-476 The 'reply' pointer was utilized before it was verified against nullptr. Check lines: 126, 133. Binder.cpp 126 </li><li> V595 CWE-476 The 'video' pointer was utilized before it was verified against nullptr. Check lines: 532, 540. rate_control.cpp 532 </li><li> V595 CWE-476 The 'video' pointer was utilized before it was verified against nullptr. Check lines: 702, 711. rate_control.cpp 702 </li><li> V595 CWE-476 The 'pInfo' pointer was utilized before it was verified against nullptr. Check lines: 251, 254. ResolveInfo.cpp 251 </li><li> V595 CWE-476 The 'address' pointer was utilized before it was verified against nullptr. Check lines: 53, 55. DeviceHalHidl.cpp 53 </li><li> V595 CWE-476 The 'halAddress' pointer was utilized before it was verified against nullptr. Check lines: 55, 82. DeviceHalHidl.cpp 55 </li></ul><br>     ,      .     ,     .     ,         . <br><br>            : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NJ_EXTERN NJ_INT16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">njx_search_word</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NJ_CLASS *iwnn, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... NJ_PREVIOUS_SELECTION_INFO *prev_info = &amp;(iwnn-&gt;previous_selection); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (iwnn == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NJ_SET_ERR_VAL(NJ_FUNC_NJ_SEARCH_WORD, NJ_ERR_PARAM_ENV_NULL); } .... }</code> </pre> <br>  PVS-Studio: V595 CWE-476 The 'iwnn' pointer was utilized before it was verified against nullptr. Check lines: 686, 689. ndapi.c 686 <br><br>  ,    ,   ¬´   ¬ª.     . ,   <i>iwnn</i> ,     . ,    ,        . <br><br> ,   .      ,     .     , ,  : <br><br><ol><li>  ,   : <i>iwnn-&gt;previous_selection</i> </li><li>    ,   undefined behavior </li><li>   ,   <i>iwnn</i>   </li><li>    : if (iwnn == NULL) </li><li> ,          ,          </li></ol><br>         " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">      </a> ". <br><br><h2>       </h2><br>     ,    Common Weakness Enumeration  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-14</a> : Compiler Removal of Code to Clear Buffers. <br><br>  ,    :      <i>memset</i> ,       . <br><br>       ,   ,      ,   . ,   .    ,     : <br><br><ul><li>  . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   </a> . </li><li> Common Weakness Enumeration. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-14</a> . </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V597</a> . </li></ul><br>  ,  .      Android?  Tentu saja ada.     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proof</a> :). <br><br>    Android       <i>FwdLockGlue_InitializeRoundKeys</i> ,     . <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FwdLockGlue_InitializeRoundKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> keyEncryptionKey[KEY_SIZE]; .... <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(keyEncryptionKey, <span class="hljs-number"><span class="hljs-number">0</span></span>, KEY_SIZE); <span class="hljs-comment"><span class="hljs-comment">// Zero out key data. }</span></span></code> </pre> <br>  PVS-Studio: V597 CWE-14 The compiler could delete the 'memset' function call, which is used to flush 'keyEncryptionKey' buffer. The memset_s() function should be used to erase the private data. FwdLockGlue.c 102 <br><br>  <i>keyEncryptionKey</i>       .        ,        .     ,   ,   " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  ‚Äî ?</a> ". <br><br>          <i>memset</i> .  ¬´Zero out key data¬ª ,     . <br><br>   ,         release-    <i>memset</i> .     <i>memset</i>  ,      <i>memset</i>      . <br><br>  <b>10</b>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Android_V597.txt</a> . <br><br>    ,    ,      <i>memset</i>   . <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SHA1Transform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">], </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> buffer[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">64</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> a, b, c, d, e; .... <span class="hljs-comment"><span class="hljs-comment">/* Wipe variables */</span></span> a = b = c = d = e = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  PVS-Studio: V1001 CWE-563 The 'a' variable is assigned but is not used until the end of the function. sha1.c 213 <br><br> PVS-Studio  ,   ,     ,    .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-563</a> : Assignment to Variable without Use. , ,  , ,   ,       CWE-14.    ,       C  C++  .         <i>a</i> , <i>b</i> , <i>c</i> , <i>d</i>  <i>e</i> ,   . <br><br><h2> Unspecified/implementation-defined behavior </h2><br>     ,    ,       . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> GGLfixed; <span class="hljs-function"><span class="hljs-function">GGLfixed </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gglFastDivx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GGLfixed n, GGLfixed d)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((d&gt;&gt;<span class="hljs-number"><span class="hljs-number">24</span></span>) &amp;&amp; ((d&gt;&gt;<span class="hljs-number"><span class="hljs-number">24</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>)) { n &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; d &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gglMulx(n, gglRecip(d)); }</code> </pre> <br>  PVS-Studio: V793 It is odd that the result of the '(d &gt;&gt; 24) + 1' statement is a part of the condition. Perhaps, this statement should have been compared with something else. fixed.cpp 75 <br><br>   ,  8    <i>d</i>  ,       .  ,   ,       ,   0x00  0xFF. <br><br>        .    ,    ,   (d&gt;&gt;24).     ,      : ((d&gt;&gt;24)+1).        .    ,          .  Yaitu   d  0b11111111'00000000'00000000'00000000,      0b11111111'11111111'11111111'11111111.  1   0xFFFFFFFF  <i>int</i> ,    0.  : -1+1=0.  ,  ((d&gt;&gt;24)+1)  ,        1.  ,    ,       ,     :). <br><br>   ,      . <br><br>         ¬´¬ª.       : ¬´The value of E1 &gt;&gt; E2 is E1 right-shifted E2 bit positions. If E1 has an unsigned type or if E1 has a signed type and a non-negative value, the value of the result is the integral part of the quotient of E1/2^E2. If E1 has a signed type and a negative value, the resulting value is implementation-defined¬ª. <br><br>     . ,   ,   (implementation-defined behavior).     ,       .         ,    ((d&gt;&gt;24)+1)     0, ..    . <br><br>  :    .     ,  , , : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">GGLfixed </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gglFastDivx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GGLfixed n, GGLfixed d)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> hibits = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>&gt;(d) &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hibits != <span class="hljs-number"><span class="hljs-number">0x00</span></span> &amp;&amp; hibits != <span class="hljs-number"><span class="hljs-number">0xFF</span></span>) { n &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; d &gt;&gt;= <span class="hljs-number"><span class="hljs-number">8</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gglMulx(n, gglRecip(d)); }</code> </pre> <br> ,     ,      ,  ,     ,  . <br><br>      . ,  :      . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f53/1a9/86b/f531a986b1bca57105eddf63d12bd50b.png" alt="perhatian"></div><br><br>            : ¬´   <i>printf</i>  ?¬ª <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%d,%d"</span></span>, i++, i++)</code> </pre> <br>  :   .         .    ,   ,    Visual C++,    ¬´6,5¬ª,      ,     :). <br><br>  ,    .  ,        , ,   Android. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ComposerClient::CommandReader::parseSetLayerCursorPosition( <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> length) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length != CommandWriterBase::kSetLayerCursorPositionLength) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> err = mHal.setLayerCursorPosition(mDisplay, mLayer, readSigned(), readSigned()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err != Error::NONE) { mWriter.setError(getCommandLoc(), err); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  PVS-Studio: V681 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-758</a> The language standard does not define an order in which the 'readSigned' functions will be called during evaluation of arguments. ComposerClient.cpp 836 <br><br>      : <br><br><pre> <code class="cpp hljs">mHal.setLayerCursorPosition(...., readSigned(), readSigned());</code> </pre> <br>     <i>readSigned</i>   .        ,  .    Unspecified Behavior. <br><br><h2>       </h2><br>             PVS-Studio  .          .     ,        .    . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span>&gt; kBootReasonMap = { .... {<span class="hljs-string"><span class="hljs-string">"watchdog_sdi_apps_reset"</span></span>, <span class="hljs-number"><span class="hljs-number">106</span></span>}, {<span class="hljs-string"><span class="hljs-string">"smpl"</span></span>, <span class="hljs-number"><span class="hljs-number">107</span></span>}, {<span class="hljs-string"><span class="hljs-string">"oem_modem_failed_to_powerup"</span></span>, <span class="hljs-number"><span class="hljs-number">108</span></span>}, {<span class="hljs-string"><span class="hljs-string">"reboot_normal"</span></span>, <span class="hljs-number"><span class="hljs-number">109</span></span>}, {<span class="hljs-string"><span class="hljs-string">"oem_lpass_cfg"</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>}, <span class="hljs-comment"><span class="hljs-comment">// &lt;= {"oem_xpu_ns_error", 111}, // &lt;= {"power_key_press", 112}, {"hardware_reset", 113}, {"reboot_by_powerkey", 114}, {"reboot_verity", 115}, {"oem_rpm_undef_error", 116}, {"oem_crash_on_the_lk", 117}, {"oem_rpm_reset", 118}, {"oem_lpass_cfg", 119}, // &lt;= {"oem_xpu_ns_error", 120}, // &lt;= {"factory_cable", 121}, {"oem_ar6320_failed_to_powerup", 122}, {"watchdog_rpm_bite", 123}, {"power_on_cable", 124}, {"reboot_unknown", 125}, .... };</span></span></code> </pre> <br>  PVS-Studio: <br><br><ul><li> V766 CWE-462 An item with the same key '¬´oem_lpass_cfg¬ª' has already been added. bootstat.cpp 264 </li><li> V766 CWE-462 An item with the same key '¬´oem_xpu_ns_error¬ª' has already been added. bootstat.cpp 265 </li></ul><br>     ( <i>std::map</i> )      .    Common Weakness Enumeration ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-462</a> : Duplicate Key in Associative List. <br><br>   ,    ,    ,       ,     . <br><br>     ,     ,     . <br><br><pre> <code class="cpp hljs">MtpResponseCode MyMtpDatabase::getDevicePropertyValue(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_INT8: packet.putInt8(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_UINT8: packet.putUInt8(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_INT16: packet.putInt16(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_UINT16: packet.putUInt16(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_INT32: packet.putInt32(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_UINT32: packet.putUInt32(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_INT64: packet.putInt64(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_UINT64: packet.putUInt64(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_INT128: packet.putInt128(longValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MTP_TYPE_UINT128: packet.putInt128(longValue); <span class="hljs-comment"><span class="hljs-comment">// &lt;= break; .... }</span></span></code> </pre> <br>  PVS-Studio: V525 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-682</a> The code contains the collection of similar blocks. Check items 'putInt8', 'putUInt8', 'putInt16', 'putUInt16', 'putInt32', 'putUInt32', 'putInt64', 'putUInt64', 'putInt128', 'putInt128' in lines 620, 623, 626, 629, 632, 635, 638, 641, 644, 647. android_mtp_MtpDatabase.cpp 620 <br><br>   <i>MTP_TYPE_UINT128</i>      <i>putUInt128</i> ,   <i>putInt128</i> . <br><br>         Copy-Paste. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btif_rc_upstreams_evt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AVRC_PDU_REQUEST_CONTINUATION_RSP: { BTIF_TRACE_EVENT( <span class="hljs-string"><span class="hljs-string">"%s() REQUEST CONTINUATION: target_pdu: 0x%02d"</span></span>, __func__, pavrc_cmd-&gt;continu.target_pdu); tAVRC_RESPONSE avrc_rsp; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_dev-&gt;rc_connected == TRUE) { <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;(avrc_rsp.continu), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tAVRC_NEXT_RSP)); avrc_rsp.continu.opcode = opcode_from_pdu(AVRC_PDU_REQUEST_CONTINUATION_RSP); avrc_rsp.continu.pdu = AVRC_PDU_REQUEST_CONTINUATION_RSP; avrc_rsp.continu.status = AVRC_STS_NO_ERROR; avrc_rsp.continu.target_pdu = pavrc_cmd-&gt;continu.target_pdu; send_metamsg_rsp(p_dev, <span class="hljs-number"><span class="hljs-number">-1</span></span>, label, ctype, &amp;avrc_rsp); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AVRC_PDU_ABORT_CONTINUATION_RSP: { BTIF_TRACE_EVENT( <span class="hljs-string"><span class="hljs-string">"%s() ABORT CONTINUATION: target_pdu: 0x%02d"</span></span>, __func__, pavrc_cmd-&gt;<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.target_pdu); tAVRC_RESPONSE avrc_rsp; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_dev-&gt;rc_connected == TRUE) { <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;(avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tAVRC_NEXT_RSP)); avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.opcode = opcode_from_pdu(AVRC_PDU_ABORT_CONTINUATION_RSP); avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.pdu = AVRC_PDU_ABORT_CONTINUATION_RSP; avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.status = AVRC_STS_NO_ERROR; avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.target_pdu = pavrc_cmd-&gt;continu.target_pdu; send_metamsg_rsp(p_dev, <span class="hljs-number"><span class="hljs-number">-1</span></span>, label, ctype, &amp;avrc_rsp); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br>        ,    . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83b/679/4ad/83b6794adb823b1fa52e18c91eff1ed2.png" alt="Gambar yang mengganggu, Java"></div><br><br>       ,      .   ,      Java,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a> . <br><br> , ,      .     : V778 CWE-682 Two similar code fragments were found. Perhaps, this is a typo and 'abort' variable should be used instead of 'continu'. btif_rc.cc 1554 <br><br> ,    Copy-Paste,  ,  ,          .         " <i>continu</i> "  " <i>abort</i> ". <br><br>  Yaitu      : <br><br><pre> <code class="cpp hljs">avrc_rsp.<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.target_pdu = pavrc_cmd-&gt;<span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>.target_pdu;</code> </pre> <br>       " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  </a> ",         . <br><br><h2> Facepalm </h2><br>        little-endian  big-endian   (. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a> ). <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> uint32_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bswap32</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (((pData &amp; <span class="hljs-number"><span class="hljs-number">0xFF000000</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>) | ((pData &amp; <span class="hljs-number"><span class="hljs-number">0x00FF0000</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) | ((pData &amp; <span class="hljs-number"><span class="hljs-number">0x0000FF00</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) | ((pData &amp; <span class="hljs-number"><span class="hljs-number">0x000000FF</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ELFAttribute::merge(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> subsection_length = *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>*&gt;(subsection_data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (llvm::sys::IsLittleEndianHost != m_Config.targets().isLittleEndian()) bswap32(subsection_length); .... }</code> </pre> <br>  PVS-Studio: V530 CWE-252 The return value of function 'bswap32' is required to be utilized. ELFAttribute.cpp 84 <br><br>   <i>bswap32</i>  .     : <br><br><pre> <code class="cpp hljs">bswap32(subsection_length);</code> </pre> <br>  ,          .      .       . <br><br>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-252</a> : Unchecked Return Value. ,   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-198</a> : Use of Incorrect Byte Ordering.  ,            . ,          . <br><br>  : <br><br><pre> <code class="cpp hljs">subsection_length = bswap32(subsection_length);</code> </pre> <br>   Android       : <br><br><ul><li> V530 CWE-252 The return value of function 'bswap32' is required to be utilized. ELFAttribute.cpp 218 </li><li> V530 CWE-252 The return value of function 'bswap32' is required to be utilized. ELFAttribute.cpp 346 </li><li> V530 CWE-252 The return value of function 'bswap32' is required to be utilized. ELFAttribute.cpp 352 </li></ul><br>    ,     <i>[[nodiscard]]</i> .   ,  ,          . ,   : <br><br><pre> <code class="cpp hljs">[[nodiscard]] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> uint32_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bswap32</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pData)</span></span></span><span class="hljs-function"> </span></span>{ ... }</code> </pre> <br>          .              " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">++17</a> ". <br><br><h2>   </h2><br>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>    ,         ,       . <br><br>    Common Weakness Enumeration ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-561</a> : Dead Code. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> sp&lt;IEffect&gt; createEffect(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pDesc == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> effect; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (status != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { *status = BAD_VALUE; } } .... }</code> </pre> <br>  PVS-Studio: V779 CWE-561 Unreachable code detected. It is possible that an error is present. IAudioFlinger.cpp 733 <br><br>  <i>return</i>    . <br><br>    : <br><br><ul><li> V779 CWE-561 Unreachable code detected. It is possible that an error is present. bta_hf_client_main.cc 612 </li><li> V779 CWE-561 Unreachable code detected. It is possible that an error is present. android_media_ImageReader.cpp 468 </li><li> V779 CWE-561 Unreachable code detected. It is possible that an error is present. AMPEG4AudioAssembler.cpp 187 </li></ul><br><h2> break </h2><br>  <i>break</i>  <i>switch</i> ‚Äî    C  C++ .    ,  C++17    ,  <i>[[fallthrough]]</i> .      <i>[[fallthrough]]</i>       " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">break  fallthrough</a> ". <br><br>       ,  <i>[[fallthrough]]</i>  ,   PVS-Studio.   ,   Android.  Common Weakness Enumeration,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-484</a> : Omitted Break Statement in Switch. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> A2dpCodecConfigLdac::setCodecConfig(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTAV_A2DP_CODEC_SAMPLE_RATE_192000: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sampleRate &amp; A2DP_LDAC_SAMPLING_FREQ_192000) { result_config_cie.sampleRate = A2DP_LDAC_SAMPLING_FREQ_192000; codec_capability_.sample_rate = codec_user_config_.sample_rate; codec_config_.sample_rate = codec_user_config_.sample_rate; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTAV_A2DP_CODEC_SAMPLE_RATE_16000: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTAV_A2DP_CODEC_SAMPLE_RATE_24000: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BTAV_A2DP_CODEC_SAMPLE_RATE_NONE: codec_capability_.sample_rate = BTAV_A2DP_CODEC_SAMPLE_RATE_NONE; codec_config_.sample_rate = BTAV_A2DP_CODEC_SAMPLE_RATE_NONE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br>  PVS-Studio: V796 CWE-484 It is possible that 'break' statement is missing in switch statement. a2dp_vendor_ldac.cc 912 <br><br> ,     .  ,          . ,      V519: <br><br><ul><li> V519 CWE-563 The 'codec_capability_.sample_rate' variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 910, 916. a2dp_vendor_ldac.cc 916 </li><li> V519 CWE-563 The 'codec_config_.sample_rate' variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 911, 917. a2dp_vendor_ldac.cc 917 </li></ul><br>    : <br><br><pre> <code class="cpp hljs">Return&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; EffectsFactory::getAllDescriptors(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (status) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> -ENOSYS: { <span class="hljs-comment"><span class="hljs-comment">// Effect list has changed. goto restart; } case -ENOENT: { // No more effects available. result.resize(i); } default: { result.resize(0); retval = Result::NOT_INITIALIZED; } } .... }</span></span></code> </pre> <br>  PVS-Studio: V796 CWE-484 It is possible that 'break' statement is missing in switch statement. EffectsFactory.cpp 118 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Reverb_getParameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> REVERB_PARAM_REFLECTIONS_LEVEL: *(<span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> *)pValue = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> REVERB_PARAM_REFLECTIONS_DELAY: *(<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *)pValue = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> REVERB_PARAM_REVERB_DELAY: *(<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *)pValue = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br>  PVS-Studio: V796 CWE-484 It is possible that 'break' statement is missing in switch statement. EffectReverb.cpp 1847 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> SLresult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IAndroidConfiguration_GetConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (IObjectToObjectID((thiz)-&gt;mThis)) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SL_OBJECTID_AUDIORECORDER: result = android_audioRecorder_getConfig( (CAudioRecorder *) thiz-&gt;mThis, configKey, pValueSize, pConfigValue); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SL_OBJECTID_AUDIOPLAYER: result = android_audioPlayer_getConfig( (CAudioPlayer *) thiz-&gt;mThis, configKey, pValueSize, pConfigValue); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: result = SL_RESULT_FEATURE_UNSUPPORTED; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } .... }</code> </pre> <br>  PVS-Studio: V796 CWE-484 It is possible that 'break' statement is missing in switch statement. IAndroidConfiguration.cpp 90 <br><br><h2>    </h2><br>    ,     .  ,  Common Weakness Enumeration,  : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-401</a> : Improper Release of Memory Before Removing Last Reference ('Memory Leak') </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-562</a> : Return of Stack Variable Address </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-762</a> : Mismatched Memory Management Routines </li></ul><br>   ,      . <br><br><pre> <code class="cpp hljs">TransformIterator&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>++(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { <span class="hljs-function"><span class="hljs-function">TransformIterator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; ++*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; } TransformIterator&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>--(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { <span class="hljs-function"><span class="hljs-function">TransformIterator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; --*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; }</code> </pre> <br>  PVS-Studio: <br><br><ul><li> V558 CWE-562 Function returns the reference to temporary local object: tmp. transform_iterator.h 77 </li><li> V558 CWE-562 Function returns the reference to temporary local object: tmp. transform_iterator.h 92 </li></ul><br>     ,  <i>tmp</i> ,      . ,       () . <br><br>      : <br><br><pre> <code class="cpp hljs">TransformIterator <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>++(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { <span class="hljs-function"><span class="hljs-function">TransformIterator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; ++*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; } TransformIterator <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>--(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { <span class="hljs-function"><span class="hljs-function">TransformIterator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; --*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; }</code> </pre> <br>     ,   . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/619/b25/299/619b2529917e9570454e60bf9c27c3f8.png" alt="Kode berbahaya"></div><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register_socket_transport</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* serial, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> local)</span></span></span><span class="hljs-function"> </span></span>{ atransport* t = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> atransport(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!serial) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">32</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">snprintf</span></span>(buf, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf), <span class="hljs-string"><span class="hljs-string">"T-%p"</span></span>, t); serial = buf; } .... }</code> </pre> <br>  PVS-Studio: V507 CWE-562 Pointer to local array 'buf' is stored outside the scope of this array. Such a pointer will become invalid. transport.cpp 1030 <br><br>   .     <i>serial</i>  NULL,        .    <i>if</i> ,  <i>buf</i>  . ,    ,      ,   .     ,      . <br><br>          . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SensorService::SensorEventConnection::reAllocateCacheLocked(....) { <span class="hljs-keyword"><span class="hljs-keyword">sensors_event_t</span></span> *eventCache_new; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> new_cache_size = computeMaxCacheSizeLocked(); eventCache_new = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sensors_event_t</span></span>[new_cache_size]; .... <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> mEventCache; mEventCache = eventCache_new; mCacheSize += count; mMaxCacheSize = new_cache_size; }</code> </pre> <br>  PVS-Studio: V611 CWE-762 The memory was allocated using 'new T[]' operator but was released using the 'delete' operator. Consider inspecting this code. It's probably better to use 'delete [] mEventCache;'. Check lines: 391, 384. SensorEventConnection.cpp 391 <br><br>   . ,        <i>mEventCache</i> ,     <i>new []</i> .    ,   <i>delete</i> .        . <br><br>  : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">aaudio_result_t</span></span> AAudioServiceEndpointCapture::open(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> mDistributionBuffer; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> distributionBufferSizeBytes = getStreamInternal()-&gt;getFramesPerBurst() * getStreamInternal()-&gt;getBytesPerFrame(); mDistributionBuffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>[distributionBufferSizeBytes]; .... }</code> </pre> <br>  PVS-Studio: V611 CWE-762 The memory was allocated using 'new T[]' operator but was released using the 'delete' operator. Consider inspecting this code. It's probably better to use 'delete [] mDistributionBuffer;'. AAudioServiceEndpointCapture.cpp 50 <br><br> ,     . <br><br>    ,       . <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeifFrameInfo</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... mIccData.reset(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>[iccSize]); .... } .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>&gt; mIccData; };</code> </pre> <br> V554 CWE-762 Incorrect use of unique_ptr.  Memori yang dialokasikan dengan 'baru [] akan dibersihkan menggunakan' hapus '. HeifDecoderAPI.h 62 <br><br>      <i>std::unique_ptr</i>      <i>delete</i> .    <i>set</i>      <i>new []</i> . <br><br>  Opsi yang benar: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>[]&gt; mIccData;</code> </pre> <br>  Kesalahan lain: <br><br><ul><li> V554 CWE-762 Incorrect use of unique_ptr.  Memori yang dialokasikan dengan 'baru [] akan dibersihkan menggunakan' hapus '. atrace.cpp 949 </li><li> V554 CWE-762 Incorrect use of unique_ptr.  Memori yang dialokasikan dengan 'baru [] akan dibersihkan menggunakan' hapus '. atrace.cpp 950 </li><li> V554 CWE-762 Incorrect use of unique_ptr.  Memori yang dialokasikan dengan 'baru [] akan dibersihkan menggunakan' hapus '. HeifDecoderImpl.cpp 102 </li><li> V554 CWE-762 Incorrect use of unique_ptr.  Memori yang dialokasikan dengan 'baru [] akan dibersihkan menggunakan' hapus '. HeifDecoderImpl.cpp 166 </li><li> V554 CWE-762 Incorrect use of unique_ptr.  Memori yang dialokasikan dengan 'baru [] akan dibersihkan menggunakan' hapus '. ColorSpace.cpp 360 </li></ul><br>    ,    .    ,      20.  ,      ,            . <br><br><pre> <code class="cpp hljs">Asset* Asset::createFromUncompressedMap(FileMap* dataMap, AccessMode mode) { _FileAsset* pAsset; <span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> result; pAsset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> _FileAsset; result = pAsset-&gt;openChunk(dataMap); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != NO_ERROR) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; pAsset-&gt;mAccessMode = mode; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pAsset; }</code> </pre> <br>  PVS-Studio: V773 CWE-401 The function was exited without releasing the 'pAsset' pointer.  Kebocoran memori dimungkinkan. Asset.cpp 296 <br><br>      chunk,        ,       <i>pAsset</i> .     . <br><br>   ,         .       : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Android_V773.txt</a> . <br><br><h2>     </h2><br>     ,      .   Android        : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || i &gt; MAX) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; A[i] = x;</code> </pre> <br>  C  C++     0,           ,    .     : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || i &gt;= MAX) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; A[i] = x;</code> </pre> <br>    ,  Common Weakness Enumeration,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-119</a> : Improper Restriction of Operations within the Bounds of a Memory Buffer. <br><br> ,       Android. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">btif_hf_cb_t</span></span> btif_hf_cb[BTA_AG_MAX_NUM_CLIENTS]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsSlcConnected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RawAddress* bd_addr)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!bd_addr) { LOG(WARNING) &lt;&lt; __func__ &lt;&lt; <span class="hljs-string"><span class="hljs-string">": bd_addr is null"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idx = btif_hf_idx_by_bdaddr(bd_addr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || idx &gt; BTA_AG_MAX_NUM_CLIENTS) { LOG(WARNING) &lt;&lt; __func__ &lt;&lt; <span class="hljs-string"><span class="hljs-string">": invalid index "</span></span> &lt;&lt; idx &lt;&lt; <span class="hljs-string"><span class="hljs-string">" for "</span></span> &lt;&lt; *bd_addr; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> btif_hf_cb[idx].state == BTHF_CONNECTION_STATE_SLC_CONNECTED; }</code> </pre> <br>  PVS-Studio: V557 CWE-119 Array overrun is possible. The value of 'idx' index could reach 6. btif_hf.cc 277 <br><br>   : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || idx &gt;= BTA_AG_MAX_NUM_CLIENTS) {</code> </pre> <br>        : <br><br><ul><li> V557 CWE-119 Array overrun is possible. The value of 'idx' index could reach 6. btif_hf.cc 869 </li><li> V557 CWE-119 Array overrun is possible. The value of 'index' index could reach 6. btif_rc.cc 374 </li></ul><br><h2>   </h2><br>       .   Android   , ,  Common Weakness Enumeration,   : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-20</a> : Improper Input Validation </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-670</a> : Always-Incorrect Control Flow Implementation </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-691</a> : Insufficient Control Flow Management </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-834</a> : Excessive Iteration </li></ul><br>  , ,     ¬´  ¬ª   ,        . <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **argv)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%s is already in *.base_fs format, just ..... "</span></span>, ....); rewind(blk_alloc_file); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((c = fgetc(blk_alloc_file)) != EOF) { fputc(c, base_fs_file); } .... }</code> </pre> <br>  PVS-Studio: V739 CWE-20 EOF should not be compared with a value of the 'char' type. The '(c = fgetc(blk_alloc_file))' should be of the 'int' type. blk_alloc_to_base_fs.c 61 <br><br>  ,   <i>EOF</i>     <i>char</i> .  ,    . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><i>fgetc</i></a>    <i>int</i> ,  :      0  255  EOF (-1).       <i>char</i> . -     0xFF (255)   -1     ,    (EOF). <br><br> -   ,  Extended ASCII Codes,    ,         . ,       Windows-1251     0xFF       . <br><br>  ,  ,      .    ,   <i>c</i>   int. <br><br>          <i>for</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> AudioPolicyManager::registerPolicyMixes(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; mixes.size(); i++) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; mHwModules.size(); j++) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (strcmp(AUDIO_HARDWARE_MODULE_ID_REMOTE_SUBMIX, mHwModules[j]-&gt;mName) == 0 &amp;&amp; mHwModules[j]-&gt;mHandle != 0) { rSubmixModule = mHwModules[j]; break; } .... } .... }</span></span></code> </pre> <br>  PVS-Studio: V534 CWE-691 It is likely that a wrong variable is being compared inside the 'for' operator. Consider reviewing 'i'. AudioPolicyManager.cpp 2489 <br><br> -         <i>i</i> ,     <i>j</i> .    <i>j</i>  ,          <i>mHwModules</i> .   ,  ,      . <br><br> ,         .        : AudioPolicyManager.cpp 2586. <br><br>   3  ,     .     ,     ,      .          ,    . <br><br>  : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ce_t3t_handle_check_cmd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; p_cb-&gt;cur_cmd.num_blocks; i++) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; T3T_MSG_NDEF_ATTR_INFO_SIZE; i++) { checksum += p_temp[i]; } .... } .... }</code> </pre> <br>  PVS-Studio: V535 CWE-691 The variable 'i' is being used for this loop and for the outer loop. Check lines: 398, 452. ce_t3t.cc 452 <br><br>  ,   <i>i</i>    ,     . <br><br>     : <br><br><ul><li> V535 CWE-691 The variable 'xx' is being used for this loop and for the outer loop. Check lines: 801, 807. sdp_db.cc 807 </li><li> V535 CWE-691 The variable 'xx' is being used for this loop and for the outer loop. Check lines: 424, 438. nfa_hci_act.cc 438 </li></ul><br>    ?     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> PVS-Studio</a> ,     . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30b/8e3/d36/30b8e3d36a2b05111cee2b76d981d89f.png" alt="Coba PVS-Studio"></div><br><br>   . <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NFA_HCI_LAST_PROP_GATE 0xFF tNFA_HCI_DYN_GATE* nfa_hciu_alloc_gate(uint8_t gate_id, tNFA_HANDLE app_handle) { .... for (gate_id = NFA_HCI_FIRST_HOST_SPECIFIC_GENERIC_GATE; gate_id </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;= NFA_HCI_LAST_PROP_GATE; gate_id++) { if (gate_id == NFA_HCI_CONNECTIVITY_GATE) gate_id++; if (nfa_hciu_find_gate_by_gid(gate_id) == NULL) break; } if (gate_id &gt; NFA_HCI_LAST_PROP_GATE) { LOG(ERROR) &lt;&lt; StringPrintf( "nfa_hci_alloc_gate - no free Gate ID: %u " "App Handle: 0x%04x", gate_id, app_handle); return (NULL); } .... }</span></span></span></span></code> </pre> <br>  PVS-Studio: V654 CWE-834 The condition 'gate_id &lt;= 0xFF' of loop is always true. nfa_hci_utils.cc 248 <br><br>    : <br><br><ul><li>  <i>NFA_HCI_LAST_PROP_GATE</i>   0xFF. </li><li>        <i>uint8_t</i> . ,     [0..0xFF]. </li></ul><br> ,   <i>gate_id &lt;= NFA_HCI_LAST_PROP_GATE</i>        . <br><br>      CWE-834,        CWE-571: Expression is Always True. <br><br>        . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> SimpleDecodingSource::doRead(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> retries = <span class="hljs-number"><span class="hljs-number">0</span></span>; ++retries; ) { .... }</code> </pre> <br>  PVS-Studio: V654 CWE-834 The condition '++ retries' of loop is always true. SimpleDecodingSource.cpp 226 <br><br> ,  ,   <i>retries</i>       <i>int</i>     . <br><br>   ,   <i>++retries</i>   0.       ,    .     ,       . ,         . ,             . <br><br>      . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> Check(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&amp; source) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pass = <span class="hljs-number"><span class="hljs-number">1</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(rc) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: SLOGI(<span class="hljs-string"><span class="hljs-string">"Filesystem check completed OK"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: SLOGE(<span class="hljs-string"><span class="hljs-string">"Filesystem check failed (not a FAT filesystem)"</span></span>); errno = ENODATA; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pass++ &lt;= <span class="hljs-number"><span class="hljs-number">3</span></span>) { SLOGW(<span class="hljs-string"><span class="hljs-string">"Filesystem modified - rechecking (pass %d)"</span></span>, pass); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } SLOGE("Failing check after too many rechecks"); errno = EIO; return -1; case 8: SLOGE("Filesystem check failed (no filesystem)"); errno = ENODATA; return -1; default: SLOGE("Filesystem check failed (unknown exit code %d)", rc); errno = EIO; return -1; } } while (0); // &lt;= return 0; }</span></span></code> </pre> <br>  PVS-Studio: V696 CWE-670 The 'continue' operator will terminate 'do {‚Ä¶ } while (FALSE)' loop because the condition is always false. Check lines: 105, 121. Vfat.cpp 105 <br><br>    : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; .... } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>    ,    <i>continue</i> .  Ini salah.  <i>continue</i>    ,     .     ,         . <br><br>   ,   , , : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;;) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre> <br><h2>    </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a>        ,     .      -    Copy-Paste.  Common Weakness Enumeration,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-563</a> : Assignment to Variable without Use.        Android. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> XMLNode::flatten_node(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;namespaceExt, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(namespaceExt)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mNamespacePrefix.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { namespaceExt.prefix.index = htodl(strings.offsetForString(mNamespacePrefix)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { namespaceExt.prefix.index = htodl((<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>)<span class="hljs-number"><span class="hljs-number">-1</span></span>); } namespaceExt.prefix.index = htodl(strings.offsetForString(mNamespacePrefix)); namespaceExt.uri.index = htodl(strings.offsetForString(mNamespaceUri)); .... }</code> </pre> <br>  PVS-Studio: V519 CWE-563 The 'namespaceExt.prefix.index' variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 1535, 1539. XMLNode.cpp 1539 <br><br>    ,  : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) X = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> X = <span class="hljs-number"><span class="hljs-number">2</span></span>; X = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>   ,  <i>X</i> (    <i>namespaceExt.prefix.index</i> )     . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> AudioFlinger::RecordThread::threadLoop() { .... <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> framesToRead = mBufferSize / mFrameSize; framesToRead = min(mRsmpInFramesOA - rear, mRsmpInFramesP2 / <span class="hljs-number"><span class="hljs-number">2</span></span>); .... }</code> </pre> <br>  PVS-Studio: V519 CWE-563 The 'framesToRead' variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 6341, 6342. Threads.cpp 6342 <br><br> ,       ,        . -   . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SchedulingLatencyVisitorARM::VisitArrayGet(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index-&gt;IsConstant()) { last_visited_latency_ = kArmMemoryLoadLatency; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (has_intermediate_address) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { last_visited_internal_latency_ += kArmIntegerOpLatency; } last_visited_internal_latency_ = kArmMemoryLoadLatency; } .... }</code> </pre> <br>  PVS-Studio: V519 CWE-563 The 'last_visited_internal_latency_' variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 680, 682. scheduler_arm.cc 682 <br><br>  ,  .  ,     : <br><br><pre> <code class="cpp hljs">last_visited_internal_latency_ += kArmMemoryLoadLatency;</code> </pre> <br>   , ,      ,          code review. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">multiprecision_fast_mod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* c, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> U; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> V; .... c[<span class="hljs-number"><span class="hljs-number">0</span></span>] += U; V = c[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt; U; c[<span class="hljs-number"><span class="hljs-number">1</span></span>] += V; V = c[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt; V; c[<span class="hljs-number"><span class="hljs-number">2</span></span>] += V; <span class="hljs-comment"><span class="hljs-comment">// V = c[2] &lt; V; // &lt;= c[2] += U; // V = c[2] &lt; U; // &lt;= c[3] += V; V = c[3] &lt; V; c[4] += V; V = c[4] &lt; V; c[5] += V; V = c[5] &lt; V; .... }</span></span></code> </pre> <br>  PVS-Studio: V519 CWE-563 The 'V' variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 307, 309. p_256_multprecision.cc 309 <br><br>   ¬´ ¬ª,       .    :      ,    . <br><br><h2>   </h2><br>   ,       .       ,    . <br><br> <b> </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TagMonitor::parseTagsToMonitor(String8 tagNames) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::lock_guard&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::mutex&gt; lock(mMonitorMutex); <span class="hljs-comment"><span class="hljs-comment">// Expand shorthands if (ssize_t idx = tagNames.find("3a") != -1) { ssize_t end = tagNames.find(",", idx); char* start = tagNames.lockBuffer(tagNames.size()); start[idx] = '\0'; .... } .... }</span></span></code> </pre> <br>  PVS-Studio: V593 CWE-783 Consider reviewing the expression of the 'A = B != C' kind. The expression is calculated as following: 'A = (B != C)'. TagMonitor.cpp 50 <br><br>   Common Weakness Enumeration: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-783</a> : Operator Precedence Logic Error. <br><br>   .    ¬´3a¬ª    <i>idx</i>    .    (idx != -1),    ,      <i>idx</i> . <br><br>  ,     .      : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> idx = (tagNames.find(<span class="hljs-string"><span class="hljs-string">"3a"</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span>))</code> </pre> <br>  ,      ¬´3a¬ª,   false/true    <i>idx</i> .    <i>idx</i>   0  1. <br><br>    ( <i>idx</i>  1),    ,   <i>idx</i> .    1     . <br><br>   ,      : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> idx = tagNames.find(<span class="hljs-string"><span class="hljs-string">"3a"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx != <span class="hljs-number"><span class="hljs-number">-1</span></span>)</code> </pre> <br>    C++17   : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> idx = tagNames.find(<span class="hljs-string"><span class="hljs-string">"3a"</span></span>); idx != <span class="hljs-number"><span class="hljs-number">-1</span></span>)</code> </pre> <br> <b> </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HearingDevice</span></span></span><span class="hljs-class"> {</span></span> .... HearingDevice() { HearingDevice(RawAddress::kEmpty, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } .... };</code> </pre> <br>  PVS-Studio: V603 CWE-665 The object was created but it is not being used. If you wish to call constructor, 'this-&gt;HearingDevice::HearingDevice(....)' should be used. hearing_aid.cc 176 <br><br>   Common Weakness Enumeration: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-665</a> : Improper Initialization. <br><br>   ,       .     .            .       ,   . <br><br>  .      <i>HearingDevice</i>    .      . <br><br>   ,     (    C++11).  : <br><br><pre> <code class="cpp hljs">HearingDevice() : HearingDevice(RawAddress::kEmpty, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { }</code> </pre> <br> <b>   </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NET_RecvFrom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> len, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flags, struct sockaddr *from, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *fromlen)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">socklen_t</span></span> socklen = *fromlen; BLOCKING_IO_RETURN_INT( s, recvfrom(s, buf, len, flags, from, &amp;socklen) ); *fromlen = socklen; }</code> </pre> <br>  PVS-Studio: V591 CWE-393 Non-void function should return a value. linux_close.cpp 139 <br><br>   Common Weakness Enumeration: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-393</a> : Return of Wrong Status Code. <br><br>    .    : V591 CWE-393 Non-void function should return a value. linux_close.cpp 158 <br><br> <b>   </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MtpFfsHandle::handleControlRequest(....) { .... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mtp_device_status</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">st</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">reinterpret_cast</span></span></span><span class="hljs-class">&lt;struct mtp_device_status*&gt;(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">buf</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">());</span></span> st-&gt;wLength = htole16(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(st)); .... }</code> </pre> <br>  PVS-Studio: V568 It's odd that 'sizeof()' operator evaluates the size of a pointer to a class, but not the size of the 'st' class object. MtpFfsHandle.cpp 251 <br><br>  ,   - <i>wLength</i>    ,    .      : <br><br><pre> <code class="cpp hljs">st-&gt;wLength = htole16(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(*st));</code> </pre> <br>   : <br><br><ul><li> V568 It's odd that 'sizeof()' operator evaluates the size of a pointer to a class, but not the size of the 'cacheinfo' class object. NetlinkEvent.cpp 220 </li><li> V568 It's odd that 'sizeof()' operator evaluates the size of a pointer to a class, but not the size of the 'page-&gt;next' class object. linker_block_allocator.cpp 146 </li><li> V568 It's odd that the argument of sizeof() operator is the '&amp; session_id' expression. reference-ril.c 1775 </li></ul><br> <b>  </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EGL_CONTEXT_OPENGL_DEBUG_BIT_KHR 0x00000001 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EGL_CONTEXT_OPENGL_FORWARD_COMPATIBLE_BIT_KHR 0x00000002 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EGL_CONTEXT_OPENGL_ROBUST_ACCESS_BIT_KHR 0x00000004 EGLContext eglCreateContext(....) { .... case EGL_CONTEXT_FLAGS_KHR: </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> ((attrib_val | EGL_CONTEXT_OPENGL_DEBUG_BIT_KHR) || (attrib_val | EGL_CONTEXT_OPENGL_FORWARD_C....) || (attrib_val | EGL_CONTEXT_OPENGL_ROBUST_ACCESS_BIT_KHR)) { context_flags = attrib_val; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { RETURN_ERROR(EGL_NO_CONTEXT,EGL_BAD_ATTRIBUTE); } .... }</span></span></code> </pre> <br>  PVS-Studio: V617 CWE-480 Consider inspecting the condition. The '0x00000001' argument of the '|' bitwise operation contains a non-zero value. egl.cpp 1329 <br><br>   Common Weakness Enumeration: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-480</a> : Use of Incorrect Operator. <br><br>   (A | 1) || (A | 2) || (A | 4)   ,      true.   ,    <i>&amp;</i> ,     : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((attrib_val &amp; EGL_CONTEXT_OPENGL_DEBUG_BIT_KHR) || (attrib_val &amp; EGL_CONTEXT_OPENGL_FORWARD_COMPATIBLE_BIT_KHR) || (attrib_val &amp; EGL_CONTEXT_OPENGL_ROBUST_ACCESS_BIT_KHR))</code> </pre> <br>  : V617 CWE-480 Consider inspecting the condition. The '0x00000001' argument of the '|' bitwise operation contains a non-zero value. egl.cpp 1338 <br><br> <b>  </b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AddressType&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegsInfo</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> saved_reg_map = <span class="hljs-number"><span class="hljs-number">0</span></span>; AddressType saved_regs[<span class="hljs-number"><span class="hljs-number">64</span></span>]; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> AddressType* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reg)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reg &gt; <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(saved_regs) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(AddressType)) { <span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>(); } saved_reg_map |= <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; reg; saved_regs[reg] = (*regs)[reg]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;(*regs)[reg]; } .... }</code> </pre> <br>  PVS-Studio: V629 CWE-190 Consider inspecting the '1 &lt;&lt; reg' expression. Bit shifting of the 32-bit value with a subsequent expansion to the 64-bit type. RegsInfo.h 47 <br><br>   Common Weakness Enumeration: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-190</a> : Integer Overflow or Wraparound. <br><br>   <i>1 &lt;&lt; reg</i>   <i>reg</i>    [0..63].    ,     ,   2^0   2^63. <br><br>   .   ,    1  32-  <i>int</i> .        1^31.            . <br><br>  : <br><br><pre> <code class="cpp hljs">saved_reg_map |= <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">1</span></span>) &lt;&lt; reg;</code> </pre> <br> : <br><br><pre> <code class="cpp hljs">saved_reg_map |= <span class="hljs-number"><span class="hljs-number">1U</span></span>LL &lt;&lt; reg;</code> </pre> <br> <b>    </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> PCLmGenerator::writeJobTicket() { <span class="hljs-comment"><span class="hljs-comment">// Write JobTicket char inputBin[256]; char outputBin[256]; if (!m_pPCLmSSettings) { return; } getInputBinString(m_pPCLmSSettings-&gt;userInputBin, &amp;inputBin[0]); getOutputBin(m_pPCLmSSettings-&gt;userOutputBin, &amp;outputBin[0]); strcpy(inputBin, inputBin); strcpy(outputBin, outputBin); .... }</span></span></code> </pre> <br>  PVS-Studio: <br><br><ul><li> V549 CWE-688 The first argument of 'strcpy' function is equal to the second argument. genPCLm.cpp 1181 </li><li> V549 CWE-688 The first argument of 'strcpy' function is equal to the second argument. genPCLm.cpp 1182 </li></ul><br>   Common Weakness Enumeration: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-688</a> : Function Call With Incorrect Variable or Reference as Argument. <br><br>  -    .  ,   - . <br><br> <b>  </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mca_set_cfg_by_tbl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ tMCA_DCB* p_dcb; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tL2CAP_FCR_OPTS* p_opt; tMCA_FCS_OPT fcs = MCA_FCS_NONE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_tbl-&gt;tcid == MCA_CTRL_TCID) { p_opt = &amp;mca_l2c_fcr_opts_def; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { p_dcb = mca_dcb_by_hdl(p_tbl-&gt;cb_idx); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_dcb) { p_opt = &amp;p_dcb-&gt;p_chnl_cfg-&gt;fcr_opt; fcs = p_dcb-&gt;p_chnl_cfg-&gt;fcs; } } <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(p_cfg, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tL2CAP_CFG_INFO)); p_cfg-&gt;mtu_present = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; p_cfg-&gt;mtu = p_tbl-&gt;my_mtu; p_cfg-&gt;fcr_present = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(&amp;p_cfg-&gt;fcr, p_opt, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(tL2CAP_FCR_OPTS)); <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  PVS-Studio: V614 CWE-824 Potentially uninitialized pointer 'p_opt' used. Consider checking the second actual argument of the 'memcpy' function. mca_main.cc 252 <br><br>   Common Weakness Enumeration: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-824</a> : Access of Uninitialized Pointer. <br><br>  <i>p_tbl-&gt;tcid != MCA_CTRL_TCID</i>  <i>p_dcb == nullptr</i> ,   <i>p_opt</i>  . <br><br> <b>    </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">timespec</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__time_t</span></span> tv_sec; <span class="hljs-comment"><span class="hljs-comment">/* Seconds. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tv_nsec; <span class="hljs-comment"><span class="hljs-comment">/* Nanoseconds. */</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> timespec </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NsToTimespec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ns)</span></span></span><span class="hljs-function"> </span></span>{ timespec t; <span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span> remainder; t.tv_sec = ns / kNanosPerSecond; remainder = ns % kNanosPerSecond; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (remainder &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { t.tv_nsec--; remainder += kNanosPerSecond; } t.tv_nsec = remainder; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t; }</code> </pre> <br>  PVS-Studio: V614 CWE-457 Uninitialized variable 't.tv_nsec' used. clock_ns.h 55 <br><br>   Common Weakness Enumeration: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-457</a> : Use of Uninitialized Variable. <br><br>     <i>t.tv_nsec</i>   .   : <i>t.tv_nsec = remainder;</i>  . -   . <br><br> <b> </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bta_dm_co_ble_io_req</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... *p_auth_req = bte_appl_cfg.ble_auth_req | (bte_appl_cfg.ble_auth_req &amp; <span class="hljs-number"><span class="hljs-number">0x04</span></span>) | ((*p_auth_req) &amp; <span class="hljs-number"><span class="hljs-number">0x04</span></span>); .... }</code> </pre> <br>  PVS-Studio: V578 An odd bitwise operation detected. Consider verifying it. bta_dm_co.cc 259 <br><br>   .    <i>(bte_appl_cfg.ble_auth_req &amp; 0x04)</i> ,     . ,   - . <br><br> <b> </b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> RSReflectionCpp::genEncodedBitCode() { FILE *pfin = fopen(mBitCodeFilePath.c_str(), <span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pfin == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stderr</span></span>, <span class="hljs-string"><span class="hljs-string">"Error: could not read file %s\n"</span></span>, mBitCodeFilePath.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> read_length; mOut.indent() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"static const unsigned char __txt[] ="</span></span>; mOut.startBlock(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((read_length = fread(buf, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf), pfin)) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { mOut.indent(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; read_length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf2[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">snprintf</span></span>(buf2, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf2), <span class="hljs-string"><span class="hljs-string">"0x%02x,"</span></span>, buf[i]); mOut &lt;&lt; buf2; } mOut &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } mOut.endBlock(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); mOut &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  PVS-Studio: V773 CWE-401 The function was exited without releasing the 'pfin' handle.  Kebocoran sumber daya mungkin terjadi. slang_rs_reflection_cpp.cpp 448 <br><br>    ,  Common Weakness Enumeration, : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-401</a> : Improper Release of Memory Before Removing Last Reference ('Memory Leak').       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-775</a> : Missing Release of File Descriptor or Handle after Effective Lifetime.       PVS-Studio. <br><br>  <i>pfin</i>   .       <i>fclose</i> .  ,        ,       . <br><br><h2>  Kesimpulan </h2><br>  ,        ,  Android,  PVS-Studio       . ,  weakness ( )  : <br><br><ul><li> CWE-14: Compiler Removal of Code to Clear Buffers </li><li> CWE-20: Improper Input Validation </li><li> CWE-119: Improper Restriction of Operations within the Bounds of a Memory Buffer </li><li> CWE-190: Integer Overflow or Wraparound </li><li> CWE-198: Use of Incorrect Byte Ordering </li><li> CWE-393: Return of Wrong Status Code </li><li> CWE-401: Improper Release of Memory Before Removing Last Reference ('Memory Leak') </li><li> CWE-457: Use of Uninitialized Variable </li><li> CWE-462: Duplicate Key in Associative List </li><li> CWE-480: Use of Incorrect Operator </li><li> CWE-484: Omitted Break Statement in Switch </li><li> CWE-561: Dead Code </li><li> CWE-562: Return of Stack Variable Address </li><li> CWE-563: Assignment to Variable without Use </li><li> CWE-570: Expression is Always False </li><li> CWE-571: Expression is Always True </li><li> CWE-476: NULL Pointer Dereference </li><li> CWE-628: Function Call with Incorrectly Specified Arguments </li><li> CWE-665: Improper Initialization </li><li> CWE-670: Always-Incorrect Control Flow Implementation </li><li> CWE-682: Incorrect Calculation </li><li> CWE-688: Function Call With Incorrect Variable or Reference as Argument </li><li> CWE-690: Unchecked Return Value to NULL Pointer Dereference </li><li> CWE-691: Insufficient Control Flow Management </li><li> CWE-758: Reliance on Undefined, Unspecified, or Implementation-Defined Behavior </li><li> CWE-762: Mismatched Memory Management Routines </li><li> CWE-775: Missing Release of File Descriptor or Handle after Effective Lifetime </li><li> CWE-783: Operator Precedence Logic Error </li><li> CWE-824: Access of Uninitialized Pointer </li><li> CWE-834: Excessive Iteration </li></ul><br>       490  .   ,     , ,    ,         . <br><br>       2168000    C  C++.   14,4% ‚Äî  . ,   1855000   . <br><br>  ,   490 CWE  1855000   . <br><br> ,   PVS-Studio     1 weakness ( )   4000     Android.     ,  . <br><br>  Terima kasih atas perhatian anda!        : <br><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a> PVS-Studio    . </li><li>  :      : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">     </a> . </li><li> ,        : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">twitter</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RSS</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">vk.com</a> . </li></ol><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  Jika Anda ingin berbagi artikel ini dengan audiens yang berbahasa Inggris, silakan gunakan tautan ke terjemahan: Andrey Karpov. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">We Checked the Android Source Codes by PVS-Studio or Nothing is Perfect</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id418891/">https://habr.com/ru/post/id418891/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id418879/index.html">Metode pengujian pertukaran crypto dan dompet crypto</a></li>
<li><a href="../id418883/index.html">GitLab di NAS</a></li>
<li><a href="../id418885/index.html">Crispr dapat mempercepat proses alami dan mengubah cara makanan ditanam</a></li>
<li><a href="../id418887/index.html">Seberapa cepat alam semesta mengembang?</a></li>
<li><a href="../id418889/index.html">Panduan Pengujian Aplikasi Manual: Manfaat, Langkah, dan Metodologi</a></li>
<li><a href="../id418897/index.html">CRDT: Jenis Data Replikasi yang bebas konflik</a></li>
<li><a href="../id418899/index.html">Kesan dan tindakan pertama setelah memutakhirkan MySQL dari versi 5.7 ke 8.0.11</a></li>
<li><a href="../id418901/index.html">Rusia memenangkan mayoritas medali emas di Olimpiade Ilmu Komputer Eropa eJOI 2018</a></li>
<li><a href="../id418903/index.html">Ilmuwan: CO‚ÇÇ di Mars tidak cukup untuk menghangatkan atmosfer. Ledakan tiang tidak akan membantu</a></li>
<li><a href="../id418905/index.html">InlineKeyboard di Telegram Bots</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>