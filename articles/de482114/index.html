<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¥üèº üôçüèæ ‚úäüèΩ Senden Sie E-Mails mit asyncio und aiohttp aus einer Django-Anwendung ü•ú üßëüèæ‚Äçü§ù‚Äçüßëüèº üë©üèø‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 

 Ich entwickle und unterst√ºtze einen Benachrichtigungsdienst in Ostrovok.ru . Der Service ist in Python3 und Django geschrieben. N...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Senden Sie E-Mails mit asyncio und aiohttp aus einer Django-Anwendung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ostrovok/blog/482114/">  Hallo allerseits! <br><br>  Ich entwickle und unterst√ºtze einen Benachrichtigungsdienst in <a href="https://www.ostrovok.ru/%3Futm_source%3Dhabr%26utm_medium%3Dpr%26utm_campaign%3Dporyvaev_dec19%26utm_content%3Darticle">Ostrovok.ru</a> .  Der Service ist in Python3 und Django geschrieben.  Neben Transaktionsbriefen, Pushs und Nachrichten √ºbernimmt der Dienst auch die Aufgabe des Massenversands von kommerziellen Angeboten (kein Spam! Vertrauen Sie mir, Abmeldungen funktionieren besser als Abonnements) an Benutzer, die dem zugestimmt haben.  Im Laufe der Zeit wuchs die Zahl der aktiven Empf√§nger auf √ºber eine Million Adressen, f√ºr die der Mail-Service noch nicht bereit war.  Ich m√∂chte dar√ºber sprechen, wie die neuen Python-Funktionen es erm√∂glichten, Massenmailings zu beschleunigen und Ressourcen zu sparen, und mit welchen Problemen wir bei der Arbeit zu k√§mpfen hatten. <br><br><img src="https://habrastorage.org/webt/qj/b-/xa/qjb-xaiilstmnucwa2xko6onw34.png"><br><a name="habracut"></a><br><h3>  Source-Implementierung </h3><br>  Am Anfang wurden Massenmailings auf einfachste Weise implementiert: F√ºr jeden Empf√§nger wurde eine Aufgabe in eine Warteschlange gestellt, die von einem von 60 Massenarbeitern ausgef√ºhrt wurde (ein Merkmal unserer Warteschlangen ist, dass jeder Mitarbeiter in einem separaten Prozess arbeitet), der Kontext daf√ºr vorbereitet, die Vorlage gerendert und gesendet Eine HTTP-Anforderung an Mailgun zum Senden eines Briefs und zum Erstellen eines Datensatzes in der Datenbank, in der der Brief gesendet wurde.  Das gesamte Mailing dauerte bis zu 12 Stunden. Von jedem Mitarbeiter wurden ca. 0,3 Briefe pro Sekunde verschickt, und das Versenden kleiner Kampagnen wurde blockiert. <br><br><img src="https://habrastorage.org/webt/qk/7p/sg/qk7psgslwi6wa0vyhjaafg7bqkq.png"><br><br><h3>  Asynchrone L√∂sung </h3><br>  Schnelle Profilerstellung ergab, dass die meisten Mitarbeiter Zeit damit verbringen, Verbindungen zu Mailgun herzustellen, und so begannen wir, Aufgaben f√ºr jeden Mitarbeiter in Gruppen zu gruppieren.  Die Arbeiter begannen eine Verbindung mit Mailgun zu nutzen, wodurch sich die Zeit f√ºr Mailings auf 9 Stunden reduzierte und jeder Arbeiter durchschnittlich 0,5 Briefe pro Sekunde verschickte.  Die anschlie√üende Profilerstellung hat erneut gezeigt, dass die Arbeit mit dem Netzwerk immer noch die meiste Zeit in Anspruch nimmt, was uns dazu veranlasste, Asyncio zu verwenden. <br><br>  Bevor wir die gesamte Verarbeitung in den Asyncio-Zyklus aufnehmen konnten, mussten wir eine L√∂sung f√ºr eine Reihe von Problemen finden: <br><br><ol><li>  Django ORM kann noch nicht mit Asyncio arbeiten, gibt jedoch die GIL w√§hrend der Abfrageausf√ºhrung frei.  Dies bedeutet, dass Datenbankabfragen in einem separaten Thread ausgef√ºhrt werden k√∂nnen und nicht die Hauptschleife blockieren. </li><li>  F√ºr aktuelle Versionen von aiohttp ist Python Version 3.6 und h√∂her erforderlich. Zum Zeitpunkt der Implementierung musste das Docker-Image aktualisiert werden.  Experimente mit √§lteren Versionen von aiohttp und Python 3.5 haben gezeigt, dass die Sendegeschwindigkeit bei diesen Versionen viel niedriger ist als bei neueren Versionen und mit dem sequentiellen Senden vergleichbar ist. </li><li>  Das Speichern einer gro√üen Menge von Asyncio corutin f√ºhrt schnell zur Ausgabe des gesamten Speichers.  Dies bedeutet, dass es unm√∂glich ist, alle Koroutinen f√ºr Briefe vorzubereiten und einen Zyklus zu veranlassen, sie zu verarbeiten. Es ist notwendig, die Daten vorzubereiten, w√§hrend Sie bereits geformte Briefe senden. </li></ol><br>  Unter Ber√ºcksichtigung aller Funktionen erstellen wir in jedem unserer Worker unseren Asynchronisationszyklus mit der √Ñhnlichkeit des ThreadPool-Musters, bestehend aus: <br><br><ul><li>  Ein oder mehrere Produzenten, die mit einer Datenbank √ºber Django ORM in einem separaten Thread √ºber asyncio.ThreadPoolExecutor arbeiten.  Der Hersteller versucht, Datenerfassungsanforderungen in kleinen Stapeln zusammenzufassen, Vorlagen f√ºr √ºber Jinja2 empfangene Daten zu rendern und Daten zum Senden an die Taskwarteschlange hinzuzuf√ºgen. </li></ul><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_campaign_send_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ids: Iterable[int])</span></span></span><span class="hljs-function"> -&gt; Iterable[Mapping[str, Any]]:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ,     Django ORM   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [{<span class="hljs-string"><span class="hljs-string">'id'</span></span>: id} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ids] <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mail_campaign_producer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ids: Iterable[int], task_queue: asyncio.Queue)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""           ,    .      ,     ThreadPoolExecutor. """</span></span> loop = asyncio.get_event_loop() total = len(ids) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> subchunk_start <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, total, PRODUCER_SUBCHUNK_SIZE): subchunk_ids = ids[subchunk_start : min(subchunk_start + PRODUCER_SUBCHUNK_SIZE, total)] send_tasks = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> loop.run_in_executor(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, get_campaign_send_data, subchunk_ids) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> task <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> send_tasks: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> task_queue.put(task)</code> </pre> <br><ul><li>  Mehrere hundert Absender von Briefen - asyncio coroutines, die in einem endlosen Zyklus Daten aus der Task-Warteschlange lesen, f√ºr jeden von ihnen Netzwerkanforderungen senden und das Ergebnis (Antwort oder Ausnahme) in die Berichtswarteschlange stellen. <br></li></ul><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_mail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: Mapping[str, Any], session: aiohttp.ClientSession)</span></span></span><span class="hljs-function"> -&gt; Union[Mapping[str, Any], Exception]:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> session.post(REQUEST_URL, data=data) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> response: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response.status_code != <span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mail_campaign_sender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( task_queue: asyncio.Queue, result_queue: asyncio.Queue, session: aiohttp.ClientSession )</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""        .     task_done,    ,   . """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: task_data = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> task_queue.get() result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> send_mail(task_data, session) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> result_queue.put(result) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> asyncio.CancelledError: <span class="hljs-comment"><span class="hljs-comment">#     raise except Exception as exception: #     await result_queue.put(exception) finally: task_queue.task_done()</span></span></code> </pre><br><ul><li>  Ein oder mehrere Mitarbeiter, die Daten aus der Berichtwarteschlange gruppieren und Informationen zum Ergebnis des Sendens eines Briefs an die Massendatenbank mit einer Anforderung bereitstellen. </li></ul><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process_campaign_results</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(results: Iterable[Union[Mapping[str, Any], Exception]])</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  :         """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mail_campaign_reporter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(task_queue: asyncio.Queue, result_queue: asyncio.Queue)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""          ThreadPoolExecutor,        . """</span></span> loop = asyncio.get_event_loop() results_chunk = [] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: results_chunk.append(<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> result_queue.get()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(results_chunk) &gt;= REPORTER_BATCH_SIZE: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> loop.run_in_executor(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, process_campaign_results, results_chunk) results_chunk.clear() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> asyncio.CancelledError: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> loop.run_in_executor(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, process_campaign_results, results_chunk) results_chunk.clear() <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: result_queue.task_done()</code> </pre><br><ul><li>  Die Task-Warteschlange, bei der es sich um eine Instanz von asyncio.Queue handelt, wird durch die maximale Anzahl von Elementen begrenzt, damit der Hersteller sie nicht √ºberf√ºllt und den gesamten Speicher belegt. </li><li>  Melden Sie Warteschlangen, auch eine Instanz von asyncio.Queue, mit einer Begrenzung der maximalen Anzahl von Elementen. </li><li>  Eine asynchrone Methode, die Warteschlangen und Worker erstellt und die Verteilung durch Anhalten beendet. </li></ul><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_mail_campaign</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( recipient_ids: Iterable[int], session: aiohttp.ClientSession, loop: asyncio.AbstractEventLoop = None )</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""       .    ,       . """</span></span> executor = ThreadPoolExecutor(max_workers=PRODUCERS_COUNT + <span class="hljs-number"><span class="hljs-number">1</span></span>) loop = loop <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> asyncio.get_event_loop() loop.set_default_executor(executor) task_queue = asyncio.Queue(maxsize=<span class="hljs-number"><span class="hljs-number">2</span></span> * SENDERS_COUNT, loop=loop) result_queue = asyncio.Queue(maxsize=<span class="hljs-number"><span class="hljs-number">2</span></span> * SENDERS_COUNT, loop=loop) producers = [ asyncio.ensure_future(mail_campaign_producer(recipient_ids, task_queue)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(PRODUCERS_COUNT) ] consumers = [ asyncio.ensure_future(mail_campaign_sender(task_queue, result_queue, session)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(SENDERS_COUNT) ] reporter = asyncio.ensure_future(mail_campaign_reporter(task_queue, result_queue)) <span class="hljs-comment"><span class="hljs-comment"># ,      done, _ = await asyncio.wait(producers) #    ,   await task_queue.join() while consumers: consumers.pop().cancel() #    ,     await result_queue.join() reporter.cancel()</span></span></code> </pre><br><ul><li>  Der Synchroncode, der die Schleife erstellt und die Verteilung startet. </li></ul><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close_session</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(future: asyncio.Future, session: aiohttp.ClientSession)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  ,    .  aiohttp      . """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.wait([future]) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(<span class="hljs-number"><span class="hljs-number">0.250</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> session.close() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mail_campaign_send_chunk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(recipient_ids: Iterable[int])</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     .   ,  asyncio     . """</span></span> loop = asyncio.new_event_loop() asyncio.set_event_loop(loop) <span class="hljs-comment"><span class="hljs-comment"># Session connector = aiohttp.TCPConnector(limit_per_host=0, limit=0) session = aiohttp.ClientSession( connector=connector, auth=aiohttp.BasicAuth('api', API_KEY), loop=loop, read_timeout=60 ) send_future = asyncio.ensure_future(send_mail_campaign(recipient_ids, session, loop=loop)) cleanup_future = asyncio.ensure_future(close_session(send_future, session)) loop.run_until_complete(asyncio.wait([send_future, cleanup_future])) loop.close()</span></span></code> </pre><br>  Nach der Implementierung dieser L√∂sung konnte die Zeit f√ºr den Versand von Massenmailings auf eine Stunde bei gleichem Mailingvolumen und 12 beteiligten Mitarbeitern reduziert werden.  Das hei√üt, jeder Mitarbeiter sendet 20 bis 25 Briefe pro Sekunde, was 50 bis 80 Mal produktiver ist als die urspr√ºngliche L√∂sung.  Der Speicherverbrauch der Worker wurde auf dem anf√§nglichen Niveau gehalten, die Prozessorauslastung leicht erh√∂ht, die Netzwerkauslastung um ein Vielfaches erh√∂ht, was den erwarteten Effekt darstellt.  Die Anzahl der Verbindungen zur Datenbank hat ebenfalls zugenommen, da jeder Fluss von Arbeiterproduzenten und Arbeitern, die Berichte speichern, aktiv mit der Datenbank arbeitet.  Gleichzeitig k√∂nnen freie Mitarbeiter kleine Mailings versenden, w√§hrend eine Massenkampagne verschickt wird. <br><br><img src="https://habrastorage.org/webt/xl/uh/uk/xluhuk6q37flgfyywloujb40eda.png"><br><br>  Trotz aller Vorteile weist eine solche Implementierung eine Reihe von Schwierigkeiten auf, die ber√ºcksichtigt werden m√ºssen: <br><br><ol><li>  Beim Umgang mit Fehlern ist Vorsicht geboten.  Eine nicht behandelte Ausnahme kann den Worker beenden und dazu f√ºhren, dass die Kampagne einfriert. </li><li>  Wenn das Senden abgeschlossen ist, m√ºssen keine Berichte zu Empf√§ngern verloren gehen, die den Block bis zum Ende nicht abgeschlossen haben, und sie m√ºssen in der Datenbank gespeichert werden. </li><li>  Die Logik, die Wiederaufnahme von Kampagnen gewaltsam zu stoppen, wird immer komplizierter, da nach dem Stoppen der sendenden Mitarbeiter verglichen werden muss, welche Empf√§nger Briefe erhalten haben und welche nicht. </li><li>  Nach einiger Zeit setzten sich die Mitarbeiter des Mailgun-Supports mit uns in Verbindung und baten uns, die Sendegeschwindigkeit zu verlangsamen, da E-Mails vor√ºbergehend abgelehnt wurden, wenn die H√§ufigkeit des Sendens den Schwellenwert √ºberschritt.  Dies ist einfach zu tun, indem die Anzahl der Arbeitnehmer verringert wird. </li><li>  Es w√§re nicht m√∂glich, Asyncio zu verwenden, wenn einige der Phasen des Briefversands prozessorintensive Vorg√§nge ausf√ºhren w√ºrden.  Das Rendern von Vorlagen mit jinja2 erwies sich als wenig ressourcenintensiv und hat praktisch keine Auswirkungen auf die Sendegeschwindigkeit. </li><li>  F√ºr die Verwendung von asyncio f√ºr Mailinglisten m√ºssen die Verteilungswarteschlangen-Handler von separaten Prozessen gestartet werden. </li></ol><br>  Ich hoffe, unsere Erfahrung wird f√ºr Sie von Nutzen sein!  Wenn Sie Fragen oder Anregungen haben, schreiben Sie in die Kommentare! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de482114/">https://habr.com/ru/post/de482114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de482102/index.html">Habr Q & A 2019: Ergebnisse des Jahres</a></li>
<li><a href="../de482104/index.html">Umgang mit den Gewohnheiten programmierter Menschen</a></li>
<li><a href="../de482106/index.html">Habr Freelance 2019: Ergebnisse des Jahres</a></li>
<li><a href="../de482108/index.html">Leise Intelligenz. Methode zur Identifizierung potenzieller WEB-Schwachstellen</a></li>
<li><a href="../de482110/index.html">Linux l√§uft auf meiner Visitenkarte</a></li>
<li><a href="../de482126/index.html">Keras Bewertung f√ºr TensorFlow</a></li>
<li><a href="../de482128/index.html">gReebok erkannt. Dermatovenerologe selbst</a></li>
<li><a href="../de482130/index.html">Umfangreiche Zuweisung von Rechten an Dom√§nenbenutzer aus verschiedenen Gesamtstrukturen</a></li>
<li><a href="../de482132/index.html">Tesla Cybertruck Kopie wurde in Moskau entdeckt. Dies ist eine ... russische LADA Samara</a></li>
<li><a href="../de482134/index.html">Vergleich der Hybriden oder was die Besitzer der rum√§nischen Meze-Kopfh√∂rer f√ºr 84 990 und 239 990 Rubel erwarten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>