<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🏫 🏸 🏄 Openstack负载平衡 🐻 🆖 👃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在大型云系统中，自动平衡或平衡计算资源负载的问题尤为严重。 Tionics还解决了这个问题（云服务的开发者和运营商，我们是Rostelecom集团公司的一部分）。 

 而且，由于我们的主要开发平台是Openstack，而且我们和所有人一样都很懒惰，因此决定选择某种已经成为平台一部分的现成模块。 我...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Openstack负载平衡</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/rostelecom/blog/461483/"> 在大型云系统中，自动平衡或平衡计算资源负载的问题尤为严重。  Tionics还解决了这个问题（云服务的开发者和运营商，我们是Rostelecom集团公司的一部分）。 <br><br> 而且，由于我们的主要开发平台是Openstack，而且我们和所有人一样都很懒惰，因此决定选择某种已经成为平台一部分的现成模块。 我们的选择取决于Watcher，我们决定将其用于我们的需求。 <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/i_/o6/ll/i_o6llxyfnumqc0nqrlnuk-ptem.jpeg" width="900"></a> <br> 首先，让我们处理术语和定义。 <br><a name="habracut"></a><br><h2> 术语和定义 </h2><br>  <b>目标</b>是必须实现的人类可读，可观察和可测量的最终结果。 为了实现每个目标，有一个或多个策略。 策略是算法的一种实现，能够为此找到解决方案。 <br><br>  <b>动作</b>是一项基本任务，它会更改OpenStack集群的目标托管资源的当前状态，例如：迁移虚拟机（迁移），更改节点电源的状态（change_node_power_state），更改nova服务的状态（change_nova_service_state），更改样式（调整大小）。 ，注册NOP消息（nop），在一定时间长度内不执行任何操作-暂停（睡眠），磁盘传输（volume_migrate）。 <br><br>  <b>行动计划（Action Plan）</b> -以特定顺序执行以实现特定目标的特定行动流。 该行动计划还包含估计的全球绩效以及一系列绩效指标。 行动计划是由Watcher在成功审核期间生成的，因此，所使用的策略可以找到实现目标的解决方案。 行动计划由一系列连续行动组成。 <br><br>  <b>审计</b>是对集群优化的要求。 为了实现给定群集中的一个目标，执行了优化。 对于每次成功的审核，Watcher都会生成一个行动计划。 <br><br>  <b>审核范围</b>是在其中执行审核的一组资源（可用区，节点聚合器，单个计算节点或存储节点等）。 在每个模板中定义了审核范围。 如果未指定审核范围，则将审核整个群集。 <br><br>  <b>审核模板</b> -保存的一组设置，用于开始审核。 需要模板才能多次使用相同的设置运行审核。 模板必须包含审核的目的，如果未指定策略，则选择最合适的现有策略。 <br><br>  <b>群集</b>是一组物理计算机，它们提供计算，存储和网络资源，并由同一OpenStack控制节点进行管理。 <br><br>  <b>群集数据模型（CDM）</b>是群集管理资源的当前状态和拓扑的逻辑表示。 <br><br>  <b>效率指标（效率指标）</b> -指示如何实施使用此策略创建的解决方案的指标。 绩效指标是特定于特定目标的，通常用于计算最终行动计划的整体有效性。 <br><br>  <b>功效规范</b>是与每个目标相关的一组特定功能，它定义了确保实现相应目标的策略应在其决策中提供的各种绩效指标。 实际上，将在计算策略整体有效性之前检查该策略提出的每个解决方案是否符合规范。 <br><br>  <b>“评分引擎”</b>是具有明确定义的输入数据，明确定义的输出数据并执行纯数学任务的可执行文件。 因此，该计算不依赖于执行该计算的环境-它将在任何地方给出相同的结果。 <br><br>  <b>Watcher Planner</b>是Watcher决策引擎的一部分。 该模块接受该策略生成的一组动作，并创建一个工作流计划，该计划定义如何及时计划这些各种动作，对于每个动作，先决条件是什么。 <br><br><h2> 观察者目标和策略 </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <b>目的</b> </td><td> 策略 </td></tr><tr><td rowspan="3">  <b>虚拟目标</b> </td><td> 虚拟策略 </td></tr><tr><td> 使用样本评分引擎的虚拟策略 </td></tr><tr><td> 调整大小的虚拟策略 </td></tr><tr><td>  <b>节约能源</b> </td><td> 节能战略 </td></tr><tr><td rowspan="2">  <b>服务器整合</b> </td><td> 基本脱机服务器整合 </td></tr><tr><td>  VM工作负载合并策略 </td></tr><tr><td rowspan="3">  <b>工作负载均衡</b> </td><td> 工作负载平衡迁移策略 </td></tr><tr><td> 存储容量平衡策略 </td></tr><tr><td> 工作量稳定 </td></tr><tr><td>  <b>吵闹的邻居</b> </td><td> 吵闹的邻居 </td></tr><tr><td>  <b>热优化</b> </td><td> 基于出口温度的策略 </td></tr><tr><td>  <b>气流优化</b> </td><td> 均匀气流迁移策略 </td></tr><tr><td>  <b>硬件维修</b> </td><td> 区域迁移 </td></tr><tr><td>  <b>未分类</b> </td><td> 执行器 </td></tr></tbody></table></div><br>  <b>虚拟目标</b> -用于测试目的的备用目标。 <br><br> 相关策略：虚拟策略，使用示例评分引擎的虚拟策略和具有调整大小的虚拟策略。 虚拟策略是通过Tempest进行集成测试的虚拟策略。 该策略没有提供任何有用的优化；其唯一目的是使用Tempest测试。 <br><br> 使用样本评分引擎的虚拟策略-该策略与先前的策略相似，仅在“评估引擎”样本的使用方面有所不同，后者使用机器学习方法进行计数。 <br><br> 具有调整大小的虚拟策略-该策略与上一个策略类似，仅在更改风味（迁移和调整大小）的用法上有所不同。 <br><br> 未在生产中使用。 <br><br>  <b>节约能源</b> -减少能耗。 节能策略与VM工作负载合并策略（服务器合并）一起能够执行动态电源管理（DPM）功能，即使在资源负荷较低的情况下，该功能也可以通过动态整合工作负载来节省能源：虚拟机转移到更少的节点上，不必要的节点将断开连接。 合并后，该策略将决定根据给定的参数打开/关闭节点：“ min_free_hosts_num”-等待负载的空闲包含的节点数，“ free_used_percent”-空闲包含的节点占计算机所占节点数的百分比。 为了使该策略<b>起作用，</b>必须<b>打开Ironic并将其配置为在节点上打开/关闭电源的情况下工作。</b> <br><br><h3> 策略选择 </h3><br><div class="scrollable-table"><table><tbody><tr><td>  <b>参数</b> </td><td>  <b>类型</b> </td><td>  <b>默认情况下</b> </td><td>  <b>说明</b> </td></tr><tr><td>  <b>free_used_percent</b> </td><td> 编号 </td><td>  10.0 </td><td> 可用虚拟机的免费计算节点数与计算节点数之比 </td></tr><tr><td>  <b>min_free_hosts_num</b> </td><td> 整数 </td><td>  1个 </td><td> 最少的免费计算节点数 </td></tr></tbody></table></div><br> 云中必须至少有两个节点。 所使用的方法是更改​​节点的电源状态（change_node_power_state）。  <b>策略不需要收集指标。</b> <br><br> 服务器整合-最小化计算节点的数量（整合）。 它有两个策略：基本脱机服务器合并和VM工作负载合并策略。 <br><br> 基本脱机服务器合并策略可最大程度地减少使用的服务器总数，并最大程度减少迁移次数。 <br><br>  <b>基本策略需要以下指标：</b> <b><br></b> <br><div class="scrollable-table"><table><tbody><tr><td>  <b>公制</b> </td><td>  <b>服务项目</b> </td><td>  <b>外挂程式</b> </td><td>  <b>评论</b> </td></tr><tr><td>  <b>compute.node.cpu.percent</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td></td></tr><tr><td>  <b>cpu_util</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td></td></tr></tbody></table></div><br> 策略参数：migration_attempts-搜索潜在关闭候选对象的组合数（默认值，0，无限制），period-从度量标准数据源获取静态聚合的时间间隔（以秒为单位）（默认值为700）。 <br><br> 使用的方法：迁移，新星服务状态更改（change_nova_service_state）。 <br><br>  VM Workload Consolidation策略基于“最适合的启发式”算法，该算法专注于测得的CPU负载，并考虑到资源容量限制，尝试最小化负载过多或过少的节点。 此策略提供了一种解决方案，可通过以下四个步骤来更有效地利用群集资源： <br><br><ol><li> 卸载阶段-处理过度使用的资源； </li><li> 合并阶段-处理未充分利用的资源； </li><li> 解决方案优化-减少迁移数量； </li><li> 禁用未使用的计算节点。 </li></ol><br> 该策略需要以下指标： <br><br><div class="scrollable-table"><table><tbody><tr><td>  <b>公制</b> </td><td>  <b>服务项目</b> </td><td>  <b>外挂程式</b> </td><td>  <b>评论</b> </td></tr><tr><td>  <b>记忆力</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td></td></tr><tr><td>  <b>disk.root.size</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td></td></tr></tbody></table></div><br> 以下指标是可选的，但可以提高策略的准确性（如果有）： <br><div class="scrollable-table"><table><tbody><tr><td>  <b>公制</b> </td><td>  <b>服务项目</b> </td><td>  <b>外挂程式</b> </td><td>  <b>评论</b> </td></tr><tr><td>  <b>内存居民</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td></td></tr><tr><td>  <b>cpu_util</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td></td></tr></tbody></table></div><br> 策略参数：period-从度量标准数据源获得静态聚合的时间间隔（以秒为单位）（默认为3600）。 <br><br> 使用与先前策略相同的方法。 更多细节<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里</a> 。 <br><br>  <b>工作负载平衡</b> -平衡计算节点之间的工作负载。 该目标具有三个策略：工作负载平衡迁移策略，工作负载稳定，存储容量平衡策略。 <br><br> 工作负载平衡迁移策略根据主机虚拟机的工作负载启动虚拟机迁移。 每当节点的CPU或RAM利用率百分比超过指定的阈值时，就做出传输决定。 在这种情况下，移动的虚拟机应使节点更接近所有节点的平均工作负载。 <br><br><h3> 要求条件 </h3><br><ul><li> 使用物理处理器； </li><li> 至少两个物理计算节点； </li><li> 安装并配置的Ceilometer组件是在每个计算节点上运行的ceilometer-agent-compute和Ceilometer API，并收集以下指标： </li></ul><br><div class="scrollable-table"><table><tbody><tr><td>  <b>公制</b> </td><td>  <b>服务项目</b> </td><td>  <b>外挂程式</b> </td><td>  <b>评论</b> </td></tr><tr><td>  <b>cpu_util</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td></td></tr><tr><td>  <b>内存居民</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td></td></tr></tbody></table></div><br> 策略选项： <br><div class="scrollable-table"><table><tbody><tr><td>  <b>参数</b> </td><td>  <b>类型</b> </td><td>  <b>默认情况下</b> </td><td>  <b>说明</b> </td></tr><tr><td>  <b>指标</b> </td><td> 弦乐 </td><td>  'cpu_util' </td><td> 作为基础的度量标准：“ cpu_util”，“ memory.resident”。 </td></tr><tr><td>  <b>门槛</b> </td><td> 编号 </td><td>  25.0 </td><td> 迁移的工作量阈值。 </td></tr><tr><td>  <b>期间</b> </td><td> 编号 </td><td>  300 </td><td> 云高仪的累计时间段。 </td></tr></tbody></table></div><br> 使用的方法是迁移。 <br><br> 工作负载稳定-一种旨在通过实时迁移来稳定工作负载的策略。 该策略基于标准偏差算法，确定集群中是否存在拥塞，并通过触发机器迁移来稳定集群来对此做出响应。 <br><br><h3> 要求条件 </h3><br><ul><li> 使用物理处理器； </li><li> 至少两个物理计算节点； </li><li> 安装并配置的Ceilometer组件是在每个计算节点上运行的ceilometer-agent-compute和Ceilometer API，并收集以下指标： </li></ul><br><div class="scrollable-table"><table><tbody><tr><td>  <b>公制</b> </td><td>  <b>服务项目</b> </td><td>  <b>外挂程式</b> </td><td>  <b>评论</b> </td></tr><tr><td>  <b>cpu_util</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td></td></tr><tr><td>  <b>内存居民</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td></td></tr></tbody></table></div><br> 存储容量平衡策略（自皇后区开始实施的策略）-该策略根据Cinder池的负载来传输磁盘。 只要池利用率超过指定的阈值，就做出转移决定。 漫游磁盘应使池接近所有Cinder池的平均负载。 <br><br><h3> 要求与限制 </h3><br><ul><li> 至少两个煤渣池； </li><li> 能够迁移磁盘。 </li><li> 集群数据模型收集器。 </li></ul><br> 策略选项： <br><br><div class="scrollable-table"><table><tbody><tr><td>  <b>参数</b> </td><td>  <b>类型</b> </td><td>  <b>默认情况下</b> </td><td>  <b>说明</b> </td></tr><tr><td>  <b>volume_threshold</b> </td><td> 编号 </td><td>  80.0 </td><td> 磁盘的阈值，用于进行卷平衡。 </td></tr></tbody></table></div><br> 使用的方法是磁盘迁移（volume_migrate）。 <br><br> 嘈杂邻居-识别并迁移“嘈杂邻居”-一种低优先级虚拟机，从IPC角度来看，这会严重影响高优先级虚拟机的性能，并过度使用最后一级缓存。 自己的策略：嘈杂的邻居（使用的策略参数为cache_threshold（默认值为35），当性能下降到指定值时开始迁移。为使该策略起作用，包括了<b>LLC（上级缓存）指标，</b> <b>最新的具有CMT支持的Intel服务器</b> ，以及收集以下指标： <br><div class="scrollable-table"><table><tbody><tr><td>  <b>公制</b> </td><td>  <b>服务项目</b> </td><td>  <b>外挂程式</b> </td><td>  <b>评论</b> </td></tr><tr><td>  <b>cpu_l3_cache</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td> 无 </td><td> 需要英特尔<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CMT</a> 。 </td></tr></tbody></table></div><br> 群集数据模型（默认）：Nova群集数据模型收集器。 应用的方法是迁移。 <br><br> 通过仪表板实现此目的的工作在Queens中尚未完全实现。 <br><br>  <b>热优化</b> -优化温度条件。 出口温度（排气）是测量服务器热/工作量状态的重要热遥测系统之一。 为此，有一种策略-基于出口温度的策略，当原始主机的输出温度达到自定义阈值时，该决策将工作负载转移到具有良好温度条件（出口处的最低温度）的节点。 <br><br> 为使该策略生效，您需要一台服务器并安装并安装了Intel Power Node Manager <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.0或更高版本</a> ，并且需要收集以下指标： <br><div class="scrollable-table"><table><tbody><tr><td>  <b>公制</b> </td><td>  <b>服务项目</b> </td><td>  <b>外挂程式</b> </td><td>  <b>评论</b> </td></tr><tr><td>  <b>hardware.ipmi.node.outlet_temperature</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td>  IPMI </td><td></td></tr></tbody></table></div><br> 策略选项： <br><div class="scrollable-table"><table><tbody><tr><td>  <b>参数</b> </td><td>  <b>类型</b> </td><td>  <b>默认情况下</b> </td><td>  <b>说明</b> </td></tr><tr><td>  <b>门槛</b> </td><td> 编号 </td><td>  35.0 </td><td> 迁移温度阈值。 </td></tr><tr><td>  <b>期间</b> </td><td> 编号 </td><td>  30 </td><td> 从度量标准数据源获得统计汇总的时间间隔（以秒为单位）。 </td></tr></tbody></table></div><br> 使用的方法是迁移。 <br><br>  <b>气流优化</b> -优化通风模式。 自己的策略-使用实时迁移实现统一气流。 每当来自服务器风扇的气流超过指定的阈值时，该策略便开始迁移虚拟机。 <br><br> 要运作，该策略需要： <br><br><ul><li> 硬件：&lt;具有NodeManager 3.0支持的计算节点； </li><li> 至少两个计算节点； </li><li> 在每个计算节点上安装和配置的ceilometer-agent-compute和Ceilometer API组件可以成功报告指标，例如空气流量，系统功率和入口温度： </li></ul><br><div class="scrollable-table"><table><tbody><tr><td>  <b>公制</b> </td><td>  <b>服务项目</b> </td><td>  <b>外挂程式</b> </td><td>  <b>评论</b> </td></tr><tr><td>  <b>hardware.ipmi.node.airflow</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td>  IPMI </td><td></td></tr><tr><td>  <b>硬件，ipmi，节点温度</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td>  IPMI </td><td></td></tr><tr><td>  <b>hardware.ipmi.node.power</b> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云高仪</a> </td><td>  IPMI </td><td></td></tr></tbody></table></div><br> 为使该策略生效，您需要安装和配置了Intel Power Node Manager 3.0或更高版本的服务器。 <br><br> 局限性：该概念不适用于生产。 <br><br> 由于每次迭代计划仅迁移一个虚拟机，因此建议将此算法与连续审核一起使用。 <br><br> 可以进行实时迁移。 <br><br> 策略选项： <br><div class="scrollable-table"><table><tbody><tr><td>  <b>参数</b> </td><td>  <b>类型</b> </td><td>  <b>默认情况下</b> </td><td>  <b>说明</b> </td></tr><tr><td>  <b>threshold_airflow</b> </td><td> 编号 </td><td>  400.0 </td><td> 迁移单元的气流阈值为0.1CFM </td></tr><tr><td>  <b>threshold_inlet_t</b> </td><td> 编号 </td><td>  28.0 </td><td> 决定迁移的入口温度阈值 </td></tr><tr><td>  <b>threshold_power</b> </td><td> 编号 </td><td>  350.0 </td><td> 决定迁移的系统功率阈值 </td></tr><tr><td>  <b>期间</b> </td><td> 编号 </td><td>  30 </td><td> 从度量标准数据源获得统计汇总的时间间隔（以秒为单位）。 </td></tr></tbody></table></div><br> 使用的方法是迁移。 <br><br>  <b>硬件维护</b> -硬件维护。 与该目标相关的策略是区域迁移。 该策略是在硬件维护的情况下有效地自动最小化虚拟机和磁盘迁移的工具。 该策略根据权重建立一个行动计划：将在其他行动之前计划一组具有更大权重的行动。 有两个配置选项：操作权重（action_weights）和并行化。 <br><br> 局限性：有必要调整动作和并行化的权重。 <br><br> 策略选项： <br><div class="scrollable-table"><table><tbody><tr><td>  <b>参数</b> </td><td>  <b>类型</b> </td><td>  <b>默认情况下</b> </td><td>  <b>说明</b> </td></tr><tr><td>  <b>计算节点</b> </td><td> 数组 </td><td> 无 </td><td> 计算节点进行迁移。 </td></tr><tr><td>  <b>storage_pools</b> </td><td> 数组 </td><td> 无 </td><td> 用于迁移的存储节点。 </td></tr><tr><td>  <b>parallel_total</b> </td><td> 整数 </td><td>  6 </td><td> 并行执行的动作总数。 </td></tr><tr><td>  <b>parallel_per_node</b> </td><td> 整数 </td><td>  2 </td><td> 每个计算节点并行执行的操作数。 </td></tr><tr><td>  <b>parallel_per_pool</b> </td><td> 整数 </td><td>  2 </td><td> 每个存储池并行执行的操作数。 </td></tr><tr><td>  <b>优先权</b> </td><td> 对象 </td><td> 无 </td><td> 虚拟机和磁盘的优先级列表。 </td></tr><tr><td>  <b>with_attached_volume</b> </td><td> 布尔值 </td><td> 错误的 </td><td>  False-迁移所有驱动器后，将迁移虚拟机。 正确-迁移所有映射的驱动器后，将迁移虚拟机。 </td></tr></tbody></table></div><br> 计算节点数组的元素： <br><div class="scrollable-table"><table><tbody><tr><td>  <b>参数</b> </td><td>  <b>类型</b> </td><td>  <b>默认情况下</b> </td><td>  <b>说明</b> </td></tr><tr><td>  <b>src_node</b> </td><td> 弦 </td><td> 无 </td><td> 从中迁移虚拟机的计算节点（必需）。 </td></tr><tr><td>  <b>dst_node</b> </td><td> 弦 </td><td> 无 </td><td> 计算虚拟机迁移到的节点。 </td></tr></tbody></table></div><br> 存储节点数组的元素： <br><div class="scrollable-table"><table><tbody><tr><td>  <b>参数</b> </td><td>  <b>类型</b> </td><td>  <b>默认情况下</b> </td><td>  <b>说明</b> </td></tr><tr><td>  <b>src_pool</b> </td><td> 弦 </td><td> 无 </td><td> 从中迁移磁盘的存储池（必需）。 </td></tr><tr><td>  <b>dst_pool</b> </td><td> 弦 </td><td> 无 </td><td> 磁盘迁移到的存储池。 </td></tr><tr><td>  <b>src_type</b> </td><td> 弦 </td><td> 无 </td><td> 原始磁盘类型（必填）。 </td></tr><tr><td>  <b>dst_type</b> </td><td> 弦 </td><td> 无 </td><td> 主驱动器类型（必填）。 </td></tr></tbody></table></div><br> 优先对象的元素： <br><div class="scrollable-table"><table><tbody><tr><td>  <b>参数</b> </td><td>  <b>类型</b> </td><td>  <b>默认情况下</b> </td><td>  <b>说明</b> </td></tr><tr><td>  <b>专案</b> </td><td> 数组 </td><td> 无 </td><td> 项目的名称。 </td></tr><tr><td>  <b>计算节点</b> </td><td> 数组 </td><td> 无 </td><td> 计算节点名称。 </td></tr><tr><td>  <b>storage_pool</b> </td><td> 数组 </td><td> 无 </td><td> 存储池的名称。 </td></tr><tr><td>  <b>计算</b> </td><td> 枚举 </td><td> 无 </td><td> 虚拟机参数[“ vcpu_num”，“ mem_size”，“ disk_size”，“ created_at”]。 </td></tr><tr><td>  <b>贮藏</b> </td><td> 枚举 </td><td> 无 </td><td> 磁盘选项[“ size”，“ created_at”]。 </td></tr></tbody></table></div><br> 使用的方法-虚拟机迁移，磁盘迁移。 <br><br>  <b>未分类</b>是用于促进策略制定的辅助目标。 它不包含规范，并且只要该策略尚未与现有目标关联就可以使用。 这个目标也可以用作过渡阶段。 相关策略是执行器。 <br><br><h2> 创建一个新目标 </h2><br>  <b>Watcher Decision Engine</b>具有“外部目标”插件界面，可让您集成可以使用策略实现的外部目标。 <br><br> 在创建新目标之前，您应确保现有目标均不满足您的需求。 <br><br><h3> 创建一个新的插件 </h3><br> 要创建新目标，您必须：扩展目标类，实现<b>get_name（）</b>类方法以为要创建的新目标返回唯一标识符。 此唯一标识符必须与您稍后声明的入口点的名称匹配。 <br><br> 接下来，您需要实现类方法<b>get_display_name（）</b>以返回要创建的目标的翻译后的显示名称（不要使用该变量返回翻译后的字符串，以便翻译工具可以自动收集该字符串）。 <br><br> 实现<b>get_translatable_display_name（）</b>类方法以返回新目标的翻译键（实际上是英文显示名称）。 返回值必须与转换为get_display_name（）的字符串匹配。 <br><br> 实现其<b>get_efficacy_specification（）</b>方法以返回性能规格供您使用。  get_efficacy_specification（）方法返回Watcher提供的Unclassified（）实例。 此性能规格在制定目标的过程中很有用，因为它符合空的规格。 <br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处有更多详细信息</a> <br><br> 体系结构观察器（更多信息<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a> ）。 <br><br><img src="https://habrastorage.org/webt/q7/ei/fb/q7eifbf7zjvdiwm3cna7ipzttyq.png"><br><br><h3> 组成部分 </h3><br><img src="https://habrastorage.org/webt/rx/fv/om/rxfvom9yai_at5zt7bwlxs4ole0.png"><br><br>  <b>Watcher API-</b>实现Watcher提供的REST API的组件。 交互机制：CLI，Horizo​​n插件，Python SDK。 <br><br>  <b>Watcher DB</b> -Watcher数据库。 <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watcher Applier-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">观察者决策者创建的行动计划的实施组件。</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watcher Decision Engine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是负责计算一组可能的优化操作以实现审核目标的组件。如果未指定策略，则组件将独立选择最合适的策略。</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watcher Metrics Publisher</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个收集和计算某些度量标准或事件并将其发布到CEP端点的组件。功能功能也可以由Ceilometer发行商提供。</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复杂事件处理（CEP）引擎</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-用于复杂事件处理的引擎。</font><font style="vertical-align: inherit;">出于性能方面的考虑，CEP引擎可能同时运行多个实例，每个实例都处理一种特定类型的度量标准/事件。</font><font style="vertical-align: inherit;">在Watcher系统中，CEP启动两种类型的操作：-将相应的事件/指标写入时间序列数据库；</font><font style="vertical-align: inherit;">-由于Openstack集群不是静态系统，因此当此事件可能影响当前优化策略的结果时，将相关事件发送给Watcher Decision Engine组件。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组件的交互是根据AMQP协议执行的。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">→ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置观察器</font></font></a> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 与Watcher的交互方案 </font></font></h3><br><img src="https://habrastorage.org/webt/_w/0a/di/_w0adiqerc6ar47nhdoitlh1uje.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 观察者测试结果 </font></font></h2><br><ol><li>   Optimization — Action plans 500  (   Queens,       ),    ,       ,   . </li><li>   Action details ,        (   Queens,       ). </li><li>    Dummy ()    ,   . </li><li>    Unclassified  ,               . </li><li>    Workload Balancing ( Storage Capacity balance)  ,     .     . </li><li>    Workload Balancing ( Workload Balance Migration Strategy)  ,     . </li><li>    Workload Balancing ( Workload Stabilization Strategy)  . </li><li>    Noisy Neighbor  ,     . </li><li>    Hardware maintenance  ,        (  ,      ). </li><li>    nova.conf ( default  compute_monitors = cpu.virt_driver)        . </li><li>    Server Consolidation ( Basic)    . </li><li>    Server Consolidation ( VM workload consolidation)   .      .  ,  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . <br>    - Watcher (  —       Optimization,     -   ): <br><br> [watcher_strategies.basic] <br> datasource = ceilometer, gnocchi </li><li>    Saving Energy   .   ,  -   Ironic,     baremetal service. </li><li>    Thermal Optimization   .   ,    Server Consolidation ( VM workload consolidation) (  ) </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 气流优化审核失败。 </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还遇到以下审核完成错误。</font><font style="vertical-align: inherit;">Decision-engine.log日志中的回溯（未定义集群状态）。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">→在</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">这里</font></a><font style="vertical-align: inherit;">讨论错误</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a> <br><br><h2> 结论 </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们进行了为期两个月的研究，得出了明确的结论：为了获得功能完善的工作负载平衡系统，我们必须紧密合作才能最终确定Openstack平台的工具。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watcher已证明自己是一个严肃且迅速发展的产品，具有巨大的潜力，要充分利用它，将需要进行大量认真的工作。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，在本周期的下一篇文章中会更多地介绍这一点。</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN461483/">https://habr.com/ru/post/zh-CN461483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN461467/index.html">为Go应用程序创建Makefile的示例</a></li>
<li><a href="../zh-CN461469/index.html">以每分钟1000个字的速度收听代码是什么感觉</a></li>
<li><a href="../zh-CN461471/index.html">.NET-用于处理多线程和异步的工具-第2部分</a></li>
<li><a href="../zh-CN461473/index.html">图上的调试算法-现在带有图片</a></li>
<li><a href="../zh-CN461475/index.html">AMA与Habr.1011</a></li>
<li><a href="../zh-CN461487/index.html">迷你CTF任务</a></li>
<li><a href="../zh-CN461493/index.html">Django 3.0将是异步的</a></li>
<li><a href="../zh-CN461497/index.html">Linux上的现代文本呈现：第1部分</a></li>
<li><a href="../zh-CN461499/index.html">2019年将翻译您的游戏的语言</a></li>
<li><a href="../zh-CN461501/index.html">为什么在美国他们正在调查大型IT公司的工作</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>