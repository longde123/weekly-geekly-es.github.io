<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎢 👨🏻‍🎨 🏯 Web服务器之战。 第1部分-HTTP与现实脱节： 🕝 🏬 👨🏽‍🔬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="有人可能会说，在本文中，我们将尝试进行逆向工程。 我们用肮脏的双手望着每台Web服务器的身影，以前所未有的方式利用它们。 

 该测试是在真空中对球形马的测量，仅是接收到的数据，现在我们不知道如何处理它们。 


 方法论 
 Nginx和Apache的操作系统是IIS Windows Server...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Web服务器之战。 第1部分-HTTP与现实脱节：</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ultravds/blog/478854/"> 有人可能会说，在本文中，我们将尝试进行逆向工程。 我们用肮脏的双手望着每台Web服务器的身影，以前所未有的方式利用它们。 <br><br> 该测试是在真空中对球形马的测量，仅是接收到的数据，现在我们不知道如何处理它们。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a3b/e3c/9a6/a3be3c9a63ac32025da9671172988f8b.png"></div><a name="habracut"></a><br><h2> 方法论 </h2><br>  Nginx和Apache的操作系统是IIS Windows Server Core 2019的Ubuntu 18.04 LTS。测试之前的所有操作系统均于2019年12月4日收到最新更新。 <br><br> 测试仅通过HTTP进行。 每个Web服务器都有相同的页面，这是Codrops提供的Jekyll的免费模板。  <a href="https://tympanus.net/codrops/2018/04/20/freebie-oasis-jekyll-website-template/">友情链接</a> 在每个Web服务器上，gzip压缩均已关闭。 <br><br> 带宽测试是使用带有参数的Httpd工具进行的： <br><br><pre><code class="plaintext hljs">ab -n 50000 -c 500 http://192.168.76.204:80/</code> </pre> <br> 将服务器的限制分别设置为8、4和1个核心的10％，5％和1％。 作为测试平台，有一台计算机在9400K @ 5400 MHz下运行，这意味着接收10％限制的服务器每个内核可获得约540 MHz。 <br><br>  TTFB测试是在服务器首次启动时进行的，并使用DevTools进行了测量，接收到结果后，服务器将关闭电源并回滚到先前的控制点以排除任何类型的缓存的出现。 <br><br> 测试仪和Web服务器位于同一主机和同一虚拟交换机上。 <br><br> 为了立即评估磁盘子系统，可以通过ATTO和CrystalDIskMark基准测试的结果来了解瓶颈。 <br><br><div class="spoiler">  <b class="spoiler_title">从虚拟机获取的数据：</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/987/071/ae3/987071ae309b892736edf426561390ad.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/177/d54/21a/177d5421a6fd02ba6248eb2e1424ddba.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f11/628/962/f11628962346d7fbcd3081b0a660d08b.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a6/a51/fcd/8a6a51fcd25882041aca693f86e6ad9f.png"></div><br></div></div><br><h2> 结果： </h2><br>  TTFB： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc1/204/7f6/fc12047f65760db65a25549a1ff0bbc3.png"></div><br>  <i>IIS的平均TTFB最小，为0.5毫秒，而Apache的平均TTFB为1.4毫秒，Nginx的平均为4毫秒。</i> <br><br>  <b>吞吐量：</b> <br><br> 首先，考虑每个服务器在核心数量方面的扩展程度。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/010/fe7/179/010fe71793558345e22d1cea925402d5.png"></div><br> 该图显示了测试人员调用Web服务器的次数和延迟。 该图显示，NGINX完成了所有点击的98％，使网站停留了20毫秒或更短的时间。  IIS和Apache的最后5％的呼叫分别工作了76ms和14ms。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c4/bed/4fd/5c4bed4fdb7a77ca8fb8ad7ca4ecca81.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/212/c07/d9f/212c07d9f863997f644e9c59d2080d0a.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/331/cba/9f2/331cba9f2ae9d4dbcf9a92dda98650ff.png"></div><br> 该图显示了压力测试期间一个请求的平均处理时间。 <br><br> 从图中可以看到，IIS导致Apache和Nginx都崩溃了，在高负载下速度大大降低。 <br><br>  IIS显然比四个核心更喜欢四个核心，这显示四个核心上的延迟较少，但也没有强烈支持一个核心。 <br><br>  NGINX可以完美地扩展到所有8个内核，对于Apache来说，似乎单核脚本似乎是最佳选择。 <br><br><h2> 可扩展性： </h2><br>  <b>Nginx：</b> <br><br> 现在考虑核心频率和数量上的可伸缩性。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dde/4ad/09d/dde4ad09db856dbe0e2e400b6db7779d.png"></div><br>  Nginx在4个和1个内核上的限制为1％的测试未通过，留下了2000个请求，它与测试器断开了连接。 <br><br>  <b>阿帕奇：</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ccf/897/d8f/ccf897d8f3ba057f35a37e0dc3987241.png"></div><br> 处理了2500个请求后，作为Nginx的Apache投降并断开了连接。  Apache未能通过限制为1％的8、4和1个内核的测试，但是此外，一个内核的5％限制的测试没有通过，这比Nginx差。 <br><br>  <b>IIS：</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30b/d79/a5e/30bd79a5e56fb568807fe6bac6fb87e0.png"></div><br> 在测试期间，IIS收集了大量的请求队列，但处理了每个请求。 显然，没有在其中设置用于处理请求的开箱超时。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bb3/f5b/afd/bb3f5bafd10834b8a352ae6518051991.png"></div><br> 该图显示了完成测试所需的时间。 荒唐荒谬的测试配置被删除。 该图显示了IIS对硬件的要求以及NGINX的美观程度。 <br><br><h2> 磁盘可伸缩性： </h2><br>  <b>Nginx：</b> <br><br> 现在考虑频率，内核数和磁盘速度的可伸缩性。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c5d/fbb/b95/c5dfbbb95be9109b43c02fcb02b7fd33.png"></div><br> 这次Nginx未能通过4次测试，而不是两次。 <br><br>  <b>阿帕奇：</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7cd/175/d52/7cd175d520fd742b1526ffe66e04e737.png"></div><br>  Apache失败的测试次数与上次相同。 <br><br>  <b>IIS：</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e8/f5a/f1b/4e8f5af1b790a7ea2b1f07429726d4a4.png"></div><br>  IIS显示几乎完全相同的图，就好像没有磁盘限制一样。 通常，所有服务器的图形变化不大，这意味着它们中的每一个都将静态数据缓存到RAM中并从那里提供。 在这里，我们看到了主要瓶颈-Web服务器本身。 <br><br> 根据此测试得出结论还为时过早；我们尚未使用Let's Encrypt提供的实时证书测试HTTPS，压缩和HTTP / 2。 我们将在下一篇文章中讨论。 <br><br> 我们提供了已更新的UltraLite <a href="https://ultravds.com/">Windows VDS</a>关税，已安装Windows Server 2019 Core的价格为99卢布。 <br> <a href="https://ultravds.com/"><img src="https://habrastorage.org/webt/ww/d4/ro/wwd4ro5_5a28hvdxyazf3enjxou.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN478854/">https://habr.com/ru/post/zh-CN478854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN478838/index.html">喷气背包的第一次死亡</a></li>
<li><a href="../zh-CN478840/index.html">市场的创建从哪里开始。 第二部分</a></li>
<li><a href="../zh-CN478844/index.html">对IT的恐惧与厌恶</a></li>
<li><a href="../zh-CN478846/index.html">系统化的交互式脚本和计时器</a></li>
<li><a href="../zh-CN478848/index.html">数码摄影的演变</a></li>
<li><a href="../zh-CN478856/index.html">SD-WAN-2020年的最新趋势和预测</a></li>
<li><a href="../zh-CN478858/index.html">在XHProf Admin中比较分析会话</a></li>
<li><a href="../zh-CN478862/index.html">Yandex.Market中如何安排前端测试，以及为什么我们拒绝每周发布</a></li>
<li><a href="../zh-CN478866/index.html">满足空间-JetBrains的新产品</a></li>
<li><a href="../zh-CN478874/index.html">东芝宣布了两条新的容量高达6 TB的HDD系列产品，并宣布自2020年以来专注于企业领域</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>