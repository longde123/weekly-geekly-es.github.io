<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§±üèΩ üëºüèº üßòüèø Protocolos de flujo como herramienta para monitorear la seguridad de la red interna ü•ã üèë üï∑Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cuando se trata de monitorear la seguridad de una red interna corporativa o departamental, muchos tienen una asociaci√≥n con el control de fugas de inf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Protocolos de flujo como herramienta para monitorear la seguridad de la red interna</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/cisco/blog/464601/">  Cuando se trata de monitorear la seguridad de una red interna corporativa o departamental, muchos tienen una asociaci√≥n con el control de fugas de informaci√≥n y la implementaci√≥n de soluciones DLP.  Y si intenta aclarar la pregunta y preguntar c√≥mo detecta ataques en la red interna, la respuesta generalmente ser√° la menci√≥n de los sistemas de detecci√≥n de intrusos (IDS).  Y lo que era la √∫nica opci√≥n hace 10-20 a√±os, hoy se est√° convirtiendo en un anacronismo.  Existe una opci√≥n m√°s efectiva y, en algunos lugares, la √∫nica opci√≥n posible para monitorear la red interna: usar protocolos de flujo que fueron dise√±ados originalmente para buscar problemas de red (soluci√≥n de problemas), pero que finalmente se transformaron en una herramienta de seguridad muy interesante.  Hablaremos sobre qu√© son los protocolos de flujo y cu√°les ayudan mejor a detectar ataques de red, d√≥nde es mejor implementar el monitoreo de flujo, qu√© buscar al implementar dicho esquema e incluso c√≥mo "recogerlo" en equipos dom√©sticos como parte de este art√≠culo <a name="habracut"></a><br><br>  No me detendr√© en la pregunta "¬øPor qu√© necesitamos monitorear la seguridad de la infraestructura interna?"  La respuesta parece ser clara.  Pero si, sin embargo, desea asegurarse una vez m√°s de que hoy no hay ning√∫n lugar sin esto, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">vea un</a> breve video con una historia sobre c√≥mo puede ingresar a la red corporativa protegida por un firewall de 17 maneras.  Por lo tanto, asumiremos que entendemos que el monitoreo interno es algo necesario y que solo queda entender c√≥mo se puede organizar. <br><br>  Destacar√≠a tres fuentes de datos clave para monitorear la infraestructura a nivel de red: <br><ul><li>  Tr√°fico "sin procesar", que capturamos y enviamos para su an√°lisis a ciertos sistemas de an√°lisis, </li><li>  eventos de dispositivos de red a trav√©s de los cuales pasa el tr√°fico, </li><li>  informaci√≥n de tr√°fico recibida utilizando uno de los protocolos de flujo. </li></ul><br><br><img src="https://habrastorage.org/webt/ic/ti/gg/ictiggm4ghkef5hgwryuxyh2qoo.png" alt="Tres fuentes de datos para el monitoreo de la red."><br><br>  Capturar tr√°fico en bruto es la opci√≥n m√°s popular entre los guardias de seguridad, porque hist√≥ricamente apareci√≥ como la primera.  Los sistemas convencionales de detecci√≥n de ataques basados ‚Äã‚Äãen la red (el primer sistema comercial de detecci√≥n de ataques fue el NetRanger de WheelR, adquirido en 1998 por Cisco) solo estaban en el negocio de capturar paquetes (y sesiones posteriores) que buscaban firmas espec√≠ficas ("reglas decisivas" en terminolog√≠a FSTEC), ataques de se√±alizaci√≥n.  Por supuesto, puede analizar el tr√°fico sin procesar no solo usando IDS, sino tambi√©n usando otras herramientas (por ejemplo, funcionalidad Wireshark, tcpdum o NBAR2 en Cisco IOS), pero generalmente carecen de una base de conocimiento que distinga una herramienta de seguridad de la informaci√≥n de una herramienta de TI normal. <br><br>  Entonces, sistemas de detecci√≥n de ataques.  El m√©todo m√°s antiguo y popular para detectar ataques a la red, que se adapta bien a su tarea en el per√≠metro (sin importar qu√©: corporativo, centro de datos, segmento, etc.), pero pasa en redes modernas conmutadas y definidas por software.  En el caso de una red construida sobre la base de conmutadores convencionales, la infraestructura de los sensores de detecci√≥n de ataques se vuelve demasiado grande: tendr√° que colocar un sensor en cada conexi√≥n al host cuyos ataques desea monitorear.  Cualquier fabricante, por supuesto, estar√° encantado de venderle cientos y miles de sensores, pero creo que su presupuesto no puede soportar tales costos.  Puedo decir que incluso en Cisco (y somos los desarrolladores de NGIPS) no pudimos hacer esto, aunque parece que el problema del precio est√° por delante.  no deber√≠a resistir, esta es nuestra propia decisi√≥n.  Adem√°s, surge la pregunta, pero ¬øc√≥mo conectar el sensor en esta realizaci√≥n?  A la brecha?  ¬øY si el sensor en s√≠ est√° desactivado?  ¬øRequiere un m√≥dulo de derivaci√≥n en el sensor?  ¬øUsar divisores de tomas?  Todo esto encarece la soluci√≥n y la hace insoportable para una empresa de cualquier escala. <br><br><img src="https://habrastorage.org/webt/qf/mq/zi/qfmqziyzqnl8axo76o4apia7qiu.png" alt="imagen"><br><br>  Puede intentar "colgar" el sensor en el puerto SPAN / RSPAN / ERSPAN y dirigir el tr√°fico hacia √©l desde los puertos necesarios en el conmutador.  Esta opci√≥n elimina parcialmente el problema descrito en el p√°rrafo anterior, pero plantea uno diferente: el puerto SPAN no puede aceptar absolutamente todo el tr√°fico que se le enviar√°, no tendr√° suficiente ancho de banda.  Acurrucarse algo para sacrificar.  Deje parte de los nodos sin supervisi√≥n (luego debe priorizarlos primero) o no enrute todo el tr√°fico desde el nodo, sino solo un cierto tipo.  En cualquier caso, podemos omitir algunos ataques.  Adem√°s, el puerto SPAN se puede ocupar para otras necesidades.  Como resultado, tendremos que revisar la topolog√≠a de red existente y, posiblemente, hacer ajustes para cubrir su red al m√°ximo con la cantidad de sensores que tiene (y coordinar esto con TI). <br><br>  ¬øY si su red utiliza rutas asim√©tricas?  ¬øY si ha implementado o planea introducir SDN?  ¬øY si necesita monitorear m√°quinas o contenedores virtualizados cuyo tr√°fico no llega al conmutador f√≠sico?  A los fabricantes de IDS tradicionales no les gustan estas preguntas porque no saben c√≥mo responderlas.  Quiz√°s lo inclinar√°n al hecho de que todas estas tecnolog√≠as de moda son exageradas y que no las necesita.  Tal vez hablar√°n sobre la necesidad de comenzar de a poco.  O tal vez dir√°n que necesita colocar una potente trilladora en el centro de la red y dirigir todo el tr√°fico hacia ella mediante equilibradores.  Independientemente de la opci√≥n que se le ofrezca, debe comprender claramente por s√≠ mismo cu√°nto le conviene.  Y solo despu√©s de eso, tome la decisi√≥n de elegir un enfoque para monitorear la seguridad de la informaci√≥n de la infraestructura de red.  Volviendo a la captura de paquetes, quiero decir que este m√©todo sigue siendo muy popular e importante, pero su objetivo principal es el control de fronteras;  los l√≠mites entre su organizaci√≥n e Internet, los l√≠mites entre el centro de datos y el resto de la red, los l√≠mites entre el ICS y el segmento corporativo.  En estos lugares, los IDS / IPS cl√°sicos todav√≠a tienen derecho a existir y hacer un buen trabajo en sus tareas. <br><br><img src="https://habrastorage.org/webt/s0/lz/qi/s0lzqikgs1pknxj2ak8n1t0mkd0.png" alt="imagen"><br><br>  Pasemos a la segunda opci√≥n.  Un an√°lisis de eventos desde dispositivos de red tambi√©n se puede utilizar para detectar ataques, pero no como el mecanismo principal, ya que le permite detectar solo una peque√±a clase de intrusiones.  Adem√°s, tiene cierta reactividad inherente: primero debe ocurrir un ataque, luego debe ser reparado por un dispositivo de red, que de una forma u otra indicar√° un problema con la seguridad de la informaci√≥n.  Hay varias formas  Puede ser syslog, RMON o SNMP.  Los dos √∫ltimos protocolos para el monitoreo de la red en el contexto de la seguridad de la informaci√≥n se aplican solo si necesitamos detectar un ataque DoS en el equipo de la red en s√≠, ya que usando RMON y SNMP, por ejemplo, podemos monitorear la carga del procesador central del dispositivo o sus interfaces.  Este es uno de los "m√°s baratos" (todos tienen syslog o SNMP), pero tambi√©n es la forma m√°s ineficaz de monitorear la seguridad de la informaci√≥n de la infraestructura interna: muchos ataques simplemente est√°n ocultos.  Por supuesto, no deben descuidarse y el mismo an√°lisis de syslog lo ayuda a identificar los cambios en la configuraci√≥n del dispositivo de manera oportuna, es un compromiso, pero no es muy adecuado para detectar ataques en toda la red. <br><br>  La tercera opci√≥n es analizar informaci√≥n sobre el tr√°fico que pasa a trav√©s de un dispositivo que admite uno de varios protocolos de flujo.  En este caso, independientemente del protocolo, la infraestructura de flujo consta necesariamente de tres componentes: <br><ul><li>  Generar o exportar flujo.  Esta funci√≥n generalmente se asigna a un enrutador, conmutador u otro dispositivo de red que, al pasar el tr√°fico de red a trav√©s de s√≠ mismo, le permite extraer par√°metros clave del mismo, que luego se transfieren al m√≥dulo de recopilaci√≥n.  Por ejemplo, el protocolo Cisco Netflow no solo es compatible con enrutadores y conmutadores, incluidos los virtuales e industriales, sino tambi√©n con controladores inal√°mbricos, firewalls e incluso servidores. </li><li>  Flujo de recolecci√≥n.  Dado que en una red moderna generalmente hay m√°s de un dispositivo de red, surge el problema de recopilar y consolidar flujos, que se resuelve utilizando los llamados colectores, que procesan los flujos recibidos y luego los transmiten para su an√°lisis. </li><li>  An√°lisis de flujo.  El analizador asume la tarea intelectual principal y, aplicando varios algoritmos a los flujos, saca ciertas conclusiones.  Por ejemplo, como parte de la funci√≥n de TI, dicho analizador puede identificar cuellos de botella en la red o analizar el perfil de carga de tr√°fico para optimizar a√∫n m√°s la red.  Y para IS, dicho analizador puede detectar fugas de datos, la propagaci√≥n de c√≥digo malicioso o ataques DoS. </li></ul><br><br>  No debe pensar que dicha arquitectura de tres niveles es demasiado complicada: todas las dem√°s opciones (excepto, tal vez, los sistemas de monitoreo de red que funcionan con SNMP y RMON) tambi√©n funcionan de acuerdo con ella.  Tenemos un generador de datos para el an√°lisis, que es un dispositivo de red o un sensor independiente.  Tenemos un sistema de recolecci√≥n de alarmas y un sistema de gesti√≥n para toda la infraestructura de monitoreo.  Los dos √∫ltimos componentes se pueden combinar dentro de un solo nodo, pero en redes m√°s o menos grandes generalmente est√°n separados por al menos dos dispositivos para garantizar la escalabilidad y la confiabilidad. <br><br><img src="https://habrastorage.org/webt/oq/pc/nm/oqpcnmnhfriy9oomnogdquh1shy.png" alt="imagen"><br><br>  A diferencia del an√°lisis de paquetes, basado en el estudio del encabezado y el cuerpo de datos de cada paquete y las sesiones que consisten en ellos, el an√°lisis de flujos se basa en la recopilaci√≥n de metadatos sobre el tr√°fico de red.  Cu√°ndo, cu√°nto, d√≥nde y d√≥nde, c√≥mo ... estas son las preguntas respondidas por el an√°lisis de la telemetr√≠a de red utilizando varios protocolos de flujo.  Inicialmente, se utilizaron para analizar estad√≠sticas y buscar problemas de TI en la red, pero luego, con el desarrollo de mecanismos anal√≠ticos, fue posible aplicarlos a la misma telemetr√≠a y con fines de seguridad.  Vale la pena mencionar aqu√≠ nuevamente que el an√°lisis de flujo no reemplaza ni cancela la captura de paquetes.  Cada uno de estos m√©todos tiene su propio campo de aplicaci√≥n.  Pero en el contexto de este art√≠culo, es el an√°lisis de flujo el m√°s adecuado para monitorear la infraestructura interna.  Tiene dispositivos de red (y no importa si funcionan en un paradigma definido por software o de acuerdo con reglas est√°ticas) que el ataque no puede pasar.  Puede omitir el sensor IDS cl√°sico, pero no hay ning√∫n dispositivo de red que admita el protocolo de flujo.  Esta es la ventaja de este m√©todo. <br><br>  Por otro lado, si necesita evidencia para la aplicaci√≥n de la ley o su propio equipo de investigaci√≥n de incidentes, no puede prescindir de la captura de paquetes: la telemetr√≠a de red no es una copia del tr√°fico que se puede utilizar para recopilar evidencia;  Es necesario para la detecci√≥n operativa y la toma de decisiones en el campo de la seguridad de la informaci√≥n.  Por otro lado, utilizando el an√°lisis de telemetr√≠a, puede "escribir" no todo el tr√°fico de la red (en todo caso, Cisco est√° involucrado en los centros de datos :-), pero solo el que est√° involucrado en el ataque.  Las herramientas de an√°lisis de telemetr√≠a a este respecto complementar√°n bien los mecanismos tradicionales de captura de paquetes, dando el comando para la captura y el almacenamiento selectivos.  De lo contrario, debe tener una infraestructura de almacenamiento colosal. <br><br>  Imagine una red que funciona a una velocidad de 250 Mbps.  Si desea guardar todo este volumen, necesitar√° 31 MB de almacenamiento para un segundo de transferencia de tr√°fico, 1.8 GB por un minuto, 108 GB por una hora y 2.6 TB por un d√≠a.  Para almacenar datos diarios de una red con un ancho de banda de 10 Gbit / s, necesita 108 TB de almacenamiento.  Pero algunos reguladores requieren que almacene datos de seguridad durante a√±os ... La grabaci√≥n ‚Äúa pedido‚Äù, que lo ayuda a implementar el an√°lisis de flujo, ayuda a reducir estos valores en √≥rdenes de magnitud.  Por cierto, si hablamos de la relaci√≥n del volumen registrado de datos de telemetr√≠a de red con respecto a la captura total de datos, entonces es de aproximadamente 1 a 500. Para los mismos valores anteriores, el almacenamiento del descifrado completo de todo el tr√°fico diario ser√° de 5 y 216 GB, respectivamente (incluso puede escribir en una unidad flash USB normal) ) <br><br>  Si las herramientas de an√°lisis de datos de red sin procesar tienen un m√©todo para capturarlas que es casi igual que el proveedor al proveedor, entonces la situaci√≥n es diferente con el an√°lisis de flujos.  Hay varias opciones para los protocolos de flujo, las diferencias en las que necesita saber en el contexto de seguridad.  El m√°s popular es el protocolo Netflow desarrollado por Cisco.  Existen varias versiones de este protocolo que difieren en sus capacidades y la cantidad de informaci√≥n registrada sobre el tr√°fico.  La versi√≥n actual es la novena (Netflow v9), sobre la base de la cual se desarroll√≥ el est√°ndar de la industria Netflow v10, tambi√©n conocido como IPFIX.  Hoy en d√≠a, la mayor√≠a de los proveedores de redes admiten exactamente Netflow o IPFIX en sus equipos.  Pero hay varias otras opciones para protocolos de flujo: sFlow, jFlow, cFlow, rFlow, NetStream, etc., de las cuales sFlow es m√°s popular.  Es √©l quien m√°s a menudo recibe el apoyo de los fabricantes nacionales de equipos de red debido a la facilidad de implementaci√≥n.  ¬øCu√°les son las diferencias clave entre Netflow, como est√°ndar de facto, y sFlow?  Destacar√≠a algunas claves.  Primero, Netflow tiene campos definidos por el usuario en lugar de campos fijos en sFlow.  Y en segundo lugar, y esto es lo m√°s importante en nuestro caso, sFlow recopila la llamada telemetr√≠a muestreada;  a diferencia de sin muestrear en Netflow e IPFIX.  ¬øCu√°l es la diferencia entre ellos? <br><br><img src="https://habrastorage.org/webt/s2/rr/ub/s2rrub0w0nkkd5bmdlvxyb07afa.png" alt="imagen"><br><br>  Imagine que decidi√≥ leer el libro " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Centro de operaciones de seguridad: construcci√≥n, operaci√≥n y mantenimiento de su SOC</a> " de mis colegas: Gary MacIntyre, Joseph Muniz y Nadef Alfardan (puede descargar parte del libro desde el enlace).  Tiene tres opciones para lograr su objetivo: leer todo el libro, revisarlo con los ojos, detenerse en cada p√°gina 10 o 20, o tratar de volver a contar conceptos clave en un blog o servicio como SmartReading.  Entonces, la telemetr√≠a sin muestrear es leer cada "p√°gina" del tr√°fico de la red, es decir, analizar los metadatos para cada paquete.  La telemetr√≠a de muestreo es un estudio selectivo del tr√°fico con la esperanza de que las muestras seleccionadas tengan lo que necesita.  Dependiendo de la velocidad del canal, la telemetr√≠a muestreada enviar√° para su an√°lisis cada paquete 64, 200, 500, 1000, 2000 o incluso 10000. <br><br><img src="https://habrastorage.org/webt/24/il/eg/24ileg_9ddptq5votue4qamrlfu.png" alt="imagen"><br><br>  En el contexto de la supervisi√≥n de la seguridad de la informaci√≥n, esto significa que la telemetr√≠a muestreada es muy adecuada para detectar ataques DDoS, escanear y difundir c√≥digo malicioso, pero puede omitir ataques at√≥micos o de paquetes m√∫ltiples que no caen en la muestra enviada para su an√°lisis.  La telemetr√≠a sin muestrear no tiene tales deficiencias.  Usar el rango de ataques detectables es mucho m√°s amplio.  Aqu√≠ hay una breve lista de eventos que pueden detectarse utilizando herramientas de an√°lisis de telemetr√≠a de red. <br><br><img src="https://habrastorage.org/webt/3c/-b/sq/3c-bsqdag-fplnfue732ckxrlkg.png" alt="Algunos tipos de incidentes detectados por Stealthwatch Enterprise"><br><br>  Por supuesto, algunos analizadores de Netflow de c√≥digo abierto no le permitir√°n hacer esto, ya que su tarea principal es recopilar telemetr√≠a y realizar an√°lisis b√°sicos desde un punto de vista de TI.  Para identificar las amenazas de seguridad de la informaci√≥n basadas en el flujo, es necesario equipar el analizador con varios motores y algoritmos, que identificar√°n los problemas de ciberseguridad sobre la base de campos Netflow est√°ndar o personalizados, enriquecer√°n los datos est√°ndar con datos externos de varias fuentes de Inteligencia de amenazas, etc. <br><br><img src="https://habrastorage.org/webt/hu/t1/oo/hut1ooqfkx6m11pfsmp8wawm0bu.png" alt="Detecci√≥n maliciosa en tr√°fico encriptado"><br><br>  Por lo tanto, si tiene una opci√≥n, det√©ngala en Netflow o IPFIX.  Pero incluso si su equipo solo funciona con sFlow, como los fabricantes nacionales, incluso en este caso puede beneficiarse de √©l en el contexto de seguridad. <br><br><img src="https://habrastorage.org/webt/za/b4/vh/zab4vhx9lc8ldaztdzajzi2xnh4.png" alt="Diferencia entre telemetr√≠a muestreada y sin muestrear"><br><br>  En el verano de 2019, analic√© las oportunidades que tienen los fabricantes rusos de hardware en red, y todos ellos, excepto NSG, Polygon y Craftway, declararon su apoyo a sFlow (al menos Zelax, Natex, Eltex, QTech, Rusteletech). <br><br><img src="https://habrastorage.org/webt/pu/ey/ww/pueywwqxumc9i1lkf4abocxnpfk.png" alt="La capacidad de los proveedores de red rusos para monitorear la infraestructura de red"><br><br>  La siguiente pregunta que enfrentar√° es ¬ød√≥nde implementar el soporte de flujo con fines de seguridad?  De hecho, la pregunta no es del todo correcta.  En equipos modernos, el soporte para protocolos de flujo casi siempre est√° ah√≠.  Por lo tanto, reformular√≠a la pregunta de manera diferente: ¬øcu√°l es la forma m√°s eficiente de recopilar telemetr√≠a desde un punto de vista de seguridad?  La respuesta ser√° bastante obvia: en el nivel de acceso, donde ver√° el 100% de todo el tr√°fico, donde tendr√° informaci√≥n detallada sobre los hosts (MAC, VLAN, ID de interfaz), donde incluso puede rastrear el tr√°fico P2P entre hosts, lo cual es cr√≠tico para detectar escaneos y y la difusi√≥n de c√≥digo malicioso.  En el nivel del kernel, es posible que no vea parte del tr√°fico, pero en el nivel del per√≠metro ver√° bien una cuarta parte de todo el tr√°fico de su red.  Pero si, por alguna raz√≥n, se conectan dispositivos extra√±os en su red que permiten a los atacantes "entrar y salir", sin pasar por el per√≠metro, entonces analizar la telemetr√≠a no le dar√° nada.  Por lo tanto, para una cobertura m√°xima, se recomienda incluir la recolecci√≥n de telemetr√≠a en el nivel de acceso.  Al mismo tiempo, vale la pena se√±alar que incluso si estamos hablando de virtualizaci√≥n o contenedores, el soporte de flujo tambi√©n se encuentra a menudo en los conmutadores virtuales modernos, lo que le permite controlar el tr√°fico all√≠ tambi√©n. <br><br>  Pero desde que mencion√© el tema, necesito responder la pregunta, pero ¬øqu√© pasa si, despu√©s de todo, el equipo, f√≠sico o virtual, no admite protocolos de flujo?  ¬øO est√° prohibida su inclusi√≥n (por ejemplo, en segmentos industriales para garantizar la fiabilidad)?  ¬øO su inclusi√≥n conduce a una alta utilizaci√≥n de la CPU (esto sucede en equipos obsoletos)?  Para resolver este problema, hay sensores virtuales especializados (sensor de flujo), que son esencialmente divisores ordinarios que pasan el tr√°fico a trav√©s de ellos mismos y lo transmiten en forma de flujo al m√≥dulo de recolecci√≥n.  Es cierto que en este caso tenemos un mont√≥n de problemas de los que hablamos anteriormente en relaci√≥n con las herramientas de captura de paquetes.  Es decir, debe comprender no solo las ventajas de la tecnolog√≠a de an√°lisis de flujo, sino tambi√©n sus limitaciones. <br><br>  Otro punto que es importante recordar cuando se habla de herramientas de an√°lisis de flujo.  Si aplicamos la m√©trica EPS (evento por segundo, eventos por segundo) a los medios convencionales para generar eventos de seguridad, entonces este indicador no se aplica al an√°lisis de telemetr√≠a;  se reemplaza por FPS (flujo por segundo).  Como en el caso de EPS, no se puede calcular por adelantado, pero puede estimar el n√∫mero aproximado de flujos que genera un dispositivo en particular dependiendo de su tarea.  En Internet puede encontrar tablas con valores aproximados para diferentes tipos de dispositivos y condiciones corporativas, que le permitir√°n determinar qu√© licencias necesita para las herramientas de an√°lisis y cu√°l ser√° su arquitectura.  El hecho es que el sensor IDS est√° limitado por un cierto ancho de banda, que "tirar√°", y el colector de flujo tiene sus propias limitaciones, que deben entenderse.  Por lo tanto, en grandes redes distribuidas geogr√°ficamente, generalmente hay varios dep√≥sitos.  Cuando describ√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥mo se monitorea la red dentro de Cisco</a> , ya mencion√© el n√∫mero de nuestros recolectores: hay 21. Y esta es una red dispersa en los cinco continentes y que cuenta con aproximadamente medio mill√≥n de dispositivos activos). <br><br><img src="https://habrastorage.org/webt/fp/6h/bu/fp6hbuehyafsw_ovcxyh9achww8.png" alt="Arquitectura empresarial de stealthwatch"><br><br>  Como sistema de monitoreo de Netflow, utilizamos nuestra propia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">soluci√≥n Cisco Stealthwatch</a> , que se enfoca espec√≠ficamente en resolver problemas de seguridad.  Tiene muchos motores incorporados para detectar actividades anormales, sospechosas y obviamente maliciosas, lo que permite detectar una amplia gama de diversas amenazas, desde la miner√≠a criptogr√°fica hasta fugas de informaci√≥n, desde la propagaci√≥n de c√≥digo malicioso hasta el fraude.  Como la mayor√≠a de los analizadores de flujo, Stealthwatch se construye de acuerdo con un esquema de tres niveles (generador - colector - analizador), pero se complementa con una serie de caracter√≠sticas interesantes que son importantes en el contexto del material en consideraci√≥n.  Primero, se integra con soluciones de captura de paquetes (por ejemplo, Cisco Security Packet Analyzer), que le permite grabar sesiones de red seleccionadas para una investigaci√≥n y an√°lisis m√°s detallados.  En segundo lugar, especialmente para expandir las tareas de seguridad, desarrollamos un protocolo especial nvzFlow, que le permite "traducir" la actividad de las aplicaciones en los nodos finales (servidores, estaciones de trabajo, etc.) a telemetr√≠a y transmitirla al recopilador para su posterior an√°lisis.  Si en su versi√≥n original Stealthwatch funciona con cualquier protocolo de flujo (sFlow, rFlow, Netflow, IPFIX, cFlow, jFlow, NetStream) en el nivel de red, entonces el soporte nvzFlow permite que los datos se correlacionen tambi√©n en el nivel del host.  aumentando la eficiencia de todo el sistema y viendo m√°s ataques que los analizadores de flujo de red convencionales. <br><br>  Est√° claro que hablando de an√°lisis de seguridad de sistemas Netflow, el mercado no se limita a una √∫nica soluci√≥n de Cisco.  Puede utilizar soluciones comerciales y gratuitas o shareware.  Por extra√±o que parezca, si uso el blog de Cisco como un ejemplo de las soluciones de la competencia, dir√© algunas palabras sobre c√≥mo se puede analizar la telemetr√≠a de red utilizando dos herramientas populares, de nombre similar, pero a√∫n diferentes: SiLK y ELK. <br><br>  SiLK es un conjunto de herramientas (el Sistema para el conocimiento a nivel de Internet) para el an√°lisis del tr√°fico, desarrollado por el American CERT / CC y que admite, en el contexto del art√≠culo de hoy, Netflow (5 y 9, las versiones m√°s populares), IPFIX y sFlow y el uso de diversas utilidades (rwfilter, rwcount, rwflowpack, etc.) para realizar diversas operaciones en la telemetr√≠a de red con el fin de detectar signos de acciones no autorizadas en ella.  Pero hay un par de puntos importantes a tener en cuenta.  SiLK es una herramienta de l√≠nea de comando y realiza an√°lisis operacionales, todo el tiempo ingresa un comando del formulario (detecci√≥n de paquetes ICMP mayores de 200 bytes): <br><br> <code>rwfilter --flowtypes=all/all --proto=1 --bytes-per-packet=200- --pass=stdout | rwrwcut --fields=sIP,dIP,iType,iCode --num-recs=15</code> <br> <br>  No muy conveniente.  Puede usar la GUI iSiLK, pero no le facilitar√° la vida al resolver solo la funci√≥n de visualizaci√≥n, no el reemplazo del analista.  Y este es el segundo punto.  A diferencia de las soluciones comerciales, que ya tienen una base anal√≠tica s√≥lida, algoritmos de detecci√≥n de anomal√≠as, algoritmos relacionados con el flujo de trabajo, etc., en el caso de SiLK, tendr√° que hacer todo esto usted mismo, lo que requerir√° que use competencias ligeramente diferentes de las que ya debe usar. Herramientas listas para usar.  Esto es malo y no est√° mal: esta es una caracter√≠stica de casi cualquier herramienta gratuita que proviene del hecho de que sabes qu√© hacer, y solo te ayudar√° en esto (las herramientas comerciales dependen menos de las competencias de sus usuarios, aunque tambi√©n supone que los analistas entienden al menos conceptos b√°sicos de investigaci√≥n y monitoreo de redes).  Pero volvamos a SiLK.  El ciclo de trabajo del analista con √©l es el siguiente: <br><ul><li>  Formulaci√≥n de una hip√≥tesis.  Debemos entender lo que buscaremos dentro de la telemetr√≠a de red, para conocer los atributos √∫nicos por los cuales identificaremos ciertas anomal√≠as o amenazas. </li><li>  Construyendo un modelo.  Una vez formulada una hip√≥tesis, la programamos utilizando la misma Python, shell u otras herramientas no incluidas en SiLK. </li><li>  Pruebas  Es el turno de probar la validez de nuestra hip√≥tesis, que se confirma o refuta utilizando las utilidades SiLK que comienzan con 'rw', 'set', 'bag'. </li><li>  An√°lisis de datos reales.  En la operaci√≥n industrial, SiLK nos ayuda a identificar algo y el analista debe responder las preguntas ‚Äú¬øEncontramos lo que esper√°bamos?‚Äù, ‚Äú¬øCorresponde esto a nuestra hip√≥tesis?‚Äù, ‚Äú¬øC√≥mo reducir el n√∫mero de falsos positivos?‚Äù, ‚Äú¬øC√≥mo mejorar el nivel de reconocimiento? "  etc. </li><li>  Mejora  En la etapa final, mejoramos lo que se hizo antes: crear plantillas, mejorar y optimizar el c√≥digo, reformular y refinar la hip√≥tesis, etc. </li></ul><br><br>  Este ciclo ser√° aplicable al mismo Cisco Stealthwatch, solo los √∫ltimos cinco pasos se automatizar√°n al m√°ximo, reduciendo el n√∫mero de errores de analistas y aumentando la velocidad de detecci√≥n de incidentes.  Por ejemplo, en SiLK, puede enriquecer las estad√≠sticas de red con datos externos sobre IP maliciosa utilizando sus propios scripts, y en Cisco Stealthwatch, esta es una funci√≥n incorporada que muestra inmediatamente una alarma si hay interacci√≥n con direcciones IP en la lista negra en el tr√°fico de red. <br><br>  Si vamos m√°s arriba en la pir√°mide "pagada" para el software de an√°lisis de flujo, entonces el SiLK totalmente gratuito ser√° seguido por el ELK shareware que consta de tres componentes clave: Elasticsearch (indexaci√≥n, b√∫squeda y an√°lisis de datos), Logstash (entrada / salida de datos) y Kibana ( visualizaci√≥n).  A diferencia de SiLK, donde tiene que escribir todo usted mismo, ELK ya tiene muchas bibliotecas / m√≥dulos listos (algunos son pagados, otros no) que automatizan el an√°lisis de telemetr√≠a de red.  Por ejemplo, el filtro GeoIP en Logstash le permite vincular las direcciones IP observadas a su ubicaci√≥n geogr√°fica (para Stealthwatch, esta es una funci√≥n incorporada). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5d4/2df/ace/5d42dfacef7789002c30d66fc5dd92ce.png" alt="Geolocalizaci√≥n en ELK"><br><br>  ELK tambi√©n tiene una comunidad bastante grande que est√° completando los componentes que faltan para esta soluci√≥n de monitoreo.  Por ejemplo, para trabajar con Netflow, IPFIX y sFlow, puede usar el m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">elastiflow</a> si no se siente c√≥modo con el M√≥dulo Logstash Netflow, que solo es compatible con Netflow. <br><br>  Dando m√°s eficiencia en la recopilaci√≥n de flujo y la b√∫squeda en √©l, ELK actualmente no cuenta con an√°lisis integrados para detectar anomal√≠as y amenazas en la telemetr√≠a de red.  Es decir, siguiendo el ciclo de vida descrito anteriormente, tendr√° que describir de forma independiente el modelo de violaciones y luego usarlo en el sistema de combate (no hay modelos incorporados all√≠). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f80/d92/728/f80d92728e14e0515e9d4f6f44259236.png" alt="M√≥dulo de flujo de red Logstash"><br><br>  Por supuesto, hay extensiones m√°s sofisticadas para ELK que ya contienen algunos modelos para detectar anomal√≠as en la telemetr√≠a de red, pero tales extensiones cuestan dinero y la pregunta es si el juego vale la pena: escriba el mismo modelo usted mismo, compre su implementaci√≥n para su herramienta de monitoreo o compre soluci√≥n llave en mano para la clase Network Traffic Analysis. <br><br><img src="https://habrastorage.org/webt/jw/7o/sp/jw7ospi0e50saqzkqi20g7tuduo.png" alt="M√≥dulo de an√°lisis de flujo pagado para ELK (soluci√≥n de terceros)"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En general, no quiero entrar en el debate de que es mejor gastar dinero y comprar una soluci√≥n llave en mano para monitorear anomal√≠as y amenazas en la telemetr√≠a de red (por ejemplo, Cisco Stealthwatch) o resolverlo por su cuenta y girar las mismas herramientas SiLK, ELK o nfdump o OSU Flow (para cada nueva amenaza) ( ¬ø </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habl√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de los dos √∫ltimos la </font><font style="vertical-align: inherit;">√∫ltima vez? Todos eligen por s√≠ mismos y cada uno tiene sus propios motivos para elegir cualquiera de las dos opciones. Solo quer√≠a mostrar que la telemetr√≠a de red es una herramienta muy importante para garantizar la seguridad de la red de su infraestructura interna y no debe descuidarla para no reponer la lista de la compa√±√≠a cuyo nombre se menciona en los medios junto con los ep√≠tetos "pirateados", que no cumplieron con los requisitos de seguridad de la informaci√≥n "," Pensando en la seguridad de sus datos y los datos de los clientes ".</font></font><br><br><img src="https://habrastorage.org/webt/l2/ya/p-/l2yap-hpfiulg4jwjeonrv_ppza.png" alt="Stealthwatch Enterprise"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En resumen, me gustar√≠a enumerar los consejos clave que debe seguir al construir el monitoreo de seguridad de la informaci√≥n de su infraestructura interna: </font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°No te limites solo al per√≠metro! </font><font style="vertical-align: inherit;">Use (y elija) la infraestructura de red no solo para transferir tr√°fico del punto A al punto B, sino tambi√©n para abordar problemas de ciberseguridad.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Explore los mecanismos de monitoreo de seguridad existentes en su equipo de red e implem√©ntelos. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para el monitoreo interno, d√© preferencia al an√°lisis de telemetr√≠a: le permite detectar hasta el 80-90% de todos los incidentes de seguridad de la informaci√≥n, mientras hace lo que es imposible al capturar paquetes de red y ahorrar espacio para almacenar todos los eventos de seguridad de la informaci√≥n. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para monitorear flujos, use Netflow v9 o IPFIX: proporcionan m√°s informaci√≥n en el contexto de seguridad y le permiten monitorear no solo IPv4, sino tambi√©n IPv6, MPLS, etc. </font></font></li><li>   flow- ‚Äì       . , Netflow  IPFIX. </li><li>      ‚Äì         flow-.       Netflow Generation Appliance. </li><li>         ‚Äì      100%  . </li><li>            ,   ,   flow-   SPAN/RSPAN-. </li><li>   /  /          (     ). </li></ol><br><br><img src="https://habrastorage.org/webt/-j/9x/e3/-j9xe39tyiu-zhx6yimb-yyb-3m.png" alt="imagen"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En cuanto al √∫ltimo consejo, me gustar√≠a dar una ilustraci√≥n, que ya he citado anteriormente. Ver√° que si antes el servicio Cisco IB constru√≠a casi por completo su sistema de monitoreo IS basado en sistemas de detecci√≥n de intrusos y m√©todos de firma, ahora representan solo el 20% de los incidentes. Otro 20% se explica por los sistemas de an√°lisis de flujo, lo que sugiere que estas soluciones no son un capricho, sino una herramienta real en las actividades de los servicios de seguridad de la informaci√≥n de una empresa moderna. Adem√°s, tiene lo m√°s importante para su implementaci√≥n: infraestructura de red, inversiones en las que tambi√©n se puede proteger mediante la asignaci√≥n de funciones de monitoreo IS a la red.</font></font><br><br><img src="https://habrastorage.org/webt/2d/yq/gy/2dyqgy3iwbotbl_lkm1m37eftvi.png" alt="imagen"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deliberadamente no toqu√© el tema de responder a las anomal√≠as o amenazas identificadas en los flujos de red, pero creo que ya est√° claro que el monitoreo no debe completarse solo mediante la detecci√≥n de una amenaza. </font><font style="vertical-align: inherit;">Debe ir seguido de una respuesta y preferiblemente en modo autom√°tico o automatizado. </font><font style="vertical-align: inherit;">Pero este es el tema de un material separado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informacion adicional:</font></font><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n de Cisco IOS Netflow</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matriz de soporte de Netflow en varias soluciones de Cisco</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gu√≠a de configuraci√≥n de Netflow para varias plataformas de Cisco</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SFlow Community</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laboratorio con Stealtjwatch, SiLK y ELK para el an√°lisis de seguridad de Netflow</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sitio web de SiLK</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un tutorial de SiLK de 300 p√°ginas con toneladas de ejemplos.</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo de flujo de red Logstash</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tutorial de Cisco ELK Netflow Analysis en ELK</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetFlow v.9 Cisco ASA Analysis mediante Logstash (ELK)</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soluci√≥n Cisco Stealthwatch</font></font></a> </li></ul><br><br>  Amenaza<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si le resulta m√°s f√°cil escuchar todo lo que se escribi√≥ anteriormente, puede ver la presentaci√≥n de una hora que form√≥ la base de esta nota. </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ncDRZsueETo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/464601/">https://habr.com/ru/post/464601/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../464591/index.html">Qu√≠mica del pollo frito. An√°lisis detallado</a></li>
<li><a href="../464593/index.html">Nube de puntos C√≥mo desarrollamos la tecnolog√≠a digital en la construcci√≥n.</a></li>
<li><a href="../464595/index.html">Alcohol y matem√°tico (a)</a></li>
<li><a href="../464597/index.html">Donde comenzar a aprender Python: libros para principiantes</a></li>
<li><a href="../464599/index.html">Cuando la historia es falsa: bodega Koktebel, vinos falsos y lecciones de marketing</a></li>
<li><a href="../464603/index.html">Alcoholismo √∫ltima etapa</a></li>
<li><a href="../464607/index.html">Desarrollo equilibrado en equipos muy grandes. Informe Yandex</a></li>
<li><a href="../464609/index.html">El complejo falso industrial de la falsa inteligencia artificial</a></li>
<li><a href="../464611/index.html">TechTrain 2019: transmisi√≥n en vivo gratis</a></li>
<li><a href="../464613/index.html">Recetas de Python: conversi√≥n de HTML y URL a PDF y PS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>