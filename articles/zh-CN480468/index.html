<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ ğŸ‘ƒ ğŸ° é›¶æ‹…éƒ¨ç½²Tarantool Cartridgeåº”ç”¨ç¨‹åºï¼ˆç¬¬1éƒ¨åˆ†ï¼‰ ğŸ¤±ğŸ½ ğŸ‘¨ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ¼ ğŸ‡ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬å·²ç»ä»‹ç»äº†Tarantoolå¼¹è¯ç­’ ï¼Œä½¿æ‚¨å¯ä»¥å¼€å‘å’Œæ‰“åŒ…åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€‚ ç°åœ¨è®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•éƒ¨ç½²å’Œæ§åˆ¶è¿™äº›åº”ç”¨ç¨‹åºã€‚ ä¸ç”¨æ‹…å¿ƒï¼Œä¸€åˆ‡éƒ½åœ¨æŒæ§ä¹‹ä¸­ï¼ æˆ‘ä»¬æ±‡é›†äº†ä½¿ç”¨Tarantool Cartridgeçš„æ‰€æœ‰æœ€ä½³å®è·µï¼Œå¹¶ç¼–å†™äº†Ansibleè§’è‰² ï¼Œè¯¥è§’è‰²å°†è½¯ä»¶åŒ…éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œå°†å®ä¾‹å¯åŠ¨å’ŒåŠ å…¥å‰¯æœ¬é›†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>é›¶æ‹…éƒ¨ç½²Tarantool Cartridgeåº”ç”¨ç¨‹åºï¼ˆç¬¬1éƒ¨åˆ†ï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/480468/"><img src="https://habrastorage.org/webt/yc/gm/xx/ycgmxxaqlvyslsrzoo6jnv1vmx0.jpeg"><br><br> æˆ‘ä»¬å·²ç»ä»‹ç»äº†<a href="https://habr.com/ru/company/mailru/blog/465503/">Tarantoolå¼¹è¯ç­’</a> ï¼Œä½¿æ‚¨å¯ä»¥å¼€å‘å’Œæ‰“åŒ…åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€‚ ç°åœ¨è®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•éƒ¨ç½²å’Œæ§åˆ¶è¿™äº›åº”ç”¨ç¨‹åºã€‚ ä¸ç”¨æ‹…å¿ƒï¼Œä¸€åˆ‡éƒ½åœ¨æŒæ§ä¹‹ä¸­ï¼ æˆ‘ä»¬æ±‡é›†äº†ä½¿ç”¨Tarantool Cartridgeçš„æ‰€æœ‰æœ€ä½³å®è·µï¼Œå¹¶ç¼–å†™äº†<a href="https://galaxy.ansible.com/tarantool/cartridge">Ansibleè§’è‰²</a> ï¼Œè¯¥<a href="https://galaxy.ansible.com/tarantool/cartridge">è§’è‰²</a>å°†è½¯ä»¶åŒ…éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œå°†å®ä¾‹å¯åŠ¨å’ŒåŠ å…¥å‰¯æœ¬é›†ï¼Œé…ç½®æˆæƒï¼Œå¼•å¯¼vshardï¼Œå¯ç”¨è‡ªåŠ¨æ•…éšœè½¬ç§»å’Œè¡¥ä¸é›†ç¾¤é…ç½®ã€‚ <br><br> æœ‰è¶£å§ï¼Ÿ æ½œå…¥ï¼Œæ£€æŸ¥åˆ‡å£ä¸‹çš„è¯¦ç»†ä¿¡æ¯ã€‚ <br><a name="habracut"></a><br><h1> ä»æ ·æœ¬å¼€å§‹ </h1><br> è®©æˆ‘ä»¬ä»…å¸¦æ‚¨äº†è§£è§’è‰²çš„æŸäº›åŠŸèƒ½ã€‚ æ‚¨å§‹ç»ˆå¯ä»¥åœ¨<a href="https://github.com/tarantool/ansible-cartridge">æ–‡æ¡£ä¸­</a>æ‰¾åˆ°å…¶æ‰€æœ‰åŠŸèƒ½å’Œè¾“å…¥å‚æ•°çš„å®Œæ•´è¯´æ˜ã€‚ ä½†æ˜¯ï¼Œå°è¯•ä¸€æ¬¡æ€»æ¯”çœ‹åˆ°ä¸€ç™¾æ¬¡æ›´å¥½ï¼Œå› æ­¤è®©æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªå°å‹åº”ç”¨ç¨‹åºã€‚ <br><br>  Tarantool Cartridgeæä¾›äº†ä¸€ä¸ª<a href="https://github.com/tarantool/cartridge-cli/tree/master/examples/getting-started-app">æ•™ç¨‹ï¼Œ</a>ç”¨äºåˆ›å»ºä¸€ä¸ªå°çš„Cartridgeåº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå­˜å‚¨æœ‰å…³é“¶è¡Œå®¢æˆ·åŠå…¶å¸æˆ·çš„ä¿¡æ¯ï¼Œå¹¶æä¾›é€šè¿‡HTTPè¿›è¡Œæ•°æ®ç®¡ç†çš„APIã€‚ ä¸ºæ­¤ï¼Œè¯¥åº”ç”¨ç¨‹åºæè¿°äº†å¯ä»¥åˆ†é…ç»™å®ä¾‹çš„ä¸¤ä¸ªå¯èƒ½çš„è§’è‰²ï¼š <code>api</code>å’Œ<code>storage</code> ã€‚ <br><br> ç›’å¼ç£å¸¦æœ¬èº«æ²¡æœ‰è¯´æ˜å¦‚ä½•å¯åŠ¨è¿›ç¨‹ï¼Œä»…æä¾›äº†é…ç½®è¿è¡Œä¸­å®ä¾‹çš„æœºä¼šã€‚ å› æ­¤ï¼Œå…¶ä½™çš„ä¸€åˆ‡å–å†³äºç”¨æˆ·ï¼šåˆ†å‘é…ç½®æ–‡ä»¶ï¼Œè¿è¡ŒæœåŠ¡å’Œé…ç½®æ‹“æ‰‘ã€‚ ä½†æ˜¯æˆ‘ä»¬ä¸ä¼šåšæ‰€æœ‰çš„äº‹æƒ…-Ansibleä¼šä¸ºæˆ‘ä»¬åšè¿™ä»¶äº‹ã€‚ <br><br><h3> é‡‡å–è¡ŒåŠ¨ </h3><br> é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ä¸¤ä¸ªè™šæ‹Ÿæœºä¸Šå¹¶è®¾ç½®ä¸€ä¸ªç®€å•çš„æ‹“æ‰‘ï¼š <br><br><ul><li>  <code>app-1</code>å‰¯æœ¬é›†å°†ä»£è¡¨åŒ…å«<code>vshard-router</code>è§’è‰²çš„<code>api</code>è§’è‰²ã€‚ åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚ </li><li>  <code>storage-1</code>å‰¯æœ¬é›†å°†ä»£è¡¨<code>storage</code>è§’è‰²ï¼ˆåŒ…æ‹¬<code>vshard-storage</code>è§’è‰²ï¼‰-åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ·»åŠ æ¥è‡ªä¸åŒè®¡ç®—æœºçš„ä¸¤ä¸ªå®ä¾‹ã€‚ </li></ul><br><img src="https://habrastorage.org/webt/k9/nh/oc/k9nhoc4kladn7obskseox7he8ek.jpeg"><br><br> è¦è¿è¡Œè¯¥ç¤ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦<a href="https://www.vagrantup.com/">Vagrant</a>å’Œ<a href="https://www.ansible.com/">Ansible</a> ï¼ˆ2.8æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚ <br><br> è§’è‰²æœ¬èº«å­˜å‚¨åœ¨<a href="https://galaxy.ansible.com/docs/">Ansible Galaxyä¸­</a> -ä¸€ä¸ªå­˜å‚¨åº“ï¼Œå¯è®©æ‚¨å…±äº«å·¥ä½œå¹¶ä½¿ç”¨ç°æˆçš„è§’è‰²ã€‚ <br><br> ç°åœ¨å…‹éš†æ ·æœ¬å­˜å‚¨åº“ï¼š <br><br><pre> <code class="plaintext hljs">$ git clone https://github.com/dokshina/deploy-tarantool-cartridge-app.git $ cd deploy-tarantool-cartridge-app &amp;&amp; git checkout 1.0.0</code> </pre> <br> ç„¶åéƒ¨ç½²è™šæ‹Ÿæœºï¼š <br><br><pre> <code class="plaintext hljs">$ vagrant up</code> </pre> <br> ä¹‹åï¼Œå®‰è£…Tarantool Cartridge Ansibleè§’è‰²ï¼š <br><br><pre> <code class="plaintext hljs">$ ansible-galaxy install tarantool.cartridge,1.0.1</code> </pre> <br> å¹¶å¼€å§‹å®‰è£…è§’è‰²ï¼š <br><br><pre> <code class="plaintext hljs">$ ansible-playbook -i hosts.yml playbook.yml</code> </pre> <br> ç°åœ¨ï¼Œç­‰åˆ°å‰§æœ¬å¤„ç†å®Œæˆåï¼Œè½¬åˆ°<a href="http://localhost:8181/admin/cluster/dashboard">httpï¼š//æœ¬åœ°ä¸»æœºï¼š8181 / admin / cluster /ä»ªè¡¨æ¿</a>å¹¶äº«å—ç»“æœï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/70/zo/vq/70zovqqaeiph6v1bjoenzl_hn1w.png"></div><br><br> æ‚¨ç°åœ¨å¯ä»¥ä¸Šä¼ æ•°æ®ã€‚ å¤ªå¥½äº†ï¼Œä¸æ˜¯å—ï¼Ÿ <br><br> ç°åœ¨è®©æˆ‘ä»¬å¼„æ¸…æ¥šå¦‚ä½•ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘æ‹“æ‰‘ä¸­æ·»åŠ å¦ä¸€ä¸ªå‰¯æœ¬é›†ã€‚ <br><br><h3> æ·±å…¥ç»†èŠ‚ </h3><br> é‚£ä¹ˆï¼Œå‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Ÿ <br><br> æˆ‘ä»¬å¯åŠ¨å¹¶è¿è¡Œäº†ä¸¤ä¸ªè™šæ‹Ÿæœºï¼Œå¹¶å¯åŠ¨äº†é…ç½®é›†ç¾¤çš„Ansibleå‰§æœ¬ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>playbook.yml</code>æ–‡ä»¶ï¼š <br><br><pre> <code class="plaintext hljs">--- - name: Deploy my Tarantool Cartridge app hosts: all become: true become_user: root tasks: - name: Import Tarantool Cartridge role import_role: name: tarantool.cartridge</code> </pre> <br> è¿™é‡Œæ²¡æœ‰æœ‰è¶£çš„äº‹æƒ…å‘ç”Ÿã€‚ è®©æˆ‘ä»¬å¯åŠ¨åä¸º<code>tarantool.cartridge</code>çš„Ansibleè§’è‰²ã€‚ <br><br> æœ€é‡è¦çš„äº‹æƒ…ï¼ˆå³é›†ç¾¤é…ç½®ï¼‰åœ¨<code><a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html">hosts.yml</a></code>æ¸…å•æ–‡ä»¶ä¸­ï¼š <br><br><pre> <code class="plaintext hljs">--- all: vars: # common cluster variables cartridge_app_name: getting-started-app cartridge_package_path: ./getting-started-app-1.0.0-0.rpm # path to package cartridge_cluster_cookie: app-default-cookie # cluster cookie # common ssh options ansible_ssh_private_key_file: ~/.vagrant.d/insecure_private_key ansible_ssh_common_args: '-o IdentitiesOnly=yes -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no' # INSTANCES hosts: storage-1: config: advertise_uri: '172.19.0.2:3301' http_port: 8181 app-1: config: advertise_uri: '172.19.0.3:3301' http_port: 8182 storage-1-replica: config: advertise_uri: '172.19.0.3:3302' http_port: 8183 children: # GROUP INSTANCES BY MACHINES host1: vars: # first machine connection options ansible_host: 172.19.0.2 ansible_user: vagrant hosts: # instances to be started on the first machine storage-1: host2: vars: # second machine connection options ansible_host: 172.19.0.3 ansible_user: vagrant hosts: # instances to be started on the second machine app-1: storage-1-replica: # GROUP INSTANCES BY REPLICA SETS replicaset_app_1: vars: # replica set configuration replicaset_alias: app-1 failover_priority: - app-1 # leader roles: - 'api' hosts: # replica set instances app-1: replicaset_storage_1: vars: # replica set configuration replicaset_alias: storage-1 weight: 3 failover_priority: - storage-1 # leader - storage-1-replica roles: - 'storage' hosts: # replica set instances storage-1: storage-1-replica:</code> </pre> <br> æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å­¦ä¹ å¦‚ä½•é€šè¿‡ä¿®æ”¹æ­¤æ–‡ä»¶æ¥ç®¡ç†å®ä¾‹å’Œå‰¯æœ¬é›†ã€‚ ç¨åï¼Œæˆ‘ä»¬å°†æ·»åŠ æ–°çš„éƒ¨åˆ†ã€‚ ä¸ºäº†é¿å…åœ¨æ·»åŠ å„èŠ‚æ—¶é€ æˆæ··ä¹±ï¼Œè¯·æŸ¥çœ‹æ­¤æ–‡ä»¶çš„æœ€ç»ˆç‰ˆæœ¬ï¼Œæˆ–ä½äºç¤ºä¾‹å­˜å‚¨åº“ä¸­çš„<code>hosts.updated.yml</code> ã€‚ <br><br><h3> ç®¡ç†å®ä¾‹ </h3><br> ç”¨Ansibleæœ¯è¯­æ¥è¯´ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æ˜¯ä¸€ä¸ªä¸»æœºï¼ˆä¸è¦ä¸ç‰©ç†æœåŠ¡å™¨æ··æ·†ï¼‰ï¼Œå³Ansibleå°†ç®¡ç†çš„åŸºç¡€ç»“æ„èŠ‚ç‚¹ã€‚ å¯¹äºæ¯ä¸ªä¸»æœºï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šè¿æ¥å‚æ•°ï¼ˆä¾‹å¦‚<code>ansible_host</code>å’Œ<code>ansible_user</code> ï¼‰å’Œå®ä¾‹é…ç½®ã€‚ å®ä¾‹æè¿°åœ¨<code>hosts</code>éƒ¨åˆ†ä¸­ã€‚ <br><br> è®©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹<code>storage-1</code>å®ä¾‹çš„é…ç½®ï¼š <br><br><pre> <code class="plaintext hljs">all: vars: ... # INSTANCES hosts: storage-1: config: advertise_uri: '172.19.0.2:3301' http_port: 8181 ...</code> </pre> <br> åœ¨<code>config</code>å˜é‡ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†å®ä¾‹å‚æ•°ï¼š <code>advertise URI</code>å’Œ<code>HTTP port</code> ã€‚ <br><br> ä»¥ä¸‹æ˜¯<code>app-1</code>å’Œ<code>storage-1-replica</code>å®ä¾‹çš„å‚æ•°ã€‚ <br><br> æˆ‘ä»¬åº”è¯¥ä¸ºAnsibleæä¾›æ¯ä¸ªå®ä¾‹çš„è¿æ¥å‚æ•°ã€‚ é€šè¿‡è™šæ‹Ÿæœºå¯¹å®ä¾‹è¿›è¡Œåˆ†ç»„ä¼¼ä¹æ˜¯åˆç†çš„ã€‚ ä¸ºæ­¤ï¼Œå®ä¾‹åœ¨<code>host1</code>å’Œ<code>host2</code>ä¸‹åˆ†ç»„åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”<code>vars</code>éƒ¨åˆ†ä¸­çš„æ¯ä¸ªç»„éƒ½åŒ…å«å•ä¸ªè™šæ‹Ÿæœºçš„<code>ansible_host</code>å’Œ<code>ansible_user</code>å‚æ•°å€¼ã€‚  <code>hosts</code>éƒ¨åˆ†åŒ…å«æ­¤ç»„ä¸­åŒ…å«çš„ä¸»æœºï¼ˆæˆ–å®ä¾‹ï¼‰ï¼š <br><br><pre> <code class="plaintext hljs">all: vars: ... hosts: ... children: # GROUP INSTANCES BY MACHINES host1: vars: # first machine connection options ansible_host: 172.19.0.2 ansible_user: vagrant hosts: # instances to be started on the first machine storage-1: host2: vars: # second machine connection options ansible_host: 172.19.0.3 ansible_user: vagrant hosts: # instances to be started on the second machine app-1: storage-1-replica:</code> </pre> <br> è®©æˆ‘ä»¬å¼€å§‹ç¼–è¾‘<code>hosts.yml</code> ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å†æ·»åŠ ä¸¤ä¸ªå®ä¾‹ï¼šç¬¬ä¸€ä¸ªè™šæ‹Ÿæœºä¸Šçš„<code>storage-2-replica</code>å’Œç¬¬äºŒä¸ªè™šæ‹Ÿæœºä¸Šçš„<code>storage-2</code> ï¼š <br><br><pre> <code class="plaintext hljs">all: vars: ... # INSTANCES hosts: ... storage-2: # &lt;== config: advertise_uri: '172.19.0.3:3303' http_port: 8184 storage-2-replica: # &lt;== config: advertise_uri: '172.19.0.2:3302' http_port: 8185 children: # GROUP INSTANCES BY MACHINES host1: vars: ... hosts: # instances to be started on the first machine storage-1: storage-2-replica: # &lt;== host2: vars: ... hosts: # instances to be started on the second machine app-1: storage-1-replica: storage-2: # &lt;== ...</code> </pre> <br> å¯åŠ¨Ansibleå‰§æœ¬ï¼š <br><br><pre> <code class="plaintext hljs">$ ansible-playbook -i hosts.yml \ --limit storage-2,storage-2-replica \ playbook.yml</code> </pre> <br> æ³¨æ„<code>--limit</code>é€‰é¡¹ã€‚ ç”±äºæ¯ä¸ªç¾¤é›†å®ä¾‹éƒ½æ˜¯Ansibleçš„ä¸»æœºï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œå‰§æœ¬æ—¶æ˜ç¡®æŒ‡å®šåº”é…ç½®çš„å®ä¾‹ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬è¿”å›åˆ°Web UIï¼Œä½äº<a href="http://localhost:8181/admin/cluster/dashboard">httpï¼š//æœ¬åœ°ä¸»æœºï¼š8181 / admin / cluster / dashboardï¼Œ</a>å¹¶æŸ¥çœ‹æˆ‘ä»¬çš„æ–°å®ä¾‹ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l2/jw/9-/l2jw9-hw2varlmqtt0tdnonh8tw.png"></div><br><br> æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æŒæ¡æ‹“æ‰‘ç®¡ç†ã€‚ <br><br><h3> ç®¡ç†æ‹“æ‰‘ </h3><br> è®©æˆ‘ä»¬å°†æ–°å®ä¾‹åˆ†ç»„åˆ°<code>storage-2</code>å‰¯æœ¬é›†ä¸­ï¼Œæ·»åŠ æ–°çš„<code>replicaset_storage_2</code>ç»„ï¼Œç„¶ååƒå¯¹<code>replicaset_storage_1</code>é‚£æ ·åœ¨å˜é‡ä¸­æè¿°å‰¯æœ¬é›†å‚æ•°ã€‚ åœ¨<code>hosts</code>éƒ¨åˆ†ï¼Œæˆ‘ä»¬æŒ‡å®šåº”åœ¨è¯¥ç»„ä¸­åŒ…å«å“ªäº›å®ä¾‹ï¼ˆå³æˆ‘ä»¬çš„å‰¯æœ¬é›†ï¼‰ï¼š <br><br><pre> <code class="plaintext hljs">--- all: vars: ... hosts: ... children: ... # GROUP INSTANCES BY REPLICA SETS ... replicaset_storage_2: # &lt;== vars: # replicaset configuration replicaset_alias: storage-2 weight: 2 failover_priority: - storage-2 - storage-2-replica roles: - 'storage' hosts: # replicaset instances storage-2: storage-2-replica:</code> </pre> <br> ç„¶åï¼Œæˆ‘ä»¬å†æ¬¡è¿è¡Œè¯¥å‰§æœ¬ï¼š <br><br><pre> <code class="plaintext hljs">$ ansible-playbook -i hosts.yml \ --limit replicaset_storage_2 \ --tags cartridge-replicasets \ playbook.yml</code> </pre> <br> è¿™æ¬¡ï¼Œæˆ‘ä»¬åœ¨<code>--limit</code>å‚æ•°ä¸­ä¼ é€’äº†ä¸æˆ‘ä»¬çš„å‰¯æœ¬é›†ç›¸å¯¹åº”çš„ç»„çš„åç§°ã€‚ <br><br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>tags</code>é€‰é¡¹ã€‚ <br><br> æˆ‘ä»¬çš„è§’è‰²å…ˆåæ‰§è¡Œå¸¦æœ‰ä»¥ä¸‹æ ‡è®°çš„å„ç§ä»»åŠ¡ï¼š <br><br><ul><li>  <code>cartridge-instances</code> ï¼šå®ä¾‹ç®¡ç†ï¼ˆé…ç½®ï¼Œæˆå‘˜ï¼‰ï¼› </li><li>  <code>cartridge-replicasets</code> ï¼šæ‹“æ‰‘ç®¡ç†ï¼ˆå‰¯æœ¬é›†ç®¡ç†å’Œä»ç¾¤é›†ä¸­æ°¸ä¹…åˆ é™¤å®ä¾‹ï¼‰ã€‚ </li><li>  ettes <code>cartridge-config</code> ï¼šæ§åˆ¶å…¶ä»–ç¾¤é›†å‚æ•°ï¼ˆvshardå¼•å¯¼ç¨‹åºï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œæˆæƒå‚æ•°å’Œåº”ç”¨ç¨‹åºé…ç½®ï¼‰ã€‚ </li></ul><br> æˆ‘ä»¬å¯ä»¥æ˜ç¡®æŒ‡å®šè¦å®Œæˆçš„å·¥ä½œçš„å“ªä¸€éƒ¨åˆ†-è¯¥è§’è‰²å°†è·³è¿‡å…¶ä½™ä»»åŠ¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªæƒ³ä½¿ç”¨æ‹“æ‰‘ï¼Œå› æ­¤æˆ‘ä»¬æŒ‡å®šäº†<code>cartridge-replicasets</code> ã€‚ <br><br> è®©æˆ‘ä»¬è¯„ä¼°æˆ‘ä»¬åŠªåŠ›çš„ç»“æœã€‚ åœ¨<a href="http://localhost:8181/admin/cluster/dashboard">httpï¼š// localhostï¼š8181 / admin / cluster / dashboardä¸­</a>æ‰¾åˆ°æ–°çš„å‰¯æœ¬é›†ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sw/0z/gm/sw0zgm53me7ft63db8lxrswcxvw.png"></div><br><br> è€¶ <br><br> å°è¯•æ›´æ”¹å®ä¾‹å’Œå‰¯æœ¬é›†çš„é…ç½®ï¼Œç„¶åæŸ¥çœ‹ç¾¤é›†çš„æ‹“æ‰‘å¦‚ä½•æ›´æ”¹ã€‚ æ‚¨å¯ä»¥å°è¯•ä¸åŒçš„ç”¨ä¾‹ï¼Œä¾‹å¦‚<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_delegation.html">æ»šåŠ¨æ›´æ–°</a>æˆ–<code>memtx_memory</code>å¢åŠ ã€‚ è¯¥è§’è‰²å°†å°è¯•æ‰§è¡Œæ­¤æ“ä½œè€Œæ— éœ€é‡æ–°å¯åŠ¨å®ä¾‹ï¼Œä»¥å‡å°‘åº”ç”¨ç¨‹åºå¯èƒ½çš„åœæœºæ—¶é—´ã€‚ <br><br> å®Œæˆè™šæ‹Ÿæœºæ“ä½œåï¼Œä¸è¦å¿˜è®°è¿è¡Œ<code>vagrant halt</code>æ¥åœæ­¢è™šæ‹Ÿæœºã€‚ <br><br><h1> é‡Œé¢æœ‰ä»€ä¹ˆï¼Ÿ </h1><br> åœ¨è¿™é‡Œï¼Œæˆ‘å°†è¯¦ç»†ä»‹ç»æ‚¨åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­Ansibleè§’è‰²çš„å¹•åç»å†ã€‚ <br> è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹éƒ¨ç½²Cartridgeåº”ç”¨ç¨‹åºçš„æ­¥éª¤ã€‚ <br><br><h3> å®‰è£…è½¯ä»¶åŒ…å¹¶å¯åŠ¨å®ä¾‹ </h3><br> é¦–å…ˆè¦åšçš„æ˜¯å°†è½¯ä»¶åŒ…äº¤ä»˜åˆ°æœåŠ¡å™¨å¹¶è¿›è¡Œå®‰è£…ã€‚ ç°åœ¨ï¼Œè¯¥è§’è‰²å¯ä»¥ä¸RPMåŒ…å’ŒDEBåŒ…ä¸€èµ·ä½¿ç”¨ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯åŠ¨å®ä¾‹ã€‚ è¿™å¾ˆç®€å•ï¼šæ¯ä¸ªå®ä¾‹éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„<code>systemd</code>æœåŠ¡ã€‚ ä¾‹å¦‚ï¼š <br><br><pre> <code class="plaintext hljs">$ systemctl start myapp@storage-1</code> </pre> <br> æ­¤å‘½ä»¤å¯åŠ¨<code>myapp</code>çš„<code>storage-1</code>å®ä¾‹ <br> åº”ç”¨ç¨‹åºã€‚ æ­£åœ¨è¿è¡Œçš„å®ä¾‹åœ¨<code>/etc/tarantool/conf.d/</code>æŸ¥æ‰¾å…¶<a href="https://www.tarantool.io/ru/doc/2.2/book/cartridge/cartridge_dev/">é…ç½®</a> ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<code>journald</code>æŸ¥çœ‹å®ä¾‹æ—¥å¿—ã€‚ <br><br> è¯¥è½¯ä»¶åŒ…éšé™„äº†ç”¨äºsystemdæœåŠ¡çš„Unitæ–‡ä»¶<code>/etc/systemd/systemd/myapp@.sevice</code> ã€‚ <br><br>  Ansibleå…·æœ‰ç”¨äºå®‰è£…è½¯ä»¶åŒ…å’Œç®¡ç†ç³»ç»ŸæœåŠ¡çš„å†…ç½®æ¨¡å—ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è¿™é‡Œæ²¡æœ‰å‘æ˜ä»»ä½•æ–°ä¸œè¥¿ã€‚ <br><br><h3> é…ç½®é›†ç¾¤æ‹“æ‰‘ </h3><br> æœ€æ¿€åŠ¨äººå¿ƒçš„äº‹æƒ…å‘ç”Ÿåœ¨è¿™é‡Œã€‚ æˆ‘ç›¸ä¿¡æ‚¨ä¼šåŒæ„ï¼Œå¯¹äºå®‰è£…è½¯ä»¶åŒ…å’Œè¿è¡Œ<code>systemd</code>æœåŠ¡çš„ç‰¹æ®ŠAnsibleè§’è‰²æ„Ÿåˆ°å›°æ‰°æ˜¯å¾ˆå¥‡æ€ªçš„ã€‚ <br><br> æ‚¨å¯ä»¥æ‰‹åŠ¨é…ç½®é›†ç¾¤ï¼š <br><br><ul><li> ç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯æ‰“å¼€Web UIå¹¶å•å‡»æŒ‰é’®ã€‚ éå¸¸é€‚åˆä¸€æ¬¡å¯åŠ¨å¤šä¸ªå®ä¾‹ã€‚ </li><li> ç¬¬äºŒç§é€‰æ‹©æ˜¯ä½¿ç”¨GraphQL APIã€‚ åœ¨è¿™é‡Œæ‚¨å·²ç»å¯ä»¥è‡ªåŠ¨åŒ–ä¸€äº›æ“ä½œï¼Œä¾‹å¦‚ï¼Œç”¨Pythonç¼–å†™è„šæœ¬ã€‚ </li><li> ç¬¬ä¸‰ç§é€‰æ‹©æ˜¯å‹‡æ•¢çš„ï¼šè½¬åˆ°æœåŠ¡å™¨ï¼Œå€ŸåŠ©<code>tarantoolctl connect</code>è¿æ¥åˆ°ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä½¿ç”¨<code>cartridge</code> Luaæ¨¡å—æ‰§è¡Œæ‰€æœ‰å¿…è¦çš„æ“ä½œã€‚ </li></ul><br> æˆ‘ä»¬å‘æ˜çš„ä¸»è¦ä»»åŠ¡æ˜¯ä¸ºæ‚¨å®Œæˆè¿™é¡¹å·¥ä½œä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ã€‚ <br><br>  Ansibleå…è®¸æ‚¨ç¼–å†™è‡ªå·±çš„æ¨¡å—å¹¶åœ¨æ‚¨çš„è§’è‰²ä¸­ä½¿ç”¨å®ƒã€‚ æˆ‘ä»¬çš„è§’è‰²ä½¿ç”¨è¿™äº›æ¨¡å—æ¥ç®¡ç†å„ç§é›†ç¾¤ç»„ä»¶ã€‚ <br><br> å¦‚ä½•è¿ä½œï¼Ÿ æ‚¨ä»¥å£°æ˜å¼é…ç½®æè¿°é›†ç¾¤çš„æ‰€éœ€çŠ¶æ€ï¼Œè¯¥è§’è‰²ä¸ºæ¯ä¸ªæ¨¡å—æä¾›å…¶è‡ªå·±çš„é…ç½®éƒ¨åˆ†ä½œä¸ºè¾“å…¥ã€‚ è¯¥æ¨¡å—æ¥æ”¶é›†ç¾¤çš„å½“å‰çŠ¶æ€ï¼Œå¹¶å°†å…¶ä¸è¾“å…¥è¿›è¡Œæ¯”è¾ƒã€‚ ç„¶åï¼Œä½¿ç”¨å…¶ä¸­ä¸€ä¸ªå®ä¾‹çš„å¥—æ¥å­—å¯åŠ¨å¿…è¦é›†ç¾¤çŠ¶æ€çš„ä»£ç ã€‚ <br><br><h1> ç»“æœ </h1><br> ä»Šå¤©ï¼Œæˆ‘ä»¬å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•éƒ¨ç½²Tarantool Cartridgeåº”ç”¨ç¨‹åºå’Œé…ç½®ç®€å•çš„æ‹“æ‰‘ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Ansibleï¼Œè¿™æ˜¯ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå…è®¸æ‚¨åŒæ—¶é…ç½®å¤šä¸ªåŸºç¡€ç»“æ„èŠ‚ç‚¹ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ˜¯é›†ç¾¤å®ä¾‹ï¼‰ã€‚ <br><br> ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†é€šè¿‡Ansibleæè¿°é›†ç¾¤é…ç½®çš„å¤šç§æ–¹æ³•ä¹‹ä¸€ã€‚ ä¸€æ—¦æ‚¨å‡†å¤‡å¥½äº†æ›´å¤šï¼Œè¯·å­¦ä¹ ç¼–å†™å‰§æœ¬çš„<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html">æœ€ä½³å®è·µ</a> ã€‚ æ‚¨å¯èƒ½ä¼šå‘ç°ä½¿ç”¨<code>group_vars</code>å’Œ<code>host_vars</code>ç®¡ç†æ‹“æ‰‘æ›´å®¹æ˜“ã€‚ <br><br> å¾ˆå¿«ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰æ‚¨å¦‚ä½•ä»æ‹“æ‰‘ä¸­æ°¸ä¹…åˆ é™¤ï¼ˆåˆ é™¤ï¼‰å®ä¾‹ï¼Œå¼•å¯¼vshardï¼Œç®¡ç†è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œé…ç½®æˆæƒä»¥åŠä¿®è¡¥ç¨‹åºé›†ç¾¤é…ç½®ã€‚ åŒæ—¶ï¼Œæ‚¨å¯ä»¥è‡ªå·±æŸ¥çœ‹<a href="https://github.com/tarantool/ansible-cartridge">æ–‡æ¡£</a>å¹¶å°è¯•æ›´æ”¹ç¾¤é›†è®¾ç½®ã€‚ <br><br> å¦‚æœå‡ºç°é—®é¢˜ï¼Œè¯·ç¡®ä¿<a href="https://github.com/tarantool/ansible-cartridge/issues/new">è®©æˆ‘ä»¬çŸ¥é“</a>è¯¥é—®é¢˜ã€‚ æˆ‘ä»¬å°†å°½åŠ›è§£å†³ä»»ä½•é—®é¢˜ï¼ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN480468/">https://habr.com/ru/post/zh-CN480468/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN480452/index.html">OWASPè«æ–¯ç§‘èšä¼šï¼ƒ9ï¼šæ€§èƒ½è®°å½•</a></li>
<li><a href="../zh-CN480454/index.html">å“ˆå…‹ç›’å­-Smasher2æ¼”ç»ƒ é€šè¿‡pwné©±åŠ¨ç¨‹åºè¿›è¡ŒFlaskï¼ŒWAFå’ŒLPE</a></li>
<li><a href="../zh-CN480458/index.html">è§‚çœ‹â€œæ—¶é—´çš„ç»†èƒâ€</a></li>
<li><a href="../zh-CN480462/index.html">æˆ‘å¦‚ä½•è¾©è®ºOçš„åŒå‘é“¾è¡¨ï¼ˆ1ï¼‰</a></li>
<li><a href="../zh-CN480466/index.html">é€æä»ªè§„æ ¼ï¼šç»åœ°ä¹‹è·¯</a></li>
<li><a href="../zh-CN480470/index.html">åœ¨å“ªé‡Œæ‹…ä»»åˆçº§å¼€å‘äººå‘˜</a></li>
<li><a href="../zh-CN480480/index.html">é‡å­è®¡ç®—æœºå¦‚ä½•å·¥ä½œã€‚ æ‹¼ç Œæ‹¼å›¾</a></li>
<li><a href="../zh-CN480482/index.html">å¦‚ä½•ä¸ºMLå»ºç«‹è®¡ç®—æœº</a></li>
<li><a href="../zh-CN480484/index.html">BeerPHPï¼šè¿™æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦å»ä»¥åŠå¦‚ä½•åœ¨æ‚¨çš„åŸå¸‚ä¸­è¿è¡Œ</a></li>
<li><a href="../zh-CN480486/index.html">æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯æœ€å¥½çš„</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>