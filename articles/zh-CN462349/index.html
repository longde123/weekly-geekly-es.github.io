<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”ï¸ ğŸ§ ğŸ¤Ÿ RESTinioæ˜¯ä¸€ä¸ªå¼‚æ­¥HTTPæœåŠ¡å™¨ã€‚ å®è·µä¸­çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼šä½œä¸ºå“åº”è¿”å›å¤§é‡æ•°æ® ğŸœ âš”ï¸ ğŸ§˜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ€è¿‘ï¼Œæˆ‘ç¢°å·§åœ¨ä¸€ä¸ªåº”è¯¥æ§åˆ¶å…¶ä¼ å‡ºè¿æ¥é€Ÿåº¦çš„åº”ç”¨ç¨‹åºä¸Šå·¥ä½œã€‚ ä¾‹å¦‚ï¼Œè¿æ¥åˆ°ä¸€ä¸ªURLï¼Œåº”ç”¨ç¨‹åºåº”å°†è‡ªèº«é™åˆ¶ä¸º200KiB /ç§’ã€‚ å¹¶è¿æ¥åˆ°å¦ä¸€ä¸ªURL-ä»…30KiB /ç§’ã€‚ 


 è¿™é‡Œæœ€æœ‰è¶£çš„ä¸€ç‚¹æ˜¯æµ‹è¯•è¿™äº›é™åˆ¶ã€‚ æˆ‘éœ€è¦ä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å°†ä»¥ç»™å®šçš„é€Ÿåº¦æä¾›æµé‡ï¼Œä¾‹å¦‚512KiB /ç§’ã€‚ ç„¶...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RESTinioæ˜¯ä¸€ä¸ªå¼‚æ­¥HTTPæœåŠ¡å™¨ã€‚ å®è·µä¸­çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼šä½œä¸ºå“åº”è¿”å›å¤§é‡æ•°æ®</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462349/"><p><img src="https://habrastorage.org/webt/a6/kc/zt/a6kcztqtbqzp5shvd5wcz-8zzl0.jpeg"></p><br><p> æœ€è¿‘ï¼Œæˆ‘ç¢°å·§åœ¨ä¸€ä¸ªåº”è¯¥æ§åˆ¶å…¶ä¼ å‡ºè¿æ¥é€Ÿåº¦çš„åº”ç”¨ç¨‹åºä¸Šå·¥ä½œã€‚ ä¾‹å¦‚ï¼Œè¿æ¥åˆ°ä¸€ä¸ªURLï¼Œåº”ç”¨ç¨‹åºåº”å°†è‡ªèº«é™åˆ¶ä¸º200KiB /ç§’ã€‚ å¹¶è¿æ¥åˆ°å¦ä¸€ä¸ªURL-ä»…30KiB /ç§’ã€‚ </p><br><p> è¿™é‡Œæœ€æœ‰è¶£çš„ä¸€ç‚¹æ˜¯æµ‹è¯•è¿™äº›é™åˆ¶ã€‚ æˆ‘éœ€è¦ä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å°†ä»¥ç»™å®šçš„é€Ÿåº¦æä¾›æµé‡ï¼Œä¾‹å¦‚512KiB /ç§’ã€‚ ç„¶åï¼Œæˆ‘å¯ä»¥æŸ¥çœ‹è¯¥åº”ç”¨ç¨‹åºæ˜¯å¦ç¡®å®èƒ½å¤Ÿæ‰¿å—200KiB /ç§’çš„é€Ÿåº¦ï¼Œæˆ–è€…æ˜¯å¦å¯ä»¥åˆ†è§£ä¸ºæ›´é«˜çš„é€Ÿåº¦ã€‚ </p><br><p> ä½†æ˜¯åœ¨å“ªé‡Œå¯ä»¥å¾—åˆ°è¿™æ ·çš„HTTPæœåŠ¡å™¨å‘¢ï¼Ÿ </p><br><p> ç”±äºæˆ‘ä¸C ++åº”ç”¨ç¨‹åºä¸­åµŒå…¥çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RESTinio</a> HTTPæœåŠ¡å™¨æœ‰å…³ï¼Œå› æ­¤ï¼Œæˆ‘æ²¡æœ‰æ¯”å°†ä¸€ä¸ªç®€å•çš„HTTPæµ‹è¯•æœåŠ¡å™¨å¿«é€ŸæŠ•æ·åˆ°è†ç›–ä¸Šä»¥å‘å®¢æˆ·ç«¯å‘é€å¤§é‡ä¼ å‡ºæ•°æ®çš„æ–¹æ³•æ›´å¥½çš„äº†ã€‚ </p><br><p> å…³äºå®ƒçš„ç®€å•ç¨‹åº¦ï¼Œå¹¶å¸Œæœ›åœ¨æœ¬æ–‡ä¸­è®²è¿°ã€‚ åŒæ—¶ï¼Œåœ¨è¯„è®ºä¸­æ‰¾å‡ºè¿™æ˜¯å¦çœŸçš„å¾ˆç®€å•æˆ–è€…æˆ‘æ˜¯å¦åœ¨è‡ªæ¬ºæ¬ºäººã€‚ åŸåˆ™ä¸Šï¼Œå¯ä»¥å°†æœ¬æ–‡è§†ä¸ºä¸Šä¸€ç¯‡æœ‰å…³RESTinioçš„æ–‡ç« çš„å»¶ç»­ï¼Œè¯¥æ–‡ç« ç§°ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œ RESTinioæ˜¯å¼‚æ­¥HTTPæœåŠ¡å™¨ã€‚å¼‚æ­¥â€</a> ã€‚ å› æ­¤ï¼Œå¦‚æœæœ‰äººæœ‰å…´è¶£é˜…è¯»æœ‰å…³RESTinioçš„å®é™…åº”ç”¨ï¼ˆè™½ç„¶ä¸æ˜¯å¾ˆè®¤çœŸï¼‰çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæ¬¢è¿æ‚¨ã€‚ </p><a name="habracut"></a><br><h1 id="obschaya-ideya"> æ€»ä½“æ€è·¯ </h1><br><p> ä¸Šé¢æåˆ°çš„æµ‹è¯•æœåŠ¡å™¨çš„æ€»ä½“æ€è·¯éå¸¸ç®€å•ï¼šå½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨å¹¶æ‰§è¡ŒHTTP GETè¯·æ±‚æ—¶ï¼Œå°†æ¿€æ´»ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œè¯¥è®¡æ—¶å™¨æ¯ç§’è¿è¡Œä¸€æ¬¡ã€‚ è§¦å‘è®¡æ—¶å™¨åï¼Œå°†ç»™å®šå¤§å°çš„ä¸‹ä¸€ä¸ªæ•°æ®å—å‘é€åˆ°å®¢æˆ·ç«¯ã€‚ </p><br><h2 id="no-vse-neskolko-slozhnee"> ä½†æ˜¯ä¸€åˆ‡éƒ½æ¯”è¾ƒå¤æ‚ </h2><br><p> å¦‚æœå®¢æˆ·ç«¯è¯»å–æ•°æ®çš„é€Ÿåº¦æ¯”æœåŠ¡å™¨å‘é€æ•°æ®çš„é€Ÿåº¦æ…¢ï¼Œé‚£ä¹ˆæ¯ç§’ä»…å‘é€N KBå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ ç”±äºæ•°æ®å°†å¼€å§‹åœ¨å¥—æ¥å­—ä¸­ç´¯ç§¯ï¼Œå› æ­¤ä¸ä¼šå¯¼è‡´ä»»ä½•é—®é¢˜ã€‚ </p><br><p> å› æ­¤ï¼Œåœ¨å‘é€æ•°æ®æ—¶ï¼Œå»ºè®®æ§åˆ¶å¥—æ¥å­—åœ¨HTTPæœåŠ¡å™¨ç«¯è¿›è¡Œå†™å…¥çš„å‡†å¤‡æƒ…å†µã€‚ åªè¦å¥—æ¥å­—å·²å‡†å¤‡å°±ç»ªï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå°šæœªç´¯ç§¯å¤ªå¤šæ•°æ®ï¼‰ï¼Œå°±å¯ä»¥å‘é€æ–°éƒ¨åˆ†ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå°šæœªå‡†å¤‡å¥½ï¼Œåˆ™éœ€è¦ç­‰åˆ°å¥—æ¥å­—è¿›å…¥å‡†å¤‡è®°å½•çš„çŠ¶æ€ã€‚ </p><br><p> å¬èµ·æ¥å¾ˆåˆç†ï¼Œä½†æ˜¯I / Oæ“ä½œéšè—åœ¨RESTinioçš„å†…è„ä¸­ã€‚å¦‚ä½•ç¡®å®šä¸‹ä¸€ä¸ªæ•°æ®æ˜¯å¦å¯ä»¥å†™å…¥ï¼Ÿ </p><br><p> å¦‚æœä½¿ç”¨RESTinioä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„å†™åé€šçŸ¥ç¨‹åº</a> ï¼Œåˆ™å¯ä»¥é¿å…è¿™ç§æƒ…å†µã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š </p><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">request_handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(restinio::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">request_handle_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> req)</span></span></span><span class="hljs-function"> </span></span>{ req-&gt;create_response() <span class="hljs-comment"><span class="hljs-comment">//   . ... //   . .done([](const auto &amp; ec) { ... //         . }); }</span></span></code> </pre> <br><p>  RESTinioå®Œæˆå†™å‡ºæ•°æ®æ—¶ï¼Œå°†è°ƒç”¨ä¼ é€’ç»™<code>done()</code>æ–¹æ³•çš„lambdaã€‚ å› æ­¤ï¼Œå¦‚æœå¥—æ¥å­—ä¸€æ®µæ—¶é—´æœªå‡†å¤‡å¥½è¿›è¡Œè®°å½•ï¼Œåˆ™lambdaä¸ä¼šç«‹å³è¢«è°ƒç”¨ï¼Œè€Œæ˜¯åœ¨å¥—æ¥å­—è¿›å…¥å…¶é€‚å½“çŠ¶æ€å¹¶æ¥å—æ‰€æœ‰ä¼ å‡ºæ•°æ®ä¹‹åã€‚ </p><br><p> ç”±äºä½¿ç”¨äº†å†™åé€šçŸ¥ç¨‹åºï¼Œå› æ­¤æµ‹è¯•æœåŠ¡å™¨çš„é€»è¾‘å¦‚ä¸‹ï¼š </p><br><ul><li> å‘é€ä¸‹ä¸€æ‰¹æ•°æ®ï¼Œè®¡ç®—åœ¨æ­£å¸¸äº‹ä»¶è¿‡ç¨‹ä¸­éœ€è¦å‘é€ä¸‹ä¸€æ‰¹æ•°æ®çš„æ—¶é—´ï¼› </li><li> æˆ‘ä»¬å°†é€šçŸ¥å™¨æŒ‚åœ¨æ•°æ®çš„ä¸‹ä¸€éƒ¨åˆ†ä¸Šï¼› </li><li> å½“è°ƒç”¨å†™åé€šçŸ¥æ—¶ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¸‹ä¸€æ‰¹æ˜¯å¦åˆ°è¾¾ã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™ç«‹å³å¯åŠ¨ä¸‹ä¸€éƒ¨åˆ†çš„å‘é€ã€‚ å¦‚æœä¸æ˜¯ï¼Œè¯·æ—‹åŠ¨è®¡æ—¶å™¨ã€‚ </li></ul><br><p> ç»“æœï¼Œäº‹å®è¯æ˜ï¼Œä¸€æ—¦è®°å½•å¼€å§‹å˜æ…¢ï¼Œå‘é€æ–°æ•°æ®å°±ä¼šæš‚åœã€‚ å¹¶åœ¨å¥—æ¥å­—å‡†å¤‡å¥½æ¥å—æ–°çš„ä¼ å‡ºæ•°æ®æ—¶æ¢å¤ã€‚ </p><br><h2 id="i-esche-nemnogo-slozhnogo-chunked_output"> è¿˜æœ‰ä¸€ç‚¹å¤æ‚ï¼šchunked_output </h2><br><p>  RESTinioæ”¯æŒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸‰ç§ç”ŸæˆHTTPè¯·æ±‚å“åº”çš„æ–¹å¼</a> ã€‚ é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„æœ€ç®€å•æ–¹æ³•ä¸é€‚ç”¨äºè¿™ç§æƒ…å†µï¼Œå› ä¸º æˆ‘éœ€è¦å‡ ä¹æ— ä¼‘æ­¢çš„ä¼ å‡ºæ•°æ®æµã€‚ è¿™æ ·çš„æµå½“ç„¶ä¸èƒ½<code>set_body</code>åˆ°å¯¹<code>set_body</code>æ–¹æ³•çš„å•ä¸ªè°ƒç”¨ã€‚ </p><br><p> å› æ­¤ï¼Œæ‰€æè¿°çš„æµ‹è¯•æœåŠ¡å™¨ä½¿ç”¨äº†æ‰€è°“çš„  <em>chunked_output</em> ã€‚ å³ åœ¨åˆ›å»ºç­”æ¡ˆæ—¶ï¼Œæˆ‘å‘RESTinioæŒ‡ç¤ºç­”æ¡ˆå°†åˆ†ä¸ºéƒ¨åˆ†ã€‚ ç„¶åï¼Œæˆ‘åªæ˜¯å®šæœŸè°ƒç”¨<code>append_chunk</code>æ–¹æ³•ï¼Œå°†ä¸‹ä¸€éƒ¨åˆ†æ·»åŠ åˆ°ç­”æ¡ˆä¸­ï¼Œç„¶å<code>flush</code>ä»¥å°†ç´¯ç§¯çš„éƒ¨åˆ†å†™å…¥å¥—æ¥å­—ã€‚ </p><br><h1 id="a-davayte-uzhe-posmotrim-v-kod"> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç ï¼ </h1><br><p> å¼€å¤´çš„å•è¯è¶³å¤Ÿäº†ï¼Œç°åœ¨å¯ä»¥ç»§ç»­æ£€æŸ¥ä»£ç æœ¬èº«äº†ï¼Œå¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å­˜å‚¨åº“ä¸­</a>æ‰¾åˆ°ã€‚ è®©æˆ‘ä»¬ä»<code>request_processor</code>å‡½æ•°å¼€å§‹ï¼Œè¯¥å‡½æ•°è¢«è°ƒç”¨ä»¥å¤„ç†æ¯ä¸ªæœ‰æ•ˆçš„HTTPè¯·æ±‚ã€‚ åŒæ—¶ï¼Œè®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶é‚£äº›ä»<code>request_processor</code>è°ƒç”¨çš„å‡½æ•°ã€‚ å¥½äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†äº†è§£<code>request_processor</code>å¦‚ä½•ç²¾ç¡®æ˜ å°„åˆ°ä¸€ä¸ªæˆ–å¦ä¸€ä¸ªä¼ å…¥çš„HTTPè¯·æ±‚ã€‚ </p><br><h2 id="funkciya-request_processor-i-eyo-podruchnye">  Request_processorå‡½æ•°åŠå…¶åŠ©æ‰‹ </h2><br><p> è°ƒç”¨<code>request_processor</code>å‡½æ•°æ¥å¤„ç†æˆ‘éœ€è¦çš„HTTP GETè¯·æ±‚ã€‚ å®ƒä½œä¸ºå‚æ•°ä¼ é€’ï¼š </p><br><ul><li> åœ¨å…¶ä¸Šæ‰§è¡Œæ‰€æœ‰å·¥ä½œçš„asio-shny io_contextï¼ˆä¾‹å¦‚ï¼Œå¯¹äºç¿˜èµ·è®¡æ—¶å™¨ï¼Œè¿™æ˜¯å¿…éœ€çš„ï¼‰ï¼› </li><li> å“åº”çš„ä¸€éƒ¨åˆ†çš„å¤§å°ã€‚ å³ å¦‚æœæˆ‘éœ€è¦ä»¥512KiB / secçš„é€Ÿç‡æä¾›ä¼ å‡ºæµï¼Œåˆ™å°†å€¼512KiBä½œä¸ºæ­¤å‚æ•°ä¼ é€’ï¼› </li><li> å“åº”çš„é›¶ä»¶æ•°ã€‚ ä¸‡ä¸€è¯¥æµåº”å…·æœ‰æœ‰é™çš„é•¿åº¦ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è¦ä»¥512KiB / secçš„é€Ÿç‡æä¾›5åˆ†é’Ÿçš„æµï¼Œåˆ™å°†å€¼300ä½œä¸ºè¯¥å‚æ•°ä¼ é€’ï¼ˆæ¯åˆ†é’Ÿ60ä¸ªå—ï¼ŒæŒç»­5åˆ†é’Ÿï¼‰ï¼› </li><li> å¥½äº†ï¼Œä¼ å…¥è¯·æ±‚æœ¬èº«è¿›è¡Œå¤„ç†ã€‚ </li></ul><br><p> åœ¨<code>request_processor</code>å†…éƒ¨ï¼Œä½¿ç”¨æœ‰å…³è¯·æ±‚åŠå…¶å¤„ç†å‚æ•°çš„ä¿¡æ¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæ­¤åå³å¼€å§‹å¤„ç†ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">request_processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( asio_ns::io_context &amp; ctx, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> chunk_size, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count, restinio::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">request_handle_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> req)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt;response_data&gt;( ctx, chunk_size, req-&gt;create_response&lt;<span class="hljs-keyword"><span class="hljs-keyword">output_t</span></span>&gt;(), count); data-&gt;response_ .append_header(restinio::http_field::server, <span class="hljs-string"><span class="hljs-string">"RESTinio"</span></span>) .append_header_date_field() .append_header( restinio::http_field::content_type, <span class="hljs-string"><span class="hljs-string">"text/plain; charset=utf-8"</span></span>) .flush(); send_next_portion(data); }</code> </pre> <br><p> åŒ…å«ä¸è¯·æ±‚ç›¸å…³çš„æ‰€æœ‰å‚æ•°çš„<code>response_data</code>ç±»å‹å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">response_data</span></span></span><span class="hljs-class"> {</span></span> asio_ns::io_context &amp; io_ctx_; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> chunk_size_; <span class="hljs-keyword"><span class="hljs-keyword">response_t</span></span> response_; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> counter_; response_data( asio_ns::io_context &amp; io_ctx, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> chunk_size, <span class="hljs-keyword"><span class="hljs-keyword">response_t</span></span> response, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> counter) : io_ctx_{io_ctx} , chunk_size_{chunk_size} , response_{<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(response)} , counter_{counter} {} };</code> </pre> <br><p> è¿™é‡Œåº”è¯¥æ³¨æ„ï¼Œå‡ºç°<code>response_data</code>ç»“æ„çš„åŸå› ä¹‹ä¸€æ˜¯ç±»å‹ä¸º<code>restinio::response_builder_t&lt;restinio::chunked_output_t&gt;</code> ï¼ˆå³ï¼Œè¯¥ç±»å‹éšè—åœ¨çŸ­åˆ«å<code>response_t</code>åé¢ï¼‰æ˜¯å¯ç§»åŠ¨ç±»å‹ï¼Œä½†ä¸æ˜¯å¯å¤åˆ¶ç±»å‹ï¼ˆé€šè¿‡ä¸<code>std::unique_ptr</code>ç±»ä¼¼ï¼‰ã€‚ å› æ­¤ï¼Œä¸èƒ½ä»…åœ¨lambdaå‡½æ•°ä¸­æ•è·è¯¥å¯¹è±¡ï¼Œç„¶åå°†å…¶åŒ…è£…åœ¨<code>std::function</code> ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå°†å“åº”å¯¹è±¡æ”¾åœ¨åŠ¨æ€åˆ›å»ºçš„<code>response_data</code>å®ä¾‹ä¸­ï¼Œåˆ™å·²ç»å¯ä»¥<code>reponse_data</code>åœ°åœ¨lambdaå‡½æ•°ä¸­æ•è·æŒ‡å‘<code>reponse_data</code>å®ä¾‹çš„æ™ºèƒ½æŒ‡é’ˆï¼Œç„¶åå°†è¯¥lambdaä¿å­˜åˆ°<code>std::function</code> ã€‚ </p><br><h3 id="funkciya-send_next_portion">  Send_next_portionå‡½æ•° </h3><br><p> æ¯å½“éœ€è¦å°†å“åº”çš„ä¸‹ä¸€éƒ¨åˆ†å‘é€ç»™å®¢æˆ·ç«¯æ—¶ï¼Œ <code>send_next_portion</code>è°ƒç”¨<code>send_next_portion</code>å‡½æ•°ã€‚ å®ƒæ²¡æœ‰å¤æ‚çš„äº‹æƒ…å‘ç”Ÿï¼Œå› æ­¤çœ‹èµ·æ¥éå¸¸ç®€æ´ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_next_portion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(response_data_shptr data)</span></span></span><span class="hljs-function"> </span></span>{ data-&gt;response_.append_chunk(make_buffer(data-&gt;chunk_size_)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-number"><span class="hljs-number">1u</span></span> == data-&gt;counter_) { data-&gt;response_.flush(); data-&gt;response_.done(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { data-&gt;counter_ -= <span class="hljs-number"><span class="hljs-number">1u</span></span>; data-&gt;response_.flush(make_done_handler(data)); } }</code> </pre> <br><p> å³ å‘é€ä¸‹ä¸€éƒ¨åˆ†ã€‚ å¹¶ä¸”ï¼Œå¦‚æœè¿™éƒ¨åˆ†æ˜¯æœ€åä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å®Œæˆè¯·æ±‚çš„å¤„ç†ã€‚ å¦‚æœä¸æ˜¯åè€…ï¼Œåˆ™å°†<code>flush</code>ç¨‹åºå‘é€åˆ°<code>flush</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯èƒ½æ˜¯ç”±æœ¬ç¤ºä¾‹ä¸­æœ€å¤æ‚çš„å‡½æ•°åˆ›å»ºçš„ã€‚ </p><br><h3 id="funkciya-make_done_handler"> å‡½æ•°make_done_handler </h3><br><p>  <code>make_done_handler</code>å‡½æ•°è´Ÿè´£åˆ›å»ºä¸€ä¸ªlambdaï¼Œè¯¥lambdaå°†ä½œä¸ºå†™åé€šçŸ¥ç¨‹åºä¼ é€’ç»™RESTinioã€‚ è¯¥é€šçŸ¥è€…åº”æ£€æŸ¥å“åº”çš„ä¸‹ä¸€éƒ¨åˆ†çš„è®°å½•æ˜¯å¦æˆåŠŸå®Œæˆã€‚ å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦å¼„æ¸…æ¥šæ˜¯å¦åº”è¯¥ç«‹å³å‘é€ä¸‹ä¸€éƒ¨åˆ†ï¼ˆå³ï¼Œå¥—æ¥å­—ä¸­æœ‰â€œåˆ¹è½¦â€å¹¶ä¸”æ— æ³•ä¿æŒå‘é€é€Ÿç‡ï¼‰æˆ–æš‚åœä¹‹åã€‚ å¦‚æœæ‚¨éœ€è¦æš‚åœï¼Œåˆ™å¯ä»¥é€šè¿‡ç¿˜èµ·è®¡æ—¶å™¨æ¥æä¾›ã€‚ </p><br><p> é€šå¸¸ï¼Œæ“ä½œå¾ˆç®€å•ï¼Œä½†æ˜¯ä»£ç ä¼šåœ¨lambdaå†…éƒ¨ç”Ÿæˆlambdaï¼Œè¿™ä¼šä½¿é‚£äº›ä¸ä¹ æƒ¯â€œç°ä»£â€ C ++çš„äººæ„Ÿåˆ°å›°æƒ‘ã€‚ å¯ä»¥è¿™ä¹ˆçŸ­çš„å‡ å¹´æ‰ç®—æ˜¯ç°ä»£ï¼›ï¼‰ </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_done_handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(response_data_shptr data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> next_timepoint = steady_clock::now() + <span class="hljs-number"><span class="hljs-number">1</span></span>s; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [=](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp; ec) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!ec) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> now = steady_clock::now(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(now &lt; next_timepoint) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> timer = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt;asio_ns::steady_timer&gt;(data-&gt;io_ctx_); timer-&gt;expires_after(next_timepoint - now); timer-&gt;async_wait([timer, data](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp; ec) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!ec) send_next_portion(data); }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> data-&gt;io_ctx_.post([data] { send_next_portion(data); }); } }; }</code> </pre> <br><p> æˆ‘è®¤ä¸ºï¼Œè¯¥ä»£ç çš„ä¸»è¦å›°éš¾åœ¨äºAsioä¸­è®¡æ—¶å™¨çš„åˆ›å»ºå’Œæ’çš„ç‰¹æ®Šæ€§ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œäº‹å®è¯æ˜å®ƒå¤ªå†—é•¿äº†ã€‚ ä½†æ˜¯ç¡®å®å­˜åœ¨ã€‚ ä½†æ˜¯æ‚¨ä¸éœ€è¦å¸å¼•ä»»ä½•å…¶ä»–åº“ã€‚ </p><br><h2 id="podklyuchenie-express-like-routera"> è¿æ¥ç±»ä¼¼å¿«é€’çš„è·¯ç”±å™¨ </h2><br><p> ä¸Šé¢æ˜¾ç¤ºçš„<code>request_processor</code> ï¼Œ <code>send_next_portion</code>å’Œ<code>make_done_handler</code> <code>send_next_portion</code>æ„æˆäº†æˆ‘çš„æµ‹è¯•æœåŠ¡å™¨çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®é™…ä¸Šæ˜¯åœ¨15æˆ–20åˆ†é’Ÿå†…ç¼–å†™çš„ã€‚ </p><br><p> ä½†æ˜¯ä½¿ç”¨è¯¥æµ‹è¯•æœåŠ¡å™¨å‡ å¤©åï¼Œå‘ç°å…¶ä¸­å­˜åœ¨ä¸€ä¸ªä¸¥é‡çš„ç¼ºç‚¹ï¼šå®ƒå§‹ç»ˆä»¥ç›¸åŒçš„é€Ÿåº¦è¿”å›å“åº”æµã€‚ ç¼–è¯‘é€Ÿåº¦ä¸º512KiB /ç§’-æä¾›æ‰€æœ‰512KiB /ç§’ã€‚ ä»¥20KiB /ç§’çš„é€Ÿåº¦é‡æ–°ç¼–è¯‘-å°†ä¸ºæ‰€æœ‰äººæä¾›20KiB /ç§’çš„é€Ÿåº¦ã€‚ ä»€ä¹ˆä¸æ–¹ä¾¿ï¼Œå› ä¸º å¿…é¡»èƒ½å¤Ÿæ¥æ”¶ä¸åŒâ€œåšåº¦â€çš„ç­”æ¡ˆã€‚ </p><br><p> ç„¶åè¿™ä¸ªæƒ³æ³•æµ®å‡ºæ°´é¢ï¼šå¦‚æœç›´æ¥åœ¨URLä¸­è¯·æ±‚è¿”å›é€Ÿåº¦æ€ä¹ˆåŠï¼Ÿ ä¾‹å¦‚ï¼Œä»–ä»¬å‘<code>localhost:8080/</code>å‘å‡ºè¯·æ±‚<code>localhost:8080/</code>å¹¶ä»¥é¢„å®šé€Ÿåº¦æ”¶åˆ°å“åº”ã€‚ å¦‚æœæ‚¨å‘<code>localhost:8080/128K</code>å‘å‡ºè¯·æ±‚<code>localhost:8080/128K</code> ï¼Œåˆ™å®ƒä»¬å¼€å§‹ä»¥128KiB /ç§’çš„é€Ÿåº¦æ¥æ”¶å“åº”ã€‚ </p><br><p> ç„¶åæƒ³æ³•å°±æ›´è¿›ä¸€æ­¥äº†ï¼šåœ¨URLä¸­ï¼Œæ‚¨è¿˜å¯ä»¥æŒ‡å®šå“åº”ä¸­å„ä¸ªéƒ¨åˆ†çš„æ•°é‡ã€‚ å³  <code>localhost:8080/128K/3000</code>è¯·æ±‚<code>localhost:8080/128K/3000</code>å°†ä»¥128KiB / secçš„é€Ÿåº¦ç”Ÿæˆ3000ä¸ªéƒ¨åˆ†çš„æµã€‚ </p><br><p> æ²¡é—®é¢˜  RESTinioå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨ExpressJSçš„å½±å“ä¸‹åˆ¶é€ </a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŸ¥è¯¢è·¯ç”±å™¨</a> ã€‚ ç»“æœï¼Œæœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°æ¥æè¿°ä¼ å…¥çš„HTTPè¯·æ±‚çš„å¤„ç†ç¨‹åºï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_router</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(asio_ns::io_context &amp; ctx)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> router = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_unique&lt;<span class="hljs-keyword"><span class="hljs-keyword">router_t</span></span>&gt;(); router-&gt;http_get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, [&amp;ctx](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req, <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>) { request_processor(ctx, <span class="hljs-number"><span class="hljs-number">100u</span></span>*<span class="hljs-number"><span class="hljs-number">1024u</span></span>, <span class="hljs-number"><span class="hljs-number">10000u</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(req)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> restinio::request_accepted(); }); router-&gt;http_get( <span class="hljs-string"><span class="hljs-string">R"(/:value(\d+):multiplier([MmKkBb]?))"</span></span>, [&amp;ctx](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req, <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> params) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> chunk_size = extract_chunk_size(params); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-number"><span class="hljs-number">0u</span></span> != chunk_size) { request_processor(ctx, chunk_size, <span class="hljs-number"><span class="hljs-number">10000u</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(req)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> restinio::request_accepted(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> restinio::request_rejected(); }); router-&gt;http_get( <span class="hljs-string"><span class="hljs-string">R"(/:value(\d+):multiplier([MmKkBb]?)/:count(\d+))"</span></span>, [&amp;ctx](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req, <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> params) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> chunk_size = extract_chunk_size(params); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> count = restinio::cast_to&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>&gt;(params[<span class="hljs-string"><span class="hljs-string">"count"</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-number"><span class="hljs-number">0u</span></span> != chunk_size &amp;&amp; <span class="hljs-number"><span class="hljs-number">0u</span></span> != count) { request_processor(ctx, chunk_size, count, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(req)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> restinio::request_accepted(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> restinio::request_rejected(); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> router; }</code> </pre> <br><p> è¿™é‡Œï¼ŒHTTP GETè¯·æ±‚å¤„ç†ç¨‹åºé’ˆå¯¹ä¸‰ç§ç±»å‹çš„URLå½¢æˆï¼š </p><br><ul><li> å½¢å¼ä¸º<code>http://localhost/</code> ; </li><li> æ ¼å¼ä¸º<code>http://localhost/&lt;speed&gt;[&lt;U&gt;]/</code> ; </li><li> å½¢å¼ä¸º<code>http://localhost/&lt;speed&gt;[&lt;U&gt;]/&lt;count&gt;/</code> </li></ul><br><p> å…¶ä¸­<code>speed</code>æ˜¯ä¸€ä¸ªå®šä¹‰é€Ÿåº¦çš„æ•°å­—ï¼Œ <code>U</code>æ˜¯ä¸€ä¸ªå¯é€‰çš„ä¹˜æ•°ï¼Œç”¨äºæŒ‡ç¤ºä»¥å“ªç§å•ä½è®¾ç½®é€Ÿåº¦ã€‚ å› æ­¤<code>128</code>æˆ–<code>128b</code>è¡¨ç¤ºæ¯ç§’128å­—èŠ‚çš„é€Ÿåº¦ã€‚  <code>128k</code>æ˜¯æ¯ç§’128 KBã€‚ </p><br><p> æ¯ä¸ªURLéƒ½æœ‰è‡ªå·±çš„lambdaå‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥ç†è§£æ¥æ”¶çš„å‚æ•°ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå®ƒå°†è°ƒç”¨ä¸Šé¢æ˜¾ç¤ºçš„<code>request_processor</code>å‡½æ•°ã€‚ </p><br><p> è¾…åŠ©å‡½æ•°<code>extract_chunk_size</code>å¦‚ä¸‹ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> extract_chunk_size(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> restinio::router::<span class="hljs-keyword"><span class="hljs-keyword">route_params_t</span></span> &amp; params) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> multiplier = [](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> sv) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sv.empty() || <span class="hljs-string"><span class="hljs-string">"B"</span></span> == sv || <span class="hljs-string"><span class="hljs-string">"b"</span></span> == sv) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1u</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-string"><span class="hljs-string">"K"</span></span> == sv || <span class="hljs-string"><span class="hljs-string">"k"</span></span> == sv) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1024u</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1024u</span></span>*<span class="hljs-number"><span class="hljs-number">1024u</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> restinio::cast_to&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>&gt;(params[<span class="hljs-string"><span class="hljs-string">"value"</span></span>]) * multiplier(params[<span class="hljs-string"><span class="hljs-string">"multiplier"</span></span>]); }</code> </pre> <br><p> åœ¨è¿™é‡Œï¼ŒC ++ lambdaç”¨äºä»å…¶ä»–ç¼–ç¨‹è¯­è¨€æ¨¡æ‹Ÿæœ¬åœ°å‡½æ•°ã€‚ </p><br><h2 id="funkciya-main"> ä¸»è¦åŠŸèƒ½ </h2><br><p> å‰©ä¸‹çš„è¦çœ‹æ‰€æœ‰è¿™äº›å¦‚ä½•åœ¨mainå‡½æ•°ä¸­è¿è¡Œï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">router_t</span></span> = restinio::router::<span class="hljs-keyword"><span class="hljs-keyword">express_router_t</span></span>&lt;&gt;; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">traits_t</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> restinio::<span class="hljs-keyword"><span class="hljs-keyword">default_single_thread_traits_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">logger_t</span></span> = restinio::<span class="hljs-keyword"><span class="hljs-keyword">single_threaded_ostream_logger_t</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">request_handler_t</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">router_t</span></span>; }; asio_ns::io_context io_ctx; restinio::run( io_ctx, restinio::on_this_thread&lt;<span class="hljs-keyword"><span class="hljs-keyword">traits_t</span></span>&gt;() .port(<span class="hljs-number"><span class="hljs-number">8080</span></span>) .address(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>) .write_http_response_timelimit(<span class="hljs-number"><span class="hljs-number">60</span></span>s) .request_handler(make_router(io_ctx))); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p> è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼š </p><br><ol><li> ç”±äºæˆ‘ä¸éœ€è¦æ™®é€šçš„å¸¸è§„è¯·æ±‚è·¯ç”±å™¨ï¼ˆæ ¹æœ¬æ— æ³•æ‰§è¡Œä»»ä½•æ“ä½œï¼Œè€Œå°†æ‰€æœ‰å·¥ä½œéƒ½äº¤ç»™äº†ç¨‹åºå‘˜ï¼‰ï¼Œå› æ­¤ï¼Œæˆ‘ä¸ºHTTPæœåŠ¡å™¨å®šä¹‰äº†æ–°å±æ€§ã€‚ ä¸ºæ­¤ï¼Œæˆ‘é‡‡ç”¨äº†å•çº¿ç¨‹HTTPæœåŠ¡å™¨çš„æ ‡å‡†å±æ€§ï¼ˆç±»å‹<code>restinio::default_single_thread_traits_t</code> ï¼‰ï¼Œå¹¶æŒ‡å‡ºå°†ç±»ä¼¼expressçš„è·¯ç”±å™¨çš„å®ä¾‹ç”¨ä½œè¯·æ±‚å¤„ç†ç¨‹åºã€‚ åŒæ—¶ï¼Œä¸ºäº†æ§åˆ¶å†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œæˆ‘æŒ‡å‡ºHTTPæœåŠ¡å™¨ä½¿ç”¨äº†çœŸæ­£çš„è®°å½•å™¨ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>null_logger_t</code>æ ¹æœ¬ä¸è®°å½•ä»»ä½•å†…å®¹ï¼‰ã€‚ </li><li> ç”±äºæˆ‘éœ€è¦åœ¨å†™å…¥åé€šçŸ¥ç¨‹åºä¸­è®¾ç½®è®¡æ—¶å™¨ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„io_contextå®ä¾‹ã€‚ å› æ­¤ï¼Œæˆ‘è‡ªå·±åˆ›å»ºå®ƒã€‚ è¿™ä½¿æˆ‘æœ‰æœºä¼šåœ¨<code>make_router</code>å‡½æ•°ä¸­ä¼ é€’æŒ‡å‘æˆ‘çš„io_contextçš„é“¾æ¥ã€‚ </li><li> ä»…ä¿ç•™åœ¨æˆ‘å…ˆå‰åˆ›å»ºçš„io_contextä¸Šä»¥å•çº¿ç¨‹ç‰ˆæœ¬å¯åŠ¨HTTPæœåŠ¡å™¨ã€‚  <code>restinio::run</code>å‡½æ•°ä»…åœ¨HTTPæœåŠ¡å™¨å®Œæˆå…¶å·¥ä½œæ—¶æ‰è¿”å›æ§åˆ¶ã€‚ </li></ol><br><h1 id="zaklyuchenie"> ç»“è®º </h1><br><p> æœ¬æ–‡æœªæ˜¾ç¤ºæµ‹è¯•æœåŠ¡å™¨çš„å®Œæ•´ä»£ç ï¼Œä»…æ˜¾ç¤ºäº†å…¶è¦ç‚¹ã€‚ å®Œæ•´çš„ä»£ç ï¼Œç”±äºé™„åŠ çš„typedefå’Œè¾…åŠ©åŠŸèƒ½è€Œç¨å¤§ä¸€äº›ï¼Œå› æ­¤æ›´å…·çœŸå®æ€§ã€‚ ä½ å¯ä»¥<a href="">åœ¨è¿™é‡Œ</a>çœ‹åˆ°å®ƒã€‚ åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œè¿™æ˜¯185è¡Œï¼ŒåŒ…æ‹¬ç©ºç™½è¡Œå’Œæ³¨é‡Šã€‚ å—¯ï¼Œè¿™185è¡Œæ˜¯ç”¨å‡ ç§æ–¹æ³•ç¼–å†™çš„ï¼Œæ€»æŒç»­æ—¶é—´å‡ ä¹ä¸è¶…è¿‡ä¸€ä¸ªå°æ—¶ã€‚ </p><br><p> æˆ‘å–œæ¬¢è¿™ä¸ªç»“æœï¼Œä»»åŠ¡å¾ˆæœ‰è¶£ã€‚ å®é™…ä¸Šï¼Œæˆ‘æ‰€éœ€è¦çš„è¾…åŠ©å·¥å…·å¾ˆå¿«å°±å¾—åˆ°äº†ã€‚ åœ¨RESTinioçš„è¿›ä¸€æ­¥å‘å±•æ–¹é¢ï¼Œå‡ºç°äº†ä¸€äº›æƒ³æ³•ã€‚ </p><br><p> é€šå¸¸ï¼Œå¦‚æœå…¶ä»–äººè¿˜æ²¡æœ‰å°è¯•è¿‡RESTinioï¼Œé‚£ä¹ˆæˆ‘é‚€è¯·æ‚¨å°è¯•ã€‚ è¯¥é¡¹ç›®æœ¬èº«ä½äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Š</a> ã€‚ æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Googleç½‘ä¸Šè®ºå›</a>æˆ–è¯„è®ºä¸­æå‡ºé—®é¢˜æˆ–è¡¨è¾¾æ‚¨çš„å»ºè®®ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN462349/">https://habr.com/ru/post/zh-CN462349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN462333/index.html">åœ¨pythonä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯¹è¯èŠå¤©æœºå™¨äºº</a></li>
<li><a href="../zh-CN462335/index.html">ä¸é˜…è¯»ï¼Œé‡æ–°é˜…è¯»</a></li>
<li><a href="../zh-CN462337/index.html">ç½‘ç«™ç»Ÿè®¡ä¿¡æ¯å’Œæ‚¨çš„å°å‹å­˜å‚¨åº“</a></li>
<li><a href="../zh-CN462339/index.html">æ‰‹æŒåŸ¹è®­ä¸äºšé©¬é€Šçš„å†…éƒ¨æ ‡å‡†æœ‰ä½•å…³ç³»ï¼Œå¯¹äºšé©¬é€Šçš„ä¸–ç•Œè§‚æœ‰ä½•å½±å“ï¼Ÿ</a></li>
<li><a href="../zh-CN462347/index.html">ä»çŒ«å¤´é¹°åˆ°æ—©é¸Ÿçš„å‰åå¤©ï¼šç¡çœ ï¼Œé¥®é£Ÿï¼Œé¥®é£Ÿå’Œè¿åŠ¨</a></li>
<li><a href="../zh-CN462353/index.html">LoRaWANåè®®å®‰å…¨æ€§å¸¸è§é—®é¢˜è§£ç­”</a></li>
<li><a href="../zh-CN462355/index.html">å¼‚æ­¥JavaScriptç¼–ç¨‹ï¼ˆå›è°ƒï¼ŒPromiseï¼ŒRxJsï¼‰</a></li>
<li><a href="../zh-CN462357/index.html">ç¬¬ä¸€ä¸ªåŸå‹ï¼šUnikernelsä½œä¸ºLinuxæ¼”è¿›çš„ä¸€ä¸ªé˜¶æ®µ</a></li>
<li><a href="../zh-CN462359/index.html">Dat-å®ƒæ˜¯ä»€ä¹ˆåè®®ï¼Œè°ä½¿ç”¨å®ƒ</a></li>
<li><a href="../zh-CN462365/index.html">æœºå™¨å­¦ä¹ çš„å±€é™æ€§</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>