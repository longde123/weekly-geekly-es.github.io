<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌬️ 🏒 🌙 Tout le monde gronde les cadres de test auto-écrits. Et nous sommes satisfaits de notre ➖ ⛄️ 📀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je m'appelle Elena Rastorgueva, je suis responsable du produit Factor chez HFLabs . The Factor est une entreprise algorithmique extrêmement complexe q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tout le monde gronde les cadres de test auto-écrits. Et nous sommes satisfaits de notre</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hflabs/blog/437380/"><img src="https://habrastorage.org/webt/nt/p-/0f/ntp-0fxrjpsarus7awbwtsdgdhu.jpeg"><br><br>  Je m'appelle Elena Rastorgueva, je suis responsable du produit Factor chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HFLabs</a> .  The Factor est une entreprise algorithmique extrêmement complexe qui traite des données à l'échelle industrielle. <br><br>  Dans l'article, je vais vous expliquer comment nous avons commencé à tester le «Factor», comment les autotests ont été développés et pourquoi nous sommes arrivés aux frameworks auto-écrits. <br><a name="habracut"></a><br><h2>  De quel type de produit s'agit-il - «Facteur» </h2><br>  "Factor" nettoie les données dans des bases de données avec des millions de clients: supprime les fautes de frappe dans le nom, le téléphone et l'e-mail, vérifie les passeports, fait beaucoup plus.  Le plus difficile est de corriger les adresses postales. <br><br><img src="https://habrastorage.org/webt/sc/le/g8/scleg8hmrcclix90ouwukypheke.png"><br>  <sub>Les adresses sont écrites de centaines de façons, donc le Facteur a un puissant appareil algorithmique sous le capot</sub> <br><br>  "Factor" fonctionne comme un service: données d'entrée - données de sortie. <br><br>  Il s'agit d'un système sans état où chaque appel est indépendant des précédents.  L'apatridie simplifie considérablement la vie du testeur.  Il est beaucoup plus difficile de tester un système avec état lorsqu'une séquence d'actions est importante. <br><br>  Le produit doit être fiable comme l'ISS, car il est utilisé par les banques, les opérateurs mobiles, les assurances et les détaillants de niveau Lenta.  Nous répondons des erreurs de notre tête dans la mesure où l'absence d'erreurs fait partie du SLA dans le contrat avec le client. <br><br>  En raison des exigences de fiabilité des autotests, nous avons écrit dès le début du développement.  L'un des critères de préparation de la tâche est «Ajout d'autotests». <br><br><h2>  Commencé par des vérifications manuelles et des autotests </h2><br>  Nous avons lancé le Factor en 2005 et l'avons d'abord testé avec nos mains.  Le matin, le testeur a effectué des autotests sur un fichier contenant des cas et a comparé le résultat du traitement des données avec le résultat de la veille: ce qui a changé après la validation du code d'hier. <br><br>  Le processus pouvait prendre une demi-journée, cet alignement n'était pas bon.  Par conséquent, nous avons pris l'ensemble minimal de tests pour la fonctionnalité clé et enveloppé dans des tests unitaires.  Ces tests sont rapides et le développeur lui-même les a exécutés avant de s'engager. <br><br>  Les tests unitaires sont si pratiques et si rapides que nous en avons ajouté des milliers.  Et puis nous sommes tombés dessus: lorsque les tests ressemblent à une feuille de milliers de morceaux de code, il n'est même pas facile de faire défiler jusqu'au bon endroit.  Sans parler de l'ajout ou de la mise à jour. <br><br><img src="https://habrastorage.org/webt/vd/a5/ua/vda5uatnzsl6du95r_x_jjbpsle.png"><br>  <sub>Test unitaire pour vérifier le format SNILS</sub> <br><br>  De plus, quelque chose d'inattendu apparaît soudain dans les données industrielles qui ne couvre pas les tests unitaires.  Par exemple, un nouveau client est venu avec de nouvelles fonctionnalités dans les adresses, les tests unitaires ne couvrent pas ces fonctionnalités.  Vous devez vous asseoir et voir quels tests ajouter pour de nouvelles données.  Nous l'avons toujours fait manuellement. <br><br><h2>  Créez votre propre framework </h2><br>  Dans les tests unitaires traditionnels, les données et le code sont mélangés; il est difficile de trouver les bonnes pièces. <br><br>  Par conséquent, nous avons essayé les autotests dans le paradigme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DDT (Data Driven Testing)</a> .  DDT est lorsque les données de test sont stockées séparément du code de test. <br><br>  Les cas ont été chargés à partir d'un fichier Excel, ils se trouvaient dans les colonnes «Données brutes» et «Résultat attendu».  Le DDT a été une percée: la mise à jour des cas dans "l'exelnik" est inexplicablement plus simple. <br><br>  Petit à petit, nous avons développé une approche et développé notre propre framework de test.  Il reçoit des fichiers texte en entrée, à l'intérieur d'eux se trouvent les données source et le résultat attendu. <br><br><img src="https://habrastorage.org/webt/4z/ux/b2/4zuxb2hzdkjzampel0ioln9qksa.png"><br>  <sub>Nous avons refusé les fichiers Excel comme stockage: les fichiers texte s'ouvrent plus rapidement, ne modifient pas le contenu, il est plus facile de collecter des données à partir d'eux</sub> <br><br>  Le cadre est aidé par des outils standard: <br><br><ul><li>  TeamCity exécute automatiquement des tests tous les soirs; </li><li>  testNG compare les résultats attendus et réels. </li></ul><br><img src="https://habrastorage.org/webt/js/3p/3x/js3p3xatz9q9u7qhd1hk7ahinfq.png"><br>  <sub>Si le résultat est différent de celui attendu, dans TeamCity le test rougit.</sub>  <sub>Si tout est comme il se doit, le test est vert</sub> <br><br><h2>  Vous avez modifié le cadre pour vous-même </h2><br>  12 ans se sont écoulés depuis.  Pendant ce temps, le cadre a envahi des capacités qui ne sont pas dans les solutions standard. <br><br>  <b>Comptabilisation de l'état des tâches dans Jira.</b>  HFLabs adhère au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">développement piloté par les tests</a> : nous écrivons d'abord un test ou ajoutons des cas de test pour de nouveaux comportements, puis nous modifions ensuite les fonctionnalités. <br><br>  Nous avons désactivé de nouveaux cas en commentant la ligne.  Sinon, ils sont d'abord tombés et sont intervenus, car les cas ont ajouté des fonctionnalités ou des corrections de bugs auparavant. <br><br>  Mais la tâche peut ne pas être en mesure de terminer le cas de test correspondant: le bogue se révélera extrêmement rare ou le client apportera quelque chose de plus important.  Certaines tâches ont été suspendues pendant des mois avec une faible priorité et des cas déconnectés se sont accumulés.  Dans le même temps, il n'est pas clair à quelle tâche appartient chaque cas, si ce cas peut être supprimé. <br><br>  Par conséquent, nous avons ajouté un numéro de tâche aux cas déconnectés et gâché un peu d'automatisation.  Maintenant, tout fonctionne comme ceci: <br><br><ul><li>  le scénario de test est désactivé en le faisant correspondre à une tâche ouverte dans Jira; <br><br><img src="https://habrastorage.org/webt/ny/xd/rb/nyxdrbvmz4np0kkgjgn5srct-cw.png"><br>  <sub>Pour joindre un cas à une tâche, écrivez devant celui-ci <i>#</i> et le numéro de tâche</sub> <br></li><li>  le framework exécute des tests même sur les cas désactivés.  Mais ignore les plantages lorsque la tâche est ouverte dans Jira; </li><li>  dès que la tâche est close, le test commence à tomber sur les cas qui lui sont attachés.  C'est un signal: ils ont réussi la tâche, mais ont oublié d'activer les boîtiers; </li><li>  si tout à coup le test du cas déconnecté a commencé à passer avec une tâche ouverte, le framework en informera également.  Il est peut-être temps d'activer le boîtier ou de fermer la tâche qui lui est associée (ainsi que de mettre à jour les notes de publication et d'informer les clients). <br><br><img src="https://habrastorage.org/webt/ah/eb/vt/ahebvthx1cfsge12a5ofyjms408.png"><br>  <sub>Le cadre dit que l'affaire déconnectée est en cours.</sub>  <sub>Peut-être que quelqu'un a corrigé le code dans le cadre d'une autre tâche, et maintenant tout fonctionne</sub> <br></li></ul><br>  Nous avons donc sauvé TDD et vaincu l'oubli lors de la gestion des cas de test. <br><br><img src="https://habrastorage.org/webt/8s/df/1w/8sdf1wf1xib-di08-upv-njfwd8.png"><br>  <sub>Nous avons documenté toutes les options avec l'état des cas de test et des tâches associées, afin de ne pas oublier</sub> <br><br>  <b>Mise à jour des cas de test en mode semi-automatique.</b>  Il semblerait que si le test se bloque, recherchez une erreur dans le code.  Mais pour nous, ce n'est pas toujours le cas.  Il arrive parfois que les cas de test doivent être mis à jour, car les exigences pour le résultat ont changé. <br><br>  Par exemple, avant que le client de l'adresse effacée ne souhaite "g.  Moscou »dans un domaine.  Maintenant qu'il a changé l'architecture de la base de données, il veut la "ville" dans un domaine, "Moscou" dans un autre.  Il est temps de changer les cas de test. <br><br>  Pour le test tombé, TeamCity montre la différence entre les résultats attendus et réels.  Auparavant, nous avons copié cette différence et mis à jour les cas de test avec nos mains.  Pour des changements massifs - un événement très coûteux. <br><br><img src="https://habrastorage.org/webt/2g/cv/iu/2gcviu56ac4pgtbtb3me4k5cc_0.png"><br>  <sub>Un exemple vivant: nous avons appris «Factor» pour déterminer un pays par numéro de téléphone, les tests dans TeamCity sont tombés.</sub>  <sub>Un nouveau repère peut être tiré du résultat réel, mais cela prend beaucoup de temps</sub> <br><br>  Nous avons fait la mise à jour du cadre de référence lui-même.  Pour ce faire, après avoir exécuté les tests, il remplace les résultats de nettoyage attendus dans la norme par ceux réels où ils ne correspondaient pas.  Le résultat est enregistré dans des artefacts en tant que fichier de mise à jour de cas. <br><br><img src="https://habrastorage.org/webt/6e/ok/dp/6eokdpdk8hqlbsggw2e2zxsyxty.png"><br>  <sub>Le premier fichier est une nouvelle référence dans laquelle le cadre a mis à jour les résultats attendus.</sub>  <sub>Les fichiers restants sont les données d'entrée, l'ancienne norme et les données réelles pour les cas abandonnés.</sub> <br><br>  Avec la nouvelle référence, le testeur met à jour les cas en trois étapes. <br><br><ol><li>  Téléchargez le fichier généré. </li><li>  Vérifie à travers n'importe quel outil de fusion quels changements sont dans le nouveau benchmark.  Ne laisse que le nécessaire. </li><li>  Valider </li></ol><br><img src="https://habrastorage.org/webt/wp/o8/xn/wpo8xnrbcyzdhqkbif0mafezhbs.png"><br>  <sub>Le testeur vérifie si les mises à jour de la nouvelle norme sont correctes et les valide</sub> <br><br>  Oui, s'il est mis à jour irréfléchi, rien de bon n'en sortira.  Mais il existe un risque de mise à jour irréfléchie lorsque vous travaillez manuellement. <br><br>  <b>Stabilisation des données de test avec des talons.</b>  "Factor" renvoie les données traitées dans des dizaines de champs.  Il y a un tas de composants dans une seule adresse: index, région, type de région, type de ville, ville, type de rue, maison, bâtiment, bâtiment, appartement.  Pour eux, le «Facteur» attrape IFTS, OKATO, OKTMO et même les petites choses.  Donc, à partir d'une ligne à l'entrée, des dizaines de valeurs sont obtenues. <br><br>  Tous les champs du résultat ne doivent pas être vérifiés avec des cas de test.  Par exemple, la reconnaissance de la même adresse dépend directement du répertoire d'état - FIAS.  Et en elle, les domaines changent régulièrement, pour nos tâches ils sont complètement étrangers.  La mise à jour de certains codes CLADR pour les maisons a supprimé des centaines de cas de test. <br><br>  Nous avons ajouté des talons au résultat attendu lorsque nous avons réalisé que nous perdions notre temps à analyser des chutes sans importance. <br><br>  Lorsque le champ n'a pas du tout besoin d'être vérifié, le testeur écrit un symbole dans le résultat attendu: <i>$$ DNV $$</i> .  Quand le champ doit être rempli, mais la valeur elle-même n'est pas importante: <i>$$ NE $$</i> . <br><br><img src="https://habrastorage.org/webt/ol/v6/e_/olv6e_wixlpjexljoquxpcgo4l8.png"><br>  <sub>L'ID FIAS est toujours dans l'adresse, nous le vérifions donc lors de tous les tests.</sub>  <sub>Si le champ est vide, quelque chose ne va pas.</sub>  <sub>Mais l'index peut ne pas l'être, par conséquent, lors de la vérification de l'ID FIAS, nous ignorons l'index</sub> <br><br>  Vous pouvez aller dans l'autre sens et séparer les tests: chaque champ a le sien.  Mais c'est difficile, car tout ne peut pas être isolé.  Par exemple, «ville» et «rue» font partie d'une adresse et sans elles n'ont aucun sens. <br><br><h2>  Un cadre auto-écrit est plus pratique </h2><br>  Par conséquent, je ne considère pas du tout la création de mon propre cadre comme une entreprise stupide.  Si nous n'avions pas créé notre propre outil, nous n'aurions pas reçu autant de nouvelles opportunités et une telle flexibilité. <br><br>  Désactiver le casse de texte par statut de tâche, générer un nouveau test de référence et des talons pour le résultat sont les choses que nos testeurs demandent maintenant dans d'autres cadres.  Si nous prenions des solutions standard, nous ne pourrions jamais le faire. <br><br>  <i>Si vous aimez faire des choses complexes en entreprise, venez chez nous.</i>  <i>Maintenant, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nous recherchons un développeur Java</a> , salaire de 135 000 ₽ sans impôt sur le revenu des particuliers.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437380/">https://habr.com/ru/post/fr437380/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437368/index.html">MOSDROID # 15 Phosphore</a></li>
<li><a href="../fr437372/index.html">Trois astuces simples pour réduire les images de docker</a></li>
<li><a href="../fr437374/index.html">Les utilisateurs de Facebook louent leurs comptes avec de l'argent et des ordinateurs portables gratuits</a></li>
<li><a href="../fr437376/index.html">Curieuses perversions du monde de l'informatique - 2</a></li>
<li><a href="../fr437378/index.html">Qu'est-ce que ARCore? Tout ce que vous devez savoir</a></li>
<li><a href="../fr437382/index.html">Théorie des feux d'artifice. Fantaisie cosmologique</a></li>
<li><a href="../fr437384/index.html">Le ministère du Travail et Rostelecom ont divergé dans l'évaluation du nombre de fonctionnaires qui recevront des smartphones sur l'OS Sailfish national</a></li>
<li><a href="../fr437386/index.html">Entretiens - Interviewer Look</a></li>
<li><a href="../fr437390/index.html">DPAPI "Secrets". Regardez l'âne</a></li>
<li><a href="../fr437396/index.html">Pourquoi CarPrice est-il piloté par l'intelligence artificielle?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>