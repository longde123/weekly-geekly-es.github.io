<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂üèΩ üéÅ üë®‚ÄçüöÄ Descomponiendo una UICollectionViewCell üç± üßõüèæ üë©üèæ‚Äçü§ù‚Äçüë®üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despu√©s de ver Keynote WWDC 2019 y conocer SwiftUI , que est√° dise√±ado para describir declarativamente las IU en el c√≥digo, quiero especular sobre c√≥m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Descomponiendo una UICollectionViewCell</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455421/"><p>  Despu√©s de ver Keynote WWDC 2019 y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conocer SwiftUI</a> , que est√° dise√±ado para describir declarativamente las IU en el c√≥digo, quiero especular sobre c√≥mo llenar declarativamente tabletas y colecciones.  Por ejemplo, as√≠: </p><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(objects: Objects)</span></span></span></span> -&gt; [<span class="hljs-type"><span class="hljs-type">Widget</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> header = [ <span class="hljs-type"><span class="hljs-type">Spacing</span></span>(height: <span class="hljs-number"><span class="hljs-number">25</span></span>).widget, <span class="hljs-type"><span class="hljs-type">Header</span></span>(string: <span class="hljs-string"><span class="hljs-string">" "</span></span>).widget, <span class="hljs-type"><span class="hljs-type">Spacing</span></span>(height: <span class="hljs-number"><span class="hljs-number">10</span></span>, separator: .bottom).widget ] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> body = objects .flatMap({ (object: <span class="hljs-type"><span class="hljs-type">Object</span></span>) -&gt; [<span class="hljs-type"><span class="hljs-type">Widgets</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-type"><span class="hljs-type">Title</span></span>(object: object).widget, <span class="hljs-type"><span class="hljs-type">Spacing</span></span>(height: <span class="hljs-number"><span class="hljs-number">1</span></span>, separator: .bottom).widget ] }) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> header + body } } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> objects: [<span class="hljs-type"><span class="hljs-type">Object</span></span>] = ... <span class="hljs-type"><span class="hljs-type">Builder</span></span> .widgets(objects: objects) .bind(to: collectionView)</code> </pre> <br><p>  En la colecci√≥n, esto se representa de la siguiente manera: <a name="habracut"></a></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/el/r0/bp/elr0bpuqgbgcm5unfprets9_woc.png" alt="imagen"></div><p></p><br><h1 id="vvedenie">  Introduccion </h1><br><p>  Como saben por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fuentes autorizadas</a> : la gran mayor√≠a de su tiempo, un desarrollador t√≠pico de iOS pasa trabajando con tabletas.  Si asumimos que los desarrolladores en el proyecto carecen mucho y las tabletas no son simples, entonces no queda absolutamente ning√∫n tiempo para el resto de la aplicaci√≥n.  Y hay que hacer algo con esto ... Una posible soluci√≥n ser√≠a la descomposici√≥n celular. </p><br><p>  La descomposici√≥n celular significa reemplazar una celda con varias celdas m√°s peque√±as.  Con este reemplazo, visualmente nada deber√≠a cambiar.  Como ejemplo, considere las publicaciones de la fuente de noticias VK para iOS.  Una publicaci√≥n se puede presentar como una sola celda o como un grupo de celdas: <strong>primitivas</strong> . </p><br><p>  Las c√©lulas en descomposici√≥n no siempre funcionar√°n.  Ser√° dif√≠cil dividir una c√©lula en primitivos que tengan una sombra o redondeo en todos los lados.  En este caso, la celda original ser√° una primitiva. </p><br><h1 id="plyusy-i-minusy">  Pros y contras </h1><br><p>  Usando la descomposici√≥n de las celdas, las tablas / colecciones comienzan a consistir en primitivas que a menudo se reutilizar√°n: una primitiva con texto, una primitiva con una imagen, una primitiva con un fondo, etc.  El c√°lculo de la altura de una √∫nica primitiva es mucho m√°s simple y m√°s efectivo que una celda compleja con una gran cantidad de estados.  Si lo desea, la altura din√°mica de la primitiva se puede calcular o incluso dibujar en el fondo (por ejemplo, texto a trav√©s de <code>CTFramesetter</code> ). </p><br><p>  Por otro lado, trabajar con datos se vuelve m√°s complicado.  Se requerir√°n datos para cada primitiva, y de acuerdo con el <code>IndexPath</code> primitiva ser√° dif√≠cil determinar a qu√© celda real pertenece.  Tendremos que introducir nuevas capas de abstracci√≥n o resolver de alguna manera estos problemas. </p><br><p>  Puede hablar durante mucho tiempo sobre los posibles pros y contras de esta empresa, pero es mejor tratar de describir el enfoque de la descomposici√≥n celular. </p><br><h1 id="vybiraem-instrumenty">  Elegir herramientas </h1><br><p>  Como <code>UITableView</code> capacidades limitadas y, como ya se mencion√≥, tenemos placas bastante complejas, una soluci√≥n adecuada ser√≠a usar <code>UICollectionView</code> .  Se trata de <code>UICollectionView</code> que se discutir√° en esta publicaci√≥n. </p><br><p>  Al usar <code>UICollectionView</code> enfrenta a una situaci√≥n en la que <code>UICollectionViewFlowLayout</code> base no puede formar la disposici√≥n deseada de los elementos de la colecci√≥n (no tenemos en cuenta el nuevo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>UICollectionViewCompositionalLayout</code></a> ).  En esos momentos, generalmente se toma la decisi√≥n de encontrar alguna <code>UICollectionViewLayout</code> c√≥digo <code>UICollectionViewLayout</code> .  Pero incluso entre las soluciones preparadas, puede que no haya una adecuada, como, por ejemplo, en el caso de la p√°gina principal din√°mica de una gran tienda en l√≠nea o red social.  Asumimos lo peor, por lo que crearemos nuestra propia <code>UICollectionViewLayout</code> universal. </p><br><p>  Adem√°s de la dificultad de elegir un dise√±o, debe decidir c√≥mo recibir√° los datos la colecci√≥n.  Adem√°s del enfoque habitual, donde un objeto (a menudo un <code>UIViewController</code> ) cumple con el protocolo <code>UICollectionViewDataSource</code> y proporciona datos para una colecci√≥n, el uso de marcos basados ‚Äã‚Äãen datos est√° ganando popularidad.  Los representantes brillantes de este enfoque son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CollectionKit</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IGListKit</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RxDataSources</a> y otros.  El uso de tales marcos simplifica el trabajo con colecciones y proporciona la capacidad de animar cambios de datos, porque  El algoritmo diferente ya est√° presente en el marco.  Para fines de publicaci√≥n, se seleccionar√° el marco <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RxDataSources</a> . </p><br><h1 id="vidzhet-i-ego-svoystva">  Widget y sus propiedades </h1><br><p>  Introducimos una estructura de datos intermedia y la llamamos <strong>widget</strong> .  Describimos las principales propiedades que debe tener un widget: </p><br><ol><li>  El widget debe cumplir con los protocolos necesarios para usar el marco basado en datos.  Tales protocolos suelen contener un valor asociado (por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>IdentifiableType</code></a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RxDataSources</a> ) </li><li>  Deber√≠a ser posible ensamblar widgets para diferentes primitivas en una matriz.  Para lograr esto, el widget no debe tener valores asociados.  Para estos fines, puede utilizar el mecanismo de borrado de tipo o algo as√≠. </li><li>  El widget deber√≠a poder contar el tama√±o de la primitiva.  Luego, al formar el <code>UICollectionViewLayout</code> , solo queda colocar correctamente las primitivas de acuerdo con reglas predefinidas. </li><li>  El widget debe ser la f√°brica para <code>UICollectionViewCell</code> .  Por lo tanto, a partir de la implementaci√≥n de <code>UICollectionViewDataSource</code> toda la l√≥gica para crear celdas y todo lo que queda es: <br><pre> <code class="plaintext hljs">let cell = widget.widgetCell(collectionView: collectionView, indexPath: indexPath) return cell</code> </pre> </li></ol><br><h1 id="realizaciya-vidzheta">  Implementaci√≥n de widgets </h1><br><p>  Para poder utilizar el widget con el marco <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RxDataSources</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">debe cumplir con los protocolos</a> <code>Equatable</code> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>IdentifiableType</code></a> .  Como el widget representa una primitiva, ser√° suficiente para fines de publicaci√≥n si el widget se identifica para cumplir con el protocolo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>IdentifiableType</code></a> .  En la pr√°ctica, esto afectar√° el hecho de que cuando el widget cambia, la primitiva no se volver√° a cargar, sino que se eliminar√° e insertar√°.  Para hacer esto, presente el nuevo protocolo <code>WidgetIdentifiable</code> : </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetIdentifiable</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IdentifiableType</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetIdentifiable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> identity: <span class="hljs-type"><span class="hljs-type">Self</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } }</code> </pre> <br><p>  Para cumplir con el <code>WidgetIdentifiable</code> , el widget debe cumplir con el protocolo <code>Hashable</code> .  <code>Hashable</code> widget <code>Hashable</code> tomar√° datos para el cumplimiento del protocolo del objeto que describir√° una primitiva particular.  Puede usar <code>AnyHashable</code> para "borrar" el widget de tipo de objeto. </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetIdentifiable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> underlying: <span class="hljs-type"><span class="hljs-type">AnyHashable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> underlying: <span class="hljs-type"><span class="hljs-type">AnyHashable</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.underlying = underlying } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(into hasher: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hasher)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.underlying.hash(into: &amp;hasher) } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> ==</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lhs: Widget, rhs: Widget)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lhs.underlying == rhs.underlying } }</code> </pre> <br><p>  En esta etapa, se ejecutan las dos primeras propiedades del widget.  Esto no es dif√≠cil de verificar mediante la recopilaci√≥n de varios widgets con diferentes tipos de objetos en una matriz. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> widgets = [<span class="hljs-type"><span class="hljs-type">Widget</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>), <span class="hljs-type"><span class="hljs-type">Widget</span></span>(<span class="hljs-number"><span class="hljs-number">100500</span></span>)]</code> </pre> <br><p>  Para implementar las propiedades restantes, presentamos un nuevo protocolo <code>WidgetPresentable</code> </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetPresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetCell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(collectionView: UICollectionView, indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UICollectionViewCell</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(containerWidth: CGFloat)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGSize</span></span> }</code> </pre> <br><p>  La funci√≥n <code>widgetSize(containerWidth:)</code> se usar√° en <code>UICollectionViewLayout</code> al generar los atributos de las celdas, y <code>widgetCell(collectionView:indexPath:)</code> - para obtener las celdas. </p><br><p>  Si el widget se <code>WidgetPresentable</code> protocolo <code>WidgetPresentable</code> , el widget cumplir√° con todas las propiedades indicadas al comienzo de la publicaci√≥n.  Sin embargo, el objeto contenido en el widget AnyHashable tendr√° que ser reemplazado por la composici√≥n <code>WidgetPresentable</code> y <code>WidgetHashable</code> , donde <code>WidgetHashable</code> no tendr√° un valor asociado (como en el caso de <code>Hashable</code> ) y el tipo de objeto dentro del widget permanecer√° "borrado": </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetHashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> any: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetHash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(into hasher: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hasher)</span></span></span></span> }</code> </pre> <br><p>  En la versi√≥n final, el widget se ver√° as√≠: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetIdentifiable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> underlying: <span class="hljs-type"><span class="hljs-type">WidgetHashable</span></span> &amp; <span class="hljs-type"><span class="hljs-type">WidgetPresentable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> underlying: <span class="hljs-type"><span class="hljs-type">WidgetHashable</span></span> &amp; <span class="hljs-type"><span class="hljs-type">WidgetPresentable</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.underlying = underlying } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(into hasher: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hasher)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.underlying.widgetHash(into: &amp;hasher) } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> ==</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lhs: Widget, rhs: Widget)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lhs.underlying.widgetEqual(rhs.underlying) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetPresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetCell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(collectionView: UICollectionView, indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UICollectionViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> underlying.widgetCell(collectionView: collectionView, indexPath: indexPath) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(containerWidth: CGFloat)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGSize</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> underlying.widgetSize(containerWidth: containerWidth) } }</code> </pre> <br><h1 id="obekt-primitiva">  Objeto primitivo </h1><br><p>  Intentemos ensamblar la primitiva m√°s simple, que ser√° la sangr√≠a de una altura dada. </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Spacing</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpacingView</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> constraint = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.heightAnchor.constraint(equalToConstant: <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(frame: .zero) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.constraint.isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Spacing</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetHashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> any: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> spacing = any <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Spacing</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> == spacing } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetHash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(into hasher: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hasher)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.hash(into: &amp;hasher) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Spacing</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WidgetPresentable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetCell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(collectionView: UICollectionView, indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UICollectionViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell: <span class="hljs-type"><span class="hljs-type">WidgetCell</span></span>&lt;<span class="hljs-type"><span class="hljs-type">SpacingView</span></span>&gt; = collectionView.cellDequeueSafely(indexPath: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell.view == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { cell.view = <span class="hljs-type"><span class="hljs-type">SpacingView</span></span>() } cell.view?.constraint.constant = height <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">widgetSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(containerWidth: CGFloat)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGSize</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">CGSize</span></span>(width: containerWidth, height: height) } }</code> </pre> <br><p>  <code>WidgetCell&lt;T&gt;</code> es solo una subclase de <code>UICollectionViewCell</code> que acepta una <code>UIView</code> y la agrega como una subvista.  <code>cellDequeueSafely(indexPath:)</code> es una funci√≥n que registra una celda en una colecci√≥n antes de reutilizarla si una celda de la colecci√≥n no se ha registrado previamente.  <code>Spacing</code> se utilizar√° como se describe al comienzo de la publicaci√≥n. </p><br><p>  Despu√©s de recibir la matriz de widgets, solo queda enlazar a <code>observerWidgets</code> : </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">DataSource</span></span> = <span class="hljs-type"><span class="hljs-type">RxCollectionViewSectionedAnimatedDataSource</span></span>&lt;<span class="hljs-type"><span class="hljs-type">WidgetSection</span></span>&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataSource: <span class="hljs-type"><span class="hljs-type">DataSource</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.makeDataSource() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> observerWidgets: (<span class="hljs-type"><span class="hljs-type">Observable</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Widgets</span></span>&gt;) -&gt; <span class="hljs-type"><span class="hljs-type">Disposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> collectionView.rx.items(dataSource: dataSource) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeDataSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">DataSource</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">DataSource</span></span>(configureCell: { (<span class="hljs-number"><span class="hljs-number">_</span></span>, collectionView: <span class="hljs-type"><span class="hljs-type">UICollectionView</span></span>, indexPath: <span class="hljs-type"><span class="hljs-type">IndexPath</span></span>, widget: <span class="hljs-type"><span class="hljs-type">Widget</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = widget.widgetCell(collectionView: collectionView, indexPath: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell }) } }</code> </pre> <br><h1 id="rezultaty">  Resultados </h1><br><p>  En conclusi√≥n, me gustar√≠a mostrar el trabajo real de la colecci√≥n, que est√° construida completamente en widgets. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_t/od/tz/_todtzto-dqfqf1nwto9pik694c.gif" alt="imagen"></div><br><p>  Como puede ver, la descomposici√≥n de <code>UICollectionViewCell</code> factible y en situaciones adecuadas puede simplificar la vida del desarrollador. </p><br><h1 id="zamechaniya">  Observaciones </h1><br><p>  El c√≥digo proporcionado en la publicaci√≥n est√° muy simplificado y no debe compilarse.  El objetivo era describir el enfoque, no proporcionar una soluci√≥n llave en mano. </p><br><p>  El protocolo <code>WidgetPresentable</code> se puede ampliar con otras funciones que optimizan el dise√±o, por ejemplo, <code>widgetSizeEstimated(containerWidth:)</code> o <code>widgetSizePredefined(containerWidth:)</code> , que devuelven el tama√±o estimado y fijo, respectivamente.  Vale la pena se√±alar que la funci√≥n <code>widgetSize(containerWidth:)</code> deber√≠a devolver el tama√±o de la primitiva incluso para c√°lculos exigentes, por ejemplo, para <code>systemLayoutSizeFitting(_:)</code> .  Dichos c√°lculos se pueden almacenar en cach√© a trav√©s de <code>Dictionary</code> , <code>NSCache</code> , etc. </p><br><p>  Como sabe, todos los tipos de celdas utilizados por <code>UICollectionView</code> deben registrarse previamente en la colecci√≥n.  Sin embargo, para reutilizar widgets entre diferentes pantallas / colecciones y no registrar todos los identificadores / tipos de celda por adelantado, debe adquirir un mecanismo que registre una celda inmediatamente antes de su primer uso dentro de cada colecci√≥n.  En la publicaci√≥n, <code>cellDequeueSafely(indexPath:)</code> utiliz√≥ la funci√≥n <code>cellDequeueSafely(indexPath:)</code> para esto. </p><br><p>  No puede haber encabezados o pies de p√°gina en la colecci√≥n.  En su lugar habr√° primitivas.  La presencia de suplementarios en la colecci√≥n no dar√° ninguna bonificaci√≥n especial en el enfoque actual.  Por lo general, se usan cuando la matriz de datos corresponde estrictamente al n√∫mero de celdas y se requiere que muestre vistas adicionales antes, despu√©s o entre celdas.  En nuestro caso, los datos para vistas auxiliares tambi√©n se pueden agregar a la matriz de widgets y dibujar como primitivos. </p><br><p>  Dentro de la misma colecci√≥n, se pueden ubicar widgets con los mismos objetos.  Por ejemplo, el mismo <code>Spacing</code> al principio y al final de la colecci√≥n.  La presencia de tales objetos no √∫nicos conducir√° al hecho de que la animaci√≥n en la colecci√≥n desaparece.  Para hacer que tales objetos sean √∫nicos, puede usar etiquetas especiales <code>AnyHashable</code> , <code>#file</code> y <code>#line</code> donde se cre√≥ el objeto, etc. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/455421/">https://habr.com/ru/post/455421/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455407/index.html">Coches el√©ctricos y pico de ventas de coches de combustible.</a></li>
<li><a href="../455409/index.html">Compatibilidad con versiones anteriores</a></li>
<li><a href="../455411/index.html">Meg√°fono realiz√≥ una actualizaci√≥n t√©cnica ... nombres de red</a></li>
<li><a href="../455413/index.html">Convierta Pocket en un servicio de noticias</a></li>
<li><a href="../455419/index.html">Apple Beta Alive: Trivia no revelada en la presentaci√≥n</a></li>
<li><a href="../455425/index.html">Creaci√≥n del t√∫nel IPSec GRE entre Mikrotik hEX S y Juniper SRX a trav√©s del m√≥dem USB</a></li>
<li><a href="../455427/index.html">C√≥mo aprendimos a predecir la solicitud de un usuario y acelerar la carga de resultados de b√∫squeda</a></li>
<li><a href="../455429/index.html">C√≥mo Doom lleg√≥ a Super Nintendo</a></li>
<li><a href="../455439/index.html">El nuevo algoritmo creado por cient√≠ficos le permite crear "cabezas parlantes" casi perfectas con personas reales</a></li>
<li><a href="../455441/index.html">21 de junio, Mosc√∫, Deworkacy - AnalyzeIT MeetUp # 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>