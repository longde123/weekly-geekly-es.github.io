<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÖ üí´ üßõüèº Como lidar com testes inadequados na comunidade de c√≥digo-fonte aberto üë®üèª‚Äçüé® üßóüèæ üèá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muitos projetos enfrentam o problema dos testes esquisitos, e esse t√≥pico foi levantado mais de uma vez em Habr√©. Os testes que n√£o decidiram suas con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como lidar com testes inadequados na comunidade de c√≥digo-fonte aberto</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/436070/">  Muitos projetos enfrentam o problema dos testes esquisitos, e esse t√≥pico foi levantado mais de uma vez em Habr√©.  Os testes que n√£o decidiram suas condi√ß√µes constantemente levam n√£o apenas o tempo da m√°quina, mas tamb√©m o tempo dos desenvolvedores e testadores.  E se em uma empresa comercial voc√™ pode alocar um determinado recurso para resolver esse problema e nomear pessoas respons√°veis, ent√£o na comunidade de c√≥digo aberto n√£o √© t√£o simples.  Especialmente quando se trata de grandes projetos - por exemplo, como o Apache Ignite, onde existem quase 60 mil testes diferentes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f92/3f5/dd2/f923f5dd2d414a1737fb093c3e0ddac4.png"><br><br>  De fato, neste post, mostraremos como resolver esse problema no Apache Ignite.  Somos Dmitry Pavlov, engenheiro de software / gerente de comunidade da GridGain, e Nikolai Kulagin, engenheiro de TI da Sberbank Technologies. <br><a name="habracut"></a><br>  <i>Tudo escrito abaixo n√£o representa a posi√ß√£o de nenhuma empresa, incluindo o Sberbank.</i>  <i>Esta hist√≥ria √© exclusivamente de membros da comunidade Apache Ignite.</i> <br><br><h2>  Apache Ignite e testes </h2><br>  A hist√≥ria do Apache Ignite come√ßa em 2014, quando o GridGain doou a primeira vers√£o do produto interno para a Apache Software Foundation.  Mais de quatro anos se passaram desde ent√£o e, durante esse per√≠odo, o n√∫mero de testes chegou √† marca de 60 mil. <br><br>  Usamos o JetBrains TeamCity como servidor de integra√ß√£o cont√≠nua - obrigado aos funcion√°rios do JetBrains por apoiar o movimento de c√≥digo aberto.  Todos os nossos testes s√£o distribu√≠dos entre as su√≠tes, cujo n√∫mero para a ramifica√ß√£o principal √© pr√≥ximo a 140. Nas su√≠tes, os testes s√£o agrupados por algum crit√©rio.  Isso pode estar testando apenas a funcionalidade do Machine Learning [RunMl], apenas o cache [RunCache] ou todo o [RunAll].  No futuro, a execu√ß√£o dos testes significar√° exatamente [RunAll] - uma verifica√ß√£o completa.  Demora aproximadamente 55 horas de tempo da m√°quina. <br><br>  O Junit √© usado como a biblioteca principal, mas existem poucos testes de unidade.  Na maioria das vezes, todos os nossos testes s√£o de integra√ß√£o, pois cont√™m o lan√ßamento de um ou mais n√≥s (e isso leva alguns segundos).  Obviamente, os testes de integra√ß√£o s√£o convenientes porque um desses testes abrange muitos aspectos e intera√ß√µes, o que √© bastante dif√≠cil de obter com um √∫nico teste de unidade.  Mas tamb√©m h√° desvantagens: no nosso caso, esse √© um lead time bastante longo, al√©m da dificuldade de encontrar um problema. <br><br><h2>  Problemas com esquisito </h2><br>  Parte desses testes √© escamosa.  Agora, de acordo com a classifica√ß√£o do TeamCity, aproximadamente 1.700 testes s√£o marcados como esquisitos - ou seja, com uma mudan√ßa de estado sem alterar o c√≥digo ou a configura√ß√£o.  Esses testes n√£o podem ser ignorados, pois existe o risco de ocorrer um erro na produ√ß√£o.  Portanto, eles precisam ser verificados duas vezes e reiniciados, √†s vezes v√°rias vezes, para analisar os resultados das quedas - e isso exige tempo e esfor√ßo preciosos.  E se os membros existentes da comunidade lidam com essa tarefa, para novos colaboradores, isso pode se tornar uma barreira real.  Voc√™ deve admitir que, ao fazer altera√ß√µes no Java Doc, n√£o espera encontrar uma falha, mas n√£o uma, mas v√°rias dezenas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/723/db8/c6b/723db8c6b70264074788f6783717f2b6.png"><br><br><h2>  Quem √© o culpado? </h2><br>  Metade dos problemas com testes escamosos surge devido √† configura√ß√£o do equipamento, devido ao tamanho da instala√ß√£o.  E a segunda metade est√° diretamente ligada √†s pessoas que erraram e n√£o corrigiram o erro. <br><br>  Convencionalmente, todos os membros da comunidade podem ser divididos em dois grupos: <br><br><ul><li>  Entusiastas que entram na comunidade por vontade pr√≥pria e contribuem para o seu tempo livre. <br></li><li>  Contribuidores em per√≠odo integral que trabalham para empresas que de alguma forma usam ou est√£o associadas a este produto de c√≥digo aberto. <br></li></ul><br>  Um colaborador do primeiro grupo pode muito bem fazer uma √∫nica edi√ß√£o e deixar a comunidade.  E alcan√ß√°-lo em caso de detec√ß√£o de um bug √© quase imposs√≠vel.  √â mais f√°cil interagir com pessoas do segundo grupo, √© mais prov√°vel que elas respondam a um teste que fazem.  Mas acontece que uma empresa que anteriormente estava interessada em um produto deixou de precisar dele.  Ela est√° deixando a comunidade e seus funcion√°rios contribuintes est√£o com ela.  Ou √© poss√≠vel que o colaborador deixe a empresa e com ela a comunidade.  Obviamente, ap√≥s essas mudan√ßas, alguns ainda continuam a participar da comunidade.  Mas n√£o todos. <br><br><h2>  Quem vai consertar? </h2><br>  Se estamos falando de pessoas que deixaram a comunidade, seus bugs, √© claro, v√£o para os colaboradores atuais.  Vale ressaltar que, para a revis√£o que levou ao bug, o revisor tamb√©m √© respons√°vel, mas tamb√©m pode ser um entusiasta - ou seja, ele nem sempre estar√° dispon√≠vel. <br><br>  Acontece que acaba alcan√ßando uma pessoa, diga-lhe: este √© o problema.  Mas ele diz: n√£o, essa n√£o √© minha corre√ß√£o introduziu um bug.  Como uma execu√ß√£o completa da ramifica√ß√£o principal √© executada automaticamente com uma fila relativamente livre, isso geralmente ocorre √† noite.  Antes disso, v√°rios commits podem ser despejados no ramo durante o dia inteiro. <br><br>  No TeamCity, qualquer modifica√ß√£o de c√≥digo √© considerada um registro de altera√ß√µes.  Se depois de tr√™s trocadores tivermos uma nova queda, tr√™s pessoas dir√£o que isso n√£o se deve ao seu comprometimento.  Se houver cinco trocadores, ouviremos de cinco pessoas. <br><br>  Outro problema: informar ao colaborador que os testes devem ser executados antes de cada revis√£o.  Alguns n√£o sabem onde, o que e como correr.  Ou os testes foram executados, mas o colaborador n√£o escreveu sobre isso no ticket.  Tamb√©m h√° problemas nesta fase. <br><br>  V√° em frente.  Suponha que os testes sejam executados e no ticket haja um link para os resultados.  Mas, como se viu, isso n√£o oferece nenhuma garantia da an√°lise dos testes de execu√ß√£o.  O colaborador pode olhar para sua corrida, ver alguns lan√ßamentos l√°, mas escrever "TeamCity Looks Good".  O revisor - especialmente se ele estiver familiarizado com o colaborador ou o tiver revisado com sucesso antes - talvez n√£o veja realmente o resultado.  E n√≥s temos esse "TeamCity Looks Good": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/055/26c/db2/05526cdb20d19b264ac4750695e46dee.png"><br><br>  Onde "Bom" est√° aqui n√£o est√° claro.  Mas, aparentemente, os autores pelo menos sabem que os testes precisam ser executados. <br><br><h2>  Como lutamos contra isso </h2><br><h3>  M√©todo 1. Testes separados </h3><br>  Dividimos os testes em dois grupos.  No primeiro, "limpo" - testes est√°veis.  No segundo - inst√°vel.  A abordagem √© bastante √≥bvia, mas n√£o deu certo mesmo com duas tentativas.  Porque  Porque uma su√≠te com testes inst√°veis ‚Äã‚Äãse transforma em um gueto onde algo come√ßa necessariamente a expirar, trava etc.  Como resultado, todo mundo come√ßa a simplesmente ignorar esses testes sempre problem√°ticos.  Em geral, n√£o faz sentido dividir os testes por nota. <br><br><h4>  M√©todo 2. Separa√ß√£o e notifica√ß√£o </h4><br>  A segunda op√ß√£o √© semelhante √† primeira - para alocar testes mais est√°veis ‚Äã‚Äãe executar os demais testes de RP √† noite.  Se algo quebrar em um grupo est√°vel, uma mensagem √© enviada ao colaborador com as ferramentas padr√£o do TeamCity, informando que algo precisa ser corrigido. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/321/7d1/7ba/3217d17ba4744bf932a498f8c2dcd63d.png"><br><br>  ... 0 pessoas reagiram a essas mensagens.  Todos os ignoraram. <br><br><h3>  M√©todo 3. Monitoramento Di√°rio </h3><br>  Dividimos as su√≠tes em v√°rios "observadores", os membros mais respons√°veis ‚Äã‚Äãda comunidade, e os assinamos para receber alertas sobre quedas.  Como resultado, foi confirmado na pr√°tica que o entusiasmo tende a acabar.  Os colaboradores abandonam esse empreendimento e param de verificar regularmente.  Ent√£o eu perdi, olhei para l√° - e novamente algo se arrastou para o mestre. <br><br><h3>  M√©todo 4. Automa√ß√£o </h3><br>  Ap√≥s outro m√©todo malsucedido, os caras do GridGain se lembraram de um utilit√°rio desenvolvido anteriormente que adicionava a funcionalidade ausente naquele momento no TeamCity.  Ou seja, a capacidade de visualizar estat√≠sticas gerais sobre o n√∫mero de quedas: quanto e o que caiu, deteriorou ou melhorou o resultado no dia seguinte.  Esse utilit√°rio foi desenvolvido gradualmente, os relat√≥rios foram adicionados e renomeados.  Em seguida, eles adicionaram notifica√ß√µes, renomeadas novamente.  Ent√£o, descobriu-se o TeamCity Bot.  Agora ele tem quase 500 confirma√ß√µes e 7 contribuidores e est√° no reposit√≥rio adicional do Apache. <br><br>  O que o bot faz?  Seus recursos podem ser combinados em dois grupos: <br><br><ul><li>  Monitoramento do projeto - monitoramento visual, exibindo os resultados das execu√ß√µes, bem como a notifica√ß√£o autom√°tica em mensageiros instant√¢neos (por exemplo, folga) <br></li><li>  Verifica√ß√£o de ag√™ncia - an√°lise de teste de RP, bem como emiss√£o de visto em um bilhete. <br></li></ul><br><h2>  Fluxo de trabalho do TeamCity Bot </h2><br>  Antes do Apache Ignite Teamcity Bot, o processo de "contribui√ß√£o" para a comunidade era o seguinte: <br><br><ol><li>  No JIRA, um dos tickets √© selecionado e fixo; <br></li><li>  Uma solicita√ß√£o de recebimento √© criada; <br></li><li>  Executa testes que podem ser afetados pelas altera√ß√µes feitas; <br></li><li>  Se os testes forem aprovados, a solicita√ß√£o de recebimento poder√° ser visualizada e moderada pelo respons√°vel pela entrega. <br></li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/1b2/c5c/d81/1b2c5cd81a826ec8e761b8c12b62c7f4.png"><br><br>  Parece simples, mas na verdade o terceiro ponto pode ser uma barreira para alguns colaboradores.  Por exemplo: um rec√©m-chegado √† comunidade decide dar sua primeira contribui√ß√£o escolhendo o ingresso mais simples.  Isso pode estar editando um Java Doc ou atualizando vers√µes de depend√™ncia automatizada.  Analisando os resultados da corrida em sua pequena corre√ß√£o, ele de repente descobre que cerca de 30 testes ca√≠ram.  De onde vem o n√∫mero de testes com falha e como analis√°-los - ele n√£o sabe.  Pode-se esperar que o colaborador nunca volte aqui. <br><br>  Membros mais experientes da comunidade tamb√©m sofrem de escama√ß√£o - passam um tempo analisando testes que ca√≠ram por acaso e, portanto, dificultam o desenvolvimento do produto. <br><img src="https://habrastorage.org/getpro/habr/post_images/c42/290/ffb/c42290ffb3ead465704b6a3a990b09b2.png"><br>  <i>Esquema de contribui√ß√£o com o TeamCity Bot</i> <br><br>  Com o advento do bot, as etapas na contra-a√ß√£o aumentaram, mas o tempo gasto analisando os testes ca√≠dos diminuiu significativamente.  Agora basta executar o teste e, depois de aprovado, observe a p√°gina do bot correspondente.  Se houver bloqueadores poss√≠veis (testes descartados que n√£o s√£o considerados inadequados), basta executar uma verifica√ß√£o dupla, ap√≥s a qual voc√™ pode obter um visto na forma de um coment√°rio no JIRA com os resultados do teste. <br><br><h2>  Vis√£o geral dos recursos </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/07c/a1b/a0e/07ca1ba0eb4d07a1537e75062eda2dd5.png"><br><br>  <i>Inspecionar contribui√ß√£o - uma lista de todos os PRs n√£o fechados com um resumo de cada informa√ß√£o: a data da √∫ltima atualiza√ß√£o, n√∫mero do PR, nome, autor e ticket no JIRA</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d9/7ec/2f8/6d97ec2f8eba182718d88d291edfa58d.png"><br>  <i>Para cada solicita√ß√£o de recebimento, uma guia com informa√ß√µes mais detalhadas est√° dispon√≠vel: o nome correto do PR, sem o qual o bot n√£o conseguir√° encontrar o ticket desejado no JIRA;</i>  <i>se os testes foram executados;</i>  <i>se o resultado do teste est√° pronto;</i>  <i>deixou um coment√°rio no JIRA.</i> <br><br>  An√°lise dos resultados dos testes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed8/104/3c2/ed81043c26693ca7f40f3f9379797b7a.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/c42/a79/22c/c42a7922ce4b4163c9561bfaa4964ea9.png"><br><br>  Aqui est√£o dois relat√≥rios sobre o teste do mesmo PR.  O primeiro √© do bot.  O segundo √© um relat√≥rio padr√£o sobre o Teamcity.  A diferen√ßa na quantidade de informa√ß√µes √© √≥bvia, e isso n√£o leva em conta o fato de que, para visualizar o hist√≥rico das execu√ß√µes de teste do TC, tamb√©m ser√° necess√°rio fazer v√°rias transi√ß√µes para as p√°ginas adjacentes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c66/7d5/24d/c667d524d85a956b5aca555343056563.png"><br><br>  Vamos voltar ao relat√≥rio do bot.  Este relat√≥rio √© visualmente dividido em duas tabelas: poss√≠veis bloqueadores e todas as falhas.  Os bloqueadores incluem testes que: <br><br><ul><li>  ter uma taxa de falhas no mestre inferior a 4% (menos de 4 partidas em 100 foram malsucedidas); <br></li><li>  n√£o s√£o escamosos de acordo com a classifica√ß√£o do TeamCity; <br></li><li>  caiu devido a um tempo limite, falta de mem√≥ria, c√≥digo de sa√≠da, falha na JVM. <br></li></ul><br>  Por exemplo, na captura de tela acima, duas su√≠tes s√£o indicadas como poss√≠veis bloqueadores - no primeiro, o teste caiu e, no segundo, ocorreu um tempo limite. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/867/ba7/53b/867ba753b7fee200ae041c36c30fc136.png"><br><br>  Para finalmente entender o que √© um teste superficial e o que √© um bug, considere a imagem acima.  A barra horizontal √© de 100 corridas.  Barra verde vertical - aprovada com √™xito no teste, gota vermelha.  No caso de um bug, o hist√≥rico de corridas parece natural: uma barra verde simples no final muda de cor para vermelho.  Isso significa que foi nesse local que um bug apareceu e o teste come√ßou a cair constantemente.  Se tivermos diante de n√≥s um teste superficial, seu hist√≥rico de corridas √© uma altern√¢ncia cont√≠nua de cores verde e vermelho. <br><br>  An√°lise dos Resultados do Teste <br><br><img src="https://habrastorage.org/getpro/habr/post_images/faa/050/154/faa050154f92d1cd4cb388efa59f461d.png"><br><br>  Por exemplo, analisamos os resultados da aprova√ß√£o nos testes na captura de tela acima.  De acordo com a vers√£o do bot, pode haver duas falhas devido a um erro - elas est√£o listadas na tabela Bloqueadores poss√≠veis.  Mas pode muito bem ser testes esquisitos com uma baixa taxa de falhas.  Para excluir esta op√ß√£o, basta clicar no bot√£o Executar novamente os poss√≠veis bloqueadores, e esses dois conjuntos ir√£o verificar novamente.  Para tornar a tarefa ainda mais f√°cil, voc√™ pode clicar em Executar novamente os poss√≠veis bloqueadores e comentar o JIRA e obter um coment√°rio (e uma notifica√ß√£o por e-mail) do bot depois que a verifica√ß√£o for conclu√≠da.  Ent√£o entre e veja se h√° um problema ou n√£o. <br><br>  Para os revisores, isso √© muito legal.  Voc√™ pode esquecer as edi√ß√µes que n√£o foram aprovadas em nenhuma verifica√ß√£o, mas basta clicar em v√°rias edi√ß√µes, clicar no grande bot√£o verde Executar novamente e aguardar a letra. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eb0/352/de5/eb0352de55fe68f17e69139426ac4474.png"><br>  <i>Relat√≥rio perfeito: nenhum bloqueador detectado</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce9/8aa/303/ce98aa3034b0b39391aa1fe4db081375.png"><br></i>  <i>Visto verde (coment√°rio) do bot.</i>  <i>Nenhum bloqueador encontrado.</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9c5/be4/802/9c5be48026aad0175d690636ea5d14d9.png"><br></i>  <i>Visto vermelho - verifica√ß√£o dupla e / ou edi√ß√£o de bugs necess√°rios</i> <br><br>  Acontece que alguns bugs ainda vazam para o "mestre".  Como dissemos, antes isso era combatido por meio de notifica√ß√µes pessoais.  Ou alguma pessoa se certificou de que nada ca√≠sse.  Agora estamos usando uma solu√ß√£o mais simples: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57d/c82/90f/57dc8290f1643362d93ff95e497ce36c.png"><br><br>  Quando um novo bug √© detectado, uma mensagem √© enviada para a lista de desenvolvedores, indicando os contribuidores e seus trocadores, que podem ser a causa do erro.  Assim, toda a comunidade descobrir√° quem fez tudo acontecer. <br><br>  Dessa forma, conseguimos aumentar o n√∫mero de hot fixes e reduzir bastante o tempo necess√°rio para solucionar o problema. <br><br>  Monitorando o Status do Assistente <br>  Outra das fun√ß√µes do bot √© monitorar o estado do assistente com as estat√≠sticas dos lan√ßamentos mais recentes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce6/3da/e80/ce63dae8033464df004d8a168e75c9c1.png"><br><br>  Principais tend√™ncias <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab4/d34/ecc/ab4d34ecc348552b4de5804a1b66a7a6.png"><br><br>  A p√°gina de tend√™ncias principais compara duas sele√ß√µes "principais" para per√≠odos espec√≠ficos.  Para cada item da tabela exibe o valor m√°ximo, m√≠nimo e mediana. <br><img src="https://habrastorage.org/getpro/habr/post_images/564/8c5/fd1/5648c5fd1dd4080a736856bf2d9afbd3.png"><br><br>  Al√©m dos resultados gerais de toda a amostra, a tabela cont√©m gr√°ficos para cada indicador com a exibi√ß√£o dos valores de cada constru√ß√£o.  Ao clicar em um ponto, voc√™ pode acessar os resultados da execu√ß√£o no TeamCity.  Al√©m disso, √© poss√≠vel remover o resultado das estat√≠sticas.  Isso √© √∫til quando valores anormais ocorrem devido a falhas graves, √†s quais o colaborador provavelmente n√£o √© o culpado.  Tais resultados devem ser exclu√≠dos para que n√£o sejam levados em considera√ß√£o no c√°lculo dos mesmos testes de falhas.  Al√©m disso, a constru√ß√£o tamb√©m pode ser diferenciada para rastrear os resultados para cada indicador. <br><br>  O Apache Ignite Teamcity Bot agora tem mais de 65 membros registrados.  Durante todo o per√≠odo de uso do bot, os vistos receberam mais de 400 solicita√ß√µes pull e, em m√©dia, cinco vistos s√£o emitidos por dia. <br><br><h2>  Estrutura de bot do TeamCity </h2><br>  O bot est√° hospedado em um servidor separado, acessa ignite.apache.org para obter dados, notifica publicamente todos na lista de desenvolvedores - esta √© a nossa principal plataforma para desenvolvedores do Ignite - e grava vistos em tickets por meio da API do JIRA. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/609/73e/734/60973e7345a076dbabedb9ef35921b7e.png"><br><br>  Ele usa o servidor Jetty, servlets de Jersey, v√°rios servi√ßos com l√≥gica de neg√≥cios complexa do bot em si, incluindo servi√ßos Teamcity, JIRA e GitHub que acessam o servi√ßo Ignited Integration.  Al√©m disso, Pure Integration para solicita√ß√µes http.  Como armazenamento - o pr√≥prio produto do Apache Ignite no modo incorporado de configura√ß√£o de n√≥ √∫nico com persist√™ncia ativa.  Al√©m das vantagens √≥bvias de usar o Ignite como banco de dados, tamb√©m nos ajuda a encontrar v√°rias √°reas de aplica√ß√£o do Ignite e a entender o que √© conveniente e o que n√£o √©. <br><br>  A primeira vers√£o da implementa√ß√£o do bot foi inspirada em um artigo sobre armazenamento em cache REST e era um cache REST e servi√ßos GitHub e Teamcity.  O Teamcity xml e o json retornados do servidor foram analisados ‚Äã‚Äãpelo Pure Java Objects, que foram armazenados em cache.  No come√ßo, funcionou e muito rapidamente.  Mas com o aumento da quantidade de dados, os resultados come√ßaram a se deteriorar. <br><br>  Vale a pena notar que o TeamCity exclui uma hist√≥ria com mais de ~ 2 semanas, mas o bot n√£o.  Por fim, com essa abordagem, surgiram toneladas de dados muito dif√≠ceis de gerenciar. <br><br><h2>  TeamCity Bot Development </h2><br>  A nova abordagem implementa uma op√ß√£o compacta de armazenamento de dados e opta por um pequeno n√∫mero de parti√ß√µes de cache.  Um grande n√∫mero de parti√ß√µes em um n√≥ afeta negativamente a velocidade da sincroniza√ß√£o de dados no disco e aumenta a hora de in√≠cio do cluster. <br><br>  Todas as principais atualiza√ß√µes de dados s√£o executadas de forma ass√≠ncrona, pois, caso contr√°rio, corremos o risco de obter um UX ruim devido ao lento retorno dos dados do TeamCity. <br><br>  Para cadeias que raramente alteram seus valores (por exemplo, os nomes dos testes), um mapeamento simples √© feito no id, gerado pela Sequ√™ncia At√¥mica.  Aqui est√° um exemplo dessa entrada: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/408/1f8/1f5/4081f81f553eb5b318799e11ea847043.png"><br><br>  O nome do teste longo corresponde ao n√∫mero int, que √© armazenado em todas as compila√ß√µes.  Isso economiza uma enorme quantidade de recursos.  No topo dos m√©todos que retornam essa linha, est√° o interceptador de cache na mem√≥ria Guava.  Gra√ßas √† anota√ß√£o do cache, mesmo no heap, n√£o selecionamos linhas lendo-as no Ignite by id.  E por id, sempre obtemos a mesma linha, o que √© bom para o desempenho. <br><br>  Para linhas "imprevis√≠veis", por exemplo, logs de rastreamento de pilha, v√°rios tipos de compacta√ß√£o s√£o usados ‚Äã‚Äã- compacta√ß√£o gzip, compacta√ß√£o instant√¢nea ou descompactada, dependendo da melhor.  Todos esses m√©todos ajudam a ajustar o m√°ximo de dados na mem√≥ria e d√£o uma resposta r√°pida ao cliente. <br><br><h2>  Por que TeamCity Bot √© melhor </h2><br>  Isso n√£o quer dizer que o TeamCity n√£o tenha os recursos listados acima.  Eles est√£o, mas espalhados por uma pilha de lugares diferentes.  No bot, tudo √© coletado em uma p√°gina e voc√™ pode entender rapidamente qual √© o problema. <br><br>  Uma boa adi√ß√£o √© a carta que o bot envia na planilha de desenvolvimento quando detecta um problema.  Imediatamente na comunidade, h√° uma ocasi√£o para iniciar uma discuss√£o: ‚ÄúVamos, talvez, agora vamos reverter?‚Äù.  Isso adiciona confian√ßa aos revisores. <br><br>  Com o bot, √© muito mais f√°cil para novos colaboradores ingressar no processo de desenvolvimento.  Ao fazer sua primeira corre√ß√£o, voc√™ nem sempre sabe o que as altera√ß√µes feitas podem acarretar.  E mergulhando de cabe√ßa na an√°lise dos resultados dos testes no TeamCity, voc√™ pode facilmente perder seu entusiasmo por um maior desenvolvimento.  O Apache Ignite TeamCity Bot ajudar√° voc√™ a entender rapidamente se houver um problema e manter o entusiasmo. <br><br>  Esperamos que o bot simplifique a vida dos colaboradores atuais e atraia novas pessoas para a comunidade.  Finalmente, aconselhamos, √© claro, a impedir o aparecimento de um grande n√∫mero de testes inadequados, porque √© dif√≠cil lidar com eles.  E confie nos rob√¥s - eles n√£o t√™m prefer√™ncias e n√£o aceitam a palavra das pessoas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt436070/">https://habr.com/ru/post/pt436070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt436060/index.html">Solu√ß√µes arquitet√¥nicas para um jogo para celular. Parte 3: Vista sobre o impulso do jato</a></li>
<li><a href="../pt436062/index.html">Sistema de arbitragem para iniciantes, parte 1</a></li>
<li><a href="../pt436064/index.html">Intelig√™ncia artificial para todos</a></li>
<li><a href="../pt436066/index.html">Matem√°tica do Apocalipse: Teoria dos Jogos e a Crise Nuclear do Caribe</a></li>
<li><a href="../pt436068/index.html">Confer√™ncia C ++ R√∫ssia 2019</a></li>
<li><a href="../pt436072/index.html">Limpe, marque: como ensinamos o chatbot a distinguir problemas do cliente</a></li>
<li><a href="../pt436076/index.html">An√°lise do ataque de Cowrie Hanipot</a></li>
<li><a href="../pt436080/index.html">Semana de Seguran√ßa 03: 2019 - Ano de Privacidade</a></li>
<li><a href="../pt436082/index.html">Como a UEBA ajuda a melhorar a seguran√ßa cibern√©tica</a></li>
<li><a href="../pt436086/index.html">Vis√£o geral da atualiza√ß√£o 4 do Veeam Cloud Connect</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>