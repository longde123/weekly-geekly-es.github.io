<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游눺 游놀游낖 游볘 C칩mo Windows 10 Explore la vulnerabilidad cr칤tica de DHCP detecta dos errores de seguridad m치s 游녿游 游 游꿃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagen: Unsplash 

 Como se describi칩 en un art칤culo anterior sobre CVE-2019-0726 , a veces la b칰squeda de detalles sobre una vulnerabilidad ya conoci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C칩mo Windows 10 Explore la vulnerabilidad cr칤tica de DHCP detecta dos errores de seguridad m치s</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/448600/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/yp/f9/um/ypf9um_w-o9bemj0w8q9gucekre.png"></a> <br><br>  <i>Imagen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Unsplash</a></i> <br><br>  Como se describi칩 en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art칤culo anterior</a> sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE-2019-0726</a> , a veces la b칰squeda de detalles sobre una vulnerabilidad ya conocida conduce al descubrimiento de una nueva vulnerabilidad.  Y en algunos casos hay m치s de una de esas nuevas vulnerabilidades. <a name="habracut"></a><br><br>  En el art칤culo se consideraron dos funciones de la biblioteca dhcpcore.dll: el UpdateDomainSearchOption mencionado casualmente y el an치lisis m치s detallado del DecodeDomainSearchListData que llama.  Como siempre sucede cuando se buscan vulnerabilidades, incluso si las conclusiones importantes al final se reducen a una o dos funciones, en el proceso de an치lisis debe analizar una cantidad de c칩digo mucho mayor.  Y a veces el ojo se aferra a cosas insignificantes que no est치n relacionadas con la tarea actual, pero que pueden tener un significado independiente o ser 칰tiles m치s adelante.  Supongamos que en este momento no hay tiempo para prestarles atenci칩n, pero tales peque침eces se posponen en la subcorteza y, si despu칠s de un cierto per칤odo de tiempo existe la oportunidad de volver a ellas y comprobar sus conjeturas, vuelven a aparecer en la conciencia. <br><br>  Y as칤 sucedi칩 esta vez.  Al estudiar la funci칩n DhcpExtractFullOptions, que es responsable de procesar todas las opciones especificadas en la respuesta DHCP del servidor, en particular, llamando a UpdateDomainSearchOption, dos conjuntos en la pila de 256 elementos cada uno llaman la atenci칩n de inmediato: <br><br><img src="https://habrastorage.org/webt/6e/ug/5g/6eug5gck41wlfwrzpfcdkxqr1x0.png"><br><br>  Al mismo tiempo, la presencia de cualquier verificaci칩n que restrinja los valores de los iteradores de estas matrices no es notable.  Como en ese momento est치bamos analizando otra vulnerabilidad, esta informaci칩n no era relevante.  Por lo tanto, solo quedaba recordar este lugar en el c칩digo para volver a 칠l m치s tarde. <br><br><h2>  An치lisis </h2><br>  Pasan un par de semanas, y nuevamente recordamos la funci칩n DhcpExtractFullOptions que hab칤a llamado la atenci칩n anteriormente.  Lo buscamos en el desensamblador, peinamos las piezas de c칩digo previamente enmarcadas de manera incompleta y tratamos de entender por qu칠 estamos usando dos matrices est치ticas que nos intrigaron. <br><br>  Al comienzo de la ejecuci칩n de la funci칩n, las matrices y sus iteradores se ponen a cero: <br><br><img src="https://habrastorage.org/webt/9i/cd/y8/9icdy8i_mroton7j0dmxna_qrrs.png"><br><br>  La funci칩n analiza todas las opciones del paquete recibido del servidor DHCP, recopila informaci칩n de ellas y luego la procesa.  Adem치s, de acuerdo con los resultados del an치lisis, ella tambi칠n escribe el evento correspondiente al servicio ETW (Event Tracing for Windows).  Es en el registro de eventos donde participan las memorias intermedias que nos interesan.  Junto con muchos otros datos, se transfieren al procedimiento EtwEventWriteTransfer.  El trabajo de preparar todos los datos para el registro es bastante voluminoso y no importa mucho la vulnerabilidad que estamos considerando, por lo que podemos prescindir de las ilustraciones. <br><br>  Es m치s importante determinar c칩mo se llenan estos b칰feres.  El llenado se produce en el bucle de an치lisis de opciones.  Primero, se llama a una funci칩n con el nombre parseado ParseDhcpv4Option para la opci칩n actual recibida para el procesamiento, que llena los campos del objeto dhcp_pointers en funci칩n de los datos recibidos o toma nota de una opci칩n desconocida cuando encuentra un identificador de opci칩n con un valor para el que no hay un controlador. <br><br><img src="https://habrastorage.org/webt/_w/9h/w1/_w9hw1bnfgfpfsodjisbt9xx4hk.png"><br><br>  Al regresar de ParseDhcpv4Option, el valor del identificador de la etiqueta de opci칩n actual se escribe en el siguiente elemento de la matriz all_tags, la primera de las matrices que nos interesan.  Si la funci칩n se encontr칩 con una opci칩n desconocida y, en consecuencia, no estableci칩 el indicador is_known_option, entonces el valor del identificador tambi칠n se escribe en el siguiente elemento de la segunda matriz: unknown_tags.  Naturalmente, los nombres significativos de las variables en este art칤culo ya se obtuvieron analizando el c칩digo. <br><br>  Por lo tanto, la matriz all_tags almacena etiquetas de todas las opciones del mensaje recibido, y la matriz unknown_tags almacena etiquetas solo para opciones desconocidas para el analizador.  Al mismo tiempo, la comprobaci칩n de los valores de los 칤ndices de estas matrices est치 completamente ausente.  En consecuencia, los valores de tales 칤ndices pueden exceder 256 y llevar a la escritura m치s all치 de los l칤mites asignados en la pila para las matrices de memoria.  Para sobrellenar la primera matriz, es suficiente enviar un paquete con un n칰mero de opciones superior a 256 desde el servidor DHCP. Lo mismo es cierto para la segunda matriz, con la 칰nica diferencia de que las opciones que el cliente no puede procesar deben enviarse. <br><br><h2>  Operaci칩n </h2><br>  Intentemos ahora usar un ejemplo pr치ctico para asegurarnos de que nuestras conclusiones sean correctas.  Para empezar, prestamos atenci칩n al hecho de que las etiquetas de opciones ocupan un byte, mientras que los elementos de la matriz son de tipo int, es decir, son de cuatro bytes.  Por lo tanto, tenemos un desbordamiento en el que controlamos cada cuarto byte, y el resto se restablece a cero cuando se sobrescribe. <br><br><img src="https://habrastorage.org/webt/bi/ww/vy/biwwvyyk6c-1mnlqz7l_mrgb3pi.png"><br><br>  Para probar nuestra suposici칩n, la forma m치s f치cil es sobrescribir la cookie de seguridad en la funci칩n en cuesti칩n, lo que generar치 una excepci칩n relacionada con la verificaci칩n de seguridad.  Simulemos una situaci칩n en la que el servidor DHCP env칤a una cantidad suficiente de opciones para reescribir.  Deje que sean 0x1a0 (416) opciones con identificador 0xaa y tama침o cero.  Por lo tanto, cada opci칩n ocupa dos bytes, y el tama침o total del paquete con todos los encabezados es de 1100-1200 bytes.  Este valor est치 dentro de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MTU</a> para Ethernet, por lo tanto, hay razones para creer que el mensaje no se fragmentar치, lo que nos permitir치 evitar posibles efectos adversos. <br><br>  Enviamos el paquete formado de la manera descrita en respuesta a una solicitud del cliente DHCP y detectamos la excepci칩n en el proceso svchost.exe correspondiente en la m치quina cliente: <br><br><img src="https://habrastorage.org/webt/yt/n_/sg/ytn_sgcs4d4e-1yvzebztfcpb1a.png"><br><br>  Como puede ver en el seguimiento de la pila, tanto la cookie de la pila como la direcci칩n de retorno de la funci칩n fueron reescritas por los identificadores de las opciones de nuestro paquete. <br><br>  Por supuesto, crear un exploit funcional para este error requerir치 mucho esfuerzo por parte del atacante.  En los sistemas modernos, el desbordamiento del b칰fer en la pila es una vulnerabilidad bastante compleja y laboriosa debido a todos los mecanismos de defensa existentes.  Por otro lado, uno no debe olvidar que todos estos mecanismos protegen contra la reescritura de la direcci칩n de retorno y los manejadores de excepciones, o proh칤ben la ejecuci칩n de c칩digo en regiones de memoria no destinadas a esto, o interfieren con la predicci칩n de direcciones.  Por ejemplo, no pueden ayudar de ninguna manera a sobrescribir los almacenados en la pila entre el b칰fer desbordado y la direcci칩n de retorno de las variables locales.  Y la funci칩n DhcpExtractFullOptions en cuesti칩n contiene varias variables potencialmente peligrosas en este intervalo. <br><br>  Nuevamente, escribimos a Microsoft sobre el error detectado.  Despu칠s de una breve correspondencia y un an치lisis de la aplicaci칩n, que tard칩 aproximadamente una semana, obtenemos la respuesta de que se est치 preparando un identificador CVE para la vulnerabilidad descrita, se planea lanzar una soluci칩n en marzo y alguien inform칩 anteriormente sobre la vulnerabilidad ya disponible en Microsoft.  El hecho, en t칠rminos generales, no es sorprendente, porque el error yace literalmente en la superficie, y los buffers que no contienen verificaciones de l칤mites de 칤ndices siempre atraen la atenci칩n primero y a menudo pueden detectarse mediante herramientas de an치lisis autom치tico. <br><br>  En marzo, como se anunci칩, se lanz칩 una actualizaci칩n para corregir el error descrito, que recibi칩 el identificador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE-2019-0697</a> .  El investigador previamente informado result칩 ser Mitch Adair, el mismo empleado de Microsoft que descubri칩 la vulnerabilidad DHCP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE-2019-0547</a> corregida en enero. <br><br>  <b>Publicado por</b> Mikhail Tsvetkov, Especialista en An치lisis de Aplicaciones de Tecnolog칤as Positivas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448600/">https://habr.com/ru/post/448600/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448580/index.html">CQ CQ CQ 춰Felices fiestas, radioaficionado! #WorldAmateurRadioDay</a></li>
<li><a href="../448584/index.html">7 errores comunes al usar preposiciones en ingl칠s y c칩mo evitarlos</a></li>
<li><a href="../448590/index.html">Extra침os familiares o una vez m치s sobre el uso de patrones de dise침o</a></li>
<li><a href="../448594/index.html">Antivirus y cortafuegos gratuitos (UTM, NGFW) de Sophos</a></li>
<li><a href="../448596/index.html">Soporte para tableta en la cinta de correr o busque pasos gratis</a></li>
<li><a href="../448602/index.html">쮼l monitoreo est치 muerto? - Larga vida al monitoreo</a></li>
<li><a href="../448604/index.html">Gameboy en C #</a></li>
<li><a href="../448606/index.html">Sidorin: KnowledgeConf trata sobre c칩mo mantener el conocimiento con una duraci칩n promedio de trabajo en un lugar en 2-3 a침os</a></li>
<li><a href="../448608/index.html">쮺칩mo dar los primeros pasos en rob칩tica?</a></li>
<li><a href="../448610/index.html">Bricolaje: c칩mo hicimos un calendario en vivo para Codefest X</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>