<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüíª üëàüèæ üßëüèæ‚Äçü§ù‚ÄçüßëüèΩ Terminales QIWI. C√≥mo aprovechar al m√°ximo las tecnolog√≠as simples üåÆ üëçüèº üë®‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A principios de 2017, nosotros, el equipo de desarrollo de software para QIWI Terminals, reunimos los deseos de los departamentos de la compa√±√≠a: apre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Terminales QIWI. C√≥mo aprovechar al m√°ximo las tecnolog√≠as simples</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/qiwi/blog/422631/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/e5/yt/wg/e5ytwgymlworvy2udox4piky1pw.png" align="left" width="200"></a>  A principios de 2017, nosotros, el equipo de desarrollo de software para QIWI Terminals, reunimos los deseos de los departamentos de la compa√±√≠a: aprendimos qu√© tareas globales les gustar√≠a resolver a nuestros colegas con nuestra ayuda, para que la vida sea m√°s f√°cil. <br><br>  Estuve muy satisfecho con la solicitud del servicio al cliente que trabaja con llamadas y reclamos de los pagadores: <br><br>  <i>‚ÄúHay un problema: el cliente realiza un pago en la terminal, pero a√∫n no llega al procesamiento, o la terminal podr√≠a congelarse o Internet que funciona a trav√©s del m√≥dem gsm se cay√≥.</i>  <i>Y resulta que el cliente tiene un cheque, pero no hay pago en el sistema.</i>  <i>Ser√≠a bueno en tales casos aprender c√≥mo entregar pagos a QIWI.</i> <i><br><br></i>  <i>Tambi√©n hay un grupo de clientes ansiosos que, inmediatamente despu√©s de hacer un pago, marcan el n√∫mero de un centro de llamadas para asegurarse de que todo est√© bien con √©l.</i>  <i>Ser√≠a genial cortar los huesos para esas llamadas ".</i> <br><br>  Por lo tanto, ten√≠amos una tarea compleja: aprender a crear un pago en caso de una falla de comunicaci√≥n con el terminal y reducir la cantidad de llamadas entrantes de los clientes al inventar una herramienta de autoservicio para verificar el estado del pago.  El caso es claro.  Comenzaron a buscar una soluci√≥n conveniente para el cliente y sin riesgos de seguridad. <br><a name="habracut"></a><br>  El cliente, seg√∫n la tradici√≥n, ofreci√≥ su opci√≥n: imprimir en el recibo una secuencia de caracteres que el pagador podr√≠a informar al operador y, a su vez, comprender si es nuestro pago o no, filtrar el fraude o realizar la operaci√≥n manualmente. <br><br>  El concepto de la idea era claro, pero irrealizable, por lo que fuimos un poco m√°s all√°: decidimos incrustar los datos de pago en el c√≥digo QR, imprimirlo en el recibo y duplicar el Terminal QIWI en la pantalla para mayor precisi√≥n.  Al escanear el c√≥digo QR con la c√°mara de su dispositivo, el cliente puede averiguar el estado de la operaci√≥n.  Y en caso de falta de pago en QIWI, el sistema lo crea autom√°ticamente.  Por lo tanto, el cliente no solo descubre si el dinero ha llegado, sino que tambi√©n lo realiza de forma independiente, independientemente del estado del terminal. <br><br>  A primera vista, la soluci√≥n era obvia: tomar una solicitud existente con el pago, envolverla en un c√≥digo QR, escribir una p√°gina web con informaci√≥n de transacciones y un proxy de microservicio de solicitudes entre el terminal, el procesamiento y la web.  Se asumi√≥ que el proyecto trabajar√° en los m√©todos existentes de autenticaci√≥n de terminal y utilizar√° los m√©todos de pago existentes en el procesamiento. <br><br>  La idea surgi√≥ de inmediato, revelando el potencial creativo del equipo.  Comenzamos a mostrar opciones adicionales hasta colocar un logotipo, eslogan e incluso publicidad en un c√≥digo QR adem√°s de los datos de pago: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5p/vy/dl/5pvydljqfmwsttqvkleyotnskfw.png" width="400" height="400" alt="imagen"></div><br>  Un proyecto para un par de sprints, no m√°s.  Ah√≠ estaba. <br><br><h3>  Primera frustraci√≥n </h3><br>  Tomamos un pago existente y formamos un c√≥digo QR en √©l: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yv/ti/pk/yvtipk6l6qkycshzycbfz8eyfu8.gif" alt="imagen" width="400" height="400"></div><br>  Como resultado, incluso el √∫ltimo iPhone7 en ese momento no pudo leerlo.  En el cheque, el c√≥digo QR, que consiste solo en datos de pago y firma, apenas cabe en la mitad de la hoja A4.  La l√≠nea de solicitud de pago era demasiado larga.  Esta fue la primera tristeza. <br><br>  Era necesario resolver dos problemas principales: <br><br><ul><li>  reducir el n√∫mero de caracteres en una solicitud de pago, es decir  idear una soluci√≥n en la que podamos alejarnos de la solicitud xml existente a una m√°s compacta; </li><li>  elija un algoritmo de cifrado y una longitud de clave que proporcione una alta seguridad criptogr√°fica y confiabilidad con un tama√±o de firma m√°s peque√±o. </li></ul><br>  El criterio para evaluar la cantidad √≥ptima de caracteres para el c√≥digo QR fue uno: debe leerse con las c√°maras de la mayor√≠a de los tel√©fonos m√≥viles. <br><br>  Sin embargo, en un par de reuniones de trabajo, se encontr√≥ una soluci√≥n: <br><br><ul><li>  en lugar de la solicitud xml, decidimos usar una solicitud get con par√°metros de pago y separadores entre ellos; </li><li>  construy√≥ una firma en curvas el√≠pticas para acortar la longitud. </li></ul><br>  La ventaja de utilizar la solicitud de obtenci√≥n fue que las c√°maras de tel√©fonos m√≥viles o programas especiales, al ver el enlace en el c√≥digo QR, lo abrieron inmediatamente en el navegador, lo que permiti√≥ realizar un pago en una sola acci√≥n.  Para reducir el tama√±o de la solicitud de obtenci√≥n, tuvimos que reemplazar el nombre del par√°metro con delimitadores. <br><br>  Como resultado del conjunto de acciones, la solicitud de pago se redujo de aproximadamente 1.100 a 200 caracteres.  Adem√°s, tuve que aplicar el nivel m√°s bajo de correcci√≥n de errores del c√≥digo QR: L. <br><br>  Para la implementaci√≥n, se requer√≠a desarrollar componentes en el sistema: <br><br><ul><li>  crear una nueva API para realizar pagos a trav√©s de un c√≥digo QR; </li><li>  introducir un nuevo mecanismo para trabajar con claves criptogr√°ficas entre el terminal y el procesamiento; </li><li>  implementar un microservicio en el que se suspender√° la funcionalidad de las solicitudes de representaci√≥n, la comprobaci√≥n de la integridad de los datos recibidos, as√≠ como la funci√≥n de bloquear solicitudes sospechosas y recopilar estad√≠sticas de operaci√≥n; </li><li>  desarrollar una p√°gina web para mostrar informaci√≥n de pago; </li><li>  Desarrolle un sistema de l√≠mites y controles para un nuevo canal de pago. </li></ul><br>  Al esquema de trabajo existente: <br><br><img src="https://habrastorage.org/webt/vh/wi/bf/vhwibfzt6s4hebqumpum7anrkv4.png" alt="imagen"><br><br>  Planeamos agregar una alternativa: <br><br><img src="https://habrastorage.org/webt/ze/75/au/ze75auougt6hzcrhryahnftqyca.png" alt="imagen"><br><br>  En el curso del proyecto, parecer√≠a, peque√±o, pero que requiere resolver problemas, lo que de hecho tom√≥ mucho tiempo, posponiendo la fecha de lanzamiento. <br><br><h3>  UX-research, o el trabajo vino de donde no esperaban </h3><br>  Quer√≠a hacer todo como las personas, por lo que trajeron especialistas en UX para implementar el proyecto para resolver problemas: <br><br><ul><li>  ¬øEn qu√© parte de la pantalla del Terminal QIWI colocar el c√≥digo QR y c√≥mo explicarle su utilidad al cliente? </li><li>  ¬øD√≥nde colocar el c√≥digo QR en el cheque y c√≥mo introducir explicaciones similares? </li><li>  ¬øC√≥mo hacer un dise√±o de una p√°gina web con el estado de pago, para que quede claro en las gu√≠as de la empresa? </li></ul><br>  Obviamente, para la parte avanzada de los clientes, no se requieren explicaciones adicionales sobre el c√≥digo QR, solo necesitan indicar el resultado.  Pero quer√≠amos cubrir esa parte de los clientes para quienes el c√≥digo QR es una abreviatura m√°gica o simplemente un "cuadrado negro".  Son ellos quienes, de hecho, rompen la l√≠nea del centro de llamadas. <br><br>  Para hacerlo bello y comprensible, se realiz√≥ una entrevista dentro del grupo focal que nos interesa con resultados inesperados ... <br><br><h3>  La brevedad es similar al ahorro </h3><br>  Result√≥ aterrador: la audiencia que necesit√°bamos no siempre entend√≠a el significado de la palabra "Escanear" y sus derivados.  Por lo tanto, la redacci√≥n original "Escanear y averiguar el estado" tuvo que ser abandonada.  La soluci√≥n fue la capacidad t√©cnica de enviar una foto del c√≥digo QR por correo electr√≥nico.  Y tambi√©n era necesario decir esto breve y claramente, porque la cinta de verificaci√≥n es el material prescindible de los propietarios de terminales y nuestra preocupaci√≥n por el negocio de estas personas es su econom√≠a.  Como resultado, el cheque ahora se ve as√≠: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1o/dr/yz/1odryzcvlubmpip1uvcd61tuuwi.png" alt="imagen" width="400" height="400"></div><br>  En cuanto a la visualizaci√≥n del c√≥digo QR en la pantalla del terminal, se coloc√≥ en la p√°gina final del pago, lo √∫ltimo en el escenario de pago.  Se muestra en el momento en que se imprime el cheque y es esencialmente un duplicado electr√≥nico del c√≥digo QR impreso. <br><br><h3>  El correo electr√≥nico es ubicuo </h3><br>  En relaci√≥n con la aparici√≥n de un nuevo canal para procesar c√≥digos QR en forma de correo electr√≥nico, se hizo necesario desarrollar mecanismos con la funci√≥n de reconocer los c√≥digos QR incrustados en las letras y generar una respuesta con el estado del pago. <br><br>  La funci√≥n de reconocer los c√≥digos QR se elimin√≥ en el microservicio.  En la implementaci√≥n inicial, la tasa de reconocimiento fue de alrededor del 65% en la muestra presentada de fotograf√≠as.  Intentamos jugar con decoloraci√≥n y mayor contraste, esto dio aproximadamente + 20% de reconocimiento exitoso. <br><br>  La guinda del pastel en la tarea de reconocer fotos del c√≥digo QR fue la introducci√≥n de "inteligencia natural" para casos dif√≠ciles y poco reconocidos: la creaci√≥n de aplicaciones y su procesamiento comenzaron a llevarse a cabo en modo manual: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/49/se/5g/49se5gbmtwhcusd4xolxybtfon8.png" alt="imagen" width="400" height="400"></div><br><h3>  T√©cnico no es trivial </h3><br>  Los principales desarrollos en este proyecto, por supuesto, se refer√≠an al microservicio en s√≠ y al software del terminal. <br><br>  QIWI se est√° moviendo activamente a una arquitectura de microservicio para no tocar el motor masivo.  Microservice le permite realizar cambios r√°pidamente en proyectos, realizar pruebas y lanzar lanzamientos.  Por lo tanto, en un par de meses escribimos el nuestro.  Nos ocupamos de todos los nuevos desarrollos importantes que solo se pod√≠an hacer: <br><br><ul><li>  proxying solicitudes analizando y analizando solicitudes get entrantes, convirti√©ndolas a xml para su procesamiento, </li><li>  funcionalidad para limitar las solicitudes entrantes de terminales, </li><li>  Funcionalidad de reconocimiento de c√≥digo QR, </li><li>  recopilaci√≥n de estad√≠sticas para su posterior an√°lisis. </li></ul><br>  Adem√°s de la implementaci√≥n de un nuevo mecanismo para trabajar con claves criptogr√°ficas, las mejoras en los terminales tocaron la aplicaci√≥n de una nueva tecnolog√≠a para imprimir recibos. <br><br>  La funcionalidad para su formaci√≥n se extrajo del n√∫cleo principal del programa en el complemento.  Ahora podr√≠amos implementar cambios en la verificaci√≥n r√°pidamente, sin tocar la operabilidad del terminal en su conjunto.  La tarea de imprimir un c√≥digo QR, que, a primera vista, parece bastante simple y se reduce a imprimir una imagen en un cheque, no es realmente as√≠. <br><br>  Esto se debe a que la red de nuestros propietarios de terminales tiene unos 20 modelos de una amplia variedad de impresoras, e imprimimos unos 40 tipos de recibos.  Cuando comenzaron la implementaci√≥n, surgieron muchos matices: las l√≠neas y la ubicaci√≥n de los objetos en la plantilla de verificaci√≥n comenzaron a flotar cuando se agreg√≥ la imagen, luego algunos comandos resultaron sensibles a la ubicaci√≥n, y luego el salto de l√≠nea se convirti√≥ en una pesta√±a. <br><br>  Comenzamos a probar, nos dimos cuenta de la necesidad de un compromiso: algunos modelos de impresoras tuvieron que ser excluidos, porque al probar todas las configuraciones, surgi√≥ una inmensa cantidad de casos. <br><br>  Para las pruebas, decidimos elegir 6 modelos principales, que cubr√≠an el 91% de la red de agentes.  Y, por supuesto, al momento de realizar pruebas aleatorias en un entorno de combate, result√≥ que fue en impresoras antiguas que cubr√≠an aproximadamente el 5% de la red de agentes que se descubrieron problemas con la impresi√≥n de recibos.  Los modelos eran tan antiguos que incluso en el mercado ya no pod√≠an comprarse.  Tuve que buscar con socios.  Ahora el proyecto cubre el 96% de la red.  Ya un poco m√°s cerca del ideal :) <br><br><h3>  Ni un solo cheque </h3><br>  Paralelamente a la colocaci√≥n de informaci√≥n sobre el c√≥digo QR en el cheque y la p√°gina final del pago, surgi√≥ otra tarea: llevar esta p√°gina a un aspecto universal para todos los proyectos de terminal: <br><br>  <i>‚ÄúEn t√©rminos de p√°ginas de finalizaci√≥n de pago en QIWI Terminals, todo fue bastante arcaico: publicidad, pancartas y env√≠o de recibos electr√≥nicos.</i>  <i>A partir de cinco p√°ginas, los chicos hicieron una, universal para todos los pagos ".</i>  - Programador l√≠der del equipo. <br><br>  Ahora esta p√°gina universal se usa en diferentes interpretaciones, sin romper la regla de construir un gui√≥n, cerrando la deuda k√°rmica del equipo de desarrollo. <br><br>  As√≠, se resolvi√≥ el problema de hace diez a√±os, al que las manos no llegaban siempre.  Hab√≠a varias tareas de larga duraci√≥n. <br><br><h3>  "¬øD√≥nde est√° el dinero, Zin?"  o lo que hay en la l√≠nea de fondo </h3><br>  El proyecto, dise√±ado para un par de sprints, tard√≥ seis meses, afectando los recursos de 10 empleados y el l√≠mite de la agencia de outsourcing. <br><br>  Como resultado, habiendo implementado el proyecto en el 85% de la red de terminales, nos sorprendimos a nosotros mismos y al servicio al cliente.  El tercer d√≠a del c√≥digo QR, los colegas pensaron que se les hab√≠a introducido un error del sistema: estad√≠sticas sobre la cantidad de llamadas al centro de llamadas con la pregunta "¬øD√≥nde est√° mi pago?"  Ya cay√≥ en un 20%.  Los clientes comenzaron a escanear el c√≥digo QR y a enviar recibos de fotos por correo electr√≥nico, descubriendo el estado y haciendo un pago por su cuenta.  Y as√≠, por segundo mes.  Debo decir que los clientes comenzaron a entender qu√© es el "cuadrado negro" y c√≥mo es √∫til. <br><br>  El proyecto con un c√≥digo QR fue del agrado de todos los que se les inform√≥ al respecto; fue una sinergia de intereses: por un lado, simplificaron la vida del cliente y, por otro, resolvieron un problema t√©cnico no est√°ndar.  Verificar el estado de un pago y llevarlo a cabo en un procesamiento de papel simplemente escaneando un c√≥digo QR para QIWI es algo nuevo.  Fue genial tomar tecnolog√≠as conocidas y simples para hacer un proyecto √∫til.  En general, el proyecto no solo impuls√≥ las habilidades, sino que tambi√©n mejor√≥ la comunicaci√≥n dentro del propio equipo.  Y esta es casi la principal ventaja del karma. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es422631/">https://habr.com/ru/post/es422631/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422617/index.html">Toda la verdad sobre RTOS. Art√≠culo # 8. Nucleus SE: dise√±o interno y despliegue</a></li>
<li><a href="../es422623/index.html">C√≥mo asegurar C</a></li>
<li><a href="../es422625/index.html">Hablamos con Troy Miles, el programador de "Neuromancer"</a></li>
<li><a href="../es422627/index.html">MongoDB y la investigaci√≥n de mercado de trabajo de TI</a></li>
<li><a href="../es422629/index.html">¬°Deja de alimentar a los madereros! ¬°Da m√°s modificadores! Campos finales est√°ticos perezosos. Borrador de croquis de funciones</a></li>
<li><a href="../es422633/index.html">C√≥mo automatizamos el monitoreo del trabajo de los empleados de la red federal de estaciones de servicio</a></li>
<li><a href="../es422635/index.html">A√∫n no has dicho la palabra "hola" y ya sabemos a qui√©n</a></li>
<li><a href="../es422637/index.html">Regalo de geek: protecci√≥n autom√°tica</a></li>
<li><a href="../es422641/index.html">Noche polar, bombeo de agua y caja fuerte inteligente: 5 proyectos de estudiantes en el campo de IoT</a></li>
<li><a href="../es422643/index.html">Nuevos dispositivos con IFA 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>