<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêê üíì üîå Kode untuk permintaan API dan cara menyusun kode üëåüèª üë©üèª‚ÄçüöÄ üö•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 

 Dimulai dengan Swift 4, kami memiliki akses ke protokol Codable baru, yang membuatnya mudah untuk menyandikan / mendekodekan model. Pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kode untuk permintaan API dan cara menyusun kode</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427937/"> Halo, Habr! <br><br>  Dimulai dengan Swift 4, kami memiliki akses ke protokol Codable baru, yang membuatnya mudah untuk menyandikan / mendekodekan model.  Proyek saya memiliki banyak kode untuk panggilan API, dan selama setahun terakhir saya telah melakukan banyak pekerjaan untuk mengoptimalkan array kode yang sangat besar ini menjadi sesuatu yang sangat ringan, ringkas dan sederhana dengan membunuh kode berulang dan menggunakan Codable bahkan untuk permintaan multi bagian dan parameter kueri url.  Ternyata beberapa kelas yang sangat baik menurut pendapat saya untuk mengirim permintaan dan mem-parsing tanggapan dari server.  Serta struktur file yang nyaman, yang merupakan pengendali untuk setiap kelompok permintaan, yang saya ambil root saat menggunakan Vapor 3 di backend.  Beberapa hari yang lalu, saya mengalokasikan semua perkembangan saya ke perpustakaan terpisah dan menamainya CodyFire.  Saya ingin berbicara tentang dia di artikel ini. <br><a name="habracut"></a><br><h4>  Penafian </h4><br>  CodyFire didasarkan pada Alamofire, tetapi lebih dari sekadar pembungkus di Alamofire, ini adalah pendekatan seluruh sistem untuk bekerja dengan REST API untuk iOS.  Itu sebabnya saya tidak khawatir Alamofire menggergaji versi kelima di mana akan ada dukungan Codable, karena  itu tidak akan membunuh kreasi saya. <br><br><h2>  Inisialisasi </h2><br>  Mari kita mulai dari jauh, yaitu bahwa kita sering memiliki tiga server: <br><br>  <b>dev</b> - untuk pengembangan, apa yang kita mulai dari Xcode <br>  <b>tahap</b> - untuk pengujian sebelum rilis, biasanya di TestFlight atau InHouse <br>  <b>prod</b> - produksi, untuk AppStore <br><br>  Dan banyak pengembang iOS, tentu saja, menyadari keberadaan <i>Variabel Lingkungan</i> dan skema startup di Xcode, tetapi selama praktik saya (8+ tahun), 90% pengembang secara manual menulis server yang tepat dalam beberapa konstanta saat pengujian, atau sebelum perakitan, dan ini adalah apa yang ingin saya perbaiki dengan menunjukkan contoh yang baik tentang bagaimana melakukannya dengan benar. <br><br>  Secara default, CodyFire secara otomatis menentukan di lingkungan mana aplikasi sedang berjalan, itu membuatnya sangat sederhana: <br><br><pre><code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> DEBUG //DEV environment #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> Bundle.main.appStoreReceiptURL?.lastPathComponent == "sandboxReceipt" { //TESTFLIGHT environment } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { //APPSTORE environment } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre> <br>  Ini tentu saja di bawah tenda, dan dalam proyek di AppDelegate Anda hanya perlu mendaftarkan tiga URL <br><br><pre> <code class="hljs objectivec">import CodyFire @<span class="hljs-built_in"><span class="hljs-built_in">UIApplicationMain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AppDelegate: <span class="hljs-built_in"><span class="hljs-built_in">UIResponder</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIApplicationDelegate</span></span> { func application(_ application: <span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span>, didFinishLaunchingWithOptions launchOptions: [<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span>.LaunchOptionsKey : Any]? = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) -&gt; Bool { let dev = CodyFireEnvironment(baseURL: <span class="hljs-string"><span class="hljs-string">"http://localhost:8080"</span></span>) let testFlight = CodyFireEnvironment(baseURL: <span class="hljs-string"><span class="hljs-string">"https://stage.myapi.com"</span></span>) let appStore = CodyFireEnvironment(baseURL: <span class="hljs-string"><span class="hljs-string">"https://api.myapi.com"</span></span>) CodyFire.shared.configureEnvironments(dev: dev, testFlight: testFlight, appStore: appStore) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br>  Dan orang bisa senang dengan ini dan tidak melakukan apa pun. <br><br>  Tetapi dalam kehidupan nyata, kita sering perlu menguji server dev, stage dan prod dalam Xcode, dan untuk ini saya mendorong Anda untuk menggunakan skema startup. <br><br><img src="https://habrastorage.org/webt/u_/rp/t_/u_rpt_jk71avrzwwasrgviv7rgk.png" alt="gambar"><br><blockquote>  <i>Kiat: di bagian <i>Kelola skema</i> , jangan lupa untuk memeriksa kotak centang `shared` untuk setiap skema sehingga tersedia untuk semua pengembang di proyek.</i> </blockquote><br>  Dalam setiap skema, Anda perlu menulis variabel lingkungan `env` yang dapat mengambil tiga nilai: dev, testFlight, appStore. <br><br><img src="https://habrastorage.org/webt/ur/j4/ee/urj4eeqtonszxwlo8uv-w8fdt4a.png" alt="gambar"><br><br>  Dan agar skema ini berfungsi dengan CodyFire, Anda perlu menambahkan kode berikut ke <i>AppDelegate.didFinishLaunchingWithOptions</i> setelah menginisialisasi CodyFire <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">CodyFire</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.shared</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.setupEnvByProjectScheme</span></span>()</code> </pre> <br>  Selain itu, seringkali bos atau penguji proyek Anda mungkin meminta Anda untuk mengganti server dengan cepat di suatu tempat di <i>LoginScreen</i> .  Dengan CodyFire, Anda dapat dengan mudah menerapkan ini dengan mengganti server dalam satu baris, mengubah lingkungan: <br><br><pre> <code class="hljs vhdl">CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.environmentMode = .appStore</code> </pre> <br><blockquote>  Ini akan berfungsi sampai aplikasi di-restart, dan jika Anda ingin disimpan setelah peluncuran, simpan nilai di <i>UserDefaults</i> , lakukan pemeriksaan ketika aplikasi dimulai di <i>AppDelegate</i> dan alihkan lingkungan ke yang diperlukan. </blockquote>  Saya mengatakan poin penting ini, saya berharap akan ada lebih banyak proyek di mana peralihan lingkungan akan dilakukan dengan indah.  Dan pada saat yang sama, kami telah menginisialisasi perpustakaan. <br><br><h2>  Struktur dan Pengontrol File </h2><br>  Sekarang Anda dapat berbicara tentang visi saya tentang struktur file untuk semua panggilan API, ini bisa disebut ideologi CodyFire. <br><br>  Mari kita lihat bagaimana akhirnya terlihat dalam proyek <br><br><img src="https://habrastorage.org/webt/0f/pn/l8/0fpnl8_sb2a6uhivnubvfwdgddy.png" alt="gambar"><br><br>  Sekarang mari kita lihat daftar file, mari mulai dengan <i>API.swift</i> . <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">API</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> auth = <span class="hljs-type"><span class="hljs-type">AuthController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> post = <span class="hljs-type"><span class="hljs-type">PostController</span></span> }</code> </pre><br>  Tautan ke semua pengontrol terdaftar di sini sehingga mereka dapat dengan mudah dipanggil melalui `API.controller.method`. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthController</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre><br>  <i>API + Login. Cepat</i> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginResponse</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token: <span class="hljs-type"><span class="hljs-type">String</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(email: String, password: String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>&lt;<span class="hljs-type"><span class="hljs-type">LoginResponse</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>(<span class="hljs-string"><span class="hljs-string">"login"</span></span>).method(.post) .basicAuth(email: email, password: password) .addCustomError(.notFound, <span class="hljs-string"><span class="hljs-string">"User not found"</span></span>) } }</code> </pre><br>  Di dekorator ini, kami mendeklarasikan fungsi untuk memanggil API kami: <br><br>  - tentukan titik akhir <br>  - Metode HTTP POST <br>  - Gunakan pembungkus untuk otentikasi dasar <br>  - mendeklarasikan teks yang diinginkan untuk respons spesifik dari server (ini nyaman) <br>  - dan menunjukkan model dimana data akan diterjemahkan <br><br>  Apa yang masih tersembunyi? <br><br>  - tidak perlu menentukan URL server lengkap, karena  sudah diatur secara global <br>  - tidak harus menunjukkan bahwa kami berharap menerima <i>200 OK</i> jika semuanya baik-baik saja <br><blockquote>  200 OK adalah kode status default yang diharapkan oleh CodyFire untuk semua permintaan, di mana data kasus diterjemahkan dan panggilan balik dipanggil, bahwa semuanya baik-baik saja, di sini adalah data Anda. </blockquote>  Lebih lanjut, di suatu tempat dalam kode untuk <i>Layar Masuk</i> Anda <i>,</i> Anda dapat memanggil <br><br><pre> <code class="hljs lua">API.auth.login(email: <span class="hljs-string"><span class="hljs-string">"test@mail.com"</span></span>, password: <span class="hljs-string"><span class="hljs-string">"qwerty"</span></span>).onError { <span class="hljs-built_in"><span class="hljs-built_in">error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch <span class="hljs-built_in"><span class="hljs-built_in">error</span></span>.code { case .notFound: <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>.description) //: User <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found default: <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>.description) } }.onSuccess { token <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //TODO:  auth token    <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Received auth token: "</span></span>+ token) }</code> </pre><br>  <i>onError</i> dan <i>onSuccess</i> hanyalah sebagian kecil dari panggilan balik yang dapat dikembalikan oleh APIR, kita akan membicarakannya nanti. <br><br>  Dalam contoh input, kami hanya mempertimbangkan opsi ketika data yang dikembalikan diterjemahkan secara otomatis, tetapi Anda dapat mengatakan bahwa Anda sendiri dapat mengimplementasikannya, dan Anda akan benar.  Karena itu, mari pertimbangkan kemungkinan pengiriman data pada model menggunakan formulir pendaftaran sebagai contoh. <br><br>  <i>API + Signup.swift</i> <br><br><pre> <code class="hljs rust">extension AuthController { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignupRequest</span></span></span></span>: JSONPayload { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> email, password: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstName, lastName, mobileNumber: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> init(email: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, password: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, firstName: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, lastName: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, mobileNumber: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.email = email <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.password = password <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.firstName = firstName <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.lastName = lastName <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mobileNumber = mobileNumber } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignupResponse</span></span></span></span>: Codable { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> token: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> func signup(_ request: SignupRequest) -&gt; APIRequest&lt;SignupResponse&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> APIRequest(<span class="hljs-string"><span class="hljs-string">"signup"</span></span>, payload: request).method(.post) .addError(.conflict, <span class="hljs-string"><span class="hljs-string">"Account already exists"</span></span>) } }</code> </pre><br>  Tidak seperti login, saat pendaftaran kami mengirimkan sejumlah besar data. <br><br>  Dalam contoh ini, kami memiliki model <i>SignupRequest</i> yang sesuai dengan protokol <i>JSONPayload</i> (sehingga CodyFire memahami tipe payload) sehingga isi permintaan kami adalah dalam bentuk JSON.  Jika Anda perlu x-www-form-urlencoded, maka gunakan <i>FormURLEncodedPayload</i> . <br><br>  Hasilnya, Anda mendapatkan fungsi sederhana yang menerima model payload <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">API</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.auth</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.signup</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">request</span></span>)</code> </pre> <br>  dan yang, jika berhasil, akan mengembalikan model respons spesifik kepada Anda. <br><br>  Saya pikir itu keren, bukan? <br><br><h4>  Tetapi bagaimana jika multipart? </h4><br>  Mari kita lihat contoh ketika Anda dapat membuat <i>Posting</i> . <br><br>  <i>Posting + Buat.segera</i> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateRequest</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultipartPayload</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tags: [<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> images: [<span class="hljs-type"><span class="hljs-type">Attachment</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> video: <span class="hljs-type"><span class="hljs-type">Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> (text: <span class="hljs-type"><span class="hljs-type">String</span></span>, tags: [<span class="hljs-type"><span class="hljs-type">String</span></span>], images: [<span class="hljs-type"><span class="hljs-type">Attachment</span></span>], video: <span class="hljs-type"><span class="hljs-type">Data</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.text = text <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.tags = tags <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.images = images <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.video = video } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tags: [<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> linksToImages: [<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> linkToVideo: <span class="hljs-type"><span class="hljs-type">String</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> request: CreateRequest)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>&lt;<span class="hljs-type"><span class="hljs-type">CreateRequest</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>(<span class="hljs-string"><span class="hljs-string">"post"</span></span>, payload: request).method(.post) } }</code> </pre><br>  Kode ini akan dapat mengirim formulir multi bagian dengan larik file gambar dan dengan satu video. <br>  Mari kita lihat cara menelepon pengiriman.  Inilah momen paling menarik tentang <i>Lampiran</i> . <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> videoData = <span class="hljs-type"><span class="hljs-type">FileManager</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.contents(atPath: <span class="hljs-string"><span class="hljs-string">"/path/to/video.mp4"</span></span>)! <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> imageAttachment = <span class="hljs-type"><span class="hljs-type">Attachment</span></span>(data: <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"cat"</span></span>)!.jpeg(.high)!, fileName: <span class="hljs-string"><span class="hljs-string">"cat.jpg"</span></span>, mimeType: .jpg) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> payload = <span class="hljs-type"><span class="hljs-type">PostController</span></span>.<span class="hljs-type"><span class="hljs-type">CreateRequest</span></span>(text: <span class="hljs-string"><span class="hljs-string">"CodyFire is awesome"</span></span>, tags: [<span class="hljs-string"><span class="hljs-string">"codyfire"</span></span>, <span class="hljs-string"><span class="hljs-string">"awesome"</span></span>], images: [imageAttachment], video: videoData) <span class="hljs-type"><span class="hljs-type">API</span></span>.post.create(payload).onProgress { progress <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" : \(progress)"</span></span>) }.onError { error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error.description) }.onSuccess { createdPost <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"  : \(createdPost)"</span></span>) }</code> </pre><br>  <i>Lampiran</i> adalah model di mana, selain <i>Data,</i> nama file dan MimeType-nya juga ditransmisikan. <br><br>  Jika Anda pernah mengirimkan formulir multi bagian dari Swift menggunakan Alamofire atau <i>URLRequest</i> telanjang <i>,</i> saya yakin Anda akan menghargai kesederhanaan <i>CodyFire</i> . <br><br>  Sekarang contoh sederhana dari GET panggilan. <br><br>  <i>Posting + Get.swift</i> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListQuery</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> offset, limit: <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> (offset: <span class="hljs-type"><span class="hljs-type">Int</span></span>, limit: <span class="hljs-type"><span class="hljs-type">Int</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.offset = offset <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.limit = limit } } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> query: ListQuery? = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">nil</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>&lt;[<span class="hljs-type"><span class="hljs-type">Post</span></span>]&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>(<span class="hljs-string"><span class="hljs-string">"post"</span></span>).query(query) } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: UUID)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Post</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>(<span class="hljs-string"><span class="hljs-string">"post/"</span></span> + id.uuidString) } }</code> </pre><br>  Contoh paling sederhana adalah <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">API</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.post</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.get</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">id</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:)</span></span></code> </pre> <br>  yang di <i>onSuccess</i> akan mengembalikan model <i>Post</i> kepada Anda. <br><br>  Berikut ini contoh yang lebih menarik. <br><br><pre> <code class="hljs pgsql">API.post.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(PostController.ListQuery(<span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>))</code> </pre> <br>  yang mengambil model <i>ListQuery</i> sebagai input, <br>  yang akhirnya diajukan APIR ke jalur URL formulir <br><br><pre> <code class="hljs pgsql">post?<span class="hljs-keyword"><span class="hljs-keyword">limit</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>&amp;<span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>=<span class="hljs-number"><span class="hljs-number">100</span></span></code> </pre> <br>  dan akan mengembalikan array <i>[Posting]</i> ke <i>onSuccess</i> . <br><br>  Tentu saja, Anda dapat menulis jalur URL dengan cara lama, tetapi sekarang Anda tahu bahwa Anda dapat sepenuhnya Codable. <br><br>  Permintaan contoh terakhir akan HAPUS <br><br>  <i>Posting + Delete.swift</i> <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: UUID)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Nothing</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">APIRequest</span></span>(<span class="hljs-string"><span class="hljs-string">"post/"</span></span> + id.uuidString) .method(.delete) .desiredStatusCode(.noContent) } }</code> </pre><br>  Ada dua hal menarik. <br><br>  - tipe kembalinya adalah APIRequest, ini menentukan tipe generik <i>Nothing</i> , yang merupakan model <i>Codable</i> kosong. <br>  - kami secara eksplisit menunjukkan bahwa kami berharap menerima 204 TANPA KONTEN, dan CodyFire hanya akan memanggil <i>onSuccess</i> dalam kasus ini. <br><br>  Anda sudah tahu cara memanggil titik akhir ini dari ViewController Anda. <br><br>  Tetapi ada dua opsi, yang pertama dengan <i>onSuccess</i> , dan yang kedua tanpa.  Kami akan melihatnya <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">API</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.post</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.delete</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">id</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:).execute()</span></span></code> </pre> <br>  Artinya, jika itu tidak masalah bagi Anda apakah permintaannya <i>berhasil</i> , Anda dapat memanggil <i>.execute () di atasnya</i> dan hanya itu, jika tidak maka akan dimulai setelah deklarasi handler <i>onSuccess</i> dari handler. <br><br><h2>  Fungsi yang tersedia </h2><br><h4>  Otorisasi setiap permintaan </h4><br>  Untuk menandatangani setiap API permintaan dengan header http apa pun, penangan global digunakan, yang dapat Anda atur di <i>AppDelegate</i> .  Selain itu, Anda dapat menggunakan model [String: String] atau Codable klasik untuk dipilih. <br><br>  Contoh untuk Pembawa Otorisasi. <br><br>  1. Codable (merekomendasikan) <br><pre> <code class="hljs ruby">CodyFire.shared.fillCodableHeaders = { struct <span class="hljs-symbol"><span class="hljs-symbol">Headers:</span></span> Codable { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-symbol"><span class="hljs-symbol">NOTE:</span></span>  <span class="hljs-literal"><span class="hljs-literal">nil</span></span>,     headers var <span class="hljs-symbol"><span class="hljs-symbol">Authorization:</span></span> String? var <span class="hljs-symbol"><span class="hljs-symbol">anythingElse:</span></span> String } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Headers(<span class="hljs-symbol"><span class="hljs-symbol">Authorization:</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">anythingElse:</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span>) }</code> </pre><br>  2. Klasik [String: String] <br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">CodyFire</span></span>.shared.fillHeaders = { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> apiToken = <span class="hljs-type"><span class="hljs-type">LocalAuthStorage</span></span>.savedToken <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [:] } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bearer \(apiToken)"</span></span>] }</code> </pre><br><h4>  Tambahkan beberapa http-header secara selektif ke permintaan </h4><br>  Ini dapat dilakukan saat membuat Permintaan APIR, misalnya: <br><br><pre> <code class="hljs powershell">APIRequest(<span class="hljs-string"><span class="hljs-string">"some/endpoint"</span></span>).headers([<span class="hljs-string"><span class="hljs-string">"someKey"</span></span>: <span class="hljs-string"><span class="hljs-string">"someValue"</span></span>])</code> </pre> <br><h4>  Menangani Permintaan Tidak Resmi </h4><br>  Anda dapat memprosesnya secara global, misalnya di <i>AppDelegate</i> <br><br><pre> <code class="hljs objectivec">CodyFire.shared.unauthorizedHandler = { <span class="hljs-comment"><span class="hljs-comment">//   WelcomeScreen }</span></span></code> </pre><br>  atau secara lokal di setiap permintaan <br><br><pre> <code class="hljs objectivec">API.post.create(request).onNotAuthorized { <span class="hljs-comment"><span class="hljs-comment">//   }</span></span></code> </pre><br><h4>  Jika jaringan tidak tersedia </h4><br><pre> <code class="hljs objectivec">API.post.create(request). onNetworkUnavailable { <span class="hljs-comment"><span class="hljs-comment">//   ,  ,     }</span></span></code> </pre>  jika tidak di <i>onError</i> Anda mendapatkan kesalahan <i>._notConnectedToInternet</i> <br><br><h4>  Mulai sesuatu sebelum permintaan dimulai </h4><br>  Anda dapat mengatur <i>.onRequestStarted</i> dan mulai menunjukkan, misalnya, sebuah loader di dalamnya. <br>  Ini adalah tempat yang nyaman, karena tidak dipanggil jika Internet tidak tersedia, dan Anda tidak perlu menunjukkan loader secara gratis, misalnya. <br><br><h4>  Cara menonaktifkan / mengaktifkan log output secara global </h4><br><pre> <code class="hljs vhdl">CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.logLevel = .debug CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.logLevel = .<span class="hljs-literal"><span class="hljs-literal">error</span></span> CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.logLevel = .info CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.logLevel = .off</code> </pre><br><h4>  Cara menonaktifkan log output untuk satu permintaan </h4><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.avoidLogError</span></span>()</code> </pre> <br><h4>  Memproses log dengan cara Anda sendiri </h4><br><pre> <code class="hljs pgsql">CodyFire.shared.logHandler = { <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, <span class="hljs-type"><span class="hljs-type">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> print("  CodyFire: " + <span class="hljs-type"><span class="hljs-type">text</span></span>) }</code> </pre><br><h4>  Cara mengatur kode respons http yang diharapkan dari server </h4><br>  Seperti yang saya katakan di atas, secara default, CodyFire mengharapkan untuk menerima <i>200 OK,</i> dan jika ya, ia mulai mengurai data dan memanggil <i>onSuccess</i> . <br><br>  Tetapi kode yang diharapkan dapat diatur dalam bentuk enum yang nyaman, misalnya, untuk <i>201 CREATED</i> <br><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.desiredStatusCode</span></span>(<span class="hljs-selector-class"><span class="hljs-selector-class">.created</span></span>)</code> </pre><br>  atau Anda bahkan dapat mengatur kode yang diharapkan khusus <br><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.desiredStatusCode</span></span>(<span class="hljs-selector-class"><span class="hljs-selector-class">.custom</span></span>(777))</code> </pre><br><h4>  Batalkan permintaan </h4><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.cancel</span></span>()</code> </pre><br>  dan Anda dapat mengetahui bahwa permintaan dibatalkan dengan menyatakan penangan <i>.onCancellation</i> <br><br><pre> <code class="hljs objectivec">.onCancellation { <span class="hljs-comment"><span class="hljs-comment">//   }</span></span></code> </pre><br>  jika tidak <i>onError</i> akan <i>dimunculkan</i> <br><br><h4>  Mengatur batas waktu untuk permintaan </h4><br><pre> <code class="hljs objectivec">.responseTimeout(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   30 </span></span></code> </pre><br>  seorang pawang juga dapat digantung pada acara timeout <br><br><pre> <code class="hljs objectivec">. onTimeout { <span class="hljs-comment"><span class="hljs-comment">//    }</span></span></code> </pre><br>  jika tidak <i>onError</i> akan <i>dimunculkan</i> <br><br><h4>  Mengatur Batas Waktu Ekstra Interaktif </h4><br>  Ini adalah fitur favorit saya.  Salah satu pelanggan dari AS pernah bertanya kepada saya tentang dia, karena  dia tidak suka bahwa formulir masuknya bekerja terlalu cepat, menurutnya itu tidak terlihat alami, seolah-olah itu palsu, bukan otorisasi. <br><br>  Idenya adalah bahwa ia ingin pemeriksaan email / kata sandi berlangsung 2 detik atau lebih.  Dan jika itu hanya berlangsung 0,5 detik, maka Anda perlu melempar 1,5 dan hanya kemudian memanggil <i>Proses berhasil</i> .  Dan jika dibutuhkan tepat 2 atau 2,5 detik, maka panggil <i>onSuccess</i> segera. <br><br><pre> <code class="hljs objectivec">.additionalTimeout(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment">// 2    </span></span></code> </pre><br><h4>  Encoder / dekoder <i>Tanggal</i> Kustom </h4><br>  CodyFire memiliki enum <i>DateCodingStrategy</i> sendiri, di mana ada tiga nilai <br><br>  - detikSejak tahun1970 <br>  - milidetik Sejak 1970 <br>  - diformat (_ customDateFormatter: DateFormatter) <br><br>  <i>DateCodingStrategy</i> dapat diatur dalam tiga cara dan secara terpisah untuk decoding dan encoding <br>  - secara global di <i>AppDelegate</i> <br><br><pre> <code class="hljs vhdl">CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.dateEncodingStrategy = .secondsSince1970 let customDateFormatter = DateFormatter() CodyFire.<span class="hljs-keyword"><span class="hljs-keyword">shared</span></span>.dateDecodingStrategy = .formatted(customDateFormatter)</code> </pre><br>  - untuk satu permintaan <br><br><pre> <code class="hljs objectivec">APIRequest(<span class="hljs-string"><span class="hljs-string">"some/endpoint"</span></span>) .dateDecodingStrategy(.millisecondsSince1970) .dateEncodingStrategy(.secondsSince1970)</code> </pre><br>  - atau bahkan secara terpisah untuk setiap model, Anda hanya perlu model yang cocok dengan <i>CustomDateEncodingStrategy</i> dan / atau <i>CustomDateDecodingStrategy</i> . <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomePayload</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JSONPayload</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomDateEncodingStrategy</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomDateDecodingStrategy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dateEncodingStrategy: <span class="hljs-type"><span class="hljs-type">DateCodingStrategy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dateDecodingStrategy: <span class="hljs-type"><span class="hljs-type">DateCodingStrategy</span></span> }</code> </pre><br><h2>  Cara menambahkan ke proyek </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Perpustakaan tersedia di GitHub di bawah lisensi MIT.</a> <br><br>  Instalasi saat ini hanya tersedia melalui CocoaPods <br><pre> <code class="ruby hljs">pod <span class="hljs-string"><span class="hljs-string">'CodyFire'</span></span></code> </pre> <br><br>  Saya sangat berharap bahwa CodyFire akan bermanfaat bagi pengembang iOS lainnya, ini akan menyederhanakan pengembangan untuk mereka, dan secara umum akan membuat dunia sedikit lebih baik dan orang-orang ramah. <br><br>  Itu saja, terima kasih atas waktu Anda. <br><br>  <b>UPD: Dukungan ReactiveCocoa dan RxSwift ditambahkan</b> <br><pre> <code class="ruby hljs">pod <span class="hljs-string"><span class="hljs-string">'ReactiveCodyFire'</span></span> <span class="hljs-comment"><span class="hljs-comment"># ReactiveCocoa pod 'RxCodyFire' # RxSwift #      'CodyFire',    </span></span></code> </pre><br>  <u>APIRequest</u> untuk ReactiveCoca akan memiliki <i>.signalProducer</i> , dan untuk RxSwift <i>.observable</i> <br><br>  <b>UPD2: Sekarang Anda dapat menjalankan beberapa permintaan</b> <br>  Jika penting bagi Anda untuk mendapatkan hasil dari setiap permintaan, gunakan <i>.and ()</i> <br>  Maksimum dalam mode ini, Anda dapat menjalankan hingga 10 permintaan, mereka akan dieksekusi secara ketat satu demi satu. <br><pre> <code class="hljs pgsql">API.employee.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>() .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>(API.office.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>()) .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>(API.car.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>()) .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>(API.event.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>()) .<span class="hljs-keyword"><span class="hljs-keyword">and</span></span>(API.post.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>()) .onError { error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> print(error.description) }.onSuccess { employees, offices, cars, events, posts <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //    !!! }</code> </pre><br>  <i>onRequestStarted, onNetworkUnavailable, onCancellation, onNotAuthorized, onTimeout</i> juga tersedia. <br>  <i>onProgress</i> - masih dalam pengembangan <br><br>  Jika Anda tidak peduli dengan hasil kueri Anda, Anda dapat menggunakan <i>.flatten ()</i> <br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">API.employee.all</span></span>(), <span class="hljs-type"><span class="hljs-type">API.office.all</span></span>(), <span class="hljs-type"><span class="hljs-type">API.car.all</span></span>()].flatten().onError { print(error.description) }.onSuccess { print(<span class="hljs-string"><span class="hljs-string">"flatten finished!"</span></span>) }</code> </pre>  Untuk menjalankannya pada saat yang sama cukup tambahkan <i>.concurrent (dengan: 3)</i> ini akan memungkinkan tiga permintaan untuk dieksekusi secara bersamaan, nomor apa pun dapat ditentukan. <br>  Untuk melewati kesalahan kueri yang gagal, tambahkan <i>.avoidCancelOnError ()</i> <br>  Untuk mendapatkan kemajuan, tambahkan <i>.onProgress</i> <br><br>  <b>UPD3: sekarang Anda dapat mengatur server terpisah untuk setiap permintaan</b> <br>  Penting untuk membuat alamat server yang diperlukan di suatu tempat, misalnya seperti ini <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> server1 = ServerURL(<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>: <span class="hljs-string"><span class="hljs-string">"https://server1.com"</span></span>, path: <span class="hljs-string"><span class="hljs-string">"v1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> server2 = ServerURL(<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>: <span class="hljs-string"><span class="hljs-string">"https://server2.com"</span></span>, path: <span class="hljs-string"><span class="hljs-string">"v1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> server3 = ServerURL(<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>: <span class="hljs-string"><span class="hljs-string">"https://server3.com"</span></span>)</code> </pre>  Dan sekarang Anda dapat menggunakannya tepat di inisialisasi permintaan sebelum menentukan titik akhir <br><pre> <code class="hljs lisp">APIRequest(<span class="hljs-name"><span class="hljs-name">server1</span></span>, <span class="hljs-string"><span class="hljs-string">"endpoint"</span></span>, payload: payloadObject) APIRequest(<span class="hljs-name"><span class="hljs-name">server2</span></span>, <span class="hljs-string"><span class="hljs-string">"endpoint"</span></span>, payload: payloadObject) APIRequest(<span class="hljs-name"><span class="hljs-name">server3</span></span>, <span class="hljs-string"><span class="hljs-string">"endpoint"</span></span>, payload: payloadObject)</code> </pre>  atau Anda dapat menentukan server setelah menginisialisasi permintaan <br><pre> <code class="hljs objectivec">APIRequest(<span class="hljs-string"><span class="hljs-string">"endpoint"</span></span>, payload: payloadObject).serverURL(server1)</code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id427937/">https://habr.com/ru/post/id427937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id427927/index.html">B - Kebrutalan. Situs resmi Federasi Tenis Meja Republik Bashkortostan (FTN RB)</a></li>
<li><a href="../id427929/index.html">Kementerian Tenaga Kerja: tugas uji adalah hubungan kerja</a></li>
<li><a href="../id427931/index.html">Arsitektur Informasi Internet Bagian 4</a></li>
<li><a href="../id427933/index.html">Opini Pengembang Steam: Pendapatan Maksimum dan Tanggung Jawab Rendah untuk Valve</a></li>
<li><a href="../id427935/index.html">Menginstal ulang Windows 8 prainstal pada akhir 2018</a></li>
<li><a href="../id427939/index.html">Memperlakukan FHRP routing asymmetric</a></li>
<li><a href="../id427941/index.html">Menyebarkan Kubernetes HA-cluster pada Baremetal menggunakan Kubeadm dan Keepalived (panduan sederhana)</a></li>
<li><a href="../id427943/index.html">Kami sedang menunggu TV LG OLED seri 8K pada bulan Juni 2019, rilisnya mungkin tertunda</a></li>
<li><a href="../id427945/index.html">Hypervisor untuk Dummies</a></li>
<li><a href="../id427947/index.html">Jaringan saraf tidak mengerti apa itu ilusi optik.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>