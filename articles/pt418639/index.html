<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòé üåê ü•å Akka Streams para meros mortais üë®üèΩ‚Äçüç≥ üêâ üôá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como posso imprimir um fluxo cont√≠nuo de mensagens do Twitter com algumas linhas de c√≥digo adicionando dados meteorol√≥gicos aos locais onde seus autor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Akka Streams para meros mortais</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/418639/">  Como posso imprimir um fluxo cont√≠nuo de mensagens do Twitter com algumas linhas de c√≥digo adicionando dados meteorol√≥gicos aos locais onde seus autores moram?  E como voc√™ pode limitar a velocidade das solicita√ß√µes ao provedor meteorol√≥gico para que elas n√£o nos incluam na lista negra? <br><br>  Hoje, mostraremos como faz√™-lo, mas primeiro conheceremos a tecnologia Akka Streams, que torna o trabalho com fluxos de dados em tempo real t√£o f√°cil quanto os programadores que trabalham com express√µes LINQ sem exigir a implementa√ß√£o de atores individuais ou interfaces de fluxos reativos. . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ibpnza_PCr0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  O artigo √© baseado em uma transcri√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio de Vagif Abilov</a> da nossa confer√™ncia de dezembro DotNext 2017 em Moscou. <br><a name="habracut"></a><br>  Meu nome √© Vagif, trabalho para a empresa norueguesa Miles.  Hoje falaremos sobre a biblioteca do Akka Streams. <br><br>  Akka e Reative Streams s√£o a interse√ß√£o de conjuntos bastante estreitos, e pode-se ter a impress√£o de que esse √© um nicho que voc√™ precisa ter um grande conhecimento para entrar, mas exatamente o oposto.  E este artigo pretende mostrar que, usando o Akka Streams, voc√™ pode evitar a programa√ß√£o de baixo n√≠vel necess√°ria ao usar o Reactive Streams e o Akka.NET.  Olhando para o futuro, posso dizer imediatamente: se no in√≠cio do nosso projeto, no qual usamos o Akka, soub√©ssemos da exist√™ncia do Akka Streams, escrever√≠amos de maneira muito diferente, economizar√≠amos tempo e c√≥digo. <br><blockquote> <i>"Talvez o pior que voc√™ possa fazer √© levar as pessoas que n√£o sentem dor a tomar sua aspirina".</i> <br>  Max Kreminski <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúPortas fechadas, dores de cabe√ßa e necessidades intelectuais‚Äù</a> </blockquote>  Antes de entrarmos nos detalhes t√©cnicos, um pouco sobre qual pode ser o seu caminho para o Akka Streams e o que pode lev√°-lo at√© l√°.  Um dia, me deparei com o blog de Max Kreminski, onde ele fazia uma pergunta filos√≥fica para programadores: como ou por que √© imposs√≠vel para um programador explicar o que s√£o m√¥nadas.  Ele explicou da seguinte maneira: muitas vezes as pessoas v√£o imediatamente aos detalhes t√©cnicos, explicando como a programa√ß√£o √© lindamente funcional e qual o sentido da m√¥nada, sem se preocupar em se perguntar por que o programador pode precisar dela.  Fazendo uma analogia, √© como tentar vender aspirina sem se preocupar em descobrir se seu paciente est√° com dor. <br><br>  Usando essa analogia, eu gostaria de fazer a seguinte pergunta: se o Akka Streams √© aspirina, qual deve ser a dor que o levar√° a isso? <br><br><h1>  Fluxos de dados </h1><br>  Primeiro, vamos falar sobre fluxos de dados.  O fluxo pode ser bastante simples, linear. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Seu navegador n√£o suporta v√≠deo HTML5. <source src="https://media.giphy.com/media/ZNejul2eTftImnVrsY/giphy.mp4" type="video/mp4"></video></div></div></div><br>  Aqui temos um certo consumidor de dados (um coelho no v√≠deo).  Consome dados a uma velocidade adequada.  Essa √© a intera√ß√£o ideal do consumidor com o fluxo: ele estabelece a largura de banda e os dados fluem silenciosamente para ele.  Esse fluxo de dados simples pode ser infinito ou pode terminar. <br><br>  Mas o fluxo pode ser mais complexo.  Se voc√™ plantar v√°rios coelhos lado a lado, j√° teremos paraleliza√ß√£o de fluxos.  O que os Reativos reativos est√£o tentando resolver √© precisamente como podemos nos comunicar com os fluxos em um n√≠vel mais conceitual, isto √©, independentemente de estarmos apenas falando sobre algum tipo de medi√ß√£o do sensor de temperatura, em que as medi√ß√µes lineares ocorrem , ou temos medi√ß√µes cont√≠nuas de milhares de sensores de temperatura que entram no sistema atrav√©s das filas do RabbitMQ e armazenados nos logs do sistema.  Todos os itens acima podem ser considerados como um fluxo composto.  Se voc√™ for ainda mais longe, o gerenciamento automatizado da produ√ß√£o (por exemplo, em algumas lojas on-line) tamb√©m poder√° ser reduzido a um fluxo de dados, e seria √≥timo se pud√©ssemos falar sobre o planejamento de um fluxo desse tipo, por mais complicado que seja. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a7c/fa0/3af/a7cfa03af65ad4d88c1ce13d316e272e.jpg"><br><br>  Para projetos modernos, o suporte a threads n√£o √© muito bom.  Se bem me lembro, Aaron Stannard, cujo tweet voc√™ v√™ na foto, queria obter um fluxo de um arquivo de v√°rios gigabytes contendo CSV, ou seja,  texto e acabou que n√£o h√° nada que voc√™ possa executar e usar imediatamente, sem v√°rias a√ß√µes adicionais.  Mas ele simplesmente n√£o conseguiu obter um fluxo de valores CSV, o que o entristeceu.  Existem poucas solu√ß√µes (com exce√ß√£o de algumas √°reas especiais), muito √© percebido pelos m√©todos antigos, quando abrimos tudo isso, come√ßamos a ler, armazenamos em buffer, no pior dos casos, obtemos algo como o bloco de notas, que diz que o arquivo √© muito grande. <br><br>  Em um alto n√≠vel conceitual, estamos todos envolvidos no processamento de fluxos de dados, e o Akka Streams o ajudar√° se: <br><br><ul><li>  Voc√™ conhece Akka, mas deseja poupar os detalhes associados √† escrita do c√≥digo do ator e sua coordena√ß√£o; <br></li><li>  Voc√™ est√° familiarizado com o Reactive Streams e gostaria de usar uma implementa√ß√£o pronta de suas especifica√ß√µes; <br></li><li>  Os elementos de bloco do Akka Streams para est√°gios s√£o adequados para modelar seu processo; <br></li><li>  Voc√™ deseja aproveitar a contrapress√£o (contrapress√£o) do Akka Streams para gerenciar e refinar dinamicamente os est√°gios de rendimento do seu fluxo de trabalho. <br></li></ul><br><h1>  De atores a Akka Streams </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/9e2/067/5d1/9e20675d1a251ffc62b578eba2e7167d.jpg"><br><br>  A primeira maneira √© dos atores ao Akka Streams, do meu jeito. <br><br>  A imagem mostra por que come√ßamos a usar o modelo de ator.  Est√°vamos exaustos pelo controle manual de fluxos, estado compartilhado, s√≥ isso.  Todo mundo que trabalhou com sistemas grandes, com multiencadeamento, entende o quanto leva tempo e como √© f√°cil cometer um erro, o que pode ser fatal para todo o processo.  Isso nos levou ao modelo de atores.  N√£o lamentamos a escolha feita, mas, √© claro, quando voc√™ come√ßa a trabalhar e a programar mais, n√£o √© que o entusiasmo inicial d√™ lugar a outra coisa, mas voc√™ come√ßa a perceber que algo pode ser feito de maneira ainda mais eficaz. <br><blockquote>  <i>‚ÄúPor padr√£o, os destinat√°rios de suas mensagens s√£o inseridos no c√≥digo dos atores.</i>  <i>Se eu criar um ator A que envie uma mensagem ao ator B e voc√™ desejar substituir o destinat√°rio pelo ator C, no caso geral, isso n√£o funcionar√° para voc√™ ‚Äù</i> <br>  Noel Welch (underscore.io) </blockquote>  Atores criticados por n√£o comporem.  Um dos primeiros a escrever sobre isso em seu blog foi Noel Welch, um dos desenvolvedores do Underscore.  Ele percebeu que o sistema de atores se parece com isso: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d8f/e3b/3dd/d8fe3b3dd378bb187c4a85de3e982960.jpg"><br><br>  Se voc√™ n√£o usar nada adicional, como inje√ß√£o de depend√™ncia, o endere√ßo do destinat√°rio ser√° costurado no ator. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3df/62f/78b/3df62f78bf5f64bda875c5f448057427.jpg"><br><br>  Quando eles come√ßam a enviar mensagens um para o outro, tudo isso voc√™ define antecipadamente, atores de programa√ß√£o.  E sem truques adicionais, um sistema t√£o r√≠gido √© obtido. <br>  Um dos desenvolvedores da Akka, Roland Kuhn, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">explicou o</a> que geralmente se entende por layout ruim.  O m√©todo ator √© baseado no m√©todo tell, ou seja, mensagens unidirecionais: √© do tipo nulo, ou seja, n√£o retorna nada (ou unidade, dependendo do idioma).  Portanto, √© imposs√≠vel construir uma descri√ß√£o do processo a partir de uma cadeia de atores.  Ent√£o voc√™ enviou dizer, ent√£o o que?  Parar  Ficamos nulos.  Voc√™ pode compar√°-lo, por exemplo, com express√µes LINQ, onde cada elemento da express√£o retorna IQueryable, IEnumerable e tudo isso pode ser facilmente compilado.  Os atores n√£o d√£o essa oportunidade.  Ao mesmo tempo, Roland Kuhn se op√¥s ao fato de que eles supostamente n√£o comp√µem em princ√≠pio, dizendo que de fato s√£o compilados de outras maneiras, no mesmo sentido em que a sociedade humana se presta ao layout.  Parece um argumento filos√≥fico, mas se voc√™ pensar sobre isso, a analogia faz sentido - sim, os atores enviam mensagens unidirecionais um ao outro, mas tamb√©m nos comunicamos, emitindo mensagens unidirecionais, mas ao mesmo tempo interagimos com bastante efic√°cia, ou seja, criamos sistemas complexos.  No entanto, existem cr√≠ticas a esses atores. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SampleActor</span></span> : <span class="hljs-title"><span class="hljs-title">ReceiveActor</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleActor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Idle(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PreStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Idle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Receive&lt;Job&gt;(job =&gt; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Working</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Receive&lt;Cancel&gt;(job =&gt; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span>); } }</code> </pre> <br>  Al√©m disso, a implementa√ß√£o do ator exige pelo menos escrever uma classe se voc√™ trabalha em C # ou funciona se voc√™ trabalha em F #.  No exemplo acima - c√≥digo padr√£o, que voc√™ deve escrever em qualquer caso.  Embora n√£o seja muito grande, √© um certo n√∫mero de linhas que voc√™ sempre precisar√° escrever nesse n√≠vel baixo.  Quase todo o c√≥digo que est√° presente aqui √© uma esp√©cie de cerim√¥nia.  O que acontece quando um ator recebe diretamente uma mensagem n√£o √© mostrado aqui.  E tudo isso precisa ser escrito.  Isso, √© claro, n√£o √© muito, mas √© uma evid√™ncia de que trabalhamos com atores em um n√≠vel baixo, criando esses m√©todos vazios. <br><br>  E se pud√©ssemos ir para um n√≠vel diferente, mais alto, nos fazer perguntas sobre como modelar nosso processo, que inclui o processamento de dados de v√°rias fontes que s√£o misturadas, convertidas e transferidas? <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> results = db.Companies .Join(db.People, c =&gt; c.CompanyID, p =&gt; p.PersonID, (c, p) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { c, p }) .Where(z =&gt; zcCreated &gt;= fromDate) .OrderByDescending(z =&gt; zcCreated) .Select(z =&gt; zp) .ToList();</code> </pre> <br>  Um an√°logo dessa abordagem pode ser o que estamos acostumados a trabalhar com o LINQ h√° dez anos.  N√£o nos perguntamos como funciona a jun√ß√£o.  Sabemos que existe um provedor LINQ que far√° tudo isso por n√≥s e estamos interessados ‚Äã‚Äãem um n√≠vel superior em atender √† solicita√ß√£o.  E geralmente podemos misturar bancos de dados aqui, podemos enviar solicita√ß√µes distributivas.  E se voc√™ pudesse descrever o processo dessa maneira? <br><br><pre> <code class="cs hljs">HttpGet pageUrl |&gt; fun s -&gt; Regex.Replace(s, <span class="hljs-string"><span class="hljs-string">"[^A-Za-z']"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>) |&gt; fun s -&gt; Regex.Split(s, <span class="hljs-string"><span class="hljs-string">" +"</span></span>) |&gt; Set.ofArray |&gt; Set.filter (fun word -&gt; not (Spellcheck word)) |&gt; Set.iter (fun word -&gt; printfn <span class="hljs-string"><span class="hljs-string">" %s"</span></span> word)</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(Fonte)</a> <br><br>  Ou, por exemplo, transforma√ß√µes funcionais.  O que muitas pessoas gostam na programa√ß√£o funcional √© que voc√™ pode transmitir dados atrav√©s de uma s√©rie de transforma√ß√µes e obter um c√≥digo compacto bastante claro, independentemente do idioma em que o escreve.  √â f√°cil de ler.  O c√≥digo da imagem √© especialmente escrito em F #, mas em geral, provavelmente, todo mundo entende o que est√° acontecendo aqui. <br><br><pre> <code class="cs hljs">val <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> = Source(<span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">10</span></span>) val <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> = Sink.ignore val bcast = builder.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(Broadcast[Int](<span class="hljs-number"><span class="hljs-number">2</span></span>)) val merge = builder.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(Merge[Int](<span class="hljs-number"><span class="hljs-number">2</span></span>)) val f1,f2,f3,f4 = Flow[Int].map(_ + <span class="hljs-number"><span class="hljs-number">10</span></span>) source ~&gt; f1 ~&gt; bcast ~&gt; f2 ~&gt; merge ~&gt; f3 ~&gt; sink bcast ~&gt; f4 ~&gt; merge ~&gt;</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(Fonte)</a> <br><br>  Que tal isso ent√£o?  No exemplo acima, temos uma fonte de dados de origem, que consiste em n√∫meros inteiros de 1 a 10. Essa √© a chamada DSL gr√°fica (linguagem espec√≠fica de dom√≠nio).  Os elementos do idioma do dom√≠nio no exemplo acima s√£o s√≠mbolos de seta unidirecionais - s√£o operadores adicionais definidos por ferramentas de idioma que mostram graficamente a dire√ß√£o do fluxo.  Passamos o Source por uma s√©rie de transforma√ß√µes - para facilitar a demonstra√ß√£o, todas adicionam dez ao n√∫mero.  Em seguida, vem a transmiss√£o: multiplicamos os canais, ou seja, cada n√∫mero entra em dois canais.  Em seguida, adicionamos 10 novamente, misturamos nossos fluxos de dados, obtemos um novo fluxo, adicionamos 10 nele tamb√©m, e tudo isso vai para o nosso fluxo de dados, no qual nada acontece.  Este √© o c√≥digo real escrito em Scala, parte do Akka Streams, implementado neste idioma.  Ou seja, voc√™ especifica as fases da transforma√ß√£o de seus dados, indica o que fazer com eles, especifica a origem, o estoque, alguns pontos de verifica√ß√£o e forma um gr√°fico usando o DSL gr√°fico.  Isso √© todo o c√≥digo para um √∫nico programa.  Algumas linhas de c√≥digo mostram o que est√° acontecendo no processo. <br><br>  Vamos esquecer como escrever o c√≥digo de defini√ß√£o para atores individuais e aprender as primitivas de layout de alto n√≠vel que criar√£o e conectar√£o os atores necess√°rios dentro de si.  Quando executamos esse gr√°fico, o sistema que fornece o Akka Streams criar√° o ator necess√°rio por si s√≥, enviar√° todos esses dados para l√°, processar√° como deve e, eventualmente, os entregar√° ao destinat√°rio final. <br><br><pre> <code class="hljs pgsql">var runnable = Source .<span class="hljs-keyword"><span class="hljs-keyword">From</span></span>(Enumerable.Range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>)) .Via(Flow.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;().<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>(x =&gt; x * <span class="hljs-number"><span class="hljs-number">2</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">To</span></span>(Sink.<span class="hljs-keyword"><span class="hljs-keyword">ForEach</span></span>&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(x =&gt; Console.<span class="hljs-keyword"><span class="hljs-keyword">Write</span></span>(x.ToString));</code> </pre> <br>  O exemplo acima mostra como isso pode parecer em C #.  A maneira mais simples: temos uma fonte de dados - esses s√£o n√∫meros de 1 a 1000 (como voc√™ pode ver, no Akka Streams, qualquer IEnumerable pode se tornar uma fonte de fluxo de dados, o que √© muito conveniente).  Fazemos alguns c√°lculos simples, digamos, multiplicamos por dois e, depois, no fluxo de dados, tudo isso √© exibido na tela. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> graph = GraphDsl.Create(builder =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bcast = builder.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Broadcast&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> merge = builder.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Merge&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> count = Flow.FromFunction(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(x =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sum = Flow.Create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;().Sum((x, y) =&gt; x + y); builder.From(bcast.Out(<span class="hljs-number"><span class="hljs-number">0</span></span>)).To(merge.In(<span class="hljs-number"><span class="hljs-number">0</span></span>)); builder.From(bcast.Out(<span class="hljs-number"><span class="hljs-number">1</span></span>)).Via(count).Via(sum).To(merge.In(<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FlowShape&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(bcast.In, merge.Out); });</code> </pre> <br>  O que √© mostrado no exemplo acima √© chamado de "DSL gr√°fico em C #".  De fato, n√£o h√° gr√°ficos aqui, √© uma porta com o Scala, mas no C # n√£o h√° como definir operadores dessa maneira, por isso parece um pouco mais complicado, mas ainda compacto o suficiente para entender o que est√° acontecendo aqui.  Ent√£o, estamos criando um determinado gr√°fico (existem diferentes tipos de gr√°fico, aqui √© chamado FlowShape) a partir de diferentes componentes, onde h√° uma fonte de dados e algumas transforma√ß√µes.  Enviamos dados para um canal no qual geramos contagem, ou seja, o n√∫mero de elementos de dados a serem transmitidos, e no outro geramos a soma e depois misturamos tudo.  A seguir, veremos exemplos mais interessantes do que apenas processar n√∫meros inteiros. <br>  Este √© o primeiro caminho que pode lev√°-lo ao Akka Streams, se voc√™ tiver experi√™ncia em trabalhar com um modelo de ator e tiver pensado em escrever manualmente cada um, mesmo o ator mais simples.  A segunda maneira pela qual os Akka Streams chegam √© atrav√©s dos Streams Reativos. <br><br><h1>  De c√≥rregos reativos a c√≥rregos Akka </h1><br>  O que s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fluxos reativos</a> ?  Esta √© uma iniciativa conjunta para desenvolver um padr√£o para processamento ass√≠ncrono de fluxos de dados.  Ele define o conjunto m√≠nimo de interfaces, m√©todos e protocolos que descrevem as opera√ß√µes e entidades necess√°rias para atingir a meta - processamento ass√≠ncrono de dados em tempo real com contrapress√£o (contrapress√£o) sem bloqueio.  Permite v√°rias implementa√ß√µes usando diferentes linguagens de programa√ß√£o. <br><br>  O Reactive Streams permite processar um n√∫mero potencialmente ilimitado de elementos em uma sequ√™ncia e transferir elementos de forma ass√≠ncrona entre componentes com contrapress√£o sem bloqueio. <br><br>  A lista de iniciadores da cria√ß√£o de Reactive Streams √© bastante impressionante: aqui est√£o Netflix, Oracle e Twitter. <br><br>  A especifica√ß√£o √© muito simples para tornar a implementa√ß√£o em diferentes idiomas e plataformas o mais acess√≠vel poss√≠vel.  Os principais componentes da API do Reactive Streams: <br><br><ol><li>  Publisher <br></li><li>  Assinante <br></li><li>  Assinatura <br></li><li>  Processador <br></li></ol><br>  Essencialmente, essa especifica√ß√£o n√£o implica que voc√™ come√ßar√° manualmente a implementar essas interfaces.  Entende-se que existem alguns desenvolvedores de bibliotecas que far√£o isso por voc√™.  E o Akka Streams √© uma das implementa√ß√µes desta especifica√ß√£o. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPublisher</span></span>&lt;<span class="hljs-title"><span class="hljs-title">out</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Subscribe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ISubscriber&lt;T&gt; subscriber</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ISubscriber</span></span>&lt;<span class="hljs-title"><span class="hljs-title">in</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnSubscribe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ISubscription subscription</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T element</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception cause</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnComplete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br>  As interfaces, como voc√™ pode ver no exemplo, s√£o realmente muito simples: por exemplo, o Publisher cont√©m apenas um m√©todo - "inscrever-se".  O assinante, Assinante, cont√©m apenas algumas rea√ß√µes ao evento. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ISubscription</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Request</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cancel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IProcessor</span></span>&lt;<span class="hljs-title"><span class="hljs-title">in</span></span> <span class="hljs-title"><span class="hljs-title">T1</span></span>, <span class="hljs-title"><span class="hljs-title">out</span></span> <span class="hljs-title"><span class="hljs-title">T2</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">ISubscriber</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T1</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IPublisher</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T2</span></span>&gt; { }</code> </pre> <br>  Por fim, a assinatura cont√©m dois m√©todos - "iniciar" e "recusar".  O processador n√£o define nenhum m√©todo novo: combina um editor e um assinante. <br><br>  O que diferencia os Fluxos Reativos de outras implementa√ß√µes de fluxo?  O Reativo Reativo combina os modelos push e pull.  Para suporte, este √© o cen√°rio de desempenho mais eficiente.  Suponha que voc√™ tenha um assinante de dados lento.  Nesse caso, pressionar por ele pode ser fatal: se voc√™ enviar uma quantidade enorme de dados, ele n√£o poder√° process√°-los.  √â melhor usar pull para que o pr√≥prio assinante extraia os dados do editor.  Mas se o editor estiver lento, o assinante ficar√° bloqueado o tempo todo, aguardando o tempo todo.  Uma solu√ß√£o intermedi√°ria pode ser a configura√ß√£o: temos um arquivo de configura√ß√£o no qual determinamos qual deles √© mais r√°pido.  E se a velocidade deles mudar? <br><br>  Portanto, a implementa√ß√£o mais elegante √© aquela em que podemos alterar dinamicamente os modelos push e pull. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/971/ab6/298/971ab6298b3f313b90503cf6a860e188.png"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(Origem (Apache Flink))</a> <br><br>  O diagrama mostra como isso pode acontecer.  Esta demonstra√ß√£o usa o Apache Flink.  Yellow √© um editor, produtor de dados, ele foi definido em cerca de 50% de sua capacidade.  O assinante tenta escolher a melhor estrat√©gia - acaba sendo um empurr√£o.  Em seguida, redefinimos o assinante para uma velocidade de cerca de 20% e ele muda para puxar.  Ent√£o vamos 100%, retornamos novamente 20% ao modelo pull, etc. Tudo isso acontece na din√¢mica, voc√™ n√£o precisa interromper o servi√ßo, inserir algo na configura√ß√£o.  Esta √© uma ilustra√ß√£o de como a contrapress√£o funciona no Akka Streams. <br><br><h1>  Princ√≠pios do Akka Streams </h1><br>  Obviamente, o Akka Streams n√£o estaria ganhando popularidade se n√£o houvesse blocos embutidos muito f√°ceis de usar.  Existem muitos deles.  Eles s√£o divididos em tr√™s grupos principais: <br><br><ol><li>  Fonte de dados (Fonte) - est√°gio de processamento com uma sa√≠da. <br></li><li>  Pia √© uma etapa de processamento de entrada √∫nica. <br></li><li>  Ponto de verifica√ß√£o (fluxo) - est√°gio de processamento com uma entrada e uma sa√≠da.  As transforma√ß√µes funcionais ocorrem aqui, e n√£o necessariamente na mem√≥ria: pode ser, por exemplo, uma chamada para um servi√ßo da web, para alguns elementos do paralelismo, multithread. <br></li></ol><br>  Desses tr√™s tipos, gr√°ficos podem ser formados.  Essas j√° s√£o etapas de processamento mais complexas, constru√≠das a partir de fontes, drenos e pontos de verifica√ß√£o.  Mas nem todo gr√°fico pode ser executado: se houver buracos, ou seja, entradas e sa√≠das abertas, esse gr√°fico n√£o ser√° executado. <br>  Um gr√°fico √© um gr√°fico execut√°vel, se estiver fechado, ou seja, haver√° uma sa√≠da para cada entrada: se os dados foram inseridos, eles devem ter ido para algum lugar. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/41f/059/a3c/41f059a3cebba7f1e023c8036a29cc8e.jpg"><br><br>  O Akka Streams possui fontes internas: na imagem, voc√™ v√™ quantas delas.  Seus nomes s√£o um por um e refletem o que o Scala ou a JVM possui, com exce√ß√£o de algumas fontes √∫teis espec√≠ficas do .NET.  Os dois primeiros (FromEnumerator e From) s√£o alguns dos mais importantes: qualquer numera√ß√£o, qualquer ienumer√°vel pode ser transformado em uma fonte de fluxo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/504/3cb/0e7/5043cb0e7cd9fb15e6b00582b5230103.jpg"><br><br>  Existem drenos internos: alguns deles se parecem com os m√©todos LINQ, por exemplo, First, Last, FirstOrDefault.  Obviamente, tudo o que voc√™ obt√©m pode despejar em arquivos, em fluxos, n√£o no Akka Streams, mas nos fluxos .NET.  E, novamente, se voc√™ tiver algum ator em seu sistema, poder√° us√°-lo na entrada e na sa√≠da do sistema, ou seja, se desejar, incorpore isso no sistema finalizado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a6/947/229/0a6947229a7ddbb5577b39634a4b6c11.jpg"><br><br>  E h√° um grande n√∫mero de pontos de verifica√ß√£o internos, que talvez sejam ainda mais reminiscentes do LINQ, porque aqui existem Select, SelectMany e GroupBy, ou seja, tudo com o qual estamos acostumados a trabalhar no LINQ. <br><br>  Por exemplo, Select in Scala √© chamado SelectAsync: √© poderoso o suficiente porque leva o n√≠vel de paralelismo como um dos argumentos.  Ou seja, voc√™ pode indicar que, por exemplo, o Select envia dados para algum servi√ßo da Web em paralelo em dez threads, depois todos s√£o coletados e transmitidos.  De fato, voc√™ determina o grau de escala do ponto de verifica√ß√£o com uma linha de c√≥digo. <br><br>  Uma declara√ß√£o de fluxo √© seu plano de execu√ß√£o, ou seja, um gr√°fico, mesmo que seja executado, n√£o pode ser executado exatamente assim - ele precisa ser materializado.  Deve haver um sistema instanciado, um sistema ator, voc√™ deve fornecer um fluxo, esse plano de execu√ß√£o e, em seguida, ele ser√° executado.  Al√©m disso, no tempo de execu√ß√£o, ele √© altamente otimizado, como quando voc√™ envia uma express√£o LINQ para um banco de dados: um provedor pode otimizar seu SQL para obter uma sa√≠da de dados mais eficiente, substituindo essencialmente o comando query por outro.  O mesmo acontece com o Akka Streams: a partir da vers√£o 2.0, √© poss√≠vel definir um certo n√∫mero de pontos de verifica√ß√£o, e o sistema entender√° que alguns deles podem ser combinados para que sejam executados por um ator (fus√£o do operador).  Os pontos de verifica√ß√£o, como regra, mant√™m a ordem dos elementos de processamento. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> results = db.Companies .Join(db.People, c =&gt; c.CompanyID, p =&gt; p.PersonID, (c, p) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { c, p }) .Where(z =&gt; zcCreated &gt;= fromDate) .OrderByDescending(z =&gt; zcCreated) .Select(z =&gt; zp) .ToList();</code> </pre> <br>  A materializa√ß√£o do fluxo pode ser comparada com o √∫ltimo elemento ToList na express√£o LINQ no exemplo acima.  Se n√£o escrevermos ToList, obteremos uma express√£o LINQ n√£o materializada que n√£o far√° com que os dados sejam transferidos para o servidor SQL ou Oracle, pois a maioria dos provedores LINQ oferece suporte √† chamada execu√ß√£o adiada da consulta (execu√ß√£o atrasada da consulta), t ou seja, a solicita√ß√£o √© executada apenas quando um comando √© fornecido para fornecer algum resultado.  Dependendo do que for solicitado - uma lista ou o primeiro resultado - a equipe mais eficaz ser√° formada.  Quando dizemos ToList, solicitamos ao provedor LINQ que nos forne√ßa o resultado final. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> runnable = Source .From(Enumerable.Range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>)) .Via(Flow.Create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;().Select(x =&gt; x * <span class="hljs-number"><span class="hljs-number">2</span></span>) .To(Sink.ForEach&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(x =&gt; Console.Write(x.ToString));</code> </pre> <br>  O Akka Streams funciona da mesma maneira.  Na figura est√° o gr√°fico lan√ßado, que consiste em uma fonte de pontos de verifica√ß√£o e escoamento, e agora queremos execut√°-lo. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> runnable = Source .From(Enumerable.Range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>)) .Via(Flow.Create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;().Select(x =&gt; x * <span class="hljs-number"><span class="hljs-number">2</span></span>) .To(Sink.ForEach&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(x =&gt; Console.Write(x.ToString)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> system = ActorSystem.Create(<span class="hljs-string"><span class="hljs-string">"MyActorSystem"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> materializer = ActorMaterializer.Create(system)) { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> runnable.Run(materializer); }</code> </pre> <br>  Para que isso aconte√ßa, precisamos criar um sistema de atores, nele existe um materializador, passa nosso gr√°fico para ele e ele o executa.  Se o recriarmos, ele ser√° executado novamente e outros resultados poder√£o ser obtidos. <br><br>  Al√©m da materializa√ß√£o do fluxo, falando sobre a parte material do Akka Streams, vale mencionar os valores materializados. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> source1 = Source.From(Enumerable.Range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sink1 = Sink.ForEach&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(output.Add); IRunnableGraph&lt;NotUsed&gt; runnable1 = source1.To(sink1); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> source2 = Source.From(Enumerable.Range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sink2 = Sink.Sum&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;((x,y) =&gt; x + y); IRunnableGraph&lt;Task&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;&gt; runnable2 = source2.ToMaterialized(sink2, Keep.Right);</code> </pre> <br>  Quando temos um fluxo que vai da fonte atrav√©s dos pontos de verifica√ß√£o at√© o dreno, se n√£o solicitarmos valores intermedi√°rios, eles n√£o estar√£o dispon√≠veis para n√≥s, pois ele ser√° executado da maneira mais eficiente.  √â como uma caixa preta.  Mas pode ser interessante extrairmos alguns valores intermedi√°rios, porque em cada ponto √† esquerda entram alguns valores, outros saem √† direita e voc√™ pode especificar um gr√°fico para indicar em que est√° interessado.  No exemplo acima, um gr√°fico de introdu√ß√£o no qual NotUsed √© indicado, ou seja, nenhum valor materializado nos interessa.  Abaixo, criamos com a indica√ß√£o de que, no lado direito do escoamento, ou seja, ap√≥s todas as transforma√ß√µes terem sido conclu√≠das, precisamos fornecer valores materializados.  Obtemos o gr√°fico Tarefa - uma tarefa, ap√≥s a conclus√£o da qual obtemos um int, ou seja, o que acontece no final deste gr√°fico.  Voc√™ pode indicar em cada par√°grafo que precisa de algum tipo de valor materializado, tudo isso ser√° coletado gradualmente. <br><br>  Para transferir dados para os fluxos do Akka Streams ou para tir√°-los de l√°, √© claro, √© necess√°rio algum tipo de intera√ß√£o com o mundo exterior.  Os est√°gios de origem incorporada cont√™m uma ampla variedade de fluxos de dados reativos: <br><br><ul><li>  Source.FromEnumerator e Source.From permitem transferir dados de qualquer fonte que implemente IEnumerable; <br></li><li>  Unfold e UnfoldAsync geram os resultados dos c√°lculos de fun√ß√µes, desde que retornem valores diferentes de zero; <br></li><li>  FromInputStream transforma um fluxo; <br></li><li>  FromFile analisa o conte√∫do do arquivo no fluxo reativo; <br></li><li>  ActorPublisher converte mensagens de ator. <br></li></ul><br>  Como eu j√° disse, para desenvolvedores .NET √© muito produtivo usar o Enumerator ou o IEnumerable, mas √†s vezes √© muito primitivo, muito ineficiente para acessar dados.  Origens mais complexas que cont√™m uma grande quantidade de dados requerem conectores especiais.  Tais conectores s√£o escritos.  Existe um projeto de c√≥digo aberto Alpakka, que apareceu originalmente no Scala e agora est√° no .NET.  Al√©m disso, o Akka possui os chamados atores persistentes e eles t√™m seus pr√≥prios fluxos que podem ser usados ‚Äã‚Äã(por exemplo, o Akka Persistence Query forma o fluxo de conte√∫do do Akka Event Journal). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/109/c40/b29/109c40b2934e0a4a4e280b27d2cd1e8b.jpg"><br><br>  Se voc√™ trabalha com a Scala, a maneira mais f√°cil √© para voc√™: h√° um grande n√∫mero de conectores e voc√™ certamente encontrar√° algo ao seu gosto.  Para informa√ß√£o, Kafka √© o chamado Kafka Reativo, n√£o Kafka Streams.  O Kafka Streams, at√© onde eu sei, n√£o suporta contrapress√£o.  O Kafka reativo √© uma implementa√ß√£o de fluxo do Kafka que suporta Fluxos reativos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f24/160/09d/f2416009d41f26f08e665b2d510aa7db.jpg"><br><br>  A lista de conectores Alpakka .NET √© mais modesta, mas √© reabastecida e h√° um elemento de competi√ß√£o.  H√° um tweet de seis meses de David Fowler, da Microsoft, que disse que o SignalR agora pode trocar dados com o Reactive Extensions, e um dos desenvolvedores da Akka respondeu que ele j√° estava no Akka Streams h√° algum tempo.  Akka suporta v√°rios servi√ßos do Microsoft Azure.  O CSV √© o resultado da frustra√ß√£o de Aaron Stannard quando ele descobriu que n√£o h√° um bom fluxo para o CSV: agora a Akka tem seu pr√≥prio fluxo para o XML do CSV.  Existe o AMQP (na realidade, o RabbitMQ), ele est√° em desenvolvimento, mas est√° dispon√≠vel para uso, funciona.  Kafka tamb√©m est√° em desenvolvimento.  Esta lista continuar√° a se expandir. <br><br>  Algumas palavras sobre as alternativas, pois se voc√™ trabalha com fluxos de dados, o Akka Streams n√£o √©, obviamente, a √∫nica maneira de lidar com esses fluxos.  Provavelmente, no seu projeto, a escolha de como implementar threads depender√° de muitos outros fatores que podem se tornar fundamentais.  Por exemplo, se voc√™ trabalha muito com o Microsoft Azure e o Orleans √© incorporado de forma org√¢nica √†s necessidades do seu projeto, com o suporte a atores virtuais ou, como eles os chamam, gr√£os, eles t√™m sua pr√≥pria implementa√ß√£o que n√£o atende √† especifica√ß√£o de Reativos - Orleans Streams, que ser√° o mais pr√≥ximo para voc√™ e faz sentido prestar aten√ß√£o a ele.  Se voc√™ trabalha muito com o TPL, existe o TPL DataFlow - essa pode ser a analogia mais pr√≥xima do Akka Streams: ele tamb√©m possui primitivas para compor fluxos de dados, al√©m de ferramentas de buffer e limita√ß√£o de largura de banda (BoundedCapacity, MaxMessagePerTask).  Se as id√©ias do modelo do ator est√£o pr√≥ximas de voc√™, o Akka Streams √© uma maneira de resolver isso e economizar uma quantidade significativa de tempo sem precisar escrever cada ator manualmente. <br><br><h1>  Exemplo de implementa√ß√£o: Fluxo de Log de Eventos </h1><br>  Vejamos alguns exemplos de implementa√ß√£o.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O primeiro exemplo n√£o est√° implementando diretamente um fluxo, √© como usar um fluxo. Esta foi a nossa primeira experi√™ncia com o Akka Streams, quando descobrimos que, de fato, podemos assinar um fluxo que simplificar√° muito para n√≥s. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/43e/de0/51f/43ede051f01ec132e11502f9cebaccaf.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carregamos v√°rios arquivos de m√≠dia na nuvem. Esta foi uma fase inicial do projeto: aqui nos √∫ltimos 15 minutos 23 arquivos, dos quais 7 erros. Agora praticamente n√£o h√° erros e o n√∫mero de arquivos √© muito maior - centenas passam a cada poucos minutos. Tudo isso est√° contido no Painel Kibana.</font></font><br> Kibana    Elasticsearch ,   Elasticsearch  ,    ,      ,        ,    .     ,      ,    , . .    .      (event journal) Akka,      Microsoft SQL Server.    ,          . <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> EventJournal ( Ordering <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PersistenceID <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, SequenceNr <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Timestamp</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, IsDeleted <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, Manifest <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">500</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, Payload VARBINARY(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, Tags <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> QU_EventJournal <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> (PersistenceID, SequenceNr) )</code> </pre> <br>   ,  ,   ,  ,   SQL Server,     eventstore   Akka, eventJournal.     eventstore. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cae/28e/b8e/cae28eb8efd64485e534c63d90550ce2.jpg"><br><br>    ,     .  ,    ,       ,      ,   -    :     ,  .      ,         . . .  -  .       ,    .       ,   .    ,     Akka  persistence query. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b2/bb9/08b/6b2bb908be095a552de279cbefad7f1b.jpg"><br><br>          ,   ,          . <br><br>   (persistence queries): <br><br><ul><li> AllPersistencelds </li><li> CurrentPersistencelds </li><li> EventsByPersistenceld </li><li> CurrentEventsByPersistenceld </li><li> EventsByTag </li><li> CurrentEventsByTag </li></ul><br>      ,    , ,   Current ‚Äî  ,      .     ‚Äî    .   EventsByTag. <br><br><pre> <code class="hljs kotlin">let system = mailbox.Context.System let queries = PersistenceQuery.Get(system) .ReadJournalFor&lt;SqlReadJournal&gt;(SqlReadJournal.Identifier) let mat = ActorMaterializer.Create(system) let offset = getCurrentOffset client config let ks = KillSwitches.Shared <span class="hljs-string"><span class="hljs-string">"persistence-elastic"</span></span> let task = queries.EventsByTag(PersistenceUtils.anyEventTag, offset) .Select(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> e -&gt; ElasticTypes.EventEnvelope.FromAkka e) .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GroupedWithin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config.BatchSize, config.BatchTimeout)</span></span></span></span> .Via(ks.Flow()) .RunForeach((<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> batch -&gt; processItems client batch), mat) .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ContinueWith</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handleStreamError mailbox, TaskContinuationOptions.OnlyOnFaulted)</span></span></span></span> |&gt; Async.AwaitTaskVoid</code> </pre> <br>  ,    .     F#,   C#      .   EventsByTag,    Akka Streams,      ,     Elasticsearch. . .   -   ,       ,   ,    ‚Äî          .        . <br><br>       .   ,       ,    ,       ,  Twitter      ,   ‚Äî  ,   , ,    .     ,   Akka Streams. <br><br><h1>  :   </h1><br>    Akka  Scala,  Akka.NET,      ,      ,        ,      , . .          -  .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tweetinvi</a> ‚Äî   ,     Twitter,         .      Reactive Streams, . .      ,    ,     ,  ,   -  Akka,      ,     . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/acf/ac1/103/acfac11035eee1b69f2eb4c148f2f7f4.jpg"><br><br>       ,      , . .  Broadcast-.        ,     ,       .         :     ,         ,    ,    ,          . <br><br>      GitHub-,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AkkaStreamsDemo</a> .    (      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a> ). <br><br>  Vamos come√ßar com um simples.        Twitter:   Program.cs <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> useCachedTweets = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caso eu seja banido do Twitter, tenho tweets em cache, eles s√£o mais r√°pidos. </font><font style="vertical-align: inherit;">Para come√ßar, criamos alguns RunnableGraph.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IRunnableGraph&lt;IActorRef&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateRunnableGraph</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tweetSource = Source.ActorRef&lt;ITweet&gt;(<span class="hljs-number"><span class="hljs-number">100</span></span>, OverflowStrategy.DropHead); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formatFlow = Flow.Create&lt;ITweet&gt;().Select(Utils.FormatTweet); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> writeSink = Sink.ForEach&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(Console.WriteLine); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tweetSource.Via(formatFlow).To(writeSink); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Temos uma fonte de tweets aqui, que vem de um ator. </font><font style="vertical-align: inherit;">Vou mostrar a voc√™ como puxamos esses tweets para l√°, formatamos (o formato de tweet d√° um tweet ao autor) e depois escrevemos na tela. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StartTweetStream - aqui usaremos a biblioteca Tweetinvi.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartTweetStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IActorRef actor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = Stream.CreateSampleStream(); stream.TweetReceived += (_, arg) =&gt; { arg.Tweet.Text = arg.Tweet.Text.Replace(<span class="hljs-string"><span class="hljs-string">"\r"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>).Replace(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> json = JsonConvert.SerializeObject(arg.Tweet); File.AppendAllText(<span class="hljs-string"><span class="hljs-string">"tweets.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{json}</span></span></span><span class="hljs-string">\r\n"</span></span>); actor.Tell(arg.Tweet); }; stream.StartStream(); }</code> </pre> <br> ( <a href=""></a> ) <br><br>  CreateSampleStream    ,       .      ,   ,    ,  : ¬´  ¬ª.     IEnumerable,       . <br><br>  <a href="">TweetEnumerator</a>   :     ,     Current, MoveNext, Reset,   Dispose,    .    ,      .   ,      .      . <br><br>     useCachedTweets  true,    . CashedTweets ‚Äî    ,       50000 ,     , ,    .    ,         ,   .   ‚Äî    .          ,   . <br><br> TweetsWithBroadcast: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> graph = GraphDsl.Create(b =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> broadcast = b.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Broadcast&lt;ITweet&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> merge = b.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Merge&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>)); b.From(broadcast.Out(<span class="hljs-number"><span class="hljs-number">0</span></span>)) .Via(Flow.Create&lt;ITweet&gt;().Select(tweet =&gt; tweet.CreatedBy)) .Via(formatUser) .To(merge.In(<span class="hljs-number"><span class="hljs-number">0</span></span>)); b.From(broadcast.Out(<span class="hljs-number"><span class="hljs-number">1</span></span>)) .Via(Flow.Create&lt;ITweet&gt;().Select(tweet =&gt; tweet.Coordinates)) .Via(formatCoordinates) .To(merge.In(<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FlowShape&lt;ITweet, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(broadcast.In, merge.Out); });</code> </pre> <br> ( <a href=""></a> ) <br><br>   Scala,    ,   DSL.    Broadcast    ‚Äî out(0), out(1) ‚Äî      CreatedBy,    ,        .    . <br><br>     ‚Äî   .    . <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> graph = GraphDsl.Create(b =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> broadcast = b.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Broadcast&lt;ITweet&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> merge = b.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Merge&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>)); b.From(broadcast.Out(<span class="hljs-number"><span class="hljs-number">0</span></span>)) .Via(Flow.Create&lt;ITweet&gt;().Select(tweet =&gt; tweet.CreatedBy) .Throttle(<span class="hljs-number"><span class="hljs-number">10</span></span>, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, ThrottleMode.Shaping)) .Via(formatUser) .To(merge.In(<span class="hljs-number"><span class="hljs-number">0</span></span>)); b.From(broadcast.Out(<span class="hljs-number"><span class="hljs-number">1</span></span>)) .Via(Flow.Create&lt;ITweet&gt;().Select(tweet =&gt; tweet.Coordinates) .Buffer(<span class="hljs-number"><span class="hljs-number">10</span></span>, OverflowStrategy.DropNew) .Throttle(<span class="hljs-number"><span class="hljs-number">1</span></span>, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">10</span></span>, ThrottleMode.Shaping)) .Via(formatCoordinates) .To(merge.In(<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FlowShape&lt;ITweet, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(broadcast.In, merge.Out); });}</code> </pre> <br> ( <a href=""></a> ) <br><br>          10   ,               10.    ,    ,  ,    . , ,   Akka Streams   Reactive Streams:     .   ,     ,   ,  ,    -  .    , ,    ,          .    ,      .   ,    ,    .     Buffer(10, OverFlowStrategy.DropHead).      ,         .      10        ,      .  , ,  - ,   ‚Äî      - ,   , ,   , . .          . ,      . <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> graph = GraphDsl.Create(b =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> broadcast = b.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Broadcast&lt;ITweet&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> merge = b.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Merge&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>)); b.From(broadcast.Out(<span class="hljs-number"><span class="hljs-number">0</span></span>)) .Via(Flow.Create&lt;ITweet&gt;().Select(tweet =&gt; tweet.CreatedBy) .Throttle(<span class="hljs-number"><span class="hljs-number">10</span></span>, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, ThrottleMode.Shaping)) .Via(formatUser) .To(merge.In(<span class="hljs-number"><span class="hljs-number">0</span></span>)); b.From(broadcast.Out(<span class="hljs-number"><span class="hljs-number">1</span></span>)) .Via(Flow.Create&lt;ITweet&gt;().Select(tweet =&gt; tweet.Coordinates) .Buffer(<span class="hljs-number"><span class="hljs-number">10</span></span>, OverflowStrategy.DropNew) .Throttle(<span class="hljs-number"><span class="hljs-number">1</span></span>, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">10</span></span>, ThrottleMode.Shaping)) .Via(Flow.Create&lt;ICoordinates&gt;().SelectAsync(<span class="hljs-number"><span class="hljs-number">5</span></span>, Utils.GetWeatherAsync)) .Via(formatTemperature) .To(merge.In(<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FlowShape&lt;ITweet, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(broadcast.In, merge.Out); });</code> </pre> <br> ( <a href=""></a> ) <br><br>     ,    SelectAsync,     .         ,    ,        5:  ,    5  ,     ,       .    ,    ,     . <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWeatherAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ICoordinates coordinates</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> requestUrl = <span class="hljs-string"><span class="hljs-string">$"http://api.met.no/weatherapi/locationforecast/1.9/?lat=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{coordinates.Latitude}</span></span></span><span class="hljs-string">;lon=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{coordinates.Latitude}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.GetStringAsync(requestUrl); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> doc = XDocument.Parse(result); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temp = doc.Root.Descendants(<span class="hljs-string"><span class="hljs-string">"temperature"</span></span>).First().Attribute(<span class="hljs-string"><span class="hljs-string">"value"</span></span>).Value; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>.Parse(temp); }</code> </pre> <br> ( <a href=""></a> ) <br><br>    .     -,      ,   -  ,   HttpClient   ,   XML,   ,     . <br><br>  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> ,      ,      .     10     10    ,          ,   . <br><br>  ,    ‚Äî   ,       .     ,     Akka Streams,   ,    . ,       ,  . <br><br>      , ,  ,       Akka Streams,        .  ,        ,      Akka Streams,       C#      ,      ,        ,    ,    . <br><br><h1>   </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/17a/f2f/c2b/17af2fc2bfbacfc95fbe5bc9504a346e.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que id√©ias sobre o Akka Streams eu gostaria que voc√™ criasse depois de ler este artigo? No DotNext 2017 Moscou, eu estava em uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apresenta√ß√£o de Alex Thyssen</font></font></a>  Azure Functions.   -     ,      deployment,    ,      (      - ,     ,   ),            .     ,        ,    ,        .        ,      ,    Akka Streams, ..    ,            .                 . <br><br>  Akka Streams       , ,   ,     ,   ,      .    ,         ,     ,      ,    ,           .   Akka Streams ‚Äî  ,     ,          . <br><br>        ,       Akka Streams,  ¬´Akka Stream Rap¬ª.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>  ,    . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/1Ct3eIQ0Tgc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><blockquote> <i>This is the Akka Stream. <br><br> This is the Source that feeds the Akka Stream. <br><br> This is the MapAsync that maps from the Source that feeds the Akka Stream. <br><br> This is the Broadcast that forks the MapAsync that maps from the Source that feeds the Akka Stream. <br><br> This is the Merge that collects from the Broadcast that forks the MapAsync that maps from the Source that feeds the Akka Stream. <br><br> This is the FilterNot that selects from the Merge that collects from the Broadcast that forks the MapAsync that maps from the Source that feeds the Akka Streams. <br><br> This is the Balance that splits the FilterNot that selects from the Merge that collects from the Broadcast that forks the MapAsync that maps from the Source that feeds the Akka Stream. <br><br> This is the Zip that combines from the Balance that splits the FilterNot that selects from the Merge that collects from the Broadcast that forks the MapAsync that maps from the Source that feeds the Akka Stream. <br><br> This is the Drop that removes from the Zip that combines from the Balance that splits the FilterNot that selects from the Merge that collects from the Broadcast that forks the MapAsync that maps from the Source that feeds the Akka Stream. <br><br> This is TakeWhile that pulls from the Drop that removes from the Zip that combines from the Balance that splits the FilterNot that selects from the Merge that collects from the Broadcast that forks the MapAsync that maps from the Source that feeds the Akka Stream. <br><br> This is the Throttle that speeds down the TakeWhile that pulls from the Drop that removes from the Zip that combines from the Balance that splits the FilterNot that selects from the Merge that collects from the Broadcast that forks the MapAsync that maps from the Source that feeds the Akka Stream. <br><br> This is the Bidiflow that turns back the Throttle that speeds down the TakeWhile that pulls from the Drop that removes from the Zip that combines from the Balance that splits the FilterNot that selects from the Merge that collects from the Broadcast that forks the MapAsync that maps from the source that feeds the Akka Streams. <br><br> This is the Sink that is filled from the Bidiflow that turns back the Throttle that speeds down the TakeWhile that pulls from the Drop that removes from the Zip that combines from the Balance that splits the FilterNot that selects from the Merge that collects from the Broadcast that forks the MapAsync that maps from the Source that feeds the Akka Stream.</i> </blockquote> <b> .</b>         ‚Äî 22-23      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DotNext 2018 Moscow</a> ,        .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>    (     ). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418639/">https://habr.com/ru/post/pt418639/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418629/index.html">Como verificar independentemente se voc√™ pode patentear seu produto e realizar uma pesquisa de patentes</a></li>
<li><a href="../pt418631/index.html">7 diretrizes de c√≥digo javascript</a></li>
<li><a href="../pt418633/index.html">Reatividade JavaScript: um exemplo simples e intuitivo</a></li>
<li><a href="../pt418635/index.html">Criando uma m√°quina de arcade emulador. Parte 1</a></li>
<li><a href="../pt418637/index.html">Kubernetes para as massas: Slurm come√ßa em 3 de agosto</a></li>
<li><a href="../pt418641/index.html">Um erro que impede um designer de crescer</a></li>
<li><a href="../pt418643/index.html">Sit vs stand: como trabalhar melhor?</a></li>
<li><a href="../pt418645/index.html">Artigos da confer√™ncia de primavera C ++ R√∫ssia 2018</a></li>
<li><a href="../pt418647/index.html">TESS lan√ßa pesquisa de exoplanetas</a></li>
<li><a href="../pt418649/index.html">A gera√ß√£o cont√≠nua de vers√µes alternativas do TLS resolver√° o problema de ossifica√ß√£o do protocolo antigo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>