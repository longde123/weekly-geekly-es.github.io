<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘‹ğŸ½ ğŸ¤« ğŸ¦– ç±»ä¼¼äºUnixçš„OSå¼€å‘-å­—ç¬¦è®¾å¤‡é©±åŠ¨ç¨‹åºï¼ˆ8ï¼‰ ğŸ§‘ğŸ¼â€ğŸ¤â€ğŸ§‘ğŸ» âœ³ï¸ â°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¤šä»»åŠ¡å¤„ç†ã€‚ ä»Šå¤©æ˜¯æ—¶å€™è€ƒè™‘å­—ç¬¦è®¾å¤‡é©±åŠ¨ç¨‹åºä¸»é¢˜äº†ã€‚ 

 å…·ä½“æ¥è¯´ï¼Œä»Šå¤©ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç»ˆç«¯é©±åŠ¨ç¨‹åºï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºå»¶è¿Ÿå¤„ç†ä¸­æ–­çš„æœºåˆ¶ï¼Œå¹¶è€ƒè™‘ä¸ŠåŠéƒ¨åˆ†å’Œä¸‹åŠéƒ¨åˆ†ä¸­æ–­çš„å¤„ç†ç¨‹åºä¸»é¢˜ã€‚ 

 æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªè®¾å¤‡ç»“æ„ï¼Œç„¶åä»‹ç»åŸºæœ¬çš„æ–‡ä»¶I / Oæ”¯æŒï¼Œè€ƒè™‘io_bufç»“æ„å’Œç”¨äº...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç±»ä¼¼äºUnixçš„OSå¼€å‘-å­—ç¬¦è®¾å¤‡é©±åŠ¨ç¨‹åºï¼ˆ8ï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468509/"> åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¤šä»»åŠ¡å¤„ç†ã€‚ ä»Šå¤©æ˜¯æ—¶å€™è€ƒè™‘å­—ç¬¦è®¾å¤‡é©±åŠ¨ç¨‹åºä¸»é¢˜äº†ã€‚ <br><br> å…·ä½“æ¥è¯´ï¼Œä»Šå¤©ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç»ˆç«¯é©±åŠ¨ç¨‹åºï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºå»¶è¿Ÿå¤„ç†ä¸­æ–­çš„æœºåˆ¶ï¼Œå¹¶è€ƒè™‘ä¸ŠåŠéƒ¨åˆ†å’Œä¸‹åŠéƒ¨åˆ†ä¸­æ–­çš„å¤„ç†ç¨‹åºä¸»é¢˜ã€‚ <br><br> æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªè®¾å¤‡ç»“æ„ï¼Œç„¶åä»‹ç»åŸºæœ¬çš„æ–‡ä»¶I / Oæ”¯æŒï¼Œè€ƒè™‘io_bufç»“æ„å’Œç”¨äºå¤„ç†stdio.hä¸­æ–‡ä»¶çš„åŠŸèƒ½ã€‚ <br><a name="habracut"></a><br><h4> ç›®å½• </h4><br> æ„å»ºç³»ç»Ÿï¼ˆmakeï¼Œgccï¼Œgasï¼‰ã€‚ åˆå§‹å¼•å¯¼ï¼ˆå¤šæ¬¡å¼•å¯¼ï¼‰ã€‚ å¯åŠ¨ï¼ˆqemuï¼‰ã€‚  Cåº“ï¼ˆstrcpyï¼Œmemcpyï¼Œstrextï¼‰ã€‚  Cåº“ï¼ˆsprintfï¼Œstrcpyï¼Œstrcmpï¼Œstrtokï¼Œva_list ...ï¼‰ã€‚ ä»¥å†…æ ¸æ¨¡å¼å’Œç”¨æˆ·åº”ç”¨ç¨‹åºæ¨¡å¼æ„å»ºåº“ã€‚ å†…æ ¸ç³»ç»Ÿæ—¥å¿—ã€‚ æ˜¾å­˜ è¾“å‡ºåˆ°ç»ˆç«¯ï¼ˆkprintfï¼Œkpanicï¼Œkassertï¼‰ã€‚ åŠ¨æ€å†…å­˜ï¼Œå †ï¼ˆkmallocï¼Œkfreeï¼‰ã€‚ å†…å­˜å’Œä¸­æ–­å¤„ç†çš„ç»„ç»‡ï¼ˆGDTï¼ŒIDTï¼ŒPICï¼Œsyscallï¼‰ã€‚ ä¾‹å¤–æƒ…å†µ è™šæ‹Ÿå†…å­˜ï¼ˆé¡µé¢ç›®å½•å’Œé¡µé¢è¡¨ï¼‰ã€‚ è¿‡ç¨‹ã€‚ ç­–åˆ’äºº å¤šä»»åŠ¡å¤„ç†ã€‚ ç³»ç»Ÿè°ƒç”¨ï¼ˆkillï¼Œexitï¼Œpsï¼‰ã€‚ <br><br>  <b>å­—ç¬¦è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚</b>  <b>ç³»ç»Ÿè°ƒç”¨ï¼ˆioctlï¼Œfopenï¼Œfreadï¼Œfwriteï¼‰ã€‚</b>  <b>Cåº“ï¼ˆfopenï¼Œfcloseï¼Œfprintfï¼Œfscanfï¼‰ã€‚</b> <br><br> å†…æ ¸ï¼ˆinitrdï¼‰ï¼ŒelfåŠå…¶å†…éƒ¨æ–‡ä»¶ç³»ç»Ÿã€‚ ç³»ç»Ÿè°ƒç”¨ï¼ˆæ‰§è¡Œï¼‰ã€‚  Shellä½œä¸ºå†…æ ¸çš„å®Œæ•´ç¨‹åºã€‚ ç”¨æˆ·ä¿æŠ¤æ¨¡å¼ï¼ˆring3ï¼‰ã€‚ ä»»åŠ¡çŠ¶æ€æ®µï¼ˆtssï¼‰ã€‚ <br><br><h4> è§’è‰²é©±åŠ¨ </h4><br> è¿™ä¸€åˆ‡éƒ½å§‹äºç¬¦å·è®¾å¤‡çš„å‡ºç°ã€‚ æ‚¨è¿˜è®°å¾—ï¼Œåœ¨Linuxè®¾å¤‡é©±åŠ¨ç¨‹åºä¸­ï¼Œè®¾å¤‡å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cdev</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">my_cdev</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cdev_alloc</span></span></span><span class="hljs-class">( );</span></span> my_cdev-&gt;ops = &amp;my_fops;</code> </pre> <br> è¦ç‚¹æ˜¯ä¸ºè®¾å¤‡åˆ†é…æ–‡ä»¶I / OåŠŸèƒ½çš„å®ç°ã€‚ <br><br> æˆ‘ä»¬å°†é‡‡ç”¨ä¸€ç§ç»“æ„ï¼Œä½†æ˜¯å«ä¹‰å°†ç›¸ä¼¼ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clist_head_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list_head</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* should be at first */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> name[<span class="hljs-number"><span class="hljs-number">8</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/* device name */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* base_r; <span class="hljs-comment"><span class="hljs-comment">/* base read address */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* base_w; <span class="hljs-comment"><span class="hljs-comment">/* base write address */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dev_read_cb_t</span></span> read_cb; <span class="hljs-comment"><span class="hljs-comment">/* read handler */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dev_write_cb_t</span></span> write_cb; <span class="hljs-comment"><span class="hljs-comment">/* write handler */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dev_ioctl_cb_t</span></span> ioctl_cb; <span class="hljs-comment"><span class="hljs-comment">/* device specific command handler */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clist_definition_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ih_list</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* low half interrupt handlers */</span></span> };</code> </pre><br> æ¯ä¸ªè®¾å¤‡å¯¹åº”äºç”Ÿæˆä¸­æ–­æ—¶è°ƒç”¨çš„ä¸­æ–­åˆ—è¡¨çš„ä¸€åŠã€‚ <br><br> åœ¨Linuxä¸­ï¼Œè¿™æ ·çš„ä¸€åŠç§°ä¸ºä¸ŠåŠéƒ¨åˆ†ï¼Œç›¸åï¼Œç§°ä¸ºä¸‹åŠéƒ¨åˆ†ï¼ˆä¸‹åŠéƒ¨åˆ†ï¼‰ã€‚ <br><br> å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œè¿™ä¼¼ä¹æ›´åŠ åˆä¹é€»è¾‘ï¼Œè€Œæˆ‘æ— æ„ä¸­åˆæƒ³èµ·äº†è¿™äº›æœ¯è¯­ã€‚ æˆ‘ä»¬å°†ä¸‹åŠéƒ¨åˆ†ä¸­æ–­åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ æè¿°ä¸º <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ih_low_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clist_head_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list_head</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* should be at first */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> number; <span class="hljs-comment"><span class="hljs-comment">/* interrupt number */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ih_low_cb_t</span></span> handler; <span class="hljs-comment"><span class="hljs-comment">/* interrupt handler */</span></span> };</code> </pre><br> åˆå§‹åŒ–åï¼Œé©±åŠ¨ç¨‹åºå°†é€šè¿‡dev_registerå‡½æ•°æ³¨å†Œå…¶è®¾å¤‡ï¼Œæ¢å¥è¯è¯´ï¼Œå°†æ–°è®¾å¤‡æ·»åŠ åˆ°ç¯åˆ—è¡¨ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dev_register</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">dev_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* dev)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clist_head_t</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entry</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev_t</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">device</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* create list entry */</span></span> entry = clist_insert_entry_after(&amp;dev_list, dev_list.head); device = (struct <span class="hljs-keyword"><span class="hljs-keyword">dev_t</span></span>*)entry-&gt;data; <span class="hljs-comment"><span class="hljs-comment">/* fill data */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">strncpy</span></span>(device-&gt;name, dev-&gt;name, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(dev-&gt;name)); device-&gt;base_r = dev-&gt;base_r; device-&gt;base_w = dev-&gt;base_w; device-&gt;read_cb = dev-&gt;read_cb; device-&gt;write_cb = dev-&gt;write_cb; device-&gt;ioctl_cb = dev-&gt;ioctl_cb; device-&gt;ih_list.head = dev-&gt;ih_list.head; device-&gt;ih_list.slot_size = dev-&gt;ih_list.slot_size; }</code> </pre><br> ä¸ºäº†ä½¿æ‰€æœ‰è¿™äº›éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦æ–‡ä»¶ç³»ç»Ÿçš„åŸºç¡€ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å°†åªåŒ…å«ç”¨äºå­—ç¬¦è®¾å¤‡çš„æ–‡ä»¶ã€‚ <br><br> å³ æ‰“å¼€æ–‡ä»¶ç­‰åŒäºä»stdioä¸ºç›¸åº”çš„é©±åŠ¨ç¨‹åºæ–‡ä»¶åˆ›å»ºFILEç»“æ„ã€‚ <br><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ–‡ä»¶åå°†ä¸è®¾å¤‡ååŒ¹é…ã€‚ æˆ‘ä»¬åœ¨Cåº“ï¼ˆstdio.hï¼‰ä¸­å®šä¹‰æ–‡ä»¶æè¿°ç¬¦çš„æ¦‚å¿µã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">io_buf_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fd; <span class="hljs-comment"><span class="hljs-comment">/* file descriptor */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* base; <span class="hljs-comment"><span class="hljs-comment">/* buffer beginning */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* ptr; <span class="hljs-comment"><span class="hljs-comment">/* position in buffer */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> is_eof; <span class="hljs-comment"><span class="hljs-comment">/* whether end of file */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* file; <span class="hljs-comment"><span class="hljs-comment">/* file definition */</span></span> }; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> FILE struct io_buf_t</span></span></code> </pre><br> ä¸ºäº†ç®€å•èµ·è§ï¼Œç°åœ¨è®©æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶éƒ½å­˜å‚¨åœ¨é“ƒå£°åˆ—è¡¨ä¸­ã€‚ åˆ—è¡¨é¡¹æè¿°å¦‚ä¸‹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">file_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clist_head_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list_head</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* should be at first */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">io_buf_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">io_buf</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* file handler */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> name[<span class="hljs-number"><span class="hljs-number">8</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/* file name */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mod_rw; <span class="hljs-comment"><span class="hljs-comment">/* whether read or write */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev_t</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* whether device driver */</span></span> };</code> </pre><br> å¯¹äºæ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å­˜å‚¨æŒ‡å‘è®¾å¤‡çš„é“¾æ¥ã€‚ æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæ‰“å¼€æ–‡ä»¶çš„åˆ—è¡¨ï¼Œå¹¶å®ç°äº†read / write / ioctlç³»ç»Ÿè°ƒç”¨ã€‚ <br><br> æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ¥è‡ªé©±åŠ¨ç¨‹åºçš„è¯»å–å’Œå†™å…¥ç¼“å†²åŒºçš„åˆå§‹ä½ç½®åˆ†é…ç»™io_buf_tç»“æ„ï¼Œå¹¶å› æ­¤å°†æ–‡ä»¶æ“ä½œä¸è®¾å¤‡é©±åŠ¨ç¨‹åºå…³è”ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> struct io_buf_t* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file_open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mod_rw)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clist_head_t</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entry</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">file_t</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">file</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev_t</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* try to find already opened file */</span></span> entry = clist_find(&amp;file_list, file_list_by_name_detector, path, mod_rw); file = (struct <span class="hljs-keyword"><span class="hljs-keyword">file_t</span></span>*)entry-&gt;data; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entry != null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;file-&gt;io_buf; } <span class="hljs-comment"><span class="hljs-comment">/* create list entry */</span></span> entry = clist_insert_entry_after(&amp;file_list, file_list.head); file = (struct <span class="hljs-keyword"><span class="hljs-keyword">file_t</span></span>*)entry-&gt;data; <span class="hljs-comment"><span class="hljs-comment">/* whether file is device */</span></span> dev = dev_find_by_name(path); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dev != null) { <span class="hljs-comment"><span class="hljs-comment">/* device */</span></span> file-&gt;dev = dev; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mod_rw == MOD_R) { file-&gt;io_buf.base = dev-&gt;base_r; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mod_rw == MOD_W) { file-&gt;io_buf.base = dev-&gt;base_w; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* fs node */</span></span> file-&gt;dev = null; unreachable(); <span class="hljs-comment"><span class="hljs-comment">/* fs in not implemented yet */</span></span> } <span class="hljs-comment"><span class="hljs-comment">/* fill data */</span></span> file-&gt;mod_rw = mod_rw; file-&gt;io_buf.fd = next_fd++; file-&gt;io_buf.ptr = file-&gt;io_buf.base; file-&gt;io_buf.is_eof = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; file-&gt;io_buf.file = file; <span class="hljs-built_in"><span class="hljs-built_in">strncpy</span></span>(file-&gt;name, path, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(file-&gt;name)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;file-&gt;io_buf; }</code> </pre><br> ä»¥è¯»å–ç³»ç»Ÿè°ƒç”¨ä¸ºä¾‹ï¼Œé€šè¿‡ä¸€ç§æ¨¡å¼å®šä¹‰æ–‡ä»¶è¯»/å†™/ ioctlæ“ä½œã€‚ <br><br> æˆ‘ä»¬åœ¨ä¸Šä¸€è¯¾ä¸­å­¦åˆ°çš„ç³»ç»Ÿè°ƒç”¨å°†ä»…è°ƒç”¨è¿™äº›å‡½æ•°ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> size_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file_read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">io_buf_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* io_buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buff, u_int size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">file_t</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">file</span></span></span><span class="hljs-class">;</span></span> file = (struct <span class="hljs-keyword"><span class="hljs-keyword">file_t</span></span>*)io_buf-&gt;file; <span class="hljs-comment"><span class="hljs-comment">/* whether file is device */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file-&gt;dev != null) { <span class="hljs-comment"><span class="hljs-comment">/* device */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> file-&gt;dev-&gt;read_cb(&amp;file-&gt;io_buf, buff, size); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* fs node */</span></span> unreachable(); <span class="hljs-comment"><span class="hljs-comment">/* fs in not implemented yet */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br> ç®€è€Œè¨€ä¹‹ï¼Œå®ƒä»¬å°†ä»…ä»è®¾å¤‡å®šä¹‰ä¸­æå–å›è°ƒã€‚ ç°åœ¨æˆ‘ä»¬å°†ç¼–å†™ç»ˆç«¯é©±åŠ¨ç¨‹åºã€‚ <br><br><h4> ç»ˆç«¯é©±åŠ¨ </h4><br> æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå±å¹•è¾“å‡ºç¼“å†²åŒºå’Œé”®ç›˜è¾“å…¥ç¼“å†²åŒºï¼Œä»¥åŠå‡ ä¸ªç”¨äºè¾“å…¥å’Œè¾“å‡ºæ¨¡å¼çš„æ ‡å¿—ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* tty_dev_name = TTY_DEV_NAME; <span class="hljs-comment"><span class="hljs-comment">/* teletype device name */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> tty_output_buff[VIDEO_SCREEN_SIZE]; <span class="hljs-comment"><span class="hljs-comment">/* teletype output buffer */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> tty_input_buff[VIDEO_SCREEN_WIDTH]; <span class="hljs-comment"><span class="hljs-comment">/* teletype input buffer */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* tty_output_buff_ptr = tty_output_buff; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* tty_input_buff_ptr = tty_input_buff; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> read_line_mode = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* whether read only whole line */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> is_echo = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* whether to put readed symbol to stdout */</span></span></code> </pre><br> æˆ‘ä»¬ç¼–å†™äº†åˆ›å»ºè®¾å¤‡çš„åŠŸèƒ½ã€‚ å®ƒåªæ˜¯æ”¾ä¸‹æ–‡ä»¶æ“ä½œå’Œä¸‹åŠéƒ¨åˆ†ä¸­æ–­çš„å¤„ç†ç¨‹åºçš„å›è°ƒï¼Œç„¶ååœ¨ç¯åˆ—è¡¨ä¸­æ³¨å†Œè¯¥è®¾å¤‡ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tty_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clist_head_t</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entry</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ih_low_t</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ih_low</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(tty_output_buff, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(VIDEO_SCREEN_SIZE)); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(tty_input_buff, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(VIDEO_SCREEN_WIDTH)); <span class="hljs-comment"><span class="hljs-comment">/* register teletype device */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">strcpy</span></span>(dev.name, tty_dev_name); dev.base_r = tty_input_buff; dev.base_w = tty_output_buff; dev.read_cb = tty_read; dev.write_cb = tty_write; dev.ioctl_cb = tty_ioctl; dev.ih_list.head = null; <span class="hljs-comment"><span class="hljs-comment">/* add interrupt handlers */</span></span> dev.ih_list.slot_size = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(struct <span class="hljs-keyword"><span class="hljs-keyword">ih_low_t</span></span>); entry = clist_insert_entry_after(&amp;dev.ih_list, dev.ih_list.head); ih_low = (struct <span class="hljs-keyword"><span class="hljs-keyword">ih_low_t</span></span>*)entry-&gt;data; ih_low-&gt;number = INT_KEYBOARD; ih_low-&gt;handler = tty_keyboard_ih_low; dev_register(&amp;dev); }</code> </pre><br> é”®ç›˜çš„ä¸‹éƒ¨ä¸­æ–­å¤„ç†ç¨‹åºå®šä¹‰å¦‚ä¸‹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Key press low half handler */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tty_keyboard_ih_low</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number, struct </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ih_low_data_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* write character to input buffer */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* keycode = data-&gt;data; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = *keycode; assert(index &lt; <span class="hljs-number"><span class="hljs-number">128</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ch = keyboard_map[index]; *tty_input_buff_ptr++ = ch; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_echo &amp;&amp; ch != <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* echo character to screen */</span></span> *tty_output_buff_ptr++ = ch; } <span class="hljs-comment"><span class="hljs-comment">/* register deffered execution */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">;</span></span> msg.type = IPC_MSG_TYPE_DQ_SCHED; msg.len = <span class="hljs-number"><span class="hljs-number">4</span></span>; *((<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> *)msg.data) = (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)tty_keyboard_ih_high; ksend(TID_DQ, &amp;msg); }</code> </pre><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªæ˜¯å°†è¾“å…¥çš„å­—ç¬¦æ”¾åœ¨é”®ç›˜ç¼“å†²åŒºä¸­ã€‚ æœ€åï¼Œæˆ‘ä»¬æ³¨å†Œé”®ç›˜ä¸­æ–­ä¸ŠåŠéƒ¨åˆ†çš„å¤„ç†å™¨çš„å»¶è¿Ÿè°ƒç”¨ã€‚ è¿™æ˜¯é€šè¿‡å°†æ¶ˆæ¯ï¼ˆIPCï¼‰å‘é€åˆ°å†…æ ¸çº¿ç¨‹æ¥å®Œæˆçš„ã€‚ <br><br> å†…æ ¸çº¿ç¨‹æœ¬èº«éå¸¸ç®€å•ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Deferred queue execution scheduler * This task running in kernel mode */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dq_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message_t</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;;) { kreceive(TID_DQ, &amp;msg); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (msg.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IPC_MSG_TYPE_DQ_SCHED: <span class="hljs-comment"><span class="hljs-comment">/* do deffered callback execution */</span></span> assert(msg.len == <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">dq_handler_t</span></span> handler = (<span class="hljs-keyword"><span class="hljs-keyword">dq_handler_t</span></span>)*((<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>*)msg.data); assert((<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)handler &lt; KERNEL_CODE_END_ADDR); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(MSG_DQ_SCHED, handler); handler(msg); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre><br> ä½¿ç”¨å®ƒï¼Œå°†è°ƒç”¨é”®ç›˜ä¸­æ–­çš„ä¸ŠåŠéƒ¨åˆ†çš„å¤„ç†ç¨‹åºã€‚ å…¶ç›®çš„æ˜¯é€šè¿‡å°†è¾“å‡ºç¼“å†²åŒºå¤åˆ¶åˆ°è§†é¢‘å­˜å‚¨å™¨æ¥åœ¨å±å¹•ä¸Šå¤åˆ¶å­—ç¬¦ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Key press high half handler */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tty_keyboard_ih_high</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">message_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *msg)</span></span></span><span class="hljs-function"> </span></span>{ video_flush(tty_output_buff); }</code> </pre><br> ç°åœ¨å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯è‡ªå·±ç¼–å†™I / Oå‡½æ•°ï¼Œä»æ–‡ä»¶æ“ä½œä¸­è°ƒç”¨ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Read line from tty to string */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> u_int </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tty_read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">io_buf_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* io_buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buffer, u_int size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* ptr = buffer; assert((<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)io_buf-&gt;ptr &lt;= (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)tty_input_buff_ptr); assert((<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)tty_input_buff_ptr &gt;= (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)tty_input_buff); assert(size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); io_buf-&gt;is_eof = (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)io_buf-&gt;ptr == (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)tty_input_buff_ptr; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (read_line_mode) { io_buf-&gt;is_eof = !<span class="hljs-built_in"><span class="hljs-built_in">strchr</span></span>(io_buf-&gt;ptr, <span class="hljs-string"><span class="hljs-string">'\n'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size - <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; !io_buf-&gt;is_eof; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ch = tty_read_ch(io_buf); *ptr++ = ch; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (read_line_mode &amp;&amp; ch == <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)ptr - (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)buffer; } <span class="hljs-comment"><span class="hljs-comment">/* * Write to tty */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tty_write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">io_buf_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* io_buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* data, u_int size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* ptr = data; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size &amp;&amp; !io_buf-&gt;is_eof; ++i) { tty_write_ch(io_buf, *ptr++); } }</code> </pre><br> é€ä¸ªå­—ç¬¦çš„æ“ä½œå¹¶ä¸å¤æ‚ï¼Œæˆ‘è®¤ä¸ºå®ƒä»¬ä¸éœ€è¦æ³¨é‡Šã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Write single character to tty */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tty_write_ch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">io_buf_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* io_buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)tty_output_buff_ptr - (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)tty_output_buff + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt; VIDEO_SCREEN_SIZE) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch != <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* regular character */</span></span> *tty_output_buff_ptr++ = ch; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* new line character */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> line_pos = ((<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)tty_output_buff_ptr - (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)tty_output_buff) % VIDEO_SCREEN_WIDTH; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; VIDEO_SCREEN_WIDTH - line_pos; ++j) { *tty_output_buff_ptr++ = <span class="hljs-string"><span class="hljs-string">' '</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { tty_output_buff_ptr = video_scroll(tty_output_buff, tty_output_buff_ptr); tty_write_ch(io_buf, ch); } io_buf-&gt;ptr = tty_output_buff_ptr; } <span class="hljs-comment"><span class="hljs-comment">/* * Read single character from tty */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tty_read_ch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">io_buf_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* io_buf)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)io_buf-&gt;ptr &lt; (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)tty_input_buff_ptr) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *io_buf-&gt;ptr++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { io_buf-&gt;is_eof = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; } }</code> </pre><br> ä»…éœ€æ§åˆ¶è¾“å…¥å’Œè¾“å‡ºæ¨¡å¼å³å¯å®ç°ioctlã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Teletype specific command */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tty_ioctl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">io_buf_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* io_buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> command)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* hello_msg = MSG_KERNEL_NAME; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (command) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IOCTL_INIT: <span class="hljs-comment"><span class="hljs-comment">/* prepare video device */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (io_buf-&gt;base == tty_output_buff) { kmode(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* detach syslog from screen */</span></span> tty_output_buff_ptr = video_clear(io_buf-&gt;base); io_buf-&gt;ptr = tty_output_buff_ptr; tty_write(io_buf, hello_msg, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(hello_msg)); video_flush(io_buf-&gt;base); io_buf-&gt;ptr = tty_output_buff_ptr; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (io_buf-&gt;base == tty_input_buff) { unreachable(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IOCTL_CLEAR: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (io_buf-&gt;base == tty_output_buff) { <span class="hljs-comment"><span class="hljs-comment">/* fill output buffer with spaces */</span></span> tty_output_buff_ptr = video_clear(io_buf-&gt;base); video_flush(io_buf-&gt;base); io_buf-&gt;ptr = tty_output_buff_ptr; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (io_buf-&gt;base == tty_input_buff) { <span class="hljs-comment"><span class="hljs-comment">/* clear input buffer */</span></span> tty_input_buff_ptr = tty_input_buff; io_buf-&gt;ptr = io_buf-&gt;base; io_buf-&gt;is_eof = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IOCTL_FLUSH: <span class="hljs-comment"><span class="hljs-comment">/* flush buffer to screen */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (io_buf-&gt;base == tty_output_buff) { video_flush(io_buf-&gt;base); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (io_buf-&gt;base == tty_input_buff) { unreachable(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IOCTL_READ_MODE_LINE: <span class="hljs-comment"><span class="hljs-comment">/* read only whole line */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (io_buf-&gt;base == tty_input_buff) { read_line_mode = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (io_buf-&gt;base == tty_output_buff) { unreachable(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IOCTL_READ_MODE_ECHO: <span class="hljs-comment"><span class="hljs-comment">/* put readed symbol to stdout */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (io_buf-&gt;base == tty_input_buff) { is_echo = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (io_buf-&gt;base == tty_output_buff) { unreachable(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: unreachable(); } }</code> </pre><br> ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨åº“Cçº§åˆ«å®ç°æ–‡ä»¶è¾“å…¥è¾“å‡ºã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Api - Open file */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> FILE* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fopen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mod_rw)</span></span></span><span class="hljs-function"> </span></span>{ FILE* result = null; asm_syscall(SYSCALL_OPEN, file, mod_rw, &amp;result); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-comment"><span class="hljs-comment">/* * Api - Close file */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fclose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FILE* file)</span></span></span><span class="hljs-function"> </span></span>{ asm_syscall(SYSCALL_CLOSE, file); } <span class="hljs-comment"><span class="hljs-comment">/* * Api - Read from file to buffer */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> u_int </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FILE* file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buff, u_int size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> asm_syscall(SYSCALL_READ, file, buff, size); } <span class="hljs-comment"><span class="hljs-comment">/* * Api - Write data to file */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fwrite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FILE* file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* data, u_int size)</span></span></span><span class="hljs-function"> </span></span>{ asm_syscall(SYSCALL_WRITE, file, data, size); }</code> </pre><br> å¥½å§ï¼Œè¿™é‡Œæœ‰ä¸€äº›é«˜çº§åŠŸèƒ½ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Api - Print user message */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uvnprintf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* format, u_int n, va_list </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">list</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buff[VIDEO_SCREEN_WIDTH]; vsnprintf(buff, n, format, <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>); uputs(buff); } <span class="hljs-comment"><span class="hljs-comment">/* * Api - Read from file to string */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uscanf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buff, ...)</span></span></span><span class="hljs-function"> </span></span>{ u_int readed = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { readed = fread(<span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>, buff, <span class="hljs-number"><span class="hljs-number">255</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (readed == <span class="hljs-number"><span class="hljs-number">0</span></span>); buff[readed - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* erase new line character */</span></span> uprintf(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); uflush(); }</code> </pre><br> ä¸ºäº†é¿å…åˆ°ç›®å‰ä¸ºæ­¢å¯¹æ ¼å¼è¯»å–çš„ç—´è¿·ï¼Œæˆ‘ä»¬å°†å§‹ç»ˆåªæ˜¯è¯»å…¥è¯¥è¡Œï¼Œå°±åƒç»™å‡ºäº†ï¼…sæ ‡å¿—ä¸€æ ·ã€‚ æˆ‘æ‡’å¾—ä»‹ç»ä¸€ä¸ªæ–°çš„ä»»åŠ¡çŠ¶æ€æ¥ç­‰å¾…æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯å°è¯•æ— é™å¾ªç¯åœ°è¯»å–æŸäº›å†…å®¹ï¼Œç›´åˆ°æˆåŠŸã€‚ <br><br> ä»…æ­¤è€Œå·²ã€‚ ç°åœ¨ï¼Œæ‚¨å¯ä»¥å®‰å…¨åœ°å°†é©±åŠ¨ç¨‹åºå›ºå®šåˆ°å†…æ ¸äº†ï¼ <br><br><h4> å‚è€ƒæ–‡çŒ® </h4><br> è§‚çœ‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è§†é¢‘æ•™ç¨‹</a>ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚ <br><br>  â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">gitå­˜å‚¨åº“ä¸­çš„</a>æºä»£ç ï¼ˆæ‚¨éœ€è¦lesson8åˆ†æ”¯ï¼‰ <br><br><h4> å‚è€ƒæ–‡çŒ® </h4><br><ol><li> è©¹å§†æ–¯Â·è«æ´›ä¼Šï¼ˆJames Molloyï¼‰ã€‚ æ»šåŠ¨è‡ªå·±çš„ç©å…·UNIXå…‹éš†æ“ä½œç³»ç»Ÿã€‚ </li><li> ç¥–å¸ƒç§‘å¤«ã€‚  DOSï¼ŒWindowsï¼ŒUnixçš„æ±‡ç¼–å™¨ </li><li> å¡æ‹‰ä»€å°¼ç§‘å¤«ã€‚ æ±‡ç¼–ç¨‹åºå¾ˆç®€å•ï¼ </li><li>  Tanenbaumã€‚ æ“ä½œç³»ç»Ÿã€‚ å®æ–½ä¸å¼€å‘ã€‚ </li><li> ç½—ä¼¯ç‰¹Â·æ´›å¤«ï¼ˆRobert Loveï¼‰ã€‚  Linuxå†…æ ¸ å¼€å‘è¿‡ç¨‹çš„æè¿°ã€‚ </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN468509/">https://habr.com/ru/post/zh-CN468509/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN468491/index.html">å“ˆå¸ƒæ‹‰ä¸šåŠ›è¯…å’’</a></li>
<li><a href="../zh-CN468493/index.html">æ•°æ®ç§‘å­¦é¡¹ç›®é¸Ÿç°å›¾çš„ç»“æ„</a></li>
<li><a href="../zh-CN468497/index.html">3åˆ†é’Ÿå®šæ—¶åˆ·ç‰™è®¡æ—¶å™¨</a></li>
<li><a href="../zh-CN468501/index.html">æˆ‘å¦‚ä½•åˆ›å»ºå³ä½¿è¿è¡Œä¸€ç™¾ä¸‡æ¬¡ä¹Ÿä¸ä¼šæŸåå›¾åƒçš„è¿‡æ»¤å™¨</a></li>
<li><a href="../zh-CN468503/index.html">é‚®ä»¶ä¸ä¼šå†èµ°500è‹±é‡Œ-å¸¸è§é—®é¢˜è§£ç­”</a></li>
<li><a href="../zh-CN468511/index.html">é€šè¿‡D-Link DFLç½‘å…³å‘å¸ƒæœåŠ¡å™¨</a></li>
<li><a href="../zh-CN468515/index.html">é›†æˆåˆ°æ–°é¡¹ç›®çš„æœ‰ç”¨æŠ€å·§</a></li>
<li><a href="../zh-CN468517/index.html">2. Extreme Networksäº¤æ¢æœºæŠ€æœ¯æ”¯æŒå’Œä¿ä¿®æ¦‚è¿°</a></li>
<li><a href="../zh-CN468519/index.html">åˆ›å»ºä¸€ä¸ªé€šç”¨ä»£ç åº“</a></li>
<li><a href="../zh-CN468521/index.html">æˆ‘ä»¬å¦‚ä½•æ¦‚æ‹¬ä¿¡æ¯å®‰å…¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>