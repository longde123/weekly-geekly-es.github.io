<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëêüèª ‚ÜîÔ∏è üë©üèæ‚ÄçüöÄ Instructions pas √† pas pour retrouver l'acc√®s aux instances Linux Amazon EC2 lors de la perte d'un fichier pem üåô üíÉüèª ‚úèÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si lors de la cr√©ation de l'instance Linux dans AWS, une paire de cl√©s (KeyPair) n'a pas √©t√© cr√©√©e pour y acc√©der via SSH ou qu'elles sont perdues, al...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Instructions pas √† pas pour retrouver l'acc√®s aux instances Linux Amazon EC2 lors de la perte d'un fichier pem</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420297/"> Si lors de la cr√©ation de l'instance Linux dans AWS, une paire de cl√©s (KeyPair) n'a pas √©t√© cr√©√©e pour y acc√©der via SSH ou qu'elles sont perdues, alors un certain nombre d'op√©rations doivent √™tre effectu√©es pour acc√©der √† la machine.  Vous ne pouvez pas ajouter de cl√©s √† une instance d√©j√† en cours d'ex√©cution via la console AWS.  Il existe trois fa√ßons de restaurer l'acc√®s SSH √† une instance. <br><br>  Le moyen le plus simple consiste √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">configurer la cl√© √† l'aide du m√©canisme cloud-init</a> (merci pour l'astuce de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">yusman</a> ).  Mais cela ne fonctionne pas si les droits sur le r√©pertoire <code>/home</code> sont endommag√©s ou si la distribution ne prend pas en charge les directives cloud-init. <br><br>  La deuxi√®me fa√ßon consiste √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cr√©er une image</a> (Amazon Machine Image) √† partir d'une instance existante, puis √† lancer une nouvelle instance bas√©e sur celle-ci, mais avec une cl√©.  Ainsi, la machine existante sera effectivement clon√©e avec la seule diff√©rence qu'au dernier stade, il est possible de cr√©er de nouvelles cl√©s.  La cr√©ation d'une image peut prendre beaucoup de temps pour une instance avec de grands disques, et vous devrez configurer √† nouveau tous les services li√©s √† cette machine.  Par cons√©quent, cette m√©thode prendra dans la plupart des cas plus de temps. <br><br>  Les documents officiels d'Amazon d√©crivent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une autre fa√ßon</a> .  Il vous permet de restaurer l'acc√®s et de minimiser le co√ªt des services de reconfiguration (par rapport √† la deuxi√®me m√©thode), qui sont li√©s √† une instance √† laquelle l'acc√®s est perdu.  L'article en donne une description pas √† pas. <br><a name="habracut"></a><br>  <i><b>Attention!</b></i>  <i>Cette m√©thode ne fonctionne que pour les instances qui utilisent le stockage en mode bloc (Amazon Elastic Block Store) en tant que p√©riph√©rique racine, et ne fonctionne pas pour le stockage d'instance local (Amazon EC2 Instance Store).</i> <br><br>  Pour savoir quel type de p√©riph√©rique racine vous utilisez, ouvrez la console Amazon EC2, acc√©dez √† <b>Instances</b> , s√©lectionnez une instance et v√©rifiez la valeur du param√®tre <b>Type de p√©riph√©rique racine</b> dans le panneau avec des informations d√©taill√©es. <br><br><div style="text-align:center;"><img alt="Type de p√©riph√©rique racine d'instance" src="https://habrastorage.org/webt/fi/gt/_m/figt_m6allv6zvevj8qrlwrzqos.png"></div><br>  Si votre machine est <abbr title="Amazon Elastic Block Store">√©quip√©e d'EBS</abbr> , cette m√©thode vous convient. <br><br><h3>  √âtape 1. Pr√©paration </h3><br>  Vous devez d'abord enregistrer certaines informations afin de ne pas vous laisser distraire et de ne pas passer √† d'autres √©crans (d'autant plus que cela sera tr√®s g√™nant).  Toutes les donn√©es se trouvent dans les informations d√©taill√©es de l'instance (vous savez d√©j√† comment vous y rendre).  Enregistrez les param√®tres suivants: <br><br><ul><li>  ID d'instance </li><li>  ID AMI </li><li>  ID EBS </li><li>  Appareil racine </li><li>  Zone de disponibilit√© </li></ul><br>  Pour une instance ex√©cut√©e dans <abbr title="Cloud priv√© virtuel Amazon">VPC</abbr> , enregistrez la valeur <b>ID VPC</b> . <br><br>  Pour <b>EC2-classic</b> : si une adresse IP √©lastique ( <b>Elastic IP</b> ) est cr√©√©e pour une instance, sa valeur doit √©galement √™tre enregistr√©e. <br><br><div style="text-align:center;"> <a href=""><img alt="Param√®tres d'instance √† enregistrer" src="https://habrastorage.org/webt/it/by/ga/itbygaladxipdfpdeywopgzb5mu.png"></a> </div>  <i>Image cliquable</i> <br><br>  Pour obtenir l'identifiant de stockage en bloc ( <b>ID EBS</b> ), cliquez sur le nom du <b>p√©riph√©rique racine</b> . <br><br><div style="text-align:center;"><img alt="ID EBS" src="https://habrastorage.org/webt/4c/lp/-q/4clp-q09-_rdn6h7y33b4g8ucw4.png"></div><br><br><h3>  √âtape 2. Cr√©ation d'une instance temporaire </h3><br>  L'√©tape suivante consiste √† cr√©er une instance avec laquelle vous restaurerez les cl√©s sur l'instance d'origine.  Vous pouvez ignorer cette √©tape si vous avez une autre instance en cours d'ex√©cution situ√©e dans la m√™me zone (zone de disponibilit√©) que celle restaur√©e, et en m√™me temps qu'elle a √©t√© cr√©√©e en utilisant la m√™me AMI ou la version du syst√®me d'exploitation sur elle vous permettra de connecter le disque √† partir de l'instance d'origine et copiez-y les cl√©s SSH.  S'il n'y a pas une telle instance, proc√©dez comme suit: <br><br><ul><li>  Acc√©dez √† la console EC2 (sur le tableau de bord ou dans le menu <b>Instances</b> ) et cliquez sur <b>Lancer l'instance</b> </li><li>  Sur la page de s√©lection AMI ( <b>Choose an Amazon Machine Image</b> ), s√©lectionnez celle qui a √©t√© utilis√©e pour cr√©er l'instance d'origine (vous l'avez not√©e √† la premi√®re √©tape - <b>ID AMI</b> ).  Si, pour une raison quelconque, cette AMI n'est pas disponible, vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cr√©er une image √†</a> partir de l'instance d'origine et l'utiliser, ou s√©lectionner le type d'AMI auquel vous pouvez connecter le disque racine de l'instance restaur√©e </li><li>  Sur la page <b>Choisir un type d'instance</b> , s√©lectionnez le type le moins cher disponible. </li><li>  Sur la page <b>Configurer les d√©tails de l'instance</b> , sp√©cifiez la m√™me <b>zone de disponibilit√©</b> que dans notre instance.  S'il s'ex√©cute dans VPC, s√©lectionnez le m√™me VPC dans l'√©l√©ment <b>R√©seau</b> et sp√©cifiez le sous-r√©seau dans cette zone. <br><br><div style="text-align:center;"><img alt="Configuration de la zone de disponibilit√©" src="https://habrastorage.org/webt/co/sf/q8/cosfq8fixautng3nvazmqvqcvqs.png"></div><br>  Cependant, il n'est pas n√©cessaire de modifier les param√®tres des interfaces r√©seau. <br></li><li>  Aucune modification n'est requise sur la page <b>Ajouter un stockage</b> . </li><li>  Sur la page des balises ( <b>Ajouter des balises</b> ), ajoutez un nom pour l'instance temporaire afin qu'elle soit facile √† identifier et ne perdez pas de temps √† r√©concilier l' <b>ID d'instance</b> et l' <b>ID EBS</b> , car sur les pages o√π vous devrez d√©terminer l'instance ou le volume avec lequel vous travaillez, dans le titre cette valeur appara√Ætra. <br><br><div style="text-align:center;"><img alt="Nom sur la page Ajouter des balises" src="https://habrastorage.org/webt/o4/wb/fh/o4wbfhmxk3fiqjzn-f4h1qykbbe.png"></div><br></li><li>  Cliquez sur <b>Review and Launch</b> puis sur <b>Launch</b> </li><li>  La derni√®re √©tape consiste √† s√©lectionner une paire de cl√©s existante ou √† en cr√©er une nouvelle.  T√©l√©chargez le fichier cl√© (pem) et n'oubliez pas de sauvegarder afin que toutes les op√©rations ne soient pas √† refaire. <br><br><div style="text-align:center;"><img alt="Enregistrement de KeyPair" src="https://habrastorage.org/webt/lz/jj/qv/lzjjqvfv0wjnnr7neskb6uq9jew.png"></div></li><li>  Apr√®s avoir enregistr√© le fichier, lancez l'instance avec le bouton <b>Lancer les instances</b> </li></ul><br><br><h3>  √âtape 3. Connexion du disque racine de la machine restaur√©e √† une instance temporaire </h3><br>  Vous devez d'abord d√©connecter le disque de l'instance d'origine et le connecter √† une instance temporaire.  Comme il s'agit du disque racine, l'instance d'origine devra √™tre arr√™t√©e avant de le d√©connecter. <br><br><ul><li>  Acc√©dez √† la console EC2 dans la section <b>Instances</b> et s√©lectionnez l'instance d'origine (elle peut √™tre d√©termin√©e par l' <b>ID d'instance</b> enregistr√© pr√©c√©demment ou par un nom diff√©rent de celui que vous avez sp√©cifi√© lors de la cr√©ation de l'instance temporaire). <br><br><div style="text-align:center;"><img alt="Arr√™t d'instance" src="https://habrastorage.org/webt/cf/nb/zt/cfnbztxp4mlphw5s16tqlzqjore.png"></div><br>  Ensuite dans le menu <b>Actions - Instance State - Stop</b> . <br><br>  <i><b>Attention!</b></i>  <i>Lorsque l'instance s'arr√™te, toutes les donn√©es du stockage local (Amazon EC2 Instance Store) sont effac√©es.</i>  <i>Si vous avez des donn√©es sur de tels volumes, veillez √† leur s√©curit√© en les transf√©rant vers un stockage permanent, si n√©cessaire.</i> <br></li><li>  Une fois l'instance arr√™t√©e, acc√©dez √† la section <b>Elastic Block Store - Volumes</b> et s√©lectionnez le volume racine de l'instance d'origine.  Il peut √™tre d√©termin√© par l' <b>ID de volume</b> stock√© ou bas√© sur les informations de la colonne <b>Informations</b> sur la <b>pi√®ce jointe</b> , qui contient le nom de l'instance. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8i/ce/ri/8icerixqy7088x9n8tutprj0dtq.png" alt="Disque muet"></div><br>  Suivant dans le menu <b>Actions - D√©tacher le volume</b> </li><li>  Connectez ce volume √† une instance temporaire.  Pour ce faire, s√©lectionnez-le √† nouveau, puis dans le menu <b>Actions - Attacher un volume</b> et dans la bo√Æte de dialogue qui appara√Æt, sp√©cifiez votre instance temporaire. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vq/jh/sx/vqjhsx1mc-pwfdi1khqxeo4ceio.png" alt="Connexion du lecteur"></div><br>  Cliquez ensuite sur <b>Attacher</b> .  Si l'instance d'origine a √©t√© cr√©√©e via l' <b>AMI AWS Marketplace</b> et que la section contient des codes AWS Marketplace, vous recevrez une erreur indiquant qu'il est impossible de connecter la section avec des codes √† l'instance de travail. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fm/ai/rb/fmairbibwjzh5aohbwori7qvnfs.png" alt="Erreur de connexion du lecteur avec les codes AWS Marketplace"></div><br>  Dans ce cas, arr√™tez notre instance temporaire et r√©p√©tez les √©tapes pour connecter le volume racine de l'instance d'origine √† l'instance temporaire.  La deuxi√®me tentative devrait r√©ussir. <br></li><li>  Vous devriez maintenant voir que les deux disques sont connect√©s √† une instance temporaire. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jm/wp/km/jmwpkmco-z6kphxqxmpfxqr2g2m.png" alt="Les deux disques sont connect√©s √† une instance temporaire"></div></li><li>  Si vous avez arr√™t√© l'instance, ex√©cutez-la: <br><br><ul><li>  Acc√©dez √† la section <b>Instances</b> de la barre de navigation. </li><li>  Choisissez une instance temporaire </li><li>  Ensuite dans le menu <b>Actions - √âtat de l'instance - D√©marrer</b> . </li></ul><br></li></ul><br><h3>  √âtape 4. Pr√©paration des cl√©s pour la connexion √† l'instance via SSH </h3><br>  Les utilisateurs de Linux n'ont pas besoin de g√©n√©rer de cl√©s suppl√©mentaires.  Vous devez seulement donner des autorisations de lecture √† ce fichier: <br><br> <code>chmod 400 my-keypair.pem</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Pr√©paration des cl√©s si vous ex√©cutez Windows</b> <div class="spoiler_text">  Pour vous connecter √† une machine Linux, nous utiliserons l'utilitaire PuTTY, donc si vous ne l'avez pas install√©, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©chargez-</a> le.  Pour vous connecter via SSH en l'utilisant, vous aurez besoin d'une <b>cl√© ppk</b> , tandis qu'avec AWS, la cl√© au format <b>pem</b> a √©t√© <b>enregistr√©e</b> .  Afin d'obtenir la cl√© au format souhait√©, proc√©dez comme suit: <br><br><ul><li>  Ouvrez <b>PuTTYgen</b> (install√© avec PuTTY) </li><li>  S√©lectionnez 2048 bits dans les param√®tres RSA <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qo/ha/hd/qohahd_138adlmeua2nwdn2h6nq.png" alt="RSA 2048 bits"></div></li><li>  T√©l√©chargez la cl√© pem enregistr√©e en cliquant sur <b>Charger</b> (Charger un fichier de cl√© priv√©e existant) </li><li>  Sp√©cifiez la phrase de passe (phrase de passe <b>cl√©</b> ) et confirmez-la ( <b>confirmez la phrase de passe</b> ).  Ce n'est pas n√©cessaire, mais plus s√ªr.  La seule diff√©rence est que lors de la connexion √† l'aide de cette touche, il vous sera toujours demand√© de saisir cette phrase pour confirmer l'entr√©e </li><li>  Enregistrez le fichier avec le nom que vous avez sp√©cifi√© lors de la cr√©ation de la paire de cl√©s ( <b>KeyPair</b> ) lors de la cr√©ation de l'instance temporaire (le nom co√Øncide avec le nom de la <b>cl√© pem</b> ) </li></ul><br>  La cl√© est pr√™te. <br></div></div><br><br><h3>  √âtape 5. Connectez-vous √† une instance temporaire via SSH </h3><br>  Connectez-vous sur le port 22 √† l'aide de la cl√©.  Le nom d'utilisateur d√©pend de l'AMI utilis√© pour cr√©er l'instance.  Vous l'avez √©crit au tout d√©but.  Les noms d'utilisateur suivants sont possibles: <br><br><ul><li>  Amazon Linux 2 ou Amazon Linux AMI - ec2-user </li><li>  Centos AMI - centos </li><li>  Debian AMI - admin ou root </li><li>  Fedora AMI - ec2-user ou fedora </li><li>  RHEL AMI - utilisateur ec2 ou root </li><li>  SUSE AMI - utilisateur ec2 ou root </li><li>  Ubuntu AMI - Ubuntu </li><li>  Pour le reste, si les noms ec2-user et root ne fonctionnent pas, contactez votre fournisseur AMI </li></ul><br>  Le nom d'h√¥te auquel vous souhaitez vous connecter est <i>user@aws-host.amazon.com</i> , o√π <i>user</i> est le nom d√©crit ci-dessus, et <i>aws-host.amazon.com</i> est l'adresse IP de votre instance, qui peut √™tre trouv√©e sur l'onglet d'informations d√©taill√©es (√† partir de l√†, vous avez enregistr√© les param√®tres au tout d√©but).  Le param√®tre est appel√© <b>IPv4 Public IP</b> .  Veuillez noter que si vous n'utilisez pas <b>Elastic IP</b> , chaque fois que vous d√©marrez l'instance, elle aura une nouvelle adresse IP. <br><br><div class="spoiler">  <b class="spoiler_title">Instructions de connexion pour les utilisateurs de Windows</b> <div class="spoiler_text"><ul><li>  Lancer PuTTY </li><li>  Dans le champ <b>Host Name</b> , l'adresse est au format <i>username @ ip-address</i> <i><br><br></i> <div style="text-align:center;"><img src="https://habrastorage.org/webt/50/mo/sn/50mosnkqgxx0rsby9eihvqq7qb4.png" alt="Configurez PuTTY. Nom d'h√¥te"></div><br></li><li>  Acc√©dez √† la section <b>Connexion - SSH - Auth</b> et t√©l√©chargez la <b>cl√© ppk</b> (fichier de cl√© priv√©e pour l'authentification) </li><li>  Cliquez sur <b>Ouvrir</b> , puis acceptez de faire confiance au serveur <br></li><li>  Si vous avez sp√©cifi√© une phrase secr√®te lors de la cr√©ation d'une cl√© ppk, saisissez-la pour confirmer l'entr√©e: <br><br><pre> <code class="bash hljs">Using username <span class="hljs-string"><span class="hljs-string">"ubuntu"</span></span>. Authenticating with public key <span class="hljs-string"><span class="hljs-string">"imported-openssh-key"</span></span> Passphrase <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key <span class="hljs-string"><span class="hljs-string">"imported-openssh-key"</span></span>:</code> </pre><br></li><li>  Vous √™tes sur le serveur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hn/tp/r-/hntpr-ztewfqqfvkbv1sonlk_by.png" alt="Connexion au serveur r√©ussie"></div><br></li></ul><br></div></div><br><h3>  √âtape 6. Copie des cl√©s d'une instance temporaire vers l'original </h3><br>  Montez le volume que vous avez connect√© √† l'instance temporaire pour pouvoir acc√©der √† son syst√®me de fichiers. <br><br><div class="spoiler">  <b class="spoiler_title">Monter la partition</b> <div class="spoiler_text">  Par exemple, si le nom du lecteur est <code>/dev/sdf</code> (il peut appara√Ætre diff√©remment sur votre instance), utilisez les op√©rations suivantes pour monter le volume dans <code>/mnt/tempvol</code> : <br><br><ul><li>  D√©terminez les noms de partition du lecteur mapp√©: <br><br> <code>[user ~]$ <b>lsblk</b></code> <br> <br><pre> <code class="bash hljs">NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT xvda 202:0 0 10G 0 disk ‚îî‚îÄxvda1 202:1 0 10G 0 part / xvdf 202:80 0 10G 0 disk ‚îî‚îÄxvdf1 202:81 0 10G 0 part</code> </pre><br>  <code>/dev/xvda1</code> et <code>/dev/xvdf1</code> sont des partitions de disque.  <code>/dev/xvdf1</code> n'a pas de point de montage (MOUNTPOINT), c'est donc la partition de disque que nous avons connect√©e plus t√¥t. <br></li><li>  Cr√©ez un r√©pertoire temporaire pour monter la partition: <br><br> <code>[user ~]$ <b>sudo mkdir /mnt/tempvol</b></code> </li> <li>  Montez la partition dans le r√©pertoire cr√©√©: <br><br> <code>[user ~]$ <b>sudo mount /dev/ <font color="#ff0000">xvdf1</font> /mnt/tempvol</b></code> <br> </li></ul><br></div></div><br>  Copiez les cl√©s SSH de l'instance temporaire vers la partition mont√©e. <br><br>  <i><b>Attention!</b></i>  <i>Utilisez le nom d'utilisateur fourni sur la ligne de commande.</i>  <i>Cela est n√©cessaire, car malgr√© le fait que vous ayez r√©ussi √† vous connecter avec un nom d'utilisateur standard, qui d√©pend du syst√®me d'exploitation (d√©crit √† l'√©tape 5), dans l'AMI d'AWS Marketplace, il peut √™tre diff√©rent apr√®s la connexion.</i>  <i>Par exemple, pour AMI WordPress Certified by Bitnami, lors de la connexion via SSH, la connexion standard pour Ubuntu est <code>ubuntu</code> .</i>  <i>Cependant, le nom d'utilisateur apr√®s la connexion est <code>bitnami</code></i> <br><br><div class="spoiler">  <b class="spoiler_title">Copier les cl√©s</b> <div class="spoiler_text">  Par exemple, si le nom d'utilisateur est <code>ubuntu</code> , utilisez la commande suivante pour copier: <br><br> <code>[user ~]$ <b>cp .ssh/authorized_keys /mnt/tempvol/home/ <font color="#ff0000">ubuntu</font> /.ssh/authorized_keys</b> <br></code> <br>  Si vous n'√™tes pas autoris√© √† modifier les fichiers dans <code>/mnt/tempvol</code> , copiez les fichiers √† l'aide de <code>sudo</code> et v√©rifiez les droits pour vous assurer que vous pouvez acc√©der √† l'instance d'origine: <br><br><ul><li>  V√©rifiez les autorisations des fichiers: <br><br> <code>[user ~]$ <b>sudo ls -l /mnt/tempvol/home/ <font color="#ff0000">ubuntu</font> /.ssh/authorized_keys</b></code> <br> <code>total 4</code> <br> <code>-rw------- 1 <font color="#ff0000">200</font> <font color="#ff0000">500</font> 392 Aug 15 00:06 authorized_keys</code> <br> <br>  Dans l'exemple, 200 est l'ID utilisateur et 500 est l'ID de groupe. <br></li><li>  Red√©marrez la commande de copie de cl√© √† l'aide de <code>sudo</code> : <br><br> <code>[user ~]$ <b>sudo cp .ssh/authorized_keys /mnt/tempvol/home/ <font color="#ff0000">ubuntu</font> /.ssh/authorized_keys</b> <br></code> <br></li><li>  V√©rifiez si les autorisations sur le fichier ont chang√©: <br><br> <code>[user ~]$ <b>sudo ls -l /mnt/tempvol/home/ <font color="#ff0000">ubuntu</font> /.ssh/authorized_keys</b></code> <br> <br>  Si les droits ont chang√©, restaurez-les: <br><br> <code>[user ~]$ <b>sudo chown <font color="#ff0000">200</font> : <font color="#ff0000">500</font> /mnt/tempvol/home/ <font color="#ff0000">ubuntu</font> /.ssh/authorized_keys</b></code> <br> </li></ul><br></div></div><br>  D√©montez la section: <br><br> <code>[user ~]$ <b>sudo umount /mnt/tempvol</b></code> <br> <br><h3>  √âtape 7. D√©marrage de l'instance avec un acc√®s restaur√© via SSH </h3><br><ul><li>  Dans la console EC2, s√©lectionnez le lecteur que vous avez connect√© au temporaire et dans le menu: <b>Actions - D√©tacher le volume</b> .  Attendez que l'√©tat du disque soit <b>disponible</b> (vous pouvez utiliser le bouton <b>Actualiser</b> pour mettre √† jour les informations). <br><br>  <i>N'oubliez pas de pr√©-terminer l'instance si la section contient des codes AWS Marketplace.</i> <br></li><li>  Pour le m√™me lecteur, acc√©dez au menu <b>Actions - Attacher le volume</b> </li><li>  S√©lectionnez l'instance d'origine et sp√©cifiez le nom du disque racine que vous avez enregistr√© au tout d√©but. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uq/u_/6o/uqu_6okxfqdxqk4e6tpcers5roc.png" alt="Connexion du lecteur"></div>  <i>Image cliquable</i> <br><br>  Cliquez sur <b>Attacher</b> <br></li><li>  Ex√©cuter l'instance </li><li>  Pour <b>EC2-classic</b> : si <b>Elastic IP a</b> √©t√© configur√© pour l'instance d'origine, r√©associez-la √† celle-ci: <br><br><ul><li>  Acc√©dez √† la section <b>Elastic IP</b> de la barre de navigation. </li><li>  S√©lectionnez l'adresse <b>IP √©lastique</b> que vous avez not√©e au tout d√©but </li><li>  <b>Actions</b> suivantes <b>- Adresse associ√©e</b> </li><li>  S√©lectionnez l' <b>ID d'</b> instance d'origine et cliquez sur <b>Associer</b> </li></ul><br></li></ul><br><h3>  √âtape 8. Contr√¥le d'acc√®s </h3><br>  Connectez-vous √† l'instance d'acc√®s restaur√©e √† l'aide de la cl√© g√©n√©r√©e. <br><br>  <i>Si le nom de la nouvelle paire de cl√©s est diff√©rent du pr√©c√©dent, assurez-vous que vous vous connectez √† l'aide de la nouvelle cl√© priv√©e.</i> <br><br><h3>  √âtape 9. L'√©tape finale </h3><br>  Si vous avez cr√©√© une nouvelle instance temporaire afin d'effectuer toutes les op√©rations et que vous n'en avez pas utilis√© une existante, arr√™tez-la si vous n'en avez plus besoin: <br><br><ul><li>  Acc√©dez √† la section <b>Instances</b> de la barre de navigation. </li><li>  Choisissez une instance temporaire </li><li>  Suivant dans le menu <b>Actions - √âtat de l'instance - Terminer</b> </li></ul><br>  De cette fa√ßon, vous avez r√©cup√©r√© l'acc√®s √† l'instance Linux Amazon EC2. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420297/">https://habr.com/ru/post/fr420297/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420285/index.html">MPRU, revenus et comment ils se rapportent aux revenus et √† la dynamique de la client√®le</a></li>
<li><a href="../fr420289/index.html">Comment nous adaptons les tables √† l'√©cran du smartphone et les unifions dans le cadre du syst√®me de conception</a></li>
<li><a href="../fr420291/index.html">Spectre et Meltdown ne sont plus les attaques les plus dangereuses contre les processeurs Intel. Des chercheurs signalent une vuln√©rabilit√© de pr√©figuration</a></li>
<li><a href="../fr420293/index.html">33 serveurs √† deux unit√©s avec 13 To de RAM et 0,6 PT de stockage distribu√© - pourquoi est-ce un minimum pour UBA proactif</a></li>
<li><a href="../fr420295/index.html">NeoQUEST-2018: le Cold Boot tant attendu, la recherche scientifique et les invit√©s de Nizhny Novgorod</a></li>
<li><a href="../fr420299/index.html">Mes exemples pr√©f√©r√©s de programmation fonctionnelle dans Kotlin</a></li>
<li><a href="../fr420301/index.html">Le Premier ministre indien Narendra Modi: nous enverrons le drapeau du pays dans l'espace √† bord du Gaganyan en 2022</a></li>
<li><a href="../fr420303/index.html">√âquilibrage de charge lors de l'analyse de sites et de la connexion de ressources cloud suppl√©mentaires</a></li>
<li><a href="../fr420305/index.html">Comment √©crire des programmes √† la jonction du d√©veloppement mobile et des algorithmes? Concours et histoires Yandex</a></li>
<li><a href="../fr420307/index.html">5 astuces CSS √† conna√Ætre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>