<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëêüèæ üë©üèø‚Äç‚úàÔ∏è ü§Ωüèø API du contrat WG: zoo des services üßëüèº‚Äçü§ù‚Äçüßëüèª üêä üì¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avec l'augmentation du nombre de composants d'un syst√®me logiciel, le nombre de personnes participant √† son d√©veloppement augmente g√©n√©ralement √©galem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>API du contrat WG: zoo des services</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wargaming/blog/441708/"><img src="https://habrastorage.org/webt/iz/gg/o8/izggo8dsjxgjso5tku-q65ezmwq.jpeg"><br><br>  Avec l'augmentation du nombre de composants d'un syst√®me logiciel, le nombre de personnes participant √† son d√©veloppement augmente g√©n√©ralement √©galement.  En cons√©quence, afin de maintenir le rythme de d√©veloppement et la facilit√© de maintenance, les approches de l'organisation de l'API devraient faire l'objet d'une attention particuli√®re. <br><br>  Si vous voulez voir de plus pr√®s comment l'√©quipe de Wargaming Platform fait face √† la complexit√© d'un syst√®me de plus d'une centaine de services Web interagissant les uns avec les autres, alors bienvenue chez cat. <br><a name="habracut"></a><br>  Bonjour √† tous!  Je m'appelle Valentine et je suis ing√©nieur sur la plateforme de Wargaming.  Pour ceux qui ne savent pas ce qu'est la plateforme et ce qu'elle fait, je vais laisser ici un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> vers la publication r√©cente d'un de mes coll√®gues - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">max_posedon</a> <br><br>  En ce moment, je travaille dans l'entreprise depuis plus de cinq ans et j'ai trouv√© en partie la p√©riode de croissance active de World of Tanks.  Pour d√©couvrir les probl√®mes soulev√©s dans cet article, je dois commencer par une br√®ve digression dans l'histoire de la plateforme Wargaming. <br><br><h2>  Un peu d'histoire </h2><br>  La popularit√© croissante des ¬´tanks¬ª s'est av√©r√©e √™tre semblable √† une avalanche, et comme c'est g√©n√©ralement le cas dans de tels cas, l'infrastructure autour du jeu a commenc√© √† se d√©velopper rapidement.  En cons√©quence, le jeu a rapidement envahi divers services Web et, au moment o√π je me suis joint √† l'√©quipe, leur score atteignait d√©j√† des dizaines (maintenant, en passant, plus de 100 composants de plate-forme fonctionnent et profitent √† l'entreprise). <br><br>  Au fil du temps, de nouveaux jeux sont sortis et il n'√©tait plus facile de comprendre les subtilit√©s des int√©grations entre les services Web.  La situation n'a fait qu'empirer lorsque des √©quipes d'autres bureaux de Wargaming ont rejoint le d√©veloppement de la plateforme.  Le d√©veloppement est devenu distribu√©, avec toutes les cons√©quences sous forme de distance, de fuseaux horaires et de barri√®re linguistique.  Et il y a plus de services.  Trouver une personne qui comprend le fonctionnement de la plateforme dans son ensemble n'est pas si facile.  Les informations devaient souvent √™tre collect√©es en plusieurs parties aupr√®s de diff√©rentes sources. <br><br>  Les interfaces des diff√©rents services Web pouvaient √™tre tr√®s diff√©rentes dans la conception stylistique, ce qui rendait le processus d'int√©gration avec la plate-forme encore plus difficile.  Et les d√©pendances directes entre composants ont r√©duit la flexibilit√© de d√©veloppement en compliquant la d√©composition des fonctionnalit√©s au sein de la plate-forme.  Pour aggraver les choses, les jeux - clients de la plateforme - connaissaient bien notre topologie, car ils devaient s'int√©grer directement √† chaque service de plateforme.  Cela leur a donn√© l'occasion, en utilisant des connexions horizontales, de faire pression pour la mise en ≈ìuvre de certaines am√©liorations directement dans le composant avec lequel elles sont int√©gr√©es.  Cela a conduit √† l'apparition de fonctionnalit√©s en double dans divers composants de la plate-forme, ainsi qu'√† l'incapacit√© d'√©tendre les fonctionnalit√©s existantes √† d'autres jeux.  Il est devenu √©vident que continuer √† construire une plate-forme autour de chaque jeu sp√©cifique est une branche de d√©veloppement sans issue.  Nous avions besoin de changements techniques et organisationnels, gr√¢ce auxquels nous pouvions prendre le contr√¥le de la complexit√© croissante d'un syst√®me en croissance rapide et rendre toutes les fonctionnalit√©s de la plate-forme adapt√©es √† n'importe quel jeu. <br><br>  Avec cela, je veux terminer l'excursion historique et, enfin, parler de l'une de nos solutions techniques, qui aide √† garder le contr√¥le de la complexit√© caus√©e par le nombre toujours croissant de services.  De plus, il r√©duit le co√ªt de d√©veloppement de nouvelles fonctionnalit√©s et simplifie consid√©rablement l'int√©gration avec la plate-forme. <br><br><h2>  D√©couvrez l'API Contract </h2><br>  √Ä l'int√©rieur de la plateforme, nous l'appelons l'API Contract.  √Ä la base, c'est un cadre d'int√©gration repr√©sent√© par un ensemble de documentation et de biblioth√®ques clientes pour chaque technologie de notre pile (Erlang / Elixir, Java / Scala, Python).  Il est d√©velopp√©, tout d'abord, afin de simplifier l'int√©gration des composants de la plateforme entre eux.  Deuxi√®mement, pour nous aider √† r√©soudre un certain nombre des probl√®mes suivants: <br><br><ul><li>  diff√©rences stylistiques des interfaces de programme </li><li>  la pr√©sence de d√©pendances inter-composants directes </li><li>  tenir √† jour la documentation </li><li>  introspection et d√©bogage des fonctionnalit√©s de bout en bout </li></ul><br>  Alors, tout d'abord. <br><br><h2>  Diff√©rences stylistiques dans les interfaces logicielles </h2><br>  √Ä mon avis, ce probl√®me est survenu √† la suite d'une combinaison de plusieurs facteurs: <br><br><ul><li>  <b>Absence d'un standard strict de ce √† quoi devrait ressembler l'API.</b>  L'ensemble de recommandations n'a souvent pas l'effet souhait√©, l'API est toujours diff√©rente.  Surtout si le d√©veloppement est r√©alis√© par des √©quipes de diff√©rents bureaux de l'entreprise.  Chaque √©quipe a ses propres habitudes et pratiques.  Collectivement, ces API ne ressemblent souvent pas √† des parties d'un tout. </li><li>  <b>Absence d'un r√©pertoire unique avec les noms et les formats d'entit√©s sp√©cifiques √† l'entreprise.</b>  En r√®gle g√©n√©rale, vous ne pouvez pas prendre une entit√© du r√©sultat d'une API et la transmettre √† l'API d'un autre service.  Cela n√©cessite une transformation. </li><li>  <b>Absence d'un syst√®me d'examen centralis√© obligatoire pour l'API.</b>  Il y a toujours des d√©lais et il n'y a pas de temps pour collecter les mises √† jour et, par ailleurs, apporter des modifications √† l'API, qui s'av√®re en fait souvent d√©j√† √† moiti√© test√©e. </li></ul><br>  La premi√®re chose que nous avons faite lors de la conception de l'API Contract a √©t√© de dire que d√©sormais l'API appartient √† la plateforme, et non √† un seul composant.  Cela a conduit au fait que le d√©veloppement de nouvelles fonctionnalit√©s commence par une requ√™te pull vers une API de stockage centralis√©e.  Actuellement, nous utilisons le r√©f√©rentiel GIT comme stockage.  Pour plus de commodit√©, nous avons divis√© l'ensemble de l'API en fonctions m√©tier distinctes, formalis√© la structure de cette fonction et l'avons appel√©e Contrat. <br><br>  Depuis lors, chaque nouvelle fonction m√©tier dans notre API de contrat doit √™tre d√©crite dans un format sp√©cial et passer par la demande de tirage avec un examen obligatoire.  Il n'y a pas d'autre moyen de publier une nouvelle API dans l'API Contract.  Dans le m√™me r√©f√©rentiel, nous avons d√©fini un r√©pertoire d'entit√©s sp√©cifiques √† l'entreprise et sugg√©r√© aux d√©veloppeurs de contrats de les r√©utiliser au lieu de d√©crire ces entit√©s elles-m√™mes. <br><br>  Nous avons donc obtenu une API conceptuellement holistique de la plate-forme, qui ressemblait √† un produit unique, malgr√© le fait qu'elle ait √©t√© mise en ≈ìuvre sur de nombreux composants de la plate-forme √† l'aide de diff√©rentes piles technologiques. <br><br><h2>  La pr√©sence de d√©pendances inter-composants directes </h2><br>  Le probl√®me que nous avons rencontr√© s'est manifest√© par le fait que chaque composant de la plate-forme devait savoir qui assurait sp√©cifiquement le service dont il avait besoin. <br><br>  Et ce n'√©tait m√™me pas la difficult√© de maintenir ce r√©pertoire √† jour, mais le fait que les d√©pendances directes ont consid√©rablement compliqu√© la migration des fonctionnalit√©s m√©tier d'un composant de plateforme √† un autre.  Le probl√®me √©tait particuli√®rement aigu lorsque nous avons commenc√© la d√©composition de nos monolithes en composants plus petits.  Il s'est av√©r√© que convaincre le client de remplacer l'int√©gration de travail par n'importe quelle fonctionnalit√© par la m√™me du point de vue de l'entreprise, mais une autre du point de vue technique, n'est pas une t√¢che de gestion triviale.  Le client n'y voit tout simplement pas l'int√©r√™t, car tout fonctionne bien pour lui.  En cons√©quence, des couches de compatibilit√© ascendante √† l'odeur d√©sagr√©able ont √©t√© √©crites, ce qui n'a fait que compliquer le support de la plate-forme et a eu un effet n√©faste sur la qualit√© du service.  Et comme nous allions d√©j√† standardiser l'API de la plateforme, il √©tait n√©cessaire de r√©soudre simultan√©ment ce probl√®me. <br><br>  Nous avons √©t√© confront√©s √† un choix de plusieurs options.  Parmi ceux-ci, nous avons particuli√®rement √©tudi√© attentivement: <br><br><ul><li>  Impl√©mentation de protocoles de <i>d√©couverte</i> de <i>service</i> sur chacun des composants. </li><li>  Utilisation d'un m√©diateur pour rediriger les demandes des clients vers le composant de plateforme appropri√©. </li><li>  Utilisation d'un <i>courtier de messages</i> comme bus de messagerie. </li></ul><br>  √Ä la suite de certaines r√©flexions et exp√©riences, le choix s'est port√© sur le courtier de messages, malgr√© le fait qu'il nous voyait comme un seul point de d√©faillance potentiel et augmentait les frais g√©n√©raux d'exploitation de la plate-forme.  Un r√¥le important dans la s√©lection a √©t√© jou√© par le fait qu'√† l'√©poque, la plateforme avait d√©j√† une expertise dans le travail avec RabbitMQ.  Et le courtier lui-m√™me a bien √©volu√© et avait des m√©canismes int√©gr√©s pour assurer la tol√©rance aux pannes.  En prime, nous avons eu l'opportunit√© de mettre en ≈ìuvre une <i>architecture √©v√©nementielle</i> ( <i>architecture √©v√©nementielle</i> ou <i>EDA</i> ) ¬´sous le capot¬ª.  Ce qui a par la suite ouvert devant nous des possibilit√©s plus larges d'interaction interservices, par rapport √† l'interaction point √† point. <br><br>  Donc, topologiquement, la plate-forme a commenc√© √† passer d'un graphique √† connectivit√© al√©atoire √† une √©toile.  Et les composants de la plate-forme ont invers√© leurs d√©pendances et ont eu la possibilit√© d'interagir les uns avec les autres exclusivement via des contrats enregistr√©s dans un r√©f√©rentiel centralis√©, sans avoir besoin de savoir qui impl√©mente sp√©cifiquement un contrat particulier.  En d'autres termes, tous les composants de la plateforme ont pu interagir les uns avec les autres √† l'aide d'un point d'int√©gration unique, ce qui a grandement simplifi√© la vie des d√©veloppeurs. <br><br><h2>  Tenir la documentation √† jour </h2><br>  Les probl√®mes li√©s au manque de documentation ou √† la perte de sa pertinence sont presque toujours rencontr√©s.  Et plus le rythme de d√©veloppement est √©lev√©, plus il se manifeste souvent.  Et apr√®s coup, la collecte de toutes les sp√©cifications de l'API en un seul endroit et format pour plus d'une centaine de services dans une √©quipe distribu√©e et multinationale est une t√¢che difficile. <br><br>  Lors du d√©veloppement de l'API Contract, nous nous sommes √©galement fix√© l'objectif de r√©soudre ce probl√®me.  Et nous l'avons fait.  Un format strictement d√©fini pour la description du contrat nous a permis de construire un processus selon lequel, imm√©diatement apr√®s l'apparition d'un nouveau contrat, l'assemblage automatique de la documentation est d√©marr√©.  Cela nous donne confiance que notre documentation API est toujours √† jour.  Ce processus est enti√®rement automatis√© et ne n√©cessite aucun effort de d√©veloppement ou de gestion. <br><br><h2>  Introspection et d√©bogage de la fonctionnalit√© de bout en bout </h2><br>  Lorsque nous avons divis√© nos monolithes en composants plus petits, tout naturellement, des difficult√©s ont commenc√© √† survenir lors du d√©bogage des fonctionnalit√©s de bout en bout.  Si le service d'une fonction m√©tier √©tait r√©parti sur plusieurs composants de plate-forme, alors souvent pour localiser et d√©boguer le probl√®me, il fallait chercher des repr√©sentants de chacun des composants.  Ce qui √©tait parfois r√©alisable avec difficult√©, √©tant donn√© le d√©calage horaire de 11 heures avec certains de nos coll√®gues. <br><br>  Avec l'av√®nement de l'API Contract, et en particulier gr√¢ce au courtier de messages qui la sous-tend, nous avons eu la possibilit√© de recevoir des copies des messages impliqu√©s dans l'ex√©cution d'une fonction m√©tier, sans effets secondaires sur les participants √† l'interaction.  Pour ce faire, il n'est m√™me pas n√©cessaire de savoir lequel des composants de la plateforme est responsable du traitement d'un contrat particulier.  Et apr√®s la localisation du probl√®me, nous pouvons obtenir l'identifiant du composant cass√© √† partir des m√©tadonn√©es du message de probl√®me. <br><br><h2>  Qu'avons-nous d√©velopp√© d'autre que l'API Contract </h2><br>  En plus de son objectif principal et de la r√©solution des probl√®mes ci-dessus, l'API Contract nous a permis de mettre en ≈ìuvre un certain nombre de services utiles. <br><br><h3>  Passerelle pour acc√©der aux fonctionnalit√©s de la plateforme </h3><br>  La standardisation de l'API sous forme de contrats nous a permis de d√©velopper un point d'acc√®s unique aux fonctionnalit√©s de la plateforme via HTTP.  De plus, avec l'av√®nement de nouvelles fonctionnalit√©s (contrats), nous n'avons plus besoin de modifier ce point d'acc√®s.  Il est compatible avec tous les futurs contrats.  Cela vous permet de travailler avec la plate-forme en tant que produit unique en utilisant l'interface HTTP habituelle. <br><br><h3>  Service des op√©rations de masse </h3><br>  Tout contrat peut √™tre lanc√© dans le cadre d'une op√©ration de masse, avec la possibilit√© de suivre son statut et de recevoir ensuite un rapport sur les r√©sultats de cette op√©ration.  Ce service, tout comme le pr√©c√©dent, est compatible avec tous les futurs contrats √† l'avance. <br><br><h3>  Gestion des erreurs de plate-forme unifi√©e </h3><br>  Le protocole Contract API standardise √©galement les erreurs.  Cela nous a permis de mettre en ≈ìuvre un intercepteur d'erreurs, qui analyse leur gravit√© et informe le syst√®me de surveillance des probl√®mes potentiels sur les composants de la plate-forme.  Et √† l'avenir, il pourra d√©cider ind√©pendamment de la d√©couverte d'un bug sur le composant de la plateforme.  L'intercepteur d'erreurs les attrape directement aupr√®s du courtier de messages et ne sait rien de l'objet d'un contrat ou d'une erreur, agissant uniquement sur la base de m√©ta-informations.  Cela lui permet, ainsi que tous les services d√©crits dans cette section, d'√™tre compatible avec tous les futurs contrats. <br><br><h3>  G√©n√©rer automatiquement des interfaces utilisateur </h3><br>  Des contrats strictement formalis√©s vous permettent de cr√©er automatiquement des composants d'interface utilisateur.  Nous avons d√©velopp√© un service qui vous permet de g√©n√©rer une interface administrative bas√©e sur une collection de contrats, puis d'int√©grer cette interface dans l'un de nos outils de plateforme.  Ainsi, les administrateurs que nous avons pr√©c√©demment √©crits avec nos mains peuvent maintenant √™tre g√©n√©r√©s (bien que partiellement jusqu'√† pr√©sent) en mode automatique. <br><br><h3>  Journalisation de la plateforme </h3><br>  Cette composante n'est pas encore impl√©ment√©e et est en cours de d√©veloppement.  Mais √† l'avenir, cela permettra ¬´√† la vol√©e¬ª d'activer et de d√©sactiver la journalisation de toute fonction commerciale de la plate-forme, en extrayant ces informations directement du courtier de messages, sans aucun effet secondaire qui affecte n√©gativement les composants en interaction. <br><br><h2>  L'objectif principal de l'API Contract </h2><br>  Mais le but principal de l'API Contract est de r√©duire le co√ªt d'int√©gration des composants de la plateforme. <br><br>  Les d√©veloppeurs sont extraits du niveau de transport par les biblioth√®ques que nous avons d√©velopp√©es pour chacune de nos piles technologiques.  Cela nous donne une certaine marge de man≈ìuvre au cas o√π nous devions changer le courtier de messages ou m√™me passer √† une interaction point √† point.  L'interface externe de la biblioth√®que restera inchang√©e. <br><br>  La biblioth√®que sous le capot g√©n√®re un message selon certaines r√®gles et l'envoie au courtier, apr√®s quoi, apr√®s avoir attendu un message de r√©ponse, il renvoie le r√©sultat au d√©veloppeur.  √Ä l'ext√©rieur, cela ressemble √† une demande synchrone r√©guli√®re (ou asynchrone, d√©pendante de l'impl√©mentation).  En guise de d√©monstration, je vais donner quelques exemples. <br><br>  Exemple d'appel de contrat Python <br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> platform_client <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Client client = Client(contracts_path=CONTRACTS_PATH, url=AMQP_URL, app_id=<span class="hljs-string"><span class="hljs-string">'client'</span></span>) client.call(<span class="hljs-string"><span class="hljs-string">"ban-management.create-ban.v1"</span></span>, { <span class="hljs-string"><span class="hljs-string">"wgid"</span></span>: <span class="hljs-number"><span class="hljs-number">1234567890</span></span>, <span class="hljs-string"><span class="hljs-string">"reason"</span></span>: <span class="hljs-string"><span class="hljs-string">"Fraudulent activity"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"ru.wot"</span></span>, <span class="hljs-string"><span class="hljs-string">"component"</span></span>: <span class="hljs-string"><span class="hljs-string">"game"</span></span>, <span class="hljs-string"><span class="hljs-string">"bantype"</span></span>: <span class="hljs-string"><span class="hljs-string">"access_denied"</span></span>, <span class="hljs-string"><span class="hljs-string">"author_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"v_nikonovich"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span>: <span class="hljs-string"><span class="hljs-string">"2038-01-19 03:14:07Z"</span></span> }) { <span class="hljs-string"><span class="hljs-string">u'ban_id'</span></span>: <span class="hljs-number"><span class="hljs-number">31415926</span></span>, <span class="hljs-string"><span class="hljs-string">u'wgid'</span></span>: <span class="hljs-number"><span class="hljs-number">1234567890</span></span>, <span class="hljs-string"><span class="hljs-string">u'title'</span></span>: <span class="hljs-string"><span class="hljs-string">u'ru.wot'</span></span>, <span class="hljs-string"><span class="hljs-string">u'component'</span></span>: <span class="hljs-string"><span class="hljs-string">u'game'</span></span>, <span class="hljs-string"><span class="hljs-string">u'reason'</span></span>: <span class="hljs-string"><span class="hljs-string">u'Fraudulent activity'</span></span>, <span class="hljs-string"><span class="hljs-string">u'bantype'</span></span>: <span class="hljs-string"><span class="hljs-string">u'access_denied'</span></span>, <span class="hljs-string"><span class="hljs-string">u'status'</span></span>: <span class="hljs-string"><span class="hljs-string">u"active"</span></span>, <span class="hljs-string"><span class="hljs-string">u'started_at'</span></span>: <span class="hljs-string"><span class="hljs-string">u"2019-02-15T15:15:15Z"</span></span>, <span class="hljs-string"><span class="hljs-string">u'expires_at'</span></span>: <span class="hljs-string"><span class="hljs-string">u"2038-01-19 03:14:07Z"</span></span> }</code> </pre> <br>  Le m√™me appel de contrat, mais en utilisant Elixir <br><pre> <code class="plaintext hljs">:platform_client.call("ban-management.create-ban.v1", %{ "wgid" =&gt; 1234567890, "reason" =&gt; "Fraudulent activity", "title" =&gt; "ru.wot", "component" =&gt; "game", "bantype" =&gt; "access_denied", "author_id" =&gt; "v_nikonovich", "expires_at" =&gt; "2038-01-19 03:14:07Z" }) {:ok, %{ "ban_id" =&gt; 31415926, "wgid" =&gt; 1234567890, "title" =&gt; "ru.wot", "conponent" =&gt; "game", "reason" =&gt; "Fraudulent activity", "bantype" =&gt; "access_denied", "status" =&gt; "active", "started_at" =&gt; "2019-02-15T15:15:15Z", "expires_at" =&gt; "2038-01-19 03:14:07Z" }}</code> </pre><br>  Au lieu du contrat ¬´ban-management.create-ban.v1¬ª, il peut y avoir toute autre fonctionnalit√© de plate-forme, par exemple: ¬´account-management.rename-account.v1¬ª ou ¬´notification-center.create-sms-notification.v1¬ª.  Et tout cela sera disponible via ce point d'int√©gration unique avec la plateforme. <br><br>  L'aper√ßu sera incomplet si vous ne d√©montrez pas l'API Contract du point de vue du d√©veloppeur du serveur.  Consid√©rez une situation dans laquelle un d√©veloppeur doit impl√©menter un gestionnaire pour le m√™me contrat ban-management.create-ban.v1. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> platform_server <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BlockingServer, handler <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomServer</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BlockingServer)</span></span></span><span class="hljs-class">:</span></span> @handler(<span class="hljs-string"><span class="hljs-string">'ban-management.create-ban.v1'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_create_ban</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, params, context)</span></span></span><span class="hljs-function">:</span></span> response = do_some_usefull_job(params) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response d = CustomServer(app_id=<span class="hljs-string"><span class="hljs-string">"server"</span></span>, amqp_url=AMQP_URL, contracts_path=CONTRACTS_PATH) d.serve()</code> </pre><br>  Ce code sera suffisant pour commencer √† servir un contrat donn√©.  La biblioth√®que du serveur d√©compresse et v√©rifie l'exactitude des param√®tres de demande, puis appelle le gestionnaire de contrat avec les param√®tres de demande pr√™ts pour le traitement.  Ainsi, le d√©veloppeur du serveur est prot√©g√© par une biblioth√®que qui, en cas de r√©ception de param√®tres de requ√™te incorrects, enverra elle-m√™me une erreur de validation au client et enregistrera le fait d'un probl√®me. <br><br>  √âtant donn√© que sous le capot, l'API Contract est impl√©ment√©e sur la base d'√©v√©nements, nous avons la possibilit√© d'aller au-del√† de la port√©e du script de demande / r√©ponse et de mettre en ≈ìuvre un √©ventail plus large d'interactions interservices. <br><br>  Par exemple: <br><br><ul><li>  faire une demande et oublier (sans attendre de r√©ponse) </li><li>  faire des demandes √† plusieurs contrats simultan√©ment (m√™me sans utiliser de boucle d'√©v√©nement) </li><li>  faire une demande et recevoir des r√©ponses de plusieurs gestionnaires √† la fois (si pr√©vu par le script d'int√©gration) </li><li>  enregistrer un gestionnaire de r√©ponse (d√©clench√© si le gestionnaire de contrat a signal√© l'ach√®vement, accepte le r√©sultat du travail du gestionnaire de contrat, c'est-√†-dire sa r√©ponse) </li></ul><br>  Et ce n'est pas une liste compl√®te de sc√©narios qui peuvent √™tre exprim√©s √† travers un mod√®le d'√©v√©nement d'interaction.  Ceci est une liste de ceux que nous utilisons actuellement. <br><br><h2>  Au lieu d'une conclusion </h2><br>  Nous utilisons l'API Contract depuis plusieurs ann√©es.  Par cons√©quent, il n'est pas possible de parler de tous les sc√©narios de son utilisation dans le cadre d'un article de synth√®se.  Pour la m√™me raison, je n'ai pas surcharg√© l'article de d√©tails techniques.  Elle s'est d√©j√† av√©r√©e assez volumineuse.  Posez des questions et j'essaierai d'y r√©pondre directement dans les commentaires.  Si un sujet est particuli√®rement int√©ressant, il sera possible de le divulguer plus en d√©tail dans un article s√©par√©. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441708/">https://habr.com/ru/post/fr441708/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441698/index.html">D√©connecter: que se passe-t-il lorsque vous vous retirez de Facebook?</a></li>
<li><a href="../fr441700/index.html">Comment un puzzle pour enfants aide √† r√©v√©ler les secrets du magn√©tisme</a></li>
<li><a href="../fr441702/index.html">Sur le stockage des donn√©es personnelles, Roskomnadzor et les sites de rencontres</a></li>
<li><a href="../fr441704/index.html">Pourquoi vous ne devriez pas attendre les manifestations morales des robots</a></li>
<li><a href="../fr441706/index.html">Une douzaine de grandes entreprises tentent de cr√©er un lidar puissant et peu co√ªteux</a></li>
<li><a href="../fr441710/index.html">Les jeux mobiles par navigateur vous d√©fient</a></li>
<li><a href="../fr441712/index.html">Solution math√©matique aux probl√®mes de relativit√©</a></li>
<li><a href="../fr441714/index.html">Comment les locomotives √† vapeur ont-elles √©t√© dispos√©es?</a></li>
<li><a href="../fr441716/index.html">Programmation pour les non-programmeurs. Biographie de juin</a></li>
<li><a href="../fr441718/index.html">Security Week 09: vuln√©rabilit√© de 19 ans dans WinRAR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>