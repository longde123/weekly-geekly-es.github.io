<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>解   Escriba Safe SQL en Kotlin   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La expresividad es una propiedad interesante de los lenguajes de programaci贸n. Simplemente combinando expresiones, puede lograr resultados impresionan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Escriba Safe SQL en Kotlin</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414483/"><p>  La expresividad es una propiedad interesante de los lenguajes de programaci贸n.  Simplemente combinando expresiones, puede lograr resultados impresionantes.  Algunos idiomas rechazan deliberadamente la idea de expresividad, pero Kotlin definitivamente no es tal lenguaje. </p><br><p>  Usando construcciones de lenguaje b谩sico y un poco de az煤car, intentaremos recrear el SQL en la sintaxis de Kotlin lo m谩s cerca posible. </p><br><p><img src="https://habrastorage.org/webt/hv/pn/x5/hvpnx5fkihdhd0ge8glwzjyruy0.png" alt="vs"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace de GitHub para los impacientes</a> </p><br><p> Nuestro objetivo es ayudar al programador a detectar un subconjunto espec铆fico de errores en la etapa de compilaci贸n.  Kotlin, siendo un lenguaje fuertemente tipado, nos ayudar谩 a deshacernos de expresiones inv谩lidas en la estructura de la consulta SQL.  Como beneficio adicional, obtendremos m谩s protecci贸n contra errores tipogr谩ficos y ayuda del IDE en las solicitudes por escrito.  No es posible reparar fallas de SQL por completo, pero es bastante posible arreglar algunas 谩reas problem谩ticas. </p><br><p>  Este art铆culo le informar谩 sobre la biblioteca de Kotlin, que le permite escribir consultas SQL en la sintaxis de Kotlin.  Adem谩s, echamos un vistazo al interior de la biblioteca para comprender c贸mo funciona esto. </p><a name="habracut"></a><br><h1 id="nemnogo-teorii">  Poco de teor铆a </h1><br><p>  SQL significa lenguaje de consulta estructurado, es decir  La estructura de las consultas est谩 presente, aunque la sintaxis es deficiente: el lenguaje se cre贸 para que pueda ser utilizado por cualquier usuario que ni siquiera tenga habilidades de programaci贸n. </p><br><p>  Sin embargo, bajo SQL se encuentra una base bastante poderosa en la forma de la teor铆a de las bases de datos relacionales: todo es muy l贸gico all铆.  Para comprender la estructura de las consultas, pasamos a una selecci贸n simple: </p><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-comment"><span class="hljs-comment">--  (projection), (id, name) FROM employees --  (table) WHERE organization_id = 1 --    (predicate), (organization_id = 1)</span></span></code> </pre> <br><p>  Lo que es importante entender: la solicitud consta de tres partes consecutivas.  Cada una de estas partes, en primer lugar, depende de la anterior y, en segundo lugar, implica un conjunto limitado de expresiones para continuar con la solicitud.  De hecho, ni siquiera es as铆: la expresi贸n FROM aqu铆 es claramente primaria en relaci贸n con SELECT, porque  qu茅 conjunto de campos podemos elegir depende de la tabla desde la que se realiza la selecci贸n, pero no al rev茅s. </p><br><p><img src="https://habrastorage.org/webt/kw/8t/vz/kw8tvzj3r8dltbj9b5yt1llxiiq.png" alt="SQL"></p><br><h1 id="perenos-na-kotlin">  Portar a Kotlin </h1><br><p>  Entonces, FROM es primario con respecto a cualquier otra construcci贸n de lenguaje de consulta.  De esta expresi贸n surgen todas las opciones posibles para continuar la consulta.  En Kotlin, reflejamos esto a trav茅s de la funci贸n from (T), que tomar谩 un objeto de entrada, que es una tabla que tiene un conjunto de columnas. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Employees : <span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>("employees") { val id = <span class="hljs-keyword"><span class="hljs-keyword">Column</span></span>("id") val <span class="hljs-type"><span class="hljs-type">name</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">Column</span></span>("name") val organizationId = <span class="hljs-keyword"><span class="hljs-keyword">Column</span></span>("organization_id") }</code> </pre><br><p>  La funci贸n devolver谩 un objeto que contiene m茅todos que reflejan la posible continuaci贸n de la solicitud.  La construcci贸n from siempre viene primero, antes que cualquier otra expresi贸n, por lo que involucra una gran cantidad de extensiones, incluida la SELECT final (a diferencia de SQL, donde SELECT siempre viene antes de FROM).  El c贸digo equivalente a la consulta SQL anterior se ver谩 as铆: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span>(Employees) .<span class="hljs-keyword"><span class="hljs-keyword">where</span></span> { e -&gt; e.organizationId eq <span class="hljs-number"><span class="hljs-number">1</span></span> } .<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> { e -&gt; e.id .. e.name }</code> </pre><br><p>  Curiosamente, de esta manera podemos evitar SQL inv谩lido incluso en tiempo de compilaci贸n.  Cada expresi贸n, cada llamada al m茅todo en la cadena implica un n煤mero limitado de extensiones.  Podemos controlar la validez de la solicitud utilizando el lenguaje Kotlin.  Como ejemplo, la expresi贸n where no implica una continuaci贸n en forma de otro where y, adem谩s, de, pero las construcciones groupBy, having, orderBy, limit, offset y la selecci贸n final son todas v谩lidas. </p><br><p><img src="https://habrastorage.org/webt/zp/nc/xt/zpncxtqxopi2x8j1amy8mitq_6k.png" alt="Kuery"></p><br><p>  Lambdas pas贸 como argumentos a las declaraciones where y select est谩n dise帽adas para construir el predicado y la proyecci贸n, respectivamente (los mencionamos anteriormente).  Se pasa una tabla a la entrada lambda para que pueda acceder a las columnas.  Es importante que la seguridad de tipo se mantenga tambi茅n a este nivel: con la ayuda de la sobrecarga del operador, podemos asegurarnos de que el predicado sea una expresi贸n pseudobooleana que no se pueda compilar si hay un error de sintaxis o un error relacionado con el tipo.  Lo mismo vale para la proyecci贸n. </p><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">where</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(predicate: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; Predicate): WhereClause&lt;T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">select</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(projection: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; Iterable&lt;Projection&gt;): SelectStatement&lt;T&gt;</code> </pre><br><h1 id="join">  Unirse </h1><br><p>  Las bases de datos relacionales le permiten trabajar con muchas tablas y las relaciones entre ellas.  Ser铆a bueno darle al desarrollador la oportunidad de trabajar con JOIN en nuestra biblioteca.  Afortunadamente, el modelo relacional encaja bien con todo lo que se describi贸 anteriormente: solo necesita agregar el m茅todo de uni贸n, que agregar谩 una segunda tabla a nuestra expresi贸n. </p><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T2: Table&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">join</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(table2: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T2</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: JoinClause&lt;T, T2&gt;</code> </pre><br><p>  JOIN, en este caso, tendr谩 m茅todos similares a los proporcionados por la expresi贸n FROM, con la 煤nica diferencia de que la proyecci贸n y el predicado lambdas tomar谩n dos par谩metros cada uno para poder acceder a las columnas de ambas tablas. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span>(Employees) .<span class="hljs-keyword"><span class="hljs-keyword">join</span></span>(Organizations).<span class="hljs-keyword"><span class="hljs-keyword">on</span></span> { e, o -&gt; o.id eq e.organizationId } .<span class="hljs-keyword"><span class="hljs-keyword">where</span></span> { e, o -&gt; e.organizationId eq <span class="hljs-number"><span class="hljs-number">1</span></span> } .<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> { e, o -&gt; e.id .. e.name .. o.name }</code> </pre><br><h1 id="upravlenie-dannymi">  Gesti贸n de datos </h1><br><p>  El lenguaje de manipulaci贸n de datos es una herramienta de lenguaje SQL que, adem谩s de consultar tablas, le permite insertar, modificar y eliminar datos.  Estos dise帽os encajan bien con nuestro modelo.  Para admitir la actualizaci贸n y eliminaci贸n, solo necesitamos complementar las expresiones from y where con una variante con la llamada de los m茅todos correspondientes.  Para apoyar la inserci贸n, introducimos una funci贸n adicional. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span>(Employees) .<span class="hljs-keyword"><span class="hljs-keyword">where</span></span> { e -&gt; e.id eq <span class="hljs-number"><span class="hljs-number">1</span></span> } .<span class="hljs-keyword"><span class="hljs-keyword">update</span></span> { e -&gt; e.name("John Doe") } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>(Employees) .<span class="hljs-keyword"><span class="hljs-keyword">where</span></span> { e -&gt; e.id eq <span class="hljs-number"><span class="hljs-number">0</span></span> } .<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">into</span></span>(Employees) .<span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> { e -&gt; e.name("John Doe") .. e.organizationId(<span class="hljs-number"><span class="hljs-number">1</span></span>) }</code> </pre><br><h1 id="opisanie-dannyh">  Descripci贸n de datos </h1><br><p>  SQL funciona con datos estructurados en forma de tablas.  Las tablas requieren una descripci贸n antes de trabajar con ellas.  Esta parte del lenguaje se llama lenguaje de definici贸n de datos. </p><br><p>  Las instrucciones CREATE TABLE y DROP TABLE se implementan de manera similar: la funci贸n over servir谩 como punto de partida. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">over</span></span>(Employees) .<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> { <span class="hljs-type"><span class="hljs-type">integer</span></span>(it.id).primaryKey(autoIncrement = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>).. text(it.name).<span class="hljs-keyword"><span class="hljs-keyword">unique</span></span>().<span class="hljs-keyword"><span class="hljs-keyword">notNull</span></span>().. <span class="hljs-type"><span class="hljs-type">integer</span></span>(it.organizationId).foreignKey(<span class="hljs-keyword"><span class="hljs-keyword">references</span></span> = Organizations.id) }</code> </pre><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">over</span></span>(Employees).<span class="hljs-keyword"><span class="hljs-keyword">drop</span></span>()</code> </pre><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C贸digo y documentaci贸n</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414483/">https://habr.com/ru/post/es414483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414473/index.html">Ninja DVR: Neoline G-Tech X27 Dual review</a></li>
<li><a href="../es414475/index.html">"Usuarios finales: estamos con usted": sobre el desarrollo de Android en CFT</a></li>
<li><a href="../es414477/index.html">Las dificultades de elegir una pantalla LED para una sala de reuniones o una sala de conferencias en lugar de un proyector</a></li>
<li><a href="../es414479/index.html">D-pantenol: una droga para el bien</a></li>
<li><a href="../es414481/index.html">Prueba PHP del viernes: algunas aventuras del programador Brad, una secuencia extra帽a y premios</a></li>
<li><a href="../es414485/index.html">GNMT, falla 茅pica o sutilezas de la traducci贸n autom谩tica</a></li>
<li><a href="../es414487/index.html">Un representante raro del tipo de fuerza bruta: la historia de un ataque</a></li>
<li><a href="../es414489/index.html">Estados Unidos planea abordar seriamente el tema de los desechos espaciales</a></li>
<li><a href="../es414493/index.html">C贸mo escribir un contrato inteligente para ICO en 5 minutos</a></li>
<li><a href="../es414495/index.html">toString: genial y terrible</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>