<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÉ üëµ üåù √âcriture d'un autre outil de cr√©ation de mod√®les Kubernetes üë¶üèΩ üèä üç≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si vous travaillez avec l'environnement Kubernetes, vous utilisez probablement plusieurs outils de mod√®les existants, certains d'entre eux faisant par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√âcriture d'un autre outil de cr√©ation de mod√®les Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437682/"><p><img src="https://habrastorage.org/webt/hj/xp/t7/hjxpt7lglfmyiz9ut7xcy2ndpl4.png"></p><br><p>  Si vous travaillez avec l'environnement Kubernetes, vous utilisez probablement plusieurs outils de mod√®les existants, certains d'entre eux faisant partie de gestionnaires de packages tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Helm</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ksonnet</a> , ou tout simplement des langages de mod√®les (Jinja2, mod√®le Go, etc.).  Tous ont leurs propres inconv√©nients ainsi que leurs avantages et nous allons les passer en revue et √©crire notre propre outil qui tentera de combiner les meilleures fonctionnalit√©s. </p><a name="habracut"></a><br><h2 id="so-why-not-helm">  Alors, pourquoi pas Helm? </h2><br><p> Il y a un certain nombre d'articles critiquant Helm (par exemple un seul d'entre eux: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©fl√©chissez bien avant d'utiliser Helm</a> ).  Le probl√®me principal avec Helm est qu'il fonctionne avec <em>les repr√©sentations de cha√Ænes</em> et les manifestes Kubernetes sont des <em>objets (json)</em> .  Le v√©ritable enfer pour un d√©veloppeur de graphiques Helm commence quand il a besoin de calculer les retraits pour un manifeste <code>yaml</code> , parfois cela ressemble √† ceci (c'est un exemple r√©el de mon graphique): </p><br><pre> <code class="plaintext hljs">spec: jobTemplate: spec: template: spec: containers: - name: my-awesome-container resources: {{ toYaml .Values.resources | indent 14 }}</code> </pre> <br><p><img src="https://habrastorage.org/webt/oh/iw/cz/ohiwczwzpduep0hfxrghx0xtook.jpeg"></p><br><p>  Mais Helm est aujourd'hui de facto la norme pour le conditionnement des applications Kubernetes.  Le principal avantage de Helm est une grande communaut√© et un grand nombre de r√©f√©rentiels publics avec des graphiques.  Et r√©cemment, les d√©veloppeurs de Helm ont annonc√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hub Helm</a> .  Aujourd'hui, Helm est comme Docker - ce n'est pas le seul mais il a une communaut√© et un support. </p><br><p>  Il y a des changements prometteurs avec la sortie de Helm 3 mais personne ne sait quand cela pourrait √™tre. </p><br><p>  Pour conclure, les avantages de Helm: </p><br><ul><li>  Grande communaut√© et un certain nombre de cartes publiques </li><li>  (Relativement) syntaxe conviviale.  Au moins c'est le mod√®le yaml + go;) </li></ul><br><p>  Inconv√©nients: </p><br><ul><li>  Travailler avec des cha√Ænes et non des objets </li><li>  Nombre limit√© d'op√©rateurs et de fonctions que vous pouvez utiliser </li></ul><br><h2 id="ok-then-maybe-ksonnet">  OK, alors peut-√™tre Ksonnet? </h2><br><p>  Si vous comparez Helm √† Ksonnet, ce dernier a un √©norme avantage, √† savoir qu'il fonctionne avec des objets.  Ksonnet est un outil bas√© sur le langage de mod√©lisation JSON Jsonnet.  Une autre fonctionnalit√© int√©ressante de Ksonnet est qu'il poss√®de des biblioth√®ques Jsonnet compatibles Kubernetes-API que vous pouvez importer dans votre mod√®le et travailler avec des objets Kubernetes comme dans n'importe quel langage OOP: </p><br><pre> <code class="json hljs">local k = import <span class="hljs-string"><span class="hljs-string">"k.libsonnet"</span></span>; local deployment = k.apps.v<span class="hljs-number"><span class="hljs-number">1</span></span>beta<span class="hljs-number"><span class="hljs-number">1</span></span>.deployment; local appDeployment = deployment .new( params.name, params.replicas, container .new(params.name, params.image) .withPorts(containerPort.new(targetPort)), labels);</code> </pre> <br><p>  Semble impressionnant, non? <br>  C'est un peu moins soign√© lorsque vous travaillez non pas avec des objets API mais avec seulement des objets json import√©s du fichier <code>yaml</code> / <code>json</code> : </p><br><pre> <code class="json hljs">{ global: {}, components: { <span class="hljs-attr"><span class="hljs-attr">"deployment-nginx-deployment-dkecx"</span></span>+: { spec+: { replicas: <span class="hljs-number"><span class="hljs-number">10</span></span>, template+: { spec+: { containers+: [ { name: <span class="hljs-string"><span class="hljs-string">"nginx"</span></span>, image: <span class="hljs-string"><span class="hljs-string">"nginx:latest"</span></span>, ports: [ { containerPort: <span class="hljs-number"><span class="hljs-number">80</span></span>, }, ], }, ], }, }, }, }, }, }</code> </pre> <br><p>  Mais c'est quand m√™me quelque chose et c'est mieux que de travailler avec des cordes dans Helm.  L'inconv√©nient de Ksonnet est qu'il a une communaut√© plus petite et moins de packages que Helm (bien que vous puissiez importer des graphiques Helm dans votre projet Ksonnet, mais vous travaillerez avec eux en tant qu'objets json, pas en tant qu'objets jsonnet-library).  Et en raison d'une communaut√© et d'une contribution plus petites, il y a un manque de fonctionnalit√©s lorsque vous essayez d'√©crire votre propre graphique.  J'ai exp√©riment√© l'un d'eux: vous savez que dans Helm, vous pouvez cr√©er un <code>ConfigMap</code> partir d'un r√©pertoire contenant un certain nombre de fichiers de configuration de cette fa√ßon: </p><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: ConfigMap metadata: name: conf data: {{- (.Files.Glob "foo/*").AsConfig | nindent 2 }}</code> </pre> <br><p>  Vous pouvez imaginer ma frustration quand j'ai d√©couvert qu'il n'y a pas une telle fonctionnalit√© dans Ksonnet.  Il existe cependant des solutions de contournement.  Mais le fait est que ce n'est qu'un exemple de la situation o√π vous √©crivez avec bonheur votre graphique, puis soudain, le manque de fonctionnalit√©s vous arr√™te √† mi-chemin. <br>  Au total, les avantages de Ksonnet: </p><br><ul><li>  Travailler avec des objets </li><li>  Biblioth√®ques Jsonnet compatibles Kubernetes-API </li><li>  Prise en charge de l'importation des graphiques de barre </li></ul><br><p>  Inconv√©nients: </p><br><ul><li>  Une communaut√© plus petite et un plus petit nombre de packages natifs de Ksonnet </li><li>  Manque de certaines fonctionnalit√©s que vous pouvez utiliser dans Helm </li><li>  Nouvelle syntaxe =&gt; augmentation du temps d'apprentissage =&gt; augmentation du facteur de bus </li><li>  La syntaxe peut parfois devenir laide et moins lisible par l'homme (en particulier lors de solutions de contournement pour des fonctionnalit√©s manquantes) </li></ul><br><h2 id="lets-think-of-an-ideal-templating-tool">  Pensons √† un outil de mod√©lisation id√©al </h2><br><p>  Voici quelques crit√®res pour l'outil de mod√©lisation "id√©al": </p><br><ul><li>  Cela devrait fonctionner avec des objets, pas des cha√Ænes </li><li>  Il devrait avoir la capacit√© de travailler avec des objets compatibles avec Kubernetes-API </li><li>  Il devrait avoir un ensemble d√©cent de fonctions pour travailler avec des cha√Ænes </li><li>  Cela devrait bien fonctionner avec les formats json et yaml </li><li>  Il doit √™tre respectueux de l'homme </li><li>  √áa devrait √™tre simple </li><li>  Il devrait avoir la possibilit√© d'importer des graphiques Helm existants (car c'est la r√©alit√© et nous voulons utiliser la communaut√© Helm) </li></ul><br><p>  √áa suffit pour l'instant.  J'ai parcouru cette liste dans ma t√™te et je me suis dit: ok, pourquoi ne pas essayer Python?  Voyons si cela correspond √† nos crit√®res: </p><br><ul><li>  <em>Travaillez avec des objets, pas des cha√Ænes</em> .  Oui, nous pouvons utiliser les types <code>dict</code> et <code>list</code> pour cela. </li><li>  <em>Avoir la capacit√© de travailler avec des objets compatibles avec Kubernetes-API</em> .  Oui, <code>from kubernetes import client</code> </li><li>  <em>Avoir un ensemble d√©cent de fonctions pour travailler avec des cha√Ænes</em> .  Beaucoup! </li><li>  <em>Fonctionne bien avec les formats json et yaml</em> .  Tr√®s bien. </li><li>  <em>Respectueux de l'homme</em>  Pas de merde. </li><li>  <em>Simple</em>  Oui </li><li>  <em>Possibilit√© d'importer des cartes Helm existantes</em> .  Cela, nous allons nous ajouter. </li></ul><br><p>  Ok, √ßa a l'air prometteur.  J'ai d√©cid√© d'√©crire un outil de mod√©lisation simple au-dessus de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que cliente officielle de Python pour kubernetes</a> et maintenant je vais vous montrer ce qui en est sorti. </p><br><h2 id="meet-karavel">  Rencontrez Karavel </h2><br><p>  Il n'y a rien de sp√©cial ou de compliqu√© dans cet outil.  Je viens de prendre la biblioth√®que Kubernetes (qui m'a donn√© la possibilit√© de travailler avec des objets Kubernetes) et d'√©crire quelques fonctionnalit√©s de base pour les graphiques Helm existants (afin que l'on puisse les r√©cup√©rer et les ajouter dans leur propre graphique).  Alors, faisons un tour. <br>  Tout d'abord, cet outil est accessible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Github repo</a> et vous pouvez y trouver un r√©pertoire avec des exemples. </p><br><h2 id="quick-start-with-docker-image">  D√©marrage rapide avec l'image Docker </h2><br><p>  Si vous voulez l'essayer, la fa√ßon la plus simple est d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette image docker</a> : </p><br><pre> <code class="plaintext hljs">$ docker run greegorey/karavel -h usage: karavelcli.py [-h] subcommand ... optional arguments: -h, --help show this help message and exit list of subcommands: subcommand template generates manifests from template ensure ensure helm dependencies</code> </pre> <br><p>  Bien s√ªr, si vous souhaitez cr√©er des mod√®les de graphiques, vous devez monter le r√©pertoire de votre graphique: </p><br><pre> <code class="plaintext hljs">$ cd example $ docker run -v $PWD:/chart greegorey/karavel template .</code> </pre> <br><p>  Voyons donc la structure du graphique.  Il est tr√®s similaire √† celui de Helm: </p><br><pre> <code class="plaintext hljs">$ cd example $ tree . . ‚îú‚îÄ‚îÄ dependencies ‚îú‚îÄ‚îÄ prod.yaml ‚îú‚îÄ‚îÄ requirements.yaml ‚îú‚îÄ‚îÄ templates ‚îÇ  ‚îú‚îÄ‚îÄ custom-resource.py ‚îÇ  ‚îú‚îÄ‚îÄ deployment.py ‚îÇ  ‚îî‚îÄ‚îÄ service-helm.py ‚îî‚îÄ‚îÄ values.yaml 2 directories, 6 files</code> </pre> <br><p>  Comme Helm, il a un fichier <code>requirements.yaml</code> avec la m√™me disposition: </p><br><pre> <code class="plaintext hljs">dependencies: - name: mysql version: 0.13.1 repository: https://kubernetes-charts.storage.googleapis.com/</code> </pre> <br><p>  Ici, vous listez simplement vos d√©pendances Helm que vous souhaitez importer dans votre graphique.  Les d√©pendances vont dans le r√©pertoire des <code>dependencies</code> .  Pour les r√©cup√©rer ou les mettre √† jour, utilisez la commande sure: </p><br><pre> <code class="plaintext hljs">$ karavel ensure .</code> </pre> <br><p>  Apr√®s cela, votre r√©pertoire de <code>dependencies</code> ressemblera √† ceci: </p><br><pre> <code class="plaintext hljs">$ tree dependencies dependencies ‚îî‚îÄ‚îÄ mysql-0.13.1 ‚îî‚îÄ‚îÄ mysql ‚îú‚îÄ‚îÄ Chart.yaml ‚îú‚îÄ‚îÄ README.md ‚îú‚îÄ‚îÄ templates ‚îÇ  ‚îú‚îÄ‚îÄ NOTES.txt ‚îÇ  ‚îú‚îÄ‚îÄ _helpers.tpl ‚îÇ  ‚îú‚îÄ‚îÄ configurationFiles-configmap.yaml ‚îÇ  ‚îú‚îÄ‚îÄ deployment.yaml ‚îÇ  ‚îú‚îÄ‚îÄ initializationFiles-configmap.yaml ‚îÇ  ‚îú‚îÄ‚îÄ pvc.yaml ‚îÇ  ‚îú‚îÄ‚îÄ secrets.yaml ‚îÇ  ‚îú‚îÄ‚îÄ svc.yaml ‚îÇ  ‚îî‚îÄ‚îÄ tests ‚îÇ  ‚îú‚îÄ‚îÄ test-configmap.yaml ‚îÇ  ‚îî‚îÄ‚îÄ test.yaml ‚îî‚îÄ‚îÄ values.yaml 4 directories, 13 files</code> </pre> <br><p>  Maintenant, apr√®s avoir assur√© nos d√©pendances, regardons les mod√®les.  Tout d'abord, nous cr√©ons un d√©ploiement nginx simple: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kubernetes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> client <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> karavel.helpers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Values <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> values = Values().values <span class="hljs-comment"><span class="hljs-comment"># Configure Pod template container container = client.V1Container( name='nginx', image='{}:{}'.format(values.nginx.image.repository, values.nginx.image.tag), ports=[client.V1ContainerPort(container_port=80)]) # Create and configurate a spec section template = client.V1PodTemplateSpec( metadata=client.V1ObjectMeta(labels={'app': 'nginx'}), spec=client.V1PodSpec(containers=[container])) # Create the specification of deployment spec = client.ExtensionsV1beta1DeploymentSpec( replicas=3, template=template) # Instantiate the deployment object deployment = client.ExtensionsV1beta1Deployment( api_version='extensions/v1beta1', kind='Deployment', metadata=client.V1ObjectMeta(name='nginx-deployment'), spec=spec) return deployment # [deployment], (deployment, deployment) are valid</span></span></code> </pre> <br><p>  Ainsi, pour que le mod√®le soit valide, vous devez avoir la fonction <code>template()</code> qui renvoie soit un seul objet Kubernetes, soit une <code>list</code> / <code>tuple</code> d'entre eux.  Vous pouvez trouver la liste des objets API pour le client Python <a href="">ici</a> . <br>  Comme vous pouvez le voir, le code est propre, simple, lisible.  Vous pouvez vous demander d'o√π vient <code>values.nginx.image.repository</code> ?  Il obtient des valeurs √† partir des fichiers de valeurs que vous transmettez lorsque vous mod√©lisez le graphique, comme dans Helm: <code>karavel template -f one.yaml --values two.yaml</code> .  Nous les examinerons plus tard. </p><br><h2 id="okay-what-about-helm-charts">  D'accord, qu'en est-il des graphiques Helm? </h2><br><p>  Maintenant, nous avons cr√©√© notre propre d√©ploiement.  Mais que faire si nous voulons importer un graphique Helm ou une partie d'un graphique?  Jetons un coup d'≈ìil √† <code>templates/service-helm.py</code> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kubernetes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> client <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> karavel.helm <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HelmChart <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> karavel.helpers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Values <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> values = Values().values <span class="hljs-comment"><span class="hljs-comment"># Initialize the chart (== helm template --values) chart = HelmChart(name='mysql', version='0.13.1', values=values.mysql.helm) # Get the desired object from chart service = chart.get(name='svc', obj_class=client.V1Service) # Create custom objects to add custom_ports = [ client.V1ServicePort( name='my-custom-port', protocol=values.mysql.protocol, port=values.mysql.port, target_port=39000, ) ] # Add custom objects to the service service.spec['ports'] = custom_ports # Change Helm-generated label service.metadata['labels']['release'] += '-suffix' # Delete Helm-generated label `heritage: Tiller` del service.metadata['labels']['heritage'] return service # [service], (service, service) are valid</span></span></code> </pre> <br><p>  C'est simple, hein?  Notez cette ligne: <code>service = chart.get(name='svc', obj_class=client.V1Service)</code> - nous avons cr√©√© un objet de classe <code>V1Service</code> form Helm <code>yaml</code> file.  Si vous ne voulez pas / n'avez pas besoin de le faire - vous pouvez toujours travailler avec simplement <code>dict</code> . </p><br><h2 id="what-if-i-want-to-create-custom-resource">  Et si je veux cr√©er une ressource personnalis√©e? </h2><br><p>  Eh bien, il y a un petit probl√®me avec √ßa.  L'API Kubernetes n'ajoute pas d'objets CRD dans la d√©finition json de swagger dans <code>/openapi/v2</code> , et les objets client Python s'appuient sur cette d√©finition.  Mais vous pouvez toujours travailler facilement avec des objets <code>dict</code> .  Comme √ßa: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kubernetes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> client <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> resource = { <span class="hljs-string"><span class="hljs-string">'apiVersion'</span></span>: <span class="hljs-string"><span class="hljs-string">'stable.example.com/v1'</span></span>, <span class="hljs-string"><span class="hljs-string">'kind'</span></span>: <span class="hljs-string"><span class="hljs-string">'Whale'</span></span>, <span class="hljs-string"><span class="hljs-string">'metadata'</span></span>: client.V1ObjectMeta( name=<span class="hljs-string"><span class="hljs-string">'my-object'</span></span>, ), <span class="hljs-string"><span class="hljs-string">'spec'</span></span>: { <span class="hljs-string"><span class="hljs-string">'image'</span></span>: <span class="hljs-string"><span class="hljs-string">'my-whale-image:0.0.1'</span></span>, <span class="hljs-string"><span class="hljs-string">'tail'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'fins'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resource <span class="hljs-comment"><span class="hljs-comment"># [resource], (resource, resource) are valid</span></span></code> </pre> <br><p>  √áa a toujours l'air bien, non? </p><br><h2 id="can-i-have-values-for-different-environments-eg-devprod">  Puis-je avoir des valeurs pour diff√©rents environnements, par exemple dev / prod? </h2><br><p>  Oui, c'est possible! <br>  Regardons d'abord <code>values.yaml</code> : </p><br><pre> <code class="plaintext hljs">nginx: image: repository: nginx tag: 1.15-alpine mysql: port: 3307 protocol: TCP helm: releaseName: my-release namespace: prod imageTag: '5.7.14' service: type: NodePort</code> </pre> <br><p>  Notez la cl√© de <code>helm</code> int√©rieur de <code>mysql</code> dict: nous l'avons utilis√©e lors de la sp√©cification de valeurs pour helm chart <code>chart = HelmChart(name='mysql', version='0.13.1', values=values.mysql.helm)</code> .  Certains graphiques Helm n√©cessitent <code>releaseName</code> pour la d√©nomination des applications et l' <code>namespace</code> de <code>namespace</code> pour les strat√©gies RBAC.  Ces deux valeurs sont transmises √† Helm sous <code>--namespace</code> arguments <code>--namespace</code> et <code>NAME</code> dans le <code>helm template</code> . </p><br><p>  Maintenant, vous pouvez sp√©cifier un fichier suppl√©mentaire pour prod env, et mod√®le tous nos exemples: </p><br><pre> <code class="plaintext hljs">$ karavel template -f values.yaml -f prod.yaml . --- # Source: templates/custom-resource.py apiVersion: stable.example.com/v1 kind: Whale metadata: name: my-object spec: fins: 4 image: my-whale-image:0.0.1 tail: 1 --- # Source: templates/deployment.py apiVersion: extensions/v1beta1 kind: Deployment metadata: name: nginx-deployment spec: replicas: 3 template: metadata: labels: app: nginx spec: containers: - image: nginx:1.14-alpine name: nginx ports: - containerPort: 80 --- # Source: templates/service-helm.py apiVersion: v1 kind: Service metadata: annotations: null labels: app: prod-release-mysql chart: mysql-0.13.1 release: prod-release-suffix name: prod-release-mysql spec: ports: - name: my-custom-port port: 3308 protocol: TCP targetPort: 39000 selector: app: prod-release-mysql type: NodePort</code> </pre><br><p>  Apr√®s cela, vous pouvez <code>kubeclt apply</code> et d√©ployer ces objets dans le cluster. </p><br><h3 id="cool-what-about-encoding-and-base64">  Cool!  Qu'en est-il du codage et de la base64? </h3><br><p> <code>import base64</code> </p> <br><h3 id="what-about-using-vault-for-secrets">  Qu'en est-il de l'utilisation de Vault pour les secrets? </h3><br><p> <code>import hvac</code> </p> <br><h3 id="fetching-urls">  R√©cup√©rer des URL? </h3><br><p> <code>import importlib</code> </p> <br><h3 id="secure-hash-functions">  Fonctions de hachage s√©curis√©es? </h3><br><p> <code>import Crypto</code> </p> <br><p>  Tu l'as.  Avec Python, vous pouvez faire beaucoup de choses avec vos manifestes Kubernetes. </p><br><h2 id="is-it-nih-syndrome">  Est-ce le syndrome NIH? </h2><br><p>  Non :) <br>  Je suis <del>  heureux </del>  utiliser Helm dans mes projets en cours.  Il y a des choses qui me manquent cependant.  J'ai √©galement utilis√© Ksonnet dans certains de mes projets. <br>  J'aimerais consid√©rer cet outil comme une preuve de concept que nous pouvons avoir des outils de mod√©lisation mieux que Helm et il n'est pas tr√®s difficile de les d√©velopper en utilisant Python.  S'il y a un int√©r√™t / besoin de la communaut√© pour un tel outil, nous pouvons ensemble continuer √† le d√©velopper.  Ou nous pouvons attendre la sortie de Helm 3;) </p><br><h2 id="conclusion">  Conclusion </h2><br><p>  Je vous ai montr√© un outil de mod√©lisation bas√© sur Python pour Kubernetes qui prend en charge les objets compatibles avec Kubernetes-API et prend en charge l'importation de graphiques Helm.  Tous les commentaires et discussions de la communaut√© sont les bienvenus, et encore une fois bienvenus au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©p√¥t</a> . </p><br><p>  Merci d'avoir lu ceci et bonne journ√©e! </p><br><h3 id="references">  Les r√©f√©rences </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Biblioth√®que cliente officielle de Python pour Kubernetes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Heaume</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ksonnet</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cet article sur Medium</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437682/">https://habr.com/ru/post/fr437682/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437670/index.html">Mises √† jour du backend MSVC dans Visual Studio 2019 Preview 2: nouvelles optimisations, am√©liorations OpenMP et Build Throughput</a></li>
<li><a href="../fr437672/index.html">cyberd: Calculer les connaissances du web3</a></li>
<li><a href="../fr437674/index.html">M√©thodes de reconnaissance d'objets 3D pour les v√©hicules sans pilote. Rapport Yandex</a></li>
<li><a href="../fr437676/index.html">Les universit√©s et les acc√©l√©rateurs d'entreprise comme levier pour lancer une start-up B2B aux √âtats-Unis</a></li>
<li><a href="../fr437680/index.html">Ma collection de bricolage sur Youtube</a></li>
<li><a href="../fr437684/index.html">Algorithme supr√™me - Compendium biais√©</a></li>
<li><a href="../fr437686/index.html">Learning Go: √©crire un messager p2p avec un cryptage de bout en bout</a></li>
<li><a href="../fr437688/index.html">OpenSceneGraph: Techniques de programmation de base</a></li>
<li><a href="../fr437694/index.html">Analyse de l'utilitaire Files.walkFileTree ();</a></li>
<li><a href="../fr437696/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 283 (du 21 au 27 janvier)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>