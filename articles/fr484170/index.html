<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÜüèª ü§• üïù Mettre √† jour Check Point de R77.30 √† 80.20 üóûÔ∏è üë®üèº‚Äçüéì üç∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä l'automne 2019, Check Point a cess√© de prendre en charge les versions R77.XX et devait √™tre mis √† jour. On a d√©j√† beaucoup parl√© de la diff√©rence en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mettre √† jour Check Point de R77.30 √† 80.20</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/484170/"><img src="https://habrastorage.org/webt/iz/bu/-j/izbu-j4fcyoxpsga-spzdz-rujc.png"><br><br>  √Ä l'automne 2019, Check Point a cess√© de prendre en charge les versions R77.XX et devait √™tre mis √† jour.  On a d√©j√† beaucoup parl√© de la diff√©rence entre les versions, les avantages et les inconv√©nients du passage au R80.  Voyons comment mettre √† niveau le point de contr√¥le de l'appliance virtuelle (CloudGuard pour VMware ESXi, Hyper-V, KVM Gateway NGTP) et ce qui pourrait mal se passer. <br><br>  Nous avons donc eu 2 ing√©nieurs CCSE, plus d'une douzaine de clusters virtuels Check Point R77.30, plusieurs nuages, quelques petits correctifs et toute une s√©rie de bugs, de bugs et tout √ßa, toutes les couleurs et tailles, et aussi des d√©lais tr√®s serr√©s.  C'est parti! <br><blockquote>  <b>Contenu:</b> <br><br>  <a href="https://habr.com/ru/company/dataline/blog/484170/">La pr√©paration</a> <br>  <a href="https://habr.com/ru/company/dataline/blog/484170/">Mise √† jour du serveur de gestion</a> <br>  <a href="https://habr.com/ru/company/dataline/blog/484170/">Mise √† jour du cluster</a> <br></blockquote><br><img src="https://habrastorage.org/webt/ng/ow/ye/ngowyegpn17chzucgvdx_afc2ag.png"><br><br>  <i>Voici √† quoi ressemble une infrastructure cloud client typique avec Check Point virtuel</i> <br><a name="habracut"></a><br><a name="ONE"></a><h2>  La pr√©paration </h2><br>  Tout d'abord, vous devez v√©rifier la suffisance des ressources pour la mise √† jour.  Les exigences minimales recommand√©es pour R80.20 ressemblent maintenant √† ceci: <br><br><div class="scrollable-table"><table><tbody><tr><td>  P√©riph√©rique <br></td><td>  CPU <br></td><td>  RAM <br></td><td>  Disque dur <br></td></tr><tr><td>  Passerelle de s√©curit√© <br></td><td>  2 noyaux <br></td><td>  4 Go <br></td><td>  √Ä partir de 15 Go <br></td></tr><tr><td>  SMS <br></td><td>  2 noyaux <br></td><td>  6 Go <br></td><td>  - </td></tr></tbody></table></div><br>  <i>Les recommandations sont d√©crites dans <a href="https://sc1.checkpoint.com/documents/R80.20_GA/WebAdminGuides/EN/CP_R80.20_RN/html_frameset.htm">CP_R80.20_GA_Release_Notes</a> .</i> <br><br>  Mais nous serons r√©alistes.  Si cela suffit dans la configuration la plus minimale, alors, comme le montre la pratique, nous avons g√©n√©ralement l'inspection https activ√©e, SmartEvent fonctionne pour SMS, etc., ce qui, bien s√ªr, n√©cessite des capacit√©s compl√®tement diff√©rentes.  Mais globalement pas plus grand que pour le R77.30. <br><br>  Mais il y a des nuances.  Et elles concernent tout d'abord les tailles de m√©moire physique.  De nombreuses op√©rations directement pendant le processus de mise √† niveau n√©cessiteront de l'espace sur le disque dur. <br><br>  Pour un serveur de gestion, la quantit√© d'espace disque disponible d√©pendra beaucoup du volume des journaux actuels (si nous voulons les enregistrer) et du nombre de r√©visions de base de donn√©es enregistr√©es, bien que nous n'en ayons pas besoin en grande quantit√©.  Bien s√ªr, pour les n≈ìuds de cluster (sauf si vous stockez √©galement les journaux localement), tout cela n'a pas d'importance.  Voici comment v√©rifier si vous avez le bon espace: <br><br><ol><li>  Nous nous connectons au Smart Management Server via ssh, passons en mode expert et entrons la commande: <br><br>  <b>[Expert @ cp-sms: 0] # df -h</b> </li><li>  √Ä la sortie, nous verrons quelque chose comme cette configuration: <br><br>  <b>Taille du syst√®me de fichiers utilis√©e Utilisation disponible% mont√©</b> <b><br></b>  <b>/ dev / mapper / vg_splat-lv_current 30G 7.4G 21G 27% /</b> <b><br></b>  <b>/ dev / sda1 289M 24M 251M 9% / boot</b> <b><br></b>  <b>tmpfs 2.0G 0 2.0G 0% / dev / shm</b> <b><br></b>  <b>/ dev / mapper / vg_splat-lv_log 243G 177G 53G 78% / var / log</b> </li><li>  Nous sommes actuellement int√©ress√©s par la section <b>/ var / log</b> </li></ol><br>  Veuillez noter qu'en fonction de la politique de stockage et de suppression des anciens fichiers journaux, ainsi que de la taille de la base de donn√©es export√©e, davantage d'espace peut √™tre requis.  Si lors de la cr√©ation de l'archive, l'espace libre devient inf√©rieur √† celui indiqu√© dans la politique de stockage des fichiers journaux, le syst√®me commencera √† effacer les anciens journaux et ne les inclura PAS dans l'archive. <br><br>  De plus, pour le processus de mise √† jour lui-m√™me, le syst√®me aura besoin d'au moins 13 Go d'espace non allou√© sur le disque dur.  Vous pouvez v√©rifier sa pr√©sence avec la commande: <br><br>  <b>[Expert @ cp-sms: 0] # pvs</b> <br><br>  Nous verrons approximativement la conclusion suivante: <br><br>  <b>PV VG Fmt Attr PSize PFree</b> <b><br></b>  <b>/ dev / sda3 vg_splat lvm2 a- 141.69G 43.69G</b> <br><br>  Dans ce cas, nous avons 43 Go.  Il y a suffisamment de ressources.  Vous pouvez commencer la mise √† jour. <br><br><a name="TWO"></a><h2>  Mise √† jour de Check Point SMS Management Server </h2><br>  Avant de commencer le travail, proc√©dez comme suit: <br><br><ol><li>  Installez le package des outils de migration sur le serveur de gestion.  Pour ce faire, vous devez t√©l√©charger l'image √† partir du portail <a href="https://supportcenter.checkpoint.com/supportcenter/portal/role/supportcenterUser/page/default.psml/media-type/html%3Faction%3Dportlets.DCFileAction%255E_%255Eamp%255E_%255EeventSubmit_doGetdcdetails%3D%255E_%255Eamp%255E_%255Efileid%3D72085">Check Point</a> . </li><li>  T√©l√©chargez l'archive sur le serveur de gestion via WinSCP dans le dossier <b>/var/log/UpgradeR77.30_R80.20</b> (si n√©cessaire, cr√©ez d'abord un dossier). </li><li>  Nous nous connectons au serveur de gestion via SSH et allons dans le dossier d'archives: <b>cd /var/log/UpgradeR77.30_R80.20/</b> </li><li>  D√©compressez le fichier: <b>tar -zxvf ./ &lt;nom de fichier&gt; .tgz</b> </li><li>  Nous d√©marrons l'utilitaire pre_upgrade_verifier avec la commande: <b>./pre_upgrade_verifier -p $ FWDIR -c R77 -t R80.20</b> </li><li>  Une fois la commande termin√©e, un rapport sur les param√®tres incompatibles sera g√©n√©r√©.  Il est disponible sur <b>/opt/CPsuite-R77/fw1/log/pre_upgrade_verification_report.(xls, html, txt).</b>  Il est plus pratique de le d√©charger via SCP et de le regarder via le navigateur. <br>  Pour √©liminer tous les param√®tres incompatibles, utilisez <a href="https://supportcenter.checkpoint.com/supportcenter/portal%3FeventSubmit_doGoviewsolutiondetails%3D%255E_%255Eamp%255E_%255Esolutionid%3Dsk117237">SK117237</a> . </li><li>  R√©ex√©cutez ensuite l'utilitaire pre_upgrade_verifier pour v√©rifier que toutes les causes d'incompatibilit√© ont √©t√© r√©solues. </li><li>  Ensuite, nous collectons des informations sur les interfaces r√©seau, la table de routage et t√©l√©chargeons la configuration GAIA: <br>  <b>ip a&gt; /var/log/UpgradeR77.30_R80.20/cp-sms-config.txt</b> <b><br></b>  <b>ip r&gt; /var/log/UpgradeR77.30_R80.20/cp-sms-config.txt</b> <b><br></b>  <b>clish -c "afficher la configuration"&gt; /var/log/UpgradeR77.30_R80.20/cp-sms-config.txt</b> </li><li>  T√©l√©chargez le fichier re√ßu via SCP. </li><li>  Nous faisons des instantan√©s au niveau de la virtualisation. </li><li>  Nous augmentons le d√©lai d'expiration de la session SSH √† 8 heures.  Voici la chance: selon la taille de la base export√©e, elle peut durer de quelques minutes √† plusieurs heures.  Pour ce faire: <br>  <b>[Expert @ HostName] # clish -c "afficher l'inactivit√©-timeout"</b> regardez le time-out actuel clish, <br><br>  <b>[Expert @ HostName] # clish -c "set inactivity-timeout 720"</b> sp√©cifiez un nouveau timeout clish (en minutes), <br><br>  <b>[Expert @ HostName] # echo $ TMOUT</b> regardez le mode expert de timeout actuel, <br><br>  <b>[Expert @ HostName] # export TMOUT = 3600</b> sp√©cifiez un nouveau mode expert de d√©lai d'attente (en secondes), si vous d√©finissez la valeur sur 0, le d√©lai d'attente sera d√©sactiv√©. </li><li>  Nous chargeons et montons l'image d'installation SMS.iso sur la machine virtuelle. <br><br>  Avant l'√©tape suivante, assurez-vous de v√©rifier √† nouveau que vous disposez de suffisamment d'espace non allou√© sur votre disque dur (je vous rappelle que vous avez besoin de 13 Go). <br></li><li>  Avant de commencer l'exportation de la configuration, nous modifions le fichier journal avec la commande: <b>fw logswitch</b> </li></ol><br>  <b>Exporter la configuration et les journaux</b> <br><br><ol><li>  Ex√©cutez l'utilitaire migrate_export pour d√©charger la configuration.  Pour ce faire, acc√©dez au dossier cr√©√© pr√©c√©demment: <b>cd /var/log/UpgradeR77.30_R80.20/</b> et utilisez la commande: <b>./migrate export -l /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> <br><br>  soit <br><br>  allez dans le dossier: <b>cd $ FWDIR / bin / upgrade_tools /</b> et <br>  ex√©cutez la commande √† partir de l√†: <b>./migrate export -l /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> <br><br>  Si la base export√©e est grande, la proc√©dure peut prendre plusieurs heures. <br>  NE D√âBRANCHEZ PAS la SESSION SSH pendant la proc√©dure. <br><br>  Dans le processus, GAIA affichera ce message: <br><img src="https://habrastorage.org/webt/ca/za/b-/cazab-404a0urgpqe7g1vejfjta.png"><br>  Vous pouvez aller en toute s√©curit√© pour le caf√© et le d√©jeuner. <br><br>  Apr√®s avoir vu un message d'erreur comme celui-ci: <br><br><img src="https://habrastorage.org/webt/k0/v9/20/k0v920a3j-8z2pciapocj0bzhnk.png"><br><br>  Ou un message sur la r√©ussite de l'op√©ration: <br><br><img src="https://habrastorage.org/webt/jf/aj/nd/jfajnd1gn41wnuk-ipg2-vitgqe.png"><br><br>  Si le processus dure depuis quelques heures, vous pouvez le v√©rifier.  Sans d√©connecter la session en cours, configurez une session parall√®le via ssh et entrez la commande <b>sup√©rieure.</b>  Parmi les processus, le processus de <b>migration</b> doit √™tre affich√© <b>.</b> <br><br>  Si sans d√©connecter la session SSH de quelque fa√ßon que ce soit, utilisez: <b>yes |</b>  <b>nohup ./migrate export -l /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> <br><br>  Dans ce cas, vous pouvez d√©connecter la session, mais il sera g√™nant de surveiller la progression: vous devrez v√©rifier la fin du processus avec la commande top, et en cas de probl√®me il n'y aura pas de message d'erreur.  Par cons√©quent, nous recommandons fortement cette option. </li><li>  Supprimer la somme de contr√¥le de l'archive: <b>md5sum /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> </li><li>  Nous enregistrons la valeur re√ßue dans un cahier. </li><li>  Nous nous connectons √† SMS via SCP et t√©l√©chargeons l'archive avec la configuration sur le poste de travail.  Assurez-vous d'utiliser le transfert de fichiers au format binaire. </li></ol><br>  <b>Exporter la base de donn√©es SmartEvent</b> <br><br>  Ici, nous avons besoin d'une version SMS pr√©-install√©e R80.  N'importe quel test fera l'affaire. <br><br><ol><li>  Depuis SMS, nous avons besoin d'un script situ√© ici: <b>$ RTDIR / bin / eva_db_backup.csh</b> </li><li>  Via SCP, chargez le script <b>eva_db_backup.csh</b> dans le dossier: <b>/var/log/UpgradeR77.30_R80.20/</b> </li><li>  Nous nous connectons via SSH √† SMS.  Copiez le fichier dans le dossier: <b>cp /var/log/UpgradeR77.30_R80.20/eva_db_backup.csh</b> <b><br></b>  <b>$ RTDIR / bin / eva_db_backup.csh</b> <br></li><li>  <b>Changez l'</b> encodage: <b>dos2unix $ RTDIR / bin / eva_db_backup.csh</b> </li><li>  Ajouter le propri√©taire: <b>chown -v admin: root $ RTDIR / bin / eva_db_backup.csh</b> </li><li>  Ajouter des autorisations: <b>chmod -v 0755 $ RTDIR / bin / eva_db_backup.csh</b> </li><li>  Nous commen√ßons l'exportation de la base SmartEvent: <b>$ RTDIR / bin / eva_db_backup.csh</b> </li><li>  Nous t√©l√©chargeons les fichiers re√ßus via SCP: <b>$ RTDIR / bin / &lt;date&gt; -db-backup.backup</b> et <b>$ RTDIR / bin / eventiaUpgrade.tar</b> sur le poste de travail. </li></ol><br>  <b>Mettre √† jour</b> <br><br><ol><li>  Acc√©dez √† <b>WebUI GAIA SMS ‚Üí CPUSE ‚Üí Afficher tous les packages.</b> </li><li>  Dans le cas o√π CPUSE g√©n√®re une erreur de connexion au cloud Connect Point, nous v√©rifions les param√®tres DGW, DNS et proxy. </li><li>  Si tout est correct, mais que l'erreur persiste, vous devez mettre √† jour CPUSE manuellement, guid√© par <a href="https://supportcenter.checkpoint.com/supportcenter/portal%3FeventSubmit_doGoviewsolutiondetails%3D%255E_%255Eamp%255E_%255Esolutionid%3Dsk92449%255E_%255Eamp%255E_%255Epartition%3DGeneral%255E_%255Eamp%255E_%255Eproduct%3DAll%2522">sk92449</a> . </li><li>  T√©l√©chargez l'image et passez par <b>Verifier.</b>  Si n√©cessaire, √©liminez les incoh√©rences. <br><br>  Par cons√©quent, vous devriez voir ce message: <br><br><img src="https://habrastorage.org/webt/w3/ai/_w/w3ai_wdfusghwng1pwxls5l4aek.png"></li><li>  Choisissez <b>R80.20 Nouvelle installation et mise √† niveau pour la gestion de la s√©curit√©.</b> </li><li>  Lors de l'installation de la mise √† jour, s√©lectionnez Nettoyer l'installation.  Apr√®s l'installation, le syst√®me red√©marrera. </li><li>  Nous passons le First Time <b>Wizard.</b> </li><li>  Apr√®s avoir obtenu l'acc√®s, nous v√©rifions les comptes. </li><li>  Nous nous connectons √† SMS via SSH et changeons notre shell utilisateur en / bin / bash /: <br><br>  <b>d√©finir l'utilisateur &lt;username&gt; shell / bin / bash /</b> <br><br>  <b>enregistrer la configuration</b> (au cas o√π nous voudrions laisser bin / bash / comme shell par d√©faut et apr√®s le red√©marrage). </li><li>  Ensuite, nous nous connectons √† SMS via SCP et en mode binaire, nous transf√©rons l'archive avec la configuration <b>SMS_w_logs_export_r77_r80.tgz</b> dans le dossier <b>/var/log/UpgradeR77.30_R80.20/</b> <b><br></b> </li><li>  Nous supprimons la somme de contr√¥le de l'archive: <b>md5sum /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> et la comparons avec la valeur pr√©c√©dente.  Le total de contr√¥le doit correspondre. </li><li>  Nous augmentons le d√©lai d'expiration de la session SSH √† 8 heures.  Pour ce faire: <br><br>  <b>[Expert @ HostName] # clish -c "afficher l'inactivit√©-timeout"</b> regardez le time-out actuel clish, <br><br>  <b>[Expert @ HostName] # clish -c "set inactivity-timeout 720"</b> sp√©cifiez un nouveau timeout clish (en minutes), <br><br>  <b>[Expert @ HostName] # echo $ TMOUT</b> regardez le mode expert de timeout actuel, <br><br>  <b>[Expert @ HostName] # export TMOUT = 3600</b> sp√©cifiez le nouveau mode expert de d√©lai d'attente (en secondes).  Si vous d√©finissez la valeur sur 0, la temporisation sera d√©sactiv√©e. </li><li>  Pour importer les param√®tres, ex√©cutez l'utilitaire d'importation de migration.  Pour ce faire, acc√©dez au dossier: <b>cd $ FWDIR / bin / upgrade_tools /</b> et ex√©cutez l'import: <b>./migrate imp</b> <b><br></b>  <b>ort -l /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> </li></ol><br>  Profitez de la vie pendant les deux prochaines heures.  NE D√âBRANCHEZ PAS la SESSION SSH pendant la proc√©dure.  √Ä la fin, le processus de migration renverra un message de r√©ussite ou une erreur. <br><br>  <b>Liste de contr√¥le apr√®s les mises √† jour</b> <br><br><ol><li>  Disponibilit√© des ressources. </li><li>  SIC avec GW. </li><li>  Licences  Si les licences ne s'affichent pas correctement ou ne s'affichent pas sur SMS, ex√©cutez la commande <b>vsec_central_licence</b> pour distribuer les licences. </li><li>  Param√®tre de strat√©gie. </li></ol><br>  <b>Importer une base de donn√©es SmartEvent</b> <br><br><ol><li>  Activez la lame SmartEvent. </li><li>  Nous nous connectons via WinSCP √† SMS et en mode binaire, nous transf√©rons les fichiers <b>&lt;date&gt; -db-backup.backup</b> et <b>eventiaUpgrade.tar pr√©c√©demment t√©l√©charg√©s</b> dans le dossier <b>/var/log/UpgradeR77.30_R80.20/</b> </li><li>  Nous commen√ßons le script avec la commande: <b>$ RTDIR / bin / eventiaUpgrade.sh -upgrade /var/log/UpgradeR77.30_R80.20/eventiaUpgrade.tar</b> </li><li>  V√©rification de l'√©tat: <b>regardez -n 10 eventiaUpgrade.sh</b> </li><li>  V√©rifiez les journaux dans SmartEvent.  <b>R√äVE!</b> </li></ol><br><a name="THREE"></a><h2>  Mettre √† jour le cluster Check Point GW (actif / sauvegarde) </h2><br>  <b>Avant de commencer le travail</b> <br><br><ol><li>  Nous enregistrons la configuration GAIA de chaque n≈ìud du cluster dans un fichier. Pour ce faire, utilisez la commande: <b>clish -c "show configuration"&gt; ./ &lt;Nom de fichier&gt; .txt</b> </li><li>  Nous t√©l√©chargeons des fichiers √† l'aide de WinSCP. </li><li>  Nous nous connectons √† la WebUI des deux n≈ìuds et allons dans l' <b>onglet CPUSE ‚Üí Afficher tous les packages.</b> </li><li>  Nous trouvons le Service Pack pour la version <b>R80.20 Fresh Install</b> , cliquez sur <b>T√©l√©charger.</b> </li><li>  On v√©rifie que le protocole CCP fonctionne en mode <b>Broadcast</b> , pour cela on entre la commande: <b>cphaprob -a if</b> <br>  Si le mode <b>multidiffusion</b> est s√©lectionn√©, modifiez-le avec la commande: <b>cphaconf set_ccp broadcast</b> (la commande est ex√©cut√©e sur chaque n≈ìud). </li><li>  D√©finissez le temps d'arr√™t pour les n≈ìuds impliqu√©s dans votre syst√®me de surveillance. </li><li>  Nous v√©rifions qu'au niveau de la virtualisation, les param√®tres de <b>changement d'adresse MAC</b> et de <b>transmissions forg√©es</b> pour le r√©seau de synchronisation sont activ√©s. </li></ol><br>  <b>Mettre √† jour</b> <br><br><ol><li>  Nous nous connectons via ssh au n≈ìud actif et ex√©cutons la commande pour surveiller l'√©tat du cluster: <b>watch -n 2 cphaprob stat</b> </li><li>  Nous revenons aux n≈ìuds WebUI Stanby sous l'onglet <b>CPUSE</b> et <b>ex√©cutons</b> <b>Verifier</b> pour le <b>package d'installation fra√Æche R80.20</b> s√©lectionn√© <b>.</b> </li><li>  Nous analysons le rapport Verifier.  Si l'installation est autoris√©e, continuez. </li><li>  S√©lectionnez le package <b>R80.20 Fresh Install</b> et ex√©cutez <b>Upgrade</b> .  Pendant le processus de mise √† niveau, le syst√®me red√©marrera.  Les param√®tres GAIA sont enregistr√©s.  Au moment du red√©marrage, nous surveillons l'√©tat du cluster.  Apr√®s le chargement, l'√©tat du n≈ìud mis √† jour doit passer √† PRET.  Dans certains cas, nous avons eu un moment o√π un n≈ìud non encore mis √† jour est pass√© √† l'√©tat Active Attention et a cess√© d'afficher l'√©tat du n≈ìud mis √† jour.  Ne vous inqui√©tez pas - cette option est √©galement valable. </li><li>  Une fois la mise √† jour termin√©e, ouvrez <b>SmartDashboard.</b> </li><li>  Ouvrez l'objet cluster et modifiez la version du cluster de R77.30 √† R80.20.  Cliquez OK.  Si une erreur se produit lors de l'enregistrement des modifications: <br>  <i>Une erreur interne s'est produite.</i>  <i>(Code: 0x8003001D, impossible d'acc√©der au fichier pour l'op√©ration d'√©criture),</i> <br>  suivez le <a href="https://supportcenter.checkpoint.com/supportcenter/portal%3FeventSubmit_doGoviewsolutiondetails%3D%255E_%255Eamp%255E_%255Esolutionid%3Dsk119973">SK119973</a> .  Apr√®s cela, enregistrez les modifications et cliquez sur <b>Installer la strat√©gie.</b> </li><li>  Dans les param√®tres, d√©cochez le param√®tre <b>For gateway clusters, si l'installation sur un membre du cluster √©choue, ne l'installez pas sur ce cluster.</b> </li><li>  Nous √©tablissons une politique.  Le syst√®me donnera une erreur pour le n≈ìud actif, qui n'a pas encore √©t√© mis √† jour. </li><li>  Nous nous connectons au n≈ìud mis √† jour via ssh et ex√©cutons la commande pour surveiller l'√©tat du cluster: <b>watch -n 2 cphaprob stat</b> </li><li>  Nous nous connectons aux n≈ìuds WebUI Active et <b>acc√©dons</b> √† l' <b>onglet CPUSE ‚Üí Afficher tous les packages.</b>  Nous trouvons le Service Pack pour la version <b>R80.20 Fresh Install</b> , cliquez sur <b>T√©l√©charger.</b> </li><li>  D√©finissez le temps d'arr√™t pour les n≈ìuds impliqu√©s dans votre syst√®me de surveillance. </li><li>  Nous revenons aux n≈ìuds WebUI Active sous l'onglet <b>CPUSE</b> et <b>ex√©cutons</b> <b>Verifier</b> pour le <b>package d'installation fra√Æche R80.20</b> s√©lectionn√© <b>.</b> </li><li>  Nous analysons le rapport Verifier.  Si l'installation est autoris√©e, continuez. </li><li>  S√©lectionnez le package <b>R80.20 Fresh Install</b> et ex√©cutez <b>Upgrade.</b>  Pendant le processus de mise √† niveau, le syst√®me red√©marrera.  Les param√®tres GAIA sont enregistr√©s.  Au moment du red√©marrage, nous surveillons l'√©tat du cluster sur un n≈ìud d√©j√† mis √† jour.  Apr√®s le red√©marrage, l'√©tat du cluster sur le n≈ìud mis √† jour passera de PRET √† ACTIF. </li><li>  Une fois le processus de mise √† niveau termin√©, lancez SmartDashboard et installez la strat√©gie. </li></ol><br>  <b>Liste de contr√¥le apr√®s les mises √† jour</b> <br><br><ul><li>  Journaux des √©v√©nements dans SmartLog, √©tat des tunnels VPN. </li><li>  Param√®tres GAIA. </li><li>  R√©cup√©ration de cluster apr√®s le basculement du test. </li><li>  Licences et contrats.  Si les licences ne s'affichent pas correctement ou ne s'affichent pas sur SMS, ex√©cutez la commande.  vsec_central_licence pour la distribution des licences. </li><li>  CoreXL. </li><li>  SecureXL. </li><li>  Hotfix et CPinfo sur deux n≈ìuds. </li></ul><br>  <b>Conclusion</b> <br><br>  En g√©n√©ral, √† ce stade, tout - vous avez mis √† jour. <br><br>  L'ensemble de notre processus a dur√© en moyenne de 6 √† 12 heures, selon la taille des bases de donn√©es export√©es.  Le travail s'est d√©roul√© sur deux nuits: une pour la mise √† jour SMS, la seconde pour le cluster. <br><br>  Il n'y a eu aucun temps d'arr√™t du trafic, malgr√© le fait que nous ayons v√©rifi√© toutes les erreurs ci-dessus. <br><br>  Bien s√ªr, des difficult√©s compl√®tement nouvelles peuvent parfois survenir pendant le processus de mise √† jour, mais il s'agit de Check Point et, comme nous le savons tous, il y a toujours un correctif! <br><br>  Bonne chance avec vos nuits roses et roses et mises √† jour! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484170/">https://habr.com/ru/post/fr484170/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484154/index.html">M√©thode de r√©solution du syst√®me d'√©quations diophantiennes</a></li>
<li><a href="../fr484160/index.html">Talent insaisissable: la Russie perd les meilleurs professionnels de l'informatique</a></li>
<li><a href="../fr484164/index.html">L'histoire du livre et l'avenir des biblioth√®ques</a></li>
<li><a href="../fr484166/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../fr484168/index.html">Nous √©crivons notre strat√©gie de d√©filement virtuel depuis Angular CDK</a></li>
<li><a href="../fr484172/index.html">Int√©gration continue dans Unity: comment r√©duire le temps d'assemblage et √©conomiser des ressources + ligne de paiement en cadeau</a></li>
<li><a href="../fr484174/index.html">Castle buvant dans des conditions "extr√™mes" ou comment nous avons particip√© au spectacle "DOZOR"</a></li>
<li><a href="../fr484176/index.html">Impl√©mentation du mod√®le de statut dans Unity</a></li>
<li><a href="../fr484178/index.html">Commutateur Ethernet intelligent pour la plan√®te Terre</a></li>
<li><a href="../fr484180/index.html">PBX virtuel Rostelecom: quoi et comment faire via l'API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>