<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏺 🔖 👼 La participación falló: llevamos a AgentTesla a agua limpia. Parte 2 🧜🏿 🆎 👐🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuamos una serie de artículos sobre análisis de malware. En la primera parte, hablamos sobre cómo Ilya Pomerantsev, un experto en análisis de cód...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La participación falló: llevamos a AgentTesla a agua limpia. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/479120/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/vz/an/r5/vzanr5kxitvhd3zqrcdh1qhctjm.png"></div><br>  Continuamos una serie de artículos sobre análisis de malware.  En la <a href="https://habr.com/ru/company/group-ib/blog/478176/">primera</a> parte, hablamos sobre cómo Ilya Pomerantsev, un experto en análisis de código malicioso en CERT Group-IB, realizó un análisis detallado de un archivo recibido por correo de una empresa europea y encontró el <b>spyware AgentTesla allí</b> .  En este artículo, Ilya presenta los resultados de un análisis por fases del módulo principal <b>AgentTesla</b> . <br><a name="habracut"></a><br><blockquote> Agent Tesla es un software de espionaje modular distribuido como malware como servicio bajo la apariencia de un producto legal keylogger.  El agente Tesla puede extraer y transmitir credenciales de usuario desde navegadores, clientes de correo electrónico y clientes FTP al servidor para atacantes, registrar datos del portapapeles y capturar la pantalla del dispositivo.  En el momento del análisis, el sitio web oficial de los desarrolladores no estaba disponible. <br></blockquote><br><h2>  Archivo de configuración </h2><br>  La siguiente tabla enumera qué características se utilizan en la muestra utilizada: <br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Descripción</strong> <br></td><td>  <strong>Valor</strong> <br></td></tr><tr><td>  Indicador de uso de KeyLogger <br></td><td>  cierto <br></td></tr><tr><td>  Marcar para usar ScreenLogger <br></td><td>  falso <br></td></tr><tr><td>  Intervalo de envío del registro de KeyLogger en minutos <br></td><td>  20 <br></td></tr><tr><td>  Intervalo de envío del registro de ScreenLogger en minutos <br></td><td>  20 <br></td></tr><tr><td>  Indicador para procesar la tecla Retroceso.  Falso: solo registro.  Verdadero: borra la clave anterior <br></td><td>  falso <br></td></tr><tr><td>  Escriba CnC.  Opciones: smtp, webpanel, ftp <br></td><td>  smtp <br></td></tr><tr><td>  Indicador de activación del hilo para terminar procesos de la lista "% filter_list%" <br></td><td>  falso <br></td></tr><tr><td>  Indicador de desactivación de UAC <br></td><td>  falso <br></td></tr><tr><td>  Desactivar la bandera del administrador de tareas <br></td><td>  falso <br></td></tr><tr><td>  Indicador de desactivación de CMD <br></td><td>  falso <br></td></tr><tr><td>  Ejecutar ventana deshabilitar bandera <br></td><td>  falso <br></td></tr><tr><td>  Desactivar el indicador del visor de registro <br></td><td>  falso <br></td></tr><tr><td>  Deshabilitar puntos de restauración del sistema <br></td><td>  cierto <br></td></tr><tr><td>  Indicador de desactivación del panel de control <br></td><td>  falso <br></td></tr><tr><td>  Indicador de desactivación de MSCONFIG <br></td><td>  falso <br></td></tr><tr><td>  Indicador de desactivación del menú contextual del explorador <br></td><td>  falso <br></td></tr><tr><td>  Indicador de pin del sistema <br></td><td>  falso <br></td></tr><tr><td>  Ruta para copiar el módulo principal al acoplar en el sistema <br></td><td>  % startupfolder% \\% insfolder% \\% insname% <br></td></tr><tr><td>  Indicador para configurar los atributos "Sistema" y "Secreto" para el módulo principal fijo en el sistema <br></td><td>  falso <br></td></tr><tr><td>  Reiniciar el indicador de ejecución cuando se fija al sistema <br></td><td>  falso <br></td></tr><tr><td>  Marcador para mover el módulo principal a una carpeta temporal <br></td><td>  falso <br></td></tr><tr><td>  Bandera de ejecución de derivación de UAC <br></td><td>  falso <br></td></tr><tr><td>  Formato de fecha y hora para iniciar sesión <br></td><td>  aaaa-MM-dd HH: mm: ss <br></td></tr><tr><td>  Marcador para usar el filtro de programa para KeyLogger <br></td><td>  cierto <br></td></tr><tr><td>  Tipo de programa de filtrado. <br>  1 - el nombre del programa se busca en los encabezados de las ventanas <br>  2 - el nombre del programa se busca en el nombre del proceso de la ventana <br></td><td>  1 <br></td></tr><tr><td>  Filtro de programa <br></td><td>  Facebook <br>  Twitter <br>  Gmail <br>  Instagram <br>  "Película", <br>  Skype <br>  "Porno", <br>  Hackear <br>  Whatsapp <br>  Discordia <br></td></tr></tbody></table></div><br><h2>  Arreglando el módulo principal en el sistema </h2><br>  Si se establece el indicador correspondiente, el módulo principal se copia a lo largo de la ruta especificada en la configuración como la ruta para la fijación en el sistema. <br><br>  Dependiendo del valor de la configuración, el archivo recibe los atributos "Oculto" y "Sistema". <br>  El inicio automático es proporcionado por dos ramas de registro: <br><br><ul><li>  <b>HKCU \ Software \ Microsoft \ Windows \ CurrentVersion \ Run \% insregname%</b> </li><li>  <b>HKCU \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Explorer \ StartupApproved \ Run \% insregname%</b> </li></ul><br>  Dado que el gestor de arranque se inyecta en el proceso <b>RegAsm</b> , establecer el indicador persistente para el módulo principal conlleva consecuencias bastante interesantes.  En lugar de copiarse a sí mismo, el malware aseguró el archivo original <b>RegAsm.exe</b> en el sistema, durante el cual se realizó la inyección. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/a8/mx/in/a8mxinpopuoixolt4r7tiwulc70.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9p/-f/ui/9p-fui42mv7y06i5ivacsyh2zqm.png"></div><br><h2>  Interacción con C&amp;C </h2><br>  Independientemente del método utilizado, la interacción de la red comienza con la obtención de la IP externa de la víctima utilizando el <b><a href="http://checkip/">checkip</a> [.] Amazonaws [.] Com /</b> resource. <br>  A continuación se describen los métodos de red presentados en el malware. <br><br><h3>  panel web </h3><br>  La interacción es a través del protocolo HTTP.  El malware ejecuta una solicitud POST con los siguientes encabezados: <br><br><ul><li>  <b>User-Agent: Mozilla / 5.0 (Windows U Windows NT 6.1 ru rv: 1.9.2.3) Gecko / 20100401 Firefox / 4.0 (.NET CLR 3.5.30729)</b> </li><li>  <b>Conexión: Keep-Alive</b> </li><li>  <b>Tipo de contenido: application / x-www-form-urlencoded</b> </li></ul><br>  La dirección del servidor está establecida en <b>% PostURL%</b> .  El mensaje cifrado se pasa en el parámetro <b>"p"</b> .  El mecanismo de cifrado se describe en la sección <b>"Algoritmos de cifrado" (Método 2)</b> . <br><br>  El mensaje transmitido es el siguiente: <br><br>  <b>type = {0} \ nhwid = {1} \ ntime = {2} \ npcname = {3} \ nlogdata = {4} \ nscreen = {5} \ nipadd = {6} \ nwebcam_link = {7} \ nclient = {8} \ nlink = {9} \ nusername = {10} \ npassword = {11} \ nscreen_link = {12}</b> <br><br>  El parámetro <b>tipo</b> indica el tipo de mensaje: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lc/5l/yr/lc5lyrzbeie0jr9z-6dpzpylaze.jpeg"></div><br>  <b>hwid</b> : se <b>escribe</b> un hash MD5 a partir de los valores del número de serie de la placa base y la ID del procesador.  Lo más probable es que se use como ID de usuario. <br>  <b>hora</b> : sirve para transmitir la hora y fecha actuales. <br>  <b>pcname</b> : definido como <b>&lt;Nombre de usuario&gt; / &lt;Nombre del equipo&gt;</b> . <br>  <b>logdata</b> : datos de registro. <br><br>  Al transmitir contraseñas, el mensaje se ve así: <br><br>  <b>type = {0} \ nhwid = {1} \ ntime = {2} \ npcname = {3} \ nlogdata = {4} \ nscreen = {5} \ nipadd = {6} \ nwebcam_link = {7} \ nscreen_link = {8} \ n [contraseñas]</b> <br><br>  Las siguientes son descripciones de los datos robados en el formato <b>\ nclient [] = {0} \ nlink [] = {1} \ nusername [] = {2} \ npassword [] = {3}</b> . <br><br><h3>  smtp </h3><br>  La interacción es a través del protocolo SMTP.  El mensaje transmitido está en formato HTML.  El parámetro <b>BODY</b> es: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gh/vg/np/ghvgnpycvdbcsyyakmwjvfppnw4.png"></div><br>  El título de la carta tiene la forma general: <b>&lt;NOMBRE DE USUARIO&gt; / &lt;NOMBRE DE COMPUTADORA&gt; &lt;TIPO DE CONTENIDO&gt;</b> .  El contenido de la carta, así como sus archivos adjuntos, no están encriptados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x5/7c/5o/x57c5ojnqhgfpnec0jnsqix931c.jpeg"></div><br>  La interacción es a través del protocolo ftp.  Un archivo con el nombre <b>&lt;TIPO DE CONTENIDO&gt; _ &lt;NOMBRE DE USUARIO&gt; - &lt;NOMBRE DE COMPUTADORA&gt; _ &lt;FECHA Y HORA&gt; .html</b> se transfiere al servidor especificado.  El contenido del archivo no está encriptado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/r-/2n/wr/r-2nwryzwnv7voneopya8y5aazq.jpeg"></div><br><h2>  Algoritmos de cifrado </h2><br>  En este caso, se utilizan los siguientes métodos de cifrado: <br><br><h3>  Método 1 </h3><br>  Este método se usa para cifrar cadenas en el módulo principal.  Para el cifrado, se <b>utiliza el</b> algoritmo <b>AES</b> . <br><br>  La entrada es un número decimal de seis dígitos.  Se realiza la siguiente transformación en él: <br><br>  <b>f (x) = (((x &gt;&gt; 2 - 31059) ^ 6380) - 1363) &gt;&gt; 3</b> <br><br>  El valor resultante es el índice de la matriz de datos incrustada. <br><br>  Cada elemento de la matriz es una secuencia <b>DWORD</b> .  Al combinar <b>DWORD,</b> se obtiene una matriz de bytes: los primeros 32 bytes son la clave de cifrado, seguidos de 16 bytes del vector de inicialización, y los bytes restantes son los datos cifrados. <br><br><h3>  Método 2 </h3><br>  El algoritmo <b>3DES</b> se usa en <b>modo ECB</b> con relleno en bytes completos ( <b>PKCS7</b> ). <br><br>  La clave se especifica mediante el parámetro <b>% urlkey%</b> , pero su hash MD5 se usa para el cifrado. <br><br><h2>  Funcionalidad maliciosa </h2><br>  La muestra en estudio utiliza los siguientes programas para implementar su función maliciosa: <br><br><h3>  Keylogger </h3><br>  Si hay un indicador VPO correspondiente que utiliza la función WinAPI, <b>SetWindowsHookEx</b> asigna su propio controlador para eventos de pulsación de teclas.  La función del controlador comienza obteniendo el título de la ventana activa. <br><br>  Si se establece el indicador para realizar el filtrado de la aplicación, el filtrado se realiza según el tipo especificado: <br><br><ol><li>  el nombre del programa se busca en los encabezados de las ventanas </li><li>  el nombre del programa se busca en el nombre del proceso de la ventana </li></ol><br>  A continuación, se agrega un registro al registro con información sobre la ventana activa en el formato: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bx/r0/cj/bxr0cj1srz9us2a4il4rwjfpoqo.png"></div><br>  Luego se registra la información sobre la tecla presionada: <br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Clave</strong> <br></td><td>  <strong>Registro</strong> <br></td></tr><tr><td>  Retroceso <br></td><td>  Dependiendo de la bandera de procesamiento de la tecla Retroceso: Falso - <font color="#008000">{BACK}</font> <br>  Verdadero: borra la clave anterior <br></td></tr><tr><td>  BLOQUEO DE MAYÚSCULAS <br></td><td>  <font color="#008000">{BLOQ MAYÚS}</font> <br></td></tr><tr><td>  Esc <br></td><td>  <font color="#008000">{ESC}</font> <br></td></tr><tr><td>  Re Pág <br></td><td>  <font color="#008000">{PageUp}</font> <br></td></tr><tr><td>  Abajo <br></td><td>  <font color="#008000">Darr</font> <br></td></tr><tr><td>  BORRAR <br></td><td>  <font color="#008000">{DEL}</font> <br></td></tr><tr><td>  " <br></td><td>  &amp; quot; <br></td></tr><tr><td>  F5 <br></td><td>  <font color="#008000">{F5}</font> <br></td></tr><tr><td>  Y <br></td><td>  &amp; amp; <br></td></tr><tr><td>  F10 <br></td><td>  <font color="#008000">{F10}</font> <br></td></tr><tr><td>  Pestaña <br></td><td>  <font color="#008000">{TAB}</font> <br></td></tr><tr><td>  &lt; <br></td><td>  &amp; lt; <br></td></tr><tr><td>  &gt; <br></td><td>  &amp; gt; <br></td></tr><tr><td>  Barra espaciadora <br></td><td></td></tr><tr><td>  F8 <br></td><td>  <font color="#008000">{F8}</font> <br></td></tr><tr><td>  F12 <br></td><td>  <font color="#008000">{F12}</font> <br></td></tr><tr><td>  F9 <br></td><td>  <font color="#008000">{F9}</font> <br></td></tr><tr><td>  ALT + TAB <br></td><td>  <font color="#008000">{ALT + TAB}</font> <br></td></tr><tr><td>  Fin <br></td><td>  <font color="#008000">{END}</font> <br></td></tr><tr><td>  F4 <br></td><td>  <font color="#008000">{F4}</font> <br></td></tr><tr><td>  F2 <br></td><td>  <font color="#008000">{F2}</font> <br></td></tr><tr><td>  CTRL <br></td><td>  <font color="#008000">{CTRL}</font> <br></td></tr><tr><td>  F6 <br></td><td>  <font color="#008000">{F6}</font> <br></td></tr><tr><td>  Derecho <br></td><td>  <font color="#008000">? rarr;</font> <br></td></tr><tr><td>  Arriba <br></td><td>  <font color="#008000">&amp; uarr;</font> <br></td></tr><tr><td>  F1 <br></td><td>  <font color="#008000">{F1}</font> <br></td></tr><tr><td>  Izquierda <br></td><td>  <font color="#008000">&amp; larr;</font> <br></td></tr><tr><td>  Pagedown <br></td><td>  <font color="#008000">{PageDown}</font> <br></td></tr><tr><td>  Insertar <br></td><td>  <font color="#008000">{Insertar}</font> <br></td></tr><tr><td>  Ganar <br></td><td>  <font color="#008000">{Win}</font> <br></td></tr><tr><td>  Numlock <br></td><td>  <font color="#008000">{Bloq Num}</font> <br></td></tr><tr><td>  F11 <br></td><td>  <font color="#008000">{F11}</font> <br></td></tr><tr><td>  F3 <br></td><td>  <font color="#008000">{F3}</font> <br></td></tr><tr><td>  Inicio <br></td><td>  <font color="#008000">{INICIO}</font> <br></td></tr><tr><td>  ENTRAR <br></td><td>  <font color="#008000">{ENTER}</font> <br></td></tr><tr><td>  ALT + F4 <br></td><td>  <font color="#008000">{ALT + F4}</font> <br></td></tr><tr><td>  F7 <br></td><td>  <font color="#008000">{F7}</font> <br></td></tr><tr><td>  Otra clave <br></td><td>  Carácter en mayúsculas o minúsculas según la posición de las teclas Mayús y Bloq Mayús <br></td></tr></tbody></table></div><br>  Con una frecuencia dada, el registro recopilado se envía al servidor.  Si la transferencia no tuvo éxito, el registro se guarda en el archivo <b>% TEMP% \\ log.tmp</b> en el formato: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xn/pz/eb/xnpzeba3_y7ulwz0wesksvlspkg.png"></div><br>  Cuando el temporizador se apaga, el archivo se transferirá al servidor. <br><br><h3>  Screenlogger </h3><br>  Con la frecuencia especificada, el malware crea una captura de pantalla en formato <b>Jpeg</b> con un valor de calidad de 50 y lo guarda en el archivo <b>% APPDATA% \\ &lt;secuencia aleatoria de 10 caracteres&gt; .jpg</b> .  Después de la transferencia, el archivo se elimina. <br><br><h3>  Clipboardlogger </h3><br>  Si se establece el indicador correspondiente, los reemplazos se realizan en el texto interceptado de acuerdo con la tabla a continuación. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xh/wc/y7/xhwcy7r4g5duormggz-texkxemi.jpeg"></div><br>  Después de eso, el texto se inserta en el registro: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ft/6l/2p/ft6l2pmpzecwtkh0hhgbblet30q.png"></div><br><h3>  PasswordStealer </h3><br>  El malware puede descargar contraseñas de las siguientes aplicaciones: <br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Navegadores</strong> <br></td><td>  <strong>Clientes de correo electrónico</strong> <br></td><td>  <strong>Clientes FTP</strong> <br></td></tr><tr><td>  Cromo <br></td><td>  Perspectiva <br></td><td>  Filezilla <br></td></tr><tr><td>  Firefox <br></td><td>  Thunderbird <br></td><td>  WS_FTP <br></td></tr><tr><td>  IE / Edge <br></td><td>  Foxmail <br></td><td>  Winscp <br></td></tr><tr><td>  Safari <br></td><td>  Opera Mail <br></td><td>  Coreftp <br></td></tr><tr><td>  Navegador Opera <br></td><td>  IncrediMail <br></td><td>  Navegador FTP <br></td></tr><tr><td>  Yandex <br></td><td>  Pocomail <br></td><td>  Flashfxp <br></td></tr><tr><td>  Comodo <br></td><td>  Eudora <br></td><td>  Smartftp <br></td></tr><tr><td>  Chromeplus <br></td><td>  Thebat <br></td><td>  FTPCommander <br></td></tr><tr><td>  Cromo <br></td><td>  Buzón <br></td><td></td></tr><tr><td>  Antorcha <br></td><td>  Clawsmail <br></td><td></td></tr><tr><td>  7estrella <br></td><td></td><td></td></tr><tr><td>  Amigo <br></td><td></td><td></td></tr><tr><td>  Bravesoftware <br></td><td>  <strong>Clientes Jabber</strong> <br></td><td>  <strong>Clientes VPN</strong> <br></td></tr><tr><td>  Centbrowser <br></td><td>  Psi / psi + <br></td><td>  VPN abierta <br></td></tr><tr><td>  Chedot <br></td><td></td><td></td></tr><tr><td>  Coccoc <br></td><td></td><td></td></tr><tr><td>  Navegador de elementos <br></td><td>  <strong>Descargar gestores</strong> <br></td><td></td></tr><tr><td>  Navegador de privacidad épico <br></td><td>  Gestor de descargas de internet <br></td><td></td></tr><tr><td>  Kometa <br></td><td>  Jdownloader <br></td><td></td></tr><tr><td>  Orbitum <br></td><td></td><td></td></tr><tr><td>  Sputnik <br></td><td></td><td></td></tr><tr><td>  uCozMedia <br></td><td></td><td></td></tr><tr><td>  Vivaldi <br></td><td></td><td></td></tr><tr><td>  Seamonkey <br></td><td></td><td></td></tr><tr><td>  Navegador Flock <br></td><td></td><td></td></tr><tr><td>  Navegador Uc <br></td><td></td><td></td></tr><tr><td>  Blackhawk <br></td><td></td><td></td></tr><tr><td>  Cyberfox <br></td><td></td><td></td></tr><tr><td>  K-meleon <br></td><td></td><td></td></tr><tr><td>  Icecat <br></td><td></td><td></td></tr><tr><td>  Icedragon <br></td><td></td><td></td></tr><tr><td>  Luna de miel <br></td><td></td><td></td></tr><tr><td>  Waterfox <br></td><td></td><td></td></tr><tr><td>  Navegador Falkon <br></td><td></td><td></td></tr></tbody></table></div><br><br><h2>  Análisis dinámico contrarrestante <br></h2><br><ul><li>  Usando la función <b>Sleep</b> .  Permite evitar algunos sandboxes por tiempo de espera </li><li>  Destrucción de la secuencia <b>Zone.Identifier</b> .  Le permite ocultar el hecho de descargar un archivo de Internet </li><li>  El parámetro <b>% filter_list%</b> establece la lista de procesos que completará el malware con un intervalo de un segundo </li><li>  Deshabilitar <b>UAC</b> </li><li>  Deshabilitar el Administrador de tareas </li><li>  Deshabilitar <b>CMD</b> </li><li>  Deshabilitar la ventana <b>Ejecutar</b> </li><li>  Deshabilitar el panel de control </li><li>  Deshabilitar la <b>herramienta RegEdit</b> </li><li>  Desactivar puntos de restauración del sistema </li><li>  Deshabilitar el menú contextual en el Explorador </li><li>  Deshabilitar <b>msconfig</b> </li><li>  Bypass <b>UAC</b> : <br></li></ul><br><h2>  Características inactivas del módulo principal. </h2><br>  Durante el análisis del módulo principal, se identificaron las funciones responsables de propagarse por la red y rastrear la posición del mouse. <br><br><h3>  Gusano </h3><br>  En una secuencia separada, se supervisan los eventos de conexión de medios extraíbles.  Cuando se conecta a la raíz del sistema de archivos, el <b>malware se</b> copia con el nombre <b>scr.exe</b> , después de lo cual busca archivos con la extensión <b>lnk</b> .  Cada <b>comando lnk</b> cambia a <b>cmd.exe / c start scr.exe y start &lt;comando original&gt; y sale</b> . <br><br>  Cada directorio en la raíz del medio recibe el atributo <b>Oculto</b> y se <b>crea</b> un archivo con la extensión <b>lnk</b> con el nombre del directorio oculto y el comando <b>cmd.exe / c start scr.exe &amp; explorer / root, \ "% CD% &lt;NOMBRE DEL DIRECTORIO&gt; \" y salir</b> . <br><br><h3>  Mousetracker </h3><br>  El método de intercepción es similar al utilizado para el teclado.  Esta funcionalidad aún está en desarrollo. <br><br><h2>  Actividad de archivo </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>El camino</strong> <br></td><td>  <strong>Descripción</strong> <br></td></tr><tr><td>  % Temp% \ temp.tmp <br></td><td>  Contiene el contador de intentos de evitar UAC <br></td></tr><tr><td>  % startupfolder% \% insfolder% \% insname% <br></td><td>  Forma de consolidarse en el sistema HPE <br></td></tr><tr><td>  % Temp% \ tmpG \ {Hora actual en milisegundos} .tmp <br></td><td>  La ruta para la copia de seguridad del módulo principal <br></td></tr><tr><td>  % Temp% \ log.tmp <br></td><td>  Archivo de registro <br></td></tr><tr><td>  % AppData% \ {Secuencia arbitraria de 10 caracteres} .jpeg <br></td><td>  Capturas de pantalla <br></td></tr><tr><td>  C: \ Users \ Public \ {Secuencia arbitraria de 10 caracteres} .vbs <br></td><td>  La ruta al archivo vbs que el gestor de arranque puede usar para cerrar el sistema <br></td></tr><tr><td>  % Temp% \ {Nombre de carpeta arbitraria} \ {Nombre de archivo} <br></td><td>  La ruta utilizada por el gestor de arranque para acoplar en el sistema <br></td></tr></tbody></table></div><br><h2>  Perfil de intrusos </h2><br>  Gracias a los datos de autenticación "cableados", pudimos obtener acceso al centro de comando. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nq/q0/eb/nqq0ebtlfljriwj4m-97hm7-aww.png"></div><br>  Esto nos permitió identificar el correo final de los atacantes: <br><br>  <b>junaid [.] en *** @ gmail [.] com</b> . <br><br>  El nombre de dominio del centro de comando está registrado en <b>sg *** @ gmail [.] Com</b> . <br><br><h2>  Conclusión </h2><br>  En el curso de un análisis detallado del malware utilizado en el ataque, pudimos establecer su funcionalidad y obtener la lista más completa de indicadores de compromiso relevantes para este caso.  La comprensión de los mecanismos de interacción de red de malvari permitió dar recomendaciones sobre el ajuste del funcionamiento de las herramientas de protección de la información, así como escribir reglas IDS estables. <br><br>  El principal peligro de <b>AgentTesla</b> como DataStealer es que para realizar sus tareas no necesita realizar una fijación en el sistema o esperar un comando de control.  Una vez en la máquina, inmediatamente comienza a recopilar información privada y la transmite a CnC.  Tal comportamiento agresivo es algo similar al comportamiento de los criptógrafos, con la única diferencia de que estos últimos ni siquiera requieren una conexión de red.  En caso de una colisión con esta familia después de limpiar el sistema infectado del malware mismo, es obligatorio cambiar todas las contraseñas que al menos teóricamente podrían almacenarse en una de las aplicaciones anteriores. <br><br>  Mirando hacia el futuro, digamos que los atacantes que envían <b>AgentTesla a</b> menudo cambian el gestor de arranque inicial.  Esto le permite pasar desapercibido para los escáneres estáticos y los analizadores heurísticos en el momento del ataque.  Y la tendencia de esta familia a comenzar inmediatamente su actividad hace que los monitores del sistema sean inútiles.  La mejor manera de tratar con AgentTesla es un análisis preliminar en el sandbox. <br><br>  En el tercer artículo de esta serie, veremos otros cargadores de arranque utilizados por <b>AgentTesla</b> y también aprenderemos sobre el proceso de su desempaque semiautomático.  ¡No te lo pierdas! <br><br><h2>  Hachís </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>SHA1</strong> <br></td></tr><tr><td>  A8C2765B3D655BA23886D663D22BDD8EF6E8E894 <br></td></tr><tr><td>  8010CC2AF398F9F951555F7D481CE13DF60BBECF <br></td></tr><tr><td>  79B445DE923C92BF378B19D12A309C0E9C5851BF <br></td></tr><tr><td>  15839B7AB0417FA35F2858722F0BD47BDF840D62 <br></td></tr><tr><td>  1C981EF3EEA8548A30E8D7BF8D0D61F9224288DD <br></td></tr></tbody></table></div><br><h2>  C&amp;C </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>URL</strong> <br></td></tr><tr><td>  sina-c0m [.] icu <br></td></tr><tr><td>  smtp [.] sina-c0m [.] icu <br></td></tr></tbody></table></div><br><br><h2>  Regkey </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Registro</strong> <br></td></tr><tr><td>  HKCU \ Software \ Microsoft \ Windows \ CurrentVersion \ Run \ {Script Name} <br></td></tr><tr><td>  HKCU \ Software \ Microsoft \ Windows \ CurrentVersion \ Run \% insregname% <br></td></tr><tr><td>  HKCU \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Explorer \ StartupApproved \ Run \% insregname% <br></td></tr></tbody></table></div><br><h3>  Mutex </h3><br>  Sin indicadores <br><br><h3>  Archivos </h3><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Actividad de archivo</strong> <br></td></tr><tr><td>  % Temp% \ temp.tmp <br></td></tr><tr><td>  % startupfolder% \% insfolder% \% insname% <br></td></tr><tr><td>  % Temp% \ tmpG \ {Hora actual en milisegundos} .tmp <br></td></tr><tr><td>  % Temp% \ log.tmp <br></td></tr><tr><td>  % AppData% \ {Secuencia arbitraria de 10 caracteres} .jpeg <br></td></tr><tr><td>  C: \ Users \ Public \ {Secuencia arbitraria de 10 caracteres} .vbs <br></td></tr><tr><td>  % Temp% \ {Nombre de carpeta arbitraria} \ {Nombre de archivo} <br></td></tr></tbody></table></div><br><h2>  Información de muestras </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Nombre</strong> <br></td><td>  Desconocido <br></td></tr><tr><td>  <strong>MD5</strong> <br></td><td>  F7722DD8660B261EA13B710062B59C43 <br></td></tr><tr><td>  <strong>SHA1</strong> <br></td><td>  15839B7AB0417FA35F2858722F0BD47BDF840D62 <br></td></tr><tr><td>  <strong>SHA256</strong> <br></td><td>  41DC0D5459F25E2FDCF8797948A7B315D3CB0753 <br>  98D808D1772CACCC726AF6E9 <br></td></tr><tr><td>  <strong>Tipo</strong> <br></td><td>  PE (.NET) <br></td></tr><tr><td>  <strong>Tamaño</strong> <br></td><td>  327680 <br></td></tr><tr><td>  <strong>Nombre original</strong> <br></td><td>  AZZRIDKGGSLTYFUBCCRRCUMRKTOXFVPDKGAGPUZI_20190701133545943.exe <br></td></tr><tr><td>  <strong>Sello de fecha</strong> <br></td><td>  01/07/2019 <br></td></tr><tr><td>  <strong>Compilador</strong> <br></td><td>  Vb.net <br></td></tr></tbody></table></div><br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Nombre</strong> <br></td><td>  IELibrary.dll <br></td></tr><tr><td>  <strong>MD5</strong> <br></td><td>  BFB160A89F4A607A60464631ED3ED9FD <br></td></tr><tr><td>  <strong>SHA1</strong> <br></td><td>  1C981EF3EEA8548A30E8D7BF8D0D61F9224288DD <br></td></tr><tr><td>  <strong>SHA256</strong> <br></td><td>  D55800A825792F55999ABDAD199DFA54F3184417 <br>  215A298910F2C12CD9CC31EE <br></td></tr><tr><td>  <strong>Tipo</strong> <br></td><td>  PE (.NET DLL) <br></td></tr><tr><td>  <strong>Tamaño</strong> <br></td><td>  16896 <br></td></tr><tr><td>  <strong>Nombre original</strong> <br></td><td>  IELibrary.dll <br></td></tr><tr><td>  <strong>Sello de fecha</strong> <br></td><td>  10/11/2016 <br></td></tr><tr><td>  <strong>Compilador</strong> <br></td><td>  Microsoft Linker (48.0 *) <br></td></tr></tbody></table></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/479120/">https://habr.com/ru/post/479120/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../479100/index.html">Front-end dojo: proyectos para la formación de habilidades de desarrollador (5 nuevos + 43 antiguos)</a></li>
<li><a href="../479102/index.html">Conocimiento de Yandex.Maps o cuánto amo la documentación</a></li>
<li><a href="../479106/index.html">¿Cuánto cuestan los trucos de magia?</a></li>
<li><a href="../479108/index.html">Knight's life - Arena en línea con elementos RPG</a></li>
<li><a href="../479116/index.html">Impresiones en la búsqueda Y. Directa: por qué paga 1,5 veces más por clic</a></li>
<li><a href="../479122/index.html">Cómo comenzar un proyecto de mascotas y no obtener beneficios</a></li>
<li><a href="../479124/index.html">[Infografía] Inteligencia artificial en ciencia ficción</a></li>
<li><a href="../479126/index.html">Python en desarrollo móvil</a></li>
<li><a href="../479128/index.html">¿Cómo funciona el servicio médico del aeropuerto?</a></li>
<li><a href="../479132/index.html">Componente externo para la plataforma móvil 1C (BroadcastReceiver)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>