<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçó üç∂ üë©üèæ‚Äçüî¨ Marco de API de Golang üåñ ü§õüèæ üë¶üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En el proceso de conocer Golang, decid√≠ crear el marco de la aplicaci√≥n, lo que me ser√° conveniente para trabajar en el futuro. El resultado fue, en m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Marco de API de Golang</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455302/"><p>  En el proceso de conocer Golang, decid√≠ crear el marco de la aplicaci√≥n, lo que me ser√° conveniente para trabajar en el futuro.  El resultado fue, en mi opini√≥n, una buena pieza de trabajo, que decid√≠ compartir, y al mismo tiempo discutir los momentos que surgieron durante la creaci√≥n del marco. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/599/73a/8a9/59973a8a925f690405c0f171fdd53048.jpg" alt="imagen"></p><br><p>  En principio, el dise√±o del lenguaje Go sugiere que no es necesario hacer aplicaciones a gran escala (estoy hablando de la falta de gen√©ricos y el mecanismo de manejo de errores no muy poderoso).  Pero todav√≠a sabemos que el tama√±o de las aplicaciones generalmente no disminuye, pero m√°s a menudo es todo lo contrario.  Por lo tanto, es mejor crear de inmediato un marco en el que sea posible encadenar nuevas funciones sin sacrificar el soporte de c√≥digo. </p><a name="habracut"></a><br><p>  Intent√© insertar menos c√≥digo en el art√≠culo, en su lugar agregu√© enlaces a l√≠neas de c√≥digo espec√≠ficas en Github con la esperanza de que fuera m√°s conveniente ver la imagen completa. </p><br><p>  Primero, bosquej√© un plan para lo que deber√≠a estar en la aplicaci√≥n.  Como en el art√≠culo hablar√© sobre cada elemento por separado, primero dar√© el principal de esta lista como contenido. </p><br><ul><li>  Elegir administrador de paquetes </li><li> Elija un marco para crear una API </li><li>  Seleccionar herramienta para inyecci√≥n de dependencia (DI) </li><li>  Rutas de solicitud web </li><li>  Respuestas JSON / XML seg√∫n encabezados de solicitud </li><li>  ORM </li><li>  Migraciones </li><li>  Hacer clases base para capas de modelo Servicio-&gt; Repositorio-&gt; Entidad </li><li>  Dep√≥sito CRUD b√°sico </li><li>  Servicio CRUD b√°sico </li><li>  Controlador CRUD b√°sico </li><li>  Validaci√≥n de solicitud </li><li>  Configuraciones y variables de entorno </li><li>  Comandos de la consola </li><li>  Registro </li><li>  Integraci√≥n de registrador con Sentry u otro sistema de alerta </li><li>  Establecer alerta de errores </li><li>  Pruebas unitarias con redefinici√≥n de servicios a trav√©s de DI </li><li>  Mapa de c√≥digos de cobertura de porcentaje y prueba </li><li>  Swagger </li><li>  Docker componer </li></ul><br><h2 id="menedzher-paketov">  Administrador de paquetes </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Despu√©s de leer las</a> descripciones de varias implementaciones, eleg√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">govendor</a> y por el momento estaba satisfecho con la elecci√≥n.  La raz√≥n es simple: le permite instalar dependencias dentro del directorio con la aplicaci√≥n, almacenar informaci√≥n sobre paquetes y sus versiones. </p><br><p>  La informaci√≥n sobre los paquetes y sus versiones se almacena en un <a href="">archivo</a> vendor.json.  Tambi√©n hay un punto negativo en este enfoque.  Si agrega un paquete con sus dependencias, junto con la informaci√≥n sobre el paquete, la informaci√≥n sobre sus dependencias tambi√©n se incluir√° en el archivo.  El archivo crece r√°pidamente y ya no es posible determinar claramente qu√© dependencias son las principales y cu√°les son las derivadas. </p><br><p>  En PHP Composer o en npm, las dependencias principales se describen en un archivo, y todas las dependencias principales y derivadas y sus versiones se registran autom√°ticamente en el archivo de bloqueo.  Este enfoque es m√°s conveniente en mi opini√≥n.  Pero por ahora, la implementaci√≥n del gobierno ha sido suficiente para m√≠. </p><br><h2 id="freymvork">  Marco </h2><br><p>  Desde el marco no necesito mucho, un enrutador conveniente, validaci√≥n de solicitudes.  Todo esto se encontr√≥ en la popular <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gin</a> .  Se detuvo en eso. </p><br><h2 id="dependency-injection">  Inyecci√≥n de dependencia </h2><br><p>  Con DI tuve que sufrir un poco.  Primero eleg√≠ Dig.  Y al principio todo fue genial.  Servicios descritos, Dig construye m√°s dependencias, convenientemente.  Pero luego result√≥ que los servicios no se pueden redefinir, por ejemplo, durante las pruebas.  Por lo tanto, al final, llegu√© a la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conclusi√≥n de</a> que tom√© un contenedor de servicio simple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sarulabs / di</a> . </p><br><p>  Solo tuve que bifurcarlo, porque listo para usar le permite agregar servicios y proh√≠be redefinirlos.  Y al escribir autotests, en mi opini√≥n, es m√°s conveniente inicializar el contenedor como en la aplicaci√≥n, y luego redefinir algunos de los servicios, especificando stubs en su lugar.  En fork, agreg√≥ un m√©todo para anular la descripci√≥n del servicio. </p><br><p> Pero al final, tanto en el caso de Dig como en el caso del contenedor de servicio, tuve que poner las pruebas en un paquete separado.  De lo contrario, resulta que las pruebas se ejecutan por separado en paquetes ( <code>go test model/service</code> ), pero no se inician de inmediato para toda la aplicaci√≥n ( <code>go test ./...</code> ), debido a las dependencias c√≠clicas que surgen en este caso. </p><br><h2 id="otvety-v-formate-jsonxml-v-sootvetstvii-s-zagolovkami-zaprosa">  Respuestas JSON / XML seg√∫n encabezados de solicitud </h2><br><p>  En Gin, no encontr√© esto, as√≠ que simplemente agregu√© un <a href="">m√©todo</a> al controlador base que genera una respuesta dependiendo del encabezado de la solicitud. </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c BaseController)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">response</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context *gin.Context, obj </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">interface</span></span></span></span><span class="hljs-function"><span class="hljs-params">{}, code </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> context.GetHeader(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"application/xml"</span></span>: context.XML(code, obj) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: context.JSON(code, obj) } }</code> </pre><br><h2 id="orm">  ORM </h2><br><p>  Con ORM no sent√≠ el largo tormento de elecci√≥n.  Hab√≠a mucho para elegir.  Pero de acuerdo con la descripci√≥n de las caracter√≠sticas, me gust√≥ GORM, que es uno de los m√°s populares en el momento de la selecci√≥n.  Hay soporte para el DBMS m√°s utilizado.  Al menos PostgreSQL y MySQL definitivamente est√°n ah√≠.  Tambi√©n tiene m√©todos para administrar el esquema base que puede usar al crear migraciones. </p><br><h2 id="migracii">  Migraciones </h2><br><p>  Para las migraciones, me decid√≠ por el paquete <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gorm-goose</a> .  Pongo un paquete separado a nivel mundial y empiezo la migraci√≥n a √©l.  Al principio, tal implementaci√≥n se avergonz√≥, ya que la conexi√≥n a la base de datos tuvo que describirse en un <a href="">archivo db / dbconf.yml</a> separado.  Pero luego result√≥ que la cadena de conexi√≥n puede describirse de tal manera que el valor se toma de la variable de entorno. </p><br><pre> <code class="plaintext hljs">development: driver: postgres open: $DB_URL</code> </pre> <br><p>  Y esto es bastante conveniente.  Al menos con docker-compose, no tuve que duplicar la <a href="">cadena de conexi√≥n</a> . </p><br><p>  Gorm-goose tambi√©n admite reversiones de migraci√≥n, lo que me parece muy √∫til. </p><br><h2 id="bazovyy-crud-repozitoriy">  Dep√≥sito CRUD b√°sico </h2><br><p>  Prefiero que todo lo que se refiere a recursos se coloque en una capa de repositorio separada.  En mi opini√≥n, con este enfoque, el c√≥digo de l√≥gica de negocios es m√°s limpio.  En este caso, el c√≥digo de l√≥gica de negocios solo sabe que necesita trabajar con los datos que toma del repositorio.  Y lo que sucede en el repositorio, la l√≥gica empresarial no es importante.  El repositorio puede funcionar con una base de datos relacional, con un almacenamiento KV, con un disco o quiz√°s con la API de otro servicio.  El c√≥digo de l√≥gica de negocios ser√° el mismo en todos estos casos. </p><br><p>  El repositorio CRUD implementa la siguiente <a href="">interfaz</a> </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> CrudRepositoryInterface <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { BaseRepositoryInterface GetModel() (entity.InterfaceEntity) Find(id <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>) (entity.InterfaceEntity, error) List(parameters ListParametersInterface) (entity.InterfaceEntity, error) Create(item entity.InterfaceEntity) entity.InterfaceEntity Update(item entity.InterfaceEntity) entity.InterfaceEntity Delete(id <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>) error }</code> </pre> <br><p>  Es decir, CRUD implementa las operaciones <code>Create()</code> , <code>Find()</code> , <code>List()</code> , <code>Update()</code> , <code>Delete()</code> y el m√©todo <code>GetModel()</code> . </p><br><p>  Sobre <a href="">GetModel ()</a> .  Existe un repositorio <code>CrudRepository</code> b√°sico que implementa operaciones CRUD b√°sicas.  En los repositorios que lo integran, es suficiente indicar con qu√© modelo deber√≠an trabajar.  Para hacer esto, el m√©todo <code>GetModel()</code> debe devolver un modelo GORM.  Luego tuvimos que usar el resultado de <code>GetModel()</code> usando la reflexi√≥n en los m√©todos CRUD. </p><br><p>  <a href="">Por ejemplo</a> </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c CrudRepository)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(entity.InterfaceEntity, error)</span></span></span></span> { item := reflect.New(reflect.TypeOf(c.GetModel()).Elem()).Interface() err := c.db.First(item, id).Error <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item, err }</code> </pre> <br><p>  Es decir, de hecho, en este caso fue necesario abandonar la escritura est√°tica en favor de la escritura din√°mica.  En esos momentos, se siente especialmente la falta de gen√©ricos en el idioma. </p><br><p>  Para que los repositorios que trabajan con modelos espec√≠ficos implementen sus propias reglas para filtrar listas en el m√©todo <code>List()</code> , primero implement√© el enlace tard√≠o para que el m√©todo responsable de construir la consulta se llame desde el m√©todo <code>List()</code> .  Y este m√©todo podr√≠a implementarse en un repositorio espec√≠fico.  Es dif√≠cil abandonar de alguna manera los patrones de pensamiento que se formaron al trabajar con otros idiomas.  Pero, mir√°ndolo con una mirada fresca y apreciando la "elegancia" del camino elegido, luego lo rehizo a un enfoque m√°s cercano a Go.  Para hacer esto, simplemente en <code>CrudRepository</code> trav√©s de la interfaz <a href="">se</a> declara <a href="">un generador de consultas</a> , que ya se <a href=""><code>  List()</code></a> . </p><br><pre> <code class="go hljs">listQueryBuilder ListQueryBuilderInterface</code> </pre><br><p>  Resulta bastante gracioso.  Limitar el lenguaje a un enlace tard√≠o, que al principio parece una falla, fomenta una separaci√≥n m√°s clara del c√≥digo. </p><br><h2 id="bazovyy-crud-servis">  Servicio CRUD b√°sico </h2><br><p>  Aqu√≠ no hay nada interesante, ya que no existe una l√≥gica de negocios en el marco.  Las llamadas de los m√©todos CRUD al repositorio son simplemente <a href="">aproximadas</a> . </p><br><p>  En la capa de servicios, se debe implementar la l√≥gica de negocios. </p><br><h2 id="bazovyy-crud-kontroller">  Controlador CRUD b√°sico </h2><br><p>  El controlador implementa <a href="">m√©todos CRUD</a> .  Procesan los par√°metros de la solicitud, el control se transfiere al m√©todo de servicio correspondiente y, en funci√≥n de la respuesta del servicio, se forma una respuesta para el cliente. </p><br><p>  Con el controlador tuve la misma historia que con el repositorio con respecto a las listas de filtrado.  Como resultado, rehice la implementaci√≥n con un enlace tard√≠o casero y agregu√© un <a href="">hidratante</a> que, seg√∫n los par√°metros de solicitud, forma una estructura con par√°metros para filtrar la lista. </p><br><p>  En el hidratador que viene con el controlador CRUD, solo se procesan los par√°metros de paginaci√≥n.  En los controladores espec√≠ficos en los que est√° integrado el controlador CRUD, el <a href="">hidratador</a> se puede <a href="">redefinir</a> . </p><br><h2 id="validaciya-zaprosov">  Validaci√≥n de solicitud </h2><br><p>  La validaci√≥n es realizada por Gin.  Por ejemplo, al agregar un registro (m√©todo <code>Create()</code> ), es suficiente <a href="">decorar los</a> elementos de la estructura de la entidad </p><br><pre> <code class="go hljs">Name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`binding:"required"`</span></span></code> </pre> <br><p>  El m√©todo <a href=""><code>ShouldBindJSON()</code></a> del marco se encarga de verificar que los par√°metros de la solicitud cumplan con los requisitos descritos en el decorador. </p><br><h2 id="konfigi-i-peremennye-okruzheniya">  Configuraciones y variables de entorno </h2><br><p>  Realmente me gust√≥ la implementaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Viper</a> , especialmente en combinaci√≥n con Cobra. </p><br><p>  Leyendo la configuraci√≥n que <a href="">describ√≠ en main.go.</a>  Los par√°metros b√°sicos que no contienen secretos se describen <a href="">en el archivo base.env</a> .  Puede anularlos en el archivo .env que se agrega a .gitignore.  En .env, puede describir valores secretos para el entorno. </p><br><p>  Las variables de entorno tienen una mayor prioridad. </p><br><h2 id="konsolnye-komandy">  Comandos de la consola </h2><br><p>  Para la descripci√≥n de los comandos de la consola, eleg√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cobra</a> .  Entonces es bueno usar Cobra junto con Viper.  Podemos <a href="">describir el comando</a> </p><br><pre> <code class="go hljs">serverCmd.PersistentFlags().StringVar(&amp;serverPort, <span class="hljs-string"><span class="hljs-string">"port"</span></span>, defaultServerPort, <span class="hljs-string"><span class="hljs-string">"Server port"</span></span>)</code> </pre> <br><p>  Y <a href="">vincule la variable de entorno</a> al valor del par√°metro de comando </p><br><pre> <code class="go hljs">viper.BindPFlag(<span class="hljs-string"><span class="hljs-string">"SERVER_PORT"</span></span>, serverCmd.PersistentFlags().Lookup(<span class="hljs-string"><span class="hljs-string">"port"</span></span>))</code> </pre> <br><p>  De hecho, toda la aplicaci√≥n de este marco es la consola.  El servidor web se inicia mediante uno de los comandos de la consola del servidor. </p><br><pre> <code class="bash hljs">gin -i run server</code> </pre> <br><h2 id="logirovanie">  Registro </h2><br><p>  Eleg√≠ el paquete <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">logrus</a> para el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">registro</a> , ya que hay todo lo que generalmente necesito: establecer niveles de registro, d√≥nde registrar, agregar ganchos, por ejemplo, para enviar registros al sistema de alerta. </p><br><h2 id="integraciya-loggera-s-sistemoy-alertinga">  Integraci√≥n de registrador con sistema de alerta </h2><br><p>  Eleg√≠ Sentry, porque todo result√≥ ser bastante simple gracias a la f√°cil integraci√≥n con logrus: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">logrus_sentry</a> .  Hice los <a href="">par√°metros</a> con la url a Sentry <code>SENTRY_DSN</code> y el tiempo de espera para enviar a Sentry <code>SENTRY_TIMEOUT</code> .  Result√≥ que, por defecto, el tiempo de espera es peque√±o, si no es err√≥neo, 300 ms, y muchos mensajes no se entregaron. </p><br><h2 id="nastroyka-alertinga-dlya-oshibok">  Establecer alerta de errores </h2><br><p>  Realic√© el procesamiento de p√°nico por separado para el <a href="">servidor web</a> y los <a href="">comandos de la consola</a> . </p><br><h2 id="yunit-testy-s-pereopredeleniem-servisov-cherez-di">  Pruebas unitarias con redefinici√≥n de servicios a trav√©s de DI </h2><br><p>  Como se se√±al√≥ anteriormente, se tuvo que asignar un paquete separado para las pruebas unitarias.  Como la biblioteca seleccionada para crear un contenedor de servicios no permit√≠a redefinir servicios, en fork se agreg√≥ un m√©todo para redefinir la descripci√≥n de los servicios.  Debido a esto, en la prueba unitaria, puede <a href="">usar</a> la misma descripci√≥n de servicios que en la aplicaci√≥n </p><br><pre> <code class="go hljs">dic.InitBuilder()</code> </pre> <br><p>  Y <a href="">redefina</a> solo algunas descripciones de servicio en trozos de esta manera </p><br><pre> <code class="go hljs">dic.Builder.Set(di.Def{ Name: dic.UserRepository, Build: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctn di.Container)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">interface</span></span></span></span><span class="hljs-function"><span class="hljs-params">{}, error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NewUserRepositoryMock(), <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }, })</code> </pre> <br><p>  A continuaci√≥n, puede <a href="">crear un contenedor</a> y utilizar los servicios necesarios en la prueba: </p><br><pre> <code class="go hljs">dic.Container = dic.Builder.Build() userService := dic.Container.Get(dic.UserService).(service.UserServiceInterface)</code> </pre> <br><p>  Por lo tanto, probaremos userService, que en lugar del repositorio real usar√° el c√≥digo auxiliar proporcionado. </p><br><p>  Mapa de c√≥digos de cobertura de porcentaje y prueba <br>  Estaba completamente satisfecho con la utilidad de prueba est√°ndar. </p><br><p>  Puedes ejecutar pruebas individualmente </p><br><pre> <code class="bash hljs">go <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/unit/user_service_test.go -v</code> </pre> <br><p>  Puedes ejecutar todas las pruebas a la vez </p><br><pre> <code class="bash hljs">go <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> ./... -v</code> </pre> <br><p>  Puede crear un mapa de cobertura y calcular el porcentaje de cobertura. </p><br><pre> <code class="bash hljs">go <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> ./... -v -coverpkg=./... -coverprofile=coverage.out</code> </pre> <br><p>  Y vea un mapa de cobertura de c√≥digo con pruebas en un navegador </p><br><pre> <code class="bash hljs">go tool cover -html=coverage.out</code> </pre> <br><h2 id="swagger">  Swagger </h2><br><p>  Hay un proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gin-swagger</a> para Gin, que se puede utilizar tanto para generar especificaciones para Swagger como para generar documentaci√≥n basada en √©l.  Pero, como result√≥, para generar especificaciones para operaciones espec√≠ficas, es necesario indicar comentarios sobre funciones espec√≠ficas del controlador.  Esto result√≥ no ser muy conveniente para m√≠, ya que no quer√≠a duplicar el c√≥digo de operaciones CRUD en cada controlador.  En cambio, en controladores espec√≠ficos, simplemente inserto un controlador CRUD como se describe anteriormente.  Realmente tampoco quer√≠a crear funciones de c√≥digo auxiliar para esto. </p><br><p>  Por lo tanto, llegu√© a la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conclusi√≥n de</a> que la especificaci√≥n se genera utilizando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">goswagger</a> , porque en este caso las operaciones <a href="">pueden describirse sin estar vinculadas a funciones espec√≠ficas</a> . </p><br><pre> <code class="bash hljs">swagger generate spec -o doc/swagger.yml</code> </pre> <br><p>  Por cierto, con goswagger incluso podr√≠a pasar de lo contrario y generar el c√≥digo del servidor web basado en la especificaci√≥n Swagger.  Pero con este enfoque, hubo dificultades con el uso de ORM, y finalmente lo abandon√©. </p><br><p>  La documentaci√≥n se genera utilizando gin-swagger, para esto se <a href="">indica</a> un archivo de especificaci√≥n pregenerado. </p><br><h2 id="docker-compose">  Docker componer </h2><br><p>  En el marco, agregu√© una descripci√≥n de dos contenedores: <a href="">para el c√≥digo y para la base</a> .  Al comienzo del contenedor con el c√≥digo, esperamos hasta que el contenedor con la base se inicie por completo.  Y en cada inicio, hacemos migraciones si es necesario.  Los par√°metros para conectarse a la base de datos para migraciones se describen, como se mencion√≥ anteriormente, en <a href="">dbconf.yml</a> , donde fue posible usar la <a href="">variable de entorno</a> para transferir la configuraci√≥n para conectarse a la base de datos. </p><br><p>  Gracias por su atencion  En el proceso, tuve que adaptarme a las caracter√≠sticas del lenguaje.  Me interesar√≠a saber la opini√≥n de colegas que pasaron m√°s tiempo con Go.  Seguramente algunos momentos podr√≠an hacerse m√°s elegantes, por lo que estar√© encantado de recibir cr√≠ticas √∫tiles.  Enlace al marco: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/zubroide/go-api-boilerplate</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/455302/">https://habr.com/ru/post/455302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455286/index.html">Dientes de sabidur√≠a: no se pueden quitar</a></li>
<li><a href="../455288/index.html">Noticias de la semana: bloqueador de anuncios corporativos en las claves de cifrado de Chrome, FSB y Yandex, la comunicaci√≥n se est√° volviendo m√°s costosa</a></li>
<li><a href="../455290/index.html">La gu√≠a completa de Prometeo en 2019</a></li>
<li><a href="../455292/index.html">C√≥mo aumentar 4 veces el tiempo de ejecuci√≥n de los dispositivos con autoalimentaci√≥n</a></li>
<li><a href="../455294/index.html">Gu√≠a: c√≥mo elegir una bicicleta el√©ctrica usando Twitter como ejemplo - hablando de cuadros</a></li>
<li><a href="../455306/index.html">Respuestas a sus preguntas sobre por qu√© necesita un editor para publicar un libro</a></li>
<li><a href="../455308/index.html">Lugar prometedor</a></li>
<li><a href="../455310/index.html">Ataques en canales de derivaci√≥n: ahora no solo las PC, sino tambi√©n los tel√©fonos inteligentes est√°n bajo ataque (revisi√≥n anal√≠tica)</a></li>
<li><a href="../455312/index.html">Sumador completo de un bit en chips inusuales</a></li>
<li><a href="../455314/index.html">¬øQu√© es una red de servicios?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>