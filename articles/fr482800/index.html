<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👰🏾 🎣 🍷 Mes recherches pour le panneau de contrôle physique d'une maison intelligente 👨🏿‍🤝‍👨🏽 ⏳ 🎙️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a très longtemps, j'ai eu l'idée d'installer un panneau de contrôle, situé à côté de la porte d'entrée à l'intérieur de l'appartement / maison. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mes recherches pour le panneau de contrôle physique d'une maison intelligente</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482800/"><p>  Il y a très longtemps, j'ai eu l'idée d'installer un panneau de contrôle, situé à côté de la porte d'entrée à l'intérieur de l'appartement / maison. </p><br><p> Il existe plusieurs options pour mettre en œuvre cette idée: </p><br><ul><li>  <abbr title="Contrôleur logique programmable">Écran</abbr> tactile opérateur <abbr title="Contrôleur logique programmable">PLC</abbr> </li><li>  tablette; </li><li>  écran tactile connecté à un micro-ordinateur. </li></ul><br><p><img src="https://habrastorage.org/webt/fl/nj/ad/flnjadfhyyyzg5zt5aesfig8fyg.gif"><br>  Une exigence supplémentaire qui limitait immédiatement le choix de l'appareil: l'image de la caméra externe devrait s'afficher automatiquement sur le panneau de commande lorsque le détecteur de mouvement est déclenché (et uniquement en présence de personnes à domicile). </p><a name="habracut"></a><br><h2 id="1vybor-devaysa">  1. Choix d'un appareil </h2><br><p>  Une fois les exigences clairement formulées, les iPads que je ne savais pas contrôler de l'extérieur ont immédiatement disparu (c'est dommage car ils ont un grand choix de supports muraux) et un appareil <abbr title="Interface homme-machine">IHM</abbr> comme <a href="https://nextion.tech/" rel="nofollow">Nextion</a> , car l'image de la caméra ne peut pas être affichée sur eux. </p><br><p><img src="https://habrastorage.org/webt/n2/xs/od/n2xsodz7s1ciurk5uvqcmuojshq.jpeg"><br>  <em>L'une des options pour l'iPad Wallmount de Loxone</em> </p><br><p>  Et bien que des appareils spécialisés soient apparus sur le marché maintenant, tels que: </p><br><ul><li>  <a href="https://store.google.com/us/product/google_nest_hub%3Fhl%3Den-US" rel="nofollow">Google Nest Hub</a> </li><li>  <a href="https://www.facebook.com/PortalFromFacebook/" rel="nofollow">Portail de Facebook</a> </li><li>  <a href="https://www.amazon.com/Echo-Show-8/dp/B07PF1Y28C" rel="nofollow">Écho d'Amazon</a> </li></ul><br><p>  Cependant, le problème avec le contrôle externe de ces appareils, si je comprends bien, reste également et n'est pas complètement résolu. </p><br><p>  En plus de la partie programme du panneau, une autre partie importante pour moi est l'absence de «ferme collective» lors de la fixation physique de ce panneau au mur, ce qui signifie connecter au moins un câble pour alimenter l'appareil et une boîte de jonction de montage dans le mur d'une taille suffisante, sur le site d'installation de ce panneau, pour caché placement du panneau d'alimentation. </p><br><p><img src="https://habrastorage.org/webt/ti/sp/4n/tisp4n5xa4ac3nu5sgelwf5rz3k.jpeg"><br>  <em>Boîte de montage</em> </p><br><h2 id="2-vliyanie-chyornoy-pyatnicy-na-vybor">  2. L'influence du «Black Friday» sur le choix </h2><br><p>  Quand je me suis de nouveau souvenu de mon idée à la veille du Black Friday 2019, j'ai décidé d'acheter quelque chose de peu coûteux pour les tests.  Je ne voulais pas me soucier de souder et de connecter l'écran tactile au Raspberry Pi, et le choix s'est porté sur la <a href="https://www.amazon.com/gp/product/B07FKR6KXF/" rel="nofollow">tablette Amazon Fire 7</a> pour 29,99 $ (environ 1700 ₽).  J'ai pensé que dans l'atelier de baguette, il serait possible de faire le cadre approprié de la bonne taille pour placer la tablette sur le mur. </p><br><p><img src="https://habrastorage.org/webt/bv/nj/s6/bvnjs6u-n2tqmvuwcra0okxawhg.jpeg"><br>  <em>Team Win Recovery Project (TWRP) sur la tablette Amazon Fire 7</em> </p><br><p>  De plus, en suivant les <a href="https://forum.xda-developers.com/amazon-fire/orig-development/fire-7-2019-mustang-unbrick-downgrade-t3944365" rel="nofollow">instructions</a> trouvées sur la ressource populaire xda-developers.com, j'ai réussi à déverrouiller par programme le chargeur de tablettes Fire 7 et à installer TWRP sans démontage physique. </p><br><p><img src="https://habrastorage.org/webt/b8/ga/pe/b8gape_ziak4jx0ofkqsmini_re.png"><br>  <em>En cours de déverrouillage de Fire 7 (2019, Mustang)</em> </p><br><p>  Je tiens à noter que l'instruction semblait initialement intimidante, mais en conséquence - tout y est décrit de manière assez transparente.  Comme je n'avais initialement pas prévu d'utiliser <a href="https://ru.wikipedia.org/wiki/Fire_OS" rel="nofollow">Fire OS</a> , j'ai installé une <a href="https://ru.wikipedia.org/wiki/LineageOS" rel="nofollow">distribution Android LineageOS</a> propre sans applications supplémentaires et sans services Google, c'est-à-dire sans installer GApps. </p><br><p><img src="https://habrastorage.org/webt/dt/f7/if/dtf7ifsb8hba6uoep5wyvp6cpym.jpeg"><br>  <em>LineageOS sur Amazon Fire 7 Tablet (2019, mustang)</em> </p><br><p>  Je voulais obtenir exactement un appareil propre avec un minimum de programmes qui n'est lié à aucun compte. </p><br><h2 id="3-udalennoe-upravlenie-cherez-adb">  3. Télécommande via ADB </h2><br><p>  Comme j'avais une tablette Android enracinée (avec un accès complet) sur mes mains, il ne devrait y avoir aucun problème avec le choix des programmes. <br>  Cependant, je voulais utiliser certains outils standard et j'ai donc opté pour <abbr title="Pont de débogage Android">ADB</abbr> .  Cela fonctionne sur tous les appareils Android où cette fonctionnalité n'a pas été intentionnellement bloquée par le fabricant - il suffit de cliquer plusieurs fois sur l'élément de menu «Numéro de build» et un nouvel élément de menu «Pour les développeurs» s'ouvrira, où tous les paramètres seront définis. </p><br><p>  Étant donné que je devais lire le flux vidéo à partir de la caméra IP (dans mon cas, <abbr title="Protocole de streaming en temps réel">RTSP</abbr> , j'avais besoin d'un <a href="https://yandex.ru/search/%3Ftext%3Dvlc%2520apk%26lr%3D50" rel="nofollow">lecteur VLC</a> et également de <a href="https://yandex.ru/search/%3Ftext%3Dchrome%2520apk%26lr%3D50" rel="nofollow">Google Chrome</a> pour afficher en plein écran le panneau d'accueil intelligent. Pour effectuer les manipulations nécessaires avec la tablette depuis le terminal de l'ordinateur, exécutez les commandes suivantes. </p><br><p> Installez l'application sur la tablette via la ligne de commande: <br> <code>adb install VLC.apk</code> <br>  Allumez / éteignez la tablette via la ligne de commande: <br> <code>adb shell input keyevent KEYCODE_POWER</code> <br>  Démarrez la diffusion depuis la caméra via la ligne de commande: <br> <code>adb shell am start -a android.intent.action.VIEW -d rtsp://login:pass@192.168.15.21:88/videoMain -t video/mp4</code> <br>  Via la ligne de commande, lancez le panneau de configuration de la maison intelligente dans le navigateur: <br> <code>adb shell am start -a android.intent.action.VIEW -d http://192.168.15.10:8123/lovelace/default_view</code> </p> <br><p>  Pour fonctionner correctement, j'ai défini les paramètres de l'écran étendu - lorsque les panneaux de contrôle sont complètement masqués. </p><br><p><img src="https://habrastorage.org/webt/rc/rb/oc/rcrbocie4yuknkqszuwg_6pahzy.png"><br>  <em>Configurer LineageOS</em> </p><br><p>  Et bien sûr, j'ai désactivé le verrouillage de l'écran - sans cela, il est difficile d'automatiser quelque chose. </p><br><p><img src="https://habrastorage.org/webt/oj/x0/xv/ojx0xval66av7ezk4njg2ngwmba.png"><br>  <em>Configurer LineageOS</em> </p><br><p>  Voici un <a href="https://gist.github.com/mcfrojd/9e6875e1db5c089b1e3ddeb7dba0f304" rel="nofollow">petit hack de vie</a> car vous pouvez trouver une liste de toutes les applications installées et des commandes pour les lancer.  Pour commencer, connectez-vous à la console: <br> <code>adb shell</code> <br>  puis faites: <br> <code>pm list packages | sed -e "s/package://" | while read x; do cmd package resolve-activity --brief $x | tail -n 1 | grep -v "No activity found"; done</code> <br>  Cela listera tous les programmes: </p><br><p><img src="https://habrastorage.org/webt/_l/3z/21/_l3z21t2uwufktefq52xnglcix8.png"><br>  <em>Exécution d'une commande pour afficher tous les programmes sur l'appareil</em> </p><br><p>  Les informations obtenues peuvent être utilisées à votre discrétion et, par exemple, démarrer le chronomètre: <br> <code>adb shell am start -a android.intent.action.VIEW -d -n com.android.deskclock/.DeskClock</code> </p> <br><h2 id="4-home-assistant">  4. Assistant à domicile </h2><br><p>  Tout ce qui précède n'était qu'une préparation pour automatiser l'affichage de la caméra et du panneau de commande du logiciel sur l'écran de la tablette.  J'ai deux options de caméra au-dessus de la porte d'entrée à différents endroits: </p><br><ol><li>  Caméra Hikvision DS-2CD2463G0-IW avec capteur de mouvement intégré. </li><li>  La caméra dôme est associée à un capteur de mouvement à micro-ondes caché au-dessus du plafond suspendu du couloir d'accès et connectée au <a href="https://www.ab-log.ru/smart-house/ethernet/megad-2561" rel="nofollow">contrôleur Ethernet</a> multifonction <a href="https://www.ab-log.ru/smart-house/ethernet/megad-2561" rel="nofollow">MegaD-2561</a> .  Le capteur de mouvement n'est pas visible à l'œil nu, mais il fonctionne.  La caméra est une installation ordinaire et non cachée. </li></ol><br><p>  Vous devez d'abord activer ADB sur le réseau: </p><br><p><img src="https://habrastorage.org/webt/rr/ty/vh/rrtyvhhrwwzteayiwjwqvsuwwes.png"><br>  <em>Configurer LineageOS</em> </p><br><p>  Après cela, la tablette est prête pour la télécommande. </p><br><p>  Depuis que j'utilise <a href="https://www.home-assistant.io/hassio/" rel="nofollow">Hass.io</a> , j'ai utilisé l'add-on <a href="https://github.com/hassio-addons/addon-adb" rel="nofollow">ADB</a> spécial <a href="https://github.com/hassio-addons/addon-adb" rel="nofollow">- Android Debug Bridge</a> , qui vous permet de contrôler tout appareil prenant en charge le contrôle ADB.  Dans la configuration de ce module complémentaire, il a indiqué son seul appareil: </p><br><pre> <code class="plaintext hljs">{ "devices": [ "192.168.15.24" ], "reconnect_timeout": 90 }</code> </pre> <br><p>  Après cela, c'est un peu étrange, mais tous ces appareils sont configurés dans Home Assistant comme <code>androidtv</code> . </p><br><div class="spoiler">  <b class="spoiler_title">configuration.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">media_player: - platform: androidtv name: Amazon Fire 7 host: 192.168.15.24 adb_server_ip: 127.0.0.1</code> </pre> </div></div><br><p>  La dernière étape consiste à enregistrer l'automatisation, qui affiche la caméra sur l'écran de la tablette, puis ferme l'application, puis affiche le panneau de configuration de Home Assistant et la ferme également après un certain temps: </p><br><div class="spoiler">  <b class="spoiler_title">automations.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">################################################### # # #  android  # # # ################################################### - alias: Amazon Fire 7 Mikhail trigger: - platform: state entity_id: binary_sensor.kamera_u_liftov_pir_alarm from: 'off' to: 'on' condition: - condition: state entity_id: device_tracker.7c_xx_5c_b5_xx_1b # state: 'home' action: - service: androidtv.adb_command data: entity_id: media_player.amazon_fire_7 command: input keyevent KEYCODE_POWER - service: androidtv.adb_command data: entity_id: media_player.amazon_fire_7 command: am start -a android.intent.action.VIEW -d rtsp://login:pass@192.168.15.21:88/videoMain -t video/mp4 - delay: '00:00:30' - service: androidtv.adb_command data: entity_id: media_player.amazon_fire_7 command: input keyevent KEYCODE_APP_SWITCH - service: androidtv.adb_command data: entity_id: media_player.amazon_fire_7 command: input keyevent DEL - delay: '00:00:01' - service: androidtv.adb_command data: entity_id: media_player.amazon_fire_7 command: am start -a android.intent.action.VIEW -d http://192.168.15.10:8123/lovelace/default_view - delay: '00:00:10' - service: androidtv.adb_command data: entity_id: media_player.amazon_fire_7 command: input keyevent KEYCODE_APP_SWITCH - service: androidtv.adb_command data: entity_id: media_player.amazon_fire_7 command: input keyevent DEL - delay: '00:00:01' - service: androidtv.adb_command data: entity_id: media_player.amazon_fire_7 command: HOME</code> </pre> </div></div><br><p>  Le résultat qui en résulte n'est pas encore à la porte, mais sur le lieu de travail: </p><br><p><img src="https://habrastorage.org/webt/jt/jk/32/jtjk32ag1ty-nawvtkwzeylkxuc.jpeg"><br>  <em>Vue arriere</em> </p><br><p>  J'ai également supprimé le panneau en action, mais je ne pouvais pas comprendre comment couvrir toutes les données personnelles sur la vidéo, et il y en a eu beaucoup, donc je n'apporte que la vue arrière :) </p><br><h2 id="itog">  Résumé </h2><br><p>  Il a été possible de créer un panneau de commande physique avec les caractéristiques spécifiées.  Des principaux coûts - seulement une tablette peu coûteuse.  Il reste à résoudre le problème avec une installation de qualité sur le lieu d'utilisation, mais c'est déjà un sujet plus constructif. </p><br><p>  Publié par: <a href="https://www.facebook.com/mikhail.shardin" rel="nofollow">Mikhail Shardin</a> , <br>  4 janvier 2020 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482800/">https://habr.com/ru/post/fr482800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482786/index.html">Énigme non résolue</a></li>
<li><a href="../fr482788/index.html">Contenu du TPU Google Coral Edge: tests de vitesse et d'analyse de l'appareil</a></li>
<li><a href="../fr482790/index.html">Oubliez le cryptage homomorphique: nous avons maintenant un cryptage fonctionnel</a></li>
<li><a href="../fr482794/index.html">Réseaux de neurones. Où est-ce que tout va</a></li>
<li><a href="../fr482798/index.html">Voir la forêt derrière les arbres</a></li>
<li><a href="../fr482802/index.html">Inclusion à distance des scripts Mikrotik de Telegram v 2.0</a></li>
<li><a href="../fr482804/index.html">Java: réduire les journaux multilignes en un journal unifilaire à l'aide de Spring and Logback ou Log4j2</a></li>
<li><a href="../fr482806/index.html">La propagande du régime totalitaire, l'antisémitisme et l'homophobie dans le manuel de programmation 2019? - c'est possible</a></li>
<li><a href="../fr482810/index.html">Pouvez-vous faire confiance aux conseils médicaux des robots? Les médecins ne sont pas encore sûrs.</a></li>
<li><a href="../fr482812/index.html">Les mathématiciens ont réalisé une percée dans l'étude du problème «dangereux»</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>