<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â™¨ï¸ ğŸ›¤ï¸ ğŸ›ï¸ MOXA Nport - Tampilan Dalam ğŸ‡ğŸ¼ ğŸ‘©ğŸ»â€ğŸ’» ğŸš¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Server pengumpulan data port serial MOXA Nport dan sejenisnya saat ini merupakan standar de facto di bidang sistem bangunan yang mentransmisikan atau ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MOXA Nport - Tampilan Dalam</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478642/">  Server pengumpulan data port serial MOXA Nport dan sejenisnya saat ini merupakan standar de facto di bidang sistem bangunan yang mentransmisikan atau menerima data melalui antarmuka RS-232, RS-485 dan RS-422. <br><br>  Meteran listrik, katup yang dikendalikan dan katup gerbang, meter aliran, sensor getaran, perangkat telemekanik. <br><br>  Segala sesuatu yang dapat menghasilkan data atau dikendalikan dari jarak jauh dan memiliki antarmuka RS-232, RS-485 dan RS-422 - bekerja melalui konverter ini. <br><br>  Tujuan umum penggunaannya biasanya sebagai berikut: meneruskan antarmuka RS-232, RS-485 dan RS-422 melalui jaringan lokal yang ada, menghubungkan perangkat atau perangkat yang memiliki salah satu antarmuka serial ke PC (server, SCADA) melalui Ethernet, sambungkan ke perangkat memiliki antarmuka serial melalui Internet untuk kendali jarak jauh, dll. <br><br>  Harga untuk konverter ini tidak terlalu tinggi, model yang lebih muda dapat dipinjam seharga $ 100-200.  Tetapi mengingat bahwa dalam produksi otomatis perangkat semacam itu, ratusan atau bahkan ribuan dapat diinstal - sebuah berita gembira yang cukup muncul untuk "pengganti impor" domestik. <br><br>  Saya akan mencoba membantu mereka hari ini. <br><br>  Apa yang akan kita lakukan <br><br>  Pertama, kita akan memahami teori bagaimana itu diatur di dalam. <br><br>  Kedua, kami mengisolasi fungsionalitas minimum untuk mulai bekerja dalam Real Com Mode (yaitu, pada kenyataannya, untuk meneruskan port COM virtual ke perangkat melalui Ethernet). <br><br>  Ketiga, demi kepentingan, kami akan menganalisis protokol untuk mencari dan mengkonfigurasi perangkat melalui utilitas NPort Administration Suite.  Kami akan mendapatkan pemahaman lengkap tentang cara membuat analog pin-to-pin dari sepotong besi yang dapat macet di tempat MOXA Nport yang ada, sambil menerima dukungan penuh dari perangkat lunak dan driver asli. <br><br>  Dan akhirnya, mari kita coba menghitung berapa banyak orang India yang menulis kode firmware MOXA. <br><a name="habracut"></a><br><h4>  Bagian 1. Pendahuluan </h4><br>  Jadi, kami memiliki subjek uji di meja kami (sebenarnya ada beberapa dari mereka, jadi jangan heran jika Anda melihat pengidentifikasi model dan alamat MAC yang berbeda dalam artikel) <br><br><img src="https://habrastorage.org/webt/zs/bu/co/zsbucoqb74oopd5ld_vkqkqipfc.jpeg"><br><br>  Ini memiliki port Ethernet dan dua port RS-422 / RS-485 - ini secara fisik. <br>  Dan dalam rencana program - pada perangkat terbuka: <br>  Port UDP 4800 - bertanggung jawab untuk menangkap paket pencarian perangkat dan mengirimkan data tentang perangkat itu sendiri ke utilitas konfigurasi. <br><br>  TCP port 4900 - menerima perintah konfigurasi perangkat.  Waktu, nama, alamat IP, mode operasi, pengaturan port dan kecepatan perangkat, dan parameter dasar lainnya dapat dikonfigurasi melalui port ini, yang dapat dikonfigurasi melalui antarmuka utama utilitas NPort Administration Suite: <br><br><img src="https://habrastorage.org/webt/mh/me/79/mhme79fontjiywnsdxgq_wk2sau.png"><br><br>  TCP port 80 - bertanggung jawab atas pengoperasian antarmuka WEB <br>  Port TCP 966, 967, (dan 968, 969 untuk 4 perangkat port) adalah port kontrol transmisi.  Mereka menjalankan perintah untuk membuka / menutup port COM yang sesuai, mengatur kecepatan port, mendorong data, memantau pemenuhan buffer pengiriman / penerimaan, dll.  Port 966 masing-masing bertanggung jawab untuk pengoperasian port pertama. <br><br>  Port TCP (default) 950, 951, (dan 952, 953 untuk 4 perangkat port) adalah port untuk transfer data langsung.  Artinya, apa yang seharusnya langsung muncul pada port RS-232/485/422 perangkat ditransmisikan ke port data.  Hanya kontrol aliran data di port ini yang masing-masing menuju 966, 967, 968, 969. <br><br>  Saya harap gambaran umum tentang memahami operasi perangkat di kepala saya telah berkembang.  Mari kita beralih ke bagian selanjutnya: <br><br><h4>  Bagian 2. Emulasi MOXA </h4><br>  Tentunya sudah menjadi jelas bagi banyak orang bahwa untuk berpura-pura menjadi MOXA Nport dalam konfigurasi minimum, perlu untuk meningkatkan server TCP pada perangkat kerasnya sendiri pada 2 port: 966 untuk kontrol transmisi dan 950 untuk transmisi data langsung.  Secara alami, Anda harus menjawab dan memproses permintaan driver dengan benar di port 966, tetapi seperti yang ditunjukkan oleh analisis wireshark, tidak ada begitu banyak permintaan dan itu adalah yang paling sederhana. <br><br>  Agar tidak membebani teks artikel dengan perhitungan yang menggambarkan permintaan dan jawaban, saya menyiapkan dan memposting secara terpisah dalam bentuk file pdf, deskripsi semua permintaan yang diuraikan, jawaban, dan parameter yang dikirimkan. <br><br>  <a href="http://multimake.ru/wp-content/uploads/2019/12/%25D0%259E%25D0%25BF%25D0%25B8%25D1%2581%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5-%25D1%2580%25D0%25B0%25D0%25B7%25D0%25B1%25D0%25BE%25D1%2580%25D0%25B0-%25D0%25BF%25D1%2580%25D0%25BE%25D1%2582%25D0%25BE%25D0%25BA%25D0%25BE%25D0%25BB%25D0%25B0-MOXA.pdf">Unduh: Deskripsi protokol parsing MOXA.pdf</a> <br>  Yaitu, kumpulan pengetahuan ini memungkinkan Anda untuk mengimplementasikan perangkat yang dapat dipasangkan dengan driver asli dan mengirimkan data sebagai MOXA.  Setengah dari pekerjaan sudah selesai, tetapi ada satu titik - bagaimana mengubah konfigurasi?  Akan lebih bagus untuk menggunakan utilitas NPort Administration Suite asli untuk tujuan ini. <br><br><h4>  Bagian 3. Cari dan temukan </h4><br>  Dua bagian pertama menggambarkan apa yang perlu dilakukan, tetapi tidak ada kata tentang bagaimana mendapatkan data untuk implementasi protokol. <br><br>  Pada bagian ini, kami menggali sedikit lebih dalam dan melihat bagaimana analisis pertukaran itu sendiri dilakukan. <br>  Kita tahu bahwa port UDP 4800 terbuka pada perangkat, mari kita hubungkan perangkat, jalankan NPort Administration Suite, Wireshark dan lihat apa yang terjadi ketika mencari perangkat dengan utilitas asli. <br><br><img src="https://habrastorage.org/webt/fk/b8/om/fkb8om_d1ieh_2wipyvvglmwzn8.png"><br><br>  Kami melihat paket yang dikirim: <br><br><img src="https://habrastorage.org/webt/av/j7/pg/avj7pgj8udm7ujvvnbs-26eip4i.png"><br><br>  Kami melihat bahwa NPort Administration Suite mengirim Siaran ke alamat 255.255.255.255, yaitu, ia berharap bahwa paket tersebut akan terbang melintasi jaringan. <br><br>  Paket payload berisi data: <br><br><pre><code class="plaintext hljs">01 00 00 08 00 00 00 00, : 01 00 â€“   00 08 â€“       Big Endian. 00 00 00 00 â€“  </code> </pre> <br>  Permintaan ini dikirim beberapa kali, tampaknya dengan harapan bahwa setidaknya satu dari mereka akan mencapai tujuan. <br><br>  Semua MOX menanggapi permintaan ini. <br><br><img src="https://habrastorage.org/webt/v7/u3/zn/v7u3zn6pil6rw8ijo1mad4caea4.png"><br><br>  Secara khusus, kami menjawab: <br><br><pre> <code class="plaintext hljs"> 81 00 00 18 00 00 00 00 12 03 00 80 32 03 00 90 e8 26 4a ab c0 a8 7f fe 81 00 â€“   00 18 â€“     (24) 00 00 00 00 â€“   12 03 00 80 32 03 â€“  MOXA Nport device,    NPort 5232.        MOXA Nport device.          NPort Administrator. 00 90 e8 26 4a ab â€“ MAC  MOXA Nport device c0 a8 7f fe â€“ IP  MOXA Nport device ( 192.168.127.254 )</code> </pre> <br>  Tampaknya semuanya sederhana, hanya membingungkan nilai 12 03 00 80 32 03, yang bertanggung jawab untuk interpretasi model perangkat tertentu. <br><br>  Tetapi, karena nilai ini diperiksa terhadap beberapa referensi referensi, itu berarti harus disimpan di suatu tempat. <br><br>  Setelah mempelajari direktori perangkat lunak sedikit, kami menemukan bahwa dalam NPort Administrator Suite v1.22 nilai-nilai ini disimpan dalam file C: \ Program Files \ NPortAdminSuite \ bin \ dsci.dll <br><br><img src="https://habrastorage.org/webt/fs/sf/8k/fssf8kgx4iaz45n0fzucjonzkla.png"><br><br>  Setelah duduk dengan Wireshark dan perangkat selama beberapa hari, kami mendapatkan log pertukaran yang lengkap dan pemahaman tentang kode fungsi apa yang mendapat respons.  Untuk kenyamanan, semua yang ditemukan dijelaskan dalam file pdf yang sama, tautan yang ditunjukkan dalam artikel sebelumnya. <br><br>  Untuk pemahaman yang lebih baik tentang gambar - Saya hanya akan mengingatkan Anda bahwa UDP 4800 menerima informasi utama tentang perangkat, semua parameter yang memerlukan konfigurasi dan pemasangan dikonfigurasikan melalui permintaan untuk port TCP 4900. <br><br>  Setelah memproses dengan benar semua permintaan yang masuk untuk port 4800 dan 4900, kita dapat sepenuhnya berpura-pura menjadi sebuah perangkat, sehingga bahkan perangkat lunak asli tidak akan melihat adanya masalah. <br><br><h4>  Bagian 4. Menghitung Orang India * </h4><br>  Dalam menganalisis protokol, saya merasa bahwa berbagai bagian protokol pertukaran ditulis oleh orang yang berbeda, makna fungsi dan interpretasinya terlalu berbeda. <br><br>  Jadi misalnya: <br><br>  Port UDP 4800 kode fungsi dimulai dengan: <br><br><pre> <code class="plaintext hljs"> 01 00 .. ..  81 00 .. ..  10 00 .. ..  90 00 .. ..  16 00 .. ..  96 00 .. ..  29 00 .. ..  a9 00 .. ..</code> </pre> <br>  Kode fungsi port TCP 4900 dimulai dengan: <br><br><pre> <code class="plaintext hljs"> 00 01 .. ..  00 01 .. ..  02 01 .. ..  02 01 .. ..</code> </pre> <br>  dan sebagainya <br><br>  Port TCP 966, 967, 968, 969 kode fungsi dimulai dengan: <br><br><pre> <code class="plaintext hljs"> 10 .. ..  10 4f 4b  11 .. ..  11 4f 4b</code> </pre> <br>  dan sebagainya <br><br>  Yaitu, pengidentifikasi byte tunggal dari fungsi yang digunakan, dan bukan byte ganda seperti sebelumnya. <br>  Kemudian, omong-omong, momen lucu keluar.  Pada port 966, 967, 968, 969, respons terhadap pengaturan parameter selalu terdiri dari 3 byte. <br><br>  Yang pertama adalah nomor fungsi, dan sisanya 2 adalah 4f 4b atau apakah ada tampilan dalam tabel ASCII - "O" "K" <br><br>  Baiklah OK dengan dia, silakan. <br><br>  Fitur kedua yang terlihat adalah hash Big dan Little Endian dalam respons yang sama. <br><br>  Contoh jawaban: <br><br><pre> <code class="plaintext hljs">9a 00 00 24 00 00 00 00 01 52 00 80 9a 52 00 90 e8 3b 89 9c 75 00 04 00 01 00 0f 00 09 00 17 00 36 00 00 00 9a 00 â€“   00 24 â€“     (36) 00 00 00 00 â€“   01 52 00 80 9a 52 â€“  MOXA Nport device 00 90 e8 3b 89 9c - MAC  MOXA Nport device 75 00 - : 1900 +   (1900 + 117 = 2017) 04 00 - :     1 -     01 00 â€“   0f 00 â€“  (15) 09 00 â€“  (9) 17 00 â€“  (23) 36 00 â€“  (36) 00 00 â€“  </code> </pre> <br>  Ukuran paket dikodekan dalam satu cara, dan semua nilai numerik (tahun, bulan, hari ...) di jalan lain.  Dari sini kita dapat menyimpulkan bahwa pemrosesan bagian pengguna mulai dari 75 00 04 00 ....... ditulis oleh programmer lain. <br><br>  Untuk meringkas: Setidaknya 3 orang berbeda menulis protokol pertukaran, 1 menulis pemrosesan bagian pengguna data, dan setidaknya 1 menulis antarmuka penangan WEB.  Menurut perhitungan saya, sekitar 5 programmer mengerjakan proyek. <br>  Berapa yang Anda hitung? <br><br>  * Dalam hal ini, istilah "Hindu" berarti seorang karyawan yang memenuhi tugasnya untuk makanan dan hipotek, yang mampu membuat kode dari sini dan sebelum makan siang tanpa benar-benar mempelajari rencana global perusahaan pemberi kerja. <br><br>  PS Artikel ini ditulis di atas bahan-bahan yang sedang dikembangkan pada tahun 2017, sehingga banyak data yang mengandung penanggalan tepat tahun ini.  Protokol diperiksa dalam kerangka kerja draft, tetapi karena pikiran menang atas pemasaran dan masalah tersebut tidak melampaui tahap prototipe kerja tunggal.  Saya menerbitkan semua perkembangan pada proyek ini dalam domain publik, karena saya percaya bahwa informasi ini akan bermanfaat bagi komunitas pengembang. <br><br>  Artikel asli PPS seperti biasa di <a href="http://multimake.ru/moxa-nport-%25D0%25B2%25D0%25B7%25D0%25B3%25D0%25BB%25D1%258F%25D0%25B4-%25D0%25B8%25D0%25B7%25D0%25BD%25D1%2583%25D1%2582%25D1%2580%25D0%25B8/">blog pribadi</a> saya </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id478642/">https://habr.com/ru/post/id478642/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id478630/index.html">Pascal memainkan Go. Implementasi metode dan antarmuka dalam kompiler amatir</a></li>
<li><a href="../id478634/index.html">Perangkap dalam Manajemen Proyek Pembelajaran Mesin</a></li>
<li><a href="../id478636/index.html">Cara kerja penyandian teks. Dari mana "buaya" berasal. Prinsip-prinsip pengkodean. Generalisasi dan analisis terperinci</a></li>
<li><a href="../id478638/index.html">db-tree: cari dan navigasikan basis data</a></li>
<li><a href="../id478640/index.html">Mobil otonom pada sumber terbuka</a></li>
<li><a href="../id478646/index.html">JetQuad: Pesawat Jet dengan Lepas Landas dan Pendaratan Vertikal</a></li>
<li><a href="../id478650/index.html">Dawn 3D</a></li>
<li><a href="../id478652/index.html">Struktur paket DNS</a></li>
<li><a href="../id478654/index.html">Perkiraan penghitungan distribusi - paling sering penyortiran ulang</a></li>
<li><a href="../id478658/index.html">Bagaimana cara bangun? Alarm Cahaya Fajar Baru Plus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>