<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüíª üíõ üë©üèæ‚Äçüé§ Revolution oder Schmerz? Yandex React Hooks-Bericht ‚è∏Ô∏è ü§æüèø üë®‚Äçüë®‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mein Name ist Artyom Berezin, ich bin Entwickler mehrerer interner Yandex-Dienste. In den letzten sechs Monaten habe ich aktiv mit React Hooks gearbei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Revolution oder Schmerz? Yandex React Hooks-Bericht</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/464071/"> Mein Name ist Artyom Berezin, ich bin Entwickler mehrerer interner Yandex-Dienste.  In den letzten sechs Monaten habe ich aktiv mit React Hooks gearbeitet.  Dabei gab es einige Schwierigkeiten, die bek√§mpft werden mussten.  Jetzt m√∂chte ich diese Erfahrung mit Ihnen teilen.  In dem Bericht habe ich die React Hook-API aus praktischer Sicht untersucht. Warum brauchen wir Hooks? Lohnt es sich zu wechseln, was beim Portieren besser zu ber√ºcksichtigen ist?  Es ist leicht, w√§hrend des √úbergangs Fehler zu machen, aber es ist auch nicht so schwierig, sie zu vermeiden. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/xm/xa/7n/xmxa7ngpjx3l902ndjcetpyhsp0.jpeg"></a> <br><br>  - Hooks sind nur eine weitere M√∂glichkeit, die Logik Ihrer Komponenten zu beschreiben.  Sie k√∂nnen den Funktionskomponenten einige Funktionen hinzuf√ºgen, die bisher nur Komponenten in Klassen eigen waren. <br><br><a name="habracut"></a><img src="https://habrastorage.org/webt/hd/r8/4b/hdr84b-fmfibqz-gwcb0k8feny8.jpeg"><br><br>  Zuallererst ist es Unterst√ºtzung f√ºr den internen Zustand, dann - Unterst√ºtzung f√ºr Nebenwirkungen.  Zum Beispiel - Netzwerkanforderungen oder Anforderungen an WebSocket: Abonnement, Abmeldung von einigen Kan√§len.  Oder wir sprechen √ºber Anfragen an andere asynchrone oder synchrone Browser-APIs.  Au√üerdem geben uns Haken Zugang zum Lebenszyklus der Komponente, zu ihrem Beginn des Lebens, dh zur Montage, zur Aktualisierung ihrer Requisiten und zu ihrem Tod. <br><br><img src="https://habrastorage.org/webt/9d/f4/lk/9df4lk5afueo28ftgmebxggxuw0.jpeg"><br><br>  Wahrscheinlich der einfachste Weg, um im Vergleich zu veranschaulichen.  Hier ist der einfachste Code, der nur mit einer Komponente in Klassen vorhanden sein kann.  Die Komponente ver√§ndert etwas.  Dies ist ein regul√§rer Z√§hler, der erh√∂ht oder verringert werden kann, nur ein Feld im Status.  Im Allgemeinen denke ich, dass der Code f√ºr Sie v√∂llig offensichtlich ist, wenn Sie mit React vertraut sind. <br><br><img src="https://habrastorage.org/webt/iy/ms/2_/iyms2_hexuxc_nx5cnxwux8crva.jpeg"><br><br>  Eine √§hnliche Komponente, die genau dieselbe Funktion ausf√ºhrt, jedoch in Hooks geschrieben ist, sieht viel kompakter aus.  Nach meinen Berechnungen nimmt der Code beim Portieren von Komponenten in Klassen zu Komponenten in Hooks im Durchschnitt etwa anderthalb Mal ab, und es gef√§llt ihm. <br><br>  Ein paar Worte dar√ºber, wie Haken funktionieren.  Ein Hook ist eine globale Funktion, die in React deklariert und jedes Mal aufgerufen wird, wenn eine Komponente gerendert wird.  React verfolgt die Aufrufe dieser Funktionen und kann deren Verhalten √§ndern oder entscheiden, was zur√ºckgegeben werden soll. <br><br><img src="https://habrastorage.org/webt/yy/wy/xf/yywyxfylah95eiqs8saijtqbf-a.jpeg"><br><br>  Es gibt einige Einschr√§nkungen bei der Verwendung von Hooks, die sie von normalen Funktionen unterscheiden.  Erstens k√∂nnen sie nicht in Komponenten f√ºr Klassen verwendet werden. Eine solche Einschr√§nkung gilt nur, weil sie nicht f√ºr sie erstellt wurden, sondern f√ºr funktionale Komponenten.  Hooks k√∂nnen nicht innerhalb interner Funktionen, innerhalb von Schleifen, Bedingungen aufgerufen werden.  Nur auf der ersten Ebene der Verschachtelung innerhalb der Komponentenfunktionen.  Diese Einschr√§nkung wird von React selbst auferlegt, um verfolgen zu k√∂nnen, welche Hooks aufgerufen wurden.  Und er stapelt sie in einer bestimmten Reihenfolge in seinem Gehirn.  Wenn sich diese Reihenfolge pl√∂tzlich √§ndert oder einige verschwinden, sind komplexe, schwer fassbare und schwer zu debuggende Fehler m√∂glich. <br><br>  Wenn Sie jedoch eine recht komplizierte Logik haben und beispielsweise Hooks in Hooks verwenden m√∂chten, ist dies h√∂chstwahrscheinlich ein Zeichen daf√ºr, dass Sie einen Hook erstellen sollten.  Angenommen, Sie stellen mehrere Haken her, die in einem separaten benutzerdefinierten Haken miteinander verbunden sind.  Und darin k√∂nnen Sie andere benutzerdefinierte Hooks verwenden, wodurch eine Hierarchie von Hooks erstellt wird, die die allgemeine Logik dort hervorhebt. <br><br><img src="https://habrastorage.org/webt/wr/av/h_/wravh_lbocryqocrjlnwqs8rrr4.jpeg"><br><br>  Haken bieten einige Vorteile gegen√ºber Klassen.  Zun√§chst k√∂nnen Sie, wie im vorherigen Abschnitt beschrieben, mit benutzerdefinierten Hooks die Logik viel einfacher fummeln.  Zuvor haben wir unter Verwendung des Ansatzes mit Komponenten h√∂herer Ordnung eine Art gemeinsame Logik entworfen, die die Komponente umh√ºllte.  Jetzt setzen wir diese Logik in Haken.  Dadurch wird der Komponentenbaum reduziert: Seine Verschachtelung wird reduziert, und es wird f√ºr React einfacher, Komponenten√§nderungen zu verfolgen, den Baum neu zu berechnen, das virtuelle DOM neu zu berechnen usw. Dies l√∂st das Problem der sogenannten Wrapper-H√∂lle.  Ich denke, diejenigen, die mit Redux arbeiten, sind damit vertraut. <br><br>  Mit Hooks geschriebener Code l√§sst sich mit modernen Minimierern wie Terser oder altem UglifyJS viel einfacher minimieren.  Tatsache ist, dass wir die Namen von Methoden nicht speichern m√ºssen, wir m√ºssen nicht √ºber Prototypen nachdenken.  Wenn das Ziel nach der Transpilation ES3 oder ES5 ist, erhalten wir normalerweise eine Reihe von Prototypen, die gepatcht werden.  Hier muss dies alles nicht getan werden, daher ist es einfacher zu minimieren.  Und da wir keine Klassen verwenden, m√ºssen wir nicht dar√ºber nachdenken.  F√ºr Anf√§nger ist dies oft ein gro√ües Problem und wahrscheinlich einer der Hauptgr√ºnde f√ºr Fehler: Wir vergessen, dass dies ein Fenster sein kann, dass wir eine Methode binden m√ºssen, zum Beispiel im Konstruktor oder auf andere Weise. <br><br>  Durch die Verwendung von Hooks k√∂nnen Sie auch die Logik hervorheben, die einen Nebeneffekt steuert.  Bisher musste diese Logik, insbesondere wenn wir mehrere Nebenwirkungen f√ºr eine Komponente haben, in verschiedene Methoden des Lebenszyklus der Komponente unterteilt werden.  Und seit dem Erscheinen von Minimierungs-Hooks, React.memo, eignen sich nun funktionale Komponenten zum Auswendiglernen, dh diese Komponente wird bei uns nicht neu erstellt oder aktualisiert, wenn sich ihre Requisiten nicht ge√§ndert haben.  Dies war vorher nicht m√∂glich, jetzt ist es m√∂glich.  Alle Funktionskomponenten k√∂nnen in Memos verpackt werden.  Au√üerdem wurde der useMemo-Hook angezeigt, mit dem wir einige schwere Werte berechnen oder einige Dienstprogrammklassen nur einmal instanziieren k√∂nnen. <br><br>  Der Bericht wird unvollst√§ndig sein, wenn ich nicht √ºber einige grundlegende Haken spreche.  Zuallererst sind dies State-Management-Hooks. <br><br><img src="https://habrastorage.org/webt/ud/wg/vl/udwgvlovxonthzvnknxeewerxea.jpeg"><br><br>  Zun√§chst einmal - useState. <br><br><img src="https://habrastorage.org/webt/0c/xb/pk/0cxbpky3iayxkvaxutbik_ohbcw.jpeg"><br><br>  Ein Beispiel √§hnelt dem am Anfang des Berichts.  useState ist eine Funktion, die einen Anfangswert annimmt und ein Tupel aus dem aktuellen Wert und der Funktion zum √Ñndern dieses Werts zur√ºckgibt.  Alle Magie wird von React intern serviert.  Wir k√∂nnen diesen Wert einfach entweder lesen oder √§ndern. <br><br>  Im Gegensatz zu Klassen k√∂nnen wir so viele Statusobjekte verwenden, wie wir ben√∂tigen. Der Status wird in logische Teile zerlegt, um sie nicht wie in Klassen in einem Objekt zu mischen.  Und diese Teile werden vollst√§ndig voneinander isoliert: Sie k√∂nnen unabh√§ngig voneinander ge√§ndert werden.  Das Ergebnis dieses Codes: Wir √§ndern zwei Variablen, berechnen das Ergebnis und zeigen Schaltfl√§chen an, mit denen wir die erste Variable hier und da und die zweite Variable hier und da √§ndern k√∂nnen.  Denken Sie an dieses Beispiel, denn sp√§ter werden wir etwas √Ñhnliches tun, aber viel komplizierter. <br><br><img src="https://habrastorage.org/webt/qh/cb/7r/qhcb7rezzu2hu5ymyqw8nw1bl9e.jpeg"><br><br>  Es gibt einen solchen useState f√ºr Steroide f√ºr Redux-Liebhaber.  Sie k√∂nnen den Status mithilfe eines Reduzierers konsistenter √§ndern.  Ich denke, dass diejenigen, die mit Redux vertraut sind, nicht einmal erkl√§ren k√∂nnen, f√ºr diejenigen, die nicht vertraut sind, werde ich sagen. <br><br>  Ein Reduzierer ist eine Funktion, die einen Status akzeptiert, und ein Objekt, das normalerweise als Aktion bezeichnet wird und beschreibt, wie sich dieser Status √§ndern soll.  Genauer gesagt, es werden einige Parameter √ºbergeben, und innerhalb des Reduzierers entscheidet es bereits abh√§ngig von seinen Parametern, wie sich der Status √§ndert. Infolgedessen sollte ein neuer Status zur√ºckgegeben und aktualisiert werden. <br><br><img src="https://habrastorage.org/webt/k6/5x/gd/k65xgdpidy6wnhmuxabw3sqqtk0.jpeg"><br><br>  Auf ungef√§hr diese Weise wird es im Komponentencode verwendet.  Wir haben einen useReducer-Hook, der eine Reducer-Funktion ben√∂tigt, und der zweite Parameter ist der Anfangswert des Zustands.  Gibt wie useState, den aktuellen Status und die Funktion zum √Ñndern zur√ºck, ist dispatch.  Wenn Sie ein Aktionsobjekt an den Versand √ºbergeben, rufen wir eine Status√§nderung auf. <br><br><img src="https://habrastorage.org/webt/un/sl/ng/unslngsedmksssjrthxjmzhn7bu.jpeg"><br><br>  Sehr wichtige VerwendungEffekthaken.  Sie k√∂nnen der Komponente Nebenwirkungen hinzuf√ºgen, die eine Alternative zum Lebenszyklus darstellen.  In diesem Beispiel verwenden wir eine einfache Methode mit useEffect: Sie fordert lediglich einige Daten vom Server an, beispielsweise mit der API, und zeigt diese Daten auf der Seite an. <br><br><img src="https://habrastorage.org/webt/bb/tc/gf/bbtcgfyw89tgu_jarnwwaagxmnq.jpeg"><br><br>  UseEffect verf√ºgt √ºber einen erweiterten Modus. Wenn die an useEffect √ºbergebene Funktion eine andere Funktion zur√ºckgibt, wird diese Funktion im n√§chsten Zyklus aufgerufen, wenn dieser useEffect angewendet wird. <br><br>  Ich habe vergessen zu erw√§hnen, dass useEffect direkt nach dem Anwenden der √Ñnderung auf das DOM asynchron aufgerufen wird.  Das hei√üt, es garantiert, dass es ausgef√ºhrt wird, nachdem die Komponente gerendert wurde, und kann zum n√§chsten Rendern f√ºhren, wenn sich einige Werte √§ndern. <br><br><img src="https://habrastorage.org/webt/gl/yd/cj/glydcjxiui-c60mgjzhnfobsqcm.jpeg"><br><br>  Hier begegnen wir zum ersten Mal einem Konzept wie Abh√§ngigkeiten.  Einige Hooks - useEffect, useCallback, useMemo - verwenden ein Array von Werten als zweites Argument, mit dem wir sagen k√∂nnen, was verfolgt werden soll.  √Ñnderungen in diesem Array f√ºhren zu Effekten.  Zum Beispiel haben wir hier hypothetisch eine Art Komponente f√ºr die Auswahl eines Autors aus einer Liste.  Und ein Teller mit B√ºchern dieses Autors.  Und wenn sich der Autor √§ndert, wird useEffect aufgerufen.  Wenn diese authorId ge√§ndert wird, wird eine Anfrage aufgerufen und B√ºcher werden geladen. <br><br>  Ich erw√§hne auch beim √úbergeben von Hooks wie useRef, dass dies eine Alternative zu React.createRef ist, √§hnlich wie useState, aber √Ñnderungen an ref f√ºhren nicht zum Rendern.  Manchmal praktisch f√ºr einige Hacks.  Mit useImperativeHandle k√∂nnen wir bestimmte "√∂ffentliche Methoden" f√ºr die Komponente deklarieren.  Wenn Sie useRef in der √ºbergeordneten Komponente verwenden, k√∂nnen diese Methoden abgerufen werden.  Um ehrlich zu sein, habe ich es einmal zu Bildungszwecken versucht, in der Praxis war es nicht n√ºtzlich.  useContext ist nur eine gute Sache. Sie k√∂nnen den aktuellen Wert aus dem Kontext √ºbernehmen, wenn der Anbieter diesen Wert irgendwo h√∂her in der Hierarchieebene definiert hat. <br><br>  Es gibt eine M√∂glichkeit, React-Anwendungen an Hooks zu optimieren: Memoisierung.  Das Auswendiglernen kann in interne und externe unterteilt werden.  Zuerst √ºber die Au√üenseite. <br><br><img src="https://habrastorage.org/webt/ao/wq/-e/aowq-evnbye1bnr6lspo9sthw9y.jpeg"><br><br>  Dies ist React.memo, praktisch eine Alternative zur React.PureComponent-Klasse, die √Ñnderungen an Requisiten und ge√§nderten Komponenten nur dann verfolgte, wenn sich Requisiten oder Status √§nderten. <br><br>  Hier √§hnlich jedoch ohne Staat.  Es √ºberwacht auch √Ñnderungen an Requisiten, und wenn sich die Requisiten ge√§ndert haben, tritt ein Renderer auf.  Wenn sich die Requisiten nicht ge√§ndert haben, wird die Komponente nicht aktualisiert, und wir sparen dies. <br><br><img src="https://habrastorage.org/webt/lk/0l/dn/lk0ldneyzriaeesmzxfnvvkl1h4.jpeg"><br><br>  Interne Optimierungsmethoden.  Zuallererst ist dies eine eher einfache Sache - useMemo, selten verwendet.  Sie k√∂nnen einen Wert berechnen und nur dann neu berechnen, wenn sich die in den Abh√§ngigkeiten angegebenen Werte ge√§ndert haben. <br><br><img src="https://habrastorage.org/webt/ve/fs/ml/vefsmlmbjqbg6-1lejt5_qofoow.jpeg"><br><br>  Es gibt einen Sonderfall von useMemo f√ºr eine Funktion namens useCallback.  Es wird haupts√§chlich verwendet, um den Wert von Ereignishandlerfunktionen zu speichern, die an untergeordnete Komponenten √ºbergeben werden, damit diese untergeordneten Komponenten nicht erneut gerendert werden k√∂nnen.  Es wird einfach verwendet.  Wir beschreiben eine bestimmte Funktion, verpacken sie in useCallback und geben an, von welchen Variablen sie abh√§ngt. <br><br>  Viele Menschen haben eine Frage, aber brauchen wir diese?  Brauchen wir haken  Bewegen wir uns oder bleiben wir wie zuvor?  Es gibt keine einzige Antwort, alles h√§ngt von den Vorlieben ab.  Erstens, wenn Sie direkt fest an die objektorientierte Programmierung gebunden sind und Ihre Komponenten als Klasse daran gew√∂hnt sind, haben sie Methoden, die abgerufen werden k√∂nnen, dann scheint Ihnen diese Sache wahrscheinlich √ºberfl√ºssig zu sein.  Im Prinzip schien es mir, als ich zum ersten Mal von Hooks h√∂rte, dass es zu kompliziert war, dass eine Art Magie hinzugef√ºgt wurde und es nicht klar war, warum. <br><br>  F√ºr Liebhaber von Funktionalit√§ten ist dies beispielsweise ein Muss, da Hooks Funktionen sind und funktionale Programmiertechniken auf sie anwendbar sind.  Sie k√∂nnen sie beispielsweise kombinieren oder √ºberhaupt etwas tun, indem Sie beispielsweise Bibliotheken wie Ramda und dergleichen verwenden. <br><br><img src="https://habrastorage.org/webt/du/k4/n7/duk4n7l_1_are_xjgrkf4vvbccy.jpeg"><br><br>  Da wir Klassen losgeworden sind, m√ºssen wir diesen Kontext nicht mehr an Methoden binden.  Wenn Sie diese Methoden als R√ºckruf verwenden.  Normalerweise war dies ein Problem, da Sie daran denken mussten, sie im Konstruktor zu binden oder eine inoffizielle Erweiterung der Sprachsyntax zu verwenden, z. B. Pfeilfunktionen als Eigenschaft.  Ziemlich √ºbliche Praxis.  Ich habe meinen Dekorateur benutzt, der im Prinzip auch experimentell auf Methoden basiert. <br><br><img src="https://habrastorage.org/webt/pn/ew/fi/pnewfifb1wwktxkbddh1zqqk-os.jpeg"><br><br>  Es gibt einen Unterschied darin, wie der Lebenszyklus funktioniert und wie er verwaltet wird.  Hooks verkn√ºpfen fast alle Lebenszyklusaktionen mit dem useEffect-Hook, mit dem Sie sowohl die Geburt als auch die Aktualisierung einer Komponente und deren Tod abonnieren k√∂nnen.  In den Klassen mussten wir daf√ºr verschiedene Methoden neu definieren, z. B. componentDidMount, componentDidUpdate und componentWillUnmount.  Au√üerdem sollte die shouldComponentUpdate-Methode jetzt durch React.memo ersetzt werden. <br><br><img src="https://habrastorage.org/webt/7d/ae/qy/7daeqyxv0yh0on4i1wcdsraoaws.jpeg"><br><br>  Es gibt einen relativ kleinen Unterschied im Umgang mit dem Staat.  Erstens haben Klassen ein Zustandsobjekt.  Wir mussten dort alles stopfen.  In Hooks k√∂nnen wir den logischen Zustand in einige Teile zerlegen, was f√ºr uns praktisch w√§re, wenn wir separat arbeiten w√ºrden. <br><br>  setState () von Komponenten in Klassen, die einen Status-Patch angeben d√ºrfen, wodurch ein oder mehrere Felder des Status ge√§ndert werden.  In Hooks m√ºssen wir den gesamten Zustand als Ganzes √§ndern, und das ist sogar gut so, denn es ist in Mode, alle m√∂glichen unver√§nderlichen Dinge zu verwenden und niemals zu erwarten, dass unsere Objekte mutieren.  Sie sind immer neu bei uns. <br><br>  Das Hauptmerkmal von Klassen, die Hooks nicht haben: Wir k√∂nnten Status√§nderungen abonnieren.  Das hei√üt, wir √§ndern den Status und abonnieren sofort seine √Ñnderungen, wobei wir unmittelbar nach dem Anwenden der √Ñnderungen unbedingt etwas verarbeiten m√ºssen.  Bei Hooks funktioniert dies einfach nicht.  Dies muss auf sehr interessante Weise geschehen, ich werde es Ihnen weiter erz√§hlen. <br><br>  Und ein wenig √ºber die funktionale Art der Aktualisierung.  Es funktioniert sowohl dort als auch dort, wenn die Status√§nderungsfunktionen eine andere Funktion akzeptieren, die dieser Status nicht √§ndern, sondern erstellen soll.  Und wenn im Fall der Klassenkomponente eine Art Patch an uns zur√ºckgegeben werden kann, m√ºssen wir in den Hooks den gesamten neuen Wert zur√ºckgeben. <br><br>  Im Allgemeinen ist es unwahrscheinlich, dass Sie eine Antwort erhalten, ob Sie sich bewegen oder nicht.  Aber ich rate zumindest, zumindest f√ºr den neuen Code zu versuchen, ihn zu f√ºhlen.  Als ich gerade anfing, mit Hooks zu arbeiten, identifizierte ich sofort mehrere benutzerdefinierte Hooks, die f√ºr mich f√ºr mein Projekt geeignet sind.  Grunds√§tzlich habe ich versucht, einige der Funktionen zu ersetzen, die ich durch Komponenten h√∂herer Ordnung implementiert hatte. <br><br><img src="https://habrastorage.org/webt/d6/cs/1-/d6cs1-ebiop8wbrdgnrr93wskqm.jpeg"><br><br>  useDismounted - F√ºr diejenigen, die mit RxJS vertraut sind, besteht die M√∂glichkeit, alle Observable innerhalb einer Komponente oder innerhalb einer Funktion in gro√üen Mengen abzubestellen, indem jedes Observable ein spezielles Objekt, Subject, abonniert wird. Wenn es geschlossen wird, werden alle Abonnements gek√ºndigt.  Dies ist sehr praktisch, wenn die Komponente komplex ist und wenn im Observable viele asynchrone Vorg√§nge vorhanden sind. Es ist praktisch, sich von allen gleichzeitig und nicht von jedem einzeln abzumelden. <br><br>  useObservable gibt einen Wert von Observable zur√ºck, wenn dort ein neuer angezeigt wird.  Ein √§hnlicher useBehaviourSubject-Hook wird von BehaviourSubject zur√ºckgegeben.  Der Unterschied zu Observable besteht darin, dass es zun√§chst eine Bedeutung hat. <br><br>  Mit dem praktischen benutzerdefinierten Hook useDebounceValue k√∂nnen wir beispielsweise einen Sujest f√ºr die Suchzeichenfolge organisieren, sodass nicht jedes Mal, wenn Sie eine Taste dr√ºcken, etwas an den Server gesendet wird, sondern gewartet wird, bis der Benutzer die Eingabe beendet hat. <br><br>  Zwei √§hnliche Haken.  useWindowResize gibt aktuelle Istwerte f√ºr Fenstergr√∂√üen zur√ºck.  Der n√§chste Haken f√ºr die Bildlaufposition ist useWindowScroll.  Ich benutze sie, um einige Popups oder modale Fenster wiederzugeben, wenn es komplizierte Dinge gibt, die mit CSS einfach nicht m√∂glich sind. <br><br>  Und so ein kleiner Haken zum Implementieren von Hotkeys, den die Komponente, wenn sie auf der Seite vorhanden ist, mit einem Hotkey abonniert.  Wenn er stirbt, erfolgt eine automatische Abmeldung. <br><br>  Wof√ºr sind diese benutzerdefinierten Haken geeignet?  Dass wir ein Abbestellen innerhalb des Hooks stopfen k√∂nnen und nicht daran denken m√ºssen, das Abmelden irgendwo in der Komponente, in der dieser Hook verwendet wird, manuell abzubestellen. <br><br>  Vor nicht allzu langer Zeit warfen sie mir einen Link zur React-Use-Bibliothek, und es stellte sich heraus, dass die meisten dieser benutzerdefinierten Hooks dort bereits implementiert waren.  Und ich habe ein Fahrrad geschrieben.  Dies ist manchmal n√ºtzlich, aber in Zukunft werde ich sie h√∂chstwahrscheinlich wegwerfen und React-Use verwenden.  Und ich rate Ihnen, auch zu pr√ºfen, ob Sie Haken verwenden m√∂chten. <br><br><img src="https://habrastorage.org/webt/03/ls/_r/03ls_rryjcv9gax_wky56kv0hye.jpeg"><br><br>  Das Hauptziel des Berichts ist es, zu zeigen, wie man falsch schreibt, welche Probleme auftreten k√∂nnen und wie man sie vermeidet.  Das allererste, wahrscheinlich, was jeder, der diese Hooks studiert und versucht, etwas zu schreiben, ist, useEffect falsch zu verwenden.  Hier ist der Code √§hnlich dem, den 100% jeder geschrieben hat, wenn er Hooks ausprobiert hat.  Dies liegt an der Tatsache, dass useEffect zun√§chst mental als Alternative zu componentDidMount wahrgenommen wird.  Im Gegensatz zu componentDidMount, das nur einmal aufgerufen wird, wird useEffect bei jedem Rendering aufgerufen.  Und der Fehler hier ist, dass es beispielsweise die Datenvariable √§ndert und gleichzeitig zu einem Komponenten-Renderer f√ºhrt, wodurch der Effekt erneut angefordert wird.  Auf diese Weise erhalten wir eine endlose Reihe von AJAX-Anforderungen an den Server, und die Komponente selbst wird st√§ndig aktualisiert, aktualisiert, aktualisiert. <br><br><img src="https://habrastorage.org/webt/ds/jw/cl/dsjwclnhk6kvmnmkxjw04vdrqd8.jpeg"><br><br>  Das Problem zu beheben ist sehr einfach.  Sie m√ºssen hier ein leeres Array der Abh√§ngigkeiten hinzuf√ºgen, von denen es abh√§ngt, und √Ñnderungen, bei denen der Effekt neu gestartet wird.  Wenn hier eine leere Liste von Abh√§ngigkeiten angegeben ist, wird der Effekt dementsprechend nicht neu gestartet.  Dies ist keine Art von Hack, sondern eine grundlegende Funktion der Verwendung von useEffect. <br><br><img src="https://habrastorage.org/webt/tx/bw/it/txbwitnnldk_y5r-bf0f4pss7eg.jpeg"><br><br>  Nehmen wir an, wir haben es behoben.  Jetzt etwas kompliziert.  Wir haben eine Komponente, die etwas rendert, das f√ºr eine Art ID vom Server √ºbernommen werden muss.  In diesem Fall funktioniert im Prinzip alles einwandfrei, bis wir die entityId im √ºbergeordneten Element √§ndern. Dies ist m√∂glicherweise f√ºr Ihre Komponente nicht relevant. <br><br><img src="https://habrastorage.org/webt/2e/pl/tx/2epltxjdup5yia7c6gsepl-o7xo.jpeg"><br><br>  Wenn es sich jedoch √§ndert oder ge√§ndert werden muss und Sie eine alte Komponente auf Ihrer Seite haben und sich herausstellt, dass sie nicht aktualisiert wird, ist es am besten, hier eine EntityId als Abh√§ngigkeit hinzuzuf√ºgen, die die Aktualisierung verursacht und die Daten aktualisiert. <br><br><img src="https://habrastorage.org/webt/rd/lc/ep/rdlcepf4e8lzq8ersyffn8ydqgs.jpeg"><br><br>  Ein komplexeres Beispiel mit useCallback.  Hier ist auf den ersten Blick alles in Ordnung.  Wir haben eine bestimmte Seite, die eine Art Countdown-Timer hat, oder umgekehrt einen Timer, der nur tickt.  Eine Liste von Hosts und dar√ºber hinaus Filter, mit denen Sie diese Liste von Hosts filtern k√∂nnen.  Nun, hier wurde Wartung hinzugef√ºgt, um einen sich h√§ufig √§ndernden Wert zu veranschaulichen, der in einen Renderer √ºbersetzt wird. <br><br>    ,   ,    maintenance    ,   ,   ,      onChange.     onChange,        .  ,  HostFilters - , ,      dropdown,     .       ,    .  ,       . <br><br><img src="https://habrastorage.org/webt/bb/08/q1/bb08q1gwb5jzadcu0-bl1w0xsy0.jpeg"><br><br>     onChange    useCallback.         ,      . <br><br>    ,   . , ,  .      Facebook,   React.  , , ,  ,  '.     ,  ,  confusing . <br><br><img src="https://habrastorage.org/webt/xw/lv/et/xwlvetymaukrlaxd7t5cctegg-8.jpeg"><br><br>     ?        ‚Äî     ,   -  , ,     ,      ,  ,         .         . <br><br> ,    ,          ,     ,      ,     , .  , Garbage Collector      ,    .  , ,     ,    ,    .   , , ,       reducer,     ,          . ,      . <br><br>    ,     ,   .     - , ,   setValue  - ,            ,   setState     .   -       useEffect. <br><br>   useEffect   -  ,   -  , ,   ,    useEffect.     useEffect     ,   .        ,    ,  Backbone,  : ,     ,  ,        -  .      ,    ,  -   ,  .    -   . ,  ,      ,    ,    -  . ,  ,  ,   , ,    ,  .     . <br><br>   ,   ,  . ,        ,     .           ,      .        ,     .  ,    , , dropdown  .   ,     .    dropdown  pop-up,     useWindowScroll, useWindowResize         ,  .         ,      , ‚Äî  ,   . <br><br>        ,   ,  . ,       , ,   ,     ,       . , ,   ,      ,   ,         . <br><br><img src="https://habrastorage.org/webt/-r/tu/f_/-rtuf_bbscg5l9i4-oaeh-xpu80.jpeg"><br><br>   ,     ¬´¬ª,   . ,     ,   TypeScript    .      .    ,  reducer  Redux ,    action.  ,   action    ,     action.   ,   ,     ,  . <br><br>    .  ,        action.     ,     , IncrementA  0,  1, 2,   .         . ,    , ,  ,       .     action     action,   -     .   UnionType ‚ÄúAction‚Äù,         ,   ,    action.   . <br><br>   ‚Äî     . ,   initialState,  .   ,       -  .       TypeScript.     . ,    typeState   ,   initialState. <br><br><img src="https://habrastorage.org/webt/_i/fg/79/_ifg793-qpfaiwittpdhffve_zw.jpeg"><br><br>       reducer.   State, Action,    :   switch  action.type.  TypeScript      UnionType:       case,      - ,    type.           action   . <br><br> ,  :  ,    ,     .  . <br><br><img src="https://habrastorage.org/webt/6r/8v/or/6r8vordbm6xpl9og288kzvrgewk.jpeg"><br><br>   ?  ,     .      .      ,   reducer. ,   action creator  ,   ,       dispatch. <br><br><img src="https://habrastorage.org/webt/vg/tg/aw/vgtgawewmkwgpr5su4c24n7hgo8.jpeg"><br><br>     extension   Dev Tools.            .    . <br><br>  ,  ,    .   ,     ,     .      useDebugValue ,        -    Dev Tool.        useConstants,       - , loaded,  ,     ,  . <br><br><img src="https://habrastorage.org/webt/rt/cc/sg/rtccsggw9kekwpt75gmvnwd_w2u.jpeg"><br><br>   ‚Äî  .  ,     .     ,        .    ,   ,  ,    .     ,   ,          ‚Äî   -       ,   ‚Äî   . <br><br>   .  Facebook     ESLint,       .      ,  , .    ,   dependencies  .     ,    ,    ,     . <br><br>       ,  ,     ,  -   ,     .     ,   ,   ,       . .       ,    -   - . <br><br>    ‚Äî       , ,  - .   ,    ,    .      ,   ,  -      . ,             .      .  N√ºtzliche Links: <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">¬´React hooks ‚Äî   ?¬ª</a> C     .       ,    ,    ,      ,    . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   useEffect</a> .  ,   ,      ,   ,   ,     . . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">¬´useReducer vs useState in React¬ª</a> ,    useReducer,      useState. :     ,  ,    ,    useReducer.    - ,   useState   . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">React Hooks CheatSheets</a> c      . </li><li>   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Usehooks.com</a> ‚Äî   , .     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">react-use</a> ‚Äî ,       ,     . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464071/">https://habr.com/ru/post/de464071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464045/index.html">Wie ich 1997 fast in Echtzeit Rennstrecken gefahren bin</a></li>
<li><a href="../de464053/index.html">Hinweis: Spurauswahl- und Rotationsalgorithmus</a></li>
<li><a href="../de464055/index.html">Wir untersuchen die von Xiaomi Mi Band f√ºr das Jahr gesammelten Daten</a></li>
<li><a href="../de464057/index.html">Hilbert, Lebesgue ... und die Leere</a></li>
<li><a href="../de464063/index.html">Kabel 2019 abschneiden</a></li>
<li><a href="../de464075/index.html">Einf√ºhrung in C. Botschaft aus dem letzten Jahrhundert</a></li>
<li><a href="../de464077/index.html">Nein, Sie brauchen kein Delta mit 50 km / s. Sie ben√∂tigen additive Technologien (Teil 1)</a></li>
<li><a href="../de464079/index.html">Wie man ein horizontales Start- und Landungsraumschiff ohne Wundertechnologie baut</a></li>
<li><a href="../de464083/index.html">Wie ITSM hilft und wer diese Methode anwendet</a></li>
<li><a href="../de464089/index.html">Automatisierung von HTTP-Anforderungen im Kontext von Spring</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>