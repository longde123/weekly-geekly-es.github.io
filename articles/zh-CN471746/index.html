<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙋🏾 👃🏼 👰🏻 配置HTTP标头以确保安全的完整指南 👩🏻‍⚕️ 🤱🏼 🤞🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="出售安全记分卡的公司正在上升，它们在公司销售中的影响力正在增长。 此外，有些人对卖方的低安全等级感到困惑，而那些至少一次看过该等级的人拒绝购买-我与这些人交谈。 


 我研究了这些公司如何计算其他公司的安全绩效。 原来，他们正在考虑使用HTTP标头来提高安全性和IP地址的信誉。 


 IP地址的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>配置HTTP标头以确保安全的完整指南</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/471746/"><p><img src="https://habrastorage.org/webt/df/rj/xf/dfrjxfp4ydkkf7al1royc4wnufs.jpeg"></p><br><p> 出售安全记分卡的公司正在上升，它们在公司销售中的影响力正在增长。 此外，有些人对卖方的低安全等级感到困惑，而那些至少一次看过该等级的人拒绝购买-我与这些人交谈。 </p><br><p> 我研究了这些公司如何计算其他公司的安全绩效。 原来，他们正在考虑使用HTTP标头来提高安全性和IP地址的信誉。 </p><br><p>  IP地址的信誉基于黑名单和垃圾邮件发送者列表数据以及有关公共IP地址所有者的信息。 原则上，如果您的公司不发送垃圾邮件并且能够快速识别并阻止恶意实施，则应该是干净的。 使用HTTP安全标头的方式与<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mozilla天文台的</a>工作方式相同。 </p><br><p> 因此，大多数公司的评级主要​​取决于公共网站上包含的安全标题。 </p><a name="habracut"></a><br><p> 正确设置标题的时间不长（不需要进行认真的验证），但这可以提高网站的安全性，并有助于避免失去安全性不是空洞的客户 </p><br><p> 我怀疑上述验证方法的价值；此外，该服务的价格高昂。 该服务的提供者不太可能能够以规定的准确性确定资源的安全性。 但是，这种情况再次强调了坐下并花一些时间打开并设置正确的标题非常重要。 </p><br><p>在本文中，我将讨论最常检查的标头，因为每个标头都会建议安全值并提供设置示例。 最后，我将举例说明常见应用程序和Web服务器的设置。 </p><br><h2 id="vazhnye-zagolovki-dlya-bezopasnosti"> 重要安全标题 </h2><br><h3 id="content-security-policy"> 内容安全政策 </h3><br><p>  CSP用于通过确定可以下载哪些资源来防止跨站点脚本编写。 在整个列表中，该标题将比其余标题花费更多的时间来创建和正确支持，甚至还有更多其他风险。 在开发CSP时，请仔细检查-如果您突然阻止了正在使用的源，然后破坏了自己站点的功能。 </p><br><p> 对于初步版本，您可以使用一个很棒的工具<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-Mozilla浏览器Laboratory CSP</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">扩展</a> 。 将其安装在浏览器中，仔细研究您要为其创建CSP的站点，然后在您的站点上使用生成的CSP。 理想情况下，您仍然需要重新处理JavaScript，以便可以删除不安全的内联指令。 </p><br><p>  CSP似乎复杂而令人困惑，因此，如果您想更深入地研究该主题，请访问<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">官方网站</a> 。 </p><br><p> 您可以像这样预先配置CSP（在战场上，很可能需要进行很多修改）。 将域添加到站点的每个部分。 </p><br><pre><code class="plaintext hljs"># Default to only allow content from the current site # Allow images from current site and imgur.com # Don't allow objects such as Flash and Java # Only allow scripts from the current site # Only allow styles from the current site # Only allow frames from the current site # Restrict URL's in the &lt;base&gt; tag to current site # Allow forms to submit only to the current site Content-Security-Policy: default-src 'self'; img-src 'self' https://i.imgur.com; object-src 'none'; script-src 'self'; style-src 'self'; frame-ancestors 'self'; base-uri 'self'; form-action 'self';</code> </pre> <br><h3 id="strict-transport-security"> 严格的运输安全 </h3><br><p> 此标头告诉浏览器您只能使用HTTPS协议进入网站-如果在您的网站上激活了HTTPS，则始终启用它。 将其包括在所有使用的子域中（如果有）。 </p><br><pre> <code class="plaintext hljs">Strict-Transport-Security: max-age=3600; includeSubDomains</code> </pre> <br><h3 id="x-content-type-options">  X内容类型选项 </h3><br><p> 由于有了此标头，浏览器可以遵守应用程序安装的MIME类型，从而有助于防止某些跨站点脚本攻击。 </p><br><p> 当浏览器错误地“猜测”网站上的内容类型时，例如，如果开发人员指定了“ HTML”页面并且浏览器看到了JavaScript并尝试相应地呈现页面，它还降低了应用程序意外行为的风险。 另外，由于有了此标头，浏览器始终保留服务器安装的MIME类型。 </p><br><pre> <code class="plaintext hljs">X-Content-Type-Options: nosniff</code> </pre> <br><h3 id="cache-control"> 缓存控制 </h3><br><p> 这将比其他的要差，因为对于不同类型的内容，您可能需要不同的缓存策略。 </p><br><p> 不应缓存任何敏感信息，例如用户页面或产品付款页面。 造成这种情况的原因之一是，另一位计算机用户没有按下“后退”按钮，没有阅读历史记录，也没有看到另一位用户的个人数据。 </p><br><p> 但是，您可以并且应该缓存那些很少更新的页面，例如静态资源（图像，CSS和JS文件）。 可以逐页配置缓存，也可以在服务器设置中使用正则表达式进行配置。 </p><br><pre> <code class="plaintext hljs"># Don't cache by default Header set Cache-Control no-cache # Cache static assets for 1 day &lt;filesMatch ".(css|jpg|jpeg|png|gif|js|ico)$"&gt; Header set Cache-Control "max-age=86400, public" &lt;/filesMatch&gt;</code> </pre> <br><h3 id="expires"> 过期 </h3><br><p> 此标头设置当前请求被缓存的时间。 如果启用了Cache-Control max-age标头，则将其忽略，因此我们仅在简单的扫描程序检查它的情况下才启用它-不包括缓存控件。 </p><br><p> 我们假设出于安全原因，浏览器不缓存任何内容，因此标头中的日期将始终是过去的日期。 </p><br><pre> <code class="plaintext hljs">Expires: 0</code> </pre> <br><h3 id="x-frame-options">  X帧选项 </h3><br><p> 该标头可在iFrame中显示网站。 </p><br><p> 通过将您的网站放置在iFrame中，恶意资源就有机会进行点击劫持攻击-通过启动某种JavaScript诱使用户点击iFrame，然后开始使用其用户名（例如，某人单击恶意链接或按钮）与该资源进行交互甚至都不知道！）。 </p><br><p> 此标头应始终配置为失败，但如果您有意使用帧则除外。 然后，标头必须设置为相同的源。 如果默认情况下将框架与其他站点一起使用，则将第三方域列入白名单。 </p><br><p> 还应注意，此标头已由CSP frame-ancestors指令替换。 我建议暂时将其打开，但是只是为了关闭用于检查标题的工具，将来它们很可能会摆脱它。 </p><br><pre> <code class="plaintext hljs">X-Frame-Options: deny</code> </pre> <br><h3 id="access-control-allow-origin"> 访问控制允许来源 </h3><br><p> 该标头告诉浏览器哪些第三方站点的外部代码有权向特定页面发出请求。 默认设置通常是正确的，但是您可以根据需要更改它们。 </p><br><p> 例如，站点A包含想要向站点B发出请求的某种JavaScript。如果标题允许站点A发出请求，则站点B应该对此请求做出响应。 如果需要配置许多源， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">请参阅MDN页面上的详细信息</a> 。 </p><br><p> 在这里，您可能会感到有些困惑，因此我制作了一个图表-说明此标头如何工作： </p><br><p><img src="https://habrastorage.org/webt/97/g9/iy/97g9iyhqou03xiinwuind3gqwbs.png"><br>  <em>具有访问控制允许来源的数据流</em> </p><br><pre> <code class="plaintext hljs">Access-Control-Allow-Origin: http://www.one.site.com</code> </pre> <br><h3 id="set-cookie"> 设定Cookie </h3><br><p> 确保仅通过HTTPS协议（带有加密）设置cookie，并且不能通过JavaScript访问它们。 仅当您的站点也应该支持HTTPS时，才可以发送这些文件。 您始终需要设置以下标志： </p><br><ul><li> 安全的 </li><li> 仅HTTP </li></ul><br><p>  Cookie定义示例： </p><br><pre> <code class="plaintext hljs">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Domain=&lt;domain-value&gt;; Secure; HttpOnly</code> </pre> <br><p> 在出色的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mozilla cookie文档中</a>了解更多<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">信息</a> 。 </p><br><h3 id="x-xss-protection">  X-XSS保护 </h3><br><p> 该标头告诉浏览器中止检测到的跨站点脚本攻击。 通过打开它，您不会承担太大的风险，但是可以在将其启动到生产环境中之前对其进行测试。 </p><br><pre> <code class="plaintext hljs">X-XSS-Protection: 1; mode=block</code> </pre> <br><h3 id="primer-nastroek-veb-servera">  Web服务器设置示例 </h3><br><p> 通常，在服务器设置中，最好将标头添加到整个站点。  Cookies是一个例外，因为它们是在应用程序本身中定义的。 </p><br><p> 我建议您在将标头添加到站点之前，首先与天文台联系，或者手动查看标头-检查已安装的标头。 一些站点和服务器引擎会自行安装所有内容，因此只需实现所需的标头或更改所需的标头即可。 </p><br><h3 id="konfiguraciya-apache">  Apache配置 </h3><br><p>  .htaccess中的示例Apache配置： </p><br><pre> <code class="plaintext hljs">&lt;IfModule mod_headers.c&gt; ## CSP Header set Content-Security-Policy: default-src 'self'; img-src 'self' https://i.imgur.com; object-src 'none'; script-src 'self'; style-src 'self'; frame-ancestors 'self'; base-uri 'self'; form-action 'self'; ## General Security Headers Header set X-XSS-Protection: 1; mode=block Header set Access-Control-Allow-Origin: http://www.one.site.com Header set X-Frame-Options: deny Header set X-Content-Type-Options: nosniff Header set Strict-Transport-Security: max-age=3600; includeSubDomains ## Caching rules # Don't cache by default Header set Cache-Control no-cache Header set Expires: 0 # Cache static assets for 1 day &lt;filesMatch ".(ico|css|js|gif|jpeg|jpg|png|svg|woff|ttf|eot)$"&gt; Header set Cache-Control "max-age=86400, public" &lt;/filesMatch&gt; &lt;/IfModule&gt;</code> </pre> <br><h3 id="konfiguraciya-nginx">  Nginx配置 </h3><br><pre> <code class="plaintext hljs">## CSP add_header Content-Security-Policy: default-src 'self'; img-src 'self' https://i.imgur.com; object-src 'none'; script-src 'self'; style-src 'self'; frame-ancestors 'self'; base-uri 'self'; form-action 'self'; ## General Security Headers add_header X-XSS-Protection: 1; mode=block; add_header Access-Control-Allow-Origin: http://www.one.site.com; add_header X-Frame-Options: deny; add_header X-Content-Type-Options: nosniff; add_header Strict-Transport-Security: max-age=3600; includeSubDomains; ## Caching rules # Don't cache by default add_header Cache-Control no-cache; add_header Expires: 0; # Cache static assets for 1 day location ~* \.(?:ico|css|js|gif|jpe?g|png|svg|woff|ttf|eot)$ { try_files $uri @rewriteapp; add_header Cache-Control "max-age=86400, public"; }</code> </pre> <br><h3 id="nastroyka-zagolovka-urovnya-prilozheniya"> 应用程序级别标题设置 </h3><br><p> 如果您无权访问Web服务器或设置标头的要求很复杂，则可能必须在应用程序本身中对其进行配置。 通常，对于整个站点，这是使用中间件完成的，或者基于一次性设置每个请求的标头。 </p><br><p> 为简洁起见，在每个示例中仅包含一个标题。 您以相同的方式添加所有需要的内容。 </p><br><p> 节点和快递： </p><br><p> 添加全局安装路径： </p><br><pre> <code class="plaintext hljs">app.use(function(req, res, next) { res.header('X-XSS-Protection', 1; mode=block); next(); });</code> </pre> <br><h3 id="java-i-spring">  Java和Spring </h3><br><p> 我对Spring的经验很少，但是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Baeldung</a>对于在Spring中设置标头有很好的指导。 </p><br><h3 id="php">  p </h3><br><p> 我不熟悉各种PHP环境。 寻找用于查询的中间件。 对于单个请求，一切都很简单。 </p><br><pre> <code class="plaintext hljs">header("X-XSS-Protection: 1; mode=block");</code> </pre> <br><h3 id="python--django">  Python / Django </h3><br><p>  Django包含可自定义的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">安全中间件</a> ，它将为您完成所有这些工作。 首先激活它们。 </p><br><p> 某些页面的答案可以解释为字典。  Django有一种特殊的缓存处理方式，如果您想以这种方式配置缓存头，则需要熟悉它。 </p><br><pre> <code class="plaintext hljs">response = HttpResponse() response["X-XSS-Protection"] = "1; mode=block"</code> </pre> <br><h3 id="vyvody"> 结论 </h3><br><p> 设置标头是一个相对简单且快速的过程，但是它提高了站点安全级别-在数据保护方面，从跨站点脚本和单击劫持。 </p><br><p> 将来，由于您的安全等级将保持在该级别，因此您将保护自己免受交易失败的影响。 根据我所检查的参数进行评估的实践正在获得发展，在我看来，它在未来几年在销售领域中的作用只会越来越大。 </p><br><p> 让我知道我是否错过了一些重要的标题！ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471746/">https://habr.com/ru/post/zh-CN471746/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471736/index.html">非接触式以太网传感器</a></li>
<li><a href="../zh-CN471738/index.html">简短的故事，有时会在膝盖上带来便利</a></li>
<li><a href="../zh-CN471740/index.html">基于ZeroMQ和Tarantool的智能缓存服务</a></li>
<li><a href="../zh-CN471742/index.html">Sberbank AI旅程。 我们如何教神经网络参加考试</a></li>
<li><a href="../zh-CN471744/index.html">Tarantool数据网格：体系结构和功能</a></li>
<li><a href="../zh-CN471748/index.html">药房优化：我们对数学的处理</a></li>
<li><a href="../zh-CN471750/index.html">特权访问管理是信息安全中的优先任务（例如，Fudo PAM）</a></li>
<li><a href="../zh-CN471756/index.html">服务器如何启动</a></li>
<li><a href="../zh-CN471758/index.html">如何将文字翻译成其他语言？</a></li>
<li><a href="../zh-CN471760/index.html">爱德华·斯诺登：战场-加密</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>