<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😪 🚹 🔆 使用BuildBot的持续集成实施示例 👩🏾‍⚖️ 🚁 ⚔️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="（图片由Computerizer在Pixabay上发布） 
 
 你好 

 我的名字叫Evgeny Cherkin ，我是Polymetal矿业公司开发团队的程序员。 

 在开始任何重大项目时，您都会开始思考：“哪种软件最好用于维护？”。 下一个版本发布之前的IT项目经历了一系列阶段。 这些步骤...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用BuildBot的持续集成实施示例</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460501/"><img src="https://habrastorage.org/webt/jj/-4/-g/jj-4-gindpovkdi6rbmzxax4yqu.jpeg" alt="BuildBot试用配置"><br>  <i>（图片由<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Computerizer</a>在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Pixabay上发布）</a></i> <i><br></i> <br> 你好 <br><br> 我的名字叫<b>Evgeny Cherkin</b> ，我是<b>Polymetal</b>矿业公司开发团队的程序员。 <br><br> 在开始任何重大项目时，您都会开始思考：“哪种软件最好用于维护？”。 下一个版本发布之前的IT项目经历了一系列阶段。 这些步骤的链是自动化的，那很好。 发布IT项目新版本的自动化过程称为“ <i>持续集成”</i> 。  <b>事实</b>证明， <b>BuildBot</b>对我们来说是一个很好的帮助，它可以执行此过程。 <br><br> 在本文中，我决定概述<b>BuildBot</b>的功能。 这个软件能做什么？ 如何接近他，如何与他建立正常的有效工作关系？ 您还可以通过在计算机上创建一个用于组装和测试项目的工作服务，将我们的经验运用到自己身上。 <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">目录内容</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td colspan="4" align="center"><h3> 目录内容 </h3></td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.为什么是BuildBot？</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2. BuildMaster领导的概念</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.安装</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.第一步</a> </td></tr><tr><td colspan="4" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.配置。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">逐步食谱</a> </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.1 BuildmasterConfig</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.2工人</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.3 change_source</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.4排放者</a> </td></tr><tr><td colspan="2" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.5建造工厂</a> </td><td colspan="2" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.6建筑商</a> </td></tr><tr><td colspan="4" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">6.自己的配置示例</a> </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">6.1在通往master.cfg的途中</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">6.2使用svn</a> </td><td colspan="2">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">6.3给您的信：记者有权声明</a> </td></tr><tr><td colspan="4" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我们做到了！</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">恭喜你</a> </td></tr></tbody></table></div><br></div></div><br><a name="Why"></a><h3>  1.为什么是BuildBot？ </h3><hr><br> 早在habr-e时，我遇到了有关使用<b>BuildBot</b>实现<i>持续集成的</i> <b>文章</b> 。 例如，在我看来， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这</a>是最有用的。 还有另一个例子- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">更简单</a> 。 这些文章可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">手册中的示例</a>进行调味，之后是英语。 轿跑车是一个很好的起点。 阅读完这些文章之后，您可能会立即想要在<b>BuildBot</b>上做一些事情。 <br><br> 别说了 有人在项目中使用过吗？ 事实是， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">许多人已将其</a>应用于任务中。 您可以在Google代码档案中找到使用<b>BuildBot的</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">示例</a> 。 <br><br> 那么人们使用<b>buildbot</b>的逻辑是什么？ 毕竟，还有其他工具： <b>CruiseControl</b>和<b>Jenkins</b> 。 我会这样回答。 对于大多数任务， <b>詹金斯</b>确实足够了。  <b>BuildBot</b>则更具适应性，并且在那里的任务像在<b>Jenkins中</b>一样容易解决。 选择你 但是，由于我们正在寻找用于开发目标项目的工具，所以为什么不选择一个允许我们从简单的步骤开始，获得具有交互性和独特界面的构建系统的工具。 <br><br> 对于那些目标项目是用python编写的人来说，就会出现一个问题：“为什么不选择一个在项目所用语言方面具有清晰界面的集成系统？”。 然后是时候介绍<b>BuildBot</b>的好处了。 <br><blockquote> 因此，我们的“乐器四重奏”。 我自己定义了<b>BuildBot</b>的四个功能： <br><ol><li> 这是GPL下的开源框架 </li><li> 这是使用python作为配置工具并描述了所需的操作。 </li><li> 这是从发生装配的机器接收响应的机会。 </li><li> 这些最终是主机的最低要求。 部署需要使用python和twisted，并且不需要虚拟机或java机器。 </li></ol><br></blockquote><a name="Concepts"></a><h3>  2. BuildMaster领导的概念 </h3><hr><br><img src="https://habrastorage.org/webt/so/qs/u1/soqsu1skae_0xuktzdemfv-n3yq.png" alt="BuildBot BuildMaster"><br><br> 任务分发架构的中心是<b>BuildMaster</b> 。 它是一项服务： <br><br><ul><li>  <b>跟踪</b>项目源代码树中的更改 </li><li>  <b>发送</b>工人服务应执行以构建项目并对其进行测试<b>的</b>命令 </li><li>  <b>通知</b>用户所采取措施的结果 </li></ul><br>  <b>BuildMaster是</b>通过<i>master.cfg</i>文件配置的。 该文件位于<b>BuildMaster</b>的根目录。 稍后，我将说明如何创建此根。  <i>master.cfg</i>文件<i>本身</i>包含python，这是一个使用<b>BuildBot</b>调用的脚本。 <br><br> 下一个最重要的<b>BuildBot</b>称为<b>Worker</b> 。 此服务可以在具有不同操作系统的其他主机上运行，​​也可以在<b>BuildMaster</b>所在的位置上<b>运行</b> 。 它也可以存在于具有其自己的程序包和变量的经过特殊准备的虚拟环境中。 可以使用<i>vertualenv，venv</i>等python实用工具准备这些虚拟环境。 <br><br>  <b>BuildMaster</b>将命令广播给每个<b>Worker</b> ，然后由他们执行它们。 也就是说，事实证明，构建和测试项目的过程可以转到Windows下的<b>Worker</b>以及Linux下的另一个Worker。 <br><br> 项目源代码<i>的检出</i>发生在每个<b>Worker上</b> 。 <br><br><a name="Install"></a><h3>  3.安装 </h3><hr><br> 所以走吧 我将使用Ubuntu 18.04作为主机。 在其上，我将放置一个<b>BuildMaster</b> -a和一个<b>Worker</b> -a。 但首先您需要安装python3.7： <br><br><pre><code class="bash hljs">sudo apt-get update sudo apt-get install python3.7</code> </pre> <br> 对于需要python3.7.2而不是3.7.1的用户，可以执行以下操作： <br><br><pre> <code class="bash hljs">sudo apt-get update sudo apt-get software-properties-common sudo add-apt-repository ppa:deadsnakes/ppa sudo apt-get install python3.7 sudo ln -fs /usr/bin/python3.7 /usr/bin/python3 pip3 install --upgrade pip</code> </pre><br> 下一步是安装<i>Twited</i>和<b>BuildBot</b>以及启用其他<b>BuildBot</b> -a功能的软件包。 <br><br><pre> <code class="bash hljs">/*   sudo        /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib/python3.7/dist-packages*/ <span class="hljs-comment"><span class="hljs-comment">#     Worker- sudo pip install twisted # twisted sudo pip install buildbot #BuildMaster #  pip install pysqlite3 #  sqllite    pip install jinja2 #framework  django,  web     pip install autobahn #Web c   BuildMaster-&gt;Worker pip install sqlalchemy sqlalchemy-migrate #     # Web  BuildBot-a pip install buildbot-www buildbot-grid-view buildbot-console-view buildbot-waterfall-view pip install python-dateutil #   web #         pip install buildbot-worker #Worker #  sudo pip install virtualenv # </span></span></code> </pre><br><a name="master"></a><h3>  4.第一步 </h3><hr><br> 是时候创建一个<b>BuildMaster了</b> 。 我们将把它放在文件夹<i>/ home / habr / master中</i> 。 <br><pre> <code class="bash hljs">mkdir master buildbot create-master master <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre> <br><a name="createworker"></a> 下一步。 创建一个<b>工人</b> 。 我们将把它放在文件夹<i>/ home / habr / worker中</i> 。 <br><pre> <code class="bash hljs">mkdir worker buildbot-worker create-worker --<span class="hljs-built_in"><span class="hljs-built_in">umask</span></span>=0o22 --keepalive=60 worker localhost:4000 yourWorkerName password</code> </pre><br> 启动<b>Worker时</b> ，默认情况下，它将在<i>/ home / habr / worker中</i>创建一个文件夹，其中包含项目的名称，该名称在<i>master.cfg中</i>指定。 然后在带有项目名称的文件夹中，他将创建<i>构建</i>目录，然后在其中进行<i>签出</i> 。  <b>Worker</b>的工作目录将是目录<i>/ home / habr / yourProject / build</i> 。 <br><br>  <b>金钥匙</b> <br> 现在，对于我之前写的内容：由于该脚本没有运行权限，因此将不会执行<b>Master</b>将要求<b>Worker</b>在该目录中远程执行的脚本。 要解决这种情况，您需要一把钥匙 <a name="umask"></a>  <i>--umask = 0o22</i> ，这禁止写入该目录，但<i>保留</i>启动权限。 我们只需要这个。 <br><br>  <b>BuildMaster</b>和<b>Worker</b>之间建立了联系。 碰巧它中断了， <b>Worker</b>等待<b>BuildMaster</b>的响应一段时间。 如果未收到响应，则重新启动连接。 密钥<b>--keepalive = 60</b>正是您需要指示<i>连接</i>重新启动之后的时间。 <br><br><a name="Recept"></a><h3>  5.配置。 逐步食谱 </h3><hr><br>  <b>BuildMaster</b>配置在机器端完成，我们在其中运行了<i>create-master</i>命令。 在我们的例子中，这是目录<i>/ home / habr / master</i> 。  <i>master.cfg</i>配置文件尚不存在，但是命令本身已经创建了<i>master.cmg.sample</i>文件。 您需要将其在<i>master.cfg.sample中</i>重命名为<i>master.cfg</i> <br><pre> <code class="bash hljs">mv master.cfg.sample master.cfg</code> </pre> <br>  <i>让我们</i>打开这个<i>master.cfg</i> 。 我们将分析它的组成。 之后，我们将尝试制作自己的配置文件。 <br><br><div class="spoiler">  <b class="spoiler_title">master.cfg</b> <div class="spoiler_text"><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>].append(changes.GitPoller( <span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, workdir=<span class="hljs-string"><span class="hljs-string">'gitpoller-workdir'</span></span>, branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>, pollInterval=<span class="hljs-number"><span class="hljs-number">300</span></span>)) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"all"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>), treeStableTimer=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>])) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.ForceScheduler( name=<span class="hljs-string"><span class="hljs-string">"force"</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>])) factory = util.BuildFactory() factory.addStep(steps.Git(repourl=<span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'incremental'</span></span>)) factory.addStep(steps.ShellCommand(command=[<span class="hljs-string"><span class="hljs-string">"trial"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>], env={<span class="hljs-string"><span class="hljs-string">"PYTHONPATH"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>})) c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append( util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>, workernames=[<span class="hljs-string"><span class="hljs-string">"example-worker"</span></span>], factory=factory)) c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] = <span class="hljs-string"><span class="hljs-string">"Hello World CI"</span></span> c[<span class="hljs-string"><span class="hljs-string">'titleURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"https://buildbot.github.io/hello-world/"</span></span> c[<span class="hljs-string"><span class="hljs-string">'buildbotURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"http://localhost:8010/"</span></span> c[<span class="hljs-string"><span class="hljs-string">'www'</span></span>] = dict(port=<span class="hljs-number"><span class="hljs-number">8010</span></span>, plugins=dict(waterfall_view={}, console_view={}, grid_view={})) c[<span class="hljs-string"><span class="hljs-string">'db'</span></span>] = { <span class="hljs-string"><span class="hljs-string">'db_url'</span></span> : <span class="hljs-string"><span class="hljs-string">"sqlite:///state.sqlite"</span></span>, }</code> </pre><br></div></div><br><a name="BC"></a><h4>  <u>5.1 BuildmasterConfig</u> </h4><br><pre> <code class="python hljs">c = BuildmasterConfig = {}</code> </pre> <br>  <i>BuildmasterConfig-</i>配置文件的基本字典。 它必须包含在配置文件中。 为了易于使用，在配置代码中输入了别名<i>“ c”</i> 。  <i>c [“ keyFromDist”]</i>中的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">键</a>名是用于与<i>BuildMaster</i>进行交互的固定元素。 在每个键下，将相应的对象替换为一个值。 <br><br><a name="Worker"></a><h4>  <u>5.2工人</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'workers'</span></span>] = [worker.Worker(<span class="hljs-string"><span class="hljs-string">"example-worker"</span></span>, <span class="hljs-string"><span class="hljs-string">"pass"</span></span>)]</code> </pre> <br> 这次我们指出了<b>BuildMaster</b> <b>工人</b>列表。 我们通过指定<i>you-worker-name</i>和<i>password</i>在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上面</a>创建了<b>Worker</b> 。 现在必须指定它们，而不是<i>example-worker</i>和<i>pass</i> 。 <br><br><a name="CS"></a><h4>  <u>5.3 change_source</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>].append(changes.GitPoller( <span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, workdir=<span class="hljs-string"><span class="hljs-string">'gitpoller-workdir'</span></span>, branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>, pollInterval=<span class="hljs-number"><span class="hljs-number">300</span></span>))</code> </pre><br>  <i>使用c</i>词典<i>的change_source</i>键，我们可以访问列表，该列表将您要放置的项目的源代码轮询存储库。 该示例使用Git存储库，该存储库会定期轮询。 <br><br> 第一个参数是存储库的路径。 <br><br>  <i>workdir</i>是指向<b>Worker</b>一侧的文件夹的路径，相对于<i>/ home / habr / worker / yourProject / build</i>路径<i>，</i> git将存储版本库的本地版本。 <br><br>  <i>分支</i>包含存储库中应监视的特定分支。 <br><br>  <i>pollInterval</i>包含<b>BuildMaster</b>将轮询存储库以查找更改的秒数。 <br><br> 有几种方法可以跟踪项目存储库中的更改。 <br><br> 最简单的方法是<i>Polling</i> ，这意味着<b>BuildMaster会</b>定期使用存储库轮询服务器。 如果<i>提交</i>反映了存储库中的更改，则<b>BuildMaster</b>会<b>稍有</b>延迟地创建一个内部<i>Change</i>对象，并将其发送到<i>Scheduler</i>事件处理程序，该事件处理程序将开始在<i>Worker</i>上构建和测试项目的步骤。 在这些步骤中，将指示存储库的<i>更新</i> 。 在<b>Worker</b>上将创建存储库的本地副本。 该过程的详细信息将在下面的两个部分<b>（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.4</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.5</a> ）中</b>公开。 <br><br> 跟踪存储库中的更改的一种更为优雅的方法是直接从其所在的服务器向<b>BuildMaster发送</b>有关更改项目源代码的消息。 在这种情况下，一旦开发人员进行了<i>提交</i> ，具有项目存储库的服务器就会向<b>BuildMaster</b>发送一条消息。 然后，将通过创建<i>PBChangeSource</i>对象来拦截该对象。 此外，该对象将被传送到<i>Scheduler</i> ，后者将激活项目的组装和测试步骤。 该方法的重要部分是使用存储库中的服务器<i>挂钩</i>脚本。 在负责处理<i>提交</i>期间操作的<i>挂钩</i>脚本中，您需要调用<i>sendchange</i>实用程序并指定<i>BuildMaster</i>的网络地址。 您必须<i>指定</i>将侦听<i>PBChangeSource的</i>网络端口。  <i>顺便说一句</i> ， <i>PBChangeSource是BuildMaster的</i>一部分。 此方法在项目存储库所在的服务器上需要<i>admin</i> -a特权。 首先，您需要制作一个备份存储库。 <br><br><a name="shedulers"></a><h4>  <u>5.4排放者</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"all"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>), treeStableTimer=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>])) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.ForceScheduler( name=<span class="hljs-string"><span class="hljs-string">"force"</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>]))</code> </pre><br>  <i>调度程序</i>是一个元素，可作为触发器运行项目的整个组装和测试链。 <br><img src="https://habrastorage.org/webt/sh/1j/jo/sh1jjoo3rog47fsyjgqgorizyfs.png" alt="Buildbot卸载程序"><br><br> 由<i>change_source</i>记录的那些更改在<b>BuildBot</b> -a操作期间被转换为<i>Change</i>对象，现在每个基于它们的<i>Sheduler</i>都生成了启动项目构建过程的请求。 但是，它也确定何时将这些请求发送到队列。 对象 <a name="builder"></a>  <i>Builder</i>保留请求队列，并在单独的<b>Worker</b> -e上监视当前程序集的状态。  <b>BuildMaster</b> -e和<b>Worker</b> -e上<b>都</b>存在<i>Builder</i> 。 他将特定的<i>构建</i>从<b>BuildMaster</b>发送到<b>Worker</b> ，必须遵循一系列步骤。 <br> 我们看到，在此类<i>调度程序</i>的当前示例中，创建了2件。 而且，每个都有自己的类型。 <br><br>  <i>SingleBranchScheduler</i>是最受欢迎的日程表类之一。 它监视一个分支，并由其中的记录更改触发。 当他看到更改时，可以推迟发送构造请求（推迟特殊参数<i>treeStableTimer中</i>指定的时间段）。 该<i>名称</i>指定将在<b>BuildBot</b> -web界面中显示的调度的名称。 在<i>ChangeFilter中</i>设置一个<i>过滤器</i>后，分支中的更改将通过该<i>过滤器</i>提示时间表以发送构建请求。 在<i>builderNames中</i>指定了名称<i>builder</i> -a，稍后再指定。 在我们的案例中，该名称将与项目的名称相同： <i>yourProject</i> 。 <br><br>  <i>ForceScheduler是一件</i>非常简单的事情。 这种类型的计划是通过在<b>BuildBot</b> -web界面上单击鼠标触发的。 参数与<i>SingleBranchScheduler</i>具有相同的本质。 <br><br>  <b>PS 3号</b>  <b>突然派上用场</b> <br>  <i>定期</i>是按特定的固定频率触发的计划。 看起来像这样的电话 <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buildbot.plugins <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> schedulers nightly = schedulers.Periodic(name=<span class="hljs-string"><span class="hljs-string">"daily"</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"full-solaris"</span></span>], periodicBuildTimer=<span class="hljs-number"><span class="hljs-number">24</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [nightly]</code> </pre><br><a name="buildfactory"></a><h4>  <u>5.5建造工厂</u> </h4><br><pre> <code class="python hljs">factory = util.BuildFactory() factory.addStep(steps.Git(repourl=<span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'incremental'</span></span>)) factory.addStep(steps.ShellCommand(command=[<span class="hljs-string"><span class="hljs-string">"trial"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>], env={<span class="hljs-string"><span class="hljs-string">"PYTHONPATH"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>}))</code> </pre><br>  <i>PeriodicalBuildTimer</i>以秒为单位设置此周期性的时间。 <br><br>  <i>BuildFactory</i>创建一个具体的<i>构建</i> ，然后<i>构建器</i>将其发送给<b>Worker</b> 。  <i>BuildFactory</i>指示<b>Worker</b>应该遵循的步骤。 通过调用<i>addStep</i>方法添加步骤<i>。</i> <i><br></i> <br><br> 在此示例中添加的第一步是<i>git clean -d -f -f –x</i> ，然后是<i>git checkout</i> 。 这些动作嵌入在<i>方法</i>参数中，该参数未明确指出，但暗含了默认值<i>fresh</i> 。  <i>mode ='incremental'</i>参数指示完成存储的目录中的文件（尽管从存储库中丢失）保持不变。 <br><br> 添加的第二个步骤是使用环境变量PATHONPATH = ...从目录<i>/ home / habr / worker / yourProject / build中</i>使用带有变量<i>hello的hello</i>参数调用<i>试验</i>脚本，因此您可以编写自己的脚本并在<b>Worker</b>端执行-a通过<i>util.ShellCommand</i>步骤。 这些脚本可以直接放入存储库中。 然后在<i>开票</i>期间，他们将转到<i>/ home / habr / worker / yourProject / build</i> 。 但是，这里有两个“ buts”： <br><ol><li> 必须使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><i>--umask开关</i></a>创建<b>Worker</b> ，以便在<i>签出</i> -a之后不会阻止执行权限。 </li><li> 当<i>git push</i>这些脚本时，必须指定<i>exacutable</i>属性，以便使用<i>chechout</i> -e Git不会失去执行脚本的权利。 </li></ol><br><br><a name="builders"></a><h4>  <u>5.6建筑商</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append(util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>, workernames=[<span class="hljs-string"><span class="hljs-string">"example-worker"</span></span>], factory=factory))</code> </pre><br> 关于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>描述<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">了</a>什么<i>Builder</i> 。 现在，我将详细讨论如何创建它。  <i>BuilderConfig</i>是构造函数<i>builder</i> 。 您可以在<i>c ['builders']中</i>指定多个此类构造函数，因为这是一系列构造<i>器</i>类型对象的列表。 现在，我们将稍微重写<b>BuildBot中</b>的示例，使其更接近我们的任务。 <br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append(util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>, workernames=[<span class="hljs-string"><span class="hljs-string">"yourWorkerName"</span></span>], factory=factory))</code> </pre><br> 现在，我将介绍参数<i>BuilderConfig</i> 。 <br><br>  <i>name</i>设置名称<i>构建器</i> -a。 在这里，我们将其称为<i>yourProject</i> 。 这意味着将在<b>Worker上创建</b>此路径<i>/ home / habr / worker / yourProject / build</i> 。  <i>Sheduler</i>用该名称搜索<i>构建器</i> 。 <br><br>  <i>workernames</i>包含一个<b>Workers</b>列表。 每个都必须添加到<i>c ['workers']中</i> 。 <br><br>  <i>factory</i>是与<i>构建器</i>关联的特定<i>构建</i> 。 它将向<i>构建器</i>发送一个<i>构建</i>对象，以完成构成该<i>构建</i> -a的所有步骤。 <br><br><a name="myconfig"></a><h3>  6.自己的配置示例 </h3><hr><br> 这是我建议通过<b>BuildBot</b>实现的示例项目架构 <b><br></b>  。 <br><br> 我们将使用<i>svn</i>作为版本控制系统。 存储库本身将位于特定的云中。 这是此云的地址<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">svn.host/svn/yourProject/trunk</a></i> 。 在<i>svn</i>下的云中，有一个用户名： <i>user</i> ，passwd： <i>密码</i>帐户。 作为<i>build</i> -a步骤的脚本也将位于<i>svn</i>分支的单独<i>buildbot / worker_linux文件夹中</i> 。 这些脚本位于存储库中，并保存了<i>可执行文件</i>属性。 <br><br>  <b>BuildMaster</b>和<b>Worker</b>在同一<i>project.host</i>主机上工作。  <b>BuildMaster</b>将其文件存储在<i>/ home / habr / master</i>文件夹中。  <b>Worker</b>存储以下路径<i>/ home / habr / worker</i> 。  <b>BuildMaster</b>和<b>Worker</b>进程之间的通信是使用<b>BuildBot</b> -a协议（即<i>“ pb”</i>协议）通过4000端口进行的。 <br><br> 目标项目完全用python编写。 任务是跟踪其更改，创建可执行文件，生成文档，进行测试。 万一发生故障，所有开发人员都需要向邮件发送一条消息，说明操作失败。 <br><br> 我们将把<b>BuildBot</b> Web映射连接到<i>project.host的</i>端口80。 修补程序是可选的。  <i>扭曲的</i>库已经有一个Web服务器， <b>BuildBot</b>使用它。 <br><br>  <b>我们</b>将使用<i>sqlite</i>存储<b>BuildBot的</b>内部信息。 <br><br> 对于邮件发送，您需要主机<i>smtp.your.domain-</i>它允许从<i>projectHost@your.domain</i>发送电子邮件而无需身份验证。 同样在主机“ <i>smtp</i> ”上，该协议在1025年被侦听。 <br><br> 此过程涉及两个人： <i>admin</i>和<i>user</i> 。  admin管理<b>BuildBot</b> 。 用户是提交提交的<i>人</i> 。 <br><br> 可执行文件是通过<i>pyinstaller</i>生成的。 文档是通过<i>doxygen</i>生成的。 <br><br> 对于这种架构，我编写了这个<i>master.cfg</i> ： <br><br><div class="spoiler">  <b class="spoiler_title">master.cfg</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buildbot.plugins <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> steps, util, schedulers, worker, changes, reporters c= BuildmasterConfig ={} c[<span class="hljs-string"><span class="hljs-string">'workers'</span></span>] = [ worker.Worker(<span class="hljs-string"><span class="hljs-string">'yourWorkerName'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>) ] c[<span class="hljs-string"><span class="hljs-string">'protocols'</span></span>] = {<span class="hljs-string"><span class="hljs-string">'pb'</span></span>: {<span class="hljs-string"><span class="hljs-string">'port'</span></span>: <span class="hljs-number"><span class="hljs-number">4000</span></span>}} svn_poller = changes.SVNPoller(repourl=<span class="hljs-string"><span class="hljs-string">"https://svn.host/svn/yourProject/trunk"</span></span>, svnuser=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, svnpasswd=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, pollinterval=<span class="hljs-number"><span class="hljs-number">60</span></span>, split_file=util.svn.split_file_alwaystrunk ) c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = svn_poller hourlyscheduler = schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"your-project-schedulers"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>), builderNames=[<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>], properties = {<span class="hljs-string"><span class="hljs-string">'owner'</span></span>: <span class="hljs-string"><span class="hljs-string">'admin'</span></span>} ) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [hourlyscheduler] checkout = steps.SVN(repourl=<span class="hljs-string"><span class="hljs-string">'https://svn.host/svn/yourProject/trunk'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'full'</span></span>, method=<span class="hljs-string"><span class="hljs-string">'fresh'</span></span>, username=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, password=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, haltOnFailure=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) projectHost_build = util.BuildFactory() cleanProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Clean"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"buildbot/worker_linux/pyinstaller_project"</span></span>, <span class="hljs-string"><span class="hljs-string">"clean"</span></span>] ) buildProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Build"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"buildbot/worker_linux/pyinstaller_project"</span></span>, <span class="hljs-string"><span class="hljs-string">"build"</span></span>] ) doxyProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Update Docs"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"buildbot/worker_linux/gendoc"</span></span>, []] ) testProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Tests"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"python"</span></span>,<span class="hljs-string"><span class="hljs-string">"tests/utest.py"</span></span>], env={<span class="hljs-string"><span class="hljs-string">'PYTHONPATH'</span></span>: <span class="hljs-string"><span class="hljs-string">'.'</span></span>} ) projectHost_build.addStep(checkout) projectHost_build.addStep(cleanProject) projectHost_build.addStep(buildProject) projectHost_build.addStep(doxyProject) projectHost_build.addStep(testProject) c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [ util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>, workername=<span class="hljs-string"><span class="hljs-string">'yourWorkerName'</span></span>, factory=projectHost_build) ] template_html=<span class="hljs-string"><span class="hljs-string">u'''\ &lt;h4&gt;  : {{ summary }}&lt;/h4&gt; &lt;p&gt;   : {{ workername }}&lt;/p&gt; &lt;p&gt;: {{ projects }}&lt;/p&gt; &lt;p&gt;         : {{ buildbot_url }}&lt;/p&gt; &lt;p&gt;         : {{ build_url }}&lt;/p&gt; &lt;p&gt; WinSCP     c ip:xxx.xx.xxx.xx.   habr/password,   executable    ~/worker/yourProject/build/dist.&lt;/p&gt; &lt;p&gt;&lt;b&gt;    Buildbot&lt;/b&gt;&lt;/p&gt; '''</span></span> sendMessageToAll = reporters.MailNotifier(fromaddr=<span class="hljs-string"><span class="hljs-string">"projectHost@your.domain"</span></span>, sendToInterestedUsers=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, lookup=<span class="hljs-string"><span class="hljs-string">"your.domain"</span></span>, relayhost=<span class="hljs-string"><span class="hljs-string">"smtp.your.domain"</span></span>, smtpPort=<span class="hljs-number"><span class="hljs-number">1025</span></span>, mode=<span class="hljs-string"><span class="hljs-string">"warnings"</span></span>, extraRecipients=[<span class="hljs-string"><span class="hljs-string">'user@your.domain'</span></span>], messageFormatter=reporters.MessageFormatter( template=template_html, template_type=<span class="hljs-string"><span class="hljs-string">'html'</span></span>, wantProperties=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, wantSteps=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ) c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [sendMessageToAll] c[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] = <span class="hljs-string"><span class="hljs-string">"The process of bulding"</span></span> c[<span class="hljs-string"><span class="hljs-string">'titleURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"http://project.host:80/"</span></span> c[<span class="hljs-string"><span class="hljs-string">'buildbotURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"http://project.host"</span></span> c[<span class="hljs-string"><span class="hljs-string">'www'</span></span>] = dict(port=<span class="hljs-number"><span class="hljs-number">80</span></span>, plugins=dict(waterfall_view={}, console_view={}, grid_view={})) c[<span class="hljs-string"><span class="hljs-string">'db'</span></span>] = { <span class="hljs-string"><span class="hljs-string">'db_url'</span></span> : <span class="hljs-string"><span class="hljs-string">"sqlite:///state.sqlite"</span></span> }</code> </pre><br></div></div><br> 首先，您需要<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">创建</a> <b>BuildMaster</b>和<b>Worker</b> -a。 然后将此<i>master.cfg</i>文件粘贴到<i>/ home / habr / master中</i> 。 <br><br> 下一步是启动<b>BuildMaster</b>服务 <br><pre> <code class="bash hljs">sudo buildbot start /home/habr/master</code> </pre><br> 然后启动<b>Worker</b> -a服务 <br><pre> <code class="bash hljs">buildbot-worker start /home/habr/worker</code> </pre><br> 做完了！ 现在， <b>Buildbot</b>将跟踪更改并在<i>svn中的</i> <i>commit</i>上<b>执行</b> ，遵循使用上述架构构建和测试项目的步骤。 <br><br> 下面，我将描述上述<i>master.cfg的</i>一些功能<i>。</i> <i><br></i> <br><br><a name="fails"></a><h4>  <u>6.1在通往master.cfg的途中</u> </h4><br> 在编写<i>master.cfg时，会</i>发生很多错误，因此您需要读取日志文件。 它既存储在<i>BuildMaster</i> -ec绝对路径<i>/home/habr/master/twistd.log</i>上，又存储在<b>Worker</b> -a侧，绝对路径为<i>/home/habr/worker/twistd.log</i> 。 当您阅读并修复错误时，将需要重新启动<b>BuildMaster</b> -a服务。 方法如下： <br><pre> <code class="bash hljs">sudo buildbot stop /home/habr/master sudo buildbot upgrade-master /home/habr/master sudo buildbot start /home/habr/master</code> </pre><br><a name="svn"></a><h4>  <u>6.2使用svn</u> </h4><br><pre> <code class="python hljs">svn_poller = changes.SVNPoller(repourl=<span class="hljs-string"><span class="hljs-string">"https://svn.host/svn/yourProject/trunk"</span></span>, svnuser=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, svnpasswd=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, pollinterval=<span class="hljs-number"><span class="hljs-number">60</span></span>, split_file=util.svn.split_file_alwaystrunk ) c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = svn_poller hourlyscheduler = schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"your-project-schedulers"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>), builderNames=[<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>], properties = {<span class="hljs-string"><span class="hljs-string">'owner'</span></span>: <span class="hljs-string"><span class="hljs-string">'admin'</span></span>} ) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [hourlyscheduler] checkout = steps.SVN(repourl=<span class="hljs-string"><span class="hljs-string">'https://svn.host/svn/yourProject/trunk'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'full'</span></span>, method=<span class="hljs-string"><span class="hljs-string">'fresh'</span></span>, username=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, password=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, haltOnFailure=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br> 首先，看一下<i>svn_poller</i> 。 该接口与每分钟定期轮询存储库的接口相同。 在这种情况下， <i>svn_poller</i>仅访问<i>中继</i>分支。 神秘的参数<i>split_file = util.svn.split_file_alwaystrunk</i>设置规则：如何将<i>svn</i>文件夹的结构拆分为分支。 他为他们提供了相对的方式。 反过来， <i>split_file_alwaystrunk</i>通过说只有<i>主干</i>在存储库中来简化了过程。 <br><br> 在<i>Schedulers中</i> ， <i>指定ChangeFilter</i> ，它看到<i>None，</i>并通过<i>split_file_alwaystrunk</i>根据指定的关联将<i>主干</i>分支与其关联。 响应<i>主干中的</i>更改，它将启动名为<i>yourProject</i>的<i>构建器</i> 。 <br><br> 需要此处的<i>属性</i> ，以便管理员作为过程的所有者从装配和测试结果中接收新闻通讯。 <br><br>  <i>build</i> -a <i>checkout</i>步骤能够完全删除<b>Worker</b>存储库的本地版本中的所有文件。 然后执行完整的<i>svn更新</i> 。 该模式通过参数<i>mode = full</i> ， <i>method = fresh进行配置</i> 。  <i>haltOnTailure</i>参数指示，如果<i>svn更新</i> <i>不成功</i> ，则应暂停整个组装和测试过程，因为进一步的步骤没有意义。 <br><br><a name="reporter"></a><h4>  <u>6.3给您的信：记者有权声明</u> </h4><br>  <i>记者</i>是邮件通知服务。 <br><pre> <code class="python hljs">template_html=<span class="hljs-string"><span class="hljs-string">u'''\ &lt;h4&gt;  : {{ summary }}&lt;/h4&gt; &lt;p&gt;   : {{ workername }}&lt;/p&gt; &lt;p&gt;: {{ projects }}&lt;/p&gt; &lt;p&gt;         : {{ buildbot_url }}&lt;/p&gt; &lt;p&gt;         : {{ build_url }}&lt;/p&gt; &lt;p&gt; WinSCP     c ip:xxx.xx.xxx.xx.   habr/password,   executable    ~/worker/yourProject/build/dist.&lt;/p&gt; &lt;p&gt;&lt;b&gt;    Buildbot&lt;/b&gt;&lt;/p&gt; '''</span></span> sendMessageToAll = reporters.MailNotifier(fromaddr=<span class="hljs-string"><span class="hljs-string">"projectHost@your.domain"</span></span>, sendToInterestedUsers=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, lookup=<span class="hljs-string"><span class="hljs-string">"your.domain"</span></span>, relayhost=<span class="hljs-string"><span class="hljs-string">"smtp.your.domain"</span></span>, smtpPort=<span class="hljs-number"><span class="hljs-number">1025</span></span>, mode=<span class="hljs-string"><span class="hljs-string">"warnings"</span></span>, extraRecipients=[<span class="hljs-string"><span class="hljs-string">'user@your.domain'</span></span>], messageFormatter=reporters.MessageFormatter( template=template_html, template_type=<span class="hljs-string"><span class="hljs-string">'html'</span></span>, wantProperties=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, wantSteps=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ) c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [sendMessageToAll]</code> </pre><br> 它可以通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">多种方式</a>发送消息。 <br><br>  <i>MailNotifier</i>使用邮件发送通知。 <br><br>  <i>template_html</i>设置新闻通讯的文本模板。 要创建标记，请使用html。 它是由<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><i>jinja2</i></a>引擎修改的（可以与<i>django</i>进行比较）。  <b>BuildBot</b>具有一组变量，在形成消息文本的过程中，将其值替换为模板。 这些变量刻在{{double花括号}}中。 因此，例如， <i>摘要</i>显示已完成操作的状态，即成功或失败。  <i>项目</i>将输出<i>yourProject</i> 。 因此，使用<i>jinja2</i> ， <i>BuildBot</i>变量和python字符串格式化程序中的控制命令，您可以创建非常有用的消息。 <br><br>  <i>MailNotifier</i>包含以下参数。 <br><br>  <i>fromaddr-</i>每个人都将从其接收新闻通讯的地址。 <br><br>  <i>sendToInterestedUsers</i> = True向进行提交的所有者和用户发送一条消息。 <br><br>  <i>查找</i> -后缀添加到接收时事通讯的用户名中。 因此，作为用户的<i>管理员</i>将通过admin@your.domain接收时事通讯。 <br><br>  <i>relayhost</i>指定打开<i>smtp</i>服务器的主机名， <i>smptPort</i>指定<i>smtp</i>服务器侦听的端口号。 <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mode =“ warning”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示只有在至少一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构建</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">步骤</font><font style="vertical-align: inherit;">以失败或警告状态结束的情况下，</font><font style="vertical-align: inherit;">才应进行邮件发送</font><font style="vertical-align: inherit;">。如果成功，则不需要邮寄。</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extraRecipients</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含一个列表，除了所有者和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">者之外，还应向他们发送邮件</font><font style="vertical-align: inherit;">。</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">messageFormatter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个对象，用于定义消息的格式，其模板以及</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jinja2中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用的变量集</font><font style="vertical-align: inherit;">。诸如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wantProperties = True</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wantSteps = True之类的参数</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定了这组可用变量。</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与['services'] = [sendMessageToAll]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供服务列表，其中包括我们的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记者</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><a name="goodboy"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们做到了！</font><font style="vertical-align: inherit;">恭喜你</font></font></h3><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们创建了自己的配置，并看到了</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BuildBot具备的功能</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我认为，这足以了解是否需要使用此工具来创建您的项目。</font><font style="vertical-align: inherit;">他对你感兴趣吗？</font><font style="vertical-align: inherit;">它会为您派上用场吗？</font><font style="vertical-align: inherit;">方便吗？</font><font style="vertical-align: inherit;">然后，我有充分的理由写这篇文章。</font></font><br><br> 还有一件事。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我希望使用</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BuildBot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的专业社区</font><font style="vertical-align: inherit;">变得更广泛，翻译手册并提供更多示例。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谢谢大家的关注。</font><font style="vertical-align: inherit;">祝你好运</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN460501/">https://habr.com/ru/post/zh-CN460501/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN460491/index.html">具有发送和绘图功能的Arduino温度和湿度传感器（第1部分）</a></li>
<li><a href="../zh-CN460493/index.html">80年代用于PC的“杀手级应用”：VisiCalc和WordStar</a></li>
<li><a href="../zh-CN460495/index.html">容器到管道：CRI-O现在是OpenShift Container Platform 4中的默认容器</a></li>
<li><a href="../zh-CN460497/index.html">马尔可夫链在蒙特卡洛方法中的直观使用</a></li>
<li><a href="../zh-CN460499/index.html">Dijkstra奖的三位获奖者：Hydra 2019和SPTDC 2019如何</a></li>
<li><a href="../zh-CN460503/index.html">Raspberry PI 3 B +的无线配置</a></li>
<li><a href="../zh-CN460505/index.html">吸引三个十字架，或者为什么项目如此难以按时完成</a></li>
<li><a href="../zh-CN460507/index.html">XEN与汽车的未来：开源管理程序如何成为商用汽车解决方案的竞争对手</a></li>
<li><a href="../zh-CN460509/index.html">居民代理如何为企业提供帮助：在数据挖掘中使用Infatica的真实案例</a></li>
<li><a href="../zh-CN460511/index.html">PHP-FPM调优：使用pm static可获得最佳性能</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>