<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฐ๐พ ๐ ๐ง๐ฟ ุฃูุช ูุจุฑุงุฏ ุจูุช 99ูช ๐ ๐คต ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุญู ูู ูุณู ุงูุชุญูููุงุช ูู ุงูุณูููุง ุนุจุฑ ุงูุฅูุชุฑูุช Okko ูุญุจ ุฃุชูุชุฉ ุญุณุงุจ ุฑุณูู ูููู Alexander Nevsky ูุฏุฑ ุงูุฅููุงู ุ ููู ููุช ุงููุฑุงุบ ูุชุนูู ุฃุดูุงุก ุฌุฏูุฏุฉ ูุชูููุฐ ุฃุดูุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฃูุช ูุจุฑุงุฏ ุจูุช 99ูช</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/okko/blog/417329/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bg/8z/-p/bg8z-pmvxneor2kulnu9tmg3qoy.jpeg" alt="ุบุฏุง ูู ุงุฌุงุฒุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูุญู ูู ูุณู ุงูุชุญูููุงุช ูู ุงูุณูููุง ุนุจุฑ ุงูุฅูุชุฑูุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Okko</a> ูุญุจ ุฃุชูุชุฉ ุญุณุงุจ ุฑุณูู ูููู Alexander Nevsky ูุฏุฑ ุงูุฅููุงู ุ ููู ููุช ุงููุฑุงุบ ูุชุนูู ุฃุดูุงุก ุฌุฏูุฏุฉ ูุชูููุฐ ุฃุดูุงุก ุฑุงุฆุนุฉ ุชุชุฑุฌู ูุณุจุจ ูุง ุนุงุฏุฉ ุฅูู ุจุฑุงูุฌ ุงูุฑูุจูุช ูู Telegram.  ุนูู ุณุจูู ุงููุซุงู ุ ูุจู ุจุฏุก ูุฃุณ ุงูุนุงูู 2018 FIFA ุ ูููุง ุจุชุทุจูู ุฑูุจูุช ุนูู ุฏุฑุฏุดุฉ ุงูุนูู ุ ูุงูุชู ุฌูุนุช ุงูุฑูุงูุงุช ุนูู ุชูุฒูุน ุงูุฃูุงูู ุงูููุงุฆูุฉ ุ ูุจุนุฏ ุงููุจุงุฑุงุฉ ุงูููุงุฆูุฉ ุ ูููุง ุจุญุณุงุจ ุงููุชุงุฆุฌ ููููุง ููููุงุณ ุชู ุงุฎุชุฑุงุนู ูุณุจููุง ูุชุญุฏูุฏ ุงููุงุฆุฒูู.  ูุฑูุงุชูุง ูู ุชุถุน ุฃุฑุจุนุฉ ูู ุงููุฑุงูุฒ ุงูุฃุฑุจุนุฉ ุงูุฃููู. </p><br><p style=";text-align:right;direction:rtl">  ููุช ุงููุฑุงุบ ุงูุฃุฎูุฑ ูู ุชุฌููุน ุงูููููุฏูุง โโุงูุฑูุณูุฉ TOP-10 ุงูุชู ูุฑุณูุงูุง ูุฅูุดุงุก <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฑูุจูุช</a> ูุฌุฏ ุงููุดุงููุฑ ุงูุฐูู ูุดุจููู ุงููุณุชุฎุฏู.  ูู ุฏุฑุฏุดุฉ ุงูุนูู ุ ูุฏุฑ ุงูุฌููุน ุงูููุฑุฉ ูุซูุฑูุง ูุฏุฑุฌุฉ ุฃููุง ูุฑุฑูุง ุฅุชุงุญุฉ ุงูุฑูุจูุช ููุฌูููุฑ.  ูู ูุฐู ุงูููุงูุฉ ุ ูุชุฐูุฑ ุจุฅูุฌุงุฒ ุงููุธุฑูุฉ ุ ููุชุญุฏุซ ุนู ุฅูุดุงุก ุฑูุจูุชูุง ูููููุฉ ุงูููุงู ุจุฐูู ุจููุณู. </p><a name="habracut"></a><br><h1 id="nemnogo-teorii-v-osnovnom-v-kartinkah" style=";text-align:right;direction:rtl">  ุงููููู ูู ุงููุธุฑูุฉ (ุบุงูุจูุง ูู ุงูุตูุฑ) </h1><br><p style=";text-align:right;direction:rtl"> ุจุงูุชูุตูู ุญูู ููููุฉ ุชุฑุชูุจ ุฃูุธูุฉ ุงูุชุนุฑู ุนูู ุงููุฌูู ุ ุชุญุฏุซุช ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุญุฏู ููุงูุงุชู ุงูุณุงุจูุฉ</a> .  ูููู ูููุงุฑุฆ ุงูููุชู ุงุชุจุงุน ุงูุฑุงุจุท ุ ูุณุฃูุถุญ ุฃุฏูุงู ุงูููุงุท ุงูุฑุฆูุณูุฉ ููุท. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุ ูุฏูู ุตูุฑุฉ ุ ุฑุจูุง ุ ุญุชู ูุธูุฑ ูุฌู ูุชุฑูุฏ ุฃู ุชููู ูู ูู.  ููููุงู ุจุฐูู ุ ุชุญุชุงุฌ ุฅูู ุงุชุจุงุน 4 ุฎุทูุงุช ุจุณูุทุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุญุฏุฏ ุงููุณุชุทูู ุงููุญูุท ุจุงููุฌู. </li><li style=";text-align:right;direction:rtl">  ูู ุจุชูููุฒ ุงูููุงุท ุงูุฑุฆูุณูุฉ ูููุฌู. </li><li style=";text-align:right;direction:rtl">  ูู ุจูุญุงุฐุงุฉ ูุฌูู ูุงูุชุตุงุตู. </li><li style=";text-align:right;direction:rtl">  ุชุญููู ุตูุฑุฉ ูุฌู ุฅูู ุจุนุถ ุงูุชูุซูู ุงูููุณุฑ ุขูููุง. </li><li style=";text-align:right;direction:rtl">  ูุงุฑู ูุฐุง ุงูุฑุฃู ูุน ุงูุขุฎุฑูู ุงููุชุงุญูู ูุฏูู. </li></ol><br><h3 id="vydelenie-lica" style=";text-align:right;direction:rtl">  ุงุฎุชูุงุฑ ุงููุฌู </h3><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุฃู ุงูุดุจูุงุช ุงูุนุตุจูุฉ ุงูุชูุงููููุฉ ูุฏ ุชุนููุช ูุคุฎุฑูุง ููููุฉ ุงูุนุซูุฑ ุนูู ูุฌูู ูู ุตูุฑุฉ ููุณุช ุฃุณูุฃ ูู ุงูุฃุณุงููุจ ุงูููุงุณูููุฉ ุ ุฅูุง ุฃููุง ูุง ุชุฒุงู ุฃุฏูู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">HOG</a> ุงูููุงุณููู ูู ุงูุณุฑุนุฉ ูุณูููุฉ ุงูุงุณุชุฎุฏุงู. </p><br><p style=";text-align:right;direction:rtl">  HOG - ุงูุฑุณูู ุงูุจูุงููุฉ ููุชุฏุฑุฌุงุช ุงูููุฌูุฉ.  ูุฑุจุท ูุฐุง ุงูุฑุฌู ูู ุจูุณู ูู ุตูุฑุฉ ุงููุตุฏุฑ ุจุชุฏุฑุฌู - ููู ูุชุฌู ูู ุงุชุฌุงู ุชุบูุฑ ุณุทูุน ูุญุฏุงุช ุงูุจูุณู ุฃูุซุฑ.  ููุฒุฉ ูุฐุง ุงูููุฌ ูู ุฃูู ูุง ููุชู ุจุงูููู ุงููุทููุฉ ูุณุทูุน ุงูุจูุณู ุ ููุท ูุณุจุฉ ูุงููุฉ.  ูุฐูู ุ ุณูุชู ุนุฑุถ ูุฌู ุนุงุฏู ููุธูู ููุถุงุก ุจุดูู ุณูุก ูุตุงุฎุจ ูู ููุณ ุงููุฏุฑุฌ ุงูุชูุฑุงุฑู ุชูุฑูุจูุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ke/_h/b_/ke_hb_cyd3odkvkwmqb0soancka.png" alt="ุฑุณู ุจูุงูู ูุชุฏุฑุฌุงุช ุงููุฌู ุงูุงุชุฌุงููุฉ"></p><br><p style=";text-align:right;direction:rtl"> ููุณ ูู ุงูุถุฑูุฑู ุญุณุงุจ ุงูุชุฏุฑุฌ ููู ุจูุณู ุ ูููู ุญุณุงุจ ูุชูุณุท โโุงูุชุฏุฑุฌ ููู ูุฑุจุน ุตุบูุฑ <code>n</code> ุจู <code>n</code> .  ุจุงุณุชุฎุฏุงู ุญูู ุงููุชุฌู ุงููุณุชูู ุ ููููู ุจุนุฏ ุฐูู ุงููุฑูุฑ ุนุจุฑ ุจุนุถ ุงููุงุดู ูุน ูุงูุฐุฉ ูุชุญุฏูุฏ ูู ูุงูุฐุฉ ูุฏู ุงุญุชูุงููุฉ ูุฌูุฏ ุงููุฌู ููู.  ูููู ุฃู ูููู ุงููุงุดู SVM ุฃู ุบุงุจุฉ ุนุดูุงุฆูุฉ ุฃู ุฃู ุดูุก ุขุฎุฑ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/mz/hk/2y/mzhk2ycaurneywpy32a0linnm3o.png" alt="ูุดู ุงููุฌู"></p><br><h3 id="vydelenie-klyuchevyh-tochek" style=";text-align:right;direction:rtl">  ูู ุจุชูููุฒ ุงูููุงุท ุงูุฑุฆูุณูุฉ </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/wd/bi/dc/wdbidcix45fpf74iglc7f0f1rpg.png" alt="ุงูููุงุท ุงูุฑุฆูุณูุฉ ููุฌู ุงููุฌู"></p><br><p style=";text-align:right;direction:rtl">  ุงูููุงุท ุงูุฑุฆูุณูุฉ ูู ุงูููุงุท ุงูุชู ุชุณุงุนุฏ ุนูู ุชุญุฏูุฏ ูููุฉ ุงูุดุฎุต ูู ุงููุถุงุก.  ุนุงุฏุฉ ูุง ูุญุชุงุฌ ุงูุนููุงุก ุงูุถุนูุงุก ูุบูุฑ ุงูุขูููู ุฅูู 68 ููุทุฉ ุฑุฆูุณูุฉ ุ ููู ุงูุญุงูุงุช ุงูููููุฉ ุจุดูู ุฎุงุต ุ ุฃูุซุฑ ูู ุฐูู.  ุงูุฃููุงุฏ ุงูุนุงุฏููู ูุงุซููู ูู ุฃููุณูู ุ ุงูุฐูู ููุณุจูู 300 ุฃูู ูู ุงูุซุงููุฉ ุ ูุฏููู ุฏุงุฆููุง ูุง ูููู ูู ุฎูุณุฉ: ุงูุฒูุงูุง ุงูุฏุงุฎููุฉ ูุงูุฎุงุฑุฌูุฉ ููุนููู ูุงูุฃูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6t/tb/-8/6ttb-8bq0ugffanbs0qcrihy2a4.jpeg" alt="ูููู ุงููุฏูู"></p><br><p style=";text-align:right;direction:rtl">  ูููู ุงุณุชุฎุฑุงุฌ ูุฐู ุงูููุงุท ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนู ุทุฑูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณูุณูุฉ ูู ุงูุงูุญุฏุงุฑุงุช</a> . </p><br><h3 id="vyravnivanie-lica" style=";text-align:right;direction:rtl">  ูุญุงุฐุงุฉ ุงููุฌู </h3><br><p style=";text-align:right;direction:rtl">  ุงูุชุทุจููุงุช ุงูููุชุตูุฉ ูู ุงูุทูููุฉุ  ููุง ูู ุดูุก ูู ููุณู ุชูุงููุง: ุชููู ุจุจูุงุก ุชุญูู ุชูุฑูุจู ูุชุฑุฌู ุซูุงุซ ููุงุท ุงุนุชุจุงุทูุฉ ุฅูู ููุงูุนูุง ุงูููุงุณูุฉ.  ูููู ุชุฑู ุงูุฃูู ููุง ูู ุ ูููู ููุนููู ูุญุณุงุจ ูุฑุงูุฒูู - ูุฐู ูู ุงูููุงุท ุงูุซูุงุซ ุฌุงูุฒุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ms/3q/s7/ms3qs7hagupsaooas-eqrjjmqpy.png" alt="ูู ุจุชุฏููุฑ ูุฌู ุงููุฌู"></p><br><h3 id="preobrazovanie-izobrazheniya-lica-v-vektor" style=";text-align:right;direction:rtl">  ุชุญููู ุตูุฑ ุงููุฌู ุฅูู ูุงูู </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ab/8w/jo/ab8wjody73ybfs_opnftpipbcz0.png" alt="ูููู ุฃูู ุนูุฑุง"></p><br><p style=";text-align:right;direction:rtl">  ููุฏ ูุฑุช ุซูุงุซ ุณููุงุช ููุฐ ูุดุฑ ููุงู ุญูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">FaceNet</a> ุ ุฎูุงู ูุฐุง ุงูููุช ุธูุฑุช ุงูุนุฏูุฏ ูู ุจุฑุงูุฌ ุงูุชุฏุฑูุจ ุงููุซูุฑุฉ ููุงูุชูุงู ููุธุงุฆู ุงูุฎุณุงุฑุฉ ุ ููููุง ูู ุงููููููุฉ ุจูู ุญููู OpenSource ุงููุชุงุญุฉ.  ูุจุฏู ุฃู ุงูุฃูุฑ ุจุฑูุชู ูู ูุฒูุฌ ูู ุณูููุฉ ุงูููู ูุงูุชูููุฐ ูุงููุชุงุฆุฌ ุงููุงุฆูุฉ.  ุดูุฑุง ุนูู ุงูุฃูู ูุญูููุฉ ุฃูู ุนูู ูุฏู ุงูุณููุงุช ุงูุซูุงุซ ุงููุงุถูุฉ ุชู ุชุบููุฑ ุงููููู ุฅูู ResNet. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/af/pt/cx/afptcx5ixcu2r0_mjkckckpt2zo.jpeg" alt="ูููู ุฌุฏูุฏ"></p><br><p style=";text-align:right;direction:rtl">  ูุชุนูู FaceNet ูู ุซูุงุซ ุฃูุซูุฉ: (ูุฑุณุงุฉ ุ ุฅูุฌุงุจู ุ ุณูุจู).  ุชูุชูู ุงููุฑุณุงุฉ ูุงูุฃูุซูุฉ ุงูุฅูุฌุงุจูุฉ ุฅูู ุดุฎุต ูุงุญุฏ ุ ูู ุญูู ูุชู ุงุฎุชูุงุฑ ุงูุณูุจูุฉ ููุฌู ูุดุฎุต ุขุฎุฑ ุ ูุงูุชู ูุณุจุจ ูุง ุชููู ุงูุดุจูุฉ ูุฑูุจุฉ ุฌุฏูุง ูู ุงูุฃููู.  ุชู ุชุตููู ูุธููุฉ ุงูุฎุณุงุฑุฉ ุจุทุฑููุฉ ูุชุตุญูุญ ุณูุก ุงูููู ูุฐุง ุ ูุฌูุน ุงูุฃูุซูุฉ ุงููุงุฒูุฉ ูููู ูุง ูู ุบูุฑ ุถุฑูุฑู ูููุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/tp/yf/sw/tpyfswhgnyco4w_0ap3zy8i5zhs.png" alt="Guccinet"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/gj/fi/zq/gjfizqzcwjybnypbv-ugovr5hl0.png" alt="ูุฌูู ุงููุฌู ู ุฏููุชุฑู ูุงูููู"></p><br><p style=";text-align:right;direction:rtl">  ูุณูู ุฅุฎุฑุงุฌ ุงูุทุจูุฉ ุงูุฃุฎูุฑุฉ ูู ุงูุดุจูุฉ ุงูุชุถููู - ุชูุซูู ุชูุซููู ูุดุฎุต ูู ูุณุงุญุฉ ูุนููุฉ ุฐุงุช ุฃุจุนุงุฏ ุตุบูุฑุฉ (ุนุงุฏุฉ 128-ุฃุจุนุงุฏ). </p><br><h3 id="sravnenie-lic" style=";text-align:right;direction:rtl">  ููุงุฑูุฉ ุงููุฌู </h3><br><p style=";text-align:right;direction:rtl">  ุฌูุงู ุงูุชุถูููุงุช ุงููุฏุฑุจุฉ ุฌูุฏูุง ูู ุฃู ูุฌูู ุดุฎุต ูุงุญุฏ ูุนุฑูุถุฉ ูู ุญู ุตุบูุฑ ูู ุงููุณุงุญุฉ ุ ุจุนูุฏูุง ุนู ุบุฑุณ ูุฌูู ุงูุขุฎุฑูู.  ูุฐูู ุ ุจุงููุณุจุฉ ููุฐู ุงููุณุงุญุฉ ุ ููููู ุฅุฏุฎุงู ูููุงุณ ููุชุดุงุจู ุ ูุชุจุงุฏู ุงููุณุงูุฉ: ุฅูููุฏูุฉ ุฃู ุฌูุจ ุงูุชูุงู ุ ุงุนุชูุงุฏูุง ุนูู ุงููุณุงูุฉ ุงูุชู ุชู ุชุฏุฑูุจ ุงูุดุจูุฉ ุนูููุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pn/u8/ba/pnu8barwdzvdryma24yezil7kvo.jpeg" alt="ูุซุงู ูุตุทูุน ุชูุงูุง ุนูู ุงูุชุถููู"></p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ูุญุชุงุฌ ููุฏููุง ุฅูู ุฅูุดุงุก ุนูููุงุช ุชุถููู ูุฌููุน ุงูุฃุดุฎุงุต ุงูุฐูู ุณูุชู ุฅุฌุฑุงุก ุงูุจุญุซ ูู ุจูููู ุ ุซู ุ ููู ุทูุจ ุ ุงุจุญุซ ุนู ุฃูุฑุจ ูุงูู ุจูููู.  ุฃู ุ ุจุทุฑููุฉ ุฃุฎุฑู ุ ุญู ูุดููุฉ ุฅูุฌุงุฏ ุฃูุฑุจ ุฌูุฑุงู ุ ุญูุซ ูุฏ ุชููู <code>k</code> ูุณุงููุฉ ููุงุญุฏ ุ ุฃู ุฑุจูุง ูุง ุ ุฅุฐุง ุฃุฑุฏูุง ุงุณุชุฎุฏุงู ุจุนุถ ููุทู ุงูุฃุนูุงู ุงูุฃูุซุฑ ุชูุฏููุง.  ุณูููู ุงูุดุฎุต ุงูุฐู ููุชูู ูุชุฌู ุงููุชูุฌุฉ ูู ุงูุฃูุซุฑ ุชุดุงุจููุง ูุน ุงูุดุฎุต ุงููุทููุจ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6f/uz/nx/6fuznxdig3uiw1mjuv1eezx5h3u.jpeg" alt="ุชุดุงุจู ูุฌูุง ููุฌู ูููุณ ูุฌูุง ููุฌู"></p><br><h3 id="kakuyu-biblioteku-ispolzovat" style=";text-align:right;direction:rtl">  ุฃู ููุชุจุฉ ุชุณุชุฎุฏูุ </h3><br><p style=";text-align:right;direction:rtl">  ุฅู ุงุฎุชูุงุฑ ุงูููุชุจุงุช ุงูููุชูุญุฉ ุงูุชู ุชููุฐ ุฃุฌุฒุงุก ูุฎุชููุฉ ูู ุฎุท ุงูุฃูุงุจูุจ ุฃูุฑ ุฑุงุฆุน.  <code>dlib</code> ู <code>OpenCV</code> ุงูุนุซูุฑ ุนูู ุงููุฌูู ูุงูููุงุท ุงูุฑุฆูุณูุฉ ุ ููููู ุงูุนุซูุฑ ุนูู ุฅุตุฏุงุฑุงุช ูุฏุฑุจุฉ ูุณุจููุง ูู ุงูุดุจูุงุช ูุฃู ุฅุทุงุฑ ุนูู ุดุจูุฉ ุนุตุจูุฉ ูุจูุฑ.  ููุงู ูุดุฑูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">OpenFace</a> ุญูุซ ููููู ุงุฎุชูุงุฑ ุงูุจููุฉ ููุชุทูุจุงุช ุงูุณุฑุนุฉ ูุงูุฌูุฏุฉ.  ููู ููุชุจุฉ ูุงุญุฏุฉ ููุท ุชุณูุญ ูู ุจุชูููุฐ ุฌููุน ููุงุท ุงูุชุนุฑู ุนูู ุงููุฌูู ุงูุฎูุณ ูู ุงูููุงููุงุช ูุซูุงุซ ูุธุงุฆู ุนุงููุฉ ุงููุณุชูู: <code>dlib</code> .  ูู ุงูููุช ููุณู ุ ูู ููุชูุจ ุจูุบุฉ C ++ ุงูุญุฏูุซุฉ ุ ููุณุชุฎุฏู BLAS ุ ููุฏูู ุบูุงู ูู Python ุ ููุง ูุชุทูุจ GPU ุ ููุนูู ุจุณุฑุนุฉ ูุจูุฑุฉ ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ.  ููุน ุงุฎุชูุงุฑูุง ุนูููุง. </p><br><h1 id="delaem-sobstvennogo-bota" style=";text-align:right;direction:rtl">  ุตูุน ุงูุฑูุจูุช ุงูุฎุงุต ุจู </h1><br><p style=";text-align:right;direction:rtl">  ุชู ูุตู ูุฐุง ุงููุณู ุจุงููุนู ูู ูู ุฏููู ูุฅูุดุงุก ุจุฑุงูุฌ ุงูุฑูุจูุช ุ ูููู ุจูุฌุฑุฏ ุฃู ููุชุจ ููุณ ุงูุดูุก ุ ุณูุชุนูู ุนูููุง ุชูุฑุงุฑู.  ููุชุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BotFather</a> ููุทูุจ ููู ุฑูุฒูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฑูุจูุชูุง</a> ุงูุฌุฏูุฏ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/um/qe/ew/umqeewdk64wtealh1ldudqsv0m8.png" alt="ุทูุณ ุงูุฑูุฒ ุงููููุฒ XS"></p><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุงูุฑูุฒ ุงููููุฒ ุดูุฆูุง ููุฐุง: <code>643075690:AAFC8ola8WRdhGbJtzjmkOhne1FGfu1BFg</code> .  ูู ุงูุถุฑูุฑู ุงูุญุตูู ุนูู ุฅุฐู ุนูุฏ ูู ุทูุจ ุฅูู Telegram bot API. </p><br><p style=";text-align:right;direction:rtl">  ุขูู ุฃูุง ูููู ูุฏู ุฃู ุดุฎุต ูู ูุฐู ุงููุฑุญูุฉ ุฃู ุดู ุนูุฏ ุงุฎุชูุงุฑ ูุบุฉ ุงูุจุฑูุฌุฉ.  ุจุงูุทุจุน ุ ุนููู ุฃู ุชูุชุจ ูู ูุงุณูู.  ููุจุฏุฃ ุจุงููุญุฏุฉ ุงูุฑุฆูุณูุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="haskell hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> System.Process main :: IO () main = do (<span class="hljs-title"><span class="hljs-title">_</span></span>, <span class="hljs-title"><span class="hljs-title">_</span></span>, <span class="hljs-title"><span class="hljs-title">_</span></span>, <span class="hljs-title"><span class="hljs-title">handle</span></span>) &lt;- createProcess (<span class="hljs-title"><span class="hljs-title">shell</span></span> "<span class="hljs-title"><span class="hljs-title">python</span></span> <span class="hljs-title"><span class="hljs-title">bot</span></span>.<span class="hljs-title"><span class="hljs-title">py</span></span>") _ &lt;- waitForProcess handle putStrLn "Done!"</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑู ูู ุงูููุฏ ุ ุณูุณุชุฎุฏู ูู ุงููุณุชูุจู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DSL</a> ุฎุงุต ููุชุงุจุฉ ุงูุฑูุจูุชุงุช ุจุฑููุฉ.  ุงูุฑูุฒ ุงูููุฌูุฏ ุนูู ุฎุท ุงููุดุชุฑู ุงูุฑููู ูุฐุง ููุชูุจ ูู ูููุงุช ูููุตูุฉ.  ูู ุจุชุซุจูุช ูุบุฉ ุงููุฌุงู ููู ูุง ูู ุถุฑูุฑู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">python -m venv .env <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> .env/bin/activate pip install python-telegram-bot</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>python-telegram-bot</code> ูู ุญุงูููุง ุงูุฅุทุงุฑ ุงูุฃูุซุฑ ููุงุกูุฉ ูุฅูุดุงุก ุจุฑุงูุฌ ุงูุฑูุจูุช.  ุฅูู ุณูู ุงูุชุนูู ุ ูุฑู ุ ูุงุจู ููุชุทููุฑ ุ ูุฏุนู ุชุนุฏุฏ ูุคุดุฑุงุช ุงูุชุฑุงุจุท.  ูุณูุก ุงูุญุธ ุ ูู ุงูููุช ุงูุญุงูู ูุง ููุฌุฏ ุฅุทุงุฑ ูุงุญุฏ ุบูุฑ ูุชุฒุงูู ุนุงุฏู ููุฌุจ ุงุณุชุฎุฏุงู ุงูุฎููุท ุงููุฏููุฉ ุจุฏูุงู ูู ุงูููุฑููุงุช ุงูุฅูููุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/t2/8b/qv/t28bqvhxxznqmzsobr4hjmuxlta.jpeg" alt="Asyncio ูู ุฅููู ุงููุญูุฏ"></p><br><p style=";text-align:right;direction:rtl">  ุจุฏุก ุฑูุจูุช ุจุงุณุชุฎุฏุงู <code>python-telegram-bot</code> ุฃูุฑ ุณูู.  ุฃุถู ุงูููุฏ ุงูุชุงูู ุฅูู <code>bot.py</code> </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telegram.ext <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Updater <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telegram.ext <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MessageHandler, Filters <span class="hljs-comment"><span class="hljs-comment">#      TOKEN = '&lt;TOKEN&gt;' def echo(bot, update): bot.send_message(chat_id=update.message.chat_id, text=update.message.text) updater = Updater(token=TOKEN) dispatcher = updater.dispatcher echo_handler = MessageHandler(Filters.text, echo) dispatcher.add_handler(echo_handler)</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุดุบู ุงูุจูุช.  ูุฃุบุฑุงุถ ุงูุชุตุญูุญ ุ ูููู ุงูููุงู ุจุฐูู ุจุงุณุชุฎุฏุงู <code>python bot.py</code> ุจุฏูู ุชุดุบูู ููุฏ Haskell. </p><br><p style=";text-align:right;direction:rtl">  ูุซู ูุฐุง ุงูุฑูุจูุช ุงูุจุณูุท ูุงุฏุฑ ุนูู ุงูุญูุงุธ ุนูู ุงูุญุฏ ุงูุฃุฏูู ูู ุงููุญุงุฏุซุฉ ุ ูุจุงูุชุงูู ุ ูููู ุชุฑุชูุจู ุจุณูููุฉ ููุนูู ููุทูุฑ ุฃูุงูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/xs/pk/sm/xspksm1d8ehnslmqjsj33dzyekm.png" alt="ุญูุงุฑ ูููุฐุฌู ูุน ูุทูุฑ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ"></p><br><p style=";text-align:right;direction:rtl">  ููู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูููุทูุฑูู ูุซูุฑุฉ ุฌุฏูุง ุจุงููุนู ุ ูุฐูู ุณููุชููุง ูู ุฃูุฑุจ ููุช ูููู ูููุถู ูู ุชูููุฐ ุงููุธููุฉ ุงูุฑุฆูุณูุฉ.  ูู ุฃุฌู ุงูุจุณุงุทุฉ ุ ุณูุฑุฏ ุจุฑูุงูุฌ ุงูุฑูุจูุช ุงูุฎุงุต ุจูุง ููุท ุนูู ุงูุฑุณุงุฆู ุงูุชู ุชุญุชูู ุนูู ุตูุฑ ููุชุฌุงูู ุฃู ุตูุฑ ุฃุฎุฑู.  ูู ุจุชุบููุฑ ุงูุฑูุฒ ุฅูู ูุง ููู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telegram.ext <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Updater <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telegram.ext <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MessageHandler, Filters <span class="hljs-comment"><span class="hljs-comment">#      TOKEN = '&lt;TOKEN&gt;' def handle_photo(bot, update): bot.send_message(chat_id=update.message.chat_id, text='nice') updater = Updater(token=TOKEN) dispatcher = updater.dispatcher photo_handler = MessageHandler(Filters.photo, handle_photo) dispatcher.add_handler(photo_handler) updater.start_polling() updater.idle()</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/-8/1k/hq/-81khq5z9redcz29_ut7sunfrpg.png" alt="ููุณ ุจุงููุนู ูุทูุฑ ุฃูุงูู"></p><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ุชุฏุฎู ุงูุตูุฑุฉ ุฅูู ุฎุงุฏู Telegram ุ ูุชู ุถุจุทูุง ุชููุงุฆููุง ุนูู ุนุฏุฉ ุฃุญุฌุงู ูุญุฏุฏุฉ ูุณุจููุง.  ูููู ููุจูุช ุ ุจุฏูุฑู ุ ุชูุฒูู ุตูุฑุฉ ุจุฃู ุญุฌู ูู ุชูู ุงูููุฌูุฏุฉ ูู ูุงุฆูุฉ <code>message.photo</code> ูุตููุฉ ุจุชุฑุชูุจ ุชุตุงุนุฏู.  ุงูุฎูุงุฑ ุงูุฃุณูู: ุงูุชูุงุท ุฃูุจุฑ ุตูุฑุฉ.  ุจุงูุทุจุน ุ ูู ุจูุฆุฉ ุงูุจูุงูุฉ ุ ุชุญุชุงุฌ ุฅูู ุงูุชูููุฑ ูู ุชุญููู ุงูุดุจูุฉ ูููุช ุงูุชุญููู ูุงุฎุชูุงุฑ ุตูุฑุฉ ุจุงูุญุฌู ุงูุฃุฏูู ุงูููุงุณุจ.  ุฃุถู ุฑูุฒ ุชูุฒูู ุงูุตูุฑุฉ ุฅูู ุฃุนูู ูุธููุฉ <code>handle_photo</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">message = update.message photo = message.photo[~<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> io.BytesIO() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fd: file_id = bot.get_file(photo.file_id) file_id.download(out=fd) fd.seek(<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชู ุชูุฒูู ุงูุตูุฑุฉ ููู ูู ุงูุฐุงูุฑุฉ.  ูุชูุณูุฑูุง ูุชูุฏูููุง ูู ุดูู ูุตูููุฉ ูุซุงูุฉ ุงูุจูุณู ุ ูุณุชุฎุฏู ุงูููุชุจุงุช <code>Pillow</code> <code>numpy</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฅุถุงูุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุชุงููุฉ ุฅูู ุงููุชูุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">image = Image.open(fd) image.load() image = np.asarray(image)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฏ ุญุงู ุงูููุช dlib.  ุฎุงุฑุฌ ุงููุธููุฉ ุ ูู ุจุฅูุดุงุก ูุงุดู ูููุฌู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dlib</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">face_detector = dlib.get_frontal_face_detector()</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฏุงุฎู ุงููุธููุฉ ูุณุชุฎุฏููุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">face_detects = face_detector(image, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุนููุฉ ุงูุซุงููุฉ ููุฏุงูุฉ ุชุนูู ุงูุชูุจูุฑ ุงูุฐู ูุฌุจ ุชุทุจููู ูุจู ูุญุงููุฉ ุงูุชุดุงู ุงููุฌูู.  ูููุง ูุงู ุฃูุจุฑ ุ ูููุง ูุงูุช ุงููุฌูู ุงูุฃุตุบุฑ ูุงูุฃูุซุฑ ุชุนููุฏูุง ูุงุฏุฑุฉ ุนูู ุงูุชุดุงููุง ุ ูููู ูููุง ุทุงูุช ูุฏุฉ ุนูููุง.  <code>face_detects</code> - ูุงุฆูุฉ ุงููุฌูู ูุฑุชุจุฉ ุชุฑุชูุจูุง ุชูุงุฒูููุง ูุซูุฉ ุงููุงุดู ุจุฃู ุงููุฌู ุฃูุงูู.  ูู ุงูุชุทุจูู ุงูุญูููู ุ ุณุชุญุชุงุฌ ุนูู ุงูุฃุฑุฌุญ ุฅูู ุชุทุจูู ุจุนุถ ููุทู ุงุฎุชูุงุฑ ุงูุดุฎุต ุงูุฑุฆูุณู ุ ููู ุฏุฑุงุณุฉ ุงูุญุงูุฉ ุณููุชุตุฑ ุนูู ุงุฎุชูุงุฑ ุงูุดุฎุต ุงูุฃูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> face_detects: bot.send_message(chat_id=update.message.chat_id, text=<span class="hljs-string"><span class="hljs-string">'no faces'</span></span>) face = face_detects[<span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุชูู ุฅูู ุงููุฑุญูุฉ ุงูุชุงููุฉ - ุงูุจุญุซ ุนู ุงูููุงุท ุงูุฑุฆูุณูุฉ.  ูู ุจุชูุฒูู <a href="">ุงููููุฐุฌ ุงููุฏุฑุจ</a> ูุญูู ุญููู ุฎุงุฑุฌ ุงููุธููุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">shape_predictor = dlib.shape_predictor(<span class="hljs-string"><span class="hljs-string">'path/to/shape_predictor_5_face_landmarks.dat'</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงุจุญุซ ุนู ุงูููุงุท ุงูุฑุฆูุณูุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">landmarks = shape_predictor(image, face)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุดูุก ุงููุญูุฏ ุงููุชุจูู ุตุบูุฑ: ูุชุตููุจ ุงููุฌู ุ ูุฏูุนู ุนุจุฑ ResNet ูุงูุญุตูู ุนูู ุชุถููู 128-ุฃุจุนุงุฏ.  ูุญุณู ุงูุญุธ ุ ูุณูุญ ูู dlib ุจุงูููุงู ุจูู ูุฐุง ุจููุงููุฉ ูุงุญุฏุฉ.  ุชุญุชุงุฌ ููุท ุฅูู ุชูุฒูู <a href="">ุงููููุฐุฌ ุงููุฏุฑุจ ูุณุจููุง</a> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">face_recognition_model = dlib.face_recognition_model_v1(<span class="hljs-string"><span class="hljs-string">'path/to/dlib_face_recognition_resnet_model_v1.dat'</span></span>)</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">embedding = face_recognition_model.compute_face_descriptor(image, landmarks) embedding = np.asarray(embedding)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุท ุงูุธุฑ ุฅูู ุฃู ููุช ุฑุงุฆุน ูุนูุด ููู.  ูุชู ุชุบููู ุงูุชุนููุฏ ุงููุงูู ููุดุจูุงุช ุงูุนุตุจูุฉ ุงูุชูุงููููุฉ ุ ูุทุฑููุฉ ูุงููุงุช ุงูุฏุนู ุ ูุงูุชุญูููุงุช ุงููุงุญูุฉ ุงููุทุจูุฉ ุนูู ุงูุชุนุฑู ุนูู ุงููุฌูู ูู ุซูุงุซ ููุงููุงุช ููุชุจุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃููุง ูุง ูุนุฑู ููููุฉ ุงูููุงู ุจุฃู ุดูุก ุฐู ูุนูู ุญุชู ุงูุขู ุ ูููุนุฏ ูููุณุชุฎุฏู ูุชูุณุท โโูููุฉ ุงูุชุถููู ุ ูุถุฑูุจูุง ูู ุงูุฃูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">bot.send_message( chat_id=update.message.chat_id, text=<span class="hljs-string"><span class="hljs-string">f'yours embedding mean: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{embedding.mean() * </span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1e3</span></span></span></span><span class="hljs-string"><span class="hljs-subst">:</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">.2</span></span></span></span><span class="hljs-string"><span class="hljs-subst">f}</span></span></span><span class="hljs-string">'</span></span> )</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ud/av/o6/udavo6i5srwrl93jbopenn84tae.png" alt="ุฃูุง ูุง ุฃุนุฑู ูุง ุฃูุนูู"></p><br><p style=";text-align:right;direction:rtl">  ููู ูุชููู ุงูุจูุช ุงูุฎุงุต ุจูุง ูู ุชุญุฏูุฏ ุงููุดุงููุฑ ุงูุฐูู ูุดุจููู ุงููุณุชุฎุฏููู ุ ูุญุชุงุฌ ุงูุขู ุฅูู ุงูุนุซูุฑ ุนูู ุตูุฑุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู ููู ุดุฎุต ูุดููุฑ ุ ูุจูุงุก ุชุถููู ุนูููุง ูุญูุธูุง ูู ููุงู ูุง.  ุณูุถูู 10 ูุดุงููุฑ ููุท ุฅูู ุฑูุจูุช ุงูุชุฏุฑูุจ ุงูุฎุงุต ุจูุง ุ ููุนุซุฑ ุนูู ุตูุฑูู ูุฏูููุง ููุถุนูู ูู ุฏููู <code>photos</code> .  ูุฐุง ูุง ูุฌุจ ุฃู ูุจุฏู ุนููู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/yz/rd/1o/yzrd1ockvqezvybwzo-yulsivqq.png" alt="ุงูุธุฑ ุ ูู ููู ูุฏู ูุง ูููู ูู ุงููุงู ูุฌูุงุฒ MacBook."></p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุฑูุฏ ุฃู ูููู ูุฏูู ููููู ูู ุงููุดุงููุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูุณูุจุฏู ูู ุดูุก ููุง ูู ุชูุงููุง ุ ููุท ููุงู ุงููุฒูุฏ ูู ุงููููุงุช ููู ุบูุฑ ุงููุญุชูู ุฃู ุชุจุญุซ ุนููุง ุจูุฏูู.  ุงูุขู ุฏุนูุง <code>build_embeddings.py</code> ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ <code>build_embeddings.py</code> ุจุงุณุชุฎุฏุงู ููุงููุงุช <code>dlib</code> ุงูุชู ูุนุฑููุง ุจุงููุนู ููููู ุจุญูุธ ุชุถููู ุงููุดุงููุฑ ูุน ุฃุณูุงุฆูู ุจุชูุณูู ุซูุงุฆู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dlib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pickle <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image face_detector = dlib.get_frontal_face_detector() shape_predictor = dlib.shape_predictor(<span class="hljs-string"><span class="hljs-string">'assets/shape_predictor_5_face_landmarks.dat'</span></span>) face_recognition_model = dlib.face_recognition_model_v1(<span class="hljs-string"><span class="hljs-string">'assets/dlib_face_recognition_resnet_model_v1.dat'</span></span>) fs = os.listdir(<span class="hljs-string"><span class="hljs-string">'photos'</span></span>) es = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fs: print(f) image = np.asarray(Image.open(os.path.join(<span class="hljs-string"><span class="hljs-string">'photos'</span></span>, f))) face_detects = face_detector(image, <span class="hljs-number"><span class="hljs-number">1</span></span>) face = face_detects[<span class="hljs-number"><span class="hljs-number">0</span></span>] landmarks = shape_predictor(image, face) embedding = face_recognition_model.compute_face_descriptor(image, landmarks, num_jitters=<span class="hljs-number"><span class="hljs-number">10</span></span>) embedding = np.asarray(embedding) name, _ = os.path.splitext(f) es.append((name, embedding)) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'assets/embeddings.pickle'</span></span>, <span class="hljs-string"><span class="hljs-string">'wb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: pickle.dump(es, f)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุถู ุงูุชุญููู ุงููุถููู ุฅูู ุฑูุฒ ุงูุฑูุจูุช ุงูุฎุงุต ุจูุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pickle</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'assets/embeddings.pickle'</span></span>, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: star_embeddings = pickle.load(f)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููู ุฎูุงู ุงูุจุญุซ ุงูุดุงูู ุ ุณููุชุดู ูู ูู ุงููุณุชุฎุฏู ููุณู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">ds = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> name, emb <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> star_embeddings: distance = np.linalg.norm(embedding - emb) ds.append((name, distance)) best_match, best_distance = min(ds, key=itemgetter(<span class="hljs-number"><span class="hljs-number">1</span></span>)) bot.send_message( chat_id=update.message.chat_id, text=<span class="hljs-string"><span class="hljs-string">f'your look exactly like *</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{best_match}</span></span></span><span class="hljs-string">*'</span></span>, parse_mode=<span class="hljs-string"><span class="hljs-string">'Markdown'</span></span> )</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฑุฌู ููุงุญุธุฉ ุฃููุง ูุณุชุฎุฏู ุงููุณุงูุฉ ุงูุฅูููุฏูุฉ ููุณุงูุฉ ุ ูุฃู  ุชู ุชุฏุฑูุจ ุงูุดุจูุฉ ูู dlib ุจุฏูุฉ ุจูุณุงุนุฏุฉ ุฐูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/yd/fl/wi/ydflwigundswx6_qbctjir_itge.png" alt="ุฎุงุจ ุฃููู ูู ุงูููุงูุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก ุ ูุจุฑูู!  ููุฏ ุฃูุดุฃูุง ุฑูุจูุชูุง ุจุณูุทูุง ููููู ุชุญุฏูุฏ ุงููุดุงููุฑ ุงูุฐูู ูุดุจููู ุงููุณุชุฎุฏู.  ูุจูู ุงูุนุซูุฑ ุนูู ุงููุฒูุฏ ูู ุงูุตูุฑ ูุฅุถุงูุฉ ุงูุนูุงูุงุช ุงูุชุฌุงุฑูุฉ ููุงุจููุฉ ุงูุชูุณุน ููููู ูู ุงูุชุณุฌูู ููููู ุชุญุฑูุฑ ูู ุดูุก ูู ุงูุฅูุชุงุฌ.  ุฌููุน ูุฐู ุงูููุงุถูุน ุถุฎูุฉ ููุบุงูุฉ ุจุญูุซ ูุง ูููู ุงูุญุฏูุซ ุนููุง ุจุงูุชูุตูู ูุน ููุงุฆู ุงูุฑููุฒ ุงูุถุฎูุฉ ุ ูุฐูู ุณุฃููู ููุท ุจุฅูุฌุงุฒ ุงูููุงุท ุงูุฑุฆูุณูุฉ ูู ุชูุณูู ุฅุฌุงุจุฉ ุงูุณุคุงู ูู ุงููุณู ุงูุชุงูู. </p><br><p style=";text-align:right;direction:rtl">  ุฑูุฒ ุจูุช ุงูุชุฏุฑูุจ ุงููุงูู ูุชุงุญ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฌูุซุจ</a> . </p><br><h1 id="rasskazyvaem-pro-nashego-bota" style=";text-align:right;direction:rtl">  ูุชุญุฏุซ ุนู ุงูุฑูุจูุช ูุฏููุง </h1><br><h3 id="skolko-u-vas-v-baze-znamenitostey-gde-vy-ih-nashli" style=";text-align:right;direction:rtl">  ูู ุนุฏุฏ ุงููุดุงููุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูุ  ุงูู ูุฌุฏุชูู </h3><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุฃู ุงููุฑุงุฑ ุงูุฃูุซุฑ ููุทููุฉ ุนูุฏ ุฅูุดุงุก ุงูุฑูุจูุช ูุฃุฎุฐ ุจูุงูุงุช ุงููุดุงููุฑ ูู ูุงุนุฏุฉ ุงููุญุชูู ุงูุฏุงุฎูู ูุฏููุง.  ููู ูู ุดูู ุงูุฑุณู ุงูุจูุงูู ุชุฎุฒู ุงูุฃููุงู ูุฌููุน ุงูููุงูุงุช ุงููุฑุชุจุทุฉ ุจุงูุฃููุงู ุ ุจูุง ูู ุฐูู ุงูููุซููู ูุงููุฎุฑุฌูู.  ููู ุดุฎุต ุ ูุนุฑู ุงุณููุง ูุชุณุฌูู ุงูุฏุฎูู ููููุฉ ุงููุฑูุฑ ูู iCloud ูุงูุฃููุงู ูุงูุฃุณูุงุก ุงููุณุชุนุงุฑุฉ ุฐุงุช ุงูุตูุฉ ุ ูุงูุชู ูููู ุงุณุชุฎุฏุงููุง ูุฅูุดุงุก ุฑูุงุจุท ุฅูู ุงููููุน.  ุจุนุฏ ุชูุธูู ูุงุณุชุฎุฑุงุฌ ุงููุนูููุงุช ุงูุถุฑูุฑูุฉ ููุท ุ ูุจูู ููู <code>json</code> ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">[ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"alias"</span></span>: <span class="hljs-string"><span class="hljs-string">"tilda-swinton"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"role"</span></span>: <span class="hljs-string"><span class="hljs-string">"actor"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"n_movies"</span></span>: <span class="hljs-number"><span class="hljs-number">14</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"alias"</span></span>: <span class="hljs-string"><span class="hljs-string">"michael-shannon"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"role"</span></span>: <span class="hljs-string"><span class="hljs-string">"actor"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"n_movies"</span></span>: <span class="hljs-number"><span class="hljs-number">22</span></span> }, ... ]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงู ููุงู <strong>22000</strong> ูุซู ูุฐู ุงูุฅุฏุฎุงูุงุช ูู ุงููุชุงููุฌ.  ุจุงูููุงุณุจุฉ ุ ููุณ ูุชุงููุฌ ุ ุจู ูุชุงููุฌ. </p><br><h3 id="gde-nayti-fotografii-dlya-vseh-etih-lyudey" style=";text-align:right;direction:rtl">  ุฃูู ุชุฌุฏ ุงูุตูุฑ ููู ูุคูุงุก ุงููุงุณุ </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/_n/5i/pl/_n5iplsi4yqnrm2lpvzyjwhjigm.jpeg" alt="ูู ุงูุฃููุงุช ุงูุฎุทุฑุฉ ูุนูุด"></p><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ููุง ุชุนูู ุ <em>ููุง ูููุงู</em> .  ููุงู ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุชุจุฉ ุฑุงุฆุนุฉ</a> ุชุณูุญ ูู ุจุชุญููู ูุชุงุฆุฌ ุงูุจุญุซ ุนู ุงูุตูุฑ ูู Google.  22 ุฃูู ุดุฎุต - ููุณ ูุซูุฑูุง ุ ุจุงุณุชุฎุฏุงู 56 ุชูุงุฑุงุช ุชูููุง ูู ุชูุฒูู ุงูุตูุฑ ููู ูู ุฃูู ูู ุณุงุนุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุจูู ุงูุตูุฑ ุงูุชู ุชู ุชูุฒูููุง ุ ุชุญุชุงุฌ ุฅูู ุชุฌุงูู ุงูุตูุฑ ุงูููุณูุฑุฉ ูุงูุตุงุฎุจุฉ ุจุชูุณูู ุฎุงุทุฆ.  ุซู ุงุชุฑู ููุท ุชูู ุงูุชู ุชูุฌุฏ ูููุง ูุฌูู ูุญูุซ ุชูุจู ูุฐู ุงููุฌูู ุดุฑูุทูุง ูุนููุฉ: ุงูุญุฏ ุงูุฃุฏูู ูููุณุงูุฉ ุจูู ุงูุนูููู ุ ูุฅูุงูุฉ ุงูุฑุฃุณ.  ูู ูุฐุง ูุชุฑููุง ูุน <strong>12000</strong> ุตูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุจูู 12 ุฃูู ูู ุงููุดุงููุฑ ุ ูุฌุฏ ุงููุณุชุฎุฏููู 2 ููุท ูู ุงูููุช ุงูุญุงูู ุ ุฃู ุฃู ููุงู ูุง ููุฑุจ ูู 8 ุขูุงู ูู ุงููุดุงููุฑ ุงูุฐูู ูุง ูุฒุงููู ููุณูุง ูุซู ุฃู ุดุฎุต ุขุฎุฑ.  ูุง ุชุชุฑู ุงูุฃูุฑ ููุฐุง!  ุงูุชุญ ุงูุจุฑููุงุช ูุงุนุซุฑ ุนูููุง ุฌููุนูุง. </p><br><h3 id="kak-opredelit-procent-shozhesti-dlya-evklidovoy-distancii" style=";text-align:right;direction:rtl">  ููููุฉ ุชุญุฏูุฏ ุงููุณุจุฉ ุงููุฆููุฉ ููุชุดุงุจู ูู ุงููุณุงูุฉ ุงูุฅูููุฏูุฉุ </h3><br><p style=";text-align:right;direction:rtl">  ุณุคุงู ุนุธูู!  ูู ุงููุงูุน ุ ุงููุณุงูุฉ ุงูุฅูููุฏูุฉ ุ ุนูู ุนูุณ ุฌูุจ ุงูุชูุงู ุ ููุณุช ูุญุฏูุฏุฉ ุฃุนูุงู.  ูุฐูู ุ ููุทุฑุญ ุณุคุงู ูุนููู ุ ููู ุชูุธูุฑ ูููุณุชุฎุฏู ุดูุฆูุง ุฃูุซุฑ ูุนูู ูู "ุชูุงูููุง ุ ุงููุณุงูุฉ ุจูู ุงูุชุถููู ูุชุถููู ุฃูุฌูููุง ุฌููู ูู 0.27635462738"ุ  ุงูุชุฑุญ ุฃุญุฏ ุฃุนุถุงุก ูุฑูููุง ุงูุญู ุงูุจุณูุท ูุงูุจุงุฑุน ุงูุชุงูู.  ุฅุฐุง ููุช ุจุจูุงุก ุชูุฒูุน ุงููุณุงูุงุช ุจูู ุงูุชุถูููุงุช ุ ูุณูููู ุฐูู ุทุจูุนููุง.  ูุฐูู ุ ุจุงููุณุจุฉ ูู ุ ููููู ุญุณุงุจ ุงููุชูุณุท โโูุงูุงูุญุฑุงู ุงููุนูุงุฑู ุ ุซู ููู ูุณุชุฎุฏู ุ ููููุง ููุฐู ุงููุนููุงุช ุ ุถุน ูู ุงุนุชุจุงุฑู <em>ุนุฏุฏ ุงูุฃุดุฎุงุต ุงูุฐูู ูู ุฃูู ุดูุฑุฉ ูู ุงููุดุงููุฑ</em> .  ููุฐุง ูุนุงุฏู ุฏูุฌ ุฏุงูุฉ ูุซุงูุฉ ุงูุงุญุชูุงู ูู <code>d</code> ุฅูู plus ุงููุงููุงูุฉ ุ ุญูุซ <code>d</code> ูู ุงููุณุงูุฉ ุจูู ุงููุณุชุฎุฏู ูุชุฌูุนุงุช ุงููุดุงููุฑ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fh/yc/4r/fhyc4r87otryweg9v-xznackhfq.png" alt="ูุฐุง ููุณ ุจุญุฑุง"></p><br><p style=";text-align:right;direction:rtl">  ูููุง ููู ุงููุธููุฉ ุงูุฏูููุฉ ุงูุชู ูุณุชุฎุฏููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_transform_dist_to_sim</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, dist)</span></span></span><span class="hljs-function">:</span></span> p = <span class="hljs-number"><span class="hljs-number">0.5</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> + erf((dist - self._dist_mean) / (self._dist_std * <span class="hljs-number"><span class="hljs-number">1.4142135623730951</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> max(min(<span class="hljs-number"><span class="hljs-number">1</span></span> - p, <span class="hljs-number"><span class="hljs-number">1.0</span></span>), self._min_similarity)</code> </pre> <br><h3 id="neuzheli-nuzhno-perebirat-spisok-vseh-embedingov-chtoby-nayti-sovpadenie" style=";text-align:right;direction:rtl">  ูู ูู ุงูุถุฑูุฑู ุงูุชูุฑุงุฑ ุนูู ูุงุฆูุฉ ุฌููุน ุงูููุงุจุงุช ูู ุฃุฌู ุงูุนุซูุฑ ุนูู ุชุทุงุจูุ </h3><br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ูุง ุ ูุฐุง ููุณ ุงูุฃูุซู ููุณุชุบุฑู ุงููุซูุฑ ูู ุงูููุช.  ุฃุณูู ุทุฑููุฉ ูุชุญุณูู ุงูุญุณุงุจุงุช ูู ุงุณุชุฎุฏุงู ุนูููุงุช ุงููุตูููุฉ.  ุจุฏูุงู ูู ุทุฑุญ ุงููุชุฌูุงุช ูู ุจุนุถูุง ุงูุจุนุถ ุ ููููู ุชูููู ูุตูููุฉ ูููุง ูุทุฑุญ ูุชุฌู ูู ุงููุตูููุฉ ุ ุซู ุญุณุงุจ ูุนูุงุฑ L2 ูู ุงูุตููู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">scores = np.linalg.norm(emb - embeddings, axis=<span class="hljs-number"><span class="hljs-number">1</span></span>) best_idx = scores.argmax()</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุนุทู ุจุงููุนู ุฒูุงุฏุฉ ูุจูุฑุฉ ูู ุงูุฅูุชุงุฌูุฉ ุ ูููู ุงุชุถุญ ุฃูู ููููู ุฃุณุฑุน.  ูููู ุชุณุฑูุน ุงูุจุญุซ ุจุดูู ูุจูุฑ ุจููุฏุงู ุงููููู ูู ุฏูุชู ุจุงุณุชุฎุฏุงู ููุชุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">nmslib</a> .  ููุณุชุฎุฏู ุฃุณููุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">HNSW</a> ูุชูุฑูุจ ุงูุจุญุซ ุนู ุฃูุฑุจ ุฌูุฑุงู <code>k</code> .  ูุฌููุน ุงููุชุฌูุงุช ุงููุชุงุญุฉ ุ ูุฌุจ ุจูุงุก ูุง ูุณูู ุงูููุฑุณ ุ ุซู ุณูุชู ุฅุฌุฑุงุก ุงูุจุญุซ.  ููููู ุฅูุดุงุก ูุญูุธ ุงูููุฑุณ ููุณุงูุฉ ุงูุฅูููุฏูุฉ ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> nmslib index = nmslib.init(method=<span class="hljs-string"><span class="hljs-string">'hnsw'</span></span>, space=<span class="hljs-string"><span class="hljs-string">'l2'</span></span>, data_type=nmslib.DataType.DENSE_VECTOR) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> idx, emb <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(embeddings): index.addDataPoint(idx, emb) index_time_params = { <span class="hljs-string"><span class="hljs-string">'indexThreadQty'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'skip_optimized_index'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'post'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'delaunay_type'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'M'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'efConstruction'</span></span>: <span class="hljs-number"><span class="hljs-number">2000</span></span> } index.createIndex(index_time_params, print_progress=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) index.saveIndex(<span class="hljs-string"><span class="hljs-string">'./assets/embeddings.bin'</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ูุตู ุงููุนููุงุช <code>M</code> ู <code>efConstruction</code> ุจุงูุชูุตูู ูู <a href="">ุงููุซุงุฆู</a> ููุชู ุงุฎุชูุงุฑูุง ุชุฌุฑูุจููุง ุจูุงุกู ุนูู ุงูุฏูุฉ ุงููุทููุจุฉ ูููุช ุจูุงุก ุงูููุฑุณ ูุณุฑุนุฉ ุงูุจุญุซ.  ูุจู ุงุณุชุฎุฏุงู ุงูููุฑุณ ุ ูุฌุจ ุนููู ุชูุฒูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">index = nmslib.init(method=<span class="hljs-string"><span class="hljs-string">'hnsw'</span></span>, space=<span class="hljs-string"><span class="hljs-string">'l2'</span></span>, data_type=nmslib.DataType.DENSE_VECTOR) index.loadIndex(<span class="hljs-string"><span class="hljs-string">'./assets/embeddings.bin'</span></span>) query_time_params = {<span class="hljs-string"><span class="hljs-string">'efSearch'</span></span>: <span class="hljs-number"><span class="hljs-number">400</span></span>} index.setQueryTimeParams(query_time_params)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุคุซุฑ ูุนููุฉ <code>efSearch</code> ูู ุฏูุฉ ุงูุงุณุชุนูุงูุงุช ูุณุฑุนุชูุง ููุฏ ูุง ุชุชุทุงุจู ูุน <code>efConstruction</code> .  ุงูุขู ููููู ุชูุฏูู ุงูุทูุจุงุช. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">ids, dists = index.knnQuery(embedding, k=<span class="hljs-number"><span class="hljs-number">1</span></span>) best_dx = ids[<span class="hljs-number"><span class="hljs-number">0</span></span>] best_dist = dists[<span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุชูุง ุ <code>nmslib</code> ุฃุณุฑุน 20 ูุฑุฉ ูู ุงูุฅุตุฏุงุฑ ุงูุฎุทู <code>nmslib</code> ุ ููุชู ูุนุงูุฌุฉ ุทูุจ ูุงุญุฏ ูู ุงููุชูุณุท <code>0.005</code> ุซุงููุฉ. </p><br><h3 id="kak-sdelat-moego-bota-gotovym-k-prodakshenu" style=";text-align:right;direction:rtl">  ููู ุฃุฌุนู ุจูุช ุฌุงูุฒุงู ููุฅูุชุงุฌุ </h3><br><h5 id="1-asinhronnost" style=";text-align:right;direction:rtl">  1. ุงูุชุฒุงูู </h5><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ูุฌุจ ุฃู ุชุฌุนู ูุธููุฉ <code>handle_photo</code> ุบูุฑ ูุชุฒุงููุฉ.  ููุง ููุช ุจุงููุนู ุ ูููุฑ <code>python-telegram-bot</code> ุชุนุฏุฏ ุณูุงุณู ููุฐุง ุงูุบุฑุถ ููููุฐ ุงูุฏูููุฑ ุงููุฑูุญ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telegram.ext.dispatcher <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> run_async @run_async <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_photo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bot, update)</span></span></span><span class="hljs-function">:</span></span> ...</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุณูุชู ุชุดุบูู ุงูุฅุทุงุฑ ููุณู ุงููุนุงูุฌ ุงูุฎุงุต ุจู ูู ูุคุดุฑ ุชุฑุงุจุท ูููุตู ูู ุงูุชุฌูุน ุงูุฎุงุต ุจู.  ูุชู ุชุนููู ุญุฌู ุงูุชุฌูุน ุนูุฏ ุฅูุดุงุก <code>Updater</code> .  "ูููู ูู ุจูุซูู ููุณ ููุงู ุชุนุฏุฏ!"  ุฃูุซุฑ ุตุจุฑ ููู ูุฏ ูุชู ุจุงููุนู.  ููุฐุง ููุณ ุตุญูุญูุง ุชูุงููุง.  ุจุณุจุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GIL ุ</a> ูุง ูููู ุชูููุฐ ููุฏ Python ุงูุนุงุฏู ุจุดูู ูุชูุงุฒู ุ ูููู ูุชู ุฅุตุฏุงุฑ GIL ูุงูุชุธุงุฑ ุฌููุน ุนูููุงุช IO ุ ููููู ุฃูุถูุง ุฅุตุฏุงุฑู ูู ูุจู ุงูููุชุจุงุช ุงูุชู ุชุณุชุฎุฏู ููุญูุงุช C. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ุจุชุญููู ูุธููุฉ <code>handle_photo</code> ุจูุง: ููู ุชุชููู ููุท ูู ุงูุชุธุงุฑ ุนูููุงุช ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ (ุชุญููู ุตูุฑุฉ ุ ุฅุฑุณุงู ุงุณุชุฌุงุจุฉ ุ ูุฑุงุกุฉ ุตูุฑุฉ ูู ุงููุฑุต ุ ููุง ุฅูู ุฐูู) ููุธุงุฆู ุงูุงุชุตุงู ูู <code>numpy</code> <code>nmslib</code> . </p><br><p style=";text-align:right;direction:rtl">  ูู ุฃุฐูุฑ <code>dlib</code> ูุณุจุจ ูุง.  ุงูููุชุจุฉ ุงูุชู ุชุณุชุฏุนู ุงูููุฏ ุงูุฃุตูู ููุณุช ูุทููุจุฉ ูุชุญุฑูุฑ GIL ู <code>dlib</code> ูุฐุง ุงูุญู.  ุฅููุง ูุง ุชุญุชุงุฌ ุฅูู ูุฐุง ุงูููู ุ ููููุง ูุง ุชุณูุญ ููุง ุจุงูุฐูุงุจ.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู</a> ุงููุคูู ุฃูู ุณููุจู ุจูู ุณุฑูุฑ ุทูุจ ุงูุณุญุจ ุงูููุงุณุจ ุ ููููู ูุณูู ุฌุฏูุง. </p><br><h5 id="2-mnogoprocessnost" style=";text-align:right;direction:rtl">  2. ุงููุนุงูุฌุฉ ุงููุชุนุฏุฏุฉ </h5><br><p style=";text-align:right;direction:rtl">  ุฃุณูู ุทุฑููุฉ ููุชุนุงูู ูุน <code>dlib</code> ูู ุชุบููู ุงููููุฐุฌ ูู ููุงู ูููุตู ูุชุดุบููู ูู ุนูููุฉ ูููุตูุฉ.  ูุฃูุถู ูู ุชุฌูุน ุงูุนูููุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_worker_initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> model model = Model(config) model.load_state() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_worker_do</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model.process_image(image) pool = multiprocessing.Pool(<span class="hljs-number"><span class="hljs-number">8</span></span>, initializer=_worker_initialize, initargs=(config,))</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">result = pool.apply(_worker_do, (image,))</code> </pre> <br><h5 id="3-zhelezo" style=";text-align:right;direction:rtl">  3. ุงูุญุฏูุฏ </h5><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ุจุฑูุงูุฌ ุงูุฑูุจูุช ุงูุฎุงุต ุจู ูุญุชุงุฌ ุฅูู ูุฑุงุกุฉ ุงูุตูุฑ ูู ุงููุฑุต ุจุงุณุชูุฑุงุฑ ุ ูุชุฃูุฏ ูู ุฃู ุงููุฑุต ูู SSD.  ุฃู ุญุชู ุชุฑููุจูุง ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู.  ุจููุบ ูุฎูุงุฏู ุงูุจุฑููุฉ ูุฌูุฏุฉ ุงูููุงุฉ ูููุฉ ุฃูุถูุง. </p><br><h5 id="4-flood-control" style=";text-align:right;direction:rtl">  4. ุงูุณูุทุฑุฉ ุนูู ุงูููุถุงูุงุช </h5><br><p style=";text-align:right;direction:rtl">  ูุง ุชุณูุญ ุงูุจุฑููุงุช ูุจุฑุงูุฌ ุงูุฑูุจูุช ุจุฅุฑุณุงู ุฃูุซุฑ ูู 30 ุฑุณุงูุฉ ูู ุงูุซุงููุฉ.  ุฅุฐุง ูุงู ุจุฑูุงูุฌ ุงูุฑูุจูุช ุงูุฎุงุต ุจู ุดุงุฆุนูุง ููุณุชุฎุฏูู ุงููุซูุฑ ูู ุงูุฃุดุฎุงุต ูู ููุณ ุงูููุช ุ ููู ุงูุณูู ุฌุฏูุง ุญุธุฑู ูุจุถุน ุซูุงูู ุ ูุงูุฐู ุณูุชุญูู ุฅูู ุฎูุจุฉ ุฃูู ูู ุชููุนุงุช ุงูุนุฏูุฏ ูู ุงููุณุชุฎุฏููู.  ูุญู ูุฐู ุงููุดููุฉ ุ ููุฏู ููุง <code>python-telegram-bot</code> ูุงุฆูุฉ ุงูุชุธุงุฑ ูุง ูููููุง ุฅุฑุณุงู ุฃูุซุฑ ูู ุญุฏ ุงูุฑุณุงูุฉ ุงููุญุฏุฏ ูู ุงูุซุงููุฉ ุ ูุน ุงูุญูุงุธ ุนูู ูุชุฑุงุช ูุชุณุงููุฉ ุจูู ุงูุฅุฑุณุงู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telegram.ext.messagequeue <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MessageQueue</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงุณุชุฎุฏุงูู ุ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุงูุฑูุจูุช ุงูุฎุงุต ุจู ูุงุณุชุจุฏุงูู ุนูุฏ ุฅูุดุงุก <code>Updater</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> telegram.utils.promise <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Promise <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MQBot</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Bot)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(*args, **kwargs) self._message_queue = MessageQueue( all_burst_limit=<span class="hljs-number"><span class="hljs-number">30</span></span>, all_time_limit_ms=<span class="hljs-number"><span class="hljs-number">1000</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__del__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: self._message_queue.stop() <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: super().__del__() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> is_group = kwargs.get(<span class="hljs-string"><span class="hljs-string">'chat_id'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._message_queue(Promise(super().send_message, args, kwargs), is_group)</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">bot = MQBot(token=TOKEN) updater = Updater(bot=bot)</code> </pre> <br><h5 id="5-web-hooks" style=";text-align:right;direction:rtl">  5. ุฎุทุงู ุงูููุจ </h5><br><p style=";text-align:right;direction:rtl">  ูู ุจูุฆุฉ ุงูููุชุฌ ุ ูุฌุจ ุฏุงุฆููุง ุงุณุชุฎุฏุงู Web Hooks ุจุฏูุงู ูู Long Polling ูุทุฑููุฉ ูุชููู ุงูุชุญุฏูุซุงุช ูู ุฎูุงุฏู Telegram.  ูููู ูุฑุงุกุฉ ูุง ูุฏูุฑ ุญููู ูููููุฉ ุงุณุชุฎุฏุงูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . </p><br><h5 id="6-melochi" style=";text-align:right;direction:rtl">  6. ุงูุชูุงูู </h5><br><p style=";text-align:right;direction:rtl">              <code>json</code> .    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ultrajson</a> . </p><br><p style=";text-align:right;direction:rtl">          IO-:    ,  ,  .      ,         . </p><br><h5 id="6-analitika" style=";text-align:right;direction:rtl"> 6.  </h5><br><p style=";text-align:right;direction:rtl">   ,   .        ,   ,  ,       .        ,        . </p><br><p style=";text-align:right;direction:rtl"> , ,      BI-tool <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Splunk</a>     . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/oh/8e/ve/oh8eve_hczr4pahrzum56fonxxg.jpeg" alt="ุงูููุญ ุงูุฅุนูุงูู (ูุฑุฌู ุชูุฏูุฏ ุงูุชุฑุฎูุต ููุง)"></p><br><p style=";text-align:right;direction:rtl">   ,         .     ,                       . </p><br><p style=";text-align:right;direction:rtl">    ,         .      ,    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">@OkkoFaceBot</a> . </p><br><p style=";text-align:right;direction:rtl"><del>        </del> ,     . ,      . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar417329/">https://habr.com/ru/post/ar417329/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar417319/index.html">ุงูุฃูุธูุฉ ุงูููุฌูุฏุฉ ูู ุงูุญุงูุฉ ุฃู ูุง ูู ุชุญุช ุบุทุงุก ุงููุนุงูุฌ ุงูุฏููู</a></li>
<li><a href="../ar417321/index.html">ููู ูุจุญุซ ุนู ูุนููู ุงูุฏูุฑุงุช ุนุจุฑ ุงูุฅูุชุฑูุช ุจูู ุงููุทูุฑููุ</a></li>
<li><a href="../ar417323/index.html">ูุดุงูู ุถูุงู ุงููุตูู ุฅูู ุงููุดุฑูุน ุจูุณุจุฉ 100ูช</a></li>
<li><a href="../ar417325/index.html">ุงูููู ุงูููุชูุญ Netrology ุ ููุถูุน ุนููู ุงูุจูุงูุงุช</a></li>
<li><a href="../ar417327/index.html">ูุฑุงูุจุฉ ุงูููุฒุงููุฉ ูุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ูู ุบุฑูุฉ ุงูุฎุงุฏู (MP707 + nettop ูุน Linux + PRTG)</a></li>
<li><a href="../ar417331/index.html">ุฃุณุจูุน ุงูุฃูู 26: ุชุญุฏูุซ ุดุจุญ ุ ุชุณุฌูู ูุฐูุฐ ุงูุขู</a></li>
<li><a href="../ar417333/index.html">ุงูุชุตููู ุงูุงุฌุชูุงุนู</a></li>
<li><a href="../ar417337/index.html">ูุจุงุฏุฆ ุงูุชุดุบูู ูุฎุตุงุฆุต ุงูุชุทุจูู ูููุจุงุฏูุฉ ุงูุฐุฑูุฉ</a></li>
<li><a href="../ar417339/index.html">3DTouch - ุงูููุงููุณ ุนูู iPhone: ุงูุงูุชูุงุก</a></li>
<li><a href="../ar417345/index.html">ุชูุฏูุฏ ุงูุตูุฏ ุจุฑุคูุฉ ุณูุณูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>