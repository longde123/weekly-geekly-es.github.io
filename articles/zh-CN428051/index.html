<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤¼ ğŸšˆ ğŸ™†ğŸ¿ å¦‚ä½•ä½¿æ›´å¤šæ— æ•ˆçŠ¶æ€å˜å¾—æ›´åŠ éš¾ä»¥è¨€è¯´ ğŸ‘¨ğŸ» ğŸ¤œğŸ½ ğŸ‘¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸ä¹…å‰ï¼ŒHabr ç¿»è¯‘äº†ä¸€ç¯‡æ–‡ç«  ï¼Œ å†…å®¹æ¶‰åŠå¦‚ä½•ä½¿ç”¨ä»£æ•°æ•°æ®ç±»å‹ä»¥ç¡®ä¿ä¸æ­£ç¡®çš„çŠ¶æ€æ˜¯ä¸å¯è¡¨è¾¾çš„ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬ç ”ç©¶ä¸€ç§è¡¨è¾¾è¿™ç§æ— æ³•è¡¨è¾¾çš„æ–¹å¼çš„æ–¹å¼ï¼Œè¯¥æ–¹å¼ç¨å¾®æ›´ç¬¼ç»Ÿï¼Œæ›´å¯æ‰©å±•ä¸”æ›´å®‰å…¨ï¼ŒHaskellå°†åœ¨æ­¤æ–¹é¢ä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ã€‚ 


ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ–‡ç« è®¨è®ºäº†ä¸€ä¸ªå…·æœ‰é‚®ä»¶åœ°å€å’Œç”µå­é‚®ä»¶åœ°å€çš„å®ä½“ï¼Œä»¥åŠé™„åŠ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¦‚ä½•ä½¿æ›´å¤šæ— æ•ˆçŠ¶æ€å˜å¾—æ›´åŠ éš¾ä»¥è¨€è¯´</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428051/"><p> ä¸ä¹…å‰ï¼ŒHabr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¿»è¯‘äº†ä¸€ç¯‡æ–‡ç« </a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†…å®¹</a>æ¶‰åŠå¦‚ä½•ä½¿ç”¨ä»£æ•°æ•°æ®ç±»å‹ä»¥ç¡®ä¿ä¸æ­£ç¡®çš„çŠ¶æ€æ˜¯ä¸å¯è¡¨è¾¾çš„ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬ç ”ç©¶ä¸€ç§è¡¨è¾¾è¿™ç§æ— æ³•è¡¨è¾¾çš„æ–¹å¼çš„æ–¹å¼ï¼Œè¯¥æ–¹å¼ç¨å¾®æ›´ç¬¼ç»Ÿï¼Œæ›´å¯æ‰©å±•ä¸”æ›´å®‰å…¨ï¼ŒHaskellå°†åœ¨æ­¤æ–¹é¢ä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ã€‚ </p><a name="habracut"></a><br><p>ç®€è€Œè¨€ä¹‹ï¼Œè¯¥æ–‡ç« è®¨è®ºäº†ä¸€ä¸ªå…·æœ‰é‚®ä»¶åœ°å€å’Œç”µå­é‚®ä»¶åœ°å€çš„å®ä½“ï¼Œä»¥åŠé™„åŠ æ¡ä»¶ï¼Œå³å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªè¿™äº›åœ°å€ã€‚ å»ºè®®å¦‚ä½•åœ¨ç±»å‹çº§åˆ«ä¸Šè¡¨è¾¾æ­¤æ¡ä»¶ï¼Ÿ å»ºè®®å†™ä»¥ä¸‹åœ°å€ï¼š </p><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ContactInfo = | EmailOnly <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> EmailContactInfo | PostOnly <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> PostalContactInfo | EmailAndPost <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> EmailContactInfo * PostalContactInfo</code> </pre> <br><p> è¿™ç§æ–¹æ³•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ </p><br><p> æœ€æ˜æ˜¾çš„ï¼ˆåœ¨è¯¥æ–‡ç« çš„è¯„è®ºä¸­å¤šæ¬¡æåˆ°ï¼‰æ˜¯è¿™ç§æ–¹æ³•æ ¹æœ¬æ— æ³•æ‰©å±•ã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¸¤ç§ç±»å‹çš„åœ°å€ï¼Œè€Œæ˜¯ä¸‰ä¸ªæˆ–äº”ä¸ªï¼Œæ­£ç¡®æ€§æ¡ä»¶çœ‹èµ·æ¥åƒâ€œå¿…é¡»æœ‰ä¸€ä¸ªé‚®å¯„åœ°å€ï¼Œæˆ–è€…æ—¢æœ‰ç”µå­é‚®ä»¶åœ°å€åˆæœ‰åŠå…¬åœ°å€ï¼Œå¹¶ä¸”ä¸åº”æœ‰å¤šä¸ªç›¸åŒç±»å‹çš„åœ°å€â€ã€‚ é‚£äº›å¸Œæœ›çš„äººå¯ä»¥ç¼–å†™é€‚å½“çš„ç±»å‹ä½œä¸ºè‡ªæµ‹ç»ƒä¹ ã€‚ å½“å…³äºä¸å­˜åœ¨é‡å¤é¡¹çš„æ¡ä»¶ä»TORä¸­æ¶ˆå¤±æ—¶ï¼Œå¸¦æœ‰æ˜Ÿå·çš„ä»»åŠ¡æ˜¯é‡å†™æ­¤ç±»å‹ã€‚ </p><br><h3> åˆ†äº«åˆ° </h3><br><p> å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ è®©æˆ‘ä»¬å°è¯•å¹»æƒ³ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬åˆ†è§£å¹¶åˆ†ç¦»åœ°å€ç±»ï¼ˆä¾‹å¦‚ï¼ŒåŠå…¬å®¤ä¸­çš„é‚®ä»¶/ç”µå­é‚®ä»¶/æœåŠ¡å°å·ç ï¼‰å’Œä¸è¯¥ç±»ç›¸å¯¹åº”çš„å†…å®¹ï¼š </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddrType</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Post</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Email</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Office</span></span></span></span></code> </pre> <br><p> æˆ‘ä»¬ä¸ä¼šè€ƒè™‘è¯¥å†…å®¹ï¼Œå› ä¸ºåœ¨åœ°å€åˆ—è¡¨çš„æœ‰æ•ˆæ€§æ–¹é¢ï¼Œå®ƒä¸å†…å®¹æ— å…³ã€‚ </p><br><p> å¦‚æœæˆ‘ä»¬åœ¨æŸäº›æ™®é€šçš„OOPè¯­è¨€çš„æ„é€ å‡½æ•°çš„è¿è¡Œæ—¶ä¸­æ£€æŸ¥äº†ç›¸åº”çš„æ¡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç±»ä¼¼ </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">valid</span></span> :: [<span class="hljs-type"><span class="hljs-type">AddrType</span></span>] -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> valid xs = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> hasNoDups = nub xs == xs <span class="hljs-comment"><span class="hljs-comment">--      hasPost = Post `elem` xs hasEmail = Email `elem` xs hasOffice = Office `elem` xs in hasNoDups &amp;&amp; (hasPost || (hasEmail &amp;&amp; hasOffice))</span></span></code> </pre> <br><p> å¦‚æœè¿”å›<code>False</code> ï¼Œå°†å¼•å‘ä¸€äº›æ‰§è¡Œã€‚ </p><br><p> åœ¨ç¼–è¯‘æ—¶ï¼Œæ˜¯å¦å¯ä»¥åœ¨è®¡æ—¶å™¨çš„å¸®åŠ©ä¸‹æ£€æŸ¥ç±»ä¼¼æƒ…å†µï¼Ÿ äº‹å®è¯æ˜ï¼Œæ˜¯çš„ï¼Œå¦‚æœè¯­è¨€çš„ç±»å‹ç³»ç»Ÿè¶³å¤Ÿè¡¨è¾¾ï¼Œæˆ‘ä»¬å¯ä»¥ï¼Œåœ¨æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚ </p><br><p> åœ¨è¿™é‡Œï¼Œä¾èµ–ç±»å‹å°†å¯¹æˆ‘ä»¬æœ‰å¾ˆå¤§å¸®åŠ©ï¼Œç”±äºåœ¨Haskellä¸­ç¼–å†™ç»è¿‡éªŒè¯çš„ä»£ç çš„æœ€å……åˆ†æ–¹æ³•æ˜¯é¦–å…ˆåœ¨Agdeæˆ–Idrisä¸­ç¼–å†™ä»£ç ï¼Œå› æ­¤æˆ‘ä»¬å°†æ¢é‹å¹¶åœ¨Idrisä¸­ç¼–å†™ä»£ç ã€‚  idrisè¯­æ³•éå¸¸æ¥è¿‘Haskellï¼šä¾‹å¦‚ï¼Œä½¿ç”¨ä¸Šè¿°åŠŸèƒ½ï¼Œæ‚¨åªéœ€ç¨å¾®æ›´æ”¹ç­¾åå³å¯ï¼š </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">valid</span></span> : List AddrType -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span></code> </pre> <br><p> ç°åœ¨è¯·è®°ä½ï¼Œé™¤äº†åœ°å€ç±»åˆ«å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®ƒä»¬çš„å†…å®¹ï¼Œå¹¶å°†å­—æ®µå¯¹åœ°å€ç±»åˆ«çš„ä¾èµ–æ€§ç¼–ç ä¸ºGADTï¼š </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddrFields</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddrType</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class"> where </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PostFields</span></span></span><span class="hljs-class"> : (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">city</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">) -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">street</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddrFields</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmailFields</span></span></span><span class="hljs-class"> : (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddrFields</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Email</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OfficeFields</span></span></span><span class="hljs-class"> : (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">floor</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">) -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">desk</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Nat</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddrFields</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Office</span></span></span></span></code> </pre> <br><p> ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç»™æˆ‘ä»¬ä¸€ä¸ªç±»å‹ä¸º<code>AddrFields t</code>çš„<code>fields</code>å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“<code>t</code>æ˜¯æŸä¸ªAddrType <code>AddrType</code>å¹¶ä¸”è¯¥<code>fields</code>åŒ…å«ä¸è¯¥ç‰¹å®šç±»ç›¸å¯¹åº”çš„ä¸€ç»„å­—æ®µã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">å…³äºè¿™ç¯‡æ–‡ç« </b> <div class="spoiler_text"><p> è¿™ä¸æ˜¯æœ€å®‰å…¨çš„ç±»å‹ç¼–ç ï¼Œå› ä¸ºGADTä¸å¿…æ˜¯å†…å°„çš„ï¼Œå¹¶ä¸”å£°æ˜ä¸‰ä¸ªå•ç‹¬çš„æ•°æ®ç±»å‹<code>PostFields</code> ï¼Œ <code>EmailFields</code> ï¼Œ <code>OfficeFields</code>å¹¶ç¼–å†™å‡½æ•°ä¼šæ›´æ­£ç¡® </p><br><pre> <code class="hljs pgsql">addrFields : AddrType -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> addrFields Post = PostFields addrFields Email = EmailFields addrFields Office = OfficeFields</code> </pre> <br><p> ä½†è¿™å¤ªå¤šäº†ï¼Œå¯¹äºåŸå‹å¹¶æ²¡æœ‰å¤ªå¤§çš„æ”¶è·ï¼Œä¸ºæ­¤ï¼Œåœ¨Haskellä¸­ä»ç„¶æœ‰æ›´åŠ ç®€æ´å’Œä»¤äººæ„‰æ‚¦çš„æœºåˆ¶ã€‚ </p></div></div><br><p> æ­¤æ¨¡å‹çš„æ•´ä¸ªåœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ è¿™æ˜¯ä¸€å¯¹åœ°å€ç±»å’Œç›¸åº”çš„å­—æ®µï¼š </p><br><pre> <code class="hljs pgsql">Addr : <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> Addr = (t : AddrType ** AddrFields t)</code> </pre> <br><p> ç±»å‹ç†è®ºçš„æ‹¥æŠ¤è€…ä¼šè¯´è¿™æ˜¯ä¸€ä¸ªä¸å­˜åœ¨æœ‰å…³çš„ç±»å‹ï¼šå¦‚æœæˆ‘ä»¬ç»™å®šäº†ç±»å‹<code>Addr</code>å€¼ï¼Œé‚£ä¹ˆè¿™æ„å‘³ç€å­˜åœ¨ç±»å‹<code>AddrType</code>çš„å€¼<code>t</code>å’Œä¸€ç»„å¯¹åº”çš„<code>AddrFields t</code>å­—æ®µã€‚ å½“ç„¶ï¼Œä¸åŒç±»åˆ«çš„åœ°å€æ˜¯åŒä¸€ç±»å‹ï¼š </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">someEmailAddr</span></span> : Addr someEmailAddr = (Email ** EmailFields <span class="hljs-string"><span class="hljs-string">"that</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">@feel</span></span></span><span class="hljs-string">.bro"</span></span>) someOfficeAddr : Addr someOfficeAddr = (Office ** OfficeFields (-<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">762</span></span>)</code> </pre> <br><p> æ­¤å¤–ï¼Œå¦‚æœå°†<code>EmailFields</code>ç»™æˆ‘ä»¬ï¼Œé‚£ä¹ˆå”¯ä¸€åˆé€‚çš„åœ°å€ç±»åˆ«æ˜¯<code>Email</code> ï¼Œå› æ­¤æ‚¨å¯ä»¥çœç•¥å®ƒï¼Œè®¡æ—¶å™¨å°†è‡ªå·±æ‰“å°å®ƒï¼š </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">someEmailAddr</span></span> : Addr someEmailAddr = (_ ** EmailFields <span class="hljs-string"><span class="hljs-string">"that</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">@feel</span></span></span><span class="hljs-string">.bro"</span></span>) someOfficeAddr : Addr someOfficeAddr = (_ ** OfficeFields (-<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">762</span></span>)</code> </pre> <br><p> æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œè¯¥å‡½æ•°æä¾›äº†åœ°å€åˆ—è¡¨ä¸­ç›¸åº”çš„åœ°å€ç±»åˆ—è¡¨ï¼Œå¹¶ç«‹å³å°†å…¶æ³›åŒ–ä¸ºå¯åœ¨ä»»æ„å‡½å­ä¸Šå·¥ä½œï¼š </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">types</span></span> : Functor f =&gt; f Addr -&gt; f AddrType <span class="hljs-keyword"><span class="hljs-keyword">types</span></span> = map fst</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œå­˜åœ¨çš„<code>Addr</code>ç±»å‹çš„è¡Œä¸ºå°±åƒä¸€å¯¹ç†Ÿæ‚‰çš„å¤«å¦‡ï¼šç‰¹åˆ«æ˜¯ï¼Œæ‚¨å¯ä»¥è¦æ±‚å…¶ç¬¬ä¸€ä¸ªç»„ä»¶<code>AddrType</code> ï¼ˆå¸¦æœ‰æ˜Ÿå·çš„ä»»åŠ¡ï¼šä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½è¦æ±‚ç¬¬äºŒä¸ªç»„ä»¶ï¼Ÿï¼‰ã€‚ </p><br><h4> å‡èµ· </h4><br><p> ç°åœ¨æˆ‘ä»¬ç»§ç»­è®²æ•…äº‹çš„å…³é”®éƒ¨åˆ†ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª<code>List Addr</code>åœ°å€<code>List Addr</code>å’Œä¸€äº›<code>valid : List AddrType -&gt; Bool</code>è°“è¯<code>valid : List AddrType -&gt; Bool</code> ï¼Œæˆ‘ä»¬è¦ä¿è¯åœ¨ç±»å‹çº§åˆ«ä¸Šå¯¹æ­¤åˆ—è¡¨çš„æ‰§è¡Œã€‚ æˆ‘ä»¬å¦‚ä½•ç»“åˆå®ƒä»¬ï¼Ÿ å½“ç„¶æ˜¯å¦ä¸€ç§ç±»å‹ï¼ </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidatedAddrList</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">List</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Addr</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class"> where </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MkValidatedAddrList</span></span></span><span class="hljs-class"> : (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lst</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">List</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Addr</span></span></span><span class="hljs-class">) -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">prf</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">valid</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lst</span></span></span><span class="hljs-class">) = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">True</span></span></span><span class="hljs-class">) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidatedAddrList</span></span></span><span class="hljs-class"> lst</span></span></code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ†æåœ¨è¿™é‡Œå†™çš„å†…å®¹ã€‚ </p><br><p>  <code>data ValidatedAddrList : List Addr -&gt; Type where</code>è¡¨ç¤ºç±»å‹<code>ValidatedAddrList</code>å®é™…ä¸Šæ˜¯ç”±åœ°å€åˆ—è¡¨å‚æ•°åŒ–çš„ã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ç§ç±»å‹çš„å”¯ä¸€<code>MkValidatedAddrList</code>æ„é€ å‡½æ•°çš„ç­¾åï¼š <code>(lst : List Addr) -&gt; (prf : valid (types lst) = True) -&gt; ValidatedAddrList lst</code> ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒéœ€è¦ä¸€äº›<code>lst</code>åœ°å€åˆ—è¡¨å’Œå¦ä¸€ä¸ª<code>valid (types lst) = True</code> <code>prf</code>å‚æ•°ã€‚ è¿™ç§ç±»å‹æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ å› æ­¤ï¼Œè¿™æ„å‘³ç€<code>=</code>å·¦è¾¹çš„å€¼ç­‰äº<code>=</code>å³è¾¹çš„å€¼ï¼Œå³<code>valid (types lst)</code>å®é™…ä¸Šä¸ºTrueã€‚ </p><br><p> å¦‚ä½•è¿ä½œï¼Ÿ ç­¾å<code>=</code>çœ‹èµ·æ¥åƒ<code>(x : A) -&gt; (y : B) -&gt; Type</code> ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œ <code>=</code>å–ä¸¤ä¸ªä»»æ„å€¼<code>x</code>å’Œ<code>y</code> ï¼ˆç”šè‡³å¯èƒ½å…·æœ‰ä¸åŒçš„<code>A</code>å’Œ<code>B</code>ç±»å‹ï¼Œè¿™æ„å‘³ç€idrisä¸­çš„ä¸ç­‰å¼æ˜¯å¼‚è´¨çš„ï¼Œä»ç±»å‹ç†è®ºçš„è§’åº¦æ¥çœ‹å®ƒæœ‰ç‚¹æ¨¡æ£±ä¸¤å¯ï¼Œä½†è¿™æ˜¯å¦ä¸€ä¸ªè®¨è®ºçš„ä¸»é¢˜ï¼‰ã€‚ é‚£ä¹ˆä»€ä¹ˆè¯æ˜äº†å¹³ç­‰å‘¢ï¼Ÿ å¹¶ä¸”ç”±äºå”¯ä¸€çš„æ„é€ å‡½æ•°<code>=</code> <code>Refl</code>å…·æœ‰<em>å‡ ä¹</em> <code>(x : A) -&gt; x = x</code>çš„ç­¾åã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å…·æœ‰ç±»å‹<code>x = y</code>çš„å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“å®ƒæ˜¯ä½¿ç”¨<code>Refl</code>æ„å»ºçš„ï¼ˆå› ä¸ºæ²¡æœ‰å…¶ä»–æ„é€ å‡½æ•°ï¼‰ï¼Œè¿™æ„å‘³ç€<code>x</code>å®é™…ä¸Šç­‰äº<code>y</code> ã€‚ </p><br><p> è¯·æ³¨æ„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨Haskellä¸­æˆ‘ä»¬æ€»æ˜¯å……å…¶é‡åªèƒ½å†’å……æˆ‘ä»¬æ­£åœ¨è¯æ˜çš„ä¸œè¥¿ï¼Œå› ä¸ºHaskellå…·æœ‰<code>undefined</code> ï¼Œå¯ä»¥å±…ä½ä»»ä½•ç±»å‹çš„ä¸œè¥¿ï¼Œå› æ­¤ä¸Šè¿°å‚æ•°åœ¨é‚£é‡Œä¸èµ·ä½œç”¨ï¼šå¯¹äºä»»ä½•<code>x</code> ï¼Œ <code>y</code> <code>x = y</code>ç±»å‹é¡¹<code>x = y</code>å¯ä»¥é€šè¿‡<code>undefined</code> ï¼ˆæˆ–é€šè¿‡æ— é™é€’å½’æ¥åˆ›å»ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå°±ç±»å‹ç†è®ºè€Œè¨€ï¼ŒåŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ï¼‰ã€‚ </p><br><p> æˆ‘ä»¬è¿˜æ³¨æ„åˆ°ï¼Œè¿™é‡Œçš„ç›¸ç­‰å¹¶ä¸æ˜¯ä»Haskellçš„<code>Eq</code>æˆ–C ++ä¸­çš„ä»»ä½•<code>operator==</code>çš„æ„ä¹‰å‡ºå‘ï¼Œè€Œæ˜¯è¦ä¸¥æ ¼å¾—å¤šï¼šç»“æ„åŒ–çš„ï¼Œç®€åŒ–åœ°è¡¨ç¤ºè¿™ä¸¤ä¸ªå€¼å…·æœ‰ç›¸åŒçš„<em>å½¢å¼</em> ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æ­¤æ¬ºéª—ä»–æ ¹æœ¬è¡Œä¸é€šã€‚ ä½†æ˜¯ï¼Œä¼ ç»Ÿä¸Šï¼Œå¹³ç­‰é—®é¢˜æ˜¯ç”±å•ç‹¬çš„æ¡æ¬¾æå‡ºçš„ã€‚ </p><br><p> ä¸ºäº†å·©å›ºæˆ‘ä»¬å¯¹ç›¸ç­‰æ€§çš„ç†è§£ï¼Œæˆ‘ä»¬ä¸º<code>valid</code>åŠŸèƒ½ç¼–å†™äº†å•å…ƒæµ‹è¯•ï¼š </p><br><pre> <code class="hljs powershell">testPostValid : valid [<span class="hljs-type"><span class="hljs-type">Post</span></span>] = True testPostValid = Refl testEmptyInvalid : valid [] = False testEmptyInvalid = Refl testDupsInvalid : valid [<span class="hljs-type"><span class="hljs-type">Post</span></span>, <span class="hljs-type"><span class="hljs-type">Post</span></span>] = False testDupsInvalid = Refl testPostEmailValid : valid [<span class="hljs-type"><span class="hljs-type">Post</span></span>, <span class="hljs-type"><span class="hljs-type">Email</span></span>] = True testPostEmailValid = Refl</code> </pre> <br><p> è¿™äº›æµ‹è¯•å¾ˆå¥½ï¼Œå› ä¸ºæ‚¨ç”šè‡³ä¸éœ€è¦è¿è¡Œå®ƒä»¬ï¼Œtaypcheræ£€æŸ¥å®ƒä»¬å°±è¶³å¤Ÿäº†ã€‚ ç¡®å®ï¼Œä¾‹å¦‚ï¼Œåœ¨å®ƒä»¬çš„ç¬¬ä¸€ä¸ªä¸­ï¼Œè®©æˆ‘ä»¬ç”¨<code>False</code>æ›¿æ¢<code>True</code> ï¼Œç„¶åçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š </p><br><pre> <code class="hljs pgsql">testPostValid : <span class="hljs-keyword"><span class="hljs-keyword">valid</span></span> [Post] = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> testPostValid = Refl</code> </pre> <br><p>  Typsekherå‘èª“ </p><br><p><img src="https://habrastorage.org/webt/l7/to/xm/l7toxmndt6lzzbpmjersntiujfg.png"></p><br><p> å¦‚é¢„æœŸçš„é‚£æ ·ã€‚ å¤ªå¥½äº† </p><br><h4> ç®€åŒ– </h4><br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬é‡æ„ä¸€ä¸‹<code>ValidatedAddrList</code> ã€‚ </p><br><p> é¦–å…ˆï¼Œå°†æŸä¸ªå€¼ä¸<code>True</code>è¿›è¡Œæ¯”è¾ƒçš„æ¨¡å¼éå¸¸æ™®éï¼Œ <code>So</code>åœ¨idrisä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹<code>So</code> ï¼šæ‚¨å¯ä»¥å°†<code>So x</code>ç”¨ä½œ<code>x = True</code>çš„åŒä¹‰è¯ã€‚ è®©æˆ‘ä»¬ä¿®å¤<code>ValidatedAddrList</code>çš„å®šä¹‰ï¼š </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidatedAddrList</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">List</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Addr</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class"> where </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MkValidatedAddrList</span></span></span><span class="hljs-class"> : (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lst</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">List</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Addr</span></span></span><span class="hljs-class">) -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">prf</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">So</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">valid</span></span></span><span class="hljs-class"> $ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lst</span></span></span><span class="hljs-class">)) -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidatedAddrList</span></span></span><span class="hljs-class"> lst</span></span></code> </pre> <br><p> å¦å¤–ï¼Œ <code>So</code>å…·æœ‰æ–¹ä¾¿çš„è¾…åŠ©åŠŸèƒ½<code>choose</code> ï¼Œä»æœ¬è´¨ä¸Šå°†æ£€æŸ¥æé«˜åˆ°ç±»å‹çš„æ°´å¹³ï¼š </p><br><pre> <code class="hljs pgsql">&gt; :doc choose Data.So.choose : (b : <span class="hljs-type"><span class="hljs-type">Bool</span></span>) -&gt; Either (So b) (So (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> b)) <span class="hljs-keyword"><span class="hljs-keyword">Perform</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> analysis <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> a <span class="hljs-type"><span class="hljs-type">Boolean</span></span>, providing clients <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> a So proof</code> </pre> <br><p> å½“æˆ‘ä»¬ç¼–å†™ä¿®æ”¹æ­¤ç±»å‹çš„å‡½æ•°æ—¶ï¼Œè¿™å¯¹æˆ‘ä»¬å¾ˆæœ‰ç”¨ã€‚ </p><br><p> å…¶æ¬¡ï¼Œæœ‰æ—¶ï¼ˆå°¤å…¶æ˜¯åœ¨äº¤äº’å¼å¼€å‘ä¸­ï¼‰idriså¯ä»¥è‡ªè¡Œæ‰¾åˆ°åˆé€‚çš„<code>prf</code>å€¼ã€‚ ä¸ºäº†åœ¨è¿™ç§æƒ…å†µä¸‹ä¸å¿…æ‰‹å·¥æ„å»ºï¼Œæœ‰ç›¸åº”çš„è¯­æ³•ç³–ï¼š </p><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidatedAddrList</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">List</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Addr</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class"> where </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MkValidatedAddrList</span></span></span><span class="hljs-class"> : (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lst</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">List</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Addr</span></span></span><span class="hljs-class">) -&gt; {</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">prf</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">So</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">valid</span></span></span><span class="hljs-class"> $ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lst</span></span></span><span class="hljs-class">)} -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ValidatedAddrList</span></span></span><span class="hljs-class"> lst</span></span></code> </pre> <br><p> å¤§æ‹¬å·è¡¨ç¤ºè¿™æ˜¯idriså°†å°è¯•è„±ç¦»ä¸Šä¸‹æ–‡çš„éšå¼å‚æ•°ï¼Œè€Œ<code>auto</code>è¡¨ç¤ºä»–è¿˜å°†å°è¯•è‡ªè¡Œæ„é€ å®ƒã€‚ </p><br><p> é‚£ä¹ˆï¼Œè¿™ä¸ªæ–°çš„<code>ValidatedAddrList</code>ç»™æˆ‘ä»¬å¸¦æ¥äº†ä»€ä¹ˆï¼Ÿ å¹¶ç»™å‡ºäº†è¿™æ ·çš„æ¨ç†é“¾ï¼šä»¤<code>val</code>ä¸º<code>ValidatedAddrList lst</code>ç±»å‹çš„å€¼ã€‚ è¿™æ„å‘³ç€<code>lst</code>æ˜¯ä¸€ä¸ªåœ°å€åˆ—è¡¨ï¼Œæ­¤å¤–ï¼Œ <code>val</code>æ˜¯ä½¿ç”¨<code>MkValidatedAddrList</code>æ„é€ å‡½æ•°åˆ›å»ºçš„ï¼Œæˆ‘ä»¬å°†è¿™ä¸ª<code>lst</code>å’Œå¦ä¸€ä¸ª<code>So (valid $ types lst)</code>ç±»å‹çš„<code>prf</code>å€¼<code>So (valid $ types lst)</code>ä¼ é€’ç»™äº†<code>val</code> ï¼Œè¯¥å€¼å‡ ä¹æ˜¯<code>valid (types lst) = True</code> ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»º<code>prf</code> ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬éœ€è¦è¯æ˜è¿™ç§å¹³ç­‰æˆç«‹ã€‚ </p><br><p> æœ€ç¾ä¸½çš„æ˜¯ï¼Œè¿™ä¸€åˆ‡éƒ½ç”±ä¸€åtympheræ£€æŸ¥ã€‚ æ˜¯çš„ï¼Œæœ‰æ•ˆæ€§æ£€æŸ¥å¿…é¡»åœ¨è¿è¡Œæ—¶è¿›è¡Œï¼ˆå› ä¸ºå¯ä»¥ä»æ–‡ä»¶æˆ–ç½‘ç»œä¸­è¯»å–åœ°å€ï¼‰ï¼Œä½†æ˜¯è®¡æ—¶å™¨å°†ç¡®ä¿å®Œæˆæ­¤æ£€æŸ¥ï¼šæ²¡æœ‰å®ƒï¼Œå°±æ— æ³•åˆ›å»º<code>ValidatedAddrList</code> ã€‚ è‡³å°‘åœ¨idrisä¸­ã€‚  Hasï¼Œåœ¨Haskellã€‚ </p><br><h4> æ’å…¥ </h4><br><p> è¦éªŒè¯éªŒè¯çš„å¿…ç„¶æ€§ï¼Œè¯·å°è¯•ç¼–å†™å°†åœ°å€æ·»åŠ åˆ°åˆ—è¡¨çš„å‡½æ•°ã€‚ ç¬¬ä¸€æ¬¡å°è¯•ï¼š </p><br><pre> <code class="hljs coffeescript">insert : <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(addr : Addr)</span></span></span><span class="hljs-function"> -&gt;</span></span> ValidatedAddrList lst -&gt; ValidatedAddrList (addr :: lst) insert addr (MkValidatedAddrList lst) = MkValidatedAddrList (addr :: lst)</code> </pre> <br><p> ä¸ï¼Œé”™å­—æ£€æŸ¥å™¨ä¼šåœ¨æ‰‹æŒ‡ä¸Šæ˜¾ç¤ºï¼ˆå°½ç®¡ä¸æ˜¯å¾ˆå¯è¯»ï¼Œä½†<code>valid</code>çš„æˆæœ¬å¤ªå¤æ‚äº†ï¼‰ï¼š </p><br><p><img src="https://habrastorage.org/webt/au/oa/6j/auoa6jeo10ucav7rffetqmvylec.png"></p><br><p> æˆ‘ä»¬å¦‚ä½•è·å¾—æ­¤<code>So</code>çš„å‰¯æœ¬ï¼Ÿ é™¤äº†ä¸Šè¿°<code>choose</code> ã€‚ ç¬¬äºŒæ¬¡å°è¯•ï¼š </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> : (addr : Addr) -&gt; ValidatedAddrList lst -&gt; ValidatedAddrList (addr :: lst) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> addr (MkValidatedAddrList lst) = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">choose</span></span> (valid $ types (addr :: lst)) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Left</span></span> l =&gt; MkValidatedAddrList (addr :: lst) <span class="hljs-keyword"><span class="hljs-keyword">Right</span></span> r =&gt; ?rhs</code> </pre> <br><p> å®ƒå‡ ä¹æ˜¯typechetsyaã€‚  â€œå‡ ä¹â€æ˜¯å› ä¸ºä¸æ¸…æ¥šç”¨ä»€ä¹ˆä»£æ›¿<code>rhs</code> ã€‚ è€Œæ˜¯å¾ˆæ¸…æ¥šï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å‡½æ•°å¿…é¡»ä»¥æŸç§æ–¹å¼æŠ¥å‘Šé”™è¯¯ã€‚ å› æ­¤ï¼Œæ‚¨éœ€è¦æ›´æ”¹ç­¾åå¹¶åŒ…è£…è¿”å›å€¼ï¼Œä¾‹å¦‚åœ¨<code>Maybe</code> ï¼š </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> : (addr : Addr) -&gt; ValidatedAddrList lst -&gt; Maybe (ValidatedAddrList (addr :: lst)) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> addr (MkValidatedAddrList lst) = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">choose</span></span> (valid $ types (addr :: lst)) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Left</span></span> l =&gt; Just $ MkValidatedAddrList (addr :: lst) <span class="hljs-keyword"><span class="hljs-keyword">Right</span></span> r =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span></code> </pre> <br><p> è¿™æ˜¯å¹³é“ºçš„ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ </p><br><p> ä½†æ˜¯ç°åœ¨å‡ºç°äº†ä»¥ä¸‹ä¸æ˜¯å¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œå®é™…ä¸Šæ˜¯åŸå§‹æ–‡ç« ä¸­çš„é—®é¢˜ã€‚ æ­¤å‡½æ•°çš„ç±»å‹ä¸ä¼šåœæ­¢ç¼–å†™è¿™æ ·çš„å®ç°ï¼š </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> : (addr : Addr) -&gt; ValidatedAddrList lst -&gt; Maybe (ValidatedAddrList (addr :: lst)) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> addr (MkValidatedAddrList lst) = <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span></code> </pre> <br><p> ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ€»æ˜¯è¯´æˆ‘ä»¬æ— æ³•å»ºç«‹æ–°çš„åœ°å€åˆ—è¡¨ã€‚  Typhechaetsyaï¼Ÿ æ˜¯çš„ å¯¹å— å¥½å§ï¼Œå‡ ä¹æ²¡æœ‰ã€‚ å¯ä»¥é¿å…å—ï¼Ÿ </p><br><p> äº‹å®è¯æ˜è¿™æ˜¯æœ‰å¯èƒ½çš„ï¼Œä¸ºæ­¤æˆ‘ä»¬æ‹¥æœ‰æ‰€æœ‰å¿…è¦çš„å·¥å…·ã€‚ å¦‚æœæˆåŠŸï¼Œ <code>insert</code>è¿”å›<code>ValidatedAddrList</code> ï¼Œå…¶ä¸­åŒ…å«éå¸¸æˆåŠŸçš„è¯æ®ã€‚ å› æ­¤ï¼Œæ·»åŠ ä¼˜é›…çš„å¯¹ç§°æ€§ï¼Œå¹¶è¦æ±‚å‡½æ•°è¿˜è¿”å›å¤±è´¥è¯æ˜ï¼ </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> : (addr : Addr) -&gt; ValidatedAddrList lst -&gt; Either (So (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> $ valid $ types (addr :: lst))) (ValidatedAddrList (addr :: lst)) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> addr (MkValidatedAddrList lst) = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">choose</span></span> (valid $ types (addr :: lst)) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Left</span></span> l =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Right</span></span> $ MkValidatedAddrList (addr :: lst) <span class="hljs-keyword"><span class="hljs-keyword">Right</span></span> r =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Left</span></span> r</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬ä¸èƒ½åªæ¥å—å¹¶å§‹ç»ˆè¿”å›<code>Nothing</code> ã€‚ </p><br><p> æ‚¨å¯ä»¥å¯¹åœ°å€åˆ é™¤åŠŸèƒ½ç­‰æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹çœ‹ç°åœ¨ä¸€åˆ‡çœ‹èµ·æ¥å¦‚ä½•ã€‚ </p><br><p> è®©æˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ªç©ºçš„åœ°å€åˆ—è¡¨ï¼š </p><br><p><img src="https://habrastorage.org/webt/9l/pf/a_/9lpfa_ytfrgfsvxbvy4lkk0a8uy.png"></p><br><p> è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œç©ºåˆ—è¡¨æ— æ•ˆã€‚ </p><br><p> åªæ˜¯ä¸€ä¸ªé‚®å¯„åœ°å€åˆ—è¡¨å‘¢ï¼Ÿ </p><br><p><img src="https://habrastorage.org/webt/au/d2/jq/aud2jqe2malfgrjg2txzsncdom4.png"></p><br><p> å¥½çš„ï¼Œè®©æˆ‘ä»¬å°è¯•å°†é‚®å¯„åœ°å€æ’å…¥å·²ç»å…·æœ‰é‚®å¯„åœ°å€çš„åˆ—è¡¨ä¸­ï¼š </p><br><p><img src="https://habrastorage.org/webt/xl/cx/ri/xlcxrimioc_dutfysgtdmr2srmc.png"></p><br><p> è®©æˆ‘ä»¬å°è¯•æ’å…¥ç”µå­é‚®ä»¶ï¼š </p><br><p><img src="https://habrastorage.org/webt/sn/1n/zw/sn1nzwqz5erm1vjnq59dkel3zzi.png"></p><br><p> æœ€åï¼Œä¸€åˆ‡éƒ½æŒ‰é¢„æœŸè¿›è¡Œã€‚ </p><br><p>  ew æˆ‘ä»¥ä¸ºä¼šæ˜¯ä¸‰è¡Œï¼Œä½†ç»“æœæ›´é•¿äº†ä¸€ç‚¹ã€‚ å› æ­¤ï¼Œè¦æ¢ç´¢åœ¨Haskellä¸­å¯ä»¥èµ°å¤šè¿œï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ã€‚ åœ¨æ­¤æœŸé—´ï¼Œ </p><br><h4> æ€è€ƒ </h4><br><p> æœ€ç»ˆï¼Œä¸æˆ‘ä»¬ä¸€å¼€å§‹å°±æåˆ°çš„æ–‡ç« ç›¸æ¯”ï¼Œè¿™ç§å†³å®šçš„åˆ©æ¶¦æ˜¯ä»€ä¹ˆï¼Ÿ </p><br><ol><li> åŒæ ·ï¼Œå®ƒå…·æœ‰æ›´å¤§çš„å¯ä¼¸ç¼©æ€§ã€‚ å¤æ‚çš„éªŒè¯åŠŸèƒ½æ›´æ˜“äºç¼–å†™ã€‚ </li><li> å®ƒæ›´å­¤ç«‹ã€‚ å®¢æˆ·ä»£ç ä¸å¿…çŸ¥é“éªŒè¯åŠŸèƒ½çš„å†…å®¹ï¼Œè€ŒåŸå§‹æ–‡ç« ä¸­çš„<code>ContactInfo</code>è¡¨å•åˆ™è¦æ±‚å°†å…¶ç»‘å®šã€‚ </li><li> éªŒè¯é€»è¾‘æ˜¯ä»¥æ™®é€šçš„å’Œç†Ÿæ‚‰çš„å‡½æ•°çš„å½¢å¼ç¼–å†™çš„ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ä»”ç»†é˜…è¯»ç«‹å³è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶é€šè¿‡ç¼–è¯‘æ—¶æµ‹è¯•å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œè€Œä¸ç”¨ä»è¡¨ç¤ºå·²éªŒè¯ç»“æœçš„æ•°æ®ç±»å‹ä¸­å¾—å‡ºéªŒè¯çš„å«ä¹‰ã€‚ </li><li> å¯ä»¥æ›´å‡†ç¡®åœ°æŒ‡å®šä¸æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ•°æ®ç±»å‹ä¸€èµ·ä½¿ç”¨çš„åŠŸèƒ½çš„è¡Œä¸ºï¼Œå°¤å…¶æ˜¯åœ¨æ— æ³•é€šè¿‡æµ‹è¯•çš„æƒ…å†µä¸‹ã€‚ ä¾‹å¦‚ï¼Œå†™å…¥çš„ç»“æœæ˜¯æ ¹æœ¬ä¸å¯èƒ½<em>æ­£ç¡®</em>å†™å…¥çš„ã€‚ åŒæ ·ï¼Œå¯ä»¥ç¼–å†™<code>insertOrReplace</code> ï¼Œ <code>insertOrIgnore</code>ä¹‹ç±»çš„ä¸œè¥¿ï¼Œå…¶è¡Œä¸ºåœ¨ç±»å‹ä¸­å®Œå…¨æŒ‡å®šã€‚ </li></ol><br><p> ä¸åƒè¿™æ ·çš„OOPè§£å†³æ–¹æ¡ˆç›¸æ¯”ï¼Œåˆ©æ¶¦æ˜¯å¤šå°‘ï¼Ÿ </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ValidatedAddrListClass</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">public</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">ValidatedAddrListClass</span></span>(std::vector&lt;Addr&gt; addrs) { if (!<span class="hljs-built_in"><span class="hljs-built_in">valid</span></span>(addrs)) throw ValidationError {}; } };</code> </pre> <br><ol><li> è¯¥ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå®‰å…¨ã€‚ åœ¨ä¸Šè¿°æƒ…å†µä¸‹ï¼Œæ£€æŸ¥æ˜¯ä¸€æ¬¡æ£€æŸ¥çš„<em>æ“ä½œ</em> ï¼Œåæ¥ä»–ä»¬å¿˜è®°äº†ã€‚ ä¸€åˆ‡éƒ½åŸºäºè¯šå®å’Œç†è§£ï¼Œå³å¦‚æœæ‚¨å…·æœ‰<code>ValidatedAddrListClass</code> ï¼Œåˆ™å…¶å®ç°æ›¾ç»åœ¨æ­¤å¤„è¿›è¡Œè¿‡æ£€æŸ¥ã€‚ è¯¥ç±»æ£€æŸ¥çš„äº‹å®ä¸èƒ½ä½œä¸ºç‰¹å®šå€¼æ¥æŒ‘é€‰ã€‚ å¯¹äºæŸç§ç±»å‹çš„å€¼ï¼Œå¯ä»¥åœ¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¹‹é—´ä¼ é€’è¯¥å€¼ï¼Œç”¨äºæ„å»ºæ›´å¤æ‚çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œå†æ¬¡æ‹’ç»æ­¤æ£€æŸ¥ï¼‰ï¼Œè¿›è¡Œè°ƒæŸ¥ï¼ˆè¯·å‚é˜…ä¸‹ä¸€æ®µï¼‰ï¼Œå¹¶ä¸”é€šå¸¸ä¸æˆ‘ä»¬ä»¥å‰åšçš„ä¸€æ ·ä¸ä»·å€¼è§‚ã€‚ </li><li> æ­¤ç±»æ£€æŸ¥å¯ç”¨äºï¼ˆç›¸å…³çš„ï¼‰æ¨¡å¼åŒ¹é…ã€‚ çš„ç¡®ï¼Œåœ¨æ­¤å‡½æ•°<code>valid</code>çš„æƒ…å†µä¸‹ä»¥åŠåœ¨idrisçš„æƒ…å†µä¸‹éƒ½ä¸æ˜¯ï¼Œè¿™å¾ˆéº»çƒ¦ï¼Œidrisåˆ™å¾ˆæ²‰é—·ï¼Œå› æ­¤å¯ä»¥ä»<code>valid</code>ç»“æ„ä¸­æå–å¯¹æ¨¡å¼æœ‰ç”¨çš„ä¿¡æ¯ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œ <code>valid</code>å¯ä»¥ç”¨ç¨å¾®å‹å¥½çš„æ¨¡å¼åŒ¹é…æ ·å¼è¿›è¡Œé‡å†™ï¼Œä½†è¿™è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œå¹¶ä¸”é€šå¸¸æœ¬èº«å¹¶ä¸çç¢ã€‚ </li></ol><br><p> ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ </p><br><p> æˆ‘åªçœ‹åˆ°ä¸€ä¸ªä¸¥é‡çš„åŸºæœ¬ç¼ºé™·ï¼š <code>valid</code>å¤ªæ„šè ¢äº†ã€‚ å®ƒä»…è¿”å›ä¸€ç‚¹ä¿¡æ¯-æ•°æ®æ˜¯å¦é€šè¿‡éªŒè¯ã€‚ å¯¹äºæ›´æ™ºèƒ½çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€äº›æ›´æœ‰è¶£çš„äº‹æƒ…ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œæƒ³è±¡ä¸€ä¸‹åœ°å€å”¯ä¸€æ€§çš„è¦æ±‚å·²ç»ä»ä¼ ç»ŸçŸ¥è¯†ä¸­æ¶ˆå¤±äº†ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¾ˆæ˜æ˜¾åœ¨ç°æœ‰åœ°å€åˆ—è¡¨ä¸­æ·»åŠ æ–°åœ°å€ä¸ä¼šä½¿åˆ—è¡¨æ— æ•ˆï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™ç±»å‹ä¸º<code>So (valid $ types lst) -&gt; So (valid $ types $ addr :: lst)</code>ç±»å‹çš„å‡½æ•°æ¥<em>è¯æ˜è¯¥å®šç†</em> ã€‚ <code>So (valid $ types lst) -&gt; So (valid $ types $ addr :: lst)</code> ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥ç¼–å†™å§‹ç»ˆæˆåŠŸçš„ç±»å‹å®‰å…¨ </p><br><pre> <code class="hljs coffeescript">insert : <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(addr : Addr)</span></span></span><span class="hljs-function"> -&gt;</span></span> ValidatedAddrList lst -&gt; ValidatedAddrList (addr :: lst)</code> </pre> <br><p> ä½†æ˜¯ï¼Œå¯æƒœï¼Œå®šç†å¦‚é€’å½’å’Œå½’çº³æ³•ï¼Œè€Œä¸”æˆ‘ä»¬çš„é—®é¢˜æ²¡æœ‰ä»»ä½•ä¼˜é›…çš„å½’çº³ç»“æ„ï¼Œå› æ­¤ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œå…·æœ‰Oakå¸ƒå°”<code>valid</code>çš„ä»£ç ä¹Ÿä¸é”™ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN428051/">https://habr.com/ru/post/zh-CN428051/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN428039/index.html">æ”¿åºœä¸æ‰“ç®—æå€¡ç½‘ç»œä¸­ç«‹</a></li>
<li><a href="../zh-CN428041/index.html">ä¸Šå‘¨ç¬¬336æœŸæ¥è‡ªå‰ç«¯ä¸–ç•Œçš„æ–°é²œææ–™æ‘˜è¦ï¼ˆ2018å¹´10æœˆ22æ—¥è‡³28æ—¥ï¼‰</a></li>
<li><a href="../zh-CN428043/index.html">ç­‰å¾…ç¬¬å…­ï¼ŒWinamp 5.8ï¼šèµ·æºçš„â€œç§˜å¯†â€ï¼Œæ­£å¼ç‰ˆæœ¬çš„å¯èƒ½æ€§</a></li>
<li><a href="../zh-CN428045/index.html">PHPæ–‡æ‘˜ç¬¬142å·ï¼ˆ2018å¹´10æœˆ15æ—¥è‡³29æ—¥ï¼‰</a></li>
<li><a href="../zh-CN428047/index.html">WSGIæœåŠ¡å™¨çš„æ€§èƒ½åˆ†æï¼šå°†uWSGIé‡æ–°æ”¾å›åŸä½</a></li>
<li><a href="../zh-CN428053/index.html">å¦‚ä½•åˆ¶å®šæµ‹è¯•ç­–ç•¥ï¼šçœŸæ­£çš„å·¥ç¨‹å¸ˆç‰ˆæœ¬</a></li>
<li><a href="../zh-CN428055/index.html">å›é¡¾ç§‘æŠ€åˆ›ä¸šå…¬å¸ã€‚ Z3-ç¬¬ä¸€å°ä¸­ç»§è®¡ç®—æœº</a></li>
<li><a href="../zh-CN428057/index.html">åœ¨Yandexä¸­è®°å½•APIå’ŒSDKçš„æ–°å¤–è§‚ã€‚ Hyperbatonè®²åº§</a></li>
<li><a href="../zh-CN428059/index.html">å°†å¤šè·¯å¾„LUNå­˜å‚¨è¿æ¥åˆ°VMware ESXiå’ŒDebian GNU / Linux</a></li>
<li><a href="../zh-CN428061/index.html">é€šè¿‡æŒ£å€¼ç®¡ç†æ¥ç®¡ç†é¡¹ç›®æˆæœ¬</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>