<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì™ ü§õüèº üé© Aplicaci√≥n de barra de men√∫ para macOS üë®üèª‚Äçüî¨ üìû üêú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Las aplicaciones ubicadas en la barra de men√∫ han sido conocidas por los usuarios de macOS. Algunas de estas aplicaciones tienen una parte "normal", o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aplicaci√≥n de barra de men√∫ para macOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447754/"> Las aplicaciones ubicadas en la barra de men√∫ han sido conocidas por los usuarios de macOS.  Algunas de estas aplicaciones tienen una parte "normal", otras se encuentran solo en la barra de men√∫. <br>  En esta gu√≠a, escribir√° una aplicaci√≥n que muestra varias citas de personas famosas en una ventana emergente.  En el proceso de creaci√≥n de esta aplicaci√≥n, aprender√°: <br><br><ul><li>  asignar icono de la aplicaci√≥n en la barra de men√∫ </li><li>  hacer que la aplicaci√≥n est√© alojada solo en la barra de men√∫ </li><li>  agregar men√∫ personalizado </li><li>  muestra una ventana emergente a solicitud del usuario y la oculta cuando es necesario, utilizando <b>Event Monitoring</b> </li></ul><br><blockquote>  <b>Nota:</b> esta gu√≠a asume que est√° familiarizado con Swift y macOS. </blockquote><a name="habracut"></a><br><h2>  Empezando </h2><br>  Lanzamiento de Xcode.  A continuaci√≥n, en el men√∫ <b>Archivo / Nuevo / Proyecto ...</b> , seleccione la plantilla <b>macOS / Aplicaci√≥n / Aplicaci√≥n de Cocoa</b> y haga clic en <b>Siguiente</b> . <br><br>  En la siguiente pantalla, ingrese Cotizaciones como el <b>Nombre</b> del <b>producto</b> , seleccione su <b>Nombre de</b> <b>organizaci√≥n</b> e <b>Identificador de organizaci√≥n</b> .  Luego, aseg√∫rese de que Swift est√© seleccionado como el idioma de la aplicaci√≥n y que la casilla de verificaci√≥n <b>Usar guiones</b> gr√°ficos est√© marcada.  Desmarque las <b>casillas de verificaci√≥n</b> <b>Crear aplicaci√≥n basada en documentos</b> , <b>Usar datos b√°sicos</b> , <b>Incluir pruebas unitarias</b> e <b>Incluir pruebas de IU</b> . <br><br><img src="https://habrastorage.org/webt/4c/_f/g6/4c_fg6hmxqq0k_vqkm8-zqrt_ok.png"><br><br>  Finalmente, haga clic en <b>Siguiente</b> nuevamente, especifique la ubicaci√≥n para guardar el proyecto y haga clic en <b>Crear</b> . <br>  Una vez que se crea el nuevo proyecto, abra <b>AppDelegate.swift</b> y agregue la siguiente propiedad a la clase: <br><br><pre><code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> statusItem = <span class="hljs-type"><span class="hljs-type">NSStatusBar</span></span>.system.statusItem(withLength:<span class="hljs-type"><span class="hljs-type">NSStatusItem</span></span>.squareLength)</code> </pre> <br>  Aqu√≠ creamos en la barra de men√∫ Elemento de estado (icono de la aplicaci√≥n) una longitud fija que ser√° visible para los usuarios. <br><br>  Luego, debemos asignar nuestra imagen a este nuevo elemento en la barra de men√∫ para que podamos distinguir nuestra nueva aplicaci√≥n. <br><br>  En el navegador de proyectos, vaya a Assets.xcassets, <a href="">cargue una imagen</a> y arr√°strela al cat√°logo de activos. <br><br>  Seleccione una imagen y abra el inspector de atributos.  Cambie la opci√≥n <b>Renderizar como</b> a <b>Imagen de plantilla</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/wv/es/-o/wves-ouas8duyvk97fki1swuedk.png"></a> <br><br>  Si usa su propia imagen, aseg√∫rese de que la imagen sea en blanco y negro y config√∫rela como una <b>imagen de plantilla</b> para que el icono se vea bien tanto en la barra de men√∫ oscura como en la clara. <br><br>  Regrese a <b>AppDelegate.swift</b> y agregue el siguiente c√≥digo a <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { button.image = <span class="hljs-type"><span class="hljs-type">NSImage</span></span>(named:<span class="hljs-type"><span class="hljs-type">NSImage</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>(<span class="hljs-string"><span class="hljs-string">"StatusBarButtonImage"</span></span>)) button.action = #selector(printQuote(<span class="hljs-number"><span class="hljs-number">_</span></span>:)) }</code> </pre> <br>  Aqu√≠ asignamos el icono de la aplicaci√≥n que acabamos de agregar al icono de la aplicaci√≥n y asignamos <b>acci√≥n</b> cuando hacemos clic en √©l. <br><br>  Agregue el siguiente m√©todo a la clase: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printQuote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quoteText = <span class="hljs-string"><span class="hljs-string">"Never put off until tomorrow what you can do the day after tomorrow."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quoteAuthor = <span class="hljs-string"><span class="hljs-string">"Mark Twain"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(quoteText) ‚Äî \(quoteAuthor)"</span></span>) }</code> </pre> <br>  Este m√©todo simplemente imprime la cita en la consola. <br><br>  Presta atenci√≥n a la <b>directiva del</b> m√©todo <b>objc</b> .  Esto le permite utilizar este m√©todo como respuesta a un clic de bot√≥n. <br><br>  Compile y ejecute la aplicaci√≥n, y ver√° la nueva aplicaci√≥n en la barra de men√∫.  ¬°Hurra! <br>  Cada vez que hace clic en el icono en la barra de men√∫, el famoso dicho de Mark Twain se muestra en la consola Xcode. <br><br><h2>  Ocultamos la ventana principal y el √≠cono en el dock </h2><br>  Hay un par de peque√±as cosas que debemos hacer antes de tratar directamente con la funcionalidad: <br><br><ul><li>  eliminar icono del muelle </li><li>  eliminar la ventana principal de la aplicaci√≥n innecesaria </li></ul><br>  Para eliminar el icono del dock, abra <b>Info.plist</b> .  Agregue una nueva clave <b>Aplicaci√≥n es agente (UIElement)</b> y establezca su valor en <b>S√ç</b> . <br><br><img src="https://habrastorage.org/webt/-c/g_/pn/-cg_pnrysiiynfs2xfab8fyblhk.png"><br><br>  Ahora es el momento de lidiar con la ventana principal de la aplicaci√≥n. <br><br><ul><li>  abrir <b>Main.storyboard</b> </li><li>  seleccione la <b>escena del controlador de ventana</b> y elim√≠nela </li><li>  <b>Ver la escena del controlador</b> , la usaremos pronto </li></ul><br><br> <a href=""><img src="https://habrastorage.org/webt/td/1q/vr/td1qvrwqe8qpgp2xvadbifvu_4o.png"></a> <br><br>  Compila y ejecuta la aplicaci√≥n.  Ahora la aplicaci√≥n no tiene tanto la ventana principal como el icono innecesario en el dock.  Genial <br><br><h2>  Agregar men√∫ al elemento de estado </h2><br>  Una respuesta de un solo clic claramente no es suficiente para una aplicaci√≥n seria.  La forma m√°s f√°cil de agregar funcionalidad es agregar un men√∫.  Agregue esta funci√≥n al final de <b>AppDelegate</b> . <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constructMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> menu = <span class="hljs-type"><span class="hljs-type">NSMenu</span></span>() menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Print Quote"</span></span>, action: #selector(<span class="hljs-type"><span class="hljs-type">AppDelegate</span></span>.printQuote(<span class="hljs-number"><span class="hljs-number">_</span></span>:)), keyEquivalent: <span class="hljs-string"><span class="hljs-string">"P"</span></span>)) menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>.separator()) menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Quit Quotes"</span></span>, action: #selector(<span class="hljs-type"><span class="hljs-type">NSApplication</span></span>.terminate(<span class="hljs-number"><span class="hljs-number">_</span></span>:)), keyEquivalent: <span class="hljs-string"><span class="hljs-string">"q"</span></span>)) statusItem.menu = menu }</code> </pre> <br>  Y luego agregue esta llamada al final de <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs">constructMenu()</code> </pre> <br>  Creamos <b>NSMenu</b> , le agregamos 3 instancias de <b>NSMenuItem</b> y configuramos este men√∫ como el men√∫ del icono de la aplicaci√≥n. <br><br>  Algunos puntos importantes: <br><br><ul><li>  <b>El t√≠tulo</b> del elemento del men√∫ es el texto que aparece en el men√∫.  Un buen lugar para localizar la aplicaci√≥n (si es necesario). </li><li>  <b>La acci√≥n</b> , como la <b>acci√≥n de un</b> bot√≥n u otro control, es un m√©todo que se llama cuando el usuario hace clic en un elemento del men√∫ </li><li>  <b>keyEquivalent</b> es un m√©todo abreviado de teclado que puede usar para seleccionar un elemento del men√∫.  Los caracteres en min√∫scula usan <b>Cmd</b> como modificador, y los caracteres en min√∫scula usan <b>Cmd + Shift</b> .  Esto solo funciona si la aplicaci√≥n est√° en la parte superior y est√° activa.  En nuestro caso, es necesario que el men√∫ o alguna otra ventana est√© visible, ya que nuestra aplicaci√≥n no tiene un √≠cono en el dock </li><li>  <b>separatorItem</b> es un elemento de men√∫ inactivo en forma de una l√≠nea gris entre otros elementos.  √öselo para agrupar </li><li>  <b>printQuote</b> es el m√©todo que ya defini√≥ en <b>AppDelegate</b> , y <b>terminar</b> es el m√©todo definido por <b>NSApplication</b> . </li></ul><br>  Inicie la aplicaci√≥n y ver√° un men√∫ haciendo clic en el icono de la aplicaci√≥n. <br><br><img src="https://habrastorage.org/webt/-w/2v/lv/-w2vlv2nfi_vxgosiihbqd19m5g.png"><br><br>  Intente hacer clic en el men√∫: al seleccionar <b>Imprimir cotizaci√≥n, se</b> muestra la cotizaci√≥n en la consola de Xcode y se cierra la aplicaci√≥n. <br><br><h2>  Agregar una ventana emergente </h2><br>  Viste lo f√°cil que es agregar un men√∫ desde el c√≥digo, pero mostrar una cita en la consola Xcode claramente no es lo que los usuarios esperan de la aplicaci√≥n.  Ahora agregaremos un controlador de vista simple para mostrar las cotizaciones de la manera correcta. <br><br>  Vaya al men√∫ <b>Archivo / Nuevo / Archivo ...</b> , seleccione la plantilla <b>macOS / Source / Cocoa Class</b> y haga clic en <b>Siguiente</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/m5/vd/7w/m5vd7wewsgjt16zajhbas3ca9mi.png"></a> <br><br><ul><li>  nombrar la clase <b>QuotesViewController</b> </li><li>  hacer un heredero de <b>NSViewController</b> </li><li>  aseg√∫rese de que la casilla de verificaci√≥n <b>Crear tambi√©n archivo XIB para la interfaz de usuario</b> no <b>est√©</b> marcada </li><li>  establecer el idioma en Swift </li></ul><br>  Finalmente, haga clic en <b>Siguiente</b> nuevamente, seleccione una ubicaci√≥n para guardar el archivo y haga clic en <b>Crear</b> . <br>  Ahora abra <b>Main.storyboard</b> .  Expanda <b>Ver escena del controlador</b> y seleccione <b>Ver instancia del controlador</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/c4/dd/em/c4ddemmj9moxiu_whrzl7ilme_4.png"></a> <br><br>  Primero seleccione el <b>Inspector de identidad</b> y cambie la clase a <b>QuotesViewController</b> , luego establezca el <b>ID</b> del <b>gui√≥n gr√°fico</b> en <b>QuotesViewController</b> <br><br>  Ahora agregue el siguiente c√≥digo al final del archivo <b>QuotesViewController.swift</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuotesViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MARK: Storyboard instantiation static func freshController() -&gt; QuotesViewController { //1. let storyboard = NSStoryboard(name: NSStoryboard.Name("Main"), bundle: nil) //2. let identifier = NSStoryboard.SceneIdentifier("QuotesViewController") //3. guard let viewcontroller = storyboard.instantiateController(withIdentifier: identifier) as? QuotesViewController else { fatalError("Why cant i find QuotesViewController? - Check Main.storyboard") } return viewcontroller } }</span></span></code> </pre> <br>  ¬øQu√© est√° pasando aqu√≠? <br><br><ol><li>  obtenemos un enlace a <b>Main.storyboard</b> . </li><li>  cree un <b>identificador de escena</b> que coincida con el que acabamos de instalar justo arriba. </li><li>  cree una instancia de <b>QuotesViewController</b> y devu√©lvala. </li></ol><br>  Usted crea este m√©todo, por lo que ahora todos los que usan <b>QuotesViewController</b> no necesitan saber c√≥mo se crea.  Simplemente funciona <br><br>  Tenga en cuenta el <b>error fatal</b> dentro de la declaraci√≥n de <b>guardia</b> .  Puede ser bueno usarlo o <b>afirmar Falla</b> para que si algo en el desarrollo sale mal, usted y los otros miembros del equipo de desarrollo est√©n informados. <br><br>  Ahora de vuelta a <b>AppDelegate.swift</b> .  Agregar una nueva propiedad. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> popover = <span class="hljs-type"><span class="hljs-type">NSPopover</span></span>()</code> </pre> <br>  Luego reemplace un <b>pplicationDidFinishLaunching (_ :) con el</b> siguiente c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationDidFinishLaunching</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aNotification: Notification)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { button.image = <span class="hljs-type"><span class="hljs-type">NSImage</span></span>(named:<span class="hljs-type"><span class="hljs-type">NSImage</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>(<span class="hljs-string"><span class="hljs-string">"StatusBarButtonImage"</span></span>)) button.action = #selector(togglePopover(<span class="hljs-number"><span class="hljs-number">_</span></span>:)) } popover.contentViewController = <span class="hljs-type"><span class="hljs-type">QuotesViewController</span></span>.freshController() }</code> </pre><br>  Ha cambiado la acci√≥n de hacer clic para llamar al <b>m√©todo togglePopover (_ :)</b> , que escribiremos un poco m√°s tarde.  Adem√°s, en lugar de configurar y agregar un men√∫, configuramos una ventana emergente que mostrar√° algo de <b>QuotesViewController</b> . <br><br>  Agregue los siguientes tres m√©todos a <b>AppDelegate</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">togglePopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> popover.isShown { closePopover(sender: sender) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { showPopover(sender: sender) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showPopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { popover.show(relativeTo: button.bounds, of: button, preferredEdge: <span class="hljs-type"><span class="hljs-type">NSRectEdge</span></span>.minY) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closePopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { popover.performClose(sender) }</code> </pre> <br>  <b>showPopover ()</b> muestra una ventana emergente.  Simplemente indica de d√≥nde viene, macOS lo posiciona y dibuja una flecha, como si apareciera en la barra de men√∫. <br><br>  <b>closePopover ()</b> simplemente cierra la ventana emergente, y <b>togglePopover ()</b> es un m√©todo que muestra u oculta la ventana emergente, dependiendo de su estado. <br><br>  Inicie la aplicaci√≥n y haga clic en su icono. <br><br><img src="https://habrastorage.org/webt/j6/gu/oq/j6guoqowcbou3xwtqr2cdunm4ns.png"><br><br>  Todo est√° bien, pero ¬ød√≥nde est√° el contenido? <br><br><h2>  Implementamos Quote View Controller </h2><br>  Primero necesita un modelo para almacenar citas y atributos.  Vaya al men√∫ <b>Archivo / Nuevo / Archivo ...</b> y seleccione la <b>plantilla macOS / Fuente / Archivo Swift</b> , luego <b>Siguiente</b> .  Asigne un nombre al archivo <b>Cita</b> y haga clic en <b>Crear</b> . <br><br>  Abra el archivo <b>Quote.swift</b> y agregue el siguiente c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quote</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> author: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> all: [<span class="hljs-type"><span class="hljs-type">Quote</span></span>] = [ <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Never put off until tomorrow what you can do the day after tomorrow."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Mark Twain"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Efficiency is doing better what is already being done."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Peter Drucker"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"To infinity and beyond!"</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Buzz Lightyear"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"May the Force be with you."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Han Solo"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Simplicity is the ultimate sophistication"</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Leonardo da Vinci"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"It's not just what it looks like and feels like. Design is how it works."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Steve Jobs"</span></span>) ] } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quote</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomStringConvertible</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"\"\(text)\" ‚Äî \(author)"</span></span> } }</code> </pre> <br>  Aqu√≠ definimos una estructura de cotizaci√≥n simple y una propiedad est√°tica que devuelve todas las cotizaciones.  Dado que hicimos que <b>Quote</b> cumpliera con el protocolo <b>CustomStringConvertible</b> , podemos obtener f√°cilmente un texto con formato conveniente. <br><br>  Hay progreso, pero a√∫n necesitamos controles para mostrar todo esto. <br><br><h2>  Agregar elementos de interfaz </h2><br>  Abra Main.storyboard y extraiga 3 botones ( <b>Push Button</b> ) y etiquete ( <b>Multiline Label)</b> en el controlador de vista. <br><br>  Coloque los botones y la etiqueta para que se vean as√≠: <br><br><img src="https://habrastorage.org/webt/1v/ry/2_/1vry2_ydfrxoqiqdsklo2uouwne.png"><br><br>  Adjunte el bot√≥n izquierdo al borde izquierdo con un espacio de 20 y centre verticalmente. <br>  Adjunte el bot√≥n derecho al borde derecho con un espacio de 20 y centre verticalmente. <br>  Coloque el bot√≥n inferior en el borde inferior con un espacio de 20 y c√©ntrelo horizontalmente. <br>  Adjunte los bordes izquierdo y derecho de la marca a los botones con un espacio de 20, centrado verticalmente. <br><br> <a href=""><img src="https://habrastorage.org/webt/jl/zi/tl/jlzitledfqmcexzv636ya6ir6sq.png"></a> <br><br>  Ver√° varios errores de dise√±o, ya que no hay suficiente informaci√≥n para que el <b>dise√±o autom√°tico</b> pueda resolverlo. <br><br>  Establezca la <b>Prioridad de abrazo de contenido horizontal</b> en 249 para permitir que la etiqueta cambie de tama√±o. <br><br> <a href=""><img src="https://habrastorage.org/webt/a6/qp/s0/a6qps0r2_vobhsjkbcfiqohklgc.png"></a> <br><br>  Ahora haga lo siguiente: <br><br><ul><li>  establece la <b>imagen del</b> bot√≥n izquierdo en <b>NSGoLeftTemplate</b> y borra el <b>t√≠tulo</b> </li><li>  establezca la <b>imagen del</b> bot√≥n derecho en <b>NSGoRightTemplate</b> y borre el <b>t√≠tulo</b> </li><li>  configure el <b>t√≠tulo del</b> bot√≥n de abajo para <b>Salir de las cotizaciones</b> . </li><li>  establece la <b>alineaci√≥n del texto de</b> la etiqueta al centro. </li><li>  verifique que el <b>Salto de l√≠nea</b> en la etiqueta est√© configurado en <b>Ajuste de l√≠nea</b> . </li></ul><br><br>  Ahora abra <b>QuotesViewController.swift</b> y agregue el siguiente c√≥digo a la implementaci√≥n de la clase <b>QuotesViewController</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textLabel: <span class="hljs-type"><span class="hljs-type">NSTextField!</span></span></code> </pre> <br><br>  Agregue esta extensi√≥n a la implementaci√≥n de la clase.  Ahora en <b>QuotesViewController.swift hay</b> dos extensiones de clase. <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// MARK: Actions extension QuotesViewController { @IBAction func previous(_ sender: NSButton) { } @IBAction func next(_ sender: NSButton) { } @IBAction func quit(_ sender: NSButton) { } }</span></span></code> </pre> <br>  Acabamos de agregar una <b>salida</b> para la etiqueta que usaremos para mostrar las comillas, y 3 m√©todos de c√≥digo auxiliar que conectaremos con los botones. <br><br><h2>  Conectando el c√≥digo con Interface Builder </h2><br>  Nota: Xcode ha colocado c√≠rculos a la izquierda de su c√≥digo, junto a las palabras clave <b>IBAction</b> e <b>IBOutlet</b> . <br><br><img src="https://habrastorage.org/webt/kv/48/k_/kv48k_pvgucw0v1jexqsna44dda.png"><br><br>  Los usaremos para conectar el c√≥digo a la interfaz de usuario. <br><br>  Mientras mantiene presionada la tecla <b>alt</b> , haga clic en <b>Main.storyboard</b> en el <b>navegador de proyectos</b> .  Por lo tanto, el <b>gui√≥n gr√°fico se</b> abre en el <b>Editor Asistente</b> a la derecha y el c√≥digo a la izquierda. <br><br>  Arrastre el c√≠rculo a la izquierda de <b>textLabel</b> a la etiqueta en el <b>generador de interfaces</b> .  Del mismo modo, combine los m√©todos <b>anterior</b> , <b>siguiente</b> y de <b>salida</b> con los botones izquierdo, derecho e inferior, respectivamente. <br><br> <a href=""><img src="https://habrastorage.org/webt/7-/qu/yb/7-quybzu1bexw545popvn_mbeea.png"></a> <br><br>  Inicia tu aplicaci√≥n. <br><br><img src="https://habrastorage.org/webt/tr/b2/6w/trb26wseu6kdpeyqyjdbeojwoxu.png"><br><br>  Utilizamos el tama√±o emergente predeterminado.  Si desea una ventana emergente m√°s grande o m√°s peque√±a, simplemente cambie su tama√±o en el <b>gui√≥n gr√°fico</b> . <br><br><h2>  Escribir un c√≥digo para los botones </h2><br>  Si a√∫n no ha ocultado el <b>Editor Asistente</b> , haga clic en <b>Cmd-Return</b> o V <b>iew&gt; Editor est√°ndar&gt; Mostrar editor est√°ndar</b> <br><br>  Abra <b>QuotesViewController.swift</b> y agregue las siguientes propiedades a la implementaci√≥n de la clase: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quotes = <span class="hljs-type"><span class="hljs-type">Quote</span></span>.all <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentQuoteIndex: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">didSet</span></span> { updateQuote() } }</code> </pre> <br>  La propiedad de <b>citas</b> contiene todas las citas, y <b>currentQuoteIndex</b> es el √≠ndice de la cita que se est√° mostrando actualmente.  <b>CurrentQuoteIndex</b> tambi√©n tiene un <b>observador de propiedades</b> para actualizar el contenido de la etiqueta con una nueva cita cuando cambia el √≠ndice. <br><br>  Ahora agregue los siguientes m√©todos: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() currentQuoteIndex = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateQuote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { textLabel.stringValue = <span class="hljs-type"><span class="hljs-type">String</span></span>(describing: quotes[currentQuoteIndex]) }</code> </pre> <br>  Cuando se carga la vista, establecemos el √≠ndice de cotizaci√≥n en 0, lo que a su vez conduce a una actualizaci√≥n de la interfaz.  <b>updateQuote ()</b> simplemente actualiza la etiqueta de texto para mostrar una cotizaci√≥n.  correspondiente <b>currentQuoteIndex</b> . <br><br>  Finalmente, actualice estos m√©todos con el siguiente c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">previous</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { currentQuoteIndex = (currentQuoteIndex - <span class="hljs-number"><span class="hljs-number">1</span></span> + quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) % quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { currentQuoteIndex = (currentQuoteIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) % quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { <span class="hljs-type"><span class="hljs-type">NSApplication</span></span>.shared.terminate(sender) }</code> </pre> <br>  Los m√©todos <b>next ()</b> y <b>previous ()</b> recorren todas las citas.  <b>Salir</b> cierra la aplicaci√≥n. <br><br>  Inicia la aplicaci√≥n: <br><br><img src="https://habrastorage.org/webt/wi/qh/ju/wiqhjuzkw5c8f7bmtofythu147k.png"><br><br><h2>  Monitoreo de eventos. </h2><br>  Hay una cosa m√°s que los usuarios esperan de nuestra aplicaci√≥n: ocultar la ventana emergente cuando el usuario hace clic fuera de ella.  Para hacer esto, necesitamos un mecanismo llamado <b>monitor de eventos globales macOS</b> . <br><br>  Cree un nuevo archivo Swift, <b>ll√°melo EventMonitor</b> y reemplace su contenido con el siguiente c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Cocoa public class EventMonitor { private var monitor: Any? private let mask: NSEvent.EventTypeMask private let handler: (NSEvent?) -&gt; Void public init(mask: NSEvent.EventTypeMask, handler: @escaping (NSEvent?) -&gt; Void) { self.mask = mask self.handler = handler } deinit { stop() } public func start() { monitor = NSEvent.addGlobalMonitorForEvents(matching: mask, handler: handler) } public func stop() { if monitor != nil { NSEvent.removeMonitor(monitor!) monitor = nil } } }</code> </pre> <br>  Al inicializar una instancia de esta clase, le pasamos una m√°scara de evento que escucharemos (como pulsaciones de teclas, desplazamiento de la rueda del mouse, etc.) y un controlador de eventos. <br>  Cuando estamos listos para comenzar a escuchar, <b>start ()</b> llama a <b>addGlobalMonitorForEventsMatchingMask (_: handler :)</b> , que devuelve el objeto que estamos guardando.  Tan pronto como ocurre el evento contenido en la m√°scara, el sistema llama a su controlador. <br><br>  Para detener la supervisi√≥n de eventos, se llama a <b>removeMonitor</b> <b>()</b> en <b>stop ()</b> y eliminamos el objeto <b>configur√°ndolo</b> en nil. <br><br>  Todo lo que nos queda es llamar a <b>start ()</b> y <b>stop ()</b> en el momento adecuado.  La clase tambi√©n llama a <b>stop ()</b> en el desinfectante para limpiar. <br><br><h2>  Conectando el monitor de eventos </h2><br>  Abra <b>AppDelegate.swift por</b> √∫ltima vez y agregue una nueva propiedad: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventMonitor: <span class="hljs-type"><span class="hljs-type">EventMonitor?</span></span></code> </pre> <br>  Luego agregue este c√≥digo para configurar el <b>monitor de eventos</b> al final de <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs">eventMonitor = <span class="hljs-type"><span class="hljs-type">EventMonitor</span></span>(mask: [.leftMouseDown, .rightMouseDown]) { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> strongSelf = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, strongSelf.popover.isShown { strongSelf.closePopover(sender: event) } }</code> </pre> <br>  Esto informar√° a su aplicaci√≥n cuando haga clic en el bot√≥n izquierdo o derecho.  Tenga en cuenta que no se llamar√° al controlador en respuesta a los clics del mouse dentro de su aplicaci√≥n.  Es por eso que la ventana emergente no se cerrar√° mientras hace clic dentro de ella. <br><br>  Utilizamos una referencia <b>d√©bil</b> a <b>uno mismo</b> para evitar el peligro de un ciclo de fuertes v√≠nculos entre <b>AppDelegate</b> y <b>EventMonitor</b> . <br><br>  Agregue el siguiente c√≥digo al final del m√©todo <b>showPopover (_ :)</b> : <br><br><pre> <code class="swift hljs">eventMonitor?.start()</code> </pre><br>  Aqu√≠ comenzamos a monitorear eventos cuando aparece una ventana emergente. <br><br>  Ahora agregue el c√≥digo al final del m√©todo <b>closePopover (_ :)</b> : <br><br><pre> <code class="swift hljs">eventMonitor?.stop()</code> </pre><br>  Aqu√≠ finalizamos el monitoreo cuando se cierra la ventana emergente. <br><br>  ¬°La aplicaci√≥n est√° lista! <br><br><h2>  Conclusi√≥n </h2><br>  <a href="">Aqu√≠</a> encontrar√° el c√≥digo completo para este proyecto. <br><br>  Ha aprendido a configurar el men√∫ y la ventana emergente en la aplicaci√≥n ubicada en la barra de men√∫.  ¬øPor qu√© no experimentar con varias etiquetas o texto formateado para ver mejor las citas?  ¬øO conecta un backend para recibir cotizaciones de Internet?  ¬øO quieres usar el teclado para navegar entre comillas? <br><br>  Un buen lugar para investigar es la documentaci√≥n oficial: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NSMenu</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NSPopover</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NSStatusItem</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/447754/">https://habr.com/ru/post/447754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447738/index.html">Julian Assange arrestado por la polic√≠a del Reino Unido</a></li>
<li><a href="../447742/index.html">¬øQu√© es la metodolog√≠a DevOps y qui√©n la necesita?</a></li>
<li><a href="../447744/index.html">Climbing Elbrus - Reconocimiento en batalla. Parte t√©cnica 2. Interrupciones, excepciones, temporizador del sistema.</a></li>
<li><a href="../447748/index.html">Sistemas de archivos virtuales de Linux: ¬øpor qu√© son necesarios y c√≥mo funcionan? Parte 2</a></li>
<li><a href="../447752/index.html">C√≥mo overclockeamos CAD COMPASS-3D ‚Üí Parte 3</a></li>
<li><a href="../447756/index.html">Nuevo Cuadrante de Gartner para Soluciones de Monitoreo de Aplicaciones (APM)</a></li>
<li><a href="../447784/index.html">M√∫sica en el d√≠a de la cosmon√°utica</a></li>
<li><a href="../447786/index.html">Antecedentes: Robot Fedor, ¬øqu√© eres?</a></li>
<li><a href="../447788/index.html">Creamos un agregador de noticias centrado en las criptomonedas - intwt.com</a></li>
<li><a href="../447790/index.html">Aprendiendo a escribir contratos inteligentes de Waves en RIDE y RIDE4DAPPS. Parte 1 (billetera multiusuario)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>