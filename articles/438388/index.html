<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游 游녪游낕 游눩游낗 Servidor de mensajes push 游놊游 游닖 游땶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En cualquier servicio moderno de Internet, solo hay dos funciones principales: 



- El primero es la autorizaci칩n del usuario. 
- El segundo es el en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servidor de mensajes push</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438388/">  En cualquier servicio moderno de Internet, solo hay dos funciones principales: <br><br><ul><li>  El primero es la autorizaci칩n del usuario. </li><li>  El segundo es el env칤o instant치neo de un evento desde el servidor al cliente. </li></ul><br>  El primer punto, creo, no necesita una explicaci칩n. <br><br>  El segundo punto es la tecnolog칤a cliente-servidor, pero viceversa.  El cliente no realiza peri칩dicamente una solicitud al servidor. 쮿ay alg칰n mensaje nuevo?  El servidor, cuando ocurre un determinado evento, env칤a el mensaje inmediatamente al cliente. <br><br>  Para una mejor comprensi칩n, el servicio no es un cierto esf칠rico en el vac칤o.  El servicio se puede representar como: <br><br><ul><li>  Una carpeta con archivos en la nube.  La informaci칩n sobre c칩mo cambiar, agregar y eliminar se env칤a a otros usuarios o al usuario actual, pero a otros dispositivos. </li><li>  Un programa de computadora para leer los registros del servidor, cuando aparecen registros de "error", enviando el contenido del registro al usuario en un tel칠fono m칩vil. </li><li>  Mirilla de video (c치mara) tomando fotos cuando se mueve cerca de la puerta del apartamento. </li><li>  Un servicio que recibe telemetr칤a de una aplicaci칩n Android-Auto. </li><li>  Un servicio similar al p치rrafo anterior, que le permite saber si un ni침o ha llegado a la escuela o ha regresado de la escuela. </li></ul><br>  La lista se puede expandir indefinidamente; como ejemplo, solo se dan los casos de uso m치s conocidos. <br><br>  Casi todos los ejemplos de servicios se pueden presentar en forma de "mensajero".  Parte de los ejemplos se describieron exactamente de esta manera; vi art칤culos sobre c칩mo conectar la c치mara y enviar im치genes a un famoso mensajero. <br><br>  No hace mucho tiempo, hab칤a un art칤culo en el que los extra침os observaban el servicio de la c치mara en los ojos de la puerta, en lugar de la inteligencia artificial.  No me enfocar칠 en servicios gratuitos de grandes corporaciones "buenas".  Como dicen en el famoso proverbio "El queso gratis sucede en una trampa para ratones" y guiado por otro proverbio "Tu camisa est치 m치s cerca de tu cuerpo", tu "servicio" es mejor. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El c칩digo de script del servidor es abierto y gratuito</a> <br><br><img src="https://habrastorage.org/webt/wx/2d/a4/wx2da4acw9c3g_x0a_mxj8dukju.png"><br><a name="habracut"></a><br>  Eleg칤 node.js socket.io postgreSQL para la implementaci칩n, implement칠 la primera versi칩n hace m치s de dos a침os, y el servicio estaba estrechamente relacionado con 1c <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://infostart.ru/public/545047/</a> , todav칤a no hab칤an anunciado un servidor de interacci칩n en ninguna parte.  Pero fue hace mucho tiempo, en este momento, la parte del servidor no est치 conectada de ninguna manera con el programa mencionado, la parte del cliente puede integrarse como procesamiento externo o extensi칩n. <br><br>  El nombre elegido es significativo: "push0k".  La primera parte est치 tomada de la frase "mensaje push", el segundo ingl칠s bien conocido en forma abreviada, pero est치 escrito en cero para el m치s significativo. <br><br>  En este caso, esto no es un "queso gratis en una trampa para ratones", ya que requiere una computadora Windows, Linux, MacOS (servidor) para funcionar a trav칠s de Internet, necesita una direcci칩n IP externa, posiblemente reenviada.  Preferiblemente el nombre de dominio asociado con la direcci칩n IP externa.  Adem치s, es deseable, pero no necesario, no un certificado autofirmado asociado con un nombre de dominio. <br><br>  No hay requisitos de hardware como tales, puede funcionar en el hogar nas, donde hay docker.  Docker en nas significa arquitectura x86-64, y postgreSQL no se puede instalar en tales nas sin docker.  Una comprensi칩n precisa de cu치ntos clientes puede soportar dicho servidor depende de las tareas: la l칩gica del servicio y el tr치fico transmitido entre los clientes. <br><br><h4>  Descripci칩n del servidor: </h4><br>  El servidor usa m칩dulos adicionales: <br><br><ul><li>  socket.io: el m칩dulo agrega un protocolo websocket con una tonelada de ext.  oportunidades </li><li>  node-postgres - m칩dulo para la comunicaci칩n con el servidor de base de datos postgreSQL. </li><li>  pm2 es un m칩dulo para iniciar varios procesos del servidor con un equilibrador de carga. </li></ul><br><h4>  Archivos del servidor: </h4><br><ul><li>  starter.js - servicio http (s), puede decir el panel de administraci칩n del servidor.  A trav칠s de este servicio, se cambia la configuraci칩n y se inician los procesos del servidor websocket principal. </li><li>  push0k.js es el servidor websocket principal. </li><li>  starter_cfg.js: configuraci칩n del script administrativo del servidor.  Conexi칩n a postgreSQL y archivos para conexi칩n https.  Los archivos para las conexiones https, as칤 como el nombre de dominio, pueden diferir del servidor principal, para mayor seguridad.  Se cambia manualmente en el primer inicio. </li><li>  config.js: la configuraci칩n b치sica de todo el servidor. </li><li>  package.js: m칩dulos de autor de versi칩n de descripci칩n de archivo necesarios para el trabajo. </li><li>  push0kStructure.sql: descripci칩n del archivo de la base de datos postgreSQL para la inicializaci칩n inicial, una base de datos vac칤a. </li></ul><br><h4>  Instalaci칩n: </h4><br>  1. Inicialmente, debe instalar node.js <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nodejs.org/en/download</a> <br><br>  2. PostgreSQL tambi칠n debe instalarse en la computadora de la red local o en el mismo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">postgrespro.ru/products/download</a> <br><br>  En el servidor postgreSQL, es necesario ejecutar el archivo "push0kStructure.sql" o casi todas las consultas de este archivo para crear una base de datos con las tablas necesarias. <br><br>  3. Descargue los primeros cinco archivos del servidor, excepto push0kStructure.sql, en cualquier directorio de la computadora. <br><br>  4. En cualquier editor de texto, edite el archivo "starter_cfg.js".  Es importante especificar los par치metros para conectarse al servidor postgreSQL y establecer el puerto para conectarse a la parte administrativa del servidor push0k. <br><br>  5. Inicie el terminal (consola) y use el comando "cd / ruta / su / directorio /" para ir al directorio de archivos del servidor.  La ruta especificada en el comando del terminal debe ser desde el punto 3. <br><br>  6. Ejecute el comando en el terminal "npm install" para instalar m칩dulos adicionales. <br>  Ejecute el comando en el terminal "node starter.js" para iniciar el servicio de administraci칩n. <br><br>  7. Descargue e instale el programa de administraci칩n push0k.  En "push0k admin" se configuran los par치metros b치sicos del websocket, el puerto del servidor, el n칰mero de procesos y muchos otros.  Puede controlar el inicio y la detenci칩n de los procesos del servidor, crear y administrar usuarios y sus salas (grupos). <br><br><h4>  Aplicaci칩n de administraci칩n Push0k </h4><br><img src="https://habrastorage.org/webt/fk/fo/go/fkfogovxziochbj901ouycltfjq.png"><br><br>  La aplicaci칩n se realiza en electr칩n usando vue.js.  En el interior, se implementa un tipo de sistema de ventanas, los peque침os cuadros de di치logo modales se pueden arrastrar y soltar como ventanas, los t칤tulos de ventanas para Windows se hacen similares a Windows 10, para Mac OS como en las 칰ltimas versiones, pero hasta ahora sin tener en cuenta el tema oscuro.  Para Linux, compilar칠 m치s tarde, es un poco m치s complicado con los t칤tulos de los di치logos, creo que ser치 como en ubuntu y, si no es ubuntu, ganar칠 10 estilos.  El consumo de memoria en win 10 y Mac OS m치s de 150 megabytes no se vio. <br><br>  En versiones anteriores no era posible agregar animaci칩n, lo hac칤a un poco sin fanatismo.  Los cuadros de di치logo descritos anteriormente: las ventanas aparecen desde el centro de la ventana de la aplicaci칩n, aumentando gradualmente, cuando est치n cerradas, vuelan hacia el centro, disminuyendo.  Adem치s, las pulsaciones de botones y los campos obligatorios est치n animados. <br><br><img src="https://habrastorage.org/webt/rn/ts/vr/rntsvrtjjhvvsnpu6vf_oyguwou.gif"><br><br>  Durante la implementaci칩n, hab칤a un gran deseo de crear un tema oscuro, pero como todav칤a no hab칤a un tema claro, tuve que contentarme solo con el panel de botones de la derecha.  En Mac OS, esta 칰nica parte oscura tiene un efecto de vitalidad, es decir, es parcialmente transparente, similar a la mayor칤a de las ventanas de la interfaz est치ndar.  Desafortunadamente, en Windows, un efecto similar llamado dise침o fluido no se pudo hacer porque no hay una funcionalidad similar en Windows para el electr칩n. <br><br>  Como se mencion칩 anteriormente, el control utiliza los protocolos http y ws (websocket).  Es posible utilizar conexiones seguras https y wss.  Con conexiones seguras, puede ver los datos de los certificados utilizados.  De manera similar a los navegadores, se utiliza el 칤cono "Bloquear": la conexi칩n es segura, "Bloqueo abierto": la conexi칩n no es segura.  Y sin iconos, respectivamente, no se utiliza una conexi칩n segura. <br><br><img src="https://habrastorage.org/webt/xz/mt/ew/xzmtew2kpyuhppeugz2fth2lxvm.png"><br><br><h4>  L칩gica general </h4><br>  Nunca he visto tal aplicaci칩n.  Durante el desarrollo, me gui칠 por el hecho de que yo mismo estar칤a interesado en el monitoreo y qu칠 par치metros ver en las estad칤sticas. <br><br>  Por ejemplo, en la tabla de conexi칩n para cada conexi칩n hay datos "tiempo de conexi칩n", "tiempo de autorizaci칩n", "tiempo de sincronizaci칩n".  El primero le permite comprender qu칠 tan r치pido se establece la conexi칩n "ws: //" o el "wss: //" protegido.  El segundo: despu칠s de la conexi칩n, se env칤a un mensaje con datos de autorizaci칩n por separado, durante la autorizaci칩n, se realiza una solicitud de verificaci칩n del usuario y una comprobaci칩n de hash de contrase침a es 칰nica para cada conexi칩n.  En tercer lugar, es el momento de recibir nuevos mensajes y datos de referencia nuevos o actualizados.  Adem치s, las versiones de node.js, socket.io y otros datos descritos generalmente se guardan, lo que permite comprender c칩mo la actualizaci칩n de node.js o el m칩dulo afectaron por separado la velocidad, o podr칤a haber afectado alg칰n refinamiento del servidor. <br><br><img src="https://habrastorage.org/webt/xs/_h/ak/xs_haktlpy5r-gb_6ktxpf9_osa.png"><br><br>  En el ejemplo anterior, solo se describe una peque침a parte de dichos datos.  Adem치s, en una tabla separada, se guardan el tiempo, el tama침o y la velocidad de MB / s.  Descargar sincronizaci칩n de datos.  La misma tabla almacena los datos de la descarga de archivos adjuntos al servidor y la descarga de estos datos del servidor. <br><br>  El tiempo para calcular la velocidad se calcula en el cliente o servidor, seg칰n la situaci칩n.  Es imposible usar el tiempo tanto del servidor como del cliente ya que no se puede sincronizar perfectamente.  Esto impone un peque침o retraso de tama침o de ping (confirmaci칩n de entrega) entre el cliente y el servidor.  Al cargar o descargar archivos grandes, el retraso descrito no es significativo. <br><br>  En la tabla de conexi칩n, puede ver la conexi칩n cerrada con los datos "byte transmitido", "byte recibido" y "tama침o" de los datos de sincronizaci칩n m치s que el "byte transmitido".  Al sincronizar datos, se utiliza la compresi칩n autom치tica de socket.io, al descargar o descargar archivos adjuntos, la compresi칩n autom치tica se desactiva, ya que a menudo la compresi칩n ya comprimida afecta negativamente la velocidad. <br><br>  Como se escribi칩 al principio del art칤culo, nunca fue un objetivo crear un servicio com칰n y conectar tantos usuarios como sea posible.  Pero siempre fue interesante cu치ntos te칩ricamente puede haber usuarios y qu칠 tipo de carga soportar치 el servidor. <br><br>  Para hacer esto, hice una prueba simple: en l칤nea a los clientes de una determinada sala (grupo), se env칤a un mensaje con los par치metros de prueba (en los par치metros solo hay un par치metro principal: el n칰mero de mensajes), que cada cliente enviar치 a otros clientes en l칤nea.  Despu칠s de la distribuci칩n de prueba, se calcula el tiempo total de todos los mensajes, notificaciones, entradas en las tablas postgresql, se calcula el n칰mero de todos los mensajes, notificaciones y entradas y, en consecuencia, se calcula la velocidad, incluido el total de todas las operaciones en el servidor. <br><br><img src="https://habrastorage.org/webt/mj/ir/eo/mjireosal4qxzjintjlz4rddhao.png"><br><br>  <i>Ejemplo de la captura de pantalla:</i> <i><br><br></i>  <i>A veces es m치s sorprendente, solo 10,000 mensajes y 390,000 gestos,</i> <i><br></i>  <i>enviando 50,000 mensajes: Procesos del servidor: 4 Usuarios: 3</i> <i><br></i>  <i>Total de mensajes recibidos 10,000 * 3 = 30,000</i> <i><br></i>  <i>Reenv칤o a otros procesos del servidor 30,000 * Procesos del servidor: 4 - 1 = 90,000</i> <i><br></i>  <i>Enviado a destinatarios 30,000 * Usuarios: 3 - 1 = 60,000</i> <i><br></i>  <i>Los mensajes se escriben en la tabla postgreSQL 30 000</i> <i><br></i>  <i>90,000 notificaciones de entrega recibidas</i> <i><br></i>  <i>Grabado en la tabla de notificaciones de entrega postgreSQL 90,000</i> <i><br></i>  <i>Todas las operaciones 390,000</i> <br><br><h4>  L칩gica de datos en administrador push0k </h4><br>  Con cada conexi칩n, se obtienen todos los datos de referencia: usuarios, salas, dispositivos, bases de datos, as칤 como las 칰ltimas 300 entradas del "diario estad칤stico": Conexiones, Sincronizaci칩n de datos, Reenv칤o de archivos adjuntos, Mensajes, Diario. <br><br>  Los mensajes pr치cticamente repiten la tabla postgresql y no tienen filtros, configuraciones y un formulario donde pueda ver el mensaje por completo.  La l칩gica de la tabla es la depuraci칩n, es posible ver r치pidamente durante el desarrollo si el mensaje ha llegado a la tabla o no. <br><br><img src="https://habrastorage.org/webt/6y/ra/gj/6yragjyt0ycnvzmiy8cvbspfpsc.png"><br><br>  Las tablas "Usuarios", "Salas (grupos)", "Conexiones" y "Diario" se actualizan autom치ticamente.  Para el resto de los datos, no tiene sentido actualizar en l칤nea. <br><br>  La aplicaci칩n de administraci칩n push0k se puede descargar aqu칤: <br><br>  Windows: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">push0kadmin Setup 19.1.11.exe</a> <br>  Mac OS: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">push0kadmin-19.1.11.dmg</a> <br><br>  Es gratis, pero a diferencia del servidor, todav칤a no planeo abrir el c칩digo fuente. <br><br>  En el pr칩ximo art칤culo describir칠 la parte del cliente del cliente Desctop push0k, as칤 como un peque침o ejemplo, c칩digo y c칩mo conectarse, iniciar sesi칩n y recibir datos del servidor. <br><br>  Para las versiones anteriores mencionadas anteriormente, tambi칠n hab칤a un cliente de Android, que viv칤a inmortalmente en segundo plano en las versiones 7 y 8 de Android.  Pero por ahora, creo que no me retras칠 por mucho tiempo.  M치s tarde, creo que habr치 un tercer art칤culo con un cliente de Android, y all칤 se ve y iOS no est치 lejos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/438388/">https://habr.com/ru/post/438388/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../438376/index.html">Ingenier칤a inversa. La historia La mia</a></li>
<li><a href="../438380/index.html">Hombre, pausa en las excepciones detectadas</a></li>
<li><a href="../438382/index.html">Organizaci칩n de una b칰squeda en una p치gina web en JavaScript (sin jQuery)</a></li>
<li><a href="../438384/index.html">Lecci칩n de qu칤mica: c칩mo exponer el cristal de un microchip para fotograf칤a</a></li>
<li><a href="../438386/index.html">En el camino hacia los principios f칤sicos de la evoluci칩n biol칩gica.</a></li>
<li><a href="../438390/index.html">Por qu칠 los desarrolladores son m치s caros que el dinero, c칩mo ahorrarlos y aumentarlos</a></li>
<li><a href="../438392/index.html">Una breve historia de una "cinta inteligente"</a></li>
<li><a href="../438394/index.html">Yii 2.0.16</a></li>
<li><a href="../438396/index.html">쯇or qu칠 deber칤as pensar en la programaci칩n funcional?</a></li>
<li><a href="../438398/index.html">C칩mo lanc칠 Keras en C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>