<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤱🏽 🤞 🚜 Active Restore: Kann Disaster Recovery schneller sein? Viel schneller 🛐 🤲🏻 🔆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Sichern wichtiger Daten ist gut. Was aber, wenn die Arbeit sofort fortgesetzt werden muss und jede Minute zählt? Wir bei Acronis haben uns entschl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Active Restore: Kann Disaster Recovery schneller sein? Viel schneller</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acronis/blog/477658/">  Das Sichern wichtiger Daten ist gut.  Was aber, wenn die Arbeit sofort fortgesetzt werden muss und jede Minute zählt?  Wir bei Acronis haben uns entschlossen zu prüfen, wie es möglich ist, die Aufgabe, das System so schnell wie möglich zu starten, zu lösen.  Und dies ist der erste Beitrag in der Active Restore-Reihe, in dem ich Ihnen erzähle, wie wir das Projekt mit der Innopolis University begonnen haben, welche Lösung wir gefunden haben und woran wir heute arbeiten.  Details - unter dem Schnitt. <br><br><img src="https://shydyrond.ru/backend/uploads/Kak%20uvelichit%27%20skorost%27%20raboty%20komp%27yutera/kak-uvelichit-skorost-raboty-kompyutera.jpg" alt="Bild"><br><a name="habracut"></a><br>  Hallo!  Mein Name ist Daulet Tumbaev, und heute möchte ich Ihnen meine Erfahrungen bei der Entwicklung eines Systems mitteilen, das die Wiederherstellung nach einem Katastrophenfall beschleunigt.  Um über den gesamten Entwicklungspfad des Projekts zu sprechen, lassen Sie uns von weitem beginnen.  Ich arbeite derzeit bei Acronis, habe aber auch einen Abschluss der Innopolis University, die ich im Master-Programm für Software Development Management (MSIT-SE) erworben habe.  Innopolis ist eine junge Universität, und der Lehrplan ist noch jünger.  Aber dann baut es auf dem Lehrplan der Carnegie Mellon University (Carnegie Mellon University) auf, in dessen Errungenschaften es so etwas wie industrielle Projekte gibt. <br><br>  Ziel des Industrieprojekts ist es, den Studenten in die reale Entwicklung einzutauchen und das in der Praxis erworbene Wissen zu festigen.  Zu diesem Zweck kooperiert die Universität mit Unternehmen wie Yandex, Acronis, MTC und Dutzenden anderen (insgesamt hatte die Universität im Jahr 2018 144 Partner).  Im Rahmen der Kooperation bieten Unternehmen der Universität ihre Arbeitsanweisungen an, und die Studierenden wählen eines der Projekte aus, das ihnen in ihrem Interesse und Ausbildungsstand näher steht.  Noch vor zwei Jahren befand ich mich „auf der anderen Seite der Barrikaden“ und arbeitete als Student an einem anderen Acronis-Projekt.  Diesmal wurde ich technischer Berater für Studenten des Unternehmens und schlug Innopolis das Active Restore-Projekt vor.  Die Idee zu Active Restore wurde vom Kernel-Team von Acronis formuliert, aber die Entwicklung der Lösung begann mit der Innopolis University. <br><br><h3>  Aktive Wiederherstellung - warum wird dies benötigt? </h3> <br>  Traditionell funktioniert die Notfallwiederherstellung nach einem Standardschema.  Nach Problemen mit dem Computer rufen Sie die Weboberfläche eines Backup-Systems auf, z. B. Acronis True Image, und klicken auf die große Schaltfläche „Wiederherstellen“.  Als nächstes müssen Sie N Minuten warten, und erst danach können Sie weiterarbeiten. <br><br><img src="https://habrastorage.org/webt/lr/qz/at/lrqzata7ct47-wrmeeiqxvrnoq8.jpeg"><br><br>  Das Problem besteht darin, dass diese Zahl N, auch als RTO (Recovery Time Objective) bezeichnet, die zulässige Wiederherstellungszeit, sehr beeindruckend sein kann. Dies hängt von der Verbindungsgeschwindigkeit (falls eine Wiederherstellung aus der Cloud erfolgt), dem Festplattenvolumen Ihres Computers und der Verfügbarkeit ab eine Reihe anderer Faktoren.  Kann es reduziert werden?  Ja, das können Sie, denn um die Arbeit wieder aufzunehmen, benötigen Sie nicht immer eine vollständige Computerfestplatte.  Dieselben Fotos und Videos beeinträchtigen nicht die Funktionalität des Geräts und können später im Hintergrund abgerufen werden. <br><br><h3>  Treiber benötigt ... </h3><br>  Das Betriebssystem erwartet den Start mit einer vollständig abgeschlossenen Festplatte.  Daher führt Windows eine Reihe von Überprüfungen auf Datenträgerintegrität durch.  Das System lässt keinen normalen Start zu, wenn einige vom Betriebssystem erwartete Dateien fehlen oder beschädigt sind.  Um dieses Problem zu lösen, wurde beschlossen, die von uns erstellten so genannten Redirector-Dateien auf die Festplatte zu kopieren, die fehlende oder beschädigte Dateien ersetzen, in Wirklichkeit aber Dummies sind.  Das Erstellen solcher Redirectors dauert nicht lange, da sie tatsächlich keinen Inhalt haben. <br><br>  Weitere Wiederherstellung erfolgt wie folgt.  Hintergrundprozess Parallel zum Betrieb des Betriebssystems werden „Dummies“ mit Daten gefüllt.  Der Hintergrundwiederherstellungsprozess berücksichtigt die Belastung der Festplatte und überschreitet das festgelegte Limit nicht.  Der Benutzer oder das Betriebssystem selbst können jedoch plötzlich eine Datei anfordern, die noch nicht vorhanden ist.  Hier kommt der zweite Wiederherstellungsmodus ins Spiel.  Die Priorität der angeforderten Datei wird auf das Maximum erhöht, und der Wiederherstellungsprozess lädt die Datei dringend auf die Festplatte hoch.  Das Betriebssystem empfängt die gewünschte Datei, allerdings mit einer leichten Verzögerung. <br><br>  Es sieht aus wie ein perfektes Bild.  In der realen Welt gibt es jedoch eine Vielzahl von Fallstricken und potenziellen Deadlocks.  Zusammen mit den Innopolis-Studenten beschlossen wir, dieses Wiederherstellungsszenario zu untersuchen, den Gewinn an RTO zu bewerten und zu verstehen, ob dieser Ansatz machbar ist.  Solche Marktentscheidungen gab es damals schlichtweg nicht. <br><br>  Und wenn ich mich entschloss, die Service-Komponente an die Jungs von Innopolis zu übergeben, begann ich in Acronis mit der Arbeit an einem <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ifs/file-system-minifilter-drivers">Mini-Filter-Dateisystemtreiber</a> .  Dies wurde vom Windows-Kernel-Team durchgeführt.  Der Plan war: <br><br><ul><li>  Führen Sie den Treiber in einem frühen Stadium des Startens des Betriebssystems aus. </li><li>  Laden Sie den Dienst während des Betriebs herunter, wenn der <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode">Benutzerbereich</a> vollständig verfügbar ist </li><li>  Der Service bearbeitet Fahreranfragen und koordiniert die weitere Arbeit. </li></ul><br><img src="https://habrastorage.org/webt/2a/vl/qf/2avlqfvl30ekh3xdix5xjwjggdu.jpeg"><br><h3>  Die Feinheiten der Fahrertechnik </h3><br>  Wenn meine Kollegen in einem anderen Beitrag über den Service sprechen, werden wir in diesem Text die Feinheiten der Treiberentwicklung aufzeigen.  Der bereits entwickelte Treiber-Minifilter verfügt über zwei Betriebsmodi - als das System im normalen Modus gestartet wurde und als das System gerade einen Fehler aufwies und seine Wiederherstellung erfolgte.  Vor dem Laden der Benutzerbibliotheken und Anwendungen und damit unseres Dienstes verhält sich der Treiber genauso.  Er weiß nicht, in welchem ​​Zustand sich das System gerade befindet.  Dadurch wird jedes Erstellen, Lesen und Schreiben protokolliert, alle Metadaten werden aufgezeichnet.  Wenn der Dienst online ist, stellt der Fahrer diese Informationen dem Dienst zur Verfügung. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x4/x0/0c/x4x00ccpfivzeboam8r6zdvx4re.png"></div><br>  Im Falle eines normalen Starts sendet der Dienst ein Entspannungssignal an den Fahrer, so dass er sich entspannt und nicht mehr alle Daten gewissenhaft protokolliert.  In diesem Fall wechselt der Treiber zur Protokollierung nur der Änderungen auf der Festplatte und meldet sie an den Dienst, der mit Hilfe anderer Acronis-Tools die Sicherung der Festplatte auf dem vom Benutzer definierten Datenträger auf dem neuesten Stand hält.  Dies kann eine Cloud-, Remote-, schrittweise oder Nachtsicherung sein. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/34/he/x1/34hex17zyywzzuv7rlivamn46e0.png"></div><br>  Wenn der Wiederherstellungsmodus aktiviert ist, informiert der Dienst den Treiber, dass er im Wiederherstellungsmodus arbeiten muss.  Das System wurde gerade nach einem Fehler wiederhergestellt. Sobald der Minifilter eine Anforderung zum Öffnen einer Datei auf der Festplatte ausgibt, sollte er diesen Vorgang abfangen, die Anforderung selbst ausführen und prüfen, ob sich eine solche Datei auf der Festplatte befindet und ob sie geöffnet werden kann. <br><br>  Wenn keine Datei vorhanden ist, überträgt der Minifilter diese Informationen an den Dienst, wodurch die Priorität der Dateiwiederherstellung erhöht wird (während der gesamten Zeit wird die Wiederherstellung ausgeführt).  Es stellt sich heraus, dass diese Datei nur an den Anfang der Warteschlange springt.  Danach stellt der Dienst selbst (oder andere Acronis-Tools) diese Datei wieder her und teilt dem Treiber mit, dass alles in Ordnung ist. Jetzt kann das Betriebssystem darauf zugreifen und der Treiber gibt die ursprüngliche Anforderung vom System auf die Festplatte „frei“. <br><br>  Wenn eine Wiederherstellung nicht möglich ist, informiert der Dienst den Treiber, dass sich auch keine Datei in der Sicherung befindet.  Unser Minifiltertreiber überspringt die Systemanforderung einfach weiter und der ursprüngliche Anforderer (das Betriebssystem selbst oder die Anwendung) erhält den Fehler "Datei nicht gefunden".  Dies ist jedoch ganz normal, wenn sich die Datei wirklich nicht auf der Festplatte und im Backup befand. <br><br><img src="https://habrastorage.org/webt/yv/8w/qe/yv8wqetbjrg3kq2hkr2vosj8dve.png"><br><br>  Natürlich arbeitet das Betriebssystem viel langsamer, da das Lesen einer Datei oder Bibliothek in mehreren Phasen erfolgt und möglicherweise auch auf Remote-Ressourcen zugegriffen werden kann.  Aber dann kann der Benutzer so schnell wie möglich mit der Arbeit beginnen, während die Wiederherstellung noch stattfindet. <br><br><h3>  Brauche weniger, noch weniger ... </h3><br>  Der Prototyp hat sich bewährt.  Wir haben aber auch festgestellt, dass wir weitermachen müssen, da in einigen Fällen immer noch Deadlocks auftreten.  Beispielsweise kann das Betriebssystem verschiedene Bibliotheken in mehreren Threads anfordern, was dazu führt, dass unser Dienst für sich selbst geschlossen wird. <br><br>  Das Problem, an dem ich gerade arbeite, besteht darin, die Geschwindigkeit der aktiven Wiederherstellung zu erhöhen und die Systemsicherheit zu erhöhen.  Angenommen, das System benötigt keine ganze Datei, sondern nur einen Teil davon.  Hierfür wurde ein weiterer Treiber entwickelt - ein Festplattenfiltertreiber.  Es funktioniert nicht mehr auf der Datei, sondern auf der Blockebene.  Das Funktionsprinzip ist ähnlich: Im normalen Betrieb protokolliert der Treiber einfach die geänderten Blöcke auf der Festplatte, und im Wiederherstellungsmodus versucht er, den Block selbst zu lesen. Im Fehlerfall fordert er den Dienst auf, die Priorität zu erhöhen.  Alle anderen Teile des Systems bleiben jedoch gleich.  Beispielsweise ahnt ein Dienst auf Betriebssystemebene nicht einmal, dass er zur Kommunikation mit einem anderen Treiber angeboten wird, da die Hauptaufgabe darin besteht, dem Betriebssystem genau die Daten zur Verfügung zu stellen, die für das Funktionieren erforderlich sind.  Diese Richtung erfordert erhebliche Verbesserungen, schon allein deshalb, weil der Dienst noch nicht weiß, wie er auf Blockebene denken soll. <br><br>  Im nächsten Schritt habe ich beschlossen, den Treiber ausführlicher und früher auszuführen und statt des Dienstes die UEFI-Treiber und native Windows-Anwendungen zu verwenden.  Zu diesem Zweck wurde ein <a href="https://edk2-docs.gitbooks.io/edk-ii-uefi-driver-writer-s-guide/3_foundation/37_uefi_images/372_drivers.html">UEFI-Boot-Treiber</a> (oder DXE-Treiber) entwickelt, der startet und abstirbt, bevor das Betriebssystem gestartet wird.  Die „Geschichte“ der UEFI-Treiber, Einzelheiten zur Montage und Installation sowie die Besonderheiten der Windows Native-Anwendungen werden wir im nächsten Beitrag behandeln.  Abonnieren Sie also unseren Blog und ich bereite vorerst eine Geschichte über die nächste Phase der Arbeit vor.  Ich würde mich über Ihre Kommentare und Ratschläge freuen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de477658/">https://habr.com/ru/post/de477658/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de477646/index.html">Mathematiker schneiden Formen auf der Suche nach Teilen von Gleichungen</a></li>
<li><a href="../de477648/index.html">MVCC in PostgreSQL-3. Zeilenversionen</a></li>
<li><a href="../de477650/index.html">Verschlüsselung des TLS-Verkehrs nach GOST-2012-Algorithmen mit Stunnel</a></li>
<li><a href="../de477654/index.html">Probieren Sie den verbesserten instanceof-Operator in Java 14 aus</a></li>
<li><a href="../de477656/index.html">Also trotzdem, warum brauchst du make?</a></li>
<li><a href="../de477662/index.html">Zugriff auf Redd Tyres auf FTDI-Brücken</a></li>
<li><a href="../de477668/index.html">29. November, 18 Uhr - devleads-mitap</a></li>
<li><a href="../de477670/index.html">Was gibt Testautomatisierung</a></li>
<li><a href="../de477672/index.html">Rechte und Pflichten der Teammitglieder: rechtliche und kulturelle Aspekte</a></li>
<li><a href="../de477674/index.html">Bedeutet KI Liebe?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>