<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСиЁЯП╗тАНтЬИя╕П ЁЯжА ЁЯЩЗЁЯП╝ Android рдкрд╛рда рдкреНрд░рджрд░реНрд╢рди ЁЯзШЁЯП╛ ЁЯСитАНЁЯПл ЁЯТЗЁЯП╛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдкрд╛рдареНрдп рд╕реВрдЪрдирд╛ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡рддрдГ рдХрдИ Android рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХрд╛ рд╕рдмрд╕реЗ рдмреБрдирд┐рдпрд╛рджреА рдФрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред рдпрд╣ рд▓реЗрдЦ TextView рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдЧрд╛ред "рд╣реИрд▓реЛ рд╡рд░реН...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Android рдкрд╛рда рдкреНрд░рджрд░реНрд╢рди</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redmadrobot/blog/461787/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/mc/2_/_o/mc2__o7rq1m6ex9alol6ivz5vey.png"></div><br><p>  рдкрд╛рдареНрдп рд╕реВрдЪрдирд╛ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡рддрдГ рдХрдИ Android рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХрд╛ рд╕рдмрд╕реЗ рдмреБрдирд┐рдпрд╛рджреА рдФрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред  рдпрд╣ рд▓реЗрдЦ TextView рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдЧрд╛ред  "рд╣реИрд▓реЛ рд╡рд░реНрд▓реНрдб" рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рдкреНрд░рддреНрдпреЗрдХ рдбреЗрд╡рд▓рдкрд░, рдЗрд╕ рдпреВрдЬрд░ рдЗрдВрдЯрд░рдлреЗрд╕ рддрддреНрд╡ рдХреЗ рд╕рд╛рде рд▓рдЧрд╛рддрд╛рд░ рд╕рд╛рдордирд╛ рдХрд░рддрд╛ рд╣реИред  рд╕рдордп-рд╕рдордп рдкрд░, рдкрд╛рда рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╕рдордп, рдЖрдкрдХреЛ рд╕реНрдХреНрд░реАрди рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреЗ рд╕рдордп рд╡рд┐рднрд┐рдиреНрди рдбрд┐рдЬрд╝рд╛рдЗрди рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдпрд╛ рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрдирд╛ рд╣реЛрдЧрд╛ред </p><br><p>  рдореИрдВ TextView рдбрд┐рд╡рд╛рдЗрд╕ рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдХреБрдЫ рд╕реВрдХреНрд╖реНрдорддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реВрдВрдЧрд╛ред  рдкрд┐рдЫрд▓реЗ Google I / O рдХреА рд░рд┐рдкреЛрд░реНрдЯреЛрдВ рд╕реЗ рдореБрдЦреНрдп рд╕реБрдЭрд╛рд╡ рд▓рд┐рдП рдЧрдП рдереЗред </p><a name="habracut"></a><br><h1 id="textview-pod-kapotom">  рд╣реБрдб рдХреЗ рдиреАрдЪреЗ TextView </h1><br><p>  рдПрдВрдбреНрд░реЙрдЗрдб рдореЗрдВ рдЯреЗрдХреНрд╕реНрдЯ рд░реЗрдВрдбрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣реБрдб рдХреЗ рдиреАрдЪреЗ рд╡рд┐рднрд┐рдиреНрди рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЗ рдПрдХ рдкреВрд░реЗ рдвреЗрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрдиреНрд╣реЗрдВ рджреЛ рдореБрдЦреНрдп рднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ - рдЬрд╛рд╡рд╛ рдХреЛрдб рдФрд░ рджреЗрд╢реА рдХреЛрдб: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hb/p0/gg/hbp0ggycnpeisn8v8hwyqkkmvfq.png" width="800"></div><br><p>  рдЬрд╛рд╡рд╛ рдХреЛрдб рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдПрдВрдбреНрд░реЙрдЗрдб рдПрд╕рдбреАрдХреЗ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ, рдФрд░ рдЗрд╕рдореЗрдВ рд╕реЗ рдирдИ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЛ рд╕рдорд░реНрдерди рдкреБрд╕реНрддрдХрд╛рд▓рдп рдореЗрдВ рдкреЛрд░реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  TextView рдХреЛрд░ рд╕реНрд╡рдпрдВ C ++ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдкреЛрд░реНрдЯрд┐рдВрдЧ рдХреЛ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдирдП рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рд╕реЗ рд╡рд╣рд╛рдВ рд▓рд╛рдЧреВ рдирдИ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рдорд░реНрдерди рдкреБрд╕реНрддрдХрд╛рд▓рдп рддрдХ рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред  рдореБрдЦреНрдп рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╣реИ: </p><br><ul><li>  рдорд┐рдирд┐рдХрд┐рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрд╛рда рдХреА рд▓рдВрдмрд╛рдИ, рд░реЗрдЦрд╛ рдХреЛ рддреЛрдбрд╝рдиреЗ рдФрд░ рд╢рдмреНрджрд╛рдВрд╢ рджреНрд╡рд╛рд░рд╛ рд╢рдмреНрджреЛрдВ рдХреЛ рдорд╛рдкрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li><li>  ICU рдпреВрдирд┐рдХреЛрдб рд╕рд╣рд╛рдпрддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </li><li>  рд╣рд╛рд░реНрдлрдмрдЬ рдпреВрдирд┐рдХреЛрдб рд╡рд░реНрдгреЛрдВ рдХреЗ рд▓рд┐рдП рдлреЛрдВрдЯ рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рдЧреНрд░рд╛рдлрд┐рдХ рддрддреНрд╡реЛрдВ (рдЧреНрд▓рд┐рдлрд╝) рдХреЛ рдвреВрдВрдврддрд╛ рд╣реИред </li><li>  FreeType рдЧреНрд▓рд┐рдлрд╝ рдХреЗ рдмрд┐рдЯрдореИрдк рдмрдирд╛рддрд╛ рд╣реИред </li><li>  Skia 2D рдЧреНрд░рд╛рдлрд┐рдХреНрд╕ рдЦреАрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЗрдВрдЬрди рд╣реИред </li></ul><br><h2 id="izmerenie-dliny-teksta-i-perenos-strok">  рдкрд╛рда рдХреА рд▓рдВрдмрд╛рдИ рдФрд░ рд░реЗрдЦрд╛ рдХреЛ рдорд╛рдкрдирд╛ </h2><br><p>  рдпрджрд┐ рдЖрдк рдорд┐рдирд┐рдХрд┐рди рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд▓рд┐рдП рд▓рд╛рдЗрди рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдЯреЗрдХреНрд╕реНрдЯ рд╡реНрдпреВ рдХреЗ рдЕрдВрджрд░ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИ, рддреЛ рдкрд╣рд▓реА рдЪреАрдЬ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рд▓рд╛рдЗрди рдореЗрдВ рдЧреНрд▓рд┐рдлрд╝ рдХреНрдпрд╛ рд╣реИ: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qt/1o/uk/qt1ouktu4gn9x0wncbgiy2a7qkg.png" width="800"></div><br>
<p> рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рд╕реЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЧреНрд▓рд┐рдлрд╝ рдХреЗ рд╕рд╛рде рдпреВрдирд┐рдХреЛрдб рд╡рд░реНрдгреЛрдВ рдХрд╛ рдорд┐рд▓рд╛рди рд╣рдореЗрд╢рд╛ рдПрдХ рд╕реЗ рдПрдХ рдирд╣реАрдВ рд╣реЛрдЧрд╛: рдпрд╣рд╛рдБ 3 рд╡рд░реНрдг рдПрдХ рдмрд╛рд░ рдореЗрдВ рдПрдХ ffi рдЧреНрд▓рд┐рдлрд╝ рдХреЗ рдЕрдиреБрд░реВрдк рд╣реЛрдВрдЧреЗред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдЖрд╡рд╢реНрдпрдХ рдЧреНрд▓рд┐рдлрд╝ рд╡рд┐рднрд┐рдиреНрди рд╕рд┐рд╕реНрдЯрдо рдлреЛрдВрдЯ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  рдХреЗрд╡рд▓ рд╕рд┐рд╕реНрдЯрдо рдлреЛрдВрдЯ рдореЗрдВ рдЧреНрд▓рд┐рдлрд╝ рдЦреЛрдЬрдиреЗ рд╕реЗ рдХрдард┐рдирд╛рдЗрдпреЛрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝ рд╕рдХрддрд╛ рд╣реИ, рдЦрд╛рд╕рдХрд░ рдЕрдЧрд░ рдЖрдЗрдХрди рдпрд╛ рдЗрдореЛрдЬреА рдкрд╛рддреНрд░реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣ рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдлреЛрдВрдЯ рд╕реЗ рдкрд╛рддреНрд░реЛрдВ рдХреЛ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рдирд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, <strong>рдПрдВрдбреНрд░реЙрдЗрдб рдХреНрдпреВ (29) рд╕реЗ</strong> рд╢реБрд░реВ рдХрд░рдирд╛, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде рдЖрдиреЗ рд╡рд╛рд▓реЗ рдлреЛрдВрдЯ рдХреА рдЕрдкрдиреА рд╕реВрдЪреА рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЧрдпрд╛ред  рдЗрд╕ рд╕реВрдЪреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдЧреНрд▓рд┐рдлрд╝ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛: </p><br><pre> <code class="kotlin hljs">textView.typeface = TypeFace.CustomFallbackBuilder( FontFamily.Builder( Font.Builder(assets, тАЬlato.ttfтАЭ).build() ).build() ).addCustomFallback( FontFamily.Builder( Font.Builder(assets, тАЬkosugi.ttfтАЭ).build() ).build() ).build()</code> </pre> <br><p>  рдЕрдм, <code>CustomFallbackBuilder</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ <code>CustomFallbackBuilder</code> рдЬрдм рдЧреНрд▓рд┐рдлрд╝ рдХреЗ рд╕рд╛рде рд╡рд░реНрдг рдорд┐рд▓рд╛рди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ SDK рдХреНрд░рдо рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдлрд╝реЙрдиреНрдЯ рдкрд░рд┐рд╡рд╛рд░ рдкрд░ <code>CustomFallbackBuilder</code> рдХрд░реЗрдЧрд╛, рдФрд░ рдпрджрд┐ рдпрд╣ рдирд╣реАрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рд╕рд┐рд╕реНрдЯрдо рдлреЛрдВрдЯ рдореЗрдВ рдЦреЛрдЬ рдЬрд╛рд░реА рд░рд╣реЗрдЧреА (рдФрд░ <code>setSystemFallback()</code> рд╡рд┐рдзрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдк рдкрд╕рдВрджреАрджрд╛ рд╕рд┐рд╕реНрдЯрдо рдлрд╝реЙрдиреНрдЯ рдкрд░рд┐рд╡рд╛рд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред  <code>CustomFallbackBuilder</code> рдлрд╝реЙрдиреНрдЯ рдкрд░рд┐рд╡рд╛рд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдПрдХ рд╕реАрдорд╛ рд╣реИ - рдЖрдк 64 рд╕реЗ рдЕрдзрд┐рдХ рдлрд╝реЙрдиреНрдЯ рдирд╣реАрдВ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдорд┐рдирд┐рдХрд┐рди рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╢рдмреНрджреЛрдВ рдореЗрдВ рддрд╛рд░реЛрдВ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╢рдмреНрджреЛрдВ рдХреЛ рдорд╛рдкрддрд╛ рд╣реИред  <strong>рд▓реЙрд▓реАрдкреЙрдк (21) рд╕реЗ</strong> рдХрд╛рдо рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╢рдмреНрджреЛрдВ рдХреЗ рдПрдХ рд╕рд┐рд╕реНрдЯрдо <abbr title="рдХрдо рд╕реЗ рдХрдо рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛">LRU</abbr> рдХреИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХрд╛ рдХреИрд╢ рдПрдХ рдмрд╣реБрдд рдмрдбрд╝рд╛ рдкреНрд░рджрд░реНрд╢рди рджреЗрддрд╛ рд╣реИ: рдХреИрд╢реНрдб рд╢рдмреНрдж рдХреЗ рд▓рд┐рдП <code>Paint.measureText()</code> рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░ рдФрд╕рддрди 3% рд╕рдордп рд▓рдЧреЗрдЧрд╛ рдЬрдм рд╡рд╣ рдкрд╣рд▓реА рдмрд╛рд░ рдЕрдкрдиреЗ рдЖрдХрд╛рд░ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d2/f1/om/d2f1omfjlqmmfqalip3whmes-1o.png" width="800"></div><br><p>  рдпрджрд┐ рдкрд╛рда рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЪреМрдбрд╝рд╛рдИ рдореЗрдВ рдлрд┐рдЯ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдорд┐рдирд┐рдХрд┐рди рдкрд╛рда рдореЗрдВ рд▓рд╛рдЗрди рдмреНрд░реЗрдХ рдФрд░ рд╢рдмреНрджреЛрдВ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░рддрд╛ рд╣реИред  <code>breakStrategy</code> <strong>(23) рдХреЗ</strong> рд╕рд╛рде рд╢реБрд░реВ рдХрд░рдХреЗ <strong>,</strong> рдЖрдк <code>breakStrategy</code> рд▓рд┐рдП <code>breakStrategy</code> рдФрд░ <code>breakStrategy</code> рд╡рд┐рд╢реЗрд╖ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ рдЗрд╕рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде <code>breakStrategy=simple</code> рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗрд╡рд▓ рдкрд╛рда рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЧреБрдЬрд░рддреЗ рд╣реБрдП, рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рд╣рд╛рдЗрдлрд╝рди рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░реЗрдЧрд╛: рдЬреИрд╕реЗ рд╣реА рд▓рд╛рдЗрди рдлрд┐рдЯ рд╣реЛрдирд╛ рдмрдВрдж рд╣реЛ рдЬрд╛рддреА рд╣реИ, рд╣рд╛рдЗрдлрд╝рдиреЗрд╢рди рдХреЛ рдЕрдВрддрд┐рдо рд╢рдмреНрдж рд╕реЗ рдкрд╣рд▓реЗ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/im/lc/cr/imlccruuhjr59qzrtpwjmrf6hhk.png" width="600"></div><br><p>  <code>balanced</code> рдореВрд▓реНрдп рдореЗрдВ <code>balanced</code> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд▓рд╛рдЗрди рдмреНрд░реЗрдХ рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧреА рддрд╛рдХрд┐ рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдЪреМрдбрд╝рд╛рдИ рдореЗрдВ рдЧрдардмрдВрдзрди рдХрд┐рдпрд╛ рдЬрд╛рдПред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v5/ys/kc/v5yskcuiwypdyponmrdqep7zaq8.png" width="600"></div><br><p>  <code>high_quality</code> рдореЗрдВ рд▓рдЧрднрдЧ рд╕рдорд╛рди рд╡реНрдпрд╡рд╣рд╛рд░ рд╣реЛрддрд╛ рд╣реИ, рдХреБрдЫ рдЕрдВрддрд░реЛрдВ рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде (рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ: рджрдВрдбрд╛рддреНрдордХ рд░реЗрдЦрд╛ рдкрд░, рд╣рд╛рдЗрдлрд╝рдиреЗрд╢рди рди рдХреЗрд╡рд▓ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╢рдмреНрдж рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рд╢рдмреНрджрд╛рдВрд╢ рджреНрд╡рд╛рд░рд╛ рд╢рдмреНрдж рднреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ)ред </p><br><p>  <code>hyphenationFrequency</code> рд╡рд┐рд╢реЗрд╖рддрд╛ <code>hyphenationFrequency</code> рд╕рд┐рд▓реЗрдмрд▓реНрд╕ рджреНрд╡рд╛рд░рд╛ рд╢рдмреНрдж рд░реИрдкрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд░рдгрдиреАрддрд┐ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред  <code>none</code> рдореВрд▓реНрдп рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╣рд╛рдЗрдлрд╝рдиреЗрд╢рди рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, <code>normal</code> рд╣рд╛рдЗрдлрд╝рдиреЗрд╢рди рдХреА рдПрдХ рдЫреЛрдЯреА рдЖрд╡реГрддреНрддрд┐ рдХрд░реЗрдЧрд╛, рдФрд░ <code>full</code> , рдЕрдзрд┐рдХрддрдо рд╢рдмреНрджреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/cr/hs/ngcrhsphklaxxe842klpnx8mhnw.png" width="600"></div><br><p>  рдЪрдпрдирд┐рдд рдЭрдВрдбреЗ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкрд╛рда рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкреНрд░рджрд░реНрд╢рди ( <strong>Android P (28)</strong> рдкрд░ рдорд╛рдкрд╛ рдЬрд╛рддрд╛ рд╣реИ): </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tx/5r/33/tx5r339s93s1nq6go8hieqhv6fq.png" width="600"></div><br><p>  рдХрд╛рдлреА рдордЬрдмреВрдд рдкреНрд░рджрд░реНрд╢рди рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, Google рдбреЗрд╡рд▓рдкрд░реНрд╕, рд╕рдВрд╕реНрдХрд░рдг <strong>Q (29)</strong> рдФрд░ <strong>AppCompat 1.1.0 рдХреЗ</strong> рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реБрдП, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╣рд╛рдЗрдлрд╝рдиреЗрд╢рди рдХреЛ рдмрдВрдж рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ред  рдпрджрд┐ рд╢рдмреНрдж рд░реИрдкрд┐рдВрдЧ рдЖрд╡реЗрджрди рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рддреЛ рдЕрдм рдЖрдкрдХреЛ рдЗрд╕реЗ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рд╡рд░реНрдб рд░реИрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдХрд┐рд╕реА рдХреЛ рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рд╡рд░реНрддрдорд╛рди рдЪрдпрдирд┐рдд рднрд╛рд╖рд╛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░реЗрдЧреАред  рднрд╛рд╖рд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рд╕рд┐рд╕реНрдЯрдо рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рдирд┐рдпрдореЛрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реЗрд╖ рд╢рдмреНрджрдХреЛрд╢реЛрдВ рдХрд╛ рдЪрдпрди рдХрд░реЗрдЧрд╛ред </p><br><h1 id="stili-teksta">  рдкрд╛рда рд╢реИрд▓реА </h1><br><p>  рдПрдВрдбреНрд░реЙрдЗрдб рдореЗрдВ рдЯреЗрдХреНрд╕реНрдЯ рдХреЛ рд╕реНрдЯрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЗ рд╣реИрдВ: </p><br><ul><li>  <strong>рдПрдХ рдПрдХрд▓ рд╢реИрд▓реА</strong> рдЬреЛ рд╕рдВрдкреВрд░реНрдг TextView рддрддреНрд╡ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреА рд╣реИред </li><li>  <strong>рдмрд╣реБ-рд╢реИрд▓реА (рдорд▓реНрдЯреА рд╕реНрдЯрд╛рдЗрд▓)</strong> - рдПрдХ рдмрд╛рд░ рдореЗрдВ рдХрдИ рд╢реИрд▓рд┐рдпрд╛рдБ, рдЬреЛ рдкреИрд░рд╛рдЧреНрд░рд╛рдл рдпрд╛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкрд╛рддреНрд░реЛрдВ рдХреЗ рд╕реНрддрд░ рдкрд░ рдкрд╛рда рдкрд░ рд▓рд╛рдЧреВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЗ рд╣реИрдВ: <br><ul><li>  рдХреИрдирд╡рд╛рд╕ рдкрд░ рдкрд╛рда рдЦреАрдВрдЪрдирд╛ </li><li>  html рдЯреИрдЧ </li><li>  рд╡рд┐рд╢реЗрд╖ рдорд╛рд░реНрдХрдЕрдк рддрддреНрд╡ - рд╕реНрдкреИрди </li></ul></li></ul><br><p>  рдПрдХ рдПрдХрд▓ рд╢реИрд▓реА рдХрд╛ рдЕрд░реНрде рд╣реИ рдЯреЗрдХреНрд╕реНрдЯ рд╡реНрдпреВ рдорд╛рд░реНрдХрдЕрдк рдореЗрдВ XML рд╢реИрд▓рд┐рдпреЛрдВ рдпрд╛ XML рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕рд┐рд╕реНрдЯрдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреНрд░рдо рдореЗрдВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рд╕реЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдЧрд╛: рдЯреЗрдХреНрд╕реНрдЯрдПрдкреИрд░реЗрдВрд╕, рдереАрдо (рдереАрдо), рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╢реИрд▓реА (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╢реИрд▓реА), рдЖрд╡реЗрджрди рд╕реЗ рд╢реИрд▓реА, рдФрд░ рд╕рд░реНрд╡реЛрдЪреНрдЪ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рд╡реНрдпреВ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рдорд╛рди рд╣реИред </p><br><p>  рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдПрдХ рдХрд╛рдлреА рд╕рд░рд▓ рдЙрдкрд╛рдп рд╣реИ, рд▓реЗрдХрд┐рди, рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдпрд╣ рдЖрдкрдХреЛ рдкрд╛рда рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рд╢реИрд▓реА рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред </p><br><p>  HTML рдЯреИрдЧ рдПрдХ рдФрд░ рд╕рд░рд▓ рд╕рдорд╛рдзрд╛рди рд╣реИ рдЬреЛ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╢рдмреНрджреЛрдВ рдХреЛ рдмреЛрд▓реНрдб, рдЗрдЯреИрд▓рд┐рдХ рдмрдирд╛рдиреЗ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдкрд╛рда рдореЗрдВ рдбреЙрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд╕реВрдЪрд┐рдпреЛрдВ рдХреЛ рд╣рд╛рдЗрд▓рд╛рдЗрдЯ рдХрд░рдиреЗ рдЬреИрд╕реА рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рд╕рднреА рдбреЗрд╡рд▓рдкрд░ рдХреЛ <code>Html.fromHtml()</code> рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реИ, рдЬреЛ рдХрд┐ рдкрд╛рда рдХреЛ рдЯреИрдЧ рдХрд┐рдП рдЧрдП рдкрд╛рда рдХреЛ рд╕реНрдкреИрди рджреНрд╡рд╛рд░рд╛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░ рджреЗрдЧрд╛ред  рд▓реЗрдХрд┐рди рдЗрд╕ рд╕рдорд╛рдзрд╛рди рдореЗрдВ рд╕реАрдорд┐рдд рдХреНрд╖рдорддрд╛рдПрдВ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ HTML рдЯреИрдЧреНрд╕ рдХреЗ рдХреЗрд╡рд▓ рдПрдХ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рдкрд╣рдЪрд╛рдирддрд╛ рд╣реИ рдФрд░ рд╕реАрдПрд╕рдПрд╕ рд╢реИрд▓рд┐рдпреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = <span class="hljs-string"><span class="hljs-string">"My text &lt;ul&gt;&lt;li&gt;bullet one&lt;/li&gt;&lt;li&gt;bullet two&lt;/li&gt;&lt;/ul&gt;"</span></span> myTextView.text = Html.fromHtml(text)</code> </pre> <br><p>  TextView рдХреЛ рд╕реНрдЯрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рд╡рд┐рдзрд┐ рдХреА рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдХреЛ рдпрд╛рдж рд░рдЦрдиреЗ рдпреЛрдЧреНрдп рд╣реИ, рдЬреЛ рдЕрдВрддрд┐рдо рдкрд░рд┐рдгрд╛рдо рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░реЗрдЧрд╛: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zm/hr/hl/zmhrhluqvvcv77s1b85gkxbtcww.png" width="400"></div><br><p>  рдПрдХ рдФрд░ рддрд░реАрдХрд╛ - рдХреИрдирд╡рд╛рд╕ рдкрд░ рдкрд╛рда рдЦреАрдВрдЪрдирд╛ - рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдкрд╛рда рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рджреЗрддрд╛ рд╣реИ: рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХ рдШреБрдорд╛рд╡рджрд╛рд░ рд░реЗрдЦрд╛ рдХреЗ рд╕рд╛рде рдкрд╛рда рдЖрдХрд░реНрд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕рдорд╛рдзрд╛рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдХрд╛рдлреА рдореБрд╢реНрдХрд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рд▓реЗрдЦ рдХреЗ рджрд╛рдпрд░реЗ рд╕реЗ рдкрд░реЗ рд╣реИред </p><br><h1 id="spans">  spans </h1><br><p>  TextView рдареАрдХ рдзреБрди рд╢реИрд▓рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрдкреИрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рд╕реНрдкреИрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк рд╡рд░реНрдгреЛрдВ рдХреА рд╢реНрд░реЗрдгреА рдХрд╛ рд░рдВрдЧ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдкрд╛рда рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд▓рд┐рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдкрд╛рда рдХрд╛ рдЖрдХрд╛рд░ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдкреИрд░рд╛рдЧреНрд░рд╛рдл рдХреЗ рд╕рд╛рдордиреЗ рдПрдХ рдмрд┐рдВрджреБ рдЦреАрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрджрд┐ред </p><br><p>  рд╕реНрдкреИрди рдХреА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢реНрд░реЗрдгрд┐рдпрд╛рдВ рдкреНрд░рддрд┐рд╖реНрдард┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ: </p><br><ul><li>  <strong>рдЪрд░рд┐рддреНрд░ рд╕реНрдкреИрди</strong> - рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдЪрд░рд┐рддреНрд░ рд╕реНрддрд░ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВред <br><ul><li>  <strong>рджрд┐рдЦрд╛рд╡рдЯ рдкреНрд░рднрд╛рд╡рд┐рдд</strong> - рдкрд╛рда рдХрд╛ рдЖрдХрд╛рд░ рди рдмрджрд▓реЗрдВред </li><li>  <strong>рдореИрдЯреНрд░рд┐рдХ рдкреНрд░рднрд╛рд╡рд┐рдд</strong> - рдкрд╛рда рдХрд╛ рдЖрдХрд╛рд░ рдмрджрд▓реЗрдВред </li></ul></li><li>  <strong>рдкреИрд░рд╛рдЧреНрд░рд╛рдл рд╕реНрдкреИрди</strong> - рдкреИрд░рд╛рдЧреНрд░рд╛рдл рд╕реНрддрд░ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zy/os/x2/zyosx2ovroe15y3bd94qridaaou.png"></div><br><p>  рдПрдВрдбреНрд░реЙрдЗрдб рдлреНрд░реЗрдорд╡рд░реНрдХ рдореЗрдВ рдЗрдВрдЯрд░рдлреЗрд╕ рдФрд░ рдПрдмреНрд╕реНрдЯреНрд░реИрдХреНрдЯ рдХреНрд▓рд╛рд╕реЗрд╕ рд╣реИрдВ, рдЬрд┐рдиреНрд╣реЗрдВ <code>onMeasure()</code> рдФрд░ <code>onMeasure()</code> рд░реЗрдВрдбрд░рд┐рдВрдЧ рдХреЗ рджреМрд░рд╛рди рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпреЗ рддрд░реАрдХреЗ <code>TextPaint</code> рдФрд░ <code>Canvas</code> рдЬреИрд╕реА <code>TextPaint</code> -рд▓реЗрд╡рд▓ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред  рд╕реНрдкреИрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдПрдВрдбреНрд░реЙрдЗрдб рдлреНрд░реЗрдорд╡рд░реНрдХ рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рддрд░реАрдХреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреМрди-рд╕рд╛ рдЗрдВрдЯрд░рдлреЗрд╕ рд╣реИред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fv/do/er/fvdoerpx8zxykjxvt9ru4kigica.png" width="600"></div><br><p>  рдПрдВрдбреНрд░реЙрдЗрдб рдлреНрд░реЗрдорд╡рд░реНрдХ рд▓рдЧрднрдЧ 20+ рд╕реНрдкреИрди рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдЖрдк рдЕрдкрдирд╛ рдмрдирд╛ рд▓реЗрдВ, рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдмреЗрд╣рддрд░ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдПрд╕рдбреАрдХреЗ рдЙрдкрдпреБрдХреНрдд рд╣реИред </p><br><h3 id="appearance-vs-metric-affecting-spans">  рд╕реНрдкреИрди рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдореЗрдЯреНрд░рд┐рдХ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ </h3><br><p>  рд╕реНрдкреИрди рдХреА рдкрд╣рд▓реА рд╢реНрд░реЗрдгреА рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рд╡рд░реНрдг рдХреИрд╕реЗ рджрд┐рдЦреЗрдВрдЧреЗ: рдЪрд░рд┐рддреНрд░ рдХрд╛ рд░рдВрдЧ, рдкреГрд╖реНрдарднреВрдорд┐ рдХрд╛ рд░рдВрдЧ, рд░реЗрдЦрд╛рдВрдХрд┐рдд рдпрд╛ рдкрд╛рд░ рдХрд┐рдП рдЧрдП рд╡рд░реНрдг, рдЖрджрд┐ред  рдпреЗ рд╕реНрдкреИрди <code>UpdateAppearance</code> рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ <code>CharacterStyle</code> рдХреНрд▓рд╛рд╕ рд╕реЗ рдЗрдирд╣реЗрд░рд┐рдЯ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ <code>TextPaint</code> рдСрдмреНрдЬреЗрдХреНрдЯ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/or/8f/zl/or8fzltp5mvoyhvdey8tz1uoqhg.png"></div><br><p>  рдореИрдЯреНрд░рд┐рдХ рдкреНрд░рднрд╛рд╡рд┐рдд рд╕реНрдкреИрди рдЯреЗрдХреНрд╕реНрдЯ рдФрд░ рд▓реЗрдЖрдЙрдЯ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕реНрдкреИрди рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рди рдХреЗрд╡рд▓ <code>onMeasure()</code> , рдмрд▓реНрдХрд┐ рдХреЙрд▓ <code>onMeasure()</code> / <code>onLayout()</code> ред  рдпреЗ <code>MetricAffectingSpan</code> рдЖрдорддреМрд░ рдкрд░ <code>MetricAffectingSpan</code> рд╡рд░реНрдЧ рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВ, рдЬреЛ рдКрдкрд░ рдмрддрд╛рдП рдЧрдП <code>MetricAffectingSpan</code> рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓реЗ рд╣реИрдВред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_h/hs/hd/_hhshd0pcadvdievngojmtsqzlu.png"></div><br><h2 id="character-vs-paragraph-affecting-spans">  рд╡рд░реНрдг рдмрдирд╛рдо рдкреИрд░рд╛рдЧреНрд░рд╛рдл рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕реНрдкреИрди </h2><br><p>  рдкреИрд░рд╛рдЧреНрд░рд╛рдлрд╝ рдЕрд╡рдзрд┐ рдкрд╛рда рдХреЗ рдПрдХ рдкреВрд░реЗ рдмреНрд▓реЙрдХ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреА рд╣реИ: рдпрд╣ рд╕рдВрд░реЗрдЦрдг, рдЗрдВрдбреЗрдВрдЯреЗрд╢рди рдХреЛ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ рдкреИрд░рд╛рдЧреНрд░рд╛рдл рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдПрдХ рдмрд┐рдВрджреБ рднреА рдбрд╛рд▓ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕реНрдкреИрди рдХреЛ <code>ParagraphStyle</code> рдХреНрд▓рд╛рд╕ рд╕реЗ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рд▓рд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ <code>ParagraphStyle</code> рдХреА рд╢реБрд░реБрдЖрдд рд╕реЗ рд▓реЗрдХрд░ рдЕрдВрдд рддрдХ рдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ рдбрд╛рд▓рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдпрджрд┐ рд░реЗрдВрдЬ рдЧрд▓рдд рд╣реИ, рддреЛ рд╕реНрдкреИрди рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/76/_n/uj/76_nujhr8rrwz-mne8bgq8p2pfu.png"></div><br><p>  Android рдкрд░, рдкреИрд░рд╛рдЧреНрд░рд╛рдл рдХреЛ newlines ( <code>\n</code> ) рджреНрд╡рд╛рд░рд╛ рдЕрд▓рдЧ рдХрд┐рдП рдЧрдП рдкрд╛рда рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s1/p1/kq/s1p1kq9esdaakdpwh_rkxdvdygw.png"></div><br><h2 id="napisanie-svoih-spanov">  рдЖрдкрдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рд▓реЗрдЦрди </h2><br><p>  рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╕реНрдкреИрди рд▓рд┐рдЦрддреЗ рд╕рдордп, рдЖрдкрдХреЛ рдпрд╣ рддрдп рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕ рд╡рд░реНрдЧ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕ рд╡рд░реНрдЧ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рдирд╛ рд╣реИ: </p><br><ul><li>  рдЪрд░рд┐рддреНрд░ рд╕реНрддрд░ рдкрд░ рдкрд╛рда рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ -&gt; <code>CharacterStyle</code> </li><li>  рдкреИрд░рд╛рдЧреНрд░рд╛рдл рд╕реНрддрд░ рдкрд░ рдкрд╛рда рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ -&gt; <code>ParagraphStyle</code> </li><li>  рдкрд╛рда рджреГрд╢реНрдп рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ тЖТ <code>UpdateAppearance</code> </li><li>  рдкрд╛рда рдХрд╛ рдЖрдХрд╛рд░ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ - <code>UpdateLayout</code> </li></ul><br><p>  рдпрд╣рд╛рдБ рдлрд╝реЙрдиреНрдЯ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд╡рдзрд┐ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomTypefaceSpan</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> font: Typeface?) : MetricAffectingSpan() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateMeasureState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = update(textPaint) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateDrawState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = update(textPaint) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { textPaint.apply { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> old = typeface <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> oldStyle = old?.style ?: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> font = Typeface.create(font, oldStyle) typeface = font <span class="hljs-comment"><span class="hljs-comment">//    } } }</span></span></code> </pre> <br><p>  рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рд╣рдо рдХреЛрдб рдХреЗ рд╣рд╛рдЗрд▓рд╛рдЗрдЯрд┐рдВрдЧ рдмреНрд▓реЙрдХ рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рд╕реНрдкреИрди рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдо рдЕрдкрдиреЗ рдкрд┐рдЫрд▓реЗ рд╕реНрдкреИрди рдХреЛ рдПрдбрд┐рдЯ рдХрд░реЗрдВрдЧреЗ - рдлреЙрдиреНрдЯ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЯреЗрдХреНрд╕реНрдЯ рдХреЗ рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдХрд▓рд░ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░реЗрдВрдЧреЗ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CodeBlockSpan</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> font: Typeface?) : MetricAffectingSpan() { тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { textPaint.apply { <span class="hljs-comment"><span class="hljs-comment">//    тАж bgColor = lightGray //    } } }</span></span></code> </pre> <br><p>  рдкрд╛рда рдкрд░ рдЕрд╡рдзрд┐ рд▓рд╛рдЧреВ рдХрд░реЗрдВ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//    span spannable.setSpan(CodeBlockSpan(typeface), ...)</span></span></code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдЖрдк рджреЛ рд╕реНрдкреИрди рдХреЗ рд╕рдВрдпреЛрдЬрди рд╕реЗ рдареАрдХ рд╡реИрд╕рд╛ рд╣реА рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: Android рдлреНрд░реЗрдорд╡рд░реНрдХ рд╕реЗ рд╣рдорд╛рд░реЗ рдкрд┐рдЫрд▓реЗ <code>CustomTypefaceSpan</code> рдФрд░ <code>BackgroundColorSpan</code> рдХреЛ рд▓реЗрдВ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//    spannable.setSpan(BackgroundColorSpan(lightGray), ...) //   spannable.setSpan(CustomTypefaceSpan(typeface), ...)</span></span></code> </pre> <br><p>  рдЗрди рджреЛрдиреЛрдВ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдореЗрдВ рдЕрдВрддрд░ рд╣реЛрдЧрд╛ред  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рд╕реНрд╡-рд▓рд┐рдЦрд┐рдд рд╕реНрдкреИрди рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╡рд┐рдкрд░реАрдд <code>Parcelable</code> рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдЬрдм рд╕реНрд╡-рд▓рд┐рдЦрд┐рдд рдорд╛рд░реНрдХрдЕрдк рдХреА рдЕрд╡рдзрд┐ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЗрдВрдЯреЗрдВрдЯ рдпрд╛ рдХреНрд▓рд┐рдкрдмреЛрд░реНрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд╕реНрдЯрд╛рдЗрд▓ рд▓рд╛рдЗрди рдХреЛ рдкреНрд░реЗрд╖рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдлреНрд░реЗрдорд╡рд░реНрдХ рд╕реЗ рд╕реНрдкреИрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдорд╛рд░реНрдХрдЕрдк рд░рд╣реЗрдЧрд╛ред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/is/nw/uu/isnwuux9cosllp6h0kgawifcepo.png" width="600"></div><br><h2 id="ispolzovanie-spanov-v-tekste">  рдкрд╛рда рдореЗрдВ рд╕реНрдкреИрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </h2><br><p>  рдлреНрд░реЗрдорд╡рд░реНрдХ рдореЗрдВ рд╕реНрдЯрд╛рдЗрд▓ рдХрд┐рдП рдЧрдП рдЯреЗрдХреНрд╕реНрдЯ рдХреЗ рд▓рд┐рдП рджреЛ рдЗрдВрдЯрд░рдлреЗрд╕ рд╣реИрдВ: <code>Spannable</code> рдФрд░ <code>Spannable</code> (рдХреНрд░рдорд╢рдГ рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рдФрд░ рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓ рдорд╛рд░реНрдХрдЕрдк рдХреЗ рд╕рд╛рде) рдФрд░ рддреАрди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди: <code>SpannedString</code> (рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рдЯреЗрдХреНрд╕реНрдЯ), <code>SpannableString</code> (рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рдЯреЗрдХреНрд╕реНрдЯ) рдФрд░ <code>SpannableStringBuilder</code> ( <code>SpannableStringBuilder</code> рдкрд╛рда)ред </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  рдкрд░рд╕реНрдкрд░ рдкрд╛рда </th><th>  рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓ рдорд╛рд░реНрдХрдЕрдк </th></tr></thead><tbody><tr><td>  <strong>рдлреИрд▓рд╛ рд╣реБрдЖ</strong> рддрд╛рд░ </td><td>  рдирд╣реАрдВ </td><td>  рдирд╣реАрдВ </td></tr><tr><td>  <strong>рд╕реНрдкреИрди рдХрд░рдиреЗ рдпреЛрдЧреНрдп</strong> рддрд╛рд░ </td><td>  рдирд╣реАрдВ </td><td>  рд╣рд╛рдВ </td></tr><tr><td>  <strong>Spannablestring</strong> рдмрд┐рд▓реНрдбрд░ </td><td>  рд╣рд╛рдВ </td><td>  рд╣рд╛рдВ </td></tr></tbody></table></div><br><p>  <code>SpannableStringBuilder</code> , рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ <code>EditText</code> рдЕрдВрджрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдкрд╛рда рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><p>  рдЖрдк рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдирдИ рдЕрд╡рдзрд┐ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><p> <code>setSpan(Object what, int start, int end, int flags)</code> </p> <br><p>  рд╕реНрдкреИрди рдкрд╣рд▓реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдлрд┐рд░ рдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреА рд╕реАрдорд╛ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдФрд░ рдЕрдВрддрд┐рдо рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдирдП рдкрд╛рда рдХреЛ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рддреЗ рд╕рдордп рд╕реНрдкреИрди рдХрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рдХреНрдпрд╛ рд╕реНрдкреИрди рдкреНрд░рд╛рд░рдВрдн рдпрд╛ рдЕрдВрдд рдмрд┐рдВрджреБ рдкрд░ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд┐рдП рдЧрдП рдЯреЗрдХреНрд╕реНрдЯ рддрдХ рдлреИрд▓ рдЬрд╛рдПрдЧрд╛ (рдпрджрд┐ рдЖрдк рдмреАрдЪ рдореЗрдВ рдирдпрд╛ рдкрд╛рда рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдлрд╝реНрд▓реИрдЧ рдорд╛рдиреЛрдВ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛, рдпрд╣ рдЕрд╡рдзрд┐ рдЕрдкрдиреЗ рдЖрдк рд▓рд╛рдЧреВ рд╣реЛ рдЬрд╛рдПрдЧреА) ред </p><br><p>  рдКрдкрд░ рд╕реВрдЪреАрдмрджреНрдз рдХрдХреНрд╖рд╛рдПрдВ рди рдХреЗрд╡рд▓ рд╢рдмреНрджрд╛рд░реНрде рд░реВрдк рд╕реЗ рднрд┐рдиреНрди рд╣реЛрддреА рд╣реИрдВ, рдмрд▓реНрдХрд┐ рдпрд╣ рднреА рдХрд┐ рд╡реЗ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рдХреИрд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВ: <code>SpannedString</code> рдФрд░ <code>SpannableString</code> рд╕реНрдкреИрди рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд░рдгрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ <code>SpannableStringBuilder</code> рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдВрддрд░рд╛рд▓ рдкреЗрдбрд╝</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрдВ</a> ред </p><br><p>  рдпрджрд┐ рдЖрдк рд╕реНрдкреИрди рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЯреЗрдХреНрд╕реНрдЯ рдХреЛ рд░реЗрдВрдбрд░ рдХрд░рдиреЗ рдХреА рдЧрддрд┐ рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдирд┐рдореНрди рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓реЗрдВрдЧреЗ: рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ ~ 250 рд╕реНрдкреИрди рддрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, <code>SpannableString</code> рдФрд░ <code>SpannableStringBuilder</code> рд▓рдЧрднрдЧ рд╕рдорд╛рди рдЧрддрд┐ рд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрджрд┐ рдорд╛рд░реНрдХрдЕрдк рддрддреНрд╡ 250 рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ <code>SpannableString</code> рд╢реБрд░реВ рд╣реЛ рдЬрд╛рддреА рд╣реИред рд╣рд╛рд░рдирд╛ред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрджрд┐ рдХрд╛рд░реНрдп рдХрд┐рд╕реА рдкрд╛рда рдореЗрдВ рдПрдХ рд╢реИрд▓реА рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рд╣реИ, рддреЛ рдХрдХреНрд╖рд╛ рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╕рдордп, рдХрд┐рд╕реА рд╡реНрдпрдХреНрддрд┐ рдХреЛ рд╢рдмреНрджрд╛рд░реНрде рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП: рдХреНрдпрд╛ рдкрдВрдХреНрддрд┐ рдФрд░ рд╢реИрд▓реА рдкрд░рд╕реНрдкрд░ рднрд┐рдиреНрди рд╣реЛрдВрдЧреАред  рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдорд╛рд░реНрдХрдЕрдк рдХреЗ рд▓рд┐рдП 250 рд╕реЗ рдЕрдзрд┐рдХ рд╕реНрдкреИрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рддреЛ рдЖрдкрдХреЛ рд╣рдореЗрд╢рд╛ <code>SpannableStringBuilder</code> рдХреЛ <code>SpannableStringBuilder</code> рджреЗрдиреА рдЪрд╛рд╣рд┐рдПред </p><br><h2 id="proverka-na-nalichie-spana-v-tekste">  рдкрд╛рда рдореЗрдВ рдЕрд╡рдзрд┐ рдХреЗ рд▓рд┐рдП рдЬрд╛рдБрдЪ рдХрд░реЗрдВ </h2><br><p>  рдХрд╛рд░реНрдп рд╕рдордп-рд╕рдордп рдкрд░ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдарддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рд╕реНрдкреИрди рд▓рд╛рдЗрди рдХреА рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЕрд╡рдзрд┐ рд╣реИред  рдФрд░ Stackoverflow рдкрд░ рдЖрдк рдпрд╣ рдХреЛрдб рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasSpan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(spanned: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Spanned</span></span></span></span><span class="hljs-function"><span class="hljs-params">, clazz: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spans: Array&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> T&gt; = spanned.getSpans(<span class="hljs-number"><span class="hljs-number">0</span></span>, spanned.length, clazz) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> spans.isNotEmpty() }</code> </pre> <br><p>  рдРрд╕рд╛ рд╕рдорд╛рдзрд╛рди рдХрд╛рдо рдХрд░реЗрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрдХреНрд╖рдо рд╣реИ: рдЖрдкрдХреЛ рд╕рднреА рд╕реНрдкреИрди рд╕реЗ рдЧреБрдЬрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЙрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдкрд╛рд░рд┐рдд рдкреНрд░рдХрд╛рд░ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ, рдкрд░рд┐рдгрд╛рдо рдХреЛ рдПрдХ рд╕рд░рдгреА рдореЗрдВ рдЗрдХрдЯреНрдард╛ рдХрд░реЗрдВ, рдФрд░ рдЕрдВрдд рдореЗрдВ рдпрд╣ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд╕рд░рдгреА рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реИред </p><br><p>  рдПрдХ рдФрд░ рдЕрдзрд┐рдХ рдкреНрд░рднрд╛рд╡реА рд╕рдорд╛рдзрд╛рди рд╣реЛрдЧрд╛ <code>nextSpanTransition()</code> рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasSpan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(spanned: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Spanned</span></span></span></span><span class="hljs-function"><span class="hljs-params">, clazz: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> limit = spanned.length <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> spanned.nextSpanTransition(<span class="hljs-number"><span class="hljs-number">0</span></span>, limit, clazz) &lt; limit }</code> </pre> <br><h2 id="razmetka-teksta-v-razlichnyh-yazykovyh-resursah">  рд╡рд┐рднрд┐рдиреНрди рднрд╛рд╖рд╛ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдореЗрдВ рдкрд╛рда рдорд╛рд░реНрдХрдЕрдк </h2><br><p>  рдРрд╕рд╛ рдХрд╛рд░реНрдп рддрдм рдЙрддреНрдкрдиреНрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдЖрдк рдХрд┐рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╢рдмреНрдж рдХреЛ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдореЗрдВ рдорд╛рд░реНрдХрдЕрдк рдХреА рдорджрдж рд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЕрдВрдЧреНрд░реЗрдЬреА рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ <em>"рдЯреЗрдХреНрд╕реНрдЯ"</em> рд╢рдмреНрдж рдФрд░ рд╕реНрдкреЗрдирд┐рд╢ рдореЗрдВ <em>"рдЯреЗрдХреНрд╕реНрдЯреЛ"</em> рд╢рдмреНрдж рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-en/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag">&gt;</span></span>Best practices for text in Android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-es/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">тАЭtitleтАЭ</span></span></span><span class="hljs-tag">&gt;</span></span>Texto en Android: mejores pr├бcticas<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  рдпрджрд┐ рдЖрдкрдХреЛ рдХреБрдЫ рд╕рд░рд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╢рдмреНрдж рдХреЛ рдмреЛрд▓реНрдб рдореЗрдВ рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рддреЛ рдЖрдк рд╕рд╛рдорд╛рдиреНрдп HTML рдЯреИрдЧ ( <code>&lt;b&gt;</code> ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  UI рдореЗрдВ, рдЖрдкрдХреЛ рдмрд╕ TextView рдореЗрдВ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╕рдВрд╕рд╛рдзрди рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="kotlin hljs">textView.setText(R.string.title)</code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдЖрдкрдХреЛ рдХреБрдЫ рдФрд░ рдЬрдЯрд┐рд▓ рдЪрд╛рд╣рд┐рдП, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдлрд╝реЙрдиреНрдЯ рдмрджрд▓рдирд╛, рддреЛ html рдХрд╛ рдЕрдм рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд╕рдорд╛рдзрд╛рди рд╡рд┐рд╢реЗрд╖ <code>&lt;annotation&gt;</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред  рдпрд╣ рдЯреИрдЧ рдЖрдкрдХреЛ xml рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХрд┐рд╕реА рднреА рдХреБрдВрдЬреА-рдорд╛рди рдпреБрдЧреНрдо рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдЬрдм рд╣рдо рд╕рдВрд╕рд╛рдзрдиреЛрдВ рд╕реЗ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЦреАрдВрдЪрддреЗ рд╣реИрдВ, рддреЛ рдпреЗ рдЯреИрдЧ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ <code>Annotation</code> рд╕реНрдкреИрди рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ, рдкрд╛рда рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рдХреБрдВрдЬрд┐рдпреЛрдВ рдФрд░ рдореВрд▓реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рд╡реНрдпрд╡рд╕реНрдерд┐рдд рд╣реЛрддреЗ рд╣реИрдВред  рдЙрд╕рдХреЗ рдмрд╛рдж, рдЖрдк рдкрд╛рда рдореЗрдВ рдПрдиреЛрдЯреЗрд╢рди рдХреА рд╕реВрдЪреА рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрд╡рд╢реНрдпрдХ рд╕реНрдкреИрди рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдорд╛рди рд▓реЗрдВ рдХрд┐ рд╣рдореЗрдВ <code>CustomTypefaceSpan</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрд╝реЙрдиреНрдЯ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рдПрдХ рдЯреИрдЧ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЗрд╕реЗ <em>"рдлрд╝реЙрдиреНрдЯ"</em> рдХреБрдВрдЬреА рдФрд░ рдорд╛рди рдХреЗ рд▓рд┐рдП рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ - рдЬрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдлрд╝реЙрдиреНрдЯ рд╣рдо рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рд╡рд╣ рд╣реИ <em>"title_emphasha"</em> : <br></p><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-en/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag">&gt;</span></span>Best practices for <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">font</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">тАЭtitle_emphasisтАЭ</span></span></span><span class="hljs-tag">&gt;</span></span>text<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag">&gt;</span></span> in Android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-es/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">тАЭtitleтАЭ</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">font</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">тАЭtitle_emphasisтАЭ</span></span></span><span class="hljs-tag">&gt;</span></span>Texto<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag">&gt;</span></span> en Android: mejores pr├бcticas<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  рд╕рдВрд╕рд╛рдзрдиреЛрдВ рд╕реЗ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЦреАрдВрдЪреЛ, рдПрдиреЛрдЯреЗрд╢рди рдХреЛ <em>"рдлрд╝реЙрдиреНрдЯ"</em> рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдЦреЛрдЬреЗрдВ рдФрд░ рд╕реНрдкреИрди рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░реЗрдВ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//      SpannedString,     span' val titleText = getText(R.string.title) as SpannedString //    val annotations = titleText.getSpans(0, titleText.length, Annotation::class.java) //     SpannableString //      val spannableString = SpannableString(titleText) //     for (annotation in annotations) { //     "font" if (annotation.key == "font") { val fontName = annotation.value //   ,     if (fontName == "title_emphasis") { val typeface = getFontCompat(R.font.permanent_marker) //  span    ,    spannableString.setSpan( CustomTypefaceSpan(typeface), titleText.getSpanStart(annotation), titleText.getSpanEnd(annotation), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE ) } } } styledText.text = spannableString</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yq/62/mm/yq62mmgvajffkxkzk3qntsnxhw4.png" width="600"></div><br><p>  рдпрд╣ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдХрд┐ рдПрдВрдбреНрд░реЙрдЗрдб рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЗ рдмрд╛рд╣рд░ рдХреЗ рд╕реНрдкреИрди <code>Parcelable</code> рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрдВрдЯреЗрдВрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░реЗрд╖рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдпрд╣ рдЙрди рдПрдиреЛрдЯреЗрд╢рди рдкрд░ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ <code>Parcelable</code> рд▓рд╛рдЧреВ <code>Parcelable</code> ред  рддреЛ рдЖрдк рдПрдиреЛрдЯреЗрдВрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдЗрдВрдЯреНрд░реЗрдВрдЯ рдФрд░ рдкрд╛рд░реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдареАрдХ рдЙрд╕реА рддрд░рд╣ рд╕реЗ рдкрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдЕрдкрдиреЗ рд╕реНрдкреИрди рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░рдХреЗред </p><br><h1 id="kak-tekst-raspolagaetsya-v-textview">  рдЯреЗрдХреНрд╕реНрдЯ рдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ рдХреИрд╕реЗ рдЯреЗрдХреНрд╕реНрдЯ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ </h1><br><p>  TextView рди рдХреЗрд╡рд▓ рдкрд╛рда, рдмрд▓реНрдХрд┐ рдЪрд┐рддреНрд░ рднреА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдЖрдк рдкрд╛рда рдХреЗ рд╕рд╛рдордиреЗ рд╡рд┐рднрд┐рдиреНрди рд╕рдВрдХреЗрдд рднреА рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣реБрдб рдХреЗ рддрд╣рдд, рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ TextView рдПрдХ рдмрдЪреНрдЪрд╛ рд╡рд░реНрдЧ, рд▓реЗрдЖрдЙрдЯ рдмрдирд╛рддрд╛ рд╣реИ, рдЬреЛ рд╕реАрдзреЗ рдкрд╛рда рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред  рдпрд╣ рдПрдХ рд╕рд╛рд░ рд╡рд░реНрдЧ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рддреАрди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИрдВ; рдЖрдорддреМрд░ рдкрд░ рдЬрдм рддрдХ рдЖрдк рдЕрдкрдирд╛ рдирд┐рдпрдВрддреНрд░рдг рдирд╣реАрдВ рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рддрдм рддрдХ рдЖрдкрдХреЛ рд╕реАрдзреЗ рдЙрдирдХреЗ рд╕рд╛рде рдХрд╛рдо рдирд╣реАрдВ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: </p><br><ul><li>  <strong>рдмреЛрд░рд┐рдВрдЧрд▓реИрдЯ рдХрд╛</strong> рдЙрдкрдпреЛрдЧ рд╕рд░рд▓ рдЧреНрд░рдВрдереЛрдВ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ <strong>рдЬрд╛рддрд╛ рд╣реИ</strong> , рд▓рд╛рдЗрди <strong>рдмреНрд░реЗрдХ</strong> , рдЖрд░рдЯреАрдПрд▓ рдФрд░ рдЕрдиреНрдп рдЪреАрдЬреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдмрд╕реЗ рд╣рд▓реНрдХрд╛ рд╣реИред  рдпрджрд┐ рдкрд╛рда рд╕рднреА рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ, рддреЛ TextView рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </li><li>  <strong>StaticLayout рдХрд╛</strong> рдЙрдкрдпреЛрдЧ рдЕрдиреНрдп рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП <strong>TextView рдореЗрдВ</strong> рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li><li>  рдПрдХ рдПрдбрд┐рдЯрдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ рдореНрдпреВрдЯреЗрдмрд▓ рдЯреЗрдХреНрд╕реНрдЯ рдХреЗ рд▓рд┐рдП <strong>рдбрд╛рдпрдиреЗрдорд┐рдХрд▓рд╛рдИрдЯ рдХрд╛</strong> рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </li></ul><br><p>  рд▓реЗрдЖрдЙрдЯ рдореЗрдВ рдХрдИ рд╡рд┐рдзрд┐рдпрд╛рдВ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдкрд╛рда рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдЬрд╛рдирдиреЗ рджреЗрддреА рд╣реИрдВ: рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ, рдЖрдзрд╛рд░ рд░реЗрдЦрд╛, рдкрд╛рда рдХреЗ рдЖрд░рдВрдн рдФрд░ рдЕрдВрдд рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдЖрджрд┐ред  (рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд▓реЗрдЦрди</a> рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ) </p><br><p>  рдЗрд╕ рддрд░рд╣ рдХреЗ рддрд░реАрдХреЗ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреБрдЫ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рдкрд╛рда рдХреЗ рднрд╛рдЧ рдХреЛ рдЧреЛрд▓ рдЖрдпрддреЛрдВ рдореЗрдВ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рдХрд╛рд░реНрдп рдХреЗ рд╕рд╛рде рд╕рд╛рдордирд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдореЗрдВ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╕реНрдкреИрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕рдХрд╛ рд╕рдорд╛рдзрд╛рди рдЦреЛрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8b/-2/df/8b-2df4-wo4ghk8tkwss6l48bfy.png" width="300"></div><br><p>  рд▓реЗрдХрд┐рди рд▓реЗрдЖрдЙрдЯ рд╡рд░реНрдЧ рдХреЗ рддрд░реАрдХреЗ рдмрдЪрд╛рд╡ рдореЗрдВ рдЖ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣рд╛рдБ рдПрдХ рдирдореВрдирд╛ рд╕рдорд╛рдзрд╛рди рд╣реИ: </p><br><p>  рдПрдиреЛрдЯреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдЙрди рд╢рдмреНрджреЛрдВ рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдпрддреЛрдВ рдореЗрдВ рдкрд░рд┐рдЪрд╛рд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><p>  рдлрд┐рд░ рдкрд╛рда рд░реИрдкрд┐рдВрдЧ рдХреЗ рд╕рднреА рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП 4 рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╕рдВрд╕рд╛рдзрди рдмрдирд╛рдПрдВ, рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдпрддреЛрдВ рдореЗрдВ рд╕рдВрд▓рдЧреНрди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q4/ry/oj/q4ryojq_lsj3sdyyehvprallpl8.png" width="600"></div><br><p>  рдЗрд╕рдХреЗ рдмрд╛рдж, рд╣рдо рдкрд╛рда рдореЗрдВ рдЬрд┐рди рдПрдиреЛрдЯреЗрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд╡реЗ рдКрдкрд░ рд╡рд░реНрдгрд┐рдд рд╣реИрдВред  рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрд╕ рддрд░рд╣ рдХреЗ рдПрдиреЛрдЯреЗрд╢рди рдХреА рд╢реБрд░реБрдЖрдд рдФрд░ рдЕрдВрдд рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рд╣реИрдВред  рд▓реЗрдЖрдЙрдЯ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдЖрдк рдЙрд╕ рдкрдВрдХреНрддрд┐ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕ рдкрд░ рдПрдиреЛрдЯреЗрдЯ рдкрд╛рда рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдЬрд┐рд╕ рдкрд░ рдпрд╣ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> startLine = layout.getLineForOffset(spanStartIndex) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> endLine = layout.getLineForOffset(spanEndIndex)</code> </pre> <br><p>  рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рдПрдХ рдпрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдЖрдпрддреЗрдВ рдЦреАрдВрдЪрдиреА рд╣реЛрдВрдЧреАред  рд╕рд╛рдзрд╛рд░рдг рдорд╛рдорд▓реЗ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ рдЬрдм рдкрд╛рда рдХрд╛ рдПрдиреЛрдЯреЗрдЯ рднрд╛рдЧ рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдЪрд╛рд░ рдЧреЛрд▓ рдХреЛрдиреЛрдВ рдХреЗ рд╕рд╛рде рдХреЗрд╡рд▓ рдПрдХ рдЖрдпрдд рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЗрд╕рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ рдФрд░ рдбреНрд░рд╛ рдХрд░реЗрдВ: </p><br><pre> <code class="kotlin hljs">... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (startLine == endLine) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lineTop = layout.getLineTop(startLine) <span class="hljs-comment"><span class="hljs-comment">//    val lineBottom = layout.getLineBottom(startLine) //    val startCoor = layout.getPrimaryHorizontal(spanStartIndex).toInt() //    val endCoor = layout.getPrimaryHorizontal(spanEndIndex).toInt() //    //   drawable.setBounds(startCoor, lineTop, endCoor, lineBottom) drawable.draw(canvas) ...</span></span></code> </pre><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рд╕реЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдЖрдЙрдЯ рдкреНрд░рджрд░реНрд╢рд┐рдд рдкрд╛рда рдкрд░ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рд╡рд┐рднрд┐рдиреНрди рдЧреИрд░-рдорд╛рдирдХ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИред </p><br><h1 id="proizvoditelnost-textview">  TextView рдкреНрд░рджрд░реНрд╢рди </h1><br><p>  <code>onMeasure()</code> рд╡реНрдпреВ, рдХрд┐рд╕реА рднреА рджреГрд╢реНрдп рдХреА рддрд░рд╣, рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрдиреЗ рдкрд░ рддреАрди рдЪрд░рдгреЛрдВ рд╕реЗ <code>onMeasure()</code> : <code>onMeasure()</code> , <code>onLayout()</code> рдФрд░ <code>onLayout()</code> <code>onDraw()</code> ред  рдЙрд╕реА рд╕рдордп, <code>onMeasure()</code> рдХреЛ рдЕрдиреНрдп рджреЛ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдордп рд▓рдЧрддрд╛ рд╣реИ: рдЗрд╕ рд╕рдордп, рд▓реЗрдЖрдЙрдЯ рд╡рд░реНрдЧ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдкрд╛рда рдЖрдХрд╛рд░ рдХреА рдЧрдгрдирд╛ рдХреА рдЬрд╛рддреА рд╣реИред  рдЗрд╕рд▓рд┐рдП рдкрд╛рда рдХрд╛ рдЖрдХрд╛рд░ рдмрджрд▓рдирд╛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдлрд╝реЙрдиреНрдЯ рдмрджрд▓рдирд╛) рдмрд╣реБрдд рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рдкрд╛рда рдХрд╛ рд░рдВрдЧ рдмрджрд▓рдирд╛ рдЕрдзрд┐рдХ рд╣рд▓реНрдХрд╛ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рдХреЗрд╡рд▓ <code>onDraw()</code> рдХреЙрд▓рд┐рдВрдЧ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЧрдгрдирд╛ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде рдПрдХ рд╡реИрд╢реНрд╡рд┐рдХ рд╢рдмреНрдж рдХреИрд╢ рд╣реИред  рдпрджрд┐ рд╢рдмреНрдж рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХреИрд╢ рдореЗрдВ рд╣реИ, рддреЛ рдЗрд╕рдХреЗ рд▓рд┐рдП <code>onMeasure()</code> рдХреЙрд▓ рдХрд░рдиреЗ рдкрд░ рдЙрд╕ рд╕рдордп рдХрд╛ 11-16% рд▓рдЧреЗрдЧрд╛ рдЬреЛ рдПрдХ рдкреВрд░реНрдг рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдерд╛ред </p><br><h2 id="uskorenie-pokaza-teksta">  рдкрд╛рда рддреНрд╡рд░рдг </h2><br><p>  2015 рдореЗрдВ, рдЗрдВрд╕реНрдЯрд╛рдЧреНрд░рд╛рдо рдбреЗрд╡рд▓рдкрд░реНрд╕ рдиреЗ рд╡реИрд╢реНрд╡рд┐рдХ рдХреИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рддрд╕реНрд╡реАрд░реЛрдВ рдкрд░ рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рддреЗрдЬ рдХрд┐рдпрд╛ред  рдпрд╣ рд╡рд┐рдЪрд╛рд░ рд╡рд╕реНрддреБрддрдГ рдкрд╛рда рдХреЛ рд╕реНрдХреНрд░реАрди рдкрд░ рджрд┐рдЦрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЦреАрдВрдЪрдирд╛ рдерд╛, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕рд┐рд╕реНрдЯрдо рдХреИрд╢ рдХреЛ "рд╡рд╛рд░реНрдорд┐рдВрдЧ рдЕрдк" рдХрд░рддрд╛ рд╣реИред  рдЬрдм рдпрд╣ рдкрд╛рда рджрд┐рдЦрд╛рдиреЗ рдХрд╛ рд╕рдордп рдерд╛, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдиреЗ рдЗрд╕реЗ рдмрд╣реБрдд рддреЗрдЬреА рд╕реЗ рджреЗрдЦрд╛, рдХреНрдпреЛрдВрдХрд┐ рдкрд╛рда рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдорд╛рдкрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдХреИрд╢ рдореЗрдВ рдерд╛ред </p><br><p>  <strong>рдПрдВрдбреНрд░реЙрдЗрдб рдкреА (28) рдХреЗ</strong> рд╕рд╛рде рд╢реБрд░реВ, Google рдбреЗрд╡рд▓рдкрд░реНрд╕ рдиреЗ рдПрдкреАрдЖрдИ рдХреЛ рдкреГрд╖реНрдарднреВрдорд┐ рдХреЗ рдзрд╛рдЧреЗ рдореЗрдВ рдЕрдЧреНрд░рд┐рдо рдореЗрдВ рдЯреЗрдХреНрд╕реНрдЯ рдЖрдХрд╛рд░ рдХреЛ рдорд╛рдкрдиреЗ рдХреЗ рдЪрд░рдг рдХреЛ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рд╣реИ - <code>PrecomputedText</code> (рдФрд░ <strong>Android I (14)</strong> - <code>PrecomputedTextCompat</code> рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдПрдкреАрдЖрдИ рдХреЗ рд▓рд┐рдП рдмреИрдХрдкреЛрд░реНрдЯ)ред  рдирдИ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, 90% рдХрд╛рдо рдкреГрд╖реНрдарднреВрдорд┐ рдереНрд░реЗрдб рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рдПрдХ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// UI thread val params: PrecomputedText.Params = textView.getTextMetricsParams() val ref = WeakReference(textView) executor.execute { // background thread val text = PrecomputedText.create("Hello", params) val textView = ref.get() textView?.post { // UI thread val textView = ref.get() textView?.text = text } }</span></span></code> </pre> <br><h2 id="pokaz-bolshogo-teksta">  рдмрдбрд╝рд╛ рдкрд╛рда рджрд┐рдЦрд╛рдУ </h2><br><p>  рдпрджрд┐ рдЖрдкрдХреЛ рдмрдбрд╝рд╛ рдкрд╛рда рджрд┐рдЦрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рддреБрд░рдВрдд рдПрдХ TextView рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рди рдХрд░реЗрдВред  рдЕрдиреНрдпрдерд╛, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реБрдЪрд╛рд░реВ рд░реВрдк рд╕реЗ рдпрд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рдирд╛ рдмрдВрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╡рд┐рд╢рд╛рд▓ рдкрд╛рда рдХреЛ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп рдереНрд░реЗрдб рдкрд░ рдмрд╣реБрдд рдХрд╛рдо рдХрд░реЗрдЧрд╛ рдЬрд┐рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдВрдд рддрдХ рд╕реНрдХреНрд░реЙрд▓ рднреА рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рд╕рдорд╛рдзрд╛рди рдкрд╛рда рдХреЛ рднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ рд╣реИ (рдЬреИрд╕реЗ рдкреИрд░рд╛рдЧреНрд░рд╛рдл) рдФрд░ RecyclerView рдореЗрдВ рд╡реНрдпрдХреНрддрд┐рдЧрдд рднрд╛рдЧреЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдирд╛ рд╣реИред  рдФрд░ рднреА рдЕрдзрд┐рдХ рд╕реНрдкреАрдбрдЕрдк рдХреЗ рд▓рд┐рдП, рдЖрдк PrecomputedText рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯреЗрдХреНрд╕реНрдЯ рдмреНрд▓реЙрдХ рдХреЗ рдЖрдХрд╛рд░ рдХреА рдкреВрд░реНрд╡-рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  RecyclerView рдореЗрдВ PrecomputedText рдХреА рдПрдореНрдмреЗрдбрд┐рдВрдЧ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП, Google рдбреЗрд╡рд▓рдкрд░реНрд╕ рдиреЗ <code>PrecomputedTextCompat.getTextFuture()</code> рдФрд░ <code>AppCompatTextView.setTextFuture()</code> рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рддрд░реАрдХреЗ рдмрдирд╛рдПред </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vh: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = getData(position) vh.textView.setTextSize(...) vh.textView.setFontVariationSettings(...) <span class="hljs-comment"><span class="hljs-comment">//    val future = PrecomputedTextCompat.getTextFuture( data.text, vh.textView.getTextMetricsParamsCompat(), myExecutor ) //  future  TextView,      onMeasure() vh.textView.setTextFuture(future) }</span></span></code> </pre> <br><p>   RecyclerView      ,     ,              ,     . </p><br><p>  ,     <code>getTextFuture()</code>     (,   ),     ,   ,    <code>getTextFuture()</code> ,     ,    TextView. </p><br><h2 id="chto-nuzhno-znat-kogda-ustanavlivaesh-tekst-v-textview">   ,     TextView </h2><br><p>    <code>TextView.setText()</code>       : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type == SPANNABLE || movementMethod != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { text = spannableFactory.newSpannable(spannable) <span class="hljs-comment"><span class="hljs-comment">//  } else { text = new SpannedString(spannable) //  }</span></span></code> </pre> <br><p>       span'  TextView,       <code>setText()</code> ,      . </p><br><p>    ,      .  TextView    ,  -,   .    ,      .    ,    ,     TextView   <code>spannableFactory</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MySpannableFactory</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Spannable.Factory</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newSpannable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CharSequence</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Spannable { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? Spannable ?: <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.newSpannable(source) } } textView.spannableFactory = MySpannableFactory()</code> </pre> <br><p>         <code>textView.setText(spannable, BufferType.SPANNABLE)</code> ,      . </p><br><p>  Google         span'  RecyclerView,      . </p><br><p>      TextView,     span,        <code>setText()</code> .      TextView      span. TextView   spannable-    span',  : </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spannable = textView.getText() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Spannable <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> span = CustomTypefaceSpan(span) spannable.setSpan(span, ...)</code> </pre> <br><p>      span,      TextView,         TextView .       ,   <code>invalidate()</code> ,    тАУ <code>requestLayout()</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spannable = textView.getText() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Spannable <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> span = CustomTypefaceSpan(span) spannable.setSpan(span, ...) span.setTypeface(anotherTypeface) textView.requestLayout() <span class="hljs-comment"><span class="hljs-comment">// re-measure and re-draw // or textView.invalidate() // re-draw</span></span></code> </pre> <br><h2 id="ispolzovanie-autolink">  autoLink </h2><br><p>  TextView     .         <code>autoLink</code> .   <code>autoLink=тАЭwebтАЭ</code> TextView          URL          <code>URLSpan</code> .   ,     SDK   <code>setText()</code> : </p><br><pre> <code class="java hljs">spannable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpannableString(string); Matcher m = pattern.matcher(text); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (...) { <span class="hljs-comment"><span class="hljs-comment">//      String utl = тАж URLSpan span = new URLSpan(url); spannable.setSpan(span, ...); }</span></span></code> </pre> <br><p>      UI ,     <code>autoLink=тАЭwebтАЭ</code>   RecyclerView.          .        <code>LinkifyCompat</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,       background thread val spannable = SpannableString(string) LinkifyCompat.addLinks(spannable, Linkify.WEB_URLS) //   RecyclerView override fun onBindViewHolder(holder: ViewHolder, position: Int) { holder.textView.setText(spannable, BufferType.SPANNABLE) // ... }</span></span></code> </pre> <br><p>  <code>autoLink</code>      <code>map</code> тАУ    (      <code>all</code> ).       .   ,        WebView,      !    SDK   <code>Linkify.gatherMapLinks()</code>    ,      : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((address = WebView.findAddress(string)) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ... }</code> </pre> <br><p>   WebView  TODO   SDK: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String addr)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Rewrite this in Java so it is not needed to start up chromium // Could also be deprecated return getFactory().getStatics().findAddress(addr); }</span></span></code> </pre> <br><p>     ?     Smart Linkify,       <strong>Android P (28)</strong> ,          ,      .    : </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// UI thread val text: Spannable = тАж val request = TextLinks.Request.Builder(text) val ref = WeakReference(textView) executor.execute { // background thread TextClassifier.generateLinks(request).apply(text) val textView = ref.get() textView?.post { // UI thread val textView = ref.get() textView?.text = text } }</span></span></code> </pre> <br><p>    Linkify,      .        toolbar   ,     Google . </p><br><p>  Smart Linkify    :  ,    . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9t/nc/qb/9tncqbkanp8avsnmisd-ax0z7ae.gif" width="300"></div><br><h1 id="magnifier"> Magnifier </h1><br><p>   <strong>Android P (28)</strong> ,     тАУ Magnifier,       .           . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fi/nn/or/finnor2svtuttfn1v-lxwkblgwm.gif" width="400"></div><br><p>      TextView, EditText  WebView,            :  API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> . </p><br><h1 id="zaklyuchenie">  рдирд┐рд╖реНрдХрд░реНрд╖ </h1><br><p>          Android   ,   , : </p><br><ul><li>         </li><li>    </li><li>   ,   TextView (, EditText) </li></ul><br><p>  -     ,      Google I/O'19 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">тАЬBest Practices for Using Text in AndroidтАЭ</a> . </p><br><a name="links"></a><br><h1 id="poleznye-ssylki">  рдЙрдкрдпреЛрдЧреА рд▓рд┐рдВрдХ </h1><br><h2 id="stati">  </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Florina Muntenescu. "Spantastic text styling with Spans"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Florina Muntenescu. "Underspanding spans"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Florina Muntenescu. "Styling internationalized text in Android"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Instagram Engineering. "Improving Comment Rendering on Android"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Daniel Lee. "Text rendering on Android"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Mariusz D─Еbrowski. "What is new in Android P тАФ PrecomputedText"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Chet Haase. "RecyclerView Prefetch"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Chris Craik. "Prefetch Text Layout in RecyclerView"</a> </li></ul><br><h2 id="doklady">  рд░рд┐рдкреЛрд░реНрдЯ </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Best practices for text on Android (Google I/O '18)</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Use Android Text Like a Pro (Android Dev Summit '18)</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Best Practices for Using Text in Android (Google I/O'19)</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi461787/">https://habr.com/ru/post/hi461787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi461773/index.html">Airtest IDE - рдореЛрдмрд╛рдЗрд▓ рдЧреЗрдо рдХреЗ рд╕реНрд╡рдЪрд╛рд▓рди рдХреЗ рдкрд░реАрдХреНрд╖рдг рдХрд╛ рдПрдХ рдирдпрд╛ рддрд░реАрдХрд╛?</a></li>
<li><a href="../hi461775/index.html">рдПрдХ Django рдЖрд╡реЗрджрди рдореЗрдВ рдЕрдЬрд╡рд╛рдЗрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 3 рдорд╛рдорд▓реЗ</a></li>
<li><a href="../hi461779/index.html">рдЖрдкрдХреЗ рдХрдВрдкрдиреА рдХрд╛ 80% рдбреЗрдЯрд╛ рдЖрдкрдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ?</a></li>
<li><a href="../hi461781/index.html">"рдпреЙрдореНрдмрд┐рдиреЗрдЯрд░ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рд╕реНрдХреВрд▓ 2019ред" рдкрд╣рд▓реЗ рддреАрди рд╣рдлреНрддреЛрдВ рдХрд╛ рд╡реАрдбрд┐рдпреЛ</a></li>
<li><a href="../hi461785/index.html">рдЖрд░рдЖрдИрдПрд╕рд╕реА-рд╡реА рдиреБрдХрд╕рд╛рди</a></li>
<li><a href="../hi461793/index.html">Jug.msk.ru рдмреИрдардХ рдореЗрдВ рдХрд╛рдлреНрдХрд╛ рд╕реНрдЯреНрд░реАрдо рдПрдкреАрдЖрдИ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЗрд╡рд╛рди рдкрд┐рдВрдбреЛрдореЗрд░реЗрд╡</a></li>
<li><a href="../hi461797/index.html">рд╕реЗрд╡рд╛ рдХреЗ рдХрд┐рд╕реНрд╕реЗред рдЧрдВрднреАрд░ рдХрд╛рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рддреБрдЪреНрдЫ рдкреЛрд╕реНрдЯ</a></li>
<li><a href="../hi461801/index.html">DisplayPort-LVDS</a></li>
<li><a href="../hi461803/index.html">рдбреЗрдЯрд╛ рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдпрдВрддреНрд░рдг (DVC): рдбреЗрдЯрд╛ рд╕рдВрд╕реНрдХрд░рдг рдФрд░ рдкреНрд░рдпреЛрдЧ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдпреЛрдЧреНрдпрддрд╛</a></li>
<li><a href="../hi461805/index.html">рд░реЗрдВрдбрд░рд┐рдВрдЧ рдореЗрдВ рдореЛрдВрдЯреЗ рдХрд╛рд░реНрд▓реЛ рдПрдХреАрдХрд░рдг рдЕрдиреБрдкреНрд░рдпреЛрдЧ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>