<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêè üåÆ üåã Exibi√ß√£o de texto Android üï∫üèº üèáüèø üë©üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A exibi√ß√£o de informa√ß√µes textuais √© provavelmente a parte mais b√°sica e importante de muitos aplicativos Android. Este artigo ir√° falar sobre o TextV...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Exibi√ß√£o de texto Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redmadrobot/blog/461787/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/mc/2_/_o/mc2__o7rq1m6ex9alol6ivz5vey.png"></div><br><p>  A exibi√ß√£o de informa√ß√µes textuais √© provavelmente a parte mais b√°sica e importante de muitos aplicativos Android.  Este artigo ir√° falar sobre o TextView.  Todo desenvolvedor, come√ßando com "Hello World", √© constantemente confrontado com esse elemento da interface do usu√°rio.  De tempos em tempos, ao trabalhar com texto, voc√™ precisa pensar em implementar v√°rias solu√ß√µes de design ou melhorar o desempenho ao renderizar a tela. </p><br><p>  Vou falar sobre o dispositivo TextView e algumas sutilezas de trabalhar com ele.  Dicas importantes foram tiradas de relat√≥rios de E / S anteriores do Google. </p><a name="habracut"></a><br><h1 id="textview-pod-kapotom">  TextView sob o cap√¥ </h1><br><p>  Para renderizar texto no Android, uma pilha inteira de bibliotecas diferentes √© usada sob o cap√¥.  Eles podem ser divididos em duas partes principais - c√≥digo java e c√≥digo nativo: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hb/p0/gg/hbp0ggycnpeisn8v8hwyqkkmvfq.png" width="800"></div><br><p>  O c√≥digo Java √© essencialmente parte do Android SDK dispon√≠vel para desenvolvedores de aplicativos e novos recursos podem ser portados para a biblioteca de suporte. </p><br><p>  O n√∫cleo do TextView em si √© escrito em C ++, o que limita a migra√ß√£o para a biblioteca de suporte de novos recursos implementados l√° a partir de novas vers√µes do sistema operacional.  O n√∫cleo s√£o as seguintes bibliotecas: </p><br><ul><li>  Minikin √© usado para medir o comprimento do texto, quebras de linha e palavras por s√≠labas. </li><li>  A UTI fornece suporte Unicode. </li><li>  O HarfBuzz encontra para caracteres Unicode os elementos gr√°ficos correspondentes (glifos) nas fontes. </li><li>  O FreeType cria bitmaps de glifos. </li><li>  Skia √© um mecanismo para desenhar gr√°ficos 2D. </li></ul><br><h2 id="izmerenie-dliny-teksta-i-perenos-strok">  Medindo o comprimento do texto e as quebras de linha </h2><br><p>  Se voc√™ passar a linha para a biblioteca Minikin, que √© usada dentro do TextView, a primeira coisa que determina √© em quais glifos a linha consiste: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qt/1o/uk/qt1ouktu4gn9x0wncbgiy2a7qkg.png" width="800"></div><br>
<p> Como voc√™ pode ver neste exemplo, a correspond√™ncia de caracteres Unicode com glifos nem sempre ser√° um para um: aqui, tr√™s caracteres de uma vez corresponder√£o a um glifo ffi.  Al√©m disso, vale a pena prestar aten√ß√£o que os glifos necess√°rios podem ser encontrados em v√°rias fontes do sistema. </p><br><p>  Encontrar glifos apenas nas fontes do sistema pode levar a dificuldades, especialmente se √≠cones ou emojis s√£o exibidos por meio de caracteres, e √© suposto combinar caracteres de fontes diferentes em uma linha.  Portanto, a partir do <strong>Android Q (29)</strong> , tornou-se poss√≠vel criar sua pr√≥pria lista de fontes que acompanham o aplicativo.  Esta lista ser√° usada para procurar glifos: </p><br><pre> <code class="kotlin hljs">textView.typeface = TypeFace.CustomFallbackBuilder( FontFamily.Builder( Font.Builder(assets, ‚Äúlato.ttf‚Äù).build() ).build() ).addCustomFallback( FontFamily.Builder( Font.Builder(assets, ‚Äúkosugi.ttf‚Äù).build() ).build() ).build()</code> </pre> <br><p>  Agora, usando <code>CustomFallbackBuilder</code> ao combinar caracteres com glifos, o SDK <code>CustomFallbackBuilder</code> na fam√≠lia de fontes especificada em ordem e, se n√£o puder ser encontrado, a pesquisa continuar√° nas fontes do sistema (e atrav√©s do m√©todo <code>setSystemFallback()</code> , voc√™ pode especificar a fam√≠lia de fontes preferida do sistema).  <code>CustomFallbackBuilder</code> tem um limite no n√∫mero de fam√≠lias de fontes - voc√™ pode adicionar n√£o mais que 64 fontes. </p><br><p>  A biblioteca Minikin divide seq√º√™ncias de caracteres em palavras e mede palavras individuais.  Para acelerar o trabalho, come√ßando com <strong>Lollipop (21)</strong> , √© usado um cache de palavras <abbr title="menos usado recentemente">LRU do</abbr> sistema.  Esse cache fornece um enorme ganho de desempenho: uma chamada para <code>Paint.measureText()</code> para uma palavra em cache levar√° em m√©dia 3% do tempo que calcula seu tamanho pela primeira vez. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d2/f1/om/d2f1omfjlqmmfqalip3whmes-1o.png" width="800"></div><br><p>  Se o texto n√£o corresponder √† largura especificada, o Minikin organizar√° quebras de linha e palavras no texto.  Come√ßando com <strong>Marshmallow (23),</strong> voc√™ pode controlar seu comportamento especificando os atributos especiais <code>breakStrategy</code> e <code>breakStrategy</code> para o TextView. </p><br><p>  Com o valor <code>breakStrategy=simple</code> biblioteca simplesmente organiza h√≠fens sequencialmente, passando pelo texto: assim que a linha deixa de se ajustar, a hifeniza√ß√£o √© colocada antes da √∫ltima palavra. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/im/lc/cr/imlccruuhjr59qzrtpwjmrf6hhk.png" width="600"></div><br><p>  No valor <code>balanced</code> biblioteca tentar√° fazer quebras de linha para que as linhas estejam alinhadas em largura. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v5/ys/kc/v5yskcuiwypdyponmrdqep7zaq8.png" width="600"></div><br><p>  <code>high_quality</code> tem quase o mesmo comportamento que o <code>balanced</code> , com exce√ß√£o de algumas diferen√ßas (uma delas: na pen√∫ltima linha, a hifeniza√ß√£o pode ser n√£o apenas palavras separadas, mas tamb√©m palavras por s√≠labas). </p><br><p>  O atributo <code>hyphenationFrequency</code> permite controlar a estrat√©gia de quebra de linha por s√≠labas.  Um valor <code>none</code> n√£o far√° hifeniza√ß√£o autom√°tica, <code>normal</code> far√° uma pequena frequ√™ncia de hifeniza√ß√£o e <code>full</code> , consequentemente, usar√° o n√∫mero m√°ximo de palavras. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/cr/hs/ngcrhsphklaxxe842klpnx8mhnw.png" width="600"></div><br><p>  Desempenho da renderiza√ß√£o de texto dependendo dos sinalizadores selecionados (medidos no <strong>Android P (28)</strong> ): </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tx/5r/33/tx5r339s93s1nq6go8hieqhv6fq.png" width="600"></div><br><p>  Dado um desempenho bastante forte, os desenvolvedores do Google, come√ßando com a vers√£o <strong>Q (29)</strong> e <strong>AppCompat 1.1.0</strong> , decidiram desativar a hifeniza√ß√£o por padr√£o.  Se a quebra de linha √© importante no aplicativo, agora voc√™ precisa habilit√°-lo explicitamente. </p><br><p>  Ao usar a quebra de linha, √© necess√°rio levar em considera√ß√£o que o idioma atualmente selecionado no sistema operacional afetar√° a opera√ß√£o da biblioteca.  Dependendo do idioma, o sistema selecionar√° dicion√°rios especiais com regras de transfer√™ncia. </p><br><h1 id="stili-teksta">  Estilos de texto </h1><br><p>  Existem v√°rias maneiras de estilizar o texto no Android: </p><br><ul><li>  <strong>Um estilo √∫nico</strong> que se aplica a todo o elemento TextView. </li><li>  <strong>Estilo m√∫ltiplo (estilo m√∫ltiplo)</strong> - v√°rios estilos de uma s√≥ vez, que podem ser aplicados ao texto, no n√≠vel do par√°grafo ou dos caracteres individuais.  Existem v√°rias maneiras de fazer isso: <br><ul><li>  desenho de texto em tela </li><li>  tags html </li><li>  elementos de marca√ß√£o especiais - v√£os </li></ul></li></ul><br><p>  Um √∫nico estilo implica o uso de estilos XML ou atributos XML na marca√ß√£o TextView.  Nesse caso, o sistema aplicar√° os valores dos recursos na seguinte ordem: Apar√™ncia de texto, tema (Tema), estilo padr√£o (estilo padr√£o), estilo do aplicativo e a prioridade mais alta ser√£o os valores dos atributos Exibir. </p><br><p>  Usar recursos √© uma solu√ß√£o bastante simples, mas, infelizmente, n√£o permite aplicar estilo a partes do texto. </p><br><p>  As tags HTML s√£o outra solu√ß√£o simples que fornece recursos como tornar as palavras individuais em negrito, it√°lico ou at√© destacar listas com pontos no texto.  Tudo o que o desenvolvedor precisa √© fazer uma chamada para o m√©todo <code>Html.fromHtml()</code> , que transformar√° o texto marcado em texto marcado por extens√µes.  Mas essa solu√ß√£o possui recursos limitados, pois reconhece apenas parte das tags html e n√£o suporta estilos CSS. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = <span class="hljs-string"><span class="hljs-string">"My text &lt;ul&gt;&lt;li&gt;bullet one&lt;/li&gt;&lt;li&gt;bullet two&lt;/li&gt;&lt;/ul&gt;"</span></span> myTextView.text = Html.fromHtml(text)</code> </pre> <br><p>  V√°rios m√©todos de estilo do TextView podem ser combinados, mas vale lembrar a prioridade de um m√©todo espec√≠fico, o que afetar√° o resultado final: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zm/hr/hl/zmhrhluqvvcv77s1b85gkxbtcww.png" width="400"></div><br><p>  Outra maneira - desenhar texto na tela - fornece ao desenvolvedor controle total sobre a sa√≠da de texto: por exemplo, voc√™ pode desenhar texto ao longo de uma linha curva.  Mas essa solu√ß√£o, dependendo dos requisitos, pode ser bastante dif√≠cil de implementar e est√° al√©m do escopo deste artigo. </p><br><h1 id="spans">  V√£os </h1><br><p>  O TextView usa extens√µes para ajustar estilos.  Usando extens√µes, voc√™ pode alterar a cor de um intervalo de caracteres, formar parte do texto como links, alterar o tamanho do texto, desenhar um ponto na frente de um par√°grafo etc. </p><br><p>  As seguintes categorias de extens√µes podem ser distinguidas: </p><br><ul><li>  <strong>Intervalo de caracteres</strong> - aplicado no n√≠vel de caractere de uma sequ√™ncia. <br><ul><li>  <strong>Apar√™ncia afetando</strong> - n√£o altere o tamanho do texto. </li><li>  <strong>M√©trica afetando</strong> - redimensione o texto. </li></ul></li><li>  <strong>Intervalo de par√°grafos</strong> - aplicado no n√≠vel do par√°grafo. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zy/os/x2/zyosx2ovroe15y3bd94qridaaou.png"></div><br><p>  A estrutura do Android possui interfaces e classes abstratas com m√©todos chamados durante <code>onMeasure()</code> e renderiza√ß√£o do TextView, esses m√©todos d√£o a extens√µes de acesso a objetos de n√≠vel inferior como <code>TextPaint</code> e <code>Canvas</code> .  Usando a extens√£o, a estrutura do Android verifica quais interfaces esse objeto implementa para chamar os m√©todos necess√°rios. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fv/do/er/fvdoerpx8zxykjxvt9ru4kigica.png" width="600"></div><br><p>  A estrutura do Android define mais de 20 extens√µes, portanto, antes de criar o seu, √© melhor verificar se o SDK √© adequado. </p><br><h3 id="appearance-vs-metric-affecting-spans">  Apar√™ncia versus m√©trica que afeta os intervalos </h3><br><p>  A primeira categoria de extens√µes afeta a apar√™ncia dos caracteres na sequ√™ncia: cor do caractere, cor do plano de fundo, caracteres sublinhados ou riscados, etc.  Essas extens√µes implementam a interface <code>UpdateAppearance</code> e herdam da classe <code>CharacterStyle</code> , que fornece acesso ao objeto <code>TextPaint</code> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/or/8f/zl/or8fzltp5mvoyhvdey8tz1uoqhg.png"></div><br><p>  A m√©trica que afeta o span afeta o tamanho do texto e do layout; portanto, o uso de um span requer n√£o apenas redesenhar o TextView, mas tamb√©m a chamada <code>onMeasure()</code> / <code>onLayout()</code> .  Essas extens√µes geralmente s√£o herdadas da classe <code>MetricAffectingSpan</code> , que herda do <code>CharacterStyle</code> mencionado acima. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_h/hs/hd/_hhshd0pcadvdievngojmtsqzlu.png"></div><br><h2 id="character-vs-paragraph-affecting-spans">  Caractere vs par√°grafo que afeta os intervalos </h2><br><p>  A extens√£o do par√°grafo afeta todo um bloco de texto: ele pode alterar o alinhamento, o recuo ou at√© mesmo inserir um ponto no in√≠cio de um par√°grafo.  Tais extens√µes devem ser herdadas da classe <code>ParagraphStyle</code> e inseridas no texto exatamente do in√≠cio ao fim.  Se o intervalo estiver incorreto, o intervalo n√£o funcionar√°. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/76/_n/uj/76_nujhr8rrwz-mne8bgq8p2pfu.png"></div><br><p>  No Android, os par√°grafos s√£o considerados parte do texto separado por novas linhas ( <code>\n</code> ). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s1/p1/kq/s1p1kq9esdaakdpwh_rkxdvdygw.png"></div><br><h2 id="napisanie-svoih-spanov">  Escrevendo seus v√£os </h2><br><p>  Ao escrever seus pr√≥prios per√≠odos, voc√™ precisa decidir o que o per√≠odo afetar√° para escolher de qual classe herdar: </p><br><ul><li>  Afeta o texto no n√≠vel do caractere -&gt; <code>CharacterStyle</code> </li><li>  Afeta o texto no n√≠vel do par√°grafo -&gt; <code>ParagraphStyle</code> </li><li>  Afeta a exibi√ß√£o de texto ‚Üí <code>UpdateAppearance</code> </li><li>  Afeta o tamanho do texto - <code>UpdateLayout</code> </li></ul><br><p>  Aqui est√° um exemplo de extens√£o para alterar a fonte: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomTypefaceSpan</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> font: Typeface?) : MetricAffectingSpan() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateMeasureState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = update(textPaint) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateDrawState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = update(textPaint) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { textPaint.apply { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> old = typeface <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> oldStyle = old?.style ?: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> font = Typeface.create(font, oldStyle) typeface = font <span class="hljs-comment"><span class="hljs-comment">//    } } }</span></span></code> </pre> <br><p>  Imagine que queremos criar nosso pr√≥prio per√≠odo para destacar os blocos de c√≥digo, para isso editaremos o per√≠odo anterior - depois de adicionar a fonte, tamb√©m adicionaremos uma altera√ß√£o na cor de fundo do texto: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CodeBlockSpan</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> font: Typeface?) : MetricAffectingSpan() { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(textPaint: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TextPaint</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { textPaint.apply { <span class="hljs-comment"><span class="hljs-comment">//    ‚Ä¶ bgColor = lightGray //    } } }</span></span></code> </pre> <br><p>  Aplique a extens√£o ao texto: </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//    span spannable.setSpan(CodeBlockSpan(typeface), ...)</span></span></code> </pre> <br><p>  Mas voc√™ pode obter exatamente o mesmo resultado combinando duas extens√µes: pegue nosso <code>CustomTypefaceSpan</code> e <code>BackgroundColorSpan</code> anterior na estrutura do Android: </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//    spannable.setSpan(BackgroundColorSpan(lightGray), ...) //   spannable.setSpan(CustomTypefaceSpan(typeface), ...)</span></span></code> </pre> <br><p>  Essas duas solu√ß√µes ter√£o uma diferen√ßa.  O fato √© que as extens√µes auto-escritas n√£o podem implementar a interface <code>Parcelable</code> , diferente das do sistema. </p><br><p>  Ao transmitir uma linha estilizada atrav√©s do Intent ou da √°rea de transfer√™ncia, no caso de um intervalo de marca√ß√£o auto-escrita, n√£o ser√° salva.  Ao usar extens√µes da estrutura, a marca√ß√£o permanecer√°. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/is/nw/uu/isnwuux9cosllp6h0kgawifcepo.png" width="600"></div><br><h2 id="ispolzovanie-spanov-v-tekste">  Usando extens√µes no texto </h2><br><p>  Existem duas interfaces para texto estilizado na estrutura: <code>Spannable</code> e <code>Spannable</code> (com marca√ß√£o inalterada e mut√°vel, respectivamente) e tr√™s implementa√ß√µes: <code>SpannedString</code> (texto inalterado), <code>SpannableString</code> (texto inalterado) e <code>SpannableStringBuilder</code> (texto mut√°vel). </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Texto mut√°vel </th><th>  Marca√ß√£o vari√°vel </th></tr></thead><tbody><tr><td>  String <strong>estendida</strong> </td><td>  n√£o </td><td>  n√£o </td></tr><tr><td>  <strong>Cadeia de</strong> caracteres <strong>spannable</strong> </td><td>  n√£o </td><td>  sim </td></tr><tr><td>  Construtor <strong>Spannablestring</strong> </td><td>  sim </td><td>  sim </td></tr></tbody></table></div><br><p>  <code>SpannableStringBuilder</code> , por exemplo, √© usado dentro de um <code>EditText</code> que precisa alterar o texto. </p><br><p>  Voc√™ pode adicionar um novo per√≠odo a uma linha usando o m√©todo: </p><br><p> <code>setSpan(Object what, int start, int end, int flags)</code> </p> <br><p>  A extens√£o √© passada pelo primeiro par√¢metro e, em seguida, o intervalo de √≠ndices no texto √© indicado.  E o √∫ltimo par√¢metro pode ser controlado, qual ser√° o comportamento do per√≠odo ao inserir um novo texto: se o per√≠odo se espalhar√° para o texto inserido no ponto inicial ou final (se voc√™ inserir um novo texto no meio, o per√≠odo ser√° aplicado automaticamente, independentemente dos valores do sinalizador) . </p><br><p>  As classes listadas acima diferem n√£o apenas semanticamente, mas tamb√©m na forma como s√£o organizadas internamente: <code>SpannedString</code> e <code>SpannableString</code> usam matrizes para armazenar extens√µes, e <code>SpannableStringBuilder</code> usa uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√°rvore de intervalo</a> . </p><br><p>  Se voc√™ realizar testes para a velocidade de renderiza√ß√£o do texto, dependendo do n√∫mero de extens√µes, obter√° os seguintes resultados: ao usar at√© 250 extens√µes em uma linha, <code>SpannableString</code> e <code>SpannableStringBuilder</code> funcionam aproximadamente na mesma velocidade, mas se os elementos de marca√ß√£o se tornarem mais de 250, <code>SpannableString</code> ser√° iniciado. perder.  Portanto, se a tarefa √© aplicar um estilo a algum texto, ao escolher uma classe, deve-se orientar por requisitos sem√¢nticos: se a linha e os estilos ser√£o mut√°veis.  Mas se a marca√ß√£o exigir mais de 250 extens√µes, voc√™ deve sempre dar <code>SpannableStringBuilder</code> ao <code>SpannableStringBuilder</code> . </p><br><h2 id="proverka-na-nalichie-spana-v-tekste">  Verifique a extens√£o no texto </h2><br><p>  A tarefa surge periodicamente para verificar se uma linha estendida possui uma extens√£o espec√≠fica.  E no Stackoverflow, voc√™ pode encontrar este c√≥digo: </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasSpan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(spanned: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Spanned</span></span></span></span><span class="hljs-function"><span class="hljs-params">, clazz: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spans: Array&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> T&gt; = spanned.getSpans(<span class="hljs-number"><span class="hljs-number">0</span></span>, spanned.length, clazz) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> spans.isNotEmpty() }</code> </pre> <br><p>  Essa solu√ß√£o funcionar√°, mas √© ineficiente: voc√™ precisa passar por todas as extens√µes, verificar se cada uma delas pertence ao tipo passado, coletar o resultado em uma matriz e, no final, apenas verificar se a matriz n√£o est√° vazia. </p><br><p>  Uma solu√ß√£o mais eficaz seria usar o m√©todo <code>nextSpanTransition()</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasSpan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(spanned: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Spanned</span></span></span></span><span class="hljs-function"><span class="hljs-params">, clazz: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> limit = spanned.length <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> spanned.nextSpanTransition(<span class="hljs-number"><span class="hljs-number">0</span></span>, limit, clazz) &lt; limit }</code> </pre> <br><h2 id="razmetka-teksta-v-razlichnyh-yazykovyh-resursah">  Marca√ß√£o de texto em v√°rios recursos de idioma </h2><br><p>  Essa tarefa pode surgir quando voc√™ deseja destacar uma palavra espec√≠fica com a ajuda da marca√ß√£o em v√°rios recursos de sequ√™ncia.  Por exemplo, precisamos destacar a palavra <em>"texto"</em> na vers√£o em ingl√™s e <em>"texto"</em> em espanhol: </p><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-en/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag">&gt;</span></span>Best practices for text in Android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-es/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äùtitle‚Äù</span></span></span><span class="hljs-tag">&gt;</span></span>Texto en Android: mejores pr√°cticas<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Se voc√™ precisar de algo simples, por exemplo, para destacar a palavra em negrito, poder√° usar as tags html habituais ( <code>&lt;b&gt;</code> ).  Na interface do usu√°rio, voc√™ s√≥ precisa definir o recurso de cadeia de caracteres no TextView: </p><br><pre> <code class="kotlin hljs">textView.setText(R.string.title)</code> </pre> <br><p>  Mas se voc√™ precisar de algo mais complexo, por exemplo, alterar a fonte, o html n√£o poder√° mais ser usado.  A solu√ß√£o √© usar a <code>&lt;annotation&gt;</code> especial.  Essa tag permite definir qualquer par de valores-chave em um arquivo xml.  Quando extra√≠mos uma string de recursos, essas tags s√£o automaticamente convertidas em extens√µes de <code>Annotation</code> , organizadas no texto com as chaves e valores correspondentes.  Depois disso, voc√™ pode analisar a lista de anota√ß√µes no texto e aplicar os intervalos necess√°rios. </p><br><p>  Suponha que precisamos alterar a fonte usando <code>CustomTypefaceSpan</code> . </p><br><p>  Adicione uma tag e defina uma chave <em>"font"</em> para ela e um valor - o tipo de fonte que queremos usar √© <em>"title_emphasis"</em> : <br></p><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-en/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag">&gt;</span></span>Best practices for <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">font</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äùtitle_emphasis‚Äù</span></span></span><span class="hljs-tag">&gt;</span></span>text<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag">&gt;</span></span> in Android<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- values-es/strings.xml --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äùtitle‚Äù</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">font</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äùtitle_emphasis‚Äù</span></span></span><span class="hljs-tag">&gt;</span></span>Texto<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">annotation</span></span></span><span class="hljs-tag">&gt;</span></span> en Android: mejores pr√°cticas<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Puxe a corda dos recursos, encontre as anota√ß√µes com a tecla <em>"font"</em> e organize os intervalos: </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//      SpannedString,     span' val titleText = getText(R.string.title) as SpannedString //    val annotations = titleText.getSpans(0, titleText.length, Annotation::class.java) //     SpannableString //      val spannableString = SpannableString(titleText) //     for (annotation in annotations) { //     "font" if (annotation.key == "font") { val fontName = annotation.value //   ,     if (fontName == "title_emphasis") { val typeface = getFontCompat(R.font.permanent_marker) //  span    ,    spannableString.setSpan( CustomTypefaceSpan(typeface), titleText.getSpanStart(annotation), titleText.getSpanEnd(annotation), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE ) } } } styledText.text = spannableString</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yq/62/mm/yq62mmgvajffkxkzk3qntsnxhw4.png" width="600"></div><br><p>  Foi mencionado acima que extens√µes de fora da estrutura do Android n√£o podem implementar o <code>Parcelable</code> e s√£o transmitidas via Intent.  Mas isso n√£o se aplica a anota√ß√µes que implementam <code>Parcelable</code> .  Assim, voc√™ pode passar a sequ√™ncia anotada pelo Intent e analisar exatamente da mesma maneira, organizando suas extens√µes. </p><br><h1 id="kak-tekst-raspolagaetsya-v-textview">  Como o texto √© colocado em um TextView </h1><br><p>  O TextView pode exibir n√£o apenas texto, mas tamb√©m imagens.  Voc√™ tamb√©m pode definir v√°rios recuos na frente do texto.  Sob o cap√¥, isso funciona para que o TextView crie uma classe filho, Layout, respons√°vel diretamente pela exibi√ß√£o do texto.  Esta √© uma classe abstrata que possui tr√™s implementa√ß√µes; geralmente voc√™ n√£o precisa trabalhar diretamente com elas, a menos que escreva seu pr√≥prio controle: </p><br><ul><li>  <strong>BoringLayout √©</strong> usado para textos simples, n√£o suporta <strong>quebras de</strong> linha, RTL e outras coisas, mas √© o mais leve.  O TextView o utiliza se o texto atender a todas as restri√ß√µes. </li><li>  <strong>StaticLayout √©</strong> usado no TextView para outros casos. </li><li>  <strong>DynamicLayout √©</strong> usado para texto mut√°vel em um EditText. </li></ul><br><p>  O layout possui muitos m√©todos que permitem conhecer os v√°rios par√¢metros do texto exibido: as coordenadas das linhas, linha de base, as coordenadas do in√≠cio e do final do texto na linha, etc.  (mais detalhes podem ser encontrados na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> ) </p><br><p>  Tais m√©todos podem ser muito √∫teis.  Por exemplo, alguns desenvolvedores enfrentam a tarefa de extrair parte do texto em ret√¢ngulos arredondados e tentam encontrar sua solu√ß√£o atrav√©s de extens√µes que n√£o s√£o aplic√°veis ‚Äã‚Äãna solu√ß√£o desse problema. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8b/-2/df/8b-2df4-wo4ghk8tkwss6l48bfy.png" width="300"></div><br><p>  Mas os m√©todos da classe Layout podem ser √∫teis.  Aqui est√° uma solu√ß√£o de amostra: </p><br><p>  Usando anota√ß√µes, selecionamos as palavras que devem ser circuladas em ret√¢ngulos. </p><br><p>  Em seguida, crie 4 recursos desenh√°veis ‚Äã‚Äãpara todos os casos de quebra de texto, que devem ser colocados em ret√¢ngulos: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q4/ry/oj/q4ryojq_lsj3sdyyehvprallpl8.png" width="600"></div><br><p>  A seguir, encontramos as anota√ß√µes necess√°rias no texto, conforme descrito acima.  Agora, temos os √≠ndices do in√≠cio e do fim dessa anota√ß√£o.  Atrav√©s dos m√©todos Layout, voc√™ pode descobrir o n√∫mero da linha na qual o texto anotado come√ßa e no qual termina: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> startLine = layout.getLineForOffset(spanStartIndex) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> endLine = layout.getLineForOffset(spanEndIndex)</code> </pre> <br><p>  Em seguida, voc√™ deve desenhar um ou mais ret√¢ngulos.  Considere o caso simples, quando a parte anotada do texto apareceu em uma linha, ent√£o precisamos de apenas um ret√¢ngulo com quatro cantos arredondados.  Defina suas coordenadas e desenhe: </p><br><pre> <code class="kotlin hljs">... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (startLine == endLine) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lineTop = layout.getLineTop(startLine) <span class="hljs-comment"><span class="hljs-comment">//    val lineBottom = layout.getLineBottom(startLine) //    val startCoor = layout.getPrimaryHorizontal(spanStartIndex).toInt() //    val endCoor = layout.getPrimaryHorizontal(spanEndIndex).toInt() //    //   drawable.setBounds(startCoor, lineTop, endCoor, lineBottom) drawable.draw(canvas) ...</span></span></code> </pre><br><p>  Como voc√™ pode ver neste exemplo, o Layout armazena muitas informa√ß√µes √∫teis no texto exibido, o que pode ajudar na implementa√ß√£o de v√°rias tarefas n√£o padr√£o. </p><br><h1 id="proizvoditelnost-textview">  Desempenho do TextView </h1><br><p>  O TextView, como qualquer View, passa por tr√™s fases quando exibido: <code>onMeasure()</code> , <code>onLayout()</code> e <code>onDraw()</code> .  Ao mesmo tempo, <code>onMeasure()</code> leva mais tempo, diferentemente dos outros dois m√©todos: nesse momento, a classe Layout √© recriada e o tamanho do texto √© calculado.  Portanto, alterar o tamanho do texto (por exemplo, alterar a fonte) exige muito trabalho.  Alterar a cor do texto ser√° mais leve, pois requer apenas chamar <code>onDraw()</code> .  Como mencionado acima, o sistema possui um cache global de palavras com tamanhos calculados.  Se a palavra j√° estiver no cache, chamar <code>onMeasure()</code> pois levar√° de 11 a 16% do tempo necess√°rio para um c√°lculo completo. </p><br><h2 id="uskorenie-pokaza-teksta">  Acelera√ß√£o de texto </h2><br><p>  Em 2015, os desenvolvedores do Instagram aceleraram a exibi√ß√£o de coment√°rios nas fotos usando o cache global.  A id√©ia era praticamente desenhar o texto antes de mostr√°-lo na tela, ‚Äúaquecendo‚Äù o cache do sistema.  Quando chegou a hora de mostrar o texto, o usu√°rio o viu muito mais r√°pido, pois o texto j√° estava medido e estava no cache. </p><br><p>  A partir do <strong>Android P (28)</strong> , os desenvolvedores do Google adicionaram √† API a capacidade de realizar a fase de medir o tamanho do texto com anteced√™ncia no thread em segundo plano - <code>PrecomputedText</code> (e o backport da API que come√ßa com o <strong>Android I (14)</strong> - <code>PrecomputedTextCompat</code> ).  Usando a nova API, 90% do trabalho ser√° realizado no encadeamento em segundo plano. </p><br><p>  Um exemplo: </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// UI thread val params: PrecomputedText.Params = textView.getTextMetricsParams() val ref = WeakReference(textView) executor.execute { // background thread val text = PrecomputedText.create("Hello", params) val textView = ref.get() textView?.post { // UI thread val textView = ref.get() textView?.text = text } }</span></span></code> </pre> <br><h2 id="pokaz-bolshogo-teksta">  Mostrar texto grande </h2><br><p>  Se voc√™ precisar mostrar texto grande, n√£o transfira imediatamente para um TextView.  Caso contr√°rio, o aplicativo pode parar de funcionar sem problemas ou congelar completamente, pois far√° muito trabalho no thread principal para mostrar um texto enorme que o usu√°rio pode nem rolar at√© o final.  A solu√ß√£o √© dividir o texto em partes (por exemplo, par√°grafos) e exibir as partes individuais no RecyclerView.  Para uma acelera√ß√£o ainda maior, voc√™ pode pr√©-calcular o tamanho dos blocos de texto usando o PrecomputedText. </p><br><p>  Para facilitar a incorpora√ß√£o do PrecomputedText no RecyclerView, os desenvolvedores do Google criaram m√©todos especiais para <code>PrecomputedTextCompat.getTextFuture()</code> e <code>AppCompatTextView.setTextFuture()</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vh: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = getData(position) vh.textView.setTextSize(...) vh.textView.setFontVariationSettings(...) <span class="hljs-comment"><span class="hljs-comment">//    val future = PrecomputedTextCompat.getTextFuture( data.text, vh.textView.getTextMetricsParamsCompat(), myExecutor ) //  future  TextView,      onMeasure() vh.textView.setTextFuture(future) }</span></span></code> </pre> <br><p>   RecyclerView      ,     ,              ,     . </p><br><p>  ,     <code>getTextFuture()</code>     (,   ),     ,   ,    <code>getTextFuture()</code> ,     ,    TextView. </p><br><h2 id="chto-nuzhno-znat-kogda-ustanavlivaesh-tekst-v-textview">   ,     TextView </h2><br><p>    <code>TextView.setText()</code>       : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type == SPANNABLE || movementMethod != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { text = spannableFactory.newSpannable(spannable) <span class="hljs-comment"><span class="hljs-comment">//  } else { text = new SpannedString(spannable) //  }</span></span></code> </pre> <br><p>       span'  TextView,       <code>setText()</code> ,      . </p><br><p>    ,      .  TextView    ,  -,   .    ,      .    ,    ,     TextView   <code>spannableFactory</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MySpannableFactory</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Spannable.Factory</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newSpannable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CharSequence</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Spannable { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? Spannable ?: <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.newSpannable(source) } } textView.spannableFactory = MySpannableFactory()</code> </pre> <br><p>         <code>textView.setText(spannable, BufferType.SPANNABLE)</code> ,      . </p><br><p>  Google         span'  RecyclerView,      . </p><br><p>      TextView,     span,        <code>setText()</code> .      TextView      span. TextView   spannable-    span',  : </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spannable = textView.getText() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Spannable <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> span = CustomTypefaceSpan(span) spannable.setSpan(span, ...)</code> </pre> <br><p>      span,      TextView,         TextView .       ,   <code>invalidate()</code> ,    ‚Äì <code>requestLayout()</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> spannable = textView.getText() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Spannable <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> span = CustomTypefaceSpan(span) spannable.setSpan(span, ...) span.setTypeface(anotherTypeface) textView.requestLayout() <span class="hljs-comment"><span class="hljs-comment">// re-measure and re-draw // or textView.invalidate() // re-draw</span></span></code> </pre> <br><h2 id="ispolzovanie-autolink">  autoLink </h2><br><p>  TextView     .         <code>autoLink</code> .   <code>autoLink=‚Äùweb‚Äù</code> TextView          URL          <code>URLSpan</code> .   ,     SDK   <code>setText()</code> : </p><br><pre> <code class="java hljs">spannable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpannableString(string); Matcher m = pattern.matcher(text); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (...) { <span class="hljs-comment"><span class="hljs-comment">//      String utl = ‚Ä¶ URLSpan span = new URLSpan(url); spannable.setSpan(span, ...); }</span></span></code> </pre> <br><p>      UI ,     <code>autoLink=‚Äùweb‚Äù</code>   RecyclerView.          .        <code>LinkifyCompat</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,       background thread val spannable = SpannableString(string) LinkifyCompat.addLinks(spannable, Linkify.WEB_URLS) //   RecyclerView override fun onBindViewHolder(holder: ViewHolder, position: Int) { holder.textView.setText(spannable, BufferType.SPANNABLE) // ... }</span></span></code> </pre> <br><p>  <code>autoLink</code>      <code>map</code> ‚Äì    (      <code>all</code> ).       .   ,        WebView,      !    SDK   <code>Linkify.gatherMapLinks()</code>    ,      : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((address = WebView.findAddress(string)) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ... }</code> </pre> <br><p>   WebView  TODO   SDK: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String addr)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Rewrite this in Java so it is not needed to start up chromium // Could also be deprecated return getFactory().getStatics().findAddress(addr); }</span></span></code> </pre> <br><p>     ?     Smart Linkify,       <strong>Android P (28)</strong> ,          ,      .    : </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// UI thread val text: Spannable = ‚Ä¶ val request = TextLinks.Request.Builder(text) val ref = WeakReference(textView) executor.execute { // background thread TextClassifier.generateLinks(request).apply(text) val textView = ref.get() textView?.post { // UI thread val textView = ref.get() textView?.text = text } }</span></span></code> </pre> <br><p>    Linkify,      .        toolbar   ,     Google . </p><br><p>  Smart Linkify    :  ,    . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9t/nc/qb/9tncqbkanp8avsnmisd-ax0z7ae.gif" width="300"></div><br><h1 id="magnifier"> Magnifier </h1><br><p>   <strong>Android P (28)</strong> ,     ‚Äì Magnifier,       .           . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fi/nn/or/finnor2svtuttfn1v-lxwkblgwm.gif" width="400"></div><br><p>      TextView, EditText  WebView,            :  API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . </p><br><h1 id="zaklyuchenie">  Conclus√£o </h1><br><p>          Android   ,   , : </p><br><ul><li>         </li><li>    </li><li>   ,   TextView (, EditText) </li></ul><br><p>  -     ,      Google I/O'19 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúBest Practices for Using Text in Android‚Äù</a> . </p><br><a name="links"></a><br><h1 id="poleznye-ssylki">  Links √∫teis </h1><br><h2 id="stati">  Artigos </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Florina Muntenescu. "Spantastic text styling with Spans"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Florina Muntenescu. "Underspanding spans"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Florina Muntenescu. "Styling internationalized text in Android"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Instagram Engineering. "Improving Comment Rendering on Android"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Daniel Lee. "Text rendering on Android"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mariusz DƒÖbrowski. "What is new in Android P ‚Äî PrecomputedText"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Chet Haase. "RecyclerView Prefetch"</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Chris Craik. "Prefetch Text Layout in RecyclerView"</a> </li></ul><br><h2 id="doklady">  Relat√≥rios </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Best practices for text on Android (Google I/O '18)</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Use Android Text Like a Pro (Android Dev Summit '18)</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Best Practices for Using Text in Android (Google I/O'19)</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461787/">https://habr.com/ru/post/pt461787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461773/index.html">Airtest IDE - uma nova maneira de testar a automa√ß√£o de jogos para celular?</a></li>
<li><a href="../pt461775/index.html">3 casos para usar o aipo em um aplicativo Django</a></li>
<li><a href="../pt461779/index.html">80% dos dados da sua empresa n√£o est√£o dispon√≠veis para voc√™. O que fazer sobre isso?</a></li>
<li><a href="../pt461781/index.html">"Ycombinator Startup School 2019." V√≠deo das tr√™s primeiras semanas</a></li>
<li><a href="../pt461785/index.html">Desvantagens do RISC-V</a></li>
<li><a href="../pt461793/index.html">Ivan Ponomarev sobre a API do Kafka Streams na reuni√£o jug.msk.ru</a></li>
<li><a href="../pt461797/index.html">Contos de servi√ßo. Um post fr√≠volo sobre trabalho s√©rio</a></li>
<li><a href="../pt461801/index.html">DisplayPort-LVDS</a></li>
<li><a href="../pt461803/index.html">Data Version Control (DVC): controle de vers√£o de dados e reprodutibilidade do experimento</a></li>
<li><a href="../pt461805/index.html">Aplicativo de Integra√ß√£o Monte Carlo em Renderiza√ß√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>