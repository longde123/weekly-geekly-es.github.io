<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ—‚ï¸ ğŸ‚ğŸ¿ ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ¼ Zabbix-ä½¿ç”¨SNMPv3 TRAPï¼Œç—›è‹¦å’Œç»æœ›æ¥ç›‘è§†OSPFé‚»å±… ğŸ‘©ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ¼ ğŸ™Œ âœŒğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="èŒæƒèŒƒå›´ 
 æœ‰ä¸€ä¸ªåˆ†å¸ƒåœ¨ä¸åŒåœ°ç†ä½ç½®çš„æ•°æ®ä¸­å¿ƒç½‘ç»œï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªVRFæ±½è½¦å’Œä¸€ä¸ªä¸æ–­å˜åŒ–çš„OSPFé‚»å±…åˆ—è¡¨ã€‚ æ‚¨éœ€è¦è·Ÿè¸ªå®ƒä»¬ï¼š 



1. çŠ¶æ€ï¼Œå¦‚æœé‚»å±…çŠ¶æ€ä¸æ˜¯FULLï¼Œåˆ™å‘å‡ºè­¦æŠ¥ 
2. æ•°é‡ï¼Œå³å¦‚æœé‚»å±…ä¸è§äº†ï¼Œæ‚¨è¿˜å¿…é¡»å‘å‡ºè­¦æŠ¥ 
 ä¸€ä¸ªç›‘æ§ç³»ç»Ÿå·²ç»å­˜åœ¨-Zabbix 3.4ï¼Œæœ€å¥½ä½¿ç”¨å®ƒï¼ŒLi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix-ä½¿ç”¨SNMPv3 TRAPï¼Œç—›è‹¦å’Œç»æœ›æ¥ç›‘è§†OSPFé‚»å±…</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417813/"><h2> èŒæƒèŒƒå›´ </h2><br> æœ‰ä¸€ä¸ªåˆ†å¸ƒåœ¨ä¸åŒåœ°ç†ä½ç½®çš„æ•°æ®ä¸­å¿ƒç½‘ç»œï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªVRFæ±½è½¦å’Œä¸€ä¸ªä¸æ–­å˜åŒ–çš„OSPFé‚»å±…åˆ—è¡¨ã€‚ æ‚¨éœ€è¦è·Ÿè¸ªå®ƒä»¬ï¼š <br><br><ol><li> çŠ¶æ€ï¼Œå¦‚æœé‚»å±…çŠ¶æ€ä¸æ˜¯FULLï¼Œåˆ™å‘å‡ºè­¦æŠ¥ </li><li> æ•°é‡ï¼Œå³å¦‚æœé‚»å±…ä¸è§äº†ï¼Œæ‚¨è¿˜å¿…é¡»å‘å‡ºè­¦æŠ¥ </li></ol><br> ä¸€ä¸ªç›‘æ§ç³»ç»Ÿå·²ç»å­˜åœ¨-Zabbix 3.4ï¼Œæœ€å¥½ä½¿ç”¨å®ƒï¼ŒLinux OS Debian 9.x <br><a name="habracut"></a><br><h2> æˆ‘ä»¬å°è¯•ä¸€ä¸‹ </h2><br> è¯¥åè®®éå¸¸æ™®éï¼Œç›‘æ§ç³»ç»Ÿä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘å¯èƒ½ä¸æ˜¯ç¬¬ä¸€ä¸ªæƒ³è¦è§£å†³æ­¤é—®é¢˜çš„äººï¼Œè€Œä¸”å¾ˆæœ‰å¯èƒ½å·²ç»è§£å†³äº†ã€‚ <br><br> æˆ‘ä»¬è¿›å…¥â€œ zabbix ospfâ€æœç´¢ï¼Œç¬¬ä¸€ä¸ªé“¾æ¥æŒ‡å‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¨¡æ¿</a> ã€‚ å¹¸ç¦å°±æ˜¯ä»€ä¹ˆ-ç°åœ¨æˆ‘å°†å…¶å¯¼å…¥ï¼Œå¹¶å°†å…¶ç»„åˆåˆ°æˆ‘çš„éœ€æ±‚ä¸­ï¼Œä¸€åˆ‡éƒ½ä¼šé¡ºåˆ©è¿›è¡Œã€‚ <br> æˆ‘ä»¬æ£€æŸ¥å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„-ä¸€åˆ‡ä¼¼ä¹éƒ½å¾ˆå¥½ï¼Œç›‘è§†äº†çŠ¶æ€ï¼Œä½†æ˜¯å½“é‚»å±…è¿›å…¥DOWNçŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬ä»Zabbixæ”¶åˆ°äº†â€œéå¸¸â€æœ‰ç”¨çš„æ¶ˆæ¯ <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">No</span></span> Such Instance currently <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> at this <span class="hljs-type"><span class="hljs-type">OID</span></span></code> </pre> <br> å’Œä¿¡æ¯ <br><br><pre> <code class="hljs pgsql">The item <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> discovered anymore <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> will be deleted <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span>d <span class="hljs-number"><span class="hljs-number">23</span></span>h <span class="hljs-number"><span class="hljs-number">57</span></span>m (<span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-19</span></span> at <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>)</code> </pre> <br> å‘ç”Ÿçš„äº‹æƒ…-é—®é¢˜å¾ˆè€è€Œä¸”åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://www.opennet.ru/openforum/vsluhforumID3/109102.html)%2520%255B%25D0%25B4%25D0%25B2%25D0%25B0%255D(">è®ºå›ä¸­éƒ½</a>çŸ¥é“-OSPFé‚»å±…æ¶ˆå¤±æ—¶ï¼Œä¸ä¹‹å…³è”çš„æ‰€æœ‰OIDéƒ½ä¼šåœ¨ç½‘ç»œç¡¬ä»¶ä¸Šè¢«åˆ é™¤ã€‚ <br><br> æ˜¯çš„ï¼Œæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ-åˆ›å»ºä¸€ä¸ªæ— æ•°æ®è§¦å‘å™¨ï¼Œç¡®å®šï¼š <br><br><pre> <code class="hljs objectivec">{Template - SNMPv3 - OSPF Discovery:ospfNbrState[{<span class="hljs-meta"><span class="hljs-meta">#SNMPVALUE}].nodata(120)}=0</span></span></code> </pre> <br> æˆ‘ä»¬åœ¨ä»ªè¡¨æ¿ä¸­çœ‹åˆ°ï¼š <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">missing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">data</span></span></code> </pre> <br> åŸºæœ¬ä¸Š...å¯ç”¨ <br><br> ä½†æ˜¯å¼€ç®±å³ç”¨ï¼ŒLLDä»…æ£€æµ‹é»˜è®¤VRFä¸­çš„é‚»å±…ã€‚ å½“ç„¶ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SNMPä¸Šä¸‹æ–‡</a>è§£å†³æ­¤é—®é¢˜ï¼Œä½†æ˜¯æˆ‘å®Œå…¨ä¸å¸Œæœ›é‡‡ç”¨è¿™ç§æ–¹å¼-æˆ‘ä»¬éœ€è¦éå†æ‰€æœ‰è…ºä½“ï¼Œå°†OSPFè¿›ç¨‹æˆ–VRFæ³¨å…¥åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œç„¶åä¸ºæ¨¡æ¿ä¸­çš„æ¯ä¸ªä¸Šä¸‹æ–‡åˆ›å»ºDiscoveryå‰¯æœ¬ï¼Œæ€»çš„æ¥è¯´è¦èŠ±ç‚¹æ—¶é—´å¤§æƒŠå°æ€ªï¼Œå½“æ·»åŠ æ–°çš„OSPFè¿›ç¨‹æ—¶ï¼Œæ‚¨éœ€è¦åœ¨å‡ ä¸ªåœ°æ–¹è¿›è¡Œæ›´æ”¹ã€‚ æ‚¨å½“ç„¶å¯ä»¥è¢«è„šæœ¬åŒ…å›´ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡Zabbix APIè¿›è¡Œæ‰€æœ‰æ›´æ”¹ï¼Œä½†æ˜¯æˆ‘ä¸å¸Œæœ›æœ‰ç‰¹æ®Šçš„è‡ªå®šä¹‰ï¼Œä½†æ˜¯æˆ‘åªæƒ³æœ€å¤§ç¨‹åº¦åœ°ä½¿ç”¨Zabbixå†…ç½®çš„åŠŸèƒ½ã€‚ è¿™é‡Œæåˆ°äº†æŸç§CISCO-CONTEXT-MAPPING-MIBï¼Œæ‚¨å¯ä»¥ä»ä¸­æå–ä¸Šä¸‹æ–‡å’ŒOSPF / VRFçš„æ‰€æœ‰å¯¹åº”å…³ç³»ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰å¼„æ¸…æ¥šå¦‚ä½•å°†è¿™ç§è®¾è®¡å›ºå®šåˆ°LLDã€‚ å¦‚æœæœ‰äººçŸ¥é“å¦‚ä½•å°†Zabbixç…®å¾—å¦‚æ­¤å‡‰çˆ½ï¼Œé‚£ä¹ˆæ¬¢è¿æ‚¨å‘è¡¨è¯„è®ºï¼Œæœ€å¥½æ˜¯æ’°å†™å®Œæ•´çš„ç‹¬ç«‹æ–‡ç« ã€‚ <br><br><h2> æˆ‘ä»¬ä»ç¬¬äºŒæ¬¡æ”»å‡»å¼€å§‹å°è¯• </h2><br> åœ¨äº’è”ç½‘ä¸Šæœç´¢äº†å‡ ä¸ªå°æ—¶åï¼Œæ‰¾åˆ°äº†è®ºå›ä¸­çš„æç¤ºä»¥åŠå†…å­˜ä¸è¶³æ—¶ï¼Œå‡ºç°äº†ä¸€ä¸ªæœ‰å…³SNMP TRAPçš„è¯é¢˜-è¿™æ˜¯æˆ‘ä»¬ä¸é‡‡è®¿é“æ†ï¼Œä½†é“æ†å‘é€æœ‰å…³æŸäº›å˜åŒ–çš„ä¿¡æ¯çš„æ—¶å€™ã€‚ æ˜¯çš„ï¼Œé’ˆå¯¹è¿™äº›é—®é¢˜çš„ç«é€‰æ”¯æŒå·²åœ¨æˆ‘ä»¬çš„ç›‘æ§ç³»ç»Ÿ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸­æä¾›</a> ï¼Œè¯¥è®¾å¤‡ä¹Ÿå¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç«‹å³</a>å°±æˆ‘çš„æƒ…å†µä½¿ç”¨ã€‚ <br><br> ä»ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œç›‘è§†æ–‡æ¡£å°±è¢«ä¸€é•¿ä¸²åˆ—è¡¨å¼„ç³Šæ¶‚äº†ï¼š <br><br><pre> <code class="hljs pgsql">The workflow <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> receiving a trap: <span class="hljs-number"><span class="hljs-number">1.</span></span> snmptrapd receives a trap <span class="hljs-number"><span class="hljs-number">2.</span></span> snmptrapd passes the trap <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> SNMPTT <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> calls Perl trap receiver <span class="hljs-number"><span class="hljs-number">3.</span></span> SNMPTT <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Perl trap receiver parses, formats <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> writes the trap <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> a file <span class="hljs-number"><span class="hljs-number">4.</span></span> Zabbix SNMP trapper reads <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> parses the trap file <span class="hljs-number"><span class="hljs-number">5.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> trap Zabbix finds <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> â€œSNMP trapperâ€ items <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> host interfaces matching the received trap address. Note that <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> the selected â€œIPâ€ <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> â€œDNSâ€ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> host interface <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> used during the matching. <span class="hljs-number"><span class="hljs-number">6.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> item, the trap <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> compared <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> regexp <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> â€œsnmptrap[regexp]â€. The trap <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> matched items. <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> matching item <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> there <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> an â€œsnmptrap.fallbackâ€ item, the trap <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> that. <span class="hljs-number"><span class="hljs-number">7.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> the trap was <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> item, Zabbix <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> logs the unmatched trap. (This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> configured <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> â€œ<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> unmatched SNMP trapsâ€ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Administration â†’ General â†’ Other.)</code> </pre> <br> ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå®ˆæŠ¤ç¨‹åºæ¥å—TRAPï¼Œå°†å…¶ä¼ é€’ç»™å¦ä¸€ä¸ªå®ˆæŠ¤ç¨‹åºï¼Œç„¶åå¯¹å…¶è¿›è¡Œè§£æï¼Œå¹¶ä»¥æ‰€éœ€çš„æ ¼å¼å°†å…¶æ”¾å…¥æ—¥å¿—ä¸­ï¼Œå¹¶ä¸”zabixå·²ç»è¯»å–è¯¥æ—¥å¿—å¹¶å†³å®šä¸‹ä¸€æ­¥è¦åšä»€ä¹ˆã€‚ æŸç§ç¨‹åº¦ä¸Šï¼Œå®ƒçœ‹èµ·æ¥æ¯”ç”¨æ‰‹èµ°è·¯å¹¶åœ¨ä»»ä½•åœ°æ–¹ç»˜åˆ¶SNMPä¸Šä¸‹æ–‡éƒ½å®¹æ˜“å¾—å¤šï¼Œä½†æ˜¯ï¼Œè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚ æˆ‘ä»¬ä»”ç»†é˜…è¯»äº†ç›‘è§†æ–‡æ¡£ï¼Œå¹¶äº†è§£åˆ°åªæœ‰å€ŸåŠ©å…¶å¸®åŠ©ï¼Œæ‰èƒ½è¿›è¡Œä»»ä½•é…ç½®ï¼Œé€šå¸¸Zabbixä¼šå¼€ç©ç¬‘-è¯¥æ–‡æ¡£ä»…æè¿°äº†ç³»ç»Ÿçš„åŠŸèƒ½å’Œç»†å¾®å·®åˆ«ï¼Œä»¥è‡´äºæ¯”è®²æˆçš„æ›´åŠ æ··ä¹±ã€‚ å°½ç®¡å¯ä»¥ç†è§£-è¯¥è½¯ä»¶æ˜¯å…è´¹çš„ï¼Œä½†æ˜¯æ‚¨éœ€è¦ä»¥æŸç§æ–¹å¼èµšé’±ï¼Œä½†æ˜¯ä»–ä»¬ä¼šåœ¨æ”¯æŒæ–¹é¢èµšé’±ã€‚ äº’è”ç½‘ä¸Šæœ‰å‡ ç¯‡æ–‡ç« ä»‹ç»äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€æ¬¡æˆ–</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸¤æ¬¡è®¾ç½®çš„æ–¹æ³•</a> ï¼Œä½†æ˜¯æˆ‘æ— æ³•ä»ä¸€ç¯‡æ–‡ç« æ”¹å†™åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä¸å¾—ä¸ä»å„ç§æ¥æºæ”¶é›†ä¿¡æ¯ã€‚ è¿™æ˜¯æ‰€æœ‰çš„æ­Œè¯ï¼Œä»–ä»¬å¼€è½¦å»åšç¡¬æ ¸ã€‚ <br><br><h2> æˆ‘ä»¬é…ç½®é“ç½‘ </h2><br> åœ¨ä½¿ç”¨ç›‘æ§ç¨‹åºæ‰­æ›²ä¸»æœºä¸Šçš„å†…å®¹ä¹‹å‰ï¼Œæˆ‘å¼ºçƒˆå»ºè®®æ‚¨é¦–å…ˆé…ç½®ç½‘ç»œç¡¬ä»¶ï¼Œå¹¶ç¡®ä¿TRAPç¡®å®ä»ç¡¬ä»¶åˆ°è¾¾æœåŠ¡å™¨-æœ€åˆï¼Œæˆ‘æ²¡æœ‰æ£€æŸ¥å®ƒæ˜¯å¦æ¶ˆè€—äº†å¾ˆå¤šç¥ç»ï¼Œç²¾åŠ›å’Œæ—¶é—´ã€‚ æˆ‘æ‰‹ä¸Šæœ‰ä¸€è¾†Cisco Nexusæ±½è½¦ï¼Œå› æ­¤æˆ‘å°†ä¸¾ä¾‹è¯´æ˜è¯¥ç³»åˆ—ã€‚ æ‹¥æœ‰Catalystï¼ŒASRï¼ŒASAç­‰äº§å“çš„äºº-æŠ±æ­‰ï¼Œæˆ‘ä¸æ˜¯å¤ªé˜³ï¼Œæˆ‘ä¸ä¼šåŠ çƒ­æ‰€æœ‰äººï¼Œè¯·é˜…è¯»æœ‰å…³å¦‚ä½•è‡ªè¡Œé…ç½®çš„æ‰©å±•åï¼Œè¯­æ³•å°†ç›¸ä¼¼ï¼Œä½†æœ‰å…¶ç»†å¾®å·®åˆ«ã€‚ <br><br><pre> <code class="hljs pgsql">snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> contact noc@example.com snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">location</span></span> Room1 snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> source-interface traps loopback1</code> </pre> <br> å°†æ¥å¾ˆé‡è¦ï¼Œåœ¨Zabbixä¸­é…ç½®TRAPæ—¶ï¼Œå‘é€TRAPçš„åœ°å€å¿…é¡»ç­‰äºZabbixä¸»æœºè®¾ç½®ä¸­æ¥å£çš„SNMPåœ°å€ã€‚ <br><br><pre> <code class="hljs cs">snmp-server user Zabbix network-<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> auth sha <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> priv aes<span class="hljs-number"><span class="hljs-number">-128</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span></code> </pre> <br> åœ¨authPrivæ¨¡å¼ï¼ˆåŠ å¯†å’Œèº«ä»½éªŒè¯ï¼‰ä¸‹ï¼Œå°½å¯èƒ½ä½¿ç”¨åè®®çš„ç‰ˆæœ¬3ï¼Œé…ç½®èµ·æ¥ä¼¼ä¹å¹¶ä¸å›°éš¾ã€‚ å¿˜è®°åè®®çš„ç‰ˆæœ¬1å’Œç‰ˆæœ¬2 â€“å½“ç”±äºè¿™äº›åè®®ç‰ˆæœ¬ä¸­ç¼ºä¹åŠ å¯†å’Œæœ¬è´¨ä¸Šçš„èº«ä»½éªŒè¯è€Œå¯¼è‡´æ„å¤–çš„äººåˆ°è¾¾æ—¶ï¼Œè¿™åªæ˜¯æ—¶é—´é—®é¢˜ï¼ˆç¤¾åŒºå­—ç¬¦ä¸²ä»¥æ¸…æ™°çš„å½¢å¼ä¼ è¾“ï¼Œè€Œä¸”ï¼Œæˆ‘ç»å¸¸çœ‹åˆ°å®ƒé…ç½®ä¸ºpublic / privateï¼‰ã€‚ ä½¿ç”¨network-operatorå‚æ•°å¯ä»¥æˆäºˆç”¨æˆ·åªè¯»æƒé™ã€‚ <br><br><pre> <code class="hljs sql">snmp-server host 192.168.192.168 traps version 3 priv Zabbix snmp-server host 192.168.192.168 <span class="hljs-keyword"><span class="hljs-keyword">use</span></span>-vrf <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> host <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.192</span></span><span class="hljs-number"><span class="hljs-number">.168</span></span> <span class="hljs-keyword"><span class="hljs-keyword">source</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> loopback1 <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps ospf lsa snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps ospf <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_mib_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_module_status_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_power_status_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_module_inserted <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_module_removed <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_unrecognised_module <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_fan_status_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_power_out_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> linkDown <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> linkUp <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extended</span></span>-linkDown <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extended</span></span>-linkUp <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> cieLinkDown <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> cieLinkUp <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> connUnitPortStatusChange <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps bfd <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>-up <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">delayed</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">link</span></span>-state-<span class="hljs-keyword"><span class="hljs-keyword">change</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps bfd <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>-down <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rf redundancy_framework <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-license-expiry <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>-license-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-feature <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-licensefile-<span class="hljs-keyword"><span class="hljs-keyword">missing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-license-expiry-<span class="hljs-keyword"><span class="hljs-keyword">warning</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span> UpgradeOpNotifyOnCompletion <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span> UpgradeJobStatusNotify <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon risingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon fallingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon hcRisingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon hcFallingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_sensor <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps generic coldStart <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps generic warmStart</code> </pre> <br> æˆ‘ä¸“é—¨ç¦ç”¨äº†é™¤OSPFä»¥å¤–çš„æ‰€æœ‰TRAPï¼Œå› æ­¤ï¼Œåœ¨è¯Šæ–­ä¸ºä»€ä¹ˆæŸäº›åŠŸèƒ½ä¸èµ·ä½œç”¨æ—¶ï¼Œæˆ‘ä¸å¿…ä»è°ƒè¯•ä¸­è¯»å–å¾ˆå¤šä¸å¿…è¦çš„ä¿¡æ¯ã€‚ <br><br> å¦‚ä½•æ£€æŸ¥TRAPæ˜¯å¦æœ‰æ•ˆå¾ˆç®€å•-æ‚¨éœ€è¦ç ´åä¸€äº›ä¸œè¥¿ã€‚ æˆ‘ä»¬é€šè¿‡ç›‘è§†åœ¨ä¸»æœºä¸Šå¯åŠ¨å—…æ¢å™¨ï¼š <br><br><pre> <code class="hljs pgsql">root@dc-zbx:~# tcpdump -i bond0 udp port <span class="hljs-number"><span class="hljs-number">162</span></span> tcpdump: <span class="hljs-keyword"><span class="hljs-keyword">verbose</span></span> output suppressed, use -v <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> -vv <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">full</span></span> protocol decode listening <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> bond0, link-<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> EN10MB (Ethernet), capture size <span class="hljs-number"><span class="hljs-number">262144</span></span> bytes</code> </pre> <br> æˆ‘ä»¬å‘ç°ä¸€ä¸ªé“ç”Ÿçš„é‚»å±…ï¼š <br><br><pre> <code class="hljs pgsql">SW# <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip ospf neighbors vrf <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> OSPF Process ID <span class="hljs-number"><span class="hljs-number">10</span></span> VRF <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">4</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.242</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> Vlan1427 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.222</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">18</span></span>w1d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span> Vlan1426 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.149</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">5</span></span>w0d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.30</span></span> Vlan1473 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.146</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">3</span></span>d00h <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.58</span></span> Vlan1404 OSPF Process ID <span class="hljs-number"><span class="hljs-number">100</span></span> VRF OSPF100 Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">4</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.149</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">5</span></span>w0d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.34</span></span> Vlan1474 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.220</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">13</span></span>w3d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.54</span></span> Vlan1479 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.240</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">13</span></span>w3d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.46</span></span> Vlan1477 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.146</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">3</span></span>d00h <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.62</span></span> Vlan1405 OSPF Process ID <span class="hljs-number"><span class="hljs-number">200</span></span> VRF Dia Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">2</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">10.65</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.252</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">17</span></span>w2d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.18</span></span> Vlan1450 <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.26</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">17</span></span>w0d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.26</span></span> Vlan1452 OSPF Process ID <span class="hljs-number"><span class="hljs-number">216</span></span> VRF Dev Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">2</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">10.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.94</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">10.216</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.73</span></span> Vlan1641 <span class="hljs-number"><span class="hljs-number">10.216</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.82</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">10.216</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.82</span></span> Vlan1643</code> </pre><br> æ”¾ä¸‹ä¸€ä¸ªäºº <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vlan</span></span></span><span class="hljs-class"> 1643 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shutdown</span></span></span></span></code> </pre> <br> æˆ‘ä»¬åœ¨å—…æ¢å™¨ä¸­çœ‹åˆ°ï¼š <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">20.001942</span></span> IP <span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.169</span></span>.<span class="hljs-number"><span class="hljs-number">22095</span></span> &gt; dc<span class="hljs-literal"><span class="hljs-literal">-zbx</span></span>.example.com.snmp<span class="hljs-literal"><span class="hljs-literal">-trap</span></span>: F=ap U=<span class="hljs-string"><span class="hljs-string">"Zabbix"</span></span> [!<span class="hljs-type"><span class="hljs-type">scoped</span></span> <span class="hljs-type"><span class="hljs-type">PDU</span></span>]<span class="hljs-number"><span class="hljs-number">39</span></span>_d1_7c_19_b3_d9_f8_31_32_8e_c9_39_c2_3a_db_d8_28_26_c6_0b_01_55_b6_fa_5e_f5_38_66_f9_6f_3f_c0_98_cb_57_93_5a_50_8e_50_90_79_f3_9b_ec_ec_d7_9f_e8_ac_f6_fd_79_ac_95_ff_71_73_32_70_52_66_a5_7d_b3_c4_39_d0_1c_7f_a6_38_ea_d7_61_c0_2f_12_ee_db_d9_07_40_8c_a8_48_57_e9_e5_56_12_3f_ec_f9_34_65_09_96_86_f6_d2_93_06_45_fa_95_ea_36_5a_82_2f_30_8f_02_03_59_07_5f_d8_a6_1c_f2_5a_be_7d_09_15_ef_05_00_83_fd_ea_ac_2a_3b_86_0f_86_e5_3b_93_3a_68_6d_33_99_e2_46_2b_9d_6a_1e_5d_9e_d9_93_56_51_5e_ff_9e_77_4c_cb</code> </pre> <br> å¦‚æœæ‚¨æ²¡æœ‰åœ¨å—…æ¢å™¨ä¸­çœ‹åˆ°ä»»ä½•ä¸œè¥¿ï¼Œè¯·å¯¹å…¶è¿›è¡Œè¯Šæ–­ï¼Œå› ä¸ºå¦åˆ™æ²¡æœ‰ç†ç”±ç»§ç»­è¿›è¡Œè¿›ä¸€æ­¥çš„æœç´¢ï¼Œæ‚¨å°†æ ¹æœ¬ä¸äº†è§£åœ¨å“ªä¸ªé˜¶æ®µä¸é€‚ç”¨äºæ‚¨ã€‚ <br> å¦‚æœæ‰‹å¤´æ²¡æœ‰é“ç‰‡æˆ–æ— æ³•è§¦æ‘¸ç”Ÿäº§ï¼Œåˆ™å¯ä»¥ä»ä»»ä½•å…¶ä»–æ±½è½¦äº§ç”ŸTRAPï¼Œä¾‹å¦‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="hljs powershell">snmptrap <span class="hljs-literal"><span class="hljs-literal">-v</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-literal"><span class="hljs-literal">-c</span></span> neveruseme <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-string"><span class="hljs-string">'.1.3.6.1.6.3.1.1.5.3'</span></span> <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-string"><span class="hljs-string">'55'</span></span> .<span class="hljs-number"><span class="hljs-number">1.3</span></span>.<span class="hljs-number"><span class="hljs-number">6.1</span></span>.<span class="hljs-number"><span class="hljs-number">6.3</span></span>.<span class="hljs-number"><span class="hljs-number">1.1</span></span>.<span class="hljs-number"><span class="hljs-number">5.3</span></span> s <span class="hljs-string"><span class="hljs-string">"teststring000"</span></span> snmptrap <span class="hljs-literal"><span class="hljs-literal">-v3</span></span> <span class="hljs-literal"><span class="hljs-literal">-l</span></span> authPriv <span class="hljs-literal"><span class="hljs-literal">-u</span></span> Zabbix <span class="hljs-literal"><span class="hljs-literal">-a</span></span> SHA <span class="hljs-literal"><span class="hljs-literal">-A</span></span> abyrvalg <span class="hljs-literal"><span class="hljs-literal">-x</span></span> AES <span class="hljs-literal"><span class="hljs-literal">-X</span></span> pechka <span class="hljs-literal"><span class="hljs-literal">-e</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>x8000000001020305 <span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.168</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> linkUp.<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><h2> é…ç½®SNMPdï¼ŒSNMPTRAPdï¼ŒSNMPTT </h2><br> æˆ‘ä»¬å°†åœ¨ç³»ç»Ÿä¸­éœ€è¦è½¯ä»¶åŒ…ï¼š <br><br><pre> <code class="hljs powershell">apt install snmp snmp<span class="hljs-literal"><span class="hljs-literal">-mibs</span></span><span class="hljs-literal"><span class="hljs-literal">-downloader</span></span> snmpd snmptrapd snmptt</code> </pre> <br> æˆ‘æ²¡æœ‰å…³æ³¨Perlé™·é˜±æ¥æ”¶å™¨ï¼Œè€Œæ˜¯å‡ºäºä¸ªäººå’Œä¸»è§‚åŸå› é€‰æ‹©äº†SNMPTTã€‚ å› æ­¤ï¼Œç å¤´è¯´ï¼š <br><br><pre> <code class="hljs markdown"><span class="hljs-bullet"><span class="hljs-bullet">1. </span></span>snmptrapd receives a trap</code> </pre> <br> å¿…é¡»ä»å…¶é…ç½®å¼€å§‹ï¼Œè€Œä¸æ˜¯ç«‹å³çˆ¬å‡ä»¥åœ¨Zabbixé¢ä¸Šåˆ›å»ºItemã€‚ ä¸ºä»€ä¹ˆè¿™æ ·åš-æ‚¨éœ€è¦éµå¾ªTRAPçš„ç›¸åŒæ­¥éª¤ã€‚ åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç¡®ä¿TRAPåŸºæœ¬ä¸Šæ¥è‡ªä¸€å—é“ï¼Œç°åœ¨æˆ‘ä»¬å°†ç¡®ä¿è‡³å°‘å®ƒè¢«ç¬¬ä¸€ä¸ªå®ˆæŠ¤ç¨‹åºsnmptrapdæ¥å—ã€‚  &lt;lyric&gt;æˆ‘è®°å¾—å¾ˆä¹…ä»¥å‰å°±è®¾ç½®äº†postfix + dovecot +å…¶ä»–åŠŸèƒ½ã€‚ æˆ‘é—·é—·äº†ä¸¤å‘¨-åœ¨é‚£å„¿ï¼Œä¸€ä¸ªæ¶é­”ä¹Ÿæ¥å—äº†è¿æ¥ï¼Œå¦ä¸€ä¸ªæ¶é­”è§£æäº†è¿™å°ä¿¡ï¼Œç¬¬ä¸‰ä¸ªæ¶é­”æŠŠå®ƒæ”¾åœ¨äº†é˜Ÿåˆ—ä¸­ï¼Œç¬¬å››ä¸ªæŠŠå®ƒæ”¾åˆ°äº†ç”¨æˆ·çš„æ–‡ä»¶å¤¹ä¸­ï¼Œä¾æ­¤ç±»æ¨ã€‚ æ‰€æœ‰è¿™äº›éƒ½æ˜¯å› ä¸ºæˆ‘ä»ä¸­é—´å¼€å§‹ï¼Œä»å¤´å¼€å§‹ï¼Œä»å¤´å¼€å§‹è¿›è¡Œè°ƒä¼˜ï¼Œä½†æ˜¯æˆ‘å¿…é¡»ä»telnetåˆ°ç«¯å£25å¹¶æŸ¥çœ‹foxerçš„è°ƒè¯•å™¨&lt;/ lyric&gt; <br><br> æˆ‘ä»¬è¿›å…¥/etc/snmp/snmptrapd.confå¹¶å°†å…¶åˆ é™¤ï¼Œä½†æˆ‘ä»¬ä¼šå¯¹æ‰€æœ‰æˆ‘ä»¬ä¸äº†è§£å’Œä¸æ„Ÿå…´è¶£çš„å†…å®¹å‘è¡¨è¯„è®ºï¼Œåªç•™ä¸‹ä¸€è¡Œ <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">disableAuthorization</span></span> <span class="hljs-literal"><span class="hljs-literal">yes</span></span></code> </pre> <br> åœæ­¢æœåŠ¡ <br><br><pre> <code class="hljs sql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> snmptrapd.service</code> </pre> <br> ä»¥æ‰‹åŠ¨æ¨¡å¼è¿è¡Œ <br><br><pre> <code class="hljs pgsql">root@dc-zbx:~# snmptrapd -f -Lo NET-SNMP <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">5.7</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> AgentX subagent connected NET-SNMP <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">5.7</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span></code> </pre> <br> å†æ¬¡å°è¯•åƒä¸Šé¢çš„ç¤ºä¾‹ä¸€æ ·ä¸­æ–­OSPFï¼Œè¯·å‚é˜…ï¼š <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-literal"><span class="hljs-literal">-07</span></span><span class="hljs-literal"><span class="hljs-literal">-20</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span> UNKNOWN [<span class="hljs-type"><span class="hljs-type">UDP</span></span>: [<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-type"><span class="hljs-type">.192.169</span></span>]:<span class="hljs-number"><span class="hljs-number">22095</span></span>-&gt;[<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-type"><span class="hljs-type">.192.168</span></span>]:<span class="hljs-number"><span class="hljs-number">162</span></span>]: DISMAN<span class="hljs-literal"><span class="hljs-literal">-EVENT</span></span><span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::sysUpTimeInstance = Timeticks: (<span class="hljs-number"><span class="hljs-number">1355817272</span></span>) <span class="hljs-number"><span class="hljs-number">156</span></span> days, <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">32.72</span></span> SNMPv2<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::snmpTrapOID.<span class="hljs-number"><span class="hljs-number">0</span></span> = OID: OSPF<span class="hljs-literal"><span class="hljs-literal">-TRAP</span></span><span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrStateChange OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfRouterId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.74</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrIpAddr = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrAddressLessIndex = INTEGER: <span class="hljs-number"><span class="hljs-number">0</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrRtrId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrState = INTEGER: down(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br> å¦‚æœçœ‹ä¸åˆ°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾åŸå› ã€‚ å¦‚æœè¦å…·æœ‰ç›¸åŒçš„ä¼˜ç¾è®°å½•ï¼Œè€Œä¸æ˜¯æ ¼å¼ä¸º1.3.6.1.2.1.14.10.1.6çš„ä¸€ç»„OIDï¼Œè¯·åœ¨/etc/snmp/snmp.confä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="hljs powershell">mibs +OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span> mibs +OSPF<span class="hljs-literal"><span class="hljs-literal">-TRAP</span></span><span class="hljs-literal"><span class="hljs-literal">-MIB</span></span> mibs +OSPFV3<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span> mibdirs +/usr/share/snmp/mibs/ietf/</code> </pre><br> å¹¶æ‰­æ›²SNMPd <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> snmpd.service</code> </pre> <br> æœ‰å…³æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œè¯·é˜…è¯»[here]ï¼ˆhttps://wiki.debian.org/SNMPï¼‰ï¼Œä»¥æœ€è½»æ¾çš„æ–¹å¼ä¸‹è½½MIBæ–‡ä»¶å¹¶å°†å…¶æä¾›ç»™SNMPdã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬åŠ å¼ºèº«ä»½éªŒè¯ï¼Œæˆ‘ä»¬å†æ¬¡è¿›å…¥/etc/snmp/snmptrapd.conf <br><br><pre> <code class="hljs vbscript">traphandle <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> snmptthandler #disableAuthorization yes # <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.192</span></span><span class="hljs-number"><span class="hljs-number">.169</span></span> createUser -e <span class="hljs-number"><span class="hljs-number">0x80000009038d604a6a82a3</span></span> Zabbix SHA <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> AES authuser <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">execute</span></span>,net Zabbix</code> </pre> <br>  -e 0x80000009038d604a6a82a3æ˜¯engineIDï¼Œå¯ä»¥åœ¨ç½‘ç»œç¡¬ä»¶ä¸ŠæŸ¥çœ‹ï¼š <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">SW</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">sh</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">engineID</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Local</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SNMP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">engineID</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Hex]</span></span> 80000009038<span class="hljs-selector-tag"><span class="hljs-selector-tag">F604D6A82A1</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Dec]</span></span> 128<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:040</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:000</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:109</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:003</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:096</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:079</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:106</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:131</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:160</span></span></code> </pre> <br> æˆ‘ä»¬å°†å†æ¬¡é‡å¤è¯¥å®éªŒï¼Œä½†ç°åœ¨æˆ‘ä»¬ä»åœ¨è¿›è¡Œæœ‰å…³USMçš„è°ƒè¯•ï¼š <br><br><pre> <code class="hljs rust">root@dc-zbx:~# snmptrapd -f -Lo -Dusm registered debug token usm, <span class="hljs-number"><span class="hljs-number">1</span></span> usmUser: created a new user Zabbix at <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>F <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>F <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">82</span></span> A5 NET-SNMP version <span class="hljs-number"><span class="hljs-number">5.7</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> AgentX subagent connected NET-SNMP version <span class="hljs-number"><span class="hljs-number">5.7</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> usm: USM processing begun... usm: <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> on user Zabbix usm: no <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> on engineID (<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>F <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>F <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">82</span></span> A5 ) usm: <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> on user Zabbix usm: Verification succeeded. usm: USM processing completed. <span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">07</span></span>-<span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span> UNKNOWN [UDP: [<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.169</span></span>]:<span class="hljs-number"><span class="hljs-number">22095</span></span>-&gt;[<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.168</span></span>]:<span class="hljs-number"><span class="hljs-number">162</span></span>]: DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (<span class="hljs-number"><span class="hljs-number">1355886163</span></span>) <span class="hljs-number"><span class="hljs-number">156</span></span> days, <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">01.63</span></span> SNMPv2-MIB::snmpTrapOID.<span class="hljs-number"><span class="hljs-number">0</span></span> = OID: OSPF-TRAP-MIB::ospfNbrStateChange OSPF-MIB::ospfRouterId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.74</span></span> OSPF-MIB::ospfNbrIpAddr = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF-MIB::ospfNbrAddressLessIndex = INTEGER: <span class="hljs-number"><span class="hljs-number">0</span></span> OSPF-MIB::ospfNbrRtrId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF-MIB::ospfNbrState = INTEGER: down(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br> å¦‚æœåœ¨æ­¤é˜¶æ®µåœ¨è°ƒè¯•ä¸­çœ‹åˆ°æˆæƒé”™è¯¯ï¼Œè¯·ä»”ç»†æ£€æŸ¥engineIDå¹¶ç¡®ä¿åœ¨ç¡¬ä»¶ä¸Šåˆ›å»ºçš„ç”¨æˆ·ä¸æˆ‘ä»¬åœ¨/etc/snmp/snmptrapd.confé…ç½®ä¸­ç»˜åˆ¶çš„ç”¨æˆ·åŒ¹é…ã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œæ˜¯çš„ï¼Œå¯¹äºæ¯å—é“ç‰‡ï¼Œæ‚¨éƒ½å¿…é¡»ä½¿ç”¨è‡ªå·±çš„engineIDåˆ›å»ºè‡ªå·±çš„ç”¨æˆ·ï¼Œæˆ–è€…ï¼Œå¦‚æœé“ç‰‡å…è®¸è¿™æ ·åšï¼Œåˆ™ç”¨æ‰‹åœ¨æ‰€æœ‰é“ç‰‡ä¸Šä½¿å…¶ç›¸åŒã€‚ <br><br> æˆ‘å¯ä»¥åœ¨è°ƒè¯•ä¸­çœ‹åˆ°è¿™ä¸€è¡Œï¼š <br><br><pre> <code class="hljs pgsql">usm: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> match <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> engineID (<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>F <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>F <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">82</span></span> A5 )</code> </pre> <br> æˆ‘ä¸ºä»€ä¹ˆä¸æ˜ç™½ï¼Œå°½ç®¡TRAPå·²è¢«æ¥å—å¹¶éœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€‚ å¦‚æœæ‚¨çŸ¥é“æˆ‘åšé”™äº†ï¼Œè¯·å‘è¡¨è¯„è®ºã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨SNMPTT-å®ƒå…·æœ‰ä¸¤ä¸ªiniå’Œconfé…ç½®ã€‚ åœ¨ç¬¬ä¸€ä¸ªä¸­ï¼Œæˆ‘ä»¬ç¡®å®šå®ˆæŠ¤ç¨‹åºæœ¬èº«çš„å‚æ•°ï¼Œåœ¨ç¬¬äºŒä¸ªä¸­ï¼Œæˆ‘ä»¬ç¡®å®šç”¨äºæ¥æ”¶å’Œå¤„ç†æ¯ä¸ªç‰¹å®šé˜¶æ¢¯çš„å‚æ•°ã€‚ <br><br> æˆ‘ä»¬è¿›å…¥/etc/snmp/snmptt.iniæ–‡ä»¶å¹¶ç»˜åˆ¶ä»¥ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="hljs perl">mode = daemon net_snmp_perl_enable = <span class="hljs-number"><span class="hljs-number">1</span></span> date_time_format = %Y %m %d %H:%M:%S</code> </pre> <br> æ—¥æœŸå’Œæ—¶é—´çš„æ ¼å¼ä¸ä¸šåŠ¡æœ‰å…³ï¼›æœ€é‡è¦çš„æ˜¯ï¼Œåˆ°å¤„éƒ½ä½¿ç”¨ç›¸åŒçš„æ ¼å¼ã€‚ <br><br><pre> <code class="hljs pgsql">log_file = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/snmptt/snmptt.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> log_system_file = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/snmptt/snmpttsystem.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> unknown_trap_log_enable = <span class="hljs-number"><span class="hljs-number">1</span></span> unknown_trap_log_file = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/snmptt/snmpttunknown.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span></code> </pre> <br> ä¸ºä»€ä¹ˆæ—¥å¿—ä¸Internetä¸Šè®¸å¤šæ–‡ç« ä¸­çš„æ—¥å¿—ä¸åŒï¼Ÿ å› ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰©å±•å</a>è¯´ï¼šâ€œå¦‚æœä½¿ç”¨systemdå‚æ•°PrivateTmpï¼Œåˆ™è¯¥æ–‡ä»¶ä¸å¤ªå¯èƒ½åœ¨/ tmpä¸­å·¥ä½œã€‚â€ï¼Œå¦‚æœäº‹å…ˆè­¦å‘Šï¼Œæˆ‘ä¸æƒ³å†æ¬¡è¿›å…¥rakeï¼Œå› æ­¤ï¼Œæˆ‘å°†ç«‹å³æ›´æ”¹ä¸ºè¯¥æ–‡ä»¶çš„å¸¸è§„è·¯å¾„ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œè½¬åˆ°/etc/snmp/snmptt.confï¼Œåˆ é™¤æˆ‘ä»¬ä¸éœ€è¦å’Œ/æˆ–ä¸ç†è§£çš„æ‰€æœ‰å†…å®¹ï¼Œä»…ä¿ç•™ä»¥ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">EVENT</span></span> ospfNbrStateChange .<span class="hljs-number"><span class="hljs-number">1.3.6.1</span></span>.<span class="hljs-number"><span class="hljs-number">2.1.14.16</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-string"><span class="hljs-string">"OSPF"</span></span> Normal FORMAT ZBXTRAP <span class="hljs-variable"><span class="hljs-variable">$aA</span></span> OSPF neighbor with IP addr <span class="hljs-variable"><span class="hljs-variable">$2</span></span> changed state to <span class="hljs-variable"><span class="hljs-variable">$5</span></span></code> </pre> <br> é‡‡ç”¨è¿™ç§å½¢å¼ï¼Œå› ä¸ºZabbixæœŸæœ›æ—¥å¿—ä¸­å…·æœ‰è¿™ç§æ ¼å¼ã€‚  $ 2å’Œ$ 5çš„æ¥æºï¼Œæ‚¨å¯ä»¥äº†è§£ä¸€ä¸‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TRAPæ¶ˆæ¯æ ¼å¼</a> ï¼Œè¯·çœ‹ï¼š <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrStateChange</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OID</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MIB</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF-TRAP-MIB</span></span> ; <span class="hljs-selector-tag"><span class="hljs-selector-tag">Trap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Components</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfRouterId</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrIpAddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrAddressLessIndex</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrRtrId</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrState</span></span></code> </pre> <br> è¿™äº›é™·é˜±ç»„ä»¶æ˜¯å¯ä»¥æŒ‰$ 1ï¼Œ$ 2 ...çš„é¡ºåºæ¨å…¥æ—¥å¿—æ ¼å¼çš„å‚æ•°ã€‚ <br><br> åœ¨æ‰€æœ‰è¿™äº›å†…å®¹çš„æ‘Šç‰Œè¿‡ç¨‹ä¸­ï¼Œæˆ‘æ³¨æ„åˆ°æ›´æ”¹SNMPTTè®¾ç½®åï¼Œå¥½åƒæ²¡æœ‰åº”ç”¨æ›´æ”¹ã€‚ äº‹å®è¯æ˜ï¼Œåœ¨è¿›è¡Œæ›´æ”¹ä¹‹åï¼Œæœ‰å¿…è¦ä¸é‡æ–°å¯åŠ¨snmptt.serivceï¼Œè€Œæ˜¯é‡æ–°å¯åŠ¨snmpd.service-è¿™ç§ç»†å¾®å·®åˆ«åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­åƒæ ·åœ°å¸äº†æˆ‘çš„è¡€ï¼Œå–äº†æˆ‘çš„ç¥ç»ã€‚ <br><br> æ£€æŸ¥æ‚¨æ˜¯å¦æ­£åœ¨è¿è¡Œæ‰€æœ‰å®ˆæŠ¤ç¨‹åºï¼š <br><br><pre> <code class="hljs lua">systemctl <span class="hljs-built_in"><span class="hljs-built_in">status</span></span> snmpd snmptrapd snmptt</code> </pre> <br> å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œè¯·å†æ¬¡å°è¯•ç ´åOSPFå¹¶è½¬åˆ°æ—¥å¿—/var/log/snmptt/snmptt.logï¼Œå®ƒå°†çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="hljs css">2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:52</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">down</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:28</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">full</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:22</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:41</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">down</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:25</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:38</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span></code> </pre> <br> æˆ‘ä»¬æœªåœ¨/etc/snmp/snmptt.confé…ç½®ä¸­é…ç½®çš„é‚£äº›TRAPå°†è½¬åˆ°/var/log/snmptt/snmpttunknown.logæ—¥å¿—ï¼Œä½†åªä¼šä»åœ¨åŒä¸€é…ç½®ä¸­ä¸ºå…¶é…ç½®äº†æ­£ç¡®ç”¨æˆ·å’ŒengineIDçš„ç¡¬ä»¶è¿›å…¥ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒTRAPå°†ä»å·¦è…ºä½“é»˜é»˜åœ°æ‰è½ï¼Œå¦‚æœæ‚¨æƒ³è¿›è¡Œå£å¤´æ±‡æŠ¥å’Œæ±‡æŠ¥ï¼Œé‚£ä¹ˆæ‚¨åœ¨net-snmpä¸Šæœ‰ä¸€ä¸ªå¼‚å¸¸å¥å£®çš„åŸºåº§ï¼ŒTRAPå’ŒINFORMä¹‹é—´çš„åŒºåˆ«åœ¨é‚£é‡Œä»ç„¶å¾ˆå¥½åœ°æè¿°äº†ï¼Œå±•æœ›æœªæ¥ï¼Œæœ€å¥½ä½¿ç”¨INFORMç­‰ã€‚ kã€‚é‚£é‡Œæœ‰æŸç§ä¼ é€’æ§åˆ¶ï¼Œä½†æ˜¯å®ƒé€šè¿‡UDPè€Œä¸æ˜¯UDPèµ·ä½œç”¨ã€‚ <br><br> è€Œä¸”åªæœ‰ç°åœ¨ï¼Œæˆ‘ä»¬æ‰å¼€å§‹é…ç½®æ˜¾ç¤ºå™¨ã€‚ <br><br><h2>  Zabbixè®¾å®š </h2><br><br> é¦–å…ˆï¼Œç¡®ä¿åœ¨/etc/zabbix/zabbix_server.confé…ç½®ä¸­ï¼Œå°†ç›‘è§†è®¾ç½®ä¸ºæ­£ç¡®çš„SNMPTTæ—¥å¿—ï¼Œå¹¶ä¸”Zabbixæœ¬èº«å¯åŠ¨è‡³å°‘ä¸€ä¸ªSNMPé™·é˜±ç¨‹åºï¼š <br><br> <code>SNMPTrapperFile=/var/log/snmptt/snmptt.log <br> StartSNMPTrapper=1</code> <br> <br> é¦–å…ˆï¼Œæˆ‘ç›´æ¥åœ¨ä¸»æœºä¸Šåˆ›å»ºäº†Itemï¼Œä»¥ä¾¿æ›´å¿«ï¼Œæ›´è½»æ¾åœ°æ•æ‰ç‰¹æ•ˆã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†ç«‹å³ç¼–å†™å¦‚ä½•åˆ›å»ºæ¨¡æ¿çš„æ–¹æ³•ï¼Œå› ä¸ºåªè¦æœ‰å¯èƒ½ï¼Œå°±åº”è¯¥ä½¿ç”¨æ¨¡æ¿ã€‚ æˆ‘å°†ä¸ºæ‚¨å±•ç¤ºå›¾ç‰‡ï¼Œå¤åˆ¶ç²˜è´´å…è´¹èµ å“å·²ç»ç»“æŸï¼Œä½†æˆ‘ä¼šç»˜åˆ¶æ‚¨éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚ <br><br> åˆ›å»ºä¸€ä¸ªæ¨¡æ¿ï¼š <br><br><img src="https://habrastorage.org/webt/h_/ne/mw/h_nemwwcsrjzr1dvlqimgrmsq5e.png" alt="å›¾ç‰‡"><br><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç»™ä¸€ä¸ªç†æ™ºçš„åå­— <br><br> åˆ›å»ºé¡¹ç›® <br><br><img src="https://habrastorage.org/webt/-c/hz/8k/-chz8klwqft17k391xp7epqusfs.png" alt="å›¾ç‰‡"><br><br> é‡è¦-å…³é”®åº”è¯¥æ˜¯è¿™æ ·ï¼Œæ–¹æ‹¬å·ä¸­æ˜¾ç¤ºçš„æ˜¯Zabbixå°†åœ¨æ—¥å¿—ä¸­æŸ¥æ‰¾çš„å†…å®¹ï¼Œæˆ‘ä»¬åœ¨/etc/snmp/snmptt.confä¸­é…ç½®äº†æ—¥å¿—æ ¼å¼ï¼Œå¹¶åœ¨å…¶ä¸­å†™é“ï¼š <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">EVENT</span></span> ospfNbrStateChange .<span class="hljs-number"><span class="hljs-number">1.3.6.1</span></span>.<span class="hljs-number"><span class="hljs-number">2.1.14.16</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-string"><span class="hljs-string">"OSPF"</span></span> Normal FORMAT ZBXTRAP <span class="hljs-variable"><span class="hljs-variable">$aA</span></span> OSPF neighbor with IP addr <span class="hljs-variable"><span class="hljs-variable">$2</span></span> changed state to <span class="hljs-variable"><span class="hljs-variable">$5</span></span></code> </pre> <br> å®é™…ä¸Šï¼Œåœ¨æ—¥å¿—ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„è¯â€œ OSPFâ€ï¼Œå¹¶æ˜¾ç¤ºï¼š <br><br><pre> <code class="hljs css">2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:25</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:38</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span></code> </pre> <br> æˆ‘ä»¬åœ¨/etc/snmp/snmptt.inié…ç½®ä¸­å®šä¹‰çš„æ—¥æœŸæ ¼å¼ï¼š <br><br><pre> <code class="hljs perl">date_time_format = %Y %m %d %H:%M:%S</code> </pre> <br> æˆ‘åœ¨ä¸Šé¢å†™çš„å†…å®¹-ä½¿ç”¨å¯¹æ‚¨æ–¹ä¾¿çš„ä»»ä½•æ ¼å¼ï¼Œä¸»è¦æ˜¯è¦åœ¨æ­£ç¡®çš„ä½ç½®è¿›è¡ŒåŒ¹é…ã€‚ <br><br> åˆ›å»ºè§¦å‘å™¨ <br><br><img src="https://habrastorage.org/webt/7q/ci/b4/7qcib4j6sxnym61nykigci8gyac.png" alt="å›¾ç‰‡"><br><br> é‚»å±…å¯èƒ½æœ‰å‡ ç§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çŠ¶æ€</a> ï¼š <br><br><pre> <code class="hljs swift"><span class="hljs-number"><span class="hljs-number">1</span></span> : down <span class="hljs-number"><span class="hljs-number">2</span></span> : attempt <span class="hljs-number"><span class="hljs-number">3</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> : twoWay <span class="hljs-number"><span class="hljs-number">5</span></span> : exchangeStart <span class="hljs-number"><span class="hljs-number">6</span></span> : exchange <span class="hljs-number"><span class="hljs-number">7</span></span> : loading <span class="hljs-number"><span class="hljs-number">8</span></span> : full</code> </pre> <br> é‚»å±…æ‰€å¤„çš„çŠ¶æ€å®Œå…¨ä¸é‡è¦ï¼Œå¦‚æœæ­¤çŠ¶æ€ä¸æ˜¯FULLï¼Œå› ä¸ºè¦è¿›è¡Œè¯Šæ–­ï¼Œæ‚¨ä»ç„¶å¿…é¡»åŠ¨æ‰‹ï¼Œé˜…è¯»æ—¥å¿—ï¼Œè¾“å…¥ä¸€äº›å‘½ä»¤ã€‚ å› æ­¤ï¼Œè§¦å‘å™¨å°†æ˜¯ä¸€ä¸ªè§¦å‘å™¨ï¼Œå¹¶ä¸”ä»…å½“åœ¨TRAPä¸­é‚»å±…çš„çŠ¶æ€ä¸æ˜¯FULLæ—¶æ‰ä¼šè¢«æ¿€å‘ã€‚ <br><br> åœ¨å°†æ¨¡æ¿æŒ‚åœ¨ç‰¹å®šä¸»æœºä¸Šä¹‹å‰ï¼Œè¯·ç¡®ä¿ä¸ºä¸»æœºé…ç½®äº†å…·æœ‰æ­£ç¡®IPåœ°å€çš„æ­£ç¡®SNMPæ¥å£ï¼Œå¦åˆ™æ¢¯å½¢å›¾å°†ä½äº/var/log/snmptt/snmptt.logæ—¥å¿—ä¸­ï¼Œä½†æ˜¯Zabbixä¸ä¼šå°†å®ƒä»¬â€œç»‘å®šâ€åˆ°ä¸»æœºä¸Šã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨æœåŠ¡å™¨/var/log/zabbix/zabbix_server.logçš„Zabbixæ—¥å¿—ä¸­ï¼Œå°†å‡ºç°ä»¥ä¸‹å½¢å¼çš„æ¶ˆæ¯ï¼š <br><br><pre> <code class="hljs css">19972<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20180720</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:091722.896</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">unmatched</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">trap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">received</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> "192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span>": 2018 07 20 09<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:17</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:21</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.64</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span></code> </pre> <br><br> è½¬åˆ°æœ€æ–°æ•°æ®ï¼Œè¯·å‚è§ <br><br><img src="https://habrastorage.org/webt/pu/gj/w9/pugjw9j9ccjdnkj6x50trsfqeoc.png" alt="å›¾ç‰‡"><br><br> æ‰³æœºä¹Ÿèµ·ä½œç”¨ <br><br><img src="https://habrastorage.org/webt/fm/wc/gp/fmwcgp5pjammodrcqjsrj3zpebe.png" alt="å›¾ç‰‡"><br><br> ç°åœ¨æ”¾ä¸¤ä¸ªé‚»å±… <br><br><img src="https://habrastorage.org/webt/7e/uh/d5/7euhd5pegn-7b_6ofpxmbctzt8c.png" alt="å›¾ç‰‡"><br><br> åœ¨ä»ªè¡¨æ¿ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å‘ç”Ÿäº†ä¸¤ä¸ªé—®é¢˜ï¼Œè¿™å¾ˆå¥½ï¼Œç”šè‡³åœ¨é…ç½®äº†é€šçŸ¥çš„æƒ…å†µä¸‹ï¼Œå³ä½¿æœ‰ä¸¤ä¸ªå­—æ¯ä¹Ÿä¼šåˆ°è¾¾æ­¤ä¸»é¢˜ã€‚ <br><br> ä¸€åˆ‡éƒ½å¾ˆæ£’ï¼Œä¸€åˆ‡æ­£å¸¸ï¼Œè¿™æ˜¯æœ€åçš„è›‹ç³•ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ç»æœ›</b> <div class="spoiler_text"> ç°åœ¨ï¼Œæˆ‘ä»¬è¦æŠšå…»ä¸€ä¸ªé‚»å±…ã€‚ åŒæ—¶ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜å°†ç«‹å³åœ¨ä»ªè¡¨æ¿ä¸Šæ¶ˆå¤±ã€‚ è¿™ä¸æ˜¯é”™è¯¯ï¼Œè€Œæ˜¯åŠŸèƒ½ã€‚ æµ‹è¯•æ¨¡æ¿æ—¶ï¼Œæˆ‘ä¸å°å¿ƒæ³¨æ„åˆ°äº†è¿™ç§ç»†å¾®å·®åˆ«ã€‚ ç»“æœï¼Œå¦‚æœå‡ ä¸ªé‚»å±…æ‰ä¸‹æ¥ï¼Œç„¶åå…¶ä¸­ä¸€ä¸ªé‚»å±…å‡èµ·ï¼Œæˆ–è€…å³ä½¿ä¸€ä¸ªé‚»å±…å‡èµ·äº†ï¼ˆä»¥å‰æ ¹æœ¬ä¸å­˜åœ¨ï¼‰ï¼Œåˆ™ç›‘è§†å°†å˜ä¸ºç»¿è‰²ã€‚ <br> å½“ç„¶ï¼Œæ‚¨å¯ä»¥ç”¨æ‰‹é…ç½®Itemæ¥è·Ÿè¸ªç‰¹å®šçš„é‚»å±…ï¼Œä»ç„¶å¯ä»¥ç¼–å†™ä¸€äº›è„šæœ¬ï¼Œè¿˜å¯ä»¥ä»æœ¬æ–‡çš„å¼€å¤´è¿”å›SNMPä¸Šä¸‹æ–‡ã€‚ è¿˜æœ‰ä¸€ç§æƒ³æ³•æ˜¯ç»˜åˆ¶ä¸€ä¸ªè„šæœ¬ï¼Œè¯¥è„šæœ¬å°†é€šè¿‡SSH / APIä¼ é€’åˆ°ç½‘ç»œè…ºä½“ï¼Œæ”¶é›†æœ‰å…³æ‰€æœ‰é‚»å±…çš„ä¿¡æ¯ï¼Œè¿›è¡Œâ€œæœ‰æ•ˆâ€è½¬æ¢ï¼Œåˆ†ææ£€æŸ¥ä¹‹é—´çš„å·®å¼‚ï¼Œå¹¶åœ¨æ—¥å¿—ä¸­å†™é”™ä»€ä¹ˆï¼Œç„¶åå°†æ—¥å¿—é¦ˆé€åˆ°ç›‘è§†å™¨â€¦â€¦è¿™å¾ˆå›°éš¾ã€‚ æˆ‘æƒ³è¦æœ€å°‘çš„æ‹æ–å’Œä¹ ä¿—ã€‚ å¦‚æœæ‚¨çŸ¥é“è§£å†³æ­¤é—®é¢˜çš„æ˜æ™ºæ–¹æ³•ï¼Œæˆ–è€…è®¤ä¸ºæˆ‘åšé”™äº†æ‰€æœ‰äº‹æƒ…ï¼Œè¯·å†æ¬¡åœ¨è¯„è®ºä¸­è¯¢é—®ï¼Œè€Œåœ¨å“åº”æ–‡ç« ä¸­è¯¢é—®ã€‚ <br></div></div><br><br>  UPDï¼šæˆ‘ä»¬çš„åŒäº‹å»ºè®®æˆ‘ä»¬è¿›è¡Œæ’åºï¼Œå¹¶å°è¯•ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SNMPä¸Šä¸‹æ–‡</a>å®æ–½æˆ‘ä»¬çš„è®¡åˆ’ã€‚ æœ‰éœ€æ±‚ï¼Œå°±ä¼šæœ‰ä¾›åº”ã€‚ å±•æœ›æœªæ¥ï¼Œæˆ‘å¯ä»¥è¯´-é­”é¬¼å¹¶ä¸é‚£ä¹ˆå¯æ€•ï¼Œæˆ‘ä»¬èµ°å§ã€‚ <br> åœ¨ä¸€å—é“ç½‘ä¸Šï¼Œæˆ‘ä»¬ç»˜åˆ¶äº†ä¸€æ¡ç¥å¥‡çš„å‘½ä»¤ï¼š <br><br> <code>snmp-server context {snmp context name} instance {protocol instance} vrf {vrf name}</code> <br> <br> å‚æ•°åç§°éœ€è¦æ¾„æ¸… <br>  {snmpä¸Šä¸‹æ–‡åç§°}-å°†åœ¨è¯·æ±‚ä¸­ä½¿ç”¨çš„SNMPä¸Šä¸‹æ–‡çš„åç§°ã€‚ <br> æˆ‘ä»¬ä»å·²é…ç½®çš„OSPFè¿›ç¨‹çš„é…ç½®ä¸­è·å–{protocol instance}å’Œ{vrf name}ï¼š <br><br> <code>router ospf {protocol instance} <br> .. <br> vrf {vrf name} <br> ..</code> <br> <br> æœ‰äººæ‹…å¿ƒåœ¨è¿›è¡Œäº†è¿™æ ·çš„è®¾ç½®åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç©ºä¸Šä¸‹æ–‡é€šè¿‡SNMPç ´åå·²ç»é…ç½®çš„é¡¹ï¼Œä½†æ˜¯æˆ‘æ£€æŸ¥äº†è¯¥è®¾ç½®ä»…å½±å“é€šè¿‡OSPF-MIBçš„æ•°æ®è¾“å‡ºï¼Œè€Œä¾‹å¦‚ä»IF-MIBéƒ¨åˆ†ä¸­ï¼Œæ‰€æœ‰å†…å®¹éƒ½åƒä»¥å‰ä¸€æ ·ä½¿ç”¨ç©ºä¸Šä¸‹æ–‡ç»§ç»­è¿”å›ã€‚ å¦‚æœæ‚¨æ²¡æœ‰Nexusï¼Œå»ºè®®æ‚¨å†æ¬¡æ£€æŸ¥è¿™ä¸€ç‚¹-è¡Œä¸ºå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ <br><br> ç°åœ¨åœ¨Zabbixä¸­æ‰­æ›²æ¨¡æ¿ã€‚ <br> æ‚¨å¿…é¡»ä½¿ç”¨ä¸Šä¸‹æ–‡åˆ›å»ºæ–°çš„å‘ç°è§„åˆ™ï¼š <br><br><img src="https://habrastorage.org/webt/by/xd/ph/byxdpha64kwdstjxoipfjr3avl0.png" alt="å›¾ç‰‡"><br><br> æ–°é¡¹ç›®åŸå‹ä¹Ÿå…·æœ‰ä¸Šä¸‹æ–‡ <br><br><img src="https://habrastorage.org/webt/oy/e1/2x/oye12xxe-ec-ohifymjb-zizpom.png" alt="å›¾ç‰‡"><br><br> è¿˜æœ‰ä¸¤ä¸ªè§¦å‘å™¨ï¼ˆç¬¬ä¸€ä¸ªè§¦å‘å™¨ï¼‰ï¼Œç”¨äºåœ¨é‚»å±…å¤„äºé™¤FULLä¹‹å¤–çš„ä»»ä½•çŠ¶æ€æ—¶å‘å‡ºçš„è­¦æŠ¥ï¼š <br><br><img src="https://habrastorage.org/webt/rj/gs/os/rjgsosmcwivhwhxjtnjheyymhza.png" alt="å›¾ç‰‡"><br><br> ç¬¬äºŒä¸ª-å¦‚æœé‚»å±…ä¸è§äº†ï¼š <br><br><img src="https://habrastorage.org/webt/sb/cx/i3/sbcxi3qrz-d-c82vyk_khmaw6im.png" alt="å›¾ç‰‡"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN417813/">https://habr.com/ru/post/zh-CN417813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN417795/index.html">æˆ‘åå‡ å²å¯¹ç”µå­æ¸¸æˆçš„ç—´è¿·ä¸æ˜¯â€œæ¸¸æˆéšœç¢â€</a></li>
<li><a href="../zh-CN417797/index.html">NASAé¡¹ç›®è¿åæˆªæ­¢æ—¥æœŸå¹¶å¤¸å¤§é¢„ç®—çš„4ä¸ªåŸå› </a></li>
<li><a href="../zh-CN417801/index.html">å°é”ç”µæŠ¥åæˆ‘å¦‚ä½•æ¬åˆ°ä»¥è‰²åˆ—</a></li>
<li><a href="../zh-CN417803/index.html">Blenderä¸­çš„æ‰¹é‡ç…§ç‰‡å¤„ç†</a></li>
<li><a href="../zh-CN417809/index.html">AIï¼Œå®è·µè¯¾ç¨‹ã€‚ ç”¨äºå›¾åƒåˆ†ç±»çš„ç°ä»£æ·±åº¦ç¥ç»ç½‘ç»œæ¶æ„</a></li>
<li><a href="../zh-CN417821/index.html">ç½‘ç»œæ‘˜è¦ï¼š20ç§æœ‰å…³åè®®ï¼Œæ ‡å‡†å’Œä¿¡æ¯å®‰å…¨çš„ä¸“å®¶ææ–™</a></li>
<li><a href="../zh-CN417823/index.html">æ–°ä¸€ä»£ï¼šå…¨çƒé¦–ä¸ªå•†ç”¨5Gç½‘ç»œå¯åŠ¨</a></li>
<li><a href="../zh-CN417825/index.html">â€œæ‰©å±•è¾¹ç•Œâ€ï¼š6 GHzèŒƒå›´å°†æ»¡è¶³Wi-Fiçš„éœ€æ±‚</a></li>
<li><a href="../zh-CN417827/index.html">å…è´¹Wi-Fiï¼šå¾·å›½æ³•é™¢åºŸé™¤äº†å’–å•¡é¦†ä¾µçŠ¯é¡¾å®¢ç‰ˆæƒçš„æƒ©ç½šæªæ–½</a></li>
<li><a href="../zh-CN417829/index.html">å°†æ¶æ„çš„å±‚æ•°ä»5å‡å°‘åˆ°2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>