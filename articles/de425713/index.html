<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüè≠ üí™üèº ü§æ Integration der HTML-Engine in native Windows-Anwendungen - Auswahl und Architektur üö® üíÖüèæ üéë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie wir √ºbersetzt haben, funktioniert mit HTML in 1C: Enterprise von Internet Explorer nach WebKit 

 Die M√∂glichkeit, HTML in 1C-Formularen anzuzeige...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Integration der HTML-Engine in native Windows-Anwendungen - Auswahl und Architektur</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/1c/blog/425713/">  <b>Wie wir √ºbersetzt haben, funktioniert mit HTML in 1C: Enterprise von Internet Explorer nach WebKit</b> <br><br>  Die M√∂glichkeit, HTML in 1C-Formularen anzuzeigen, wurde 2003 in Version 8.0 auf der 1C: Enterprise-Plattform angezeigt.  Um mit HTML zu arbeiten, verwendete die Plattform die Browser-Engine Internet Explorer (1C: Enterprise funktionierte zu dieser Zeit nur unter Windows).  Die Browser-Engine wurde von der Plattform f√ºr n√ºtzliche Zwecke verwendet.  Zum Beispiel, um ein vollwertiges <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Element</a> zum Bearbeiten von Text a la Word von Grund auf neu zu schreiben - mit der M√∂glichkeit verschiedener Farb- und Schriftl√∂sungen, Einf√ºgen von Bildern usw.  - eine sehr schwierige Aufgabe.  Wenn Sie f√ºr diese Zwecke HTML verwenden und die Internetbrowser-Engine als Anzeigetool verwenden, wird die Aufgabe erheblich vereinfacht.  Mithilfe der Engine wurden auch eine Reihe anderer Mechanismen (z. B. Anzeigen von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hilfeinformationen</a> ) und Elemente (z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Scheduler</a> ) implementiert. <br><br>  Die M√∂glichkeit f√ºr Anwendungsentwickler, nach benutzerdefinierten HTML-Designs nach den Standards der Welt der Buchhaltungssysteme anzuzeigen, erm√∂glichte es manchmal, eine Vielzahl angenehmer Highlights in die Benutzeroberfl√§che von Gesch√§ftsanwendungen zu bringen. <br><br>  Mit der Zeit begann die Plattform zuerst Linux und dann macOS zu unterst√ºtzen.  Internet Explorer war aus offensichtlichen Gr√ºnden nicht f√ºr die Arbeit mit HTML in diesen Betriebssystemen geeignet.  Unter Linux verwendeten wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WebKitGTK +</a> und auf macOs eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cocoa-</a> basierte Bibliothek.  Daher wurde in diesem Bereich die Einheit der Codebasis f√ºr verschiedene Betriebssysteme (die wir versuchen, f√ºr den Clientcode auf einer Ebene von 95% zu halten) verletzt.  Nun, die IE-Engine ist zu diesem Zeitpunkt zur Quelle einer Reihe von Problemen geworden. <br><img src="https://habrastorage.org/webt/xo/c6/2k/xoc62k11ifqv9dfeunr279csd4q.png" alt="Bild"><br><a name="habracut"></a><br>  Die Probleme: <br><br><ul><li>  Die IE-Engine hat den Quellcode geschlossen - das bedeutet: <br><ul><li>  Eine flexible Anpassung des Motors an die Bed√ºrfnisse der Plattform ist nicht m√∂glich </li><li>  Debuggen und Verstehen von Prozessen im Inneren </li><li>  Fehler und Fehler k√∂nnen nicht durch Aktualisieren der Engine-Version behoben werden </li></ul></li><li>  Die Engine ist nicht f√ºr die Implementierung moderner Webprogrammieraufgaben geeignet </li><li>  Leistungsprobleme bei schwachen Maschinen </li></ul><br>  Die √úbersetzung der Arbeit mit HTML in Version 1C: Enterprise f√ºr Windows von der IE-Engine auf etwas anderes war also offensichtlich.  Was soll ich w√§hlen? <br><br>  Zun√§chst haben wir die Anforderungen an den Motor formuliert: <br><br><ul><li>  Unterst√ºtzung f√ºr moderne Webprogrammiertechnologien </li><li> Open Source f√ºr die flexible Anpassung der Engine und das Verst√§ndnis ihrer Logik </li><li>  Hohe Leistung auf langsameren Computern </li><li>  Es ist w√ºnschenswert, dass die Engine eine kleine Anzahl von Bibliotheken von Drittanbietern ben√∂tigt, um zu funktionieren </li></ul><br><h2>  Motorauswahl </h2><br>  Was zur Auswahl?  Wir haben nat√ºrlich mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WebKit begonnen</a> , mit dem wir bereits in Versionen der Plattform f√ºr Linux und macOS gearbeitet haben. <br><br>  WebKit wurde Anfang der 2000er Jahre bei Apple auf Basis der Open-Source-Engines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">KHTML</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">KJS entwickelt</a> .  Basierend auf WebKit wurde sp√§ter der Safari-Browser erstellt - Chrome (auch sp√§ter wechselte Chrome von WebKit zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Blink</a> , das wiederum auf WebCore-Code von WebKit basiert). <br><br>  Der Quellcode f√ºr WebKit ist Open Source und unter der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LGPL lizenziert</a> .  WebKit ist f√ºr macOS geschrieben, es gibt mehrere Ports f√ºr Windows: <br><br><h3>  WebKit AppleWin </h3><br>  Dies ist der Port, den WebKit-Entwickler standardm√§√üig unter Windows erstellen m√∂chten.  Es wurde von Apple-Mitarbeitern Mitte bis Ende der 2000er Jahre hergestellt.  Es verwendet die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CoreGraphics-</a> Grafikbibliothek, eine vereinfachte Version der f√ºr Windows portierten Bibliothek f√ºr macOS.  Zum Ausf√ºhren von JavaScript verwendet der Port die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JavaScriptCore-</a> Bibliothek mit derselben API, die bei der Implementierung der Plattform f√ºr Linux verwendet wird.  Dies macht es zu einem Hauptkandidaten f√ºr die Verwendung. <br><br><h3>  WebKit WinCairo </h3><br>  Dieser Port verwendet die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cairo-</a> Bibliothek f√ºr Grafiken.  Apple entwickelt diesen Port seit einiger Zeit aktiv als Analogon zum AppleWin-Hauptport.  Der Vorteil dieses Ports besteht darin, dass er weniger von den f√ºr CoreGraphics erforderlichen macOS-spezifischen Bibliotheken abh√§ngig ist.  Dar√ºber hinaus verwendet der Port dieselbe Grafikbibliothek ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kairo</a> ) wie die WebKitGTK + -Engine, die wir in der Linux-Implementierung der Plattform verwenden, um das Verhalten unseres Codes zu standardisieren. <br><br><h3>  QtWebKit </h3><br>  Eine weitere Implementierung der WebKit-Engine f√ºr Windows, die jetzt unabh√§ngig von den Entwicklern der Engine selbst ist.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Qt</a> ist eine beliebte plattform√ºbergreifende Bibliothek mit einer eigenen QtGui-Grafikbibliothek.  Dieser Port verwendet auch die JavaScriptCore-Bibliothek, um JavaScript zu verarbeiten, hat jedoch Nachteile: <br><br><ul><li>  Starke Abh√§ngigkeit von den Hauptkomponenten von Qt, die, wenn sie in Software von Drittanbietern verwendet werden, mitgeliefert werden m√ºssen </li><li>  Ein anderer Satz von Schnittstellen f√ºr die Arbeit mit Komponenten zum Rendern von HTML als WebKitGTK und eine eigene Logik f√ºr die Arbeit mit diesen. </li></ul><br><h3>  WebKitGtk + f√ºr Windows </h3><br>  Wir haben WebKitGtk + bereits in der Linux-Version der Plattform verwendet.  Die Option zur Verwendung unter Windows wurde jedoch aufgrund der Komplexit√§t der Assembly, der schlechten Dokumentation dieses Prozesses und des Mangels an st√§ndiger Unterst√ºtzung f√ºr diesen Entwicklungsbereich durch die Entwickler von WebKitGTK + ausgeschlossen. <br><br><h3>  Chrom (Blinken) </h3><br>  Die erste und einzige nicht WebKit-√§hnliche Engine, die als Kandidat f√ºr die L√∂sung des Problems angesehen wurde.  Es wurde aufgrund gro√üer Unterschiede in der Logik der Komponenten zum Rendern von HTML im Vergleich zu WebKitGTK + und einer anderen Bibliothek f√ºr die Arbeit mit JavaScript ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V8</a> ) abgelehnt. <br><br><h3>  Was soll ich w√§hlen? </h3><br>  Nach Recherchen erreichten AppleWin und WinCairo das Finale. <br>  Um die endg√ºltige Entscheidung zu treffen, haben wir untersucht, wie WebKit funktioniert. <br><br><h2>  WebKit-Engine-Struktur </h2><br>  In der Regel unterscheiden sich verschiedene WebKit-Ports auf zwei Arten.  Die erste ist direkt die Implementierung f√ºr ein bestimmtes Betriebssystem unter Verwendung betriebssystemspezifischer Komponenten.  Die zweite ist eine Grafikbibliothek.  Die folgende Abbildung beschreibt die Unterschiede in diesem Sinne zwischen WebKit-Ports.  F√ºr Windows haben WebKit-Entwickler Ports f√ºr die angepasste CoreGraphics- und Cairo-Bibliothek geschrieben. <br><br><img src="https://habrastorage.org/webt/y5/m5/mo/y5m5moefn2yjpbt4ohq9iwqqqj4.png" alt="Bild"><br><br>  Ein vereinfachtes Modell der Engine: Drei traditionelle Mechanismen zum Formatieren einer Webseite - HTML, JavaScript und CSS - werden der Engine zugef√ºhrt und bilden die Seite daraus und zeigen sie an: <br><br><img src="https://habrastorage.org/webt/j4/2n/r5/j42nr5vmxoryxsbq-c_mxe9oots.png" alt="Bild"><br><br>  Der Motor selbst besteht aus mehreren Komponenten: <br><br><ul><li>  WTF (Web Template Framework, nicht das, was Sie vielleicht <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gedacht haben</a> ): Hier finden Sie Ihre eigenen Implementierungen von Datenstrukturen f√ºr die Funktionsweise der Engine sowie die Arbeit mit Streams </li><li>  JavaScriptCore: Eine Komponente, wie der Name schon sagt, f√ºr die Arbeit mit der JavaScript-Sprache </li><li>  WebCore: Alle Arbeiten mit DOM, Stilen, HTML- und XML-Analyse werden hier geschrieben.  Hier wird die gesamte Hauptmagie des Motors ausgef√ºhrt. </li><li>  Plattform: F√ºhrt technische Aktionen f√ºr die Interaktion mit dem Netzwerk, das Platzieren von Daten in einer Datenbank, das Dekodieren von Bildern und das Arbeiten mit Medien aus </li><li>  WebKit und WebKit2-API - Verkn√ºpfung aller Komponenten und Bereitstellung des Zugriffs auf sie </li></ul><br><img src="https://habrastorage.org/webt/ao/zr/gp/aozrgpbezfy8ex2ufhbnrzqf68e.png" alt="Bild"><br>  Die Beziehung zwischen WebKit-Komponenten und betriebssystemspezifischen Funktionen ist in der folgenden Abbildung dargestellt.  Wie Sie sehen, gibt es einige spezifische Punkte, die f√ºr jedes Betriebssystem separat implementiert werden m√ºssen.  Mit JavaScriptCore k√∂nnen Sie sich jedoch in jedem Port ohne separate Implementierungen verwenden. <br><br><img src="https://habrastorage.org/webt/r7/hz/c8/r7hzc8sbq6bcn_qpltvdzpimugu.png" alt="Bild"><br><br><h3>  Wie eine Webseite entsteht </h3><br>  Vom Netzwerk kommt eine Antwort auf eine Anfrage an den Server mit Daten zum Herunterladen.  Der Loader √ºbergibt die Daten an den Parser, der in Interaktion mit der Komponente f√ºr JavaScript das DOM und das Stylesheet bildet.  Als n√§chstes werden die generierten Daten in den Rendering-Baum √ºbertragen und in einem grafischen Kontext angezeigt. <br><img src="https://habrastorage.org/webt/k-/id/dh/k-iddhrnyvvcw8yzacaigtetlai.png" alt="Bild"><br>  Die Seite selbst besteht ebenfalls aus einzelnen Komponenten.  Die WebCore-Komponente implementiert die Page-Klasse, die den Zugriff auf die gesamte Seite erm√∂glicht.  Seite hat einen Hauptrahmen - Hauptrahmen, ein Rahmen hat immer ein Dokument.  Der Hauptrahmen kann eine beliebige Anzahl anderer Rahmen enthalten, auch mit darin enthaltenen Dokumenten.  F√ºr jeden Frame werden einige Ereignisse separat gebildet sowie bestimmte Grafik- und JavaScript-Kontexte. <br><br><img src="https://habrastorage.org/webt/zv/fo/9c/zvfo9cqiclfhckd1wmzpnnv4jx4.png" alt="Bild"><br><br>  Der vereinfachte HTML-Parser funktioniert so.  Aus dem Satz von Bytes, die vom Server empfangen werden, generiert der Decoder einen Satz von Zeichen zum Parsen.  Symbole werden in Token oder Token konvertiert. Dies sind normalerweise elementare Codeteile mit Metainformationen dar√ºber, um welche Art von Text es sich handelt, ob er Teil der Sprachsyntax oder des Inhalts ist.  Dann werden Knoten aus Token gebildet, um einen DOM-Baum zu erstellen.  Ein Baumgenerator aus einer Reihe von Knoten bildet ein vollst√§ndiges Objektmodell f√ºr ein Webseitendokument. <br><br><img src="https://habrastorage.org/webt/iq/9q/b5/iq9qb5qwciws_d-rfzze2afuopw.png" alt="Bild"><br><br><h2>  Endg√ºltige Wahl </h2><br><ul><li>  Applewin <ul><li>  Vorteile: <ul><li>  Implementiert in einer Grafikbibliothek, die unter macOS ausgef√ºhrt wird - der Hauptzielplattform f√ºr WebKit-Entwickler </li></ul></li><li>  Nachteile: <ul><li>  Fehlende Implementierung des Druckmechanismus </li><li>  Eine gro√üe Anzahl von Abh√§ngigkeiten </li></ul></li></ul></li><li>  Wincairo <ul><li>  Vorteile: <ul><li>  Dieselbe Grafikbibliothek (Kairo) wie im Linux-Port der 1C-Plattform </li></ul></li><li>  Nachteile: <ul><li>  Wesentlich f√ºr unsere Aufgaben nicht gefunden </li></ul></li></ul></li></ul><br>  Besiegte WinCairo.  F√ºr die Entwicklung wurde die neueste Version von WebKit verwendet - 605.1.11. <br><br><h2>  Implementierung </h2><br>  Obwohl die Engine durch Unit-Tests ziemlich gut abgedeckt ist (etwa 30.000 f√ºr alle Komponenten der Engine, geschrieben von den Autoren der Engine), gibt es Fehler und M√§ngel bei der Implementierung f√ºr "Nicht-Core" -Betriebssysteme (dh f√ºr alles, was nicht macOS ist).  Diese Implementierungsl√ºcken wurden nach und nach entdeckt, als die Engine als Teil der 1C: Enterprise-Plattform entwickelt und getestet wurde. <br><br><h3>  Laden Sie HTML per Drag &amp; Drop herunter </h3><br>  Beim Ziehen von Text in das Fenster wurde festgestellt, dass Hieroglyphen in das endg√ºltige Dokument eingef√ºgt werden, wenn der zu ziehende Text Nicht-ASCII-Zeichen enth√§lt.  Der Fehler trat nur in der Windows-Implementierung der Engine auf, da sie mit einem betriebssystemspezifischen Mechanismus zum Ziehen und Ablegen von Elementen arbeitete.  Es stellt sich heraus, dass der Text nicht von UNICODE nach UTF-16 dekodiert wurde, bevor er an den Ereignishandler zum Einf√ºgen √ºbergeben wurde. <br><br><h3>  √Ñndern Sie Umschalt + Tastaturverhalten eingeben </h3><br>  In den meisten Texteditoren (einschlie√ülich Microsoft Word) f√ºgt diese Kombination einen Zeilenumbruch ein.  Das Standardverhalten von WebKit besteht darin, einen neuen Absatz einzuf√ºgen (als ob Sie einfach die Eingabetaste dr√ºcken).  Wir haben die Engine ge√§ndert, um das Verhalten den Benutzern besser bekannt zu machen. <br><br><h3>  Organisation des R√ºckg√§ngig- und Wiederherstellungsmechanismus. </h3><br>  WebKit bietet eine API zum Implementieren eines eigenen Mechanismus zum Abbrechen und Wiederholen von Benutzeraktionen.  Das Schema lautet wie folgt: Wenn der Benutzer eine bestimmte Aktion aus Sicht der Engine diskret ausf√ºhrt (z. B. Wechseln zu einem neuen Absatz, Formatieren in Kursivschrift, Einf√ºgen), informiert WebKit den Entwickler mithilfe der API dar√ºber, damit er diese Aktion registrieren kann. <br><br>  Beim Testen des implementierten Mechanismus wurde ein unangenehmes Problem festgestellt: Die Engine meldet keine √Ñnderungen in der Struktur der Tabellen.  Es wurden Befehle zum Hinzuf√ºgen und Entfernen von Zellen und zum √Ñndern des colSpan-Attributs hinzugef√ºgt, die Teil zusammengesetzter Aktionen wurden, z. B. zum Hinzuf√ºgen / Entfernen einer Spalte oder Zeile in einer Tabelle.  Solche zusammengesetzten Befehle werden im selben R√ºckg√§ngig- und Wiederherstellungsstapel registriert und stellen zusammen mit den Befehlen der Engine den korrekten Betrieb des Mechanismus sicher. <br><br><h3>  Aus Excel einf√ºgen </h3><br>  Diejenigen, die mit der Windows- und Excel-Zwischenablage gearbeitet haben, wissen m√∂glicherweise, dass erstens beim Kopieren von Excel nach HTML das Zwischenablageformat im kopierten Fragment nur die Tags der Zellen und Zeilen enth√§lt, nicht jedoch das Tag der Tabelle selbst, und zweitens. Stile aus einem Excel-Dokument werden nicht in Zellen √ºbertragen.  Aus diesem Grund sieht das Einf√ºgen einer Farbtabelle in ein bearbeitbares Element in Chrome folgenderma√üen aus: <br><br>  Original: <br><br><img src="https://habrastorage.org/webt/gp/qu/fd/gpqufdcqtefrrio5zechwq0ufus.png" alt="Bild"><br><br>  In Chrome: <br><br><img src="https://habrastorage.org/webt/gf/6y/uu/gf6yuuqrxmu8il-7bgoeql7xtwy.png" alt="Bild"><br><br>  Beide Faktoren wurden von den Entwicklern von WebKit nicht ber√ºcksichtigt.  Die Offenheit des Engine-Codes erm√∂glichte es uns, den Einf√ºgemechanismus zu verfeinern, und jetzt liegt das Fragment der Tabelle, das in das HTML-Feld des Dokuments eingef√ºgt wurde, nahe am Original: <br><br><img src="https://habrastorage.org/webt/l8/pi/bo/l8piboap1-odjv6iwb2jd4zdhim.png" alt="Bild"><br><br><h3>  Kursive Schriftgenerierung </h3><br>  Wenn Windows keine kursive Version einer nicht standardm√§√üigen Schriftart hat, k√∂nnen die meisten Texteditoren eine solche Schriftart mit ihrer regul√§ren Version generieren.  WebKit war jedoch nicht in der Lage, dies zu tun, und f√ºhrte Entwickler einige Male in die Irre: Wie kommt es, dass wir im HTML-Code des Dokuments den Text in das &lt;i&gt; -Tag einf√ºgen, der Text jedoch trotzdem gerade bleibt?  Der Grund daf√ºr ist, dass die WebKit-Engine die gew√ºnschte Schriftart im von uns verwendeten WinCairo-Port ausw√§hlt. Wenn keine kursive Version vorhanden ist, verwendet die Engine die regul√§re Version.  Dieses Verhalten wurde durch die Verwendung der von der Grafikbibliothek in Kairo generierten Kursivschrift ersetzt. <br><br><h3>  Fehler beim Dekodieren von Bildern und Animationen </h3><br>  Es wurden Fehler im Verhalten der Engine beim Arbeiten mit grafischen Elementen gefunden.  Beim Laden einiger Bilder im PNG-Format wurde eine Bildverzerrung und manchmal √ºberhaupt keine beobachtet.  Der Grund f√ºr dieses Verhalten konnte nicht ermittelt werden, da beim Dekodieren von Bildern im Darm der libpng-Bibliothek ein Fehler auftritt. <br><br>  Empirisch wurde festgestellt, dass das Problem behoben ist, wenn die libpng-Bibliothek nicht dynamisch, sondern dynamisch verkn√ºpft wird.  In der aktuellen Version der Engine erfolgt die Verkn√ºpfung √ºbrigens auf diese Weise.  Es wurde beschlossen, dasselbe zu tun. <br><br>  Ein weiteres Problem war die Engine beim Laden von Animationen im GIF-Format.  Der Fehler wurde beim Laden der Seite mit solchen Animationen regelm√§√üig reproduziert und f√ºhrte zum Absturz des Programms.  Der Fehler wurde durch die fehlende Synchronisation beim Arbeiten mit dem Puffer verursacht, in den das n√§chste Bild der Animation eingef√ºgt wird.  Das Problem wurde mithilfe interner WebKit-Synchronisierungstools behoben. <br><br><h3>  Rechtschreibunterst√ºtzung </h3><br>  In der Assembly mit Internet Explorer konnte in Windows Version 8 und h√∂her die Rechtschreibpr√ºfung f√ºr das bearbeitbare HTML-Feld aktiviert werden.  Dazu gen√ºgte es, "Rechtschreibpr√ºfung" gleich "wahr" zuzuweisen.  WebKit hatte verschiedene L√∂sungen f√ºr verschiedene Ports: Unter Linux ist es die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Enchant-</a> Bibliothek, unter macOS hat es einen eigenen Mechanismus, der allen Benutzern von Apple-Produkten vertraut ist.  F√ºr Windows gibt es jedoch keine Implementierung, sondern eine API f√ºr die eigene L√∂sung.  Wir haben die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Windows-Rechtschreibpr√ºfungs-API verwendet</a> , die ab Windows 8 verf√ºgbar ist, und einen Mechanismus implementiert, der dem Build mit Internet Explorer √§hnelt.  √úbrigens funktioniert diese Funktionalit√§t jetzt auch in einem formatierten Dokument in nativen 1C: Enterprise-Clients.  Vor Version 8.3.14 war es aufgrund der schlechten Leistung des Internet Explorers deaktiviert. <br><br><h3>  Windows XP-Unterst√ºtzung </h3><br>  Einige unserer Clients arbeiten noch unter Windows XP und werden das Betriebssystem in naher Zukunft nicht aktualisieren.  Traurig f√ºr uns als Entwickler, aber wahr.  Also - wir m√ºssen sie unterst√ºtzen.  Und hier hatten wir eine unangenehme √úberraschung: WebKit-Entwickler haben die Engine in WinXP seit etwa einem Jahr nicht mehr unterst√ºtzt.  Der Versuch, eine Version der Engine mit einer Reihe von Build-Tools f√ºr WinXP zu erstellen, war erfolglos. WebKit-Entwickler verwenden Bibliotheken, die nur unter Windows Vista und h√∂her verf√ºgbar sind. <br><br>  Was zu tun ist?  Die Optionen waren wie folgt: <br><br><ol><li>  Verlassen Sie die WinXP-Implementierung mit der Internet Explorer-Engine und verwenden Sie WebKit in √§lteren Windows-Versionen </li><li>  Nehmen Sie f√ºr die Entwicklung eine fr√ºhere Version der WebKit-Engine, die in WinXP funktioniert, und verwenden Sie diese Version in allen Betriebssystemen </li><li>  Verwenden Sie die entsprechende Version von WebKit in WinXP und die neueste Engine in √§lteren Windows-Versionen </li><li>  Portieren Sie die aktuelle Version der Engine selbst auf WinXP und verwenden Sie sie √ºberall </li></ol><br>  Die Frage war nicht einfach.  Mit der ersten Option konnten Sie die neueste Version der WebKit-Engine verwenden, mussten jedoch die alte Implementierung mit Internet Explorer zur√ºckgeben.  In einer solchen L√∂sung w√§re es schwierig, einen fehlerfreien Betrieb des Programms sicherzustellen, und der Code selbst w√§re sehr kompliziert.  Die zweite Option bot auf allen Windows-Betriebssystemen das gleiche Verhalten, lie√ü uns jedoch nicht die M√∂glichkeit zur Entwicklung - Aktualisierung der Engine, um Fehler zu beheben und neue Funktionen von den Entwicklern der Engine in sp√§teren Versionen zu erhalten.  Mit der dritten Option konnten Sie die aktuelle Version der Engine in √§lteren Windows-Versionen verwenden, die Installationslogik wurde jedoch erheblich kompliziert und das gleiche Versionsverhalten auf allen Betriebssystemen sichergestellt.  Die vierte Option schien allen anderen vorzuziehen, aber es war unm√∂glich, die Komplexit√§t und im Allgemeinen die M√∂glichkeit einer solchen L√∂sung vorherzusagen. <br><br>  Trotzdem haben wir uns entschlossen, das Risiko einzugehen und die vierte Option zu implementieren, die aus architektonischer Sicht am korrektesten ist (unter Verwendung eines einzigen Engine-Quellcodes unter allen Windows-Versionen).  Die portierte Version von WebKit funktioniert in WinXP und neueren Windows-Versionen anders: <br><br><ul><li>  Ich musste die Tools des neuen DirectX (d3d11) zugunsten des alten DirectX9 (d3d9) aufgeben und seine Header-Dateien an die j√ºngere Version des SDK anpassen. </li><li>  Funktionen aus dem neuen SDK werden bei Ausf√ºhrung unter neuen Windows-Versionen an der Adresse aufgerufen (√ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GetProcAddress bezogen</a> ). </li><li>  F√ºr die √úbertragung von Daten zwischen Streams in der Engine verwendet WinXP den lokalen Thread-Speicher in neuen Versionen - den lokalen Fibre-Speicher. </li></ul><br><h2>  Zusammenfassung </h2><br>  In unserer 1C: Enterprise-Plattform ab Version 8.3.14 (Release - Ende 2018) wird HTML auf h√∂chstem Niveau unterst√ºtzt - HTML5, OpenGL usw.  Sowohl die Quantit√§t als auch die Qualit√§t der Rosinen, die auf unserer Plattform in Entscheidungen einflie√üen k√∂nnen, sind nur durch die Vorstellungskraft des Entwicklers begrenzt.  Und doch nat√ºrlich das Betriebssystem des Clients - unter WinXP funktionieren viele leckere HTML5-Br√∂tchen aus offensichtlichen Gr√ºnden nicht. <br><br>  Jetzt k√∂nnen Windows-Anwendungen auf der 1C: Enterprise-Plattform Folgendes anzeigen: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zL6beG-cNEI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Vergessen Sie jedoch nicht den gesunden Menschenverstand, wenn Sie die "Extras" von HTML in Anwendungsl√∂sungen verwenden.  Die Verwendung von HTML ist f√ºr spezielle Aufgaben (Anzeigen von Hilfe, Techniken, Produktbeschreibungen usw.) geeignet und empfohlen, jedoch nicht f√ºr die Implementierung von Gesch√§ftslogikaufgaben (Eingabe / Ausgabe strukturierter Informationen).  Dazu m√ºssen Sie die standardm√§√üigen 1C: Enterprise-Schnittstellenmechanismen verwenden, die automatische Unterst√ºtzung f√ºr Zugriffsrechte, Funktionsverwaltung, Anpassung an den Ger√§teformfaktor, Unterst√ºtzung f√ºr Benutzereinstellungen und die Arbeit vieler anderer Mechanismen bieten, ohne die der vollst√§ndige Betrieb einer Gesch√§ftsanwendung nahezu unm√∂glich wird. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de425713/">https://habr.com/ru/post/de425713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de425703/index.html">Kafka bei Wargaming: Blitz</a></li>
<li><a href="../de425705/index.html">Replikation von Percona Server f√ºr MySQL nach PostgreSQL mit dem Tool pg_chameleon</a></li>
<li><a href="../de425707/index.html">Benachrichtigungssystem von der Konsole zum Telegramm</a></li>
<li><a href="../de425709/index.html">Wir haben ein Memo f√ºr die Chinesen gemacht, die zu Ihnen gekommen sind</a></li>
<li><a href="../de425711/index.html">Nicht √ºbereinstimmender Leitungsverlust</a></li>
<li><a href="../de425715/index.html">Bildungsprogramm in Chemie: S√§urewechselung von Mikroschaltungen (wie man einen Kristall einer Mikroschaltung f√ºr die anschlie√üende Fotografie freilegt)</a></li>
<li><a href="../de425717/index.html">Neuronales Netzwerk f√ºr C ++ - Entwickler</a></li>
<li><a href="../de425719/index.html">Sellerie in gesch√§ftigen Projekten: ein wenig √úbung</a></li>
<li><a href="../de425723/index.html">Facebook entwickelt aktiv einen Dienst, um Arbeit zu finden und Mitarbeiter in einem sozialen Netzwerk einzustellen</a></li>
<li><a href="../de425725/index.html">Nintendo Patents Case - Game Boy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>