<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥ ğŸ†– ğŸ“› Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹ØµØ¨ÙŠØ© ODE ğŸ§‘ğŸ½â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ‘°ğŸ¼ ğŸ‘©ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„ØªÙØ§Ø¶Ù„ÙŠØ© Ø§Ù„Ø¹ØµØ¨ÙŠØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© 
 ÙŠØªÙ… ÙˆØµÙ Ù†Ø³Ø¨Ø© ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„ØªÙØ§Ø¶Ù„ÙŠØ© ØŒ ÙˆÙ‡Ø°Ø§ Ù‚Ø¯ ÙŠÙƒÙˆÙ† ØªØ·ÙˆØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ø¯ÙŠ Ù…Ø¹ Ù…Ø±ÙˆØ± Ø§Ù„ÙˆÙ‚Øª ØŒ ÙˆØ§Ù„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹ØµØ¨ÙŠØ© ODE</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ods/blog/442002/" style=";text-align:right;direction:rtl"><h1 style=";text-align:right;direction:rtl">  Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„ØªÙØ§Ø¶Ù„ÙŠØ© Ø§Ù„Ø¹ØµØ¨ÙŠØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© </h1><br>  ÙŠØªÙ… ÙˆØµÙ Ù†Ø³Ø¨Ø© ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„ØªÙØ§Ø¶Ù„ÙŠØ© ØŒ ÙˆÙ‡Ø°Ø§ Ù‚Ø¯ ÙŠÙƒÙˆÙ† ØªØ·ÙˆØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ø¯ÙŠ Ù…Ø¹ Ù…Ø±ÙˆØ± Ø§Ù„ÙˆÙ‚Øª ØŒ ÙˆØ§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ© Ù„Ù„Ù…Ø±ÙŠØ¶ ØŒ ÙˆØ§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ© ØŒ ÙˆÙ…Ø§ Ø¥Ù„Ù‰ Ø°Ù„Ùƒ.  Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…ØªØ³Ù‚Ø© ÙˆÙ…Ø³ØªÙ…Ø±Ø© Ø¨Ø·Ø¨ÙŠØ¹ØªÙ‡Ø§ ØŒ Ø¨Ù…Ø¹Ù†Ù‰ Ø£Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡ÙŠ Ø¨Ø¨Ø³Ø§Ø·Ø© Ù…Ø¸Ø§Ù‡Ø± Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªØºÙŠØ±Ø© Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±. <br><br>  Ù‡Ù†Ø§Ùƒ Ø£ÙŠØ¶Ù‹Ø§ Ù†ÙˆØ¹ Ø¢Ø®Ø± Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© ØŒ ÙÙ‡Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†ÙØµÙ„Ø© ØŒ Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù‡Ù…Ø© NLP.  ØªØ®ØªÙ„Ù Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ù…Ø«Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØ±Ø¯: Ù…Ù† Ø­Ø±Ù Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø¥Ù„Ù‰ Ø£Ø®Ø±Ù‰. <br><br>  Ø§Ù„Ø¢Ù† ØªØªÙ… Ù…Ø¹Ø§Ù„Ø¬Ø© ÙƒÙ„Ø§ Ø§Ù„Ù†ÙˆØ¹ÙŠÙ† Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© Ø¹Ø§Ø¯Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ø´Ø¨ÙƒØ§Øª Ù…ØªÙƒØ±Ø±Ø© ØŒ Ø¹Ù„Ù‰ Ø§Ù„Ø±ØºÙ… Ù…Ù† Ø§Ø®ØªÙ„Ø§ÙÙ‡Ù…Ø§ Ø¨Ø·Ø¨ÙŠØ¹ØªÙ‡Ù…Ø§ ÙˆÙŠØ¨Ø¯Ùˆ Ø£Ù†Ù‡Ù…Ø§ ÙŠØªØ·Ù„Ø¨Ø§Ù† Ø£Ø³Ø§Ù„ÙŠØ¨ Ù…Ø®ØªÙ„ÙØ©. <br><br>  ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ù…Ù‚Ø§Ù„Ø© Ù…Ø«ÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù… ÙÙŠ <em>Ù…Ø¤ØªÙ…Ø± NIPS</em> Ø§Ù„Ø£Ø®ÙŠØ± ØŒ ÙˆØ§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ Ø­Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©.  ÙŠÙ‚ØªØ±Ø­ Ø§Ù„Ù…Ø¤Ù„ÙÙˆÙ† Ù…Ù‚Ø§Ø±Ø¨Ø© Ø£Ø·Ù„Ù‚ÙˆØ§ Ø¹Ù„ÙŠÙ‡Ø§ <strong>ODEs Ø§Ù„Ø¹ØµØ¨ÙŠØ©</strong> . <br><br>  Ø­Ø§ÙˆÙ„Øª Ù‡Ù†Ø§ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†ØªØ§Ø¬ ÙˆØªÙ„Ø®ÙŠØµ Ù†ØªØ§Ø¦Ø¬ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ù…Ù† Ø£Ø¬Ù„ Ø¬Ø¹Ù„ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ ÙÙƒØ±ØªÙ‡Ø§ Ø£Ø³Ù‡Ù„ Ù‚Ù„ÙŠÙ„Ø§Ù‹.  ÙŠØ¨Ø¯Ùˆ Ù„ÙŠ Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‚Ø¯ ØªØ¬Ø¯ Ù…ÙƒØ§Ù†Ù‹Ø§ ÙÙŠ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„ØªÙ„Ø§ÙÙŠÙÙŠØ© ÙˆØ§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/7e/65/hf/7e65hfxs1amdqyy_uy6emdwulkg.png"></div><br><a name="habracut"></a><br><i></i><p style=";text-align:right;direction:rtl">  <em>Ø§Ù„Ø´ÙƒÙ„</em> 1: ÙŠØªØ·Ù„Ø¨ <em>backpropagation</em> Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù…Ø³ØªÙ…Ø± Ø­Ù„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªÙØ§Ø¶Ù„ÙŠØ© Ø²ÙŠØ§Ø¯Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨. <br><br>  ØªÙ…Ø«Ù„ Ø§Ù„Ø£Ø³Ù‡Ù… Ø¶Ø¨Ø· Ø§Ù„ØªØ¯Ø±Ø¬Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ù†Ø´Ø±Ù‡Ø§ Ù„Ù„Ø®Ù„Ù Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„ØªØ¯Ø±Ø¬Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª. <br><br>  ØªÙˆØ¶ÙŠØ­ Ù…Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ. </p><br><h2 style=";text-align:right;direction:rtl">  Ø¨ÙŠØ§Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø© </h2><br>  ÙÙ„ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¹Ù…Ù„ÙŠØ© ØªØ·ÙŠØ¹ Ø¨Ø¹Ø¶ Ø¹Ù†Ø§ØµØ± ODE ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ© ÙˆØªØ³Ù…Ø­ Ø¨ÙˆØ¬ÙˆØ¯ Ø¹Ø¯Ø© Ù…Ù„Ø§Ø­Ø¸Ø§Øª (ØµØ§Ø®Ø¨Ø©) Ø¹Ù„Ù‰ Ø·ÙˆÙ„ Ù…Ø³Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/438/dde/8ca/438dde8cabcfd6a826ed0257752e6499.svg" alt="\ frac {dz} {dt} = f (z (t)ØŒ t) \Ø› (1)"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/190/072/e64/190072e645d65dc29d6160aaf0dde065.svg" alt="\ {(z_0ØŒ t_0)ØŒ (z_1ØŒ t_1)ØŒ ...ØŒ (z_MØŒ t_M) \} - \ text {notes}"></div><br>  ÙƒÙŠÙÙŠØ© Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙ‚Ø±ÙŠØ¨ <img src="https://habrastorage.org/getpro/habr/post_images/287/bb8/c63/287bb8c637a8a70238be4ea690a0a8e1.svg" alt="\ widehat {f} (zØŒ tØŒ \ theta)">  ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªÙƒÙ„Ù… <img src="https://habrastorage.org/getpro/habr/post_images/6ad/6ab/1fa/6ad6ab1fa56e2c8b6d987dc5c1f68004.svg" alt="f (z ØŒ t)">  ØŸ <br><br>  Ø£ÙˆÙ„Ø§Ù‹ ØŒ ÙÙƒØ± ÙÙŠ Ù…Ù‡Ù…Ø© Ø£ÙƒØ«Ø± Ø¨Ø³Ø§Ø·Ø©: Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙˆÙ‰ Ù…Ù„Ø§Ø­Ø¸ØªØ§Ù† ØŒ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø± ÙˆÙÙŠ Ù†Ù‡Ø§ÙŠØªÙ‡ ØŒ <img src="https://habrastorage.org/getpro/habr/post_images/547/808/5c2/5478085c21b85393c8e9e0f78c2821b3.svg" alt="(z_0 ØŒ t_0) ØŒ (z_1 ØŒ t_1)">  . <br><br>  ØªØ·ÙˆØ± Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© <img src="https://habrastorage.org/getpro/habr/post_images/7e2/d13/d9a/7e2d13d9a9cc05a84422c3b63260dd83.svg" alt="z_0 ØŒ t_0">  ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯ <img src="https://habrastorage.org/getpro/habr/post_images/4fc/683/cd0/4fc683cd033494d093a0e2c6f021805b.svg" alt="t_1 - t_0">  Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù…Ø© ØªØ¹Ù…Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠ Ø·Ø±ÙŠÙ‚Ø© Ù„ØªØ·ÙˆØ± Ø£Ù†Ø¸Ù…Ø© ODE.  Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙŠ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© <img src="https://habrastorage.org/getpro/habr/post_images/56d/8d1/11e/56d8d111e514029cf892aff24a82c768.svg" alt="\ Ù‚Ø¨Ø¹Ø© {z_1} ØŒ t_1">  ØŒ Ø¨Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ù…Ø¹ Ø§Ù„Ø¯ÙˆÙ„Ø© <img src="https://habrastorage.org/getpro/habr/post_images/f80/709/9a5/f807099a57f179abaa3ab5e70cee4c9c.svg" alt="z_1">  ÙˆÙŠØªÙ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ†Ù‡Ù…Ø§ Ù…Ù† Ø®Ù„Ø§Ù„ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª <img src="https://habrastorage.org/getpro/habr/post_images/2cb/bcb/347/2cbbcb347a44c276c1095ac5bb3f8242.svg" alt="\ Ø«ÙŠØªØ§">  ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª. <br><br>  Ø£Ùˆ ØŒ Ø¨Ø´ÙƒÙ„ Ø£ÙƒØ«Ø± Ø±Ø³Ù…ÙŠØ© ØŒ ÙÙƒØ± ÙÙŠ ØªÙ‚Ù„ÙŠÙ„ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø®Ø³Ø§Ø±Ø© <img src="https://habrastorage.org/getpro/habr/post_images/b03/557/43f/b0355743fe8383284ef53436870494da.svg" alt="L (\ hat {z_1})">  : <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/251/944/489/251944489756d64d40b61f0dc0d7cb0b.svg" alt="L (z (t_1)) = L \ Big (\ int_ {t_0} ^ {t_1} f (z (t) ØŒ t ØŒ \ theta) dt \ Big) = L \ big (\ text {ODESolve} (z ( t_0) ØŒ f ØŒ t_0 ØŒ t_1 ØŒ \ theta) \ big) \Ø› (2)"></div><br>  Ù„ØªÙ‚Ù„ÙŠÙ„ <img src="https://habrastorage.org/getpro/habr/post_images/899/a67/551/899a675510d28419769a9b42281f0c65.svg" alt="Ù„Ø§Ù…">  ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ¯Ø±Ø¬Ø§Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª: <img src="https://habrastorage.org/getpro/habr/post_images/194/e4f/6e5/194e4f6e59bbfefc52efebce3bb857a3.svg" alt="z (t_0) ØŒ t_0 ØŒ t_1 ØŒ \ theta">  .  Ù„Ù„Ù‚ÙŠØ§Ù… Ø¨Ø°Ù„Ùƒ ØŒ ØªØ­ØªØ§Ø¬ Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ù„Ù‰ ØªØ­Ø¯ÙŠØ¯ ÙƒÙŠÙ <img src="https://habrastorage.org/getpro/habr/post_images/899/a67/551/899a675510d28419769a9b42281f0c65.svg" alt="Ù„Ø§Ù…">  ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆÙ„Ø© ÙÙŠ ÙƒÙ„ Ù„Ø­Ø¸Ø© Ù…Ù† Ø§Ù„Ø²Ù…Ù† <img src="https://habrastorage.org/getpro/habr/post_images/823/f33/fc8/823f33fc81685e76b1d88f48c68eea32.svg" alt="(Ø¶ (Ø±))">  : <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e79/64f/b7f/e7964fb7f074d4f9c16893b53a1562c6.svg" alt="a (t) = - \ frac {\ Ø§Ù„Ø¬Ø²Ø¦ÙŠ L} {\ Ø§Ù„Ø¬Ø²Ø¦ÙŠ z (t)} \Ø› (3)"></div><br><img src="https://habrastorage.org/getpro/habr/post_images/2e3/af6/935/2e3af69359cb79517739f0ccf9a8bc3e.svg" alt="(Ø±)">  ÙŠÙØ·Ù„Ù‚ Ø¹Ù„ÙŠÙ‡Ø§ Ø­Ø§Ù„Ø© <em>Ù…ØªØ¬Ø§ÙˆØ±Ø©</em> ØŒ ÙˆÙŠØªÙ… Ø¥Ø¹Ø·Ø§Ø¡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§ØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ø¹Ø§Ø¯Ù„Ø© ØªÙØ§Ø¶Ù„ÙŠØ© Ø£Ø®Ø±Ù‰ ØŒ ÙˆØ§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ø§Ø¹ØªØ¨Ø§Ø±Ù‡Ø§ ØªÙ†Ø§Ø¸Ø±ÙŠÙ‹Ø§ Ù…Ø³ØªÙ…Ø±Ù‹Ø§ Ù„Ù„ØªÙ…Ø§ÙŠØ² Ø¨ÙŠÙ† Ø¯Ø§Ù„Ø© Ù…Ø¹Ù‚Ø¯Ø© ( <em>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø³Ù„Ø³Ù„Ø©</em> ): <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/006/b66/5d5/006b665d51719470f25859e6271463dc.svg" alt="\ frac {d a (t)} {d t} = -a (t) \ frac {\ Ø¬Ø²Ø¦ÙŠ f (z (t)ØŒ tØŒ \ theta)} {\ Ø¬Ø²Ø¦ÙŠØ© z} \Ø› (4)"></div><br>  ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¥Ø®Ø±Ø§Ø¬ Ù‡Ø°Ù‡ Ø§Ù„ØµÙŠØºØ© ÙÙŠ Ù…Ù„Ø­Ù‚ Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©. <br><br>  <i>ÙŠØ¬Ø¨ Ø§Ø¹ØªØ¨Ø§Ø± Ø§Ù„Ù…ØªØ¬Ù‡Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ù†Ø§Ù‚Ù„Ø§Øª ØµØºÙŠØ±Ø© ØŒ Ø¹Ù„Ù‰ Ø§Ù„Ø±ØºÙ… Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ ÙŠØ³ØªØ®Ø¯Ù… ÙƒÙ„Ø§Ù‹ Ù…Ù† ØªÙ…Ø«ÙŠÙ„ Ø§Ù„ØµÙ ÙˆØ§Ù„Ø¹Ù…ÙˆØ¯.</i> <br><br>  Ø­Ù„ diffur (4) ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ØŒ Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© <img src="https://habrastorage.org/getpro/habr/post_images/9ec/7ef/827/9ec7ef8276505d510f609b983c58fdc3.svg" alt="z (t_0)">  : <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/556/75a/7f0/55675a7f0c820f2a1da88e0802c97dc7.svg" alt="\ frac {\ Ø¬Ø²Ø¦ÙŠØ© L} {\ Ø¬Ø²Ø¦ÙŠØ© z (t_0)} = \ int_ {t_1} ^ {t_0} a (t) \ frac {\ Ø¬Ø²Ø¦ÙŠØ© f (z (t) ØŒ t ØŒ \ theta)} {\ Ø¬Ø²Ø¦ÙŠØ© z} dt \Ø› (5)"></div><br>  Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ¯Ø±Ø¬ ÙÙŠÙ…Ø§ ÙŠØªØ¹Ù„Ù‚ <img src="https://habrastorage.org/getpro/habr/post_images/2a3/102/4ea/2a31024ea1803c34a47496e24a53a1ef.svg" alt="Ø±">  Ùˆ <img src="https://habrastorage.org/getpro/habr/post_images/2cb/bcb/347/2cbbcb347a44c276c1095ac5bb3f8242.svg" alt="\ Ø«ÙŠØªØ§">  ÙŠÙ…ÙƒÙ†Ùƒ Ø¨Ø¨Ø³Ø§Ø·Ø© Ø§Ø¹ØªØ¨Ø§Ø±Ù‡Ù… Ø¬Ø²Ø¡Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¯ÙˆÙ„Ø©.  ÙˆØªØ³Ù…Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© <em>Ø²ÙŠØ§Ø¯Ø©</em> .  ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ø´ÙƒÙ„ ØªØ§ÙÙ‡ Ù…Ù† Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/161/f11/79c/161f1179cbb6dfe3c18057d8abd0f45b.svg" alt="\ frac {d} {dt} \ ØªØ¨Ø¯Ø£ {bmatrix} z â€‹â€‹\\ \ theta \\ t \ end {bmatrix} (t) = f _ {\ text {aug}} ([zØŒ \ thetaØŒ t]): = \ start {bmatrix} f ([zØŒ \ thetaØŒ t]) \\ 0 \\ 1 \ end {bmatrix} \Ø› (6)"></div><br>  Ø«Ù… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªØ±Ø§ÙÙ‚Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø²Ø²Ø©: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7dc/7d0/553/7dc7d055304addbb695d1f23a9e640e6.svg" alt="a _ {\ text {aug}}: = \ start {bmatrix} a \\ a _ {\ theta} \\ a_t \ end {bmatrix} ØŒ a _ {\ theta} (t): = \ frac {\ Ø§Ù„Ø¬Ø²Ø¦ÙŠ L} { \ Ø¬Ø²Ø¦ÙŠØ© \ theta (t)} ØŒ a_t (t): = \ frac {\ Ø¬Ø²Ø¦ÙŠØ© L} {\ Ø¬Ø²Ø¦ÙŠØ© t (t)} \Ø› (7)"></div><br>  Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù…Ø¹Ø²Ø²: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/985/437/7a4/9854377a42cda72fa53bedb928a9d023.svg" alt="\ frac {\ Ø¬Ø²Ø¦ÙŠØ© f _ {\ text {aug}}} {\ Ø¬Ø²Ø¦ÙŠØ© [zØŒ \ thetaØŒ t]} = \ ØªØ¨Ø¯Ø£ {bmatrix} \ frac {\ Ø¬Ø²Ø¦ÙŠØ© f} {\ Ø¬Ø²Ø¦ÙŠØ© z} &amp;Ø› \ frac {\ Ø¬Ø²Ø¦ÙŠØ© f} {\ Ø¬Ø²Ø¦ÙŠØ© \ theta} &amp;Ø› \ frac {\ Ø¬Ø²Ø¦ÙŠØ© f} {\ Ø¬Ø²Ø¦ÙŠØ© t} \\ 0 &amp;Ø› 0 &amp;Ø› 0 \\ 0 &amp;Ø› 0 &amp;Ø› 0 \ end {bmatrix} \Ø› (8)"></div><br>  Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„ØªÙØ§Ø¶Ù„ÙŠØ© Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªØ¶Ø§ÙØ±Ø© Ù…Ù† Ø§Ù„ØµÙŠØºØ© (4) Ø«Ù…: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/bd3/b9f/7f3/bd3b9f7f3e6ec08881594346a8a3e4f3.svg" alt="\ frac {d a _ {\ text {aug}}} {dt} = - \ start {bmatrix} a \ frac {\ Ø¬Ø²Ø¦ÙŠØ© f} {\ Ø¬Ø²Ø¦ÙŠØ© z} &amp;Ø› a \ frac {\ Ø¬Ø²Ø¦ÙŠØ© f} {\ Ø¬Ø²Ø¦ÙŠØ© \ theta} &amp;Ø› a \ frac {\ Ø¬Ø²Ø¦ÙŠØ© f} {\ Ø¬Ø²Ø¦ÙŠØ© t} \ end {bmatrix} \Ø› (9)"></div><br>  ÙŠÙ†ØªØ¬ Ø¹Ù† Ø­Ù„ ODE Ù‡Ø°Ø§ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/5a0/01e/3d9/5a001e3d928ce08d05ff084353134d78.svg" alt="\ frac {\ Ø¬Ø²Ø¦ÙŠØ© L} {\ Ø¬Ø²Ø¦ÙŠØ© z (t_0)} = \ int_ {t_1} ^ {t_0} a (t) \ frac {\ Ø¬Ø²Ø¦ÙŠØ© f (z (t) ØŒ t ØŒ \ theta)} {\ Ø¬Ø²Ø¦ÙŠØ© z} dt \Ø› (10)"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e09/ba3/cc6/e09ba3cc6674830a8847894c39020ec0.svg" alt="\ frac {\ Ø¬Ø²Ø¦ÙŠØ© L} {\ Ø¬Ø²Ø¦ÙŠØ© \ theta} = \ int_ {t_1} ^ {t_0} a (t) \ frac {\ Ø¬Ø²Ø¦ÙŠØ© f (z (t) ØŒ t ØŒ \ theta)} {\ Ø¬Ø²Ø¦ÙŠØ© \ theta } dt \Ø› (11)"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/022/f84/715/022f84715f62b101017a6dcb591d5de3.svg" alt="\ frac {\ Ø§Ù„Ø¬Ø²Ø¦ÙŠ L} {\ Ø§Ù„Ø¬Ø²Ø¦ÙŠ t_0} = \ int_ {t_1} ^ {t_0} a (t) \ frac {\ Ø§Ù„Ø¬Ø²Ø¦ÙŠ f (z (t) ØŒ t ØŒ \ theta)} {\ Ø§Ù„Ø¬Ø²Ø¦ÙŠ t} dt \Ø› (12)"></div><br>  Ù…Ø§ Ù…Ø¹ <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/0f9/b43/8a8/0f9b438a88408c879af759bcaf4d1d5e.svg" alt="\ frac {\ Ø¬Ø²Ø¦ÙŠØ© L} {\ Ø¬Ø²Ø¦ÙŠØ© t_1} = - a (t) \ frac {\ Ø¬Ø²Ø¦ÙŠØ© f (z (t)ØŒ tØŒ \ theta)} {\ Ø¬Ø²Ø¦ÙŠØ© t} \Ø› (13)"></div><br>  ÙŠØ¹Ø·ÙŠ Ø§Ù„ØªØ¯Ø±Ø¬Ø§Øª ÙÙŠ Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¥Ù„Ù‰ <em>ODESolve</em> ODE <em>Ø­Ù„Ø§Ù„Ø§</em> . <br><br>  ÙŠÙ…ÙƒÙ† Ø­Ø³Ø§Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¯Ø±Ø¬Ø§Øª (10) ØŒ (11) ØŒ (12) ØŒ (13) Ù…Ø¹Ù‹Ø§ ÙÙŠ Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ù† <em>ODESolve</em> Ù…Ø¹ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙØ¶Ø§ÙØ© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© (9). <br><br><img src="https://habrastorage.org/webt/8k/pz/uk/8kpzukmizpmezmywov4b3zm29lc.png"><br>  <i>ØªÙˆØ¶ÙŠØ­ Ù…Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ.</i> <br><br>  ØªØµÙ Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø£Ø¹Ù„Ø§Ù‡ Ø§Ù„Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¹ÙƒØ³ÙŠ Ù„ØªØ¯Ø±Ø¬ Ø­Ù„ ODE Ù„Ù„Ø±ØµØ¯Ø§Øª Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©. <br><br>  ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ Ø¹Ø¯Ø© Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø± ÙˆØ§Ø­Ø¯ ØŒ ÙŠØªÙ… Ø­Ø³Ø§Ø¨ ÙƒÙ„ Ø´ÙŠØ¡ Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ù†ÙØ³Ù‡Ø§ ØŒ ÙˆÙ„ÙƒÙ† ÙÙŠ Ù„Ø­Ø¸Ø§Øª Ø§Ù„Ø±ØµØ¯ ØŒ ÙŠØ¬Ø¨ Ø¶Ø¨Ø· Ù…Ø¹ÙƒÙˆØ³ Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù…Ø±ÙˆØ¬ Ø¨ÙˆØ§Ø³Ø·Ø© ØªØ¯Ø±Ø¬Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØŒ ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø¨ÙŠÙ† ÙÙŠ <em>Ø§Ù„Ø´ÙƒÙ„ 1</em> . <br><br><h1 style=";text-align:right;direction:rtl">  Ø§Ù„ØªÙ†ÙÙŠØ° </h1><br>  Ø§Ù„ÙƒÙˆØ¯ Ø£Ø¯Ù†Ø§Ù‡ Ù‡Ùˆ Ø¹Ù…Ù„ÙŠ ÙÙŠ ØªÙ†ÙÙŠØ° <strong>ODEs Ø§Ù„Ø¹ØµØ¨ÙŠØ©</strong> .  Ù„Ù‚Ø¯ ÙØ¹Ù„Øª Ø°Ù„Ùƒ Ù…Ù† Ø£Ø¬Ù„ ÙÙ‡Ù… Ø£ÙØ¶Ù„ Ù„Ù…Ø§ ÙŠØ­Ø¯Ø«.  ÙˆÙ…Ø¹ Ø°Ù„Ùƒ ØŒ ÙÙ‡Ùˆ Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ù‹Ø§ Ù…Ù…Ø§ ØªÙ… ØªÙ†ÙÙŠØ°Ù‡ ÙÙŠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Ù…Ø³ØªÙˆØ¯Ø¹</a> Ù…Ø¤Ù„ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„.  Ø£Ù†Ù‡ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ÙÙ‡Ù…Ù‡ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯ ØŒ ÙƒÙ…Ø§ Ø£Ù†Ù‡ ØªÙ… ØªØ¹Ù„ÙŠÙ‚Ù‡ Ø£ÙƒØ«Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹.  Ù„Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª ÙˆØ§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ØŒ Ù„Ø§ ÙŠØ²Ø§Ù„ Ù…Ù† Ø§Ù„Ø£ÙØ¶Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¤Ù„ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ. <br><br><pre style=";text-align:right;direction:rtl"><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> math <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> IPython.display <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> clear_output <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tqdm <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tqdm_notebook <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tqdm <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> mpl <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt %matplotlib inline <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> seaborn <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sns sns.color_palette(<span class="hljs-string"><span class="hljs-string">"bright"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> mpl <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.cm <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cm <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torch <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Tensor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torch <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> nn <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torch.nn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> functional <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> F <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torch.autograd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Variable use_cuda = torch.cuda.is_available()</code> </pre> <br>  ØªØ­ØªØ§Ø¬ Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ù„Ù‰ ØªÙ†ÙÙŠØ° Ø£ÙŠ Ø·Ø±ÙŠÙ‚Ø© Ù„ØªØ·ÙˆÙŠØ± Ø£Ù†Ø¸Ù…Ø© ODE.  Ù…Ù† Ø£Ø¬Ù„ Ø§Ù„Ø¨Ø³Ø§Ø·Ø© ØŒ ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø·Ø±ÙŠÙ‚Ø© Euler Ù‡Ù†Ø§ ØŒ Ø¹Ù„Ù‰ Ø§Ù„Ø±ØºÙ… Ù…Ù† Ø£Ù† Ø£ÙŠ Ø·Ø±ÙŠÙ‚Ø© ØµØ±ÙŠØ­Ø© Ø£Ùˆ Ø¶Ù…Ù†ÙŠØ© Ù…Ù†Ø§Ø³Ø¨Ø©. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ode_solve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(z0, t0, t1, f)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     -   """</span></span> h_max = <span class="hljs-number"><span class="hljs-number">0.05</span></span> n_steps = math.ceil((abs(t1 - t0)/h_max).max().item()) h = (t1 - t0)/n_steps t = t0 z = z0 <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i_step <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(n_steps): z = z + h * f(z, t) t = t + h <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> z</code> </pre><br>  ÙŠØµÙ Ø£ÙŠØ¶Ù‹Ø§ Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„ÙØ§Ø¦Ù‚Ø© Ù„ÙˆØ¸ÙŠÙØ© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø°Ø§Øª Ù…Ø¹Ù„Ù…Ø§Øª Ù…Ø¹ Ø¹Ø¯Ø© Ø·Ø±Ù‚ Ù…ÙÙŠØ¯Ø©. <br><br>  Ø£ÙˆÙ„Ø§Ù‹: ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ø±Ø¬Ø§Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„ÙŠÙ‡Ø§ Ø§Ù„ÙˆØ¸ÙŠÙØ© ÙÙŠ Ø´ÙƒÙ„ Ù…ØªØ¬Ù‡. <br><br>  Ø«Ø§Ù†ÙŠØ§Ù‹: Ù…Ù† Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ø²Ø²Ø©.  ØªØ¹ØªÙ…Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù„ÙˆÙ†ÙŠ Ù„Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ù…Ù† Ø­ÙŠØ« Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„.  Ø­ØªÙ‰ Ù„Ø§ ØªØ¶Ø·Ø± Ø¥Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ¯Ø±Ø¬ <strong>Ø§Ù„Ù„ÙˆÙ†ÙŠ</strong> Ù…Ø¹ ÙƒÙ„ ÙŠØ¯ Ù„ÙƒÙ„ Ù‡Ù†Ø¯Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø© ØŒ <strong>Ø³Ù†Ø³ØªØ®Ø¯Ù…</strong> Ø·Ø±ÙŠÙ‚Ø© <strong>torch.autograd.grad</strong> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ODEF</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(nn.Module)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward_with_grad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, z, t, grad_outputs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Compute f and a df/dz, a df/dp, a df/dt"""</span></span> batch_size = z.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>] out = self.forward(z, t) a = grad_outputs adfdz, adfdt, *adfdp = torch.autograd.grad( (out,), (z, t) + tuple(self.parameters()), grad_outputs=(a), allow_unused=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, retain_graph=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ) <span class="hljs-comment"><span class="hljs-comment">#  grad       , #  expand   if adfdp is not None: adfdp = torch.cat([p_grad.flatten() for p_grad in adfdp]).unsqueeze(0) adfdp = adfdp.expand(batch_size, -1) / batch_size if adfdt is not None: adfdt = adfdt.expand(batch_size, 1) / batch_size return out, adfdz, adfdt, adfdp def flatten_parameters(self): p_shapes = [] flat_parameters = [] for p in self.parameters(): p_shapes.append(p.size()) flat_parameters.append(p.flatten()) return torch.cat(flat_parameters)</span></span></code> </pre><br>  ÙŠØµÙ Ø§Ù„ÙƒÙˆØ¯ Ø£Ø¯Ù†Ø§Ù‡ Ø§Ù„Ø§Ù†ØªØ´Ø§Ø± <em>Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ ÙˆØ§Ù„Ø®Ù„ÙÙŠ Ù„Ù…ÙˆØ§Ø¯ ODE Ø§Ù„Ø¹ØµØ¨ÙŠØ©</em> .  Ù…Ù† Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ ÙØµÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ø¹Ù† <strong><em>torch.nn.Module</em></strong> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙŠ Ø´ÙƒÙ„ ÙˆØ¸ÙŠÙØ© <strong><em>torch.autograd.Function</em></strong> Ù„Ø£Ù†Ù‡ ÙÙŠ Ø§Ù„Ø£Ø®ÙŠØ± ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ†ÙÙŠØ° Ø·Ø±ÙŠÙ‚Ø© ØªØ¹Ø³ÙÙŠØ© Ù„Ù„Ù†Ø´Ø± Ø§Ù„Ø®Ù„ÙÙŠ ØŒ Ø¹Ù„Ù‰ Ø¹ÙƒØ³ Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù†Ù…Ø·ÙŠØ©.  Ù„Ø°Ù„Ùƒ Ù‡Ø°Ø§ Ù…Ø¬Ø±Ø¯ Ø¹ÙƒØ§Ø². <br><br>  Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© ØªÙƒÙ…Ù† ÙˆØ±Ø§Ø¡ Ù†Ù‡Ø¬ <em>ODE Ø§Ù„Ø¹ØµØ¨ÙŠ</em> Ø¨Ø£ÙƒÙ…Ù„Ù‡. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ODEAdjoint</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(torch.autograd.Function)</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx, z0, t, flat_parameters, func)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> isinstance(func, ODEF) bs, *z_shape = z0.size() time_len = t.size(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> torch.no_grad(): z = torch.zeros(time_len, bs, *z_shape).to(z0) z[<span class="hljs-number"><span class="hljs-number">0</span></span>] = z0 <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i_t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(time_len - <span class="hljs-number"><span class="hljs-number">1</span></span>): z0 = ode_solve(z0, t[i_t], t[i_t+<span class="hljs-number"><span class="hljs-number">1</span></span>], func) z[i_t+<span class="hljs-number"><span class="hljs-number">1</span></span>] = z0 ctx.func = func ctx.save_for_backward(t, z.clone(), flat_parameters) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> z @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">backward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx, dLdz)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" dLdz shape: time_len, batch_size, *z_shape """</span></span> func = ctx.func t, z, flat_parameters = ctx.saved_tensors time_len, bs, *z_shape = z.size() n_dim = np.prod(z_shape) n_params = flat_parameters.size(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   , #       def augmented_dynamics(aug_z_i, t_i): """   -     t_i -   : bs, 1 aug_z_i -   : bs, n_dim*2 + n_params + 1 """ #     z_i, a = aug_z_i[:, :n_dim], aug_z_i[:, n_dim:2*n_dim] # Unflatten z and a z_i = z_i.view(bs, *z_shape) a = a.view(bs, *z_shape) with torch.set_grad_enabled(True): t_i = t_i.detach().requires_grad_(True) z_i = z_i.detach().requires_grad_(True) faug = func.forward_with_grad(z_i, t_i, grad_outputs=a) func_eval, adfdz, adfdt, adfdp = faug adfdz = adfdz if adfdz is not None else torch.zeros(bs, *z_shape) adfdp = adfdp if adfdp is not None else torch.zeros(bs, n_params) adfdt = adfdt if adfdt is not None else torch.zeros(bs, 1) adfdz = adfdz.to(z_i) adfdp = adfdp.to(z_i) adfdt = adfdt.to(z_i) # Flatten f and adfdz func_eval = func_eval.view(bs, n_dim) adfdz = adfdz.view(bs, n_dim) return torch.cat((func_eval, -adfdz, -adfdp, -adfdt), dim=1) dLdz = dLdz.view(time_len, bs, n_dim) # flatten dLdz   with torch.no_grad(): ##      #    , #       adj_z = torch.zeros(bs, n_dim).to(dLdz) adj_p = torch.zeros(bs, n_params).to(dLdz) #    z  p,        adj_t = torch.zeros(time_len, bs, 1).to(dLdz) for i_t in range(time_len-1, 0, -1): z_i = z[i_t] t_i = t[i_t] f_i = func(z_i, t_i).view(bs, n_dim) #      dLdz_i = dLdz[i_t] dLdt_i = torch.bmm(torch.transpose(dLdz_i.unsqueeze(-1), 1, 2), f_i.unsqueeze(-1))[:, 0] #     adj_z += dLdz_i adj_t[i_t] = adj_t[i_t] - dLdt_i #      aug_z = torch.cat(( z_i.view(bs, n_dim), adj_z, torch.zeros(bs, n_params).to(z) adj_t[i_t]), dim=-1 ) #  ()      aug_ans = ode_solve(aug_z, t_i, t[i_t-1], augmented_dynamics) #       adj_z[:] = aug_ans[:, n_dim:2*n_dim] adj_p[:] += aug_ans[:, 2*n_dim:2*n_dim + n_params] adj_t[i_t-1] = aug_ans[:, 2*n_dim + n_params:] del aug_z, aug_ans ##         #    dLdz_0 = dLdz[0] dLdt_0 = torch.bmm(torch.transpose(dLdz_0.unsqueeze(-1), 1, 2), f_i.unsqueeze(-1))[:, 0] #  adj_z += dLdz_0 adj_t[0] = adj_t[0] - dLdt_0 return adj_z.view(bs, *z_shape), adj_t, adj_p, None</span></span></code> </pre><br>  Ø§Ù„Ø¢Ù† Ù„Ù„Ø±Ø§Ø­Ø© ØŒ Ù„Ù Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© ÙÙŠ <strong>nn.Module</strong> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NeuralODE</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(nn.Module)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, func)</span></span></span><span class="hljs-function">:</span></span> super(NeuralODE, self).__init__() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> isinstance(func, ODEF) self.func = func <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, z0, t=Tensor</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">([</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0.</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1.</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">])</span></span></span></span><span class="hljs-function"><span class="hljs-params">, return_whole_sequence=False)</span></span></span><span class="hljs-function">:</span></span> t = t.to(z0) z = ODEAdjoint.apply(z0, t, self.func.flatten_parameters(), self.func) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> return_whole_sequence: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> z[<span class="hljs-number"><span class="hljs-number">-1</span></span>]</code> </pre><br><br><h1 style=";text-align:right;direction:rtl">  Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ </h1><br><h2 style=";text-align:right;direction:rtl">  Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© (Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ù‡Ø¬) </h2><br>  ÙƒØ§Ø®ØªØ¨Ø§Ø± Ø£Ø³Ø§Ø³ÙŠ ØŒ Ø¯Ø¹ÙˆÙ†Ø§ Ø§Ù„Ø¢Ù† Ù†ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¨Ø¥Ù…ÙƒØ§Ù† <strong>Neural ODE</strong> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±ØµØ¯. <br><br>  Ù„Ù„Ù‚ÙŠØ§Ù… Ø¨Ø°Ù„Ùƒ ØŒ Ù†Ø­Ø¯Ø¯ Ø£ÙˆÙ„Ø§Ù‹ ÙˆØ¸ÙŠÙØ© Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª ODE ØŒ ÙˆÙ†Ø·ÙˆØ± Ø§Ù„Ù…Ø³Ø§Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„ÙŠÙ‡ ØŒ Ø«Ù… Ù†Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡ Ù…Ù† ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ø°Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©. <br><br>  Ø£ÙˆÙ„Ø§Ù‹ ØŒ Ø¯Ø¹ÙˆÙ†Ø§ Ù†ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ø¨Ø³Ø· Ø­Ø§Ù„Ø§Øª ODE Ø§Ù„Ø®Ø·ÙŠØ©.  ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ù‡ÙŠ Ø¨Ø¨Ø³Ø§Ø·Ø© Ø¹Ù…Ù„ Ù…ØµÙÙˆÙØ©. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/eb4/fdc/86a/eb4fdc86a1c5f56ab1b6e37e575e7c72.svg" alt="\ frac {dz} {dt} = \ ØªØ¨Ø¯Ø£ {bmatrix} -0.1 &amp;Ø› -1.0 \\ 1.0 &amp;Ø› -0.1 \ end {bmatrix} z"></div><br>  ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø¯Ø±Ø¨Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ØµÙÙˆÙØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©. <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nj/q6/es/njq6eswuevh4rhx-8nhzyz-cq_k.gif"></div><br>  Ø¹Ù„Ø§ÙˆØ© Ø¹Ù„Ù‰ Ø°Ù„Ùƒ ØŒ Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ø£ÙƒØ«Ø± ØªØ¹Ù‚ÙŠØ¯Ù‹Ø§ Ø¨Ù‚Ù„ÙŠÙ„ (Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø© Ù…ØªØ­Ø±ÙƒØ© ØŒ Ù„Ø£Ù† Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù„Ù… Ù„ÙŠØ³Øª Ø¬Ù…ÙŠÙ„Ø© Ø¬Ø¯Ù‹Ø§ :)) <br>  ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ¹Ù„Ù… Ù‡Ù†Ø§ Ù‡ÙŠ Ø´Ø¨ÙƒØ© Ù…ØªØµÙ„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø·Ø¨Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ø®ÙÙŠØ©. <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/tr/4n/eb/tr4nebjdrs4pt4v5vlzleai8exe.png"></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ÙƒÙˆØ¯</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinearODEF</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ODEF)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, W)</span></span></span><span class="hljs-function">:</span></span> super(LinearODEF, self).__init__() self.lin = nn.Linear(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) self.lin.weight = nn.Parameter(W) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, t)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.lin(x)</code> </pre><br>  ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ù‡ÙŠ Ù…Ø¬Ø±Ø¯ Ù…ØµÙÙˆÙØ© <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpiralFunctionExample</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(LinearODEF)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> matrix = Tensor([[<span class="hljs-number"><span class="hljs-number">-0.1</span></span>, <span class="hljs-number"><span class="hljs-number">-1.</span></span>], [<span class="hljs-number"><span class="hljs-number">1.</span></span>, <span class="hljs-number"><span class="hljs-number">-0.1</span></span>]]) super(SpiralFunctionExample, self).__init__(matrix)</code> </pre><br>  Ù…ØµÙÙˆÙØ© Ù…Ø¹Ù„Ù…Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§ <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomLinearODEF</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(LinearODEF)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super(RandomLinearODEF, self).__init__(torch.randn(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)/<span class="hljs-number"><span class="hljs-number">2.</span></span>)</code> </pre><br>  Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø£ÙƒØ«Ø± ØªØ·ÙˆØ±Ø§ <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestODEF</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ODEF)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, A, B, x0)</span></span></span><span class="hljs-function">:</span></span> super(TestODEF, self).__init__() self.A = nn.Linear(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) self.A.weight = nn.Parameter(A) self.B = nn.Linear(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) self.B.weight = nn.Parameter(B) self.x0 = nn.Parameter(x0) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, t)</span></span></span><span class="hljs-function">:</span></span> xTx0 = torch.sum(x*self.x0, dim=<span class="hljs-number"><span class="hljs-number">1</span></span>) dxdt = torch.sigmoid(xTx0) * self.A(x - self.x0) + torch.sigmoid(-xTx0) * self.B(x + self.x0) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dxdt</code> </pre><br>  Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª Ø§Ù„ØªØ¹Ù„Ù… ÙÙŠ Ø´ÙƒÙ„ Ø´Ø¨ÙƒØ© Ù…ØªØµÙ„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NNODEF</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ODEF)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, in_dim, hid_dim, time_invariant=False)</span></span></span><span class="hljs-function">:</span></span> super(NNODEF, self).__init__() self.time_invariant = time_invariant <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_invariant: self.lin1 = nn.Linear(in_dim, hid_dim) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.lin1 = nn.Linear(in_dim+<span class="hljs-number"><span class="hljs-number">1</span></span>, hid_dim) self.lin2 = nn.Linear(hid_dim, hid_dim) self.lin3 = nn.Linear(hid_dim, in_dim) self.elu = nn.ELU(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, t)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.time_invariant: x = torch.cat((x, t), dim=<span class="hljs-number"><span class="hljs-number">-1</span></span>) h = self.elu(self.lin1(x)) h = self.elu(self.lin2(h)) out = self.lin3(h) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> out <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_np</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x.detach().cpu().numpy() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plot_trajectories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obs=None, times=None, trajs=None, save=None, figsize=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">16</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">8</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> plt.figure(figsize=figsize) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> obs <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> times <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: times = [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>] * len(obs) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> o, t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> zip(obs, times): o, t = to_np(o), to_np(t) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> b_i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(o.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>]): plt.scatter(o[:, b_i, <span class="hljs-number"><span class="hljs-number">0</span></span>], o[:, b_i, <span class="hljs-number"><span class="hljs-number">1</span></span>], c=t[:, b_i, <span class="hljs-number"><span class="hljs-number">0</span></span>], cmap=cm.plasma) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> trajs <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> trajs: z = to_np(z) plt.plot(z[:, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], z[:, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], lw=<span class="hljs-number"><span class="hljs-number">1.5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> save <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: plt.savefig(save) plt.show() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">conduct_experiment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ode_true, ode_trained, n_steps, name, plot_freq=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Create data z0 = Variable(torch.Tensor([[0.6, 0.3]])) t_max = 6.29*5 n_points = 200 index_np = np.arange(0, n_points, 1, dtype=np.int) index_np = np.hstack([index_np[:, None]]) times_np = np.linspace(0, t_max, num=n_points) times_np = np.hstack([times_np[:, None]]) times = torch.from_numpy(times_np[:, :, None]).to(z0) obs = ode_true(z0, times, return_whole_sequence=True).detach() obs = obs + torch.randn_like(obs) * 0.01 # Get trajectory of random timespan min_delta_time = 1.0 max_delta_time = 5.0 max_points_num = 32 def create_batch(): t0 = np.random.uniform(0, t_max - max_delta_time) t1 = t0 + np.random.uniform(min_delta_time, max_delta_time) idx = sorted(np.random.permutation( index_np[(times_np &gt; t0) &amp; (times_np &lt; t1)] )[:max_points_num]) obs_ = obs[idx] ts_ = times[idx] return obs_, ts_ # Train Neural ODE optimizer = torch.optim.Adam(ode_trained.parameters(), lr=0.01) for i in range(n_steps): obs_, ts_ = create_batch() z_ = ode_trained(obs_[0], ts_, return_whole_sequence=True) loss = F.mse_loss(z_, obs_.detach()) optimizer.zero_grad() loss.backward(retain_graph=True) optimizer.step() if i % plot_freq == 0: z_p = ode_trained(z0, times, return_whole_sequence=True) plot_trajectories(obs=[obs], times=[times], trajs=[z_p], save=f"assets/imgs/{name}/{i}.png") clear_output(wait=True) ode_true = NeuralODE(SpiralFunctionExample()) ode_trained = NeuralODE(RandomLinearODEF()) conduct_experiment(ode_true, ode_trained, 500, "linear") func = TestODEF(Tensor([[-0.1, -0.5], [0.5, -0.1]]), Tensor([[0.2, 1.], [-1, 0.2]]), Tensor([[-1., 0.]])) ode_true = NeuralODE(func) func = NNODEF(2, 16, time_invariant=True) ode_trained = NeuralODE(func) conduct_experiment(ode_true, ode_trained, 3000, "comp", plot_freq=30)</span></span></code> </pre><br></div></div><br>  ÙƒÙ…Ø§ ØªØ±ÙˆÙ† ØŒ <em>ODE Neural Ù‡Ùˆ</em> Ø¬ÙŠØ¯ Ø¬Ø¯Ø§ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠØ§Øª.  ÙˆÙ‡Ø°Ø§ Ù‡Ùˆ ØŒ Ù…ÙÙ‡ÙˆÙ… ÙƒÙƒÙ„ Ø£Ø¹Ù…Ø§Ù„. <br>  ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù† Ù…Ù† Ù…Ø´ÙƒÙ„Ø© Ø£ÙƒØ«Ø± ØªØ¹Ù‚ÙŠØ¯Ù‹Ø§ (MNISTØŒ haha). <br><br><h2 style=";text-align:right;direction:rtl">  ODE Ø§Ù„Ø¹ØµØ¨ÙŠØ© Ù…Ø³ØªÙˆØ­Ø§Ø© Ù…Ù† ResNets </h2><br>  ÙÙŠ ResNet'ax ØŒ ØªØªØºÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ù…Ù†Ø© ÙˆÙÙ‚Ù‹Ø§ Ù„Ù„ØµÙŠØºØ© <br><br><p style=";text-align:right;direction:rtl"></p><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/30a/6b2/d3c/30a6b2d3c27bb27afaeb4736072e4446.svg" alt="h_ {t + 1} = h_ {t} + f (h_ {t} ØŒ \ theta_ {t})"></div><br>  Ø§ÙŠÙ† <img src="https://habrastorage.org/getpro/habr/post_images/7ca/860/97d/7ca86097dc5dc0d9cbb9b454168de928.svg" alt="t \ in \ {0 ... T \}">  Ù‡Ùˆ Ø±Ù‚Ù… ÙƒØªÙ„Ø© Ùˆ <img src="https://habrastorage.org/getpro/habr/post_images/eb2/5f7/ddf/eb25f7ddf77e46681e256b28fecaef35.svg" alt="Ùˆ">  Ù‡Ø°Ù‡ Ù‡ÙŠ ÙˆØ¸ÙŠÙØ© ØªØ¹Ù„Ù…ØªÙ‡Ø§ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØªÙ„Ø©. <br><br>  ÙÙŠ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ ØŒ Ø¥Ø°Ø§ Ø£Ø®Ø°Ù†Ø§ Ø¹Ø¯Ø¯Ù‹Ø§ Ù„Ø§ Ø­ØµØ± Ù„Ù‡ Ù…Ù† Ø§Ù„ÙƒØªÙ„ Ø¨Ø®Ø·ÙˆØ§Øª Ø£ØµØºØ± Ù…Ù† Ø£ÙŠ ÙˆÙ‚Øª Ù…Ø¶Ù‰ ØŒ ÙØ³ÙˆÙ Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Øª Ù…Ø³ØªÙ…Ø±Ø© Ù„Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ù…Ø®ÙÙŠØ© ÙÙŠ Ø´ÙƒÙ„ ODE ØŒ ØªÙ…Ø§Ù…Ù‹Ø§ ÙƒÙ…Ø§ ÙƒØ§Ù† Ø£Ø¹Ù„Ø§Ù‡. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/629/67a/d41/62967ad41e5f50cc65e1c1e55a2860d3.svg" alt="\ frac {dh (t)} {dt} = f (h (t) ØŒ t ØŒ \ theta)"></div><br>  Ø¨Ø¯Ø¡Ø§ Ù…Ù† Ø·Ø¨Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ <img src="https://habrastorage.org/getpro/habr/post_images/c33/9b9/bc0/c339b9bc0244968c806390c2e66fdb62.svg" alt="Ø­ (0)">  ÙŠÙ…ÙƒÙ†Ù†Ø§ ØªØ­Ø¯ÙŠØ¯ Ø·Ø¨Ù‚Ø© Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ <img src="https://habrastorage.org/getpro/habr/post_images/b7e/dec/ef3/b7edecef308ce0df4f3d1c8aaa753617.svg" alt="Ø­ (Ø±)">  ÙƒØ­Ù„ Ù„Ù‡Ø°Ø§ ODE ÙÙŠ ÙˆÙ‚Øª T. <br><br>  Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ <img src="https://habrastorage.org/getpro/habr/post_images/2cb/bcb/347/2cbbcb347a44c276c1095ac5bb3f8242.svg" alt="\ Ø«ÙŠØªØ§">  ÙƒÙ…Ø§ Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ù…ÙˆØ²Ø¹Ø© ( <em>Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©</em> ) Ø¨ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªÙ„ Ù…ØªÙ†Ø§Ù‡ÙŠØ© Ø§Ù„ØµØºØ±. <br><br><h3 style=";text-align:right;direction:rtl">  Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø¨Ù†ÙŠØ© ODE Ø§Ù„Ø¹ØµØ¨ÙŠØ© Ø¹Ù„Ù‰ MNIST </h3><br>  ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ØŒ Ø³Ù†Ø®ØªØ¨Ø± Ù‚Ø¯Ø±Ø© <em>ODE Neural</em> Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙƒÙ…ÙƒÙˆÙ†Ø§Øª ÙÙŠ Ø£Ø¨Ù†ÙŠØ© Ù…Ø£Ù„ÙˆÙØ© Ø£ÙƒØ«Ø±. <br><br>  Ø¹Ù„Ù‰ ÙˆØ¬Ù‡ Ø§Ù„Ø®ØµÙˆØµ ØŒ Ø³Ù†Ø³ØªØ¨Ø¯Ù„ Ø§Ù„ÙƒØªÙ„ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ø¨Ù€ <em>ODE Neural</em> ÙÙŠ Ù…ØµÙ†Ù MNIST. <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/7c/gw/ia/7cgwiawqx6-_kxk82qpenqplowi.png" width="400"></div><br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ÙƒÙˆØ¯</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">norm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dim)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nn.BatchNorm2d(dim) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">conv3x3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(in_feats, out_feats, stride=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nn.Conv2d(in_feats, out_feats, kernel_size=<span class="hljs-number"><span class="hljs-number">3</span></span>, stride=stride, padding=<span class="hljs-number"><span class="hljs-number">1</span></span>, bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(in_tensor, t)</span></span></span><span class="hljs-function">:</span></span> bs, c, w, h = in_tensor.shape <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> torch.cat((in_tensor, t.expand(bs, <span class="hljs-number"><span class="hljs-number">1</span></span>, w, h)), dim=<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConvODEF</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ODEF)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, dim)</span></span></span><span class="hljs-function">:</span></span> super(ConvODEF, self).__init__() self.conv1 = conv3x3(dim + <span class="hljs-number"><span class="hljs-number">1</span></span>, dim) self.norm1 = norm(dim) self.conv2 = conv3x3(dim + <span class="hljs-number"><span class="hljs-number">1</span></span>, dim) self.norm2 = norm(dim) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, t)</span></span></span><span class="hljs-function">:</span></span> xt = add_time(x, t) h = self.norm1(torch.relu(self.conv1(xt))) ht = add_time(h, t) dxdt = self.norm2(torch.relu(self.conv2(ht))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dxdt <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContinuousNeuralMNISTClassifier</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(nn.Module)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, ode)</span></span></span><span class="hljs-function">:</span></span> super(ContinuousNeuralMNISTClassifier, self).__init__() self.downsampling = nn.Sequential( nn.Conv2d(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), norm(<span class="hljs-number"><span class="hljs-number">64</span></span>), nn.ReLU(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>), nn.Conv2d(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), norm(<span class="hljs-number"><span class="hljs-number">64</span></span>), nn.ReLU(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>), nn.Conv2d(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), ) self.feature = ode self.norm = norm(<span class="hljs-number"><span class="hljs-number">64</span></span>) self.avg_pool = nn.AdaptiveAvgPool2d((<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) self.fc = nn.Linear(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x)</span></span></span><span class="hljs-function">:</span></span> x = self.downsampling(x) x = self.feature(x) x = self.norm(x) x = self.avg_pool(x) shape = torch.prod(torch.tensor(x.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>:])).item() x = x.view(<span class="hljs-number"><span class="hljs-number">-1</span></span>, shape) out = self.fc(x) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> out func = ConvODEF(<span class="hljs-number"><span class="hljs-number">64</span></span>) ode = NeuralODE(func) model = ContinuousNeuralMNISTClassifier(ode) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda: model = model.cuda() <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torchvision img_std = <span class="hljs-number"><span class="hljs-number">0.3081</span></span> img_mean = <span class="hljs-number"><span class="hljs-number">0.1307</span></span> batch_size = <span class="hljs-number"><span class="hljs-number">32</span></span> train_loader = torch.utils.data.DataLoader( torchvision.datasets.MNIST(<span class="hljs-string"><span class="hljs-string">"data/mnist"</span></span>, train=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, download=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, transform=torchvision.transforms.Compose([ torchvision.transforms.ToTensor(), torchvision.transforms.Normalize((img_mean,), (img_std,)) ]) ), batch_size=batch_size, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ) test_loader = torch.utils.data.DataLoader( torchvision.datasets.MNIST(<span class="hljs-string"><span class="hljs-string">"data/mnist"</span></span>, train=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, download=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, transform=torchvision.transforms.Compose([ torchvision.transforms.ToTensor(), torchvision.transforms.Normalize((img_mean,), (img_std,)) ]) ), batch_size=<span class="hljs-number"><span class="hljs-number">128</span></span>, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ) optimizer = torch.optim.Adam(model.parameters()) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(epoch)</span></span></span><span class="hljs-function">:</span></span> num_items = <span class="hljs-number"><span class="hljs-number">0</span></span> train_losses = [] model.train() criterion = nn.CrossEntropyLoss() print(<span class="hljs-string"><span class="hljs-string">f"Training Epoch </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{epoch}</span></span></span><span class="hljs-string">..."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> batch_idx, (data, target) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tqdm(enumerate(train_loader), total=len(train_loader)): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda: data = data.cuda() target = target.cuda() optimizer.zero_grad() output = model(data) loss = criterion(output, target) loss.backward() optimizer.step() train_losses += [loss.item()] num_items += data.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>] print(<span class="hljs-string"><span class="hljs-string">'Train loss: {:.5f}'</span></span>.format(np.mean(train_losses))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> train_losses <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> accuracy = <span class="hljs-number"><span class="hljs-number">0.0</span></span> num_items = <span class="hljs-number"><span class="hljs-number">0</span></span> model.eval() criterion = nn.CrossEntropyLoss() print(<span class="hljs-string"><span class="hljs-string">f"Testing..."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> torch.no_grad(): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> batch_idx, (data, target) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tqdm(enumerate(test_loader), total=len(test_loader)): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda: data = data.cuda() target = target.cuda() output = model(data) accuracy += torch.sum(torch.argmax(output, dim=<span class="hljs-number"><span class="hljs-number">1</span></span>) == target).item() num_items += data.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>] accuracy = accuracy * <span class="hljs-number"><span class="hljs-number">100</span></span> / num_items print(<span class="hljs-string"><span class="hljs-string">"Test Accuracy: {:.3f}%"</span></span>.format(accuracy)) n_epochs = <span class="hljs-number"><span class="hljs-number">5</span></span> test() train_losses = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> epoch <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, n_epochs + <span class="hljs-number"><span class="hljs-number">1</span></span>): train_losses += train(epoch) test() <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)) history = pd.DataFrame({<span class="hljs-string"><span class="hljs-string">"loss"</span></span>: train_losses}) history[<span class="hljs-string"><span class="hljs-string">"cum_data"</span></span>] = history.index * batch_size history[<span class="hljs-string"><span class="hljs-string">"smooth_loss"</span></span>] = history.loss.ewm(halflife=<span class="hljs-number"><span class="hljs-number">10</span></span>).mean() history.plot(x=<span class="hljs-string"><span class="hljs-string">"cum_data"</span></span>, y=<span class="hljs-string"><span class="hljs-string">"smooth_loss"</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), title=<span class="hljs-string"><span class="hljs-string">"train error"</span></span>)</code> </pre><br></div></div><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Testing... 100% 79/79 [00:01&lt;00:00, 45.69it/s] Test Accuracy: 9.740% Training Epoch 1... 100% 1875/1875 [01:15&lt;00:00, 24.69it/s] Train loss: 0.20137 Testing... 100% 79/79 [00:01&lt;00:00, 46.64it/s] Test Accuracy: 98.680% Training Epoch 2... 100% 1875/1875 [01:17&lt;00:00, 24.32it/s] Train loss: 0.05059 Testing... 100% 79/79 [00:01&lt;00:00, 46.11it/s] Test Accuracy: 97.760% Training Epoch 3... 100% 1875/1875 [01:16&lt;00:00, 24.63it/s] Train loss: 0.03808 Testing... 100% 79/79 [00:01&lt;00:00, 45.65it/s] Test Accuracy: 99.000% Training Epoch 4... 100% 1875/1875 [01:17&lt;00:00, 24.28it/s] Train loss: 0.02894 Testing... 100% 79/79 [00:01&lt;00:00, 45.42it/s] Test Accuracy: 99.130% Training Epoch 5... 100% 1875/1875 [01:16&lt;00:00, 24.67it/s] Train loss: 0.02424 Testing... 100% 79/79 [00:01&lt;00:00, 45.89it/s] Test Accuracy: 99.170%</code> </pre><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zx/zv/5x/zxzv5x4ktqyy9lt19of-d2i4few.png"></div><br>  Ø¨Ø¹Ø¯ ØªØ¯Ø±ÙŠØ¨ ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù„ØºØ§ÙŠØ© Ø®Ù„Ø§Ù„ Ø®Ù…Ø³ Ø¹ØµÙˆØ± ÙÙ‚Ø· Ùˆ 6 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ØŒ ÙˆØµÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¥Ù„Ù‰ Ø®Ø·Ø£ Ø§Ø®ØªØ¨Ø§Ø± Ø£Ù‚Ù„ Ù…Ù† 1Ùª.  ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ù„Ù‚ÙˆÙ„ Ø£Ù† <em>ODEs Ø§Ù„Ø¹ØµØ¨ÙŠØ©</em> ØªØ¯Ù…Ø¬ ÙƒØ°Ù„Ùƒ ÙƒØ¹Ù†ØµØ± ÙÙŠ Ø´Ø¨ÙƒØ§Øª Ø£ÙƒØ«Ø± ØªÙ‚Ù„ÙŠØ¯ÙŠØ©. <br><br>  ÙÙŠ Ù…Ù‚Ø§Ù„ØªÙ‡Ù… ØŒ Ù‚Ø§Ø±Ù† Ø§Ù„Ù…Ø¤Ù„ÙÙˆÙ† Ø£ÙŠØ¶Ù‹Ø§ Ù‡Ø°Ø§ Ø§Ù„Ù…ØµÙ†Ù (ODE-Net) Ø¨Ø´Ø¨ÙƒØ© Ù…Ù†ØªØ¸Ù…Ø© Ù…ØªØµÙ„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ØŒ Ù…Ø¹ ResNet Ù…Ø¹ Ø¨Ù†ÙŠØ© Ù…Ù…Ø§Ø«Ù„Ø© ØŒ ÙˆØ¨Ù†ÙØ³ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© ØŒ Ø§Ù„ØªÙŠ ÙŠÙ†ØªØ´Ø± ÙÙŠÙ‡Ø§ Ø§Ù„ØªØ¯Ø±Ø¬ <em>Ø§Ù„Ù„ÙˆÙ†ÙŠ</em> Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙÙŠ <em>ODESolve</em> (Ø¨Ø¯ÙˆÙ† Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù…ØªØ±Ø§ÙÙ‚) ( RK-Net). <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vn/41/--/vn41--frzbdkftca4ehe7hh-kea.png"></div><br>  <i>ØªÙˆØ¶ÙŠØ­ Ù…Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ.</i> <br><br>  ÙˆÙÙ‚Ø§ Ù„Ù‡Ù… ØŒ ÙØ¥Ù† Ø´Ø¨ÙƒØ© Ù…ØªØµÙ„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø°Ø§Øª Ø·Ø¨Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ Ù…Ø«Ù„ <em>Neural ODE</em> Ø¨Ù‡Ø§ Ø®Ø·Ø£ Ø£Ø¹Ù„Ù‰ Ø¨ÙƒØ«ÙŠØ± ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØŒ ResNet Ù…Ø¹ Ù†ÙØ³ Ø§Ù„Ø®Ø·Ø£ Ø¥Ù„Ù‰ Ø­Ø¯ ÙƒØ¨ÙŠØ± Ø¨Ù‡ Ù…Ø¹Ù„Ù…Ø§Øª Ø£ÙƒØ«Ø± Ø¨ÙƒØ«ÙŠØ± ØŒ Ùˆ RK-Net Ø¨Ø¯ÙˆÙ† Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù…ØªØ±Ø§ÙÙ‚ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø®Ø·Ø£ Ø£Ø¹Ù„Ù‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙˆÙ…Ø¹ Ø²ÙŠØ§Ø¯Ø© Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø´ÙƒÙ„ Ø®Ø·ÙŠ (ÙƒÙ„Ù…Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ <em>Ø£ØµØºØ±Ù‹Ø§</em> ØŒ Ø²Ø§Ø¯Øª Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ <em>ODESolve</em> Ø§ØªØ®Ø§Ø°Ù‡Ø§ ØŒ Ù…Ù…Ø§ ÙŠØ²ÙŠØ¯ Ù…Ù† Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø®Ø·ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª). <br><br>  ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¤Ù„ÙÙˆÙ† Ø·Ø±ÙŠÙ‚Ø© Runge-Kutta Ø§Ù„Ø¶Ù…Ù†ÙŠØ© Ù…Ø¹ Ø­Ø¬Ù… Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªÙƒÙŠÙÙŠ ÙÙŠ ØªÙ†ÙÙŠØ°Ù‡Ø§ ØŒ Ø¹Ù„Ù‰ Ø¹ÙƒØ³ Ø·Ø±ÙŠÙ‚Ø© Euler Ø§Ù„Ø£Ø¨Ø³Ø· Ù‡Ù†Ø§.  Ù‡Ù… Ø£ÙŠØ¶Ø§ Ø¯Ø±Ø§Ø³Ø© Ø¨Ø¹Ø¶ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/u7/li/fq/u7lifqdsf72otgcyfigm6-fiyww.png"></div><br>  <i>Ù…ÙŠØ²Ø© ODE-Net (NFE Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù…Ø§Ù… - Ø¹Ø¯Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ÙÙŠ Ù…Ø³Ø§Ø± Ù…Ø¨Ø§Ø´Ø±)</i> <i><br></i>  <i>ØªÙˆØ¶ÙŠØ­ Ù…Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ.</i> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  (Ø£) ØªØºÙŠÙŠØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø¹Ø¯Ø¯ÙŠ Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ ÙŠØºÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª ÙÙŠ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±. <br></li><li style=";text-align:right;direction:rtl">  (Ø¨) Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø°ÙŠ ÙŠÙ‚Ø¶ÙŠÙ‡ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø¹Ø¯Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù. <br></li><li style=";text-align:right;direction:rtl">  (Ø¬) ÙŠÙ…Ø«Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø®Ù„ÙÙŠ Ù…Ø§ ÙŠÙ‚Ø±Ø¨ Ù…Ù† Ù†ØµÙ Ø§Ù„Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ØŒ Ù…Ù…Ø§ ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø£Ù† Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù…ØªØ²Ø§Ù…Ù† Ù‚Ø¯ ØªÙƒÙˆÙ† Ø£ÙƒØ«Ø± ÙƒÙØ§Ø¡Ø© Ù…Ù† Ø§Ù„Ù†Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© Ù…Ù† Ù†Ø´Ø± Ø§Ù„ØªØ¯Ø±Ø¬ <em>Ø§Ù„Ù„ÙˆÙ†ÙŠ</em> Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø®Ù„Ø§Ù„ <em>ODESolve</em> . <br></li><li style=";text-align:right;direction:rtl">  (Ø¯) Ø¹Ù†Ø¯Ù…Ø§ ÙŠØµØ¨Ø­ ODE-Net Ø£ÙƒØ«Ø± ÙˆØ£ÙƒØ«Ø± ØªØ¯Ø±ÙŠØ¨Ø§Ù‹ ØŒ ÙØ¥Ù†Ù‡ ÙŠØªØ·Ù„Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ ÙˆØ§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© Ù„Ù„ÙˆØ¸ÙŠÙØ© (Ø®Ø·ÙˆØ© Ø£ØµØºØ± Ù…Ù† Ø£ÙŠ ÙˆÙ‚Øª Ù…Ø¶Ù‰) ØŒ ÙˆØ±Ø¨Ù…Ø§ Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„Ù…ØªØ²Ø§ÙŠØ¯ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬. <br></li></ul><br><br><h2 style=";text-align:right;direction:rtl">  ÙˆØ¸ÙŠÙØ© ØªÙˆÙ„ÙŠØ¯ÙŠØ© Ø®ÙÙŠØ© Ù„Ù†Ù…Ø°Ø¬Ø© Ø§Ù„Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø²Ù…Ù†ÙŠØ© </h2><br>  ODE Ø§Ù„Ø¹ØµØ¨ÙŠ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø© Ø­ØªÙ‰ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙ…Ù† Ø§Ù„Ù…Ø³Ø§Ø± ÙÙŠ Ù…Ø³Ø§Ø­Ø© Ù…Ø®ÙÙŠØ© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©. <br><br>  ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ØŒ Ø³Ù†Ù‚ÙˆÙ… Ø¨ØªØ¬Ø±Ø¨Ø© ÙˆØªØºÙŠÙŠØ± ØªÙˆÙ„ÙŠØ¯ ØªØ³Ù„Ø³Ù„ Ù…Ø³ØªÙ…Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… <em>Neural ODE</em> ØŒ ÙˆÙ†Ù„Ù‚ÙŠ Ù†Ø¸Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø®ÙÙŠØ© Ø§Ù„Ù…Ø³ØªÙØ§Ø¯Ø©. <br><br>  ÙŠÙ‚Ø§Ø±Ù† Ø§Ù„Ù…Ø¤Ù„ÙÙˆÙ† Ù‡Ø°Ø§ Ø£ÙŠØ¶Ù‹Ø§ Ø¨Ø§Ù„ØªØ³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø© Ø§Ù„Ù†Ø§ØªØ¬Ø© Ø¹Ù† Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©. <br><br>  ØªØ®ØªÙ„Ù Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ù‡Ù†Ø§ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ ÙÙŠ Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù…Ø¤Ù„ÙÙŠÙ† ØŒ ÙÙ‡Ù†Ø§Ùƒ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ØªÙ†ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª. <br><br><h3 style=";text-align:right;direction:rtl">  Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª </h3><br>  ØªØªÙƒÙˆÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù„ÙˆØ§Ù„Ø¨ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ØŒ Ù†ØµÙÙ‡Ø§ ÙÙŠ Ø§ØªØ¬Ø§Ù‡ Ø¹Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø© ØŒ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø¹Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©.  Ø¹Ù„Ø§ÙˆØ© Ø¹Ù„Ù‰ Ø°Ù„Ùƒ ØŒ ÙŠØªÙ… Ø£Ø®Ø° Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙˆØ§Ù„Ø¨ ØŒ Ø§Ù„ØªÙŠ ØªØªÙ… Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ù…ÙˆØ°Ø¬ ØªÙƒØ±Ø§Ø± Ø§Ù„ØªØ±Ù…ÙŠØ² ÙÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…Ø¹Ø§ÙƒØ³ ØŒ Ù…Ù…Ø§ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø¨Ø¯Ø§ÙŠØ© Ø­Ø§Ù„Ø© Ù…Ø®ÙÙŠØ© ØŒ ÙˆØ§Ù„ØªÙŠ ØªØªØ·ÙˆØ± Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ ØŒ Ù…Ù…Ø§ ÙŠØ®Ù„Ù‚ Ù…Ø³Ø§Ø±Ù‹Ø§ ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø®ÙÙŠ.  Ø«Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø± ÙƒØ§Ù…Ù† Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ…Ù‚Ø§Ø±Ù†ØªÙ‡Ø§ Ù…Ø¹ ÙŠÙ„ÙŠÙ‡ Ø¹ÙŠÙ†Ø§Øª.  ÙˆØ¨Ø§Ù„ØªØ§Ù„ÙŠ ØŒ ÙŠØªØ¹Ù„Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø±Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/or/4z/lg/or4zlgwkqjm-kzhvlmqtzmeqnl4.png"></div><br>  <i>Ø£Ù…Ø«Ù„Ø© Ù…Ù† Ø§Ù„Ù„ÙˆØ§Ù„Ø¨ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</i> <br><br><h3 style=";text-align:right;direction:rtl">  VAE ÙƒÙ†Ù…ÙˆØ°Ø¬ Ø¥Ù†ØªØ§Ø¬ÙŠ </h3><br>  Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø§Ù… Ù…Ù† Ø®Ù„Ø§Ù„ Ø¥Ø¬Ø±Ø§Ø¡ Ø£Ø®Ø° Ø§Ù„Ø¹ÙŠÙ†Ø§Øª: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/fde/a91/b7b/fdea91b7b77af8c87a50e6c9e361f13b.svg" alt="z_ {t_0} \ sim \ mathcal {N} (0 ØŒ I)"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/fb0/9b2/ad7/fb09b2ad71d820266be632be7c5b5f97.svg" alt="z_ {t_1}ØŒ z_ {t_2}ØŒ ...ØŒ z_ {t_M} = \ text {ODESolve} (z_ {t_0}ØŒ fØŒ \ theta_fØŒ t_0ØŒ ...ØŒ t_M)"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/477/5a1/439/4775a14397c7842e67c0756d585c3d5b.svg" alt="x_ {t_i} \ sim p (x \ mid z_ {t_i}Ø› \ theta_x)"></div><br>  ÙˆØ§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† ØªØ¯Ø±ÙŠØ¨Ù‡Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù‡Ø¬ Ø§Ù„ØªØ±Ù…ÙŠØ² Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª. <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Ø§Ù†ØªÙ‚Ù„ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„ØªØ´ÙÙŠØ± Ø§Ù„Ù…ØªÙƒØ±Ø± Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ³Ù„Ø³Ù„ Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª <img src="https://habrastorage.org/getpro/habr/post_images/26b/84a/1dd/26b84a1dd2d618b4dd85d805e95b5db3.svg" alt="\ mu_ {z_ {t_0}}">  ØŒ <img src="https://habrastorage.org/getpro/habr/post_images/a1f/9e2/8ac/a1f9e28acee2636547023da51c1af36e.svg" alt="\ sigma_ {z_ {t_0}}">  Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø®Ù„ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± ØŒ Ø«Ù… Ø£Ø®Ø° Ø¹ÙŠÙ†Ø© Ù…Ù†Ù‡: <br></li></ol><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/816/997/3be/8169973bece43135c717f8abd5088e4c.svg" alt="z_ {t_0} \ sim q \ left (z_ {t_0} \ mid x_ {t_0}ØŒ ...ØŒ x_ {t_M}Ø› t_0ØŒ ...ØŒ t_MØ› \ theta_q \ right) = \ mathcal {N} \ ÙŠØ³Ø§Ø± (z_ {t_0} \ mid \ mu_ {z_ {t_0}} \ sigma_ {z_ {t_0}} \ Ø§Ù„ÙŠÙ…ÙŠÙ†)"></div><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø®ÙÙŠ: <br></li></ol><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/416/810/833/416810833bb304242b3ec7bccfeb91ad.svg" alt="z_ {t_1}ØŒ z_ {t_2}ØŒ ...ØŒ z_ {t_N} = \ text {ODESolve} (z_ {t_0}ØŒ fØŒ \ theta_fØŒ t_0ØŒ ...ØŒ t_N)ØŒ \ text {Ø­ÙŠØ«} \ frac {dz} {dt} = f (zØŒ tØ› \ theta_f)"></div><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Ø¹ÙŠÙ‘Ù† Ù…Ø³Ø§Ø±Ù‹Ø§ Ù…Ø®ÙÙŠÙ‹Ø§ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø± ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø´Ø¨ÙƒØ© Ø¹ØµØ¨ÙŠØ© Ø£Ø®Ø±Ù‰: <img src="https://habrastorage.org/getpro/habr/post_images/fd1/2b0/73d/fd12b073dd1cede0a98b312c0e3240d1.svg" alt="\ hat {x_ {t_i}} (z_ {t_i}ØŒ t_iØ› \ theta_x)"><br></li><li style=";text-align:right;direction:rtl">  ØªØ¹Ø¸ÙŠÙ… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (ELBO) Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¹ÙŠÙ†Ø©: <br></li></ol><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/9cf/838/1e3/9cf8381e35978cf70219a1f3bea211b6.svg" alt="\ text {ELBO} \ approx N \ Big (\ sum_ {i = 0} ^ {M} \ log p (x_ {t_i} \ mid z_ {t_i} (z_ {t_0}Ø› \ theta_x) + \ theta_x) + KL \ left (q (z_ {t_0} \ mid x_ {t_0}ØŒ ...ØŒ x_ {t_M}Ø› t_0ØŒ ...ØŒ t_MØ› \ theta_q) \ parallel \ mathcal {N} (0ØŒ I) \ Ø§Ù„ÙŠÙ…ÙŠÙ†) \ ÙƒØ¨ÙŠØ±)"></div><br>  ÙˆÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø®Ù„ÙÙŠ Ø§Ù„ØºÙˆØ³ÙŠ <img src="https://habrastorage.org/getpro/habr/post_images/9a9/404/aa0/9a9404aa0267a6c257815abc794e95c3.svg" alt="p (x \ mid z_ {t_i}Ø› \ theta_x)">  ÙˆÙ…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ© <img src="https://habrastorage.org/getpro/habr/post_images/87a/7c9/aba/87a7c9abaa12e58e75ef64aa8312050e.svg" alt="\ sigma_x">  : <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7b0/a0d/c43/7b0a0dc43667f287d584b6865afa1cfb.svg" alt="\ text {ELBO} \ approx -N \ Big (\ sum_ {i = 1} ^ {M} \ frac {(x_i - \ hat {x_i}) ^ 2} {\ sigma_x ^ 2} - \ log \ sigma_ { z_ {t_0}} ^ 2 + \ mu_ {z_ {t_0}} ^ 2 + \ sigma_ {z_ {t_0}} ^ 2 \ Big) + C"></div><br>  ÙŠÙ…ÙƒÙ† ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ø­Ø³Ø§Ø¨ Ù†Ù…ÙˆØ°Ø¬ ODE Ø§Ù„Ù…Ø®ÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø­Ùˆ Ø§Ù„ØªØ§Ù„ÙŠ <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zl/57/ui/zl57uisgnvjy7-y94fkker9m1eq.png"></div><br>  <i>ØªÙˆØ¶ÙŠØ­ Ù…Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ.</i> <br><br>  ÙŠÙ…ÙƒÙ† Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ Ø§Ø®ØªØ¨Ø§Ø± Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ù…Ø¹Ø±ÙØ© ÙƒÙŠÙÙŠØ© ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ù…Ø³Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙÙ‚Ø·. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ÙƒÙˆØ¯</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><h3 style=";text-align:right;direction:rtl">  ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ </h3><br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RNNEncoder</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(nn.Module)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, input_dim, hidden_dim, latent_dim)</span></span></span><span class="hljs-function">:</span></span> super(RNNEncoder, self).__init__() self.input_dim = input_dim self.hidden_dim = hidden_dim self.latent_dim = latent_dim self.rnn = nn.GRU(input_dim+<span class="hljs-number"><span class="hljs-number">1</span></span>, hidden_dim) self.hid2lat = nn.Linear(hidden_dim, <span class="hljs-number"><span class="hljs-number">2</span></span>*latent_dim) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, t)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Concatenate time to input t = t.clone() t[1:] = t[:-1] - t[1:] t[0] = 0. xt = torch.cat((x, t), dim=-1) _, h0 = self.rnn(xt.flip((0,))) # Reversed # Compute latent dimension z0 = self.hid2lat(h0[0]) z0_mean = z0[:, :self.latent_dim] z0_log_var = z0[:, self.latent_dim:] return z0_mean, z0_log_var class NeuralODEDecoder(nn.Module): def __init__(self, output_dim, hidden_dim, latent_dim): super(NeuralODEDecoder, self).__init__() self.output_dim = output_dim self.hidden_dim = hidden_dim self.latent_dim = latent_dim func = NNODEF(latent_dim, hidden_dim, time_invariant=True) self.ode = NeuralODE(func) self.l2h = nn.Linear(latent_dim, hidden_dim) self.h2o = nn.Linear(hidden_dim, output_dim) def forward(self, z0, t): zs = self.ode(z0, t, return_whole_sequence=True) hs = self.l2h(zs) xs = self.h2o(hs) return xs class ODEVAE(nn.Module): def __init__(self, output_dim, hidden_dim, latent_dim): super(ODEVAE, self).__init__() self.output_dim = output_dim self.hidden_dim = hidden_dim self.latent_dim = latent_dim self.encoder = RNNEncoder(output_dim, hidden_dim, latent_dim) self.decoder = NeuralODEDecoder(output_dim, hidden_dim, latent_dim) def forward(self, x, t, MAP=False): z_mean, z_log_var = self.encoder(x, t) if MAP: z = z_mean else: z = z_mean + torch.randn_like(z_mean) * torch.exp(0.5 * z_log_var) x_p = self.decoder(z, t) return x_p, z, z_mean, z_log_var def generate_with_seed(self, seed_x, t): seed_t_len = seed_x.shape[0] z_mean, z_log_var = self.encoder(seed_x, t[:seed_t_len]) x_p = self.decoder(z_mean, t) return x_p</span></span></code> </pre><br><br><h3 style=";text-align:right;direction:rtl">  Ø¬ÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª </h3><br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">t_max = <span class="hljs-number"><span class="hljs-number">6.29</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span> n_points = <span class="hljs-number"><span class="hljs-number">200</span></span> noise_std = <span class="hljs-number"><span class="hljs-number">0.02</span></span> num_spirals = <span class="hljs-number"><span class="hljs-number">1000</span></span> index_np = np.arange(<span class="hljs-number"><span class="hljs-number">0</span></span>, n_points, <span class="hljs-number"><span class="hljs-number">1</span></span>, dtype=np.int) index_np = np.hstack([index_np[:, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>]]) times_np = np.linspace(<span class="hljs-number"><span class="hljs-number">0</span></span>, t_max, num=n_points) times_np = np.hstack([times_np[:, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>]] * num_spirals) times = torch.from_numpy(times_np[:, :, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>]).to(torch.float32) <span class="hljs-comment"><span class="hljs-comment"># Generate random spirals parameters normal01 = torch.distributions.Normal(0, 1.0) x0 = Variable(normal01.sample((num_spirals, 2))) * 2.0 W11 = -0.1 * normal01.sample((num_spirals,)).abs() - 0.05 W22 = -0.1 * normal01.sample((num_spirals,)).abs() - 0.05 W21 = -1.0 * normal01.sample((num_spirals,)).abs() W12 = 1.0 * normal01.sample((num_spirals,)).abs() xs_list = [] for i in range(num_spirals): if i % 2 == 1: # Make it counter-clockwise W21, W12 = W12, W21 func = LinearODEF(Tensor([[W11[i], W12[i]], [W21[i], W22[i]]])) ode = NeuralODE(func) xs = ode(x0[i:i+1], times[:, i:i+1], return_whole_sequence=True) xs_list.append(xs) orig_trajs = torch.cat(xs_list, dim=1).detach() samp_trajs = orig_trajs + torch.randn_like(orig_trajs) * noise_std samp_ts = times fig, axes = plt.subplots(nrows=3, ncols=3, figsize=(15, 9)) axes = axes.flatten() for i, ax in enumerate(axes): ax.scatter(samp_trajs[:, i, 0], samp_trajs[:, i, 1], c=samp_ts[:, i, 0], cmap=cm.plasma) plt.show() import numpy.random as npr def gen_batch(batch_size, n_sample=100): n_batches = samp_trajs.shape[1] // batch_size time_len = samp_trajs.shape[0] n_sample = min(n_sample, time_len) for i in range(n_batches): if n_sample &gt; 0: probs = [1. / (time_len - n_sample)] * (time_len - n_sample) t0_idx = npr.multinomial(1, probs) t0_idx = np.argmax(t0_idx) tM_idx = t0_idx + n_sample else: t0_idx = 0 tM_idx = time_len frm, to = batch_size*i, batch_size*(i+1) yield samp_trajs[t0_idx:tM_idx, frm:to], samp_ts[t0_idx:tM_idx, frm:to]</span></span></code> </pre><br><br><h3 style=";text-align:right;direction:rtl">  Ø§Ù„ØªØ¯Ø±ÙŠØ¨ </h3><br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">vae = ODEVAE(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>) vae = vae.cuda() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda: vae = vae.cuda() optim = torch.optim.Adam(vae.parameters(), betas=(<span class="hljs-number"><span class="hljs-number">0.9</span></span>, <span class="hljs-number"><span class="hljs-number">0.999</span></span>), lr=<span class="hljs-number"><span class="hljs-number">0.001</span></span>) preload = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> n_epochs = <span class="hljs-number"><span class="hljs-number">20000</span></span> batch_size = <span class="hljs-number"><span class="hljs-number">100</span></span> plot_traj_idx = <span class="hljs-number"><span class="hljs-number">1</span></span> plot_traj = orig_trajs[:, plot_traj_idx:plot_traj_idx+<span class="hljs-number"><span class="hljs-number">1</span></span>] plot_obs = samp_trajs[:, plot_traj_idx:plot_traj_idx+<span class="hljs-number"><span class="hljs-number">1</span></span>] plot_ts = samp_ts[:, plot_traj_idx:plot_traj_idx+<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda: plot_traj = plot_traj.cuda() plot_obs = plot_obs.cuda() plot_ts = plot_ts.cuda() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> preload: vae.load_state_dict(torch.load(<span class="hljs-string"><span class="hljs-string">"models/vae_spirals.sd"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> epoch_idx <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(n_epochs): losses = [] train_iter = gen_batch(batch_size) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x, t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> train_iter: optim.zero_grad() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda: x, t = x.cuda(), t.cuda() max_len = np.random.choice([<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>]) permutation = np.random.permutation(t.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>]) np.random.shuffle(permutation) permutation = np.sort(permutation[:max_len]) x, t = x[permutation], t[permutation] x_p, z, z_mean, z_log_var = vae(x, t) z_var = torch.exp(z_log_var) kl_loss = <span class="hljs-number"><span class="hljs-number">-0.5</span></span> * torch.sum(<span class="hljs-number"><span class="hljs-number">1</span></span> + z_log_var - z_mean**<span class="hljs-number"><span class="hljs-number">2</span></span> - z_var, <span class="hljs-number"><span class="hljs-number">-1</span></span>) loss = <span class="hljs-number"><span class="hljs-number">0.5</span></span> * ((x-x_p)**<span class="hljs-number"><span class="hljs-number">2</span></span>).sum(<span class="hljs-number"><span class="hljs-number">-1</span></span>).sum(<span class="hljs-number"><span class="hljs-number">0</span></span>) / noise_std**<span class="hljs-number"><span class="hljs-number">2</span></span> + kl_loss loss = torch.mean(loss) loss /= max_len loss.backward() optim.step() losses.append(loss.item()) print(<span class="hljs-string"><span class="hljs-string">f"Epoch </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{epoch_idx}</span></span></span><span class="hljs-string">"</span></span>) frm, to, to_seed = <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span> seed_trajs = samp_trajs[frm:to_seed] ts = samp_ts[frm:to] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda: seed_trajs = seed_trajs.cuda() ts = ts.cuda() samp_trajs_p = to_np(vae.generate_with_seed(seed_trajs, ts)) fig, axes = plt.subplots(nrows=<span class="hljs-number"><span class="hljs-number">3</span></span>, ncols=<span class="hljs-number"><span class="hljs-number">3</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>)) axes = axes.flatten() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, ax <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(axes): ax.scatter(to_np(seed_trajs[:, i, <span class="hljs-number"><span class="hljs-number">0</span></span>]), to_np(seed_trajs[:, i, <span class="hljs-number"><span class="hljs-number">1</span></span>]), c=to_np(ts[frm:to_seed, i, <span class="hljs-number"><span class="hljs-number">0</span></span>]), cmap=cm.plasma) ax.plot(to_np(orig_trajs[frm:to, i, <span class="hljs-number"><span class="hljs-number">0</span></span>]), to_np(orig_trajs[frm:to, i, <span class="hljs-number"><span class="hljs-number">1</span></span>])) ax.plot(samp_trajs_p[:, i, <span class="hljs-number"><span class="hljs-number">0</span></span>], samp_trajs_p[:, i, <span class="hljs-number"><span class="hljs-number">1</span></span>]) plt.show() print(np.mean(losses), np.median(losses)) clear_output(wait=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) spiral_0_idx = <span class="hljs-number"><span class="hljs-number">3</span></span> spiral_1_idx = <span class="hljs-number"><span class="hljs-number">6</span></span> homotopy_p = Tensor(np.linspace(<span class="hljs-number"><span class="hljs-number">0.</span></span>, <span class="hljs-number"><span class="hljs-number">1.</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)[:, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>]) vae = vae <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda: homotopy_p = homotopy_p.cuda() vae = vae.cuda() spiral_0 = orig_trajs[:, spiral_0_idx:spiral_0_idx+<span class="hljs-number"><span class="hljs-number">1</span></span>, :] spiral_1 = orig_trajs[:, spiral_1_idx:spiral_1_idx+<span class="hljs-number"><span class="hljs-number">1</span></span>, :] ts_0 = samp_ts[:, spiral_0_idx:spiral_0_idx+<span class="hljs-number"><span class="hljs-number">1</span></span>, :] ts_1 = samp_ts[:, spiral_1_idx:spiral_1_idx+<span class="hljs-number"><span class="hljs-number">1</span></span>, :] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda: spiral_0, ts_0 = spiral_0.cuda(), ts_0.cuda() spiral_1, ts_1 = spiral_1.cuda(), ts_1.cuda() z_cw, _ = vae.encoder(spiral_0, ts_0) z_cc, _ = vae.encoder(spiral_1, ts_1) homotopy_z = z_cw * (<span class="hljs-number"><span class="hljs-number">1</span></span> - homotopy_p) + z_cc * homotopy_p t = torch.from_numpy(np.linspace(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>*np.pi, <span class="hljs-number"><span class="hljs-number">200</span></span>)) t = t[:, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>].expand(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)[:, :, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>].cuda() t = t.cuda() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> use_cuda <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> t hom_gen_trajs = vae.decoder(homotopy_z, t) fig, axes = plt.subplots(nrows=<span class="hljs-number"><span class="hljs-number">2</span></span>, ncols=<span class="hljs-number"><span class="hljs-number">5</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>)) axes = axes.flatten() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, ax <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(axes): ax.plot(to_np(hom_gen_trajs[:, i, <span class="hljs-number"><span class="hljs-number">0</span></span>]), to_np(hom_gen_trajs[:, i, <span class="hljs-number"><span class="hljs-number">1</span></span>])) plt.show() torch.save(vae.state_dict(), <span class="hljs-string"><span class="hljs-string">"models/vae_spirals.sd"</span></span>)</code> </pre><br></div></div><br>       <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/fv/pn/pi/fvpnpimixf3sq0cezhepgzh2txy.png"></div><br> <i> â€”      (), <br>  â€”     ,    . <br><br>    .</i> <br><br>       .        .       . <br><br>    ,     -   - . <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/at/g_/7e/atg_7ecofins-uohnv99qccfxfq.png"></div><br><br>         <em>Neural ODE</em>    . <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/kj/ak/-e/kjak-evgr-7mrrtpgimf0gfmfxq.png"></div><br> <i>   </i> <br><br><h2 style=";text-align:right;direction:rtl">    </h2><br>         .   ,       ,         (, ),            . <br>  ,           ,   . <br><br> <em> </em>       <em> </em> , <em>  </em>     . <br><br>  , ,    <em></em> ,  ,  ,     . <br><br>  : <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nd/e_/wn/nde_wn590scz9dff_0hzxo1-tgg.png"></div><br> <i>    ( )   ( )   ; <br><br> -X        Â«Â» ( )  Â«Â» ( ). <br><br>    </i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">bekemax</a>            . <br><br>      <strong>Neural ODEs</strong> .   ! <br><br><h1 style=";text-align:right;direction:rtl">   </h1><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">   + . </a> <br></li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> <br></li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> <br></li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> <br></li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">   VAE ()</a> <br></li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> VAE</a> <br></li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">   </a> <br></li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Variational Inference with Normalizing Flows Paper</a> <br></li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar442002/">https://habr.com/ru/post/ar442002/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar441990/index.html">Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£ÙƒØ«Ø± ÙØ¹Ø§Ù„ÙŠØ© Ù„Ù…ÙƒØ§ÙØ­Ø© Ø§Ù„Ù‚Ø±ØµÙ†Ø© - Ø®Ø¯Ù…Ø§Øª Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ù…Ø±ÙŠØ­Ø© ÙˆØ±Ø®ÙŠØµØ©</a></li>
<li><a href="../ar441992/index.html">Ø§Ø®ØªÙŠØ§Ø± Ù‡Ø¯ÙŠØ© Ù„ÙØªØ§Ø© Ø§Ù„Ù…Ù‡ÙˆØ³</a></li>
<li><a href="../ar441994/index.html">Ù†Ø§Ø³Ø§: Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ Ø§Ù„ØµØ§Ù„Ø­Ø© Ù„Ù„Ø­ÙŠØ§Ø© ÙÙŠ Ù…Ø¬Ø±ØªÙ†Ø§ Ù‡Ùˆ Ø£Ù‚Ù„ Ø¨ÙƒØ«ÙŠØ± Ù…Ù…Ø§ ÙŠØ¹ØªÙ‚Ø¯ Ø¹Ù…ÙˆÙ…Ø§</a></li>
<li><a href="../ar441996/index.html">Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ù…Ù† 80s: Ø§Ù„Ø°ÙŠ ÙŠØ­ÙŠÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª waferscale</a></li>
<li><a href="../ar441998/index.html">"ÙØ§Ø²Øª Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª ÙÙŠ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© ØŒ Ù„ÙƒÙ†Ù‡Ø§ Ø®Ø³Ø±Øª Ø§Ù„Ø­Ø±Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ø§Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù…" - Ø³Ø§ÙŠÙ…ÙˆÙ† ÙˆØ§Ø±Ø¯Ù„ÙŠ</a></li>
<li><a href="../ar442004/index.html">Ø¢Ø«Ø§Ø± ØªØµÙÙŠØ© SVG. Ø§Ù„Ø¬Ø²Ø¡ 7. Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù…Ø§Ù…</a></li>
<li><a href="../ar442006/index.html">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø®Ø·Ø£ - Ø§Ù„Ø¬Ø²Ø¡ 2: ØªØ­ÙØ© Ù…Ù† Ø§Ù„Ø®Ø±Ø§Ø¡</a></li>
<li><a href="../ar442008/index.html">k3s Ù‡ÙŠ Kubernetes ØµØºÙŠØ±Ø© ÙˆÙ„ÙƒÙ†Ù‡Ø§ Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† Ù‚Ø¨Ù„ Rancher Labs</a></li>
<li><a href="../ar442010/index.html">Ø¨ÙŠØ«ÙˆÙ† Ùˆ FPGA. ØªØ¬Ø±ÙŠØ¨</a></li>
<li><a href="../ar442012/index.html">Ø§Ù„ØªØ¬Ø±Ø¨Ø©: Ù†Ù‚ÙˆÙ… Ø¨Ø¬Ù…Ø¹ Ø¯Ù„ÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„ØªÙŠ Ø£ØµØ¯Ø±Øª Ø¬ÙˆØ§Ø² Ø³ÙØ±</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>