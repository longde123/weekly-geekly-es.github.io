<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëî üïµÔ∏è üë®üèª‚Äç‚öïÔ∏è Cara memutakhirkan proyek yang ada dari ASP.NET MVC ke ASP.NET Core. Panduan praktis üßïüèº üìª üíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Posting ini lahir dari pengalaman kami memigrasikan proyek yang ada dari ASP.NET MVC ke ASP.NET Core. Kami mencoba menyatukan seluruh proses migrasi d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara memutakhirkan proyek yang ada dari ASP.NET MVC ke ASP.NET Core. Panduan praktis</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472738/">  Posting ini lahir dari pengalaman kami memigrasikan proyek yang ada dari ASP.NET MVC ke ASP.NET Core.  Kami mencoba menyatukan seluruh proses migrasi dalam bentuk terstruktur dan menggambarkan berbagai hambatan sehingga pengembang dapat terus bergantung pada materi ini dan mengikuti peta jalan dalam menyelesaikan masalah tersebut. <br><br>  Beberapa kata tentang proyek kami.  Kami adalah platform eCommerce open-source di ASP.NET, yang pada saat transfer sudah ada dengan sukses selama 9 tahun.  Kami melakukan migrasi 2 tahun yang lalu - tetapi tangan kami datang untuk menulis tentang hal itu sekarang.  Pada saat itu, kami adalah salah satu proyek besar pertama yang memutuskan langkah seperti itu. <br><br><h2>  Mengapa beralih ke ASP.NET Core? </h2><br>  Sebelum melanjutkan dengan langkah-langkah untuk bermigrasi dari ASP.NET MVC ke ASP.NET Core, beberapa kata tentang manfaat platform ini. <br><br><img src="https://habrastorage.org/webt/wo/xg/ue/woxgueorhrjz_brki1qktunkqhe.png"><br><a name="habracut"></a><br><div class="spoiler"> <b class="spoiler_title">Manfaat dari ASP.NET Core</b> <div class="spoiler_text">  Jadi, ASP.NET Core sudah merupakan kerangka kerja yang cukup terkenal dan dikembangkan, yang telah mengalami beberapa pembaruan besar, yang berarti bahwa saat ini cukup stabil, maju secara teknologi dan tahan terhadap serangan XSRF / CSRF. <br><br>  <b>Cross</b> - <b>platform</b> adalah salah satu keunggulan yang memungkinkannya untuk mendapatkan popularitas yang semakin banyak.  Mulai sekarang, aplikasi web Anda dapat berjalan di lingkungan Windows dan Unix. <br><br>  <b>Modularitas</b> - ASP.NET Core hadir sepenuhnya dalam bentuk paket NuGet, ini memungkinkan Anda untuk mengoptimalkan aplikasi, termasuk paket yang diperlukan yang dipilih.  Ini meningkatkan kinerja solusi dan mengurangi waktu yang diperlukan untuk memutakhirkan bagian-bagian individual.  Ini adalah fitur penting kedua yang memungkinkan pengembang untuk lebih fleksibel mengintegrasikan fitur-fitur baru ke dalam solusi mereka. <br><br>  <b>Kinerja</b> adalah langkah lain untuk membangun aplikasi berkinerja tinggi, ASP.NET Core memproses 2300% lebih banyak permintaan per detik dari ASP.NET 4.6, dan 800% lebih banyak permintaan per detik daripada node.js.  Anda dapat memeriksa sendiri tes kinerja terperinci di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> atau di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><img src="https://habrastorage.org/webt/wb/vg/oi/wbvgoixwdbcfr0m8l0myjywrlpq.png"><br><br>  <b>Middleware</b> adalah pipa modular ringan kinerja tinggi baru untuk permintaan dalam aplikasi.  Setiap bagian middleware memproses permintaan HTTP, dan kemudian memutuskan untuk mengembalikan hasilnya, atau melewati bagian middleware berikutnya.  Pendekatan ini memberikan pengembang kontrol penuh atas pipa HTTP dan berkontribusi pada pengembangan modul sederhana untuk aplikasi, yang penting untuk proyek open source yang berkembang. <br><br>  ASP.NET Core MVC menyediakan fitur yang menyederhanakan pengembangan web.  NopCommerce telah menggunakan fitur seperti template Model-View-Controller, sintaks Razor, pengikatan dan validasi model, tetapi alat baru muncul: <br><br><ul><li>  Beri Tag pada Pembantu.  Ini adalah kode sisi server untuk berkontribusi pada pembuatan dan rendering elemen HTML dalam file Razor. </li><li>  Lihat komponen.  Ini adalah alat baru, mirip dengan tampilan sebagian, tetapi jauh lebih kuat.  nopCommerce menggunakan komponen tampilan ketika menggunakan kembali logika rendering diperlukan dan ketika tugas terlalu kompleks untuk tampilan parsial. </li><li>  Tampilan DI.  Meskipun sebagian besar data yang ditampilkan dalam pandangan dilewatkan dari controller, nopCommerce memiliki pandangan di mana injeksi ketergantungan lebih nyaman. </li></ul><br>  Tentu saja, ASP.NET Core memiliki lebih banyak fitur, tetapi kami baru saja memeriksa yang paling menarik. </div></div><br>  Sekarang mari kita bicara tentang apa yang harus Anda pertimbangkan ketika porting aplikasi Anda ke platform baru. <br><br><h2>  Migrasi </h2><br>  Teks akan berisi sejumlah besar tautan ke dokumentasi resmi ASP.NET Core untuk membantu mendapatkan informasi lebih rinci tentang topik tersebut.  Terutama relevan untuk pengembang yang dihadapkan dengan tugas serupa untuk pertama kalinya. <br><br><h3>  Langkah 1. Persiapan alat </h3><br>  Hal pertama yang perlu Anda lakukan adalah meningkatkan Visual Studio 2017 ke versi 15.3 atau lebih tinggi.  Dan instal versi terbaru .NET Core SDK. <br><br>  Sebelum memulai migrasi, Anda disarankan untuk menggunakan alat analisis portabilitas .NET <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">.Net Portability Analyzer</a> .  Ini adalah titik awal yang baik untuk memahami betapa sulitnya transisi dari satu platform ke platform lainnya.  Tapi, tentu saja, alat ini tidak menyelesaikan semua masalah, dan dalam prosesnya akan ada banyak jebakan.  Selanjutnya, tahapan utama yang perlu dilewati akan dijelaskan, dan solusi yang digunakan dalam proyek kami akan ditampilkan. <br><br>  Hal pertama yang Anda butuhkan adalah memperbarui tautan ke perpustakaan yang digunakan dalam proyek yang akan mendukung .NET Standard. <br><br><h3>  Langkah 2. Analisis kompatibilitas paket NuGet untuk mendukung Standar Net </h3><br>  Jika Anda menggunakan paket NuGet dalam proyek Anda, Anda perlu memeriksa apakah mereka kompatibel dengan .NET Core.  Salah satu cara untuk melakukan ini adalah dengan menggunakan alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">NuGetPackageExplorer</a> . <br><br><h3>  Langkah 3. .NET Core menggunakan format file csproj yang baru </h3><br>  Penting untuk menggunakan pendekatan baru untuk menambahkan tautan pihak ketiga yang diperkenalkan di .NET Core: ketika perpustakaan kelas baru ditambahkan ke solusi, Anda harus membuka file proyek utama dan mengganti isinya dengan yang berikut: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Sdk</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.NET.Sdk"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span>netcoreapp2.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.AspNetCore.App"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.2.6"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Tautan dari perpustakaan yang terhubung akan diunduh secara otomatis.  Informasi lebih lanjut tentang pemetaan antara properti project.json dan CSPROJ dapat ditemukan di dokumentasi resmi di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> dan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><h3>  Langkah 4. Memperbarui namespace </h3><br>  Anda harus menghapus semua penggunaan System.Web dan menggantinya dengan Microsoft.AspNetCore. <br><br><h3>  Langkah 5. Anda harus mengonfigurasi file Startup.cs.  alih-alih menggunakan global.asax </h3><br>  ASP.NET Core memiliki mekanisme baru untuk memuat aplikasi.  Titik masuk ke aplikasi menjadi <code>Startup</code> , dan ketergantungan pada file <i>Global.asax</i> menghilang.  <code>Startup</code> mendaftarkan suite middleware dalam aplikasi.  <code>Startup</code> harus menyertakan metode <code>Configure</code> .  Di <code>Configure</code> tambahkan middleware yang diperlukan ke saluran pipa. <br><br>  <b>Masalah startup.cs</b> <br><br><ol><li>  Mengkonfigurasi middleware untuk permintaan MVC dan WebAPI </li><li>  Pengaturan konfigurasi untuk: </li></ol><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Penanganan pengecualian</a> <br><p>  Karena dalam proses transisi, Anda harus menghadapi berbagai jenis tabrakan, Anda harus segera menyiapkan dan mengatur penanganan pengecualian di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lingkungan</a> Pembangunan.  Menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">UseDeveloperExceptionPage</a> , middleware ditambahkan untuk menangkap pengecualian. </p></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Routing MVC</a> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Registrasi rute baru</a> juga telah diubah.  IRouteBuilder sekarang digunakan sebagai pengganti RouteCollection, cara baru untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mendaftarkan kendala</a> (IActionConstraint) </p></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Filter MVC / WebAPI</a> <br><p>  Diperlukan untuk menulis ulang filter sesuai dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">implementasi baru dari ASP.NET Core</a> . </p></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Formator</a> MVC / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">WebAPI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Binding Model</a> </li></ul><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//add basic MVC feature var mvcBuilder = services.AddMvc(); //add custom model binder provider (to the top of the provider list) mvcBuilder.AddMvcOptions(options =&gt; options.ModelBinderProviders.Insert(0, new NopModelBinderProvider())); /// &lt;summary&gt; /// Represents model binder provider for the creating NopModelBinder /// &lt;/summary&gt; public class NopModelBinderProvider : IModelBinderProvider { /// &lt;summary&gt; /// Creates a nop model binder based on passed context /// &lt;/summary&gt; /// &lt;param name="context"&gt;Model binder provider context&lt;/param&gt; /// &lt;returns&gt;Model binder&lt;/returns&gt; public IModelBinder GetBinder(ModelBinderProviderContext context) { if (context == null) throw new ArgumentNullException(nameof(context)); var modelType = context.Metadata.ModelType; if (!typeof(BaseNopModel).IsAssignableFrom(modelType)) return null; //use NopModelBinder as a ComplexTypeModelBinder for BaseNopModel if (context.Metadata.IsComplexType &amp;&amp; !context.Metadata.IsCollectionType) { //create binders for all model properties var propertyBinders = context.Metadata.Properties .ToDictionary(modelProperty =&gt; modelProperty, modelProperty =&gt; context.CreateBinder(modelProperty)); return new NopModelBinder(propertyBinders, EngineContext.Current.Resolve&lt;ILoggerFactory&gt;()); } //or return null to further search for a suitable binder return null; } }</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Area</a> </li></ul><br><br><pre> <code class="java hljs">app.UseMvc(routes =&gt; { routes.MapRoute(<span class="hljs-string"><span class="hljs-string">"areaRoute"</span></span>, <span class="hljs-string"><span class="hljs-string">"{area:exists}/{controller=Admin}/{action=Index}/{id?}"</span></span>); routes.MapRoute( name: <span class="hljs-string"><span class="hljs-string">"default"</span></span>, template: <span class="hljs-string"><span class="hljs-string">"{controller=Home}/{action=Index}/{id?}"</span></span>); });</code> </pre> <br>  Pada saat yang sama, folder dengan Area nama, di dalam mana folder Admin berada, harus ditempatkan di root aplikasi.  Sekarang, atribut <code>[Area("Admin")] [Route("admin")]</code> akan digunakan untuk menghubungkan controller dengan area ini. <br>  Tetap hanya untuk membuat tampilan untuk semua tindakan yang dijelaskan dalam controller. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3o/eo/rp/3oeorp_vjlbwlisc1kbavvvaeoe.png"></div><br><pre> <code class="java hljs">[Area(<span class="hljs-string"><span class="hljs-string">"Admin"</span></span>)] [Route(<span class="hljs-string"><span class="hljs-string">"admin"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdminController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(); } }</code> </pre> <br>  <b>Validasi</b> <br><br>  Sekarang Anda tidak perlu meneruskan IFormCollection ke pengendali, karena dalam kasus ini validasi server asp.net dinonaktifkan - MVC sedang menekan validasi lebih lanjut jika IFormCollection ditemukan bukan nol.  Solusi untuk masalah ini dapat menambahkan properti ini ke model, ini akan mencegah kita melewati langsung ke metode pengontrol.  Aturan ini hanya valid jika ada model, tetapi jika tidak ada model, maka tidak akan ada validasi. <br><br>  Properti anak tidak lagi divalidasi secara otomatis.  Itu harus ditentukan secara manual. <br><br><h3>  Langkah 6. Mentransfer penangan HTTP dan modul HTTP ke Middleware </h3><br>  Penangan HTTP dan modul HTTP pada dasarnya sangat mirip dengan konsep <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://docs.microsoft.com/ru-ru/aspnet/core/migration/">Middleware di ASP.NET Core</a> , tetapi tidak seperti modul, urutan middleware didasarkan pada urutan di mana mereka dimasukkan ke dalam pipa permintaan.  Urutan modul, sebagian besar, didasarkan pada peristiwa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">siklus hidup aplikasi</a> .  Urutan middleware untuk jawaban adalah kebalikan dari urutan permintaan, dan urutan modul untuk permintaan dan jawaban adalah sama. Berdasarkan ini, Anda dapat melanjutkan dengan peningkatan. <br><br>  Jadi, apa yang masih harus diperbarui: <br><br><ul><li>  Migrasi modul untuk Middleware (AuthenticationMiddleware, CultureMiddleware, dll.) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://docs.microsoft.com/en-us/aspnet/core/migration/">Penangan</a> ke Middleware </li><li>  Menggunakan Middleware Baru </li></ul><br>  Otentikasi dalam proyek kami tidak menggunakan sistem kredensial bawaan, untuk tujuan ini, middleware AuthenticationMiddleware digunakan, dikembangkan sesuai dengan struktur Core ASP.NET baru. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthenticationMiddleware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly RequestDelegate _next; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthenticationMiddleware</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IAuthenticationSchemeProvider schemes, RequestDelegate next)</span></span></span><span class="hljs-function"> </span></span>{ Schemes = schemes ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(nameof(schemes)); _next = next ?? <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(nameof(next)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IAuthenticationSchemeProvider Schemes { get; set; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> async Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpContext context)</span></span></span><span class="hljs-function"> </span></span>{ context.Features.Set&lt;IAuthenticationFeature&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AuthenticationFeature { OriginalPath = context.Request.Path, OriginalPathBase = context.Request.PathBase }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handlers = context.RequestServices.GetRequiredService&lt;IAuthenticationHandlerProvider&gt;(); foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scheme in await Schemes.GetRequestHandlerSchemesAsync()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (await handlers.GetHandlerAsync(context, scheme.Name) is IAuthenticationRequestHandler handler &amp;&amp; await handler.HandleRequestAsync()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ignored } } var defaultAuthenticate = await Schemes.GetDefaultAuthenticateSchemeAsync(); if (defaultAuthenticate != null) { var result = await context.AuthenticateAsync(defaultAuthenticate.Name); if (result?.Principal != null) { context.User = result.Principal; } } await _next(context); } }</span></span></code> </pre> <br>  ASP.NET menyediakan banyak middleware tertanam yang dapat Anda gunakan dalam aplikasi Anda, tetapi perhatikan bahwa pengembang memiliki kemampuan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">untuk membuat middleware sendiri</a> dan menambahkannya ke pipa permintaan HTTP.  Untuk menyederhanakan mekanisme ini, kami menambahkan antarmuka khusus, dan sekarang cukup untuk membuat kelas yang mengimplementasikannya. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INopStartup</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Add and configure any of the middleware /// &lt;/summary&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; /// &lt;param name="configuration"&gt;Configuration of the application&lt;/param&gt; void ConfigureServices(IServiceCollection services, IConfiguration configuration); /// &lt;summary&gt; /// Configure the using of added middleware /// &lt;/summary&gt; /// &lt;param name="application"&gt;Builder for configuring an application's request pipeline&lt;/param&gt; void Configure(IApplicationBuilder application); /// &lt;summary&gt; /// Gets order of this startup configuration implementation /// &lt;/summary&gt; int Order { get; } }</span></span></code> </pre> <br>  Di sini Anda dapat menambah dan mengkonfigurasi middleware Anda: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Represents object for the configuring authentication middleware on application startup /// &lt;/summary&gt; public class AuthenticationStartup : INopStartup { /// &lt;summary&gt; /// Add and configure any of the middleware /// &lt;/summary&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; /// &lt;param name="configuration"&gt;Configuration of the application&lt;/param&gt; public void ConfigureServices(IServiceCollection services, IConfiguration configuration) { //add data protection services.AddNopDataProtection(); //add authentication services.AddNopAuthentication(); } /// &lt;summary&gt; /// Configure the using of added middleware /// &lt;/summary&gt; /// &lt;param name="application"&gt;Builder for configuring an application's request pipeline&lt;/param&gt; public void Configure(IApplicationBuilder application) { //configure authentication application.UseNopAuthentication(); } /// &lt;summary&gt; /// Gets order of this startup configuration implementation /// &lt;/summary&gt; public int Order =&gt; 500; //authentication should be loaded before MVC }</span></span></code> </pre> <br><h3>  Langkah 7. Menggunakan DI Terintegrasi </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ketergantungan</a> injeksi adalah salah satu fitur utama dalam proses desain aplikasi di ASP.NET Core.  Hal ini memungkinkan Anda untuk membuat aplikasi yang digabungkan secara longgar yang lebih dapat diuji, modular dan, akibatnya, dapat dipelihara.  Ini dimungkinkan dengan mengikuti prinsip inversi ketergantungan.  Untuk menginstal dependensi, wadah IoC (Inversion of Control) digunakan.  Dalam ASP.NET Core, wadah seperti itu diwakili oleh antarmuka IServiceProvider.  Layanan diinstal dalam aplikasi dalam metode <code>Startup.ConfigureServices()</code> . <br><br>  Setiap layanan terdaftar dapat dikonfigurasi dengan tiga cakupan: <br><br><ul><li>  sementara </li><li>  tercakup </li><li>  singleton </li></ul><br><pre> <code class="java hljs">services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt; options.UseSqlServer(Configuration.GetConnectionString(<span class="hljs-string"><span class="hljs-string">"DefaultConnection"</span></span>))); services.AddSingleton&lt;Isingleton,MySingleton&gt;();</code> </pre> <br><h3>  Langkah 8. Menggunakan Kerangka Kompatibilitas Proyek WebAPI (Shim) </h3><br>  Untuk menyederhanakan migrasi implementasi API Web yang ada, disarankan untuk menggunakan paket <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Microsoft.AspNetCore.Mvc.WebApiCompatShim</a> NuGet.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Fungsi-fungsi yang kompatibel</a> berikut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini</a> didukung: <br><br><ul><li>  Menambahkan Tipe ApiController </li><li>  Mengaktifkan pengikatan model gaya API web </li><li>  Memperpanjang model mengikat sehingga tindakan pengontrol dapat menerima parameter tipe HttpRequestMessage. </li><li>  Menambahkan pemformat pesan yang memungkinkan tindakan untuk mengembalikan hasil tipe HttpResponseMessage </li></ul><br><pre> <code class="java hljs">services.AddMvc().AddWebApiConventions(); routes.MapWebApiRoute(name: <span class="hljs-string"><span class="hljs-string">"DefaultApi"</span></span>, template: <span class="hljs-string"><span class="hljs-string">"api/{controller}/{id?}"</span></span> );</code> </pre> <br><h3>  Langkah 9. Transfer Konfigurasi Aplikasi </h3><br>  Sebelumnya, beberapa pengaturan disimpan dalam file web.config.  Kami sekarang mengambil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pendekatan baru</a> berdasarkan pasangan kunci-nilai yang dibuat <i>oleh penyedia konfigurasi</i> .  Ini adalah mekanisme yang disarankan dalam ASP.NET Core, dan kami menggunakan file appsettings.json. <br><br>  Anda juga dapat menggunakan <code>System.Configuration.ConfigurationManager</code> paket NuGet jika karena alasan tertentu Anda ingin terus menggunakan * .config.  Dalam hal ini, Anda harus meninggalkan kemampuan untuk menjalankan aplikasi pada platform Unix dan menjalankannya hanya di bawah IIS. <br><br>  Jika Anda ingin menggunakan penyedia konfigurasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Azure Key Vault</a> , Anda harus merujuk ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Migrasi</a> Konten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ke konten Valut Azure Key</a> .  Dalam proyek kami, ini bukan tugas. <br><br><h3>  Langkah 10. Mentransfer konten statis ke wwwroot </h3><br>  Untuk menyajikan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">konten statis,</a> Anda harus memberi tahu host web akar dari isi direktori saat ini.  Standarnya adalah wwwroot.  Anda dapat menyesuaikan direktori Anda untuk menyimpan file statis dengan mengatur middleware. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b7/z1/s7/b7z1s7pkzbd2yrkqukxcfholuus.png"></div><br><br><h3>  Langkah 11. Porting EntityFramework ke EF Core </h3><br>  Jika proyek menggunakan beberapa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">fitur</a> spesifik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari Entity Framework 6</a> yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tidak didukung</a> di <code>EF Core</code> , maka masuk akal untuk menjalankan aplikasi pada <code>NET Framework</code> .  Namun, dalam hal ini, Anda harus mengorbankan multiplatform.  Aplikasi hanya akan berfungsi di Windows dan di bawah IIS. <br><br>  <b>Mari kita lihat perubahan-perubahan utama yang harus diperhitungkan:</b> <br><br><ul><li>  System.Data.Entity namespace digantikan oleh Microsoft.EntityFrameworkCore </li><li>  Tanda tangan konstruktor DbContext telah diubah.  Sekarang Anda perlu menyuntikkan DbContextOptions </li><li>  Metode HasDatabaseGeneratedOption (DatabaseGeneratedOption.None) digantikan oleh ValueGeneratedNever () </li><li>  Metode WillCascadeOnDelete (false) digantikan oleh OnDelete (DeleteBehavior.Restrict) </li><li>  Metode OnModelCreating (DbModelBuilder modelBuilder) digantikan oleh OnModelCreating (ModelBuilder modelBuilder) </li><li>  Metode HasOptional tidak lagi tersedia </li><li>  konfigurasi objek diubah, sekarang Anda perlu menggunakan OnModelCreating, karena  Konfigurasi EntityType tidak lagi tersedia </li><li>  Atribut ComplexType tidak lagi tersedia </li><li>  Penggantian antarmuka IDbSet dengan DbSet </li><li>  ComplexType - dukungan tipe kompleks muncul di EF Core 2 dengan tipe Entitas yang Dimiliki ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://docs.microsoft.com/en-us/ef/core/modeling/</a> owned-entities), dan tabel tanpa Kunci Utama dengan QueryType di EF Core 2.1 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://docs.microsoft.com/en-us/ef/core/modeling/query-types</a> ) </li><li>  kunci asing di EF Core menghasilkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">properti bayangan</a> menggunakan pola ID [Entity], tidak seperti EF6, yang menggunakan pola [Entity] _Id.  Oleh karena itu, pertama-tama tambahkan kunci asing sebagai properti biasa ke entitas. </li><li>  Untuk mendukung DI untuk DbContext, konfigurasikan DbContex Anda di <code>ConfigureServices</code> </li></ul><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Register base object context /// &lt;/summary&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; public static void AddNopObjectContext(this IServiceCollection services) { services.AddDbContextPool&lt;NopObjectContext&gt;(optionsBuilder =&gt; { optionsBuilder.UseSqlServerWithLazyLoading(services); }); } /// &lt;summary&gt; /// SQL Server specific extension method for Microsoft.EntityFrameworkCore.DbContextOptionsBuilder /// &lt;/summary&gt; /// &lt;param name="optionsBuilder"&gt;Database context options builder&lt;/param&gt; /// &lt;param name="services"&gt;Collection of service descriptors&lt;/param&gt; public static void UseSqlServerWithLazyLoading(this DbContextOptionsBuilder optionsBuilder, IServiceCollection services) { var nopConfig = services.BuildServiceProvider().GetRequiredService&lt;NopConfig&gt;(); var dataSettings = DataSettingsManager.LoadSettings(); if (!dataSettings?.IsValid ?? true) return; var dbContextOptionsBuilder = optionsBuilder.UseLazyLoadingProxies(); if (nopConfig.UseRowNumberForPaging) dbContextOptionsBuilder.UseSqlServer(dataSettings.DataConnectionString, option =&gt; option.UseRowNumberForPaging()); else dbContextOptionsBuilder.UseSqlServer(dataSettings.DataConnectionString); }</span></span></code> </pre><br>  Gunakan alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SQL Compare</a> untuk memverifikasi bahwa <code>EF Core</code> menghasilkan skema basis data yang sama dengan <code>Entity Framework</code> selama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">migrasi</a> . <br><br><h3>  Langkah 12. Menghapus semua referensi HttpContext, mengganti kelas yang sudah usang, dan mengubah namespace </h3><br>  Selama migrasi proyek Anda, Anda akan menemukan bahwa sejumlah besar kelas telah diubah namanya atau dipindahkan, dan sekarang Anda perlu menyesuaikan semuanya dengan persyaratan baru.  Berikut adalah daftar transisi utama yang mungkin Anda temui: <br><br><ul><li>  HttpPostedFileBase -&gt; IFormFile </li><li>  Akses untuk mengakses HttpContext sekarang melalui IHttpContextAccessor </li><li>  HtmlHelper -&gt; IHtmlHelper </li><li>  ActionResult -&gt; IActionResult </li><li>  HttpUtility -&gt; WebUtility </li><li>  Alih-alih HttpSessionStateBase - ISession, dapat diakses dari HttpContext.Session.  dari Microsoft.AspNetCore.Http </li><li>  Request.Cookies mengembalikan IRequestCookieCollection: IEnumerable &lt;KeyValuePair &lt;string, string &gt;&gt;, jadi alih-alih HttpCookie, KeyValuePair &lt;string, string&gt; dari Microsoft.AspNetCore.Http </li></ul><br>  Penggantian ruang nama: <br><br><ul><li>  SelectList -&gt; Microsoft.AspNetCore.Mvc.Rendering </li><li>  UrlHelper -&gt; WebUtitlity </li><li>  MimeMapping -&gt; FileExtensionContentTypeProvider </li><li>  MvcHtmlString -&gt; IHtmlString dan HtmlString </li><li>  ModelState, ModelStateDictionary, ModelError -&gt; Microsoft.AspNetCore.Mvc.ModelBinding </li><li>  FormCollection -&gt; IFormCollection </li><li>  Request.Url.Scheme -&gt; this.Url.ActionContext.HttpContext.Request.Scheme </li></ul><br>  Lainnya: <br><br><ul><li>  MvcHtmlString.IsNullOrEmpty (IHtmlString) -&gt; String.IsNullOrEmpty (variabel.ToHtmlString ()) </li><li>  [ValidateInput (false)] - umumnya tidak lebih dan tidak diperlukan </li><li>  HttpUnauthorizedResult -&gt; UnauthorizedResult </li><li>  [AllowHtml] - tidak ada lagi arahan dan itu tidak diperlukan </li><li>  Metode TagBuilder.SetInnerText diganti - sekarang ini adalah InnerHtml.AppendHtml </li><li>  JsonRequestBehavior.AllowDapat ketika mengembalikan Json tidak lagi diperlukan </li><li>  HttpUtility.JavaScriptStringEncode.  -&gt; JavaScriptEncoder.Default.Encode </li><li>  Permintaan.RawUrl.  Hal ini diperlukan untuk menghubungkan secara terpisah Request.Path + Request.QueryString </li><li>  AllowHtmlAttribute - tidak ada lagi kelas </li><li>  XmlDownloadResult - sekarang Anda dapat menggunakan hanya mengembalikan File (Encoding.UTF8.GetBytes (xml), "application / xml", "filename.xml"); </li><li>  [ValidateInput (false)] - tidak ada lagi arahan dan tidak diperlukan </li></ul><br><h3>  Langkah 13. Memperbarui Otentikasi dan Otorisasi </h3><br>  Saya sudah menulis di atas bahwa dalam proyek kami otentikasi tidak diimplementasikan menggunakan sistem identitas bawaan, tetapi dikeluarkan dalam lapisan middleware terpisah.  Namun, ASP.NET Core memiliki mekanisme sendiri untuk memberikan kredensial.  Rincian lebih lanjut dapat ditemukan di dokumentasi di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Adapun perlindungan data - kami tidak lagi menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">MachineKey</a> .  Sebagai gantinya, kami menggunakan fitur perlindungan data bawaan.  Secara default, kunci dibuat saat aplikasi dimulai.  Gudang data dapat: <br><br><ul><li>  Sistem file - keystore berbasis sistem file </li><li>  Azure Storage - kunci perlindungan data di Azure Blob Storage </li><li>  Redis - kunci perlindungan data dalam cache Redis </li><li>  Registri - harus digunakan jika aplikasi tidak memiliki akses ke sistem file </li><li>  EF Core - kunci disimpan dalam basis data </li></ul><br>  Jika mekanisme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bawaan</a> tidak cocok, Anda bisa menentukan mekanisme penyimpanan kunci Anda sendiri dengan menyediakan tempat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">penyimpanan IXml</a> kustom. <br><br><h3>  Langkah 14. Memperbarui JS / CSS </h3><br>  Cara bekerja dengan sumber daya statis telah berubah: sekarang semuanya harus disimpan dalam folder root dari proyek <i>wwwroot</i> , kecuali, tentu saja, pengaturan lain ditentukan. <br><br>  Saat menggunakan blok javascript bawaan, Anda disarankan untuk memindahkannya ke akhir halaman.  Cukup gunakan atribut asp-location = "Footer" untuk tag Anda.  Aturan yang sama berlaku untuk file js. <br><br>  Gunakan ekstensi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">BundlerMinifier</a> sebagai pengganti System.Web.Optimization - ini akan memungkinkan Anda untuk mengikat dan meminimalkan JavaScript dan CSS saat membangun proyek.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tautan</a> ke dokumentasi. <br><br><h3>  Langkah 15. Memigrasi Tampilan </h3><br>  Tindakan Anak tidak lagi digunakan.  Sebaliknya, ASP.NET Core menawarkan alat yang kuat baru - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ViewComponents</a> , yang disebut tidak sinkron. <br><br>  Cara mendapatkan string dari ViewComponent: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Render component to string /// &lt;/summary&gt; /// &lt;param name="componentName"&gt;Component name&lt;/param&gt; /// &lt;param name="arguments"&gt;Arguments&lt;/param&gt; /// &lt;returns&gt;Result&lt;/returns&gt; protected virtual string RenderViewComponentToString(string componentName, object arguments = null) { if (string.IsNullOrEmpty(componentName)) throw new ArgumentNullException(nameof(componentName)); var actionContextAccessor = HttpContext.RequestServices.GetService(typeof(IActionContextAccessor)) as IActionContextAccessor; if (actionContextAccessor == null) throw new Exception("IActionContextAccessor cannot be resolved"); var context = actionContextAccessor.ActionContext; var viewComponentResult = ViewComponent(componentName, arguments); var viewData = ViewData; if (viewData == null) { throw new NotImplementedException(); } var tempData = TempData; if (tempData == null) { throw new NotImplementedException(); } using (var writer = new StringWriter()) { var viewContext = new ViewContext( context, NullView.Instance, viewData, tempData, writer, new HtmlHelperOptions()); // IViewComponentHelper is stateful, we want to make sure to retrieve it every time we need it. var viewComponentHelper = context.HttpContext.RequestServices.GetRequiredService&lt;IViewComponentHelper&gt;(); (viewComponentHelper as IViewContextAware)?.Contextualize(viewContext); var result = viewComponentResult.ViewComponentType == null ? viewComponentHelper.InvokeAsync(viewComponentResult.ViewComponentName, viewComponentResult.Arguments): viewComponentHelper.InvokeAsync(viewComponentResult.ViewComponentType, viewComponentResult.Arguments); result.Result.WriteTo(writer, HtmlEncoder.Default); return writer.ToString(); } }</span></span></code> </pre> <br>  Tidak perlu menggunakan HtmlHelper lagi - ASP.NET Core memiliki banyak fungsi tag pembantu ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tag Helpers</a> ) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bawaan</a> .  Ketika aplikasi sedang berjalan, mereka diproses oleh mesin Razor di sisi server dan akhirnya dikonversi ke elemen html standar.  Ini sangat menyederhanakan pengembangan aplikasi.  Dan, tentu saja, Anda dapat menerapkan tag-help Anda sendiri. <br><br>  Kami mulai menggunakan injeksi dependensi dalam tampilan alih-alih mengizinkan pengaturan dan layanan menggunakan <code>EngineContext</code> . <br><br>  Jadi, poin utama tentang migrasi tampilan: <br><br><ul><li>  Konversi <code>Views/web.config  Views/_ViewImports.cshtml</code> - digunakan untuk mengimpor ruang nama dan <code>Views/web.config  Views/_ViewImports.cshtml</code> dependensi.  File ini tidak mendukung fungsi <code>Razor</code> lainnya, seperti definisi fungsi dan bagian. </li><li>  Konversikan <code>namespaces.add</code> ke <code>@using</code> </li><li>  Transfer pengaturan apa pun ke konfigurasi aplikasi utama </li><li>  <code>Scripts.Render</code> dan <code>Styles.Render</code> tidak ada.  Ganti <code>libman</code> atau <code>BundlerMinifier</code> tautan ke keluaran </li></ul><br><h2>  Kesimpulannya </h2><br>  Kami telah melihat dari pengalaman kami bahwa proses migrasi aplikasi web besar adalah tugas yang sangat memakan waktu yang hampir tidak dapat dilakukan tanpa jebakan.  Kami berencana untuk beralih ke kerangka kerja baru segera setelah versi stabil pertama dirilis, tetapi kami tidak dapat menyelesaikannya segera: ada beberapa fungsi penting yang pada saat itu belum ditransfer ke .NET Core, khususnya, terkait dengan EntityFramework.  Oleh karena itu, kami harus terlebih dahulu merilis rilis berikutnya menggunakan pendekatan campuran - arsitektur .NET Core dengan dependensi .NET Framework. <br><br>  Kami dapat sepenuhnya menyesuaikan proyek setelah rilis. NET Core 2.1, pada saat itu solusi stabil sudah bekerja pada arsitektur baru - yang tersisa hanyalah mengganti beberapa paket dan menulis ulang pekerjaan dengan EF Core.  Dengan demikian, migrasi lengkap ke kerangka kerja baru membutuhkan beberapa bulan kerja. <br><br>  Anda dapat mempelajari lebih lanjut tentang proyek kami dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori</a> kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id472738/">https://habr.com/ru/post/id472738/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id472720/index.html">ERP tidak berfungsi ... Apa alternatifnya? atau tepat waktu. Untuk Rusia?</a></li>
<li><a href="../id472724/index.html">Pengantar skydive.network</a></li>
<li><a href="../id472726/index.html">Peningkatan imunitas noise Arduino</a></li>
<li><a href="../id472730/index.html">Ivanovo! Mitap untuk menghormati peringatan 10 tahun Node.js</a></li>
<li><a href="../id472736/index.html">Buka webinar "Pengantar untuk menguji otomatisasi aplikasi seluler di Selenium dan Appium"</a></li>
<li><a href="../id472744/index.html">MRP tidak berfungsi ... Apa alternatifnya?</a></li>
<li><a href="../id472746/index.html">Server terminal untuk admin; Tidak ada celah SSH tunggal</a></li>
<li><a href="../id472748/index.html">Browser semantik atau kehidupan tanpa situs</a></li>
<li><a href="../id472750/index.html">OK, apakah saya benar-benar membutuhkan Kubernet?</a></li>
<li><a href="../id472752/index.html">CSE: Kubernetes untuk siapa pun di vCloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>