<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>„Ä∞Ô∏è ü§¶üèª üí† Bot untuk memonitor layanan web dalam setengah jam: telegram + bash + cron üë° ‚ñ∂Ô∏è üßôüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Terkadang Anda perlu segera melakukan pemantauan untuk layanan baru, tetapi tidak ada infrastruktur / keahlian yang siap pakai. Dalam panduan ini, dal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bot untuk memonitor layanan web dalam setengah jam: telegram + bash + cron</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483318/"><img src="https://habrastorage.org/webt/ks/-r/l9/ks-rl9jvsn3vka3r5kxkj4jvbxg.jpeg"><br><br>  Terkadang Anda perlu segera melakukan pemantauan untuk layanan baru, tetapi tidak ada infrastruktur / keahlian yang siap pakai.  Dalam panduan ini, dalam setengah jam kami akan mengimplementasikan alat untuk memonitor semua layanan web hanya menggunakan alat-alat ubuntu bawaan: bash, cron dan curl.  Kami akan menggunakan telegram untuk mengirimkan peringatan. <br><br>  "Cherry on the cake" akan menjadi keterlibatan emosional pengguna.  Itu diperiksa pada orang - itu berfungsi. <br><a name="habracut"></a><br>  Ketika kami membuat chatbot di layanan Doctor Near telemedicine untuk menentukan tingkat stres pengguna, kami perlu pemantauan.  Dalam beberapa jam, sebuah proyek mini dibuat, yang tidak hanya berfungsi dengan baik, tetapi juga menambahkan umpan balik positif. <br><br>  Untuk memulai, dapatkan repositori dengan skrip: <br><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/rshekhovtsov/msms.git</code> </pre> <br>  Buka folder msms dan kemudian bekerja di dalamnya. <br><br>  Jika telegram diblokir, gunakan proxy.  Opsi termudah dan paling dapat diandalkan adalah torsocks: <br><br><pre> <code class="bash hljs">sudo apt install tor sudo apt install torsocks</code> </pre> <br>  Sebagai contoh, kami akan mengonfigurasi pemantauan halaman awal google.com dalam tiga langkah. <br><br><h2>  LANGKAH 1. Buat bot di telegram dan dapatkan id pengguna </h2><br><ul><li>  Dalam string pencarian kontak di telegram, cari <a href="https://t.me/botfather" rel="nofollow">@botfather</a> : <br><br><img src="https://habrastorage.org/webt/mf/8r/tx/mf8rtxrovcs-4r8ax2pn7fuxusc.png"><br></li><li>  Kami memulainya dengan tombol Mulai, masukkan perintah / newbot dan jawab pertanyaan.  Anda harus ingat bahwa nama adalah nama bot yang akan ditampilkan kepada pengguna, dan nama pengguna adalah unik dan harus diakhiri dengan "bot": <br><br><img src="https://habrastorage.org/webt/gc/q5/fx/gcq5fxjht5xytwso83degwhmslm.png"><br><br>  Di antara hal-hal lain, bot akan mengeluarkan token rahasia untuk API HTTP, yang perlu Anda salin dan simpan ke file telegram-api-key.txt di folder msms. <br></li><li>  Kami mengetikkan nama bot kami di baris telegram pencarian, dan menjalankannya. <br></li><li>  Sebagai sentuhan akhir, tambahkan diri kita ke daftar penerima peringatan pemantauan: <br><br><pre> <code class="bash hljs">sudo chmod +x ./recipients-setup.sh torsocks ./recipients-setup.sh</code> </pre> <br>  Script akan menampilkan daftar panggilan terakhir ke bot, harus ada satu baris dengan id dan nama kita di telegram.  Kami mengambil id ini dan menyimpannya di file services / google-penerima.txt.  Format file: setiap baris adalah satu id.  Contoh: <br><br><pre> <code class="bash hljs">123456789 987654321</code> </pre> </li></ul><br>  Untuk menambahkan penerima baru, Anda perlu memintanya untuk memulai bot di telegram, jalankan penerima-setup.sh dan tambahkan id ke file. <br><br><h2>  LANGKAH 2. Konfigurasi Pemantauan </h2><br>  Deskripsi layanan terjadi dengan membuat file-in di folder layanan.  Lima parameter perlu diatur: <br><br><ol><li>  <b>MSMS_SERVICE_NAME</b> : nama layanan - akan digunakan dalam lansiran dan pemantauan <b>log</b> . </li><li>  <b>MSMS_SERVICE_ENDPOINT</b> : titik akhir dari layanan yang akan kami hubungi dengan curl. </li><li>  <b>MSMS_CURL_PARAMS</b> : parameter ikal tambahan, lihat contoh di bawah ini. </li><li>  <b>MSMS_EXPECTED</b> : respons layanan yang diharapkan.  Digunakan jika jawabannya singkat. </li><li>  <b>MSMS_EXPECTED_FILE</b> : nama file dengan respons layanan yang diharapkan.  Jika ditentukan, timpa MSMS_EXPECTED. </li><li>  <b>MSMS_RECIPIENTS</b> : file dengan daftar penerima notifikasi. </li></ol><br>  Permintaan di google.com mengembalikan html tetap dengan redirect, kami akan menggunakannya sebagai respons server yang diharapkan: <br><br><pre> <code class="bash hljs">curl google.com &gt; services/google-response.html</code> </pre> <br>  Buat file layanan / google.ini: <br><br><pre> <code class="bash hljs">MSMS_SERVICE_NAME=<span class="hljs-string"><span class="hljs-string">'google front page'</span></span> <span class="hljs-comment"><span class="hljs-comment"># service endpoint MSMS_SERVICE_ENDPOINT='google.com' # curl parameters MSMS_CURL_PARAMS='-s --connect-timeout 3 -m 7' # expected service response MSMS_EXPECTED_FILE='google-response.html' # recipients list file MSMS_RECIPIENTS='google-recipients.txt'</span></span></code> </pre> <br>  Di <code>MSMS_CURL_PARAMS</code> Anda dapat menentukan semua yang dapat dilakukan curl, termasuk: <br><br><ol><li>  Nonaktifkan pesan keriting agar tidak menyumbat konsol dan masuk: <code>-s</code> </li><li>  Atur batas waktu koneksi dengan layanan yang sedang diperiksa (dalam detik): <code>--connect-timeout 3</code> </li><li>  Tetapkan batas waktu respons: <code>-m 7</code> </li><li>  Nonaktifkan verifikasi sertifikat untuk SSL (misalnya, jika sertifikat yang ditandatangani sendiri digunakan): <code>--insecure</code> </li><li>  Tentukan jenis permintaan http: <code>-X POST</code> </li><li>  Tentukan tajuk: <code>-H "Content-Type: application/json"</code> </li><li>  Tentukan badan permintaan sebagai string atau file.  Contoh untuk file: <code>-d @request.json</code> </li></ol><br>  Kami mematikan notifikasi dan menetapkan batas waktu 3 detik.  pada koneksi dan 7 detik.  untuk menerima tanggapan dari layanan. <br><br>  <b>Perhatian</b> : tentukan nilai parameter dalam tanda kutip tunggal, seperti pada contoh.  Sayangnya, bash dalam pengertian ini cukup rapuh, dan seekor <s>kupu</s> - <s>kupu yang tidak sengaja terbang di tempat yang</s> salah, sebuah kutipan, dapat menyebabkan <s>kematian alam semesta dengan</s> kesalahan yang sulit didiagnosis. <br><br>  Kami mengatur pemantauan.  Periksa apakah semuanya OK: <br><br><pre> <code class="bash hljs">sudo chmod +x ./monitoring.sh torsocks ./monitoring.sh</code> </pre> <br>  Script harus menampilkan pesan berupa: <br><br><pre> <code class="bash hljs">2020-01-10 12:14:31 health-check <span class="hljs-string"><span class="hljs-string">"google front page"</span></span>: OK</code> </pre> <br><h2>  LANGKAH 3. Sesuaikan jadwal </h2><br>  Atur jadwal pemantauan di cron: <br><br><pre> <code class="bash hljs">sudo crontab -e</code> </pre> <br>  Tambahkan baris untuk memeriksa google.com setiap menit: <br><br><pre> <code class="bash hljs">*/1 * * * * torsocks &lt;   &gt;/monitoring.sh &gt;&gt; &lt;   &gt;/monitoring.log 2&gt;&amp;1</code> </pre> <br>  Tambahkan peringatan setiap hari pukul 11.00, yang mengkonfirmasi pemantauan itu sendiri.  Untuk melakukan ini, kirimkan parameter SETIAP HARI ke skrip: <br><br><pre> <code class="bash hljs">0 11 * * * torsocks &lt;   &gt;/monitoring.sh DAILY &gt;&gt; &lt;   &gt;/monitoring.log 2&gt;&amp;1</code> </pre><br>  <code>2&gt;&amp;1</code> - teknik standar mengarahkan kesalahan ke aliran output utama.  Sebagai hasilnya, mereka juga akan dimasukkan dalam log pemantauan. <br><br>  Simpan perubahan dan tangkap dengan perintah: <br><br><pre> <code class="bash hljs"> sudo service cron reload</code> </pre> <br>  Anda dapat membaca lebih lanjut tentang mengkonfigurasi cron, misalnya, di <a href="https://losst.ru/nastrojka-cron" rel="nofollow">sini</a> . <br><br>  Jadi, setiap menit skrip pemantauan akan diluncurkan, yang akan diakses melalui gol di google.com.  Jika jawaban yang diterima berbeda dari yang diharapkan, skrip akan mengirim pemberitahuan di telegram ke daftar penerima.  Log audit disimpan dalam file monitoring.log <br><br>  Jika Anda perlu menambahkan layanan lain, kami cukup membuat file-in baru untuknya di folder layanan dan, jika perlu, buat daftar penerima yang terpisah.  Segala sesuatu yang lain akan bekerja secara otomatis. <br><br>  Jika layanan yang dicentang tidak tersedia, peringatan akan dikirim setiap menit.  Jika Anda tidak dapat mengembalikan layanan dengan cepat, Anda dapat menonaktifkan sementara pemberitahuan di properti bot di telegram. <br><br>  Sekarang mari kita melihat lebih dekat fitur tambahan dan implementasi skrip. <br><br><h2>  Template Pesan dan Keterlibatan Emosional </h2><br>  Untuk membuat komunikasi dengan bot lebih hidup, kami menyebutnya Manechka, menambahkan avatar gambar yang sesuai dan melibatkan spesialis PR profesional untuk membuat teks pesan.  Anda dapat menggunakan prestasi kami atau mengubah selera Anda. <br><br>  Misalnya, seperti ini: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zs/kk/nd/zskkndbpynjm9l-o2ujyvblznlw.jpeg"></div><br>  atau bahkan lebih: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ul/nh/e3/ulnhe3lg9gypwy56x53sk-kuegm.png"></div><br>  Kenapa tidak <br><br>  Nama bot dan avatar ditetapkan melalui <a href="https://t.me/botfather" rel="nofollow">@botfather</a> . <br>  Templat pesan terletak di folder <b>templat</b> : <br><br><ul><li>  <b>curl-fail.txt</b> : pesan terkirim saat curl mengembalikan kode kesalahan bukan nol.  Biasanya berbicara tentang ketidakmungkinan menjangkau layanan. </li><li>  <b>daily.txt</b> : pesan harian yang mengonfirmasi bahwa pemantauan layanan berfungsi. </li><li>  <b>service-fail.txt</b> : pesan yang dikirim ketika respons layanan berbeda dari yang diharapkan. </li></ul><br>  Mari kita periksa kemungkinan penyesuaian menggunakan contoh templat pesan bawaan. <br>  Template menggunakan emoji.  Sayangnya, habr tidak menampilkannya. <br>  Untuk memilih emoji, lebih mudah menggunakan pencarian di <a href="https://emojipedia.org/" rel="nofollow">emojipedia.org</a> : <br><br><img src="https://habrastorage.org/webt/wj/uy/_3/wjuy_3icssro1d0hpptoe5xq91e.jpeg"><br><br>  Anda cukup menyalin dan menempelkan karakter yang sesuai ke dalam teks template (ini adalah unicode biasa). <br><ol><li>  curl-fail.txt: <br><br><pre> <code class="bash hljs">,  ...      \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" \`CURL EXIT CODE: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$EXIT_CODE</span></span></span><span class="hljs-string">\`</span></span></code> </pre> <br>  Kami menggunakan nama layanan yang kami tentukan (variabel <code>MSMS_SERVICE_NAME</code> ) dan variabel skrip internal dengan kode pengakhiran ikal ( <code>EXIT_CODE</code> ).  Kami juga memformat pesan menggunakan markup <a href="https://core.telegram.org/bots/api" rel="nofollow">telegram markdown</a> : karakter frame teks `` '' dengan lebar tetap.  Karena tanda kutip dan apostrof adalah karakter bash resmi, kami menghindarinya dengan karakter "\".  Nama variabel diawali dengan tanda "$". <br><br>  Hasil: <br><br><img src="https://habrastorage.org/webt/po/zf/3n/pozf3neoa1bjqxslwqny1ocal2s.jpeg"><br></li><li>  service-fail.txt: <br><br><pre> <code class="bash hljs">,  ...  \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\"     ,     : \`</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$RESPONSE</span></span></span><span class="hljs-string">\`</span></span></code> </pre> <br>  Hasil: <br><br><img src="https://habrastorage.org/webt/kv/f1/tl/kvf1tlzbrmm3cqdpf70tnm0m2z4.jpeg"><br><br>  Di sini kita menggunakan variabel skrip lain: <code>RESPONSE</code> .  Ini berisi respons dari layanan. <br></li><li>  daily.txt: <br><br><pre> <code class="bash hljs">, !    , c  : \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\"  ...     ?</span></span></code> </pre><br>  Hasil: <br><br><img src="https://habrastorage.org/webt/qs/ox/r_/qsoxr_bkdi8qva9ms1xzwpxugxa.jpeg"><br></li></ol><br>  Mari kita beralih ke implementasi skrip. <br><br><h2>  Skrip pemantauan </h2><br>  <b>monitoring.sh</b> membuat penemuan otomatis sederhana - mengambil semua file ini dari folder layanan dan untuk masing-masing mengeksekusi skrip utama dengan logika untuk memeriksa dan mengirim peringatan: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cd $(dirname "$0")/services for service_ini in $(ls *.ini); do bash ../msms.sh "$1" "$service_ini" done</span></span></code> </pre> <br>  Untuk menghasilkan pesan harian tentang status pemantauan, skrip dapat melewati parameter SETIAP HARI. <br><br>  Harap dicatat bahwa ketika skrip dimulai, folder saat ini berubah ke layanan.  Ini memungkinkan file ini untuk menentukan jalur file relatif ke layanan. <br><br><h2>  Skrip untuk memeriksa dan mengirim peringatan </h2><br>  <b>msms.sh</b> berisi logika dasar untuk memeriksa layanan dan mengirimkan peringatan. <br><br>  Bekerja dengan telegram: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># telegram endpoint TG_API_URL="https://api.telegram.org/bot$(cat ../telegram-api-key.txt)/sendMessage" ################################################################# # send message to telegram # parameter: message text ################################################################# function send_message { for chat_id in $(cat ../$MSMS_RECIPIENTS); do curl -s -X POST --connect-timeout 10 $TG_API_URL -d chat_id=$chat_id -d parse_mode="Markdown" -d text="$1" echo done }</span></span></code> </pre><br>  Kami membuat URL untuk mengakses API REST telegram menggunakan kunci pribadi yang tersimpan dalam file. <br><br>  Fungsi send_message menggunakan curl untuk mengirim pesan ke REST API ini, mengambil id penerima dari file yang kami tentukan di ini.  Dalam data yang kami kirim, kami mengindikasikan bahwa kami menggunakan markup pesan: <code>parse_mode="Markdown"</code> . <br><br>  Cetak tanggal-waktu saat ini dan muat file-in ini. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> $(date <span class="hljs-string"><span class="hljs-string">'+%Y-%m-%d %H:%M:%S'</span></span>) <span class="hljs-comment"><span class="hljs-comment"># load variables from .ini file: . $2</span></span></code> </pre><br>  Garis ajaib <code>. $2</code>  <code>. $2</code> mengeksekusi file-in ini sebagai parameter kedua sebagai skrip biasa, memasukkan nilai yang ditentukan di dalamnya ke dalam variabel lingkungan. <br><br>  Unduh respons yang diharapkan dari file jika parameter <code>MSMS_EXPECTED_FILE</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -n <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_EXPECTED_FILE</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> MSMS_EXPECTED=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(cat "$MSMS_EXPECTED_FILE")</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br>  Lakukan pemeriksaan layanan dengan mengirimkan peringatan, jika perlu: <br><br><pre> <code class="bash hljs">RESPONSE=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval curl $MSMS_CURL_PARAMS \"$MSMS_SERVICE_ENDPOINT\")</span></span></span><span class="hljs-string">"</span></span> EXIT_CODE=$? <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$EXIT_CODE</span></span> != 0 ]]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> health-check \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" FAILED: CURL EXIT WITH </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$EXIT_CODE</span></span></span><span class="hljs-string"> MESSAGE="</span></span>$(cat ../templates/curl-fail.txt)<span class="hljs-string"><span class="hljs-string">" MESSAGE=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval echo $MESSAGE)</span></span></span><span class="hljs-string"> send_message "</span></span><span class="hljs-variable"><span class="hljs-variable">$MESSAGE</span></span><span class="hljs-string"><span class="hljs-string">" elif [[ "</span></span><span class="hljs-variable"><span class="hljs-variable">$RESPONSE</span></span><span class="hljs-string"><span class="hljs-string">" != "</span></span><span class="hljs-variable"><span class="hljs-variable">$MSMS_EXPECTED</span></span><span class="hljs-string"><span class="hljs-string">" ]]; then echo health-check \"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" FAILED: "</span></span><span class="hljs-variable"><span class="hljs-variable">$RESPONSE</span></span><span class="hljs-string"><span class="hljs-string">" MESSAGE="</span></span>$(cat ../templates/service-fail.txt)<span class="hljs-string"><span class="hljs-string">" MESSAGE=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval echo $MESSAGE)</span></span></span><span class="hljs-string"> send_message "</span></span><span class="hljs-variable"><span class="hljs-variable">$MESSAGE</span></span><span class="hljs-string"><span class="hljs-string">" else echo health-check \"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\": OK fi</span></span></code> </pre><br>  Pertama-tama kita menetapkan variabel <code>RESPONSE</code> ke hasil perintah curl untuk layanan ini. <br><br>  Ekspresi <code>EXIT_CODE=$?</code>  menempatkan hasil dari perintah terakhir, mis.  ikal  Jika Anda perlu mengirim peringatan, templat dibaca dari file yang sesuai dan pengiriman surat kepada penerima <code>send_message</code> menggunakan <code>send_message</code> . <br><br>  Blok terakhir memproses parameter SETIAP HARI: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"DAILY"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> health-check \<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$MSMS_SERVICE_NAME</span></span></span><span class="hljs-string">\" DAILY MESSAGE="</span></span>$(cat ../templates/daily.txt)<span class="hljs-string"><span class="hljs-string">" MESSAGE=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(eval echo $MESSAGE)</span></span></span><span class="hljs-string"> send_message "</span></span><span class="hljs-variable"><span class="hljs-variable">$MESSAGE</span></span><span class="hljs-string"><span class="hljs-string">" fi</span></span></code> </pre> <br>  Ia mengirim pesan yang mengkonfirmasi kesehatan pemantauan itu sendiri. <br><br><h2>  Mendapatkan daftar id pengguna </h2><br>  <b>penerima-setup.sh</b> memanggil API telegram untuk mendapatkan pesan terbaru yang ditujukan ke bot: <br><br><pre> <code class="bash hljs">curl -s https://api.telegram.org/bot$(cat telegram-api-key.txt)/getUpdates \ | python recipients-setup.py</code> </pre> <br>  Menggunakan sihir python untuk membuat daftar output dengan baik.  Ini opsional, Anda cukup mengambil id yang diinginkan dari json, yang akan ditampilkan perintah: <br><br><pre> <code class="bash hljs">torsocks curl -s https://api.telegram.org/bot$(cat telegram-api-key.txt)/getUpdates</code> </pre> <br><h2>  Kesimpulan </h2><br>  Dengan demikian, Anda dapat menggunakan skrip yang sudah jadi dan templat pesan, hanya menyiapkan layanan dan daftar yang dapat diamati untuk pemberitahuan;  Anda dapat membuat "identitas" baru untuk bot;  dan Anda dapat membuat keputusan berdasarkan proposal yang diajukan. <br><br>  Sebagai opsi untuk pengembangan lebih lanjut, konfigurasi dan manajemen pemantauan di bot itu sendiri menunjukkan dirinya, tetapi di sini Anda tidak dapat melakukannya tanpa python.  Jika seseorang memegang tangan saya sebelum saya - Anda tahu di mana harus mengunggah permintaan tarik :-) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id483318/">https://habr.com/ru/post/id483318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id483308/index.html">Eksperimen VonmoTrade. Bagian 4: Grafik Perdagangan</a></li>
<li><a href="../id483310/index.html">Buat lensa untuk Snapchat menggunakan pix2pix</a></li>
<li><a href="../id483312/index.html">Teori Kepingan Salju Besar</a></li>
<li><a href="../id483314/index.html">Cara melakukan tindakan Redux asinkron menggunakan Redux-Thunk</a></li>
<li><a href="../id483316/index.html">Pengantar cepat ke SwiftUI</a></li>
<li><a href="../id483320/index.html">Pembuatan museum VR abad pertengahan</a></li>
<li><a href="../id483322/index.html">REST API development - apa pendekatan Code First?</a></li>
<li><a href="../id483324/index.html">Proses yang fleksibel dalam tim TI</a></li>
<li><a href="../id483328/index.html">REST API - Apa itu HATEOAS?</a></li>
<li><a href="../id483330/index.html">Tentang pengoperasian PC menggunakan contoh Windows 10 dan keyboard, bagian 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>