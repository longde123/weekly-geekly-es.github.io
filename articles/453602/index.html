<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìπ üõÄüèΩ üéå ¬øLas bases de datos viven en Kubernetes? üìû üßëüèæ‚Äçü§ù‚Äçüßëüèº üë©üèº‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De alguna manera, sucedi√≥ hist√≥ricamente que la industria de TI, por cualquier motivo, se divide en dos campos condicionales: a favor y en contra. Ade...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øLas bases de datos viven en Kubernetes?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/453602/"><img src="https://habrastorage.org/webt/iq/xw/bx/iqxwbxcjzz4tipitwhcc-_mqe5q.jpeg"><br><br>  De alguna manera, sucedi√≥ hist√≥ricamente que la industria de TI, por cualquier motivo, se divide en dos campos condicionales: a favor y en contra.  Adem√°s, el tema de controversia puede ser absolutamente arbitrario.  ¬øQu√© sistema operativo es mejor: Win o Linux?  ¬øEn un tel√©fono inteligente Android o iOS?  ¬øMantener todo en las nubes o cargarlo en un almacenamiento RAID fr√≠o y poner tornillos en una caja fuerte?  ¬øLos schnicks de PHP tienen derecho a ser llamados programadores?  Estas disputas son, a veces, exclusivamente de naturaleza existencial y no tienen otra base adem√°s del inter√©s deportivo. <br><br>  Dio la casualidad de que con el advenimiento de los contenedores y toda esta amada cocina con estibador y k8 condicional, las disputas a favor y en contra comenzaron a usar nuevas oportunidades en varias √°reas del backend.  (Haremos una reserva por adelantado que, aunque la mayor√≠a de las veces Kubernetes ser√° indicado como un orquestador en esta discusi√≥n, la elecci√≥n de este instrumento no importa. En cambio, puede sustituirlo por otro que le parezca m√°s conveniente y familiar). <br><br>  Y, al parecer, ser√≠a un simple argumento sobre las dos caras de la misma moneda.  Tan insensato y despiadado como la eterna confrontaci√≥n Win vs Linux, en la que las personas adecuadas existen para s√≠ mismas en alg√∫n punto intermedio.  Eso es solo en el caso de la contenedorizaci√≥n no es tan simple.  Por lo general, en tales disputas no hay un lado correcto, pero en el caso de los contenedores "aplicar" o "no aplicar" para almacenar la base de datos, todo se pone patas arriba.  Porque, en cierto sentido, tanto los partidarios como los oponentes de este enfoque tienen raz√≥n. <br><a name="habracut"></a><br><h4>  Lado bueno </h4><br>  Puede describir brevemente los argumentos del lado bueno con una frase: "¬°Hola, 2k19 fuera de la ventana!"  Suena a populismo, por supuesto, pero si profundizas en la situaci√≥n en detalle, tiene sus ventajas.  Los analizaremos ahora. <br><br>  Supongamos que tiene un gran proyecto web.  Inicialmente podr√≠a construirse sobre la base de un enfoque de microservicio, o en alg√∫n momento lleg√≥ a √©l de una manera evolutiva; de hecho, esto no es muy importante.  Dispers√≥ nuestro proyecto en microservicios separados, configur√≥ la orquestaci√≥n, el equilibrio de carga, el escalado.  Y ahora, con la conciencia tranquila, beba mojito en una hamaca durante un efecto habr, en lugar de levantar los servidores ca√≠dos.  Pero todas las acciones deben ser consistentes.  Muy a menudo solo la aplicaci√≥n en s√≠ est√° en contenedores: el c√≥digo.  ¬øQu√© m√°s tenemos adem√°s del c√≥digo? <br><br>  Correcto, datos.  El coraz√≥n de cualquier proyecto son sus datos: puede ser un DBMS t√≠pico: MySQL, Postgre, MongoDB o almacenamiento utilizado para la b√∫squeda (ElasticSearch), almacenamiento de valor clave para el almacenamiento en cach√©, por ejemplo, redis, etc. Ahora no lo hacemos. hablaremos sobre las opciones de implementaci√≥n de backend torcidas cuando la base de datos se bloquee debido a consultas mal escritas, y en su lugar hablaremos sobre proporcionar tolerancia a fallas para esta misma base de datos bajo la carga del cliente.  De hecho, cuando incluimos nuestra aplicaci√≥n en contenedores y le permitimos escalar libremente para manejar cualquier cantidad de solicitudes entrantes, esto naturalmente aumenta la carga en la base de datos. <br><br>  De hecho, el canal para acceder a la base de datos y al servidor en el que gira se convierte en el ojo de la aguja en nuestro hermoso backend contenedorizado.  Al mismo tiempo, el motivo principal para la virtualizaci√≥n de contenedores es la movilidad y la plasticidad de la estructura, lo que permite organizar la distribuci√≥n de la carga m√°xima en toda la infraestructura disponible de la manera m√°s eficiente posible.  Es decir, si no colocamos en contenedores y enrollamos todos los elementos disponibles del sistema en un cl√∫ster, cometemos un error muy grave. <br><br>  Es mucho m√°s l√≥gico agrupar no solo la aplicaci√≥n en s√≠, sino tambi√©n los servicios responsables del almacenamiento de datos.  Al agrupar e implementar de forma independiente trabajando y distribuyendo la carga de servidores web en k8s, ya resolvemos el problema de la sincronizaci√≥n de datos: los mismos comentarios para las publicaciones, si tomas alg√∫n tipo de plataforma de medios o blog como ejemplo.  En cualquier caso, comenzamos una representaci√≥n intracluster, incluso virtual, de la base de datos como un ExternalService.  La pregunta es que la base de datos en s√≠ a√∫n no se ha agrupado: los servidores web implementados en el cubo toman informaci√≥n sobre los cambios de nuestra base de combate est√°tica, que gira por separado. <br><br>  Siente la trampa?  Utilizamos k8s o Swarm para distribuir la carga y evitar la ca√≠da del servidor web principal, pero no hacemos esto para la base de datos.  Pero, despu√©s de todo, si la base de datos se bloquea, entonces, en toda nuestra infraestructura agrupada, no tiene sentido: ¬øde qu√© sirven las p√°ginas web vac√≠as que devuelven un error de acceso a la base de datos? <br><br>  Es por eso que no solo los servidores web deben agruparse, como se hace generalmente, sino tambi√©n la infraestructura de la base de datos.  Solo de esta manera podemos asegurarnos de que los elementos de la misma estructura que son completamente operativos en un equipo, pero al mismo tiempo, sean independientes entre s√≠.  Al mismo tiempo, incluso si la mitad de nuestro backend bajo carga "colapsa", el resto sobrevivir√°, y el sistema de sincronizaci√≥n de la base de datos entre s√≠ dentro del cl√∫ster y la posibilidad de escalado infinito y la implementaci√≥n de nuevos cl√∫steres ayudar√°n a alcanzar r√°pidamente las capacidades requeridas: habr√≠a bastidores en el centro de datos . <br><br>  Adem√°s, el modelo de base de datos distribuido en grupos le permite llevar esta misma base de datos a donde se necesita;  si estamos hablando de un servicio global, es bastante il√≥gico torcer un cl√∫ster web en alg√∫n lugar del √°rea de San Francisco y al mismo tiempo conducir paquetes al acceder a la base de datos en la Regi√≥n de Mosc√∫ y viceversa. <br><br>  Adem√°s, la contenedorizaci√≥n de la base de datos le permite construir todos los elementos del sistema al mismo nivel de abstracci√≥n.  Lo que, a su vez, permite administrar este sistema directamente desde el c√≥digo, por parte de los desarrolladores, sin la participaci√≥n activa de los administradores.  Los desarrolladores pensaron que necesitaban un DBMS separado para un nuevo subproyecto, ¬°f√°cil!  escribi√≥ un archivo yaml, lo carg√≥ en el cl√∫ster y ya est√°. <br><br>  Bueno, por supuesto, la operaci√≥n interna se simplifica enormemente.  Dime, ¬øcu√°ntas veces has entrecerrado los ojos en los momentos en que un nuevo miembro del equipo meti√≥ las manos en la base de datos de combate para trabajar?  ¬øCu√°l, de hecho, est√° girando en este momento?  Por supuesto, todos somos adultos aqu√≠, y en alg√∫n lugar tenemos una copia de seguridad nueva, y a√∫n m√°s, detr√°s de un estante con pepinos de la abuela y esqu√≠s viejos, otra copia de seguridad, posiblemente incluso en una c√°mara frigor√≠fica, porque una vez que su oficina se incendi√≥.  Pero a√∫n as√≠, cada presentaci√≥n de un nuevo miembro del equipo con acceso a la infraestructura de combate y, por supuesto, a la base de datos de combate es un balde de validol para todos los que lo rodean.  Bueno, ¬øqui√©n, un novato, sabe, tal vez est√° entrecerrando los ojos?  Miedo, de acuerdo. <br><br>  La contenedorizaci√≥n y, de hecho, la topolog√≠a de base de datos f√≠sica distribuida de su proyecto ayuda a evitar esos momentos v√°lidos.  ¬øNo conf√≠as en el novato?  Esta bien  Levantaremos nuestro propio cl√∫ster para √©l y lo desconectaremos del resto de los cl√∫steres de la base de datos: sincronizaci√≥n solo mediante inserci√≥n manual y rotaci√≥n simult√°nea de dos teclas (un l√≠der del equipo, el segundo administrador).  Y todos est√°n felices. <br><br>  Y ahora es el momento de cambiar de zapatos en los oponentes de la contenedorizaci√≥n de bases de datos. <br><br><h4>  Lado oscuro </h4><br>  Argumentando por qu√© no es necesario contener la base de datos y continuar rot√°ndola en un servidor central, no nos rebajaremos a la ret√≥rica de la ortodoxia y las declaraciones como "abuelos convirtieron la base de datos en hardware, ¬°y lo haremos!"  En cambio, tratemos de llegar a una situaci√≥n en la que la contenedorizaci√≥n realmente traiga dividendos tangibles. <br><br>  Debe admitir que los proyectos que realmente necesitan una base en el contenedor se pueden contar con los dedos de una mano como el mejor operador de fresadora.  En su mayor parte, incluso el uso mismo de k8s o Docker Swarm es redundante; a menudo recurren a estas herramientas debido a la naturaleza general de la tecnolog√≠a y las "m√°s poderosas", en la persona de los g√©neros, para conducir todo a nubes y contenedores.  Bueno, porque ahora est√° de moda y todos lo hacen. <br><br>  Al menos en la mitad de los casos, usar kubernetis o simplemente un acoplador en un proyecto es redundante.  La pregunta es que no todos los equipos o empresas de outsourcing contratados para dar servicio a la infraestructura del cliente son conscientes de esto.  Peor: cuando se imponen contenedores, ya que aumenta en una cierta cantidad de monedas para el cliente. <br><br>  En general, existe la opini√≥n de que el cubo acoplable / mafioso aplasta est√∫pidamente a los clientes que subcontratan estos problemas de infraestructura.  De hecho, para trabajar con cl√∫steres, necesita ingenieros que sean capaces de esto y entiendan la arquitectura de la soluci√≥n implementada en general.  De alguna manera, ya describimos nuestro caso con la edici√≥n Republic: all√≠ capacitamos al equipo del cliente para trabajar en las realidades de kubernetis, y todos quedaron satisfechos.  Y fue decente.  A menudo, los "implementadores" de k8 toman como rehenes a la infraestructura del cliente: ahora solo entienden c√≥mo funciona todo all√≠, no hay especialistas del lado del cliente. <br><br>  Ahora imagine que de esta manera le damos no solo la parte del servidor web a la subcontrataci√≥n, sino tambi√©n el mantenimiento de la base de datos.  Dijimos que un DB es un coraz√≥n, y la p√©rdida del coraz√≥n es fatal para cualquier organismo vivo.  En resumen, las perspectivas no son las mejores.  Entonces, en lugar de hype kubernetis, muchos proyectos simplemente no deber√≠an volverse locos con la tarifa normal de AWS, que resolver√° todos los problemas con la carga en su sitio web / proyecto.  Pero AWS ya no est√° de moda, y las exhibiciones son m√°s caras que el dinero, desafortunadamente, tambi√©n en el entorno de TI. <br><br>  Esta bien  Quiz√°s el proyecto realmente necesite agrupamiento, pero si todo est√° claro con aplicaciones sin estado, ¬øc√≥mo podemos organizar una provisi√≥n decente de conectividad de red para la base de datos agrupada? <br><br>  Si estamos hablando de una soluci√≥n de ingenier√≠a perfecta, que parece ser la transici√≥n a k8s, entonces nuestro principal dolor de cabeza es la replicaci√≥n de datos en una base de datos agrupada.  Algunos DBMS son inicialmente bastante leales a la distribuci√≥n de datos entre sus instancias individuales.  Muchos otros no son tan acogedores.  Y a menudo, el argumento principal al elegir un DBMS para nuestro proyecto no es la capacidad de replicarse con un m√≠nimo de recursos y costos de ingenier√≠a.  Especialmente si el proyecto no se plane√≥ originalmente como un microservicio, sino que simplemente evolucion√≥ en esta direcci√≥n. <br><br>  No necesitamos hablar sobre la velocidad de las unidades de red: son lentas.  Es decir  todav√≠a no tenemos una posibilidad real, en cuyo caso, actualizar una instancia de DBMS en alg√∫n lugar, donde haya m√°s, por ejemplo, capacidades de procesador o RAM libre.  Nos encontramos r√°pidamente con el rendimiento de un subsistema de disco virtualizado.  En consecuencia, el DBMS debe clavarse en su propio conjunto personal de m√°quinas en las proximidades.  O bien, es necesario separar de alguna manera la sincronizaci√≥n suficientemente r√°pida de la sincronizaci√≥n de datos con las reservas estimadas. <br><br>  Continuando con el tema de FS virtual: Docker Volumes, desafortunadamente, no es f√°cil.  En general, en un caso de almacenamiento de datos confiable a largo plazo, me gustar√≠a administrar con los esquemas t√©cnicos m√°s simples.  Y agregar una nueva capa de abstracci√≥n del contenedor FS al FS del host principal es un riesgo en s√≠ mismo.  Pero cuando tambi√©n hay dificultades para transmitir datos entre estas capas en el funcionamiento del sistema de soporte de contenedorizaci√≥n, entonces es realmente un desastre.  Por el momento, la mayor√≠a de los problemas conocidos por la humanidad progresiva parecen erradicarse.  Pero usted mismo comprende, cuanto m√°s complejo es el mecanismo, m√°s f√°cil se rompe. <br><br>  A la luz de todas estas "aventuras", es mucho m√°s rentable y m√°s f√°cil mantener la base de datos en un solo lugar, e incluso si necesita la contenedorizaci√≥n de la aplicaci√≥n, d√©jela girar sola y, a trav√©s de la puerta de enlace de distribuci√≥n, reciba comunicaci√≥n simult√°nea con la base de datos, que se leer√° y escribir√° solo una vez y en un solo lugar  Este enfoque reduce la probabilidad de errores y errores de sincronizaci√≥n a valores m√≠nimos. <br><br>  ¬øA qu√© nos estamos dirigiendo?  Adem√°s, la contenedorizaci√≥n de la base de datos es apropiada cuando existe una necesidad real de ella.  No puede llenar la base de la aplicaci√≥n completa y girarla como si tuviera dos docenas de microservicios; esto no funciona.  Y esto debe entenderse claramente. <br><br><h4>  En lugar de salida </h4><br>  Si est√° esperando la conclusi√≥n inteligible "virtualice o no la base de datos", entonces estamos decepcionados: no estar√° aqu√≠.  Porque al crear cualquier soluci√≥n de infraestructura, uno no debe guiarse por la moda y el progreso, sino, en primer lugar, por el sentido com√∫n. <br><br>  Hay proyectos en los que los principios y herramientas que vienen con kubernetis encajan perfectamente, y en tales proyectos, la paz llega al menos en el √°rea de back-end.  Y hay proyectos que no necesitan contenedorizaci√≥n, sino una infraestructura de servidor normal, porque b√°sicamente no se pueden redimensionar a un modelo de cl√∫ster de microservicios, porque se caer√°n. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/453602/">https://habr.com/ru/post/453602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453590/index.html">Tu propio SaaS personal</a></li>
<li><a href="../453592/index.html">Ganarse la vida y hacer juegos: 11 consejos de Levelord</a></li>
<li><a href="../453594/index.html">Haciendo juegos para ganarse la vida: 11 consejos de Levelord</a></li>
<li><a href="../453596/index.html">Fraudes y EDS: todo es muy malo</a></li>
<li><a href="../453598/index.html">Jap√≥n: un pa√≠s de sentido com√∫n que en algunos lugares es irracional</a></li>
<li><a href="../453608/index.html">Pythonhosted.org bloqueado por error por Roskomnadzor</a></li>
<li><a href="../453610/index.html">C√≥mo vender negocios SD-WAN</a></li>
<li><a href="../453612/index.html">F√∫tbol en las nubes: ¬ømoda o necesidad?</a></li>
<li><a href="../453614/index.html">Repositorio local (fuera de l√≠nea) npm</a></li>
<li><a href="../453616/index.html">¬øQu√© tiene de malo la ley federal "sobre firmas electr√≥nicas" (63-FZ) y c√≥mo solucionarla?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>