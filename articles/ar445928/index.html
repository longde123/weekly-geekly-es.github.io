<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จโ๐ ๐ผ ๐ ููู ูููุง ุจุฒูุงุฏุฉ ุฅูุชุงุฌูุฉ Tensorflow ุจูุณุจุฉ 70ูช ๐จ๐ปโ๐จ ๐ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฃุตุจุญ Tensorflow ููุตุฉ ููุงุณูุฉ ููุชุนูู ุงูุขูู (ML) ุ ุดุนุจูุฉ ูู ูู ูู ุงูุตูุงุนุฉ ูุงูุจุญุซ. ุชู ุฅูุดุงุก ุงูุนุฏูุฏ ูู ุงูููุชุจุงุช ูุงูุฃุฏูุงุช ูุงูุฃุทุฑ ุงููุฌุงููุฉ ูุชุฏุฑูุจ ูุตูุงูุฉ ููุงุฐ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููู ูููุง ุจุฒูุงุฏุฉ ุฅูุชุงุฌูุฉ Tensorflow ุจูุณุจุฉ 70ูช</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445928/" style=";text-align:right;direction:rtl">  ุฃุตุจุญ Tensorflow ููุตุฉ ููุงุณูุฉ ููุชุนูู ุงูุขูู (ML) ุ ุดุนุจูุฉ ูู ูู ูู ุงูุตูุงุนุฉ ูุงูุจุญุซ.  ุชู ุฅูุดุงุก ุงูุนุฏูุฏ ูู ุงูููุชุจุงุช ูุงูุฃุฏูุงุช ูุงูุฃุทุฑ ุงููุฌุงููุฉ ูุชุฏุฑูุจ ูุตูุงูุฉ ููุงุฐุฌ ML.  ูุณุงุนุฏ ูุดุฑูุน Tensorflow Serving ูู ุงูุญูุงุธ ุนูู ููุงุฐุฌ ML ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ ุงูููุฒุนุฉ. <br><br>  ุชุณุชุฎุฏู ุฎุฏูุฉ Mux ุงูุฎุงุตุฉ ุจูุง ุฎุฏูุฉ Tensorflow ูู ุนุฏุฉ ุฃุฌุฒุงุก ูู ุงูุจููุฉ ุงูุชุญุชูุฉ ุ ููุฏ ูุงูุดูุง ุจุงููุนู ุงุณุชุฎุฏุงู ุฎุฏูุฉ Tensorflow ูู ุชุฑููุฒ ุนูุงููู ุงูููุฏูู.  ุณูุฑูุฒ ุงูููู ุนูู ุงูุฃุณุงููุจ ุงูุชู ุชุนูู ุนูู ุชุญุณูู ุฒูู ุงููุตูู ูู ุฎูุงู ุชุญุณูู ูู ูู ุฎุงุฏู ุงูุชูุจุค ูุงูุนููู.  ุนุงุฏุฉ ูุง ุชููู ุงูุชูุจุคุงุช ุงููููุฐุฌูุฉ ุนุจุงุฑุฉ ุนู ุนูููุงุช "ุนุจุฑ ุงูุฅูุชุฑูุช" (ุนูู ุงููุณุงุฑ ุงูุญุฑุฌ ูุทูุจ ุชูุฏูู ุทูุจ) ุ ูุจุงูุชุงูู ุ ูุฅู ุงูุฃูุฏุงู ุงูุฑุฆูุณูุฉ ููุชุญุณูู ูู ูุนุงูุฌุฉ ูููุงุช ูุจูุฑุฉ ูู ุงูุทูุจุงุช ุจุฃูู ุชุฃุฎูุฑ ูููู. <br><a name="habracut"></a><br>
<h1 style=";text-align:right;direction:rtl">  ูุง ูู ุฎุฏูุฉ Tensorflowุ </h1><br>  ูููุฑ Tensorflow Serving ุจููุฉ ุฎุงุฏู ูุฑูุฉ ููุดุฑ ูุตูุงูุฉ ููุงุฐุฌ ML.  ุจูุฌุฑุฏ ุชุฏุฑูุจ ุงููููุฐุฌ ูุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ููุชูุจุค ุ ูุชุทูุจ Tensorflow Serving ุชุตุฏูุฑู ุฅูู ุชูุณูู ูุชูุงูู (ูุงุจู ููุชูููุฐ). <br><br>  <i>Servable</i> ุนุจุงุฑุฉ ุนู ุชุฌุฑูุฏ ูุฑูุฒู ููู ูุงุฆูุงุช Tensorflow.  ุนูู ุณุจูู ุงููุซุงู ุ ูููู ุชูุซูู ูููุฐุฌ ููุงุฆู ูุงุญุฏ ุฃู ุฃูุซุฑ ูู ุงููุงุฆูุงุช ุงููุงุจูุฉ ููุฎุฏูุฉ.  ูุจุงูุชุงูู ุ Servable ูู ุงููุงุฆูุงุช ุงูุฃุณุงุณูุฉ ุงูุชู ูุณุชุฎุฏููุง ุงูุนููู ูุชูููุฐ ุงูุนูููุงุช ุงูุญุณุงุจูุฉ.  ุฃูููุฉ ุงูุญุฌู ุงููุงุจู ููุชุทุจูู: ุชุดุบู ุงูููุฏููุงุช ุงูุฃุตุบุฑ ูุณุงุญุฉ ุฃูู ูุชุณุชุฎุฏู ุฐุงูุฑุฉ ุฃูู ูุชุญููู ุจุดูู ุฃุณุฑุน.  ูุชูุฒูู ูุตูุงูุฉ ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Predict ุ ูุฌุจ ุฃู ุชููู ุงูุทุฑุฒ ูู ุชูุณูู SavedModel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20b/9f9/47e/20b9f947ea0f318dc7c2eba619b3901f.png"><br><br>  ูุฌูุน Tensorflow Serving ุจูู ุงูููููุงุช ุงูุฃุณุงุณูุฉ ูุฅูุดุงุก ุฎุงุฏู gRPC / HTTP ุงูุฐู ูุฎุฏู ุงูุนุฏูุฏ ูู ุทุฑุฒ ML (ุฃู ุนุฏุฉ ุฅุตุฏุงุฑุงุช) ุ ููููุฑ ููููุงุช ุงููุฑุงูุจุฉ ููููู ูุฎุตุต. <br><br><h1 style=";text-align:right;direction:rtl">  Tensorflow ุฎุฏูุฉ ูุน ุนุงูู ุงููููุงุก </h1><br>  ุฏุนูุง ูููู ูุธุฑุฉ ุนูู ุงูููุงููุณ ุงูุฃุณุงุณูุฉ ูููููู ูู ุงูุชูุจุค ุจุงูุฃุฏุงุก ูู ุฎูุงู ุฅุนุฏุงุฏุงุช ุฎุฏูุฉ Tensorflow ุงูููุงุณูุฉ (ุจุฏูู ุชุญุณูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ). <br><br>  ุฃููุงู ุ ูู ุจุชูุฒูู ุฃุญุฏุซ ุตูุฑุฉ ูู ูุฑูุฒ TensorFlow Docker: <br><br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">docker pull tensorflow/serving:latest</code> </pre> <br>  ูู ูุฐู ุงูููุงูุฉ ุ ุชุนูู ุฌููุน ุงูุญุงููุงุช ุนูู ูุถูู ุจู ุฃุฑุจุนุฉ ููู ุ 15 ุฌูุฌุงุจุงูุช ุ ุฃูุจููุชู 16.04. <br><br><h3 style=";text-align:right;direction:rtl">  ุชุตุฏูุฑ ูููุฐุฌ Tensorflow ุฅูู SavedModel </h3><br>  ุนูุฏ ุชุฏุฑูุจ ูููุฐุฌ ุจุงุณุชุฎุฏุงู Tensorflow ุ ูููู ุญูุธ ุงูุฅุฎุฑุงุฌ ูููุงุท ุชุญูู ูุชุบูุฑุฉ (ูููุงุช ุนูู ุงููุฑุต).  ูุชู ุชูููุฐ ุงูุฅุฎุฑุงุฌ ูุจุงุดุฑุฉ ูู ุฎูุงู ุงุณุชุนุงุฏุฉ ููุงุท ุงูุชุญูู ูู ุงููููุฐุฌ ุฃู ูู ุชูุณูู ุงูุฑุณู ุงูุจูุงูู ุงููุฌูุฏุฉ ุงููุฌูุฏุฉ (ููู ุซูุงุฆู). <br><br>  ุจุงููุณุจุฉ ุฅูู Tensorflow Serving ุ ูุฌุจ ุชุตุฏูุฑ ูุฐุง ุงูุฑุณู ุงูุจูุงูู ุงููุฌูุฏ ุฅูู ุชูุณูู SavedModel.  ุชุญุชูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู Tensorflow</a> ุนูู ุฃูุซูุฉ ูุชุตุฏูุฑ ุงูููุงุฐุฌ ุงููุฏุฑุจุฉ ุฅูู ุชูุณูู SavedModel. <br><br>  ูููุฑ Tensorflow ุฃูุถูุง ุงูุนุฏูุฏ ูู ุงูููุงุฐุฌ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฑุณููุฉ ูุงูุจุญุซูุฉ</a> ูููุทุฉ ุงูุทูุงู ููุชุฌุฑูุจ ุฃู ุงูุจุญุซ ุฃู ุงูุฅูุชุงุฌ. <br><br>  ุนูู ุณุจูู ุงููุซุงู ุ ุณูู ูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุฐุฌ ุงูุดุจูุฉ ุงูุนุตุจูุฉ ุงูุนูููุฉ (ResNet)</a> ูุชุตููู ูุฌููุนุฉ ุจูุงูุงุช ImageNet ูู 1000 ูุฆุฉ.  ูู ุจุชูุฒูู <code>ResNet-50 v2</code> ุ ูุชุญุฏูุฏุงู ุฎูุงุฑ Channels_last (NHWC) ูู <i>SavedModel</i> : ููุงุนุฏุฉ ุนุงูุฉ ุ ูุนูู ุจุดูู ุฃูุถู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ. <br><br>  ุงูุณุฎ ุฏููู ุทุฑุงุฒ RestNet ุฅูู ุงููููู ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">models/ 1/ saved_model.pb variables/ variables.data-00000-of-00001 variables.index</code> </pre> <br>  ุชุชููุน ุฎุฏูุฉ Tensorflow ุจููุฉ ุฏููู ูุฑุชุจุฉ ุนุฏุฏููุง ููุฅุตุฏุงุฑ.  ูู ุญุงูุชูุง ุ ูุชูุงูู ุงูุฏููู <code>1/</code> ูุน ุทุฑุงุฒ ุงูุฅุตุฏุงุฑ 1 ุ ุงูุฐู ูุญุชูู ุนูู ุจููุฉ ุทุฑุงุฒ <code>saved_model.pb</code> ูุน ููุทุฉ ูู ุฃูุฒุงู ุงููููุฐุฌ (ุงููุชุบูุฑุงุช). <br><br><h3 style=";text-align:right;direction:rtl">  ุชุญููู ููุนุงูุฌุฉ SavedModel </h3><br>  ูุจุฏุฃ ุงูุฃูุฑ ุงูุชุงูู ูู ุชุดุบูู ุฎุงุฏู ุทุฑุงุฒ Tensorflow Serving ูู ุญุงููุฉ Docker.  ูุชุญููู SavedModel ุ ูุฌุจ ุนููู ุชุญููู ุฏููู ุงูุทุฑุงุฒ ูู ุฏููู ุงูุญุงููุฉ ุงููุชููุน. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker run -d -p 9000:8500 \ -v $(pwd)/models:/models/resnet -e MODEL_NAME=resnet \ -t tensorflow/serving:latest</code> </pre> <br>  ููุถุญ ุงูุชุญูู ูู ุณุฌูุงุช ุงูุญุงููุฉ ุฃู ModelServer ููุฏ ุงูุชุดุบูู ููุชุนุงูู ูุน ุทูุจุงุช ุงูุฅุฎุฑุงุฌ ูุทุฑุงุฒ <code>resnet</code> ูู ููุทุชู gRPC ู HTTP: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">... I tensorflow_serving/core/loader_harness.cc:86] Successfully loaded servable version {name: resnet version: 1} I tensorflow_serving/model_servers/server.cc:286] Running gRPC ModelServer at 0.0.0.0:8500 ... I tensorflow_serving/model_servers/server.cc:302] Exporting HTTP/REST API at:localhost:8501 ...</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุงูุชูุจุค ุงูุนููู </h3><br>  ูุญุฏุฏ Tensorflow Serving ูุฎุทุท API ูู ุชูุณูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฎุงุฒู ุจุฑูุชูููู</a> (protobufs).  ูุชู ุญุฒู ุชุทุจููุงุช ุนููู GRPC ููุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ููุชูุจุค ูุญุฒูุฉ Python <code>tensorflow_serving.apis</code> .  ุณูุญุชุงุฌ ุฅูู ุญุฒูุฉ <code>tensorflow</code> ุญุฒูุฉ Python <code>tensorflow</code> ุงููุฑุงูู. <br><br>  ุชุซุจูุช ุงูุชุจุนูุงุช ูุฅูุดุงุก ุนููู ุจุณูุท: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">virtualenv .env &amp;&amp; source .env/bin/activate &amp;&amp; \ pip install numpy grpcio opencv-python tensorflow tensorflow-serving-api</code> </pre> <br>  ูุชููุน ูููุฐุฌ <code>ResNet-50 v2</code> ูุฏุฎูุงุช <code>ResNet-50 v2</code> ุงูุนุงุฆูุฉ ูู ุจููุฉ ุจูุงูุงุช ุงูุชูุณูู (NHWC) ุงูููุณูุฉ.  ูุฐูู ุ ุชุชู ูุฑุงุกุฉ ุตูุฑุฉ ุงูุฅุฏุฎุงู ุจุงุณุชุฎุฏุงู opencv-python ูุชุญููููุง ูู ุตููู numpy (ุงุฑุชูุงุน ร ุนุฑุถ ร ูููุงุช) ูููุน ุจูุงูุงุช float32.  ูููู ุงูุจุฑูุงูุฌ ุงููุตู ุฃุฏูุงู ุจุฅูุดุงุก ูุนุจ ุนููู ุชูุจุค ูุชุญููู ุจูุงูุงุช JPEG ูู ุตููู numpy ุ ููููู ุจุชุญููููุง ุฅูู tensor_proto ูุชูุฏูู ุทูุจ ุชูุจุค ูู gRPC: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python from __future__ import print_function import argparse import numpy as np import time tt = time.time() import cv2 import tensorflow as tf from grpc.beta import implementations from tensorflow_serving.apis import predict_pb2 from tensorflow_serving.apis import prediction_service_pb2 parser = argparse.ArgumentParser(description='incetion grpc client flags.') parser.add_argument('--host', default='0.0.0.0', help='inception serving host') parser.add_argument('--port', default='9000', help='inception serving port') parser.add_argument('--image', default='', help='path to JPEG image file') FLAGS = parser.parse_args() def main(): # create prediction service client stub channel = implementations.insecure_channel(FLAGS.host, int(FLAGS.port)) stub = prediction_service_pb2.beta_create_PredictionService_stub(channel) # create request request = predict_pb2.PredictRequest() request.model_spec.name = 'resnet' request.model_spec.signature_name = 'serving_default' # read image into numpy array img = cv2.imread(FLAGS.image).astype(np.float32) # convert to tensor proto and make request # shape is in NHWC (num_samples x height x width x channels) format tensor = tf.contrib.util.make_tensor_proto(img, shape=[1]+list(img.shape)) request.inputs['input'].CopyFrom(tensor) resp = stub.Predict(request, 30.0) print('total time: {}s'.format(time.time() - tt)) if __name__ == '__main__': main()</span></span></code> </pre> <br>  ุจุนุฏ ุชููู ุฅุฏุฎุงู JPEG ุ ุณููุชุฌ ุนู ุนููู ุนุงูู ุงููุชูุฌุฉ ุงูุชุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">python tf_serving_client.py --image=images/pupper.jpg total time: 2.56152906418s</code> </pre> <br>  ูุญุชูู ุงูููุชุฑ ุงููุงุชุฌ ุนูู ุชูุจุค ูู ุดูู ูููุฉ ุนุฏุฏูุฉ ูุงุญุชูุงู ูุฌูุฏ ุนูุงูุงุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">outputs { key: <span class="hljs-string"><span class="hljs-string">"classes"</span></span> value { dtype: DT_INT64 tensor_shape { dim { size: <span class="hljs-number"><span class="hljs-number">1</span></span> } } int64_val: <span class="hljs-number"><span class="hljs-number">238</span></span> } } outputs { key: <span class="hljs-string"><span class="hljs-string">"probabilities"</span></span> ...</code> </pre> <br>  ูุทูุจ ูุงุญุฏ ุ ูุซู ูุฐุง ุงูุชุฃุฎูุฑ ุบูุฑ ููุจูู.  ููู ููุณ ูู ุงููุณุชุบุฑุจ ุฃู ูุชู ุชุตููู Tensorflow Serving binary ุงูุชุฑุงุถููุง ูุฃูุณุน ูุฌููุนุฉ ูู ุงููุนุฏุงุช ููุนุธู ุญุงูุงุช ุงูุงุณุชุฎุฏุงู.  ุฑุจูุง ูุงุญุธุช ุงูุฃุณุทุฑ ุงูุชุงููุฉ ูู ุณุฌูุงุช ุญุงููุฉ Tensorflow Serving ุงูููุงุณูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">I external/org_tensorflow/tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA</code> </pre> <br>  ูุดูุฑ ูุฐุง ุฅูู ูุฌูุฏ TensorFlow Serving ุซูุงุฆู ูุนูู ุนูู ููุตุฉ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูุงูุชู ูู ูุชู ุชุญุณูููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุจูุงุก ุซูุงุฆู ุงูุฃูุซู </h3><br>  ููููุง <a href="">ููุซุงุฆู</a> Tensorflow ุ ููุตู ุจุชุฑุฌูุฉ Tensorflow ูู ุงููุตุฏุฑ ูุน ุฌููุน ุงูุชุญุณููุงุช ุงููุชุงุญุฉ ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุนูู ุงููุถูู ุญูุซ ุณูุนูู ุงูุซูุงุฆู.  ุนูุฏ ุงูุชุฌููุน ุ ุชุชูุญ ุงูุนูุงูุงุช ุงูุฎุงุตุฉ ุชูุดูุท ูุฌููุนุงุช ุชุนูููุงุช ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูููุตุฉ ูุนููุฉ: <br><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><th>  ูุฌููุนุฉ ุงูุชุนูููุงุช </th><th>  ุงูุฃุนูุงู </th></tr><tr><td>  AVX </td><td>  - ุชุจูู = -mavx </td></tr><tr><td>  AVX2 </td><td>  - ุชุจูู = - mxx2 </td></tr><tr><td>  FMA </td><td>  - ูุจุทู = -mfma </td></tr><tr><td>  SSE 4.1 </td><td>  - ุชุจูู = -msse4.1 </td></tr><tr><td>  SSE 4.2 </td><td>  - ุชุจูู = -msse4.2 </td></tr><tr><td>  ุฌููุน ุชุฏุนููุง ุงููุนุงูุฌ </td><td>  - ุชุจู = ูุงุฑุณ = ููุงุทู </td></tr></tbody></table></div><br>  ุงุณุชูุณุงุฎ Tensorflow ุชูุฏูู ุฅุตุฏุงุฑ ูุญุฏุฏ.  ูู ุญุงูุชูุง ุ ูุฐุง ูู 1.13 (ุงูุฃุฎูุฑ ูู ููุช ูุดุฑ ูุฐู ุงูููุงูุฉ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">USER=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> TAG=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> TF_SERVING_VERSION_GIT_BRANCH=<span class="hljs-string"><span class="hljs-string">"r1.13"</span></span> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> --branch=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TF_SERVING_VERSION_GIT_BRANCH</span></span></span><span class="hljs-string">"</span></span> https://github.com/tensorflow/serving</code> </pre> <br>  ุชุณุชุฎุฏู ุตูุฑุฉ dev Tensorflow Serving ุฃุฏุงุฉ ุจุงุฒู ููุจูุงุก.  ูุญู ุชููููู ููุฌููุนุงุช ูุญุฏุฏุฉ ูู ุชุนูููุงุช ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">TF_SERVING_BUILD_OPTIONS=<span class="hljs-string"><span class="hljs-string">"--copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-msse4.1 --copt=-msse4.2"</span></span></code> </pre> <br>  ุฅุฐุง ูู ุชูู ููุงู ุฐุงูุฑุฉ ูุงููุฉ ุ <code>--local_resources=2048,.5,1.0</code> ุงุณุชููุงู ุงูุฐุงูุฑุฉ ุฃุซูุงุก ุนูููุฉ <code>--local_resources=2048,.5,1.0</code> ุจุงุณุชุฎุฏุงู ุงูุนูุงูุฉ <code>--local_resources=2048,.5,1.0</code> .  ููุญุตูู ุนูู ูุนูููุงุช ุญูู ุงูุนูุงูุงุช ุ ุฑุงุฌุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุณุงุนุฏุฉ Tensorflow Serving and Docker</a> ุ ููุฐูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู Bazel</a> . <br><br>  ูู ุจุฅูุดุงุก ุตูุฑุฉ ุนูู ุจูุงุกู ุนูู ุงูุตูุฑุฉ ุงูุญุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash USER=$1 TAG=$2 TF_SERVING_VERSION_GIT_BRANCH="r1.13" git clone --branch="${TF_SERVING_VERSION_GIT_BRANCH}" https://github.com/tensorflow/serving TF_SERVING_BUILD_OPTIONS="--copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-msse4.1 --copt=-msse4.2" cd serving &amp;&amp; \ docker build --pull -t $USER/tensorflow-serving-devel:$TAG \ --build-arg TF_SERVING_VERSION_GIT_BRANCH="${TF_SERVING_VERSION_GIT_BRANCH}" \ --build-arg TF_SERVING_BUILD_OPTIONS="${TF_SERVING_BUILD_OPTIONS}" \ -f tensorflow_serving/tools/docker/Dockerfile.devel . cd serving &amp;&amp; \ docker build -t $USER/tensorflow-serving:$TAG \ --build-arg TF_SERVING_BUILD_IMAGE=$USER/tensorflow-serving-devel:$TAG \ -f tensorflow_serving/tools/docker/Dockerfile .</span></span></code> </pre> <br>  ุชู ุชูููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ModelServer</a> ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุดุงุฑุงุช TensorFlow</a> ูุฏุนู ุงูุชุฒุงูู.  ุงูุฎูุงุฑุงุช ุงูุชุงููุฉ ุชูููู ุชุฌูุนุงุช ูุคุดุฑ ุชุฑุงุจุท ุงุซููู ูุนูููุฉ ูุชูุงุฒูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">intra_op_parallelism_threads</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชุญูู ูู ุงูุญุฏ ุงูุฃูุตู ูุนุฏุฏ ูุคุดุฑุงุช ุงูุชุฑุงุจุท ููุชูููุฐ ุงููุชูุงุฒู ูุนูููุฉ ูุงุญุฏุฉ ุ <br></li><li style=";text-align:right;direction:rtl">  ุชุณุชุฎุฏู ูููุงุฒูุฉ ุงูุนูููุงุช ุงูุชู ููุง ุนูููุงุช ูุฑุนูุฉ ูุณุชููุฉ ูู ุงูุทุจูุนุฉ. </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">inter_op_parallelism_threads</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชุญูู ูู ุงูุญุฏ ุงูุฃูุตู ูุนุฏุฏ ูุคุดุฑุงุช ุงูุชุฑุงุจุท ููุชูููุฐ ุงููุชูุงุฒู ููุนูููุงุช ุงููุณุชููุฉ ุ <br></li><li style=";text-align:right;direction:rtl">  ุนูููุงุช Tensorflow Graph ุ ูุงูุชู ุชููู ูุณุชููุฉ ุนู ุจุนุถูุง ุงูุจุนุถ ุ ูุจุงูุชุงูู ุ ูููู ุชูููุฐูุง ูู ุฎููุท ูุฎุชููุฉ. </li></ul><br>  ุงูุชุฑุงุถููุง ุ ูุชู ุชุนููู ุงููุนููุชูู ุนูู <code>0</code> .  ูุฐุง ูุนูู ุฃู ุงููุธุงู ููุณู ูุฎุชุงุฑ ุงูุฑูู ุงูููุงุณุจ ุ ูุงูุฐู ูุนูู ุบุงูุจูุง ุฎูุท ูุงุญุฏ ููู ููุงุฉ.  ููุน ุฐูู ุ ูููู ุชุบููุฑ ุงููุนููุฉ ูุฏููุงู ูู ุฃุฌู ุงูุชุฒุงูู ูุชุนุฏุฏ ุงูููุงุฉ. <br><br>  ุซู ูู ุจุชุดุบูู ุงูุญุงููุฉ Serving ุจููุณ ุทุฑููุฉ ุงูุญุงููุฉ ุงูุณุงุจูุฉ ุ ูุฐู ุงููุฑุฉ ูุน ุตูุฑุฉ Docker ุชู ุชุฌููุนูุง ูู ุงููุตุงุฏุฑ ููุน ุฅุดุงุฑุงุช Tensorflow ุงููุญุณูุฉ ููุนุงูุฌ ูุญุฏุฏ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">docker run -d -p 9000:8500 \ -v $(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>)/models:/models/resnet -e MODEL_NAME=resnet \ -t <span class="hljs-variable"><span class="hljs-variable">$USER</span></span>/tensorflow-serving:<span class="hljs-variable"><span class="hljs-variable">$TAG</span></span> \ --tensorflow_intra_op_parallelism=4 \ --tensorflow_inter_op_parallelism=4</code> </pre> <br>  ุณุฌูุงุช ุงูุญุงููุงุช ูุฌุจ ุฃู ูุง ุชุธูุฑ ุงูุชุญุฐูุฑุงุช ุญูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุบูุฑ ูุญุฏุฏุฉ.  ุจุฏูู ุชุบููุฑ ุงูููุฏ ุจูุงุกู ุนูู ุทูุจ ุงูุชููุน ููุณู ุ ูุชู ุชูููู ุงูุชุฃุฎูุฑ ุจุญูุงูู 35.8ูช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">python tf_serving_client.py --image=images/pupper.jpg total time: 1.64234706879s</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุฒูุงุฏุฉ ุงูุณุฑุนุฉ ูู ุงูุชูุจุค ุงูุนููู </h3><br>  ูู ูุง ูุฒุงู ูู ุงููููู ุชุณุฑูุนุ  ููุฏ ูููุง ุจุชุญุณูู ุฌุงูุจ ุงูุฎุงุฏู ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงูุฎุงุตุฉ ุจูุง ุ ูููู ูุง ูุฒุงู ุชุฃุฎูุฑ ุฃูุซุฑ ูู ุซุงููุฉ ูุจูุฑูุง ุฌุฏูุง. <br><br>  ุญุฏุซ ุฃู ุชุญููู ููุชุจุงุช <code>tensorflow</code> ู <code>tensorflow</code> ููุณูู ุจุดูู ูุจูุฑ ูู ุงูุชุฃุฎูุฑ.  ูุถูู ูู ููุงููุฉ ุบูุฑ ุถุฑูุฑูุฉ ุฅูู <code>tf.contrib.util.make_tensor_proto</code> ุฃูุถูุง ุชูุณูู ุซุงููุฉ. <br><br>  ูุฏ ุชุณุฃู: "ุฃูุง ูุญุชุงุฌ ุฅูู ุญุฒู TensorFlow Python ูุชูุฏูู ุทูุจุงุช ุงูุชูุจุค ุจุงููุนู ุฅูู ุฎุงุฏู Tensorflowุ"  ูู ุงููุงูุน ุ ููุณุช ููุงู <i>ุญุงุฌุฉ</i> ุญููููุฉ <code>tensorflow_serving</code> ู <code>tensorflow</code> . <br><br>  ููุง ุฐูุฑ ุณุงุจููุง ุ ูุชู ุชุนุฑูู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ููุชูุจุค Tensorflow ุนูู ุฃููุง ูุฎุงุฒู ูุคูุชุฉ.  ูุฐูู ุ ูููู ุงุณุชุจุฏุงู ุงุซููู ูู ุงูุชุจุนูุงุช ุงูุฎุงุฑุฌูุฉ <code>tensorflow</code> ู <code>tensorflow</code> ุงูููุงุจูุฉ - ููู ุซู ูู ุชุญุชุงุฌ ุฅูู ุณุญุจ ููุชุจุฉ Tensorflow (ุงูุซูููุฉ) ุจุงููุงูู ุนูู ุงูุนููู. <br><br>  ุฃููุงู ุ ุชุฎูุต ูู <code>tensorflow</code> ู <code>tensorflow_serving</code> ูุฃุถู ุญุฒูุฉ <code>grpcio-tools</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">pip uninstall tensorflow tensorflow-serving-api &amp;&amp; \ pip install grpcio-tools==1.0.0</code> </pre> <br>  ูู <code>tensorflow/tensorflow</code> ู <code>tensorflow/serving</code> ุงููุณุชูุฏุนุงุช ููุณุฎ ูููุงุช protobuf ุงูุชุงููุฉ ุฅูู ูุดุฑูุน ุงูุนููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">tensorflow/serving/ tensorflow_serving/apis/model.proto tensorflow_serving/apis/predict.proto tensorflow_serving/apis/prediction_service.proto tensorflow/tensorflow/ tensorflow/core/framework/resource_handle.proto tensorflow/core/framework/tensor_shape.proto tensorflow/core/framework/tensor.proto tensorflow/core/framework/types.proto</code> </pre> <br>  ุงูุณุฎ ูููุงุช protobuf ูุฐู ุฅูู <code>protos/</code> directory ูุน ุงูุญูุงุธ ุนูู ุงููุณุงุฑุงุช ุงูุฃุตููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">protos/ tensorflow_serving/ apis/ *.proto tensorflow/ core/ framework/ *.proto</code> </pre> <br>  ูู ุฃุฌู ุงูุจุณุงุทุฉ ุ ูููู ุชุจุณูุท <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">prediction_service.proto</a> ูุชูููุฐ Predict RPC ููุท ุญุชู ูุง ูุชู ุชูุฒูู ุงูุชุจุนูุงุช ุงููุชุฏุงุฎูุฉ ูู RPC ุงูุฃุฎุฑู ุงููุญุฏุฏุฉ ูู ุงูุฎุฏูุฉ.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุง ููู</a> ูุซุงู ุนูู <code>prediction_service.</code> ุงููุจุณุทุฉ. <br><br>  ุฅูุดุงุก ุชุทุจููุงุช PyRon gRPC ุจุงุณุชุฎุฏุงู <code>grpcio.tools.protoc</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">PROTOC_OUT=protos/ PROTOS=$(find . | grep "\.proto$") for p in $PROTOS; do python -m grpc.tools.protoc -I . --python_out=$PROTOC_OUT --grpc_python_out=$PROTOC_OUT $p done</code> </pre> <br>  ุงูุขู ูููู ุฅุฒุงูุฉ ูุญุฏุฉ <code>tensorflow_serving</code> ุจุฃููููุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">from tensorflow_serving.apis import predict_pb2 from tensorflow_serving.apis import prediction_service_pb2</code> </pre> <br>  ... ูุงุณุชุจุฏุงููุง ุจุงุณุชุฎุฏุงู protobuffers ุงูุชู ุชู ุฅูุดุงุคูุง ูู <code>protos/tensorflow_serving/apis</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">from protos.tensorflow_serving.apis import predict_pb2 from protos.tensorflow_serving.apis import prediction_service_pb2</code> </pre> <br>  ูุชู ุงุณุชูุฑุงุฏ ููุชุจุฉ Tensorflow ูุงุณุชุฎุฏุงู ูุธููุฉ ุงููุณุงุนุฏ <code>make_tensor_proto</code> ุ ููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุถุฑูุฑูุฉ ููุงูุชูุงู</a> ุนูู ูุงุฆู python / numpy ููุงุฆู TensorProto. <br><br>  ูุจุงูุชุงูู ุ ูููููุง ุงุณุชุจุฏุงู ุฌุฒุก ุงูุชุจุนูุฉ ูุงูุฑูุฒ ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensorflow <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tf ... tensor = tf.contrib.util.make_tensor_proto(features) request.inputs[<span class="hljs-string"><span class="hljs-string">'inputs'</span></span>].CopyFrom(tensor)</code> </pre> <br>  ุงุณุชูุฑุงุฏ protobuffers ูุจูุงุก ูุงุฆู TensorProto: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> protos.tensorflow.core.framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensor_pb2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> protos.tensorflow.core.framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensor_shape_pb2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> protos.tensorflow.core.framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> types_pb2 ... <span class="hljs-comment"><span class="hljs-comment"># ensure NHWC shape and build tensor proto tensor_shape = [1]+list(img.shape) dims = [tensor_shape_pb2.TensorShapeProto.Dim(size=dim) for dim in tensor_shape] tensor_shape = tensor_shape_pb2.TensorShapeProto(dim=dims) tensor = tensor_pb2.TensorProto( dtype=types_pb2.DT_FLOAT, tensor_shape=tensor_shape, float_val=list(img.reshape(-1))) request.inputs['inputs'].CopyFrom(tensor)</span></span></code> </pre> <br>  ุงููุต ุงููุงูู ูุจูุซูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ูู ุจุชุดุบูู ุนููู ุจุฏุก ุชุดุบูู ูุญุฏุซ ููุฏู ุทูุจ ุชูุจุค ูุฎุฏูุฉ Tensorflow ุงููุญุณูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">python tf_inception_grpc_client.py --image=images/pupper.jpg total time: 0.58314920859s</code> </pre> <br>  ููุถุญ ุงููุฎุทุท ุงูุชุงูู ููุช ุงูุชูููุฐ ุงููุชููุน ูู ุงูุฅุตุฏุงุฑ ุงูุฃูุซู ูู Tensorflow Serving ููุงุฑูุฉู ุจุงููุนูุงุฑ ุงูุฐู ูุฒูุฏ ุนู 10 ูุฑุงุช: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/48d/990/b83/48d990b83dc54762fec809a580c450c8.png"><br><br>  ุงูุฎูุถ ูุชูุณุท โโุงูุชุฃุฎูุฑ ุจูุญู 3.38 ูุฑุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ุนุฑุถ ุงููุทุงู ุงูุชุฑุฏุฏู ุงูุฃูุซู </h1><br>  ูููู ุชูููู ุฎุฏูุฉ Tensorflow ููุชุนุงูู ูุน ูููุงุช ูุจูุฑุฉ ูู ุงูุจูุงูุงุช.  ุนุงุฏุฉู ูุง ูุชู ุฅุฌุฑุงุก ุชุญุณูู ุนุฑุถ ุงููุทุงู ุงูุชุฑุฏุฏู ููุนุงูุฌุฉ ุงูุฏููุนุงุช "ุงููุณุชููุฉ" ุ ุญูุซ ูุง ุชููู ุญุฏูุฏ ุฒูู ุงููุตูู ุงูุถูู ูุชุทูุจูุง ุตุงุฑููุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุฎุงุฏู ุงูุฌุงูุจ ุชุฌููุฒ ุงูุฏูุนุงุช </h3><br>  ููุง ูู ูุฐููุฑ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู</a> ุ ูุชู ุฏุนู ูุนุงูุฌุฉ ุงูุฏููุนุงุช ูู ุฌุงูุจ ุงูุฎุงุฏู ุฃุตูุงู ูู ุฎุฏูุฉ Tensorflow. <br><br>  ูุชู ุชุญุฏูุฏ ุงูููุงุถูุฉ ุจูู ุงููููู ูุงูุฅูุชุงุฌูุฉ ุจูุงุณุทุฉ ูุนููุงุช ูุนุงูุฌุฉ ุงูุฏููุนุงุช.  ุฅููุง ุชุณูุญ ูู ุจุชุญููู ุงูุญุฏ ุงูุฃูุตู ูู ุงูุฅูุชุงุฌูุฉ ุงูุชู ุชููู ูุณุฑุนุงุช ุงูุฃุฌูุฒุฉ ูุงุฏุฑุฉ ุนูููุง. <br><br>  ูุชูููู ุงูุชุนุจุฆุฉ ุ ุงุถุจุท - <code>--batching_parameters_file</code> ู - <code>--batching_parameters_file</code> .  ูุชู ุชุนููู ุงููุนููุงุช ููููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SessionBundleConfig</a> .  ุจุงููุณุจุฉ ููุฃูุธูุฉ ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุ ูู ุจุชุนููู <code>num_batch_threads</code> ุนูู ุนุฏุฏ ุงูููู ุงููุชุงุญุฉ.  ู GPU ุ ุฑุงุฌุน ุงููุนููุงุช ุงูููุงุณุจุฉ <a href="">ููุง</a> . <br><br>  ุจุนุฏ ููุก ุงูุญุฒูุฉ ุจุฃููููุง ุนูู ุฌุงูุจ ุงูุฎุงุฏู ุ ูุชู ุฏูุฌ ุทูุจุงุช ุงูุฅุตุฏุงุฑ ูู ุทูุจ ูุงุญุฏ ูุจูุฑ (tensor) ุ ูุฅุฑุณุงููุง ุฅูู ุฌูุณุฉ Tensorflow ูุน ุทูุจ ูุดุชุฑู.  ูู ูุฐู ุงูุญุงูุฉ ุ ุชุดุงุฑู ุงูุชูุงุฒู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ / GPU ุญูุง. <br><br>  ุจุนุถ ุงูุงุณุชุฎุฏุงูุงุช ุงูุดุงุฆุนุฉ ููุนุงูุฌุฉ ุงูุฏูุนุงุช Tensorflow: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏุงู ุทูุจุงุช ุงูุนููู ุบูุฑ ุงููุชุฒุงููุฉ ูุชุนุจุฆุฉ ุงูุญุฒู ูู ุฌุงูุจ ุงูุฎุงุฏู <br></li><li style=";text-align:right;direction:rtl">  ูุนุงูุฌุฉ ุฏูุนูุฉ ุฃุณุฑุน ุนู ุทุฑูู ููู ููููุงุช ุงูุฑุณู ุงูุจูุงูู ุงููููุฐุฌู ุฅูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ / ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช <br></li><li style=";text-align:right;direction:rtl">  ุฎุฏูุฉ ุงูุทูุจุงุช ูู ููุงุฐุฌ ูุชุนุฏุฏุฉ ูู ุฎุงุฏู ูุงุญุฏ <br></li><li style=";text-align:right;direction:rtl">  ููุตู ุจุดุฏุฉ ุจูุนุงูุฌุฉ ุงูุฏููุนุงุช ูููุนุงูุฌุฉ "ุบูุฑ ุงููุชุตูุฉ" ูุนุฏุฏ ูุจูุฑ ูู ุงูุทูุจุงุช </li></ul><br><h3 style=";text-align:right;direction:rtl">  ุงูุนููู ุฏูุนุฉ ุชุฌููุฒ ุชุฌููุฒ </h3><br>  ูุฌููุนุงุช ุงููุนุงูุฌุฉ ุงูุฏูุนูุฉ ูู ุฌุงูุจ ุงูุนููู ุจุชุฌููุน ุงูุนุฏูุฏ ูู ุงูุทูุจุงุช ุงููุงุฑุฏุฉ ูู ูุงุญุฏ. <br><br>  ูุธุฑูุง ูุฃู ูููุฐุฌ ResNet ููุชุธุฑ ุงูุฅุฏุฎุงู ุจุชูุณูู NHWC (ุงูุจุนุฏ ุงูุฃูู ูู ุนุฏุฏ ุงููุฏุฎูุงุช) ุ ูููููุง ุฏูุฌ ุนุฏุฉ ุตูุฑ ุฅุฏุฎุงู ูู ุทูุจ RPC ูุงุญุฏ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">... </span></span>batch = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> jpeg <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.listdir(FLAGS.images_path): path = os.path.join(FLAGS.images_path, jpeg) img = cv2.imread(path).astype(np.float32) batch.append(img) ... batch_np = np.array(batch).astype(np.float32) dims = [tensor_shape_pb2.TensorShapeProto.Dim(size=dim) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dim <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> batch_np.shape] t_shape = tensor_shape_pb2.TensorShapeProto(dim=dims) tensor = tensor_pb2.TensorProto( dtype=types_pb2.DT_FLOAT, tensor_shape=t_shape, float_val=list(batched_np.reshape(<span class="hljs-number"><span class="hljs-number">-1</span></span>))) request.inputs[<span class="hljs-string"><span class="hljs-string">'inputs'</span></span>].CopyFrom(tensor)</code> </pre> <br>  ุจุงููุณุจุฉ ูุญุฒูุฉ ูู ุงูุตูุฑ N ุ ุณูุญุชูู ููุชุฑ ุงูุฅุฎุฑุงุฌ ูู ุงูุงุณุชุฌุงุจุฉ ุนูู ูุชุงุฆุฌ ุงูุชูุจุค ูููุณ ุนุฏุฏ ุงููุฏุฎูุงุช.  ูู ุญุงูุชูุง ุ N = 2: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">outputs { key: <span class="hljs-string"><span class="hljs-string">"classes"</span></span> value { dtype: DT_INT64 tensor_shape { dim { size: <span class="hljs-number"><span class="hljs-number">2</span></span> } } int64_val: <span class="hljs-number"><span class="hljs-number">238</span></span> int64_val: <span class="hljs-number"><span class="hljs-number">121</span></span> } } ...</code> </pre> <br><h1 style=";text-align:right;direction:rtl">  ุชุณุฑูุน ุงูุฃุฌูุฒุฉ </h1><br>  ุจุถุน ูููุงุช ุนู GPUs. <br><br>  ุชุณุชุฎุฏู ุนูููุฉ ุงูุชุนูู ุจุดูู ุทุจูุนู ุงูุชูุงุฒู ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช ุ ุญูุซ ุฃู ุจูุงุก ุงูุดุจูุงุช ุงูุนุตุจูุฉ ุงูุนูููุฉ ูุชุทูุจ ุญุณุงุจุงุช ุถุฎูุฉ ูุชุญููู ุงูุญู ุงูุฃูุซู. <br><br>  ููู ุจุงููุณุจุฉ ููุชุงุฆุฌ ุงููุชุงุฆุฌ ุ ูุฅู ุงูุชูุงุฒู ููุณ ูุงุถุญูุง ููุบุงูุฉ.  ุบุงูุจูุง ูุง ููููู ุชุณุฑูุน ุฅุฎุฑุงุฌ ุงูุดุจูุฉ ุงูุนุตุจูุฉ ุฅูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช ุ ูููู ุนููู ุงุฎุชูุงุฑ ุงููุนุฏุงุช ูุงุฎุชุจุงุฑูุง ุจุนูุงูุฉ ุ ูุฅุฌุฑุงุก ุชุญููู ุชููู ูุงูุชุตุงุฏู ูุชุนูู.  ุชุนุฏ ููุงุฒูุฉ ุงูุฃุฌูุฒุฉ ุฃูุซุฑ ูููุฉ ูู ูุนุงูุฌุฉ ุงูุฏููุนุฉ ูู ุงูุงุณุชูุชุงุฌุงุช "ุงููุณุชููุฉ" (ูุญุฏุงุช ุงูุชุฎุฒูู ุงูุถุฎูุฉ). <br><br>  ูุจู ุงูุงูุชูุงู ุฅูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช ุ ููุฑ ูู ูุชุทูุจุงุช ุงูุนูู ูู ุฎูุงู ุชุญููู ุฏููู ููุชูุงููู (ุงูููุฏูุฉ ูุงูุชุดุบูููุฉ ูุงููููุฉ) ูุชุญููู ุฃูุจุฑ ูุงุฆุฏุฉ (ุชูููู ุฒูู ุงููุตูู ุ ูุงุฑุชูุงุน ุงูุฅูุชุงุฌูุฉ). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar445928/">https://habr.com/ru/post/ar445928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar445918/index.html">20 ุนุงููุง ูู ุชุงุฌุฑ ุฑููุฑ ููุณุชุฑ: ููุงุจูุฉ ูุน ููุดุฆ ุงููุนุจุฉ</a></li>
<li><a href="../ar445920/index.html">ูุงูู: ููููุฉ ุงูุญุฏ ูู ุชุทููุฑ ุฏุงุฆุฑุฉ ุงูุฑูุงุจุฉ ุงูุฏุงุฎููุฉ ูู ูุฑู ูุจูุฑุฉ</a></li>
<li><a href="../ar445922/index.html">ููุงุฐุง ูุดุงูุฏุฉ ุงูุจุซ ุนุจุฑ ุงูุฅูุชุฑูุช ุฅุฐุง ููุช ุชุณุชุทูุน ูุฑุงุกุฉ ูุจุฑ</a></li>
<li><a href="../ar445924/index.html">ุงููููุฒ: ุนูุฏูุง ุชุตุจุญ ุงูุณุงุนุงุช ุงูุฐููุฉ ุบุฑูุจุฉ</a></li>
<li><a href="../ar445926/index.html">ูููู ุงูุจุฑูุงูุฌ ุงูุณุฑู UFO UFO ุฃูุถูุง ุจุงูุจุญุซ ุนู ุงูุซููุจ ูุงูุฃุจุนุงุฏ ุงูุฅุถุงููุฉ.</a></li>
<li><a href="../ar445932/index.html">ุฃูุงู ุชุทุจูู ุงูุนููู: ูุตุงุฆุญ ุนูููุฉ ููุทูุฑ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ</a></li>
<li><a href="../ar445936/index.html">ุชุทููุฑ ุงูุฅููุชุฑูููุงุช. ุญูู ูููุฑูููุชุฑููุฑ ุนูู ุงูุฃุตุงุจุน</a></li>
<li><a href="../ar445940/index.html">AMA ูุน Habr ุ ุงูุฅุตุฏุงุฑ 7.0. ุงูููููู ูุงููุนู ูุงูุฃุฎุจุงุฑ</a></li>
<li><a href="../ar445946/index.html">MWC: ุชุนูููุงุช ููุงุณุชุฎุฏุงู</a></li>
<li><a href="../ar445948/index.html">ุงููุฑุงุซุฉ ูู C ++: ูุจุชุฏุฆ ุ ูุชูุณุท โโุ ูุชูุฏู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>