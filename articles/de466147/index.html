<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚵 🧝🏾 💕 Reactive Data Display Manager. Einführung 🚩 👩🏻‍🤝‍👨🏼 ☕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dies ist der erste Teil einer Reihe von Artikeln zur RDDM- Bibliothek (ReactiveDataDisplayManager) . In diesem Artikel werde ich die häufigsten Proble...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reactive Data Display Manager. Einführung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/surfstudio/blog/466147/">  Dies ist der erste Teil einer Reihe von Artikeln zur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RDDM-</a> Bibliothek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">(ReactiveDataDisplayManager)</a> .  In diesem Artikel werde ich die häufigsten Probleme beschreiben, mit denen ich mich bei der Arbeit mit „normalen“ Tabellen befassen muss, sowie eine Beschreibung von RDDM geben. <br><br><img src="https://habrastorage.org/webt/ys/lo/ms/yslomsnycv9gjh_69ojwvxzxe14.png"><br><a name="habracut"></a><br><br><h3>  Problem 1. UITableViewDataSource </h3><br>  Vergessen Sie zunächst die Zuweisung von Verantwortlichkeiten, die Wiederverwendung und andere coole Wörter.  Schauen wir uns die übliche Arbeit mit Tabellen an: <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ ... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDelegate</span></span></span><span class="hljs-class"> </span></span>{ ... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDataSource</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre> <br>  Wir werden die häufigste Option analysieren.  Was müssen wir implementieren?  Richtig, <code>UITableViewDataSource</code> werden 3 <code>UITableViewDataSource</code> Methoden implementiert: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, numberOfRowsInSection section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numberOfSections</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span></code> </pre> <br>  Im <code>numberOfSection</code> wir uns nicht mit <code>numberOfSection</code> ( <code>numberOfSection</code> usw.) <code>numberOfSection</code> und die interessanteste betrachten - <code>func tableView(tableView: UITableView, indexPath: IndexPath)</code> <br><br>  Angenommen, wir möchten eine Tabelle mit Zellen mit einer Beschreibung der Produkte ausfüllen, dann sieht unsere Methode folgendermaßen aus: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> anyCell = tableView.dequeueReusableCell(withIdentifier: <span class="hljs-type"><span class="hljs-type">ProductCell</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = anyCell <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">ProductCell</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } cell.configure(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.products[indexPath.row]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell }</code> </pre> <br>  Ausgezeichnet, es ist nicht schwierig.  Angenommen, wir haben verschiedene Zelltypen, zum Beispiel drei: <br><br><ul><li>  Produkte </li><li>  Liste der Aktien; </li><li>  Werbung. </li></ul><br>  Zur Vereinfachung des Beispiels erhalten wir die Methode cell to <code>getCell</code> : <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> indexPath.row { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell: <span class="hljs-type"><span class="hljs-type">PromoCell</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.getCell() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } cell.configure(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.promo) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell: <span class="hljs-type"><span class="hljs-type">AdCell</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.getCell() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } cell.configure(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ad) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell: <span class="hljs-type"><span class="hljs-type">AdCell</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.getCell() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } cell.configure(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.products[indexPath.row - <span class="hljs-number"><span class="hljs-number">2</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell } }</code> </pre> <br>  Irgendwie viel Code.  Stellen Sie sich vor, wir möchten den Einstellungsbildschirm erstellen.  Was wird da sein? <br><br><ul><li>  Eine Zellenkappe mit einem Avatar; </li><li>  Eine Reihe von Zellen mit Übergängen "in der Tiefe"; </li><li>  Zellen mit Schaltern (z. B. Eingabe über PIN-Code aktivieren / deaktivieren); </li><li>  Zellen mit Informationen (z. B. eine Zelle, in der sich ein Telefon, eine E-Mail usw. befindet); </li><li>  Persönliche Angebote. </li></ul><br>  Außerdem ist die Reihenfolge festgelegt.  Eine großartige Methode wird sich herausstellen ... <br><br>  Und jetzt noch eine Situation - es gibt ein Eingabeformular.  Auf dem Eingabeformular eine Reihe identischer Zellen, von denen jede für ein bestimmtes Feld im Datenmodell verantwortlich ist.  Beispielsweise ist die Zelle zum Eingeben des Telefons für das Telefon usw. verantwortlich. <br>  Alles ist einfach, aber es gibt ein "ABER".  In diesem Fall müssen Sie noch verschiedene Fälle malen, da Sie die erforderlichen Felder aktualisieren müssen. <br><br>  Sie können weiterhin phantasieren und sich Backend Driven Design vorstellen, in dem wir 6 verschiedene Arten von Eingabefeldern erhalten. Je nach Status der Felder (Sichtbarkeit, Eingabetyp, Validierung, Standardwert usw.) ändern sich die Zellen so stark, dass sich ihre ändern kann nicht zu einer einzigen Schnittstelle führen.  In diesem Fall sieht diese Methode sehr unangenehm aus.  Auch wenn Sie die Konfiguration in verschiedene Methoden zerlegen. <br><br>  Stellen Sie sich danach vor, wie Ihr Code aussehen wird, wenn Sie während der Arbeit Zellen hinzufügen / entfernen möchten.  Es wird nicht sehr schön aussehen, da wir gezwungen sein werden, die Konsistenz der im <code>ViewController</code> gespeicherten <code>ViewController</code> und die Anzahl der Zellen unabhängig zu überwachen. <br><br>  Die Probleme: <br><br><ul><li>  Wenn es Zellen unterschiedlichen Typs gibt, wird der Code nudelartig. </li><li>  Es gibt viele Probleme bei der Behandlung von Ereignissen aus Zellen. </li><li>  Hässlicher Code für den Fall, dass Sie den Status der Tabelle ändern müssen. </li></ul><br><h3>  Problem 2. MindSet </h3><br>  Die Zeit für coole Worte ist noch nicht gekommen. <br>  Schauen wir uns an, wie die Anwendung funktioniert oder wie die Daten auf dem Bildschirm angezeigt werden.  Wir präsentieren diesen Prozess immer nacheinander.  Nun, mehr oder weniger: <br><br><ol><li>  Daten aus dem Netzwerk abrufen; </li><li>  Zu verarbeiten; </li><li>  Zeigen Sie diese Daten auf dem Bildschirm an. </li></ol><br>  Aber ist es wirklich so?  Nein!  Tatsächlich machen wir das: <br><br><ol><li>  Daten aus dem Netzwerk abrufen; </li><li>  Zu verarbeiten; </li><li>  Im ViewController-Modell speichern; </li><li>  Etwas bewirkt eine Bildschirmaktualisierung. </li><li>  Das gespeicherte Modell wird in Zellen konvertiert. </li><li>  Daten werden auf dem Bildschirm angezeigt. </li></ol><br>  Neben der Menge gibt es noch Unterschiede.  Erstens geben wir keine Daten mehr aus, sondern werden ausgegeben.  Zweitens gibt es eine logische Lücke im Datenverarbeitungsprozess, das Modell wird gespeichert und der Prozess endet dort.  Dann passiert etwas und ein anderer Prozess beginnt.  Daher fügen wir dem Bildschirm offensichtlich keine Elemente hinzu, sondern speichern sie (die übrigens auch voll sind) nur bei Bedarf. <br><br>  <code>UITableViewDelegate</code> Sie auch an <code>UITableViewDelegate</code> . Es enthält auch Methoden zum Bestimmen der <code>UITableViewDelegate</code> .  Normalerweise reicht die <code>automaticDimension</code> Abmessung aus, aber manchmal reicht dies nicht aus, und Sie müssen die Höhe selbst einstellen (z. B. bei Animationen oder für Überschriften). <br>  Dann teilen wir im Allgemeinen die Zelleneinstellungen, das Teil mit der Höhenkonfiguration ist in einer anderen Methode. <br><br>  Die Probleme: <br><br><ul><li>  Die explizite Verbindung zwischen der Datenverarbeitung und ihrer Anzeige auf der Benutzeroberfläche geht verloren. </li><li>  Die Zellenkonfiguration gliedert sich in verschiedene Teile. </li></ul><br><h3>  Idee </h3><br>  Die aufgeführten Probleme auf komplexen Bildschirmen verursachen Kopfschmerzen und ein scharfes Verlangen nach Tee. <br><br>  Erstens möchte ich nicht ständig Delegierungsmethoden implementieren.  Die naheliegende Lösung besteht darin, ein Objekt zu erstellen, das es implementiert.  Als nächstes machen wir so etwas wie: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> displayManager = <span class="hljs-type"><span class="hljs-type">DisplayManager</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.tableView)</code> </pre> <br>  Großartig.  Jetzt muss das Objekt mit beliebigen Zellen arbeiten können, während die Konfiguration dieser Zellen an einen anderen Ort verschoben werden muss. <br><br>  Wenn wir die Konfiguration in ein separates Objekt einfügen, kapseln wir die Konfiguration an einem Ort (es ist Zeit für intelligente Wörter).  An derselben Stelle können wir die Logik zum Formatieren von Daten herausnehmen (z. B. Ändern des Datumsformats, Verketten von Zeichenfolgen usw.).  Über dasselbe Objekt können wir Ereignisse in der Zelle abonnieren. <br><br>  In diesem Fall haben wir ein Objekt mit zwei verschiedenen Schnittstellen: <br><br><ol><li>  Die Schnittstelle zur Generierung von <code>UITableView</code> Instanzen ist für unseren DisplayManager vorgesehen. </li><li>  Initialisierungs-, Abonnement- und Konfigurationsoberfläche - für Presenter oder ViewController. </li></ol><br>  Wir nennen dieses Objekt einen Generator.  Dann ist unser Generator für die Tabelle eine Zelle und für alles andere eine Möglichkeit, Daten auf einer Benutzeroberfläche darzustellen und Ereignisse zu verarbeiten. <br><br>  Und da die Konfiguration jetzt vom Generator gekapselt wird und der Generator selbst eine Zelle ist, können wir viele Probleme lösen.  Einschließlich der oben aufgeführten. <br><br><h3>  Implementierung </h3><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableCellGenerator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> identifier: <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>.<span class="hljs-type"><span class="hljs-type">Type</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cellHeight: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> estimatedCellHeight: <span class="hljs-type"><span class="hljs-type">CGFloat?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tableView: UITableView, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerCell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView)</span></span></span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ViewType</span></span>: <span class="hljs-type"><span class="hljs-type">UIView</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: ViewType)</span></span></span></span> }</code> </pre> <br>  Mit solchen Implementierungen können wir die Standardimplementierung vornehmen: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableCellGenerator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Self</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tableView: UITableView, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = tableView.dequeueReusableCell(withIdentifier: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.identifier.nameOfClass, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Self</span></span>.<span class="hljs-type"><span class="hljs-type">ViewType</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.build(view: cell) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> ?? <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerCell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView)</span></span></span></span> { tableView.registerNib(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.identifier) } }&lt;source lang=<span class="hljs-string"><span class="hljs-string">"swift"</span></span>&gt;</code> </pre> <br>  Ich werde ein Beispiel für einen kleinen Generator geben: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FamilyCellGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cell: <span class="hljs-type"><span class="hljs-type">FamilyCell?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> family: <span class="hljs-type"><span class="hljs-type">Family?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> didTapPerson: ((<span class="hljs-type"><span class="hljs-type">Person</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)? <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(family: Family)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.family = family cell?.fill(with: family) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.family = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> cell?.showLoading() } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FamilyCellGenerator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableCellGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> identifier: <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>.<span class="hljs-type"><span class="hljs-type">Type</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">FamilyCell</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FamilyCellGenerator</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: FamilyCell)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.cell = view view.selectionStyle = .<span class="hljs-keyword"><span class="hljs-keyword">none</span></span> view.didTapPerson = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] person <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.didTapPerson?(person) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> family = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.family { view.fill(with: family) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { view.showLoading() } } }</code> </pre> <br>  Hier haben wir sowohl die Konfiguration als auch die Abonnements versteckt.  Bitte beachten Sie, dass wir jetzt einen Ort haben, an dem wir den Status kapseln können (da es unmöglich ist, den Status in der Zelle zu kapseln, da er von der Tabelle wiederverwendet wird).  Außerdem hatten sie die Möglichkeit, die Daten in der Zelle "on the fly" zu ändern. <br><br>  <code>self.cell = view</code> auf <code>self.cell = view</code> .  Wir haben uns an die Zelle erinnert und können jetzt die Daten aktualisieren, ohne diese Zelle neu zu laden.  Dies ist eine nützliche Funktion. <br><br>  Aber ich war abgelenkt.  Da jede Zelle durch einen Generator dargestellt werden kann, können wir die Benutzeroberfläche unseres DisplayManager etwas schöner gestalten. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataDisplayManager</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">CollectionType</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">CellGeneratorType</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">HeaderGeneratorType</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(collection: <span class="hljs-type"><span class="hljs-type">CollectionType</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forceRefill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSectionHeaderGenerator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generator: HeaderGeneratorType)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addCellGenerator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generator: CellGeneratorType)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addCellGenerators</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generators: [CellGeneratorType], after: CellGeneratorType)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addCellGenerator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generator: CellGeneratorType, after: CellGeneratorType)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addCellGenerators</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> generators: [CellGeneratorType])</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(generators: [CellGeneratorType])</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearHeaderGenerators</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearCellGenerators</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> }</code> </pre> <br>  Das ist eigentlich nicht alles.  Wir können Generatoren an den richtigen Stellen einfügen oder löschen. <br><br>  Übrigens kann das Einfügen einer Zelle nach einer bestimmten Zelle verdammt nützlich sein.  Insbesondere wenn wir die Daten nach und nach laden (z. B. hat der Benutzer die TIN eingegeben, haben wir die TIN-Informationen hochgeladen und angezeigt, indem wir nach dem TIN-Feld mehrere neue Zellen hinzugefügt haben). <br><br><h3>  Zusammenfassung </h3><br>  Wie die Zellarbeit jetzt aussehen wird: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: [Products])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gens = data.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> { <span class="hljs-type"><span class="hljs-type">ProductCellGenerator</span></span>($<span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ddm.addGenerators(gens) } }</code> </pre><br>  Oder hier: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fields: [Field])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gens = fields.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> { field <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> field.type { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .phone: <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gen = <span class="hljs-type"><span class="hljs-type">PhoneCellGenerator</span></span>(item) gen.didUpdate = { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updatePhone($<span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gen <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .date: <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gen = <span class="hljs-type"><span class="hljs-type">DateInputCellGenerator</span></span>(item) gen.didTap = { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.showPicker() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gen <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .dropdown: <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gen = <span class="hljs-type"><span class="hljs-type">DropdownCellGenerator</span></span>(item) gen.didTap = { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.showDropdown(item) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gen } } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> splitter = <span class="hljs-type"><span class="hljs-type">SplitterGenerator</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ddm.addGenerator(splitter) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ddm.addGenerators(gens) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ddm.addGenerator(splitter) } }</code> </pre> <br>  Wir können die Reihenfolge des Hinzufügens von Elementen steuern und gleichzeitig geht die Verbindung zwischen der Datenverarbeitung und dem Hinzufügen zur Benutzeroberfläche nicht verloren.  In einfachen Fällen haben wir also einfachen Code.  In schwierigen Fällen verwandelt sich der Code nicht in Pasta und sieht gleichzeitig passabel aus.  Eine deklarative Schnittstelle für die Arbeit mit Tabellen wurde angezeigt, und jetzt kapseln wir die Konfiguration von Zellen, wodurch wir Zellen zusammen mit Konfigurationen zwischen verschiedenen Bildschirmen wiederverwenden können. <br><br>  Vorteile der Verwendung von RDDM: <br><br><ul><li>  Kapselung der Zellkonfiguration; </li><li>  Reduzieren der Codeduplizierung durch Einkapseln von Arbeiten aus Sammlungen in den Adapter; </li><li>  Wählen Sie ein Adapterobjekt aus, das die spezifische Logik der Arbeit mit Sammlungen kapselt. </li><li>  Der Code wird offensichtlicher und leichter zu lesen. </li><li>  Die Menge an Code, die geschrieben werden muss, um eine Tabelle hinzuzufügen, wird reduziert. </li><li>  Der Prozess der Verarbeitung von Ereignissen aus Zellen wird vereinfacht. </li></ul><br>  Quellen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Vielen Dank für Ihre Aufmerksamkeit! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de466147/">https://habr.com/ru/post/de466147/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de466129/index.html">Effizienz des Transports mit Benzin, Batterien und Wasserstoff</a></li>
<li><a href="../de466135/index.html">Megapack: Wie Factorio-Entwickler es geschafft haben, das 200-Spieler-Multiplayer-Problem zu lösen</a></li>
<li><a href="../de466137/index.html">System.IO. Pipelines - ein wenig bekanntes Tool für Liebhaber hoher Leistung</a></li>
<li><a href="../de466139/index.html">Angewandte Technologie auf den Ruinen des Blockchain-Fiebers oder den praktischen Vorteilen der Ressourcenzuweisung</a></li>
<li><a href="../de466143/index.html">Wie haben wir Kartoncode oder die Scratch-Version des Brettspiels Golem Battle erstellt?</a></li>
<li><a href="../de466149/index.html">Erstellen eines Konnektorsymbols mit „dynamischem“ Text in OrCAD</a></li>
<li><a href="../de466151/index.html">Untersuchung: seltsame Programme im Register der inländischen Software</a></li>
<li><a href="../de466153/index.html">Erstellen eines Missionsdesign-Dokuments für ein narratives Spiel am Beispiel von Last of Us</a></li>
<li><a href="../de466155/index.html">Architektur und Funktionen des Tarantool-Datengitters</a></li>
<li><a href="../de466157/index.html">Blockchain: Was sollen wir PoC bauen?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>