<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèïÔ∏è üí¥ üóØÔ∏è Was ist, wenn es keinen statischen Analysator f√ºr Ihre Lieblingssprache gibt? üï∞Ô∏è üëÇüèª üßíüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nun, wenn Ihre Lieblingssprache Russisch, Englisch usw. bedeutet, dann ist dies in einem anderen Hub . Und wenn die Programmier- oder Auszeichnungsspr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Was ist, wenn es keinen statischen Analysator f√ºr Ihre Lieblingssprache gibt?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474920/"><p>  Nun, wenn Ihre Lieblingssprache Russisch, Englisch usw. bedeutet, dann ist dies in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einem anderen Hub</a> .  Und wenn die Programmier- oder Auszeichnungssprache, dann schreiben Sie den Analysator nat√ºrlich selbst!  Auf den ersten Blick ist es sehr schwierig, aber zum Gl√ºck gibt es fertige mehrsprachige Tools, mit denen sich die Unterst√ºtzung f√ºr eine neue Sprache relativ einfach hinzuf√ºgen l√§sst.  Heute werde ich zeigen, wie man mit relativ wenig Zeit die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Modelica-</a> Sprachunterst√ºtzung zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PMD-Analyser</a> hinzuf√ºgt. </p><br><p> Wissen Sie √ºbrigens, was die Qualit√§t der Codebasis, die aus einer Folge von idealen Pull-Anforderungen erhalten wird, beeintr√§chtigen kann?  Die Tatsache, dass Programmierer von Drittanbietern anstelle einer kompetenten Abstraktion Teile des vorhandenen Projektcodes in ihre Patches kopierten.  Sie m√ºssen zugeben, dass es bis zu einem gewissen Grad noch schwieriger ist, einen solchen banalen Code zu finden als einen Code mit schlechter Qualit√§t. Er ist von hoher Qualit√§t und wird <strong>bereits</strong> sorgf√§ltig getestet. Daher reicht die lokale √úberpr√ºfung hier nicht aus. Sie m√ºssen die gesamte Codebasis im Auge behalten, aber dies ist f√ºr eine Person nicht einfach Das Hinzuf√ºgen der vollst√§ndigen Unterst√ºtzung von Modelica (ohne das Erstellen spezifischer Regeln) zum Status "Primitive √úberpr√ºfungen ausf√ºhren k√∂nnen" dauerte ungef√§hr eine Woche. Dann kann an einem Tag h√§ufig nur die Unterst√ºtzung f√ºr Copy-Paste-Detektoren hinzugef√ºgt werden! </p><a name="habracut"></a><br><h2 id="kakaya-eschyo-modelica">  Was ist Modelica noch? </h2><br><p> Modelica ist, wie der Name schon sagt, eine Sprache zum Schreiben von Modellen physikalischer Systeme.  Tats√§chlich nicht nur physikalisch: Es ist m√∂glich, chemische Prozesse, das quantitative Verhalten von Tierpopulationen usw. zu beschreiben - das wird durch Differentialgleichungssysteme der Form <code>der(X) = f(X)</code> , wobei <code>X</code> der Vektor von Unbekannten ist.  Imperative Codeteile werden ebenfalls unterst√ºtzt.  Partielle Differentialgleichungen werden nicht ausdr√ºcklich unterst√ºtzt, aber es ist m√∂glich, den Untersuchungsbereich in Teile zu unterteilen (wie wir es wahrscheinlich in einer allgemeinen Sprache getan h√§tten) und dann die Gleichungen f√ºr jedes Element aufzuschreiben, wodurch das Problem auf das vorherige reduziert wird.  Der Trick von Modelka ist, dass die L√∂sung f√ºr diesen <code>der(X) = f(X)</code> beim Compiler liegt: Sie k√∂nnen einfach den L√∂ser <strong>in den Einstellungen</strong> √§ndern, die Gleichung muss nicht linear sein usw. Kurz gesagt, es gibt einige Pluspunkte (ich schrieb die Formel aus dem Lehrbuch - und es hat funktioniert) und die Nachteile (mit mehr Abstraktion bekommen wir weniger Kontrolle).  Eine Einf√ºhrung in Modelika ist das Thema eines separaten Artikels (der bereits mehrmals auf Habr√© erschienen ist) und sogar eines ganzen Zyklus. Heute interessiert es mich als offenen und mit mehreren Implementierungen, aber leider immer noch ein feuchter Standard. </p><br><p>  Dar√ºber hinaus verf√ºgt Modelika einerseits √ºber eine statische Typisierung (mit deren Hilfe wir einige aussagekr√§ftige Analysen schneller erstellen k√∂nnen), andererseits muss der Compiler beim Instanziieren eines Modells nicht die gesamte Bibliothek vollst√§ndig √ºberpr√ºfen (daher ist ein statischer Analysator sehr n√ºtzlich, um "Sleeping" zu erfassen). Bugs).  Schlie√ülich gibt es im Gegensatz zu einigen C ++, f√ºr die es eine Wolke von statischen Analysatoren und Compilern mit sch√∂nen, <del>  und was am wichtigsten ist, siehe C ++ - Vorlagen </del>  Fehlerdiagnose, Compiler Modelle generieren immer noch regelm√§√üig einen internen Compilerfehler, was bedeutet, dass der Benutzer auch mit einem relativ einfachen Analyseger√§t noch gen√ºgend Platz hat, um zu helfen. </p><br><h2 id="a-chto-za-pmd">  Was ist PMD? </h2><br><p>  Ich werde antworten <del>  Lied </del>  mit dem Fahrrad.  Einmal wollte ich eine kleine Pull-Anfrage in die Entwicklungsumgebung f√ºr OpenModelica stellen.  Als ich sah, wie das Speichern des Modells in einem anderen Teil des Codes verarbeitet wird, bemerkte ich ein kleines und nicht sehr klares St√ºck aus vier Codezeilen, das eine Art Invariante unterst√ºtzte.  Ich verstehe nicht, mit welchen Editor-Interna er interagiert, erkenne aber, dass meine Aufgabe aus der Sicht dieses Code-Teils v√∂llig identisch ist. Ich habe sie einfach in eine Funktion umgewandelt, damit ich sie wiederverwenden und nicht zerst√∂ren kann.  Menteiner meinte, es ist wunderbar, diesen Code erst dann durch einen Funktionsaufruf an den verbleibenden zwanzig Stellen zu ersetzen. Ich habe beschlossen, mich noch nicht einzumischen, und habe nur eine weitere Kopie angefertigt mit dem aktuellen Patch.  Googeln fand ich Copy-Paste Detector (CPD) - Teil des statischen PMD-Analysators - der noch mehr Sprachen als der Analysator selbst unterst√ºtzt.  Nachdem ich es auf die OMEdit-Codebasis gesetzt hatte, erwartete ich, diese zwei Dutzend St√ºcke von vier Zeilen zu sehen.  Ich habe sie nur nicht gesehen (jeder von ihnen hat die Schwelle f√ºr die Anzahl der Token einfach nicht √ºberschritten), aber ich habe zum Beispiel die Wiederholung von fast f√ºnfzig Zeilen C ++ - Code gesehen.  Wie ich bereits sagte, ist es unwahrscheinlich, dass der Menter einfach ein riesiges St√ºck aus einer anderen Akte kopiert hat.  In der PR konnte er dies jedoch leicht √ºbersehen - denn der Code erf√ºllte per Definition bereits alle Standards des Projekts!  Als ich die Beobachtung mit dem Menter teilte, stimmte er zu, dass es notwendig sein w√ºrde, im Rahmen einer separaten Aufgabe aufzur√§umen. </p><br><p>  Dementsprechend ist der Program Mistake Detector (PMD) ein leicht erweiterbarer statischer Analysator.  Vielleicht berechnet er nicht die Menge der Werte, die eine Variable annehmen kann (obwohl wer wei√ü ...), aber um Regeln hinzuzuf√ºgen, m√ºssen Sie nicht einmal Java kennen und den Code irgendwie √§ndern!  Tatsache ist, dass er als erstes AST-Dateien mit Quellcodes erstellt, was nicht √ºberraschend ist.  Und wie sieht der Quell-Parsing-Baum aus?  Zum XML-Parsing-Baum!  Sie k√∂nnen die Regeln also einfach als XPath-Anforderungen beschreiben - f√ºr die sie zutreffen, geben wir eine Warnung aus.  Sie haben sogar einen grafischen Debugger f√ºr die Regeln!  Nat√ºrlich k√∂nnen komplexere Regeln als Besucher des AST direkt in Java geschrieben werden. </p><br><p>  <em><strong>Konsequenz</strong></em> : PMD kann nicht nur f√ºr die strengen und universellen Regeln verwendet werden, die strenge Java-Programmierer f√ºr den Code des Analysators festgelegt haben, sondern auch f√ºr den lokalen Codierungsstil - selbst wenn Sie Ihre eigene lokale ruleset.xml in jedes Repository √ºbertragen! </p><br><h2 id="uroven-1-nahodim-kopipast-avtomatizirovanno">  Stufe 1: Kopieren-Einf√ºgen automatisch finden </h2><br><p>  Im Prinzip ist das Hinzuf√ºgen einer Unterst√ºtzung f√ºr eine neue Sprache in CPD oft sehr einfach.  Ich sehe keinen Sinn darin, die Dokumentation noch einmal ‚Äûwie es geht‚Äú zu erz√§hlen - sie ist sehr klar, strukturiert und schrittweise.  Um so etwas noch einmal zu erz√§hlen - spielen Sie nur in einem besch√§digten Telefon.  Ich beschreibe besser, was dich erwartet <em>(TLDR: ist okay)</em> : </p><br><ul><li>  Der Analysator (sowohl PMD als auch CPD) wird auf dem Github im PMD / PMD- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository entwickelt</a> </li><li>  Der Visual Rule Debugger wurde in ein separates <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PMD / PMD-Designer-</a> Repository verschoben.  Bitte beachten Sie, dass der fertige jar-Spitzname automatisch in die <em>PMD-Bin√§rdistribution</em> eingebettet wird, die Gradle im vorherigen Repository f√ºr Sie sammelt. Sie m√ºssen hierf√ºr nicht speziell <code>pmd-designer</code> klonen. </li><li>  Das Projekt hat eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Entwicklerdokumentation</a> .  Der, den ich las, war sehr detailliert.  Stimmt, ein bisschen veraltet, aber das wird von der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zweiten Pull-Anfrage behandelt</a> :) </li></ul><br><p>  Ich warne Sie, dass ich auf Ubuntu entwickle.  Unter Windows sollte es auch einwandfrei funktionieren - sowohl in Bezug auf die Qualit√§t als auch im Sinne einer etwas anderen Art, Tools zu starten. </p><br><p>  Um CPD eine neue Sprache hinzuzuf√ºgen, m√ºssen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nur</a> ... </p><br><ul><li>  <strong>ACHTUNG:</strong> Wenn Sie die vollst√§ndige Unterst√ºtzung f√ºr PMD vor der Ver√∂ffentlichung von PMD 7 w√ºnschen, sollten Sie direkt zu Level 2 √ºbergehen, da die normale Unterst√ºtzung f√ºr den einfachen Weg durch die fertige Antlr-Grammatik Ger√ºchten zufolge in Version 7 angezeigt wird und ein bisschen ...) </li><li>  Gabeln Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PMD / PMD-Repository</a> . </li><li>  Suchen Sie in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">antlr / grammars-v4</a> eine fertige Grammatik f√ºr Ihre Sprache - nat√ºrlich m√ºssen Sie sie selbst schreiben, wenn die Sprache intern ist, aber f√ºr Modelika wurde sie beispielsweise gefunden.  Hier m√ºssen Sie nat√ºrlich die Formalit√§ten mit Lizenzen einhalten - ich bin kein Anwalt, aber ich muss zumindest die Quelle angeben, von der ich kopiert habe. </li><li>  Danach m√ºssen Sie das Modul <code>pmd-&lt;your language name&gt;</code> erstellen, es zu Gradle hinzuf√ºgen und die Grammatikdatei dort <code>pmd-&lt;your language name&gt;</code> .  Nachdem Sie zwei Seiten der stressfreien Dokumentation gelesen haben, wiederholen Sie das Assembler-Skript aus dem Modul f√ºr Go, ein paar Klassen zum Laden des Moduls durch Reflektion. <em>Nun, es gibt noch eine Kleinigkeit ...</em> </li><li>  Korrigieren Sie die Referenzausgabe in einem der Tests, da CPD jetzt eine weitere Sprache unterst√ºtzt!  Wie findest du diesen Test?  Ganz einfach: <em>Er m√∂chte den Build abbrechen</em> . </li><li>  GEWINN!  Es ist ganz einfach, <em>vorausgesetzt, es gibt eine fertige Grammatik</em> </li></ul><br><p>  Jetzt k√∂nnen Sie im Stammverzeichnis des pmd-Repositorys <code>./mvnw clean verify</code> , w√§hrend Sie in <code>pmd-dist/target</code> unter anderem die Bin√§rdistribution in Form eines Zip-Archivs erhalten, das Sie mit ./bin/run entpacken und ausf√ºhren <code>./bin/run.sh cpd --minimum-tokens 100 --files /path/to/source/dir --language &lt;your language name&gt;</code> aus dem entpackten Verzeichnis.  Grunds√§tzlich k√∂nnen Sie <code>../mvnw clean verify</code> in Ihrem neuen Modul <code>../mvnw clean verify</code> , was die Assemblierung drastisch beschleunigt. Anschlie√üend m√ºssen Sie jedoch den zusammengesetzten JAR-Kurznamen korrekt in die entpackte <code>../mvnw clean verify</code> (z. B. einmal zusammengesetzt, nachdem Sie ein neues Modul registriert haben). </p><br><h2 id="uroven-2-nahodim-oshibki-i-narusheniya-style-guide">  Stufe 2: Auffinden von Fehlern und Verst√∂√üen gegen den Styleguide </h2><br><p>  Wie gesagt, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in PMD 7</a> wird volle Unterst√ºtzung f√ºr Antlr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">versprochen</a> .  Wenn Sie, wie ich, nicht auf die Ver√∂ffentlichung des Meeres warten m√∂chten, m√ºssen Sie irgendwo eine Beschreibung der Grammatik der Sprache im JJTree-Format abrufen.  Vielleicht k√∂nnen Sie die Unterst√ºtzung eines beliebigen Parsers selbst <code>modelica.g4</code> - die Dokumentation besagt, dass dies m√∂glich ist, <em>aber sie sagen nicht, wie genau</em> ... Ich habe nur <code>modelica.g4</code> aus demselben Repository mit Grammatiken f√ºr Anltr als Basis genommen und es manuell in JJTree neu erstellt.  Wenn sich herausstellt, dass die Grammatik eine Verarbeitung der vorhandenen ist, geben Sie die Quelle an, √ºberpr√ºfen Sie die Einhaltung der Lizenzen und.  etc. </p><br><p>  √úbrigens ist es unwahrscheinlich, dass eine Person, die sich mit Parsergeneratoren aller Art auskennt, √ºberrascht.  Vorher habe ich es ernsthaft benutzt, es sei denn, ich habe selbst Stammkunden und Parser-Kombinatoren auf Scala geschrieben.  Daher hat mich das Offensichtliche anfangs tats√§chlich traurig gemacht: AST kommt nat√ºrlich von <code>modelica.g4</code> , aber es sieht nicht sehr klar und ‚Äûbrauchbar‚Äú aus: Es gibt Wolken von zus√§tzlichen Knoten darin, und wenn Sie nicht auf die <strong>Token</strong> schauen, sondern nur auf Knoten ist nicht immer klar, wo zum Beispiel der Zweig <code>then</code> endet und <code>else</code> beginnt. </p><br><p>  Auch hier werde ich die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation zu JJTree</a> und ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gutes Tutorial</a> nicht <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nacherz√§hlen</a> - diesmal jedoch nicht, weil das Original mit Details und Klarheit gl√§nzt, sondern weil ich es selbst nicht vollst√§ndig herausgefunden habe, sondern weil die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> falsch, aber mit Zuversicht erneut √ºbertragen wurde. offensichtlich schlimmer als kein Nacherz√§hlen.  Ich hinterlasse lieber einen kleinen Hinweis, den ich auf dem Weg herausgefunden habe: </p><br><ul><li>  Erstens setzt der <strong>JavaCC-Parser-Beschreibungscode Java-Einf√ºgungen voraus, die in den generierten Parser eingeschrieben werden</strong> </li><li>  Seien Sie nicht durch die Tatsache verwirrt, dass beim Erstellen eines AST Syntax wie <code>[ Expression() ]</code> optional bedeutet und im Kontext der Beschreibung von Tokens ein Zeichen ausgew√§hlt wird, wie in einem regul√§ren Ausdruck.  Soweit ich die Erkl√§rung der PMD-Entwickler verstehe, sind dies √§hnliche Konstruktionen, die eine so unterschiedliche Bedeutung haben - Verm√§chtnis, Sir ... </li><li>  F√ºr den <code>StoredDefinition</code> (in meinem Fall <code>StoredDefinition</code> ) m√ºssen Sie den Typ anstelle von <code>void</code> angeben (d. H. <code>ASTStoredDefiniton</code> ). </li><li>  Wenn Sie die Syntax <code>#void</code> nach dem Knotennamen verwenden, k√∂nnen Sie sie vor dem analysierten Baum verbergen (das hei√üt, es <code>#void</code> sich nur darauf aus, welche Quelle die richtige ist und welche nicht und wie die anderen Knoten verschachtelt werden). </li><li>  Mit einer Konstruktion des Formulars <code>void SimpleExpression() #SimpleExpression(&gt;1)</code> wir sagen, dass der Knoten im resultierenden AST angezeigt werden muss, wenn er mehr als einen Nachkommen hat.  Dies ist sehr praktisch, wenn Ausdr√ºcke mit vielen Operatoren mit unterschiedlichen Priorit√§ten beschrieben werden: Das hei√üt, aus Sicht des Parsers ist die einsame Konstante <code>1</code> so etwas wie <code>LogicExpression(AdditiveExpression(MultiplicativeExperssion(Constant(1))))</code> - <em>geben Sie alle n Ebenen der Operationspriorit√§ten ein</em> - aber Der Code des Analysators erh√§lt nur die <code>Constant(1)</code> </li><li>  Der Knoten verf√ºgt √ºber ein Standardvariablen- <code>image</code> (siehe <code>getImage</code> , <code>setImage</code> ), das normalerweise das "Wesentliche" dieses Knotens <code>setImage</code> : F√ºr einen Knoten, der dem Namen einer lokalen Variablen entspricht, ist es logisch, das √ºbereinstimmende Token mit dem Bezeichner in <code>image</code> zu kopieren (standardm√§√üig alle Token von B√§ume werden weggeworfen, daher lohnt es sich, die darin enthaltene Bedeutung zu kopieren, wenn es sich um eine Variable handelt und nicht nur um Stichw√∂rter.) </li><li>  <strong>LOOKAHEAD</strong> - nun, dies ist ein separates Lied, dem sogar ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">separates Kapitel</a> in der Dokumentation gewidmet ist <br><ul><li>  Grob gesagt k√∂nnen Sie in JavaCC einen Knoten nicht zur√ºckwerfen und versuchen, ihn anders zu analysieren. Sie k√∂nnen jedoch im Voraus nach vorne schauen und entscheiden, ob Sie ihn verwenden m√∂chten oder nicht </li><li>  im einfachsten Fall, wenn eine JavaCC-Warnung angezeigt wird, <del>  Sie sagen nur in der Kopfzeile <code>LOOKAHEAD = n</code> </del>  und es treten mysteri√∂se Parsing-Fehler auf, da im Allgemeinen anscheinend nicht alle Probleme gel√∂st werden k√∂nnen (abgesehen davon, dass Sie durch das Setzen einiger Milliarden Token eine Vorschau von allem erhalten, aber nicht die Tatsache, dass dies so funktioniert). .) </li><li>  Vor dem Namen des eingebetteten Knotens k√∂nnen Sie explizit angeben, anhand wie vieler Token Sie hier definitiv die endg√ºltige Entscheidung treffen k√∂nnen </li><li>  Wenn es im allgemeinen Fall keine <strong>feste</strong> Anzahl von Token gibt, k√∂nnen Sie sagen: "Gehen Sie hierher, wenn es uns zuvor gelungen ist, ab diesem Punkt ein solches Pr√§fix zu finden - und dann die √ºbliche Beschreibung des Teilbaums." </li><li>  Vorsicht: Im Allgemeinen kann JavaCC die Korrektheit der <code>LOOKAHEAD</code> Direktiven nicht √ºberpr√ºfen - es vertraut Ihnen, also finden Sie zumindest den mathematischen Beweis heraus, warum ein solcher Lookahead ausreicht ... </li></ul></li></ul><br><p>  Nachdem Sie nun eine Beschreibung der Grammatik der Sprache im JJTree-Format haben, k√∂nnen Sie mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesen einfachen 14 Schritten</a> die Sprachunterst√ºtzung hinzuf√ºgen.  Die meisten von ihnen haben die Form "Eine Klasse √§hnlich der Implementierung f√ºr Java oder VM erstellen, aber angepasst".  Ich stelle nur typische Funktionen fest. Einige davon werden in der Hauptdokumentation angezeigt, wenn sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">meine Anforderung zum Abrufen</a> der Dokumentation akzeptieren: </p><br><ul><li>  Wenn Sie das Entfernen aller generierten Dateien im Assemblerskript <code>alljavacc.xml</code> (das sich in Ihrem neuen Modul befindet) <code>alljavacc.xml</code> , k√∂nnen Sie diese von <code>target/generated-sources</code> in den <code>alljavacc.xml</code> √ºbertragen.  Aber besser nicht.  H√∂chstwahrscheinlich wird nur ein kleiner Teil ge√§ndert, daher sollten Sie sich besser nur um das L√∂schen einiger weniger k√ºmmern: Sie mussten die Standardimplementierung √§ndern, in den Quellbaum kopieren, der Liste der gel√∂schten Dateien hinzuf√ºgen, <strong>diese Datei neu</strong> erstellen - und jetzt verwalten Sie die Datei - <strong>speziell diese Datei</strong> .  Andernfalls wird es schwierig sein, herauszufinden, was genau ge√§ndert wurde, und die Unterst√ºtzung kann kaum als angenehm bezeichnet werden. </li><li>  Nachdem Sie den PMD-Hauptmodus implementiert haben, k√∂nnen Sie Ihrem JJTree-Parser auf einfache Weise auch eine Bindung f√ºr CPD anh√§ngen, √§hnlich wie bei Java oder einer anderen verf√ºgbaren Implementierung </li><li>  Denken Sie daran, eine Methode zu implementieren, die den Hostnamen f√ºr XPath-Abfragen zur√ºckgibt.  In der Standardimplementierung wird entweder eine unendliche Rekursion erhalten (der Name des Knotens steht √ºber <code>toString</code> und umgekehrt) oder es ist im Allgemeinen auch nicht m√∂glich, den Baum in PMD Designer zu betrachten und die Grammatik ohne diesen zu debuggen </li><li>  Ein Teil der Komponentenregistrierungen erfolgt durch Hinzuf√ºgen von Textdateien von vollst√§ndig qualifizierten Eintrittspunkten f√ºr Klassennamen zu <code>META-INF/services</code> </li><li>  Was in den Regeln deklarativ beschrieben werden kann (z. B. eine detaillierte Beschreibung der Pr√ºfung und Beispiele f√ºr Fehler), wird nicht im Code, sondern in der <code>category/&lt;language name&gt;/&lt;ruleset&gt;.xml</code> In jedem Fall m√ºssen Sie Ihre Regeln dort registrieren </li><li>  ... aber bei der Implementierung der Tests wird anscheinend ein gewisser, m√∂glicherweise selbst entwickelter Mechanismus zur automatischen Erkennung aktiv verwendet <br><ul><li>  Wenn Ihnen gesagt wird, dass Sie "f√ºr jede Version der Sprache einen einfachen Test hinzuf√ºgen" - besser gesagt, nicht streiten, sagen sie "Ich brauche es nicht, es funktioniert so" - ist dies m√∂glicherweise der automatische Erkennungsmechanismus </li><li>  Wenn Sie einen Test f√ºr eine bestimmte Regel mit einem Klassenk√∂rper sehen, der nur einen Kommentar enth√§lt, <code>// no additional unit tests</code> , dann sind dies keine Tests, sie liegen einfach in den Ressourcen in Form einer XML-Beschreibung der Eingabedaten und der erwarteten Analysereaktionen, und zwar sofort: einige richtige und einige falsche Beispiele. </li></ul></li></ul><br><h2 id="malenkiy-no-vazhnyy-kvest-dopili-pmd-designer">  Eine kleine, aber wichtige Aufgabe: Beende den PMD Designer </h2><br><p>  Vielleicht k√∂nnen Sie alles ohne Visualizer debuggen.  Aber warum?  Erstens ist es sehr einfach zu beenden.  Zweitens wird es Ihren Benutzern, die mit Java nicht vertraut sind, sehr helfen: Sie sind einfach und unkompliziert (wenn dies √ºberhaupt f√ºr XPath gilt) oder zumindest ohne Neukompilierung k√∂nnen PMD einfache Muster beschreiben, die ihnen nicht gefallen (im einfachsten Fall) - Ein Styleguide wie ‚ÄûDer Name eines Modellpakets beginnt immer mit einem Kleinbuchstaben p‚Äú). </p><br><p>  Im Gegensatz zu anderen Fehlern, die sofort sichtbar sind, sind Probleme mit PMD Designer ziemlich heimt√ºckisch: Es scheint, dass Sie bereits verstanden haben, dass die Java-Inschrift auf der rechten Seite des Men√ºs keine Schaltfl√§che ist, sondern eine Dropdown-Liste der O_o-Sprachauswahl, in der sie bereits angezeigt wurde Modelica, weil im Klassenpfad ein neues Modul mit der Registrierung von Einstiegspunkten erschienen ist.  Aber hier w√§hlen Sie Ihre Sprache, laden eine Testdatei herunter und sehen AST.  Und es scheint ein Sieg zu sein, aber es ist irgendwie schwarz und wei√ü, und der hervorgehobene Teilbaum k√∂nnte im Text hervorgehoben werden - obwohl nein, das Highlight ist da, aber es wird schief aktualisiert - und doch, wie haben sie nicht geraten, die gefundenen √úbereinstimmungen mit XPath hervorzuheben ... Sie sch√§tzen den Arbeitsaufwand bereits ein und √ºberlegen sich, ob Sie die n√§chste Pull-Anforderung durchf√ºhren m√∂chten. Dann entscheiden Sie sich jedoch versehentlich, die Sprache auf Java umzustellen und den Quellcode des PMD selbst herunterzuladen ... Oh!  Es ist farbig! .. Und das Teilbaum-Highlight funktioniert!  √Ñh ... und es stellt sich heraus, dass es normalerweise die gefundenen √úbereinstimmungen hervorhebt und Textteile in das Feld rechts von der Anforderung schreibt ... Wenn beim Rendern der Benutzeroberfl√§che eine Ausnahme im JavaFX-Code auftritt, wird das Rendern unterbrochen, aber nicht an die Konsole gedruckt ... </p><br><p>  Im Allgemeinen m√ºssen Sie nur eine ma-a-scarlet-Klasse hinzuf√ºgen, um die auf regul√§ren Ausdr√ºcken basierende Syntax hervorzuheben.  In meinem Fall war es <code>net.sourceforge.pmd.util.fxdesigner.util.codearea.syntaxhighlighting.ModelicaSyntaxHighlighter</code> , das in der <code>AvailableSyntaxHighlighters</code> Klasse registriert werden muss.  Beachten Sie, dass beide √Ñnderungen im <code>pmd-designer</code> Repository vorgenommen werden, dessen Assembly-Artefakt in Ihre Bin√§rdistribution eingef√ºgt werden muss. </p><br><p>  Am Ende sieht es ungef√§hr so ‚Äã‚Äãaus (GIF aus README im PMD Designer-Repository): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/289/e3e/92b/289e3e92b353b29c696ed466434307ed.gif" alt="PMD Designer bei der Arbeit"></p><br><h2 id="promezhutochnyy-itog">  Zwischensumme </h2><br><p>  Wenn Sie alle diese Levels abgeschlossen haben, haben Sie jetzt: </p><br><ul><li>  Kopier- und Einf√ºgedetektor </li><li>  Regeln-Engine </li><li>  Visualizer zum Debuggen und Analysieren von AST (wie wir bereits gesehen haben, sind nicht alle Grammatiken einer Sprache gleich n√ºtzlich!) </li><li>  Derselbe Visualizer zum Debuggen von XPath-Regeln, den Ihre Benutzer schreiben k√∂nnen, ohne PMD neu zu kompilieren, und mit allgemeinen Java-Kenntnissen (XPath ist nat√ºrlich auch nicht BASIC, aber es ist mindestens eine Standard- und keine lokale Abfragesprache). </li></ul><br><p>  Ich hoffe, Sie haben auch Verst√§ndnis daf√ºr, dass die Grammatik jetzt eine stabile API f√ºr Ihre Implementierung der Sprachunterst√ºtzung ist - √§ndern Sie sie nicht (oder vielmehr die darin beschriebene Funktion der Konvertierung der Quelle in AST), es sei denn, dies ist absolut notwendig, und wenn Sie sie ge√§ndert haben, benachrichtigen Sie sie als brechende √Ñnderung. und dann werden die Benutzer ver√§rgert sein: H√∂chstwahrscheinlich werden nicht alle Tests f√ºr ihre Regeln schreiben, aber es ist sehr traurig, wenn die Regeln den Code √ºberpr√ºft und dann ohne Vorwarnung gestoppt haben - fast wie ein Backup, das pl√∂tzlich kaputt gegangen ist und vor einem Jahr ... </p><br><p>  Die Geschichte endet nicht dort: Zumindest m√ºssen einige n√ºtzliche Regeln geschrieben werden. </p><br><p>  Das ist aber noch nicht alles: PMD unterst√ºtzt nativ G√ºltigkeitsbereiche und Deklarationen.  Jedem AST-Knoten ist ein Bereich zugeordnet: der K√∂rper der Klasse, die Funktion, die Schleife ... Im schlimmsten Fall die gesamte Datei!  Und in jedem Bereich gibt es eine Liste von Definitionen (Deklarationen), die direkt enthalten sind.  Wie in anderen F√§llen wird vorgeschlagen, Modellika analog zu anderen Sprachen zu implementieren (aber zum Zeitpunkt des Schreibens ist die Logik in meiner Pull-Anfrage, ganz offen gesagt, roh).   scopes  declarations    visitor,  -  <code>ScopeAndDeclarationFinder</code> ,           ‚Äî  ,    ,  ,  - ,  read-only    AST.        ,    . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelicaHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractLanguageVersionHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @Override public VisitorStarter getSymbolFacade() { return new VisitorStarter() { @Override public void start(Node rootNode) { new SymbolFacade().initializeWith((ASTStoredDefinition) rootNode); } }; } }</span></span></code> </pre> <br><h2 id="vyvod">  </h2><br><p>   PMD     .  ,     ¬´¬ª  Clang Static Analyzer   ,           .      ,      CPD (   ),         . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de474920/">https://habr.com/ru/post/de474920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de474906/index.html">Xamarin.Forms - Dekorative QRCode-Zuordnung mit SkiaSharp</a></li>
<li><a href="../de474910/index.html">Was mit Kindern vor der Schule zu spielen</a></li>
<li><a href="../de474912/index.html">Nachrichten und Warnungen auf Android √ºber JSON</a></li>
<li><a href="../de474916/index.html">Wenden Sie die Nix-Shell-Umgebung in Visual Studio-Code an</a></li>
<li><a href="../de474918/index.html">Verbesserung des Gelenkdesigns von elektromechanischen Bauteilen</a></li>
<li><a href="../de474922/index.html">Wie w√§hlt man einen VPS</a></li>
<li><a href="../de474924/index.html">Wie werde ich ein guter Manager? 4 M√∂glichkeiten, um die L√ºcke in den Managementf√§higkeiten zu schlie√üen</a></li>
<li><a href="../de474928/index.html">Lernen, dem Vivaldi-Browser zu folgen</a></li>
<li><a href="../de474930/index.html">Meetup Burning Leads: Jetzt streamen</a></li>
<li><a href="../de474936/index.html">15 gro√üartige Tools zum Erstellen, Speichern und Verwalten von Links (Bourget)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>