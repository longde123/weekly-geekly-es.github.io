<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤾 👩🏾‍⚕️ 🧚🏾 Drahtloser Beleuchtungssensor CR2450 👨🏼‍🎨 👄 📽️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es ist kein Problem, einen drahtlosen Sensor herzustellen, der ein Barometer, ein Thermometer, ein Hygrometer oder alles in einer Flasche enthält und ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Drahtloser Beleuchtungssensor CR2450</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/385129/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist kein Problem, einen drahtlosen Sensor herzustellen, der ein Barometer, ein Thermometer, ein Hygrometer oder alles in einer Flasche enthält und mit 220 V betrieben wird. </font><font style="vertical-align: inherit;">Interessanter ist es jedoch schon, ein solches Gerät mit Batterien oder Akkus zu versorgen. </font><font style="vertical-align: inherit;">Wenn es sich um einen Disc-Lithium-Akku (Tablet) handelt, ist er im Allgemeinen cool, da sich das Gerät als sehr kompakt herausstellt. </font></font><img src="https://habrastorage.org/files/3ec/db0/e32/3ecdb0e32dff4633b5451cced4effca8.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Das einzige Hindernis für die Verwendung der „Pille“ ist ihre geringe Kapazität. </font><font style="vertical-align: inherit;">Aber auch unter den "Tabletten" gibt es durchaus geeignete Proben, zum Beispiel CR2450, mit der beanspruchten Kapazität von 550-610 mAh.</font></font><a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da ich zum Zeitpunkt der Herstellung des Geräts bereits vorgefertigte Temperatur- und Feuchtigkeitssensoren für den Innen- und Außenbereich hatte, entschied ich mich, einen Beleuchtungssensor auf Basis des BH1750 herzustellen und auf dem Balkon zu platzieren und zusätzlich mit einem Temperatursensor DS18B20 auszustatten. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da alle Fenster nach Süden ausgerichtet sind und der Temperatur- und Feuchtigkeitssensor im Freien erheblich vom Sonnenlicht beeinflusst wird, muss dieser Effekt durch Wetterdaten aus dem Internet kompensiert werden. In Zukunft plane ich, Informationen über das Beleuchtungsniveau zur Berechnung der Kompensation zu verwenden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den Energieverbrauch des Sensors zu minimieren, wurde entschieden:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1. Verweigern Sie die Verwendung des fertigen Arduinki und verwenden Sie den ATmega 328P-PU-Mikrocontroller direkt mit 8-MHz-Quarz. Ich habe mich geweigert, den internen RC-Generator zu verwenden, weil Aufgrund signifikanter Änderungen der Außentemperatur ist die Betriebsfrequenz nicht stabil. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Verwenden Sie die LowPower-Bibliothek und aktivieren Sie den Energiesparmodus LowPower.powerDown (SLEEP_8S, ADC_OFF, BOD_OFF) für den Controller. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Schalten Sie </font><font style="vertical-align: inherit;">den </font><font style="vertical-align: inherit;">DS18B20-Sensor über den Digitalausgang des Mikrocontrollers ein und schalten Sie ihn unmittelbar vor der Messung ein. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4. Schalten Sie das Funkmodul und BH1750 direkt mit den Energiesparmodi radio.powerDown () und Light.configure (BH1750_ONE_TIME_HIGH_RES_MODE) ein. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit dem USBasp-Programmierer bewaffnet,</font></font><br>
<img src="https://habrastorage.org/files/590/376/3ae/5903763aee93423b9d5de8b5ca44dabc.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe eine Sicherung im Controller und natürlich im Bootloader angefordert. Ich baute einen Prototyp zusammen, skizzierte eine Testskizze und maß die verbrauchten Ströme: Im Schlafmodus wurden 14 μA gemessen, im Messmodus von Sensoren - 3-4 mA, im Modus der Datenübertragung über nRF24 zu einer Wetterstation - 16-18 mA. Angesichts der Tatsache, dass ich mich entschlossen habe, alle 3 Minuten Messwerte von den Sensoren zu erfassen und alle 10 Minuten zu senden, ist der Sensor sehr sparsam. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Herstellung des Endgeräts wurde ein Stück Steckbrett und Draht MGTF verwendet. Das Ergebnis ist, was passiert ist: </font></font><br>
 <img src="https://habrastorage.org/files/1d7/c4f/e16/1d7c4fe1624c42ad9132a49decca339e.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um den Batteriestatus zu überwachen, verwenden wir die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in diesem Artikel beschriebenen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Funktionen von ATmega </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Vorgang des Flashens des Bootloaders und der Sicherungen wird </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und hier </font></font></a><font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">ausführlich behandelt</font></a><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die allgemeine Idee, einen autonomen Sensor zu erstellen, wurde </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf der Maniacbug-Website ausgeliehen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Sensor hat bereits den zweiten Monat auf dem Balkon auf der Fensterbank gelegen (und funktioniert) und sendet die Daten korrekt. </font><font style="vertical-align: inherit;">Die Leistungsregelung meldet, dass während dieser Zeit die Spannung der Quelle von 3,05 V beim ersten Einschalten auf 2,98 V abnahm. </font><font style="vertical-align: inherit;">Tagsüber, wenn die Sonne den Balkon erwärmt, kann die Spannung jedoch auf 3,00 V ansteigen. </font><font style="vertical-align: inherit;">Ich freue mich auf kaltes Wetter, mal sehen, wie sich der ausgewählte Akku bei niedrigen Temperaturen zeigt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei der gewählten Dauer des Schlafmodus stellt sich heraus, dass der Sensor in 24 Stunden nur 492-495 Sekunden wach ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gerät ist komplett, aber leider bisher ohne Koffer kann ich kein passendes finden</font></font><br>
<img src="https://habrastorage.org/files/8af/06a/226/8af06a2266d549c6acc7e9533fa105dc.jpg"><br>
<img src="https://habrastorage.org/files/07d/b1d/1e1/07db1d1e1cfc40e4972a9db2197b0519.jpg"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinzufügung vom 20.03.2016.</font></font></b><div class="spoiler_text"> 6 ,        .        -24,      2,5280V.<br>
  (  )       4 +  .<br>
</div></div><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;LowPower.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SPI.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;RF24Network.h&gt;   </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;RF24.h&gt;          </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;OneWire.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;DallasTemperature.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Wire.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;BH1750.h&gt;</span></span>
<span class="hljs-comment">/////// lass AVG //////////////////////////////////////////////////////////</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AVG</span> {</span>
  <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEPTH_AVG 10</span>
  <span class="hljs-keyword">private</span> :
     <span class="hljs-keyword">int</span> depth;
     <span class="hljs-keyword">long</span> *mas;
     <span class="hljs-keyword">int</span> cur;<font></font>
     boolean first;<font></font>
  <span class="hljs-keyword">public</span> :<font></font>
     boolean fDebug;  <font></font>
<font></font>
  AVG(<span class="hljs-keyword">int</span> d)<font></font>
  {<font></font>
    <span class="hljs-keyword">if</span>( d == <span class="hljs-number">0</span> || d &gt; DEPTH_AVG)depth = DEPTH_AVG;
    <span class="hljs-keyword">else</span> depth = d;<font></font>
    mas = (<span class="hljs-keyword">long</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">long</span>)*depth);<font></font>
    first = <span class="hljs-literal">true</span>;<font></font>
    cur   = <span class="hljs-number">0</span>;<font></font>
    fDebug = <span class="hljs-literal">false</span>;<font></font>
  }<font></font>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Set</span><span class="hljs-params">(<span class="hljs-keyword">long</span> x)</span>
  </span>{
    <span class="hljs-keyword">if</span>( first )<font></font>
    {<font></font>
       <span class="hljs-keyword">for</span>( <span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;depth; i++ )mas[i] = x;<font></font>
       cur = <span class="hljs-number">0</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span><font></font>
    {<font></font>
    mas[cur++] = x;<font></font>
    <span class="hljs-keyword">if</span>( cur &gt;= depth ) cur = <span class="hljs-number">0</span>; <font></font>
    }<font></font>
    first = <span class="hljs-literal">false</span>;  <font></font>
  }<font></font>
  <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">Get</span><span class="hljs-params">()</span>
  </span>{
    <span class="hljs-keyword">long</span> x=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>( <span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;depth; i++ )<font></font>
          {<font></font>
            x+=mas[i];<font></font>
          }<font></font>
    x/=depth;<font></font>
    <span class="hljs-keyword">return</span>(x);<font></font>
  }<font></font>
};<font></font>
<span class="hljs-comment">/////////////////////////////////////////////////////////////////////</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> pinPowerSensor 4    <span class="hljs-comment">//    Pin 4</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ONE_WIRE_BUS 3</span>
<span class="hljs-function">OneWire <span class="hljs-title">oneWire</span><span class="hljs-params">(ONE_WIRE_BUS)</span></span>;
<span class="hljs-function">DallasTemperature <span class="hljs-title">sensors</span><span class="hljs-params">(&amp;oneWire)</span></span>;<font></font>
BH1750 Light;<font></font>
<span class="hljs-function">RF24 <span class="hljs-title">radio</span><span class="hljs-params">(<span class="hljs-comment">/*ce*/</span> <span class="hljs-number">9</span>, <span class="hljs-comment">/*cs*/</span> <span class="hljs-number">10</span>)</span></span>;
<span class="hljs-function">RF24Network <span class="hljs-title">network</span><span class="hljs-params">(radio)</span></span>;
<span class="hljs-comment">//   </span>
<span class="hljs-keyword">uint16_t</span> this_node = <span class="hljs-number">02</span>;
<span class="hljs-comment">// ,     </span>
<span class="hljs-keyword">uint16_t</span> main_node = <span class="hljs-number">0</span>;
<span class="hljs-comment">//  </span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> Chanel = <span class="hljs-number">11</span>;
<span class="hljs-keyword">int</span> ReadCount;
<span class="hljs-keyword">int</span> iSend     = <span class="hljs-number">3</span>;    <span class="hljs-comment">//    </span>
<span class="hljs-keyword">int</span> WaitCount = <span class="hljs-number">24</span>;   <span class="hljs-comment">//     8 .</span>
<span class="hljs-keyword">bool</span> allowSend = <span class="hljs-literal">false</span>; <span class="hljs-comment">//   </span>
<span class="hljs-function">AVG <span class="hljs-title">vAVG</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span>;
<span class="hljs-function">AVG <span class="hljs-title">tAVG</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span>;
<span class="hljs-function">AVG <span class="hljs-title">lAVG</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span>;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StreetMeteoSensor</span>
{</span>
  <span class="hljs-keyword">char</span>    ID[<span class="hljs-number">5</span>];     <span class="hljs-comment">// </span>
  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> UpTime;
  <span class="hljs-keyword">int</span>   T;           <span class="hljs-comment">//</span>
  <span class="hljs-keyword">long</span>  L;           <span class="hljs-comment">//  (Lx) </span>
  <span class="hljs-keyword">int</span>   V;           <span class="hljs-comment">//   (mV)</span><font></font>
};<font></font>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">StreetMeteoSensor</span> <span class="hljs-title">sensor</span>;</span>
<span class="hljs-function">RF24NetworkHeader <span class="hljs-title">header</span><span class="hljs-params">(main_node, <span class="hljs-string">'I'</span>)</span></span>;
<span class="hljs-comment">////////////////////////////////////////////</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> DEBUG_MODE     0</span>
<span class="hljs-comment">////////////////////////////////////////////</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
    <span class="hljs-keyword">if</span> (DEBUG_MODE) <font></font>
  {<font></font>
    Serial.begin(<span class="hljs-number">115200</span>);
    <span class="hljs-comment">//tAVG.fDebug = true;  </span>
    <span class="hljs-comment">//lAVG.fDebug = true;      </span>
    Serial.println(<span class="hljs-string">"-- START --"</span>);  <font></font>
    WaitCount = <span class="hljs-number">5</span>;<font></font>
  }<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">15</span>; i++)  <font></font>
  {<font></font>
    pinMode(i, OUTPUT);<font></font>
    digitalWrite(i,LOW);<font></font>
  }<font></font>
  digitalWrite(pinPowerSensor,HIGH);<font></font>
  <span class="hljs-keyword">char</span> ID[<span class="hljs-number">5</span>] = <span class="hljs-string">"LTS1"</span>;
  <span class="hljs-built_in">memcpy</span>(sensor.ID, ID, <span class="hljs-number">5</span>);  <font></font>
  ReadCount = iSend;<font></font>
  SPI.begin();<font></font>
  delay(<span class="hljs-number">500</span>);<font></font>
  radio.begin();<font></font>
  network.begin( Chanel, this_node );  <font></font>
  sensors.begin();  <font></font>
  Light.begin(BH1750_ONE_TIME_HIGH_RES_MODE);<font></font>
  delay(<span class="hljs-number">500</span>);<font></font>
  radio.powerDown();    <font></font>
  digitalWrite(pinPowerSensor,LOW);  <font></font>
  Light.configure(BH1750_POWER_DOWN);<font></font>
  <span class="hljs-keyword">if</span> (DEBUG_MODE)  Serial.println(<span class="hljs-string">"-- End SETUP --"</span>); <font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
  <span class="hljs-comment">//  </span>
 <span class="hljs-keyword">if</span> (DEBUG_MODE) Serial.println(<span class="hljs-string">"data read..."</span>);
  <span class="hljs-comment">//  BH1750    , </span>
  Light.configure(BH1750_POWER_ON);                    <span class="hljs-comment">//  </span>
  Light.configure(BH1750_ONE_TIME_HIGH_RES_MODE);     <span class="hljs-comment">//   </span>
  digitalWrite(pinPowerSensor,HIGH);                  <span class="hljs-comment">//    DS18B20</span><font></font>
  sensors.setResolution(TEMP_9_BIT);   <font></font>
  delay(<span class="hljs-number">250</span>); <font></font>
  sensors.requestTemperatures();<font></font>
  <span class="hljs-keyword">int</span> T = sensors.getTempCByIndex(<span class="hljs-number">0</span>);<font></font>
  digitalWrite(pinPowerSensor,LOW);  <span class="hljs-comment">//   DS18B20</span>
  <span class="hljs-keyword">long</span> L = Light.readLightLevel();  <span class="hljs-comment">// ONE_TIME   </span>
  <span class="hljs-keyword">int</span> V = readVcc();  
  <span class="hljs-comment">/////////////////////////////////////////////////////////////</span>
  <span class="hljs-keyword">int</span> tt = tAVG.Get();
  <span class="hljs-keyword">int</span> vv = vAVG.Get();
  <span class="hljs-keyword">long</span> ll = lAVG.Get();
  <span class="hljs-keyword">if</span> (L &gt; <span class="hljs-number">0</span> || ll &gt; <span class="hljs-number">0</span> || T &lt; tt<span class="hljs-number">-2</span> || T &gt; tt+<span class="hljs-number">2</span> || V &lt; vv<span class="hljs-number">-100</span><span class="hljs-comment">/*0.1V*/</span>) <font></font>
  { <span class="hljs-comment">//  -    </span><font></font>
    tAVG.Set(T);<font></font>
    lAVG.Set(L);<font></font>
    vAVG.Set(V); <font></font>
    allowSend = <span class="hljs-literal">true</span>;     <span class="hljs-comment">//   -  </span>
    <span class="hljs-comment">//     0 ()</span>
    <span class="hljs-keyword">if</span> (ll == <span class="hljs-number">0</span> &amp;&amp;  L &gt; <span class="hljs-number">0</span>)<font></font>
      lAVG.Set(L);  <font></font>
  }<font></font>
  ReadCount++;        <font></font>
  <span class="hljs-comment">/////////////////////////////////////////////////////////////</span>
  <span class="hljs-keyword">if</span> (DEBUG_MODE)<font></font>
  {<font></font>
    Serial.print(<span class="hljs-string">"T= "</span>);<font></font>
    Serial.print(tAVG.Get());<font></font>
    Serial.print(<span class="hljs-string">": "</span>);<font></font>
    Serial.print(T);    <font></font>
    Serial.print(<span class="hljs-string">"; L= "</span>);<font></font>
    Serial.print(lAVG.Get());<font></font>
    Serial.print(<span class="hljs-string">": "</span>);    <font></font>
    Serial.print(L);    <font></font>
    Serial.print(<span class="hljs-string">"; V= "</span>);<font></font>
    Serial.print(vAVG.Get());<font></font>
    Serial.print(<span class="hljs-string">": "</span>);    <font></font>
    Serial.print(V);        <font></font>
    Serial.print(<span class="hljs-string">"; ReadCount= "</span>);    <font></font>
    Serial.println(ReadCount);<font></font>
  }  <font></font>
  <span class="hljs-comment">/////////////////////////////////////////////////////////////</span>
  <span class="hljs-comment">//    </span>
  <span class="hljs-keyword">if</span> ( ReadCount &gt;= iSend &amp;&amp; allowSend )<font></font>
  {<font></font>
    <span class="hljs-comment">//     </span>
    ReadCount = <span class="hljs-number">0</span>;<font></font>
    allowSend = <span class="hljs-literal">false</span>;   <font></font>
    radio.powerUp();<font></font>
    delay(<span class="hljs-number">50</span>);<font></font>
    sensor.T = tAVG.Get();  <font></font>
    sensor.L = lAVG.Get();<font></font>
    sensor.V = vAVG.Get();    <font></font>
    sensor.UpTime = millis()/<span class="hljs-number">1000</span>;     <font></font>
    network.write(header,&amp;sensor,<span class="hljs-keyword">sizeof</span>(sensor));<font></font>
    radio.powerDown();  <font></font>
  }    <font></font>
  sleep();<font></font>
}<font></font>
<span class="hljs-comment">//      </span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sleep</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">if</span> (DEBUG_MODE) {Serial.println(<span class="hljs-string">"----- SLEEP -----"</span>);Serial.flush();}
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; WaitCount; i++)  <span class="hljs-comment">//   </span><font></font>
  {<font></font>
    LowPower.powerDown(SLEEP_8S, ADC_OFF, BOD_OFF); <font></font>
  }<font></font>
}<font></font>
<span class="hljs-comment">////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<span class="hljs-comment">//   </span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">readVcc</span><span class="hljs-params">()</span> 
</span>{
  <span class="hljs-keyword">int</span> result;
  <span class="hljs-comment">// Read 1.1V reference against AVcc</span>
  <span class="hljs-comment">// set the reference to Vcc and the measurement to the internal 1.1V reference</span><font></font>
  ADMUX = _BV(REFS0) | _BV(MUX3) | _BV(MUX2) | _BV(MUX1);<font></font>
  delay(<span class="hljs-number">75</span>); <span class="hljs-comment">// Wait for Vref to settle</span>
  ADCSRA |= _BV(ADSC); <span class="hljs-comment">// Start conversion</span>
  <span class="hljs-keyword">while</span> (bit_is_set(ADCSRA,ADSC)); <span class="hljs-comment">// measuring</span><font></font>
  result = ADCL;<font></font>
  result |= ADCH&lt;&lt;<span class="hljs-number">8</span>;
  <span class="hljs-keyword">if</span> (DEBUG_MODE) {Serial.print(<span class="hljs-string">"result="</span>);Serial.println(result);}<font></font>
  result =  <span class="hljs-number">1125300L</span> / result; <span class="hljs-comment">// (Kvcc * 1023.0 * 1000) (in mV);</span>
  <span class="hljs-keyword">return</span> result; <font></font>
}<font></font>
</code></pre><br>
</div></div></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de385129/">https://habr.com/ru/post/de385129/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de385117/index.html">DJI Osmo - Taschenstabilisator</a></li>
<li><a href="../de385119/index.html">Wein für Android</a></li>
<li><a href="../de385121/index.html">Algorithmischer Surrealismus: Ein Leitfaden für den Hochfrequenzhandel für 900 Millionen Mikrosekunden. Teil 1</a></li>
<li><a href="../de385123/index.html">Station New Horizons schickte ein Bild eines kleinen Satelliten von Pluto Styx</a></li>
<li><a href="../de385125/index.html">Reddit hat ausgewählt, welches Bild 2017 zum Mond geht</a></li>
<li><a href="../de385131/index.html">Nachts ruhig, nur nicht schlafen PC: lautlos gehen</a></li>
<li><a href="../de385135/index.html">Hydroponik auf einer Fensterbank oder C ++ 11 in AVR-Mikrocontrollern</a></li>
<li><a href="../de385137/index.html">Global Urban Billboard Demontagebewegung</a></li>
<li><a href="../de385139/index.html">Tesla Motors Roboter</a></li>
<li><a href="../de385141/index.html">Cannybots: Roboter, die Kindern das Programmieren beibringen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>