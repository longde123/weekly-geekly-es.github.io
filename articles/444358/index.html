<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí™üèª üë®üèº‚Äçüç≥ ‚úåüèæ Enumerable: c√≥mo generar un valor comercial ü§¶üèø üë®üèº‚Äçüíº üë∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo es una breve explicaci√≥n acerca de c√≥mo el uso de palabras clave de un lenguaje com√∫n puede influir en el presupuesto de infraestructura...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Enumerable: c√≥mo generar un valor comercial</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444358/">  Este art√≠culo es una breve explicaci√≥n acerca de c√≥mo el uso de palabras clave de un lenguaje com√∫n puede influir en el presupuesto de infraestructura de TI de un proyecto o ayudar a lograr algunas limitaciones / restricciones de la infraestructura de alojamiento y, adem√°s, ser√° una buena se√±al de la calidad y madurez del c√≥digo fuente. <br><a name="habracut"></a><br>  Para la demostraci√≥n de ideas, en el art√≠culo se utilizar√° el lenguaje C #, pero la mayor√≠a de las ideas se pueden traducir a otros idiomas. <br><br>  Desde el conjunto de caracter√≠sticas del lenguaje, desde mi punto de vista, 'rendimiento' es la palabra clave m√°s infravalorada.  Puede leer la documentaci√≥n y encontrar una gran cantidad de ejemplos en Internet.  Para ser cortos, digamos que 'rendimiento' permite crear 'iteradores' impl√≠citamente.  Por dise√±o, un iterador debe exponer una fuente IEnumerable para uso 'p√∫blico'.  Y aqu√≠ comienza lo complicado.  Porque tenemos muchas implementaciones de IEnumerable en el lenguaje: lista, diccionario, hashset, cola y etc.  Y desde mi experiencia, la elecci√≥n de uno de ellos para satisfacer los requisitos de alguna tarea comercial es incorrecta.  Adem√°s, todo esto se ve agravado por cualquier implementaci√≥n que se elija, el programa 'simplemente funciona': esto es lo que realmente necesita para los negocios, ¬øno?  Com√∫nmente funciona, pero solo hasta que el servicio se implemente en un entorno de producci√≥n. <br><br>  Para una demostraci√≥n del problema, sugiero elegir un caso / flujo de negocios muy com√∫n para la mayor√≠a de los proyectos empresariales que podemos extender durante el art√≠culo y sustituir alguna parte de este flujo para comprender una escala de influencia de este enfoque en los proyectos empresariales.  Y deber√≠a ayudarlo a encontrar su propio caso en este conjunto para solucionarlo. <br><br>  Ejemplo de la tarea: <br><br><ol><li>  Cargue en l√≠nea un conjunto de registros de un archivo o base de datos en la memoria. </li><li>  Para cada columna del registro, cambie el valor a otro valor. </li><li>  Guarde los resultados de la transformaci√≥n en un archivo o base de datos. </li></ol><br>  Asumamos varios casos donde esta l√≥gica puede ser aplicable.  En este momento, veo dos casos: <br><br><ol><li>  Tal vez sea parte del flujo de alguna aplicaci√≥n ETL de consola. </li><li>  Es quiz√°s una l√≥gica dentro de la acci√≥n en la aplicaci√≥n Controlador de MVC. </li></ol><br>  Si parafraseamos la tarea de una manera m√°s t√©cnica, puede sonar as√≠: "(1) Asignar una cantidad de memoria, (2) cargar informaci√≥n en la memoria desde el almacenamiento de persistencia, (3) modificar y (4) eliminar registros cambios en la memoria para el almacenamiento de persistencia ".  Aqu√≠ la primera frase en la descripci√≥n "(1) Asignar una cantidad de memoria" puede tener una correlaci√≥n real con sus requisitos no funcionales.  Debido a que su trabajo / servicio debe 'vivir' en alg√∫n entorno de alojamiento que puede tener algunas limitaciones / restricciones (por ejemplo, 150Mb por microservicio) y para predecir los gastos en su servicio en el presupuesto, debemos predecir, en nuestro caso, la cantidad de memoria qu√© servicio usar√° (com√∫nmente decimos sobre las cantidades m√°ximas de memoria).  En otras palabras, debemos determinar una "huella" de memoria para su servicio. <br><br>  Consideremos una huella de memoria para una implementaci√≥n realmente com√∫n que observo de vez en cuando en diferentes bases de c√≥digo de proyectos empresariales.  Adem√°s, tambi√©n puede intentar encontrarlo en sus proyectos, por ejemplo, 'bajo el cap√≥' de la implementaci√≥n del patr√≥n 'repositorio', solo intente encontrar esas palabras: 'ToList', 'ToArray', 'ToReadonlyCollection' y etc.  Toda esta implementaci√≥n significa que: <br><br>  1. Para cada l√≠nea / registro en el archivo / db, asigna memoria para mantener las propiedades del registro del archivo / db (es decir, var user = new User () {FirstName = 'Test', LastName = 'Test2'}) <br><br>  2. Luego, con la ayuda de, por ejemplo, 'ToArray' o manualmente, las referencias del objeto se mantienen en alguna colecci√≥n (es decir, var users = new List (); users.Add (user)).  Por lo tanto, se le asigna cierta cantidad de memoria para cada registro de un archivo y, para no olvidarlo, la referencia se almacena en alguna colecci√≥n. <br><br>  Aqu√≠ hay un ejemplo: <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;User&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadUsers2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;User&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> File.ReadLines(<span class="hljs-string"><span class="hljs-string">"text.txt"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> splittedLine = line.Split(<span class="hljs-string"><span class="hljs-string">';'</span></span>); list.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User() { FirstName = splittedLine[<span class="hljs-number"><span class="hljs-number">0</span></span>], LastName = splittedLine[<span class="hljs-number"><span class="hljs-number">1</span></span>] }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; <span class="hljs-comment"><span class="hljs-comment">// or return File.ReadLines("text.txt") .Select(line =&gt; line.Split(';')) .Select(splittedLine =&gt; new User() { FirstName = splittedLine[0], LastName = splittedLine[1] }).ToArray(); }</span></span></code> </pre> <br>  Resultados del generador de perfiles de memoria: <br><br><img src="https://habrastorage.org/webt/du/i2/bx/dui2bxcfqb1tvgzfeyvwsj6mfba.jpeg" alt="imagen"><br><br>  Exactamente esa imagen que vi cada vez en un entorno de producci√≥n antes de que el contenedor se detenga / recargue debido a la limitaci√≥n de recursos del hosting por contenedor. <br><br>  Entonces, una huella para este caso, aproximadamente, depende de la cantidad de registros en un archivo.  Porque la memoria se asigna por registro en el archivo.  Y, la suma de estas peque√±as cantidades de memoria nos da una cantidad m√°xima de memoria que nuestro servicio puede consumir: es la huella del servicio.  ¬øPero es esta huella predecible?  Aparentemente no.  Porque no podemos predecir una cantidad de registros en el archivo.  Y, en la mayor√≠a de los casos, el tama√±o del archivo excede la cantidad de memoria permitida en el alojamiento en varias ocasiones.  Significa que es dif√≠cil usar dicha implementaci√≥n en el entorno de producci√≥n. <br><br>  Parece que es el momento de repensar tal implementaci√≥n.  La siguiente suposici√≥n puede darnos m√°s oportunidades para calcular una huella para el servicio: "una huella debe depender del tama√±o de UN solo registro en el archivo".  Aproximadamente, en este caso, podemos calcular el tama√±o m√°ximo de cada columna de un solo registro y sumarlos.  Es bastante f√°cil predecir el tama√±o de un registro en lugar de predecir el n√∫mero de registros en el archivo. <br><br>  <b>Y realmente se pregunta si podemos implementar un servicio que pueda manejar una cantidad impredecible de registros y que constantemente consuma solo un par de megabytes con ayuda de solo una palabra clave: 'rendimiento' *.</b> <br><br>  El tiempo para un ejemplo: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1. Load byline a set of records from a file or DB into memory. var users = LoadUsers(); // 2. For each column of the record change the value to someone other value. users = ModifyFirstName(users); // 3. Save the results of transformation into a file or DB. SaveUsers(users); } private static IEnumerable&lt;User&gt; LoadUsers() { foreach(var line in File.ReadLines("text.txt")) { var splitedLine = line.Split(';'); yield return new User() { FirstName = splitedLine[0], LastName = splitedLine[1] }; } } private static IEnumerable&lt;User&gt; ModifyFirstName(IEnumerable&lt;User&gt; users) { foreach (var user in users) { user.FirstName += "_1"; yield return user; } } private static void SaveUsers(IEnumerable&lt;User&gt; users) { foreach(var user in users) { File.AppendAllLines("results.txt", new string []{ user.FirstName + ';' + user.LastName }); } } private class User { public string FirstName { get; set; } public string LastName { get; set; } } }</span></span></code> </pre><br>  Como puede ver en el ejemplo anterior, solo se asigna memoria para un objeto a la vez: 'return return new User ()' en lugar de crear una colecci√≥n y llenarla con objetos.  Es el principal punto de optimizaci√≥n que nos permite calcular una huella de memoria m√°s predecible para el servicio.  Porque solo necesitamos saber el tama√±o de dos campos, en nuestro caso Nombre y Apellido.  Cuando un usuario modificado se guarda en un archivo (consulte File.AppendAllLines), la instancia del objeto de usuario est√° disponible para la recolecci√≥n de elementos no utilizados.  Y la memoria que est√° ocupada por el objeto se desasigna (es decir, la pr√≥xima iteraci√≥n de la declaraci√≥n 'foreach' en LoadUsers), por lo que se puede crear la siguiente instancia del objeto de usuario.  En otras palabras, aproximadamente, la misma cantidad de memoria reemplaza por la misma cantidad de memoria en cada iteraci√≥n.  Es por eso que no necesitamos m√°s memoria que el tama√±o de un solo registro en el archivo. <br><br>  Resultados del generador de perfiles de memoria despu√©s de la optimizaci√≥n: <br><br><img src="https://habrastorage.org/webt/6k/gy/y6/6kgyy6wiwpafktukdwq2lsh_vx0.jpeg" alt="imagen"><br><br>  Desde otra perspectiva, si cambiamos ligeramente el nombre de un par de m√©todos en la implementaci√≥n anterior, de modo que el uso pueda notar alguna l√≥gica significativa para los Controladores en la aplicaci√≥n MVC: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUsersAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1. Load byline a set of records from a file or DB into memory. var users = LoadUsers(); // 2. For each column of the record change the value to someone other value. var usersDTOs = MapToDTO(users); // 3. Save the results of transformation into a file or DB. OkResult(usersDTOs); }</span></span></code> </pre><br>  Una nota importante antes del listado de c√≥digos: la mayor√≠a de las bibliotecas importantes como EntityFramework, ASP.net MVC, AutoMapper, Dapper, NHibernate, ADO.net y etc. exponen / consumen fuentes IEnumerables.  Entonces, significa en el ejemplo anterior que LoadUsers puede ser reemplazado por una implementaci√≥n que utiliza EntityFramework, por ejemplo.  Que carga datos fila por fila de la tabla DB, en lugar de un archivo.  MapToDTO puede ser reemplazado por Automapper y OkResult puede ser reemplazado por una implementaci√≥n 'real' de IActionResult en alg√∫n marco MVC o nuestra propia base de implementaci√≥n en el flujo de red, por ejemplo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OkResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;User&gt; users</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// you can use a networksteam implementation using(StreamWriter sw = new StreamWriter("result.txt")) { foreach(var user in users) { sw.WriteLine(user.FirstName + ';' + user.LastName); } } }</span></span></code> </pre><br>  Este ejemplo 'similar a mvc' nos muestra que todav√≠a podemos predecir y calcular una huella de memoria tambi√©n para aplicaciones web.  Pero en este caso, depender√° del recuento de solicitudes tambi√©n.  Por ejemplo, los requisitos no funcionales pueden sonar de esta manera: "Cantidad m√°xima de memoria para 1000 solicitudes, no m√°s de: 200 KB por objeto de usuario x 1000 solicitudes ~ 200 MB". <br><br>  Dichos c√°lculos son muy √∫tiles para la optimizaci√≥n del rendimiento en caso de escalar la aplicaci√≥n web.  Por ejemplo, necesita escalar su aplicaci√≥n web en 100 contenedores / VM.  Entonces, en este caso, para tomar una decisi√≥n sobre la cantidad de recursos que debe asignar del proveedor de alojamiento, para que pueda ajustar la f√≥rmula de esta manera: 200 KB por objeto de usuario x 1000 solicitudes x 100VMs ~ 20GB.  Adem√°s, esta es la cantidad m√°xima de memoria y esta cantidad est√° bajo el control del presupuesto de su proyecto. <br><br>  Espero que la informaci√≥n de este art√≠culo sea √∫til y permita ahorrar mucho dinero y tiempo en sus proyectos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/444358/">https://habr.com/ru/post/444358/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444346/index.html">GraphQL y Golang</a></li>
<li><a href="../444348/index.html">¬øEn qu√© se diferencian los componentes funcionales de React de los componentes basados ‚Äã‚Äãen clases?</a></li>
<li><a href="../444350/index.html">Por alguna raz√≥n, MVP (producto m√≠nimo viable) no se inicia</a></li>
<li><a href="../444352/index.html">Kontur.Kampus: te invitamos a un campamento estudiantil gratuito de desarrollo industrial cerca de San Petersburgo</a></li>
<li><a href="../444356/index.html">Tutorial de React Parte 24: Lecci√≥n de los segundos formularios</a></li>
<li><a href="../444360/index.html">La injusticia de Google Play como una buena experiencia de vida</a></li>
<li><a href="../444362/index.html">Unity y Havok trabajan en un nuevo motor de f√≠sica</a></li>
<li><a href="../444364/index.html">24 horas de juego Rust: experiencia de desarrollo personal</a></li>
<li><a href="../444366/index.html">Seminario "Requisitos de seguridad de la informaci√≥n: c√≥mo las empresas pueden vivir con ellos"</a></li>
<li><a href="../444368/index.html">Acabamos de imprimir el micr√≥fono en una impresora 3D en el laboratorio, y luego habr√° ciencia ficci√≥n completa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>