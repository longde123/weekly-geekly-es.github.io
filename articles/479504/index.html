<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöè ‚òùÔ∏è ‚è¨ Cree un cliente ligero RDP basado en Raspberry Pi üï† üßôüèª üë®üèæ‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Con la creciente popularidad de las mini PC como Raspberry Pi y clones similares, hubo muchos casos para su uso en la infraestructura de TI de la empr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cree un cliente ligero RDP basado en Raspberry Pi</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479504/">  Con la creciente popularidad de las mini PC como Raspberry Pi y clones similares, hubo muchos casos para su uso en la infraestructura de TI de la empresa, casa inteligente / casa de campo / garaje y otras aplicaciones. <br><br>  Uno de los casos convenientes y deseables es el uso de RPi como un cliente ligero que se conecta a trav√©s de RDP a sistemas basados ‚Äã‚Äãen Windows. <br><br>  Si est√° interesado en c√≥mo configurar un lugar de este tipo sobre la base de la Raspberry Pi, y de tal manera que "configure y olvide", bienvenido al gato.  Hay una imagen preparada para los completamente vagos (ver secci√≥n 6.B). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3v/mj/zp/3vmjzprnt4v33dvnqnr6rwlikb8.png" alt="Una imagen para llamar la atenci√≥n."></div><br><a name="habracut"></a><br>  Espec√≠ficamente, en mi experiencia (un especialista en automatizaci√≥n de contabilidad / gesti√≥n), a menudo ten√≠a que organizar lugares de trabajo cuyo √∫nico prop√≥sito era acceder a un programa (principalmente amarillo), una suite de oficina, Internet y correo.  A veces, trabaje con unidades flash.  El servidor, al mismo tiempo, ya estaba en la empresa. <br><br>  Al mismo tiempo, la estaci√≥n requer√≠a poco ruido, compacidad y fiabilidad.  O, seamos honestos, barato.  Especialmente si la pregunta era sobre el comercio minorista, donde todo deber√≠a ser "clavado". <br><br>  Al mismo tiempo, en el pasado, se probaron muchas soluciones en forma de clientes ligeros especializados "de hierro", pero por una serie de razones resultaron inc√≥modas.  En alg√∫n lugar, se requer√≠an tareas relacionadas espec√≠ficas, como el reenv√≠o de impresoras a un servidor, que no pod√≠an hacer frente.  En alg√∫n lugar, las tablas aparecieron lentamente, lo que volvi√≥ locos a los usuarios.  En alg√∫n lugar, los clientes delgados simplemente trabajaban en un solo lugar, y era imposible entender por qu√©.  En alg√∫n lugar, la carga de red caprichosa no funcion√≥, o los par√°metros no se transfirieron a trav√©s de DHCP. <br><br>  Por lo tanto, de alguna manera natural, todo lleg√≥ a la conclusi√≥n de que es m√°s f√°cil comprar un nettop basura y ponerle un conjunto m√≠nimo de software que adivinar un juego con hierro oscuro, m√°s a su propio costo, porque no se sabe de antemano d√≥nde y qu√© no funciona. , pero se sabe con certeza que todo deber√≠a haber estado bien, y no tomar tanto tiempo. <br><br>  El art√≠culo lleg√≥ un poco tarde con la relevancia.  Si vuelve al mismo programa amarillo, en los √∫ltimos a√±os la plataforma se ha desarrollado, tiene su propio cliente ligero y la relevancia de su implementaci√≥n en modo de escritorio remoto ha disminuido. <br><br>  Pero hay una serie de otras tareas donde una estaci√≥n de trabajo silenciosa y confiable conectada a trav√©s de RDP ser√° apropiada.  Y en los √∫ltimos a√±os, el costo de las mini-PC ha subido hasta ahora, y el de las computadoras y nettops est√°ndar, se ha vuelto m√°s rentable (el costo del hardware, una hora de trabajo especializado, adem√°s de las licencias CAL / TCAL para Windows Server) para construir tales soluciones. <br><br><h2>  Declaraci√≥n del problema. </h2><br>  Entonces, sobre la base de Raspberry Pi, <b>necesitamos</b> implementar un cliente RDP delgado, "clavar" a un servidor espec√≠fico, adem√°s de proporcionar reconexi√≥n en caso de falla. <br><br>  Cualquier interacci√≥n del usuario con el dispositivo en s√≠ debe ser excluida.  En consecuencia, no hay comandos locales de escritorio y consola.  La contrase√±a se ingresa solo para la sesi√≥n RDP. <br><br>  Como beneficio adicional, organice unidades USB extra√≠bles de montaje autom√°tico y probros. <br><br>  <b>Dado:</b> <br><br><ul><li>  Raspberry Pi 3 puro Modelo B 1 Gb, o 4 Modelo B 1 Gb </li><li>  Adaptador de corriente 5v 2A, </li><li>  Cable HDMI </li><li>  adaptador con HDMI al monitor (si el monitor no tiene un puerto HDMI incorporado), </li><li>  Cable Ethernet (o la presencia de una red WiFi), </li><li>  Tarjeta de memoria MicroSD con 8 GB o m√°s (4 GB es objetivamente suficiente, pero me parece que puede comprar una tarjeta de 4 GB solo en el museo). </li><li>  monitor, teclado, mouse para frambuesa. </li></ul><br>  En el momento de la instalaci√≥n: una computadora (computadora port√°til) con Windows o Linux, un adaptador de tarjeta microSD. <br><br>  Se supone que el lector tiene la habilidad b√°sica de administrar sistemas Linux, y la pregunta "crear y editar un archivo, copiar el texto de este art√≠culo en √©l" o "conectarse a trav√©s de SSH" no causar√° dificultades.  Sin embargo, a veces me permito una excursi√≥n m√°s profunda, para aquellos que podr√≠an no haberse encontrado espec√≠ficamente con Raspbian. <br><br>  L√≥gica general: configure el sistema base, instale el cliente RDP, configure el inicio de sesi√≥n autom√°tico, pruebe, solucione problemas. <br><br>  Tambi√©n describir√° c√≥mo clonar un ensamblaje terminado en otra Raspberry. <br><br>  El dise√±o del software en s√≠ es sencillo, naci√≥ de una forma u otra hace unos 9 a√±os, como recuerdo ahora, lo hice bajo Debian Etch.  Desde entonces, ha cambiado un poco de versiones de software y hardware a versiones, y ahora es el momento de portarlo a Raspberry. <br><br>  El consumo de tiempo planificado es de aproximadamente 30 minutos. <br><br><h2>  1. Configuraci√≥n del sistema base </h2><br><h4>  1.1 Descargar imagen del sistema </h4><br>  Elegiremos Raspbian como sistema. <br><br>  Al momento de escribir, <a href="https://www.raspberrypi.org/downloads/raspbian/" rel="nofollow">esto se puede hacer aqu√≠</a> .  La versi√≥n actual es Buster. <br><br>  Seleccione Imagen m√≠nima basada en Debian Buster. <br><br><img src="https://habrastorage.org/webt/iy/eb/jv/iyebjvlxbebhaqflevjeihob5fa.png"><br><br>  Descargue el archivo ZIP para obtener el √∫nico archivo .img. <br><br><img src="https://habrastorage.org/webt/vp/qo/5w/vpqo5wlbndwf9n2ntw5stuylso0.png"><br><br><h4>  1.2 Escr√≠belo en una tarjeta flash </h4><br>  <b>a) Bajo Windows</b> <br><br>  Descargue el programa <b>Rufus</b> del <a href="https://rufus.ie/" rel="nofollow">sitio oficial</a> .  Una versi√≥n port√°til es suficiente. <br><br>  Ejecute el programa, seleccione la tarjeta SD y la imagen extra√≠da del archivo en el p√°rrafo 1.1. <br><br><img src="https://habrastorage.org/webt/yx/9o/3f/yx9o3ftepbvxw5qytwiu5__d_fi.png"><br><br>  Presione el bot√≥n "INICIAR", confirme la destrucci√≥n de datos en la tarjeta SD, espere a que se complete el proceso (aproximadamente 5 minutos). <br><br>  Retire con seguridad la tarjeta. <br><br>  <b>b) bajo Linux</b> <br><br>  Ejecute el comando: <br><br><pre><code class="plaintext hljs"># dd if=2019-09-26-raspbian-buster-lite.img of=/dev/&lt; SD-&gt; bs=4M</code> </pre> <br>  Espere a que se complete el proceso, saque la tarjeta. <br><br><h4>  1.3 Implemente el sistema en RPI </h4><br>  Reorganizamos la tarjeta al dispositivo de destino.  Conectamos la mini PC con un monitor, teclado, mouse y le aplicamos energ√≠a. <br><br>  Despu√©s de un tiempo, sin hacer preguntas adicionales, la mini PC se reiniciar√° en el sistema reci√©n implementado y lo invitar√° a ingresar su nombre de usuario y contrase√±a. <br>  Por defecto, esto es <b>pi: frambuesa.</b> <br><br><img src="https://habrastorage.org/webt/7p/ej/p6/7pejp6fntkhztb-4tkbhdlcmdq8.jpeg"><br><br><h4>  1.4 Inicie sesi√≥n y cambie su contrase√±a </h4><br><pre> <code class="plaintext hljs"># passwd pi</code> </pre> <br>  o <br><br><pre> <code class="plaintext hljs">$ sudo passwd pi</code> </pre> <br>  (Ejecut√© passwd intencionalmente para el usuario pi como root para que Raspbian no nos atormente con los requisitos de seguridad para la contrase√±a, pero la acepta y la acepta) <br><br>  No puede iniciar sesi√≥n directamente como root a menos que establezca expl√≠citamente una contrase√±a para ello.  En general, esto no es malo.  Entonces, todos los comandos que deben ejecutarse bajo el superusuario deben ejecutarse desde el usuario pi con el comando sudo prefix.  Como en Ubuntu. <br><br>  Por ejemplo (una <b><u>broma famosa, ¬°no corras!</u></b> ) <br><br><pre> <code class="plaintext hljs">$ sudo rm -rf --no-preserve-root</code> </pre> <br>  Sin embargo, dado que soy patol√≥gicamente flojo, entonces, al iniciar sesi√≥n en Raspbian, o en el mismo Ubuntu, escribo: <br><br><pre> <code class="plaintext hljs">$ sudo bash</code> </pre> <br>  Y recibo la invitaci√≥n #, ya con derechos elevados.  Entonces yo trabajo. <br>  Estrictamente hablando, hacerlo no es bueno, pero en la etapa de la configuraci√≥n inicial del sistema ahorra mucho tiempo. <br><br>  En lo sucesivo, si los comandos anteriores est√°n precedidos por #, deben ejecutarse bajo superusuario.  Si con $, entonces debajo del usuario (generalmente se indica arriba debajo de cu√°l). <br><br><h2>  2. Instalando el software necesario "como m√≠nimo", probando la conexi√≥n </h2><br><h4>  2.1 Configurar red </h4><br>  Para hacer esto, ejecute la utilidad administrativa ejecutando el comando: <br><br><pre> <code class="plaintext hljs"># raspi-config</code> </pre> <br><img src="https://habrastorage.org/webt/cl/ds/fb/cldsfbbpwcg-xln0ezbmc54refm.png"><br><br>  (La navegaci√≥n se realiza mediante flechas, tabulaci√≥n, Intro - elecci√≥n, ESC - retorno) <br>  Vaya a <b>Opciones de red</b> . <br><br>  Establezca el nombre del equipo (nombre de <b>host del</b> punto <b>N1</b> ), por ejemplo, <b>TERM1</b> . <br><br>  Si la computadora est√° conectada a la red con un cable Ethernet y recibe una direcci√≥n DHCP, entonces no es necesario hacer nada m√°s. <br><br>  Si necesita configurar una red WiFi, h√°galo (punto <b>N2 Wi-Fi</b> ).  Elige tu pais.  <b>El nombre de la red</b> deber√° ingresarse manualmente; no se proporciona una descripci√≥n general.  Nosotros especificamos la <b>contrase√±a</b> . <br><br>  Luego <b>Finalizar -&gt; Finalizar</b> . <br><br>  Reiniciar a pedido, o con el comando: <br><br><pre> <code class="plaintext hljs"># reboot</code> </pre> <br>  Despu√©s de volver a iniciar sesi√≥n, aseg√∫rese de tener acceso a Internet. <br><br><pre> <code class="plaintext hljs"># ping 8.8.8.8</code> </pre> <br><h4>  2.2 Sistema de actualizaci√≥n </h4><br>  Actualizar informaci√≥n sobre paquetes disponibles. <br><br><pre> <code class="plaintext hljs"># apt-get update</code> </pre> <br>  Ahora actualice el sistema (Opcional, pero altamente deseable. Puede hacerse m√°s tarde). <br><br><pre> <code class="plaintext hljs"># apt-get upgrade</code> </pre> <br>  Esta etapa puede llevar mucho tiempo (tengo unos 15 minutos), porque se actualiza el gestor de arranque binario RPi, que descomprime muchos archivos peque√±os en la tarjeta SD. <br><blockquote>  Tenga en cuenta que casi inmediatamente despu√©s de que se complete la descarga y comience el desempaquetado, alg√∫n paquete desagradable le pedir√° que presione "q", deteniendo el proceso.  Tendr√° que hacer clic antes de distraerse con otras cosas para esperar. <br></blockquote>  Al final de la actualizaci√≥n, debe reiniciar <br><br><pre> <code class="plaintext hljs"># reboot</code> </pre><br><h4>  2.3 Instalar la configuraci√≥n regional y el dise√±o de Rusia </h4><br>  De nuevo en la utilidad administrativa: <br><br><pre> <code class="plaintext hljs"># raspi-config</code> </pre> <br>  Siga las <b>Opciones de localizaci√≥n</b> , all√≠: <br><br><ol><li>  <b>Cambie la</b> <b>configuraci√≥n</b> <b>regional</b> , elimine * de <b>en-GB.UTF-8</b> e instale enfrente de <b>ru-RU.UTF-8</b> .  Confirmamos, y en la siguiente ventana lo seleccionamos como el principal. </li><li>  <b>Cambie la zona horaria</b> y seleccione la zona <b>horaria de</b> su pa√≠s y ciudad. </li><li>  <b>Cambie la distribuci√≥n del teclado</b> , hay <b>PC gen√©rica de 105 teclas (Intl)</b> ‚Üí <b>Otro</b> ‚Üí <b>Ruso</b> ‚Üí <b>Ruso</b> ‚Üí <b>Control + May√∫s</b> (o Alt + May√∫s, si lo desea, para cambiar la distribuci√≥n) ‚Üí <b>Sin conmutador temporal</b> ‚Üí <b>Alt Alt (AltGr)</b> ‚Üí <b>Sin tecla de composici√≥n</b> . </li></ol><br>  Confirmar y salir - <b>Finalizar</b> ‚Üí <b>Finalizar</b> . <br><br>  Dejamos la utilidad de administraci√≥n, ejecute el comando: <br><br><pre> <code class="plaintext hljs"># dpkg-reconfigure console-setup</code> </pre> <br>  seleccione <b>UTF-8</b> ‚Üí <b>Adivina el conjunto de caracteres √≥ptimo</b> ‚Üí <b>Deje que el sistema seleccione ...</b> (abajo) ‚Üí <b>8x16</b> . <br><br>  Las fuentes deber√≠an volverse visualmente m√°s delgadas, pero lo principal es que ahora admiten el alfabeto cir√≠lico. <br><br>  Reiniciamos, iniciamos sesi√≥n, probamos el dise√±o en ingl√©s, el cambio y el dise√±o en ruso. <br><br><h4>  2.4 Determinado con software auxiliar y editor </h4><br>  Para trabajar con archivos, navegar por la estructura de carpetas y editar archivos, realmente me gusta <b>Midnight Commander</b> , por lo tanto: <br><br><pre> <code class="plaintext hljs"># apt-get install mc</code> </pre><br>  Lo ejecuto bajo los derechos de root, y la primera vez que uso el editor (tecla F4 en alg√∫n archivo) selecciono <b>mcedit</b> (punto 2). <br><br>  Por supuesto, puede editar archivos con las herramientas que elija.  Por ejemplo, usando nano, o incluso VIM. <br><br><h4>  2.5 Instalar el servidor ssh </h4><br><pre> <code class="plaintext hljs"># apt-get install ssh</code> </pre> <br>  Edici√≥n / etc / ssh / sshd_config.  Descomente la l√≠nea: <br><br><pre> <code class="plaintext hljs">ListenAddress 0.0.0.0</code> </pre> <br>  Desbloquear carga autom√°tica <br><br><pre> <code class="plaintext hljs"># systemctl enable ssh.service</code> </pre> <br>  Reiniciar el servicio <br><br><pre> <code class="plaintext hljs"># systemctl restart ssh.service</code> </pre> <br>  Descubrimos la direcci√≥n IP con el comando <br><br><pre> <code class="plaintext hljs"># ifconfig</code> </pre> <br>  Y ahora podemos conectarnos al dispositivo de forma remota desde la computadora de origen a trav√©s de SSH (en Windows Personalmente me gusta el cliente <b>PuTTY</b> SSH) para configurar desde una estaci√≥n de trabajo conveniente y poder copiar y pegar los textos de este art√≠culo a las configuraciones.  Les recuerdo que el inicio de sesi√≥n es <b>pi</b> , no root. <br><br><img src="https://habrastorage.org/webt/n7/rf/dp/n7rfdpupnveaxml-qs16hyjmmnw.png"><br><br>  Otras acciones que recomendar√≠a hacer exactamente a trav√©s de SSH, a menos que se indique lo contrario. <br><br><h4>  2.6 Mover particiones vol√°tiles a discos virtuales </h4><br>  Por ejemplo, <b>/ tmp</b> y <b>/ var / log</b> , para: <br><br><ol><li>  el sistema no agudiz√≥ una tarjeta SD, </li><li>  hab√≠a menos posibilidades de que el sistema de archivos ra√≠z se desmoronara durante un corte de energ√≠a, </li><li>  para que en un futuro lejano, los registros no obstruyan el espacio libre en el mapa. </li></ol><br>  Para hacer esto, agregue l√≠neas a <b>/ etc / fstab</b> : <br><br><pre> <code class="plaintext hljs">tmpfs /var/log tmpfs defaults,noatime,nosuid,mode=0755,size=100m 0 0 tmpfs /tmp tmpfs defaults,noatime,nosuid,size=100m 0 0</code> </pre><br>  No olvide poner un salto de l√≠nea al final del archivo. <br><br>  Aqu√≠, a las secciones <b>/ var / log</b> y <b>/ tmp</b> se les asignan 100 mb de memoria cada una (se usar√° solo cuando est√© llena).  Gigabyte Pi, que se usa solo para RDP, estos gastos no obstaculizar√°n nada. <br><br>  Reinicie el sistema y luego ejecute el comando: <br><br><pre> <code class="plaintext hljs"># df</code> </pre> <br>  y aseg√∫rese de que las particiones est√©n montadas en tmpfs (3 y 4 columnas pueden diferir): <br><br><pre> <code class="plaintext hljs">tmpfs 102400 8 102392 1% /tmp tmpfs 102400 224 102176 1% /var/log</code> </pre><br><h4>  2.7 Obtendremos el usuario bajo el cual, posteriormente, lanzaremos autom√°ticamente el shell gr√°fico </h4><br>  Ejecute el comando: <br><br><pre> <code class="plaintext hljs"># adduser user</code> </pre> <br>  Establecer una contrase√±a arbitraria.  Se pueden omitir todo tipo de nombres y tel√©fonos.  Confirmar <br><br><h4>  2.8 Instalar X-server en una versi√≥n m√≠nima </h4><br>  Ejecute el comando: <br><br><pre> <code class="plaintext hljs"># apt-get install xserver-xorg xinit xterm x11-xserver-utils</code> </pre> <br>  Esto puede demorar unos 5 minutos. <br><br>  Ahora debe <u>sentarse en el terminal f√≠sico</u> (en el sentido de un monitor, teclado y mouse conectados directamente a la Pi), iniciar sesi√≥n como usuario y ejecutar el comando: <br><br><pre> <code class="plaintext hljs">$ startx</code> </pre> <br>  La siguiente imagen deber√≠a aparecer en la pantalla, lo que significa que x-server se ha instalado correctamente y puede continuar. <br><br><img src="https://habrastorage.org/webt/c1/na/qb/c1naqbmygzqagi02s3dm5exinn0.png"><br><br>  Pasamos el cursor sobre el cursor (es importante, ya que no hay una ventana que forme un marco y un t√≠tulo de ventana, y la ventana simplemente no recibir√° texto sin un foco expl√≠cito) y escriba <br><br><pre> <code class="plaintext hljs">$ exit</code> </pre> <br>  para volver <br><br><h4>  2.9 Instalar software para trabajar con escritorio remoto </h4><br>  Personalmente me gusta <b>rdesktop</b> .  Por supuesto, no carece de matices (consulte la secci√≥n "Extracci√≥n de rastrillo").  Hay alternativas como <b>xfreerdp</b> , <b>remmina</b> , etc., aunque tambi√©n se quejan de ellas. <br><br>  Dar√© un ejemplo para el primero. <br><br><pre> <code class="plaintext hljs"># apt-get install rdesktop</code> </pre> <br>  Cree un script que ejecute rdesktop en pantalla completa.  En el directorio <b>/ home / user,</b> cree el archivo <b>runrdp</b> (preferiblemente como usuario): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash rdesktop &lt;  IP  &gt; -u &lt;   &gt; -f -z</span></span></code> </pre><br>  Si ha elegido otro cliente RDP, escriba aqu√≠ la l√≠nea de comando o use la masa de par√°metros adicionales que tiene rdesktop.  Incluso puede codificar la contrase√±a para iniciar sesi√≥n autom√°ticamente. <br><br>  Debe poner los derechos para ejecutar este script, y si lo cre√≥ como root, entonces el propietario es el usuario. <br><br><pre> <code class="plaintext hljs"># chmod 755 /home/user/runrdp # chown user:user /home/user/runrdp</code> </pre><br>  Ahora, vamos a la consola f√≠sica debajo del usuario, inicie startx, en el terminal gr√°fico abierto (vea la figura anterior), escriba: <br><br><pre> <code class="plaintext hljs">$ ./runrdp</code> </pre> <br>  La ventana para conectarse al escritorio remoto debe aparecer en la pantalla. <br><br><img src="https://habrastorage.org/webt/av/mt/y8/avmty8dt4vclbpt5yrkw-3mmmlc.png"><br><br>  Si: <br><br>  a) la consola muestra algo sobre el error CredSSP, <br>  b) el modo de pantalla completa en FullHD deja bordes oscuros (como en la foto-foto No. 4 de este art√≠culo, aunque hay un modo de consola, pero puede ver los bordes) <br>  luego vea la secci√≥n Extracci√≥n de rastrillo. <br><br>  Y si todo est√° bien, cancele el inicio de sesi√≥n del sistema (Esc, o el elemento de men√∫ "Desactivar"), abandone el terminal x, escriba exit, vuelva a la consola. <br><br><h2>  3. Automatizaci√≥n de las sesiones de elevaci√≥n. </h2><br>  Si todos los pasos anteriores funcionan, entonces es hora de poner todo junto. <br><br>  Para hacer esto, haremos que cuando el sistema se inicie, el usuario inicie sesi√≥n autom√°ticamente en el terminal, inicie el servidor X y se conecte al RDP que se encuentra debajo.  Por lo tanto, la contrase√±a se solicitar√° solo para la sesi√≥n RDP, lo que salvar√° a las mentes inmaduras de las habilidades innecesarias de domar Linux. <br><br><h4>  3.1 RDP infinito </h4><br>  Creemos un script que, al iniciar el servidor x, intente sin cesar abrir una sesi√≥n RDP. <br>  Para hacer esto, en el directorio <b>/ home / user,</b> cree un archivo de ejecuci√≥n autom√°tica al comienzo de la sesi√≥n <b>X.xinitrc</b> , los siguientes contenidos: <br><pre> <code class="bash hljs">setxkbmap -option terminate:ctrl_alt_bksp <span class="hljs-comment"><span class="hljs-comment">#    Ctrl-Alt-BkSpace setterm -blank 0 -cursor off #   xsetroot -solid gray #      while /bin/true; do ./runrdp done</span></span></code> </pre> <br><h4>  3.2 servidor Infinite X </h4><br>  Arreglaremos un script que define el inicio autom√°tico de los programas y la configuraci√≥n del perfil durante el inicio de sesi√≥n de la consola para que la sesi√≥n x se inicie autom√°ticamente, pero solo cuando el usuario inicie sesi√≥n en el primer terminal. <br><br><blockquote>  Gracias a <a href="https://habr.com/ru/users/gecube/">gecube</a> por recordarme que desactive el protector de pantalla.  Por defecto, es una pantalla negra que, para la mayor√≠a de los monitores modernos, es bastante da√±ina. </blockquote><br><br>  <b>Editemos /home/user/.profile</b> , <u><b>agregando</b></u> las siguientes l√≠neas all√≠: <br><br><pre> <code class="bash hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DISPLAY</span></span></span><span class="hljs-string">"</span></span> ] &amp;&amp; [ $(tty) = <span class="hljs-string"><span class="hljs-string">"/dev/tty1"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> startx clear <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" 5    "</span></span> sleep 5 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br><h4>  3.3 Prueba intermedia de un grupo </h4><br>  Reiniciamos Pi, nos sentamos en la terminal, iniciamos sesi√≥n como usuario usuario.  Obtenemos la ventana de inicio de sesi√≥n en la pantalla, como en la figura anterior. <br><br>  Intentamos negarnos a ingresar la contrase√±a (esc, o depende de la versi√≥n de Windows): obtenemos la misma ventana para el inicio de la sesi√≥n (es decir, nuestro script de 3.1 se vuelve a conectar constantemente). <br><br>  Esperamos aproximadamente un minuto (dependiendo del servidor) sin tocar el teclado y el mouse; la ventana para iniciar la sesi√≥n deber√≠a apagarse pronto (la sesi√≥n RDP en la etapa de ingreso de contrase√±a sin actividad caduca en el tiempo de espera).  Por supuesto, debido a la cl√°usula 3.1, se volver√° a conectar. <br><br>  Ahora presiona <b>Ctrl + Alt + BkSp</b> .  La sesi√≥n X debe interrumpirse, se mostrar√° una inscripci√≥n sobre la espera de 5 segundos, despu√©s de lo cual la sesi√≥n de la consola finalizar√° tambi√©n.  La pantalla le pedir√° que ingrese al terminal con un nombre de usuario y contrase√±a. <br><br>  Si todo es as√≠, excelente. <br><br>  Solo necesitamos iniciar sesi√≥n autom√°ticamente en el terminal. <br><br><h4>  3.4 Autologina repetitiva de <s>naranja</s> infinitamente <s>deliciosa</s> en tty1 </h4><br>  Para hacer esto, desde la ra√≠z, cree el archivo <b>/etc/systemd/system/getty@tty1.service.d/autologin.conf</b> con los siguientes contenidos: <br><br><pre> <code class="plaintext hljs">[Service] ExecStart= ExecStart=-/sbin/agetty --autologin user --noclear %I 38400 linux</code> </pre><br>  Entonces: <br><br><pre> <code class="plaintext hljs">#systemctl enable getty@tty1.service</code> </pre> <br>  Reiniciamos, nos aseguramos de que la consola f√≠sica inicie sesi√≥n autom√°ticamente como usuario, se inicie el servidor X y se abra la sesi√≥n RDP, y luego todo estar√° como en 3.3. <br>  Presione Ctrl + Alt + BkSp, espere la reconexi√≥n. <br><br>  Ingresamos al sistema, prueba de conmutaci√≥n, el trabajo de dise√±os.  Si algo est√° mal, vea la secci√≥n 4. <br><br>  <b>Esto completa la configuraci√≥n.</b> <br><br>  Se debe indicar a los usuarios que si algo sale mal (la pantalla se pone en blanco, algo se congela, etc.), primero deben presionar Ctrl + Alt + BkSp y esperar la reacci√≥n. <br><br>  Consulte tambi√©n la secci√≥n 5 sobre montaje autom√°tico de USB. <br><br><h2>  4. Extracci√≥n de rastrillo </h2><br>  Dado que este es un OpenSource, la extracci√≥n de rastrillos es un proceso desesperado y continuo.  Tratar√© de describir el rastrillo principal posible, pero qui√©n sabe qu√© nos espera.  Yo, personalmente, nunca tuve suerte, y ninguna instrucci√≥n me funcion√≥ sin horas de b√∫squeda adicional. <br><br><h4>  4.1 Problemas con el uso incompleto de la resoluci√≥n de pantalla </h4><br>  S√≠ntomas: en casos con algunos equipos (adaptadores HDMI-DSUB, algunos monitores), raspbian no utiliza toda la resoluci√≥n disponible del monitor Full-HD.  Los campos oscuros permanecen entre la informaci√≥n relevante y el borde f√≠sico de la pantalla. <br><br>  Se resuelve de la siguiente manera: <br><br>  Edite <b>/boot/config.txt</b> , encuentre la l√≠nea <br><br><pre> <code class="plaintext hljs"># disable_overscan = 1</code> </pre> <br>  y descomentarlo. <br><br>  Reiniciar <br><br>  Ahora los campos oscuros de los bordes de la pantalla deben eliminarse tanto en la consola como en los modos gr√°ficos. <br><br><h4>  4.2 Problemas con el cursor del mouse al conectar rdesktop a servidores RDP modernos </h4><br>  Esto se refiere principalmente a Windows 2012, 2016, Windows 10, donde se incluye el tema del cursor. <br><br>  S√≠ntomas: el cursor desaparece, est√° mal dibujado, despu√©s de cambiar a no est√°ndar (reloj de arena, s√≠mbolo I, flechas de ampliaci√≥n de ventana, etc.) se olvida de cambiar a una flecha normal. <br><br>  Soluci√≥n: como usuario del servidor al que se est√° conectando, vaya a las propiedades del mouse a trav√©s del panel de control, restablezca el tema a "No" y apague las sombras debajo del puntero. <br><br><img src="https://habrastorage.org/webt/ek/na/rc/eknarc92omul5c37i4ta4lfenmc.png"><br><br>  Los cursores deben llegar a la obediencia. <br><br><h4>  4.3.  Problemas de codificaci√≥n con rdesktop </h4><br>  S√≠ntomas: en algunos casos, a trav√©s de la conexi√≥n RDP, los caracteres especiales se escriben incorrectamente en el sistema remoto: tildes, barras, comillas, puntos, barras verticales.  Especialmente comience a enfurecer los puntos, porque a menudo se escriben a m√°quina. <br><br>  Soluci√≥n: <br><br>  En <b>/ usr / share / rdesktop / keymaps</b> cree un archivo sin <b>procesar</b> y ll√©nelo con el siguiente contenido: <br><br><pre> <code class="plaintext hljs">include common map 0x419 grave 0x29 asciicircum 0x07 shift backslash 0x2b bar 0x2b shift apostrophe 0x28 greater 0x34 shift less 0x33 shift</code> </pre><br>  Agregue el argumento <b>sin</b> formato <b>-k</b> al s√≠mbolo del sistema rdesktop en el script <b>/ home / user / runrdp</b> .  Por ejemplo: <br><br><pre> <code class="bash hljs">rdesktop 10.0.0.1 -u user -k raw</code> </pre> <br>  Reinicie la sesi√≥n en la terminal con Ctrl + Alt + BkSp o generalmente reinicie el Pi. <br><br>  Ingrese RDP, pruebe todos los caracteres especiales, incluidos  con Shift en la l√≠nea num√©rica del teclado y las teclas laterales a la izquierda y derecha de la secci√≥n de letras, con Shift y sin (comillas, dos puntos, signos de puntuaci√≥n, barras, etc.).  Todo deber√≠a funcionar. <br><br><h4>  4.4.  Cuando intenta iniciar rdesktop, la sesi√≥n no se abre, el error CredSSP se muestra en la consola </h4><br><pre> <code class="bash hljs">CredSSP: Initialize failed, <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> you have correct kerberos tgt initialized ? Failed to connect, CredSSP required by server.</code> </pre><br>  El sistema de destino requiere un algoritmo de autenticaci√≥n de cliente moderno, que rdesktop normalmente no puede hacer. <br><br>  Opciones de soluci√≥n: <br><br><ol><li>  Deshabilite la autenticaci√≥n del servidor reduciendo la configuraci√≥n de seguridad.  B√°sicamente, en entornos donde Pi est√° tratando de usar RDP como cliente, esto no deber√≠a ser un gran problema de seguridad. </li><li>  Use otro cliente, por ejemplo freerdp, remmina, reemplazando el contenido del script runrdp con la l√≠nea de inicio de este cliente. </li><li>  Instala y configura el cliente kerberos, pero de alguna manera todo es complicado all√≠.  Si quieres probar, <a href="https://github.com/rdesktop/rdesktop/issues/71" rel="nofollow">comienza aqu√≠</a> . </li></ol><br><h4>  4.5.  Encender y apagar el dispositivo </h4><br>  Raspberry Pi no tiene un bot√≥n de apagado.  Esto es malo  Resulta que no hay una forma efectiva de encenderlo y apagarlo.  Mucho se ha escrito sobre esto, intentar√© resumirlo brevemente: <br><br><ol><li>  Por un lado, no podemos apagar el dispositivo, apagando solo el monitor.  Estrictamente hablando, donde pongo el RPi, todo est√° hecho.  En general, el dispositivo casi no se calienta, no consume electricidad, no hace ruido.  El monitor, antes de salir, el usuario se apagar√°. </li><li>  Puede configurar la noche libre con Cron, pero luego para encender el RPi por la ma√±ana, el usuario tendr√° que hacer malabarismos con el cable o la fuente de alimentaci√≥n. </li><li>  Puede resolver este problema comprando un cable de alimentaci√≥n USB con un bot√≥n abierto (para encender el RPi, solo necesita abrir el circuito brevemente con un bot√≥n).  120 rublos es todo un placer.  Pero aqu√≠, los usuarios tendr√°n el apagado autom√°tico de la misma manera que el dispositivo se bloquear√°.  Dado que hemos movido las particiones vol√°tiles a tmpfs, es probable que no haya problemas, pero nadie est√° seguro de que el usuario no se registrar√° en la ma√±ana debido al colapso de rootfs.  No funcion√≥, por as√≠ decirlo, la soluci√≥n "clav√≥". </li><li>  Hay soluciones con un bot√≥n adicional que se incluye en el puerto GPIO y enciende / apaga el dispositivo suavemente (de la manera adecuada).  Pero las granjas colectivas al edificio: es pasar horas y aumentar los costos de producci√≥n. </li><li>  Sin embargo, para el RPi incluso hay un caso con un bot√≥n incorporado (los chinos lo tienen todo).  Pero personalmente a√∫n no lo he probado. </li><li>  Pienso en encender el dispositivo a trav√©s de un interruptor en el cable USB y apagarlo mediante una tecla de acceso r√°pido (como Ctrl + Alt + Shift + P), que es monitoreado por el servicio del sistema, pero no es posible trabajar con esta soluci√≥n. </li></ol><br><h4>  4.6 Reconexiones m√∫ltiples al servidor RDP </h4><br>  En el esquema actual, el dispositivo cliente se conectar√° al servidor usando el protocolo RDP, mostrar√° la ventana de ingreso de usuario y contrase√±a, y si el usuario no ingresa nada, luego de un tiempo la sesi√≥n se reiniciar√° y el cliente RDP comenzar√° nuevamente, y as√≠ hasta el infinito. <br><br><blockquote>  En los comentarios, el usuario de <a href="https://habr.com/ru/users/Mnemonik/">Mnemonik</a> <a href="https://habr.com/ru/post/479504/">dijo</a> que con m√∫ltiples reconexiones permanentes, Windows Server se queda sin memoria, y dio un ejemplo de c√≥mo resolver el problema. <br></blockquote><br>  Yo traer√© el m√≠o.  Modificaremos el script .xinitrc para que despu√©s de completar el siguiente proceso de rdesktop, se muestre un cuadro de di√°logo modal que evite reiniciar hasta que se haga clic en el bot√≥n Aceptar. <br><br>  Para hacer esto, puede usar el xmessage regular incluido en el paquete xorg, pero las ventanas creadas por √©l son tan feas que mi monitor se est√° agrietando.  Adem√°s, esta aplicaci√≥n no es compatible con el idioma ruso, y activarlo es otra tarea. <br><br>  Estoy impresionado por gxmessage, desprovisto de este inconveniente, pero extrae GTK y 25 megabytes de otras dependencias, que tampoco me gustan.  Bueno, escojamos un mal menor: <br><pre> <code class="plaintext hljs">apt-get install gxmessage</code> </pre> <br>  Cambie el script .xinitrc: <br><pre> <code class="bash hljs">setxkbmap -option terminate:ctrl_alt_bksp <span class="hljs-comment"><span class="hljs-comment">#    Ctrl-Alt-BkSpace setterm -blank 0 -cursor off #   xsetroot -solid gray #      while /bin/true; do ./runrdp gxmessage --center " OK      RDP" done</span></span></code> </pre> <br>  Ahora, entre los intentos de rdesktop de conectarse al servidor, se mostrar√° un mensaje correspondiente en nuestra pantalla, y no habr√° un "bombardeo" constante del servidor. <br><br>  Una vez finalizado el script f√°cilmente, puede verificar previamente la disponibilidad de red del servidor y mostrar un mensaje sobre la reconexi√≥n debido a la falta de comunicaci√≥n. <br><br><h4>  4.7 Configuraci√≥n de NTP </h4><br><blockquote>  Gracias a <a href="https://habr.com/ru/users/gecube/">gecube</a> por recordarme este momento.  Te√≥ricamente, el tiempo en el dispositivo puede "flotar" con el tiempo, lo que puede causar dificultades con la autenticaci√≥n y quiz√°s otros problemas. <br></blockquote>  Para solucionar este peque√±o problema, debe instalar el programa ntpdate y registrar en cron una tarea para actualizar la hora cada hora (el dispositivo necesitar√° acceso a Internet): <br><br><pre> <code class="plaintext hljs"># apt-get install ntpdate # echo "0 * * * * root ntpdate pool.ntp.org" &gt; /etc/cron.d/ntp</code> </pre><br>  Si tiene un servidor NTP local en su red, reemplace el nombre de host con el suyo. <br><h2>  5 Opcional: conectar, desconectar y reenviar dispositivos USB </h2><br>  En realidad, esta secci√≥n incluye dos etapas cruciales.  En primer lugar, gestionar dispositivos USB para garantizar su montaje autom√°tico y, al menos, un desmontaje controlado por el usuario.  Y en segundo lugar, reenv√≠e los dispositivos conectados al terminal para que sean accesibles a trav√©s de la red. <br><br><h4>  5.1.  Configuraci√≥n de montaje autom√°tico </h4><br>  Los dispositivos USB enchufables con sistemas de archivos se montar√°n en subdirectorios del directorio / media.  Luego reenviaremos el mismo directorio a rdesktop. <br><br>  Necesitaremos el paquete pmount. <br><br><pre> <code class="plaintext hljs"># apt-get install pmount.</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n necesitaremos crear una regla para udev que capture los dispositivos conectados y los monte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/udev/rules.d</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cree el archivo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80-usbstick.rules</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el siguiente contenido:</font></font><br><br><pre> <code class="plaintext hljs">ACTION=="add", KERNEL=="sd[az][0-9]", TAG+="systemd", ENV{SYSTEMD_WANTS}="usbstick-handler@%k"</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora cree un servicio para systemd. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ lib / systemd / system,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cree el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archivo usbstick-handler @ .service</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el siguiente contenido:</font></font><br><br><pre> <code class="plaintext hljs">[Unit] Description=Mount USB sticks BindsTo=dev-%i.device After=dev-%i.device [Service] Type=oneshot RemainAfterExit=yes ExecStart=/usr/bin/pmount --umask 000 --noatime -w --sync /dev/%i /media/%i ExecStop=/usr/bin/pumount /dev/%i</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / local / bin,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cree el archivo de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dispositivos de desmontaje</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el siguiente contenido:</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash for folder in /media/*; do pumount $folder echo "Unmounted $folder" done</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Asignarle los derechos para correr. </font></font><br><br><pre> <code class="plaintext hljs">#chmod 755 unmount-devices</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agregue un usuario usuario al grupo plugdev para que pueda usar este script (pumount permite a los miembros de este grupo montar y desmontar dispositivos) </font></font><br><br><pre> <code class="plaintext hljs"># adduser user plugdev</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reiniciar Si todo se hace correctamente, al insertar la unidad flash en el puerto USB de la mini PC, despu√©s de unos segundos, la carpeta sda1, etc., deber√≠a aparecer en el directorio / media, donde se montar√° la unidad flash para leer y escribir. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los dispositivos se montan con el indicador ‚Äìsync, por lo tanto, en teor√≠a, si extrae el dispositivo cuando se completa la operaci√≥n de escritura, no deber√≠a haber ning√∫n problema con la seguridad de los datos, sin embargo, el indicador de extracci√≥n insegura permanecer√° en el dispositivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probamos este punto (inserte la unidad flash USB, retire la unidad flash USB, luego inserte el dispositivo en la PC con Windows y corrija los posibles errores). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora inserte el dispositivo en el Pi nuevamente, aseg√∫rese de que la carpeta / media / sda1 vuelva a aparecer.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecute dispositivos de desmontaje desde debajo del usuario usuario. </font><font style="vertical-align: inherit;">sda1 de / media deber√≠a desaparecer, y el dispositivo deber√≠a desmontarse de forma segura y no dar un error cuando se inserta en una PC con Windows.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5.2 Reenviar el directorio / media por RDP y proporcionar dispositivos de montaje autom√°tico </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ home / user / runrdp</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agregamos un argumento adicional a la l√≠nea de comando rdesktop:</font></font><br><br><pre> <code class="bash hljs">rdesktop ‚Ä¶... -r disk:USB=/media/</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora edite </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/home/user/.profile</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , agregando una llamada a dispositivos de desmontaje.</font></font><br><br><pre> <code class="bash hljs">... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DISPLAY</span></span></span><span class="hljs-string">"</span></span> ] &amp;&amp; [ $(tty) = <span class="hljs-string"><span class="hljs-string">"/dev/tty1"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> startx clear unmount-devices <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" 5    "</span></span> sleep 5 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reiniciar </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora, si estamos trabajando en una sesi√≥n RDP, y necesitamos conectar un disco USB al Pi, simplemente lo insertamos y vamos a Mi computadora, donde vemos aproximadamente la siguiente imagen. </font></font><br><br><img src="https://habrastorage.org/webt/vu/l_/qu/vul_quyi50ig54vjbewcwgpa83w.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Podemos usar estos dispositivos libremente, aparecer√°n como carpetas (sda1-xx, sdb1-xx, etc.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si necesitamos eliminar el dispositivo, simplemente presione Ctrl + Alt + BkSp. La sesi√≥n se desconectar√° (por lo tanto, cualquier copia en el dispositivo debe interrumpirse, incluso si se realiz√≥), la consola mostrar√° el desmontaje de los dispositivos (en este momento </font><font style="vertical-align: inherit;">, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todos se</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> retiraron de forma segura) y un mensaje esperando 5 segundos antes de volver a conectarse a RDP.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luego, despu√©s de reconectarse, puede ingresar una contrase√±a y continuar trabajando desde el mismo punto, pero los dispositivos conectados previamente se desmontar√°n. </font><font style="vertical-align: inherit;">En este punto, se pueden eliminar f√≠sicamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto completa el paso de configuraci√≥n.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Clonar el sistema a otro Rpi </font></font></h2><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.A Si se configura de forma independiente </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si se eliminan todos los rastrillos, el dispositivo funciona de manera aceptable, entonces puede extender el ensamblaje a otros dispositivos. </font><font style="vertical-align: inherit;">Si son del mismo tipo, entonces no hay necesidad de repetir el proceso desde cero. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inserte la tarjeta SD (encontr√© 16 gigabytes) en la tarjeta adaptadora y col√≥quela en el puerto USB de Raspberry. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si ya ha configurado el montaje autom√°tico desde la √∫ltima secci√≥n, ejecute el script</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># unmount-devices</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que desmonte la tarjeta SD reci√©n conectada, que, por supuesto, se mont√≥ inmediatamente en / media / sdxx. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora ejecute el comando lsblk y mire la lista de dispositivos:</font></font><br><br><pre> <code class="plaintext hljs">sda 8:0 1 14.6G 0 disk ‚îî‚îÄsda1 8:1 1 14.6G 0 part mmcblk0 179:0 0 7.4G 0 disk ‚îú‚îÄmmcblk0p1 179:1 0 256M 0 part /boot ‚îî‚îÄmmcblk0p2 179:2 0 7.2G 0 part /</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sda</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es obviamente nuestra nueva tarjeta, y </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mmcblk0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es una </font><font style="vertical-align: inherit;">tarjeta de </font><font style="vertical-align: inherit;">sistema. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecutar:</font></font><br><br><pre> <code class="plaintext hljs">dd if=/dev/mmcblk0 of=/dev/sda bs=4M</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y espere el resultado, que se espera en aproximadamente media hora (para una tarjeta de 8GB). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s de eso, inserte en otra Raspberry, cambie el nombre de host, el nombre de usuario en el script runrdp y repita seg√∫n sea necesario.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.B Descargue la imagen terminada </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si, por supuesto, conf√≠as en m√≠, puedes usar la imagen preparada por m√≠ reconfigur√°ndola ligeramente. Cualquier marcador, herramientas de telemetr√≠a, etc. - No agregu√©, no es Windows 10, pero no soy Microsoft, y tampoco creo en la perspectiva econ√≥mica de la miner√≠a oculta de bitcoins en RPi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La imagen se compil√≥ de acuerdo con las instrucciones y se compact√≥ para su uso en una tarjeta SD con un tama√±o m√≠nimo de 2 GB chinos (deshonestos) (1977614336 bytes). Adem√°s, la parte llena de la imagen generalmente ocupa los primeros 1966080000 bytes, que deber√≠an caber incluso en la tarjeta SD m√°s china. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para hacer esto: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Descargue el archivo </font></font><a href="https://dropmefiles.com/ljUGS" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el enlace</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (MD5: 0B5033A9CA12BA8299340BC482111998) y descomprima el archivo de imagen.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) C√≥pielo en la tarjeta SD, utilizando, por analog√≠a, las instrucciones del p√°rrafo 1.2. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) Inicie el sistema, espere a que aparezca la pantalla gr√°fica y presione Ctrl + Alt + F2 para ir a la consola. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicie sesi√≥n como usuario pi, contrase√±a 111. Ejecute:</font></font><br><br><pre> <code class="plaintext hljs">$ sudo bash</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Siga los pasos 1.4, 2.1, aseg√∫rese de que Internet funcione (comando ping, por ejemplo). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5) Ejecute raspi-config, vaya a Opciones avanzadas, seleccione Expandir sistema de archivos (para expandir la imagen del sistema a todo el espacio disponible en la tarjeta SD) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6) Editar / inicio / usuario / runrdp, reemplazando el nombre de host del servidor con el nombre o IP la direcci√≥n de su servidor y el nombre de usuario "usuario" con el nombre del usuario bajo el cual el operador debe conectarse al servidor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7) Reinicie nuevamente y verifique la operaci√≥n.</font></font><br><br><h2>  Conclusi√≥n </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eso es todo, gracias por su atenci√≥n. </font><font style="vertical-align: inherit;">Espero que esta informaci√≥n sea √∫til para alguien. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desafortunadamente, cubrir todo en un art√≠culo es extremadamente dif√≠cil. </font><font style="vertical-align: inherit;">Si hay comentarios positivos, escribir√© c√≥mo es conveniente reenviar las impresoras desde este conjunto. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS 12/11/2019. </font><font style="vertical-align: inherit;">Gracias a los colegas (gecube, Mnemonik, mkovalevskyi, SannX) por los consejos y las ediciones. </font><font style="vertical-align: inherit;">Cambios realizados:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se agreg√≥ un comando de apagado del protector de pantalla; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> configuraci√≥n NTP agregada; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con respecto al consumo de memoria en el servidor con m√∫ltiples conexiones incompletas de clientes RDP: se agreg√≥ un cuadro de mensaje al script con una pausa. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adem√°s, acabo de probar una tarjeta sacada de RPi3 insert√°ndola en el RPi4 Model B 1Gb reci√©n desempaquetado. </font><font style="vertical-align: inherit;">Todo funciona muy bien sin ninguna soluci√≥n. </font><font style="vertical-align: inherit;">En consecuencia, esta instrucci√≥n tambi√©n es adecuada para RPi 4, y puede ser adecuada para otras modificaciones. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para tal alegr√≠a, agregu√© una imagen descargable (consulte la secci√≥n 6.B), que puede descargar y clonar sin seguir todas las instrucciones.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/479504/">https://habr.com/ru/post/479504/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../479488/index.html">Desde una computadora port√°til: un servidor dom√©stico con alimentaci√≥n redundante al enrutador Mikrotik</a></li>
<li><a href="../479492/index.html">Computaci√≥n sin servidor basada en OpenWhisk, parte 3</a></li>
<li><a href="../479496/index.html">An√°lisis de tareas de WTF en JavaScript</a></li>
<li><a href="../479498/index.html">C√≥mo el tiempo lineal se convierte en Windows en O (n¬≤)</a></li>
<li><a href="../479502/index.html">¬øC√≥mo sobrevivir a la edad de hielo m√°s severa en la historia de la Tierra?</a></li>
<li><a href="../479508/index.html">Antipatterns PostgreSQL: uniones da√±inas y OR</a></li>
<li><a href="../479510/index.html">Revisi√≥n de PocketBook X: un enorme lector de 10.3 pulgadas con una pantalla E Ink Carta Mobius y una carcasa de metal</a></li>
<li><a href="../479512/index.html">MVCC en PostgreSQL-4. Instant√°neas</a></li>
<li><a href="../479514/index.html">Privacidad por dise√±o y privacidad por defecto (protecci√≥n de datos dise√±ada y privacidad predeterminada por GDPR)</a></li>
<li><a href="../479516/index.html">¬øQu√© es la entrop√≠a en el software y c√≥mo gestionarla?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>