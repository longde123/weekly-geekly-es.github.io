<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌳 ✋🏽 👊🏻 Memahami Google Chrome Konversi Fitur HTML ke PDF 👨🏾 ⛔️ 📫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Baru-baru ini, dalam satu startup, saya memecahkan masalah menghasilkan tiket dalam format PDF. Pada saat itu, sebuah situs web dengan setumpuk teknol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Memahami Google Chrome Konversi Fitur HTML ke PDF</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459112/"><p><img src="https://habrastorage.org/webt/nl/zz/on/nlzzon_ar_4p3nuhes4p4cgq2ey.jpeg"></p><br><p>  Baru-baru ini, dalam satu startup, saya memecahkan masalah menghasilkan tiket dalam format PDF.  Pada saat itu, sebuah situs web dengan setumpuk teknologi sudah siap, jadi saya mencari pendekatan yang tidak memerlukan penggunaan alat tambahan.  Pada akhirnya, saya mengusulkan untuk membuat tiket dalam format HTML terlebih dahulu, dan kemudian mengonversi ke PDF menggunakan browser Chrome.  Ternyata, metode ini dapat menghasilkan tidak hanya tiket kaya dihiasi dengan CSS, tetapi juga berbagai laporan dengan grafik di JavaScript.  Dalam artikel ini, saya akan berbicara tentang cara meluncurkan Chrome untuk tujuan ini, memberikan beberapa kiat untuk menyesuaikan CSS, dan juga membahas kerugian dari solusi ini. </p><a name="habracut"></a><br><p>  Opsi-opsi alternatif tidak akan dibahas di sini, karena sudah cukup dituliskan pada mereka, mereka mudah ditemukan, dan mereka adalah alat yang siap pakai, informasi yang lebih baik untuk dilihat di sumber utama - dalam dokumentasi di situs web resmi.  Metode yang diusulkan bukan alat independen dan lebih seperti produk sampingan dari pengembangan beberapa teknologi.  Di segmen Internet berbahasa Rusia, ada sedikit informasi yang terkumpul di dalamnya, jadi saya memutuskan untuk mengisi kekosongan. </p><br><h2 id="pochemu-vybran-imenno-etot-variant">  Mengapa opsi ini dipilih? </h2><br><p>  Keuntungan terbesar adalah bahwa Chrome tidak perlu memperluas tumpukan teknologi untuk menghasilkan PDF.  Pengembang frontend membuat HTML dengan alat pengembangan yang sudah dikenal dan segera melihat hasil kerja antara di browser.  Pada saat yang sama, Chrome mungkin berputar dalam tes dan mentransfernya ke backend tidak sulit.  Juga harus dicatat bahwa pembuat kode dapat mengakses seluruh gudang properti css termasuk Flexbox dan Grid. <br>  Saya akan berbicara tentang kekurangan dan cara untuk mengatasinya selama artikel. </p><br><h2 id="reshaem-zadachu-odnoy-strokoy">  Kami memecahkan masalah dalam satu baris </h2><br><p>  Di baris perintah, kami memanggil Chrome dalam mode tanpa kepala dengan menyimpan halaman dalam pdf: </p><br><pre><code class="bash hljs">chrome --headless --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-gpu --<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>-to-pdf https://google.com</code> </pre> <br><p>  Pengguna Linux mungkin perlu menjalankan <code>chromium-browser</code> alih <code>chromium-browser</code> alih <code>chrome</code> . <br>  Pengguna MAC mungkin merasa terbantu untuk melakukan pra-buat alias: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> chrome=<span class="hljs-string"><span class="hljs-string">"/Applications/Google\\ \\Chrome.app/Contents/MacOS/Google\\ \\Chrome"</span></span></code> </pre> <br><p>  UPDATE: Komentar menjelaskan bahwa pengguna Windows harus secara eksplisit mengatur nama file PDF <code>--print-to-pdf=output.pdf</code> </p><br><p>  Jika Anda sudah memiliki pembuat dokumen HTML, alih-alih <code>https://google.com</code> tentukan URL untuk menerima dokumen ini. </p><br><p>  Buka file <code>output.pdf</code> di direktori lokal dan lihat hasilnya. <br>  Hal pertama yang menarik perhatian Anda adalah keberadaan Header dengan tanggal cetak dan Footer dengan URL dan pagination.  Untuk menghapusnya, Anda perlu menambahkan beberapa aturan CSS.  Aturan-aturan ini tidak mungkin ditambahkan ke <code>google.com</code> , jadi untuk pekerjaan lebih lanjut lebih baik membuat dokumen HTML Anda sendiri. </p><br><h2 id="dobavlyaem-css">  Tambahkan CSS </h2><br><p>  CSS memiliki <code>@page</code> kueri media khusus, yang digunakan untuk mencetak; kami akan mengatur lekukan di dalamnya sehingga Header dan Footer tidak cocok: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">size</span></span>: A4; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0mm</span></span>; }</code> </pre> <br><p>  Metode ini hanya akan berfungsi untuk dokumen satu halaman, saat mencetak dua halaman atau lebih, Footer dengan URL dan penomoran halaman akan tetap berada di bagian bawah.  Anda dapat secara eksplisit meminta Chrome untuk mematikan tampilan Header dan Footer dengan mengatur parameter cetak <code>displayHeaderFooter = False</code> , tetapi saat ini tidak dipindahkan ke antarmuka baris perintah.  Untuk mencapainya, Anda perlu alat untuk mengotomatiskan pekerjaan dengan browser: Selenium atau dalang.  Selanjutnya, saya akan mempertimbangkan opsi pertama, karena proyek saya menggunakan Python. </p><br><h2 id="zapuskaem-chrome-cherez-selenium">  Luncurkan Chrome melalui Selenium </h2><br><p>  Jadi, instal Selenium dengan perintah <code>pip install selenium</code> , unduh driver chrome yang sesuai dengan versi Chrome Anda dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://chromedriver.chromium.org/</a> dan gunakan fungsi <code>get_pdf_from_html</code> dari contoh di bawah ini: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> webdriver <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> selenium.webdriver.chrome.options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json, base64 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pdf_from_html</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path, chromedriver=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'./chromedriver'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, print_options = {})</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#  Chrome webdriver_options = Options() webdriver_options.add_argument('--headless') webdriver_options.add_argument('--disable-gpu') driver = webdriver.Chrome(chromedriver, options=webdriver_options) #   url driver.get(path) #    calculated_print_options = { 'landscape': False, 'displayHeaderFooter': False, 'printBackground': True, 'preferCSSPageSize': True, } calculated_print_options.update(print_options) #    pdf  result = send_devtools(driver, "Page.printToPDF", calculated_print_options) driver.quit() #    base64 -  return base64.b64decode(result['data']) def send_devtools(driver, cmd, params={}): resource = "/session/%s/chromium/send_command_and_get_result" % driver.session_id url = driver.command_executor._url + resource body = json.dumps({'cmd': cmd, 'params': params}) response = driver.command_executor._request('POST', url, body) if response['status']: raise Exception(response.get('value')) return response.get('value') if __name__ == "__main__": if len(sys.argv) != 3: print ("usage: converter.py &lt;html_page_sourse&gt; &lt;filename_to_save&gt;") exit() result = get_pdf_from_html(sys.argv[1]) with open(sys.argv[2], 'wb') as file: file.write(result)</span></span></code> </pre><br><p>  Untuk mendapatkan file PDF, Anda dapat menjalankan contoh ini dari baris perintah dengan menentukan url dan nama file untuk menyimpan PDF, atau memanggil fungsi <code>get_pdf_from_html</code> dan menyampaikan tiga argumen padanya: </p><br><ol><li>  path - url dari dokumen html; </li><li>  chromedriver - jalur di mesin lokal ke driver chrome (secara default, itu harus di direktori lokal); </li><li>  print_options - atribut cetak tambahan. </li></ol><br><p>  Perlu dicatat bahwa Selenium tidak memiliki antarmuka standar untuk mencetak halaman dalam PDF, dan hanya Chrome yang dapat melakukan ini, jadi Anda harus langsung menghubungi <code>driver.command_executor._request</code> . </p><br><p>  Sekarang mari kita lihat alat apa yang tersedia untuk mengontrol penempatan konten pada dokumen multi-halaman. </p><br><h2 id="tipografika-v-css">  Tipografi CSS </h2><br><p>  Saat mencetak dupleks, Anda dapat mengatur margin berbeda dari tepi untuk halaman kanan dan kiri satu per satu jika Anda berencana untuk menjahitnya di masa mendatang: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:left</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">4cm</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">2cm</span></span>; } @<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:right</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">4cm</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">2cm</span></span>; }</code> </pre> <br><p>  Untuk halaman pertama, Anda dapat menentukan desain Anda sendiri, misalnya, peningkatan indentasi dari tepi atas: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> <span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:first</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">10cm</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Top margin on first page 10cm */</span></span> }</code> </pre> <br><p>  Dimungkinkan untuk mengatur istirahat halaman sebelum tajuk tingkat pertama sehingga dimulai pada halaman ganjil: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-before </span></span>: right }</code> </pre> <br><p>  Menggunakan properti <code>page-break-after</code> , Anda dapat mencegah page break segera setelah beberapa elemen, misalnya, header tingkat kedua: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-after </span></span>: avoid }</code> </pre> <br><p>  Properti <code>page-break-inside</code> membantu untuk menghindari page break di tempat yang tidak diinginkan untuk melakukan ini, misalnya di tengah-tengah tabel </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-inside </span></span>: avoid }</code> </pre> <br><p>  Properti <code>orphans</code> dan <code>orphans</code> akan membantu mencegah page break pada awal dan akhir paragraf: </p><br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">orphans</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">widows</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><h2 id="chto-s-proizvoditelnostyu">  Bagaimana dengan kinerja? </h2><br><p>  Pada Core i5-8600K 3600MHz menjadi satu aliran, satu konversi dokumen sederhana membutuhkan 0,6 detik.  Pada mesin ketik portabel akhir saya 2013, 2,4 GHz - 1,5 detik. <br>  Jelas, sumber daya utama dihabiskan untuk meluncurkan browser.  Anda dapat mengurangi waktu konversi untuk sejumlah besar file jika Anda menjalankan Chrome satu kali sebagai layanan mikro dan mengirimkannya URL untuk konversi.  Implementasi metode ini berada di luar cakupan artikel ini. </p><br><h2 id="chto-esche-ne-tak">  Apa lagi yang salah? </h2><br><p>  Saya melihat dua masalah utama: </p><br><ol><li>  Ketidakmungkinan hanya menentukan posisi elemen dalam dokumen.  Ini membuatnya sulit untuk membuat daftar isi dengan indikasi otomatis nomor halaman, terutama jika ukuran konten tidak diketahui sebelumnya. </li><li>  Konversi Chrome adalah produk Google, yang mengumpulkan berbagai informasi tentang pengguna.  Jika kebocoran data dari dokumen tidak dapat diterima, Anda harus berhati-hati tentang solusi yang diusulkan - tutup browser dengan akses ke sumber daya eksternal, atau bahkan cari solusi lain.  Menggunakan open source Chromium tidak menyelesaikan masalah - bug dari Google telah ditemukan di dalamnya. </li></ol><br><h2 id="vyvody">  Kesimpulan </h2><br><p>  Saya mengusulkan untuk menarik kesimpulan tentang diterimanya menggunakan pendekatan ini sendiri.  Setiap proyek unik dengan caranya sendiri.  Apakah metode ini cocok untuk proyek Anda, itu terserah Anda. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id459112/">https://habr.com/ru/post/id459112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id459100/index.html">Registry Paket GitHub akan mendukung paket Swift</a></li>
<li><a href="../id459102/index.html">Hadiah piring atau musik gratis untuk pecinta cola dan sarapan siap saji</a></li>
<li><a href="../id459104/index.html">C # atau Java? TypeScript atau JavaScript? Klasifikasi bahasa pemrograman berdasarkan pembelajaran mesin</a></li>
<li><a href="../id459108/index.html">Tesla akan menghadirkan beberapa kejutan sekaligus di paruh kedua tahun ini</a></li>
<li><a href="../id459110/index.html">Kami sedang menulis bot memancing di game Albion Online dengan Python</a></li>
<li><a href="../id459114/index.html">14 Plugin SEO WordPress Terbaik di 2019</a></li>
<li><a href="../id459116/index.html">Satu langkah lebih dekat ke perbaikan timus</a></li>
<li><a href="../id459118/index.html">Bagaimana kami merancang dan mengimplementasikan jaringan baru pada Huawei di kantor Moskow, bagian 2</a></li>
<li><a href="../id459120/index.html">Komputer Tertanam Modular Seri UNO-1000/2000</a></li>
<li><a href="../id459122/index.html">Aleksey Savvateev: Hadiah Nobel Jean Tyrol untuk menganalisis pasar yang tidak sempurna (2014) dan reputasi kolektif</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>