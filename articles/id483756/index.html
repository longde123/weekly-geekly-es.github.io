<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛎ 👩🏿‍⚖️ 🎞️ Kami membuat permintaan HTTP, menurunkan dengan anggun (dan bukan celah tunggal) 🏰 💈 👨🏽‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saat ini, beberapa orang ingat bahwa aplikasi web dapat berjalan tanpa permintaan XHR tunggal. AJAX (Asynchronous Javascript dan XML) menyediakan fitu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami membuat permintaan HTTP, menurunkan dengan anggun (dan bukan celah tunggal)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/483756/"><img src="https://habrastorage.org/webt/q7/e_/an/q7e_an5o_ojnkjr4lmhiih9bula.png" alt="gambar"><br><br>  Saat ini, beberapa orang ingat bahwa aplikasi web dapat berjalan tanpa permintaan XHR tunggal.  AJAX (Asynchronous Javascript dan XML) menyediakan fitur keren - memuat data tanpa memuat ulang halaman.  Konsep ini mendasari kebanyakan SPA modern. <br><br>  Tapi tidak ada yang diberikan begitu saja, Anda harus membayar semuanya.  Konsep AJAX tampaknya sangat sederhana, tetapi bahkan pada tingkat permintaan data dari server, Anda dapat menemui banyak masalah. <br><a name="habracut"></a><br>  Untuk memulai, mari menulis aplikasi SPA paling sederhana dengan AJAX: <br><br><pre><code class="javascript hljs">initApp(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initApp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.innerHTML = <span class="hljs-string"><span class="hljs-string">` &lt;h3&gt;Employees list&lt;/h3&gt; &lt;ul id="employees-list"&gt;&lt;/ul&gt; &lt;button id="load-employees"&gt;Load employee&lt;/button&gt; `</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'load-employees'</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, loadEmployee); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadEmployee</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ fetch(<span class="hljs-string"><span class="hljs-string">'http://dummy.restapiexample.com/api/v1/employee/1'</span></span>) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> res.json()).then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{employee_name}</span></span></span><span class="hljs-function">) =&gt;</span></span> addEmployee(employee_name)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addEmployee</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employeeName</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> employeeElement = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'li'</span></span>); employeeElement.innerText = employeeName; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'employees-list'</span></span>).appendChild(employeeElement); }</code> </pre> <br>  Semuanya sangat sederhana: ketika Anda mengklik tombol, kami meminta data dari server dan ketika mereka diterima, tambahkan item ke daftar. <br><br>  Seperti yang saya katakan, pada tahap ini banyak yang bisa salah dan, untuk memperluas topik lebih dalam, pertama-tama kita akan menganalisis sedikit teori. <br><br><h2>  Dua filosofi membangun antarmuka toleran kesalahan </h2><br><img src="https://habrastorage.org/webt/gd/dn/xk/gddnxk3fna-p7gcpynnnmjstybw.png" alt="gambar"><br><br><h3>  Degradasi anggun </h3><br>  Ini adalah filosofi desain antarmuka di mana pengguna awalnya disediakan dengan fungsi sebanyak mungkin.  Dan hanya jika terjadi kegagalan pada bagian mana pun dari sistem, fungsi-fungsi yang bergantung padanya dinonaktifkan.  Kedengarannya rumit, tetapi di bawah ini kita akan menganalisisnya dengan sebuah contoh - itu akan jauh lebih jelas. <br><br><h3>  Peningkatan progresif </h3><br>  Ada filosofi alternatif / paralel - peningkatan progresif.  Di dalamnya, gerakan berjalan ke arah lain: pada awalnya, pengguna diberikan set fungsionalitas minimal (atau rata-rata).  Dan untuk menginisialisasi sisanya, dukungan dari bagian-bagian sistem yang diperlukan untuk pekerjaan mereka diperiksa terlebih dahulu. <br><br>  Biasanya, ketika berbicara tentang <b>degradasi yang baik dan peningkatan progresif</b> dalam konteks aplikasi berbasis browser, itu berarti kompatibilitas atau kemampuan beradaptasi antar browser.  Ada contoh populer yang menjelaskan konsep-konsep ini.  Misalkan aplikasi Anda memiliki fungsi halaman cetak, dan jika Anda melakukan ini: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:window.print()"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"print-btn"</span></span></span><span class="hljs-tag">&gt;</span></span>Print<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">const</span></span></span><span class="javascript"> printButton = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'print-btn'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (printButton &amp;&amp; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">typeof</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.print !== </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'function'</span></span></span><span class="javascript">) { printButton.parentNode.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createTextNode(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'  '</span></span></span><span class="javascript">)); printButton.parentNode.removeChild(printButton); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  maka ini adalah <b>degradasi yang bagus</b> , karena Anda segera menunjukkan tombol cetak, tetapi ketika Anda menyadari bahwa pencetakan tidak didukung oleh browser, Anda menghapus fungsionalitasnya. <br><br>  PS: Dalam contoh asli, tag noscript digunakan untuk menunjukkan <b>degradasi yang anggun</b> , tetapi bagi saya tampaknya sudah sangat ketinggalan zaman. <br><br>  Jika Anda melakukan ini: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.print === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> printButton = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); printButton.innerText = <span class="hljs-string"><span class="hljs-string">'Print'</span></span>; printButton.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, () =&gt; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.print()); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.appendChild(printButton); }</code> </pre><br>  ini merupakan <b>peningkatan progresif</b> , karena pertama-tama Anda memeriksa dukungan untuk API yang diperlukan dan baru kemudian menambahkan fungsinya. <br><br>  Contoh-contoh menunjukkan aplikasi yang paling primitif dari filosofi desain antarmuka toleransi kesalahan. <br><br>  Kembali ke <b>permintaan</b> <b>AJAX</b> dan <b>HTTP</b> . <br><br><h2>  Apa yang salah dengan AJAX? </h2><br><h3>  Kode status HTTP tidak terduga </h3><br><img src="https://habrastorage.org/webt/uy/el/zt/uyelztasfngdzvaizjhtd4qdxss.png" alt="gambar"><br><br>  Kasus paling sederhana adalah jika server mengembalikan kode status yang salah yang Anda harapkan, katakan 500. Ini adalah skenario umum, dan Anda mungkin memiliki beberapa alat untuk memprosesnya.  Misalnya, perlihatkan kepada pengguna pemberitahuan "Telah terjadi kesalahan server".  Ini jelas degradasi, tetapi seberapa anggun itu?  Apakah mungkin untuk menerapkan peningkatan progresif di sini?  Tidak, ini jelas bukan tempat untuk peningkatan progresif - fungsinya telah menurun.  Anda hanya dapat mengalahkan masalah ini dengan indah: <br><br><ol><li>  Untuk mengetahui bahwa situasi ini umumnya terjadi pada klien untuk mencegahnya di masa depan.  Untuk ini, logger kesalahan biasanya digunakan, misalnya <a href="https://sentry.io/">sentry.io</a> . <br></li><li>  Tembolok data yang diterima, jika memungkinkan.  Keren jika sudah ada panggilan ke permintaan serupa dan Anda menyimpan data.  Dalam hal ini, bahkan jika Anda menerima kode status yang tidak terduga dari server, Anda dapat menampilkan antarmuka, meskipun tidak dengan data terbaru. </li><li>  Coba ulangi permintaan nanti.  Mungkin ini adalah server crash sementara dan setelah beberapa detik itu akan "dirilis".  Anda dapat membuat permintaan kedua secara otomatis atau memberikan opsi ini kepada pengguna. <br></li><li>  Jangan memblokir sisa aplikasi.  Jika Anda menunjukkan pemintal atau kerangka sebelum memanggil permintaan HTTP, maka jangan lupa sembunyikan di setiap penyelesaian permintaan, berhasil atau tidak.  Ini mungkin tampak jelas, tetapi saya sering menjumpai ini. </li><li>  Secara umum, mungkin ada banyak kode status yang tidak terduga, misalnya, ketika sesi pengguna berakhir dan server merespons dengan kode 403. Untuk kesalahan ini, penangan terpisah diperlukan yang menerbitkan kembali token sesi atau mengirim pengguna untuk otorisasi.  Aplikasi failover harus memiliki penangan untuk semua kemungkinan respons server. </li></ol><br><h3>  Jawaban tidak valid </h3><br><img src="https://habrastorage.org/webt/v0/qx/pk/v0qxpkivrql4ftzj-ansb5-b3ag.png" alt="gambar"><br><br>  Jangan pernah percaya backend!  Server dapat merespons dengan kode 200, tetapi di dalam tubuh respons akan mengembalikan data yang salah yang Anda butuhkan.  Dalam situasi ini, Anda dapat melakukan hal yang sama dengan kode status yang tidak terduga, tetapi kesulitannya dalam menentukan bahwa jawabannya benar-benar tidak valid. <br><br>  Jika Anda menulis dalam naskah, maka bagi Anda ada alat keren - <a href="https://github.com/YousefED/typescript-json-schema">naskah-json-skema</a> .  Dengan itu, Anda dapat menghasilkan skema json dari antarmuka naskah dan menggunakannya untuk memvalidasi data dalam runtime. <br><br><h3>  Jawaban panjang </h3><br><img src="https://habrastorage.org/webt/vs/j1/5z/vsj15z3zrwlf73aipc7mf7gimwi.png" alt="gambar"><br><br>  Ini adalah pukulan yang sedikit orang harapkan.  Jika kita mengingat kesalahan atau bahkan data tanggapan yang tidak valid, kita jarang ingat batas waktu.  Pelakunya mungkin bukan hanya aplikasi server, tetapi bahkan penyedia Internet atau perangkat klien. <br><br>  Jangan lupa tentang hal itu, lebih baik memberi tahu pengguna bahwa permintaan lebih lama dari biasanya daripada membiarkannya berhadapan muka dengan lingkaran berputar di layar.  Ketika waktu yang diberikan untuk pelaksanaan permintaan berakhir, Anda dapat melalui skenario yang sama seperti pada dua situasi sebelumnya. <br><br><h3>  Kurangnya internet </h3><br><img src="https://habrastorage.org/webt/pu/v4/fy/puv4fye-opxgmqqnvlh99h4d9bg.png" alt="gambar"><br><br>  Saya sangat terkesan mengetahui bahwa Google Documents memiliki mode offline.  Itu sangat membantu saya ketika saya memutuskan untuk selesai menulis artikel di pesawat terbang di mana tidak ada internet. <br><br>  Tentu saja, aplikasi berbeda dan banyak dari mereka praktis tidak berguna tanpa internet.  Tetapi bahkan dalam aplikasi ini, Anda dapat menangani kasus ini dengan kurangnya koneksi dan menampilkan pesan informatif (walaupun saya juga suka memainkan tyrannosaurus di "Chrome"). <br><br>  Selain itu, Anda dapat mendengarkan <a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/Online_and_offline_events">acara yang menghubungkan / memutuskan koneksi Internet</a> .  Dan, misalnya, secara otomatis memuat ulang data selama acara online di jendela. <br><br><h2>  Antarmuka toleran kesalahan - tidak mudah </h2><br>  Secara total, daftar tindakan yang harus diterapkan ketika memohon permintaan HTTP: <br><br><ol><li>  Kesalahan log. </li><li>  Tembolok data dan menggunakannya. </li><li>  Ulangi permintaan yang gagal. </li><li>  Jangan memblokir antarmuka. </li><li>  Menangani semua kemungkinan respons server. </li><li>  Validasi respons server. </li><li>  Tetapkan batas waktu. </li><li>  Mode offline (kurangnya internet). </li></ol><br>  Apa yang tampak sepele pada awalnya berubah menjadi filsafat lengkap dengan banyak masalah.  Tentu saja, ini bukan masthead.  Tetapi jika aplikasi Anda telah mencapai tingkat kematangan yang tinggi dan Anda ingin membuat antarmuka yang benar-benar berkualitas tinggi, maka ini adalah arah yang layak untuk dikembangkan. <br><br>  Tujuan artikel ini adalah untuk membicarakan kemungkinan masalah saat bekerja dengan permintaan HTTP, tetapi bukan tentang solusi spesifik.  Saat ini ada sejumlah besar perpustakaan dan kerangka kerja yang ditujukan untuk menyelesaikan masalah ini, misalnya, pencegat HTTP di Angular. <br>  Mengetahui masalah yang mungkin terjadi, akan lebih mudah untuk menemukan solusi bagi mereka di Internet. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id483756/">https://habr.com/ru/post/id483756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id483744/index.html">Penjualan Tahun Baru Lama</a></li>
<li><a href="../id483746/index.html">Stasiun Gateway: jalur ke garis bulan, akses ke stasiun Mars</a></li>
<li><a href="../id483748/index.html">Kecerobohan pengguna PayPal yang memungkinkan mereka untuk mencuri akun dan uang mereka [Tetap]</a></li>
<li><a href="../id483750/index.html">Terjemahan buku Andrew Un, Passion for Machine Learning, Bab 30 - 32</a></li>
<li><a href="../id483754/index.html">Bagaimana cara mengukur peningkatan tim?</a></li>
<li><a href="../id483758/index.html">10 perusahaan pemula Pengembangan Aplikasi Seluler dapat bermitra pada tahun 2020</a></li>
<li><a href="../id483762/index.html">GitLab 12.6 Dirilis dengan Peringkat Keselamatan Proyek dan Materi Rilis</a></li>
<li><a href="../id483766/index.html">Pengadilan sebagai alat peretasan sosial atau sedikit tentang keandalan informasi dalam database WHOIS</a></li>
<li><a href="../id483768/index.html">MVCC di PostgreSQL-5. Vakum dalam halaman dan pembaruan HOT</a></li>
<li><a href="../id483774/index.html">Intisari acara untuk profesional SDM di bidang TI untuk Januari 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>