<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🌾 🕊️ 💧 Apa yang saya pelajari dengan menguji 200.000 baris kode infrastruktur 🤱🏾 👩🏻‍🤝‍👨🏾 👶🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pendekatan IaC (Infrastructure as Code) tidak hanya terdiri dari kode yang disimpan dalam repositori, tetapi juga orang-orang dan proses yang mengelil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apa yang saya pelajari dengan menguji 200.000 baris kode infrastruktur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467171/"><p><img src="https://habrastorage.org/webt/j2/pp/6q/j2pp6qs2f6qjrz5pn35wuzd0luk.png"></p><br><p>  Pendekatan <strong>IaC</strong> (Infrastructure as Code) tidak hanya terdiri dari kode yang disimpan dalam repositori, tetapi juga orang-orang dan proses yang mengelilingi kode ini.  Apakah mungkin untuk menggunakan kembali pendekatan dari pengembangan perangkat lunak hingga manajemen dan deskripsi infrastruktur?  Ini tidak akan berlebihan untuk mengingat ide ini saat Anda membaca artikel. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Versi Rusia</a> </p><a name="habracut"></a><br><p>  Ini adalah transkrip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kinerja</a> saya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">DevopsConf 2019-05-28</a> . </p><br><div class="spoiler">  <b class="spoiler_title">Slide dan video</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Versi Rusia</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Versi Rusia</a> </li><li>  Lari kering 2019-04-24 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SpbLUG</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Video (RU) dari DevopsConf 2019-05-28</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Video (RU) dari DINS DevOps EVENING 2019-06-20</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Slide</a> </li></ul></div></div><br><h1 id="infrastructure-as-bash-history">  Infrastruktur sebagai bash history </h1><br><p><img src="https://habrastorage.org/webt/i_/yl/fm/i_ylfms8w-9pgisnujlu-iv1u3y.png"></p><br><p>  Misalkan Anda datang ke proyek baru, dan mereka berkata kepada Anda: "kami memiliki <em>Infrastruktur sebagai Kode</em> ."  Pada kenyataannya, ternyata, <em>Infrastruktur sebagai bash history</em> atau misalnya <em>Dokumentasi sebagai bash history</em> .  Ini adalah situasi yang sangat nyata, misalnya, kasus serupa dijelaskan oleh Denis Lysenko dalam pidatonya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagaimana cara mengganti seluruh infrastruktur dan mulai tidur nyenyak</a> , ia mengatakan bagaimana dari bash history mereka mendapatkan infrastruktur ramping pada proyek tersebut. </p><br><p>  Jika mau, Anda dapat mengatakan bahwa <em>Infrastruktur sebagai bash history</em> seperti kode: </p><br><ol><li>  <em>reproduktifitas</em> : Anda dapat mengambil bash history, menjalankan perintah dari sana, mungkin, omong-omong, Anda akan mendapatkan konfigurasi yang berfungsi di output. </li><li>  <em>versi</em> : Anda tahu siapa yang masuk dan apa yang dilakukan, sekali lagi, bukan fakta bahwa ini akan mengarahkan Anda ke konfigurasi yang berfungsi pada output. </li><li>  <em>sejarah</em> : sejarah siapa yang melakukan apa.  hanya Anda yang tidak dapat menggunakannya jika Anda kehilangan server. </li></ol><br><p>  Apa yang harus dilakukan </p><br><h1 id="infrastructure-as-code">  Infrastruktur sebagai kode </h1><br><p><img src="https://habrastorage.org/webt/gm/3e/wf/gm3ewf7g3w72takvuffsxhcbgoy.png"></p><br><p>  Bahkan kasus aneh seperti <em>Infrastruktur seperti bash history</em> dapat ditarik oleh Telinga ke <em>Infrastruktur sebagai Kode</em> , tetapi ketika kita ingin melakukan sesuatu yang lebih rumit daripada server LAMP lama yang baik, kita akan sampai pada kesimpulan bahwa kode ini perlu dimodifikasi, dimodifikasi, dimodifikasi entah bagaimana .  Selanjutnya, kami ingin mempertimbangkan paralel antara <em>Infrastruktur sebagai Kode</em> dan pengembangan perangkat lunak. </p><br><h2 id="dry">  KERING </h2><br><p><img src="https://habrastorage.org/webt/rx/qa/vf/rxqavfjxrtmtwkjzzq4prr72oao.png"></p><br><p>  Pada proyek untuk pengembangan sistem penyimpanan, ada sub-tugas untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengkonfigurasi SDS secara berkala</a> : kami merilis rilis baru - perlu diluncurkan untuk pengujian lebih lanjut.  Tugasnya sangat sederhana: </p><br><ul><li>  datang ke sini dengan ssh dan jalankan perintah. </li><li>  salin file di sana. </li><li>  di sini adalah tweak untuk konfigurasi. </li><li>  mulai layanan di sana </li><li>  ... </li><li>  KEUNTUNGAN! </li></ul><br><p>  Bash lebih dari cukup untuk logika yang dijelaskan, terutama pada tahap awal proyek ketika baru saja dimulai.  Ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tidak buruk bahwa Anda menggunakan bash</a> , tetapi seiring waktu Anda diminta untuk menyebarkan sesuatu yang serupa, tetapi sedikit berbeda.  Hal pertama yang terlintas dalam pikiran: copy-paste.  Dan sekarang kami memiliki dua skrip yang sangat mirip yang melakukan hal yang hampir sama.  Seiring waktu, jumlah skrip telah tumbuh, dan kami dihadapkan dengan kenyataan bahwa ada semacam logika bisnis untuk menggunakan instalasi, yang harus disinkronkan di antara skrip yang berbeda, itu cukup sulit. </p><br><p><img src="https://habrastorage.org/webt/-u/ep/cv/-uepcvi1kjsnruflehy0noydk1k.png"></p><br><p>  Ternyata ada semacam latihan KERING (Jangan Ulangi Diri Sendiri).  Idenya adalah untuk menggunakan kembali kode yang ada.  Kedengarannya sederhana, tetapi tidak langsung sampai ke sini.  Dalam kasus kami, itu adalah ide yang lumrah: untuk memisahkan konfigurasi dari skrip.  Yaitu  logika bisnis bagaimana instalasi digunakan secara terpisah, konfigurasi secara terpisah. </p><br><h2 id="solid-for-cfm">  SOLID untuk CFM </h2><br><p><img src="https://habrastorage.org/webt/kt/7f/ba/kt7fbazyy0arjwrnlwgoynqbvqg.png"></p><br><p>  Seiring waktu, proyek tumbuh dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">perpanjangan alami</a> adalah munculnya Ansible.  Alasan utama penampilannya adalah kehadiran keahlian dalam tim dan bahwa bash tidak dimaksudkan untuk logika yang kompleks.  Ansible juga mulai mengandung logika yang kompleks.  Agar logika yang kompleks tidak berubah menjadi kekacauan, ada prinsip-prinsip pengorganisasian kode <em>SOLID</em> dalam pengembangan perangkat lunak. Misalnya, Grigory Petrov dalam laporannya "Mengapa TI membutuhkan merek pribadi" menimbulkan pertanyaan bahwa seseorang dirancang sedemikian rupa sehingga lebih mudah dioperasikan dengan beberapa entitas sosial, dalam pengembangan perangkat lunak, ini adalah objek.  Jika Anda menggabungkan kedua ide ini dan terus mengembangkannya, Anda akan melihat bahwa Anda juga dapat menggunakan <em>SOLID</em> dalam deskripsi infrastruktur sehingga akan lebih mudah untuk mempertahankan dan memodifikasi logika ini di masa mendatang. </p><br><h3 id="the-single-responsibility-principle">  Prinsip Tanggung Jawab Tunggal </h3><br><p><img src="https://habrastorage.org/webt/yh/h7/kg/yhh7kgr1jal27ddvpeydqxcmzog.png"></p><br><p>  <em>Setiap kelas hanya melakukan satu tugas.</em> </p><br><p>  Tidak perlu mencampur kode dan membuat monster pasta ilahi monolitik.  Infrastruktur harus terdiri dari batu bata sederhana.  Ternyata jika Anda membagi buku pedoman Ansible menjadi potongan-potongan kecil, baca peran Ansible, maka itu lebih mudah untuk dipertahankan. </p><br><h3 id="the-open-closed-principle">  Prinsip tertutup terbuka </h3><br><p><img src="https://habrastorage.org/webt/g6/ym/qn/g6ymqn8vohwbewqx7hgixuiuuf8.png"></p><br><p>  <em>Prinsip keterbukaan / penutupan.</em> </p><br><ul><li>  <em>Terbuka untuk ekspansi: berarti perilaku suatu entitas dapat diperluas dengan menciptakan jenis entitas baru.</em> </li><li>  <em>Ditutup untuk perubahan: sebagai hasil dari perluasan perilaku suatu entitas, tidak ada perubahan yang harus dilakukan pada kode yang menggunakan entitas ini.</em> </li></ul><br><p>  Awalnya, kami menggunakan infrastruktur uji pada mesin virtual, tetapi karena fakta bahwa logika bisnis penyebaran terpisah dari implementasi, kami dengan mudah menambahkan rolling ke bare-metal. </p><br><h3 id="the-liskov-substitution-principle">  Prinsip Substitusi Liskov </h3><br><p><img src="https://habrastorage.org/webt/1x/-4/am/1x-4am1tjecrhxx3jm7bfur00oy.png"></p><br><p>  <em>Prinsip substitusi Barbara Liskov.</em>  <em>objek dalam program harus dapat diganti dengan instance subtipe mereka tanpa mengubah kebenaran program</em> </p><br><p>  Jika Anda melihat lebih luas, ini bukan fitur dari proyek tertentu yang dapat Anda terapkan <em>SOLID</em> , umumnya tentang CFM, misalnya, pada proyek lain Anda perlu menggunakan aplikasi Java kotak di atas berbagai Jawa, server aplikasi, database, OS, dll.  Untuk contoh ini, saya akan mempertimbangkan prinsip-prinsip <em>SOLID</em> lebih lanjut. </p><br><p>  Dalam kasus kami, sebagai bagian dari tim infrastruktur, ada kesepakatan bahwa jika kami memasang peran imbjava atau oraclejava, maka kami memiliki binary java executable.  Ini perlu karena  peran yang lebih tinggi tergantung pada perilaku ini, mereka berharap java akan hadir.  Pada saat yang sama, ini memungkinkan kita untuk mengganti satu implementasi / versi java dengan yang lain tanpa mengubah logika penerapan aplikasi. </p><br><p>  Masalahnya di sini terletak pada kenyataan bahwa dalam Ansible tidak mungkin untuk mengimplementasikan seperti itu, sebagai akibatnya, beberapa perjanjian muncul dalam tim. </p><br><h3 id="the-interface-segregation-principle">  Prinsip Pemisahan Antarmuka </h3><br><p><img src="https://habrastorage.org/webt/v2/9r/wa/v29rwalnqryarhrwe-_r8jvx0go.png"></p><br><p>  <em>Prinsip pemisahan antarmuka “banyak antarmuka yang dirancang khusus untuk pelanggan lebih baik daripada antarmuka tujuan umum tunggal.</em> </p><br><p>  Awalnya, kami mencoba untuk menempatkan semua variasi dalam menyebarkan aplikasi ke dalam satu buku pedoman Ansible, tetapi sulit untuk mendukung, dan pendekatan ketika kami memiliki antarmuka keluar (klien mengharapkan port 443) ditentukan, maka untuk implementasi tertentu Anda dapat membangun infrastruktur dari batu bata yang terpisah. </p><br><h3 id="the-dependency-inversion-principle">  Prinsip Pembalikan Ketergantungan </h3><br><p><img src="https://habrastorage.org/webt/ee/ip/e8/eeipe8nr7hbjx18yxtoxsekwlfy.png"></p><br><p>  <em>Prinsip inversi ketergantungan.</em>  <em>Modul tingkat atas tidak harus bergantung pada modul tingkat bawah.</em>  <em>Kedua jenis modul harus bergantung pada abstraksi.</em>  <em>Abstraksi tidak harus bergantung pada detail.</em>  <em>Rinciannya harus bergantung pada abstraksi.</em> </p><br><p>  Di sini contohnya akan didasarkan pada antipattern. </p><br><ol><li>  Salah satu pelanggan memiliki cloud pribadi. </li><li>  Di dalam cloud, kami memesan mesin virtual. </li><li>  Tetapi mengingat fitur cloud, penyebaran aplikasi terkait dengan hypervisor yang digunakan VM. </li></ol><br><p>  Yaitu  logika penyebaran aplikasi tingkat tinggi, dependensi mengalir ke tingkat hypervisor yang lebih rendah, dan ini berarti masalah ketika menggunakan kembali logika ini.  <em><strong>Jangan lakukan itu.</strong></em> </p><br><h1 id="interaction">  Interaksi </h1><br><p><img src="https://habrastorage.org/webt/rd/7_/8r/rd7_8rtprcz4xjkuhctjppbkcuu.png"></p><br><p>  Infrastruktur sebagai kode tidak hanya tentang kode, tetapi juga tentang hubungan antara kode dan seseorang, tentang interaksi antara pengembang infrastruktur. </p><br><h2 id="bus-factor">  Faktor bus </h2><br><p><img src="https://habrastorage.org/webt/p5/4-/wh/p54-whkhcglorvk_dlt0b1jpajy.png"></p><br><p>  Misalkan Anda memiliki Vasya di proyek tersebut.  Vasya tahu segalanya tentang infrastruktur Anda, apa yang akan terjadi jika Vasya tiba-tiba menghilang?  Ini adalah situasi yang sangat nyata, karena bisa ditabrak bus.  Terkadang ini terjadi.  Jika ini terjadi dan pengetahuan tentang kode, strukturnya, cara kerjanya, penampilan, dan kata sandi tidak didistribusikan di tim, maka Anda mungkin menghadapi sejumlah situasi yang tidak menyenangkan.  Berbagai pendekatan dapat digunakan untuk meminimalkan risiko ini dan mendistribusikan pengetahuan dalam tim. </p><br><h2 id="pair-devopsing">  Berpasangan dengan pasangan </h2><br><p><img src="https://habrastorage.org/webt/6q/0l/t0/6q0lt0afzbkpivxxp4uvryxgake.png"></p><br><p>  Ini tidak seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lelucon</a> yang admin minum bir, mengubah kata sandi, tetapi analog pemrograman pasangan.  Yaitu  dua insinyur duduk di satu komputer, satu keyboard dan mulai mengkonfigurasi infrastruktur Anda bersama-sama: mengkonfigurasi server, menulis peran yang mungkin, dll.  Kedengarannya bagus, tetapi itu tidak berhasil bagi kami.  Tetapi kasus-kasus khusus dari praktik ini berhasil.  Seorang karyawan baru telah datang, mentornya mengambil tugas nyata bersamanya, bekerja, mentransfer pengetahuan. </p><br><p>  Kasus khusus lainnya adalah panggilan insiden.  Selama masalah, sekelompok orang yang bertugas dan terlibat mengumpulkan, satu pemimpin ditunjuk, yang berbagi layarnya dan menyuarakan kereta pemikiran.  Peserta lain mengikuti pemikiran pemimpin, memata-matai trik dari konsol, memeriksa apakah mereka tidak melewatkan satu baris pun dalam log, mempelajari hal-hal baru tentang sistem.  Pendekatan ini berhasil daripada tidak. </p><br><h2 id="code-review">  Ulasan kode </h2><br><p><img src="https://habrastorage.org/webt/wk/u6/vn/wku6vntzzsquckgu58n1_r3tg-i.png"></p><br><p>  Secara subyektif, lebih efisien, penyebaran pengetahuan tentang infrastruktur dan bagaimana hal itu dilakukan dengan menggunakan tinjauan kode: </p><br><ul><li>  Infrastruktur dijelaskan oleh kode dalam repositori. </li><li>  Perubahan terjadi di cabang terpisah. </li><li>  Dengan permintaan penggabungan, Anda dapat melihat delta perubahan infrastruktur. </li></ul><br><p>  Sorotan di sini adalah bahwa pengulas dipilih pada gilirannya, sesuai dengan jadwal, yaitu  dengan beberapa kemungkinan Anda akan naik ke infrastruktur baru. </p><br><h3 id="code-style">  Gaya Kode </h3><br><p><img src="https://habrastorage.org/webt/qa/fz/ju/qafzju1vc86llmvcc1m4urpfa7c.png"></p><br><p>  Seiring waktu, pertengkaran mulai muncul selama peninjauan, sebagai  pengulas memiliki gaya mereka sendiri dan rotatability pengulas menumpuk mereka dengan gaya yang berbeda: 2 spasi atau 4, camelCase atau snake_case.  Implementasi ini tidak berhasil segera. </p><br><ul><li>  Gagasan pertama adalah merekomendasikan penggunaan linter, karena semua insinyur yang sama, semuanya pintar.  Tetapi editor yang berbeda, OS, tidak nyaman </li><li>  Ini berkembang menjadi bot, yang untuk masing-masing komit berkomitmen untuk yang bermasalah ditulis dalam slack, dan menerapkan output linter.  Tetapi dalam kebanyakan kasus, hal-hal yang lebih penting ditemukan dan kode tetap tidak diperbaiki. </li></ul><br><h3 id="green-build-master">  Tuan bangunan hijau </h3><br><p><img src="https://habrastorage.org/webt/lw/ow/xi/lwowxis0izoohgthm9db7nheih4.png"></p><br><p>  Waktu berlalu, dan kami sampai pada kesimpulan bahwa Anda tidak boleh membiarkan komitmen yang tidak lulus tes tertentu ke master.  Voila!  kami menemukan Green Build Master, yang telah lama dipraktikkan dalam pengembangan perangkat lunak: </p><br><ul><li>  Pengembangan adalah cabang yang terpisah. </li><li>  Tes dijalankan di utas ini. </li><li>  Jika tes gagal, kode tidak akan masuk ke panduan. </li></ul><br><p>  Membuat keputusan ini sangat menyakitkan karena  menyebabkan banyak kontroversi, tetapi itu layak, karena  permintaan untuk merger mulai datang ke tinjauan tanpa perselisihan dalam gaya dan seiring waktu, jumlah bidang masalah mulai berkurang. </p><br><h1 id="iac-testing">  Pengujian IaC </h1><br><p><img src="https://habrastorage.org/webt/ah/dg/sa/ahdgsaecxtevlwnv9ozcoiypkq8.png"></p><br><p>  Selain pemeriksaan gaya, Anda dapat menggunakan hal-hal lain, misalnya, untuk memverifikasi bahwa infrastruktur Anda benar-benar dapat digunakan.  Atau periksa apakah perubahan infrastruktur tidak akan mengakibatkan kehilangan uang.  Mengapa ini diperlukan?  Pertanyaannya kompleks dan filosofis, lebih baik untuk menjawab dengan kisah bahwa entah bagaimana ada scaler otomatis pada Powershell yang tidak memeriksa kondisi batas =&gt; lebih banyak VM dibuat dari yang diperlukan =&gt; klien menghabiskan lebih banyak uang daripada yang direncanakan.  Ini tidak cukup menyenangkan, tetapi akan cukup realistis untuk menangkap kesalahan ini pada tahap sebelumnya. </p><br><p>  Orang mungkin bertanya, mengapa membuat infrastruktur yang kompleks semakin sulit?  Tes untuk infrastruktur, serta untuk kode, bukan tentang penyederhanaan, tetapi tentang mengetahui bagaimana infrastruktur Anda harus bekerja. </p><br><h2 id="iac-testing-pyramid">  IaC Menguji Piramida </h2><br><p><img src="https://habrastorage.org/webt/pn/98/jt/pn98jtnydc1wupw_jvifjjc9mpc.png"></p><br><h3 id="iac-testing-static-analysis">  Pengujian IaC: Analisis Statis </h3><br><p>  Jika Anda segera menggunakan seluruh infrastruktur dan memverifikasi bahwa itu berfungsi, maka itu mungkin membutuhkan banyak waktu dan membutuhkan banyak waktu.  Karena itu, dasarnya haruslah sesuatu yang cepat berfungsi, banyak, dan mencakup banyak tempat primitif. </p><br><h4 id="bash-is-tricky">  Bash itu rumit </h4><br><p>  Ini adalah contoh sepele.  pilih semua file di direktori saat ini dan salin ke lokasi lain.  Hal pertama yang terlintas dalam pikiran: </p><br><pre><code class="plaintext hljs">for i in * ; do cp $i /some/path/$i.bak done</code> </pre> <br><p>  Tetapi bagaimana jika ada spasi dalam nama file?  Baiklah, kita pintar, kita bisa menggunakan tanda kutip: </p><br><pre> <code class="plaintext hljs">for i in * ; do cp "$i" "/some/path/$i.bak" ; done</code> </pre> <br><p>  Dilakukan dengan baik?  tidak!  Bagaimana jika tidak ada apa pun di direktori, mis.  Globbing tidak akan berhasil. </p><br><pre> <code class="plaintext hljs">find . -type f -exec mv -v {} dst/{}.bak \;</code> </pre> <br><p>  Sekarang dilakukan dengan baik?  not ... Lupa bahwa nama file mungkin <code>\n</code> . </p><br><pre> <code class="plaintext hljs">touch x mv x "$(printf "foo\nbar")" find . -type f -print0 | xargs -0 mv -t /path/to/target-dir</code> </pre> <br><h4 id="static-analysis-tools">  Alat analisis statis </h4><br><p>  Masalah dari langkah sebelumnya bisa ditangkap ketika kita lupa tanda kutip, karena ini di alam ada banyak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">alat Shellcheck</a> , ada banyak dari mereka, dan kemungkinan besar Anda dapat menemukan liner untuk tumpukan Anda di bawah IDE Anda. </p><br><div class="scrollable-table"><table><thead><tr><th>  Bahasa </th><th>  Alat </th></tr></thead><tbody><tr><td>  bash </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Shellcheck</a> </td></tr><tr><td>  Ruby </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Rubocop</a> </td></tr><tr><td>  ular sanca </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pylint</a> </td></tr><tr><td>  mungkin </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Serat yang memungkinkan</a> </td></tr></tbody></table></div><br><h3 id="iac-testing-unit-tests">  Pengujian IaC: Tes Unit </h3><br><p><img src="https://habrastorage.org/webt/pn/wx/av/pnwxavylqxfmvcc-oynjhjmsq-a.png"></p><br><p>  Seperti yang kita lihat dari contoh sebelumnya, linter tidak mahakuasa dan tidak dapat menunjuk ke semua area masalah.  Selanjutnya, dengan analogi dengan pengujian dalam pengembangan perangkat lunak, kita dapat memanggil unit test.  Kemudian <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">shunit</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">junit</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">rspec</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pytest</a> segera terlintas dalam pikiran.  Tapi apa yang harus dilakukan dengan ansible, chef, saltstack dan yang lainnya seperti mereka? </p><br><p>  Pada awalnya, kami berbicara tentang <em>SOLID</em> dan fakta bahwa infrastruktur kami harus terdiri dari batu bata kecil.  Waktunya telah tiba. </p><br><ol><li>  Infrastruktur dihancurkan menjadi batu bata kecil, misalnya, peran yang dimungkinkan. </li><li>  Beberapa jenis lingkungan sedang berlangsung, baik itu buruh pelabuhan atau VM. </li><li>  Kami menerapkan peran Ansible kami ke lingkungan pengujian ini. </li><li>  Kami memeriksa bahwa semuanya berfungsi seperti yang kami harapkan (jalankan tes). </li><li>  Kami memutuskan ok atau tidak ok. </li></ol><br><h4 id="iac-testing-unit-testing-tools">  IaC Testing: Alat Unit Testing </h4><br><p>  Pertanyaannya adalah, apa tes untuk CFM?  Anda dapat menjalankan skrip klise, atau Anda dapat menggunakan solusi yang sudah jadi untuk ini: </p><br><div class="scrollable-table"><table><thead><tr><th>  CFM </th><th>  Alat </th></tr></thead><tbody><tr><td>  Mungkin </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Testinfra</a> </td></tr><tr><td>  Koki </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Inspec</a> </td></tr><tr><td>  Koki </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Serverspec</a> </td></tr><tr><td>  tumpukan garam </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Goss</a> </td></tr></tbody></table></div><br><p>  Contoh untuk testinfra, kami memverifikasi bahwa pengguna <code>test1</code> , <code>test2</code> ada dan berada di grup <code>sshusers</code> : </p><br><pre> <code class="plaintext hljs">def test_default_users(host): users = ['test1', 'test2' ] for login in users: assert host.user(login).exists assert 'sshusers' in host.user(login).groups</code> </pre> <br><p>  Apa yang harus dipilih?  Pertanyaannya kompleks dan ambigu, berikut adalah contoh perubahan dalam proyek-proyek di github untuk 2018-2019: </p><br><p><img src="https://habrastorage.org/webt/aj/vm/0w/ajvm0wr0cno5a0kchi0z-jwyyxy.png"></p><br><h4 id="iac-testing-frameworks">  Kerangka Pengujian IaC </h4><br><p>  Ada cara menyatukan dan menjalankannya?  Anda dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengambil dan melakukan semuanya sendiri</a> jika Anda memiliki jumlah insinyur yang memadai.  Dan Anda dapat mengambil solusi yang sudah jadi, meskipun tidak terlalu banyak: </p><br><div class="scrollable-table"><table><thead><tr><th>  CFM </th><th>  Alat </th></tr></thead><tbody><tr><td>  Mungkin </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Molekul</a> </td></tr><tr><td>  Koki </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dapur uji</a> </td></tr><tr><td>  Bentuk Terra </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Terratest</a> </td></tr></tbody></table></div><br><p>  Contoh perubahan proyek pada github untuk 2018-2019: </p><br><p><img src="https://habrastorage.org/webt/bj/lb/02/bjlb02mi6tympyzdjjxef3_8bhq.png"></p><br><h4 id="molecule-vs-testkitchen">  Molekul vs  Testkitchen </h4><br><p><img src="https://habrastorage.org/webt/vx/2e/dt/vx2edtvvuquxyw-4yf81zmk6s9c.png"></p><br><p>  Awalnya, kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mencoba menggunakan testkitchen</a> : </p><br><ol><li>  Buat VM secara paralel. </li><li>  Terapkan Peran yang Mungkin. </li><li>  Usir inspec. </li></ol><br><p>  Untuk 25-35 peran, ini bekerja selama 40-70 menit, yang merupakan waktu yang lama. </p><br><p><img src="https://habrastorage.org/webt/i-/9j/cl/i-9jclmr4x36ag1e8ppzk_d-_b0.png"></p><br><p>  Langkah selanjutnya adalah beralih ke jenkins / docker / ansible / molekul.  Secara idiologis, semuanya sama </p><br><ol><li>  Buku pedoman serat </li><li>  Untuk menumpahkan peran. </li><li>  Jalankan kontainer </li><li>  Terapkan Peran yang Mungkin. </li><li>  Usir testinfra. </li><li>  Periksa idempotensi. </li></ol><br><p><img src="https://habrastorage.org/webt/zz/je/kf/zzjekf-i8wckzdeslzlrbkmmxhg.png"></p><br><p>  Penguasa untuk 40 peran dan tes untuk selusin mulai memakan waktu sekitar 15 menit. </p><br><p><img src="https://habrastorage.org/webt/pn/6p/qe/pn6pqelxwb7dbaapkefv80ccxra.png"></p><br><p>  Apa yang harus dipilih tergantung pada banyak faktor, seperti tumpukan yang digunakan, keahlian dalam tim, dll.  di sini setiap orang memutuskan cara menutup masalah pengujian Unit </p><br><h3 id="iac-testing-integration-tests">  Pengujian IaC: Tes Integrasi </h3><br><p><img src="https://habrastorage.org/webt/yt/jf/br/ytjfbruwxfanxl15sxcfyg_gz1g.png"></p><br><p>  Pada tahap berikutnya dari piramida pengujian infrastruktur, tes integrasi akan muncul.  Mereka mirip dengan tes Unit: </p><br><ol><li>  Infrastruktur dihancurkan menjadi batu bata kecil, seperti peran Ansible. </li><li>  Beberapa jenis lingkungan sedang berlangsung, baik itu buruh pelabuhan atau VM. </li><li>  Ada <strong>banyak</strong> peran yang mungkin diterapkan pada lingkungan pengujian ini. </li><li>  Kami memeriksa bahwa semuanya berfungsi seperti yang kami harapkan (jalankan tes). </li><li>  Kami memutuskan ok atau tidak ok. </li></ol><br><p>  Secara kasar, kami tidak memeriksa operabilitas elemen individu dari sistem seperti dalam pengujian unit, kami memeriksa bagaimana server dikonfigurasi secara keseluruhan. </p><br><h3 id="iac-testing-end-to-end-tests">  Pengujian IaC: Tes ujung ke ujung </h3><br><p><img src="https://habrastorage.org/webt/pn/98/jt/pn98jtnydc1wupw_jvifjjc9mpc.png"></p><br><p>  Di puncak piramida kita bertemu dengan tes ujung ke ujung.  Yaitu  kami tidak memeriksa operasi server yang terpisah, skrip yang terpisah, dan infrastruktur kami yang terpisah.  Kami memeriksa bahwa banyak server digabungkan bersama, infrastruktur kami berfungsi seperti yang kami harapkan.  Sayangnya, saya tidak melihat solusi kotak yang siap pakai, mungkin karena  infrastruktur sering kali unik dan sulit untuk di-templat dan membuat kerangka kerja untuk mengujinya.  Akibatnya, semua orang menciptakan solusi mereka sendiri.  Ada permintaan, tetapi tidak ada jawaban.  Oleh karena itu, saya akan memberi tahu Anda apa yang ada di sana untuk mendorong orang lain untuk menyuarakan pemikiran atau menyodok hidung saya, bahwa semuanya diciptakan jauh sebelum kita. </p><br><p><img src="https://habrastorage.org/webt/us/xz/rl/usxzrlzt8unudguhf9b89d83dfm.png"></p><br><p>  Sebuah proyek dengan sejarah yang kaya.  Digunakan di organisasi besar dan mungkin Anda masing-masing secara tidak langsung berpotongan.  Aplikasi ini mendukung banyak basis data, integrasi, dll., Dll.  Mengetahui bagaimana infrastruktur bisa terlihat seperti ini adalah banyak file-file docker-compose, dan mengetahui tes mana yang harus dijalankan di mana jenkins berada. </p><br><p><img src="https://habrastorage.org/webt/an/l2/ev/anl2ev_lxlsnegrxpulghdw9jxw.png"></p><br><p>  Skema ini bekerja untuk waktu yang lama, sampai sebagai bagian dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">penelitian</a> kami mencoba mentransfernya ke Openshift.  Kontainer tetap sama, tetapi lingkungan peluncuran telah berubah (halo KERING lagi). </p><br><p><img src="https://habrastorage.org/webt/sh/sg/ud/shsgudbrhuqpazrpikcacxskzrm.png"></p><br><p>  Ide penelitian melangkah lebih jauh, dan dalam openhift ada hal APB (Ansible Playbook Bundle) yang memungkinkan Anda untuk mengemas pengetahuan dalam wadah bagaimana menggunakan infrastruktur.  Yaitu  Ada pengetahuan yang dapat direproduksi dan dapat diuji tentang cara menggunakan infrastruktur. </p><br><p><img src="https://habrastorage.org/webt/l_/cw/ho/l_cwho8ftxhtnmuekhjlsfllctg.png"></p><br><p>  Semua ini terdengar bagus, sampai kami membenamkan diri dalam infrastruktur yang heterogen: kami membutuhkan Windows untuk tes.  Akibatnya, pengetahuan tentang di mana akan digunakan dan diuji ada di jenkins. </p><br><h1 id="conclusion">  Kesimpulan </h1><br><p><img src="https://habrastorage.org/webt/j2/pp/6q/j2pp6qs2f6qjrz5pn35wuzd0luk.png"></p><br><p>  Infrastruktur sebagai Kode </p><br><ul><li>  Kode dalam repositori. </li><li>  Interaksi orang. </li><li>  Pengujian infrastruktur. </li></ul><br><div class="spoiler">  <b class="spoiler_title">tautan</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Versi Bahasa Inggris</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Posting silang dari blog pribadi</a> </li><li>  Lari kering 2019-04-24 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SpbLUG</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Video (RU) dari DevopsConf 2019-05-28</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Video (RU) dari DINS DevOps EVENING 2019-06-20</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pelajaran dari Menulis Lebih Dari 300.000 Baris Kode Infrastruktur</a> &amp; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">versi teks</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengintegrasikan Infrastruktur sebagai Kode ke dalam Pipa Pengiriman Kontinu</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menguji infrastruktur sebagai kode</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengembangan dan pemeliharaan yang efektif untuk peran yang memungkinkan</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kemungkinan bukan bash untuk Anda!</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Idempoten yang memungkinkan</a> </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id467171/">https://habr.com/ru/post/id467171/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id467155/index.html">Praktik Terbaik untuk Kontainer Kubernet: Pemeriksaan Kesehatan</a></li>
<li><a href="../id467161/index.html">Aplikasi web di Kotlin + Spring Boot + Vue.js</a></li>
<li><a href="../id467163/index.html">Cara bermigrasi ke cloud dalam dua jam berkat Kubernetes dan otomatisasi</a></li>
<li><a href="../id467165/index.html">Mengikuti jejak gerakan Scala Rusia. Bagian 2</a></li>
<li><a href="../id467169/index.html">Pelajaran yang diperoleh dari pengujian Lebih dari 200.000 baris Kode Infrastruktur</a></li>
<li><a href="../id467173/index.html">Arsitek implementasi ERP yang aman</a></li>
<li><a href="../id467175/index.html">Berpikir dua kali sebelum menggunakan mesin gim</a></li>
<li><a href="../id467177/index.html">Tips Pemasaran Tarantino: Apa yang Dimainkan Kaki Peran dan Mengapa Membuat Uma Thurman Soap</a></li>
<li><a href="../id467179/index.html">Samsung Compiler Bootcamp: mengajarkan untuk membuat "program pemrograman"</a></li>
<li><a href="../id467181/index.html">Mencoba membuat analog ASH untuk PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>