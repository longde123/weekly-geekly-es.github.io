<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯР╖ ЁЯМ╜ тП╕я╕П рднрд╛рдЧ 1: рдПрдХ рдЕрдкреНрд░рд╛рдХреГрддрд┐рдХ рдЖрд╡рд╛рд╕ рдореЗрдВ RISC-V / RocketChip ЁЯЩЛ ЁЯМн ЁЯСиЁЯП╛тАНЁЯПл</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдХреА рд▓рд╛рдЧрдд рдХреЗ рдмрд┐рдирд╛ RISC-V рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдкрд░ рдПрдХ рд▓реЗрдЦ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ ред рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рдЖрдк рдбрд┐рдмрдЧ рдмреЛрд░реНрдб ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рднрд╛рдЧ 1: рдПрдХ рдЕрдкреНрд░рд╛рдХреГрддрд┐рдХ рдЖрд╡рд╛рд╕ рдореЗрдВ RISC-V / RocketChip</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455391/"><img src="https://habrastorage.org/webt/it/on/yz/itonyz90xq9l_bvyih5h20xhuds.png" alt="RocketChip рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛" align="left"><br><p>  рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдХреА рд▓рд╛рдЧрдд рдХреЗ рдмрд┐рдирд╛ RISC-V рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдкрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХ рд▓реЗрдЦ</a> рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧрдпрд╛ рдерд╛</a> ред  рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рдЖрдк рдбрд┐рдмрдЧ рдмреЛрд░реНрдб рдкрд░ рдРрд╕рд╛ рдХрд░рддреЗ рд╣реИрдВ?  рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдЧреЗрдо рдЬрдирд░реЗрдЯрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореЗрдорд░реНрд╕: "рдЧреНрд░рд╛рдлрд┐рдХреНрд╕ рдХреА рд╢реИрд▓реА рдореЗрдВ 20 рдЪреЗрдХрдорд╛рд░реНрдХ рдХреНрд░рд╛рдЗрд╕рд┐рд╕ рд╕реЗ рдмрджрддрд░ рдирд╣реАрдВ рд╣реИрдВ", "рдЖрдк рдХреЛрд░реЛрд╡рд╛рди рдХреЛ рд▓реВрдЯ рд╕рдХрддреЗ рд╣реИрдВ" рдФрд░ "рдЬреЗрдирд░реЗрдЯ" рдмрдЯрдиред  RocketChip SoC рдЬрдирд░реЗрдЯрд░ рд▓рдЧрднрдЧ рдЙрд╕реА рддрд░рд╣ рд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдХреЗрд╡рд▓ рдЪреЗрдХрдорд╛рд░реНрдХ рд╡рд╛рд▓реА рдПрдХ рдЦрд┐рдбрд╝рдХреА рдирд╣реАрдВ рд╣реИ, рдмрд▓реНрдХрд┐ рдПрдХ рд╕реНрдХрд╛рд▓рд╛ рдХреЛрдб рдФрд░ рдХреЛрдбрд╛рдВрддрд░рдХ рдФрд░ рдореЗрдХ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдПрдХ рд╕рд╛ рд╣реИред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рдореИрдВ рджрд┐рдЦрд╛рдКрдВрдЧрд╛ рдХрд┐ рдЗрд╕ рд░реЙрдХреЗрдЯрд╢рд┐рдк рдХреЛ рдЕрдкрдиреЗ рдореВрд▓ Xilinx рд╕реЗ Altera / Intel рдореЗрдВ рдкреЛрд░реНрдЯ рдХрд░рдирд╛ рдХрд┐рддрдирд╛ рдЖрд╕рд╛рди рд╣реИред </p><a name="habracut"></a><br><p>  <strong>рдЕрд╕реНрд╡реАрдХрд░рдг:</strong> рд▓реЗрдЦрдХ "рдЬрд▓рд╛" рдмреЛрд░реНрдб рдХреЗ рд▓рд┐рдП рдЬрд╝рд┐рдореНрдореЗрджрд╛рд░ рдирд╣реАрдВ рд╣реИ - рдзреНрдпрд╛рди рд╕реЗ рджреЗрдЦреЗрдВ рдХрд┐ рдЖрдк рдкрд┐рди рдХреИрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ, рдЖрдк рд╢рд╛рд░реАрд░рд┐рдХ рд░реВрдк рд╕реЗ рдХреНрдпрд╛ рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдЖрджрд┐ред  рдЦреИрд░, рд╕реБрд░рдХреНрд╖рд╛ рд╕рд╛рд╡рдзрд╛рдирд┐рдпреЛрдВ рдХрд╛ рднреА рдкрд╛рд▓рди рдХрд░реЗрдВред  рдЖрдкрдХреЛ рдпрд╣ рдирд╣реАрдВ рд╕реЛрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЪреВрдВрдХрд┐ рд╕рдм рдХреБрдЫ рдпреВрдПрд╕рдмреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИ, рддреЛ рдпрд╣ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ: рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдЕрдкрдиреЗ рдкрд┐рдЫрд▓реЗ рдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рд╕рдордЭрд╛ рдерд╛, рднрд▓реЗ рд╣реА рдЖрдк рдпреВрдПрд╕рдмреА-рдмреЛрд░реНрдб рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реЛрдВ, рдлрд┐рд░ рднреА рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдкреИрд░ рдХреЗ рд╕рд╛рде рд╣реАрдЯрд┐рдВрдЧ рдмреИрдЯрд░реА рдХреЛ рдЫреВрдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕рдВрднрд╛рд╡рд┐рдд рдЕрдВрддрд░ ... рдУрд╣ рд╣рд╛рдВ , рдореИрдВ рд▓рдЧрднрдЧ рдПрдХ рдкреЗрд╢реЗрд╡рд░ plisovods рдпрд╛ рдЗрд▓реЗрдХреНрдЯреНрд░реЙрдирд┐рдХ рдЗрдВрдЬреАрдирд┐рдпрд░ рдирд╣реАрдВ рд╣реВрдБ - рдореИрдВ рд╕рд┐рд░реНрдл рдПрдХ рд╕реНрдХрд╛рд▓рд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рд╣реВрдБред </p><br><p> рдЬрд╣рд╛рдВ рддрдХ тАЛтАЛрдореИрдВ рд╕рдордЭрддрд╛ рд╣реВрдВ, рд░реЙрдХреЗрдЯрд╕реЗрдЯ рдХреЛ рдбрд┐рдмрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдордВрдЪ рдПрдХреНрд╕рд┐рд▓рд┐рдирдПрдХреНрд╕ рдПрдлрдкреАрдЬреАрдП рдерд╛ред  рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдЬрд┐рд╕реЗ рд╣рдо рдЬрд▓реНрдж рд╣реА рдХреНрд▓реЛрди рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЗрд╕реЗ рдорд╛рдЗрдХреНрд░реЛрд╕реЗрдореА рдореЗрдВ рднреА рд░рдЦрд╛ рдЧрдпрд╛ рдерд╛ред  рдХрд╣реАрдВ рдореИрдВрдиреЗ рдПрд▓реНрдЯрд░ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реБрдирд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕реНрд░реЛрдд рдирд╣реАрдВ рджреЗрдЦрд╛ред  рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ, рдпрд╣ рдПрдХ рдмрдбрд╝реА рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИ: рдЬрд┐рд╕ рдХреНрд╖рдг рд╕реЗ рд╣рдордиреЗ рдмреЛрд░реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдФрд░ рдХрд╛рд░реНрдпрд╢реАрд▓ " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореЗрдореЛрд░реАрд▓реЗрд╕</a> " рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">SiFive рдлреНрд░реАрдбрдо</a> рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛ (рдпрд╛рдиреА, рдХреЗрд╡рд▓ рдкреНрд░реЛрд╕реЗрд╕рд░ рд░рдЬрд┐рд╕реНрдЯрд░, рдмреВрдЯрдореЙрдо рдФрд░ рдореЗрдореЛрд░реА рдореИрдкреНрдб рд░рдЬрд┐рд╕реНрдЯрд░, 32-рдмрд┐рдЯ "рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░"), рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╣реИ рдХреБрдЫ <em>рдиреИрдиреЛрдХрдВрдЯреНрд░реЛрд▓рд░</em> рдирд┐рдХрд▓рддрд╛ рд╣реИ ...) 3 рджрд┐рди рдХреА рдЫреБрдЯреНрдЯреА рдФрд░ 4 <em>рд╡реАрдХреЗрдВрдбреНрд╕</em> рдмреАрдд рдЪреБрдХреЗ рд╣реИрдВ, рдФрд░ рдЕрдЧрд░ рд╡рд┐рд╢реНрд╡ рд╕реНрддрд░ рдкрд░ <code>SYNTHESIS</code> рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреБрд░рдВрдд рдореЗрд░реЗ рдкрд╛рд╕ рдЖрдпрд╛ рддреЛ рдЗрд╕реЗ рдФрд░ рднреА рдХрдо рд▓реЗ рд▓рд┐рдпрд╛ рд╣реЛрдЧрд╛ред </p><br><h1 id="materialy">  рд╕рд╛рдордЧреНрд░реА </h1><br><p>  рд╢реБрд░реБрдЖрдд рдХреЗ рд▓рд┐рдП - рд╢рдмреНрдж рдХреЗ рд╡реНрдпрд╛рдкрдХ рдЕрд░реНрде рдореЗрдВ <em>рд╕рд╛рдордЧреНрд░реА</em> рдХреА рдПрдХ рд╕реВрдЪреАред  рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░реЙрдХреЗрдЯрд╢рд┐рдк</a> - рдЗрд╕рдореЗрдВ рд╕реНрд╡рдпрдВ рдкреНрд░реЛрд╕реЗрд╕рд░ рдФрд░ рдЕрд╕реЗрдВрдмрд▓реА рд╡рд╛рддрд╛рд╡рд░рдг рд╢рд╛рдорд┐рд▓ рд╣реИ (рд╕рд╣рд┐рдд, рдХрдИ рдЙрдк-рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддрд╛ рд╣реИ)ред  рд░реЙрдХреЗрдЯ рдХреЛрд░ рдЗрди-рдСрд░реНрдбрд░ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЗ рд╕рд╛рде рд░реЙрдХреЗрдЯрд╢рд┐рдк рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдоред </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">SiFive рд╕реНрд╡рддрдВрддреНрд░рддрд╛</a> - рд╡рд┐рднрд┐рдиреНрди рдбрд┐рдмрдЧ рдмреЛрд░реНрдбреЛрдВ рдХреЗ рд▓рд┐рдП рдмрд╛рдзреНрдпрдХрд╛рд░реА - рд╡рд╣рд╛рдВ рд╣рдо рдЕрдкрдиреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░реЙрдХреЗрдЯ-рдЯреВрд▓реНрд╕</a> - 32- рдФрд░ 64-рдмрд┐рдЯ рдЖрд░рдЖрдИрдПрд╕рд╕реА-рд╡реА рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдмрдирд╛рдиреЗ рдФрд░ рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Openocd-riscv</a> - RISC-V рдЧреБрдард▓реА (рдХрдо рд╕реЗ рдХрдо RocketChip) рдХреЗ рд╕рд╛рде JTAG рдкрд░ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">OpenOCD</a> рдкреЛрд░реНрдЯ </li><li>  рд╕реНрдХрд╛рд▓рд╛ рдХреЛрдб рдХреЗ рд╕рдВрдкрд╛рджрди рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">IntelliJ IDEA рд╕рдореБрджрд╛рдп</a> , рдЬреЛ рдХрд┐ RocketChip рдореЗрдВ рдмрд╣реБрдордд рд╣реИ </li><li>  SiFive рдХреЗ рдкреВрд░реНрд╡-рдЗрдХрдЯреНрдареЗ рдЯреВрд▓рдЪреИрди рднреА рдХрд╛рдо рдореЗрдВ рдЖ рд╕рдХрддреЗ рд╣реИрдВ, рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓рд┐рдВрдХ</a> рдЬреЛ рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╣реА рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдП рдЧрдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЗрдЦ</a> рдореЗрдВ рджреЗрдЦрд╛ рдерд╛ </li></ul><br><p>  рд▓реЛрд╣реЗ рд╕реЗ рдХреНрдпрд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ: </p><br><ul><li>  Aliexpress рд╕реЗ рдЬрд╝рд┐рдпреЛрд╡рд╛ рдХрд┐рдЯ: рд╕рд╛рдЗрдХреНрд▓реЛрди 4 EP4CE115 рдФрд░ (рдХреНрд▓реЛрди?) USB рдмреНрд▓рд╛рд╕реНрдЯрд░ рдХреЗ рд╕рд╛рде рдмреЛрд░реНрдб </li><li>  рд╕реЙрдлреНрдЯ рдХреЛрд░ рдХреЗ рд▓рд┐рдП JTAG рдбрд┐рдмрдЧрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд░рд╛рд╕реНрдкрдмреЗрд░реАрдкреА </li></ul><br><p>  рд╣реЛрд╕реНрдЯ рдорд╢реАрди рдХреЛ рдПрдХ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдХрдВрдкреНрдпреВрдЯрд░ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЙрдмрдВрдЯреВ рдФрд░ рдХреНрд╡рд╛рд░реНрдЯрд╕ рд▓рд╛рдЗрдЯ 18 рд╕реНрдерд╛рдкрд┐рдд рд╣реИред </p><br><p>  рджрд░рдЕрд╕рд▓, рдлрд╛рдпрд░рдлрд┐рдо рдирд╛рдордХ рдПрдХ рд╣реА SiFive рд╕реЗ рдЙрдирдХреЗ FPGA- рдЙрджрд╛рд╣рд░рдгреЛрдВ рдкрд░ рдЕрдореЗрдЬрд╝реЕрди рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЗрддрдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рдирд╣реАрдВ рд╣реИ, <del>  рд╣рд╛рдВ, рдФрд░ рдПрд▓рдИрдбреА рдЦрд░рд╛рдм рджрд┐рдЦрд╛рдИ рджреЗ рд░рд╣реЗ рд╣реИрдВ </del>  ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдЕрдиреНрдп рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдВрдЯреНрд░реЛрд▓ рдЙрджрд╛рд╣рд░рдг рдкрд░ рдЕрдкрдиреА рдПрдкреАрдЖрдИ рдХреБрдВрдЬреА рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдФрд░ рдЖрдкрдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕рдХреА рдмрд╣реБрдд рджреЗрдЦрднрд╛рд▓</a> рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЕрдиреНрдпрдерд╛ рдпрд╣ рдЕрдлрд╡рд╛рд╣ рд╣реИ рдХрд┐ рдЖрдк рдПрдХ рджрд┐рди рдореЗрдВ рд╣рдЬрд╛рд░реЛрдВ рдбреЙрд▓рд░ рдХреЗ рдЛрдг рдХреЗ рд╕рд╛рде рдЬрд╛рдЧ рд╕рдХрддреЗ рд╣реИрдВ ... </p><br><h1 id="izuchaem-obstanovku">  рд╣рдо рд╕реНрдерд┐рддрд┐ рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рддреЗ рд╣реИрдВ </h1><br><p>  рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдмреЛрд░реНрдб рд╡рд┐рдХреНрд░реЗрддрд╛ рд╕реЗ <code>read_write_1G</code> рдкрд░реАрдХреНрд╖рдг рдкрд░рд┐рдпреЛрдЬрдирд╛ рд▓реА рдФрд░ <code>read_write_1G</code> рдЖрд╡рд╢реНрдпрдХ рд╕реНрд░реЛрддреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ред  рдирдпрд╛ рдХреНрдпреЛрдВ рдирд╣реАрдВ рдмрдирд╛рдпрд╛?  рдХреНрдпреЛрдВрдХрд┐ рдореИрдВ рдирдпрд╛ рд╣реВрдБ, рдФрд░ рдЗрд╕ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдкрд┐рдВрд╕ рдХреЗ рдирд╛рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдореИрдк рдХрд┐рдП рдЧрдП рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ рдХрд╣реАрдВ рд╕реЗ рд╕реЛрд░реНрд╕ рдХреЛрдб рд▓реЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ <code>freedom</code> рднрдВрдбрд╛рд░ ( <code>freedom-e-sdk</code> рд╕рд╛рде рднреНрд░рдорд┐рдд рдирд╣реАрдВ рд╣реЛрдирд╛) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред  рдХрдо рд╕реЗ рдХрдо рдХреБрдЫ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░ <code>rocket-tools</code> рдПрдХрддреНрд░ рдХрд░реЗрдВрдЧреЗ (рд╢рд╛рдмреНрджрд┐рдХ рд░реВрдк рд╕реЗ рджреЛ рд▓рд┐рдкрд┐рдпреЛрдВ рдФрд░ рдмрд╣реБрдд рдкреНрд░рддреАрдХреНрд╖рд╛ рдХреА рд╢реБрд░реВрдЖрдд), рдФрд░ рдлрд┐рд░ рдЪрд▓рд╛рдПрдВ </p><br><pre> <code class="plaintext hljs">RISCV=$(pwd)/../rocket-tools make -f Makefile.e300artydevkit verilog mcs</code> </pre> <br><p>  рд▓рдХреНрд╖реНрдп <code>verilog</code> рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕реНрд░реЛрддреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╡рд┐рд╢рд╛рд▓ Verilog рдлрд╝рд╛рдЗрд▓ рдЙрддреНрдкрдиреНрди <code>verilog</code> , рдФрд░ <code>mcs</code> BootROM <code>mcs</code> рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдЧрд╛ред  рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВ рдХрд┐ <code>mcs</code> рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ - рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ Xilinx Vivado рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рдВрдХрд▓рд┐рдд BootROM рдХреЛ рдЙрд╕ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ Vivado рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рдореЗрдиреВ рдЖрдЗрдЯрдо Quartus <strong>рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ</strong> рдорд╛рдзреНрдпрдо рд╕реЗ <strong>-&gt; рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЗрдВ рдЬреЛрдбрд╝реЗрдВ / рдирд┐рдХрд╛рд▓реЗрдВ ...</strong> <code>freedom/builds/e300artydevkit/sifive.freedom.everywhere.e300artydevkit.E300ArtyDevKitConfig.v</code> рдЬреЛрдбрд╝реЗрдВ <code>freedom/builds/e300artydevkit/sifive.freedom.everywhere.e300artydevkit.E300ArtyDevKitConfig.v</code> , рд╢реАрд░реНрд╖ рд╕реНрддрд░ рдХреА рдЗрдХрд╛рдИ рд╕реЗрдЯ рдХрд░реЗрдВ: <strong>E300ArtyDevitKPGFPGPPG</strong> рдкрд░ <strong>рдЪрд╛рд▓реВ</strong> рдХрд░реЗрдВред рд╢реАрд░реНрд╖ рд╕реНрддрд░ рдХреА рдЗрдХрд╛рдИ рд╕реНрд╡рддрдГ рдкреВрд░реНрдг рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд╕реВрдЪреА рдкрд╣рд▓реЗ рд╕рдВрдХрд▓рди рдХреЗ рдмрд╛рдж рджрд┐рдЦрд╛рдИ рджреЗрдЧреА)ред  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╣рдореЗрдВ <code>AsyncResetReg</code> , <code>IOBUF</code> рдореЙрдбреНрдпреВрд▓, рдЖрджрд┐ рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕рд╛рд░реА рддреНрд░реБрдЯрд┐рдпрд╛рдВ <code>AsyncResetReg</code> ред  рдпрджрд┐ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рд╢реАрд░реНрд╖ рд╕реНрддрд░ рдХреА рдЗрдХрд╛рдИ рдХреЛ рдмрджрд▓рдирд╛ рднреВрд▓ рдЧрдПред  рдпрджрд┐ рдЖрдк рд╕реНрд░реЛрдд рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ <code>AsyncResetReg.v</code> рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рд╕реАрдзреЗ <code>AsyncResetReg.v</code> рдлрд╝рд╛рдЗрд▓ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди <code>IOBUF</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Xilinx</a> рдХреЗ IP рдХреЛрд░ рдХреЗ рд▓рд┐рдП рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмрд╛рдзреНрдпрдХрд╛рд░реА</a> рд╣реИред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, <code>freedom/rocket-chip/src/main/resources/vsrc/AsyncResetReg.v</code> ред  рдФрд░ <code>plusarg_reader.v</code> рдХреЛ рднреА рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рд╕рдВрдХрд▓рди рдЪрд▓рд╛рдПрдВ рдФрд░ рдПрдХ рдФрд░ рддреНрд░реБрдЯрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ: </p><br><pre> <code class="plaintext hljs">Error (10174): Verilog HDL Unsupported Feature error at plusarg_reader.v(18): system function "$value$plusargs" is not supported for synthesis</code> </pre> <br><p>  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЧреИрд░-рд╕рдВрд╢реНрд▓реЗрд╖рд┐рдд рдирд┐рд░реНрдорд╛рдгреЛрдВ рдХреЛ рдПрдХ рд╕рдорд╛рди рдирд╛рдо рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдЙрдореНрдореАрдж рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">plusarg_reader.v</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">// See LICENSE.SiFive for license details. //VCS coverage exclude_file // No default parameter values are intended, nor does IEEE 1800-2012 require them (clause A.2.4 param_assignment), // but Incisive demands them. These default values should never be used. module plusarg_reader #(parameter FORMAT="borked=%d", DEFAULT=0) ( output [31:0] out ); `ifdef SYNTHESIS assign out = DEFAULT; `else reg [31:0] myplus; assign out = myplus; initial begin if (!$value$plusargs(FORMAT, myplus)) myplus = DEFAULT; end `endif endmodule</code> </pre> </div></div><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдореЙрдбреНрдпреВрд▓ рд╕рдВрднрд╡рддрдГ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рд╕реЗ рд╕рд┐рдореБрд▓реЗрд╢рди рд╡рд┐рдХрд▓реНрдк рдкрдврд╝рддрд╛ рд╣реИ, рдФрд░ рдЬрдм рдЗрд╕реЗ рд╕рдВрд╢реНрд▓реЗрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рддреЛ рдмрд╕ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рджреЗрддрд╛ рд╣реИред  рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реА рдкрд░рд┐рдпреЛрдЬрдирд╛ <code>SYNTHESIS</code> рдирд╛рдо рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рд╣реИред  <code>ifdef</code> рд╕реЗ рдареАрдХ рдкрд╣рд▓реЗ рдкрд┐рдЫрд▓реА рдкрдВрдХреНрддрд┐ рдкрд░ <code>`define SYNTHESIS</code> рдХреЛ <code>`define SYNTHESIS</code> рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдФрд░ рдлрд┐рд░ рдЖрдзрд╛ рд╕рдкреНрддрд╛рд╣ рдпрд╣ рд╕рдордЭрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдореЗрдВ рдмрд┐рддрд╛рдПрдВ рдХрд┐ рдХрд░реНрдиреЗрд▓ рд╢реБрд░реВ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ (рдФрд░ рдЖрдЦрд┐рд░рдХрд╛рд░, рд╕рдВрдХреНрд░рдордг рд╕рдВрд╢реНрд▓реЗрд╖рд┐рдд рд╣реИ ...)ред  рдореЗрд░реА рдЧрд▓рддрд┐рдпреЛрдВ рдХреЛ рди рджреЛрд╣рд░рд╛рдПрдВ, рд▓реЗрдХрд┐рди рдмрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЧреБрдгреЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЦреЛрд▓реЗрдВ, рдФрд░ <strong>рдХрдВрдкрд╛рдЗрд▓рд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкрд░-&gt; рд╡реЗрд░рд┐рд▓реЙрдЧ рдПрдЪрдбреАрдПрд▓ рдЗрдирдкреБрдЯ</strong> рдЯреИрдм, <code>SYNTHESIS</code> рдореИрдХреНрд░реЛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ, рдФрд░ рдХрдо рд╕реЗ рдХрдо 1, <code>&lt;NONE&gt;</code> (рдЦрд╛рд▓реА рд▓рд╛рдЗрди) рдореЗрдВ рдирд╣реАрдВред </p><br><p>  рдпрд╣рд╛рдБ!  рдЕрдм рдХреНрд╡рд╛рд░реНрдЯрд╕ рд▓рд╛рдкрддрд╛ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдкрд░ рд╢рдкрде рд▓реЗрддрд╛ рд╣реИ - рдЖрдЗрдбрд┐рдпрд╛ рдореЗрдВ рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдФрд░ рдкреЛрд░реНрдЯрд┐рдВрдЧ рд╢реБрд░реВ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред </p><br><h1 id="znakomimsya-s-proektom">  рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рдЬрд╛рдирдирд╛ </h1><br><p>  рд╣рдо рдЖрдпрд╛рдд рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд╡рд┐рдЪрд╛рд░ рдХреЛ рдмрддрд╛рддреЗ рд╣реИрдВ, <code>freedom</code> рднрдВрдбрд╛рд░ рдХреЛ рдкрде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ, sbt рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЪреЗрдХрдмреЙрдХреНрд╕ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП, рдЖрдпрд╛рдд рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ sbt рд╢реЗрд▓ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВред  рдпрд╣рд╛рдВ, рдкрд░реА рдХрдерд╛ рд╕рдорд╛рдкреНрдд рд╣реЛрддреА рд╣реИ, рдРрд╕рд╛ рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдЖрдзреЗ-рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рд╡рд┐рдЪрд╛рд░ рдХреЛ рдирд╣реАрдВ рдЦреЛрдЬрддрд╛ рд╣реИ - рд╕рднреА рд╕реНрд░реЛрдд рдХреЛрдб рд▓рд╛рд▓ рд░рдВрдЧ рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рд╣реИрдВред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ рд╕реЗ</a> рдорд┐рд▓реА рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдореБрдЭреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдорд┐рд▓реА: </p><br><ul><li>  sbt рд╢реЗрд▓ рд╡рд┐рдВрдбреЛ рдЦреЛрд▓реЗрдВ </li><li>  <code>clean</code> рдкреНрд░рд╡реЗрд╢ рдХрд░реЗрдВ </li><li>  рдмрд╛рдИрдВ рдУрд░ рд╣рд░реЗ рд░рдВрдЧ рдХрд╛ рдкреБрдирд░рд╛рд░рдВрдн рдмрдЯрди рджрдмрд╛рдПрдБ </li><li>  sbt рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдкрд╣рд▓реЗ рдХрдорд╛рдВрдб <code>++2.12.4</code> рджрд░реНрдЬ рдХрд░реЗрдВ, рдЬрд┐рд╕рд╕реЗ рд╕рднреА рд╕рдмрдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ Scala рд╡рд░реНрдЬрди 2.12.4 рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░ рджреЗрдВ, рдлрд┐рд░ рд╣рдо <code>compile</code> рдЪрд▓рд╛рдПрдВрдЧреЗ </li><li>  рд╕рднреА sbt рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЖрдЗрдбрд┐рдпрд╛ рдХреЛ рддрд╛рдЬрд╝рд╛ рдХрд░реЗрдВ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ </li><li>  рд▓рд╛рдн!, рдЕрдм backlight рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ </li></ul><br><p>  рдЕрдм рддрдХ, рдореИрдВ рдХрд┐рд╕реА рднреА рддрд░рд╣ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реВрдВрдЧрд╛, рдХрдо рд╕реЗ рдХрдо рдЕрд░реНрдз-рдореИрдиреБрдЕрд▓ рдореЛрдб рдореЗрдВред  <strong>рд╡реИрд╕реЗ, рдХреЛрдИ <code>quartus_ipcreate</code> рдмрддрд╛рдУ, рд▓рд╛рдЗрдЯ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ <code>quartus_ipcreate</code> рд╣реИ?</strong>  рд╣рдо рдЕрднреА рдХреЗ рд▓рд┐рдП рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЖрдИрдкреА рд╡реЗрд░рд┐рдПрд╢рди рдмрдирд╛рдПрдВрдЧреЗ, рдФрд░ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдХреЗрд╡рд▓ рдмреНрд▓реИрдХрдмреЙрдХреНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдХрд╛рд▓рд╛ рдкрд░ рд╣реЛрдЧреАред </p><br><p>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкрджрд╛рдиреБрдХреНрд░рдо рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">fpga-shells () | +-src/main/scala | +- ip/intel &lt;--     IP Variations | | | +- Intel.scala | +- shell/intel &lt;--       | +- ZeowaaShell.scala src/main/scala | +- everywhere.e300artydevkit &lt;--   "" ,    | +- zeowaa/e115 &lt;--      "" SoC | +- Config +- FPGAChip +- Platform +- System</code> </pre> <br><p>  рдЖрдкрдХреЛ Makefile.e300artydevkit рдХреЗ рд╕рдорд╛рди рдПрдХ рдореЗрдХрдлрд╛рдЗрд▓ рднреА рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛, рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ: </p><br><p>  <strong>Makefile.zeowaa-e115:</strong> </p><br><pre> <code class="plaintext hljs"># See LICENSE for license details. base_dir := $(patsubst %/,%,$(dir $(abspath $(lastword $(MAKEFILE_LIST))))) BUILD_DIR := $(base_dir)/builds/zeowaa-e115 FPGA_DIR := $(base_dir)/fpga-shells/intel MODEL := FPGAChip PROJECT := sifive.freedom.zeowaa.e115 export CONFIG_PROJECT := sifive.freedom.zeowaa.e115 export CONFIG := ZeowaaConfig export BOARD := zeowaa export BOOTROM_DIR := $(base_dir)/bootrom/xip rocketchip_dir := $(base_dir)/rocket-chip sifiveblocks_dir := $(base_dir)/sifive-blocks include common.mk</code> </pre> <br><h1 id="bindingi">  рдмрд╛рдЗрдВрдбрд┐рдВрдЧ </h1><br><p>  рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрд╕ <code>IOBUF</code> рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ - рдпрд╣ рд╢рд╛рдпрдж рд╣реА рдореБрд╢реНрдХрд┐рд▓ рд╣реЛрдЧрд╛ред  рд╕реНрдХрд╛рд▓рд╛ рдХреЛрдб рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдпрд╣ рдПрдХ рдРрд╕рд╛ рдореЙрдбреНрдпреВрд▓ рд╣реИ рдЬреЛ рднреМрддрд┐рдХ "рд▓реЗрдЧ" (рдмреЙрд▓?) рдХреЛ рдорд╛рдЗрдХреНрд░реЛрдХреНрд░рд┐рдХрд┐рдЯ рдкрд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ: рдЗрд╕реЗ рдЪрд╛рд▓реВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЪрд╛рд▓реВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдмрдВрдж рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдХреНрд╡рд╛рд░реНрдЯрд╕ рд╡рд┐рдВрдбреЛ рдХреЗ рджрд╛рд╣рд┐рдиреЗ рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ, рд╣рдо "IOBUF" рдЖрдИрдкреА рдХреИрдЯрд▓реЙрдЧ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рддреБрд░рдВрдд <code>ALTIOBUF</code> рдирд╛рдордХ рдПрдХ рдШрдЯрдХ рдкреНрд░рд╛рдкреНрдд <code>ALTIOBUF</code> ред  рдЪрд▓реЛ рд╡рд┐рд╡рд┐рдзрддрд╛ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдирд╛рдо рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, "рдПрдХ рджреНрд╡рд┐рджрд┐рд╢ рдмрдлрд░ рдХреЗ рд░реВрдк рдореЗрдВ" рдЪреБрдиреЗрдВред  рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдорд╛рд░реЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ <code>iobuf</code> рдирд╛рдордХ рдПрдХ рдореЙрдбреНрдпреВрд▓ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛: </p><br><pre> <code class="plaintext hljs">// ... module obuf ( datain, oe, dataout); input [0:0] datain; input [0:0] oe; output [0:0] dataout; wire [0:0] sub_wire0; wire [0:0] dataout = sub_wire0[0:0]; obuf_iobuf_out_d5t obuf_iobuf_out_d5t_component ( .datain (datain), .oe (oe), .dataout (sub_wire0)); endmodule // ...</code> </pre> <br><p>  рдЖрдЗрдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдмреНрд▓реИрдХрдмреЙрдХреНрд╕ рдореЙрдбреНрдпреВрд▓ рд▓рд┐рдЦреЗрдВ: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ip.intel <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.core.{<span class="hljs-type"><span class="hljs-type">Analog</span></span>, <span class="hljs-type"><span class="hljs-type">BlackBox</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> freechips.rocketchip.jtag.<span class="hljs-type"><span class="hljs-type">Tristate</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IOBUF</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlackBox</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> datain = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dataout = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> oe = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dataio = <span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">desiredName</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"iobuf"</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IOBUF</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span></span>(a: <span class="hljs-type"><span class="hljs-type">Analog</span></span>, t: <span class="hljs-type"><span class="hljs-type">Tristate</span></span>): <span class="hljs-type"><span class="hljs-type">IOBUF</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> res = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">IOBUF</span></span>) res.io.datain := t.data res.io.oe := t.driven a &lt;&gt; res.io.dataio res } }</code> </pre> <br><p>  рд╣рдо рдЯрд╛рдЗрдк <code>Analog</code> рдХреЗ рд╡реЗрд░рд┐рд▓реЛрдЧ рдЗрдирдЖрдЙрдЯ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ <code>desiredName</code> рд╡рд┐рдзрд┐ <code>desiredName</code> рдореЙрдбреНрдпреВрд▓ рдХрд╛ рд╡рд░реНрдЧ рдирд╛рдо рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред  рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдмрд╛рдЗрдВрдбрд░реНрд╕ рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ, рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдирд╣реАрдВред </p><br><p>  рд╣рдореЗрдВ BootROM рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ - рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдо <strong>ROM: 1-PORT</strong> (2048 x 32-рдмрд┐рдЯ рд╢рдмреНрдж, рдХреЗрд╡рд▓ рдПрдбреНрд░реЗрд╕ рд░рдЬрд┐рд╕реНрдЯрд░, <code>rden</code> рдкреЛрд░реНрдЯ рдмрдирд╛рдПрдБ) рдХреА рднрд┐рдиреНрдирддрд╛ рдмрдирд╛рдПрдБред  рд╣рдо рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рдмреНрд▓реЙрдХ рдмрдирд╛рддреЗ рд╣реИрдВ <code>rom</code> , рдХреНрдпреЛрдВрдХрд┐ рддрдм рд╣рдореЗрдВ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдбреЗрдкреНрдЯрд░ рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ <code>ROMGenerator</code> рд╡рд░реНрдЧ рдХреЛ <code>ROMGenerator</code> : <code>me</code> рдмрдЬрд╛рдп <code>ROMGenerator</code> рдФрд░ рд╣рдорд╕реЗ рдЧрд╛рдпрдм (рдпрд╣ рдЕрднреА рднреА 1 рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИ): </p><br><p>  <strong>BootROM.v:</strong> </p><br><pre> <code class="plaintext hljs">module BootROM( input wire [10:0] address, input wire clock, input wire me, input wire oe, output wire [31:0] q ); rom r( .address(address), .clock(clock), .rden(me), .q(q) ); endmodule</code> </pre><br><p>  рдПрдХ рдФрд░ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рддреБрд░рдВрдд рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рдХрд▓реЗрдХреНрдЯрд░ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╣реЗрдХреНрд╕-рдлрд╛рдЗрд▓реЗрдВ, рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ, рдХреНрд╡рд╛рд░реНрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдЕрд╕рдВрдЧрдд рд╣реЛрдирд╛ред  рдЗрдВрдЯреЗрд▓ рд╣реЗрдХреНрд╕ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╡рд┐рд╖рдп рдкрд░ рдПрдХ рд╣рд▓реНрдХреА рдЧреБрдЧрд▓реА рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж (рдЗрдВрдЯреЗрд▓ рдЗрд╕ рдЗрдВрдЯреЗрд▓ рдПрд▓реНрдЯрд░ рдХреА рдЦрд░реАрдж рд╕реЗ рдмрд╣реБрдд рдкрд╣рд▓реЗ рдерд╛, рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВ рдЗрд╕реЗ рд╕рдордЭрддрд╛ рд╣реВрдВ), рд╣рдо рдРрд╕реЗ рдХрдорд╛рдВрдб рдореЗрдВ рдЖрддреЗ рд╣реИрдВ рдЬреЛ рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдПрдЪрдИрдПрдХреНрд╕ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИ: </p><br><pre> <code class="plaintext hljs">srec_cat -Output builds/zeowaa-e115/xip.hex -Intel builds/zeowaa-e115/xip.bin -Binary -Output_Block_Size 128</code> </pre> <br><p>  рдЗрд╕рд▓рд┐рдП, рд╣рдорд╛рд░рд╛ рдореЗрдХрдлрд╛рдЗрд▓ рдереЛрдбрд╝рд╛ рдмрджрд▓ рдЬрд╛рдПрдЧрд╛: </p><br><div class="spoiler">  <b class="spoiler_title">рдЫрд┐рдкрд╛ рд╣реБрдЖ рдкрд╛рда</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">base_dir := $(patsubst %/,%,$(dir $(abspath $(lastword $(MAKEFILE_LIST))))) BUILD_DIR := $(base_dir)/builds/zeowaa-e115 FPGA_DIR := $(base_dir)/fpga-shells/intel MODEL := FPGAChip PROJECT := sifive.freedom.zeowaa.e115 export CONFIG_PROJECT := sifive.freedom.zeowaa.e115 export CONFIG := ZeowaaConfig export BOARD := zeowaa export BOOTROM_DIR := $(base_dir)/bootrom/xip rocketchip_dir := $(base_dir)/rocket-chip sifiveblocks_dir := $(base_dir)/sifive-blocks all: verilog $(MAKE) -C $(BOOTROM_DIR) clean romgen || true srec_cat -Output $(BUILD_DIR)/xip.hex -Intel $(BUILD_DIR)/xip.bin -Binary -Output_Block_Size 128 include common.mk</code> </pre> </div></div><br><h1 id="ono-shevelitsyaw-sinteziruetsya">  рдпрд╣ рдЪрд▓рддрд╛ рд╣реИ ^ W рд╕рдВрд╢реНрд▓реЗрд╖рд┐рдд рд╣реИ </h1><br><p>  рддреЛ, рдПрдХ рдкреВрд░реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рд╕рдВрд╢реНрд▓реЗрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЕрдм рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рдмрд╛рдд рдбрд┐рдмрдЧрд┐рдВрдЧ рд╣реИред  рдмрд┐рд▓реНрд▓реА рдХреЛ рдкрд╣рд▓реЗ рдШрд░ рдореЗрдВ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рддреА рд╣реИ, рдФрд░ рд╢рд╛рдпрдж JTAG рдХреЛ рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдореЗрдВред  рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд▓рдЧрднрдЧ рдиреНрдпреВрдирддрдо рд╕рд┐рд╕реНрдЯрдо рдмрдирд╛рддреЗ рд╣реИрдВ: рдмреВрдЯ рд╕реЗ рдмреВрдЯ, рдЬреАрдкреАрдЖрдИрдУ рд╕реЗ рдПрд▓рдИрдбреА рдХреЛ рдмреНрд▓рд┐рдВрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдФрд░ рдЬреЗрдЯреАрдПрдЬреА рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпреЛрдВ рдХреБрдЫ рднреА рд▓реЛрдб рдирд╣реАрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИ рдФрд░ рдмреНрд▓рд┐рдВрдХрд┐рдВрдЧ рдирд╣реАрдВред  <code>E300ArtyDevKit</code> рд╕рд╛рде рд╕рд╛рджреГрд╢реНрдп рдХрд░рдХреЗ <code>E300ArtyDevKit</code> рдЗрд╕рдореЗрдВ рдЪрд╛рд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдкреИрдХреЗрдЬ рдмрдирд╛рдПрдБред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, </p><br><p>  <strong>Config.scala:</strong> </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultZeowaaConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> (</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> new </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">WithNBreakpoints</span></span></span></span><span class="hljs-class"><span class="hljs-params">(2</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">++</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithNExtTopInterrupts</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">0</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">++</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithJtagDTM</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">++</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TinyConfig</span></span></span><span class="hljs-class"> ) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Peripherals</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(site, here, up</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=&gt;</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">PeripheryGPIOKey</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>( <span class="hljs-type"><span class="hljs-type">GPIOParams</span></span>(address = <span class="hljs-type"><span class="hljs-type">BigInt</span></span>(<span class="hljs-number"><span class="hljs-number">0x64002000</span></span>L), width = <span class="hljs-number"><span class="hljs-number">6</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">PeripheryMaskROMKey</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>( <span class="hljs-type"><span class="hljs-type">MaskROMParams</span></span>(address = <span class="hljs-number"><span class="hljs-number">0x10000</span></span>, name = <span class="hljs-string"><span class="hljs-string">"BootROM"</span></span>)) }) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeowaaConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> new </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Peripherals</span></span></span></span><span class="hljs-class"><span class="hljs-params"> ++ new </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">DefaultZeowaaConfig</span></span></span></span><span class="hljs-class"><span class="hljs-params">(</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alter</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(site, here, up</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=&gt;</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">JtagDTMKey</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">JtagDTMConfig</span></span> ( idcodeVersion = <span class="hljs-number"><span class="hljs-number">2</span></span>, idcodePartNum = <span class="hljs-number"><span class="hljs-number">0xe31</span></span>, idcodeManufId = <span class="hljs-number"><span class="hljs-number">0x489</span></span>, debugIdleCycles = <span class="hljs-number"><span class="hljs-number">5</span></span>) }) )</code> </pre> <br><p>  рд╡рд┐рд╡рд░рдг E300 рд╕реЗ рдХреЙрдкреА рдХрд┐рдП рдЧрдП рдФрд░ рдХрд╛рдЯреЗ рдЧрдП рдЕрдзрд┐рдХрд╛рдВрд╢ рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рд╣реИ: рд╣рдо рдкреВрдЫрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдХреНрдпрд╛ рд╣реИ рдФрд░ рдпрд╣ рдкрддрд╛ рд╕реНрдерд╛рди рдореЗрдВ рдХрд╣рд╛рдВ рд╣реЛрдЧрд╛ред  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ RAM рдирд╣реАрдВ рд╣реИ (рдпрд╣ <code>TinyConfig</code> рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ <code>TinyConfig</code> рд╣реИ), рдПрдХ рдкрддрд╛ рд╕реНрдерд╛рди, рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, 32-рдмрд┐рдЯ рд╣реИ! </p><br><p>  рдПрдХ рдлрд╝рд╛рдЗрд▓ рднреА рд╣реИ рдЬреЛ рдмреЙрдпрд▓рд░рдкреНрд▓реЗрдЯ рдХреА рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдорд╛рддреНрд░рд╛ рдХреЛ рд╡рд╣рди рдХрд░рддреА рд╣реИред <br>  <strong>System.scala:</strong> </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">System</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RocketSubsystem</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryMaskROMSlave</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryDebug</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryGPIO</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> module = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SystemModule</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SystemModule</span></span></span><span class="hljs-class">[+</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class"> &lt;: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">System</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_outer: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">L</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RocketSubsystemModuleImp</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_outer</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryDebugModuleImp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryGPIOModuleImp</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Reset vector is set to the location of the mask rom val maskROMParams = p(PeripheryMaskROMKey) global_reset_vector := maskROMParams(0).address.U }</span></span></code> </pre> <br><p>  рджрд░рдЕрд╕рд▓, рд╣рдорд╛рд░реЗ "рдорджрд░рдмреЛрд░реНрдб" рдХрд╛ рд▓реЗрдЖрдЙрдЯ рддреАрди (рдЕрдм рддрдХ) рд╕рд░рд▓ рдлрд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╣реИ: <br>  <strong>Platform.scala:</strong> </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlatformIO</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit val p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jtag = <span class="hljs-type"><span class="hljs-type">Flipped</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">JTAGIO</span></span>(hasTRSTn = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jtag_reset = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> gpio = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">GPIOPins</span></span>(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">BasePin</span></span>(), p(<span class="hljs-type"><span class="hljs-type">PeripheryGPIOKey</span></span>)(<span class="hljs-number"><span class="hljs-number">0</span></span>)) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Platform</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sys = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-type"><span class="hljs-type">LazyModule</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">System</span></span>).module) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PlatformIO</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sjtag = sys.debug.systemjtag.get sjtag.reset := io.jtag_reset sjtag.mfr_id := p(<span class="hljs-type"><span class="hljs-type">JtagDTMKey</span></span>).idcodeManufId.<span class="hljs-type"><span class="hljs-type">U</span></span>(<span class="hljs-number"><span class="hljs-number">11.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>) sjtag.jtag &lt;&gt; io.jtag io.gpio &lt;&gt; sys.gpio.head }</code> </pre> <br><p>  <strong>FPGAChip.scala:</strong> </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FPGAChip</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">override implicit val p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeowaaShell</span></span></span><span class="hljs-class"> </span></span>{ withClockAndReset(cpu_clock, cpu_rst) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dut = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Platform</span></span>) dut.io.jtag.<span class="hljs-type"><span class="hljs-type">TCK</span></span> := jtag_tck dut.io.jtag.<span class="hljs-type"><span class="hljs-type">TDI</span></span> := jtag_tdi <span class="hljs-type"><span class="hljs-type">IOBUF</span></span>(jtag_tdo, dut.io.jtag.<span class="hljs-type"><span class="hljs-type">TDO</span></span>) dut.io.jtag.<span class="hljs-type"><span class="hljs-type">TMS</span></span> := jtag_tms dut.io.jtag_reset := jtag_rst <span class="hljs-type"><span class="hljs-type">Seq</span></span>(led_0, led_1, led_2, led_3) zip dut.io.gpio.pins foreach { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (led, pin) =&gt; led := <span class="hljs-type"><span class="hljs-type">Mux</span></span>(pin.o.oe, pin.o.oval, <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) } dut.io.gpio.pins.foreach(_.i.ival := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) dut.io.gpio.pins(<span class="hljs-number"><span class="hljs-number">4</span></span>).i.ival := key1 dut.io.gpio.pins(<span class="hljs-number"><span class="hljs-number">5</span></span>).i.ival := key2 } }</code> </pre> <br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк рдПрдХ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рд╢реИрд▓реА рдореЗрдВ рдЪрд┐рд╕реЗрд▓ рдореЗрдВ рдЬрдирд░реЗрдЯрд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ (рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ рдорд╛рдорд▓рд╛ рдпрд╣рд╛рдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ)ред  рд▓реЗрдХрд┐рди рдЖрдк рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╣рд░ рддрд╛рд░: </p><br><div class="spoiler">  <b class="spoiler_title">ZeowaaShell.scala</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeowaaShell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MemIf</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_addr = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">14.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_ba = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">3.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_cas_n = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_cke = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_clk = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_clk_n = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_cs_n = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_dm = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_dq = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">64.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_dqs = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_odt = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_ras_n = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_we_n = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeowaaShell</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit val p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RawModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clk25 = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clk27 = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clk48 = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key1 = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key2 = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key3 = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> led_0 = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> led_1 = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> led_2 = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> led_3 = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jtag_tdi = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jtag_tdo = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jtag_tck = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jtag_tms = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uart_rx = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>())) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uart_tx = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-comment"><span class="hljs-comment">// Internal wiring val cpu_clock = Wire(Clock()) val cpu_rst = Wire(Bool()) val jtag_rst = Wire(Bool()) withClockAndReset(cpu_clock, false.B) { val counter = Reg(UInt(64.W)) counter := counter + 1.U cpu_rst := (counter &gt; 1000.U) &amp;&amp; (counter &lt; 2000.U) jtag_rst := (counter &gt; 3000.U) &amp;&amp; (counter &lt; 4000.U) } cpu_clock &lt;&gt; clk25 }</span></span></code> </pre> </div></div><br><p>  рдЗрд╕реЗ рддреАрди рдлрд╛рдЗрд▓реЛрдВ рдореЗрдВ рдХреНрдпреЛрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ?  рдЦреИрд░, рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдореЗрдВ рдРрд╕рд╛ рдерд╛ :) <code>Shell</code> рдХреЛ <code>FPGAChip</code> рд╕реЗ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХрд╛ рддрд░реНрдХ, рдЬрд╛рд╣рд┐рд░рд╛ рддреМрд░ рдкрд░, рдпрд╣ рдерд╛ рдХрд┐ рд╢реЗрд▓ рдмрд╛рд╣рд░реА рджреБрдирд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рд╡рд┐рд╡рд░рдг рд╣реИ: рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдмреЛрд░реНрдб рдкрд░ рдХреНрдпрд╛ рдирд┐рд╖реНрдХрд░реНрд╖ рд╣реИрдВ (рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛) рдЪрд┐рдк рдирд┐рд╖реНрдХрд░реНрд╖!), рдФрд░ <code>FPGAChip</code> рдЗрд╕ рддрдереНрдп рд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реЛрддреА рд╣реИ рдХрд┐ рд╣рдо рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ SoC рдореЗрдВ рд░рдЯрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдареАрдХ рд╣реИ, рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЛ рдХрд╛рдлреА рддрд╛рд░реНрдХрд┐рдХ рд░реВрдк рд╕реЗ рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рдиреЛрдЯ: <code>ZeowaaShell</code> (рдФрд░, рдЗрд╕рд▓рд┐рдП, <code>Platform</code> ) рдПрдХ <code>RawModule</code> , рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдЙрдирдХреЗ рдкрд╛рд╕ рдПрдХ рдирд┐рд╣рд┐рдд <code>clock</code> рдФрд░ <code>reset</code> - рдпрд╣ "рд╡рд╛рдпрд░рд┐рдВрдЧ рдмреЛрд░реНрдб" рдХреЗ рд▓рд┐рдП рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд╣реИ, рд▓реЗрдХрд┐рди рдХрд╛рдо рдХреЗ рд▓рд┐рдП рдЕрд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ (рдФрд░, рд╢рд╛рдпрдж, рд╡рд┐рдкреБрд▓ рдЖрд╡реГрддреНрддрд┐ рдбреЛрдореЗрди рдХреЗ рд╕рд╛рде рдореБрд╢реНрдХрд┐рд▓ рддреНрд░реБрдЯрд┐рдпреЛрдВ рд╕реЗ рднрд░рд╛)ред  рдЦреИрд░, рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдЫреЗрдиреА рдореЙрдбреНрдпреВрд▓ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЖрдк рд░рдЬрд┐рд╕реНрдЯрд░ рдЖрджрд┐ рдХрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд╡рд░реНрдгрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><h1 id="jtag">  JTAG </h1><br><p>  JTAG рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдкрд░ рдХреБрдЫ рд╢рдмреНрджред  рдЪреВрдВрдХрд┐ рдореЗрд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд░рд╛рд╕реНрдкрдмреЗрд░реАрдкреА 3 рдореЙрдбрд▓ рдмреА + рдерд╛, рдЗрд╕рд▓рд┐рдП рд╕реНрдкрд╖реНрдЯ рд╕рдорд╛рдзрд╛рди рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдЕрдкрдиреЗ рдЬреАрдкреАрдЖрдИрдУ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдирд╛ рдерд╛ред  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, <em>рд╣рдорд╛рд░реЗ рд╕рд╛рдордиреЗ рд╕рдм рдХреБрдЫ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд▓рд╛рдЧреВ рд╣реЛ рдЧрдпрд╛ рд╣реИ</em> : рддрд╛рдЬрд╛ рдУрдкрдирдУрд╕реАрдбреА рдореЗрдВ <code>interface/sysfsgpio-raspberrypi.cfg</code> рдХрд╛ рд╡рд░реНрдгрди рд╣реИ, рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдЖрдк рдбрд┐рдмрдЧрд░ рдХреЛ рдмреНрд▓реЙрдХ (TCK = 11, TMS = 25, TDI = 10, TDO = 9, рдФрд░ 9) рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВред рдЬреАрдПрдирдбреА рд╡реНрдпрд╛рдпрд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рдЫреЛрдбрд╝ рджреЗрдВ) - <a href="">рдпрд╣рд╛рдВ</a> рдкрд┐рдирдЖрдЙрдЯ <a href="">рдХрд░реЗрдВ</a> ред </p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, <a href="">рдлреНрд░реАрдбрдо.рдХреЙрдл</a> рдХреЛ <code>riscv-tests</code> рднрдВрдбрд╛рд░ рд╕реЗ рдПрдХ рдЖрдзрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЗрддреЗ <a href="">рд╣реБрдП</a> , рдореБрдЭреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдорд┐рд▓рд╛: </p><br><pre> <code class="plaintext hljs">adapter_khz 10000 source [find interface/sysfsgpio-raspberrypi.cfg] set _CHIPNAME riscv jtag newtap $_CHIPNAME cpu -irlen 5 -expected-id 0x20e31913 set _TARGETNAME $_CHIPNAME.cpu target create $_TARGETNAME riscv -chain-position $_TARGETNAME -rtos riscv init halt echo "Ready for Remote Connections"</code> </pre> <br><p>  рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдЖрд░рдПрдо рдХреЗ рддрд╣рдд рдирд┐рд░реНрдорд┐рдд <a href="">riscv-openocd</a> рдкреЛрд░реНрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрд╕рд▓рд┐рдП <del>  рдлреНрд░реАрдмреА рдкрд╛рд╕ рдирд╣реАрдВ рд╣реБрдЖ </del>  SiFive рд╕реЗ рдкреВрд░реНрд╡-рдЗрдХрдЯреНрдареЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рдмрдЬрд╛рдп, рдЖрдкрдХреЛ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рдХреНрд▓реЛрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЗрдХрдЯреНрдард╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: </p><br><pre> <code class="plaintext hljs">./configure --enable-remote-bitbang --enable-sysfsgpio</code> </pre> <br><p>  рдЕрдЧрд░ рдХрд┐рд╕реА рдХреЛ рдкрддрд╛ рд╣реИ рдХрд┐ рд░рд┐рдореЛрдЯ рдмрд┐рдЯрдмреИрдВрдЧ рдХреЛ рдХреИрд╕реЗ рдЪрд▓рд╛рдирд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдПрдЖрд░рдПрдо рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╕реНрдЯрдо рдкреЛрд░реНрдЯ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИ ... </p><br><p>  рдирддреАрдЬрддрди, рд╣рдо рд░реВрдЯ рд╕реЗ рдорд╛рд▓рд┐рдВрдХрд╛ рдкрд░ рд▓реЙрдиреНрдЪ рдХрд░рддреЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">root@ubuntu:~/riscv-openocd# ./src/openocd -s tcl -f ../riscv.tcl Open On-Chip Debugger 0.10.0+dev-00614-g998fed1fe-dirty (2019-06-03-10:27) Licensed under GNU GPL v2 For bug reports, read http://openocd.org/doc/doxygen/bugs.html adapter speed: 10000 kHz SysfsGPIO nums: tck = 11, tms = 25, tdi = 10, tdo = 9 SysfsGPIO nums: swclk = 11, swdio = 25 Info : auto-selecting first available session transport "jtag". To override use 'transport select &lt;transport&gt;'. Info : SysfsGPIO JTAG/SWD bitbang driver Info : JTAG and SWD modes enabled Warn : gpio 11 is already exported Warn : gpio 25 is already exported Info : This adapter doesn't support configurable speed Info : JTAG tap: riscv.cpu tap/device found: 0x20e31913 (mfg: 0x489 (SiFive, Inc.), part: 0x0e31, ver: 0x2) Info : datacount=1 progbufsize=16 Info : Disabling abstract command reads from CSRs. Info : Examined RISC-V core; found 1 harts Info : hart 0: XLEN=32, misa=0x40001105 Info : Listening on port 3333 for gdb connections Ready for Remote Connections Info : Listening on port 6666 for tcl connections Info : Listening on port 4444 for telnet connections</code> </pre> <br><p>  3333 рдкреЛрд░реНрдЯ рдлреЙрд░рд╡рд░реНрдбрд┐рдВрдЧ рдХреЗ рд╕рд╛рде SSH рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╡рд╛рдВрдЫрд┐рдд рдЖрдИрдкреА рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛: </p><br><pre> <code class="plaintext hljs">ssh -L 3333:127.0.0.1:3333 ubuntu@192.168.1.104</code> </pre> <br><p>  рд╣реЛрд╕реНрдЯ рдкрд░ рдЕрдм рдЖрдк <strong>RDBv32 рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рддрд╣рдд</strong> GDB рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">$ ../../rocket-tools/bin/riscv32-unknown-elf-gdb -q (gdb) target remote :3333 Remote debugging using :3333 warning: No executable has been specified and target does not support determining executable automatically. Try using the "file" command. 0x00000000 in ?? ()</code> </pre> <br><p>  рд╣рдо рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдЧреИрд░-рдЪрд┐рдкрдХреЗ рд╣реБрдП рдЬреЗрдЯреАрдПрдЬреА рдХреЗ рдХреБрдЫ рдЕрдВрдзреЗ рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВрдЧреЗ рдХрд┐ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ <code>SYNTHESIS</code> рдореИрдХреНрд░реЛ рдХрд╛ рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рд╕реНрдерд┐рддрд┐ рдХреЛ рд░рд╛рдЬреНрдп рдореЗрдВ рдЙрд▓реНрдЯрд╛ рдХрд░ рджреЗрддрд╛ рд╣реИ "рдЬреЗрдЯреАрдПрдЬреА рд╣реБрдХ рд╣реИ, рд▓реЗрдХрд┐рди рд░реЛрд╢рдиреА рдЭрдкрдХреА рдирд╣реАрдВ рд╣реИред" </p><br><h1 id="pervyy-kod">  рдкрд╣рд▓рд╛ рдХреЛрдб </h1><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ <code>bootrom/xip/xip.S</code> рдореЗрдВ рджреЗрдЦрд╛ рдерд╛, <code>bootrom/xip/xip.S</code> рдХреЗ рд▓рд┐рдП рдХреЛрдб рдХреЛ <code>bootrom/xip/xip.S</code> рд╕реЗ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЕрдм рдпрд╣ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: </p><br><pre> <code class="plaintext hljs">// See LICENSE for license details. // Execute in place // Jump directly to XIP_TARGET_ADDR .section .text.init .option norvc .globl _start _start: csrr a0, mhartid la a1, dtb li t0, XIP_TARGET_ADDR jr t0 .section .rodata dtb: .incbin DEVICE_TREE</code> </pre> <br><p>  рдореИрдВ рд╕рдордЭрддрд╛ рд╣реВрдВ рдХрд┐ рдУрдПрд╕ рджреНрд╡рд╛рд░рд╛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдбрд┐рд╡рд╛рдЗрд╕ рдЯреНрд░реА (dtb рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА) рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рд░реИрдо рдХреЗ рдмрд┐рдирд╛ рдУрдПрд╕ рдХрд┐рд╕ рддрд░рд╣ рдХрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╕рд╛рд╣рд╕рдкреВрд░реНрд╡рдХ рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдЗрд╕реЗ рдЪрдордХрддреЗ рдкреНрд░рдХрд╛рд╢ рдмрд▓реНрдмреЛрдВ рд╕реЗ рдмрджрд▓ рджреЗрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">рдЫрд┐рдкрд╛ рд╣реБрдЖ рдкрд╛рда</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> .section .text.init .option norvc .globl _start _start: li a5, 0x64002000 li a1, 0x0F li a2, 0x01 li a3, 0x30 li a6, 0x10 li a7, 0x20 sw zero, 0x38(a5) // iof_en sw a1, 0x08(a5) // output_en sw a2, 0x00(a5) // value sw a1, 0x14(a5) // drive sw a3, 0x04(a5) // input_en // a0 &lt;- timer // a1 &lt;- 0x0F // a2 &lt;- [state] // a3 &lt;- 0x30 // a4 &lt;- [buttons] // a5 &lt;- [gpio addr] // a6 &lt;- 0x10 // a7 &lt;- 0x20 loop: li a4, 0x1000 add a0, a0, a4 bgtu a0, zero, loop lw a4, 0x00(a5) // value beq a4, a6, plus beq a4, a7, minus j store plus: srai a2, a2, 1 beq a2, zero, pzero j store pzero: li a2, 0x08 j store minus: slli a2, a2, 1 beq a2, a6, mzero j store mzero: li a2, 0x01 store: sw a2, 0x0c(a5) // value j loop</code> </pre> </div></div><br><p>  рдЗрд╕ рдХреЛрдб рдиреЗ рдкреБрдирд░рд╛рд╡реГрддреНрдд рд░реВрдк рд╕реЗ рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХреГрдкрдпрд╛ рдореБрдЭреЗ рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреА рдЕрдЬреАрдм рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП рдХреНрд╖рдорд╛ рдХрд░реЗрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдореИрдВрдиреЗ RISC-V рдЕрд╕реЗрдВрдмрд▓рд░ рдХрд╛ рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ рдЕрдзреНрдпрдпрди рдХрд┐рдпрд╛ "рд╡рд┐рдзрд┐ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдХреЛрдб рдХреЗ рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ, рдЕрд▓рдЧ рдХрд░реЗрдВ, рджреЗрдЦреЗрдВред"  рдЬрдм рдореИрдВрдиреЗ рдХреБрдЫ рд╕рд╛рд▓ рдкрд╣рд▓реЗ рдПрдХ рдЗрд▓реЗрдХреНрдЯреНрд░реЙрдирд┐рдХреНрд╕ рдкреБрд╕реНрддрдХ рдкрдврд╝реА рдереА, рддреЛ рдЙрд╕рдиреЗ рдЕрд╕реЗрдВрдмрд▓реА рднрд╛рд╖рд╛ рдореЗрдВ ATTiny рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХреА рдереАред  "рдпрд╣рд╛рдБ рдЙрдмрд╛рдК рдмрд╛рддреЗрдВ рдФрд░ рджрд┐рдирдЪрд░реНрдпрд╛ рд╣реИ, рд╢рд╛рдпрдж," рдореИрдВрдиреЗ рд╕реЛрдЪрд╛, рд▓реЗрдХрд┐рди рдЕрдм, рдЬрд╛рд╣рд┐рд░рд╛ рддреМрд░ рдкрд░, <em>рдПрдХ рд╕реНрд╡реАрдбрд┐рд╢ рд╕реНрдЯреЛрд░ рдХрд╛ рдкреНрд░рднрд╛рд╡ рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛ рд╣реИ</em> : <del>  рд▓реЙрдХрд░ </del>  рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕реНрдкреЗрдпрд░ рдкрд╛рд░реНрдЯреНрд╕ рд╕реЗ рдЗрдХрдЯреНрдард╛ рдХрд┐рдпрд╛, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдХреЛрдбрд╛рдВрддрд░рдХ рднреА рджреЗрд╢реА рдФрд░ рджрд┐рд▓рдЪрд╕реНрдк рд▓рдЧрддрд╛ рд╣реИред  рдЗрд╕ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдПрд▓рдИрдбреА рдХреЛ рдмрд╛рдПрдВ рдпрд╛ рджрд╛рдПрдВ "рд░рди" рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдмрдЯрди рджрдмрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рд╣рдо рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ ... рдФрд░ рдХреБрдЫ рднреА рдирд╣реАрдВ: рд╕рднреА рд░реЛрд╢рдиреА рдЪрд╛рд▓реВ рд╣реИрдВ, рд╡реЗ рдмрдЯрди рдХрд╛ рдЬрд╡рд╛рдм рдирд╣реАрдВ рджреЗрддреЗ рд╣реИрдВред  рдЪрд▓реЛ JTAG рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ: рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд╛рдЙрдВрдЯрд░ = 0x00000000 - рдХрд┐рд╕реА рддрд░рд╣ рд╕рдм рдХреБрдЫ рджреБрдЦреА рд╣реИред  рд▓реЗрдХрд┐рди <code>0x64002000</code> рд╣рдорд╛рд░реЗ рдкрд╛рд╕ GPIO рд░рдЬрд┐рд╕реНрдЯрд░ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">GPIOCtrlRegs.scala</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">// See LICENSE for license details. package sifive.blocks.devices.gpio object GPIOCtrlRegs { val value = 0x00 val input_en = 0x04 val output_en = 0x08 val port = 0x0c val pullup_en = 0x10 val drive = 0x14 val rise_ie = 0x18 val rise_ip = 0x1c val fall_ie = 0x20 val fall_ip = 0x24 val high_ie = 0x28 val high_ip = 0x2c val low_ie = 0x30 val low_ip = 0x34 val iof_en = 0x38 val iof_sel = 0x3c val out_xor = 0x40 }</span></span></code> </pre> </div></div><br><p>  рдЖрдЗрдП рдЙрдиреНрд╣реЗрдВ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ: </p><br><pre> <code class="plaintext hljs">(gdb) set variable *0x64002038=0 (gdb) set variable *0x64002008=0xF (gdb) set variable *0x64002000=0x1 (gdb) set variable *0x64002014=0xF (gdb) set variable *0x6400200c=0x1</code> </pre> <br><p>  рддреЛ ... рдПрдХ рдПрд▓ рдИ рдбреА рдмрд╛рд╣рд░ рдЪрд▓рд╛ рдЧрдпрд╛ ... рдФрд░ рдЕрдЧрд░ <code>0x1</code> рдирд╣реАрдВ, рд▓реЗрдХрд┐рди <code>0x5</code> ... рдпрд╣ рд╕рд╣реА рд╣реИ, рдЕрдм рдПрд▓ рдИ рдбреА рдПрдХ рдХреЗ рдмрд╛рдж рд╕реЗ рдЬрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рднреА рд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЧрдпрд╛ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдЙрд▓реНрдЯрд╛ рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ 0x00 рд░рдЬрд┐рд╕реНрдЯрд░ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ - рдЖрдкрдХреЛ рд╡рд╣рд╛рдВ рд╕реЗ рдкрдврд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs">(gdb) x/x 0x64002000 0x64002000: 0x00000030 //    (gdb) x/x 0x64002000 0x64002000: 0x00000020 //   (gdb) x/x 0x64002000 0x64002000: 0x00000010 //   (gdb) x/x 0x64002000 0x64002000: 0x00000000</code> </pre> <br><p>  рдЦреИрд░, рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЛ рд╢реБрд░реВ рдХрд┐рдП рдмрд┐рдирд╛ рдореЗрдореЛрд░реА-рдореИрдк рдХрд┐рдП рдЧрдП рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЖрдк рд╣рд░ рдмрд╛рд░ рдХреЙрдиреНрдЯ + Ctrl-C рджрдмрд╛ рдирд╣реАрдВ рд╕рдХрддреЗ - рдПрдХ рдЯреНрд░рд┐рдлрд╝рд▓, рд▓реЗрдХрд┐рди рдЕрдЪреНрдЫрд╛ред </p><br><p>  рд▓реЗрдХрд┐рди рд╣рдо рд▓реВрдк рдореЗрдВ рдХрддрд╛рдИ рдХреНрдпреЛрдВ рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди <code>$pc=0x0000000</code> ? </p><br><pre> <code class="plaintext hljs">(gdb) x/10i 0x10000 0x10000: addi s1,sp,12 0x10002: fsd ft0,-242(ra) 0x10006: srli a4,a4,0x21 0x10008: addi s0,sp,32 0x1000a: slli t1,t1,0x21 0x1000c: lb zero,-1744(a2) 0x10010: nop 0x10012: addi a0,sp,416 0x10014: c.slli zero,0x0 0x10016: 0x9308</code> </pre> <br><p>  рдХреНрдпрд╛ рд╣реИ рдкреЛрдХреЗрдореЙрди ???  рдореИрдВрдиреЗ рдРрд╕реЗ рдирд┐рд░реНрджреЗрд╢ рдирд╣реАрдВ рд▓рд┐рдЦреЗ, рдЙрдиреНрд╣реЛрдВрдиреЗ рдореБрдЭреЗ рдлреЗрдВрдХ рджрд┐рдпрд╛!  рдЖрдЗрдП рдХрд░реАрдм рд╕реЗ рджреЗрдЦреЗрдВ: </p><br><pre> <code class="plaintext hljs">(gdb) x/10x 0x10000 0x10000: 0xb7270064 0x9305f000 0x13061000 0x93060003 0x10010: 0x13080001 0x93080002 0x23ac0702 0x23a4b700 0x10020: 0x23a0c700 0x23aab700</code> </pre> <br><p>  рджреВрд╕рд░реА рдУрд░, рд╡рд╣рд╛рдБ рдХреНрдпрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП? </p><br><pre> <code class="plaintext hljs">$ ../../rocket-tools/bin/riscv32-unknown-elf-objdump -d builds/zeowaa-e115/xip.elf builds/zeowaa-e115/xip.elf:   elf32-littleriscv   .text: 00010054 &lt;_start&gt;: 10054: 640027b7 lui a5,0x64002 10058: 00f00593 li a1,15 1005c: 00100613 li a2,1 10060: 03000693 li a3,48 10064: 01000813 li a6,16 10068: 02000893 li a7,32 1006c: 0207ac23 sw zero,56(a5) # 64002038 &lt;__global_pointer$+0x63ff0770&gt; 10070: 00b7a423 sw a1,8(a5) 10074: 00c7a023 sw a2,0(a5) 10078: 00b7aa23 sw a1,20(a5) 1007c: 00d7a223 sw a3,4(a5) ...</code> </pre> <br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрд╡рд╛рд░реНрдЯрд╕ рдиреЗ рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ рдЙрдиреНрд╣реАрдВ рд╢рдмреНрджреЛрдВ рдХреЛ рд░рдЦрд╛ рд╣реИ рдЬреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдереЗ, рд▓реЗрдХрд┐рди рдЙрдирдХреА рдПрдВрдбрд┐рдпрдирдиреЗрд╕ рдмрджрд▓ рдЧрдИред  рдЖрдк рдЗрд╕реЗ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдВрдмреЗ рд╕рдордп рддрдХ Google рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди <em>рдореИрдВ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рд╣реВрдВ</em> , рдмреИрд╕рд╛рдЦреА рд╣рдорд╛рд░реА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореИрдВ рдмрд╕ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦреВрдВрдЧрд╛ </p><br><div class="spoiler">  <b class="spoiler_title">BootROM.v</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">module BootROM( input wire [10:0] address, input wire clock, input wire me, input wire oe, output wire [31:0] q ); wire [31:0] q_r; rom r( .address(address), .clock(clock), .rden(me), .q(q_r) ); assign q[31:24] = q_r[7:0]; assign q[23:16] = q_r[15:8]; assign q[15:8] = q_r[23:16]; assign q[7:0] = q_r[31:24]; endmodule</code> </pre> </div></div><br><p>  рддреЛ, рд╣рдо рдЗрдХрдЯреНрдард╛ рдХрд░рддреЗ рд╣реИрдВ, рд╣рдо рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рдпрд╣ рдЪрдордХ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред   JTAG: <code>$pc</code>   -  ,    = 4,  ,   <code>output_en</code> : <code>set variable *0x64002008=0xF</code> ,  <code>c</code> (continue) тАФ  ! ,      . -,        ,  тАж        ,   <code>output_en</code>    . </p><br><p>      : </p><br><pre> <code class="plaintext hljs">Total logic elements 17,370 / 114,480 ( 15 % ) Total registers 8357 Total pins 16 / 281 ( 6 % ) Total virtual pins 0 Total memory bits 264,000 / 3,981,312 ( 7 % ) Embedded Multiplier 9-bit elements 4 / 532 ( &lt; 1 % )</code> </pre> <br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  Chisel</a> </p><br><p> <em> ...</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi455391/">https://habr.com/ru/post/hi455391/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi455377/index.html">IoT рд╡рд╛рд╕реНрддреБрдХрд▓рд╛</a></li>
<li><a href="../hi455379/index.html">(рд╕реНрдереИрддрд┐рдХ) C ++ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдореЗрдВ рдЗрд╖реНрдЯрддрдо рдХрдВрдЯреЗрдирд░реЛрдВ рдХрд╛ рдЪрдпрди</a></li>
<li><a href="../hi455381/index.html">3CX рддрдХрдиреАрдХреА рд╕рдорд░реНрдерди рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИ: PBX рд╕рд░реНрд╡рд░ рдкрд░ SIP рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ</a></li>
<li><a href="../hi455387/index.html">рдЗрд▓рд╛рд╕реНрдЯрд┐рдХ рд╕реНрдЯреИрдХ рдореЗрдВ рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ (рдЙрд░реНрдл рдПрд▓рд┐рдЯрд┐рдХреНрд╕ рдЦреЛрдЬ, рдЙрд░реНрдл тАЛтАЛрдПрд▓реНрдХ)</a></li>
<li><a href="../hi455389/index.html">рд╣реИрдХреНрд╕ 4: рдирдпрд╛ рдХреНрдпрд╛ рд╣реИ?</a></li>
<li><a href="../hi455393/index.html">рд░рдбрд╛рд░ рдореЗрдВ рд╡рд░реНрдгрдХреНрд░рдореАрдп рдЖрдХрд▓рди рдХреЗ рдкреИрд░рд╛рдореАрдЯреНрд░рд┐рдХ рддрд░реАрдХреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ - рд╕рдВрдЧреАрдд рд╡рд┐рдзрд┐ред рд▓реЗрдЦ рдХреЗ рдЕрд▓рд╛рд╡рд╛</a></li>
<li><a href="../hi455397/index.html">рд╣рдордиреЗ рдореЙрд╕реНрдХреЛ рдХрд╛рд░реНрдпрд╛рд▓рдп, 1 рднрд╛рдЧ рдореЗрдВ рд╣реБрдЖрд╡реЗрдИ рдкрд░ рдирдП рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рдХреИрд╕реЗ рдбрд┐рдЬрд╛рдЗрди рдФрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛</a></li>
<li><a href="../hi455401/index.html">рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рд╕рд┐рд╕реНрдХреЛ IOS рдХреЗ рд▓рд┐рдП Tcl</a></li>
<li><a href="../hi455403/index.html">рдкрд╛рдВрдЪ рд╕реЗрдВрдЯ рд╕реЗ рд▓реЗрдХрд░ рджреЗрд╡рддрд╛рдУрдВ рдХреЗ рдЦреЗрд▓ рддрдХ</a></li>
<li><a href="../hi455405/index.html">рдХреИрд╕реЗ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдХрд╛рд░реНрдпрдХреНрд░рдо рдиреЗ 100+ рдорд┐рд▓рд┐рдпрди рд░реВрдмрд▓ / рдорд╣реАрдиреЗ рдХреЗ рд▓рд╛рдн рдХреЗ рд╕рд╛рде рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдХрд╛рд░реНрдпрд╛рд▓рдп рдХреЛ рдПрдХ рд╕рдВрдШреАрдп рдХрдВрдкрдиреА рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>