<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛕 ⚱️ 🛌 AERODISCO Motor: catastrófico. Parte 2. Metrocluster 🥙 📷 🍭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola lectores de Habr! En un artículo anterior, hablamos sobre una herramienta simple de tolerancia a desastres en los sistemas de almacenamiento AERO...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>AERODISCO Motor: catastrófico. Parte 2. Metrocluster</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/aerodisk/blog/460305/"><p><img src="https://habrastorage.org/webt/ft/el/xz/ftelxzp4fmlci1fn9endwmjffew.jpeg"></p><br><p>  Hola lectores de Habr!  En un artículo anterior, hablamos sobre una herramienta simple de tolerancia a desastres en los sistemas de almacenamiento AERODISK ENGINE, sobre la replicación.  En este artículo, profundizaremos en un tema más complejo e interesante: el clúster metropolitano, es decir, un medio de protección automatizada ante desastres para dos centros de datos, que permite a los centros de datos trabajar en modo activo-activo.  Lo diremos, mostraremos, romperemos y arreglaremos. </p><a name="habracut"></a><br><h2 id="kak-obychno-v-nachale-teoriya">  Como siempre, al principio de la teoría. </h2><br><p>  Un grupo de metro es un grupo dividido en varios sitios dentro de una ciudad o distrito.  La palabra "clúster" nos sugiere claramente que el complejo está automatizado, es decir, el cambio de nodos del clúster en caso de fallas se produce automáticamente. </p><br><p>  Aquí es donde radica la principal diferencia entre el clúster metropolitano y la replicación ordinaria.  Automatización de operaciones.  Es decir, en el caso de ciertos incidentes (falla del centro de datos, canales rotos, etc.), el sistema de almacenamiento realizará independientemente las acciones necesarias para mantener la disponibilidad de datos.  Cuando se utilizan réplicas regulares, el administrador realiza estas acciones completa o parcialmente de forma manual. </p><br><h3 id="dlya-chego-eto-nuzhno">  ¿Para qué es esto? </h3><br><p> El objetivo principal que los clientes persiguen utilizando una u otra implementación del clúster de metro es minimizar el RTO (Objetivo del tiempo de recuperación).  Es decir, minimice el tiempo de recuperación de los servicios de TI después de una falla.  Si usa la replicación normal, el tiempo de recuperación siempre será más largo que el tiempo de recuperación con el clúster metro.  Por qué  Muy simple  El administrador debe estar en el lugar de trabajo y cambiar la replicación a mano, y el clúster de metro lo hace automáticamente. </p><br><p>  Si no tiene un administrador dedicado de guardia que no duerma, coma, fume o se enferme y observe el estado de almacenamiento las 24 horas del día, no hay forma de garantizar que el administrador estará disponible para el cambio manual durante una falla. </p><br><p>  En consecuencia, RTO en ausencia de un grupo de metro o <del>  administrador inmortal nivel 99 </del>  El servicio en servicio del administrador será igual a la suma del tiempo de conmutación de todos los sistemas y el período máximo de tiempo después del cual se garantiza que el administrador comenzará a trabajar con los sistemas de almacenamiento y sistemas relacionados. </p><br><p>  Por lo tanto, llegamos a la conclusión obvia de que el clúster metropolitano debe usarse si el requerimiento de RTO es minutos, no horas o días, es decir, cuando el departamento de TI debe proporcionar a las empresas tiempo para restablecer el acceso a TI en el caso de la peor caída del centro de datos -servicios en minutos, o incluso segundos. </p><br><h3 id="kak-eto-rabotaet">  Como funciona </h3><br><p>  En el nivel inferior, el clúster metropolitano utiliza el mecanismo de replicación de datos síncronos, que describimos en un artículo anterior (ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace</a> ).  Como la replicación es sincrónica, los requisitos para ella son apropiados, o más bien: </p><br><ul><li>  fibra como física, 10 gigabit Ethernet (o superior); </li><li>  la distancia entre los centros de datos no es más de 40 kilómetros; </li><li>  Retardo de canal óptico entre centros de datos (entre sistemas de almacenamiento) hasta 5 milisegundos (óptimamente 2). </li></ul><br><p>  Todos estos requisitos son de naturaleza consultiva, es decir, el clúster de metro funcionará incluso si no se cumplen estos requisitos, pero debe entenderse que las consecuencias del incumplimiento de estos requisitos son iguales a la desaceleración de ambos sistemas de almacenamiento en el clúster de metro. </p><br><p>  Entonces, una réplica sincrónica se usa para transferir datos entre sistemas de almacenamiento, y cómo las réplicas se cambian automáticamente, y lo más importante, ¿cómo evitar el cerebro dividido?  Para esto, en el nivel anterior, se utiliza una entidad adicional: el árbitro. </p><br><h3 id="kak-rabotaet-arbitr-i-v-chem-ego-zadacha">  ¿Cómo funciona el árbitro y cuál es su tarea? </h3><br><p>  El árbitro es una pequeña máquina virtual, o un clúster de hardware, que debe ejecutarse en la tercera plataforma (por ejemplo, en la oficina) y proporcionar acceso al almacenamiento a través de ICMP y SSH.  Después del lanzamiento, el árbitro debe establecer la IP y luego, desde el lado del almacenamiento, indicar su dirección, más las direcciones de los controladores remotos que participan en el clúster metropolitano.  Después de eso, el árbitro está listo para trabajar. </p><br><p>  El árbitro supervisa constantemente todos los sistemas de almacenamiento en el clúster metropolitano y, si un sistema de almacenamiento no está disponible, después de confirmar que no está disponible desde otro miembro del clúster (uno de los sistemas de almacenamiento "en vivo"), toma la decisión de iniciar el procedimiento para cambiar las reglas de replicación y el mapeo. </p><br><p>  Un punto muy importante.  El árbitro siempre debe estar en un sitio diferente de aquellos en los que se encuentra el almacenamiento, es decir, ni en el centro de datos-1, donde se encuentra el almacenamiento 1, ni en el centro de datos-2, donde está instalado el almacenamiento 2. </p><br><p>  Por qué  Porque la única forma en que un árbitro con la ayuda de uno de los sistemas de almacenamiento sobrevivientes puede determinar de manera inequívoca y precisa la caída de cualquiera de los dos sitios donde están instalados los sistemas de almacenamiento.  Cualquier otra forma de colocar un árbitro puede resultar en un cerebro dividido. </p><br><h3 id="teper-pogruzimsya-v-detali-raboty-arbitra">  Ahora sumérgete en los detalles del árbitro </h3><br><p>  El árbitro ejecuta varios servicios que son interrogados constantemente por todos los controladores de almacenamiento.  Si el resultado de la encuesta difiere del anterior (disponible / inaccesible), se registra en una pequeña base de datos, que también funciona como árbitro. </p><br><p>  <strong>Considere la lógica del árbitro con más detalle.</strong> </p><br><p>  <u>Paso 1. Determinación de la inaccesibilidad.</u>  Una señal de evento sobre la falla del sistema de almacenamiento es la ausencia de ping de ambos controladores del mismo sistema de almacenamiento durante 5 segundos. </p><br><p>  <u>Paso 2. Inicie el procedimiento de cambio.</u>  Después de que el árbitro comprende que uno de los sistemas de almacenamiento no está disponible, envía una solicitud al sistema de almacenamiento "en vivo" para asegurarse de que el sistema de almacenamiento "muerto" realmente haya muerto. </p><br><p>  Después de recibir dicha orden del árbitro, el segundo sistema de almacenamiento (en vivo) verifica adicionalmente la disponibilidad del primer sistema de almacenamiento caído y, si no es así, envía al árbitro la confirmación de sus conjeturas.  El almacenamiento realmente no está disponible. </p><br><p>  Después de recibir dicha confirmación, el árbitro inicia el procedimiento remoto para cambiar la replicación y elevar la asignación en aquellas réplicas que estaban activas (primarias) en el sistema de almacenamiento descartado, y envía un comando al segundo sistema de almacenamiento para que estas réplicas pasen de secundaria a primaria y aumenten la asignación.  Bueno, el segundo sistema de almacenamiento, respectivamente, realiza estos procedimientos, después de lo cual proporciona acceso a los LUN perdidos de sí mismo. </p><br><p>  ¿Por qué necesito verificación adicional?  Para quórum.  Es decir, la mayoría del número impar total (3) de miembros del clúster debería confirmar la caída de uno de los nodos del clúster.  Solo entonces esta decisión será correcta.  Esto es necesario para evitar cambios erróneos y, en consecuencia, cerebro dividido. </p><br><p>  El paso 2 en el tiempo toma aproximadamente 5 a 10 segundos, por lo tanto, teniendo en cuenta el tiempo requerido para determinar la inaccesibilidad (5 segundos), dentro de los 10 a 15 segundos después del accidente, los LUN con almacenamiento caído estarán disponibles automáticamente para trabajar con almacenamiento en vivo. </p><br><p>  Está claro que para evitar desconectar los hosts, también debe cuidar la configuración correcta de los tiempos de espera en los hosts.  El tiempo de espera recomendado es de al menos 30 segundos.  Esto no permitirá que el host se desconecte del sistema de almacenamiento durante la transferencia de carga durante un accidente y podrá garantizar que no haya interrupción de la entrada-salida. </p><br><blockquote>  Resulta que solo un segundo, si todo está bien con el clúster de metro, ¿por qué necesita una replicación regular? </blockquote><p>  De hecho, no todo es tan simple. </p><br><h3 id="rassmotrim-plyusy-i-minusy-metroklastera">  Considere los pros y los contras del clúster de metro </h3><br><p>  Entonces, nos dimos cuenta de que las ventajas obvias del clúster metro en comparación con la replicación convencional son: </p><br><ul><li>  Automatización completa que proporciona un tiempo de recuperación mínimo en caso de desastre; </li><li>  Y eso es todo :-). </li></ul><br><p>  Y ahora, atención, contras: </p><br><ul><li>  El costo de la decisión.  Aunque el clúster metropolitano en los sistemas Aerodisk no requiere licencias adicionales (se usa la misma licencia que para la réplica), el costo de la solución seguirá siendo mayor que el uso de la replicación sincrónica.  Será necesario implementar todos los requisitos para la réplica síncrona, más los requisitos para el clúster metropolitano relacionados con la conmutación adicional y el sitio adicional (consulte la planificación del clúster metropolitano); </li><li>  La complejidad de la decisión.  El clúster metropolitano es mucho más complejo que una réplica normal y requiere mucha más atención y trabajo para la planificación, configuración y documentación. </li></ul><br><p>  Al final  <strong>Metro cluster es, por supuesto, una solución muy tecnológica y buena cuando realmente necesita proporcionar RTO en segundos o minutos.</strong>  Pero si no existe tal tarea, y RTO en horas está bien para el negocio, entonces no tiene sentido disparar gorriones desde el cañón.  La replicación habitual de los trabajadores y campesinos es suficiente, porque el clúster de metro incurrirá en costos adicionales y complicará la infraestructura de TI. </p><br><h2 id="planirovanie-metroklastera">  Planificación de clúster de metro </h2><br><p>  Esta sección no pretende ser una guía completa para el diseño del clúster metropolitano, sino que solo muestra las instrucciones principales que deben elaborarse si decide construir dicho sistema.  Por lo tanto, con la implementación real del clúster metro, asegúrese de involucrar al fabricante de los sistemas de almacenamiento (es decir, nosotros) y otros sistemas relacionados para consultas. </p><br><h3 id="ploschadki">  Plataformas </h3><br><p>  Como se indicó anteriormente, se requieren un mínimo de tres sitios para un clúster de metro.  Dos centros de datos, donde funcionarán los sistemas de almacenamiento y sistemas relacionados, así como una tercera plataforma donde trabajará el árbitro. </p><br><p>  La distancia recomendada entre los centros de datos no es más de 40 kilómetros.  Es muy probable que distancias más grandes causen demoras adicionales, que en el caso de un grupo de metro son altamente indeseables.  Recuerde, los retrasos deben ser de hasta 5 milisegundos, aunque es deseable cumplir con 2. </p><br><p>  También se recomienda verificar las demoras durante el proceso de planificación.  Cualquier proveedor más o menos adulto que proporciona fibra entre los centros de datos, un control de calidad puede organizarse con bastante rapidez. </p><br><p>  En cuanto a las demoras ante el árbitro (es decir, entre la tercera plataforma y las dos primeras), el umbral de demora recomendado es de hasta 200 milisegundos, es decir, es adecuada una conexión VPN corporativa regular a través de Internet. </p><br><h3 id="kommutaciya-i-set">  Conmutación y redes </h3><br><p>  A diferencia de un esquema de replicación, donde es suficiente para interconectar sistemas de almacenamiento de diferentes sitios, un esquema con un clúster metropolitano requiere conectar hosts con ambos sistemas de almacenamiento en diferentes sitios.  Para aclarar cuál es la diferencia, ambos esquemas se enumeran a continuación. </p><br><p><img src="https://habrastorage.org/webt/qq/tg/x-/qqtgx-ze1zjj9fhbb7drzz6zabw.png"></p><br><p><img src="https://habrastorage.org/webt/l3/vs/es/l3vsesenlgm7lalbws0gdqhysuy.png"></p><br><p>  Como puede ver en el diagrama, los hosts en el sitio 1 están mirando tanto SHD1 como SHD 2. Además, por el contrario, los hosts de la plataforma 2 están mirando SHD 2 y SHD1.  Es decir, cada host ve ambos sistemas de almacenamiento.  Este es un requisito previo para el funcionamiento del clúster de metro. </p><br><p>  Por supuesto, no es necesario tirar de cada host con un cable óptico a un centro de datos diferente, no habrá suficientes puertos y cordones.  Todas estas conexiones deben realizarse a través de conmutadores Ethernet 10G + o FibreChannel 8G + (FC solo para conectar hosts y almacenamiento para IO, el canal de replicación actualmente solo está disponible a través de IP (Ethernet 10G +). </p><br><p>  Ahora algunas palabras sobre la topología de la red.  Un punto importante es la configuración correcta de las subredes.  Debe identificar inmediatamente varias subredes para los siguientes tipos de tráfico: </p><br><ul><li>  La subred para la replicación sobre la cual se sincronizarán los datos entre los sistemas de almacenamiento.  Puede haber varios, en este caso no importa, todo depende de la topología de red actual (ya implementada).  Si hay dos de ellos, entonces obviamente el enrutamiento entre ellos debe configurarse; </li><li>  Subredes de almacenamiento a través de las cuales los hosts accederán a los recursos de almacenamiento (si es iSCSI).  Debe haber una de esas subredes en cada centro de datos; </li><li>  Controle las subredes, es decir, tres subredes enrutables en tres sitios desde los que se realiza la gestión de almacenamiento, y también hay un árbitro. </li></ul><br><p>  No consideramos subredes para acceder a los recursos del host aquí, ya que dependen mucho de las tareas. </p><br><p>  La separación de tráfico diferente en subredes diferentes es extremadamente importante (es especialmente importante separar la réplica de E / S), porque si mezcla todo el tráfico en una subred "gruesa", este tráfico será imposible de administrar, y en las condiciones de dos centros de datos aún puede causar diferentes opciones de colisión de red.  No profundizaremos mucho en este tema en el marco de este artículo, ya que puede leer sobre la planificación de una red extendida entre centros de datos sobre los recursos de los fabricantes de equipos de red, donde se describe con gran detalle. </p><br><h3 id="konfiguraciya-arbitra">  Configuración de árbitro </h3><br><p>  El árbitro debe proporcionar acceso a todas las interfaces de administración de almacenamiento a través de los protocolos ICMP y SSH.  También debe considerar la tolerancia a fallas del árbitro.  Hay un matiz. </p><br><p>  La tolerancia a fallos del árbitro es muy deseable, pero opcional.  ¿Y qué pasa si el árbitro se estrella en el momento equivocado? </p><br><ul><li>  El funcionamiento del clúster metro en modo normal no cambiará porque  arbtir no afecta el funcionamiento del clúster metropolitano en modo normal de ninguna manera (su tarea es cambiar oportunamente la carga entre los centros de datos) </li><li>  Además, si el árbitro por una razón u otra cae y "despierta" el accidente en el centro de datos, entonces no ocurrirá ningún cambio, porque no habrá nadie para dar los comandos necesarios para cambiar y organizar un quórum.  En este caso, el clúster metropolitano se convertirá en un esquema de replicación regular, que deberá cambiarse manualmente durante un desastre, que afectará a RTO. </li></ul><br><p>  ¿Qué se sigue de esto?  Si realmente necesita garantizar un RTO mínimo, debe garantizar la tolerancia a fallos del árbitro.  Hay dos opciones para esto: </p><br><ul><li>  Ejecute una máquina virtual con un árbitro en un hipervisor de conmutación por error, ya que todos los hipervisores adultos admiten la conmutación por error; </li><li>  Si está en el tercer sitio (en una oficina condicional) <del>  pereza para poner un clúster normal </del>  Dado que no existe un clúster de hipervizor existente, hemos proporcionado una versión de hardware del árbitro, que se realiza en una caja de 2U, en la que funcionan dos servidores x-86 ordinarios y que pueden sobrevivir a una falla local. </li></ul><br><p>  Recomendamos encarecidamente que el árbitro sea tolerante a fallas a pesar de que el clúster metropolitano no lo necesita en modo normal.  Pero tanto la teoría como la práctica muestran que si construyes una infraestructura verdaderamente confiable a prueba de desastres, entonces es mejor ir a lo seguro.  Es mejor protegerse y proteger a su empresa de la "ley de la mezquindad", es decir, de la falla tanto del árbitro como de uno de los sitios donde se encuentra el sistema de almacenamiento. </p><br><h3 id="arhitektura-resheniya">  Arquitectura de soluciones </h3><br><p>  Teniendo en cuenta los requisitos anteriores, obtenemos la siguiente arquitectura de solución general. </p><br><p><img src="https://habrastorage.org/webt/di/wt/oq/diwtoqu2jdf7ik-nsigr4ypx37s.png"></p><br><p>  Los LUN deben distribuirse uniformemente en dos sitios para evitar una congestión intensa.  Al mismo tiempo, al dimensionar en ambos centros de datos, es necesario colocar no solo un doble volumen (que es necesario para almacenar datos simultáneamente en dos sistemas de almacenamiento), sino también un doble rendimiento en IOPS y MB / s, para evitar la degradación de las aplicaciones en caso de falla de uno de los centros de datos: ov. </p><br><p>  Por separado, observamos que con un enfoque adecuado para el dimensionamiento (es decir, siempre que hayamos proporcionado los límites superiores adecuados para IOPS y MB / s, así como los recursos necesarios de CPU y RAM), si uno de los sistemas de almacenamiento falla en el clúster metropolitano, no habrá una reducción seria en el rendimiento bajo trabajo temporal en un sistema de almacenamiento. </p><br><p>  Esto se debe al hecho de que, en las condiciones de dos sitios simultáneamente, el trabajo de replicación sincrónica "consume" la mitad del rendimiento de escritura, ya que cada transacción debe escribirse en dos sistemas de almacenamiento (similar a RAID-1/10).  Entonces, si uno de los sistemas de almacenamiento falla, el efecto de la replicación temporalmente (hasta que el sistema de almacenamiento con fallas aumente) desaparece, y obtenemos un aumento doble en el rendimiento de escritura.  Después de que los LUN del sistema de almacenamiento fallido se reiniciaron en un sistema de almacenamiento en funcionamiento, este aumento doble desaparece debido a la carga de los LUN de otro sistema de almacenamiento, y volvemos al mismo nivel de rendimiento que teníamos antes de la "caída", pero solo dentro del marco de una plataforma. </p><br><p>  Con la ayuda de un tamaño competente, es posible proporcionar condiciones bajo las cuales los usuarios no sentirán la falla de un sistema de almacenamiento completo.  Pero, de nuevo, esto requiere un tamaño muy cuidadoso, por lo que, por cierto, puede contactarnos gratis :-). </p><br><h2 id="nastroyka-metroklastera">  Configuración de Metro Cluster </h2><br><p>  Configurar un clúster de metro es muy similar a configurar una replicación regular, que describimos en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">artículo anterior</a> .  Por lo tanto, nos enfocamos solo en las diferencias.  Configuramos un soporte basado en la arquitectura anterior en el laboratorio solo en la versión mínima: dos sistemas de almacenamiento conectados por Ethernet 10G entre sí, dos conmutadores 10G y un host que observa los 10 puertos de almacenamiento a través de los conmutadores en ambos sistemas de almacenamiento.  El árbitro se ejecuta en una máquina virtual. </p><br><p><img src="https://habrastorage.org/webt/gy/-v/ci/gy-vci08eyyimjl6lwa2mciot8k.png"></p><br><p>  Al configurar IP virtuales (VIP) para una réplica, seleccione el tipo de VIP para el cluster de metro. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ym/aw/89/ymaw89gofhplngagm5nvveg4oe0.png"></a> </p><br><p>  Creamos dos enlaces de replicación para dos LUN y los distribuimos en dos sistemas de almacenamiento: LUN TEST Primary para SHD1 (enlace METRO), LUN TEST2 Primary para SHD2 (enlace METRO2). </p><br><p><img src="https://habrastorage.org/webt/rz/7w/6e/rz7w6esdq4bued37xobjg1obcha.jpeg"></p><br><p>  Para ellos, configuramos dos objetivos idénticos (en nuestro caso iSCSI, pero FC también es compatible, la lógica de configuración es la misma). </p><br><p>  SHD1: </p><br><p><img src="https://habrastorage.org/webt/d8/r-/dw/d8r-dw3gglptcowecdjabpewdve.jpeg"></p><br><p>  SHD2: </p><br><p><img src="https://habrastorage.org/webt/lf/ys/_6/lfys_6aohva42tp89ddqcjhakes.jpeg"></p><br><p>  Para las conexiones de replicación, hicieron asignaciones en cada sistema de almacenamiento. </p><br><p>  SHD1: </p><br><p><img src="https://habrastorage.org/webt/fw/qe/5q/fwqe5qqhcir_4rlbj3usmea1hgg.jpeg"></p><br><p>  SHD2: </p><br><p><img src="https://habrastorage.org/webt/rn/68/ap/rn68apxwkixmyh3dpv70vo-9pk8.jpeg"></p><br><p>  Multipath configurado y presentado al host. </p><br><p><img src="https://habrastorage.org/webt/gx/ii/wj/gxiiwjndb_fzeywc5hrxdfbqnrk.jpeg"></p><br><p><img src="https://habrastorage.org/webt/c6/df/5j/c6df5jjxnggdqk8wnjfbebb1rty.jpeg"></p><br><h3 id="nastraivaem-arbitra">  Configurar el árbitro </h3><br><p>  No necesita hacer nada especial con el árbitro, solo debe habilitarlo en la tercera plataforma, configurar una IP y configurar el acceso a ella a través de ICMP y SSH.  La configuración en sí se realiza desde los propios sistemas de almacenamiento.  En este caso, es suficiente configurar el árbitro una vez en cualquiera de los controladores de almacenamiento en el clúster metro, esta configuración se distribuirá a todos los controladores automáticamente. </p><br><p>  En la sección Replicación remota &gt;&gt; Metrocluster (en cualquier controlador) &gt;&gt; botón Configurar. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/sy/h0/x-/syh0x-gywrz2yu8w9mk0us5mwcg.jpeg"></a> </p><br><p>  Introducimos la IP del árbitro, así como las interfaces de control de los dos controladores del sistema de almacenamiento remoto. </p><br><p><img src="https://habrastorage.org/webt/rs/u2/dt/rsu2dt3tt18k1it_qvmdsdnxldy.jpeg"></p><br><p>  Después de eso, debe habilitar todos los servicios (el botón "Reiniciar todo").  En el caso de una reconfiguración en el futuro, los servicios deben reiniciarse para que la configuración surta efecto. </p><br><p><img src="https://habrastorage.org/webt/kj/sb/7u/kjsb7u9rrzlk6cttl7amr_ebxma.jpeg"></p><br><p>  Verifique que todos los servicios se estén ejecutando. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/oh/mw/xl/ohmwxl5jry0dufgfamey0ddxris.jpeg"></a> </p><br><p>  <strong>Esto completa la configuración del clúster de metro.</strong> </p><br><h2 id="krash-test">  Prueba de choque </h2><br><p>  La prueba de choque en nuestro caso será bastante simple y rápida, ya que la funcionalidad de replicación (cambio, consistencia, etc.) se consideró en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">artículo anterior</a> .  Por lo tanto, para probar la confiabilidad de un clúster de metro, es suficiente para nosotros verificar la automatización de la detección de accidentes, la conmutación y la ausencia de pérdidas de registro (paradas de E / S). </p><br><p>  Para hacer esto, emulamos la falla completa de uno de los sistemas de almacenamiento apagando físicamente sus dos controladores, comenzando una copia preliminar de un archivo grande en el LUN, que debe activarse en el otro sistema de almacenamiento. </p><br><p><img src="https://habrastorage.org/webt/f-/lb/fo/f-lbfonzy8n4iawaihumetqtkmo.png"></p><br><p>  Deshabilitar un almacenamiento.  En el segundo sistema de almacenamiento, vemos alertas y mensajes en los registros de que la conexión con el sistema vecino ha desaparecido.  Si ha configurado alertas para la supervisión SMTP o SNMP, el administrador recibirá las alertas correspondientes. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ae/jo/xv/aejoxv6piwk4fvl-nc1leklbxce.jpeg"></a> </p><br><p>  Exactamente 10 segundos después (visto en ambas capturas de pantalla), el enlace de replicación METRO (el que era Primario en el sistema de almacenamiento bloqueado) se convirtió automáticamente en Primario en el sistema de almacenamiento en ejecución.  Usando el mapeo existente, LUN TEST permaneció disponible para el host, la grabación se hundió un poco (dentro del 10 por ciento prometido), pero no se interrumpió. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/v_/gj/d9/v_gjd9sgoi5hwrgjdkwxwtdomeu.jpeg"></a> </p><br><p><img src="https://habrastorage.org/webt/ih/lq/rg/ihlqrgv7dq-4fv6dlnhair6nib4.jpeg"></p><br><p>  <strong>Prueba completada con éxito.</strong> </p><br><h2 id="podvodim-itog">  Para resumir </h2><br><p>  La implementación actual del metrocluster en los sistemas de almacenamiento de la serie N del motor AERODISK permite resolver por completo los problemas en los que es necesario eliminar o minimizar el tiempo de inactividad de los servicios de TI y garantizar su funcionamiento 24/7/365 con una mano de obra mínima. </p><br><p>  , ,    ,      …       ,      ,    .      ,         ,        ,         . </p><br><p> ,   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460305/">https://habr.com/ru/post/460305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460287/index.html">Visualización de noticias runet</a></li>
<li><a href="../460291/index.html">Problemas de procesamiento por lotes de solicitudes y sus soluciones (parte 1)</a></li>
<li><a href="../460295/index.html">¿Qué significa inseguro en Rust?</a></li>
<li><a href="../460297/index.html">WeakRef - propuesta para agregar al estándar ECMAScript</a></li>
<li><a href="../460301/index.html">Lámparas LED de alta potencia de nueva generación.</a></li>
<li><a href="../460307/index.html">Experiencia de modelado del equipo de Computer Vision Mail.ru</a></li>
<li><a href="../460311/index.html">Hora de una nueva teoría del dinero.</a></li>
<li><a href="../460313/index.html">¿Las diferentes canciones de éxito tienen algo en común?</a></li>
<li><a href="../460319/index.html">Caza de inspectores espaciales</a></li>
<li><a href="../460321/index.html">Galería de los mejores cuadernos ML y Data Science</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>