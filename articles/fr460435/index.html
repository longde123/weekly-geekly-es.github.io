<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“š ğŸ‘©ğŸ»â€ğŸ­ ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ¼ Petty Little Joy # 8: Petits plaisirs pour travailler avec la base de donnÃ©es ğŸŒ• ğŸ‘©ğŸ½â€ğŸ’» ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une rapide enquÃªte auprÃ¨s de collÃ¨gues sur mon projet actuel a montrÃ© qu'avec les mots "ORM et travailler avec la base de donnÃ©es" dans la grande majo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Petty Little Joy # 8: Petits plaisirs pour travailler avec la base de donnÃ©es</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460435/"><p>  Une rapide enquÃªte auprÃ¨s de collÃ¨gues sur mon projet actuel a montrÃ© qu'avec les mots "ORM et travailler avec la base de donnÃ©es" dans la grande majoritÃ© des cas, les mots "Alchemy" et "Django ORM" sonnent.  La connaissance de ces deux mots, en gÃ©nÃ©ral, suffit pour Ã©crire du code propre, soignÃ© et fonctionnel.  Mais l'Ã©largissement des horizons d'ingÃ©nierie n'a fait de mal Ã  personne jusqu'Ã  prÃ©sent, donc aujourd'hui, nous ajouterons Ã  notre image du monde quelques piÃ¨ces intÃ©ressantes (peut-Ãªtre jusqu'Ã  ce jour inconnues) pour travailler avec la base de donnÃ©es. </p><br><p><img src="https://habrastorage.org/webt/uk/az/it/ukazitmggbfvyxec95urmvbz8zs.jpeg"></p><a name="habracut"></a><br><h2 id="yoyo">  Yoyo </h2><br><p>  Aujourd'hui, tout ORM est livrÃ© avec un systÃ¨me de migration de base de donnÃ©es interne.  Une approche simple et cool, quand ORM surveille la structure des tables, en gÃ©nÃ©ral, convient Ã  tout le monde.  Mais cette solution a un cas oÃ¹ il n'est pas pratique de l'utiliser: </p><br><ul><li><p>  Il y a des gars qui figuatent les requÃªtes dans une base de donnÃ©es, contournant ORM.  Cela utilise quelque chose comme asyncpg et une petite tache auto-Ã©crite pour simplifier la compilation des demandes. </p><br><p> Pourquoi ces gars abandonnent-ils les Ã©quipements ORM?  Oui, car tout wrapper pour la base de donnÃ©es consomme une certaine quantitÃ© de ressources systÃ¨me, et ces gars-lÃ  doivent Ã©crire du code hautes performances.  Ils ont jetÃ© l'ORM, et d'une maniÃ¨re ou d'une autre, ils doivent migrer la base. </p><br></li><li>  Les migrants intÃ©grÃ©s peuvent avoir leurs propres opinions spÃ©cifiques sur la liaison et l'indexation des enregistrements.  Parfois, il n'est pas possible de supprimer ces vues ORM sur la structure de la table; vous devez corriger les corrections de requÃªte vous-mÃªme. </li></ul><br><p>  Dans les deux cas, il est pratique d'utiliser des migrations manuelles - nous ne nous appuyons pas sur les modÃ¨les ORM, mais avec nos mains, nous tapons les instructions SQL nÃ©cessaires et les introduisons dans un simple migrateur qui applique sÃ©quentiellement les modifications structurelles Ã  la base de donnÃ©es. </p><br><p>  La sortie est une structure de table propre, comprÃ©hensible et entiÃ¨rement gÃ©rable, compilÃ©e judicieusement. </p><br><p>  Pour une telle approche manuelle, il existe un migrateur de schÃ©ma de base de donnÃ©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">yoyo</a> . </p><br><pre><code class="bash hljs">pip install yoyo-migrations</code> </pre> <br><p>  Ensuite, tout le travail de gestion de la migration est effectuÃ© Ã  l'aide de l'exÃ©cutable yoyo </p><br><pre> <code class="bash hljs">yoyo new ./migrations -m <span class="hljs-string"><span class="hljs-string">"Add column to foo"</span></span></code> </pre> <br><p>  La commande crÃ©e un fichier dans lequel vous pouvez entrer une ou plusieurs instructions pour migrer le schÃ©ma </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> yoyo <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> step steps = [ step(<span class="hljs-string"><span class="hljs-string">"CREATE TABLE foo (id INT, bar VARCHAR(20), PRIMARY KEY (id))"</span></span>, <span class="hljs-string"><span class="hljs-string">"DROP TABLE foo"</span></span>), ]</code> </pre> <br><p>  AprÃ¨s cette migration, vous pouvez passer Ã  la base </p><br><pre> <code class="bash hljs">yoyo apply --database postgresql://scott:tiger@localhost/db ./migrations</code> </pre> <br><p>  Tout est simple, comme les journaux.  Et en mÃªme temps, vous avez un contrÃ´le absolu sur l'apparence de la base de donnÃ©es. </p><br><p>  Il y a deux inconvÃ©nients Ã  cette approche. </p><br><ul><li>  L'ensemble des champs des tables et leurs paramÃ¨tres devront Ãªtre suivis de poignÃ©es.  Chaque changement entraÃ®ne la nÃ©cessitÃ© d'Ã©crire <strong>ALTER TABLE</strong> vous-mÃªme, la possibilitÃ© de tout migrer en un seul clic est perdue. </li><li>  La fusion de ces migrations devra Ã©galement se faire toujours avec les mains et la tÃªte.  Ceci, bien sÃ»r, est un travail superflu.  Mais dans la pratique, les conflits et les fusions complexes de migration sont rares. </li></ul><br><h2 id="peewee">  Peewee </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/465/7ca/2a7/4657ca2a7a5cfe5db0889b7569d953df.png" alt="image"></p><br><p>  Un ORM petit et pas le plus populaire (bien qu'il ait Ã©tÃ© Ã©crit ici plus d'une fois), qui a cependant son propre public. <br>  Peewee est conÃ§u pour Ãªtre le wrapper le plus stupide et le plus simple de la base de donnÃ©es, avec le mÃ©canisme d'exÃ©cution de requÃªte le plus comprÃ©hensible et le code le plus facile Ã  lire. </p><br><pre> <code class="python hljs">Users.select().where( Users.user_id == user_id ).get()</code> </pre> <br><p>  MalgrÃ© sa simplicitÃ©, son minimalisme et une petite quantitÃ© de code, peewee a tout ce qui est nÃ©cessaire pour un travail sain. </p><br><ul><li>  Performances adÃ©quates (mais pas la vitesse d'exÃ©cution des requÃªtes la plus rapide) </li><li>  Tous les goodies nÃ©cessaires - divers ensembles de champs, relations entre entitÃ©s, pools de connexions, ensembles de plugins et d'extensions. </li><li>  Il y a mÃªme un asynchronisme plus ou moins sain d'esprit ajoutÃ© par le module tiers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peewee_async</a> . </li></ul><br><h2 id="pony-orm">  Orme de poney </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pony</a> est un emballage lÃ©gendaire.  La couche de base de donnÃ©es Ã©crite Ã  l'aide de cet ORM peut parfois accÃ©lÃ©rer le dos Ã  d'autres solutions.  Il n'y a pas de magie dans sa vitesse, il existe une politique trÃ¨s compÃ©tente de mise en cache des requÃªtes vers les bases de donnÃ©es, des tas d'optimisations et des astuces avec le code.  Au total, cela conduit au fait que le poney frit Ã  la vitesse du cheval. </p><br><p>  Le moins peut Ãªtre appelÃ© la syntaxe de requÃªte dans cet ORM - elle est trÃ¨s spÃ©cifique, avec l'utilisation de gÃ©nÃ©rateurs, de lambdas et d'autres chignons en langage Python. </p><br><pre> <code class="python hljs">query = select(c <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Customer <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sum(o.total_price <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> o <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> c.orders) &gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>) Product.select().order_by(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> p: desc(sum(p.order_items.quantity))).first()</code> </pre> <br><p>  Cette approche nÃ©cessite une certaine dÃ©composition du cerveau. </p><br><h2 id="tortoise-orm">  Orme de tortue </h2><br><p><img src="https://habrastorage.org/webt/wx/hw/9k/wxhw9knyyo5zzbper-awdud2mwm.png"></p><br><p>  En fouillant dans divers dÃ©pÃ´ts acceptant les animaux de compagnie, j'ai trouvÃ© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">collection de tests de diffÃ©rents ORM</a> avec des mesures de vitesse.  En plus du Pony ORM dÃ©jÃ  mentionnÃ©, un certain <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tortoise ORM</a> est apparu dans la liste des plus rapides.  Il est clair que les rÃ©sultats des tests dÃ©pendent de la personne qui Ã©crit les tests et de la faÃ§on dont ils s'exÃ©cutent, mais vous devez y regarder de plus prÃ¨s. </p><br><p>  La tortue est un projet relativement jeune, qui est toujours en dÃ©veloppement actif.  Les bonnes performances de cette bibliothÃ¨que s'expliquent par le fait que l'ORM ne contient rien de superflu et est prÃªt Ã  l'emploi emprisonnÃ© pour un fonctionnement asynchrone.  Et il suppose Ã©galement l'utilisation d' <strong>uvloop</strong> , qui fonctionne plus rapidement que les cycles de piton natifs des Ã©vÃ©nements. </p><br><p>  Cet ORM est encore trop brut pour Ãªtre utilisÃ© au combat (par exemple, jusqu'Ã  ce que les pools de connexions soient mÃªme implÃ©mentÃ©s), mais vous devriez regarder le dÃ©veloppement de cette lib.  Si tout va bien avec les dÃ©veloppeurs, dans l'annÃ©e Ã  venir, nous aurons un wrapper trÃ¨s rapide pour la base de donnÃ©es avec une bonne vitesse et sans l'Ã©trange syntaxe dans le style Pony. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460435/">https://habr.com/ru/post/fr460435/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460421/index.html">Commutateur optique TP-Link T2600G-28SQ pour les fournisseurs de services: un examen dÃ©taillÃ©</a></li>
<li><a href="../fr460423/index.html">WAL dans PostgreSQL: 3. Checkpoint</a></li>
<li><a href="../fr460425/index.html">Rhume infernal, lÃ©vitation et plasma: passÃ©, prÃ©sent et futur de la supraconductivitÃ©</a></li>
<li><a href="../fr460431/index.html">CrÃ©ation d'un pipeline de tests automatisÃ©s sur Azure DevOps</a></li>
<li><a href="../fr460433/index.html">Risques et menaces sur l'Internet des objets</a></li>
<li><a href="../fr460437/index.html">Comment nous mettons un vÃ©lo de support technique</a></li>
<li><a href="../fr460439/index.html">Langage de programmation P4</a></li>
<li><a href="../fr460441/index.html">Gleb Nitzman: Â«J'ai trouvÃ© la toute fin d'une Ã©poque oÃ¹ les gens n'avaient pas encore chassÃ© l'or contenu dans les Ã©lÃ©ments radioÂ»</a></li>
<li><a href="../fr460443/index.html">Concepteurs vs dÃ©veloppeurs: sur l'histoire de la crÃ©ation de l'application Â«Ma ville intelligenteÂ»</a></li>
<li><a href="../fr460445/index.html">Cours magistral "Fondamentaux du traitement numÃ©rique du signal"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>