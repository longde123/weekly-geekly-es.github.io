<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥‚Äç‚ò†Ô∏è üàöÔ∏è üßëüèæ‚Äçü§ù‚ÄçüßëüèΩ OMower SDK f√ºr Radroboter (Open Source, Open Hardware) üÜë üíê ‚úåüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Schlie√ülich haben wir das versprochene SDK f√ºr das OMower-Projekt ver√∂ffentlicht (eine offene Software- und Hardwareplattform f√ºr Radroboter auf Basis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OMower SDK f√ºr Radroboter (Open Source, Open Hardware)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409515/">  Schlie√ülich haben wir das versprochene SDK f√ºr das OMower-Projekt ver√∂ffentlicht (eine offene Software- und Hardwareplattform f√ºr Radroboter auf Basis des 32-Bit-ATSAM3X8E-Controllers mit Entwicklungsunterst√ºtzung in Arduino IDE).  Der Grad der Software-Fertigstellung ist nicht sehr gut (zum Beispiel gibt es keine Klassen f√ºr Sto√üf√§nger-, Regen- und Grassensoren, einige Funktionen sind nicht vollst√§ndig getestet), aber selbst in seiner aktuellen Form kann der Roboter mit hoher Genauigkeit √ºber RTK GPS fahren und unterst√ºtzt fast alles, was ben√∂tigt wird M√§her - Sonare, Kabelumfang, Kompass und GPS-Navigation, Laden von einer Ladestation oder einem Solarpanel. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/LkU6-B6TZKI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mein vorheriger Artikel √ºber das OMower-Projekt</a> <br><a name="habracut"></a><br>  Der SDK-Code und die Kicad-Dateien mit der Schaltung und der Verkabelung der Platine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">liegen auf dem Github</a> . <br><br>  Derzeit werden nur zwei Plattformen unterst√ºtzt - OMower Board v3 mit Polulu Dual MC33926-Motortreibern und einer Reihe von Arduino Due + IHM12A1-Motortreibern (Testmaschine auf einem kleinen vierr√§drigen Chassis).  Ardumower-Unterst√ºtzung basierend auf Arduino Due kann hinzugef√ºgt werden.  Es ist sehr w√ºnschenswert, ein IMU GY-80-Board zu haben, ohne das die Navigation nicht einfach funktioniert (obwohl Sie einen einfachen M√§hermann herstellen k√∂nnen, der versehentlich in den Kabelumfang f√§hrt). <br><br>  In der neuen, vierten Version der Karte ist geplant, eine IMU MPU9250 darauf zu platzieren und einen FRAM-Chip hinzuzuf√ºgen, um Benutzereinstellungen zu speichern, die nicht im internen Flash des Controllers enthalten sind (der beim erneuten Laden der Firmware zur√ºckgesetzt wird). Nun, alle Arten von Karten k√∂nnen darin gespeichert werden.  Au√üerdem werde ich wahrscheinlich die Gr√∂√üe der Widerstands- und Kondensatorbaugruppen erh√∂hen, das L√∂ten des 0402 ‚Äûam Knie‚Äú mit einem Haartrockner war ein Vergn√ºgen unter dem Durchschnitt und den Platz f√ºr die Anschl√ºsse vergr√∂√üern, damit Sie diese mit Klemmen und nicht nur mit Stecknadeln platzieren k√∂nnen. <br><br>  Der API-Code wird in Form einer Handvoll Klassen (omower - *. H-Dateien) geschrieben, die Sie als Objekte in Ihre Software aufnehmen m√ºssen (und optional alle einschlie√üen k√∂nnen, k√∂nnen Sie nur diejenigen verwenden, die ben√∂tigt werden, mit Ausnahme der Basisklassen).  Um das Verst√§ndnis und Testen zu vereinfachen, wurde OMower_Simple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">geschrieben</a> , das eine ziemlich gro√üe Anzahl von Befehlen ausf√ºhrt, die √ºber pfodApp von jedem Smartphone aus ausgegeben werden. <br><br>  Das SDK √ºbernimmt die Kontrolle √ºber alle Funktionen auf niedriger Ebene und arbeitet haupts√§chlich mit Unterbrechungen. Dadurch kann der endg√ºltige Softwareprogrammierer Software unabh√§ngig von den spezifischen Details eines bestimmten Roboters und auf sehr kostenlose Weise schreiben (Sie k√∂nnen eine Zustandsmaschine schreiben oder einfach die Startantriebsfunktion aufrufen und warten Sie, bis der Roboter den gew√ºnschten Punkt erreicht hat.  Nur die Verfahren zum Aufrufen der Funktionen zum Initialisieren und Steuern der Fahrt des Roboters fallen auf die Schultern des Programmierers (Anweisungen, wohin die Operationen von Sonaren und anderen Sensoren tats√§chlich gehen und zu verarbeiten sind). <br><br>  Zum Anschlie√üen zus√§tzlicher externer Ger√§te auf der Karte (und nat√ºrlich zur Unterst√ºtzung im SDK) gibt es viele externe Anschl√ºsse.  Beispielsweise k√∂nnen Standard-Servoantriebe mit PPM-Eingang bis zu vier Teile anschlie√üen (oder sogar sechs, wenn Sie zwei Motoren ablehnen).  Es gibt viele ‚ÄûStandard‚Äú -Sensoren f√ºr den M√§her, es gibt bis zu sechs dieser Sonare und vier der Umfangssensoren.  In den meisten F√§llen wird nat√ºrlich nicht so viel ben√∂tigt, und ein Teil ihrer Anschl√ºsse kann zum Anschlie√üen einiger anderer Ger√§te verwendet werden (fast alle Ausg√§nge des Mikrocontrollers werden ausgegeben).  Der intellektuelle Teil (Verarbeitung von RTK GPS, Konnektivit√§t mit WLAN) wird von Orange PI Zero ausgef√ºhrt, das in einem speziellen Anschluss installiert ist. <br><br>  Ich entschuldige mich im Voraus f√ºr die Kurve und den unvollendeten Code an einigen Stellen, ich musste mich mit anderen Projekten befassen, und es kamen viele Schwierigkeiten auf, die ich kaum bew√§ltigen konnte.  Aber ich habe viele neue Dinge gelernt, zum Beispiel, dass die Kr√ºmmung der Erdellipse an unseren Orten fast 40 Meter betr√§gt und die Magnetpole der Erde von Jahr zu Jahr mehrere zehn Kilometer wandern (ohne dies zu ber√ºcksichtigen, bewegte sich der Roboter mit sehr gekr√ºmmten Linien von Punkt zu Punkt).  Manchmal schien es, als w√ºrde ich eine Weltraumrakete starten und kein Rasenm√§hen.  :) :) <br><br>  Als Bonus habe ich auch die Quellen meiner Firmware f√ºr das Arduino mit Decawave DW1000 ausgelegt, das ein Mini-Netzwerk dieser Ger√§te organisiert und es dem Roboter erm√∂glicht, seinen Standort in Innenr√§umen zu bestimmen oder wo RTK GPS seine Koordinaten einfach nicht bestimmen kann (mit Unterst√ºtzung f√ºr eine nahezu unendliche Menge) Tags und Aufteilung in R√§ume).  Diese <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Firmware ist</a> immer noch sehr, sehr roh, kann aber f√ºr jemanden n√ºtzlich sein. <br><br>  Update, ich habe beschlossen, den Artikel mit einer Geschichte dar√ºber zu erg√§nzen, wie er im Inneren angeordnet ist: <br><br>  Der SDK-Benutzer muss alle ben√∂tigten Objekte ermitteln, die Funktion begin () f√ºr alle aufrufen (Hardware-Initialisierung nur einmal), dann die Werte seiner Parameter festlegen (nachdem er sie aus dem Flash gelesen hat oder nur Standardwerte), init () f√ºr alle aufrufen (die Funktion kann) Zum Zur√ºcksetzen des Ger√§ts, f√ºr das das Objekt verantwortlich ist.) Legen Sie Hook-Funktionen f√ºr poll10 / poll20 / poll50 fest (10, 20 und 50 Mal pro Sekunde), von denen aus die entsprechenden poll * () -Funktionen aller verwendeten Objekte aufgerufen werden sollen.  Theoretisch war es m√∂glich, all dies im Code des SDK selbst zu automatisieren, aber ich habe mich entschieden, dies nicht zu tun, da zus√§tzliche Controller-Ressourcen verbraucht werden.  Ein Beispiel f√ºr die Verwendung, die Sie f√ºr OMower_Simple.ino ben√∂tigen <br><br>  Eine der Hauptklassen ist das Motorobjekt (omower-motors.h), das die Motortreiber √ºber seine Funktion poll10 () steuert.  Der Benutzer ruft einfach Roll / Move (Drehen und Fahren ohne Navigation) oder RollCourse / MoveCourse (Fahren mit Navigation / Korrektur basierend auf Daten eines untergeordneten Objekts der navThing-Klasse auf, das √ºber die Funktionen readCourseError () den Wert der Abweichung von der gew√ºnschten Fahrtrichtung angibt ) <br><br>  Derivate von navThing sind Objekte der Klassen imu und gps (omower-imu.h und omower-gps.h). Die erste ist f√ºr das Lesen und Konvertieren der Kompass- / Beschleunigungsmesser- / Gyroskopdaten in eine bequeme Form verantwortlich (sie gibt die Kompass- und Neigungswerte in Grad auf zwei Achsen an )  Die zweite - verarbeitet GPS-Daten und lenkt das Motorobjekt in die richtige Richtung, wenn Sie √ºber GPS- oder RTK-GPS-Koordinaten fahren m√ºssen (f√ºr letztere wird die Korrektur berechnet, wenn sich die Antenne nicht in der Mitte des Roboterk√∂rpers befindet, und die Kurzzeitkorrektur durch Kilometerz√§hlersensoren).  Das Anwenderprogramm ist f√ºr die Kommunikation mit dem GPS-Empf√§nger selbst verantwortlich und √ºbertr√§gt NMEA-Zeichenfolgen oder Bereitschaftskoordinaten an das GPS-Objekt. <br><br>  Das M√§hobjekt (omower-mow.h) ist f√ºr den Schermotor und dessen Aktuatoraufzug mit einem Schrittmotor (falls vorhanden) verantwortlich.  Der Benutzer sagt, mit welcher Geschwindigkeit gedreht und welche Schnitth√∂he eingestellt werden soll. <br><br>  Das pwmServo-Objekt (omower-pwmservo.h) steuert die PWM-A / B / C / D / E / F / G / H-Ausg√§nge (dies kann aufgrund m√∂glicher Konflikte mit Zeitgebern nicht √ºber andere Bibliotheken erfolgen). <br><br>  Das Leistungsobjekt (omower-power.h) ist f√ºr die Steuerung der Laderegler und die Umwandlung der ADC-Werte in Volt und Ampere verantwortlich, die jeder versteht.  Das Anwenderprogramm muss das Auftreten von Spannung an den Ladeelektroden erkennen und die Funktion zum Einschalten des Ladevorgangs aufrufen. Anschlie√üend werden die PWM-Zyklen der Regler entsprechend dem Ladestrom erfasst. <br><br>  Da die Verwendung von Standard-Arduin Serial * -Objekten die Interrupt-Behandlung unterbrechen kann (siehe unten), gibt es ein serielles Objekt (omower-serial.h) zum Lesen und √úbertragen von seriellen Ports.  Leider besteht das gleiche Problem bei I2C-Bussen. Sie m√ºssen mit den in due-i2c-blocking.h definierten Funktionen verwendet werden. <br><br>  Die Funktionen anderer Objekte sind aus ihren Namen ersichtlich. Sie k√∂nnen nur die Kommentare in den Header-Dateien (omower-sonars.h, omower-rtc.h, omower-current * .h, omower-odometry.h usw.) anzeigen. <br><br>  Nun zu Interrupts auf der untersten Ebene.  Das Chassis-Objekt (omower-chassis.h) konfiguriert TIM7 mit 100 Interrupts pro Sekunde.  Bei jedem Interrupt werden 12 Kan√§le des ADC-Chips MAX11617 gelesen (in ein spezielles Array eingegeben, von dem OMower SDK-Objekte ihre Werte lesen - max11617-adc-scan.h).  Bei jeder Sekunde wird ein weicher Interrupt f√ºr den Funktionshaken poll50 () generiert, bei jeder f√ºnften - poll20 (), bei jeder zehnten - poll10 ().  Sie arbeiten alle asynchron (was praktisch ist, aber die Verwendung des I2C-Busses einschr√§nkt, sp√§ter plane ich, dort einige Transaktionen / Semaphoren hinzuzuf√ºgen). <br><br>  Der TIM5-Timer ist auch so konfiguriert, dass er Interrupts mit einer Frequenz von 38462 Hertz erzeugt.  Von diesem Interrupt werden alle Kan√§le des internen ADC-Controllers gelesen und in ein spezielles Array eingegeben (es unterst√ºtzt auch die Eingabe jedes empfangenen Werts f√ºr den ausgew√§hlten Puffer in den Ringpuffer, was beispielsweise durch die Perimeterklasse erfolgt und diese Abtastwerte sp√§ter unter Verwendung der Fourier-Transformation filtert). <br><br>  Um Debugging-Informationen auszugeben, gibt es eine debug () -Funktion mit einer minimalen Priorit√§t f√ºr die Anzeige von Nachrichten (das hei√üt, w√§hrend das Debugging nicht durchgef√ºhrt wird, wird nichts an die Konsole ausgegeben, aber Sie k√∂nnen jederzeit mindestens die maximale Stufe aktivieren, es wird Spam sein).  In den Formaten f√ºr Debugging-Werte (* printf-Format) werden Gleitkommazahlen unterst√ºtzt (im Gegensatz zu Standard-Arduin-Funktionen). <br><br>  Update: Die neue vierte Version der OMower-Karte, bisher nur eine Schaltung (wartet auf die Herstellung der Leiterplatte).  Enth√§lt zus√§tzlich einen Kompass / Beschleunigungsmesser MPU9250, 128 Kilobyte F-RAM zum Speichern von Einstellungen, Karten, Wegpunkten und anderen Dingen, alle Anschl√ºsse mit Verriegelungen (Molex 22-11-20x3 / 10-11-20x3, kompatibel mit der alten Version von einem 2.54- Pins), 74HC4050-Logikpegel√ºbersetzer f√ºr Sonare und Kilometerz√§hler, leistungsst√§rkere 3,3 / 5-Volt-Stromrichter (bis zu drei Ampere), zwei weitere PWM / PPM-Ausg√§nge an Steckverbindern, separate Leitungen zur unabh√§ngigen Steuerung des zweiten Schrittmotortreibers, mehr Pufferkondensatoren f√ºr Stabilit√§t Gro√üe SMD-Elemente f√ºr eine einfache Montage  kleinere √Ñnderungen. <br><br> <a href=""><img src="https://habrastorage.org/webt/xz/r_/sr/xzr_srcxrfx72fdh4nvtuaqgjuo.png"></a> <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de409515/">https://habr.com/ru/post/de409515/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de409503/index.html">Neues Jahr, neue Rekorde: 50. Mersenne Prime gefunden</a></li>
<li><a href="../de409505/index.html">Glasmousepad zum Selbermachen</a></li>
<li><a href="../de409507/index.html">White Noise Record auf YouTube erhielt f√ºnf Anspr√ºche von f√ºnf verschiedenen Copyright-Inhabern</a></li>
<li><a href="../de409509/index.html">Forscher glauben, dass ein Bot den Preis f√ºr Bitcoin von 150 auf 1000 Dollar erh√∂ht hat</a></li>
<li><a href="../de409511/index.html">SORM auf Kosten der Betreiber und Yarovaya?</a></li>
<li><a href="../de409517/index.html">Der Geist begann, als die G√∂tter aufh√∂rten zu reden</a></li>
<li><a href="../de409519/index.html">James Webb Teleskop durch extrem niedrige Temperaturen und Vakuum √ºberpr√ºft</a></li>
<li><a href="../de409521/index.html">Neue Stabilisatoren DJI Osmo Mobile 2 und Ronin-S</a></li>
<li><a href="../de409523/index.html">Gespr√§ch mit dem Auto: die F√§higkeit zu h√∂ren und zuzuh√∂ren</a></li>
<li><a href="../de409525/index.html">Wie nur ein Unternehmen die Grenzen dessen erweitern kann, was im Bereich unbemannter Luftfahrzeuge m√∂glich ist</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>