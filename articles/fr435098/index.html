<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🎨 🌷 🛁 ADB vs Spy Cam & Mic 👩🏾‍🤝‍👨🏼 🤜🏻 🧕🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comment vérifier si une application sur le smartphone Android a un rapport photo ou vidéo, bien qu'il n'en ait jamais besoin? L'option suivante n'est ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ADB vs Spy Cam & Mic</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435098/">  Comment vérifier si une application sur le smartphone <i>Android</i> a un rapport photo ou vidéo, bien qu'il n'en ait jamais besoin?  L'option suivante n'est pas parfaite du tout, mais ne nécessite pas de «root» ou de firmware personnalisé. <br><br>  <i>PS J'ai ajouté une description de la surveillance de l'accès des applications au microphone à l'article.</i> <br><br>  Ce que vous devez installer: <br><ul><li>  <i>ADB</i> ( <i>Android Debug Bridge</i> ) (par exemple, dans le cadre des <i>outils de la plate-forme SDK Android</i> - vous pouvez télécharger <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ); </li><li>  pilote pour le téléphone (si nécessaire, par exemple, <i>Google USB Driver</i> peut être téléchargé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ). </li></ul><br>  Nous activons le mode de débogage via <i>USB</i> sur le téléphone et connectons le smartphone au <i>port USB de l'</i> ordinateur, et vous devez sélectionner le mode de <i>connexion USB</i> , autre que «Chargement uniquement». <br><div class="spoiler">  <b class="spoiler_title">Texte masqué</b> <div class="spoiler_text">  Dans le «Gestionnaire de périphériques», le smartphone s'affiche, par exemple, comme suit: <br>  en mode "Photo" ou "Fichiers" <br><img src="https://habrastorage.org/webt/8b/nh/bi/8bnhbi9hvmyd2456nnbkdakfcbm.png"><br>  en mode clé USB <br><img src="https://habrastorage.org/webt/he/tf/iz/hetfizpqdgopgbzupspiggwdysw.png"><br>  Et donc, dans la sortie de la commande <i>lsusb</i> : <br><img src="https://habrastorage.org/webt/uq/pr/ps/uqprpshh-ncs265jlpbpgamvd6e.png"><br></div></div><br>  Ouvrez la ligne de commande dans le répertoire dans lequel les "outils" sont installés. <br>  Vérifiez que la connexion est réussie (le numéro de série du smartphone connecté est affiché): <br><pre><code class="bash hljs">adb devices</code> </pre>  (pour <i>windows</i> ) <br><img src="https://habrastorage.org/webt/xs/5y/e3/xs5ye3ez3e64mcqpicweuhzywlk.png"><br>  Pour <i>Linux, la</i> commande ressemblerait à ceci: <br><pre> <code class="bash hljs">./adb devices</code> </pre> <br>  Si l'ordinateur n'est pas autorisé à être utilisé avec ce smartphone (pour <i>Android</i> 4.2.2 et versions ultérieures), le message d'avertissement " <b>non autorisé</b> " apparaîtra à côté du numéro de série. <br>  Pour l'autorisation, vous devez confirmer l'autorisation de débogage via <i>USB</i> sur le smartphone. <br><div class="spoiler">  <b class="spoiler_title">Texte masqué</b> <div class="spoiler_text">  Sous <i>Linux</i> , le message " <b>aucune autorisation</b> " peut apparaître - dans mon cas, j'ai réussi à résoudre le problème en basculant le smartphone en mode "Périphérique multimédia ( <i>MTP</i> )". <br></div></div><br>  Lancez le shell sur l'appareil (nous obtenons l'invite "$"): <br><pre> <code class="bash hljs">adb shell</code> </pre> <br><img src="https://habrastorage.org/webt/xj/u-/hm/xju-hm5vnekjwns8kk9iemaceo0.png"><br><br>  Nous introduisons ensuite les symboles "magiques" suivants: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ps `<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ! (dumpsys media.camera | grep -E <span class="hljs-string"><span class="hljs-string">"PID"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> | grep -o <span class="hljs-string"><span class="hljs-string">"[^PID: ][0-9]*$"</span></span>` | grep -o <span class="hljs-string"><span class="hljs-string">"[^S ]*$"</span></span> ; date; sleep 1; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><a name="habracut"></a><br><br>  Version améliorée, suppression de la sortie "NAME" et des lignes vides: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ps `<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ! (dumpsys media.camera | grep -E <span class="hljs-string"><span class="hljs-string">"PID"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> | grep -o <span class="hljs-string"><span class="hljs-string">"[^PID: ][0-9]*$"</span></span>` | grep -o <span class="hljs-string"><span class="hljs-string">"[^S ]*$"</span></span> | grep -v <span class="hljs-string"><span class="hljs-string">"NAME"</span></span> | grep .; date; sleep 1; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br><br>  Et rien ne se passe :-) Jusqu'à ce que quelque chose décide de prendre une petite photo :-) <br><br>  Le jeu de caractères «magique» indiqué commence à surveiller l'accès au service de caméra - <i>media.camera</i> à la vitesse la plus élevée possible (ce service est implémenté par la bibliothèque <i>libcameraservice.so</i> ).  Si la caméra n'est pas active, <i>dumpsys</i> affiche quelque chose comme ceci: <br><img src="https://habrastorage.org/webt/at/pj/pv/atpjpvwxpi0zifn52wob3cd7nc8.png"><br>  Et si une caméra est nécessaire, cela apparaît: <br><img src="https://habrastorage.org/webt/2s/7e/n0/2s7en0ianftirjofmyjfzjpxe2i.png"><br><br>  <i>grep</i> vérifie la présence d'un " <i>PID</i> " et, si cette chaîne existe, ils coupent le numéro de processus de la chaîne et le transmettent à la commande <i>ps</i> , qui affiche les données sur ce processus, et un autre <i>grep</i> coupe son nom.  Après avoir détecté l'activité de la caméra, faites une pause d'une seconde afin que les messages ne se répandent pas trop souvent.  Pour interrompre la commande, utilisez la combinaison de <i>touches CTRL-C</i> et pour quitter le shell - <i>CTRL-D</i> . <br><br>  L'exemple le plus simple est qu'après le lancement de l'application smartphone standard pour la prise de vue photo / vidéo, les messages avec le nom du processus et la date / heure commencent à affluer à des intervalles de 1 seconde: <br><br><img src="https://habrastorage.org/webt/kj/lu/rj/kjlurja3_dqlnzegfi6tfabrcv0.png">  " <br><br>  Mais il existe des applications plus astucieuses, elles peuvent être trouvées par le mot clé "spy cam" (en utilisant une astuce, par exemple, avec un aperçu à un pixel ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://www.ez.ai/2014/05/exploring-limits-of-covert-data .html</a> )).  Une telle création s'effondre au début du tournage et des reportages, mais des messages affluent régulièrement: <br><br><img src="https://habrastorage.org/webt/gd/a0/wy/gda0wy7nqinaoaxki1ftvziye50.png"><br><br>  J'ai également vérifié la fonctionnalité de la méthode proposée sur une application qui prend une seule photo en cliquant sur un bouton flottant <img src="https://habrastorage.org/webt/4s/6_/vo/4s6_voee5sikw5qgscsmjeqiofq.png">  sans aucune fenêtre d'aperçu visible. <br>  Le script a réussi à appeler la caméra et a émis deux messages à chaque prise de vue: <br><img src="https://habrastorage.org/webt/7r/5v/y4/7r5vy4yfcwzo1bqmgjaafevrjcg.png"><br><br>  Mais rien ne vous empêche d'implémenter des fonctionnalités similaires dans une application avec un nom plus anodin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.zdnet.com/article/this-scary-android-malware-can-record-audio-video-and-steal-your- données /</a> ), et les autorisations - eh bien, il y a toutes sortes de cas.  Et l'application «légale» peut signaler quand elle lui plaît (j'ai rencontré la mention d'un tel cas).  Et ce n'est pas en vain <i>qu'Android P a</i> pris des mesures pour empêcher les applications d'arrière-plan d'accéder à la caméra. <br><br>  La méthode a été testée sur les smartphones <i>Huawei SCL-L01</i> ( <i>Android</i> 5.1.1) et <i>Huawei G700-U20</i> ( <i>Android</i> 4.2.1), sur d'autres modèles de smartphones, le <i>format de</i> sortie de <i>dumpsys</i> peut différer (il n'est pas normalisé pour le service <i>media.camera</i> ), ce qui nécessitera une correction de code . <br>  Le format du message est codé en dur dans la bibliothèque <i>/system/lib/libcameraservice.so</i> - par exemple, pour le smartphone <i>Huawei SCL-L01</i> : <br><img src="https://habrastorage.org/webt/tg/zd/mx/tgzdmx-b6daoiiqvaybyy9r6jpe.png"><br>  Dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commentaire</a> - un indice sur la façon de changer le code pour travailler avec un smartphone sous <i>Android</i> 9. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ce commentaire</a> montre le journal d'accès à la caméra maintenu par le <i>HTC U11</i> . <br>  Mais, par exemple, sur "l'ancien" <i>Huawei U8650</i> ( <i>Android</i> 2.3.4), <i>dumpsys</i> fonctionne bien: <br><img src="https://habrastorage.org/webt/_b/7i/6x/_b7i6xaaoc6i9bedq4k3upl46c0.png"><br>  Et les droits ne suffisent pas pour ... <i>grep</i> :-) <br><img src="https://habrastorage.org/webt/u4/s0/ie/u4s0iejn5_nkltppwoevptg-wpy.png"><br><br>  <u>Surveillance de l'accès au microphone</u> <br><br>  Une méthode similaire peut être appliquée pour surveiller l'accès des applications au microphone.  Dans ce cas, vous devez surveiller le service <i>media.audio_flinger</i> . <br>  On entre la commande dans le «shell» (le code donné fonctionne sur le smartphone <i>Huawei SCL-L01</i> ( <i>Android</i> 5.1.1)): <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ps `<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ! (dumpsys media.audio_flinger | grep -A20 Input| grep -A1 Client | grep yes | grep -o <span class="hljs-string"><span class="hljs-string">"[^yes ].*"</span></span> | grep -o [0-9]*) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>` | grep -o <span class="hljs-string"><span class="hljs-string">"[^S ]*$"</span></span> | grep -v <span class="hljs-string"><span class="hljs-string">"NAME"</span></span> | grep .; date; sleep 1; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br>  Si une application enregistre le son via un microphone, alors dans la sortie de <i>dumpsys media.audio_flinger,</i> il y a un fragment similaire: <br><img src="https://habrastorage.org/webt/mr/gx/ol/mrgxoltpgeeurxc7_hzja8mc5i4.png"><br>  ( <b>Fil d'</b> entrée - flux d'entrée, <b>22467</b> - <i>PID du</i> son d'enregistrement de processus). <br>  Lorsque vous enregistrez du son via l'application standard «Enregistreur vocal» et que la surveillance est activée (via le code ci-dessus), les messages suivants apparaissent: <br><img src="https://habrastorage.org/webt/kj/0b/us/kj0busykxehfhlhbypunzuz-rn8.png"><br>  Mais quels messages sont versés lorsque la saisie vocale du traducteur <i>Google</i> est activée: <br><img src="https://habrastorage.org/webt/u9/am/f_/u9amf_27htcg5wcxgr3duk4nu0o.png"><br>  <b>Sur d'autres smartphones, le <i>format de</i> sortie de <i>dumpsys</i> peut être différent, ce qui nécessitera une correction de code.</b> <br>  Par exemple, sur un smartphone <i>Huawei G700-U20</i> ( <i>Android</i> 4.2.1): <br><img src="https://habrastorage.org/webt/3p/d2/mj/3pd2mjkp8yecq7jipjla-bwed6e.png"><br>  Dans ce cas, le code de surveillance ressemblera à: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ps `<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ! (dumpsys media.audio_flinger | grep -A3 Input| grep -A1 Clien | grep -o <span class="hljs-string"><span class="hljs-string">"[^ ].*"</span></span> | grep -o [0-9]*) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span>` | grep -o <span class="hljs-string"><span class="hljs-string">"[^S ]*$"</span></span> | grep -v <span class="hljs-string"><span class="hljs-string">"NAME"</span></span> | grep .; date; sleep 1; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  Voici comment l'Alice «ressuscitée» se manifeste dans ce cas: <br><img src="https://habrastorage.org/webt/hd/cv/xe/hdcvxedtfruwftsyoxt7avij56i.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435098/">https://habr.com/ru/post/fr435098/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435084/index.html">Comment travailler avec async / wait dans les boucles JavaScript</a></li>
<li><a href="../fr435086/index.html">Que devrions-nous construire notre carte de montage PCI-E</a></li>
<li><a href="../fr435088/index.html">Le géant chinois du streaming Tencent Music entre en bourse - qu'est-ce que cela signifie et à quoi les concurrents devraient-ils s'attendre</a></li>
<li><a href="../fr435094/index.html">Manette de jeu de Sega Mega Drive et Raspberry Pi Partie 2 (six derniers boutons)</a></li>
<li><a href="../fr435096/index.html">L'effet de la radio à tube chaud</a></li>
<li><a href="../fr435102/index.html">Un peu sur l'analyse lexicale</a></li>
<li><a href="../fr435106/index.html">Encore une fois à propos de passport.js</a></li>
<li><a href="../fr435108/index.html">Utilisation de Prolog</a></li>
<li><a href="../fr435112/index.html">Entretien d'entreprise</a></li>
<li><a href="../fr435114/index.html">Spring data jpa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>