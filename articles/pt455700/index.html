<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì∫ üë∂ üòû 4 truques que nos ajudaram a otimizar o frontend üö£üèª üî± üõê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Belas anima√ß√µes h√° muito se estabelecem nas tend√™ncias de design. Os designers de interface do usu√°rio fazem carross√©is, downloads, anima√ß√µes de menu ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>4 truques que nos ajudaram a otimizar o frontend</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/epayments/blog/455700/"><p>  Belas anima√ß√µes h√° muito se estabelecem nas tend√™ncias de design.  Os designers de interface do usu√°rio fazem carross√©is, downloads, anima√ß√µes de menu e outras decora√ß√µes elaboradas, e os desenvolvedores de front-end os traduzem em c√≥digo.  Mas o site n√£o deve apenas ter uma boa apar√™ncia, mas tamb√©m funcionar rapidamente. </p><br><p>  Um frontend moderno deve otimizar seu c√≥digo.  Isso √© especialmente verdadeiro para produtos nos quais a maioria do p√∫blico acessa o site a partir de dispositivos m√≥veis.  Alguns m√©todos de anima√ß√£o ficam atrasados, mesmo no Chrome, nos melhores computadores, mas devem funcionar sem problemas em um smartphone comum. </p><br><p>  Nossos desenvolvedores usaram um grande n√∫mero de t√©cnicas que ajudaram a otimizar o site e acelerar o trabalho.  Eu colecionei 4 dos mais interessantes deles.  Compartilhamos conhecimentos √∫teis para iniciantes e profissionais, al√©m de fornecer links para tutoriais √∫teis. </p><br><p><img src="https://habrastorage.org/webt/1e/2e/ic/1e2eic7lnnlwnm22gy1y2ah8zto.jpeg"></p><a name="habracut"></a><br><h2 id="1-animaciya-na-scss">  1. Anima√ß√£o no SCSS </h2><br><p>  <strong>O site tem muita anima√ß√£o.</strong>  <strong>Precisamos do navegador para reproduzi-lo com uma taxa de quadros est√°vel de 60 qps.</strong>  <strong>Em CSS puro, isso √© dif√≠cil, portanto usamos o SCSS.</strong> </p><br><p>  Para criar os controles deslizantes, usamos a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Swiper</a> .  Para um controle deslizante horizontal, o uso desta biblioteca √© justificado, pois precisamos fornecer suporte ao svayp do usu√°rio.  Mas para um carrossel sem fim vertical, o Swiper n√£o √© necess√°rio, n√£o h√° intera√ß√£o do usu√°rio.  Portanto, quer√≠amos repetir a mesma funcionalidade usando apenas recursos CSS. </p><br><p>  A primeira e mais importante condi√ß√£o ao trabalhar com anima√ß√£o CSS √© usar apenas as propriedades de transforma√ß√£o e opacidade.  Os navegadores podem otimizar independentemente a anima√ß√£o dessas propriedades e produzir 60 fps est√°veis.  No entanto, o uso de @keyframes sozinho n√£o √© poss√≠vel gravar anima√ß√µes diferentes para elementos diferentes, e animar cada elemento individualmente em CSS puro consome muito tempo.  Como escrever rapidamente a anima√ß√£o que precisamos?  Escolhemos o SCSS, o dialeto SASS - uma extens√£o CSS mais funcional. </p><br><p>  Vamos analisar o uso do SCSS usando o exemplo do nosso controle deslizante vertical. </p><br><p><img src="https://habrastorage.org/webt/bt/si/ia/btsiiagvb3utwdiuf4hasoszp7a.gif"></p><br><p>  √Ä nossa disposi√ß√£o, h√° um cont√™iner cuja altura √© igual √† altura dos tr√™s elementos do carrossel.  No interior, h√° outro recipiente contendo todos os elementos do carrossel. </p><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"b-vertical-carousel-slider"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-wrapper slider-items"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Removemos a visibilidade dos elementos do cont√™iner que v√£o al√©m e definimos a altura dos blocos. </p><br><pre> <code class="plaintext hljs">.b-vertical-carousel-slider { position: relative; overflow: hidden; height: $itemHeight * 3; .vertical-carousel-slider-item { height: $itemHeight; } }</code> </pre> <br><p>  O c√°lculo da anima√ß√£o muda apenas se o n√∫mero de elementos no carrossel mudar.  Em seguida, escrevemos um mixin que recebe um par√¢metro de entrada - <code>$itemCount</code> </p><br><pre> <code class="plaintext hljs">@mixin verticalSlideAnimation($itemCount) { }</code> </pre> <br><p>  No mixin, gere um quadro-chave para cada elemento, defina o estado inicial para ele e use <code>:nth-child</code> determinar a anima√ß√£o para o elemento. </p><br><pre> <code class="plaintext hljs">for $i from * 1 through $itemCount { $animationName: carousel-item-#{$itemCount}-#{$i}; @keyframes #{$animationName} { 0% { transform: translate3d(0, 0, 0) scale(.95); } } .vertical-carousel-slider-item:nchild(#{$i}) { animation: $stepDuration * $itemCount $animation ease infinite; } }</code> </pre> <br><p>  Al√©m disso, durante a anima√ß√£o, apenas moveremos os elementos ao longo do eixo y e alteraremos a escala do elemento no centro. </p><br><p>  Estados do elemento carrossel: </p><br><ol><li>  Paz </li><li>  Deslocamento Y </li><li>  Deslocamento Y </li><li>  Deslocamento Y com diminui√ß√£o </li></ol><br><p>  Cada item <code>$itemCount</code> vezes, aumentar√° uma vez e diminuir√° uma vez durante o movimento.  Portanto, geraremos e calcularemos a anima√ß√£o para cada um dos movimentos para cima. </p><br><pre> <code class="plaintext hljs">@keyframes #{$animationName} { 0% { transform: translate3d(0, 0, 0) scale(.95); } @for $j from 0 through $itemCount { $isFocusedStep: $i == $j + 2; $isNotPrevStep: $i != $j + 1; $offset: 100% / $itemCount * ($animationTime / $stepDuration); @if ($isFocusedStep) { #{getPercentForStep($j, $itemCount, $offset)} { transform: getTranslate($j - 1) scale(.95); } #{getPercentForStep($j, $itemCount)} { transform: getTranslate($j) scale(1); } #{getPercentForStep($j + 1, $itemCount, $offset)} { transform: getTranslate($j) scale(1); } #{getPercentForStep($j + 1, $itemCount)} { transform: getTranslate($j + 1) scale(.95); } } @else if ($isNotPrevStep) { #{getPercentForStep($j, $itemCount, $offset)} { transform: getTranslate($j - 1) scale(.95); } #{getPercentForStep($j, $itemCount)} { transform: getTranslate($j) scale(.95); } } } }</code> </pre> <br><p>  Resta definir algumas vari√°veis ‚Äã‚Äãe fun√ß√µes: </p><br><ul><li>  <code>$animationTime</code> - tempo de interpola√ß√£o de movimento </li><li>  <code>$stepDuration</code> - tempo total de execu√ß√£o de uma etapa da anima√ß√£o ( <code>$animationTime</code> + tempo de descanso do carrossel) </li><li>  <code>getPercentForStep($step, $itemCount, $offset)</code> - uma fun√ß√£o que retorna em porcentagem o ponto extremo de um dos estados. </li><li>  <code>getTranslate($step)</code> - retorna a convers√£o dependendo da etapa da anima√ß√£o </li></ul><br><p>  Implementa√ß√µes de fun√ß√µes de exemplo: </p><br><pre> <code class="plaintext hljs">@function getPercentForStep($step, $count, $offset: 0) { @return 100% * $step / $count - $offset; } @function getTranslate($step) { @return translate3d(0, -100% * $step, 0); }</code> </pre> <br><p>  Temos um carrossel de trabalho com um elemento crescente no meio.  Resta fazer uma sombra sob os elementos crescentes.  Inicialmente, cada elemento do carrossel tinha um pseudo-elemento: depois, que por sua vez tinha uma sombra.  Para n√£o animar a propriedade shadow, usamos a propriedade opacidade, ou seja,  apenas mostrou e escondeu a sombra. </p><br><p>  Por√©m, na nova implementa√ß√£o de uma solu√ß√£o desse tipo, voc√™ precisa gerar muitos quadros-chave adicionais para cada pseudo-elemento.  Decidimos fazer isso com mais facilidade: haver√° um bloco com sombra e ele ocupar√° espa√ßo exatamente abaixo do elemento do meio do carrossel. </p><br><p>  Adicione uma div que seja respons√°vel pela sombra. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"b-vertical-carousel-slider"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-wrapper"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-item"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical-carousel-slider-shadow"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  N√≥s estilizamos e adicionamos anima√ß√µes. </p><br><pre> <code class="plaintext hljs">@keyframes shadowAnimation { 0% { opacity: 1; } 80% { opacity: 1; } 90% { opacity: 0; } 100% { opacity: 1; } } .vertical-carousel-slider-shadow { top: $itemHeight; left: 0; right: 0; height: $itemHeight; animation: $stepDuration shadowAnimation ease infinite; }</code> </pre> <br><p>  Nesse caso, voc√™ n√£o precisa gerar e pensar em uma maneira de animar a sombra sob cada elemento, apenas animamos um bloco, ele possui dois estados - √© vis√≠vel e oculto </p><br><p>  Como resultado, temos um carrossel CSS puro que anima com apenas propriedades bem otimizadas.  Isso permite que o navegador use a acelera√ß√£o de hardware para renderiza√ß√£o.  Da√≠ o lucro tang√≠vel comparado √† anima√ß√£o JS: </p><br><ol><li>  Ao rolar p√°ginas com anima√ß√µes em dispositivos fracos, os quadros eram claramente ignorados nas anima√ß√µes JS, reduzindo o FPS para 15-20.  As anima√ß√µes CSS melhoraram claramente as coisas.  Nesses dispositivos, esse n√∫mero era de pelo menos 50-55 FPS. </li><li>  Nos livramos do trabalho de um m√≥dulo de terceiros onde n√£o era necess√°rio. </li><li>  A anima√ß√£o ser√° reproduzida mesmo quando o JS estiver desativado </li></ol><br><p>  A anima√ß√£o JS deve ser usada se for necess√°rio um controle rigoroso sobre cada quadro: pausa, reprodu√ß√£o reversa, retrocesso, rea√ß√£o √†s a√ß√µes do usu√°rio.  Em outros casos, recomendamos o uso de CSS puro. </p><br><p>  <strong>Links √∫teis</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia de anima√ß√£o de desfoque</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia de propriedades CSS e tarefas do navegador</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia de anima√ß√£o de sombras</a> </li></ul><br><h2 id="2-ispolzovanie-intersection-observer-api">  2. Usando a API Intersection Observer </h2><br><p>  <strong>A anima√ß√£o que o visitante do site n√£o v√™ √© reproduzida em algum lugar fora da vista e carrega a CPU.</strong>  <strong>Usando o Intersection Observer, determinamos que tipo de anima√ß√£o est√° vis√≠vel na tela no momento e apenas a reproduzimos.</strong> </p><br><p>  Todos os truques do √∫ltimo par√°grafo podem ser combinados com o Intersection Observer.  Essa ferramenta ajuda a n√£o carregar o navegador com anima√ß√£o que o visitante do site n√£o v√™.  Anteriormente, ‚Äúouvintes‚Äù de eventos com uso intensivo de recursos eram usados ‚Äã‚Äãpara entender se um visitante estava olhando para um elemento animado e isso n√£o produzia um ‚Äúescape‚Äù forte.  A diferen√ßa entre usar anima√ß√£o fora da janela de exibi√ß√£o e usar ouvintes era m√≠nima.  A API do Intersection Observer requer menos recursos e ajuda a reproduzir apenas a anima√ß√£o que √© vis√≠vel para o visitante. </p><br><p>  No nosso site, a anima√ß√£o √© ativada apenas quando um elemento aparece na janela de exibi√ß√£o.  Se n√£o o fiz√©ssemos, as p√°ginas seriam sobrecarregadas com a execu√ß√£o constante de anima√ß√µes em loop que permaneciam fora da vista.  A API Intersection Observer permite monitorar a interse√ß√£o do elemento com o pai ou com o escopo do documento. </p><br><p>  <strong>Exemplo de implementa√ß√£o</strong> </p><br><p>  Como exemplo, mostramos como otimizar a anima√ß√£o em JS.  A id√©ia √© simples - a anima√ß√£o √© reproduzida enquanto o elemento animado est√° na janela de exibi√ß√£o.  Para implementa√ß√£o, usamos a API Intersection Observer. </p><br><p>  Adicionar manipula√ß√£o de classe com <code>is-paused</code> aos estilos </p><br><pre> <code class="plaintext hljs">.b-vertical-carousel-slider.is-paused { .vertical-carousel-slider-wrapper { .vertical-carousel-slider-item { animation-play-state: paused; } } .vertical-carousel-slider-shadow { animation-play-state: paused; } }</code> </pre> <br><p>  I.e.  quando essa classe aparecer, a anima√ß√£o ser√° pausada. </p><br><p>  Agora descrevemos a l√≥gica de adicionar e remover esta classe </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.IntersectionObserver) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> el = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'.b-vertical-carousel-slider'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> observer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntersectionObserver(intersectionObserverCallback); observer.observe(el); }</code> </pre> <br><p>  Aqui, criamos uma inst√¢ncia de IntersectionObserver, especificada a fun√ß√£o <code>intersectionObserverCallback</code> , que funcionar√° quando a visibilidade for alterada. </p><br><p>  Agora defina <code>intersectionObserverCallback</code> </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">intersectionObserverCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entries</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entries[<span class="hljs-number"><span class="hljs-number">0</span></span>].intersectionRatio === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } helperDOM.toggleClass(el, <span class="hljs-string"><span class="hljs-string">'is-paused'</span></span>, entries[<span class="hljs-number"><span class="hljs-number">0</span></span>].intersectionRatio &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>); };</code> </pre> <br><p>  Agora a anima√ß√£o √© reproduzida apenas nos elementos vis√≠veis.  Assim que o elemento desaparece do campo de vis√£o, a anima√ß√£o √© pausada.  Quando o visitante retornar a ele, a reprodu√ß√£o continuar√°. </p><br><p>  <strong>Links √∫teis</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Navegadores que suportam o Intersection Observer</a> </li><li>  Para navegadores que n√£o suportam, voc√™ precisa usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">polyfil</a> </li></ul><br><h2 id="3-rendering-svg">  3. renderiza√ß√£o SVG </h2><br><p>  <strong>Um grande n√∫mero de imagens ou o uso de sprites causa frisos e atrasos nos primeiros segundos ap√≥s o carregamento.</strong>  <strong>A incorpora√ß√£o de SVG no c√≥digo da p√°gina ajuda a tornar visualmente o carregamento mais suave.</strong> </p><br><p>  Quando selecionamos m√©todos para trabalhar com imagens, t√≠nhamos duas op√ß√µes de otimiza√ß√£o: incorporar SVG em HTML ou usar sprites.  N√≥s decidimos incorporar.  Incorporamos o c√≥digo XML de cada imagem diretamente no c√≥digo HTML das p√°ginas.  Isso aumenta um pouco o tamanho, mas o SVG √© servido imediatamente em linha com o documento. </p><br><p>  Muitos desenvolvedores continuam usando sprites SVG.  Qual √© a ess√™ncia do m√©todo: uma matriz de imagens (por exemplo, √≠cones) √© coletada em uma tela de imagem grande, chamada de sprite.  Quando voc√™ precisa mostrar um √≠cone espec√≠fico, um sprite √© chamado, ap√≥s o qual s√£o dadas as coordenadas da pe√ßa espec√≠fica em que est√° localizado.  Isso √© feito h√° muito tempo, mesmo na primeira vers√£o do HTTP.  Sprites ajudaram a armazenar em cache agressivamente o arquivo e reduzir o n√∫mero de solicita√ß√µes do servidor.  Isso foi importante porque muitos pedidos simult√¢neos desaceleraram o navegador.  O uso de sprites SVG √© uma muleta t√≠pica com a qual voc√™ negligencia a l√≥gica de trabalhar para economizar recursos.  Agora, o n√∫mero de solicita√ß√µes n√£o √© t√£o importante, por isso recomendamos a incorpora√ß√£o. </p><br><p>  Antes de tudo, afeta positivamente o desempenho do ponto de vista do visitante.  Ele v√™ como os √≠cones carregam instantaneamente e n√£o sofre os primeiros segundos ap√≥s o carregamento da p√°gina.  Ao usar imagens sprite ou PNG, a p√°gina que est√° sendo carregada diminui um pouco.  Isso √© especialmente sentido se o visitante rolar imediatamente a p√°gina carregada - o FPS cair√° para 5-15 em dispositivos n√£o superiores.  A incorpora√ß√£o de SVG em HTML ajuda a reduzir a lat√™ncia da p√°gina (subjetiva, do ponto de vista do cliente) e a se livrar de frisos e pulos de quadros durante o carregamento. </p><br><h2 id="4-keshirovanie-s-ispolzovaniem-service-worker-i-http-cache">  4. Armazenamento em cache usando o Service Worker e o cache HTTP </h2><br><p>  <strong>N√£o faz sentido recarregar uma p√°gina que n√£o tenha sido alterada e usar o tr√°fego de visitantes.</strong>  <strong>Existem muitas estrat√©gias de cache, decidimos pela combina√ß√£o mais eficiente.</strong> </p><br><p>  Otimizar √© o uso n√£o apenas da CPU / GPU, mas tamb√©m da rede.  Os dispositivos m√≥veis s√£o uma limita√ß√£o n√£o apenas em termos de recursos, mas tamb√©m em termos de velocidade e tr√°fego da Internet.  O cache nos ajudou aqui.  Ele permite salvar respostas √†s solicita√ß√µes HTTP e us√°-las sem receber uma resposta do servidor novamente. </p><br><p>  Quando consideramos uma estrat√©gia de armazenamento em cache, optamos por usar o Service Worker e o HTTP Cache ao mesmo tempo.  Vamos come√ßar com o primeiro e mais avan√ßado.  O Service Worker √© um arquivo js que pode controlar sua p√°gina ou arquivo, interceptar e modificar solicita√ß√µes, al√©m de armazenar em cache programaticamente solicita√ß√µes.  Ele atua como um proxy entre o site e o servidor e determina seu comportamento offline.  Tudo isso √© feito na "frente", sem conectar um "back-end". </p><br><p>  O Operador de Servi√ßo tem uma tremenda variabilidade.  Podemos programar o comportamento como quisermos.  Por exemplo, sabemos que um visitante que foi para a p√°gina n√∫mero 1, com uma probabilidade de 90%, ir√° para a p√°gina n√∫mero 2.  Pedimos ao SW para carregar a segunda p√°gina com o segundo plano quando o visitante ainda estiver na primeira.  Quando ele acessa, a p√°gina carrega instantaneamente.  Pode ser usado para diferentes tarefas: </p><br><ul><li>  Sincroniza√ß√£o de dados em segundo plano </li><li>  Calculadoras offline </li><li>  Modelo personalizado </li><li>  Rea√ß√£o a uma hora e data espec√≠ficas. </li></ul><br><p>  Os arquivos do Service Worker podem ser criados em diferentes servi√ßos.  Recomendamos a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">caixa de trabalho</a> .  √â bastante simples e permite criar um conjunto de regras pelas quais o armazenamento em cache √© realizado, por exemplo, precache. </p><br><p>  Os funcion√°rios do servi√ßo n√£o oferecem suporte a todos os navegadores, como IE, Safari ou Chrome, anteriores √† vers√£o 40.0.  Se o dispositivo n√£o puder trabalhar com ele, seguir√° as regras de cache do cache HTTP.  Adicionamos os seguintes cabe√ßalhos HTTP √†s p√°ginas: </p><br><pre> <code class="plaintext hljs">cache-control: no-cache last-modified: Mon, 06 May 2019 04:26:29 GMT</code> </pre> <br><p>  Nesse caso, o navegador adiciona respostas √†s solicita√ß√µes ao reposit√≥rio, mas a cada solicita√ß√£o subsequente envia um cabe√ßalho para verificar se h√° altera√ß√µes. </p><br><pre> <code class="plaintext hljs">if-modified-since: Mon, 06 May 2019 04:26:29 GMT</code> </pre> <br><p>  Caso n√£o ocorram altera√ß√µes, o navegador recebe uma resposta com o c√≥digo 304 N√£o modificado e usa o conte√∫do armazenado no cache.  Se forem feitas altera√ß√µes no documento, a resposta ser√° retornada com o c√≥digo 200 e uma nova resposta ser√° gravada no armazenamento do navegador. </p><br><p>  Um pouco mais tarde, alteramos o m√©todo de armazenamento em cache e verificamos a quantidade de hash no nome do arquivo.  Ele garante que o recurso permane√ßa exclusivo.  Portanto, poder√≠amos armazenar em cache agressivamente o conte√∫do.  O seguinte cabe√ßalho foi adicionado em resposta: </p><br><pre> <code class="plaintext hljs">Cache-control:max-age=31536000, immutable</code> </pre> <br><p>  A idade m√°xima indica o tempo m√°ximo de armazenamento em cache, no nosso caso, √© de 1 ano.  Um valor imut√°vel significa que essa resposta n√£o precisa ser verificada quanto a altera√ß√µes. </p><br><p>  <strong>Links √∫teis</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/">Manual de Cache HTTP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia de uso da API do Service Worker</a> </li></ul><br><p>  Essas n√£o s√£o todas as maneiras de otimizar o site.  Isso poderia adicionar uma rejei√ß√£o ao bootstrap, reduzindo o n√∫mero de elementos e eventos do DOM e muito mais.  Mas essas s√£o as dicas que nos ajudaram a tornar o site r√°pido e responsivo, apesar da grande quantidade de anima√ß√£o. </p><br><h3 id="priglashaem-v-nashu-komandu">  Convidamos voc√™ para nossa equipe </h3><br><p>  Estamos sempre procurando especialistas legais em nosso escrit√≥rio em S√£o Petersburgo para nossas tarefas ambiciosas: desenvolvedores, testadores, designers.  Abaixo h√° vagas - junte-se a n√≥s. </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Desenvolvedor Frontend</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Engenheiro de controle de qualidade</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Engenheiro de desenvolvimento de software em teste</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt455700/">https://habr.com/ru/post/pt455700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt455686/index.html">Como escolher a melhor ferramenta de gerenciamento de projetos se voc√™ √© milenar?</a></li>
<li><a href="../pt455692/index.html">ASZP: restyling ou teatro come√ßa com um cabide</a></li>
<li><a href="../pt455694/index.html">Arquitetura de cobran√ßa de pr√≥xima gera√ß√£o: transi√ß√£o para Tarantool</a></li>
<li><a href="../pt455696/index.html">O estado eletr√¥nico do futuro. Parte 2</a></li>
<li><a href="../pt455698/index.html">O livro "Como funciona o JavaScript"</a></li>
<li><a href="../pt455702/index.html">Gera√ß√£o efetiva de n√∫meros em um determinado intervalo</a></li>
<li><a href="../pt455710/index.html">Por que n√≥s da Leroy Merlin precisamos de nosso pr√≥prio departamento de desenvolvimento russo para 200 pessoas</a></li>
<li><a href="../pt455714/index.html">Exporte automaticamente o Google Forms para o Notion usando IFTTT e Django</a></li>
<li><a href="../pt455716/index.html">15 pr√°ticas recomendadas para implantar o software de Business Intelligence</a></li>
<li><a href="../pt455720/index.html">Como criamos interface do usu√°rio para sistemas de an√∫ncios</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>