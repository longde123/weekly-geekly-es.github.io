<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☪️ 🍿 👩🏾‍🔬 Doppel-VPN mit einem Klick. So teilen Sie einfach die IP-Adresse eines Ein- und Ausstiegspunkts 👩🏻‍🍳 🏁 👩‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR In diesem Artikel wird der einfachste Weg zum Konfigurieren eines VPN-Servers beschrieben, dessen IP-Adresse zum Verbinden von VPN-Clients sich...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Doppel-VPN mit einem Klick. So teilen Sie einfach die IP-Adresse eines Ein- und Ausstiegspunkts</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/469879/"><img src="https://habrastorage.org/webt/gu/ux/_r/guux_rw3bw9b6_0h617yyow4xrq.png"><br><br>  <b>TL; DR In</b> <i>diesem Artikel wird der einfachste Weg zum Konfigurieren eines VPN-Servers beschrieben, dessen IP-Adresse zum Verbinden von VPN-Clients sich von der IP-Adresse unterscheidet, von der aus Clients auf das Internet zugreifen.</i> <br><br>  Verwenden Sie ein VPN, um die Privatsphäre im Internet zu schützen, und mieten Sie dafür Ihren eigenen Server?  Sind Sie der einzige Client, der weltweit eine Verbindung zu diesem Server herstellt?  Ist es so schwer, deine echte IP-Adresse zu finden?  Mit dem Inkrafttreten des Federpakets wird es viel einfacher. <br><br>  <b>Double VPN</b> ist ein beliebtes Thema, über das viel spekuliert wird.  Oft wird dieser Begriff als völlig andere Technologie bezeichnet, aber fast immer bedeutet er Internetverbindung und Austrittspunkte, die auf der Ebene der IP-Adressen voneinander getrennt sind.  Wir werden den einfachsten Weg in Betracht ziehen, einen VPN-Server in diesem Modus zu konfigurieren, der keine zusätzliche Konfiguration auf der Serverseite erfordert und es Ihnen ermöglicht, die maximale Geschwindigkeit und die niedrigste Latenz zu erreichen. <br><a name="habracut"></a><br><h2>  Bedrohungsmodell </h2><br>  Um sich vor etwas zu schützen, müssen Sie das Bedrohungsmodell klar verstehen.  Wir werden nicht über neue Gesetze sprechen, nach denen Anbieter den gesamten Kundenverkehr speichern müssen, aber wir können definitiv sagen, dass es sich um Verbindungsdaten handelt, die sogenannten  Netflow, Speicherung ist recht einfach und wird schon lange durchgeführt.  Das heißt, die Tatsache, dass zu einer bestimmten Tageszeit eine bedingte IP-Adresse <b><code>1.1.1.1</code></b> mit der Adresse <b><code>2.2.2.2</code></b> wird, wird aufgezeichnet. <br><br>  Wenn Sie auf der Grundlage des Anbieters, der Stadt oder des Landes auf solche Informationen zugreifen können, müssen Sie lediglich feststellen, wer sich hinter dem VPN versteckt. <br><br>  Um die Privatsphäre bei Verwendung eines VPN zu erhöhen, müssen Sie den Verbindungspunkt und den Internetzugangspunkt auf IP-Ebene trennen.  Im Bild oben befindet sich unser Benutzer hinter dem Zaun unter der Kontrolle von Irina Yarovoy.  Irina erinnert sich streng an alle Verbindungen, die durch den Zaun verlaufen.  Der Benutzer stellt als anständiger Bürger eine Verbindung zur Adresse <b><code>good.citizen.vpn</code></b> , während er von der Adresse <b><code>super.cool.guy.vpn</code></b> .  Für Irina sehen diese beiden Verbindungen daher nicht miteinander verbunden aus. <br><br><h2>  Was sind duale VPNs? </h2><br>  Unter dem Namen "doppeltes" VPN werden oft verschiedene Dinge verstanden, aber fast immer bedeutet dies Knoten der Verbindung und des Zugangs zum Internet, die geografisch oder auf Netzwerkebene voneinander getrennt sind.  Manchmal ist es nur ein Marketing-Trick von VPN-Anbietern, was absolut nichts bedeutet. Solche Dienste können als "dreifache" und "vierfache" VPNs bezeichnet werden. <br><br>  Wir werden die typischsten Schemata analysieren, die in der Praxis verwendet werden. <br><br><h3>  VPN zwischen Servern </h3><br>  Der häufigste Weg.  In diesem Modus stellt der Client nur eine VPN-Verbindung zum ersten Server her.  Der Tunnel zum zweiten Server wird auf dem ersten Server konfiguriert, und der gesamte Datenverkehr vom Client geht zum zweiten Server usw.  Es können mehrere Zwischenserver vorhanden sein.  In diesem Fall kann der Tunnel zwischen den Servern mit einem anderen Protokoll als dem Protokoll installiert werden, über das der Client verbunden ist, z. B. IPsec, oder ohne Verschlüsselung, z. B. GRE oder IPIP.  In diesem Modus werden alle Zwischenserver <b>in der Routenverfolgung angezeigt</b> .  Es gibt keine Möglichkeit, genau zu überprüfen, wie die Zwischenserver auf der Clientseite verbunden sind, sodass Sie nur dem Anbieter vertrauen können. <br><br>  Während der gesamten Verkehrsroute bleibt die minimale MTU (Maximum Transmission Unit) gleich dem Wert des allerersten Tunnels, und jeder Zwischenserver <b>hat Zugriff auf entschlüsselten Clientverkehr</b> . <br><br><img src="https://habrastorage.org/webt/-f/k8/0p/-fk80pf8rdttoxn4tbpu7qcnopi.png"><br><br><h3>  VPN über Proxy </h3><br>  Auch ein ziemlich üblicher Weg.  Wird häufig verwendet, um den VPN-Verkehr unter einem anderen Protokoll zu maskieren, beispielsweise in China.  Diese Methode ist bequemer als eine Kette von Proxys, da mit einem VPN der gesamte Systemverkehr einfach zum Tunnel geleitet werden kann.  Es gibt auch Tools zum Abfangen von Systemaufrufen von Programmen und zum Umleiten an Proxys: ProxyCap, Proxifier. Sie sind jedoch weniger stabil, da sie manchmal Anforderungen verpassen und den Proxy umgehen oder mit einigen Programmen falsch arbeiten. <br><br>  In diesem Modus ist der Proxyserver in der Routenverfolgung nicht sichtbar. <br><br><img src="https://habrastorage.org/webt/hd/uf/ar/hdufardfsfqecwuasklqamx_fzw.png"><br><br><h3>  VPN innerhalb von VPN </h3><br>  Der paranoideste und langsamste Weg: Alle Tunnel erheben sich auf der Client-Seite, wobei sich beide ineinander befinden.  Diese Methode erfordert eine raffinierte Konfiguration der Routen auf der Clientseite und den Start aller VPN-Clients in der richtigen Reihenfolge.  Dies ist schlecht für Latenz und Leistung, aber Zwischenserver haben keinen Zugriff auf den offenen Datenverkehr des Clients.  Alle Kapselungskosten werden zusammengefasst, und die maximale Paketgröße (MTU), die dem Client letztendlich zur Verfügung steht, nimmt abhängig von der Anzahl der Tunnel ab.  Zwischenserver sind in der Routenverfolgung nicht sichtbar. <br><br><img src="https://habrastorage.org/webt/1f/bc/_d/1fbc_dpm24jxomg-gtt-t4xhouu.png"><br><br><h2>  Konfigurieren Sie VDS </h2><br>  Der einfachste Weg, ein VPN mit geteilten Ein- und Ausstiegspunkten einzurichten, besteht darin, mehrere IP-Adressen mit einem einzigen virtuellen Server zu verbinden.  Mit dieser Methode können Sie maximale Geschwindigkeit und minimale Verzögerungen erzielen, da der Datenverkehr tatsächlich auf einem einzelnen Server beendet wird.  Bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vdsina.ru</a> können Sie dies selbst über das Bedienfeld tun.  Während IPv4 überall endet, geben wir zusätzliche IP-Adressen auch auf Servern für 60 Rubel aus! <br><br>  Wir werden die Serverkonfiguration Schritt für Schritt analysieren. <br><br><h3>  Wählen Sie einen Server </h3><br>  Wir bestellen VDS mit einem geeigneten Tarif im erforderlichen Rechenzentrum.  Aufgrund unserer Aufgabe werden wir ein weiter entferntes Rechenzentrum in den Niederlanden auswählen;) <br><br><img src="https://habrastorage.org/webt/xf/jv/nt/xfjvntqtokkir7sgkqlzcctlgyq.png"><br><br><h3>  Verbinden Sie eine zusätzliche IP-Adresse </h3><br>  Nach dem Kauf einer zusätzlichen IP-Adresse müssen Sie diese <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gemäß den Anweisungen</a> konfigurieren. <br><br><img src="https://habrastorage.org/webt/um/er/ot/umerotsqubrxdreezekpld2jzyi.png"><br><br>  Weisen Sie der Übersichtlichkeit halber IP einen PTR-Datensatz zu.  Dies ist der Domänenname, der angezeigt wird, wenn die IP-Adresse wieder in eine Domäne konvertiert wird.  Dies kann ein beliebiger Wert sein, einschließlich einer nicht vorhandenen Domäne. <br><br>  Als Beispiele verwenden wir die folgenden Werte: <br><br><pre> <code class="bash hljs">xxx.xxx.38.220 — super.cool.guy.vpn <span class="hljs-comment"><span class="hljs-comment">#   ( ) xxx.xxx.39.154 — good.citizen.vpn #   ( )</span></span></code> </pre><br><img width="400" src="https://habrastorage.org/webt/mz/oh/uj/mzohujvwi-8-ahlpeuuaduo1rie.png"><br><br><h2>  Zwei IP-Überprüfungen </h2><br>  Es ist wichtig zu beachten, dass die IP-Adresse, die ursprünglich auf dem Server festgelegt wurde, der Austrittspunkt ist, sodass die neue Adresse der Einstiegspunkt ist.  Stellen Sie über SSH eine Verbindung zum Server her und überprüfen Sie, welche Adresse als externe Adresse verwendet wird. <br><br>  Zu diesem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zweck</a> ist es am einfachsten, den Dienst <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ifconfig.co</a> über die Konsole zu verwenden.  Bei der Anforderung über Curl wird die IP-Adresse zurückgegeben, von der die Anforderung gestellt wurde. <br><br><pre> <code class="bash hljs">$ curl ifconfig.co xxx.xxx.38.220</code> </pre><br>  Die letzten Zahlen zeigen, dass unsere externe Adresse wirklich mit dem Austrittspunkt übereinstimmt.  Versuchen wir, den korrekten Betrieb der zweiten IP als Einstiegspunkt zu überprüfen.  Verwenden Sie dazu einfach die in SSH integrierte SOCKS-Proxy-Funktion. <br><br>  Befehle werden auf dem Client ausgeführt: <br><br><pre> <code class="bash hljs">ssh -D 9999 root@good.citizen.vpn <span class="hljs-comment"><span class="hljs-comment">#    curl -x socks5h://127.0.0.1:9999 ifconfig.co super.cool.guy.vpn</span></span></code> </pre><br>  Der erste Befehl richtet eine SSH-Sitzung mit der Adresse good.citizen.vpn ein und aktiviert gleichzeitig einen SOCKS-Proxy innerhalb dieser Sitzung, der am lokalen Port verfügbar ist.  Der zweite macht eine normale HTTP-Anfrage über diesen Proxy. <br><blockquote>  Es ist wichtig, sich daran zu erinnern, dass unsere Beispiele fiktive Domainnamen für Abfragen verwenden.  Sie werden nur mit einer PTR-Auflösung angezeigt, und eine vollständige Anfrage an sie kann nicht gestellt werden.  Daher müssen Sie zu diesem Zeitpunkt über die IP-Adresse auf den Server zugreifen. </blockquote><h2>  IKEv2-Serverkonfiguration </h2><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/gg/tv/jr/ggtvjr7iq-tknhzeiv-3cdogqw0.png"></div><br><br>  IPsec IKEv2 ist ein modernes VPN-Protokoll, das von fast allen Betriebssystemen sofort unterstützt wird.  Es wird als Standardprotokoll in Windows, MacOS und iOS verwendet.  Gleichzeitig ist keine Installation von Software von Drittanbietern erforderlich und funktioniert in den meisten Fällen schneller als OpenVPN.  Es gab bereits <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel zum Einrichten des IKEv2-Servers auf dem Hub</a> , aber alle beschreiben die Verwendung selbstsignierter Zertifikate und sind insofern unpraktisch, als Sie das Stammzertifikat auf der Seite des VPN-Clients installieren müssen. <br><br>  Wir werden ein Beispiel für die Serverkonfiguration mithilfe eines vertrauenswürdigen Zertifikats von Let's Encrypt analysieren.  Auf diese Weise können Sie keine externen Stammzertifikate für den Client installieren, sondern nur einen Benutzernamen und ein Kennwort eingeben. <br><br><h3>  Servervorbereitung </h3><br>  Wir werden einen Server verwenden, der auf Ubuntu 18.04 basiert, aber die Anweisung ist auch für die meisten modernen Distributionen geeignet. <br><br>  Wir aktualisieren das System und installieren die erforderlichen Pakete <br><br><pre> <code class="plaintext hljs">apt update &amp;&amp; apt upgrade apt install certbot strongswan libstrongswan-extra-plugins</code> </pre><br><h3>  Zertifikatausstellung </h3><br>  Um ein vertrauenswürdiges Zertifikat auszustellen, müssen Sie die reale Domäne an die IP-Adresse des Einstiegspunkts weiterleiten.  Wir werden diesen Artikel nicht im Detail betrachten, da er den Rahmen des Artikels sprengt.  Als Beispiel verwenden wir die fiktive Domain <b>good.citizen.vpn</b> <br><br>  Wenn Sie bereits einen Webserver auf dem Server haben, verwenden Sie die entsprechende Methode zum Ausstellen des Zertifikats über certbot oder einen anderen Client für Let's Encrypt.  In diesem Beispiel wird davon ausgegangen, dass der HTTP-Port (80) nicht belegt ist. <br><br><pre> <code class="bash hljs">certbot certonly --standalone --agree-tos -d good.citizen.vpn</code> </pre><br>  Beantwortung der Fragen des Assistenten?  Wir erhalten ein unterschriebenes Zertifikat und einen Schlüssel <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># find /etc/letsencrypt/live/good.citizen.vpn/ /etc/letsencrypt/live/good.citizen.vpn/ /etc/letsencrypt/live/good.citizen.vpn/fullchain.pem /etc/letsencrypt/live/good.citizen.vpn/README /etc/letsencrypt/live/good.citizen.vpn/cert.pem /etc/letsencrypt/live/good.citizen.vpn/privkey.pem /etc/letsencrypt/live/good.citizen.vpn/chain.pem</span></span></code> </pre><br>  Für die IKEv2-Serverauthentifizierung werden dieselben X.509-Zertifikate wie für verwendet <br>  Https  Damit Strongswan diese Zertifikate verwenden kann, müssen sie in den Ordner /etc/ipsec.d kopiert werden. <br><br>  So sollten sich die Zertifikate befinden: <br><br><pre> <code class="plaintext hljs">cp /etc/letsencrypt/live/good.citizen.vpn/cert.pem /etc/ipsec.d/certs/ cp /etc/letsencrypt/live/good.citizen.vpn/privkey.pem /etc/ipsec.d/private/ cp /etc/letsencrypt/live/good.citizen.vpn/chain.pem /etc/ipsec.d/cacerts/</code> </pre><br>  Da letsencrypt-Zertifikate häufig neu ausgestellt werden, ist es unpraktisch, dies manuell zu tun.  Daher automatisieren wir diesen Prozess mithilfe des Hooks für certbot. <br><br>  Die Aufgabe des Skripts besteht darin, bei jeder Aktualisierung des Zertifikats drei Dateien in den gewünschten Ordner zu kopieren und dann den Befehl strongswan zu senden, um die Zertifikate erneut zu lesen. <br><br>  Erstellen Sie die Datei <b>/etc/letsencrypt/renewal-hooks/deploy/renew-copy.sh</b> und machen Sie sie ausführbar. <br><br><pre> <code class="plaintext hljs">#!/bin/sh set -e for domain in $RENEWED_DOMAINS; do case $domain in good.citizen.vpn) daemon_cert_root=/etc/ipsec.d/ # Make sure the certificate and private key files are # never world readable, even just for an instant while # we're copying them into daemon_cert_root. umask 077 cp "$RENEWED_LINEAGE/cert.pem" "$daemon_cert_root/certs/" cp "$RENEWED_LINEAGE/chain.pem" "$daemon_cert_root/cacerts/" cp "$RENEWED_LINEAGE/privkey.pem" "$daemon_cert_root/private/" # Reread certificates /usr/sbin/ipsec reload /usr/sbin/ipsec purgecerts /usr/sbin/ipsec rereadall ;; esac done</code> </pre><br>  Nach jeder erneuten Ausstellung des Zertifikats kopiert das Skript die neuen Dateien in die strongswan-Ordner und sendet einen Befehl an den Dämon, um die Zertifikate erneut zu lesen. <br><br><h3>  Strongswan Setup </h3><br>  Fügen Sie die Konfiguration strongswan /etc/ipsec.conf hinzu <br><br><pre> <code class="bash hljs">config setup <span class="hljs-comment"><span class="hljs-comment">#       uniqueids=no # Increase debug level # charondebug = ike 3, cfg 3 conn %default #       ike=aes256-sha256-modp1024,aes256-sha256-modp2048 #  ""  dpdaction=clear dpddelay=35s dpdtimeout=2000s keyexchange=ikev2 auto=add rekey=no reauth=no fragmentation=yes #compress=yes # left - local (server) side leftcert=cert.pem #      /etc/ipsec.d/certs/ leftsendcert=always #    leftsubnet=0.0.0.0/0 # right - remote (client) side eap_identity=%identity #   IP-  VPN- rightsourceip=10.0.1.0/24 rightdns=8.8.8.8,1.1.1.1 # Windows and BlackBerry clients usually goes here conn ikev2-mschapv2 rightauth=eap-mschapv2 # Apple clients usually goes here conn ikev2-mschapv2-apple rightauth=eap-mschapv2 leftid=good.citizen.vpn</span></span></code> </pre><br>  Anmeldungen und Kennwörter von VPN-Clients werden in der Datei <b>/etc/ipsec.secrets festgelegt</b> <br><br>  In dieser Datei müssen Sie auch den Namen des privaten Schlüssels angeben, den wir zuvor aus dem Ordner letsencrypt kopiert haben: <br><br><pre> <code class="plaintext hljs">#       /etc/ipsec.d/private/ : RSA privkey.pem #  VPN #  : EAP "" IrinaYarovaya : EAP "PleaseLoveMe123" Mizooleena : EAP "IwannaLoveToo3332"</code> </pre><br>  In diesem Stadium können Sie den strongswan-Server neu starten und prüfen, ob die neue Konfiguration aktiviert wurde: <br><br><pre> <code class="plaintext hljs">$ systemctl restart strongswan $ ipsec statusall Virtual IP pools (size/online/offline): 10.0.1.0/24: 254/0/0 Listening IP addresses: xxx.xxx.38.220 Connections: ikev2-mschapv2: %any...%any IKEv2, dpddelay=35s ikev2-mschapv2: local: [CN=good.citizen.vpn] uses public key authentication ikev2-mschapv2: cert: "CN=good.citizen.vpn" ikev2-mschapv2: remote: uses EAP_MSCHAPV2 authentication with EAP identity '%any' ikev2-mschapv2: child: 0.0.0.0/0 === dynamic TUNNEL, dpdaction=clear ikev2-mschapv2-apple: %any...%any IKEv2, dpddelay=35s ikev2-mschapv2-apple: local: [good.citizen.vpn] uses public key authentication ikev2-mschapv2-apple: cert: "CN=good.citizen.vpn" ikev2-mschapv2-apple: remote: uses EAP_MSCHAPV2 authentication with EAP identity '%any' ikev2-mschapv2-apple: child: 0.0.0.0/0 === dynamic TUNNEL, dpdaction=clear</code> </pre><br>  Sie können sehen, dass die Konfiguration erfolgreich aktiviert und das Zertifikat verbunden wurde.  Zu diesem Zeitpunkt können Sie bereits eine Verbindung zum VPN-Server herstellen, jedoch ohne Internetzugang.  Um Clients im Internet freizugeben, müssen Sie die Weiterleitung aktivieren und NAT konfigurieren. <br><br><h3>  NAT-Setup </h3><br>  Wir aktivieren Weiterleitungspakete: <br><br><pre> <code class="plaintext hljs">echo "net.ipv4.ip_forward=1" &gt;&gt; /etc/sysctl.conf sysctl -p</code> </pre><br>  Schalten Sie NAT ein.  Es ist wichtig zu beachten, dass dies nur ein Beispiel für eine minimale Konfiguration von iptables ist.  Passen Sie den Rest der Regeln an Ihre Bedürfnisse an. <br><br>  <b>ethName0</b> - durch Ihren Schnittstellennamen ersetzen <br>  <b>10.0.1.0/24</b> - Der Bereich der IP-Adressen, die an VPN-Clients ausgegeben werden.  Wir haben es in <b>/etc/ipsec.conf gefragt</b> <br>  <b>111.111.111.111</b> - die IP-Adresse des Exit-Punkts, in unserem Beispiel die Adresse super.cool.guy.vpn <br><br><pre> <code class="plaintext hljs">iptables -t nat -A POSTROUTING -s 10.0.1.0/24 -o ethName0 -j SNAT --to-source 111.111.111.111</code> </pre><br><h3>  Debuggen </h3><br>  In dieser Phase der Konfiguration sollten wir einen voll funktionsfähigen Server erhalten, zu dem Clients bereits eine Verbindung herstellen können.  Bevor Sie fortfahren, sollten Sie dies überprüfen, indem Sie die Verbindung überprüfen. <br><br>  Bei Verbindungsproblemen können Sie das Protokoll in Echtzeit anzeigen: <br><br><pre> <code class="plaintext hljs">journalctl -f -u strongswan</code> </pre><br><h3>  Start beim Start </h3><br>  Wenn alles erfolgreich ist, können Sie beim Start beim Start strongswan hinzufügen: <br><br><pre> <code class="plaintext hljs">systemctl enable strongswan</code> </pre><br><h3>  Iptables-Regeln speichern </h3><br>  Um die iptables-Regeln nach dem Neustart zu speichern, gibt es ein spezielles <b>iptables-persistentes</b> Paket.  Es ist wichtig zu beachten, dass die aktuellen Regeln gespeichert und zum Start hinzugefügt werden. <br><br><pre> <code class="plaintext hljs">apt install iptables-persistent</code> </pre><br><h2>  Kundeneinrichtung </h2><br>  Das Einrichten auf der Clientseite ist äußerst einfach. Teilen Sie dem Client einfach die Serveradresse, den Benutzernamen und das Kennwort mit.  Für macOS und iOS können Sie Autokonfigurationsprofile erstellen, die ausreichen, um mit zwei Klicks aktiviert zu werden. <br><br><div class="spoiler">  <b class="spoiler_title">Windows-Setup</b> <div class="spoiler_text">  In neuen Windows-Versionen wird IKEv2 in einem einfachen Assistenten konfiguriert, auf den über das WiFi-Verbindungsmenü zugegriffen werden kann. <br><br><img src="https://habrastorage.org/webt/mu/hq/_r/muhq_rn7iubyixxxsislcmmqvzm.png"><br><br>  Windows legt keine Standardroute für eine solche Verbindung fest, daher werden wir sie manuell installieren.  Wechseln Sie in den Eigenschaften der VPN-Verbindung zusätzlich zu den Eigenschaften von TCP / IPv4 -&gt; und aktivieren Sie das Kontrollkästchen "Gateway in einem Remote-Netzwerk verwenden". <br><br> <a href=""><img src="https://habrastorage.org/webt/ra/c5/_x/rac5_xi76rjiuadeswi3e1m8rug.png"></a> <br>  <sup>anklickbar</sup> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">MacOS-Setup</b> <div class="spoiler_text">  MacOS unterstützt IKEv2 ab Version 10.11 (El Capitan).  Die Verbindung wird über das Menü Netzwerkeinstellungen hergestellt. <br><br><img src="https://habrastorage.org/webt/f4/ad/hk/f4adhkw9swpneyfo0jn9jgro9s4.png" alt="Bild"><br><br>  Fügen Sie eine neue Verbindung hinzu.  Der Name der Verbindung ist ein beliebiger Name. <br><br><img src="https://habrastorage.org/webt/xc/ng/zq/xcngzqon0ilejqrl7hqla-8vbf4.png" alt="Bild"><br><br>  Um ein Zertifikat zu authentifizieren, müssen Sie einen Domänennamen angeben.  Gleichzeitig können Sie im Feld "Serveradresse" die IP-Adresse des Servers und die Domäne nur unter "Remote-ID" angeben. Dann wird keine DNS-Auflösung für die Verbindung durchgeführt und dies geschieht etwas schneller. <br><br><img src="https://habrastorage.org/webt/x4/c2/eq/x4c2eqk2waefy8woi_pnaa8o5uw.png" alt="Bild"><br><br>  Der Benutzername und das Kennwort werden in der Datei <b>/etc/ipsec.secrets</b> angegeben <br><br><img src="https://habrastorage.org/webt/-p/gu/98/-pgu98eevkywzjzqjd7dfvq94zc.png" alt="Bild"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">IOS-Setup</b> <div class="spoiler_text">  Die IOS-Konfiguration kann manuell über den Assistenten erfolgen. Es ist jedoch wesentlich bequemer, das automatische Konfigurationsprofil mobileconfig zu verwenden. <br><br>  Die manuelle Optimierung hat eine ähnliche Bedeutung wie das Desktop-MacOS: <br><br>  <b>Einstellungen -&gt; VPN -&gt; VPN-Konfiguration hinzufügen</b> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Automatisches Konfigurationsprofil für Apple-Geräte</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sj/r2/up/sjr2up4rsqjjrxzltdldqrepnmk.png"><br>  Autokonfigurationsprofile .mobileconfig ist eine XML-Konfigurationsdatei, die alles von SSL-Zertifikaten bis zu VPN-Verbindungen konfigurieren kann. <br><br>  Es reicht aus, wenn der Benutzer auf die Datei klickt, und alle erforderlichen Einstellungen werden automatisch installiert. <br><br>  Beispielkonfiguration für die Verbindung zu unserem IKEv2-Server. <br>  Um eine Datei für Ihre Konfiguration zu konfigurieren, bearbeiten Sie einfach einige Parameter in dieser Vorlage: <br><br>  <b>AuthName</b> - Benutzername aus der Datei <b>/etc/ipsec.secrets</b> <br>  <b>AuthPassword</b> - Benutzerkennwort <b>/etc/ipsec.secrets</b> <br>  <b>RemoteAddress</b> - IP-Adresse der Domäne oder des Servers <br>  <b>RemoteIdentifier</b> - Domäne, für die das Zertifikat ausgestellt wird <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plist</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadContent<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>IKEv2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Username and password from ipsec.secrets --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>AuthName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>IrinaYarovaya<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>AuthPassword<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>PleaseLoveMe123<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Hostname or IP address of VPN server. Chosing IP address instead of DNS name can avoid issues with client DNS resolvers and speed up connection process. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>RemoteAddress<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>123.123.123.123<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- leftid in ipsec.conf --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>RemoteIdentifier<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>good.citizen.vpn<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>AuthenticationMethod<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>Certificate<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>ChildSecurityAssociationParameters<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- in ipsec.conf this proposal is: ike=aes256-sha256-modp2048 --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>DiffieHellmanGroup<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span>14<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>EncryptionAlgorithm<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>AES-256<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>IntegrityAlgorithm<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>SHA2-256<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>LifeTimeInMinutes<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span>1440<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>DeadPeerDetectionRate<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- None (Disable) Low (keepalive sent every 30 minutes) Medium (keepalive sent every 10 minutes) High (keepalive sent every 1 minute) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>High<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>ExtendedAuthEnabled<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">true</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>IKESecurityAssociationParameters<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>DiffieHellmanGroup<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span>14<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>EncryptionAlgorithm<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>AES-256<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>IntegrityAlgorithm<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>SHA2-256<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>LifeTimeInMinutes<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span>1440<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Always On OnDemand Rule Cen be disabled in connection preferences by "On Demand" checkbox http://www.v2ex.com/t/137653 https://developer.apple.com/library/mac/featuredarticles/iPhoneConfigurationProfileRef/Introduction/Introduction.html https://github.com/iphoting/ovpnmcgen.rb --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>OnDemandEnabled<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>OnDemandRules<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>Action<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>Connect<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>IPv4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>OverridePrimary<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadDescription<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>Configures VPN settings<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadDisplayName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>VPN<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadIdentifier<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>com.apple.vpn.managed.96C1C38F-D4D6-472E-BA90-9117ED8896B5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadType<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>com.apple.vpn.managed<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadUUID<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>96C1C38F-D4D6-472E-BA90-9117ED8896B5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadVersion<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- VPN connection name in Network Preferences --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>UserDefinedName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>London VPN<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>VPNType<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>IKEv2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Set the name to whatever you like, it is used in the profile list on the device --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadDisplayName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>My Super IKEv2 VPN<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- A reverse-DNS style identifier (com.example.myprofile, for example) that identifies the profile. This string is used to determine whether a new profile should replace an existing one or should be added. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadIdentifier<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>vpn.googd.citizen<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- A globally unique identifier, use uuidgen on Linux/Mac OS X to generate it --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadUUID<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>F3FAD91C-019C-4A79-87A1-CF334C583339<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadType<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>Configuration<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PayloadVersion<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plist</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Android-Setup</b> <div class="spoiler_text">  Leider ist Android das einzige der beliebtesten Betriebssysteme, das IKEv2 noch nicht unterstützt.  Um eine Verbindung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">herzustellen</a> , können Sie den offiziellen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Strongswan-</a> Client <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von PlayMarket verwenden</a> <br></div></div><br><h2>  Zusammenfassung </h2><br>  Wir haben die einfachste Server-Setup-Option mit beabstandeten Ein- und Ausstiegspunkten gezeigt.  Mit dieser Konfiguration können Sie die maximale VPN-Geschwindigkeit erreichen, da keine zusätzlichen Tunnel zwischen den Servern verwendet werden, obwohl sich die IP-Adressen der Ein- und Ausstiegspunkte in verschiedenen Subnetzen befinden.  Mit diesem Ansatz können Sie weiter experimentieren, indem Sie mehr als zwei IP-Adressen mit dem Server verbinden. <br><br>  Das IKEv2-Protokoll eignet sich perfekt für die Verwendung unter Desktop-Betriebssystemen für die tägliche Arbeit, da es maximal nativ in das System integriert ist und bei sonst gleichen Bedingungen eine höhere Geschwindigkeit als bei VPN-Programmen von Drittanbietern ermöglicht. <br><br><img src="https://habrastorage.org/webt/hi/b3/xj/hib3xjmkyohwf9yqp_irjum5tls.png"><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/ud/xv/wf/udxvwfcz80j3nug11rxaguqelww.png"><br></a> <br><h3>  Abonnieren Sie unseren Instagram-Entwickler </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/e5/as/-l/e5as-ltfnotkemk2dsqngygimra.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de469879/">https://habr.com/ru/post/de469879/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de469861/index.html">Datenstrukturen für Spielprogrammierer: Massendaten</a></li>
<li><a href="../de469867/index.html">Wie wird daraus ein Schüler (und was haben Brettspiele damit zu tun)</a></li>
<li><a href="../de469871/index.html">Als Tastaturen Tische waren</a></li>
<li><a href="../de469875/index.html">So schützen Sie Ihre Passwörter im Jahr 2019</a></li>
<li><a href="../de469877/index.html">Oh diese Newtonsche Methode</a></li>
<li><a href="../de469881/index.html">Die ersten drei Tage des Lebens eines Postens auf Habré</a></li>
<li><a href="../de469883/index.html">Ist es möglich, Zufälligkeit zu programmieren?</a></li>
<li><a href="../de469889/index.html">SamsPcbGuide, Teil 12: Technologie - BGA-Gehäuse, Kunststoff und Raum II</a></li>
<li><a href="../de469893/index.html">Haus mit Hightech-Elementen für eine obdachlose Katze</a></li>
<li><a href="../de469895/index.html">Social Engineering auf Instagram</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>