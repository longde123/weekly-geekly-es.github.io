<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÇ üèª üôÄ Testen von SQL Server-Code mit tSQLt üîÄ üõãÔ∏è üê¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zu Ihrer Information: Dieser Artikel ist eine erweiterte Version meines Berichts √ºber die SQA-Tage Nr. 25. 

 Aufgrund meiner Erfahrung in der Kommuni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Testen von SQL Server-Code mit tSQLt</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/arcadia/blog/461133/">  <i>Zu Ihrer Information: Dieser Artikel ist eine erweiterte Version meines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Berichts</a> √ºber die SQA-Tage Nr. 25.</i> <br><br>  Aufgrund meiner Erfahrung in der Kommunikation mit Kollegen kann ich sagen, dass das Testen von Code in einer Datenbank keine g√§ngige Praxis ist.  Dies kann eine potenzielle Gefahr sein.  Die Logik in der Datenbank wird von denselben Personen geschrieben, die den "regul√§ren" Code schreiben.  Folglich k√∂nnen dort auch Fehler vorhanden sein, die auch negative Folgen f√ºr das Produkt, das Gesch√§ft und die Verbraucher haben k√∂nnen.  Es spielt keine Rolle, ob es sich um gespeicherte Prozeduren handelt, die dem Backend helfen, oder um ETLs, die Daten in Speicher konvertieren - es besteht ein Risiko, und Tests k√∂nnen es erheblich reduzieren.  Ich m√∂chte Ihnen sagen, was tSQLt ist und wie es uns beim Testen von Code in SQL Server hilft. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2e/-h/nx/2e-hnxb3bddbq3ck_8vi4jwah8i.jpeg"></div><br><a name="habracut"></a><br><h1>  Kontext </h1><br>  Auf SQL Server gibt es ein gro√ües Lager, das verschiedene klinische Forschungsdaten enth√§lt.  Es wird aus verschiedenen Quellen (haupts√§chlich dokumentenorientierten Datenbanken) gef√ºllt.  Innerhalb des Servers selbst werden Daten wiederholt mit ETL konvertiert.  In Zukunft k√∂nnen diese Daten in kleinere Datenbanken hochgeladen werden, um von Webanwendungen verwendet zu werden, die einige kleine spezifische Probleme l√∂sen.  Einige Kunden des Kunden fragen auch nach einer API f√ºr ihre internen Anforderungen.  Bei der Implementierung solcher APIs werden h√§ufig gespeicherte Prozeduren und Abfragen verwendet. <br><br><div style="text-align:center;"><img width="75%" height="75%" src="https://habrastorage.org/webt/iw/vu/rz/iwvurz8sbflhuz3mkj39ipf9rag.png"></div><br>  Im Allgemeinen befindet sich der Code in der Reihenfolge auf der DBMS-Seite. <br><br>
<h1>  Warum das alles gebraucht wird </h1><br>  Wie bereits aus der Einf√ºhrung verstanden, ist der Code in der Datenbank derselbe Code <br>  Anwendungen, wie der Rest, und es kann auch Fehler geben. <br><br>  Ich denke, viele Menschen sind sich der Abh√§ngigkeit des Preises des Fehlers vom Zeitpunkt seiner Entdeckung bewusst, dessen Entdeckung normalerweise Barry Bohem zugeschrieben wird.  Ein Fehler, der in einem fr√ºhen Stadium gemacht und zu einem sp√§teren Zeitpunkt erkannt wird, kann teurer sein, da viele Phasen (Codierung, Einheit, Integration, Systemtests usw.) wiederholt durchlaufen werden m√ºssen, um den Fehler zu lokalisieren und den korrigierten Code wieder herzustellen das Stadium, in dem das Problem identifiziert wurde.  Dieser Effekt ist auch f√ºr den Lagerfall relevant.  Wenn sich ein Fehler in eine ETL eingeschlichen hat und die Daten mehrere Transformationen durchlaufen, m√ºssen Sie: Wenn in den Daten ein Fehler festgestellt wird, Folgendes tun: <br><br><ol><li>  F√ºhren Sie alle Schritte der Konvertierung zur√ºck zur Lokalisierung des Problems. </li><li>  Beheben Sie das Problem. </li><li>  Erhalten Sie die korrigierten Daten erneut (manuelle Korrekturen sind nicht ausgeschlossen). </li><li>  Stellen Sie sicher, dass durch den Fehler verursachte falsche Daten nicht an anderer Stelle angezeigt wurden. </li></ol><br>  Vergessen Sie nicht, dass wir kein Stofftier verkaufen.  Ein Fehler in einem Bereich wie der klinischen Forschung kann nicht nur das Gesch√§ft, sondern auch die Gesundheit der Menschen sch√§digen. <br><br><h1>  Wie teste ich? </h1><br>  Da es sich um Codetests handelt, meinen wir Unit- und Integrationstests.  Diese Dinge sind sehr probenhaft und beinhalten eine st√§ndige Regression.  Genau genommen f√ºhrt niemand solche Tests manuell durch (naja, vielleicht mit Ausnahme einiger v√∂llig entarteter F√§lle). <br><br>  Ein sch√∂ner Bonus: Tests k√∂nnen ein Hilfsmaterial bei der Dokumentation des Codes sein.  Kundenanforderungen k√∂nnen √ºbrigens so aussehen (anklickbar): <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/fh/af/xb/fhafxb5yph-tgvy2zhka9jfcvmk.png"></a> </div><br>  Excel, zwei Spalten mit Anforderungen + verstreute unterst√ºtzende Informationen in anderen Spalten + verschwommenes Markup, was verwirrender ist als es hilft.  Falls erforderlich, kann es schwierig sein, die urspr√ºnglichen W√ºnsche wiederherzustellen.  Tests k√∂nnen dabei helfen, die Nuancen der Implementierung genauer zu erfassen (nat√ºrlich sollten Sie sie nicht als √Ñquivalent zur Dokumentation betrachten). <br><br>  Leider w√§chst mit der Komplexit√§t des Codes die Komplexit√§t der Tests, und dieser Effekt kann ausgeglichen werden. <br><br>  Tests k√∂nnen als zus√§tzliche Sicherheitsebene gegen spontane Walrosse dienen.  Selbsttests in CI aufgrund von Formalismus helfen, dieses Problem zu bew√§ltigen. <br><br>  Wenn unsere Wahl auf den Weg der Automatisierung fiel, m√ºssen wir uns f√ºr die Tools f√ºr deren Implementierung entscheiden. <br><br><h1>  Wie teste ich? </h1><br>  Beim Testen des Codes in der Datenbank unterscheide ich zwei Ans√§tze: SQL-basiert, d. H. Direkt im DBMS funktionieren, und Nicht-SQL-unterst√ºtzt.  Ich konnte folgende Nuancen hervorheben: <br><div class="scrollable-table"><table><tbody><tr><th>  SQL-basiert <br></th><th>  Nicht mit SQL betrieben <br></th></tr><tr><td>  Erfordert die Installation von Objekten in der Datenbank <br></td><td>  Die Installation zus√§tzlicher externer Tools in der Datenbank ist erforderlich <br></td></tr><tr><td>  Tests sind immer unabh√§ngig von den in der Anwendung au√üerhalb der Datenbank verwendeten Technologien <br></td><td>  Tests k√∂nnen von Technologien abh√§ngen, die au√üerhalb der Datenbank verwendet werden. <br></td></tr><tr><td>  Das Framework ist immer an ein bestimmtes DBMS gebunden </td><td>  Das Framework unterst√ºtzt h√§ufig mehrere DBMS. </td></tr><tr><td>  F√ºr das Schreiben von Tests sind nur Kenntnisse des DBMS erforderlich.  F√ºr die Entwicklung k√∂nnen Sie manuelle Tester oder DBA verwenden </td><td>  Das Schreiben von Tests erfordert normalerweise zus√§tzliche Kenntnisse einer Programmiersprache und / oder -technologie.  brauchen oft Hilfe von Programmierern <br></td></tr><tr><td>  Die Ausf√ºhrung auf DBMS-Ebene erm√∂glicht die Verwendung erweiterter F√§lschungen und Zusicherungen <br></td><td>  Die externe Ausf√ºhrung kann die Werkzeugfunktionen einschr√§nken <br></td></tr></tbody></table></div>  In SQL Server haben wir eine Auswahl: <br><div class="scrollable-table"><table><tbody><tr><th colspan="6" align="center">  Allgemeine Informationen </th></tr><tr><th>  Titel </th><th>  Der Ansatz </th><th>  Architektur </th><th>  Geschrieben am </th><th>  Tests f√ºr </th></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tSQLt</a> </td><td>  SQL-basiert </td><td>  xEinheit </td><td>  T-SQL + CLR </td><td>  T-sql </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TSQLUnit</a> </td><td>  SQL-basiert </td><td>  xEinheit </td><td>  T-sql </td><td>  T-sql </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">utTSQL</a> </td><td>  SQL-basiert </td><td>  xEinheit </td><td>  T-sql </td><td>  T-sql </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tst</a> </td><td>  SQL-basiert </td><td>  xEinheit </td><td>  T-sql </td><td>  T-sql </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dbfit</a> </td><td>  Nicht mit SQL betrieben </td><td>  Fitnessess </td><td>  C # / Java </td><td>  Wiki-Abschlag </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fauler</a> </td><td>  Nicht mit SQL betrieben </td><td>  RSpec (BDD-orientiert) </td><td>  Ruby </td><td>  Ruby </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NUnit</a> usw. </td><td>  Nicht mit SQL betrieben </td><td>  xEinheit </td><td>  N / a </td><td>  N / a </td></tr></tbody></table></div><div class="scrollable-table"><table><tbody><tr><th colspan="4" align="center">  Termine </th></tr><tr><th>  Titel </th><th>  Erster Auftritt </th><th>  Letztes Commit </th><th>  Neueste Version </th></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tSQLt</a> </td><td>  2007-07-27 </td><td>  07/07/2019 </td><td>  31.01.2016 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TSQLUnit</a> </td><td>  2006-12-16 (0,9) <br>  2007-07-21 (0,91 rc1) </td><td>  26.04.2008 (GitHub) </td><td>  04/09/2011 (SourceForge) </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">utTSQL</a> </td><td>  2003-03-12 </td><td>  2003-03-12 </td><td>  2003-03-12 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tst</a> </td><td>  02-03-2009 (v1.0) </td><td>  N / a </td><td>  30-03-2012 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dbfit</a> </td><td>  12-01-2009 </td><td>  10-09-2018 </td><td>  15.08.2015 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fauler</a> </td><td>  23.06.2011 </td><td>  12-12-2018 </td><td>  12-12-2018 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NUnit</a> usw. </td><td>  N / a </td><td>  N / a </td><td>  N / a </td></tr></tbody></table></div><div class="scrollable-table"><table><tbody><tr><th colspan="7" align="center">  Die M√∂glichkeiten </th></tr><tr><th>  Titel </th><th>  CLR nicht erforderlich </th><th>  XML-Ausgabe </th><th>  In eine Transaktion eingebundene Tests </th><th>  Gef√§lscht </th><th>  Fehlerbehandlungsroutinen </th><th>  Behauptungen </th></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tSQLt</a> </td><td>  - - </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  Gro√üartig </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TSQLUnit</a> </td><td>  + </td><td>  - - </td><td>  + </td><td>  - - </td><td>  - - </td><td>  Sehr schlecht </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">utTSQL</a> </td><td>  + </td><td>  - - </td><td>  - - </td><td>  - - </td><td>  - - </td><td>  Schlecht </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tst</a> </td><td>  + </td><td>  + </td><td>  + (opt.) </td><td>  - - </td><td>  + </td><td>  Gro√üartig </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dbfit</a> </td><td>  + </td><td>  - - </td><td>  + (opt.) </td><td>  - - </td><td>  + </td><td>  Gut;  Es gibt Nuancen </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fauler</a> </td><td>  + </td><td>  - - </td><td>  + (opt.) </td><td>  - - </td><td>  - - </td><td>  Gut;  Es gibt Nuancen </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NUnit</a> usw. </td><td>  + </td><td>  + </td><td>  N / a </td><td>  N / a </td><td>  N / a </td><td>  Gro√üartig  Es gibt Nuancen </td></tr></tbody></table></div><div class="scrollable-table"><table><tbody><tr><th colspan="3" align="center">  Andere </th></tr><tr><th>  Titel </th><th>  Die Dokumentation </th><th>  Gemeinschaft </th></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tSQLt</a> </td><td>  Gro√üartig  Es gibt Nuancen </td><td>  Gro√üartig </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TSQLUnit</a> </td><td>  Schlecht </td><td>  Schlecht </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">utTSQL</a> </td><td>  Gro√üartig </td><td>  Schlecht </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tst</a> </td><td>  Gro√üartig </td><td>  Schlecht </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dbfit</a> </td><td>  Gro√üartig </td><td>  Okay </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fauler</a> </td><td>  Gro√üartig </td><td>  Okay </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NUnit</a> usw. </td><td>  Gro√üartig </td><td>  Gro√üartig </td></tr></tbody></table></div>  Bewertungen von "gut-schlecht" sind subjektiv, sorry, ohne dies nirgendwo. <br><br>  Erl√§uterung: ‚ÄûErstes Erscheinen‚Äú ist das fr√ºheste Datum im Lebensweg des Frameworks, das ich gefunden habe, dh die fr√ºheste Ver√∂ffentlichung oder Festschreibung. <br><br>  M√∂glicherweise stellen Sie fest, dass SQL-basierte Alternativen seit einiger Zeit aufgegeben wurden und tSQLt die einzige unterst√ºtzte Option ist.  Funktionell gewinnt auch tSQLt.  Das einzige ist, dass TST in Bezug auf Behauptungen eine etwas reichhaltigere Auswahl bietet als tSQLt, was jedoch wahrscheinlich nicht die Nachteile √ºberwiegt. <br><br>  Es gibt Nuancen in der tSQLt-Dokumentation, aber ich werde sp√§ter dar√ºber sprechen. <br><br>  In der Welt ohne SQL sind die Dinge nicht so einfach.  Alternativen, wenn auch nicht sehr aktiv, werden entwickelt.  DbFit ist ein interessantes Tool, das auf dem FitNesse-Framework basiert.  Er bietet Schreibtests zum Wiki-Markup an.  Slacker ist auch eine merkw√ºrdige Sache - der BDD-Ansatz beim Schreiben von Tests f√ºr die Datenbank. <br><br>  Ich werde die Behauptungen in nicht SQL-basierten diskutieren.  √Ñu√üerlich gibt es weniger von ihnen, und man k√∂nnte sagen, dass sie aus diesem Grund schlechter sind.  Hier ist jedoch zu ber√ºcksichtigen, dass sie sich grundlegend von tSQLt unterscheiden.  Nicht alles ist so einfach. <br><br>  Die letzte Zeile lautet "NUnit usw."  - Es ist eher eine Erinnerung.  Viele der in der t√§glichen Arbeit bekannten Unit-Testing-Frameworks k√∂nnen mithilfe von Zusatzbibliotheken in Hilfsdatenbanken verwendet werden.  Die Tabelle enth√§lt viele N / A, da diese Zeile tats√§chlich viele Tools enth√§lt.  Die ‚ÄûNuancen‚Äú in der Assertionsspalte stammen aus demselben Punkt - in verschiedenen Tools kann ihre Menge variieren, und die Frage der Anwendbarkeit auf die Datenbank ist offen. <br><br>  Als weitere interessante Metrik k√∂nnen wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google-Trends</a> ber√ºcksichtigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ud/2u/km/ud2ukmcoyjvstvhcu2taegpib34.png"></div><br>  Nuancen: <br><br><ol><li>  Ich habe Slacker nicht aufgenommen, da dieser Name viele Dinge bedeuten kann (und Anfragen wie "Slacker-Framework" in den Diagrammen nicht besonders sichtbar sind). </li><li>  Aus Neugier wurde der TST-Trend hinzugef√ºgt, aber er spiegelt auch nicht viel den Stand der Dinge wider, da es sich um eine Abk√ºrzung handelt, die viele verschiedene Dinge bedeutet. </li><li>  Ich habe NUnit und seine Analoga nicht ber√ºcksichtigt, da dies urspr√ºnglich Frameworks zum Testen des Anwendungscodes selbst waren und ihre Trends nicht auf unseren Kontext hinweisen. </li></ol><br>  Im Allgemeinen k√∂nnen wir sagen, dass tSQLt vor dem Hintergrund von Analoga positiv aussieht. <br><br><h1>  Was ist tSQLt? </h1><br>  tSQLt ist, wie Sie sich vorstellen k√∂nnen, ein SQL-basiertes Unit-Testing-Framework. <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Offizielle Seite</a> <br><br>  Die SQL Server-Unterst√ºtzung wurde seit 2005 SP2 angek√ºndigt.  Ich konnte noch nie so weit in die Vergangenheit schauen, aber wir haben 2012 auf dem Dev-Server, ich habe lokal 2017 - es gab keine Probleme. <br><br>  Open Source, eine Apache 2.0-Lizenz, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ist auf GitHub verf√ºgbar</a> .  Sie k√∂nnen in kommerziellen Projekten gabeln, schmuggeln, kostenlos verwenden und vor allem keine Angst vor Lesezeichen in der CLR haben. <br><br><h1>  Arbeitsmechaniker </h1><br><div style="text-align:center;"><img width="85%" height="85%" src="https://habrastorage.org/webt/1v/kx/wi/1vkxwixwjyna756vsce7uhwqzw0.png"></div><br>  Testf√§lle sind gespeicherte Prozeduren.  Sie werden zu Testklassen zusammengefasst (Testsuite in Bezug auf xUnit). <br><br>  Testklassen sind nichts anderes als normale Datenbankschemata.  Sie unterscheiden sich von anderen Schemata durch die Registrierung in den Rahmentabellen.  Sie k√∂nnen eine solche Registrierung vornehmen, indem Sie eine Prozedur aufrufen - tSQLt.NewTestClass. <br><br>  Innerhalb der Testklasse kann auch eine SetUp-Prozedur definiert werden, die ausgef√ºhrt wird, bevor jeder einzelne Testfall ausgef√ºhrt wird. <br><br>  Ein Abbauverfahren zur Wiederherstellung des Systems nach Abschluss des Testfalls ist nicht erforderlich.  Jeder Testfall wird zusammen mit der SetUp-Prozedur in einer separaten Transaktion ausgef√ºhrt, die nach dem Sammeln der Ergebnisse zur√ºckgesetzt wird.  Dies ist sehr praktisch, hat jedoch einige negative Auswirkungen, auf die ich weiter unten eingehen werde. <br><br>  Mit dem Framework k√∂nnen Sie einzelne Testf√§lle, ganze Testklassen oder alle registrierten Testklassen gleichzeitig ausf√ºhren. <br><br><h1>  Funktionen am Beispiel </h1><br>  Da ich keine Lust habe, einen bereits einfachen offiziellen Leitfaden noch einmal zu erz√§hlen, werde ich anhand von Beispielen √ºber die M√∂glichkeiten des Frameworks sprechen. <br><br>  <i>Haftungsausschluss:</i> <br><br><ul><li>  <i>Beispiele werden vereinfacht;</i> </li><li>  <i>im Original wurde nicht der gesamte Testcode von mir geschrieben, sondern es sind eher die Fr√ºchte der kollektiven Kreativit√§t;</i> </li><li>  <i>Beispiel 2 wurde erfunden, um die F√§higkeiten von tSQLt besser zu demonstrieren.</i> </li></ul><br><h3>  Beispiel 1: CsvSql </h3><br>  Auf Wunsch eines Kunden des Kunden wurde Folgendes implementiert.  Die Datenbank in Nvarchar (MAX) -Feldern speichert SQL-Abfragen.  Um diese Abfragen anzuzeigen, wird ein minimales Frontend verschraubt.  Die von diesen Anforderungen zur√ºckgegebenen Ergebnismengen werden vom Backend verwendet, um die CSV-Datei f√ºr die R√ºckgabe √ºber den API-Aufruf zu generieren. <br><br><div style="text-align:center;"><img width="75%" height="75%" src="https://habrastorage.org/webt/5q/mu/oy/5qmuoyyjjvlphk79jt-xtawwjn8.png"></div><br>  Ergebniss√§tze sind ziemlich schwer und enthalten viele Spalten.  Ein bedingtes Beispiel f√ºr eine solche Ergebnismenge: <br><br><div style="text-align:center;"><img width="75%" height="75%" src="https://habrastorage.org/webt/dg/50/bb/dg50bbx25qaw6ycwpfqcsfj5kyk.png"></div><br>  Diese Ergebnismenge enth√§lt einige Daten aus klinischen Studien.  Schauen wir uns genauer an, wie ClinicsNum betrachtet wird - die Anzahl der an der Studie beteiligten Kliniken.  Wir haben zwei Tabellen: [Studie] und [Klinik]: <br><br><div style="text-align:center;"><img width="85%" height="85%" src="https://habrastorage.org/webt/qo/mu/n-/qomun-gdbdl05teniypbtzi8jio.png"></div><br>  Es gibt FK: [Klinik]. [TrialID] -&gt; [Trial]. [TrialID].  Um die Anzahl der Kliniken zu berechnen, ben√∂tigen wir nat√ºrlich nur die √ºbliche COUNT (*). <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*), ...  <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.Trial  <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> dbo.Clinic    <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> Trial.ID = Clinic.TrialID  <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Trial.Name = @trialName  <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ...</code> </pre> <br>  Wie testen wir eine solche Anfrage?  Zun√§chst k√∂nnen wir den praktischen Stub FakeTable verwenden, der die weitere Arbeit erheblich vereinfacht. <br><br><pre> <code class="sql hljs">EXEC tSQLt.FakeTable 'dbo.Trial'; EXEC tSQLt.FakeTable 'dbo.Clinic';</code> </pre> <br>  FakeTable macht eine einfache Sache - benennt alte Tabellen um und erstellt an ihrer Stelle neue.  Dieselben Namen, dieselben Spalten, aber ohne Einschr√§nkung'ov und Trigger'ov. <br><br>  Warum brauchen wir das: <br><br><ol><li>  M√∂glicherweise enth√§lt die Testdatenbank einige Daten, die die Tests beeintr√§chtigen k√∂nnen.  Dank FakeTable sind wir nicht von ihnen abh√§ngig. </li><li>  F√ºr den Test m√ºssen Sie in der Regel nur wenige Spalten ausf√ºllen.  Es k√∂nnen viele von ihnen in der Tabelle sein, und einige von ihnen haben Einschr√§nkungen.  Auf diese Weise vereinfachen wir die weitere Installation von Testdaten - wir f√ºgen nur diejenigen ein, die f√ºr den Testfall wirklich notwendig sind. </li><li>  Wir haben definitiv keinen Einfluss auf den Ausl√∂ser beim Einf√ºgen von Testdaten und m√ºssen uns keine Gedanken √ºber unerw√ºnschte Nachwirkungen machen. </li></ol><br>  F√ºgen Sie als N√§chstes die ben√∂tigten Testdaten ein: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.Trial ([<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>], [<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,   <span class="hljs-string"><span class="hljs-string">'Valerian'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.Clinic ([<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>], [TrialID], [<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,   <span class="hljs-number"><span class="hljs-number">1</span></span>,        <span class="hljs-string"><span class="hljs-string">'Clinic1'</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>,   <span class="hljs-number"><span class="hljs-number">1</span></span>,        <span class="hljs-string"><span class="hljs-string">'Clinic2'</span></span>);</code> </pre> <br>  Wir erhalten unsere Abfrage aus der Datenbank, erstellen die Ist-Tabelle und f√ºllen sie mit der Ergebnismenge unserer Abfrage: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @sqlStatement <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) = (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span>‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> actual ([TrialID], ...); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> actual EXEC sp_executesql @sqlStatement, ...</code> </pre> <br>  F√ºllen Sie die erwarteten - erwarteten Werte aus: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> expected (   ClinicsNum <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> expected <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Ich m√∂chte Ihre Aufmerksamkeit auf die Tatsache lenken, dass wir in der Tabelle "Erwartet" nur eine Spalte haben, w√§hrend wir in "Tats√§chlich" einen vollst√§ndigen Satz haben. <br><br><div style="text-align:center;"><img width="80%" height="80%" src="https://habrastorage.org/webt/qd/gx/ga/qdgxgaqr4cjp2eayoz0eycjs8cg.png"></div><br>  Dies liegt an der Funktion der AssertEqualsTable-Prozedur, mit der wir die Werte √ºberpr√ºfen. <br><br><pre> <code class="sql hljs">EXEC tSQLt.AssertEqualsTable   'expected',   'actual',   'incorrect number of clinics';</code> </pre> <br>  Es werden nur die Spalten verglichen, die in beiden zu vergleichenden Tabellen vorhanden sind.  Dies ist in unserem Fall sehr praktisch, da die Testabfrage viele Spalten zur√ºckgibt, von denen jede ihre eigene Logik hat, die manchmal sehr verwirrend ist.  Wir m√∂chten keine Testf√§lle aufblasen, daher ist diese Funktion f√ºr uns sehr n√ºtzlich.  Nat√ºrlich ist dies ein zweischneidiges Schwert.  Wenn in Actual eine Reihe von Spalten automatisch √ºber SELECT TOP 0 gef√ºllt wird und irgendwann pl√∂tzlich eine zus√§tzliche Spalte angezeigt wird, wird ein solcher Testfall diesen Moment nicht erfassen.  Um solche Situationen zu bew√§ltigen, m√ºssen Sie zus√§tzliche √úberpr√ºfungen durchf√ºhren. <br><br><h3>  Schwesterprozeduren AssertEqualsTable </h3><br>  Es ist erw√§hnenswert, dass tSQLt zwei Prozeduren enth√§lt, die AssertEqualsTable √§hnlich sind.  Dies sind AssertEqualsTableSchema und AssertResultSetsHaveSameMetaData.  Der erste Vorgang entspricht dem von AssertEqualsTable, jedoch f√ºr die Tabellenmetadaten.  Der zweite macht einen √§hnlichen Vergleich, aber auf den Metadaten der Ergebnismengen. <br><br><h3>  Beispiel 2: Einschr√§nkungen </h3><br>  Im vorherigen Beispiel haben wir gesehen, wie Sie Einschr√§nkungen entfernen k√∂nnen.  Aber was ist, wenn wir sie √ºberpr√ºfen m√ºssen?  Technisch gesehen ist dies auch Teil der Logik und kann auch als Kandidat f√ºr die Testabdeckung angesehen werden. <br><br>  Betrachten Sie die Situation aus dem vorherigen Beispiel.  Zwei Tabellen - [Studie] und [Klinik];  [TrialID] FK: <br><br><div style="text-align:center;"><img width="80%" height="80%" src="https://habrastorage.org/webt/-8/zu/v3/-8zuv3clqoo3ygm9wko5hpibc90.png"></div><br>  Versuchen wir, einen Testfall zu schreiben, um diese Einschr√§nkung zu testen.  Zuerst, wie beim letzten Mal, f√§lschen wir Tische. <br><br><pre> <code class="sql hljs">EXEC tSQLt.FakeTable '[dbo].[Trial]' EXEC tSQLt.FakeTable '[dbo].[Clinic]'</code> </pre> <br>  Das Ziel ist das gleiche - unn√∂tige Einschr√§nkungen zu beseitigen.  Wir wollen isolierte Kontrollen ohne unn√∂tige Gesten. <br><br>  Als N√§chstes geben wir die ben√∂tigte Einschr√§nkung mithilfe der ApplyConstraint-Prozedur an den Ort zur√ºck: <br><br><pre> <code class="sql hljs">EXEC tSQLt.ApplyConstraint   '[dbo].[Clinic]',   'Trial_FK';</code> </pre> <br>  Hier haben wir eine praktische Konfiguration f√ºr die direkte √úberpr√ºfung zusammengestellt.  Die Pr√ºfung selbst besteht darin, dass ein Versuch, Daten einzuf√ºgen, zwangsl√§ufig zu einer Ausnahme f√ºhrt.  Damit der Testfall korrekt funktioniert, m√ºssen wir genau diese Ausnahme abfangen.  Der ExpectException-Ausnahmebehandler hilft uns dabei. <br><br><pre> <code class="sql hljs">EXEC tSQLt.ExpectException   @ExpectedMessage = 'The <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">statement</span></span> conflicted...<span class="hljs-string"><span class="hljs-string">',   @ExpectedSeverity = 16,   @ExpectedState = 0;</span></span></code> </pre> <br>  Nach der Installation des Handlers k√∂nnen Sie versuchen, das nicht einf√ºgbare einzuf√ºgen. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> [dbo].[Clinic] ([TrialID])   <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Ausnahme abgefangen.  Test bestanden. <br><br><h3>  Schwesterprozeduren ApplyConstraint </h3><br>  TSQLt-Entwickler bieten uns einen √§hnlichen Ansatz zum Testen von Triggern an.  Mit der ApplyTrigger-Prozedur k√∂nnen Sie einen Trigger an die gef√§lschte Tabelle zur√ºckgeben.  Au√üerdem ist alles wie im obigen Beispiel - wir l√∂sen den Trigger aus und √ºberpr√ºfen das Ergebnis. <br><br><h3>  ExpectNoException - das Antonyme von ExpectException </h3><br>  In F√§llen, in denen eine Ausnahme definitiv nicht auftreten sollte, gibt es eine ExpectNoException-Prozedur.  Es funktioniert genauso wie eine ExpectException, au√üer dass der Test als fehlgeschlagen betrachtet wird, wenn eine Ausnahme auftritt. <br><br><h3>  Beispiel 3: Semaphor </h3><br>  Die Situation ist wie folgt.  Es gibt eine Reihe von gespeicherten Prozeduren und Windows-Diensten.  Der Beginn ihrer Ausf√ºhrung kann durch verschiedene externe Ereignisse verursacht werden.  In diesem Fall ist die zul√§ssige Reihenfolge ihrer Ausf√ºhrung festgelegt.  Ein Semaphor wird verwendet, um den Zugriff auf Datenbanktabellen zu unterscheiden.  Es ist eine Gruppe gespeicherter Prozeduren. <br><br>  Betrachten Sie beispielsweise eines dieser Verfahren.  Wir haben zwei Tabellen: <br><br><div style="text-align:center;"><img width="80%" height="80%" src="https://habrastorage.org/webt/-m/hz/8-/-mhz8-fm_n1w7njpryiv8z3epiw.png"></div><br>  Die Tabelle [Prozess] enth√§lt eine Liste der zur Ausf√ºhrung zugelassenen Prozesse, [ProcStatus] - eine Liste der Status dieser Prozesse. <br><br>  Was macht unser Verfahren?  Beim Aufruf erfolgt zun√§chst eine Reihe von √úberpr√ºfungen: <br><br><ol><li>  Der Name des zu startenden Prozesses, der im Prozedurparameter √ºbergeben wird, wird im Feld [Name] der Tabelle [Prozess] nachgeschlagen. </li><li>  Wenn der Prozessname gefunden wurde, wird gepr√ºft, ob es derzeit m√∂glich ist, ihn zu starten - das Flag [IsRunable] der Tabelle [Process]. </li><li>  Wenn sich herausstellt, dass der Prozess f√ºr die Ausf√ºhrung akzeptabel ist, muss sichergestellt sein, dass er noch nicht ausgef√ºhrt wird.  In der Tabelle [ProcStatus] wird das Fehlen von Datens√§tzen zu diesem Prozess mit dem Status = 'InProg' √ºberpr√ºft. </li></ol><br>  Wenn alles in Ordnung ist, wird ProcStatus ein neuer Datensatz mit dem Status 'InProg' hinzugef√ºgt (dies wird als Start betrachtet). Die ID dieses Datensatzes wird mit dem Parameter ProcStatusId zur√ºckgegeben.  Wenn eine √úberpr√ºfung fehlschl√§gt, erwarten wir Folgendes: <br><br><ol><li>  Ein Brief wird an den Systemadministrator gesendet. </li><li>  Gibt ProcStatusId = -1 zur√ºck. </li><li>  Ein neuer Eintrag in [ProcStatus] wird nicht hinzugef√ºgt. </li></ol><br>  Schreiben wir einen Testfall, um den Fall zu testen, wenn der Prozess nicht in der Liste der akzeptablen F√§lle enthalten ist. <br><br>  Wenden Sie der Einfachheit halber sofort FakeTable an.  Hier ist es nicht so grundlegend wichtig, aber es kann n√ºtzlich sein: <br><br><ol><li>  Wir werden garantiert alle Daten entfernen, die die korrekte Ausf√ºhrung des Testfalls beeintr√§chtigen k√∂nnten. </li><li>  Wir werden die weitere √úberpr√ºfung fehlender Eintr√§ge in ProcStatus vereinfachen. </li></ol><br><pre> <code class="sql hljs">EXEC tSQLt.FakeTable 'dbo.Process'; EXEC tSQLt.FakeTable 'dbo.ProcStatus';</code> </pre> <br>  Zum Senden einer Nachricht wird die von unseren Programmierern geschriebene Prozedur [SendEmail] verwendet.  Um das Senden eines Briefes an Administratoren zu √ºberpr√ºfen, m√ºssen wir ihren Anruf entgegennehmen.  In diesem Fall bietet uns tSQLt die Verwendung von SpyProcedure an. <br><br><pre> <code class="sql hljs">EXEC tSQLt.SpyProcedure 'dbo.SendEmail'</code> </pre> <br>  SpyProcedure f√ºhrt Folgendes aus: <br><br><ol><li>  Erstellt eine Tabelle der Form [dbo]. [SendEmail_SpyProcedureLog]. </li><li>  Wie FakeTable ersetzt es die urspr√ºngliche Prozedur durch eine eigene mit demselben Namen, die jedoch eine Protokollierungslogik enth√§lt.  Falls gew√ºnscht, k√∂nnen Sie eine beliebige eigene Logik hinzuf√ºgen. </li></ol><br>  Wie Sie vielleicht erraten haben, erfolgt die Protokollierung in der Tabelle [dbo]. [SendEmail_SpyProcedureLog].  Diese Tabelle enth√§lt die Spalte [_ID_] - die Sequenznummer des Prozeduraufrufs.  Die nachfolgenden Spalten tragen die Namen der Parameter, die an die Prozedur √ºbergeben wurden, und die in den Aufrufen √ºbergebenen Werte werden in ihnen gesammelt.  Bei Bedarf k√∂nnen sie auch √ºberpr√ºft werden. <br><br><div style="text-align:center;"><img width="75%" height="75%" src="https://habrastorage.org/webt/ko/gh/4h/kogh4hgcdsxagldk2bmdcfrptzi.png"></div><br>  Das letzte, was wir tun m√ºssen, bevor wir das Semaphor aufrufen und pr√ºfen, ist, eine Variable zu erstellen, in die wir die Datensatz-ID aus der [ProcStatus] -Tabelle einf√ºgen (genauer -1, da der Datensatz nicht hinzugef√ºgt wird). <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @ProcStatusId <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>;</code> </pre> <br>  Nennen Sie das Semaphor: <br><br><pre> <code class="sql hljs">EXEC dbo.[Semaphore_JobStarter]   'SomeProcess',   @ProcStatusId OUTPUT; <span class="hljs-comment"><span class="hljs-comment">--    -1</span></span></code> </pre> <br>  Jetzt haben wir alle notwendigen Daten zur √úberpr√ºfung.  Beginnen wir mit der √úberpr√ºfung der Sendung. <br>  Buchstaben: <br><br><pre> <code class="sql hljs">IF NOT EXISTS (   <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> *   <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.SendEmail_SpyProcedureLog) EXEC tSQLt.Fail <span class="hljs-string"><span class="hljs-string">'SendEmail has not been run.'</span></span>;</code> </pre> <br>  In diesem Fall haben wir beschlossen, die w√§hrend des Sendens √ºbertragenen Parameter nicht zu √ºberpr√ºfen, sondern nur die Tatsache selbst zu √ºberpr√ºfen.  Ich mache Sie auf das Verfahren tSQLt.Fail aufmerksam.  Damit k√∂nnen Sie den Testfall "offiziell" nicht bestehen.  Wenn Sie eine bestimmte Konstruktion erstellen m√ºssen, k√∂nnen Sie dies mit tSQLt.Fail tun. <br><br>  √úberpr√ºfen Sie als N√§chstes das Fehlen von Eintr√§gen in [dbo]. [ProcStatus]: <br><br><pre> <code class="sql hljs">EXEC tSQLt.AssertEmptyTable 'dbo.ProcStatus';</code> </pre> <br>  Hier hat uns die FakeTable geholfen, die wir zu Beginn angewendet haben.  Dank ihm k√∂nnen wir Leere erwarten.  Ohne sie sollten wir zur genauen √úberpr√ºfung die Anzahl der Datens√§tze vor und nach dem Semaphor auf gute Weise vergleichen. <br><br>  Gleichheit ProcStatusId = -1 k√∂nnen wir leicht mit AssertEquals √ºberpr√ºfen: <br><br><pre> <code class="sql hljs">EXEC tSQLt.AssertEquals   -1,       @ProcStatusId,       'Wrong ProcStatusId.';</code> </pre> <br>  AssertEquals ist minimalistisch - es vergleicht einfach zwei Werte, nichts √úbernat√ºrliches. <br><br><h3>  AssertEquals Geschwisterverfahren </h3><br>  Um die Werte zu vergleichen, stehen uns eine Reihe von Verfahren zur Verf√ºgung: <br><br><ul><li>  AssertEquals </li><li>  AssertNotEquals </li><li>  AssertEqualsString </li><li>  Assertike </li></ul><br>  Ich denke, ihre Namen sprechen f√ºr sich.  Das einzige, was erw√§hnenswert ist, ist das Vorhandensein einer separaten AssertEqualsString-Prozedur.  Die Sache ist, dass AssertEquals / AssertNotEquals / AssertLike mit SQL_VARIANT zusammenarbeiten und NVARCHAR (MAX) nicht darauf anwendbar ist. Daher mussten tSQLt-Entwickler ein separates Verfahren zum Testen von NVARCHAR (MAX) zuweisen. <br><br><h3>  Gef√§lschte Funktion </h3><br>  FakeFunction mit einer gewissen Dehnung kann als eine Prozedur bezeichnet werden, die SpyProcedure √§hnelt.  Mit dieser F√§lschung k√∂nnen Sie jede Funktion durch die notwendige einfachere ersetzen.  Da die Funktionen in SQL Server nach dem Prinzip einer Tube mit Zahnpasta arbeiten - sie liefern das Ergebnis durch das "einzige technologische Loch" -, wird leider keine Protokollierungsfunktion bereitgestellt.  Nur ein Ersatz f√ºr Logik. <br><br><h1>  Fallstricke </h1><br>  Es ist erw√§hnenswert, dass einige Fallstricke auftreten k√∂nnen, wenn Sie mit tSQLt arbeiten.  In diesem Fall meine ich mit Fallstricken einige problematische Probleme, die aufgrund der Einschr√§nkungen von SQL Server entstanden sind und / oder von den Entwicklern des Frameworks nicht gel√∂st werden k√∂nnen. <br><br><h3>  Stornierung / Besch√§digung von Transaktionen </h3><br>  Das erste und wichtigste Problem unseres Teams war die Stornierung von Transaktionen.  SQL Server wei√ü nicht, wie verschachtelte Transaktionen separat zur√ºckgesetzt werden sollen - nur alles als Ganzes bis hin zu den externesten.  Angesichts der Tatsache, dass tSQLt jeden Testfall in eine separate Transaktion einschlie√üt, wird dies zu einem Problem.  Schlie√ülich kann ein Transaktions-Rollback innerhalb der Testprozedur die Testausf√ºhrung unterbrechen und einen nicht beschreibenden Ausf√ºhrungsfehler verursachen. <br><br>  Um dieses Problem zu umgehen, verwenden wir Sicherungspunkte.  Die Idee ist einfach.  Bevor wir eine Transaktion im Testverfahren starten, pr√ºfen wir, ob wir uns bereits in der Transaktion befinden.  Wenn sich herausstellt, dass dies der Fall ist, setzen wir unter der Annahme, dass es sich um eine tSQLt-Transaktion handelt, den Sicherungspunkt, anstatt ihn zu starten.  Bei Bedarf kehren wir dann zu diesem Sicherungspunkt zur√ºck und nicht zum Beginn der Transaktion.  Verschachteln als solches ist nicht. <br><br><div style="text-align:center;"><img width="85%" height="85%" src="https://habrastorage.org/webt/zk/0u/jc/zk0ujc2gmggccs7bg7icraan3da.png"></div><br>  Das Problem wird durch Transaktionsbesch√§digung kompliziert.  Wenn pl√∂tzlich etwas schief gelaufen ist und die Ausnahme funktioniert hat, ist die Transaktion m√∂glicherweise zum Scheitern verurteilt.  Eine solche Transaktion kann nicht nur festgeschrieben, sondern auch auf den Sicherungspunkt zur√ºckgesetzt werden, sondern nur das Ganze zur√ºckgesetzt werden. <br><br>  In Anbetracht all dieser Punkte m√ºssen Sie das folgende Design anwenden: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @isNestedTransaction <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span> =   <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> @@trancount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'true'</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'false'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> TRY   <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> @isNestedTransaction = <span class="hljs-string"><span class="hljs-string">'false'</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">SAVE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span> SavepointName;       <span class="hljs-comment"><span class="hljs-comment">-- something useful   IF @isNestedTransaction = 'false'   COMMIT TRANSACTION; END TRY BEGIN CATCH   DECLARE @isCommitable BIT =       CASE WHEN XACT_STATE() = 1           THEN 'true'           ELSE 'false'   END;   IF @isCommitable = 'true' AND @isNestedTransaction = 'true'       ROLLBACK TRANSACTION SavepointName;   ELSE       ROLLBACK;   THROW; END CATCH;</span></span></code> </pre> <br>  Betrachten Sie den Code in Teilen.  Zuerst m√ºssen wir feststellen, ob wir uns in einer Transaktion befinden: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @isNestedTransaction <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span> =   <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> @@trancount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'true'</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'false'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;</code> </pre> <br>  F√ºhren Sie nach dem Empfang des Flags @isNestedTransaction den TRY-Block aus und legen Sie je nach Situation den Sicherungspunkt oder den Start der Transaktion fest. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> TRY   <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> @isNestedTransaction = <span class="hljs-string"><span class="hljs-string">'false'</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">SAVE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span> SavepointName;       <span class="hljs-comment"><span class="hljs-comment">-- something useful</span></span></code> </pre> <br>  Nachdem wir etwas N√ºtzliches getan haben, legen Sie fest, ob dies ein ‚Äûechter‚Äú Start des Verfahrens ist. <br><br><pre> <code class="sql hljs">       <span class="hljs-comment"><span class="hljs-comment">-- something useful   IF @isNestedTransaction = 'false'   COMMIT TRANSACTION; END TRY</span></span></code> </pre> <br>  Wenn dies ein Start aus einem Testfall ist, m√ºssen wir nat√ºrlich nichts festlegen.  Am Ende der Ausf√ºhrung setzt tSQLt einfach alle √Ñnderungen zur√ºck.  Wenn pl√∂tzlich etwas schief gelaufen ist und wir in den CATCH-Block geraten sind, m√ºssen wir zun√§chst herausfinden, ob unsere Transaktion √ºberhaupt festgeschrieben werden kann. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> CATCH   <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @isCommitable <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span> =       <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> XACT_STATE() = <span class="hljs-number"><span class="hljs-number">1</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'true'</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'false'</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;</code> </pre> <br>  Wir k√∂nnen nur dann zum Sicherungspunkt zur√ºckkehren, wenn <br><br><ol><li>  festschreibbare Transaktion </li><li>  ein Testlauf findet statt, d.h.  Sicherungspunkt vorhanden. </li></ol><br>  In anderen F√§llen m√ºssen wir die gesamte Transaktion zur√ºcksetzen. <br><br><pre> <code class="sql hljs">   IF @isCommitable = 'true' AND @isNestedTransaction = 'true'       <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span> SavepointName;   ELSE       <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span>;   THROW; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> CATCH;</code> </pre> <br>  Ja, leider, wenn wir w√§hrend eines Testlaufs eine nicht festschreibbare Transaktion erhalten haben, erhalten wir immer noch einen Fehler bei der Ausf√ºhrung des Testfalls. <br><br><h3>  FakeTable und Problem mit dem Fremdschl√ºssel </h3><br>  Betrachten Sie die bekannten Tabellen [Studie] und [Klinik]: <br><br><div style="text-align:center;"><img width="85%" height="85%" src="https://habrastorage.org/webt/fy/k7/nm/fyk7nmhfha_fnezignyxclpflay.png"></div><br>  Wir erinnern uns an die [TrialID] FK.  Welche Probleme kann dies verursachen?  In den zuvor angegebenen Beispielen haben wir FakeTable gleichzeitig auf beide Tabellen angewendet.  Wenn wir es nur auf [Test] anwenden, erhalten wir die folgende Situation: <br><br><div style="text-align:center;"><img width="85%" height="85%" src="https://habrastorage.org/webt/og/to/3-/ogto3-drjheieblpi1_gsyup4hs.png"></div><br>  Der Versuch, auf diese Weise einen Eintrag in [Clinic] einzuf√ºgen, kann zum Fehlschlagen f√ºhren (selbst wenn wir alle erforderlichen Daten in der gef√§lschten Version der Tabelle [Trial] vorbereitet haben). <br><br><pre> <code class="sql hljs">[dbo].[Test_FK_Problem] failed: (Error) The <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">statement</span></span> conflicted <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> <span class="hljs-string"><span class="hljs-string">"Trial_Fk"</span></span>. The conflict occurred <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-string"><span class="hljs-string">"HabrDemo"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">"dbo.tSQLt_tempobject_ba8f36353f7a44f6a9176a7d1db02493"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> <span class="hljs-string"><span class="hljs-string">'TrialID'</span></span>.[<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]{Test_FK_Problem,<span class="hljs-number"><span class="hljs-number">14</span></span>}</code> </pre> <br>  Fazit: Sie m√ºssen entweder alles vort√§uschen oder nichts vort√§uschen.  Im zweiten Fall ist es offensichtlich, dass die Basis im Voraus zum Testen vorbereitet werden muss. <br><br><h3>  SpyProcedure zu Systemprozeduren </h3><br>  Leider schl√§gt das Ausspionieren von Aufrufen von Systemprozeduren fehl. <br><br><pre> <code class="sql hljs">[HabrDemo].[test_test] failed: (Error) Cannot <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> SpyProcedure <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> sys.sp_help because the <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> exist[<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>] {tSQLt.Private_ValidateProcedureCanBeUsedWithSpyProcedure,<span class="hljs-number"><span class="hljs-number">7</span></span>}</code> </pre> <br>  Im Semaphor-Beispiel haben wir Aufrufe der von unseren Entwicklern geschriebenen [SendEmail] -Prozedur verfolgt.  In diesem Fall muss beim Schreiben einer separaten Prozedur einige zus√§tzliche Informationen gesammelt und verarbeitet werden, bevor Nachrichten direkt gesendet werden.  Im Allgemeinen muss man mental darauf vorbereitet sein, dass man f√ºr einige Systemprozeduren m√∂glicherweise Interlayer-Prozeduren nur zum Testen schreiben muss. <br><br><h1>  Vorteile </h1><br><h3>  Schnelle Installation </h3><br>  Die Installation erfolgt in 2 Schritten und dauert ca. 2 Minuten.  Sie m√ºssen nur die CLR auf dem Server aktivieren, falls dies noch nicht geschehen ist, und ein einzelnes Skript ausf√ºhren.  Alles, Sie k√∂nnen die erste Testklasse hinzuf√ºgen und Testf√§lle schreiben. <br><br><h3>  Schnelle Entwicklung </h3><br>  tSQLt ist ein leicht zu erlernendes Tool.  Ich habe einen kleinen Tag gebraucht, um es zu meistern.  Ich fragte meine Kollegen, die mit dem Framework arbeiteten, und es stellte sich heraus, dass jeder ungef√§hr einen Tag verbringen w√ºrde. <br><br><h3>  Schnelle Implementierung in CI </h3><br>  Es dauerte ungef√§hr 2 Stunden, um die Integration in CI f√ºr unser Projekt einzurichten.  Die Zeit kann nat√ºrlich variieren, aber im Allgemeinen ist dies kein Problem, und die Integration kann sehr schnell durchgef√ºhrt werden. <br><br><h3>  Gro√üe Auswahl an Werkzeugen </h3><br>  Dies ist eine subjektive Einsch√§tzung, aber meiner Meinung nach ist die von tSQLt bereitgestellte Funktionalit√§t ziemlich umfangreich und deckt den L√∂wenanteil der Bed√ºrfnisse in der Praxis ab.  In seltenen F√§llen, in denen nicht gen√ºgend F√§lschungen und Behauptungen eingebaut sind, gibt es nat√ºrlich tSQLt.Fail. <br><br><h3>  Bequeme Dokumentation </h3><br>  Die offizielle Dokumentation ist bequem und konsistent.  Mit seiner Hilfe k√∂nnen Sie die Essenz der Verwendung von tSQLt in kurzer Zeit leicht verstehen, selbst wenn dies Ihr erstes Unit-Test-Tool ist. <br><br><h3>  Bequeme Ausgabe </h3><br>  Die Daten k√∂nnen in einer sehr klaren Textform erhalten werden: <br><br><pre> <code class="plaintext hljs">[tSQLtDemo].[test_error_messages] failed: (Failure) Expected an error to be raised. [tSQLtDemo].[test_tables_comparison] failed: (Failure) useful and descriptive error message Unexpected/missing resultset rows! |_m_|Column1|Column2| +---+-------+-------+ |&lt; |2 |Value2 | |= |1 |Value1 | |= |3 |Value3 | |&gt; |2 |Value3 | +----------------------+ |Test Execution Summary| +----------------------+ |No|Test Case Name |Dur(ms)|Result | +--+------------------------------------+-------+-------+ |1 |[tSQLtDemo].[test_constraint] | 83|Success| |2 |[tSQLtDemo].[test_trial_view] | 83|Success| |3 |[tSQLtDemo].[test_error_messages] | 127|Failure| |4 |[tSQLtDemo].[test_tables_comparison]| 147|Failure| ----------------------------------------------------------------------------- Msg 50000, Level 16, State 10, Line 1 Test Case Summary: 4 test case(s) executed, 2 succeeded, 2 failed, 0 errored. -----------------------------------------------------------------------------</code> </pre><br>  Sie k√∂nnen auch aus der Datenbank extrahieren (anklickbar) ... <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/-f/83/la/-f83lajcz1mfcnkhtttz45b0x3g.png"></a> </div><br>  ... oder im XML-Format erhalten. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuites</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuite</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLtDemo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tests</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">errors</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">failures</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2019-06-22T16:46:06"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.433"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hostname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BLAHBLAHBLAH\SQL2017"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLt"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testcase</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">classname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLtDemo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test_constraint"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.097"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testcase</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">classname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLtDemo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test_error_messages"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.153"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">failure</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">message</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Expected an error to be raised."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLt.Fail"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testcase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testcase</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">classname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLtDemo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test_trial_view"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.156"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system-out</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system-err</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuite</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuites</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Mit der letzteren Option k√∂nnen Sie Tests einfach in CI integrieren.  Insbesondere bei Atlassian Bamboo funktioniert bei uns alles. <br><br><h3>  Redgate-Support </h3><br>  Zu den Pluspunkten geh√∂rt die Unterst√ºtzung eines so gro√üen Anbieters von DBA-Tools wie RedGate.  SQL Test - das Plugin f√ºr SQL Server Management Studio - funktioniert sofort mit tSQLt.  Dar√ºber hinaus bietet RedGate dem tSQLt-Hauptentwickler Unterst√ºtzung bei der Entwicklungsumgebung, wie der Entwickler selbst bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Groups</a> behauptet. <br><br><h1>  Nachteile </h1><br><h3>  Keine tempor√§ren Tischf√§lschungen </h3><br>  tSQLt erlaubt keine gef√§lschten tempor√§ren Tabellen.  Bei Bedarf k√∂nnen Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">inoffizielle Add-On verwenden</a> .  Leider wird dieses Add-On nur von SQL Server 2016+ unterst√ºtzt. <br><br><h3>  Kein Zugriff auf externe Datenbanken </h3><br>  Es wird nicht funktionieren, eine separate Basis nur zum Speichern des Frameworks zu behalten.  tSQLt wurde entwickelt, um zu testen, was in derselben Datenbank enthalten ist.  Fake wird leider nicht funktionieren. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> [tSQLtDemo].[test_outer_db] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [AdventureWorks2017].[Person].[<span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>]   EXEC tSQLt.FakeTable <span class="hljs-string"><span class="hljs-string">'[AdventureWorks2017].[Person].[Password]'</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [AdventureWorks2017].[Person].[<span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ga/au/ny/gaaunygdr124sssxhonbb2s0b_0.png"></div><br>  Behauptungen scheinen zu funktionieren, aber nat√ºrlich garantiert niemand ihre Leistung. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> [tSQLtDemo].[test_outer_db_assertions] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP <span class="hljs-number"><span class="hljs-number">1</span></span> *   <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#Actual   FROM [AdventureWorks2017].[Person].[Password]   SELECT *   INTO #Expected   FROM (          SELECT 'bE3XiWw=' AS [PasswordSalt]   ) expectedresult;   EXEC tSQLt.AssertEqualsTable '#Expected', '#Actual', 'The salt is not salty'; END</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cg/dk/ow/cgdkowych69imevqmbirkkgsniq.png"></div><br><h3>  Dokumentationsfehler </h3><br>  Trotz der Tatsache, dass ich oben √ºber die Konsistenz und Zug√§nglichkeit der Dokumentation geschrieben habe, enth√§lt sie auch Probleme.  Es gibt einige veraltete Momente. <br><br>  Beispiel 1. In der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kurzanleitung wird vorgeschlagen</a> , das Framework von SourceForge herunterzuladen.  Sie verabschiedeten sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2015</a> von SourceForge. <br><br>  Beispiel 2. Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ApplyConstraint-Handbuch</a> im Beispiel verwendet eine Fail-Prozedur zum Abfangen einer Ausnahme, die durch ExpectException einfacher und visueller zu ersetzen w√§re. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> ConstraintTests.[<span class="hljs-keyword"><span class="hljs-keyword">test</span></span> ReferencingTable_ReferencedTable_FK prevents <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> orphaned <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> EXEC tSQLt.FakeTable <span class="hljs-string"><span class="hljs-string">'dbo.ReferencedTable'</span></span>; EXEC tSQLt.FakeTable 'dbo.ReferencingTable'; EXEC tSQLt.ApplyConstraint 'dbo.ReferencingTable','ReferencingTable_ReferencedTable_FK'; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @ErrorMessage <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @ErrorMessage = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* []     ExceptException ? */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> TRY <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.ReferencingTable ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, ReferencedTableId ) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> ( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span> ) ; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> TRY <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> CATCH <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @ErrorMessage = ERROR_MESSAGE(); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> CATCH <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> @ErrorMessage <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%ReferencingTable_ReferencedTable_FK%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> EXEC tSQLt.Fail <span class="hljs-string"><span class="hljs-string">'Expected error message containing ''ReferencingTable_ReferencedTable_FK'' but got: '''</span></span>,@ErrorMessage,<span class="hljs-string"><span class="hljs-string">'''!'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre><br>  Und das ist nat√ºrlich, weil es stattfindet ... <br><br><h3>  Teilweise Aufgabe </h3><br>  Die Entwicklung von tSQLt hat von Anfang 2016 bis Juni 2019 eine lange Pause eingelegt. Ja, leider wird dieses Tool teilweise aufgegeben.  Nach <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> ging die Entwicklung 2019 nach und nach weiter voran.  Obwohl die offiziellen Google Groups <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Thread haben,</a> in dem Sebastian, der Hauptentwickler von tSQLt, direkt nach dem Schicksal der Entwicklung gefragt wurde.  Die letzte Frage wurde am 2. M√§rz 2019 gestellt, die Antwort ist noch nicht eingegangen. <br><br><h3>  Problem mit SQL Server 2017 </h3><br>  Wenn Sie SQL Server 2017 verwenden, erfordert die Installation von tSQLt m√∂glicherweise zus√§tzliche Manipulationen.    ,    2012   SQL Server  security-.       ¬´CLR strict security¬ª,      ( SAFE).       (,  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>     ).      . <br><br>   , ,     ¬´ ¬ª,       tSQLt,        ,    . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> GitHub   issue</a> , ,       2017 (.  ). <br><br><h1>  (¬±)    </h1><br>        . tSQLt      . ,    (CLR,   T-SQL     SQL ),        ,       . ,     tSQLt  ,       SQL-powered   . <br><br> ,  PostgreSQL       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ptTAP</a> .      ¬´¬ª PL/pgSQL      TAP.  MySQL  ,       ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MyTAP</a> .       Oracle,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">utPLSQL</a> ‚Äî     (   ,  )  . <br><br><h1>  Fazit </h1><br> ,         . <br><br>  ‚Äî     .     SQL Server, Oracle  MySQL ‚Äî .          ,       .       ,       ,    ,  , ,  . <br><br>   ‚Äî   .  ,     ,   SQL Server,  tSQLt    100% ,    ,      .        ,     ,   . <br><br><div class="spoiler"> <b class="spoiler_title">,    ( )</b> <div class="spoiler_text"> DbFit ‚Äî Automated Open Source Database Testing: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://www.methodsandtools.com/tools/dbfit.php</a> <br><br> DbFit Documentation: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://dbfit.github.io/dbfit/docs/</a> <br><br> Slacker wiki: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/vassilvk/slacker/wiki</a> <br><br> TST documentation: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://archive.codeplex.com/projects/TST/4e04e281-9f35-4891-809a-15f09d304f4e</a> <br><br> NUnit Assertions: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/nunit/docs/wiki/Assertions</a> <br><br> utTSQL code: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://sourceforge.net/p/uttsql/code/HEAD/tree/</a> <br><br> Junit Class Assert: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://junit.org/junit4/javadoc/latest/org/junit/Assert.html</a> <br><br> pgTap: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://pgtap.org/</a> <br><br> utPLSQL: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://utplsql.org/</a> <br><br> MyTap: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/hepabolu/mytap</a> <br><br> tSQLt Google groups: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://groups.google.com/forum/#!forum/tsqlt</a> <br><br> tSQLt official website: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://tsqlt.org/</a> <br><br> tSQLt GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/tSQLt-org/tSQLt</a> <br><br> Google trends: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://bit.ly/2x7BQL6</a> <br><br> How to ROLLBACK a transaction when testing using tSQLt: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://stackoverflow.com/questions/8973138/how-to-rollback-a-transaction-when-testing-using-tsqlt</a> <br><br> What are the Pros and Cons of Manual Unit Testing against the Automated Unit Testing?: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://stackoverflow.com/questions/2948337/what-are-the-pros-and-cons-of-manual-unit-testing-against-the-automated-unit-tes#2948354</a> <br><br> The Good, the Bad, and the UgleÃÖeÃÖ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://sqlquantumleap.com/2017/08/07/sqlclr-vs-sql-server-2017-part-1-clr-strict-security/</a> <br><br> Rex Black, Erik Van Veenendal, Dorothy Graham, Foundations of Software Testing, Third edition, 2012 Cengage Learning EMEA <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de461133/">https://habr.com/ru/post/de461133/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de461121/index.html">Kleine Multitasking-Experimente in einem Mikrocontroller</a></li>
<li><a href="../de461125/index.html">Die Aufgabe, sequentielle numerische Codes zum Nummerieren von Nachrichten im Quellcode in Visual Studio zu erstellen (z. B. C #)</a></li>
<li><a href="../de461127/index.html">VM-Leistungsanalyse in VMware vSphere. Teil 3: Lagerung</a></li>
<li><a href="../de461129/index.html">√úber Kote, Frau, zwei S√∂hne, die Idee ... und nicht nur. Geschichte mit Fortsetzung</a></li>
<li><a href="../de461131/index.html">ROS Wagen LKW Teil 2. Software</a></li>
<li><a href="../de461137/index.html">Wie wir ein Ger√§t zur √úberwachung der Aufmerksamkeit von Fahrern entwickelt haben. Erleben Sie Yandex.Taxi</a></li>
<li><a href="../de461141/index.html">Mein erster Tag mit Haiku: Sie ist unerwartet gut</a></li>
<li><a href="../de461143/index.html">Zu aktuellen Problemen des Spieldesigns und M√∂glichkeiten, diese zu l√∂sen. Blick von unten</a></li>
<li><a href="../de461145/index.html">Was sollte ein Team f√ºhren: Rollen, Verantwortlichkeiten und F√§higkeiten</a></li>
<li><a href="../de461147/index.html">So sparen Sie 64 Stunden, indem Sie Schl√ºssel in PowerPoint kombinieren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>