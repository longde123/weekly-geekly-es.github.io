<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧞 ⚪️ 🔼 Transmita la pantalla a múltiples dispositivos a través de la red 💐 🚶🏽 💫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Era necesario que yo mostrara tableros con monitoreo en varias pantallas en la oficina. Hay varios Raspberry Pi Model B + antiguos y un hipervisor con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Transmita la pantalla a múltiples dispositivos a través de la red</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450118/"><p><img src="https://habrastorage.org/webt/ef/qk/de/efqkdemwmhhniofkklcjvayvmm0.png"></p><br><p>  Era necesario que yo mostrara tableros con monitoreo en varias pantallas en la oficina.  Hay varios Raspberry Pi Model B + antiguos y un hipervisor con una cantidad casi ilimitada de recursos. </p><br><p>  Aparentemente, el Raspberry Pi Model B + no tiene suficiente aleatoriedad para mantener el navegador funcionando constantemente y dibujar una gran cantidad de gráficos, por lo que sucede que la página está parcialmente defectuosa y a menudo se bloquea. </p><br><p>  Hubo una solución bastante simple y elegante, que quiero compartir con ustedes. </p><a name="habracut"></a><br><p> Como saben, todas las Raspberry tienen un procesador de video bastante potente, que es excelente para la decodificación de video por hardware.  Entonces surgió la idea de lanzar un navegador con un tablero en otro lugar y transferir la secuencia terminada con la imagen renderizada a la frambuesa. </p><br><p>  Además de todo esto, se suponía que simplificaría la administración, ya que en este caso toda la configuración se realizará en una máquina virtual, lo que es más fácil de actualizar y respaldar. </p><br><p>  Apenas dicho que hecho. </p><br><h2 id="servernaya-chast">  Lado del servidor </h2><br><p>  Utilizaremos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la imagen en la nube ya</a> preparada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">para Ubuntu</a> .  Sin requerir instalación, contiene todo lo que necesita para implementar rápidamente una máquina virtual, y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el soporte de Cloud-Init lo</a> ayuda a configurar instantáneamente su red, agregar claves ssh y ponerla en funcionamiento rápidamente. </p><br><p>  Implementamos una nueva <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">máquina virtual</a> y, en primer lugar, instalamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Xorg</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nodm</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fluxbox</a> en ella: </p><br><pre><code class="bash hljs">apt-get update apt-get install -y xserver-xorg nodm fluxbox sed -i <span class="hljs-string"><span class="hljs-string">'s/^NODM_USER=.*/NODM_USER=ubuntu/'</span></span> /etc/default/nodm</code> </pre> <br><p>  También utilizamos la configuración de Xorg amablemente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proporcionada</a> por Diego Ongaro, agregando solo la nueva resolución <strong>1920x1080</strong> , ya que todos nuestros monitores la usarán: </p><br><pre> <code class="bash hljs">cat &gt; /etc/X11/xorg.conf &lt;&lt;\EOT Section <span class="hljs-string"><span class="hljs-string">"Device"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"device"</span></span> Driver <span class="hljs-string"><span class="hljs-string">"vesa"</span></span> EndSection Section <span class="hljs-string"><span class="hljs-string">"Screen"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"screen"</span></span> Device <span class="hljs-string"><span class="hljs-string">"device"</span></span> Monitor <span class="hljs-string"><span class="hljs-string">"monitor"</span></span> DefaultDepth 16 SubSection <span class="hljs-string"><span class="hljs-string">"Display"</span></span> Modes <span class="hljs-string"><span class="hljs-string">"1920x1080"</span></span> <span class="hljs-string"><span class="hljs-string">"1280x1024"</span></span> <span class="hljs-string"><span class="hljs-string">"1024x768"</span></span> <span class="hljs-string"><span class="hljs-string">"800x600"</span></span> EndSubSection EndSection Section <span class="hljs-string"><span class="hljs-string">"Monitor"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"monitor"</span></span> HorizSync 20.0 - 50.0 VertRefresh 40.0 - 80.0 Option <span class="hljs-string"><span class="hljs-string">"DPMS"</span></span> EndSection Section <span class="hljs-string"><span class="hljs-string">"ServerLayout"</span></span> Identifier <span class="hljs-string"><span class="hljs-string">"layout"</span></span> Screen <span class="hljs-string"><span class="hljs-string">"screen"</span></span> EndSection EOT systemctl restart nodm</code> </pre> <br><p>  Ahora instale Firefox, lo iniciaremos como un servicio del sistema, por lo que al mismo tiempo escribiremos un archivo de unidad para él: </p><br><pre> <code class="bash hljs">apt-get install -y firefox xdotool cat &gt; /etc/systemd/system/firefox.service &lt;&lt;\EOT [Unit] Description=Firefox After=network.target [Service] Restart=always User=ubuntu Environment=<span class="hljs-string"><span class="hljs-string">"DISPLAY=:0"</span></span> Environment=<span class="hljs-string"><span class="hljs-string">"XAUTHORITY=/home/ubuntu/.Xauthority"</span></span> ExecStart=/usr/bin/firefox -url <span class="hljs-string"><span class="hljs-string">'http://example.org/mydashboard'</span></span> ExecStartPost=/usr/bin/xdotool search --sync --onlyvisible --class <span class="hljs-string"><span class="hljs-string">"Firefox"</span></span> windowactivate key F11 [Install] WantedBy=graphical.target EOT systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> firefox systemctl start firefox</code> </pre> <br><p>  Necesitamos Xdotool para ejecutar Firefox directamente en modo de pantalla completa. <br>  Usando el parámetro <code>-url</code> , puede especificar cualquier página para que se abra automáticamente cuando se inicie el navegador. </p><br><p>  En esta etapa, nuestro quiosco está listo, pero ahora necesitamos exportar la imagen a otros monitores y dispositivos a través de la red.  Para hacer esto, utilizaremos las capacidades de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Motion JPEG</a> , un formato que se usa con mayor frecuencia para transmitir video desde la mayoría de las cámaras web. </p><br><p>  Para hacer esto, necesitamos dos cosas: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FFmpeg</a> con el módulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">x11grab</a> , para capturar imágenes de X y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">streamEye</a> , que lo distribuirá a nuestros clientes: </p><br><pre> <code class="bash hljs">apt-get install -y make gcc ffmpeg <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp/ wget https://github.com/ccrisan/streameye/archive/master.tar.gz tar xvf master.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> streameye-master/ make make install cat &gt; /etc/systemd/system/streameye.service &lt;&lt;\EOT [Unit] Description=streamEye After=network.target [Service] Restart=always User=ubuntu Environment=<span class="hljs-string"><span class="hljs-string">"DISPLAY=:0"</span></span> Environment=<span class="hljs-string"><span class="hljs-string">"XAUTHORITY=/home/ubuntu/.Xauthority"</span></span> ExecStart=/bin/sh -c <span class="hljs-string"><span class="hljs-string">'ffmpeg -f x11grab -s 1920x1080 -r 1 -i :0 -f mjpeg -q:v 5 - 2&gt;/dev/null | streameye'</span></span> [Install] WantedBy=graphical.target EOT systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> streameye systemctl start streameye</code> </pre> <br><p>  Como nuestra imagen no requiere una actualización rápida, indiqué la frecuencia de actualización: 1 fotograma por segundo (parámetro <code>-r 1</code> ) y la calidad de compresión: 5 ( <code>-q:v 5</code> parámetro <code>-q:v 5</code> ) </p><br><p>  Ahora intentamos ir a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http: // your-vm: 8080 /</a> , en respuesta verá una captura de pantalla del escritorio constantemente actualizada.  Genial  - eso era lo que se necesitaba. </p><br><h2 id="klientskaya-chast">  Parte del cliente </h2><br><p>  Todavía es más simple aquí, como dije, usaremos el Raspberry Pi Model B +. </p><br><p>  En primer lugar, instale <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Arch Linux ARM</a> en él, para esto seguimos las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones</a> en el sitio web oficial. </p><br><p>  También necesitaremos asignar más memoria para nuestro chip de video, para esto editaremos en <code>/boot/config.txt</code> </p><br><pre> <code class="bash hljs">gpu_mem=128</code> </pre> <br><p>  Inicie nuestro nuevo sistema y recuerde inicializar el llavero pacman, instale <a href="">OMXPlayer</a> : </p><br><pre> <code class="bash hljs">pacman -Sy omxplayer</code> </pre> <br><p>  Sorprendentemente, OMXPlayer puede funcionar sin X, es por eso que todo lo que tenemos que hacer es escribir un archivo unitario y ejecutarlo: </p><br><pre> <code class="bash hljs">cat &gt; /etc/systemd/system/omxplayer.service &lt;&lt;\EOT [Unit] Description=OMXPlayer Wants=network-online.target After=network-online.target [Service] Type=simple Restart=always ExecStart=/usr/bin/omxplayer -r --live -b http://your-vm:8080/ --aspect-mode full [Install] WantedBy=multi-user.target EOT systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> omxplayer systemctl start omxplayer</code> </pre> <br><p>  Como parámetro <code>-b http://your-vm:8080/</code> pasamos la URL de nuestro servidor. </p><br><p>  Eso es todo, una imagen de nuestro servidor debería aparecer inmediatamente en la pantalla conectada.  En caso de problemas, la secuencia se reiniciará automáticamente y los clientes se volverán a conectar a ella. </p><br><p>  Como beneficio adicional, puede configurar la imagen resultante como un protector de pantalla para todas las computadoras de la oficina.  Para hacer esto, necesitará <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MPV</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">XScreenSaver</a> : </p><br><pre> <code class="bash hljs">mode: one selected: 0 programs: \ <span class="hljs-string"><span class="hljs-string">"Monitoring Screen"</span></span> mpv --really-quiet --no-audio --fs \ --loop=inf --no-stop-screensaver \ --wid=<span class="hljs-variable"><span class="hljs-variable">$XSCREENSAVER_WINDOW</span></span> \ http://your-vm:8080/ \n\ maze -root \n\ electricsheep --root 1 \n\</code> </pre> <br><p>  Ahora tus colegas estarán muy felices :) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/450118/">https://habr.com/ru/post/450118/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450106/index.html">El proyecto de la organización de construcción y reconstrucción en condiciones de hacinamiento en el sitio de construcción SPDS</a></li>
<li><a href="../450110/index.html">Patentes de diseño: segunda parte (ejemplos de Microsoft, Snapchat, Samsung, Netflix, Airbnb, Tinder)</a></li>
<li><a href="../450112/index.html">Eh, ¿qué pasó con las maletas? En el ejemplo de una maleta-scooter infantil ZINC</a></li>
<li><a href="../450114/index.html">Sobre lo que hemos implementado en EWM gracias a tu consejo</a></li>
<li><a href="../450116/index.html">Sistemas operativos: tres piezas fáciles. Parte 5: Planificación: Cola de comentarios de varios niveles (traducción)</a></li>
<li><a href="../450120/index.html">Busque imágenes similares, analizando un solo algoritmo</a></li>
<li><a href="../450122/index.html">Startup Digest: Genetics (enero - marzo 2019)</a></li>
<li><a href="../450124/index.html">Configuración de mapas OsmAnd de la capa de mapa de calor de Strava</a></li>
<li><a href="../450126/index.html">La puerta trasera y el encriptador Buhtrap se distribuyeron usando Yandex.Direct</a></li>
<li><a href="../450128/index.html">Uso de la óptica Minolta AF (Sony A-mount) en las modernas cámaras sin espejo de Sony</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>