<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦋 👇🏿 🙆🏼 Référentiels Spring JPA à CUBA 😁 🎸 🛰️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le sujet de l'article est assez étroitement ciblé, mais il peut être utile à ceux qui développent leurs propres entrepôts de données et pensent à l'in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Référentiels Spring JPA à CUBA</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/436216/"><p><img src="https://habrastorage.org/webt/_8/cc/h0/_8cch0_nvkzgoi2u1vailg4oiio.png"></p><br><p>  <em>Le sujet de l'article est assez étroitement ciblé, mais il peut être utile à ceux qui développent leurs propres entrepôts de données et pensent à l'intégration avec Spring Framework.</em> </p><br><h3 id="predposylki">  Contexte </h3><br><p>  Les développeurs n'aiment généralement pas changer leurs habitudes (souvent, les cadres sont également inclus dans la liste des habitudes).  Quand j'ai commencé à travailler avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CUBA</a> , je n'avais pas à apprendre trop de nouvelles choses, il était possible de s'impliquer activement dans le travail sur le projet presque immédiatement.  Mais il y avait une chose sur laquelle je devais m'asseoir plus longtemps - c'était de travailler avec des données. </p><a name="habracut"></a><br><p>  Spring a plusieurs bibliothèques qui peuvent être utilisées pour travailler avec la base de données, l'une des plus populaires est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">spring-data-jpa</a> , qui permet dans la plupart des cas de ne pas écrire SQL ou JPQL.  Vous avez juste besoin de créer une interface spéciale avec des méthodes qui sont nommées d'une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manière spéciale</a> et Spring générera et fera le reste du travail pour vous sur la récupération des données de la base de données et la création d'instances d'objets d'entité. </p><br><p>  Voici l'interface, avec une méthode pour compter les clients avec un nom de famille donné. </p><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Customer</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span></span>; }</code> </pre> <br><p>  Cette interface peut être utilisée directement dans les services Spring sans créer d'implémentation, ce qui accélère considérablement le travail. </p><br><p>  CUBA dispose d'une API pour travailler avec des données, qui comprend diverses fonctionnalités telles que des entités partiellement chargées ou un système de sécurité délicat avec contrôle d'accès aux attributs d'entité et aux lignes dans les tables de base de données.  Mais cette API est légèrement différente de ce à quoi les développeurs sont habitués dans Spring Data ou JPA / Hibernate. </p><br><p>  Pourquoi n'y a-t-il pas de référentiels JPA dans CUBA et puis-je les ajouter? </p><br><h3 id="rabota-s-dannymi-v-cuba">  Utilisation de données dans CUBA </h3><br><p>  Dans CUBA, il existe trois classes principales responsables de l'utilisation des données: DataStore, EntityManager et DataManager. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DataStore</a> est une abstraction de haut niveau pour tout stockage de données: base de données, système de fichiers ou stockage cloud.  Cette API vous permet d'effectuer des opérations de base sur les données.  Dans la plupart des cas, les développeurs n'ont pas besoin de travailler directement avec le DataStore, sauf lors du développement de leur propre référentiel ou si un accès très spécial aux données du référentiel est requis. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EntityManager</a> est une copie du célèbre JPA EntityManager.  Contrairement à l'implémentation standard, il dispose de méthodes spéciales pour travailler avec les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">représentations CUBA</a> , pour la suppression «logique» (logique) des données, et aussi pour travailler avec les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">requêtes dans CUBA</a> .  Comme dans le cas du DataStore, dans 90% des projets, un développeur ordinaire n'aura pas à traiter avec EntityManager, sauf lorsqu'il est nécessaire de répondre à certaines demandes en contournant le système de restriction d'accès aux données. </p><br><p>  DataManager est la classe principale pour travailler avec des données dans CUBA.  Fournit une API pour la manipulation des données et prend en charge le contrôle d'accès aux données, y compris l'accès aux attributs et les restrictions au niveau des lignes.  Le DataManager modifie implicitement toutes les requêtes qui s'exécutent dans CUBA.  Par exemple, il peut exclure des champs de table auxquels l'utilisateur actuel n'a pas accès à partir de l'instruction <code>select</code> et ajouter des conditions <code>where</code> pour exclure des lignes de table de la sélection.  Et cela facilite la vie des développeurs, car vous n'avez pas à réfléchir à la façon d'écrire correctement les requêtes en tenant compte des droits d'accès, CUBA le fait automatiquement en fonction des données des tables de service de base de données. </p><br><p>  Vous trouverez ci-dessous un diagramme de l'interaction des composants CUBA impliqués dans la récupération des données via le DataManager. </p><br><p><img src="https://habrastorage.org/webt/vy/e7/e1/vye7e1axlvkzuky3raw6an4ttl0.png"></p><br><p>  À l'aide du DataManager, vous pouvez relativement facilement charger des entités et des hiérarchies entières d'entités à l'aide des vues CUBA.  Dans sa forme la plus simple, la requête ressemble à ceci: </p><br><pre> <code class="java hljs">dataManager.load(Customer.class).list();</code> </pre> <br><p>  Comme déjà mentionné, DataManager filtrera les enregistrements «supprimés logiquement», supprimera les attributs interdits de la demande et ouvrira et fermera automatiquement la transaction. </p><br><p>  Mais, quand il s'agit de requêtes plus compliquées, vous devez écrire JPQL en CUBA. </p><br><p>  Par exemple, si vous devez compter les clients avec un nom de famille donné, comme dans l'exemple de la section précédente, vous devez écrire quelque chose comme ce code: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataManager .loadValue(<span class="hljs-string"><span class="hljs-string">"select count(c) from sample$Customer c where c.lastName = :lastName"</span></span>, Long.class) .parameter(<span class="hljs-string"><span class="hljs-string">"lastName"</span></span>, lastName) .one(); }</code> </pre> <br><p>  ou tel: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span><span class="hljs-function"> </span></span>{ LoadContext&lt;Customer&gt; loadContext = LoadContext.create(Customer.class); loadContext .setQueryString(<span class="hljs-string"><span class="hljs-string">"select c from sample$Customer c where c.lastName = :lastName"</span></span>) .setParameter(<span class="hljs-string"><span class="hljs-string">"lastName"</span></span>, lastName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataManager.getCount(loadContext); }</code> </pre> <br><p>  Dans l'API CUBA, vous devez passer une expression JPQL sous forme de chaîne (l'API Criteria n'est pas encore prise en charge), c'est une façon lisible et compréhensible de créer des requêtes, mais le débogage de telles requêtes peut apporter beaucoup de minutes amusantes.  De plus, les chaînes JPQL ne sont ni vérifiées par le compilateur ni par Spring Framework lors de l'initialisation du conteneur, ce qui entraîne des erreurs uniquement dans le Runtime. </p><br><p>  Comparez cela avec Spring JPA: </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Customer</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span></span>; }</code> </pre> <br><p>  Le code est trois fois plus court et sans lignes.  De plus, le nom de la méthode <code>countByLastName</code> vérifié lors de l'initialisation du conteneur Spring.  S'il y a une faute de frappe et que vous avez écrit <code>countByLastNsme</code> , l'application se bloquera avec une erreur lors du déploiement: </p><br><pre> <code class="plaintext hljs">Caused by: org.springframework.data.mapping.PropertyReferenceException: No property LastNsme found for type Customer!</code> </pre> <br><p>  CUBA est construit autour de Spring Framework, vous pouvez donc utiliser la bibliothèque spring-data-jpa dans une application écrite en utilisant CUBA, mais il y a un petit problème - le contrôle d'accès.  L'implémentation Spring CrudRepository utilise son EntityManager.  Ainsi, toutes les requêtes seront exécutées en contournant le DataManager.  Ainsi, pour utiliser les référentiels JPA dans CUBA, vous devez remplacer tous les appels EntityManager par des appels DataManager et ajouter la prise en charge des vues CUBA. </p><br><p>  Quelqu'un peut dire que spring-data-jpa est une boîte noire incontrôlée et il est toujours préférable d'écrire du JPQL pur ou même du SQL.  C'est le problème éternel de l'équilibre entre la commodité et le niveau d'abstraction.  Tout le monde choisit la méthode qu'il préfère, mais avoir un moyen supplémentaire de travailler avec des données dans l'arsenal ne fera jamais de mal.  Et pour ceux qui ont besoin de plus de contrôle, Spring <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">a un moyen de définir leur propre demande</a> de méthodes de référentiel JPA. </p><br><h2 id="realizaciya">  Implémentation </h2><br><p>  Les référentiels JPA sont implémentés en tant que module CUBA à l'aide de la bibliothèque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">spring-data-commons</a> .  Nous avons abandonné l'idée de modifier spring-data-jpa, car la quantité de travail serait bien plus importante que d'écrire notre propre générateur de requêtes.  D'autant plus que Spring-data-commons fait l'essentiel du travail.  Par exemple, l'analyse d'un nom de méthode et l'association d'un nom à des classes et à des propriétés sont entièrement effectuées dans cette bibliothèque.  Spring-data-commons contient toutes les classes de base nécessaires pour implémenter vos propres référentiels et cela ne prend pas beaucoup d'efforts pour l'implémenter.  Par exemple, cette bibliothèque est utilisée dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">spring-data-mongodb</a> . </p><br><p>  La chose la plus difficile a été d'implémenter avec précision la génération JPQL basée sur une hiérarchie d'objets - le résultat de l'analyse du nom de la méthode.  Mais, heureusement, une tâche similaire a déjà été implémentée dans Apache Ignite, donc le code a été pris à partir de là et adapté un peu pour générer JPQL au lieu de SQL et prendre en charge l'opérateur de <code>delete</code> . </p><br><p>  Spring-data-commons utilise le proxy pour créer dynamiquement des implémentations d'interface.  Lorsque le contexte d'application CUBA est initialisé, tous les liens vers les interfaces sont remplacés par des liens vers des bacs proxy publiés dans le contexte.  Lorsque la méthode d'interface est appelée, elle est interceptée par l'objet proxy correspondant.  Cet objet génère ensuite une requête JPQL par le nom de la méthode, substitue les paramètres et envoie la requête avec paramètres au DataManager pour exécution.  Le diagramme suivant montre un processus d'interaction simplifié entre les composants clés du module. </p><br><p><img src="https://habrastorage.org/webt/zh/cd/1l/zhcd1lasrsrz4vwcedkgtnsiz2m.png"></p><br><h2 id="ispolzovanie-repozitoriev-v-cuba">  Utilisation de référentiels dans CUBA </h2><br><p>  Pour utiliser les référentiels dans CUBA, il vous suffit de connecter le module dans le fichier de construction du projet: </p><br><pre> <code class="plaintext hljs"> appComponent("com.haulmont.addons.cuba.jpa.repositories:cuba-jpa-repositories-global:0.1-SNAPSHOT")</code> </pre> <br><p>  Vous pouvez utiliser la configuration XML pour «activer» les référentiels: </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans:beans</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:beans</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/context"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:repositories</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.cuba-platform.org/schema/data/jpa"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd http://www.cuba-platform.org/schema/data/jpa http://www.cuba-platform.org/schema/data/jpa/cuba-repositories.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Annotation-based beans --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context:component-scan</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base-package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.company.sample"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repositories:repositories</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base-package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.company.sample.core.repositories"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans:beans</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Et vous pouvez utiliser les annotations: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableCubaRepositories</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//Configuration here }</span></span></code> </pre> <br><p>  Une fois la prise en charge des référentiels activée, vous pouvez les créer sous la forme habituelle, par exemple: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CubaJpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Customer</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UUID</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String lastName)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;Customer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByNameIsIn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; names)</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@CubaView</span></span>(<span class="hljs-string"><span class="hljs-string">"_minimal"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@JpqlQuery</span></span>(<span class="hljs-string"><span class="hljs-string">"select c from sample$Customer c where c.name like concat(:name, '%')"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Customer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByNameStartingWith</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span></span>; }</code> </pre> <br><p>  Pour chaque méthode, vous pouvez utiliser des annotations: </p><br><ul><li>  <code>@CubaView</code> - pour définir la vue CUBA à utiliser dans le DataManager </li><li>  <code>@JpqlQuery</code> - pour spécifier la requête JPQL qui sera exécutée, quel que soit le nom de la méthode. </li></ul><br><p>  Ce module est utilisé dans le module <code>global</code> du framework CUBA, par conséquent, les référentiels peuvent être utilisés à la fois dans le module <code>core</code> et sur le <code>web</code> .  La seule chose dont vous devez vous souvenir est d'activer les référentiels dans les fichiers de configuration des deux modules. </p><br><p>  Un exemple d'utilisation du référentiel dans le service CUBA: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span>(CustomerService.NAME) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomerServiceBean</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CustomerRepository customerRepository; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Date&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomersBirthDatesByLastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> customerRepository.findByNameStartingWith(name) .stream().map(Customer::getBirthDate).collect(Collectors.toList()); } }</code> </pre> <br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  CUBA est un cadre flexible.  Si vous souhaitez y ajouter quelque chose, il n'est pas nécessaire de réparer le noyau vous-même ou d'attendre une nouvelle version.  J'espère que ce module rend le développement de CUBA plus efficace et plus rapide.  La première version du module est disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> , testée sur CUBA version 6.10 <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436216/">https://habr.com/ru/post/fr436216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436202/index.html">J'ai perdu confiance dans le développement, brûlé, mais le culte de l'outil m'a sauvé</a></li>
<li><a href="../fr436206/index.html">Comment unir sans peine l'art avec Java, JavaScript et les graphiques ou l'histoire derrière la création d'un produit de théâtre interactif</a></li>
<li><a href="../fr436208/index.html">De nouveaux torrents n'apparaissent plus sur The Pirate Bay</a></li>
<li><a href="../fr436210/index.html">Biquaternions</a></li>
<li><a href="../fr436212/index.html">Réception de télécopies en ondes courtes avec votre PC et un récepteur standard</a></li>
<li><a href="../fr436218/index.html">Marketing de contenu dans les médias en ligne populaires: 5 erreurs de startups à éviter</a></li>
<li><a href="../fr436220/index.html">Comment fonctionne la notation dans l'industrie de l'autopartage. Partie 2. Identifiez un conducteur agressif en 5 secondes</a></li>
<li><a href="../fr436224/index.html">Nous écrivons notre langage de programmation, partie 4: Représentation des structures et des classes, génération d'allocateurs</a></li>
<li><a href="../fr436226/index.html">Guide et aide-mémoire pour Wireshark</a></li>
<li><a href="../fr436228/index.html">Développement d'une équipe pour interroger les données de la base de données</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>