<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏿 👩🏼‍🍳 🦇 Modules d'injection de dépendances, JavaScript et ES6 👩🏻‍🌾 🔟 🈁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une autre implémentation de Dependency Injection en JavaScript est avec les modules ES6, avec la possibilité d'utiliser le même code dans un navigateu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Modules d'injection de dépendances, JavaScript et ES6</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464347/"><p>  Une autre implémentation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dependency Injection en JavaScript</a> est avec les modules ES6, avec la possibilité d'utiliser le même code dans un navigateur et dans nodejs et de ne pas utiliser de transpilers. </p><br><p><img src="https://habrastorage.org/webt/cm/yd/it/cmyditgokfobpp0llt2opzsflts.jpeg" alt="image"></p><br><p>  Sous la coupe se trouve mon point de vue sur DI, sa place dans les applications Web modernes, l'implémentation fondamentale d'un conteneur DI qui peut créer des objets à l'avant et à l'arrière, ainsi qu'une explication de ce que Michael Jackson a à voir avec cela. </p><a name="habracut"></a><br><p> Je demande très fortement à ceux qui trouvent trivial dans l'article de ne pas se violer et de ne pas lire jusqu'au bout, afin que plus tard, s'ils sont déçus, ne mettent pas de «moins».  Je ne suis pas contre les «moins» - mais seulement si le moins est accompagné d'un commentaire, ce qui exactement dans la publication a provoqué une réaction négative.  Il s'agit d'un article technique, essayez donc d'être condescendant envers le style de présentation et critiquez précisément la composante technique de ce qui précède.  Je vous remercie </p><br><h1 id="obekty-v-prilozhenii">  Objets dans l'application </h1><br><p>  Je respecte vraiment la programmation fonctionnelle, mais j'ai consacré l'essentiel de mon activité professionnelle à la création d'applications constituées d'objets.  JavaScript m'impressionne du fait que les fonctions qu'il contient sont également des objets.  Lors de la création d'applications, je pense aux objets, c'est ma déformation professionnelle. </p><br><p>  Selon la durée de vie, les objets de l'application peuvent être répartis dans les catégories suivantes: </p><br><ul><li>  <strong>permanent</strong> - survient à un certain stade de la demande et n'est détruit que lorsque la demande est terminée; </li><li>  <strong>temporaire</strong> - survient lorsqu'il est nécessaire d'effectuer une opération et est détruit lorsque cette opération est terminée; </li></ul><br><p>  À cet égard, dans la programmation, il existe des modèles de conception tels que: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">singleton</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">usine abstraite</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">constructeur</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">piscine</a> , ... </li></ul><br><p>  Autrement dit, de mon point de vue, l'application consiste en des solitaires existants en permanence qui effectuent eux-mêmes les opérations requises ou génèrent des objets temporaires pour les exécuter. </p><br><h1 id="konteyner-obektov">  Conteneur d'objets </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'injection de dépendances</a> est une approche qui facilite la création d'objets dans une application.  Autrement dit, dans l'application, il y a un objet spécial qui «sait» comment créer tous les autres objets.  Un tel objet est appelé un conteneur d'objets (parfois un gestionnaire d'objets). </p><br><p>  Le conteneur d'objets n'est pas un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">objet divin</a> , car  sa tâche est uniquement de créer des objets significatifs de l'application et de leur donner accès à d'autres objets.  La grande majorité des objets d'application, générés par le conteneur et situés dans celui-ci, n'ont aucune idée du conteneur lui-même.  Ils peuvent être placés dans n'importe quel autre environnement, pourvu des dépendances nécessaires, et ils fonctionneront également à merveille là-bas (les testeurs savent ce que je veux dire). </p><br><h1 id="mesto-vnedreniya">  Lieu d'exécution </h1><br><p>  Dans l'ensemble, il existe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deux façons</a> d'injecter des dépendances dans un objet: </p><br><ul><li>  par le constructeur; </li><li>  par une propriété (ou son accesseur); </li></ul><br><p>  J'ai essentiellement utilisé la première approche, donc je vais continuer la description avec le point de vue de l'injection de dépendance via le constructeur. </p><br><p>  Disons que nous avons une application composée de trois objets: </p><br><p><img src="https://habrastorage.org/webt/lv/5n/w4/lv5nw4nv1bperu7mgoxtn4luss4.png" alt="image"></p><br><p>  En PHP (ce langage avec des traditions DI de longue date, j'ai actuellement des bagages actifs, je vais passer à JS un peu plus tard) une situation similaire pourrait se refléter de cette manière: </p><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Config $config)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config = $config; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $service; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Config $config, Service $service)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config = $config; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;service = $service; } }</code> </pre> <br><p>  Ces informations doivent être suffisantes pour qu'un conteneur DI (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ligue / conteneur</a> ), s'il est configuré de manière appropriée, puisse, sur demande pour créer un objet <code>Application</code> , créer ses dépendances <code>Service</code> et <code>Config</code> et leur transmettre des paramètres au constructeur de l'objet <code>Application</code> . </p><br><h1 id="identifikatory-zavisimostey">  Identifiants de dépendance </h1><br><p>  Comment le conteneur d'objets comprend-il que le constructeur de l'objet <code>Application</code> nécessite deux objets <code>Config</code> et <code>Service</code> ?  En analysant l'objet via l'API Reflection ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Java</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PHP</a> ) ou en analysant directement le code objet (annotations de code).  Autrement dit, dans le cas général, nous pouvons déterminer les noms des variables que le constructeur d'objet s'attend à voir en entrée, et si le langage est typable, nous pouvons également obtenir les types de ces variables. </p><br><p>  Ainsi, en tant qu'identificateurs d'objets, le conteneur peut fonctionner avec les noms des paramètres d'entrée du constructeur ou les types de paramètres d'entrée. </p><br><h1 id="sozdanie-obektov">  Créer des objets </h1><br><p>  L'objet peut être créé explicitement par le programmeur et placé dans le conteneur sous l'identifiant correspondant (par exemple, "configuration") </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \League\Container\Container $container */</span></span> $container-&gt;add(<span class="hljs-string"><span class="hljs-string">"configuration"</span></span>, $config);</code> </pre> <br><p>  et peut être créé par le conteneur selon certaines règles spécifiques.  Ces règles, dans l'ensemble, se résument à faire correspondre l'identifiant de l'objet à son code.  Les règles peuvent être définies explicitement (mappage sous forme de code, XML, JSON, ...) </p><br><pre> <code class="json hljs">[ [<span class="hljs-string"><span class="hljs-string">"object_id_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"/path/to/source1.php"</span></span>], [<span class="hljs-string"><span class="hljs-string">"object_id_2"</span></span>, <span class="hljs-string"><span class="hljs-string">"/path/to/source2.php"</span></span>], ... ]</code> </pre> <br><p>  ou sous la forme d'un algorithme: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{. <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"/path/to/source/${id}.php"</span></span>; }</code> </pre> <br><p>  En PHP, les règles de correspondance d'un nom de classe à un fichier avec son code source sont standardisées ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PSR-4</a> ); en Java, la correspondance se fait au niveau de la configuration JVM ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chargeur de classe</a> ).  Si le conteneur fournit une recherche automatique des sources lors de la création d'objets, les noms de classe sont des identifiants suffisamment bons pour les objets dans un tel conteneur. </p><br><h1 id="namespaces">  Espaces de noms </h1><br><p>  Habituellement, dans un projet, en plus de son propre code, des modules tiers sont également utilisés.  Avec l'avènement des gestionnaires de dépendances (maven, composer, npm), l'utilisation des modules a été considérablement simplifiée et le nombre de modules dans les projets a considérablement augmenté.  Les espaces de noms permettent à des éléments de code du même nom d'exister dans un même projet à partir de différents modules (classes, fonctions, constantes). </p><br><p>  Il existe des langages dans lesquels l'espace de noms est intégré initialement (Java): </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> vendor.project.<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.folder;</code> </pre> <br><p>  Il existe des langages dans lesquels l'espace de noms a été ajouté lors du développement du langage (PHP): </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Vendor</span></span>\<span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">Module</span></span>\<span class="hljs-title"><span class="hljs-title">Folder</span></span>;</code> </pre> <br><p>  Une bonne implémentation d'espace de noms vous permet d'adresser sans ambiguïté n'importe quel élément du code: </p><br><pre> <code class="php hljs">\Doctrine\Common\Annotations\Annotation\Attribute::$name</code> </pre> <br><p>  L'espace de noms résout le problème de l'organisation de nombreux éléments logiciels dans un projet, et la structure de fichiers résout le problème de l'organisation des fichiers sur le disque.  Par conséquent, il n'y a pas seulement beaucoup de choses en commun entre eux, et parfois beaucoup - en Java, par exemple, une classe publique dans l'espace de noms doit être uniquement attachée à un fichier avec le code de cette classe. </p><br><p>  Ainsi, l'utilisation de l'identifiant d'une classe d'objet dans l'espace de noms du projet comme identifiants d'objet dans le conteneur est une bonne idée et peut servir de base pour créer des règles pour la détection automatique des codes source lors de la création de l'objet souhaité. </p><br><pre> <code class="php hljs">$container-&gt;add(\Vendor\Project\Module\ObjectType::class, $obj);</code> </pre> <br><h1 id="avtozagruzka-koda">  Démarrage du code </h1><br><p>  Dans PHP <code>composer</code> espace de noms <code>composer</code> module est mappé sur le système de fichiers à l'intérieur du module dans le descripteur du module <code>composer.json</code> : </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"autoload"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"psr-4"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Doctrine\\Common\\Annotations\\"</span></span>: <span class="hljs-string"><span class="hljs-string">"lib/Doctrine/Common/Annotations"</span></span> } }</code> </pre> <br><p>  La communauté JS pourrait effectuer un mappage similaire dans <code>package.json</code> s'il y avait des espaces de noms dans JS. </p><br><h1 id="identifikatory-zavisimostey-v-js">  Identifiants de dépendance JS </h1><br><p>  Ci-dessus, j'ai indiqué que le conteneur peut utiliser les noms des paramètres d'entrée du constructeur ou les types de paramètres d'entrée comme identificateurs.  Le problème est que: </p><br><ol><li>  JS est un langage à typage dynamique et ne permet pas de spécifier des types lors de la déclaration d'une fonction. </li><li>  JS utilise des minificateurs qui peuvent renommer les paramètres d'entrée. </li></ol><br><p>  Les développeurs du conteneur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">awilix</a> DI suggèrent d'utiliser l'objet comme seul paramètre d'entrée pour le constructeur, et les propriétés de cet objet comme dépendances: </p><br><pre> <code class="plaintext hljs">class UserController { constructor(opts) { this.userService = opts.userService } }</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'identificateur de</a> propriété d'objet dans JS peut être composé de caractères alphanumériques, "_" et "$", et ne peut pas commencer par un chiffre. </p><br><p>  Étant donné que nous devrons mapper les identificateurs de dépendance sur le chemin d'accès à leurs sources dans le système de fichiers pour le chargement automatique, il est préférable d'abandonner l'utilisation de "$" et d'utiliser l'expérience de PHP.  Avant que l'opérateur d' <code>namespace</code> n'apparaisse dans certains frameworks (par exemple, dans Zend 1), les noms suivants étaient utilisés pour les classes: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zend_Config_Writer_Json</span></span></span><span class="hljs-class"> </span></span>{...}</code> </pre> <br><p>  Ainsi, nous pourrions refléter notre application de trois objets ( <code>Application</code> , <code>Config</code> , <code>Service</code> ) sur JS quelque chose comme ceci: </p><br><pre> <code class="plaintext hljs">class Vendor_Project_Config { constructor() { } } class Vendor_Project_Service { constructor({Vendor_Project_Config}) { this.config = Vendor_Project_Config; } } class Vendor_Project_Application { constructor({Vendor_Project_Config, Vendor_Project_Service}) { this.config = Vendor_Project_Config; this.service = Vendor_Project_Service; } }</code> </pre> <br><p>  Si nous affichons le code de chaque classe: </p><br><pre> <code class="plaintext hljs">export default class Vendor_Project_Application { constructor({Vendor_Project_Config, Vendor_Project_Service}) { this.config = Vendor_Project_Config; this.service = Vendor_Project_Service; } }</code> </pre> <br><p>  dans votre dossier à l'intérieur de notre module projet: </p><br><ul><li> <code>./src/</code> <br> <ul><li> <code>./Application.js</code> </li> <li> <code>./Config.js</code> </li> <li> <code>./Service.js</code> </li> </ul></li></ul><br><p>  Ensuite, nous pouvons connecter le répertoire racine du module avec le "namespace" racine du module dans la configuration du conteneur: </p><br><pre> <code class="plaintext hljs">const ns = "Vendor_Project"; const path = path.join(module_root, "src"); container.addSourceMapping(ns, path);</code> </pre> <br><p>  puis, à partir de ces informations, construisez le chemin d'accès aux sources correspondantes ( <code>${module_root}/src/Config.js</code> ) en fonction de l'identificateur de dépendance ( <code>${module_root}/src/Config.js</code> ). </p><br><h1 id="es6-moduli">  Modules ES6 </h1><br><p>  ES6 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">propose une</a> conception générale pour le chargement des modules ES6: </p><br><pre> <code class="plaintext hljs">import { something } from 'path/to/source/with/something';</code> </pre> <br><p>  Comme nous devons attacher un objet (classe) à un fichier, il est logique dans la source d'exporter cette classe par défaut: </p><br><pre> <code class="plaintext hljs">export default class Vendor_Project_Path_To_Source_With_Something {...}</code> </pre> <br><p>  En principe, il est possible de ne pas écrire un nom aussi long pour la classe, juste <code>Something</code> fonctionnera aussi, mais dans Zend 1, ils ont écrit et ne se sont pas cassés, et l'unicité du nom de classe dans le projet affecte positivement les capacités de l'IDE (autocomplete et invites contextuelles), donc et lors du débogage: </p><br><p><img src="https://habrastorage.org/webt/qc/vj/wg/qcvjwg4lkvdwbg0nwcbmotantby.png" alt="image"></p><br><p>  L'importation d'une classe et la création d'un objet dans ce cas ressemble à ceci: </p><br><pre> <code class="plaintext hljs">import Something from 'path/to/source/with/something'; const something = new Something();</code> </pre> <br><h1 id="front--back-import">  Importation avant et arrière </h1><br><p>  L'importation fonctionne à la fois dans le navigateur et dans nodejs, mais il y a des nuances.  Par exemple, le navigateur ne comprend pas l'importation des modules nodejs: </p><br><pre> <code class="plaintext hljs">import path from "path";</code> </pre> <br><p>  Nous obtenons une erreur dans le navigateur: </p><br><pre> <code class="plaintext hljs">Failed to resolve module specifier "path". Relative references must start with either "/", "./", or "../".</code> </pre> <br><p>  Autrement dit, si nous voulons que notre code fonctionne à la fois dans le navigateur <strong>et dans</strong> nodejs, nous ne pouvons pas utiliser de constructions que le navigateur <strong>ou</strong> nodejs ne comprend pas.  Je me concentre spécifiquement sur cela, car une telle conclusion est trop naturelle pour y penser.  Comment respirer. </p><br><h1 id="mesto-di-v-sovremennyh-web-prilozheniyah">  La place de DI dans les applications web modernes </h1><br><p>  Ceci est purement mon opinion personnelle, en raison de mon expérience personnelle, comme tout le reste dans cette publication. </p><br><p>  Dans les applications Web, JS prend pratiquement sa place à l'avant, dans le navigateur, presque sans alternative.  Côté serveur, Java, PHP, .Net, Ruby, python, densément creusé ... Mais avec l'avènement de nodejs, JavaScript a également pénétré le serveur.  Et les technologies utilisées dans d'autres langages, y compris DI, ont commencé à pénétrer JS côté serveur. </p><br><p>  Le développement de JavaScript est dû au comportement asynchrone du code dans le navigateur.  L'asynchronie n'est pas une caractéristique exceptionnelle de JS, mais plutôt innée.  Désormais, la présence de JS sur le serveur et sur le devant ne surprend personne, mais encourage plutôt l'utilisation des mêmes approches aux deux extrémités de l'application Web.  Et le même code.  Bien sûr, l'avant et l'arrière sont trop différents par essence et dans les tâches à résoudre pour utiliser le même code là et là.  Mais nous pouvons supposer que dans une application plus ou moins complexe, il y aura un navigateur, un serveur et un code général. </p><br><p>  DI est déjà utilisé à l'avant, dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RequireJS</a> : </p><br><pre> <code class="plaintext hljs">define( ["./config", "./service"], function App(Config, Service) {} );</code> </pre> <br><p>  Certes, ici les identifiants des dépendances sont écrits explicitement et immédiatement sous forme de liens vers les sources (vous pouvez configurer le mappage des identifiants dans la configuration du chargeur de démarrage). </p><br><p>  Dans les applications Web modernes, DI existe non seulement côté serveur, mais aussi dans le navigateur. </p><br><h1 id="pri-chyom-tut-maykl-dzhekson">  Qu'est-ce que Michael Jackson a à voir avec ça? </h1><br><p>  Lorsque vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">activez la</a> prise en charge du module ES dans nodejs (indicateur <code>--experimental-modules</code> ), le moteur identifie le contenu des fichiers avec l' <code>*.mjs</code> tant que modules EcmaScript (contrairement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">aux modules communs</a> avec l' <code>*.cjs</code> ). </p><br><p>  Cette approche est parfois appelée « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Michael Jackson Solution</a> », et les scripts sont appelés Michael Jackson Scripts ( <code>*.mjs</code> ). </p><br><p>  Je suis d'accord que l'intrigue avec le KDPV a été résolue, mais ... le camon des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gars, Michael Jackson ...</a> </p><br><h1 id="yet-another-di-implementation">  Encore une autre implémentation DI </h1><br><p>  Eh bien, comme prévu, le vôtre <del>  le vélo </del>  Module DI - <a href="">@ teqfw / di</a> </p><br><p>  Ce n'est pas une solution prête à combattre, mais plutôt une mise en œuvre fondamentale.  Toutes les dépendances doivent être des modules ES et utiliser des fonctionnalités communes pour le navigateur et nodejs. </p><br><p>  Pour résoudre les dépendances, le module utilise l'approche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">awilix</a> : </p><br><pre> <code class="plaintext hljs">constructor(spec) { /** @type {Vendor_Module_Config} */ const _config = spec.Vendor_Module_Config; /** @type {Vendor_Module_Service} */ const _service = spec.Vendor_Module_Service; }</code> </pre> <br><p>  Pour exécuter l'exemple précédent: </p><br><pre> <code class="plaintext hljs">import Container from "./src/Container.mjs"; const container = new Container(); container.addSourceMapping("Vendor_Module", "../example"); container.get("Vendor_Module_App") .then((app) =&gt; { app.run(); });</code> </pre> <br><p>  sur le serveur: </p><br><pre> <code class="plaintext hljs">$ node --experimental-modules main.mjs</code> </pre> <br><p>  Pour exécuter l'exemple frontal ( <code>example.html</code> ): </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>DI in Browser<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./main.mjs"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Load main script './main.mjs', create new DI container, then get object by ID from container.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Open browser console to see output.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  vous devez placer le module sur le serveur et ouvrir la page <code>example.html</code> dans le navigateur (ou utiliser les capacités de l'EDI).  Si vous ouvrez directement <code>example.html</code> , l'erreur dans Chrom est la suivante: </p><br><pre> <code class="plaintext hljs">Access to script at 'file:///home/alex/work/teqfw.di/main.mjs' from origin 'null' has been blocked by CORS policy: Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension, https.</code> </pre> <br><p>  Si tout s'est bien passé, alors dans la console (navigateur ou nodejs) il y aura quelque chose comme ça: </p><br><pre> <code class="plaintext hljs">Create object with ID 'Vendor_Module_App'. Create object with ID 'Vendor_Module_Config'. There is no dependency with id 'Vendor_Module_Config' yet. 'Vendor_Module_Config' instance is created. Create object with ID 'Vendor_Module_Service'. There is no dependency with id 'Vendor_Module_Service' yet. 'Vendor_Module_Service' instance is created (deps: [Vendor_Module_Config]). 'Vendor_Module_App' instance is created (deps: [Vendor_Module_Config, Vendor_Module_Service]). Application 'Vendor_Module_Config' is running.</code> </pre> <br><h1 id="rezyume">  Résumé </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AMD, CommonJS, UMD?</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ESM</a> ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464347/">https://habr.com/ru/post/fr464347/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464331/index.html">Avantages inutiles: synthèse de produits chimiques absorbant les UV à partir de noix de cajou</a></li>
<li><a href="../fr464333/index.html">Suivi du cycle de vie des utilisateurs sans pince ni ruban électrique</a></li>
<li><a href="../fr464335/index.html">Tests unitaires dans SGBD - comment nous le faisons dans Sportmaster, première partie</a></li>
<li><a href="../fr464337/index.html">Comment contourner le captcha: réseau de neurones sur Tensorflow, Keras, captcha bruyant numérique python v</a></li>
<li><a href="../fr464345/index.html">5 raisons d'ouvrir une startup informatique en Allemagne</a></li>
<li><a href="../fr464351/index.html">Caméras IP PoE, exigences spéciales et fonctionnement sans problème - tout rassembler</a></li>
<li><a href="../fr464353/index.html">1C: ERP VS 1C: KA 2.0. Que devraient choisir les fabricants d'aliments?</a></li>
<li><a href="../fr464355/index.html">Comment une image est rendue dans Shadow Fight 3</a></li>
<li><a href="../fr464357/index.html">Blockchain aléatoire RSA</a></li>
<li><a href="../fr464359/index.html">Fonctionnalités de test des applications Web mobiles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>