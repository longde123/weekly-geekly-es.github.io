<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜí üö± üê§ Reduzindo tamanhos de pacotes com o Webpack Analyzer e React Lazy / Suspense üé´ üë©üèø‚Äçüî¨ üõï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä medida que a complexidade dos aplicativos clientes aumenta, o tamanho de seus pacotes configur√°veis ‚Äã‚Äãaumenta cada vez mais. Nessa situa√ß√£o, as pess...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reduzindo tamanhos de pacotes com o Webpack Analyzer e React Lazy / Suspense</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/468225/">  √Ä medida que a complexidade dos aplicativos clientes aumenta, o tamanho de seus pacotes configur√°veis ‚Äã‚Äãaumenta cada vez mais.  Nessa situa√ß√£o, as pessoas sofrem mais, for√ßadas, por v√°rias raz√µes, a usar conex√µes lentas com a Internet.  Al√©m disso, todos os dias s√≥ piora. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/yp/wc/u-/ypwcu-trdbiswrdeltqb677yqxk.jpeg"></a> <br><br>  O autor do artigo, cuja tradu√ß√£o publicamos hoje, trabalha no Wix.  Ele quer falar sobre como conseguiu reduzir o tamanho de um pacote em cerca de 80%, usando o Webpack Analyzer e o React Lazy / Suspense. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Qual a antecipa√ß√£o da otimiza√ß√£o?</font> </h2><br>  Se voc√™ acabou de come√ßar a trabalhar em seu novo aplicativo Web, provavelmente est√° tentando se concentrar em faz√™-lo, por assim dizer, "decolar", tentando faz√™-lo funcionar.  Voc√™ provavelmente n√£o presta muita aten√ß√£o ao desempenho ou no tamanho do pacote.  Eu entendo isso.  No entanto, minha experi√™ncia sugere que o desempenho e o tamanho dos pacotes devem ser resolvidos desde o in√≠cio.  Uma boa arquitetura de aplicativos e uma oportuna ‚Äúreflex√£o sobre o futuro do projeto‚Äù economizar√£o, a longo prazo, muito tempo e ajudar√£o a n√£o acumular s√©rias d√≠vidas t√©cnicas.  Obviamente, √© dif√≠cil "prever" tudo com anteced√™ncia, mas voc√™ deve se esfor√ßar ao m√°ximo para fazer tudo certo desde o primeiro dia de trabalho no projeto. <br><br>  Aqui est√£o algumas √≥timas ferramentas que eu acho que devem ser usadas desde o in√≠cio.  Essas ferramentas ajudar√£o voc√™ a reconhecer pacotes NPM "problem√°ticos" mesmo antes de ocuparem qualquer lugar importante no aplicativo. <br><br><h3>  <font color="#3AC1EF">UndBundlefobia</font> </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bundlephobia</a> √© um site que permite saber quanto um determinado pacote NPM aumentar√° o tamanho de um pacote.  Essa √© uma √≥tima ferramenta para ajudar o programador a tomar as decis√µes corretas em rela√ß√£o √† escolha de pacotes de terceiros que ele possa precisar.  A bundlephobia ajuda a projetar a arquitetura do aplicativo para que seu tamanho n√£o seja muito grande.  A figura a seguir mostra os resultados da verifica√ß√£o de uma biblioteca popular para trabalhar com o tempo, chamada momento.  Voc√™ pode ver que essa biblioteca √© bastante grande - quase 66 Kb na forma compactada.  Para muitos usu√°rios que trabalham com Internet de alta velocidade, isso n√£o √© nada.  No entanto, vale a pena prestar aten√ß√£o no que se torna o tempo de download deste pacote nas redes 2G / 3G.  S√£o respectivamente 2,2 e 1,32 segundos.  E, preste aten√ß√£o, estamos falando apenas deste pacote. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/298/eed/1c1298eed8992918c5314e651ea04032.png"></div><br>  <i><font color="#999999">Resultados da an√°lise de pacotes de momentos Bundlephobia</font></i> <br><br><h3>  <font color="#3AC1EF">CostCusto de importa√ß√£o</font> </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Custo de importa√ß√£o</a> √© uma extens√£o muito interessante para muitos editores de c√≥digo populares (possui mais de um milh√£o de downloads para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">VS Code</a> ).  Pode mostrar o "custo" dos pacotes importados.  Eu gosto especialmente porque ajuda a identificar √°reas problem√°ticas do aplicativo corretamente enquanto trabalha nele.  A figura a seguir (retirada da p√°gina GitHub de custo de importa√ß√£o) mostra um excelente exemplo do impacto nas dimens√µes do projeto de uma abordagem diferente para as entidades importadoras.  Portanto, importar a √∫nica propriedade <code>uniqueId</code> do Lodash leva √† importa√ß√£o de toda a biblioteca para o projeto (70 Kb).  E se voc√™ importar diretamente a fun√ß√£o <code>uniqueId</code> , apenas 2 Kb ser√£o adicionados ao tamanho do projeto.  Leia mais sobre o custo de importa√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8d1/488/bbb/8d1488bbb04afc1739a0a94967f74c2b.gif"></div><br>  <i><font color="#999999">O "custo" de importar toda a biblioteca Lodash para o projeto e apenas uma fun√ß√£o espec√≠fica dessa biblioteca</font></i> <br><br><h2>  <font color="#3AC1EF">O caso de pacotes excessivamente grandes</font> </h2><br>  Ent√£o, voc√™ criou seu aplicativo maravilhoso.  Funciona muito bem na Internet de alta velocidade e no computador mais poderoso, cheio de RAM.  Voc√™ lan√ßou no mundo real.  Depois de algum tempo, come√ßaram a surgir reclama√ß√µes suas ou de seus pr√≥prios analistas.  Essas reclama√ß√µes estavam relacionadas aos tempos de carregamento do aplicativo.  Algo semelhante aconteceu recentemente comigo quando n√≥s, no Wix, revelamos um novo recurso em que eu estava trabalhando. <br><br>  Para acelerar um pouco, vamos falar sobre esta nova oportunidade.  Essa √© uma nova barra de progresso localizada na parte superior do painel lateral da interface de configura√ß√µes do site do usu√°rio.  O objetivo desse mecanismo √© chamar a aten√ß√£o do usu√°rio para as v√°rias etapas que ele precisa executar para que seu projeto de neg√≥cios tenha uma melhor chance de sucesso (conex√£o com o SEO, adi√ß√£o de regi√µes nas quais os produtos s√£o entregues, adi√ß√£o do primeiro produto) e assim por diante). <br><br>  A barra de progresso √© atualizada automaticamente conectando-se ao servidor usando soquetes da web.  Quando o usu√°rio conclui todas as etapas recomendadas, uma janela pop-up √© exibida com parab√©ns.  Depois que essa janela √© fechada, a barra de progresso fica oculta e nunca √© exibida novamente ao trabalhar com o site em que voc√™ a usou.  √â disso que acabamos de falar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2eb/b42/282/2ebb4228298df39e9b83358aaa7ebaac.gif"></div><br>  <i><font color="#999999">Barra de progresso e janela de parab√©ns</font></i> <br><br>  O que aconteceu?  Por que nossos analistas se queixaram de que o tempo de carregamento da p√°gina aumentou?  Quando examinei o estado das coisas usando a guia Rede das ferramentas de desenvolvedor do Chrome, imediatamente ficou claro para mim que meu pacote era muito grande.  Ou seja, seu tamanho era de 190 Kb. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f13/0ce/631/f130ce631ea4399322aa95583c7b2fa5.png"></div><br>  <i><font color="#999999">Tamanho do pacote encontrado usando as Ferramentas do desenvolvedor do Chrome</font></i> <br><br>  "Por que essa coisinha precisa de um pacote relativamente grande?", Pensei.  Mas a verdade - por qu√™? <br><br><h3>  <font color="#3AC1EF">‚ñçProcure pontos problem√°ticos no pacote</font> </h3><br>  Depois que percebi que o tamanho do pacote √© muito grande, √© hora de descobrir o motivo disso.  √â aqui que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Webpack Bundle Analyzer</a> foi √∫til - uma √≥tima ferramenta para identificar √°reas problem√°ticas de pacotes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">configur√°veis</a> .  Ele abre uma nova guia do navegador e exibe informa√ß√µes de depend√™ncia. <br><br>  Foi o que aconteceu depois que analisei o pacote com esta ferramenta. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f17/465/f5f/f17465f5f21c29bbbb57f37373b0c92e.png"></div><br>  <i><font color="#999999">Resultados do Webpack Bundle Analyzer</font></i> <br><br>  Com a ajuda do analisador, consegui detectar o "criminoso".  O pacote lottie-web foi usado aqui, que adicionou 61,45 Kb ao tamanho do pacote.  Lottie √© uma biblioteca JavaScript muito boa que permite o uso de ferramentas padr√£o do navegador para gerar anima√ß√µes criadas no Adobe After Effect.  No meu caso, foi para que nosso designer precisasse de uma boa anima√ß√£o, que foi realizada quando a janela de parab√©ns apareceu.  Ele criou essa anima√ß√£o e me deu na forma de um arquivo JSON, que eu transferi para o pacote Lottie e recebi uma bela anima√ß√£o.  Al√©m do pacote lottie-web, eu tamb√©m tinha um arquivo JSON com descri√ß√µes de anima√ß√£o.  O tamanho deste arquivo era 26 Kb.  Como resultado, a biblioteca Lottie, o arquivo JSON e tamb√©m algumas pequenas depend√™ncias auxiliares ‚Äúme custam‚Äù aproximadamente 94 Kb.  E isso √© apenas uma anima√ß√£o da janela com parab√©ns ao usu√°rio.  O usu√°rio, quando viu esses parab√©ns, deveria estar feliz.  Tudo isso me deixou triste. <br><br><h2>  <font color="#3AC1EF">A tecnologia React Lazy / Suspense vem em socorro</font> </h2><br>  Depois que eu descobri a causa do problema, chegou a hora de resolv√™-lo.  Ficou claro que n√£o era necess√°rio carregar, no in√≠cio do trabalho, tudo o que era necess√°rio para a anima√ß√£o.  De fato, havia uma chance consider√°vel de que, durante a sess√£o atual do usu√°rio, ele n√£o tivesse que mostrar uma janela com parab√©ns.  Ent√£o me familiarizei com as tecnologias React Lazy / Suspense, recentemente exibidas, e pensei que agora provavelmente tinha uma boa oportunidade de test√°-las. <br><br>  Se voc√™ n√£o estiver familiarizado com o conceito de componentes "pregui√ßosos" (pregui√ßosos), saiba que o significado deles √© dividir o aplicativo em pequenos peda√ßos de c√≥digo.  O download desses fragmentos √© realizado apenas quando necess√°rio.  No meu caso, isso foi expresso no fato de que eu precisava selecionar entre as principais fun√ß√µes funcionais da barra de progresso o componente respons√°vel por mostrar os parab√©ns.  Foi necess√°rio carregar esse componente apenas quando o usu√°rio concluiu a sequ√™ncia recomendada de etapas. <br><br>  O React 16.6.0 (e vers√µes mais recentes) possui uma API simples projetada para renderizar componentes pregui√ßosos.  Estes s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">React.lazy e React.Suspense</a> .  Considere um exemplo: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OtherComponent = React.lazy(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-string"><span class="hljs-string">'./OtherComponent'</span></span>)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (    <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">      </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">React.Suspense</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">fallback</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Loading...</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">}&gt;        </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">OtherComponent</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">      </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">React.Suspense</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  ); }</span></span></code> </pre> <br>  Temos um componente que exibe o elemento <code>&lt;div&gt;</code> e nele existe um componente <code>Suspense</code> que envolve o componente <code>OtherComponent</code> .  Se voc√™ observar a primeira linha deste exemplo, poder√° ver que <code>OtherComponent</code> n√£o <code>OtherComponent</code> importado diretamente para o c√≥digo.  Normalmente, uma importa√ß√£o como essa se parece com <code>import OtherComponent from './OtherComponent';</code>  . <br><br>  Em vez disso, o comando import √© estruturado como uma fun√ß√£o que utiliza um caminho de arquivo.  Esse mecanismo funciona porque o Webpack possui ferramentas de separa√ß√£o de c√≥digo integradas.  Quando uma constru√ß√£o semelhante est√° presente no c√≥digo, √© retornada uma promessa que, ap√≥s o download do arquivo, √© resolvida com o conte√∫do desse arquivo.  Nossa equipe de importa√ß√£o est√° envolvida em uma fun√ß√£o <code>React.lazy</code> . <br><br>  Nos materiais de renderiza√ß√£o retornados por <code>MyComponent</code> , <code>OtherComponent</code> envolvido em um componente <code>React.Suspense</code> que possui uma propriedade de <code>fallback</code> .  No nosso caso, acontece que quando a renderiza√ß√£o atinge <code>OtherComponent</code> , o carregamento do componente correspondente √© iniciado.  Enquanto isso, o que √© gravado na propriedade <code>fallback</code> √© renderizado.  Neste exemplo, este √© o texto <code>Loading‚Ä¶</code>  Isso, de fato, √© tudo.  Esses mecanismos apenas fazem seu trabalho. <br><br>  √â verdade que existem alguns recursos que voc√™ precisa considerar ao trabalhar com o Lazy / Suspense. <br><br><ol><li>  Um componente importado de forma "lenta" deve conter a exporta√ß√£o padr√£o, que ser√° o ponto de entrada do componente.  As exporta√ß√µes nomeadas n√£o podem ser usadas aqui. </li><li>  Voc√™ precisa <code>React.lazy</code> o componente importado usando a fun√ß√£o <code>React.lazy</code> no componente <code>React.Suspense</code> .  O componente <code>React.Suspense</code> fornecer a propriedade <code>fallback</code> .  Caso contr√°rio, ocorrer√° um erro.  No entanto, se voc√™ simplesmente n√£o deseja renderizar nada at√© que o componente termine o carregamento lento, basta escrever <code>null</code> no <code>fallback</code> sem tentar contornar a necessidade de escrever algo nesta propriedade de alguma maneira complicada. </li></ol><br><h2>  <font color="#3AC1EF">O uso do React Lazy / Suspense me ajudou?</font> </h2><br>  Sim, isso ajudou!  A divis√£o de c√≥digo funcionou de maneira surpreendente.  Vamos dar uma olhada nos resultados da an√°lise do novo pacote usando o Webpack. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21e/502/fff/21e502fffa9544e33a750a8d23c33ede.png"></div><br>  <i><font color="#999999">Resultados do Webpack Bundle Analyzer ap√≥s divis√£o de c√≥digo</font></i> <br><br>  Como voc√™ pode ver, o tamanho do meu pacote diminuiu cerca de 50% - para 96 ‚Äã‚ÄãKb.  √ìtimo! <br><br>  E agora, o problema est√° resolvido?  Infelizmente n√£o.  Quando olhei para a p√°gina, constatou-se que o pop-up com parab√©ns perdeu o posicionamento. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b9/4a0/25d/3b94a025d8577c55a2d973928acf7c5f.png"></div><br>  <i><font color="#999999">A janela de parab√©ns n√£o aparece onde voc√™ precisa</font></i> <br><br>  O problema foi que eu "pedi" a janela para abrir, alterando o estado do componente React.  Enquanto isso, j√° processei <code>null</code> (ou seja, n√£o <code>React.Suspense</code> nada) usando o componente <code>React.Suspense</code> .  Ap√≥s o carregamento lento dos dados necess√°rios, os materiais relevantes foram adicionados ao DOM.  No entanto, o posicionamento do pop-up j√° foi feito.  Como resultado, devido ao fato de as propriedades do componente correspondente n√£o terem sido alteradas, esse componente ‚Äún√£o sabia‚Äù que precisava resolver o problema referente ao posicionamento.  Se eu alterasse o tamanho da janela do navegador, a janela pop-up aparecia no lugar certo devido ao fato de o componente correspondente estar observando altera√ß√µes nas propriedades e eventos de redimensionamento da janela, iniciando, se necess√°rio, reposicionando. <br><br>  Como resolver este problema?  A solu√ß√£o foi eliminar o "intermedi√°rio". <br><br>  Eu tive que carregar primeiro o componente "pregui√ßoso" e s√≥ depois escrever para o estado que informaria a janela com os parab√©ns que ele precisa abrir.  Consegui fazer isso usando os mesmos mecanismos de compartilhamento de c√≥digo do Webpack, mas agora - sem implementar importa√ß√µes usando o <code>React.lazy</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> loadAndSetHappyMoment() {  <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(    <span class="hljs-string"><span class="hljs-string">'../SidebarHappyMoment/SidebarHappyMoment.component'</span></span>  );  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SidebarHappyMoment = component.SidebarHappyMoment;  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({    <span class="hljs-attr"><span class="hljs-attr">tooltipLevel</span></span>: TooltipLevel.happyMoment,  }); }</code> </pre> <br>  Essa fun√ß√£o √© chamada depois que meu componente, por meio do mecanismo de soquetes da web, √© informado de que precisa mostrar uma janela com parab√©ns.  Eu usei a fun√ß√£o de <code>import</code> do Webpack (segunda linha de c√≥digo).  Se voc√™ se lembra, eu disse acima que esta fun√ß√£o retorna uma promessa, como resultado, eu pude usar a constru√ß√£o <code>async/await</code> . <br><br>  Ap√≥s o carregamento do componente, escrevo-o na inst√¢ncia do meu componente (com o comando <code>this.SidebarHappyMoment = component.SidebarHappyMoment;</code> ).  Isso me d√° a oportunidade de us√°-lo mais tarde ao renderizar.  Observe que agora posso usar exporta√ß√µes nomeadas.  No meu caso, usei, na linha acima, o nome <code>SidebarHappyMoment</code> .  E, finalmente, e isso n√£o √© menos importante do que tudo o resto, "informo" a janela que ele precisa abrir, alterando seu estado de acordo depois que eu souber que o componente est√° pronto para opera√ß√£o. <br><br>  Como resultado, o c√≥digo de renderiza√ß√£o agora fica assim: <br><br><pre> <code class="javascript hljs">renderTooltip() {  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.tooltipLevel === TooltipLevel.happyMoment) {    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">this.SidebarHappyMoment</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">;  }  // ... }</span></span></code> </pre> <br>  Observe que o comando <code>return &lt;this.SidebarHappyMoment /&gt;;</code>  retorna <code>this.SidebarHappyMoment</code> - o que escrevi anteriormente na inst√¢ncia do meu componente.  Agora, essa √© uma fun√ß√£o de renderiza√ß√£o s√≠ncrona normal, a mesma que voc√™ usou um milh√£o de vezes.  E agora a janela com parab√©ns √© exibida exatamente onde deve ser exibida.  E o fato √© que ele √© aberto somente ap√≥s o conte√∫do estar pronto para uso. <br><br><h2>  <font color="#3AC1EF">Produto define arquitetura</font> </h2><br>  Se a id√©ia no cabe√ßalho desta se√ß√£o despertou um grande ponto de interroga√ß√£o em sua imagina√ß√£o, lembre-se de que esse √© o caso.  O produto define a arquitetura. <br><br>  √â sobre o fato de que o produto define o que deve ser vis√≠vel e interativo quando o componente √© renderizado pela primeira vez.  Isso ajuda o desenvolvedor a descobrir o que exatamente ele pode separar do c√≥digo principal e carregar mais tarde, quando necess√°rio.  Pensei na situa√ß√£o e lembrei-me de que, depois que o usu√°rio conclui as etapas recomendadas para configurar o site, ou se ele n√£o √© o administrador do site, n√£o preciso mostrar a barra de progresso e o que h√° com ela conectado.  Agora, usando essas informa√ß√µes, eu pude continuar compartilhando o pacote.  Foi o que eu consegui. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36f/5f2/eb9/36f5f2eb91ead3a7188f5d5162d75b3e.png"></div><br>  <i><font color="#999999">A separa√ß√£o cont√≠nua do pacote</font></i> <br><br>  Depois disso, o tamanho do pacote foi de apenas 38 Kb.  E lembro que come√ßamos com 190 Kb.  H√° uma redu√ß√£o no tamanho do pacote em 80%.  E, a prop√≥sito, j√° vejo outras possibilidades de separa√ß√£o de c√≥digo.  Mal posso esperar para continuar otimizando o pacote. <br><br><h2>  <font color="#3AC1EF">Sum√°rio</font> </h2><br>  Os desenvolvedores t√™m a capacidade de se esfor√ßar para permanecer em sua "zona de conforto" e n√£o se aprofundar em nada al√©m do dispositivo do c√≥digo em si e de sua funcionalidade.  No entanto, um programador que usa as ferramentas descritas acima, pensa de forma criativa e trabalha em estreita colabora√ß√£o com outros especialistas, pode melhorar o desempenho de seu aplicativo reduzindo significativamente o tamanho do pacote que cont√©m o necess√°rio para come√ßar a trabalhar com esse aplicativo. <br><br>  <b>Caros leitores!</b>  Voc√™ usa a divis√£o de c√≥digo para acelerar o carregamento de seus aplicativos da web? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt468225/">https://habr.com/ru/post/pt468225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt468211/index.html">‚ÄúEu s√≥ queria fazer uma piada, mas ningu√©m entendeu‚Äù ou como n√£o me enterrar na apresenta√ß√£o do projeto</a></li>
<li><a href="../pt468213/index.html">tinc-boot - rede de malha completa sem dor</a></li>
<li><a href="../pt468217/index.html">Dr. Jekyll e Sr. Hyde Cultura Corporativa</a></li>
<li><a href="../pt468219/index.html">Mecanismos de extensibilidade extens√≠vel em JavaScript</a></li>
<li><a href="../pt468223/index.html">Habr Weekly # 19 / BT-door para o gato, por que a IA est√° enganando, o que perguntar ao futuro empregador, um dia com o iPhone 11 Pro</a></li>
<li><a href="../pt468227/index.html">Acelera√ß√£o instagram.com. Parte 1</a></li>
<li><a href="../pt468229/index.html">Uma observa√ß√£o sobre o vazio no JavaScript e TypeScript</a></li>
<li><a href="../pt468231/index.html">A seguran√ßa no AEM √© um problema de plataforma ou implementa√ß√£o?</a></li>
<li><a href="../pt468233/index.html">A maneira de digitar a verifica√ß√£o de 4 milh√µes de linhas de c√≥digo Python. Parte 1</a></li>
<li><a href="../pt468235/index.html">A maneira de digitar a verifica√ß√£o de 4 milh√µes de linhas de c√≥digo Python. Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>