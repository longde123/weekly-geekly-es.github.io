<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÜ üë©üèæ‚Äç‚öñÔ∏è üé≥ 5 maneiras de criar um servidor Python em um Raspberry Pi Parte 2 ‚ö´Ô∏è ü§ΩüèΩ üàπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Habr. 

 Hoje continuaremos estudando os recursos de rede do Raspberry Pi, ou melhor, sua implementa√ß√£o em Python. Na primeira parte, examinamos as...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>5 maneiras de criar um servidor Python em um Raspberry Pi Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472464/">  Oi Habr. <br><br>  Hoje continuaremos estudando os recursos de rede do Raspberry Pi, ou melhor, sua implementa√ß√£o em Python.  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">primeira parte,</a> examinamos as fun√ß√µes b√°sicas do servidor Web mais simples em execu√ß√£o no Raspberry Pi.  Agora vamos al√©m e consideramos v√°rias maneiras de tornar nosso servidor interativo. <br><br><img src="https://habrastorage.org/webt/el/mj/q2/elmjq2v_pe9vuinjagdxacuz2u0.png"><br><br>  O artigo foi desenvolvido para iniciantes. <a name="habracut"></a><br><br>  Antes de come√ßar algumas notas. <br><br>  Antes de tudo, duvidei de que valia a pena fazer uma sequ√™ncia e esperava <i>um</i> maior fluxo de cr√≠ticas e classifica√ß√µes baixas, mas como a pesquisa mostrou na primeira parte, 85% dos leitores acharam as informa√ß√µes fornecidas √∫teis.  Entendo que alguns artigos profissionais para ‚Äúmanequins‚Äù s√£o irritantes, mas todos come√ßaram uma vez, ent√£o voc√™ tem que esperar. <br><br>  Em segundo lugar, vou escrever sobre programa√ß√£o, n√£o sobre administra√ß√£o.  Portanto, os problemas de configura√ß√£o do Raspbian, configura√ß√µes, VPN, seguran√ßa e outras coisas n√£o ser√£o considerados aqui.  Embora isso tamb√©m seja importante, n√£o se pode abra√ßar o imenso.  Ser√° apenas sobre Python, e como criar um servidor nele. <br><br>  Aqueles que n√£o estiverem interessados ‚Äã‚Äãpodem clicar no bot√£o voltar no navegador agora mesmo e n√£o perder seu precioso tempo;) <br><br>  E n√≥s come√ßaremos. <br><br>  Deixe-me lembr√°-lo que na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">parte anterior</a> acabamos lan√ßando um servidor Web simples no Raspberry Pi, mostrando uma p√°gina est√°tica: <br><br><img src="https://habrastorage.org/webt/9y/ur/j9/9yurj9o1c452hvs930r3kdlpyng.png" alt="imagem"><br><br>  Agora iremos al√©m e tornaremos nosso servidor interativo, adicionar controle de LED √† p√°gina da web.  Obviamente, em vez do LED, pode haver qualquer outro dispositivo que possa ser controlado pelo GPIO, mas com o LED √© mais f√°cil conduzir um experimento. <br><br><h2>  Prepara√ß√£o </h2><br>  N√£o vou descrever como conectar o LED ao Raspberry Pi, qualquer um pode encontr√°-lo no Google em 5 minutos.  Vamos escrever v√°rias fun√ß√µes para usar o GPIO de uma s√≥ vez, que depois inserimos em nosso servidor. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RPi.GPIO <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> GPIO <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ModuleNotFoundError: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> led_pin = <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">raspberrypi_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: GPIO.setmode(GPIO.BCM) GPIO.setup(led_pin, GPIO.OUT) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rasperrypi_pinout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: int, value: bool)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"LED ON"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">"LED OFF"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: GPIO.output(pin, value) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rasperrypi_cleanup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: GPIO.cleanup() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br>  Como voc√™ pode ver, cada fun√ß√£o de chamada GPIO √© "empacotada" em um bloco try-catch.  Por que isso √© feito?  Isso permite depurar o servidor em qualquer PC, incluindo o Windows, o que √© bastante conveniente.  Agora podemos inserir essas fun√ß√µes no c√≥digo do servidor da web. <br><br>  Nossa tarefa √© adicionar bot√µes √† p√°gina da web que nos permitem controlar o LED no navegador.  Ser√£o consideradas tr√™s formas de implementa√ß√£o. <br><br><h2>  M√©todo 1: Errado </h2><br>  Este m√©todo n√£o pode ser chamado de bonito, mas √© curto e mais f√°cil de entender. <br><br>  Crie uma linha com uma p√°gina HTML. <br><br><pre> <code class="python hljs">html = <span class="hljs-string"><span class="hljs-string">'''&lt;html&gt; &lt;style&gt;html{font-family: Helvetica; display:inline-block; margin: 0px auto; text-align: center;} .button_led {display: inline-block; background-color: #e7bd3b; border: none; border-radius: 4px; color: white; padding: 16px 40px; text-decoration: none; font-size: 30px; margin: 2px; cursor: pointer;} &lt;/style&gt; &lt;body&gt; &lt;h2&gt;Hello from the Raspberry Pi!&lt;/h2&gt; &lt;p&gt;&lt;a href="/led/on"&gt;&lt;button class="button button_led"&gt;Led ON&lt;/button&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/led/off"&gt;&lt;button class="button button_led"&gt;Led OFF&lt;/button&gt;&lt;/a&gt;&lt;/p&gt; &lt;/body&gt; &lt;/html&gt;'''</span></span></code> </pre> <br>  H√° tr√™s pontos a serem observados aqui: <br><br><ul><li>  Usamos CSS para especificar o estilo dos bot√µes.  Voc√™ n√£o pode fazer isso e se dar bem com apenas 4 linhas de c√≥digo HTML, mas nossa p√°gina se pareceria com "sauda√ß√µes dos anos 90": <br><br><img src="https://habrastorage.org/webt/cc/fc/qu/ccfcquo-kundjijwwobgpqpea_c.png"></li><li>  Para cada bot√£o, criamos um link local como / led / on e / led / off </li><li>  A mistura de recursos e c√≥digo √© um estilo de programa√ß√£o ruim e, idealmente, √© melhor manter o HTML separado do c√≥digo Python.  Mas meu objetivo √© mostrar um c√≥digo minimamente funcional, no qual exista um m√≠nimo de sup√©rfluo, para que algumas coisas sejam omitidas por simplicidade.  Al√©m disso, √© conveniente quando o c√≥digo pode ser simplesmente copiado de um artigo, sem qualquer problema com arquivos adicionais. </li></ul><br>  J√° examinamos o servidor na parte anterior, resta adicionar o processamento das linhas '/ led / on' e '/ led / off' a ele.  C√≥digo inteiro atualizado: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> http.server <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseHTTPRequestHandler, HTTPServer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseHTTPRequestHandler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"GET request, Path:"</span></span>, self.path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/off"</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/on"</span></span>): rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/off"</span></span>): rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>) self.end_headers() self.wfile.write(html.encode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_error(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"Page Not Found {}"</span></span>.format(self.path)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">server_thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(port)</span></span></span><span class="hljs-function">:</span></span> server_address = (<span class="hljs-string"><span class="hljs-string">''</span></span>, port) httpd = HTTPServer(server_address, ServerHandler) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: httpd.serve_forever() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyboardInterrupt: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> httpd.server_close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: port = <span class="hljs-number"><span class="hljs-number">8000</span></span> print(<span class="hljs-string"><span class="hljs-string">"Starting server at port %d"</span></span> % port) raspberrypi_init() server_thread(port) rasperrypi_cleanup()</code> </pre><br>  Come√ßamos e, se tudo foi feito corretamente, podemos controlar o LED atrav√©s do nosso servidor da web: <br><br><img src="https://habrastorage.org/webt/np/f3/ip/npf3ipmqfd-movc084uxpgibhxa.png"><br><br>  Voc√™ pode testar o servidor n√£o apenas no Raspberry Pi, mas tamb√©m no Windows ou OSX; no console, haver√° mensagens LED ON, LED OFF quando voc√™ clicar no bot√£o correspondente: <br><br><img src="https://habrastorage.org/webt/bf/a1/hn/bfa1hne52ewrqpimi76d4bqyzxq.png"><br><br>  Agora descobrimos por que esse m√©todo √© ruim e por que est√° "errado".  Este exemplo √© bastante funcional e, muitas vezes, copiado em diferentes tutoriais.  Mas existem dois problemas - primeiro, √© errado recarregar a p√°gina inteira quando queremos apenas acender o LED.  Mas isso ainda √© metade do problema.  O segundo problema, e mais s√©rio, √© que, quando pressionamos o bot√£o para ligar o LED, o endere√ßo da p√°gina se torna <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://192.168.1.106:8000/led/on</a> .  Os navegadores geralmente lembram a √∫ltima p√°gina aberta e, da pr√≥xima vez que voc√™ abrir o navegador, o comando para ligar o LED funcionar√° novamente, mesmo que n√£o desej√°ssemos.  Portanto, seguiremos para o pr√≥ximo caminho, mais correto. <br><br><h2>  M√©todo 2: Direito </h2><br>  Para fazer tudo certo, colocamos as fun√ß√µes de ativa√ß√£o e desativa√ß√£o do LED em solicita√ß√µes separadas e as chamaremos de forma ass√≠ncrona usando Javascript.  O c√≥digo HTML da p√°gina agora ter√° a seguinte apar√™ncia: <br><br><pre> <code class="python hljs">html = <span class="hljs-string"><span class="hljs-string">'''&lt;html&gt; &lt;style&gt;html{font-family: Helvetica; display:inline-block; margin: 0px auto; text-align: center;} .button_led {display: inline-block; background-color: #e7bd3b; border: none; border-radius: 4px; color: white; padding: 16px 40px; text-decoration: none; font-size: 30px; margin: 2px; cursor: pointer;} &lt;/style&gt; &lt;script type="text/javascript" charset="utf-8"&gt; function httpGetAsync(method, callback) { var xmlHttp = new XMLHttpRequest(); xmlHttp.onreadystatechange = function() { if (xmlHttp.readyState == 4 &amp;&amp; xmlHttp.status == 200) callback(xmlHttp.responseText); } xmlHttp.open("GET", window.location.href + method, true); xmlHttp.send(null); } function ledOn() { console.log("Led ON..."); httpGetAsync("led/on", function(){ console.log("Done"); }); } function ledOff() { console.log("Led OFF..."); httpGetAsync("led/off", function(){ console.log("Done"); }); } &lt;/script&gt; &lt;body&gt; &lt;h2&gt;Hello from the Raspberry Pi!&lt;/h2&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOn();"&gt;Led ON&lt;/button&gt;&lt;/p&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOff();"&gt;Led OFF&lt;/button&gt;&lt;/p&gt; &lt;/body&gt; &lt;/html&gt;'''</span></span></code> </pre> <br>  Como voc√™ pode ver, abandonamos o href e chamamos as fun√ß√µes ledOn e ledOff, que, por sua vez, chamam os m√©todos correspondentes do servidor de forma ass√≠ncrona (m√©todos ass√≠ncronos s√£o necess√°rios para que a p√°gina n√£o seja bloqueada at√© que a resposta do servidor chegue). <br><br>  Agora resta adicionar o processamento de solicita√ß√£o de solicita√ß√£o ao servidor: <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"GET request, path:"</span></span>, self.path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>) self.end_headers() self.wfile.write(html.encode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/led/on"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>) self.end_headers() rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) self.wfile.write(<span class="hljs-string"><span class="hljs-string">b"OK"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/led/off"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>) self.end_headers() rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) self.wfile.write(<span class="hljs-string"><span class="hljs-string">b"OK"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_error(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"Page Not Found {}"</span></span>.format(self.path))</code> </pre> <br>  Agora, como voc√™ pode ver, a p√°gina n√£o recarrega mais quando voc√™ tenta acender o LED, cada m√©todo faz apenas o que deve fazer. <br><br><h2>  M√©todo 3: Mais correto </h2><br>  Tudo parece estar funcionando j√°.  Mas √© claro que o c√≥digo acima pode (e deve) ser aprimorado.  O fato √© que usamos solicita√ß√µes GET para controlar o LED.  Isso economiza espa√ßo no c√≥digo, mas metodologicamente isso n√£o est√° totalmente correto - as solicita√ß√µes GET s√£o projetadas para <i>ler dados</i> do servidor, podem ser armazenadas em cache pelo navegador e, geralmente, n√£o devem ser usadas para <i>modificar</i> dados.  A maneira correta √© usar o POST (para aqueles que est√£o interessados ‚Äã‚Äãem detalhes, mais detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.w3schools.com/tags/ref_">aqui</a> ). <br><br>  Mudaremos as chamadas em HTML de chegar para postar, mas, ao mesmo tempo, como nosso c√≥digo √© ass√≠ncrono, exibiremos o status de aguardar a resposta do servidor e exibir os resultados do trabalho.  Para uma rede local, isso n√£o ser√° percept√≠vel, mas para uma conex√£o lenta √© muito conveniente.  Para torn√°-lo mais interessante, usaremos JSON para passar par√¢metros. <br><br>  A vers√£o final √© assim: <br><br><pre> <code class="python hljs">html = <span class="hljs-string"><span class="hljs-string">'''&lt;html&gt; &lt;style&gt;html{font-family: Helvetica; display:inline-block; margin: 0px auto; text-align: center;} .button_led {display: inline-block; background-color: #e7bd3b; border: none; border-radius: 4px; color: white; padding: 16px 40px; text-decoration: none; font-size: 30px; margin: 2px; cursor: pointer;} &lt;/style&gt; &lt;script type="text/javascript" charset="utf-8"&gt; function httpPostAsync(method, params, callback) { var xmlHttp = new XMLHttpRequest(); xmlHttp.onreadystatechange = function() { if (xmlHttp.readyState == 4 &amp;&amp; xmlHttp.status == 200) callback(xmlHttp.responseText); else callback(`Error ${xmlHttp.status}`) } xmlHttp.open("POST", window.location.href + method, true); xmlHttp.setRequestHeader("Content-Type", "application/json"); xmlHttp.send(params); } function ledOn() { document.getElementById("textstatus").textContent = "Making LED on..."; httpPostAsync("led", JSON.stringify({ "on": true }), function(resp) { document.getElementById("textstatus").textContent = `Led ON: ${resp}`; }); } function ledOff() { document.getElementById("textstatus").textContent = "Making LED off..."; httpPostAsync("led", JSON.stringify({ "on": false }), function(resp) { document.getElementById("textstatus").textContent = `Led OFF: ${resp}`; }); } &lt;/script&gt; &lt;body&gt; &lt;h2&gt;Hello from the Raspberry Pi!&lt;/h2&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOn();"&gt;Led ON&lt;/button&gt;&lt;/p&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOff();"&gt;Led OFF&lt;/button&gt;&lt;/p&gt; &lt;span id="textstatus"&gt;Status: Ready&lt;/span&gt; &lt;/body&gt; &lt;/html&gt;'''</span></span></code> </pre> <br>  Adicione suporte para solicita√ß√µes GET e POST ao servidor: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseHTTPRequestHandler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"GET request, path:"</span></span>, self.path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>) self.end_headers() self.wfile.write(html.encode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_error(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"Page Not Found {}"</span></span>.format(self.path)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_POST</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> content_length = int(self.headers[<span class="hljs-string"><span class="hljs-string">'Content-Length'</span></span>]) body = self.rfile.read(content_length) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: print(<span class="hljs-string"><span class="hljs-string">"POST request, path:"</span></span>, self.path, <span class="hljs-string"><span class="hljs-string">"body:"</span></span>, body.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/led"</span></span>: data_dict = json.loads(body.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'on'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data_dict: rasperrypi_pinout(led_pin, data_dict[<span class="hljs-string"><span class="hljs-string">'on'</span></span>]) self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>) self.end_headers() self.wfile.write(<span class="hljs-string"><span class="hljs-string">b"OK"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-string"><span class="hljs-string">'Bad Request: Method does not exist'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>, <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>) self.end_headers() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> err: print(<span class="hljs-string"><span class="hljs-string">"do_POST exception: %s"</span></span> % str(err))</code> </pre> <br>  Como voc√™ pode ver, agora usamos uma fun√ß√£o led, na qual o par√¢metro "on" √© passado usando json, que aceita True ou False (quando chamado em HTML, uma string json do formato {"on": true} √© transmitida, respectivamente).  Tamb√©m vale a pena prestar aten√ß√£o ao try-catch - isso impede que o servidor caia, por exemplo, se algu√©m enviar uma string com json inv√°lido ao servidor. <br><br>  Se tudo foi feito corretamente, obtemos um servidor com feedback, que deve ser algo como isto: <br><br><img src="https://habrastorage.org/webt/2b/tz/nv/2btznv4uxbfp8hhu4yxljcbfztc.png"><br><br>  O feedback, no nosso caso, a mensagem "OK", permite que voc√™ veja a confirma√ß√£o do servidor de que o c√≥digo foi realmente processado. <br><br>  Este servidor ainda pode ser melhorado?  Voc√™ pode, por exemplo, fazer sentido substituir o uso da fun√ß√£o de impress√£o pelo uso de log, isso √© mais correto e permite exibir os logs do servidor n√£o apenas na tela, mas tamb√©m se voc√™ deseja grav√°-los em um arquivo com rota√ß√£o autom√°tica.  Quem desejar pode fazer isso por conta pr√≥pria. <br><br><h2>  Conclus√£o </h2><br>  Se tudo foi feito corretamente, obteremos um mini-servidor que permite controlar o LED ou qualquer outro dispositivo atrav√©s de um navegador a partir de qualquer dispositivo de rede. <br><br>  <b>Importante: Precau√ß√µes de seguran√ßa</b> <br><br>  Mais uma vez, observo que n√£o h√° prote√ß√£o ou autentica√ß√£o aqui; portanto, voc√™ n√£o deve "postar" uma p√°gina na Internet se planeja gerenciar uma carga mais ou menos respons√°vel.  Embora os casos de ataques a esses servidores sejam desconhecidos para mim, ainda n√£o vale a pena dar a quem quiser abrir remotamente a porta da garagem ou ligar o aquecedor de quilowatt.  Se voc√™ deseja controlar remotamente atrav√©s dessa p√°gina, vale a pena configurar uma VPN ou algo semelhante. <br><br>  Concluindo, repito que o material foi desenvolvido para iniciantes e espero que isso tenha sido mais ou menos √∫til.  √â claro que nem todo mundo em Khabr est√° satisfeito com a disponibilidade de artigos "para manequins", portanto, se a pr√≥xima parte depender√° ou n√£o das notas finais.  Se houver, ele considerar√° as estruturas Flask e WSGI, bem como os m√©todos b√°sicos de autentica√ß√£o. <br><br>  Todas as experi√™ncias bem sucedidas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt472464/">https://habr.com/ru/post/pt472464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt472446/index.html">Como fazer a cor correta do c√≥digo em "Habr√©" e por que √© t√£o dif√≠cil</a></li>
<li><a href="../pt472448/index.html">Temas da se√ß√£o Frontend no DUMP Kazan: ML para um desenvolvedor front-end, pixel magic, SvelteJS, risos, suor e l√°grimas</a></li>
<li><a href="../pt472452/index.html">Como adicionar suporte para o per√≠odo de car√™ncia (per√≠odo de car√™ncia de cobran√ßa) no aplicativo iOS?</a></li>
<li><a href="../pt472454/index.html">Vis√£o geral de servidores VPS baratos</a></li>
<li><a href="../pt472462/index.html">iFest em N√≠jni Novgorod: TI √© impressionante</a></li>
<li><a href="../pt472466/index.html">Classificar por distribui√ß√£o</a></li>
<li><a href="../pt472468/index.html">ClusterJ - trabalhando com o MySQL NDB Cluster de Java</a></li>
<li><a href="../pt472470/index.html">Camundongos transg√™nicos e antienvelhecimento</a></li>
<li><a href="../pt472472/index.html">Casa de campo no inverno: ser ou n√£o ser?</a></li>
<li><a href="../pt472474/index.html">Erro cosm√©tico engra√ßado no Google Chrome</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>