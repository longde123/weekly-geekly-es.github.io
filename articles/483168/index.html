<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï¥üèø üó®Ô∏è üï∏Ô∏è C√≥mo hacer un bot que convierta una foto en un c√≥mic. Segunda parte Entrenamiento modelo ‚ÜîÔ∏è üôåüèæ üë®üèΩ‚Äçü§ù‚Äçüë®üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚á® La primera parte 
 ‚á® Tercera parte 

 Hola de nuevo 

 Como puede ver, las vacaciones han paralizado la l√≠nea de tiempo de los art√≠culos. 
 Creo que...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo hacer un bot que convierta una foto en un c√≥mic. Segunda parte Entrenamiento modelo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483168/">  <a href="https://habr.com/ru/post/479218/">‚á® La primera parte</a> <br>  <a href="https://habr.com/ru/post/485824/">‚á® Tercera parte</a> <br><br>  Hola de nuevo <br><br>  Como puede ver, las vacaciones han paralizado la l√≠nea de tiempo de los art√≠culos. <br>  Creo que muchos durante este tiempo lograron, si no entrenaron completamente su modelo, al menos experimentaron con diferentes conjuntos de datos. <br><blockquote>  1. Pon la distribuci√≥n <br>  2. Descargando fotos <br>  3. ??? <br>  4. Beneficio! <br></blockquote>  Si no estaba a la altura de estas de nuestras redes neuronales, o si comienza a leer este art√≠culo, entonces, como dicen, no hay tiempo para explicarlo, tomamos el kit de distribuci√≥n, descargamos las im√°genes necesarias y ¬°vamos! <br><a name="habracut"></a><br>  Las instrucciones detalladas se encuentran <a href="https://habr.com/ru/post/479218/">en el art√≠culo anterior de la serie</a> . <br><br><h2>  El primer panqueque es grumoso </h2><br>  Cuando <a href="https://t.me/photo2comicsbot" rel="nofollow">entren√©</a> el modelo para <a href="https://t.me/photo2comicsbot" rel="nofollow">@ photo2comicsbot</a> por primera vez, sin m√°s pre√°mbulos, simplemente met√≠ alrededor de 1000 p√°ginas de c√≥mics en un conjunto de datos. <br>  S√≠, junto con portadas, anuncios y otros rellenos. <br><br>  En la entrada se ve√≠a as√≠: <br><br><img src="https://habrastorage.org/webt/vs/7t/p8/vs7tp8lqmuevcrv_3cpuzbyaef4.png"><br><br>  El resultado es correspondiente: <br><br><img src="https://habrastorage.org/webt/2s/sf/5s/2ssf5st8mk1oge_9rrfbyepmlhk.png"><br><br><img src="https://habrastorage.org/webt/7x/dl/kp/7xdlkpn70yzd8qfljqusgn6jy5y.png"><br><br><img src="https://habrastorage.org/webt/ll/ll/v8/llllv8gmtfys_udt5euohplcjzw.png"><br><br><div class="spoiler">  <b class="spoiler_title">M√°s fotos</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tl/ey/8e/tley8enuh1qlcjt3nc7e9-wnzse.png"><br><br><img src="https://habrastorage.org/webt/2u/cz/5n/2ucz5nwpenvhonfh84m080tj_t0.png"><br><br><img src="https://habrastorage.org/webt/o7/qb/xt/o7qbxtxqcrgdcih_4m-ysiksd_e.png"><br><br><img src="https://habrastorage.org/webt/xc/-8/yl/xc-8ylyfuk71me4v59xxvn3qhj4.png"><br><br><img src="https://habrastorage.org/webt/ys/zx/vm/yszxvm-2hc8xt6rjsvvxcpuyy3w.png"><br><br><img src="https://habrastorage.org/webt/jl/p9/3t/jlp93trm26hwitdzgmdt_kylhfw.png"><br><br><img src="https://habrastorage.org/webt/3l/fb/y6/3lfby6xuenl47xlggsv9n2p9hss.png"><br><br><img src="https://habrastorage.org/webt/bq/mt/sd/bqmtsdr7xedmcxsogpa4j8olk8c.png"><br><br></div></div><br>  El modelo transmite perfectamente las diferencias generales entre c√≥mics y fotos: <br><br><ul><li>  Graduaci√≥n de color t√≠pica </li><li>  Selecci√≥n de esquema </li><li>  Bloqueo </li><li>  Nube de texto </li></ul><br>  En principio, esta opci√≥n puede ser suficiente para la producci√≥n. <br><br>  Pero me preguntaba qu√© resultados se pueden obtener en un conjunto de datos m√°s "limpio". <br><br><h2>  Toma dos </h2><br>  Para el siguiente experimento, dej√© las p√°ginas con un bloque, y del resto cort√© las piezas m√°s grandes, que consisten en un bloque, para eliminar las l√≠neas divisorias verticales y horizontales en el modelo final. <br><blockquote>  Si realiza cambios en su conjunto de datos, por ejemplo, elimina o agrega fotos, no olvide guardar la versi√≥n anterior.  Tendr√° un lugar para regresar si algo sale mal. </blockquote>  El segundo conjunto de datos se ve√≠a as√≠: <br><br><img src="https://habrastorage.org/webt/ww/j9/8f/wwj98fxmy0d15c0xgxfz8w9bfs4.png"><br><br>  El resultado, como dicen, es obvio: <br><br><img src="https://habrastorage.org/webt/zn/b3/sc/znb3sczf0ypubx8jya-uryrqbxm.png"><br><br><img src="https://habrastorage.org/webt/xp/n9/zv/xpn9zvimruobxodr4wa2vhrutxk.png"><br><br><img src="https://habrastorage.org/webt/xh/nf/sp/xhnfspsgqrkxvuvhdkj7vaqz5yy.png"><br><br><div class="spoiler">  <b class="spoiler_title">M√°s fotos</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ag/6b/pw/ag6bpwlw1xefb9o8igrdixarhqc.png"><br><br><img src="https://habrastorage.org/webt/h7/xb/di/h7xbdiuyzdmukmjalf3o6rdou8e.png"><br><br><img src="https://habrastorage.org/webt/by/j8/zk/byj8zkaujwhx52po8xqw37un2oo.png"><br><br><img src="https://habrastorage.org/webt/pl/po/0y/plpo0yucjtvt0sbfc-pefnxz940.png"><br><br><img src="https://habrastorage.org/webt/65/4f/el/654fellkdx6_ebimev8ardha_e0.png"><br><br><img src="https://habrastorage.org/webt/zj/9u/vq/zj9uvqeres9m1kr2nmzcpgt-8uc.png"><br></div></div><br>  Las l√≠neas divisorias desaparecieron, pero con ellas la expresividad qued√≥ en las nubes con el texto: comenzaron a encontrarse con mucha menos frecuencia en el conjunto de datos y dejaron de ser la caracter√≠stica principal. <br><br>  El espacio vac√≠o que sol√≠a estar lleno de texto ahora est√° lleno de ruido psicod√©lico. <br><br><h2>  La tercera es la vencida </h2><br>  Decid√≠ deshacerme del texto por completo, dejando solo aquellas partes de los c√≥mics donde no est√°.  Nadie sobrevivi√≥: sin nubes, sin titulares o nombres de series. <br><br>  Conjunto de datos despu√©s del "genocidio ling√º√≠stico": <br><br><img src="https://habrastorage.org/webt/zu/pw/az/zupwaz8q1toeo9qvqncmfamino8.png"><br><br>  El resultado final: <br><br><img src="https://habrastorage.org/webt/9s/o2/qg/9so2qgo6e6jpkdazfsqf2wlu1-w.png"><br><br><img src="https://habrastorage.org/webt/gs/nr/7p/gsnr7pfyfu4bcowe0bpyqlqn1vc.png"><br><br><img src="https://habrastorage.org/webt/me/vs/m6/mevsm6y3hlgvrvsa8qce0xhenqa.png"><br><br><div class="spoiler">  <b class="spoiler_title">M√°s fotos</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/uv/hn/ua/uvhnuapobrpzdu8fxhyjqnz-ozg.png"><br><br><img src="https://habrastorage.org/webt/w1/gu/2e/w1gu2enojimz-lrpkzrzlkvihv8.png"><br><br><img src="https://habrastorage.org/webt/_e/j0/91/_ej091msilwm4hhlmbl3j7nw6sq.png"><br><br><img src="https://habrastorage.org/webt/ql/o6/th/qlo6thuiesfbqx_f2yx6yanf4ne.png"><br><br><img src="https://habrastorage.org/webt/cm/xg/4t/cmxg4tu9jp4-6dcjvjp2nwei3gq.png"><br></div></div><br>  Por un lado, hay menos artefactos, por otro, la expresividad se ha ido.  Como en la capacitaci√≥n GAN la calidad del resultado est√° determinada en gran medida por usted y por m√≠, no existe una receta √∫nica para un buen modelo. <br><br>  La belleza est√° en el ojo del espectador, as√≠ que no tengas miedo de experimentar y elegir lo que m√°s te guste. <br><br><h2>  ¬°Al arma! </h2><br>  Bueno, ya hemos hablado sobre las principales trampas y m√©todos para lidiar con ellas, es hora de poner manos a la obra. <br><br>  Vaya a la carpeta donde descargamos la distribuci√≥n.  D√©jame recordarte que se llamaba <b>pytorch-CycleGAN-and-pix2pix</b> <br><br>  Como tenemos instrucciones para tontos, no tocaremos el c√≥digo de distribuci√≥n, ya que todos los par√°metros necesarios se pueden configurar desde la l√≠nea de comandos. <br><br>  En esta distribuci√≥n, el entrenamiento predeterminado se lleva a cabo en m√°s de doscientas eras, con una atenuaci√≥n lineal de la tasa de aprendizaje despu√©s de la cent√©sima √©poca. <br><blockquote>  La resoluci√≥n m√°xima que mi tarjeta de ocho gigabytes pudo dominar fue de 400x400.  El entrenamiento completo me llev√≥ unas 33 horas, por lo que utilizaremos un peque√±o truco de vida.  Primero, entrenaremos a la modelo en im√°genes de 128x128, luego 256x256, y solo en la etapa final le mostraremos nuestra hermosa 400x400. <br>  La primera etapa durar√° 100 eras, la segunda y la tercera, 50 cada una, lo que nos permitir√° reducir el tiempo de entrenamiento a casi la mitad. <br><br>  Como muestra la pr√°ctica, el resultado con este enfoque no es peor, y a veces mejor, que cuando se entrena inmediatamente a la m√°xima resoluci√≥n. </blockquote>  Quiz√°s suficiente teor√≠a, es hora de pasar a la pr√°ctica. <br><br>  En el s√≠mbolo del sistema, ingrese. <br><br><h3>  Etapa uno </h3><br><pre><code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 128 --load_size 180 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 4</code> </pre> <br>  <i>No olvides reemplazar las llaves con tus propios valores.</i> <i><br></i> <br>  Analizaremos algunos par√°metros con m√°s detalle: <br><br><pre> <code class="bash hljs">--batch_size {number}</code> </pre> <br>  Este par√°metro es responsable del n√∫mero de im√°genes procesadas por ciclo, afectando positivamente la velocidad y negativamente en la glotoner√≠a del modelo. <br><br>  En cada etapa, seleccione el m√°ximo posible --batch_size, que no causa errores debido a la falta de memoria de la GPU. <br><br><pre> <code class="bash hljs">-- dataroot {dataset root folder}</code> </pre> <br>  - carpeta con nuestro conjunto de datos.  En su interior deben estar las carpetas trainA, trainB, testA, testB, como se describe en el art√≠culo anterior. <br><br><pre> <code class="bash hljs">--name {model name}</code> </pre> <br>  - El nombre de tu proyecto.  Puede ser arbitrario, pero recomiendo incluir la arquitectura del modelo, la resoluci√≥n m√°xima y el nombre del conjunto de datos en el nombre. <br>  Por ejemplo: "resnet9_128to400_comics8" <br>  Entonces puede distinguir entre experimentos con varios par√°metros y datos. <br><br>  La primera etapa del entrenamiento se puede detener en la cent√©sima era. <br><br>  Puede observar el progreso desde el navegador: <a href="http://localhost/" rel="nofollow">localhost</a> : 8097 / <br>  (u otro enlace que ser√° visible en la consola) <br><br><h3>  Etapa dos </h3><br><pre> <code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 256 --load_size 290 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 2 --epoch 100 --epoch_count 0 --continue_train</code> </pre> <br>  Es importante indicar la √©poca en que terminamos nuestros estudios en la primera etapa. <br>  ‚Äú--Epoch 100‚Äù significa que cargaremos el modelo desde el punto de control de la cent√©sima era <br>  "--Epoch_count 0" significa que comenzaremos a entrenar desde cero, con la m√°xima velocidad de aprendizaje. <br><br>  La segunda etapa del entrenamiento se puede detener en la era 50. <br><br><h3>  Etapa tres </h3><br><pre> <code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 400 --load_size 430 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 1 --epoch 50 --epoch_count 0 --continue_train</code> </pre> <br><br>  La tercera etapa del entrenamiento se puede detener en la era 50, pero esto es cuesti√≥n de gustos.  Puede terminar hasta el final y elegir el resultado intermedio que desee.  Es importante recordar que el resultado en la era 200 puede ser peor que en la 150. <br><br><h2>  Ahora sal y mira lo que has hecho </h2><br>  Durante el entrenamiento, el modelo y los resultados intermedios se guardar√°n en una carpeta <br>  / pytorch-CycleGAN-and-pix2pix / checkpoints / {nombre del modelo} <br><br>  Para probar el modelo, simplemente ingrese la l√≠nea de comando: <br><br><pre> <code class="bash hljs">python test.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --netG resnet_9blocks --crop_size 512 --load_size 580 --epoch {epoch name}</code> </pre> <br>  Puede ver el resultado en un conjunto de datos de prueba para cualquier punto de control, solo especif√≠quelo como {nombre de √©poca}.  Si no se especifica {nombre de √©poca}, se tomar√° el √∫ltimo punto de control. <br><br>  El resultado se guardar√° en la carpeta: <br> <code>/pytorch-CycleGAN-and-pix2pix/results/{model name}/test_{epoch name}</code> <br> <blockquote>  Para no confundirse qu√© modelo en qu√© conjunto de datos da qu√© resultado, <br>  Comience a llevar un peque√±o diario.  Registre datos de referencia y resultados de aprendizaje. <br><br>  Por ejemplo, la l√≠nea de comando y la era a la que ha llegado.  Estos datos son suficientes para guardar los par√°metros de entrenamiento y el conjunto de datos en el que entrenamos. <br><br>  Despu√©s de todo, ¬øcu√°l es la diferencia entre un experimento cient√≠fico y perder el tiempo?  ¬°El hecho de que todo est√° documentado con nosotros! </blockquote>  ¬°Eso es todo por hoy!  En el pr√≥ximo art√≠culo, aprenderemos c√≥mo exportar un modelo terminado y alojarlo en la nube. <br><br>  No tengas miedo de experimentar.  ¬°Aseg√∫rese de probar varios conjuntos de datos diferentes, compare los resultados y comp√°rtalos en los comentarios! <br><br>  Hasta pronto! <br><br>  <a href="https://habr.com/ru/post/485824/">‚á® Siguiente parte</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/483168/">https://habr.com/ru/post/483168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../483148/index.html">Discutimos gemelos digitales y simulaci√≥n con el fundador de una empresa de consultor√≠a.</a></li>
<li><a href="../483154/index.html">Gast√© $ 40 mil y arruin√© una gran idea para una startup</a></li>
<li><a href="../483156/index.html">Pon al gato de pie</a></li>
<li><a href="../483160/index.html">Space 2020: Marte, constelaciones de sat√©lites y nuevos cohetes</a></li>
<li><a href="../483166/index.html">Detecci√≥n autom√°tica de codificaci√≥n de texto</a></li>
<li><a href="../483170/index.html">Base de datos de Messenger (parte 2): particionamos "beneficio"</a></li>
<li><a href="../483172/index.html">¬øC√≥mo localizar una aplicaci√≥n o juego? Las diez principales fuentes gratuitas de aprendizaje electr√≥nico</a></li>
<li><a href="../483174/index.html">Grabe y transfiera sonido de un dispositivo a otro utilizando la Conectividad Multipeer</a></li>
<li><a href="../483176/index.html">Base de datos de Messenger (parte 1): dise√±amos el marco base</a></li>
<li><a href="../483178/index.html">Aqu√≠ hay una actualizaci√≥n sobre la versi√≥n Flutter 1.9 junto con la programaci√≥n Dart 2.5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>