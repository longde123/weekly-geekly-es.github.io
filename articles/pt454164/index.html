<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëª üë©üèº‚Äçüîß üëâüèø Como o teste A / B funciona no Avito? üë≤üèº üíΩ üåÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal. Meu nome √© Danila, trabalho em uma equipe que desenvolve infraestrutura anal√≠tica no Avito. O ponto central dessa infraestrutura √© o test...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o teste A / B funciona no Avito?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/454164/"><p>  Ol√° pessoal.  Meu nome √© Danila, trabalho em uma equipe que desenvolve infraestrutura anal√≠tica no Avito.  O ponto central dessa infraestrutura √© o teste A / B. </p><br><p>  Os experimentos A / B s√£o uma ferramenta essencial para a tomada de decis√£o no Avito.  Em nosso ciclo de desenvolvimento de produtos, um teste A / B √© obrigat√≥rio.  Testamos todas as hip√≥teses e lan√ßamos apenas mudan√ßas positivas. </p><br><p>  Coletamos centenas de m√©tricas e podemos detalhar as se√ß√µes de neg√≥cios: verticais, regi√µes, usu√°rios autorizados, etc. Fazemos isso automaticamente usando uma √∫nica plataforma para experimentos.  No artigo, mostrarei em detalhes suficientes como a plataforma est√° organizada e abordaremos alguns detalhes t√©cnicos interessantes. </p><br><p><img src="https://habrastorage.org/webt/ts/r_/qw/tsr_qwh3l7qfw2kob14z0lsaiya.png"></p><a name="habracut"></a><br><p>  As principais fun√ß√µes da plataforma A / B s√£o formuladas da seguinte maneira. </p><br><ol><li>  Ajuda voc√™ a executar experi√™ncias rapidamente </li><li>  Controla interse√ß√µes indesejadas da experi√™ncia </li><li>  Conta m√©tricas, stat.  testa, visualiza resultados </li></ol><br><p>  Em outras palavras, a plataforma ajuda a tomar decis√µes sem erros mais rapidamente. </p><br><p>  Se deixarmos de lado o processo de desenvolvimento de recursos enviados para teste, o ciclo completo do experimento ser√° semelhante a este: </p><br><p><img src="https://habrastorage.org/webt/ve/wd/by/vewdbye97eexzetbj3riubs-i1w.png"></p><br><ul><li>  O cliente (analista ou gerente de produto) configura os par√¢metros da experi√™ncia atrav√©s do painel de administra√ß√£o. </li><li>  O servi√ßo de divis√£o, de acordo com esses par√¢metros, distribui o grupo A / B necess√°rio para o dispositivo cliente. </li><li>  As a√ß√µes do usu√°rio s√£o coletadas em logs brutos que passam por agrega√ß√£o e se transformam em m√©tricas. </li><li>  As m√©tricas s√£o executadas atrav√©s de testes estat√≠sticos. </li><li>  Os resultados s√£o visualizados no portal interno no dia seguinte ao lan√ßamento. </li></ul><br><p>  Todo o transporte de dados em um ciclo leva um dia.  Como regra, os experimentos duram uma semana, mas o cliente recebe um incremento de resultados todos os dias. </p><br><p>  Agora vamos mergulhar nos detalhes. </p><br><h1 id="upravlenie-eksperimentom">  Gerenciamento de experi√™ncias </h1><br><p>  O painel do administrador usa o formato YAML para configurar experimentos. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/lb/ko/k_/lbkok_pnexw8kzvdlkoq1jteuzy.png"></a> </p><br><p>  Esta √© uma solu√ß√£o conveniente para uma equipe pequena: a finaliza√ß√£o dos recursos da configura√ß√£o ocorre sem uma frente.  O uso de configura√ß√µes de texto simplifica o trabalho do usu√°rio: voc√™ precisa fazer menos cliques com o mouse.  Uma solu√ß√£o semelhante √© usada pela estrutura <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Airbnb A / B.</a> </p><br><p>  Para dividir o tr√°fego em grupos, usamos a t√©cnica comum de hash de sal. </p><br><p><img src="https://habrastorage.org/webt/fs/ar/r_/fsarr_kezrgckfiuvf1w1uyuqfs.png"></p><br><p>  Para eliminar o efeito de "mem√≥ria" dos usu√°rios, ao iniciar um novo experimento, fazemos uma mistura adicional com o segundo sal: </p><br><p><img src="https://habrastorage.org/webt/3-/qd/w0/3-qdw0xc2l0swwonorrgkfd_lpg.png"></p><br><p>  O mesmo princ√≠pio √© descrito na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">apresenta√ß√£o do Yandex</a> . </p><br><p>  Para evitar interse√ß√µes potencialmente perigosas de experimentos, usamos uma l√≥gica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">semelhante a "camadas" no Google</a> . </p><br><h1 id="sbor-metrik">  Cole√ß√£o de m√©tricas </h1><br><p>  Colocamos logs brutos no Vertica e os agregamos em tabelas de prepara√ß√£o com a estrutura: </p><br><p><img src="https://habrastorage.org/webt/v6/tw/bv/v6twbvgj-togpdbylpqq21gfbz0.png"></p><br><p>  As observa√ß√µes s√£o geralmente simples contadores de eventos.  As observa√ß√µes s√£o usadas como componentes na f√≥rmula de c√°lculo da m√©trica. </p><br><p>  A f√≥rmula para calcular qualquer m√©trica √© uma fra√ß√£o, cujo numerador e denominador √© a soma das observa√ß√µes: </p><br><p><img src="https://habrastorage.org/webt/me/sb/or/mesbordzixv0yrcl4oo5nho5aa4.png"></p><br><p>  Em um dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rios</a> da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Yandex, as</a> m√©tricas foram divididas em dois tipos: por usu√°rios e Propor√ß√£o.  Isso faz sentido para os neg√≥cios, mas na infraestrutura √© mais conveniente considerar todas as m√©tricas da mesma maneira que a Ratio.  Essa generaliza√ß√£o √© v√°lida, porque a m√©trica "posyuzerny" √© obviamente represent√°vel como uma fra√ß√£o: </p><br><p><img src="https://habrastorage.org/webt/d_/ih/l5/d_ihl5vdcvdguaohaytz5xkfepy.png"></p><br><p>  Resumimos as observa√ß√µes no numerador e denominador da m√©trica de duas maneiras. <br>  Simples: </p><br><p><img src="https://habrastorage.org/webt/q9/fk/vc/q9fkvc6qsmj6dzwqknqnqwpgrts.png"></p><br><p>  Essa √© a quantidade usual de qualquer conjunto de observa√ß√µes: o n√∫mero de pesquisas, cliques em an√∫ncios etc. <br>  E mais complicado: </p><br><p><img src="https://habrastorage.org/webt/iu/_s/ru/iu_srukdm2pyxrvoizc68butlx8.png"></p><br><p>  Um n√∫mero exclusivo de chaves, no agrupamento pelo qual o total de observa√ß√µes √© maior que um determinado limite. </p><br><p>  Essas f√≥rmulas s√£o facilmente definidas usando a configura√ß√£o YAML: </p><br><p><img src="https://habrastorage.org/webt/ga/i3/qj/gai3qjape-xmwg2pyfg0snj6lao.png"></p><br><p>  Os par√¢metros groupby e threshold s√£o opcionais.  Apenas eles determinam o segundo m√©todo de soma. </p><br><p>  Os padr√µes descritos permitem configurar quase todas as m√©tricas online que voc√™ puder imaginar.  Ao mesmo tempo, √© preservada uma l√≥gica simples que n√£o imp√µe uma carga excessiva na infraestrutura. </p><br><h1 id="statisticheskiy-kriteriy">  Crit√©rio Estat√≠stico </h1><br><p>  Medimos a signific√¢ncia dos desvios por m√©tricas usando os m√©todos cl√°ssicos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">teste T, teste</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">U de Mann-Whitney</a> .  A principal condi√ß√£o necess√°ria para a aplica√ß√£o desses crit√©rios √© que as observa√ß√µes na amostra n√£o dependam uma da outra.  Em quase todas as nossas experi√™ncias, acreditamos que os usu√°rios (Uid) atendem a essa condi√ß√£o. </p><br><p><img src="https://habrastorage.org/webt/v-/ya/nz/v-yanzyx8c--fqqgnzkhlkg4j0c.png"></p><br><p>  Agora, surge a pergunta: como realizar o teste T e o teste MW para m√©tricas de rela√ß√£o?  Para o teste T, voc√™ precisa ler a varia√ß√£o da amostra e, para MW, a amostra deve ser "definida pelo usu√°rio". </p><br><p><img src="https://habrastorage.org/webt/d-/7j/p2/d-7jp2xfsktkjajzki-wrp8sugw.png"></p><br><p>  Resposta: voc√™ precisa expandir a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rela√ß√£o em uma s√©rie de Taylor para a primeira ordem em um ponto</a> <math> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>E</mi></mrow><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy=&quot;false&quot;>[</mo><mi>X</mi><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>E</mi></mrow><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy=&quot;false&quot;>[</mo><mi>Y</mi><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="33.139ex" height="2.66ex" viewBox="0 -832 14268.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-45" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-6C" x="1404" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-65" x="1702" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-66" x="2169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-74" x="2719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMAIN-5B" x="3081" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-58" x="3359" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-72" x="4462" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-69" x="4913" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-67" x="5259" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-68" x="5739" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-74" x="6316" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMAIN-5D" x="6677" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMAIN-2C" x="6956" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-45" x="7401" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-6C" x="8415" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-65" x="8714" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-66" x="9180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-74" x="9731" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMAIN-5B" x="10092" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-59" x="10371" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-72" x="11384" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-69" x="11836" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-67" x="12181" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-68" x="12662" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMATHI-74" x="13238" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMAIN-5D" x="13600" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;usg=ALkJrhgMkhmozespLC7OWtSeYxNk1trQsQ#MJMAIN-29" x="13878" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi>E</mi></mrow><mtext>&nbsp;</mtext><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy="false">[</mo><mi>X</mi><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="false">]</mo><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi>E</mi></mrow><mtext>&nbsp;</mtext><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy="false">[</mo><mi>Y</mi><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> ({E} \ left [X \ right], {E} \ left [Y \ right]) </script>   : </p><br><p><img src="https://habrastorage.org/webt/ky/im/td/kyimtdhnynvygcu_r867uzeoubu.png"></p><br><p>  Essa f√≥rmula converte duas amostras (numerador e denominador) em uma, preservando a m√©dia e a vari√¢ncia (assintoticamente), o que permite o uso de estat√≠sticas cl√°ssicas.  testes. </p><br><p><img src="https://habrastorage.org/webt/il/h3/ac/ilh3acbdbdjnszyjezba85ee4ku.png"></p><br><p>  Uma id√©ia semelhante √© chamada pelos colegas de Yandex de m√©todo de lineariza√ß√£o da rela√ß√£o (apari√ß√µes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√∫nicas</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">duas</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vezes</a> ). </p><br><h1 id="proizvoditelnost-pri-masshtabirovanii">  Escalando o desempenho </h1><br><p>  Usando r√°pido para o status da CPU.  O crit√©rio permite realizar milh√µes de itera√ß√µes (compara√ß√µes de tratamento versus controle) em minutos em um servidor completamente comum com 56 n√∫cleos.  Por√©m, no caso de grandes volumes de dados, o desempenho repousa, antes de tudo, no armazenamento e no tempo de leitura do disco. </p><br><p>  O c√°lculo di√°rio das m√©tricas Uid gera amostras com um tamanho total de centenas de bilh√µes de valores (devido ao grande n√∫mero de experimentos simult√¢neos, centenas de m√©tricas e acumula√ß√£o acumulada).  √â problem√°tico extrair esses volumes do disco todos os dias (apesar do grande cluster da base da coluna Vertica).  Portanto, somos for√ßados a reduzir a cardinalidade dos dados.  Mas fazemos isso quase sem perda de informa√ß√µes sobre a varia√ß√£o usando uma t√©cnica chamada "Bucket". </p><br><p>  A id√©ia √© simples: n√≥s temos os Uids e, de acordo com o restante da divis√£o, ‚Äúos dispersamos‚Äù em v√°rios baldes (denotamos seu n√∫mero por B): </p><br><p><img src="https://habrastorage.org/webt/cd/1h/x-/cd1hx-k8rgilkmwxafotz3-tgok.png"></p><br><p>  Agora passamos para a nova unidade experimental - o balde.  Resumimos as observa√ß√µes no intervalo (o numerador e o denominador s√£o independentes): </p><br><p><img src="https://habrastorage.org/webt/yv/jq/bz/yvjqbz34yd8yswtoff50zpgj3g0.png"></p><br><p>  Com essa transforma√ß√£o, a condi√ß√£o de independ√™ncia das observa√ß√µes √© cumprida, o valor da m√©trica n√£o muda e √© f√°cil verificar se a varia√ß√£o da m√©trica (m√©dia sobre a amostra de observa√ß√µes) √© preservada: </p><br><p><img src="https://habrastorage.org/webt/df/ku/6p/dfku6pb74plagc0doxg62blhdly.png"></p><br><p>  Quanto mais balde, menos informa√ß√µes s√£o perdidas e menor o erro de igualdade.  No Avito, tomamos B = 200. </p><br><p>  A densidade da distribui√ß√£o m√©trica ap√≥s a convers√£o do bucket sempre se torna semelhante ao normal. </p><br><p><img src="https://habrastorage.org/webt/fk/sa/rf/fksarfomowkwdzzhwveb10vbtr0.png"></p><br><p>  O n√∫mero de amostras grandes que voc√™ quiser pode ser reduzido para um tamanho fixo.  O crescimento da quantidade de dados armazenados neste caso depende apenas linearmente do n√∫mero de experimentos e m√©tricas. </p><br><h1 id="vizualizaciya-rezultatov">  Visualiza√ß√£o de Resultados </h1><br><p>  Como ferramenta de visualiza√ß√£o, usamos o Tableau e a visualiza√ß√£o na web no Tableau Server.  Todo funcion√°rio da Avito tem acesso l√°.  Observe que o Tableau faz bem o trabalho.  Implementar uma solu√ß√£o semelhante usando um desenvolvimento completo de tr√°s / frente seria uma tarefa muito mais intensiva em recursos. </p><br><p>  Os resultados de cada experimento s√£o uma folha de v√°rios milhares de n√∫meros.  A visualiza√ß√£o deve permitir minimizar conclus√µes incorretas no caso da implementa√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">erros de primeiro e segundo tipos</a> e, ao mesmo tempo, n√£o "perder" as altera√ß√µes em m√©tricas e se√ß√µes importantes. </p><br><p>  Primeiro, monitoramos as m√©tricas de "sa√∫de" dos experimentos.  Ou seja, respondemos √†s perguntas: "√â verdade que os participantes foram" despejados "em cada um dos grupos?", "√â igual aos usu√°rios novos ou autorizados?" </p><br><p> <a href=""><img src="https://habrastorage.org/webt/k1/-r/-x/k1-r-xrjn1gyeg8-o6-9eolq-qe.png"></a> </p><br><p>  No caso de desvios estatisticamente significativos, as c√©lulas correspondentes s√£o destacadas.  Quando voc√™ passa o mouse sobre qualquer n√∫mero, a din√¢mica cumulativa do dia √© exibida. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ju/ke/z0/jukez0yfvsmoyu_gmpy384rsmzc.png" width="600"></a> </p><br><p>  O painel principal com m√©tricas fica assim: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ng/mb/ju/ngmbjufio9wsbf0mnpld0ldqajq.png"></a> </p><br><p>  Cada linha √© uma compara√ß√£o de grupos por uma m√©trica espec√≠fica em uma se√ß√£o espec√≠fica.  √Ä direita, h√° um painel com filtros para experimentos e m√©tricas.  Painel de filtro da se√ß√£o inferior. </p><br><p>  Cada compara√ß√£o de m√©tricas consiste em v√°rias m√©tricas.  Vamos analisar seus valores da esquerda para a direita: </p><br><p>  <strong>1. MDE.</strong>  <strong>Efeito Detect√°vel M√≠nimo</strong> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/sy/xw/gk/syxwgkaimg-pgsqtnrriv8ybf5e.png"></a> </p><br><p>  ‚ç∫ e Œ≤ s√£o probabilidades de erro pr√©-selecionadas do primeiro e do segundo tipo.  O MDE √© muito importante se a altera√ß√£o n√£o for estatisticamente significativa.  Ao tomar uma decis√£o, o cliente deve se lembrar da falta de estat√≠sticas.  signific√¢ncia n√£o √© equivalente a nenhum efeito.  De maneira confi√°vel, podemos apenas dizer que o poss√≠vel efeito n√£o passa de MDE. </p><br><p>  <strong>2. MW |</strong>  <strong>Resultados dos testes U e T T. Mann-Whitney</strong> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/za/vs/j8/zavsj8pnzmrazz-maz_lucwjrti.png"></a> </p><br><p>  O painel exibe o valor das estat√≠sticas z e t (para MW e T, respectivamente).  Em uma dica de ferramenta - din√¢mica de valor p.  Se a altera√ß√£o for significativa, a c√©lula ser√° destacada em vermelho ou verde, dependendo do sinal da diferen√ßa entre os grupos.  Nesse caso, dizemos que a m√©trica √© "colorida". </p><br><p>  <strong>3. Levante.</strong>  <strong>Diferen√ßa percentual entre grupos</strong> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/cr/db/fk/crdbfkcytwrjdzez3l-v1gu1c8e.png"></a> </p><br><p>  <strong>4. m√©dia |</strong>  <strong>Num |</strong>  <strong>Den</strong>  <strong>Valor m√©trico, bem como numerador e denominador separadamente</strong> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/8d/kc/wp/8dkcwpugkmf6f6qqdrmnksp-rda.png"></a> </p><br><p>  Aplicamos outro teste T ao numerador e denominador, o que ajuda a entender cuja contribui√ß√£o √© decisiva. </p><br><p>  <strong>5. Padr√£o</strong>  <strong>Desvio padr√£o seletivo</strong> <br>  <strong>6. Hist.</strong>  <strong>Teste de Shapiro-Wilk para normalidade da distribui√ß√£o "bucket".</strong> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/0d/dh/h6/0ddhh68_mdhgjpb6dyufnucnmfc.png"></a> </p><br><p>  Se o indicador estiver vermelho, talvez a amostra tenha valores discrepantes ou cauda anormalmente longa.  Nesse caso, voc√™ precisa levar o resultado de acordo com essa m√©trica com cuidado, ou de modo algum.  Clicar no indicador abre o histograma da m√©trica por grupo.  O histograma mostra claramente anomalias - √© mais f√°cil tirar conclus√µes. </p><br><h1 id="zaklyuchenie">  Conclus√£o </h1><br><p>  O surgimento da plataforma A / B em Avito √© um divisor de √°guas quando nosso produto come√ßou a crescer mais rapidamente.  Todos os dias fazemos experimentos ecol√≥gicos que cobram √† equipe;  e "vermelhos", que fornecem alimento saud√°vel para o pensamento. </p><br><p>  Conseguimos construir um sistema eficaz de testes e m√©tricas A / B.  Muitas vezes, resolv√≠amos problemas complexos com m√©todos simples.  Devido a essa simplicidade, a infraestrutura possui uma boa margem de seguran√ßa. </p><br><p>  Tenho certeza de que aqueles que v√£o construir a plataforma A / B em sua empresa encontraram algumas id√©ias interessantes no artigo.  Tenho o prazer de compartilhar nossa experi√™ncia com voc√™. </p><br><p>  Escreva perguntas e coment√°rios - tentaremos respond√™-las. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454164/">https://habr.com/ru/post/pt454164/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454144/index.html">No Java 13, eles querem adicionar "blocos de texto"</a></li>
<li><a href="../pt454148/index.html">Verificando o desempenho do SOC</a></li>
<li><a href="../pt454154/index.html">"Ramos do inferno": controle em nuvem de aterros ilegais e aterros perigosos</a></li>
<li><a href="../pt454156/index.html">Pneus e protocolos em automa√ß√£o industrial: como tudo funciona</a></li>
<li><a href="../pt454160/index.html">Usando o PowerShell para aumentar os privil√©gios da conta local</a></li>
<li><a href="../pt454166/index.html">6 de junho - F√≥rum VeeamON em Moscou</a></li>
<li><a href="../pt454168/index.html">A principal arena do pa√≠s. Como foram atualizados Luzhniki antes da Copa do Mundo</a></li>
<li><a href="../pt454170/index.html">Bem-vindo ao DroidHeads Meetup 8 de junho</a></li>
<li><a href="../pt454172/index.html">Enviando estat√≠sticas de um DataFrame para o BigQuery usando as estat√≠sticas Yandex.Direct como um exemplo</a></li>
<li><a href="../pt454176/index.html">Uibook - uma ferramenta de teste visual para componentes React com consultas de m√≠dia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>