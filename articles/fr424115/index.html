<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÜüèø ‚öúÔ∏è üí≠ Cas d'utilisation ou manque d'√©quilibreurs de charge üõÉ üè™ üì¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a quelques ann√©es, j'ai r√©alis√© un projet de migration dans le r√©seau d'un de nos clients, la t√¢che √©tait de changer de plateforme, qui r√©partit ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cas d'utilisation ou manque d'√©quilibreurs de charge</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424115/">  Il y a quelques ann√©es, j'ai r√©alis√© un projet de migration dans le r√©seau d'un de nos clients, la t√¢che √©tait de changer de plateforme, qui r√©partit la charge entre les serveurs.  Le sch√©ma de prestation de services de ce client a √©volu√© pendant pr√®s de 10 ans, parall√®lement aux nouveaux d√©veloppements dans l'industrie des centres de donn√©es, de sorte que le ¬´pointilleux¬ª, dans le bon sens du terme, attendait du client une solution qui satisferait non seulement aux exigences de tol√©rance aux pannes des √©quipements r√©seau, des √©quilibreurs de charge et des serveurs. , mais poss√©derait √©galement des propri√©t√©s telles que l'√©volutivit√©, la flexibilit√©, la mobilit√© et la simplicit√©.  Dans cet article, je vais essayer de pr√©senter de mani√®re coh√©rente, du plus simple au plus complexe, les principaux exemples d'utilisation d'√©quilibreurs de charge sans r√©f√©rence au fabricant, √† leurs fonctionnalit√©s et m√©thodes de couplage avec le r√©seau de transmission de donn√©es. <br><a name="habracut"></a><br>  Les √©quilibreurs de charge sont d√©sormais de plus en plus appel√©s contr√¥leurs de distribution d'applications (ADC).  Mais si les applications s'ex√©cutent sur le serveur, pourquoi devraient-elles √™tre livr√©es quelque part?  Pour des raisons de tol√©rance aux pannes ou de mise √† l'√©chelle, l'application peut √™tre ex√©cut√©e sur plusieurs serveurs, dans ce cas, vous avez besoin d'une sorte de serveur proxy inverse qui cache la complexit√© interne aux consommateurs, s√©lectionne le serveur souhait√©, lui envoie une demande et s'assure que le serveur renvoie le bon. , du point de vue du protocole, le r√©sultat, sinon, il s√©lectionnera un autre serveur et y enverra une requ√™te.  Pour impl√©menter ces fonctions, l'ADC doit comprendre la s√©mantique du protocole de couche application avec lequel il fonctionne; cela vous permet de configurer des r√®gles sp√©cifiques √† l'application pour la livraison du trafic, l'analyse du r√©sultat et la v√©rification de l'√©tat du serveur.  Par exemple, une compr√©hension de la s√©mantique de HTTP rend la configuration possible lorsque des requ√™tes HTTP <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /docs/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Host: www.company.com Accept-<span class="hljs-keyword"><span class="hljs-keyword">Language</span></span>: en-us Accept-<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>: gzip, deflate</code> </pre> <br>  sont envoy√©s √† un groupe de serveurs avec compression ult√©rieure des r√©sultats, mise en cache et demandes <br><br><pre> <code class="hljs pgsql">POST /api/<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>-put HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> HOST: b2b.company.com X-Auth: <span class="hljs-number"><span class="hljs-number">76</span></span>GDjgtgdfsugs893Hhdjfpsj Content-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>: application/<span class="hljs-type"><span class="hljs-type">json</span></span></code> </pre><br>  trait√©es selon des r√®gles compl√®tement diff√©rentes. <br><br>  La compr√©hension de la s√©mantique du protocole vous permet d'organiser une session au niveau des objets du protocole d'application, par exemple, en utilisant des en-t√™tes HTTP, un cookie RDP ou des requ√™tes multiplex pour remplir une session de transport avec de nombreuses requ√™tes utilisateur si le niveau d'application du protocole le permet. <br>  Le champ d'application de l'ADC est parfois d√©raisonnablement imagin√© uniquement en servant le trafic HTTP, en fait, la liste des protocoles pris en charge pour la plupart des fabricants est beaucoup plus large.  M√™me en travaillant sans comprendre la s√©mantique du protocole de couche application, ADC peut √™tre utile pour r√©soudre diverses t√¢ches, par exemple, j'ai particip√© √† la construction d'une batterie de serveurs virtuelle autosuffisante de serveurs SMTP, pendant les attaques de spam, le nombre d'instances augmente √† l'aide du contr√¥le de r√©troaction sur la longueur de la file d'attente de messages pour fournir un temps satisfaisant pour v√©rifier les messages avec des algorithmes gourmands en ressources.  Lors de l'activation, le serveur s'est inscrit aupr√®s d'ADC et a re√ßu sa portion de nouvelles sessions TCP.  Dans le cas de SMTP, ce sch√©ma de fonctionnement √©tait pleinement justifi√© en raison de l'entropie √©lev√©e des connexions au niveau du r√©seau et du transport; pour une r√©partition uniforme de la charge lors des attaques de spam ADC, seul le support TCP est requis.  Un sch√©ma similaire peut √™tre utilis√© pour cr√©er une batterie de serveurs √† partir de serveurs de bases de donn√©es, de grappes de serveurs DNS, DHCP, AAA ou d'acc√®s distant tr√®s charg√©s lorsque les serveurs peuvent √™tre consid√©r√©s comme √©quivalents dans le domaine et lorsque leurs caract√©ristiques de performances ne diff√®rent pas trop les unes des autres.  Je n'irai pas plus loin dans le sujet des fonctionnalit√©s de protocole, cet aspect est trop √©tendu pour √™tre mentionn√© dans l'introduction, si quelque chose semble int√©ressant - √©crivez, c'est peut-√™tre l'occasion pour un article avec une pr√©sentation plus approfondie d'une application, et maintenant passons au point. <br><br>  Le plus souvent, ADC ferme la couche de transport, de sorte que la session TCP de bout en bout entre le consommateur et le serveur devient composite, le consommateur √©tablit une session avec ADC et ADC avec l'un des serveurs. <br><br><img src="https://habrastorage.org/webt/qi/_9/vg/qi_9vglsdqfiqbtzbrsh-egpvwk.png" alt="image"><br>  <i>Fig.1</i> <br><br>  Les param√®tres de configuration et d'adressage du r√©seau doivent permettre une telle am√©lioration du trafic afin que deux parties de la session TCP passent par l'ADC.  L'option la plus simple pour rendre le trafic de la premi√®re partie √† venir √† l'ADC est d'attribuer une adresse de service √† l'une des adresses de l'interface ADC, avec la deuxi√®me partie, les options suivantes sont possibles: <br><br><ol><li>  ADC comme passerelle par d√©faut pour le r√©seau de serveurs; </li><li>  Diffuser vers les adresses des consommateurs ADC dans l'une de ses adresses d'interface. </li></ol><br>  En fait, une vue l√©g√®rement plus r√©aliste du premier sch√©ma d'application ressemble √† ceci, c'est la base √† partir de laquelle nous commencerons: <br><br><img src="https://habrastorage.org/webt/6z/y8/5y/6zy85y1fcajgfndoybabz9geikk.png" alt="image"><br>  <i>Fig.2</i> <br><br>  Le deuxi√®me groupe de serveurs peut √™tre des bases de donn√©es, un back-end d'application, un stockage r√©seau ou un front-end pour un autre ensemble de services en cas de d√©composition d'une application classique en micro-services.  Ce groupe de serveurs peut √™tre un domaine de routage distinct, avec ses propres politiques, situ√© dans un autre centre de donn√©es ou √™tre compl√®tement isol√© pour des raisons de s√©curit√©.  Les serveurs sont rarement situ√©s dans un segment; le plus souvent, ils sont plac√©s dans des segments pour leur destination avec des politiques d'acc√®s clairement r√©glement√©es, la figure le montre comme un pare-feu. <br><br>  Des √©tudes montrent que les applications multiniveaux modernes g√©n√®rent plus de trafic Ouest-Est et il est peu probable que tout le trafic intra-code / inter-segments passe par l'ADC.  Les commutateurs de la figure 2 ne sont pas n√©cessairement physiques - les domaines de routage peuvent √™tre impl√©ment√©s √† l'aide d'entit√©s virtuelles, appel√©es virtual-router, vrf, vr, vpn-instance ou une table de routage virtuelle pour diff√©rents fabricants. <br><br>  Soit dit en passant, il existe une variante de couplage avec le r√©seau, sans n√©cessiter de sym√©trie des flux de trafic du consommateur vers l'ADC et de l'ADC vers les serveurs, il est demand√© dans les cas de sessions de longue dur√©e, dans lesquelles une tr√®s grande quantit√© de trafic est transmise dans un sens, par exemple, le streaming ou diffuser du contenu vid√©o.  Dans ce cas, l'ADC ne voit que le flux du client vers les serveurs, ce flux est d√©livr√© √† l'adresse de l'interface ADC et apr√®s un traitement simple, qui consiste √† remplacer l'adresse MAC par l'interface MAC de l'un des serveurs, la requ√™te est envoy√©e au serveur o√π l'adresse de service est affect√©e √† l'une des interfaces logiques.  Le trafic inverse du serveur vers le consommateur contourne l'ADC conform√©ment √† la table de routage du serveur.  La prise en charge d'un seul domaine de diffusion pour tous les frontaux peut √™tre tr√®s difficile, en outre, la capacit√© d'ADC √† analyser les r√©ponses et √† prendre en charge la sessionnabilit√© dans ce cas est tr√®s limit√©e, en fait il ne s'agit que d'un commutateur, donc cette option n'est pas envisag√©e plus loin, bien que certaines soient √©troites les t√¢ches peuvent √™tre utilis√©es. <br><br><img src="https://habrastorage.org/webt/hm/xb/vs/hmxbvspqknpgsvws5uqbycydaps.png" alt="image"><br>  <i>Fig.3</i> <br><br>  Donc, nous avons un centre de donn√©es de base, illustr√© √† la figure 2, r√©fl√©chissons aux probl√®mes qui peuvent pousser le centre de donn√©es de base √† l'√©volution, je vois deux sujets d'analyse: <br><br><ol><li>  Supposons que le sous-syst√®me de commutation soit enti√®rement r√©serv√©, ne pensons pas comment ni pourquoi, le sujet est trop √©tendu.  Les applications s'ex√©cutent sur plusieurs serveurs et sont sauvegard√©es √† l'aide d'ADC, mais comment r√©server l'ADC lui-m√™me? </li><li>  Si l'analyse montre que la prochaine charge de pointe saisonni√®re peut d√©passer les capacit√©s d'ADC, vous pensez bien s√ªr √† l'√©volutivit√©. </li></ol><br>  Ces t√¢ches sont similaires dans la mesure o√π, au cours de leur r√©solution, le nombre d'instances ADC augmentera certainement.  Dans le m√™me temps, la tol√©rance aux pannes peut √™tre organis√©e selon le sch√©ma Actif / Sauvegarde et Actif / Actif, et la mise √† l'√©chelle ne peut √™tre effectu√©e qu'en fonction du sch√©ma Actif / Actif.  Essayons de les r√©soudre individuellement et voyons quelles sont les propri√©t√©s des diff√©rentes solutions. <br><br>  Les ADC de nombreux fabricants peuvent √™tre consid√©r√©s comme des √©l√©ments d'une infrastructure r√©seau, RIP, OSPF, BGP - tout cela est l√†, ce qui signifie que vous pouvez cr√©er un sch√©ma de sauvegarde Active / Backup trivial.  L'ADC actif transmet les pr√©fixes de service au routeur en amont et en re√ßoit l'itin√©raire par d√©faut pour remplir sa table et transf√©rer vers le centre de donn√©es vers la table de routage virtuelle correspondante.  L'ADC de sauvegarde fait de m√™me, mais, en utilisant la s√©mantique du protocole de routage s√©lectionn√©, g√©n√®re des annonces moins attrayantes.  Avec cette approche, les serveurs peuvent voir la v√©ritable adresse IP du consommateur, car il n'y a aucune raison d'utiliser la traduction d'adresse.  Ce sch√©ma fonctionne √©galement correctement s'il y a plus d'un routeur en amont, mais afin d'√©viter une situation o√π l'ADC actif perd la connexion par d√©faut et la connectivit√© avec le routeur, tout en recevant toujours la valeur par d√©faut de l'ADC de sauvegarde et continue de l'annoncer vers le centre de donn√©es, essayez d'√©viter la proximit√© entre ADC et l'utilisation de routes statiques. <br><br><img src="https://habrastorage.org/webt/l8/bw/di/l8bwdie61pvk2wibngd9jwgcco4.png" alt="image"><br>  <i>Fig.4</i> <br><br>  Si les serveurs n'ont pas besoin de fonctionner avec de vraies adresses IP de consommateur, ou si le protocole de couche application vous permet de l'int√©grer dans des en-t√™tes, tels que HTTP, le sch√©ma se transforme en Actif / Actif avec une d√©pendance presque lin√©aire des performances sur le nombre d'ADC.  Dans le cas de plusieurs routeurs en amont, il faut veiller √† ce que le trafic entrant arrive en portions plus ou moins uniformes.  Cette t√¢che peut √™tre facilement r√©solue si dans le domaine de routage ECMP le transfert commence vers ces routeurs, s'il est difficile ou si le domaine de routage n'est pas desservi par vous - vous pouvez utiliser des connexions √† maillage complet entre ADX et les routeurs afin que le transfert ECMP commence directement vers eux. <br><br><img src="https://habrastorage.org/webt/z3/wr/bu/z3wrbuedtvq62eabsourkdgxkvy.png" alt="image"><br>  <i>Fig.5</i> <br><br>  Au d√©but de cette partie, j'ai √©crit que la tol√©rance aux pannes et la mise √† l'√©chelle sont deux grandes diff√©rences.  Les solutions √† ces probl√®mes ont un niveau d'utilisation des ressources diff√©rent, si vous concevez un sch√©ma actif / de secours, vous devez accepter le fait que la moiti√© des ressources seront inactives.  Et s'il vous arrive de devoir passer √† la prochaine √©tape quantitative, soyez pr√™t √† multiplier les ressources n√©cessaires par deux √† l'avenir. <br><br>  Les avantages d'Active / Active commencent √† appara√Ætre lorsque vous utilisez plus de deux appareils.  Supposons que vous deviez garantir les performances de 8 unit√©s arbitraires (8 000 connexions par seconde ou 8 millions de sessions simultan√©es) et fournir un sc√©nario de d√©faillance de p√©riph√©rique unique, dans la version Active / Active, vous n'avez besoin que de trois instances ADC d'une capacit√© de 4, dans le cas d'Active / Standby - deux par 8. Si vous traduisez ces nombres en ressources inactives, vous obtenez un tiers √† la moiti√©.  Le m√™me principe de calcul peut √™tre utilis√© pour estimer la proportion de connexions rompues pendant une p√©riode de d√©faillance partielle.  Avec une augmentation du nombre d'instances Active / Active, les calculs deviennent encore plus agr√©ables, et le syst√®me a la possibilit√© d'augmenter progressivement la productivit√© au lieu de Active / Standby par √©tapes. <br><br>  Il sera correct de mentionner une autre fa√ßon de sch√©mas de travail actif / actif ou actif / veille - le clustering.  Mais il ne sera pas tr√®s correct de consacrer beaucoup de temps √† cela, car j'ai essay√© d'√©crire sur les approches et non sur les fonctionnalit√©s des fabricants.  Lorsque vous choisissez cette solution, vous devez comprendre clairement les choses suivantes: <br><br><ol><li>  L'architecture de cluster impose parfois des restrictions sur telle ou telle fonctionnalit√©, dans certains projets c'est fondamental, dans certains cela peut devenir important √† l'avenir, tout d√©pend du fabricant et chaque solution doit √™tre √©labor√©e individuellement; </li><li>  Le cluster est souvent un domaine d'erreur, il y aura des erreurs dans le logiciel. </li><li>  Le cluster est facile √† assembler, mais tr√®s difficile √† d√©monter.  La technologie a moins de mobilit√© - vous ne pouvez pas contr√¥ler certaines parties du syst√®me. </li><li>  Vous tombez dans l'√©treinte tenace de votre fabricant. </li></ol><br>  N√©anmoins, il y a des choses positives: <br><br><ol><li>  Le cluster est facile √† installer et √† utiliser. </li><li>  Parfois, vous pouvez vous attendre √† une utilisation des ressources presque optimale. </li></ol><br>  Ainsi, notre centre de donn√©es de la figure 5 continue de cro√Ætre, la t√¢che que vous devrez peut-√™tre r√©soudre consiste √† augmenter le nombre de serveurs.  Il n'est pas toujours possible de le faire dans un centre de donn√©es existant, alors supposez qu'un nouvel emplacement spacieux avec des serveurs suppl√©mentaires soit apparu. <br><br><img src="https://habrastorage.org/webt/o5/kq/fo/o5kqfoeksqpzk09cfrlmdluxts8.png" alt="image"><br>  <i>Fig.6</i> <br><br>  Un nouveau site peut ne pas √™tre tr√®s loin, vous pourrez alors r√©soudre le probl√®me en renouvelant les domaines de routage.  Un cas plus g√©n√©ral, qui n'exclut pas l'apparition du site dans une autre ville ou dans un autre pays, posera de nouveaux d√©fis pour le datacenter: <br><br><ol><li>  Utilisation des canaux entre les sites; </li><li>  Diff√©rence de temps de traitement pour les demandes envoy√©es par ADC pour traitement aux serveurs proches et distants. </li></ol><br>  Le maintien d'un large canal entre les sites peut √™tre une entreprise tr√®s co√ªteuse, et le choix d'un emplacement ne sera plus une t√¢che triviale - un site surcharg√© avec un temps de r√©ponse court ou gratuit avec un grand.  En y r√©fl√©chissant, vous serez amen√© √† cr√©er une configuration de centre de donn√©es g√©ographiquement distribu√©e.  Cette configuration, d'une part, est conviviale pour les consommateurs, car elle vous permet de recevoir un service √† un point proche de vous, d'autre part, elle peut r√©duire consid√©rablement les exigences pour la bande de canaux entre les sites. <br><br>  Dans le cas o√π les vraies adresses IP ne doivent pas √™tre accessibles aux serveurs, ou lorsque le protocole de couche application permet de les transmettre dans les en-t√™tes, le dispositif d'un centre de donn√©es g√©ographiquement distribu√© n'est pas tr√®s diff√©rent de ce que j'ai appel√© le centre de donn√©es de base.  ADC sur n'importe quel site peut envoyer des demandes de traitement √† des serveurs locaux ou les envoyer pour traitement √† un voisin, la diffusion de l'adresse du consommateur rend cela possible.  Une attention particuli√®re devrait √™tre accord√©e √† la surveillance du volume de trafic entrant afin de maintenir la quantit√© d'ADC dans le site ad√©quate √† la proportion du trafic que le site re√ßoit.  La traduction d'adresse du consommateur vous permet d'augmenter / diminuer le nombre d'ADC ou m√™me de d√©placer des instances entre les sites en fonction des changements dans la matrice de trafic entrant, ou pendant la migration / le lancement.  Malgr√© sa simplicit√©, le sch√©ma est assez flexible, pr√©sente des caract√©ristiques de fonctionnement agr√©ables et est facilement reproduit pour plus de deux sites. <br><br><img src="https://habrastorage.org/webt/4f/3k/e0/4f3ke0imkvzickwdmswg76qo8ts.png" alt="image"><br>  <i>Fig. 7</i> <br><br>  Si vous travaillez avec un protocole qui permet de transf√©rer des demandes, comme dans le cas de la redirection HTTP, cette fonctionnalit√© peut √™tre utilis√©e comme un levier suppl√©mentaire pour contr√¥ler la charge du canal entre les sites, comme un m√©canisme pour effectuer une maintenance de routine sur les serveurs ou comme une m√©thode de construction de batteries de serveurs Active / Backup sur diff√©rents sites.  Au moment voulu, automatiquement ou apr√®s certains √©v√©nements d√©clencheurs, ADC peut supprimer le trafic des serveurs locaux et d√©placer les consommateurs vers un site voisin.  Il vaut la peine de porter une attention particuli√®re au d√©veloppement de cet algorithme afin que le travail coordonn√© de l'ADC exclue la possibilit√© de transmission mutuelle des demandes ou de r√©sonance. <br><br>  Le cas est particuli√®rement int√©ressant lorsque les serveurs ont besoin de v√©ritables adresses IP de consommateurs et que le protocole de couche application n'a pas la capacit√© de transmettre des en-t√™tes suppl√©mentaires, ou lorsque les ADC fonctionnent sans comprendre la s√©mantique du protocole de couche application.  Dans ce cas, il n'est pas possible de fournir une connexion coh√©rente entre les segments de session TCP en d√©clarant simplement une route dans ADC par d√©faut.  Si vous proc√©dez ainsi, les serveurs du premier site commenceront √† utiliser l'ADC local comme passerelle par d√©faut pour les sessions provenant du deuxi√®me site, la session TCP ne sera pas √©tablie dans ce cas car l'ADC du premier site ne verra qu'une seule √©paule de la session. <br><br><img src="https://habrastorage.org/webt/bh/zs/sg/bhzssgahst0iwxcsj_-rzpnzy4k.png" alt="image"><br>  <i>Fig. 8</i> <br><br>  Il existe une petite astuce qui vous permet toujours d'ex√©cuter Active / Active ADC en combinaison avec des batteries de serveurs Active / Active sur diff√©rents sites (je ne consid√®re pas le cas d'Active / Backup sur deux sites, une lecture attentive de ce qui pr√©c√®de vous permettra de r√©soudre ce probl√®me sans autre discussion).  L'astuce consiste √† utiliser sur l'ADC du deuxi√®me site non pas les adresses de l'interface du serveur, mais l'adresse ADC logique, qui correspond √† la batterie de serveurs sur le premier site.  Dans le m√™me temps, les serveurs re√ßoivent le trafic comme s'il provenait de l'ADC local et utilisent la passerelle par d√©faut locale.  Pour conserver ce mode de fonctionnement sur l'ADC, vous devez activer la fonction m√©moire de l'interface √† partir de laquelle le premier paquet pour la configuration de la session TCP est venu.  Diff√©rents fabricants appellent cette fonction diff√©remment, mais l'essence est la m√™me - rappelez-vous l'interface dans la table d'√©tat de session et utilisez-la pour le trafic de r√©ponse sans pr√™ter attention √† la table de routage.  Le sch√©ma est enti√®rement fonctionnel et vous permet de r√©partir la charge de mani√®re flexible sur tous les serveurs disponibles o√π qu'ils se trouvent.  Dans le cas de deux sites ou plus, la d√©faillance d'un ADC n'affecte pas la disponibilit√© du service dans son ensemble, mais exclut compl√®tement la possibilit√© de traiter le trafic sur les serveurs de site avec des ADC d√©faillants, cela doit √™tre gard√© √† l'esprit lors de la pr√©vision du comportement et de la charge lors d'√©checs partiels. <br><br><img src="https://habrastorage.org/webt/j8/c5/n0/j8c5n0oqpzijkfiz3dbyrrxeaww.png" alt="image"><br>  <i>Fig. 9</i> <br><br>  Les services de notre client ont fonctionn√© √† peu pr√®s de la m√™me mani√®re lorsque j'ai commenc√© √† travailler sur un projet de migration vers la nouvelle plateforme ADC.  Il n'√©tait pas difficile de recr√©er simplement le comportement des appareils de l'ancienne plateforme sur la nouvelle dans le cadre d'un sch√©ma √©prouv√© et convivial, c'est ce qu'ils attendaient de nous. <br><br>  Mais regardez √† nouveau la figure 9, voyez-vous ce qui peut √™tre optimis√© l√†-bas? <br>  Le principal inconv√©nient de travailler avec la cha√Æne ADC est qu'elle consomme les ressources de deux ADC pour traiter une partie des sessions.  Dans le cas de ce client, le choix √©tait absolument conscient, il √©tait d√ª aux sp√©cificit√©s des applications et √† la n√©cessit√© de pouvoir redistribuer tr√®s rapidement (de 20 √† 50 secondes) la charge entre serveurs de sites diff√©rents.  √Ä diff√©rentes p√©riodes, le double traitement a n√©cessit√© en moyenne 15 √† 30% des ressources ADC, ce qui suffit √† penser √† l'optimisation.  Apr√®s avoir discut√© de ce point avec les ing√©nieurs du client, nous avons propos√© de remplacer la prise en charge de la table de session ADC par la liaison d'interface avec le routage source sur les serveurs utilisant PBR sur la pile IP Linux.  En tant que cl√©, nous avons consid√©r√© des options telles que: <br><br><ol><li>  adresse IP suppl√©mentaire sur les serveurs sur une interface commune pour chaque ADC; </li><li>  interface adresse IP sur les serveurs sur un 802.1q distinct pour chaque ADC; </li><li>  R√©seau de tunnel de superposition distinct sur les serveurs pour chaque ADC. </li></ol><br>  Les premi√®re et deuxi√®me options affectent en quelque sorte le r√©seau dans son ensemble.  Parmi les effets secondaires de l'option num√©ro un, il nous a sembl√© inacceptable qu'une augmentation multiple du nombre d'ADC, de tables ARP sur les commutateurs, et la deuxi√®me option n√©cessiterait une augmentation du nombre de domaines de diffusion de bout en bout entre les sites ou des instances individuelles de tables de routage virtuelles.  La nature locale de la troisi√®me option nous a sembl√© tr√®s attrayante et nous nous sommes mis au travail, ce qui a abouti √† un contr√¥leur simple qui automatise la configuration des tunnels sur les serveurs et l'ADC, ainsi que la configuration PBR sur la pile IP des serveurs Linux. <br><br><img src="https://habrastorage.org/webt/6a/io/9_/6aio9_jovjmxyo2n2qtuamfzlji.png" alt="image"><br>  <i>Fig. 10</i> <br><br>  Au moment o√π j'√©crivais, la migration √©tait termin√©e, le client a obtenu ce qu'il voulait - une nouvelle plate-forme, simplicit√©, flexibilit√©, √©volutivit√© et, √† la suite du passage √† une superposition, simplifiant la configuration de l'√©quipement r√©seau dans le cadre de la maintenance de ces services - au lieu de plusieurs copies de tables virtuelles et de grands domaines de diffusion, il s'est av√©r√© que -   IP . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chers coll√®gues qui travaillent avec les fabricants d'ADC, ce paragraphe se concentre davantage sur vous. Certains de vos produits sont bons, mais essayez de faire attention √† une int√©gration plus √©troite avec les applications sur les serveurs, l'automatisation de leurs param√®tres et l'orchestration de l'ensemble du processus de d√©veloppement et de fonctionnement. Cela me semble sous la forme d'une interaction contr√¥leur-agent classique, apportant des modifications √† l'ADC, l'utilisateur lance l'appel du contr√¥leur aux agents enregistr√©s, c'est ce que nous avons fait avec le client, mais ¬´pr√™t √† l'emploi¬ª.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, certains clients peuvent trouver commode de passer d'un mod√®le PULL d'interaction avec des serveurs √† un mod√®le PUSH. Les capacit√©s d'application sur les serveurs sont tr√®s larges, il est donc parfois plus facile d'organiser une v√©rification s√©rieuse sp√©cifique √† l'application du service sur l'agent lui-m√™me. Si la v√©rification donne un r√©sultat positif, l'agent transmet des informations, par exemple, sous une forme similaire √† la communaut√© de co√ªts BGP, pour une utilisation dans des algorithmes de calcul pond√©r√©s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Souvent, diff√©rents d√©partements de l'organisation effectuent la maintenance du serveur et de l'ADC; le passage √† un mod√®le d'interaction PUSH peut √™tre int√©ressant car ce mod√®le √©limine le besoin de coordination entre les d√©partements sur une interface interhumaine. Les services auxquels le serveur participe peuvent √™tre transf√©r√©s directement de l'agent √† l'ADC sous la forme de quelque chose de similaire √† la BGP Flow-Spec avanc√©e.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a encore beaucoup √† √©crire. Pourquoi suis-je tout cela ... √âtant dans un choix libre, nous prenons une d√©cision en faveur d'une option plus pratique, plus adapt√©e ou en faveur d'une option qui √©largit la fen√™tre d'opportunit√© afin de minimiser nos risques. Les grands acteurs de l'industrie Internet inventent quelque chose de compl√®tement innovant pour r√©soudre leurs probl√®mes, quelque chose qui dicte demain, les petits acteurs et les entreprises ayant une exp√©rience dans le d√©veloppement de logiciels utilisent de plus en plus des technologies et des produits qui permettent une personnalisation approfondie pour eux-m√™mes. De nombreux fabricants d'√©quilibreurs de charge notent une baisse de la demande pour leurs produits. En d'autres termes, les serveurs et applications qui les ex√©cutent, commutateurs et routeurs il y a quelque temps, ont d√©j√† chang√© qualitativement et sont entr√©s dans l'√®re SDN. Les √©quilibreurs sont au seuilprenez cette mesure lorsque la porte est ouverte, sinon vous risquez de perdre un avantage concurrentiel et de vous d√©placer vers la p√©riph√©rie.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr424115/">https://habr.com/ru/post/fr424115/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr424105/index.html">La NASA sait comment rendre Mars vert √† nouveau</a></li>
<li><a href="../fr424107/index.html">Cela fait un an que le trou b√©ant dans le stockage r√©seau domestique My Cloud de WD</a></li>
<li><a href="../fr424109/index.html">VSCE # 2: Podcast des entrepreneurs m√©diatiques</a></li>
<li><a href="../fr424111/index.html">Vagues de contrats intelligents. Premi√®re exp√©rience</a></li>
<li><a href="../fr424113/index.html">Processus de conception, recherche et recherche d'emploi</a></li>
<li><a href="../fr424119/index.html">Y avait-il un Scrum *?</a></li>
<li><a href="../fr424121/index.html">Cr√©ation d'une fonction de d√©clenchement dans pgModeler</a></li>
<li><a href="../fr424127/index.html">Comment se faire des amis Ovirt et Let's Encrypt</a></li>
<li><a href="../fr424129/index.html">D√©veloppement Android. Un peu de travail rapide avec les listes</a></li>
<li><a href="../fr424131/index.html">Manifeste des d√©veloppeurs de syst√®mes intelligents: 15 principes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>