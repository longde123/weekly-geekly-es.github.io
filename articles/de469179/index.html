<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛹🏿 🛫 😑 Eine kurze Einführung in Kustomize 📦 🧘🏾 📗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hinweis perev. : Der Artikel wurde von Scott Lowe verfasst, einem leitenden IT-Ingenieur, der sieben gedruckte Bücher (hauptsächlich für VMware vSpher...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eine kurze Einführung in Kustomize</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/469179/"> <i><b>Hinweis</b></i>  <i><b>perev.</b></i>  <i>: Der Artikel wurde von Scott Lowe verfasst, einem leitenden IT-Ingenieur, der sieben gedruckte Bücher (hauptsächlich für VMware vSphere) verfasst / mitverfasst hat.</i>  <i>Derzeit arbeitet er bei der VMware-Tochter Heptio (2016 erworben), die sich auf Cloud Computing und Kubernetes spezialisiert hat.</i>  <i>Der Text selbst dient als umfassende und leicht verständliche Einführung in das Konfigurationsmanagement für Kubernetes mithilfe der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kustomize-</a> Technologie, die kürzlich in K8s enthalten war.</i> <br><br><img src="https://habrastorage.org/webt/3k/3j/if/3k3jifu6nisnqt_nghi6iitekoy.png"><br><br>  Kustomize ist ein Tool, mit dem Benutzer "einfache und vorlagenfreie YAML-Dateien für verschiedene Zwecke anpassen können, wobei die ursprüngliche YAML intakt und verwendbar bleibt" (die Beschreibung wird direkt aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dem kustomize-Repository auf GitHub ausgeliehen</a> ).  Kustomize kann direkt ausgeführt werden oder ab Kubernetes 1.14 <code>kubectl -k</code> um auf seine Funktionen zuzugreifen (obwohl ab Kubernetes 1.15 eine separate Binärdatei neuer ist als die in kubectl integrierten Funktionen).  <i>( <b>Hinweis</b> : Mit der aktuellen Version von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kubernetes 1.16</a> wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kustomize</a> auch im Dienstprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kubeadm</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unterstützt</a> .)</i> In diesem Beitrag möchte ich den Lesern die Grundlagen von kustomize vorstellen. <a name="habracut"></a><br><br>  In seiner einfachsten Form / Anwendung ist kustomize einfach eine Sammlung von Ressourcen (YAML-Dateien, die Kubernetes-Objekte definieren: Bereitstellungen, Dienste usw.) sowie eine Liste von Anweisungen zu den Änderungen, die an diesen Ressourcen vorgenommen werden müssen.  So wie make den im <code>Makefile</code> enthaltenen Befehlssatz verwendet und Docker <code>Dockerfile</code> Container basierend auf Anweisungen aus dem <code>Dockerfile</code> , verwendet <code>kustomization.yaml</code> , um Anweisungen darüber zu speichern, welche Änderungen der Benutzer am Ressourcensatz vornehmen möchte. <br><br>  Hier ist ein Beispiel für eine <code>kustomization.yaml</code> Datei: <br><br><pre> <code class="plaintext hljs">resources: - deployment.yaml - service.yaml namePrefix: dev- namespace: development commonLabels: environment: development</code> </pre> <br>  Ich werde nicht versuchen, über alle möglichen Felder in der Datei <code>kustomization.yaml</code> zu sprechen (dies ist hier gut geschrieben), aber ich werde eine kurze Erklärung eines bestimmten Beispiels geben: <br><br><ul><li>  Das Feld <code>resources</code> gibt an, welche (welche Ressourcen) kustomize sich ändern wird.  In diesem Fall sucht es in seinem Verzeichnis nach Ressourcen in den Dateien <code>service.yaml</code> und <code>service.yaml</code> (bei Bedarf können Sie vollständige oder relative Pfade angeben). </li><li>  Das Feld <code>namePrefix</code> weist kustomize an, dem Attribut <code>name</code> aller im Feld resources definierten <code>resources</code> ein bestimmtes Präfix (in diesem Fall <code>dev-</code> ) hinzuzufügen.  Wenn es in Deployment einen <code>name</code> mit dem Wert <code>nginx-deployment</code> deploy gibt, macht kustomize daraus <code>dev-nginx-deployment</code> deploy. </li><li>  Das <code>namespace</code> Feld weist kustomize an, den angegebenen Namespace allen Ressourcen hinzuzufügen.  In diesem Fall fallen Bereitstellung und Dienst in den <code>development</code> . </li><li>  Schließlich enthält das Feld <code>commonLabels</code> eine Reihe von Beschriftungen, die allen Ressourcen hinzugefügt werden.  In unserem Beispiel weist kustomize den Ressourcen mit der Namensumgebung und der Wertentwicklung eine Bezeichnung zu. </li></ul><br>  Wenn der Benutzer <code>kustomize build .</code>  Im Verzeichnis mit der Datei <code>kustomization.yaml</code> und den erforderlichen Ressourcen (d. <code>kustomization.yaml</code> <code>deployment.yaml</code> und <code>service.yaml</code> Dateien) erhält es bei der Ausgabe den Text mit den in <code>kustomization.yaml</code> registrierten <code>kustomization.yaml</code> . <br><br><img src="https://habrastorage.org/webt/nv/sf/uy/nvsfuyar7x570ia_zrcp_v4lohi.jpeg"><br>  <i><b>Hinweis</b></i>  <i><b>perev.</b></i>  <i>: Illustration aus der Projektdokumentation für die „einfache“ Verwendung von kustomize</i> <br><br>  Die Ausgabe kann umgeleitet werden, wenn Sie die Änderungen festschreiben müssen: <br><br><pre> <code class="bash hljs">kustomize build . &gt; custom-config.yaml</code> </pre> <br>  Die Ausgabe ist deterministisch (mit derselben Eingabe wird dieselbe Ausgabe erhalten), sodass Sie das Ergebnis nicht in einer Datei speichern können.  Stattdessen können Sie es sofort an einen anderen Befehl übergeben: <br><br><pre> <code class="bash hljs">kustomize build . | kubectl apply -f -</code> </pre> <br>  Auf Kustomize-Funktionen kann auch über <code>kubectl -k</code> zugegriffen werden (seit Version 1.14 von Kubernetes).  Beachten Sie jedoch, dass ein separates kustomize-Paket schneller aktualisiert wird als ein in kubectl integriertes (zumindest ist dies bei der Veröffentlichung von Kubernetes 1.15 der Fall). <br><br>  Leser können fragen: "Warum all diese Schwierigkeiten, wenn Sie Dateien direkt bearbeiten können?".  Gute Frage.  In unserem Beispiel ist es wirklich <i>möglich,</i> die Dateien <code>service.yaml</code> und <code>service.yaml</code> direkt <i>zu</i> ändern. Was ist jedoch, wenn sie eine Abzweigung des Projekts eines anderen sind?  Das direkte Ändern von Dateien macht es schwierig (wenn nicht gar unmöglich), die Verzweigung neu zu starten, wenn Änderungen an der Quelle / Quelle vorgenommen werden.  Mit kustomize können Sie diese Änderungen in der Datei <code>kustomization.yaml</code> zentralisieren, die Originaldateien intakt lassen und so das erneute Basieren der Quelldateien bei Bedarf vereinfachen. <br><br>  Die Vorteile von kustomize werden in komplexeren Anwendungsfällen deutlich.  Im obigen Beispiel befinden sich <code>kustomization.yaml</code> und resources im selben Verzeichnis.  Kustomize unterstützt jedoch Verwendungsszenarien, wenn eine Grundkonfiguration und viele ihrer Varianten vorhanden sind, die auch als <i>Overlays bezeichnet werden</i> .  Ein Benutzer wollte beispielsweise Deployment and Service für nginx, das ich als Beispiel verwendet habe, verwenden und Entwicklungs-, Staging- und Produktionsversionen (oder Varianten) dieser Dateien erstellen.  Dazu benötigt er die oben genannten Overlays und in der Tat die grundlegenden Ressourcen selbst. <br><br>  Angenommen, Verzeichnisse haben die folgende Struktur, um die Idee von Überlagerungen und Basisressourcen zu veranschaulichen: <br><br><pre> <code class="plaintext hljs">- base - deployment.yaml - service.yaml - kustomization.yaml - overlays - dev - kustomization.yaml - staging - kustomization.yaml - prod - kustomization.yaml</code> </pre> <br>  In der <code>base/kustomization.yaml</code> Benutzer einfach das <code>resources</code> <code>base/kustomization.yaml</code> um die <code>resources</code> zu deklarieren, die kustomize aktivieren soll. <br><br>  In jeder der <code>overlays/{dev,staging,prod}/kustomization.yaml</code> verweisen Benutzer auf die Grundkonfiguration im Feld <code>resources</code> und geben dann die spezifischen Änderungen für <i>diese Umgebung an</i> .  Beispielsweise könnte die <code>overlays/dev/kustomization.yaml</code> wie im vorherigen Beispiel aussehen: <br><br><pre> <code class="plaintext hljs">resources: - ../../base namePrefix: dev- namespace: development commonLabels: environment: development</code> </pre> <br>  Gleichzeitig kann die <code>overlays/prod/kustomization.yaml</code> völlig anders sein: <br><br><pre> <code class="plaintext hljs">resources: - ../../base namePrefix: prod- namespace: production commonLabels: environment: production sre-team: blue</code> </pre> <br>  Wenn der Benutzer <code>kustomize build .</code>  Im <code>overlays/dev</code> generiert kustomize eine Entwicklungsoption.  Wenn Sie <code>kustomize build .</code>  Im Verzeichnis <code>overlays/prod</code> Sie die Produktionsoption.  Und das alles - ohne Änderungen an den Originaldateien <i>(Basisdateien)</i> und auf deklarative und deterministische Weise.  Sie können die Grundkonfigurations- und Overlay-Verzeichnisse direkt an das Versionskontrollsystem übergeben, da Sie wissen, dass Sie basierend auf diesen Dateien die gewünschte Konfiguration jederzeit reproduzieren können. <br><br><img src="https://habrastorage.org/webt/ou/3-/f1/ou3-f1faejz5z8fnho8hmtlcfoy.jpeg"><br>  <i><b>Hinweis</b></i>  <i><b>perev.</b></i>  <i>: Abbildung aus der Projektdokumentation zur Verwendung von Overlays in kustomize</i> <br><br>  Kustomize kann <i>viel</i> mehr als in diesem Artikel beschrieben.  Ich hoffe jedoch, dass dies eine gute Einführung sein wird. <br><br><h2>  Zusätzliche Ressourcen </h2><br>  Es gibt viele gute Artikel und Veröffentlichungen über kustomize.  Hier sind einige, die ich besonders nützlich fand: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ändern Sie die Basis-YAML-Konfiguration für verschiedene Umgebungen mit Kustomize</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kustomize - Der richtige Weg, um in Kubernetes Vorlagen zu erstellen</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Deklarative Verwaltung von Kubernetes-Objekten mit Kustomize</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anpassen von Upstream-Helmdiagrammen mit Kustomize</a> . </li></ul><br>  <i><b>Hinweis</b></i>  <i><b>perev.</b></i>  <i>: Sie können auch den als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ressourcen</a> auf der Dienstprogramm-Website veröffentlichten Linkblock und die nachfolgende Sammlung von Videos mit den neuesten Berichten zu kustomize empfehlen.</i> <br><br>  Wenn Sie Fragen oder Anregungen zur Verbesserung dieses Materials haben, bin ich immer offen für Rückmeldungen.  Sie können mich auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Twitter</a> oder über <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Kubernetes Slack-Kanal</a> kontaktieren.  Viel Spaß beim Ändern Ihrer Manifeste mit kustomize! <br><br><h2>  PS vom Übersetzer </h2><br>  Lesen Sie auch in unserem Blog: <br><br><ul><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tools für Anwendungsentwickler, die auf Kubernetes ausgeführt werden</a> "; </li><li>  „ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kubernetes 1.14: Ein Überblick über wichtige Innovationen</a> “; </li><li>  „Die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fünf wichtigsten Ergebnisse des Helmgipfels 2019 in Amsterdam</a> “; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eine praktische Einführung in den Paketmanager für Kubernetes - Helm</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de469179/">https://habr.com/ru/post/de469179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de469163/index.html">Runenhistorie: Denken Sie daran, wie das Netzwerk temperiert wurde</a></li>
<li><a href="../de469165/index.html">Wir laden Sie zu Schulungen von Entwicklern von Intel Software und Yandex "Software Development in the Cloud" ein.</a></li>
<li><a href="../de469167/index.html">Liebe und Eulen: Was nützt die Nachtschicht?</a></li>
<li><a href="../de469171/index.html">Die besten Produkte gehen von echten Problemen aus: Gegensprechanlage über zu erledigende Jobs. Teil 2</a></li>
<li><a href="../de469173/index.html">Einsamkeit online</a></li>
<li><a href="../de469181/index.html">Wir verwenden statische Links zu Objekteigenschaften mit Lambdas</a></li>
<li><a href="../de469183/index.html">AMA mit Habr, # 12. Zerknittertes Problem</a></li>
<li><a href="../de469187/index.html">Das Buch "Swift. Grundlagen der Entwicklung von Anwendungen für iOS, iPadOS und macOS. 5. Aufl. ergänzt und überarbeitet "</a></li>
<li><a href="../de469189/index.html">Warum speichert MS-DOS den Diskettenlesepuffer genau zwei Sekunden lang?</a></li>
<li><a href="../de469193/index.html">PHP-Backend-Leistung. Video von Badoo PHP Meetup # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>