<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äç‚úàÔ∏è üè´ ‚ôìÔ∏è Samba DC en tant que deuxi√®me contr√¥leur dans le domaine AD de Windows 2012R2 et dossiers itin√©rants pour les clients sous Windows et Linux üõ∏ üåî üîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La prise de conscience que j'√©tais dans le mix d'importation n'est pas venue tout de suite. Ce n'est que lorsque de nouveaux approvisionnements en PC ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Samba DC en tant que deuxi√®me contr√¥leur dans le domaine AD de Windows 2012R2 et dossiers itin√©rants pour les clients sous Windows et Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450572/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/q7/qz/gi/q7qzgibifknfegmdk3ffls-fik0.jpeg" alt="image"></div><br>  La prise de conscience que j'√©tais dans le mix d'importation n'est pas venue tout de suite.  Ce n'est que lorsque de nouveaux approvisionnements en PC ont commenc√© √† arriver de mani√®re stable de l'organisation m√®re avec la distribution Alt Linux √† bord, j'ai soup√ßonn√© que quelque chose n'allait pas. <br><br>  Cependant, en passant par les √©tapes d'acceptation de l'in√©vitable, je me suis impliqu√© et j'ai m√™me commenc√© √† appr√©cier un peu le processus.  Et √† un moment donn√©, j'ai pens√© que, √† un tel rythme, je devais t√¥t ou tard abandonner la d√©cision d'organiser le service d'annuaire Microsoft et aller vers quelque chose de plus exotique.  Par cons√©quent, afin de se pr√©parer √† l'avance √† l'in√©vitable, et si possible d'attraper plus d'emb√ªches, il a √©t√© d√©cid√© de d√©ployer un banc d'essai, qui comprend: <br><br><ul><li>  DC1 - Windows Server 2012R2 </li><li>  DC2 - Alt Server 8.2 </li><li>  Serveur de fichiers - Windows Server 2012R2 </li><li>  PC1 - Windows 7 </li><li>  PC2 - Alt Workstation 8.2 </li></ul><a name="habracut"></a><br><h4>  T√¢ches du stand: </h4><br><ol><li> D√©ployez un domaine bas√© sur w2k12r2.  Cr√©ez un ensemble minimal de strat√©gies de groupe (similaires √† celles utilis√©es dans l'infrastructure de travail), y compris une strat√©gie de transfert des dossiers de travail des utilisateurs (T√©l√©chargements / Documents / Bureau).  En fin de compte, je veux que lorsqu'un utilisateur change son lieu de travail de Windows √† Linux et vice versa, il ait un acc√®s confortable √† ses documents de travail. </li><li>  Entr√©e dans Samba DC par le deuxi√®me contr√¥leur.  V√©rification du service d'annuaire et de la r√©plication DNS </li><li>  Configuration de clients Linux avec des dossiers itin√©rants </li></ol><br><h4>  R√©alisation: </h4><br><ol><li>  <b>Installer et entrer un nouveau contr√¥leur</b> <br><br>  Avec l'installation de MS Windows 2012R2, tout est simple et moins clair.  Sur Internet, il existe un manuel 1001 pour d√©ployer un domaine sous Windows √† l'aide de l'interface graphique et de Powershell, donc je ne le r√©p√©terai pas, je ne laisserai qu'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> √† d√©sactiver.  documentation pour les curieux et ceux qui veulent se rafra√Æchir la m√©moire. <br><br>  Cependant, il y a un point important dans ce paragraphe.  √Ä ce jour, Samba n'est pas en mesure de travailler avec des sch√©mas de catalogue sup√©rieurs √† 2008R2. <br><br><div class="spoiler">  <b class="spoiler_title">Cap de spoiler</b> <div class="spoiler_text">  Les d√©veloppeurs de ce support sont plut√¥t d√©clar√©s exp√©rimentaux.  Mais en pratique, une tentative d'entrer samba en tant que deuxi√®me contr√¥leur de domaine dans un domaine Windows existant avec le sch√©ma 69 vous rencontrera l'erreur suivante <br><blockquote>  √âchec de DsAddEntry avec le statut WERR_ACCESS_DENIED info (8567, 'WERR_DS_INCOMPATIBLE_VERSION') </blockquote><br></div></div><br>  Le probl√®me est que Windows 2012 et 2012R2 utilisent des outils WMI pour travailler avec les domaines et les for√™ts, dont la prise en charge stable n'est annonc√©e que pour la version 4.11 de Samba, qui devrait sortir avant la fin de cette ann√©e. <br>  Il s'ensuit que la seule option pour introduire la samba dans le domaine AD, d√©ploy√©e sur le serveur 2012R2, est de r√©duire le sch√©ma de 69 √† 47. Bien s√ªr, cela ne devrait pas √™tre fait sur l'infrastructure de travail sans raison valable, mais nous avons un banc de test ici, alors pourquoi en fait non. <br><br>  Nous mettons Alt Server 8.2.  Lors de l'installation, s√©lectionnez le profil "Serveur Samba-DC (Contr√¥leur AD)".  Sur le serveur d√©ploy√©, nous effectuons une mise √† jour compl√®te du syst√®me et installons le package task-samba-dc, qui tirera tout ce dont vous avez besoin <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install task-samba-dc</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Si task-samba-dc subitement, contrairement aux assurances de la documentation, Alta refuse d'installer tout le n√©cessaire.</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install python-module-samba-DC samba-DC-common samba-DC-winbind-clients samba-DC-winbind samba-DC-common-libs libpytalloc-devel</span></span></code> </pre> <br></div></div><br>  Ensuite, proc√©dez √† la configuration de Kerberos et recevez un ticket.  Ouvrez le fichier krb5.conf, acc√©dez √† la section [libdefaults] et apportez-le sous la forme suivante: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vim /etc/krb5.conf</span></span></code> </pre> <br><pre> <code class="bash hljs"> dns_lookup_kdc = <span class="hljs-literal"><span class="hljs-literal">true</span></span> dns_lookup_realm = <span class="hljs-literal"><span class="hljs-literal">true</span></span> default_realm = TEST.LOCAL</code> </pre> <br>  Demander un billet <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># kinit administrator Password for administrator@TEST.LOCAL:</span></span></code> </pre> <br>  V√©rification de la liste des tickets Kerberos re√ßus <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># klist Ticket cache: KEYRING:persistent:0:0 Default principal: administrator@TEST.LOCAL Valid starting Expires Service principal 16.05.2019 11:51:38 16.05.2019 21:51:38 krbtgt/TEST.LOCAL@TEST.LOCAL renew until 23.05.2019 11:51:35</span></span></code> </pre> <br>  Maintenant, supprimez ou renommez la configuration samba existante. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mv smb.conf smb.conf.bak1</span></span></code> </pre> <br>  Enfin, nous entrons le deuxi√®me contr√¥leur dans le domaine AD: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># samba-tool domain join test.local DC -U"TEST\administrator"</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">L'entr√©e r√©ussie sera suivie du journal suivant</b> <div class="spoiler_text"><pre> <code class="bash hljs">Finding a writeable DC <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> domain <span class="hljs-string"><span class="hljs-string">'test.local'</span></span> Found DC DC1.TEST.LOCAL Password <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [TEST\administrator]: Reconnecting to naming master e31d7da6-8f56-4420-8473-80f2b3a31338._msdcs.TEST. LOCAL DNS name of new naming master is DC1.TEST.LOCAL workgroup is TEST realm is TEST.LOCAL Adding CN=DC2,OU=Domain Controllers,DC=TEST,DC=LOCAL Adding CN=DC2,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC =TEST,DC=LOCAL Adding CN=NTDS Settings,CN=DC2,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN =Configuration,DC=TEST,DC=LOCAL Adding SPNs to CN=DC2,OU=Domain Controllers,DC=TEST,DC=LOCAL Setting account password <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DC2$ Enabling account Calling bare provision Looking up IPv4 addresses Looking up IPv6 addresses No IPv6 address will be assigned Setting up share.ldb Setting up secrets.ldb Setting up the registry Setting up the privileges database Setting up idmap db Setting up SAM db Setting up sam.ldb partitions and settings Setting up sam.ldb rootDSE Pre-loading the Samba 4 and AD schema A Kerberos configuration suitable <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Samba AD has been generated at /var/lib/sa mba/private/krb5.conf Provision OK <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> domain DN DC=TEST,DC=LOCAL Starting replication Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[402/1426] linked _values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[804/1426] linked _values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[1206/1426] linke d_values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[1608/1426] linke d_values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[1743/1426] linke d_values[0/0] Analyze and apply schema objects Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[402/2240] linked_values[0/ 24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[804/2240] linked_values[0/ 24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[1206/2240] linked_values[0 /24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[1608/2240] linked_values[0 /24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[1772/2240] linked_values[2 4/24] Replicating critical objects from the base DN of the domain Partition[DC=TEST,DC=LOCAL] objects[109/110] linked_values[26/29] Partition[DC=TEST,DC=LOCAL] objects[394/5008] linked_values[29/29] Done with always replicated NC (base, config, schema) Replicating DC=DomainDnsZones,DC=TEST,DC=LOCAL Partition[DC=DomainDnsZones,DC=TEST,DC=LOCAL] objects[42/42] linked_values[0/0] Replicating DC=ForestDnsZones,DC=TEST,DC=LOCAL Partition[DC=ForestDnsZones,DC=TEST,DC=LOCAL] objects[20/20] linked_values[0/0] Exop on[CN=RID Manager$,CN=System,DC=TEST,DC=LOCAL] objects[3] linked_values[0] Committing SAM database Adding 1 remote DNS records <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DC2.TEST.LOCAL Adding DNS A record DC2.TEST.LOCAL <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> IPv4 IP: 192.168.90.201 Adding DNS CNAME record 6ff1df40-cbb5-41f0-b7b3-53a27dde8edf._msdcs.TEST.LOCAL <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DC2.TEST.LOCAL All other DNS records (like _ldap SRV records) will be created samba_dnsupdate on first startup Replicating new DNS records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> DC=DomainDnsZones,DC=TEST,DC=LOCAL Partition[DC=DomainDnsZones,DC=TEST,DC=LOCAL] objects[1/42] linked_values[0/0] Replicating new DNS records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> DC=ForestDnsZones,DC=TEST,DC=LOCAL Partition[DC=ForestDnsZones,DC=TEST,DC=LOCAL] objects[1/20] linked_values[0/0] Sending DsReplicaUpdateRefs <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> all the replicated partitions Setting isSynchronized and dsServiceName Setting up secrets database Joined domain TEST (SID S-1-5-21-3959064270-1572045903-2556826204) as a DC</code> </pre> <br></div></div><br>  Un enregistrement sur le nouveau contr√¥leur de domaine dans le domaine TEST.LOCAL doit appara√Ætre dans le composant logiciel enfichable ADUC, et un nouvel enregistrement A correspondant √† DC2 doit appara√Ætre dans le gestionnaire DNS. </li><li>  <b>R√©plication entre contr√¥leurs</b> <br><br>  Pour commencer, consultez le service de r√©plication d'annuaire (DRS) <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># samba-tool drs showrepl</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Toutes les tentatives de r√©plication en sortie doivent r√©ussir.</b>  <b class="spoiler_title">Dans la liste des objets KCC, dans les 15 minutes suivant la saisie, notre DC1 sur Windows devrait appara√Ætre</b> <div class="spoiler_text"><pre> <code class="bash hljs">Default-First-Site-Name\DC2 DSA Options: 0x00000001 DSA object GUID: 0e9f5bce-ff59-401e-bdbd-fc69df3fc6bf DSA invocationId: 017997b5-d718-41d7-a3f3-e57ab5151b5c ==== INBOUND NEIGHBORS ==== DC=ForestDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:31 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:31 2019 MSK DC=DomainDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:32 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:32 2019 MSK CN=Schema,CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:32 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:32 2019 MSK DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:32 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:32 2019 MSK CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:33 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:33 2019 MSK ==== OUTBOUND NEIGHBORS ==== DC=ForestDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:03 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:03 2019 MSK DC=DomainDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:03 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:03 2019 MSK CN=Schema,CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:08 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:08 2019 MSK DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:08 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:08 2019 MSK CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:12:17 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:12:17 2019 MSK ==== KCC CONNECTION OBJECTS ==== Connection -- Connection name: 6d2652b3-e723-4af7-a19f-1ee48915753c Enabled : TRUE Server DNS name : DC1.test.local Server DN name : CN=NTDS Settings,CN=DC1,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> TransportType: RPC options: 0x00000001 Warning: No NC replicated <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Connection!</code> </pre> <br></div></div><br>  Avertissement <i>"Aucun NC r√©pliqu√© pour la connexion!"</i>  peut √™tre ignor√© en toute s√©curit√©.  Cela semble d√ª au fait que lors de l'enregistrement d'un nouveau contr√¥leur de domaine, samba d√©finit de mani√®re incorrecte certains indicateurs de r√©plication. <br><br>  La v√©rification de la r√©plication LDAP est √©galement une bonne id√©e. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># samba-tool ldapcmp ldap://dc1.test.local ldap://dc2.test.local -Uadministrator</span></span></code> </pre> <br>  La commande ci-dessus comparera les valeurs d'attribut des objets de l'ensemble du r√©pertoire sur DC1 et DC2. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple de r√©plication r√©ussie</b> <div class="spoiler_text"><pre> <code class="bash hljs">* Comparing [DOMAIN] context... * Objects to be compared: 249 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [DOMAIN]: SUCCESS * Comparing [CONFIGURATION] context... * Objects to be compared: 1750 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [CONFIGURATION]: SUCCESS * Comparing [SCHEMA] context... * Objects to be compared: 1739 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [SCHEMA]: SUCCESS * Comparing [DNSDOMAIN] context... * Objects to be compared: 42 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [DNSDOMAIN]: SUCCESS * Comparing [DNSFOREST] context... * Objects to be compared: 20 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [DNSFOREST]: SUCCESS</code> </pre> </div></div><br>  Dans certains cas, les attributs des objets sur diff√©rents contr√¥leurs peuvent diff√©rer et la sortie de la commande vous en informera.  Mais ce ne sera pas dans tous les cas le signe d'un probl√®me de r√©plication. <br><br>  L'√©tape suivante consiste √† configurer manuellement la r√©plication stable du r√©pertoire SysVol. <br>  Le fait est que samba ne prend pas encore en charge DFS-R, car il ne prend pas en charge le FRS pr√©c√©dent.  Par cons√©quent, pour la r√©plication entre DC Samba et Windows, la seule solution qui fonctionne aujourd'hui est la r√©plication unidirectionnelle √† l'aide de l'utilitaire <i>Robocopy √†</i> partir des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">outils du Kit de ressources Windows Server 2003</a> . <br><br>  Les d√©veloppeurs de Samba, afin d'√©viter les probl√®mes de compatibilit√©, recommandent d'abord d'installer le kit utilitaire sur un poste de travail normal, puis copiez Robocopy sur le contr√¥leur dans le dossier ¬´C: \ Program Files (x86) \ Windows Resource Kits \ Tools \¬ª <br><br>  Apr√®s l'installation, dans le planificateur de t√¢ches sur le contr√¥leur Windows, nous cr√©ons une t√¢che pour la r√©plication avec les param√®tres suivants: <br><br>  - Effectuer pour tous les utilisateurs <br>  - D√©clenchement pour ex√©cuter quotidiennement toutes les 5 minutes pendant la journ√©e <br>  - Dans les actions on prescrit le chemin vers l'utilitaire robocopy, on indique comme arguments: <br><br><pre> <code class="xml hljs">\\DC1\SYSVOL\test.local\ \\DC2\SYSVOL\test.local\ /mir /sec</code> </pre> <br>  Dans un cas sp√©cifique, copiez le contenu du r√©pertoire SysVol de DC1 vers DC2. <br></li><li>  <b>Dossiers utilisateur portables utilisant la configuration pam_mount</b> <br><br>  Empiriquement, j'ai trouv√© deux options viables pour r√©soudre ce probl√®me avec son aide. <br><br><ol><li>  Montage complet du dossier de profils du r√©seau √† la section / home <br><br>  Une option simple.  Cela fonctionne bien si les noms de dossier Mes documents, T√©l√©chargements et Bureau sont les m√™mes sur les deux syst√®mes d'exploitation.  Il est entendu qu'un PC Linux a d√©j√† √©t√© entr√© dans le domaine et que les utilisateurs sont connect√©s sous leurs comptes de domaine en utilisant sssd comme m√©canisme d'authentification et d'autorisation. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vim /etc/security/pam_mount.conf.xml</span></span></code> </pre> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000000000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  o√π: <br><br><ul><li>  <b>uid = "100000000-2000000000"</b> - la plage UID attribu√©e aux utilisateurs de domaine √† partir de SSSD </li><li>  <b>server = "dfs"</b> - nom du serveur de fichiers </li><li>  <b>path = "Profile_Users /% (USER)"</b> - une ressource sur le serveur de fichiers avec le profil utilisateur h√©berg√© </li><li>  <b>mountpoint = "~"</b> - chemin de montage vers le dossier de d√©part de l'utilisateur </li></ul><br>  Le login de l'utilisateur est transmis √† la variable macro "% (USER)" utilis√©e par pam_mount pour connecter notre ressource r√©seau, sous la forme dans laquelle elle est entr√©e dans le gestionnaire d'affichage.  Par cons√©quent, il est important que la connexion DM soit entr√©e sans indication explicite du nom de domaine. <br><br>  Dans sssd.conf, cela est r√©solu en commentant ou en d√©finissant la valeur False sur l'option <b>use_fully_qualified_names</b> , qui active le mode nom complet (y compris le domaine) pour les utilisateurs et les groupes. <br></li><li>  La deuxi√®me m√©thode est moins simple et maladroite, et √† mon avis plus pratique et pr√©f√©r√©e.  La diff√©rence par rapport au premier uniquement dans la configuration pam_mount <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vim /etc/security/pam_mount.conf.xml</span></span></code> </pre> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000200000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)/ "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~/ "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000200000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)/Downloads"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000200000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)/ "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  Autrement dit, nous montons simplement chacun de nos dossiers s√©par√©ment dans le r√©pertoire correspondant </li></ol></li></ol><br>  <b>Conclusions</b> <br><br>  Plus d'un demi-mois de travail sur un banc de test, ce bundle a surv√©cu avec succ√®s √† plusieurs arr√™ts altern√©s √† long terme et √† court terme des deux contr√¥leurs, sans pratiquement aucune cons√©quence pour les clients (une fois qu'un client sur Windows7 a perdu confiance). <br><br>  En g√©n√©ral, j'ai eu une impression plut√¥t agr√©able de travailler avec ce produit, malgr√© toutes les nuances auxquelles j'ai d√ª faire face √† la fois dans l'article et dans les coulisses. <br><br>  Il y a des pi√®ges, il y en a beaucoup, et au cours du travail avec la samba, ils devront √™tre captur√©s en grande quantit√©.  Cependant, √† ce jour, aucune autre solution ne vous permet d'organiser un environnement hybride √† l'aide des services d'annuaire et sans utiliser Windows. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450572/">https://habr.com/ru/post/fr450572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450554/index.html">Briser le mod√®le de conception - Singleton en PHP</a></li>
<li><a href="../fr450556/index.html">Indice de valve - examen du nouvel ensemble VR</a></li>
<li><a href="../fr450564/index.html">Paillettes et pauvret√©: comment la r√©volution num√©rique a rendu les musiciens plus pauvres</a></li>
<li><a href="../fr450566/index.html">OutOfMemory et l'utilisation d'images vectorielles dans Android Studio</a></li>
<li><a href="../fr450568/index.html">Chaque poison a son propre antidote. Comment √©conomiser ou au moins essayer (mise √† jour: √† propos des antidotes contre les empoisonnements domestiques)</a></li>
<li><a href="../fr450574/index.html">Cr√©er un jeu web .io multijoueur</a></li>
<li><a href="../fr450576/index.html">De nouvelles r√®gles pour l'anonymat des messagers</a></li>
<li><a href="../fr450578/index.html">Qu'entend-on dans l'air? Nous recevons et d√©codons les signaux les plus int√©ressants. Partie 2, VHF</a></li>
<li><a href="../fr450582/index.html">Principes PIM</a></li>
<li><a href="../fr450586/index.html">Fish Redux - Nouvelle biblioth√®que Redux pour Flutter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>