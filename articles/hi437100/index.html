<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйЁЯП╗тАНЁЯдЭтАНЁЯСиЁЯП╜ ЁЯСйЁЯП╛тАНЁЯФм ЁЯеЭ The Witcher 3 рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреА рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ ЁЯСиЁЯП╜тАНЁЯН│ ЁЯР║ ЁЯШМ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЕрдиреБрд╡рд╛рдж рдХрд╛ рдкрд╣рд▓рд╛ рднрд╛рдЧ рдпрд╣рд╛рдБ рд╣реИ ред рдЗрд╕ рднрд╛рдЧ рдореЗрдВ, рд╣рдо рдмрд╛рд░рд┐рд╢ рдХреЗ рджреМрд░рд╛рди рддреАрдЦреЗрдкрди, рдФрд╕рдд рдЪрдордХ, рдЪрд╛рдБрдж рдЪрд░рдгреЛрдВ рдФрд░ рд╡рд╛рдпреБрдордВрдбрд▓реАрдп рдШрдЯрдирд╛рдУрдВ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред 

 рднрд╛рдЧ 6...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>The Witcher 3 рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреА рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437100/">  рдЕрдиреБрд╡рд╛рдж рдХрд╛ рдкрд╣рд▓рд╛ рднрд╛рдЧ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ рд╣реИ</a> ред  рдЗрд╕ рднрд╛рдЧ рдореЗрдВ, рд╣рдо рдмрд╛рд░рд┐рд╢ рдХреЗ рджреМрд░рд╛рди рддреАрдЦреЗрдкрди, рдФрд╕рдд рдЪрдордХ, рдЪрд╛рдБрдж рдЪрд░рдгреЛрдВ рдФрд░ рд╡рд╛рдпреБрдордВрдбрд▓реАрдп рдШрдЯрдирд╛рдУрдВ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред <br><br><h2>  рднрд╛рдЧ 6. рддреЗрдЬ рдХрд░реЛ </h2><br>  рдЗрд╕ рднрд╛рдЧ рдореЗрдВ, рд╣рдо рдж рд╡рд┐рдЪрд░ 3 - рд╢рд╛рд░реНрдкрди рд╕реЗ рдПрдХ рдФрд░ рдкреЛрд╕реНрдЯ-рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкреНрд░рднрд╛рд╡ рдкрд░ рдХрд░реАрдм рд╕реЗ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВрдЧреЗред <br><br>  Sharpening рдЖрдЙрдЯрдкреБрдЯ рдЗрдореЗрдЬ рдХреЛ рдереЛрдбрд╝рд╛ рд╢рд╛рд░реНрдк рдмрдирд╛рддрд╛ рд╣реИред  рдпрд╣ рдкреНрд░рднрд╛рд╡ рд╣рдореЗрдВ рдлрд╝реЛрдЯреЛрд╢реЙрдк рдФрд░ рдЕрдиреНрдп рдЧреНрд░рд╛рдлрд┐рдХ рд╕рдВрдкрд╛рджрдХреЛрдВ рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИред <br><br>  рдж рд╡рд┐рдЪрд░ 3 рдореЗрдВ, рд╢рд╛рд░реНрдкрдирд┐рдВрдЧ рдХреЗ рджреЛ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ: рдирд┐рдореНрди рдФрд░ рдЙрдЪреНрдЪред  рдореИрдВ рдЙрдирдХреЗ рдмреАрдЪ рдХреЗ рдЕрдВрддрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реВрдВрдЧрд╛, рд▓реЗрдХрд┐рди рдЕрднреА рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓рддреЗ рд╣реИрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/285/1fc/6bc/2851fc6bc19e39660e0307f2775b0322.png" alt="рдЫрд╡рд┐"></div><br>  <i>рд╡рд┐рдХрд▓реНрдк "рдХрдо" - рддрдХ</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc2/cd4/4cd/dc2cd44cd83306f2c08bbf7f87831d8c.png" alt="рдЫрд╡рд┐"></div><br>  <i>рд╡рд┐рдХрд▓реНрдк "рдХрдо" - рдХреЗ рдмрд╛рдж</i> <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aad/807/2aa/aad8072aa3977f32549856c0be24206b.png"></div><br>  <i>рдЙрдЪреНрдЪ рд╡рд┐рдХрд▓реНрдк - рдЕрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b87/3ce/0f3/b873ce0f320a785f4fb4bc83e9a696f5.png"></div><br>  <i>рд╡рд┐рдХрд▓реНрдк "рдЙрдЪреНрдЪ" - рдХреЗ рдмрд╛рдж</i> <br><br>  рдпрджрд┐ рдЖрдк рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд (рд╕рдВрд╡рд╛рджрд╛рддреНрдордХ) рддреБрд▓рдирд╛рдУрдВ рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдирд╡рд┐рдбрд┐рдпрд╛ рдж рд╡рд┐рдЪрд░ 3 рдбреА рдЧрд╛рдЗрдб рдореЗрдВ рдЕрдиреБрднрд╛рдЧ рджреЗрдЦреЗрдВ</a> ред  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдкреНрд░рднрд╛рд╡ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдШрд╛рд╕ рдФрд░ рдкрддреНрддреЗ рдкрд░ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИред <br><br>  рдкреЛрд╕реНрдЯ рдХреЗ рдЗрд╕ рднрд╛рдЧ рдореЗрдВ, рд╣рдо рдЦреЗрд▓ рдХреА рд╢реБрд░реБрдЖрдд рд╕реЗ рд╣реА рдлреНрд░реЗрдо рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░реЗрдВрдЧреЗ: рдореИрдВрдиреЗ рдЗрд╕реЗ рдЬрд╛рдирдмреВрдЭрдХрд░ рдЪреБрдирд╛, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣рд╛рдВ рд╣рдо рд░рд╛рд╣рдд (рд▓рдВрдмреА рдбреНрд░рд╛рдЗрдВрдЧ рджреВрд░реА) рдФрд░ рдЖрдХрд╛рд╢ рдХреЗ рдЧреБрдВрдмрдж рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/898/e97/895/898e9789593705231157a07ebcf34f5e.png"></div><br>  рдЗрдирдкреБрдЯ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рд╢рд╛рд░реНрдкрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдХрд▓рд░ рдмрдлрд░ <b>t0</b> (LDR рдХреЗ рдмрд╛рдж рдЯреЛрди рдХрд░реЗрдХреНрд╢рди рдФрд░ рд▓реЗрдВрд╕ рдлреНрд▓реЗрдпрд░реНрд╕) рдФрд░ рдбреЗрдкреНрде рдмрдлрд░ <b>t1 рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ</b> ред <br><br>  рдЪрд▓реЛ рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреЗ рд▓рд┐рдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ: <br><br> <code>ps_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb3[3], immediateIndexed <br> dcl_constantbuffer cb12[23], immediateIndexed <br> dcl_sampler s0, mode_default <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_resource_texture2d (float,float,float,float) t1 <br> dcl_input_ps_siv v0.xy, position <br> dcl_output o0.xyzw <br> dcl_temps 7 <br> 0: ftoi r0.xy, v0.xyxx <br> 1: mov r0.zw, l(0, 0, 0, 0) <br> 2: ld_indexable(texture2d)(float,float,float,float) r0.x, r0.xyzw, t1.xyzw <br> 3: mad r0.x, r0.x, cb12[22].x, cb12[22].y <br> 4: mad r0.y, r0.x, cb12[21].x, cb12[21].y <br> 5: max r0.y, r0.y, l(0.000100) <br> 6: div r0.y, l(1.000000, 1.000000, 1.000000, 1.000000), r0.y <br> 7: mad_sat r0.y, r0.y, cb3[1].z, cb3[1].w <br> 8: add r0.z, -cb3[1].x, cb3[1].y <br> 9: mad r0.y, r0.y, r0.z, cb3[1].x <br> 10: add r0.y, r0.y, l(1.000000) <br> 11: ge r0.x, r0.x, l(1.000000) <br> 12: movc r0.x, r0.x, l(0), l(1.000000) <br> 13: mul r0.z, r0.x, r0.y <br> 14: round_z r1.xy, v0.xyxx <br> 15: add r1.xy, r1.xyxx, l(0.500000, 0.500000, 0.000000, 0.000000) <br> 16: div r1.xy, r1.xyxx, cb3[0].zwzz <br> 17: sample_l(texture2d)(float,float,float,float) r2.xyz, r1.xyxx, t0.xyzw, s0, l(0) <br> 18: lt r0.z, l(0), r0.z <br> 19: if_nz r0.z <br> 20: div r3.xy, l(0.500000, 0.500000, 0.000000, 0.000000), cb3[0].zwzz <br> 21: add r0.zw, r1.xxxy, -r3.xxxy <br> 22: sample_l(texture2d)(float,float,float,float) r4.xyz, r0.zwzz, t0.xyzw, s0, l(0) <br> 23: mov r3.zw, -r3.xxxy <br> 24: add r5.xyzw, r1.xyxy, r3.zyxw <br> 25: sample_l(texture2d)(float,float,float,float) r6.xyz, r5.xyxx, t0.xyzw, s0, l(0) <br> 26: add r4.xyz, r4.xyzx, r6.xyzx <br> 27: sample_l(texture2d)(float,float,float,float) r5.xyz, r5.zwzz, t0.xyzw, s0, l(0) <br> 28: add r4.xyz, r4.xyzx, r5.xyzx <br> 29: add r0.zw, r1.xxxy, r3.xxxy <br> 30: sample_l(texture2d)(float,float,float,float) r1.xyz, r0.zwzz, t0.xyzw, s0, l(0) <br> 31: add r1.xyz, r1.xyzx, r4.xyzx <br> 32: mul r3.xyz, r1.xyzx, l(0.250000, 0.250000, 0.250000, 0.000000) <br> 33: mad r1.xyz, -r1.xyzx, l(0.250000, 0.250000, 0.250000, 0.000000), r2.xyzx <br> 34: max r0.z, abs(r1.z), abs(r1.y) <br> 35: max r0.z, r0.z, abs(r1.x) <br> 36: mad_sat r0.z, r0.z, cb3[2].x, cb3[2].y <br> 37: mad r0.x, r0.y, r0.x, l(-1.000000) <br> 38: mad r0.x, r0.z, r0.x, l(1.000000) <br> 39: dp3 r0.y, l(0.212600, 0.715200, 0.072200, 0.000000), r2.xyzx <br> 40: dp3 r0.z, l(0.212600, 0.715200, 0.072200, 0.000000), r3.xyzx <br> 41: max r0.w, r0.y, l(0.000100) <br> 42: div r1.xyz, r2.xyzx, r0.wwww <br> 43: add r0.y, -r0.z, r0.y <br> 44: mad r0.x, r0.x, r0.y, r0.z <br> 45: max r0.x, r0.x, l(0) <br> 46: mul r2.xyz, r0.xxxx, r1.xyzx <br> 47: endif <br> 48: mov o0.xyz, r2.xyzx <br> 49: mov o0.w, l(1.000000) <br> 50: ret</code> <br> <br>  рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреА 50 рд▓рд╛рдЗрдиреЗрдВ рдПрдХ рд╡реНрдпрд╡рд╣рд╛рд░реНрдп рдХрд╛рд░реНрдп рдХреА рддрд░рд╣ рджрд┐рдЦрддреА рд╣реИрдВред  рдЗрд╕реЗ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдЙрддрд░реЗрдВред <br><br><h3>  рд╢рд╛рд░реНрдк рд╡реИрд▓реНрдпреВ рдЬрдирд░реЗрд╢рди </h3><br>  рдкрд╣рд▓рд╛ рдХрджрдо рдЧрд╣рд░рд╛рдИ рдмрдлрд░ (рдкрдВрдХреНрддрд┐ 1) рдХреЛ рд▓реЛрдб рдХрд░рдирд╛ рд╣реИред  рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ "рдж рд╡рд┐рдЪрд░ 3" рдПрдХ рдФрдВрдзрд╛ рдЧрд╣рд░рд╛рдИ (1.0 - рдХрд░реАрдм, 0.0 - рджреВрд░) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ, рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдХреА рдЧрд╣рд░рд╛рдИ рдХреЛ рдмрд┐рдирд╛ рд░реЗрдЦрд╛ рдХреЗ рд╕рд╛рде рдмрд╛рдВрдзрд╛ рдЬрд╛рддрд╛ рд╣реИ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП рдпрд╣ рд▓реЗрдЦ рджреЗрдЦреЗрдВ</a> )ред <br><br>  рд▓рд╛рдЗрдиреЗрдВ 3-6 рдЗрд╕ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдЧрд╣рд░рд╛рдИ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рд╣реА рджрд┐рд▓рдЪрд╕реНрдк рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВ [1.0 - 0.0] [рдирд┐рдХрдЯ-рджреВрд░] рдореВрд▓реНрдпреЛрдВ рдХреЗ рд╕рд╛рде (рд╣рдордиреЗ рдЙрдиреНрд╣реЗрдВ рдореИрдЯреНрд░рд┐рдХреНрд╕рдкрд░реНрд╕рд┐рд╡реЗрдлрд┐рдПрд╡ рд╕реНрдЯреЗрдЬ рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рд╣реИ)ред  рд╕реНрдерд┐рд░ рдмрдлрд░ рд╕реЗ рдорд╛рдиреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/636/345/52a/63634552ae9daf03f14305c118cccc25.png"></div><br>  рдорд╛рди реж.реи рдХреЗ "рдкрд╛рд╕" рдФрд░ "рд╕реБрджреВрд░" релрежрежреж рдХреЗ рдорд╛рди рдХреЗ рдмрд╛рдж, рд╣рдо cb12_v21.xy рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br> <code>cb12_v21.y = 1.0 / near <br> cb12_v21.x = - (1.0 / near) + (1.0 / near) * (near / far)</code> <br> <br>  TW3 рдХреЛрдб рдореЗрдВ рдХреЛрдб рдХрд╛ рдпрд╣ рдЯреБрдХрдбрд╝рд╛ рдХрд╛рдлреА рд╕рд╛рдорд╛рдиреНрдп рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕рд┐рд░реНрдл рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╣реИред <br><br>  "рджреГрд╢реНрдпрддрд╛ рдХреЗ рдкрд┐рд░рд╛рдорд┐рдб рдХреА рдЧрд╣рд░рд╛рдИ" рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд▓рд╛рдЗрди 7 рдкреНрд░рдХреНрд╖реЗрдк рдЧреБрдгрд╛рдВрдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреИрдорд╛рдиреЗ / рд╡рд┐рд░реВрдкрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ (рдпрд╣рд╛рдВ рд╣рдо рдЕрдВрддрд░рд╛рд▓ рдХреЛ рдореВрд▓реНрдпреЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдВрддреГрдкреНрдд</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ [0-1])ред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e89/efd/571/e89efd5711cb2aa1a3c544e9deda9321.png"></div><br>  cb3_v1.xy рдФрд░ cb3_v2.xy - рдпрд╣ рдЫреЛрдЯреА рдФрд░ рд▓рдВрдмреА рджреВрд░реА рдкрд░ рддреАрдХреНрд╖реНрдг рдкреНрд░рднрд╛рд╡ рдХреА рдЪрдордХ рд╣реИред  рдЪрд▓реЛ рдЙрдиреНрд╣реЗрдВ рддреАрдХреНрд╖реНрдгрддрд╛ рд╕реЗ рдмреБрд▓рд╛рдПрдВ рдФрд░ рддреЗрдЬ рдХрд░реЗрдВред  рдФрд░ рдпрд╣ "рдХрдо" рдФрд░ "рдЙрдЪреНрдЪ" рдХреЗ рдмреАрдЪ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рдЕрдВрддрд░ рд╣реИ, рдЬреЛ рдХрд┐ рдж рд╡рд┐рдЪрд░ 3 рдореЗрдВ рдЗрд╕ рдЖрд╢рдп рдХрд╛ рд╣реИред <br><br>  рдЕрдм рдкрд░рд┐рдгрд╛рдореА рдЕрдиреБрдкрд╛рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред  рд▓рд╛рдЗрдиреНрд╕ 8-9 рдмрд╕ <code>lerp(sharpenNear, sharpenFar, interpolationCoeff)</code> ред  рдпрд╣ рдХрд┐рд╕ рд▓рд┐рдП рд╣реИ?  рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рд╣рдореЗрдВ рдЧреЗрд░рд╛рд▓реНрдЯ рдХреЗ рдкрд╛рд╕ рдФрд░ рдЙрд╕рд╕реЗ рджреВрд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЪрдордХ рдорд┐рд▓рддреА рд╣реИред  рдПрдХ рдмрд╛рд░ рджреЗрдЦ рд▓реЛ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/646/233/515/6462335151728759f236b58f14b894dd.png"></div><br>  рд╢рд╛рдпрдж рдпрд╣ рдореБрд╢реНрдХрд┐рд▓ рд╕реЗ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рд╣рдордиреЗ рдЦрд┐рд▓рд╛рдбрд╝реА (2.177151) рдХреЗ рдмрдЧрд▓ рдореЗрдВ рддреЗрдЬ рдЪрдордХ рдХреА рджреВрд░реА рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкреНрд░рдХреНрд╖реЗрдк рдХрд┐рдпрд╛ рдФрд░ рдкреНрд░рднрд╛рд╡ рдЪрдордХ рдмрд╣реБрдд рджреВрд░ (1.91303) рд╣реИред  рдЗрд╕ рдЧрдгрдирд╛ рдХреЗ рдмрд╛рдж, рд╣рдо 1.0 рдХреЛ рдЪрдордХ (рдкрдВрдХреНрддрд┐ 10) рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред  рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреНрдпреЛрдВ рд╣реИ?  рдорд╛рди рд▓реАрдЬрд┐рдП рдКрдкрд░ рджрд┐рдЦрд╛рдП рдЧрдП рдСрдкрд░реЗрд╢рди lerp рдиреЗ рд╣рдореЗрдВ 0.0 рджрд┐рдпрд╛ред  1.0 рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ 1.0 рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣ рдПрдХ рдРрд╕рд╛ рдореВрд▓реНрдп рд╣реИ рдЬреЛ рдкреИрдирд╛рдкрди рдХрд░рддреЗ рд╕рдордп рдкрд┐рдХреНрд╕реЗрд▓ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред  рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдиреАрдЪреЗ рдкрдврд╝реЗрдВред <br><br>  рддреЗрдЬ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдЖрдХрд╛рд╢ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдпрд╣ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд╕рд╢рд░реНрдд рдЬрд╛рдВрдЪ рдЬреЛрдбрд╝рдХрд░ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <br><br> <code>//   sharpen   <br> float fSkyboxTest = (fDepth &gt;= 1.0) ? 0 : 1;</code> <br> <br>  рдж рд╡рд┐рдЪрд░ 3 рдореЗрдВ, рдЖрдХрд╛рд╢ рдХреА рдкрд┐рдХреНрд╕реЗрд▓ рдЧрд╣рд░рд╛рдИ рдХрд╛ рдорд╛рди 1.0 рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХрд╛ "рдмрд╛рдЗрдирд░реА рдлрд╝рд┐рд▓реНрдЯрд░" рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВ (рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рддрдереНрдп: рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЪрд░рдг</a> рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛)ред <br><br>  рдЕрдм рд╣рдо "рд╕реНрдХрд╛рдИ рдлрд┐рд▓реНрдЯрд░" рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рдЪрдордХ рдХреЛ рдЧреБрдгрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/63c/ed1/f50/63ced1f5036d9ee63cfe54de6a501bc1.png"></div><br>  рдпрд╣ рдЧреБрдгрди рдкрдВрдХреНрддрд┐ 13 рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рд╢реЗрдбрд░ рдХреЛрдб рдЙрджрд╛рд╣рд░рдг: <br><br> <code>//    sharpen <br> float fSharpenAmount = fSharpenIntensity * fSkyboxTest;</code> <br> <br><h3>  рдкрд┐рдХреНрд╕реЗрд▓ рдирдореВрдирд╛ рдХреЗрдВрджреНрд░ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">SV_Position</a> рдХрд╛ рдПрдХ рдкрд╣рд▓реВ рд╣реИ рдЬреЛ рдпрд╣рд╛рдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛрдЧрд╛: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХ рдЖрдзрд╛ рдкрд┐рдХреНрд╕реЗрд▓ рдСрдлрд╕реЗрдЯ</a> ред  рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдКрдкрд░реА рдмрд╛рдПрдБ рдХреЛрдиреЗ (0, 0) рдХреЗ рдкрд┐рдХреНрд╕реЗрд▓ рдореЗрдВ SV_Position.xy рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ (0, 0) рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди (0.5, 0.5) рд╣реИред  рд╡рд╛рд╣! <br><br>  рдпрд╣рд╛рдВ рд╣рдо рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рдПрдХ рдирдореВрдирд╛ рд▓реЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдЗрдП 14-16 рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рджреЗрдЦреЗрдВред  рдЖрдк рдЙрдиреНрд╣реЗрдВ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ: <br><br> <code>//   . <br> //   ""   SV_Position.xy. <br> float2 uvCenter = trunc( Input.Position.xy ); <br> <br> //   ,       <br> uvCenter += float2(0.5, 0.5); <br> uvCenter /= g_Viewport.xy</code> <br> <br>  рдФрд░ рдмрд╛рдж рдореЗрдВ, рд╣рдо рдЯреЗрдХреНрд╕рдХреЛрд░реНрдбреНрд╕ "рдпреВрд╡реАрдХреЗрдВрдЯрд░" рд╕реЗ рдЗрдирдкреБрдЯ рд░рдВрдЧ рдХреА рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрддреЗ рд╣реИрдВред  рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВ, рдирдореВрдиреЗ рдХрд╛ рдкрд░рд┐рдгрд╛рдо "рд╕рд╛рдорд╛рдиреНрдп" рд╡рд┐рдзрд┐ (SV_Position.xy / ViewportSize.xy) рдХреЗ рд╕рдорд╛рди рд╣реЛрдЧрд╛ред <br><br><h3>  рддреЗрдЬ рдХрд░рдирд╛ рдпрд╛ рди рдХрд░рдирд╛ </h3><br>  рдкреИрдирд╛рдкрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рдирд┐рд░реНрдгрдп fSharpenAmount рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред <br><br> <code>//     <br> float3 colorCenter = TexColorBuffer.SampleLevel( samplerLinearClamp, uvCenter, 0 ).rgb; <br> <br> //   <br> float3 finalColor = colorCenter; <br> <br> if ( fSharpenAmount &gt; 0 ) <br> { <br> //   sharpening... <br> } <br> <br> return float4( finalColor, 1 );</code> <br> <br><h3>  рдкреИрдирд╛ </h3><br>  рдпрд╣ рдПрд▓реНрдЧреЛрд░рд┐рдердо рдХреЗ рдЗрдирд╕рд╛рдЗрдб рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред <br><br>  рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ, рдпрд╣ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреНрд░рд┐рдпрд╛рдПрдВ рдХрд░рддрд╛ рд╣реИ: <br><br>  - рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рдХреЛрдиреЛрдВ рдкрд░ рдЪрд╛рд░ рдмрд╛рд░ рдЗрдирдкреБрдЯ рд░рдВрдЧ рдХреА рдмрдирд╛рд╡рдЯ рдХреЗ рдирдореВрдиреЗ, <br><br>  - рдирдореВрдиреЗ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдФрд░ рдФрд╕рдд рдореВрд▓реНрдп рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ, <br><br>  - "рдХреЗрдВрджреНрд░" рдФрд░ "рдХреЛрдиреЗ рдПрд╡рд░реЗрдЬ" рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ: <br><br>  - рдЕрдВрддрд░ рдХрд╛ рдЕрдзрд┐рдХрддрдо рдирд┐рд░рдкреЗрдХреНрд╖ рдШрдЯрдХ рдкрд╛рддрд╛ рд╣реИ, <br><br>  - рдЕрдзрд┐рдХрддрдо рдХреЛ рд╕рд╣реА рдХрд░рддрд╛ рд╣реИред  рдкреЗрдЯред  рдкреИрдорд╛рдиреЗ + рдкреВрд░реНрд╡рд╛рдЧреНрд░рд╣ рдореВрд▓реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рдШрдЯрдХ, <br><br>  - рдЕрдзрд┐рдХрддрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреА рдорд╛рддреНрд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдкреЗрдЯред  рдЕрдВрдЧ <br><br>  - "CenterColor" рдФрд░ "averageColor" рдХреЗ рд▓рд┐рдП рдЪрдордХ рдореВрд▓реНрдп (рд▓реВрдорд╛) рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ, <br><br>  - рд░рдВрдЧрдХрд░реНрдореА рдХреЛ рдЙрд╕рдХреЗ рд▓реВрдорд╛ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ, <br><br>  - рдкреНрд░рднрд╛рд╡ рдХреА рднрдпрд╛рд╡рд╣рддрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдХ рдирдП, рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рд▓реВрдорд╛ рдорд╛рди рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ, <br><br>  - рдирдП рд▓реВрдорд╛ рдореВрд▓реНрдп рджреНрд╡рд╛рд░рд╛ рдХрд▓рд░рдХреЗрдВрдЯрд░ рдХреЛ рдЧреБрдгрд╛ рдХрд░реЗрдВред <br><br>  рдмрд╣реБрдд рд╕рд╛рд░реЗ рдХрд╛рдо, рдФрд░ рдореЗрд░реЗ рд▓рд┐рдП рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдерд╛, рдХреНрдпреЛрдВрдХрд┐ рдореИрдВрдиреЗ рдХрднреА рддреЗрдЬ рдкреИрдирд╛рдкрди рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдерд╛ред <br><br>  рдЪрд▓реЛ рдирдореВрдирд╛ рдкреИрдЯрд░реНрди рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЪрд╛рд░ рдмрдирд╛рд╡рдЯ рд░реАрдб рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред <br><br>  рдпрд╣ рдПрдХ рдкрд┐рдХреНрд╕реЗрд▓ рдЫрд╡рд┐ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдХрд▓рд╛рдХрд╛рд░ рдХрд╛ рдХреМрд╢рд▓ рд╕реНрддрд░ <i>рдПрдХ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд╣реИ</i> ): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e3/d46/5fa/5e3d465fadc0bccd551256c40c6e5368.png"></div><br>  Shader рдореЗрдВ рд╕рднреА рдкрдврд╝рддреЗ рд╣реИрдВ рдмрд┐рд▓рд┐рдирд┐рдпрд░ рд╕реИрдВрдкрд▓рд┐рдВрдЧ (D3D11_FILTER_MIN_MAG_LINEAR_MIP_POINT)ред <br><br>  рдкреНрд░рддреНрдпреЗрдХ рдХреЛрдг рдкрд░ рдХреЗрдВрджреНрд░ рд╕реЗ рдСрдлрд╕реЗрдЯ (0.5,, 0.5) рд╣реИ, рдЬреЛ рдХреЛрдг рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред <br><br>  рджреЗрдЦреЗрдВ рдХрд┐ рдЗрд╕реЗ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдкрд░ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ?  рдЖрдЗрдП рджреЗрдЦреЗрдВ: <br><br> <code>float2 uvCorner; <br> float2 uvOffset = float2( 0.5, 0.5 ) / g_Viewport.xy; // remember about division! <br> <br> float3 colorCorners = 0; <br> <br> //    <br> // -0,5, -0.5 <br> uvCorner = uvCenter - uvOffset; <br> colorCorners += TexColorBuffer.SampleLevel( samplerLinearClamp, uvCorner, 0 ).rgb; <br> <br> //    <br> // +0.5, -0.5 <br> uvCorner = uvCenter + float2(uvOffset.x, -uvOffset.y); <br> colorCorners += TexColorBuffer.SampleLevel( samplerLinearClamp, uvCorner, 0 ).rgb; <br> <br> //    <br> // -0.5, +0.5 <br> uvCorner = uvCenter + float2(-uvOffset.x, uvOffset.y); <br> colorCorners += TexColorBuffer.SampleLevel( samplerLinearClamp, uvCorner, 0 ).rgb; <br> <br> //    <br> // +0.5, +0.5 <br> uvCorner = uvCenter + uvOffset; <br> colorCorners += TexColorBuffer.SampleLevel( samplerLinearClamp, uvCorner, 0 ).rgb;</code> <br> <br>  рддреЛ, рдЕрдм рд╕рднреА рдЪрд╛рд░ рдирдореВрдиреЛрдВ рдХреЛ "colorCorners" рдЪрд░ рдореЗрдВ рд╕рдВрдХреНрд╖реЗрдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЖрдЗрдП рдЗрди рдЪрд░рдгреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ: <br><br> <code>//     <br> float3 averageColorCorners = colorCorners / 4.0; <br> <br> //    <br> float3 diffColor = colorCenter - averageColorCorners; <br> <br> //  . . RGB-  <br> float fDiffColorMaxComponent = max( abs(diffColor.x), max( abs(diffColor.y), abs(diffColor.z) ) ); <br> <br> //    <br> float fDiffColorMaxComponentScaled = saturate( fDiffColorMaxComponent * sharpenLumScale + sharpenLumBias ); <br> <br> //     . <br> //   "1.0" -      fSharpenIntensity  1.0. <br> float fPixelSharpenAmount = lerp(1.0, fSharpenAmount, fDiffColorMaxComponentScaled); <br> <br> //   ""     . <br> float lumaCenter = dot( LUMINANCE_RGB, finalColor ); <br> float lumaCornersAverage = dot( LUMINANCE_RGB, averageColorCorners ); <br> <br> //  "centerColor"    <br> float3 fColorBalanced = colorCenter / max( lumaCenter, 1e-4 ); <br> <br> //    <br> float fPixelLuminance = lerp(lumaCornersAverage, lumaCenter, fPixelSharpenAmount); <br> <br> //     <br> finalColor = fColorBalanced * max(fPixelLuminance, 0.0); <br> } <br> <br> return float4(finalColor, 1.0);</code> <br> <br>  рдЕрдзрд┐рдХрддрдо рдХреА рдЧрдгрдирд╛ рдХрд░рдХреЗ рдПрдЬ рдХреА рдкрд╣рдЪрд╛рди рдХреА рдЬрд╛рддреА рд╣реИред  рдкреЗрдЯред  рдЕрдВрддрд░ рдШрдЯрдХред  рд╕реНрдорд╛рд░реНрдЯ рдЪрд╛рд▓!  рдЗрд╕рдХрд╛ рджреГрд╢реНрдп рджреЗрдЦреЗрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa9/a26/44a/aa9a2644a16b1b79c6213f7d4effe068.jpg"></div><br>  <i>рдЕрдВрддрд░ рдХреЗ рдЕрдзрд┐рдХрддрдо рдирд┐рд░рдкреЗрдХреНрд╖ рдШрдЯрдХ рдХрд╛ рджреГрд╢реНрдпред</i> <br><br>  рдмрд╣реБрдд рдмрдврд╝рд┐рдпрд╛ред  рддреИрдпрд╛рд░ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рд╢реЗрдбрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдЙрдкрд▓рдмреНрдз <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред  рдмрд╣реБрдд рдЧрд░реАрдм рд╕реНрд╡рд░реВрдкрдг рдХреЗ рд▓рд┐рдП рдХреНрд╖рдорд╛ рдХрд░реЗрдВред  рдЖрдк рдореЗрд░реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">HLSLexplorer</a> рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреЛрдб рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдореИрдВ рдЦреБрд╢реА рд╕реЗ рдХрд╣ рд╕рдХрддрд╛ рд╣реВрдВ рдХрд┐ рдКрдкрд░ рджрд┐рдП рдЧрдП рдХреЛрдб рдЧреЗрдо рдореЗрдВ рд╕рдорд╛рди рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдмрдирд╛рддрд╛ рд╣реИ! <br><br>  рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ: The Witcher 3 sharpness shader рдмрд╣реБрдд рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ (рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ fPixelSharpenAmount 1.0 рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ! рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ ...)ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреНрд░рднрд╛рд╡ рдХреА рдЪрдордХ рдХреЛ рдмрджрд▓рдиреЗ рдХрд╛ рдореБрдЦреНрдп рддрд░реАрдХрд╛ рдирд┐рдХрдЯ / рджреВрд░ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХреА рдЪрдордХ рд╣реИред  рдЗрд╕ рдЦреЗрд▓ рдореЗрдВ, рд╡реЗ рдирд┐рд░рдВрддрд░ рдирд╣реАрдВ рд╣реИрдВ;  рдореИрдВрдиреЗ рдореВрд▓реНрдпреЛрдВ рдХреЗ рдХрдИ рдЙрджрд╛рд╣рд░рдг рд╕рдВрдХрд▓рд┐рдд рдХрд┐рдП рд╣реИрдВ: <br><br>  рд╕реНрдХреЗрд▓рд┐рдЧ: <br><br><table><tbody><tr><th></th><th>  sharpenNear </th><th>  sharpenFar </th><th>  sharpenDistanceScale </th><th>  sharpenDistanceBias </th><th>  sharpenLumScale </th><th>  sharpenLumBias </th></tr><tr><td>  <b>рдХрдо</b> </td></tr></tbody><tbody><tr><td>  <b>рдЙрдЪреНрдЪ</b> </td><td>  2.0 </td><td>  1.8 </td><td>  0.025 <br></td><td>  -0.25 <br></td><td>  -резрей.рейрей,рейрейрей <br></td><td>  1.33333 </td></tr></tbody></table><br>  рдХрд╛рдпрд░ рдореЛрд░реЗрди: <br><br><table><tbody><tr><th></th><th>  sharpenNear <br></th><th>  sharpenFar <br></th><th>  sharpenDistanceScale <br></th><th>  sharpenDistanceBias <br></th><th>  sharpenLumScale <br></th><th>  sharpenLumBias <br></th></tr><tr><td>  рдХрдо <br></td><td>  .релрен,ренрелрез <br></td><td>  .рейрез,рейрежрей <br></td><td>  .режрем,ремремрел <br></td><td>  -.рейрей,реирелрем <br></td><td>  -1.0 <br></td><td>  2.0 <br></td></tr><tr><td>  рдЙрдЪреНрдЪ <br></td><td>  реи.резрен,ренрелрез <br></td><td>  рез.репрез,рейрежрей <br></td><td>  .режрем,ремремрел <br></td><td>  -.рейрей,реирелрем <br></td><td>  -1.0 <br></td><td>  2.0 </td></tr></tbody></table><br><h2>  рднрд╛рдЧ 7. рдФрд╕рдд рдЪрдордХ </h2><br>  рд╡рд░реНрддрдорд╛рди рдлреНрд░реЗрдо рдХреА рдФрд╕рдд рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рд▓рдЧрднрдЧ рдХрд┐рд╕реА рднреА рдЖрдзреБрдирд┐рдХ рд╡реАрдбрд┐рдпреЛ рдЧреЗрдо рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдпрд╣ рдорд╛рди рдЕрдХреНрд╕рд░ рдмрд╛рдж рдореЗрдВ рдЖрдВрдЦ рдЕрдиреБрдХреВрд▓рди рдФрд░ рддрд╛рдирд╡рд╛рд▓рд╛ рд╕реБрдзрд╛рд░ рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдкреЛрд╕реНрдЯ рдХреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд┐рдЫрд▓реЗ рднрд╛рдЧ</a> рдореЗрдВ рджреЗрдЦреЗрдВ)ред  рд╕рд░рд▓ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдореЗрдВ, рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ, рдмрдирд╛рд╡рдЯ, 512 <sup>2 рдХреЗ</sup> рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдлрд┐рд░ рдЗрд╕рдХреЗ рдПрдордЖрдЗрдкреА рд╕реНрддрд░ рдХреА рдЧрдгрдирд╛ рдФрд░ рдмрд╛рдж рдХреЗ рдЖрд╡реЗрджрдиред  рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рдВрднрд╛рд╡рдирд╛рдУрдВ рдХреЛ рдмрд╣реБрдд рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред  рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╕рдорд╛рдзрд╛рди рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ рд╢реЗрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдорд╛рдирд╛рдВрддрд░ рдХрдореА рдХрд░рддреЗ рд╣реИрдВ</a> ред <br><br>  рдЖрдЗрдП рдкрддрд╛ рдХрд░реЗрдВ рдХрд┐ рдХреИрд╕реЗ рд╕реАрдбреА рдкреНрд░реЗрдЬреЗрдХ рд░реЗрдб рдЯреАрдо рдиреЗ рдж рд╡рд┐рдЪрд░ 3 рдореЗрдВ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд┐рдпрд╛ред  рдкрд┐рдЫрд▓реЗ рднрд╛рдЧ рдореЗрдВ, рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЖрдВрдЦ рдХреЗ рддрд╛рдирд╡рд╛рд▓рд╛ рд╕реБрдзрд╛рд░ рдФрд░ рдЕрдиреБрдХреВрд▓рди рдХреА рдЬрд╛рдВрдЪ рдХреА, рдЗрд╕рд▓рд┐рдП рдкрд╣реЗрд▓реА рдХрд╛ рдПрдХрдорд╛рддреНрд░ рд╢реЗрд╖ рдЯреБрдХрдбрд╝рд╛ рдФрд╕рдд рдЪрдордХ рдерд╛ред <br><br>  рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдж рд╡рд┐рдЪрд░ 3 рдХреА рдФрд╕рдд рдЪрдордХ рдЧрдгрдирд╛ рдореЗрдВ рджреЛ рдкрд╛рд╕ рд╣реЛрддреЗ рд╣реИрдВред  рд╕реНрдкрд╖реНрдЯрддрд╛ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдЙрдиреНрд╣реЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рддреЛрдбрд╝рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛, рдФрд░ рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рд╣рдо рдкрд╣рд▓реА рдкрд╛рд╕ - "рдЪрдордХ рд╡рд┐рддрд░рдг" (рдЪрдордХ рдХреЗ рд╣рд┐рд╕реНрдЯреЛрдЧреНрд░рд╛рдо рдХреА рдЧрдгрдирд╛) рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред <br><br><h3>  рдЪрдордХ рд╡рд┐рддрд░рдг </h3><br>  рдпреЗ рджреЛрдиреЛрдВ рдкрд╛рд╕ рдХрд┐рд╕реА рднреА рдлреНрд░реЗрдо рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рдореЗрдВ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рдЖрд╕рд╛рди рд╣реИрдВред  рдЖрдВрдЦреЛрдВ рдХрд╛ рдЕрдиреБрдХреВрд▓рди рдХрд░рдиреЗ рд╕реЗ рдареАрдХ рдкрд╣рд▓реЗ рдпреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбрд┐рд╕реНрдкреИрдЪ</a> рдХреЙрд▓ рд╣реИрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7de/5fb/09c/7de5fb09ce00453f14262f9e2b1bae30.png"></div><br>  рдЖрдЗрдП рдЗрд╕ рдкрд╛рд╕ рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ рджреЗрдЦреЗрдВред  рдЙрд╕реЗ рджреЛ рдмрдирд╛рд╡рдЯ рдЪрд╛рд╣рд┐рдП: <br><br>  1) рдПрдЪрдбреАрдЖрд░ рдХрд▓рд░ рдмрдлрд░, рдЬрд┐рд╕рдХрд╛ рд╕реНрдХреЗрд▓ 1/4 x 1/4 рддрдХ рдХрдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, 1920x1080 рд╕реЗ 480x27070), <br><br>  2) рдлреБрд▓рд╕реНрдХреНрд░реАрди рдбреЗрдкреНрде рдмрдлрд░ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/021/38b/795/02138b795946d192f553eadc20d34366.png"></div><br>  <i>1/4 x 1/4 HDR рд░рдВрдЧ рдмрдлрд░ред</i>  <i>рдЯреНрд░рд┐рдХреА рдЯреНрд░рд┐рдХ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВ - рдпрд╣ рдмрдлрд░ рдПрдХ рдмрдбрд╝реЗ рдмрдлрд░ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред</i>  <i>рдмрдлрд░реНрд╕ тАЛтАЛрдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрдЪреНрдЫрд╛ рдЕрднреНрдпрд╛рд╕ рд╣реИред</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0e3/62d/c97/0e362dc97908f75db564cff0f46b1e7e.png"></div><br>  <i>рдлреБрд▓рд╕реНрдХреНрд░реАрди рдбреЗрдкреНрде рдмрдлрд░</i> <br><br>  рдХрд▓рд░ рдмрдлрд░ рдХреЛ рдЬрд╝реВрдо рдЖрдЙрдЯ рдХреНрдпреЛрдВ рдХрд░реЗрдВ?  рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИред <br><br>  рдЗрд╕ рдкрд╛рд╕ рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдПрдХ рд╕рдВрд░рдЪрд┐рдд рдмрдлрд░ рд╣реИред  4 рдмрд╛рдЗрдЯреНрд╕ рдХреЗ 256 рддрддреНрд╡ рдкреНрд░рддреНрдпреЗрдХред <br><br>  рд╢реЗрдбрд░реНрд╕ рдХреЗ рдкрд╛рд╕ рдпрд╣рд╛рдВ рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдорд╛рди рд▓реЗрдВ рдХрд┐ рдпрд╣ рдЕрд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдЕрдВрддрд░ рдореВрд▓реНрдпреЛрдВ рдХрд╛ рдПрдХ рдмрдлрд░ рд╣реИред <br><br>  рдорд╣рддреНрд╡рдкреВрд░реНрдг: рдФрд╕рдд рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдореЗрдВ рдкрд╣рд▓рд╛ рдХрджрдо рд╕рдВрд░рдЪрд┐рдд рдмрдлрд░ рдХреЗ рд╕рднреА рддрддреНрд╡реЛрдВ рдХреЛ рд╢реВрдиреНрдп рдкрд░ рд░реАрд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">ClearUnorderedAccessViewUint</a> рдХреЛ рдХреЙрд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд░рддрд╛</a> рд╣реИред <br><br>  рдЖрдЗрдП рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ shader рдХреЗ рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░реЗрдВ (рдпрд╣ рд╣рдорд╛рд░реЗ рд╕рдВрдкреВрд░реНрдг рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдореЗрдВ рдкрд╣рд▓рд╛ рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ shader рд╣реИ!) <br><br> <code>cs_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb0[3], immediateIndexed <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_resource_texture2d (float,float,float,float) t1 <br> dcl_uav_structured u0, 4 <br> dcl_input vThreadGroupID.x <br> dcl_input vThreadIDInGroup.x <br> dcl_temps 6 <br> dcl_tgsm_structured g0, 4, 256 <br> dcl_thread_group 64, 1, 1 <br> 0: store_structured g0.x, vThreadIDInGroup.x, l(0), l(0) <br> 1: iadd r0.xyz, vThreadIDInGroup.xxxx, l(64, 128, 192, 0) <br> 2: store_structured g0.x, r0.x, l(0), l(0) <br> 3: store_structured g0.x, r0.y, l(0), l(0) <br> 4: store_structured g0.x, r0.z, l(0), l(0) <br> 5: sync_g_t <br> 6: ftoi r1.x, cb0[2].z <br> 7: mov r2.y, vThreadGroupID.x <br> 8: mov r2.zw, l(0, 0, 0, 0) <br> 9: mov r3.zw, l(0, 0, 0, 0) <br> 10: mov r4.yw, l(0, 0, 0, 0) <br> 11: mov r1.y, l(0) <br> 12: loop <br> 13: utof r1.z, r1.y <br> 14: ge r1.z, r1.z, cb0[0].x <br> 15: breakc_nz r1.z <br> 16: iadd r2.x, r1.y, vThreadIDInGroup.x <br> 17: utof r1.z, r2.x <br> 18: lt r1.z, r1.z, cb0[0].x <br> 19: if_nz r1.z <br> 20: ld_indexable(texture2d)(float,float,float,float) r5.xyz, r2.xyzw, t0.xyzw <br> 21: dp3 r1.z, r5.xyzx, l(0.212600, 0.715200, 0.072200, 0.000000) <br> 22: imul null, r3.xy, r1.xxxx, r2.xyxx <br> 23: ld_indexable(texture2d)(float,float,float,float) r1.w, r3.xyzw, t1.yzwx <br> 24: eq r1.w, r1.w, cb0[2].w <br> 25: and r1.w, r1.w, cb0[2].y <br> 26: add r2.x, -r1.z, cb0[2].x <br> 27: mad r1.z, r1.w, r2.x, r1.z <br> 28: add r1.z, r1.z, l(1.000000) <br> 29: log r1.z, r1.z <br> 30: mul r1.z, r1.z, l(88.722839) <br> 31: ftou r1.z, r1.z <br> 32: umin r4.x, r1.z, l(255) <br> 33: atomic_iadd g0, r4.xyxx, l(1) <br> 34: endif <br> 35: iadd r1.y, r1.y, l(64) <br> 36: endloop <br> 37: sync_g_t <br> 38: ld_structured r1.x, vThreadIDInGroup.x, l(0), g0.xxxx <br> 39: mov r4.z, vThreadIDInGroup.x <br> 40: atomic_iadd u0, r4.zwzz, r1.x <br> 41: ld_structured r1.x, r0.x, l(0), g0.xxxx <br> 42: mov r0.w, l(0) <br> 43: atomic_iadd u0, r0.xwxx, r1.x <br> 44: ld_structured r0.x, r0.y, l(0), g0.xxxx <br> 45: atomic_iadd u0, r0.ywyy, r0.x <br> 46: ld_structured r0.x, r0.z, l(0), g0.xxxx <br> 47: atomic_iadd u0, r0.zwzz, r0.x <br> 48: ret</code> <br> <br>  рдФрд░ рдПрдХ рдирд┐рд░рдВрддрд░ рдмрдлрд░: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c14/805/dc6/c14805dc6b7ffd431d9307cc46dcba0d.png"></div><br>  рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдкрд╣рд▓рд╛ рдЗрдирдкреБрдЯ рдПрдЪрдбреАрдЖрд░ рдХрд▓рд░ рдмрдлрд░ рд╣реИред  рдлреБрд▓рдПрдЪрдбреА рдХреЗ рд╕рд╛рде, рдЗрд╕рдХрд╛ рд░рд┐рдЬрд╝реЙрд▓реНрдпреВрд╢рди 480x270 рд╣реИред  рдЖрдЗрдП рдбрд┐рд╕реНрдкреИрдЪ рдХреЙрд▓ рдХреЛ рджреЗрдЦреЗрдВред <br><br>  рдбрд┐рд╕реНрдкреИрдЪ (270, 1, 1) - рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо 270 рдереНрд░реЗрдб рд╕рдореВрд╣ рдЪрд▓рд╛рддреЗ рд╣реИрдВред  рд╕реАрдзреЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ рдХрд╣реЗрдВ, рд╣рдо рд░рдВрдЧ рдмрдлрд░ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдкрдВрдХреНрддрд┐ рдХреЗ рдзрд╛рдЧреЗ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рдЪрд▓рд╛рддреЗ рд╣реИрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e9a/a97/7e3/e9aa977e3f9a60104fe9a66d797a27cc.png"></div><br>  <i>рдкреНрд░рддреНрдпреЗрдХ рдереНрд░реЗрдб рд╕рдореВрд╣ HDR рд░рдВрдЧ рдмрдлрд╝рд░ рдХреА рдПрдХ рдкрдВрдХреНрддрд┐ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ</i> <br><br>  рдЕрдм рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдпрд╣ рд╕рдВрджрд░реНрдн рд╣реИ, рддреЛ рдЖрдЗрдП рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдХрд┐ рд╢реЗрдбрд░ рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИред <br><br>  рдкреНрд░рддреНрдпреЗрдХ рдереНрд░реЗрдб рд╕рдореВрд╣ рдореЗрдВ X рджрд┐рд╢рд╛ рдореЗрдВ 64 рдереНрд░реЗрдбреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ (dcl_thread_group 64, 1, 1), рд╕рд╛рде рд╣реА рд╕рд╛рде рд╕рд╛рдЭрд╛ рдХреА рдЧрдИ рдореЗрдореЛрд░реА, 4 рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде 256 рддрддреНрд╡ (dcl_tgsm_structured g0, 4, 256)ред <br><br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ shader рдореЗрдВ рд╣рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">SV_GroupThreadID</a> (vThreadIDInGroup.x) [0-63] рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">SV_GroupID</a> (vThreadGroupID.x) [0-269] рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br><br>  1) рд╣рдо рд╕рд╛рдЭрд╛ рд╕реНрдореГрддрд┐ рд╢реВрдиреНрдп рдорд╛рди рдХреЗ рд╕рднреА рддрддреНрд╡реЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдЪреВрдВрдХрд┐ рдХреБрд▓ рдореЗрдореЛрд░реА рдореЗрдВ рдкреНрд░рддрд┐ рддрддреНрд╡ 256 рддрддреНрд╡ рдФрд░ 64 рдереНрд░реЗрдбреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЖрд╕рд╛рдиреА рд╕реЗ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд▓реВрдк рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <br><br> <code>//   -      . <br> //        64 ,          4 . <br> [unroll] for (uint idx=0; idx &lt; 4; idx++) <br> { <br> const uint offset = threadID + idx*64; <br> shared_data[ offset ] = 0; <br> }</code> <br> <br>  2) рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдордиреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GroupMemoryBarrierWithGroupSync</a> (Sync_g_t) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рдзрд╛ рдХреЛ рд╕реЗрдЯ рдХрд┐рдпрд╛ред  рд╣рдо рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╕рдореВрд╣реЛрдВ рдХреА рд╕рд╛рдЭрд╛ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рднреА рдереНрд░реЗрдбреНрд╕ рдЕрдЧрд▓реЗ рдЪрд░рдг рдкрд░ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╢реВрдиреНрдп рдкрд░ рд░реАрд╕реЗрдЯ рд╣реЛ рдЬрд╛рдПрдВред <br><br>  3) рдЕрдм рд╣рдо рдПрдХ рд▓реВрдк рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЬреЛ рдореЛрдЯреЗ рддреМрд░ рдкрд░ рдЗрд╕ рддрд░рд╣ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <br><br> <code>// cb0_v0.x -      .  1920x1080   1920/4 = 480; <br> float ViewportSizeX = cb0_v0.x; <br> [loop] for ( uint PositionX = 0; PositionX &lt; ViewportSizeX; PositionX += 64 ) <br> { <br> ...</code> <br> <br>  рдпрд╣ 64 рдХреЗ рд╡реЗрддрди рд╡реГрджреНрдзрд┐ рдХреЗ рд╕рд╛рде рд▓реВрдк рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рд╣реИ (рдХреНрдпрд╛ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рдордЭрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпреЛрдВ?)ред <br><br>  рдЕрдЧрд▓рд╛ рдХрджрдо рд▓реЛрдб рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рд╣реИред <br><br>  рдЪрд▓рд┐рдП рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрддреЗ рд╣реИрдВред <br><br>  Y рд╕рдордиреНрд╡рдп рдХреЗ рд▓рд┐рдП, рд╣рдо SV_GroupID.x рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╣рдордиреЗ 270 рдереНрд░реЗрдб рд╕рдореВрд╣ рд▓реЙрдиреНрдЪ рдХрд┐рдП рд╣реИрдВред <br><br>  рдПрдХреНрд╕ рдХреЗ рд╕рдордиреНрд╡рдп рдХреЗ рд▓рд┐рдП, рд╣рдо ... рд╡рд░реНрддрдорд╛рди рд╕рдореВрд╣ рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рд▓рд╛рдн рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВ!  рдЪрд▓реЛ рдЗрд╕реЗ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВред <br><br>  рдЪреВрдВрдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рд╕рдореВрд╣ рдореЗрдВ 64 рдзрд╛рдЧреЗ рд╣реИрдВ, рдРрд╕реЗ рд╕рдорд╛рдзрд╛рди рд╕рднреА рдкрд┐рдХреНрд╕реЗрд▓ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░реЗрдВрдЧреЗред <br><br>  рдзрд╛рдЧрд╛ рд╕рдореВрд╣ (0, 0, 0) рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред <br><br>  - рдзрд╛рд░рд╛ (0, 0, 0) рдкрд┐рдХреНрд╕рд▓ (0, 0), (64, 0), (128, 0), (192, 0), (256, 0), (320, 0), (384) рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░реЗрдЧреАред 0), (448,0)ред <br><br>  - рдереНрд░реЗрдб (1, 0, 0) рдкрд┐рдХреНрд╕рд▓ (1, 0), (65, 0), (129, 0), (193, 0), (257, 0), (321, 0), (385,) рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░реЗрдЧрд╛ред 0), (449, 0) ... <br><br>  - рдзрд╛рд░рд╛ (63, 0, 0) рдкрд┐рдХреНрд╕рд▓ (63, 0), (127, 0), (191, 0), (255, 0), (319, 0), (383, 0), (447) рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░реЗрдЧреАред 0) <br><br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╕рднреА рдкрд┐рдХреНрд╕реЗрд▓ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред <br><br>  рд╣рдореЗрдВ рдпрд╣ рднреА рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рд░рдВрдЧ рдмрдлрд░ рдХреЗ рдмрд╛рд╣рд░ рд╕реЗ рдкрд┐рдХреНрд╕реЗрд▓ рд▓реЛрдб рди рдХрд░реЗрдВ: <br><br> <code>//      X.  Y  GroupID. <br> uint CurrentPixelPositionX = PositionX + threadID; <br> uint CurrentPixelPositionY = groupID; <br> if ( CurrentPixelPositionX &lt; ViewportSizeX ) <br> { <br> // HDR- . <br> //   HDR-    ,     . <br> uint2 colorPos = uint2(CurrentPixelPositionX, CurrentPixelPositionY); <br> float3 color = texture0.Load( int3(colorPos, 0) ).rgb; <br> float luma = dot(color, LUMA_RGB);</code> <br> <br>  рдЖрдк рджреЗрдЦрддреЗ рд╣реИрдВ?  рдпрд╣ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИ! <br><br>  рдореИрдВрдиреЗ рдЪрдордХ (рдЕрд╕реЗрдВрдмрд▓рд░ рдХреЛрдб рдХреА рд▓рд╛рдЗрди 21) рдХреА рднреА рдЧрдгрдирд╛ рдХреАред <br><br>  рдорд╣рд╛рди, рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рд░рдВрдЧ рдкрд┐рдХреНрд╕реЗрд▓ рд╕реЗ рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдХреА рд╣реИред  рдЕрдЧрд▓рд╛ рдХрджрдо рд▓реЛрдб рдХрд░рдирд╛ рд╣реИ (рдирдореВрдирд╛ рдирд╣реАрдВ!) рд╕рдВрдмрдВрдзрд┐рдд рдЧрд╣рд░рд╛рдИ рдореВрд▓реНрдпред <br><br>  рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рд╣рдореЗрдВ рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдордиреЗ рдкреВрд░реНрдг рд╕рдВрдХрд▓реНрдк рдХреА рдЧрд╣рд░рд╛рдИ рдХреЗ рдмрдлрд░ рдХреЛ рдЬреЛрдбрд╝рд╛ред  рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ? <br><br>  рдпрд╣ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд░реВрдк рд╕реЗ рд╕рд░рд▓ рд╣реИ - рдмрд╕ рдХреБрдЫ рд╕реНрдерд┐рд░ (cb0_v2.z) рджреНрд╡рд╛рд░рд╛ рд░рдВрдЧ рдЬрдорд╛ рдХрд░реЗрдВред  рд╣рдордиреЗ рдЪрд╛рд░ рдмрд╛рд░ рдПрдЪрдбреАрдЖрд░ рдХрд▓рд░ рдмрдлрд░ рдбрд╛рдЙрди рдХрд┐рдпрд╛ред  рдЗрд╕рд▓рд┐рдП рдореВрд▓реНрдп 4 рд╣реИ! <br><br> <code>const int iDepthTextureScale = (int) cb0_v2.z; <br> uint2 depthPos = iDepthTextureScale * colorPos; <br> float depth = texture1.Load( int3(depthPos, 0) ).x;</code> <br> <br>  рдЕрдм рддрдХ рддреЛ рдЕрдЪреНрдЫрд╛ рд╣реИ!  рд▓реЗрдХрд┐рди ... рд╣рдо 24-25 рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдорд┐рд▓рд╛ ... <br><br> <code>24: eq r2.x, r2.x, cb0[2].w <br> 25: and r2.x, r2.x, cb0[2].y</code> <br> <br>  So.  рдкрд╣рд▓реЗ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдлреНрд▓реЛрдЯрд┐рдВрдЧ рдкреЙрдЗрдВрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдорд╛рдирддрд╛ рдХреА рддреБрд▓рдирд╛ рд╣реИ</a> , рдЗрд╕рдХрд╛ рдкрд░рд┐рдгрд╛рдо r2.x рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рдареАрдХ рдмрд╛рдж рдЬрд╛рддрд╛ рд╣реИ ... рдХреНрдпрд╛?  рдмрд┐рдЯрд╡рд╛рдЗрдЬрд╝ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдВрдб</a> ??  рдЧрдВрднреАрд░рддрд╛ рд╕реЗ?  рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдмрд┐рдВрджреБ рдорд╛рди рдХреЗ рд▓рд┐рдП?  рдпреЗ рдХреНрдпрд╛ ??? <br><br>  <b>'Eq + рдФрд░' рд╕рдорд╕реНрдпрд╛</b> <br><br>  рдореБрдЭреЗ рд╕рд┐рд░реНрдл рдЗрддрдирд╛ рдХрд╣рдирд╛ рд╣реИ рдХрд┐ рдореЗрд░реЗ рд▓рд┐рдП рдпрд╣ рд╕рдмрд╕реЗ рдХрдард┐рди рд╣рд┐рд╕реНрд╕рд╛ рдерд╛ред  рдореИрдВ рднреА рдЕрдЬреАрдм asint / asfloat рд╕рдВрдпреЛрдЬрди рдХреА рдХреЛрд╢рд┐рд╢ рдХреА ... <br><br>  рдФрд░ рдЕрдЧрд░ рдЖрдк рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ?  рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рдлреНрд▓реЛрдЯ-рдлреНрд▓реЛрдЯ рдХреА рддреБрд▓рдирд╛ рдХрд░рддреЗ рд╣реИрдВред <br><br> <code>float DummyPS() : SV_Target0 <br> { <br> float test = (cb0_v0.x == cb0_v0.y); <br> return test; <br> }</code> <br> <br>  рдФрд░ рдпрд╣рд╛рдБ рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдореЗрдВ рдЖрдЙрдЯрдкреБрдЯ рд╣реИ: <br><br> <code>0: eq r0.x, cb0[0].y, cb0[0].x <br> 1: and o0.x, r0.x, l(0x3f800000) <br> 2: ret</code> <br> <br>  рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ, рд╣реИ рдирд╛?  рдореБрдЭреЗ рдпрд╣рд╛рдВ "рдФрд░" рджреЗрдЦрдиреЗ рдХреА рдЙрдореНрдореАрдж рдирд╣реАрдВ рдереАред <br><br>  0x3f800000 рд╕рд┐рд░реНрдл 1.0f рд╣реИ ... рдпрд╣ рддрд╛рд░реНрдХрд┐рдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо 1.0 рдФрд░ 0.0 рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдЕрдиреНрдпрдерд╛ рдпрджрд┐ рддреБрд▓рдирд╛ рд╕рдлрд▓ рд╣реЛрддреА рд╣реИред <br><br>  рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рд╣рдо 1.0 рдХреЛ рдХреБрдЫ рдЕрдиреНрдп рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде "рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд" рдХрд░реЗрдВ?  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣: <br><br> <code>float DummyPS() : SV_Target0 <br> { <br> float test = (cb0_v0.x == cb0_v0.y) ? cb0_v0.z : 0.0; <br> return test; <br> }</code> <br> <br>  рд╣рдореЗрдВ рдирд┐рдореНрди рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓рддреЗ рд╣реИрдВ: <br><br> <code>0: eq r0.x, cb0[0].y, cb0[0].x <br> 1: and o0.x, r0.x, cb0[0].z <br> 2: ret</code> <br> <br>  рд╣рд╛!  рдЗрд╕рдиреЗ рдХрд╛рдо рдХрд┐рдпрд╛ред  рдпрд╣ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдХрдВрдкрд╛рдЗрд▓рд░ рдХрд╛ рдЬрд╛рджреВ рдорд╛рддреНрд░ рд╣реИред  рдиреЛрдЯ: рдпрджрд┐ рдЖрдк 0.0 рдХреЛ рдХрд┐рд╕реА рдФрд░ рдЪреАрдЬрд╝ рд╕реЗ рдмрджрд▓рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдмрд╕ movc рдорд┐рд▓ рдЬрд╛рдПрдЧрд╛ред <br><br>  рдЖрдЗрдП рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ рд╢реЗрдбрд░ рдкрд░ рд╡рд╛рдкрд╕ рдЬрд╛рдПрдВред  рдЕрдЧрд▓рд╛ рдХрджрдо рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдирд╛ рд╣реИ рдХрд┐ рдЧрд╣рд░рд╛рдИ cb0_v2.w рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред  рдпрд╣ рд╣рдореЗрд╢рд╛ 0.0 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрддрд╛ рд╣реИ - рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рд╣рдо рдЬрд╛рдВрдЪрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдкрд┐рдХреНрд╕реЗрд▓ рдПрдХ рджреВрд░ рдХреЗ рд╡рд┐рдорд╛рди (рдЖрдХрд╛рд╢ рдореЗрдВ) рдкрд░ рд╣реИред  рдпрджрд┐ рдРрд╕рд╛ рд╣реИ, рддреЛ рд╣рдо рдЗрд╕ рдЧреБрдгрд╛рдВрдХ рдХреЛ рдХреБрдЫ рдорд╛рди рджреЗрддреЗ рд╣реИрдВ, рд▓рдЧрднрдЧ 0.5 (рдореИрдВрдиреЗ рдХрдИ рдлрд╝реНрд░реЗрдореЛрдВ рдкрд░ рдЬрд╛рдВрдЪ рдХреА)ред <br><br>  рдЗрд╕ рдЧрдгрдирд╛ рдЧреБрдгрд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рд░рдВрдЧ рдХреА рдЪрдордХ рдФрд░ "рдЖрдХрд╛рд╢" рдХреА рдЪрдордХ (cb0_v2.x рдорд╛рди, рдЬреЛ рдкреНрд░рд╛рдпрдГ 0.0 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрддрд╛ рд╣реИ) рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдореИрдВ рдорд╛рдирддрд╛ рд╣реВрдВ рдХрд┐ рдФрд╕рдд рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдореЗрдВ рдЖрдХрд╛рд╢ рдХреЗ рдорд╣рддреНрд╡ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред  рдЖрдорддреМрд░ рдкрд░ рдорд╣рддреНрд╡ рдХрдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред  рдмрд╣реБрдд рдЪрддреБрд░ рд╡рд┐рдЪрд╛рд░ред <br><br> <code>// ,       ( ).  ,    ,    <br> //    . <br> float value = (depth == cb0_v2.w) ? cb0_v2.y : 0.0; <br> <br> //  'value'  0.0,   lerp    'luma'.   'value'  <br> // (  0.50),   luma    . (cb0_v2.x    0.0). <br> float lumaOk = lerp( luma, cb0_v2.x, value );</code> <br> <br>  рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ lumaOk рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдЧрд▓рд╛ рдХрджрдо рдПрдХ рдЕрдЪреНрдЫрд╛ рд╡рд┐рддрд░рдг рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд▓рдШреБрдЧрдгрдХ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рд╣реИред  рд▓реЗрдХрд┐рди рд░реБрдХрд┐рдП, рд╣рдо рдмрддрд╛рддреЗ рд╣реИрдВ рдХрд┐ lumaOk 0.0 рд╣реИред  рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд▓реЙрдЧ (0) рдХрд╛ рдорд╛рди рдЕрдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо 1.0 рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд▓реЙрдЧ (1) = 0.0 рд╣реИред <br><br>  рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдо 256 рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЗрд╕реЗ рд╡рд┐рддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧрдгрдирд╛ рдХрд┐рдП рдЧрдП рд▓рдШреБрдЧрдгрдХ рдХреЛ 128 рддрдХ рдорд╛рдкрддреЗ рд╣реИрдВред  рдмрд╣реБрдд рд╣реЛрд╢рд┐рдпрд╛рд░! <br><br>  рдФрд░ рдпрд╣ рдпрд╣рд╛рдБ рд╕реЗ рд╣реИ рдХрд┐ рдпрд╣ рдорд╛рди 88.722839 рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рдПрдХ <code>128 *   (2)</code> ред <br><br>  рдпрд╣ рдЙрд╕реА рддрд░рд╣ рд╣реИ рдЬреИрд╕реЗ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рд▓реЙрдЧрд░рд┐рдердо рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИред <br><br>  HLSL рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рд╣реА рдХрд╛рд░реНрдп рд╣реИ рдЬреЛ рд▓рдШреБрдЧрдгрдХ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЙрдЧ</a> , рдФрд░ рдЗрд╕рдХрд╛ рдЖрдзрд╛рд░ 2 рд╣реИред <br><br> <code>// ,  lumaOk  0.0. <br> // log(0)   undefined <br> // log(1) = 0. <br> //     <br> lumaOk = log(lumaOk + 1.0); <br> <br> //     128 <br> lumaOk *= 128;</code> <br> <br>  рдЕрдВрдд рдореЗрдВ, рд╣рдо рд▓рдШреБрдЧрдгрдХреАрдп рд░реВрдк рд╕реЗ рд╡рд┐рддрд░рд┐рдд рдЪрдордХ рд╕реЗ рд╕реЗрд▓ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╕рд╛рдЭрд╛ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рд╕реЗрд▓ рдореЗрдВ 1 рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред <br><br> <code>//   .    Uint,    256 , <br> //  ,      . <br> uint uLuma = (uint) lumaOk; <br> uLuma = min(uLuma, 255); <br> <br> //  1    . <br> InterlockedAdd( shared_data[uLuma], 1 );</code> <br> <br>  рдЕрдЧрд▓рд╛ рдЪрд░рдг рдлрд┐рд░ рд╕реЗ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд╡рд░реЛрдз рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдЧрд╛ рдХрд┐ рдкрдВрдХреНрддрд┐ рдореЗрдВ рд╕рднреА рдкрд┐рдХреНрд╕реЗрд▓ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВред <br><br>  рдФрд░ рдЕрдВрддрд┐рдо рдЪрд░рдг рд╕рд╛рдЭрд╛ рдореЗрдореЛрд░реА рд╕реЗ рд╕рдВрд░рдЪрд┐рдд рдмрдлрд░ рдореЗрдВ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╣реИред  рдпрд╣ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд▓реВрдк рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрд╕реА рддрд░рд╣ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: <br><br> <code>// ,       <br> GroupMemoryBarrierWithGroupSync(); <br> <br> //      . <br> [unroll] for (uint idx = 0; idx &lt; 4; idx++) <br> { <br> const uint offset = threadID + idx*64; <br> <br> uint data = shared_data[offset]; <br> InterlockedAdd( g_buffer[offset], data ); <br> }</code> <br> <br>  рд╕рд╛рдорд╛рдиреНрдп рдбреЗрдЯрд╛ рдореЗрдВ рдереНрд░реЗрдб рд╕рдореВрд╣ рдореЗрдВ рд╕рднреА 64 рдереНрд░реЗрдбреНрд╕ рднрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдкреНрд░рддреНрдпреЗрдХ рдереНрд░реЗрдб рдЖрдЙрдЯрдкреБрдЯ рдорд╛рди рдореЗрдВ 4 рдорд╛рди рдЬреЛрдбрд╝рддрд╛ рд╣реИред <br><br>  рдЖрдЙрдЯрдкреБрдЯ рдмрдлрд░ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред  рдЪрд▓рд┐рдП рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрддреЗ рд╣реИрдВред  рдмрдлрд╝рд░ рдореЗрдВ рд╕рднреА рдорд╛рдиреЛрдВ рдХрд╛ рдпреЛрдЧ рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рдХреБрд▓ рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ!  (480x270 = 129,600 рдкрд░)ред  рдпрд╣реА рд╣реИ, рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдХрд┐рддрдиреЗ рдкрд┐рдХреНрд╕реЗрд▓ рдореЗрдВ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЪрдордХ рдореВрд▓реНрдп рд╣реИред <br><br>  рдпрджрд┐ рдЖрдк рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ рд╢реЗрдбреНрд╕ (рдореЗрд░реЗ рдЬреИрд╕реЗ) рдореЗрдВ рдЦрд░рд╛рдм рд░реВрдк рд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реИрдВ, рддреЛ рдкрд╣рд▓реЗ рддреЛ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкреЛрд╕реНрдЯ рдХреЛ рдХреБрдЫ рдФрд░ рдмрд╛рд░ рдкрдврд╝реЗрдВ, рдкреЗрдкрд░ рдФрд░ рдПрдХ рдкреЗрдВрд╕рд┐рд▓ рд▓реЗрдВ, рдФрд░ рдЙрди рдЕрд╡рдзрд╛рд░рдгрд╛рдУрдВ рдХреЛ рд╕рдордЭрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдЬрд┐рди рдкрд░ рдпрд╣ рддрдХрдиреАрдХ рдмрдиреА рд╣реИред <br><br>  рд╡рд╣ рд╕рдм рд╣реИ!  рдпрд╣ рд╣реИ рдХрд┐ рдХреИрд╕реЗ рдЗрд╕ Witcher 3 рдЪрдордХ рдХреЗ рдПрдХ рд╣рд┐рд╕реНрдЯреЛрдЧреНрд░рд╛рдо рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИред  рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ, рдореИрдВрдиреЗ рдЗрд╕ рднрд╛рдЧ рдХреЛ рд▓рд┐рдЦрддреЗ рд╕рдордп рдмрд╣реБрдд рдХреБрдЫ рд╕реАрдЦрд╛ред  рд╕реАрдбреА рдкреНрд░рдЬреЗрдХрдЯ рд░реЗрдб рдХреЗ рд▓реЛрдЧреЛрдВ рдХреЛ рдЙрдирдХреЗ рдЙрддреНрдХреГрд╖реНрдЯ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рдмрдзрд╛рдИ! <br><br>  рдпрджрд┐ рдЖрдк рдПрдХ рдкреВрд░реНрдг рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рд╢реЗрдбрд░ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдЙрдкрд▓рдмреНрдз <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред  рдореИрдВ рд╣рдореЗрд╢рд╛ рдЦреЗрд▓ рдХреЗ рдХрд░реАрдм рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реВрдВ рдФрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЦреБрд╢ рд╣реВрдВ рдХрд┐ рдореИрдВ рдлрд┐рд░ рд╕реЗ рд╕рдлрд▓ рд╣реБрдЖ! <br><br><h2>  рдФрд╕рдд рдЪрдордХ рдЧрдгрдирд╛ </h2><br>  рдпрд╣ "рдж рд╡рд┐рдЪрд░ 3: рд╡рд╛рдЗрд▓реНрдб рд╣рдВрдЯ" рдореЗрдВ рдордзреНрдпрдо рдЪрдордХ рдЧрдгрдирд╛ рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд╛ рджреВрд╕рд░рд╛ рднрд╛рдЧ рд╣реИред <br><br>  рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо рдПрдХ рдФрд░ рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ рд╢реЗрдбрд░ рдХреЗ рд╕рд╛рде рд▓рдбрд╝рд╛рдИ рдореЗрдВ рдЬрд╛рдПрдВ, рдЪрд▓реЛ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рджреЛрд╣рд░рд╛рдПрдВ рдХрд┐ рдкрд┐рдЫрд▓реЗ рднрд╛рдЧ рдореЗрдВ рдХреНрдпрд╛ рд╣реБрдЖ рдерд╛: рд╣рдордиреЗ рдПрдЪрдбреАрдЖрд░ рд░рдВрдЧ рдмрдлрд░ рдХреЗ рд╕рд╛рде 1 / 4x1 / 4 рдХреЗ рдкреИрдорд╛рдиреЗ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд┐рдпрд╛ред  рдкрд╣рд▓реА рдкрд╛рд╕ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдПрдХ рдЪрдордХ рд╣рд┐рд╕реНрдЯреЛрдЧреНрд░рд╛рдо (256 рдЕрд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдкреВрд░реНрдгрд╛рдВрдХ рдорд╛рдиреЛрдВ рдХрд╛ рд╕рдВрд░рдЪрд┐рдд рдмрдлрд░) рдорд┐рд▓рд╛ред  рд╣рдордиреЗ рдкреНрд░рддреНрдпреЗрдХ рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рдЪрдордХ рдХреЗ рд▓рд┐рдП рд▓рдШреБрдЧрдгрдХ рдХреА рдЧрдгрдирд╛ рдХреА, рдЗрд╕реЗ 256 рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдкрд░ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдФрд░ рд╕рдВрд░рдЪрд┐рдд рдмрдлрд░ рдХреЗ рд╕рдВрдЧрдд рдореВрд▓реНрдп рдХреЛ 1 рдкрд┐рдХреНрд╕реЗрд▓ рд╕реЗ рдмрдврд╝рд╛ рджрд┐рдпрд╛ред  рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рдЗрди 256 рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд╕рднреА рдорд╛рдиреЛрдВ рдХреА рдХреБрд▓ рд░рд╛рд╢рд┐ рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c3/89c/d16/3c389cd16ec2eed7617dcf9334429c6e.png"></div><br>  <i>рдкрд╣рд▓реЗ рдкрд╛рд╕ рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдгред</i>  <i>256 рддрддреНрд╡ рд╣реИрдВред</i> <br><br>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдлреБрд▓-рд╕реНрдХреНрд░реАрди рдмрдлрд░ рдХрд╛ рдЖрдХрд╛рд░ 1920x1080 рд╣реИред  рдЬрд╝реВрдо рдЖрдЙрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдкрд╣рд▓реЗ рдкрд╛рд╕ рдореЗрдВ 480x270 рдмрдлрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдмрдлрд░ рдореЗрдВ рд╕рднреА 256 рдорд╛рдиреЛрдВ рдХрд╛ рдпреЛрдЧ 480 * 270 = 129 600 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдЧрд╛ред <br><br>  рдЗрд╕ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкрд░рд┐рдЪрдп рдХреЗ рдмрд╛рдж, рд╣рдо рдЕрдЧрд▓реЗ рдЪрд░рдг рдкрд░ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВ: рдХрдВрдкреНрдпреВрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдПред <br><br>  рдЗрд╕ рд╕рдордп рдХреЗрд╡рд▓ рдПрдХ рдереНрд░реЗрдб рд╕рдореВрд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдбрд┐рд╕реНрдкреИрдЪ (1, 1, 1))ред <br><br>  рдЖрдЗрдП рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ shader рдХреЗ рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреЛ рджреЗрдЦреЗрдВ: <br><br> <code>cs_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb0[1], immediateIndexed <br> dcl_uav_structured u0, 4 <br> dcl_uav_typed_texture2d (float,float,float,float) u1 <br> dcl_input vThreadIDInGroup.x <br> dcl_temps 4 <br> dcl_tgsm_structured g0, 4, 256 <br> dcl_thread_group 64, 1, 1 <br> 0: ld_structured_indexable(structured_buffer, stride=4)(mixed,mixed,mixed,mixed) r0.x, vThreadIDInGroup.x, l(0), u0.xxxx <br> 1: store_structured g0.x, vThreadIDInGroup.x, l(0), r0.x <br> 2: iadd r0.xyz, vThreadIDInGroup.xxxx, l(64, 128, 192, 0) <br> 3: ld_structured_indexable(structured_buffer, stride=4)(mixed,mixed,mixed,mixed) r0.w, r0.x, l(0), u0.xxxx <br> 4: store_structured g0.x, r0.x, l(0), r0.w <br> 5: ld_structured_indexable(structured_buffer, stride=4)(mixed,mixed,mixed,mixed) r0.x, r0.y, l(0), u0.xxxx <br> 6: store_structured g0.x, r0.y, l(0), r0.x <br> 7: ld_structured_indexable(structured_buffer, stride=4)(mixed,mixed,mixed,mixed) r0.x, r0.z, l(0), u0.xxxx <br> 8: store_structured g0.x, r0.z, l(0), r0.x <br> 9: sync_g_t <br> 10: if_z vThreadIDInGroup.x <br> 11: mul r0.x, cb0[0].y, cb0[0].x <br> 12: ftou r0.x, r0.x <br> 13: utof r0.y, r0.x <br> 14: mul r0.yz, r0.yyyy, cb0[0].zzwz <br> 15: ftoi r0.yz, r0.yyzy <br> 16: iadd r0.x, r0.x, l(-1) <br> 17: imax r0.y, r0.y, l(0) <br> 18: imin r0.y, r0.x, r0.y <br> 19: imax r0.z, r0.y, r0.z <br> 20: imin r0.x, r0.x, r0.z <br> 21: mov r1.z, l(-1) <br> 22: mov r2.xyz, l(0, 0, 0, 0) <br> 23: loop <br> 24: breakc_nz r2.x <br> 25: ld_structured r0.z, r2.z, l(0), g0.xxxx <br> 26: iadd r3.x, r0.z, r2.y <br> 27: ilt r0.z, r0.y, r3.x <br> 28: iadd r3.y, r2.z, l(1) <br> 29: mov r1.xy, r2.yzyy <br> 30: mov r3.z, r2.x <br> 31: movc r2.xyz, r0.zzzz, r1.zxyz, r3.zxyz <br> 32: endloop <br> 33: mov r0.w, l(-1) <br> 34: mov r1.yz, r2.yyzy <br> 35: mov r1.xw, l(0, 0, 0, 0) <br> 36: loop <br> 37: breakc_nz r1.x <br> 38: ld_structured r2.x, r1.z, l(0), g0.xxxx <br> 39: iadd r1.y, r1.y, r2.x <br> 40: utof r2.x, r2.x <br> 41: utof r2.w, r1.z <br> 42: add r2.w, r2.w, l(0.500000) <br> 43: mul r2.w, r2.w, l(0.011271) <br> 44: exp r2.w, r2.w <br> 45: add r2.w, r2.w, l(-1.000000) <br> 46: mad r3.z, r2.x, r2.w, r1.w <br> 47: ilt r2.x, r0.x, r1.y <br> 48: iadd r2.w, -r2.y, r1.y <br> 49: itof r2.w, r2.w <br> 50: div r0.z, r3.z, r2.w <br> 51: iadd r3.y, r1.z, l(1) <br> 52: mov r0.y, r1.z <br> 53: mov r3.w, r1.x <br> 54: movc r1.xzw, r2.xxxx, r0.wwyz, r3.wwyz <br> 55: endloop <br> 56: store_uav_typed u1.xyzw, l(0, 0, 0, 0), r1.wwww <br> 57: endif <br> 58: ret</code> <br> <br>  рдПрдХ рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╣реИ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bbe/13a/0ab/bbe13a0abe0d79f47b0a59d33d51ab9c.png"></div><br>  рдЖрдЗрдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдкрд░ рдПрдХ рддреНрд╡рд░рд┐рдд рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ: рджреЛ рдпреВрдПрд╡реА рд╕рдВрд▓рдЧреНрди рд╣реИрдВ (u0: рдкрд╣рд▓реЗ рднрд╛рдЧ рд╕реЗ рдЗрдирдкреБрдЯ рдмрдлрд░ рдФрд░ u1: 1x1 R32_FLOAT рдкреНрд░рд╛рд░реВрдк рдХреА рдЖрдЙрдЯрдкреБрдЯ рдмрдирд╛рд╡рдЯ)ред  рд╣рдо рдпрд╣ рднреА рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдкреНрд░рддрд┐ рд╕рдореВрд╣ 64 рдзрд╛рдЧреЗ рдФрд░ 4-рдмрд╛рдЗрдЯ рд╕рд╛рдЭрд╛ рд╕рдореВрд╣ рдореЗрдореЛрд░реА рдХреЗ 256 рддрддреНрд╡ рд╣реИрдВред <br><br>  рд╣рдо рдЗрдирдкреБрдЯ рдмрдлрд░ рд╕реЗ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛ рдореЗрдореЛрд░реА рдХреЛ рднрд░рдиреЗ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ 64 рдзрд╛рдЧреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рд▓рдЧрднрдЧ рдкрд╣рд▓реЗ рдЬреИрд╕рд╛ рд╣реА рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдЖрдЧреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рд╕рднреА рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдЙрд╕рдХреЗ рдмрд╛рдж рд╣рдордиреЗ рдПрдХ рдмрд╛рдзрд╛ рдбрд╛рд▓ рджреАред <br><br> <code>//   -        . <br> //        64 ,    4     <br> //    . <br> [unroll] for (uint idx=0; idx &lt; 4; idx++) <br> { <br> const uint offset = threadID + idx*64; <br> shared_data[ offset ] = g_buffer[offset]; <br> } <br> //    ,       ,     <br> //             . <br> GroupMemoryBarrierWithGroupSync();</code> <br> <br>  рд╕рднреА рдЧрдгрдирд╛ рдХреЗрд╡рд▓ рдПрдХ рдзрд╛рдЧреЗ рдореЗрдВ рдХреА рдЬрд╛рддреА рд╣реИ, рдЕрдиреНрдп рд╕рднреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрдлрд░ рд╕реЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рд╕рд╛рдЭрд╛ рдореЗрдореЛрд░реА рдореЗрдВ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  "рдХрдВрдкреНрдпреВрдЯрд┐рдВрдЧ" рд╕реНрдЯреНрд░реАрдо рдореЗрдВ 0. рдХрд╛ рд╕реВрдЪрдХрд╛рдВрдХ рдХреНрдпреЛрдВ рд╣реИ?  рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ, рд╣рдо рдЕрдВрддрд░рд╛рд▓ [0-63] рд╕реЗ рдХрд┐рд╕реА рднреА рдзрд╛рд░рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди 0 рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рд╣рдо рдЕрддрд┐рд░рд┐рдХреНрдд рдкреВрд░реНрдгрд╛рдВрдХ-рдкреВрд░реНрдгрд╛рдВрдХ рддреБрд▓рдирд╛ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╛рдиреА</a> рдирд┐рд░реНрджреЗрд╢) рд╕реЗ рдмрдЪ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдкрд┐рдХреНрд╕рд▓ рдХреЗ рдЕрдВрддрд░рд╛рд▓ рдХреЗ рд╕рдВрдХреЗрдд рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ рдЬрд┐рд╕реЗ рдСрдкрд░реЗрд╢рди рдореЗрдВ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдПрдЧрд╛ред <br><br>  рдкрдВрдХреНрддрд┐ 11 рдореЗрдВ, рд╣рдо рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рдХреБрд▓ рд╕рдВрдЦреНрдпрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪреМрдбрд╝рд╛рдИ * рдХреА рдКрдБрдЪрд╛рдИ рдХреЛ рдмрдврд╝рд╛рддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЕрдВрддрд░рд╛рд▓ рд╕реЗ рджреЛ рд╕рдВрдЦреНрдпрд╛рдУрдВ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВ [0.0f-1.0f], рдЬреЛ рдЕрдВрддрд░рд╛рд▓ рдХреА рд╢реБрд░реБрдЖрдд рдФрд░ рдЕрдВрдд рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред  рдЖрдЧреЗ рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ <code>0 &lt;= Start &lt;= End &lt;= totalPixels - 1</code> : <br><br> <code>//        0. <br> [branch] if (threadID == 0) <br> { <br> //         <br> uint totalPixels = cb0_v0.x * cb0_v0.y; <br> <br> //   (,  ,    ), <br> //        . <br> int pixelsToConsiderStart = totalPixels * cb0_v0.z; <br> int pixelsToConsiderEnd = totalPixels * cb0_v0.w; <br> <br> int pixelsMinusOne = totalPixels - 1; <br> <br> pixelsToConsiderStart = clamp( pixelsToConsiderStart, 0, pixelsMinusOne ); <br> pixelsToConsiderEnd = clamp( pixelsToConsiderEnd, pixelsToConsiderStart, pixelsMinusOne );</code> <br> <br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдиреАрдЪреЗ рджреЛ рдЪрдХреНрд░ рд╣реИрдВред  рдЙрдирдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛ (рдпрд╛ рдЙрдирдХреЗ рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреЗ рд╕рд╛рде) рдпрд╣ рд╣реИ рдХрд┐ рдЫреЛрд░реЛрдВ рдХреЗ рдЫреЛрд░ рдкрд░ рдЕрдЬреАрдм рд╕рд╢рд░реНрдд рд╕рдВрдХреНрд░рдордг рд╣реИрдВред  рдореЗрд░реЗ рд▓рд┐рдП рдЙрдиреНрд╣реЗрдВ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдирд╛ рдмрд╣реБрдд рдореБрд╢реНрдХрд┐рд▓ рдерд╛ред  рдкрдВрдХреНрддрд┐ 21 рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВред "-1" рдХреНрдпреЛрдВ рд╣реИ?  рдореИрдВ рдЗрд╕реЗ рдереЛрдбрд╝рд╛ рдиреАрдЪреЗ рд╕рдордЭрд╛рдКрдВрдЧрд╛ред <br><br>  рдкрд╣рд▓реЗ рдЪрдХреНрд░ рдХрд╛ рдХрд╛рд░реНрдп <i>PixToConsiderStart</i> рдХреЛ рддреНрдпрд╛рдЧрдирд╛ рдФрд░ рд╣рдореЗрдВ рдмрдлрд░ рд╕реЗрд▓ рдХрд╛ рд╕реВрдЪрдХрд╛рдВрдХ рджреЗрдирд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ <i>PixToConsiderStart</i> +1 рдореМрдЬреВрдж рд╣реИ (рд╕рд╛рде рд╣реА рдкрд┐рдЫрд▓реЗ рдХрдХреНрд╖реЛрдВ рдореЗрдВ рд╕рднреА рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рд╕рдВрдЦреНрдпрд╛)ред <br><br>  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ <i>PixToConsiderStart</i> рд▓рдЧрднрдЧ 30,000 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ, рдФрд░ рдмрдлрд░ рдореЗрдВ рд╕реЗрд▓ рдореЗрдВ "рд╢реВрдиреНрдп" рдореЗрдВ 37,000 рдкрд┐рдХреНрд╕реЗрд▓ рд╣реИрдВ (рдпрд╣ рд░рд╛рдд рдореЗрдВ рдЧреЗрдо рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ)ред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рд▓рдЧрднрдЧ 30001 рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рд╕рд╛рде рдЪрдордХ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рд╢реБрд░реВ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЬреЛ рд╕реЗрд▓ "рд╢реВрдиреНрдп" рдореЗрдВ рдореМрдЬреВрдж рд╣реИред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рддреБрд░рдВрдд рд▓реВрдк рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд╢реБрд░реБрдЖрддреА рдЗрдВрдбреЗрдХреНрд╕ '0' рдФрд░ рдЬреАрд░реЛ рдбрд┐рд╕реНрдХреНрд▓реЛрдЬреНрдб рдкрд┐рдХреНрд╕рд▓ рдорд┐рд▓рддрд╛ рд╣реИред <br><br>  HLSL рдХреЛрдб рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ: <br><br> <code>//     <br> int numProcessedPixels = 0; <br> <br> //   [0-255] <br> int lumaValue = 0; <br> <br> //      <br> bool bExitLoop = false; <br> <br> //    -  "pixelsToConsiderStart" . <br> //          lumaValue,      . <br> [loop] <br> while (!bExitLoop) <br> { <br> //       . <br> uint numPixels = shared_data[lumaValue]; <br> <br> // ,      lumaValue <br> int tempSum = numProcessedPixels + numPixels; <br> <br> //  ,  pixelsToConsiderStart,    . <br> // ,      lumaValue. <br> //  , pixelsToConsiderStart -   "" ,   ,    . <br> [flatten] <br> if (tempSum &gt; pixelsToConsiderStart) <br> { <br> bExitLoop = true; <br> } <br> else <br> { <br> numProcessedPixels = tempSum; <br> lumaValue++; <br> } <br> }</code> <br> <br>  рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдХреА рдкрдВрдХреНрддрд┐ 21 рд╕реЗ рд░рд╣рд╕реНрдпрдордп рд╕рдВрдЦреНрдпрд╛ "-1" рд▓реВрдк рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдмреВрд▓рд┐рдпрди рд╕реНрдерд┐рддрд┐ рд╕реЗ рдЬреБрдбрд╝реА рд╣реБрдИ рд╣реИ (рдореИрдВрдиреЗ рджреБрд░реНрдШрдЯрдирд╛ рдХреЗ рдмрд╛рдж рд▓рдЧрднрдЧ рдЗрд╕реЗ рдЦреЛрдЬ рд▓рд┐рдпрд╛ рдерд╛)ред <br><br>  <i>LumaValue</i> рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдФрд░ рд╕реНрд╡рдпрдВ <i>LumaValue</i> рд╕реЗ рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рджреВрд╕рд░реЗ рдЪрдХреНрд░ рдкрд░ рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рджреВрд╕рд░реЗ рдЪрдХреНрд░ рдХрд╛ рдХрд╛рд░реНрдп рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рдкреНрд░рднрд╛рд╡ рдФрд░ рдФрд╕рдд рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рд╣реИред <br><br>  рд╣рдо рдкрд╣рд▓реЗ рд▓реВрдк рдореЗрдВ рдЧрдгрдирд╛ рдХрд┐рдП рдЧрдП <i>lumaValue рд╕реЗ</i> рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред <br><br> <code>float finalAvgLuminance = 0.0f; <br> <br> //       <br> uint numProcessedPixelStart = numProcessedPixels; <br> <br> //    -      . <br> //    ,    ,        lumaValue. <br> //      [0-255],     ,    ,   ,    <br> //    pixelsToConsiderEnd. <br> //          . <br> bExitLoop = false; <br> [loop] <br> while (!bExitLoop) <br> { <br> //       . <br> uint numPixels = shared_data[lumaValue]; <br> <br> //      <br> numProcessedPixels += numPixels; <br> <br> //    ,    [0-255] (uint) <br> uint encodedLumaUint = lumaValue; <br> <br> //        <br> float numberOfPixelsWithCurrentLuma = numPixels; <br> <br> //    ,    [0-255] (float) <br> float encodedLumaFloat = encodedLumaUint;</code> <br> <br>  рдЗрд╕ рд╕реНрддрд░ рдкрд░, рд╣рдордиреЗ рдЕрдВрддрд░рд╛рд▓ [0.0f-255.f] рдореЗрдВ рдПрдиреНрдХреЛрдбреЗрдб рдЪрдордХ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ред <br><br>  рдбрд┐рдХреЛрдбрд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИ - рдЖрдкрдХреЛ рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдЪрд░рдг рдХреА рдЧрдгрдирд╛ рдХреЛ рдЙрд▓реНрдЯрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рдХреЛрдбрд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдПрдХ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рджреЛрд╣рд░рд╛рд╡: <br><br> <code>float luma = dot( hdrPixelColor, float3(0.2126, 0.7152, 0.0722) ); <br> ... <br> float outLuma; <br> <br> //   log(0)  undef,  log(1) = 0 <br> outLuma = luma + 1.0; <br> <br> //   <br> outLuma = log( outLuma ); <br> <br> //   128,   log(1) * 128 = 0, log(2,71828) * 128 = 128, log(7,38905) * 128 = 256 <br> outLuma = outLuma * 128 <br> <br> //   uint <br> uint outLumaUint = min( (uint) outLuma, 255);</code> <br> <br>  рдЪрдордХ рдХреЛ рдбрд┐рдХреЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЙрд▓реНрдЯрд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣: <br><br> <code>//    0.5f (  ,    ) <br> float fDecodedLuma = encodedLumaFloat + 0.5; <br> <br> //   : <br> <br> //   128 <br> fDecodedLuma /= 128.0; <br> <br> // exp(x),   log(x) <br> fDecodedLuma = exp(fDecodedLuma); <br> <br> //  1.0 <br> fDecodedLuma -= 1.0;</code> <br> <br>  рдлрд┐рд░ рд╣рдо рдбрд┐рдХреЛрдб рдХреА рдЧрдИ рдЪрдордХ рджреНрд╡рд╛рд░рд╛ рджреА рдЧрдИ рдЪрдордХ рдХреЗ рд╕рд╛рде рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдЧреБрдгрд╛ рдХрд░рдХреЗ рд╡рд┐рддрд░рдг рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдЙрдиреНрд╣реЗрдВ рддрдм рддрдХ <i>рд╕рдореЗрдЯрддреЗ</i> рд╣реИрдВ рдЬрдм рддрдХ рдХрд┐ рд╣рдореЗрдВ <i>рдкрд┐рдХреНрд╕рд▓рдЯреЙрдирд╕рд╛рдЗрдбрд░рдЗрдВрдб</i> рдкрд┐рдХреНрд╕рд▓ рдХреА рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдирд╣реАрдВ рдорд┐рд▓ рдЬрд╛рддреАред <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдо рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд┐рдП рдЧрдП рдкрд┐рдХреНрд╕реЗрд▓ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдХреБрд▓ рдкреНрд░рднрд╛рд╡ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдмрд╛рдХреА рд▓реВрдк (рдФрд░ shader) рд╣реИ: </font><font style="vertical-align: inherit;">рдкреВрд░рд╛ shader </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ</font></a><font style="vertical-align: inherit;"> рдЙрдкрд▓рдмреНрдз </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рд╣реИ</font></a><font style="vertical-align: inherit;"> ред рдпрд╣ рдореЗрд░реЗ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">HLSLexplorer</font></a><font style="vertical-align: inherit;"> рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЗ рд╕рд╛рде рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдВрдЧрдд рд╣реИ </font><font style="vertical-align: inherit;">, рдЬрд┐рд╕рдХреЗ рдмрд┐рдирд╛ рдореИрдВ рдкреНрд░рднрд╛рд╡реА рд░реВрдк рд╕реЗ рдж рд╡рд┐рдЪрд░ 3 (рдФрд░ рдЕрдиреНрдп рд╕рднреА рдкреНрд░рднрд╛рд╡ рднреА!) рдореЗрдВ рдФрд╕рдд рдЪрдордХ рдЧрдгрдирд╛ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдирд┐рд╖реНрдХрд░реНрд╖ рдореЗрдВ, рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ред рдФрд╕рдд рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рдЗрд╕ рд╢реЗрдбрд░ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдерд╛ред рдореБрдЦреНрдп рдХрд╛рд░рдг: </font><font style="vertical-align: inherit;">1) рдЪрдХреНрд░ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдкрд░ рдЕрдЬреАрдм "рд▓рдВрдмрд┐рдд" рдЪреЗрдХ, рдореБрдЭреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╕реЛрдЪрд╛ рдЧрдпрд╛ рдерд╛ рдХрд┐ рдпрд╣ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╕рдордп рд▓рдЧрд╛ред </font><font style="vertical-align: inherit;">2) рд░реЗрдВрдбрд░рдбреЛрдХ (vред 1.2) рдореЗрдВ рдЗрд╕ рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ рд╢реЗрдбрд░ рдХреЛ рдбреАрдмрдЧ рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ред</font></font><br><br> <code>//     <br> float fCurrentLumaContribution = numberOfPixelsWithCurrentLuma * fDecodedLuma; <br> <br> // ()       . <br> float tempTotalContribution = fCurrentLumaContribution + finalAvgLuminance; <br> <br> <br> [flatten] <br> if (numProcessedPixels &gt; pixelsToConsiderEnd ) <br> { <br> //     <br> bExitLoop = true; <br> <br> //      ,     . <br> //         <br> int diff = numProcessedPixels - numProcessedPixelStart; <br> <br> //     <br> finalAvgLuminance = tempTotalContribution / float(diff); <br> } <br> else <br> { <br> //       lumaValue <br> finalAvgLuminance = tempTotalContribution; <br> lumaValue++; <br> } <br> } <br> <br> //    <br> g_avgLuminance[uint2(0,0)] = finalAvgLuminance;</code> <br> <br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдСрдкрд░реЗрд╢рди "ld_structured_indexable" рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╕реВрдЪрдХрд╛рдВрдХ 0 рд╕реЗ рдкрдврд╝рдиреЗ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╕рд╣реА рдореВрд▓реНрдп рджреЗрддрд╛ рд╣реИ, рдЕрдиреНрдп рд╕рднреА рд╢реВрдиреНрдп рд╡рд╛рдкрд╕ рд▓реМрдЯрддреЗ рд╣реИрдВ, рдпрд╣реА рд╡рдЬрд╣ рд╣реИ рдХрд┐ рдЪрдХреНрд░ рдЕрдирд┐рд╢реНрдЪрд┐рдд рдХрд╛рд▓ рддрдХ рдЬрд╛рд░реА рд░рд╣рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рдореИрдВ рдореВрд▓ рдХреЗ рд╕рдорд╛рди рдХреЛрдбрд╛рдВрддрд░рдХ (рдЕрдВрддрд░ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рджреЗрдЦреЗрдВ) рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рдерд╛, RenderDoc рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореИрдВ рдЗрд╕ shader рдХреЛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдерд╛ - рдФрд░ рдкрд░рд┐рдгрд╛рдо рд╕рдорд╛рди рдереЗ!</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de1/a0e/74f/de1a0e74f0f6619994d1edc9621d148d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рдбрд╝рд╛рдИ рдХрд╛ рдирддреАрдЬрд╛ред </font><font style="vertical-align: inherit;">рдмрд╛рдИрдВ рдУрд░ рдореЗрд░рд╛ shader рд╣реИ, рджрд╛рдИрдВ рдУрд░ рдореВрд▓ рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рд╣реИред</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 8. рдЪрдВрджреНрд░рдорд╛ рдФрд░ рдЙрд╕рдХреЗ рдЪрд░рдг </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдЦ рдХреЗ рдЖрдард╡реЗрдВ рднрд╛рдЧ рдореЗрдВ, рдореИрдВ рдж рд╡рд┐рдЪрд░ 3 (рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рд░рдХреНрдд рдФрд░ рд╢рд░рд╛рдм рдХреЗ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ) рд╕реЗ рдЪрдВрджреНрд░рдорд╛ рдХреА рдЫрд╛рдпрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реВрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд╛рдБрдж рд░рд╛рдд рдХреЗ рдЖрдХрд╛рд╢ рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рддрддреНрд╡ рд╣реИ, рдФрд░ рдЗрд╕реЗ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдмрдирд╛рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореЗрд░реЗ рд▓рд┐рдП рд░рд╛рдд рдореЗрдВ TW3 рдореЗрдВ рдЪрд▓рдирд╛ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЖрдирдВрдж рдерд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд░рд╛ рдЗрд╕ рджреГрд╢реНрдп рдХреЛ рджреЗрдЦреЗрдВ!</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53f/099/b6c/53f099b6ccfcef0eeb0755ced73894b9.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░ рд▓реЗрдВ, рдореИрдВ рд░реЗрдВрдбрд░рд┐рдВрдЧ рдХреА рдмрд╛рд░реАрдХрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рд╢рдмреНрдж рдХрд╣реВрдВрдЧрд╛ред рдЬреНрдпрд╛рдорд┐рддреАрдп рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдЪрдВрджреНрд░рдорд╛ рд╕рд┐рд░реНрдл рдПрдХ рдЧреЛрд▓рд╛ рд╣реИ (рдиреАрдЪреЗ рджреЗрдЦреЗрдВ), рдЬрд┐рд╕рдореЗрдВ рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ, рд╕рд╛рдорд╛рдиреНрдп рдФрд░ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╡реИрдХреНрдЯрд░ рд╣реИрдВред рд╡рд░реНрдЯреЗрдХреНрд╕ рд╢реЗрдбрд░ рд╡рд┐рд╢реНрд╡ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рд╕реНрдерд┐рддрд┐ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рдорд╛рдирджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╡реИрдХреНрдЯрд░, рджреЛ рдмрд┐рдВрджреБрдУрдВ рдкрд░ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рдФрд░ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ (рд╡реЗрдХреНрдЯрд░ рдЙрддреНрдкрд╛рдж рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ), рд╡рд┐рд╢реНрд╡ рдореИрдЯреНрд░рд┐рдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЪрдВрджреНрд░рдорд╛ рджреВрд░рджрд░рд╛рдЬ рдХреЗ рд╡рд┐рдорд╛рди, рдЦреЗрддреЛрдВ рдФрд░ MinDepth MaxDepth рд╕рдВрд░рдЪрдирд╛ рдкрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдирд┐рд╣рд┐рдд </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D3D11_VIEWPORT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореВрд▓реНрдп 0.0 (рдПрдХ рд╣реА рдЪрд╛рд▓ рд╣реИ рдХрд┐ рдЖрдХрд╛рд╢ рдЧреБрдВрдмрдж рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛) рд╕реМрдВрдкрд╛ред рдЖрдХрд╛рд╢ рдХреЗ рддреБрд░рдВрдд рдмрд╛рдж рдЪрдВрджреНрд░рдорд╛ рдХрд╛ рдкреНрд░рддрд┐рдкрд╛рджрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f5/999/ec7/6f5999ec7ca1176dfac370f60820d97f.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреЛрд▓рд╛ рдЪрд╛рдБрдж рдХреЛ рдЦреАрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЦреИрд░, рд╕рдм рдХреБрдЫ, рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ, рдЖрдк рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдкрд┐рдХреНрд╕реЗрд▓ shader рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ: </font><font style="vertical-align: inherit;">рдореБрдЦреНрдп рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдореИрдВрдиреЗ рдмреНрд▓рдб рдФрд░ рд╡рд╛рдЗрди рд╕реЗ рдПрдХ рд╢реЗрдбрд░ рдЪреБрдирд╛ рд╣реИ - рдпрд╣ рдЫреЛрдЯрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдмрдирд╛рд╡рдЯ рдХреЛ рдирдореВрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдСрдлрд╕реЗрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">cb0 [0] .w рдХрд╛ рдЙрдкрдпреЛрдЧ X рдЕрдХреНрд╖ рдХреЗ рд╕рд╛рде рдПрдХ рдСрдлрд╕реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ рд╕рд░рд▓ рдЪрд╛рд▓ рд╕реЗ рд╣рдо рдЪрдВрджреНрд░рдорд╛ рдХреЗ рдШреВрд░реНрдгрди рдХреЛ рдЕрдкрдиреА рдзреБрд░реА рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдШреБрдорд╛ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br> <code>ps_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb0[1], immediateIndexed <br> dcl_constantbuffer cb2[3], immediateIndexed <br> dcl_constantbuffer cb12[267], immediateIndexed <br> dcl_sampler s0, mode_default <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_input_ps linear v1.w <br> dcl_input_ps linear v2.xyzw <br> dcl_input_ps linear v3.xy <br> dcl_input_ps linear v4.xy <br> dcl_output o0.xyzw <br> dcl_temps 3 <br> 0: mov r0.x, -cb0[0].w <br> 1: mov r0.y, l(0) <br> 2: add r0.xy, r0.xyxx, v2.xyxx <br> 3: sample_indexable(texture2d)(float,float,float,float) r0.xyzw, r0.xyxx, t0.xyzw, s0 <br> 4: add r0.xyz, r0.xyzx, l(-0.500000, -0.500000, -0.500000, 0.000000) <br> 5: log r0.w, r0.w <br> 6: mul r0.w, r0.w, l(2.200000) <br> 7: exp r0.w, r0.w <br> 8: add r0.xyz, r0.xyzx, r0.xyzx <br> 9: dp3 r1.x, r0.xyzx, r0.xyzx <br> 10: rsq r1.x, r1.x <br> 11: mul r0.xyz, r0.xyzx, r1.xxxx <br> 12: mul r1.xy, r0.yyyy, v3.xyxx <br> 13: mad r0.xy, v4.xyxx, r0.xxxx, r1.xyxx <br> 14: mad r0.xy, v2.zwzz, r0.zzzz, r0.xyxx <br> 15: mad r0.z, cb0[0].y, l(0.033864), cb0[0].w <br> 16: mul r0.z, r0.z, l(6.283185) <br> 17: sincos r1.x, r2.x, r0.z <br> 18: mov r2.y, r1.x <br> 19: dp2_sat r0.x, r0.xyxx, r2.xyxx <br> 20: mul r0.xyz, r0.xxxx, cb12[266].xyzx <br> 21: mul r0.xyz, r0.xyzx, r0.wwww <br> 22: mul r0.xyz, r0.xyzx, cb2[2].xyzx <br> 23: add_sat r0.w, -v1.w, l(1.000000) <br> 24: mul r0.w, r0.w, cb2[2].w <br> 25: mul o0.xyz, r0.wwww, r0.xyzx <br> 26: mov o0.w, l(0) <br> 27: ret</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc2/ddb/c02/fc2ddbc0262d27002f70d837a623c366.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╕реЗ рдореВрд▓реНрдпреЛрдВ рдХреЗ рдЙрджрд╛рд╣рд░рдгред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рдмрдирд╛рд╡рдЯ (1024x512) рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрд▓рдЧреНрди рд╣реИред </font><font style="vertical-align: inherit;">рдЖрд░рдЬреАрдмреА рдЪреИрдирд▓реЛрдВ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢рд╛ рдПрдиреНрдХреЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ рдореЗрдВ рдЪрдВрджреНрд░рдорд╛ рдХреА рд╕рддрд╣ рдХрд╛ рд░рдВрдЧред </font><font style="vertical-align: inherit;">рдЪрд╛рд▓рд╛рдХ!</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/392/733/1a1/3927331a17867d712e667c36a0ee6641.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ рдЪрдВрджреНрд░рдорд╛ рдХреА рд╕рддрд╣ рдХрд╛ рд░рдВрдЧ рд╣реИред</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c64/542/d70/c64542d70a7e3b58aa9426f12e8880d7.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрдирд╛рд╡рдЯ рдЖрд░рдЬреАрдмреА рдЪреИрдирд▓ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢рд╛ рд╣реИрдВред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╣реА рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо RGBA рдЪреИрдирд▓реЛрдВ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрддреЗ рд╣реИрдВред рд╣рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдирдЪрд┐рддреНрд░ рдХреЛ рдЕрдирдкреИрдХ рдХрд░рдиреЗ рдФрд░ рд╕рддрд╣ рдХреЗ рд░рдВрдЧ рдХреЗ рдЧрд╛рдорд╛ рд╕реБрдзрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рд╡рд░реНрддрдорд╛рди рдореЗрдВ, рдПрдХ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рд╢реЗрдбрд░ рдХреЛ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: </font><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛ рдХрджрдо рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдмрд╛рдзреНрдпрдХрд╛рд░реА рдкреНрд░рджрд░реНрд╢рди рдХрд░рдирд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдПрдХреНрд╕рд╡рд╛рдИ рдШрдЯрдХреЛрдВ рдореЗрдВред (рдж рд╡рд┐рдЪрд░ 3 рдореЗрдВ, рдЬреЗрдб рдЕрдХреНрд╖ рдКрдкрд░ рд╣реИ, рдФрд░ рдмрдирд╛рд╡рдЯ рдХрд╛ рдкреВрд░рд╛ рдЬреЗрдб-рдЪреИрдирд▓ 1.0 рд╣реИ)ред рд╣рдо рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </font><font style="vertical-align: inherit;">рдЕрдм рдпрд╣ рдЗрд╕ shader рдХреЗ рдореЗрд░реЗ рдкрд╕рдВрджреАрджрд╛ рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рд╕рдордп рд╣реИред 15-16 рдХреА рддрд░реНрдЬ рдкрд░ рдлрд┐рд░ рд╕реЗ </font><font style="vertical-align: inherit;">рджреЗрдЦреЗрдВ </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">рдпрд╣ рд░рд╣рд╕реНрдпрдордп 0.033864 рдХреНрдпрд╛ рд╣реИ? рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рдХрд╛ рдХреЛрдИ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╣рдо рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд рдореВрд▓реНрдп рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рд▓рдЧрднрдЧ 29.53 рдорд┐рд▓рддреЗ рд╣реИрдВ, рдЬреЛ рдХрд┐ рд╕рдорд╛рди </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рдорд╣реАрдиреЗ</font></a><font style="vertical-align: inherit;"> рдХреА рдЕрд╡рдзрд┐ рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИ</font></font><br><br> <code>float4 MoonPS(in InputStruct IN) : SV_Target0 <br> { <br> //  Texcoords <br> float2 uvOffsets = float2(-cb0_v0.w, 0.0); <br> <br> //  texcoords <br> float2 uv = IN.param2.xy + uvOffsets; <br> <br> //   <br> float4 sampledTexture = texture0.Sample( sampler0, uv); <br> <br> //    -  - <br> float moonColorTex = pow(sampledTexture.a, 2.2 ); <br> <br> //     [0,1]   [-1,1]. <br> // : sampledTexture.xyz * 2.0 - 1.0    <br> float3 sampledNormal = normalize((sampledTexture.xyz - 0.5) * 2);</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>//    <br> float3 Tangent = IN.param4.xyz; <br> float3 Normal = float3(IN.param2.zw, IN.param3.w); <br> float3 Bitangent = IN.param3.xyz; <br> <br> //  TBN <br> float3x3 TBN = float3x3(Tangent, Bitangent, Normal); <br> <br> //    XY <br> //   TBN  float3x2: 3 , 2  <br> float2 vNormal = mul(sampledNormal, (float3x2)TBN).xy;</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>15: mad r0.z, cb0[0].y, l(0.033864), cb0[0].w <br> 16: mul r0.z, r0.z, l(6.283185)</code> <br> <br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджрд┐рдиреЛрдВ рдореЗрдВ! </font><font style="vertical-align: inherit;">рдпрд╣ рд╡рд╣реА рд╣реИ рдЬреЛ рдореИрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдзреНрдпрд╛рди рджреЗрддрд╛ рд╣реВрдВ! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдордЬрд╝рдмреВрддреА рд╕реЗ рдпрд╣ рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ cb0 [0]ред рдпрд╣ рдЙрди рджрд┐рдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реИ рдЬреЛ рдЧреЗрдордкреНрд▓реЗ рдХреЗ рджреМрд░рд╛рди рдмреАрдд рдЪреБрдХреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╡рд┐рдЪрд▓рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣рд╛рдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрдирд╛рд╡рдЯ рдХреЗ рдПрдХреНрд╕-рдЕрдХреНрд╖ рдХреЗ рд╕рд╛рде рдСрдлрд╕реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдЧреБрдгрд╛рдВрдХ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЗрд╕реЗ 2 * рдкрд╛рдИ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд░ sincos рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдо рдПрдХ рдФрд░ 2d рд╡реЗрдХреНрдЯрд░ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рд╡реЗрдХреНрдЯрд░ рдФрд░ "рдЪрдВрджреНрд░рдорд╛" рд╡реЗрдХреНрдЯрд░ рдХреЗ рдмреАрдЪ рд╕реНрдХреЗрд▓рд░ рдЙрддреНрдкрд╛рдж рдХреА рдЧрдгрдирд╛ рдХрд░рдХреЗ, рдЪрдВрджреНрд░рдорд╛ рдХреЗ рдПрдХ рдЪрд░рдг рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪрдВрджреНрд░рдорд╛ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдЪрд░рдгреЛрдВ рдХреЗ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рджреЗрдЦреЗрдВ:</font></font><br><br> <code>//  . <br> //   days/29.53 + bias. <br> float phase = cb0_v0.y * (1.0 / SYNODIC_MONTH_LENGTH) + cb0_v0.w; <br> <br> //   2*PI.  , 29.53     <br> //   sin/cos. <br> phase *= TWOPI; <br> <br> //      . <br> float outSin = 0.0; <br> float outCos = 0.0; <br> sincos(phase, outSin, outCos); <br> <br> //    <br> float lunarPhase = saturate( dot(vNormal, float2(outCos, outSin)) );</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c54/e7f/648/c54e7f6488b10d402a7f4b45e61d455d.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/899/133/edc/899133edc0c04c67ffb4987748e908b7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрддрд┐рдо рдЪрд░рдг рдЕрдВрддрд┐рдо рд░рдВрдЧ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреБрдгрд╛ рд╕рдВрдЪрд╛рд▓рди рдХреА рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХрд░рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рд╢рд╛рдпрдж рдпрд╣ рдирд╣реАрдВ рд╕рдордЭ рдкрд╛рдПрдВрдЧреЗ рдХрд┐ рдпрд╣ рд╢реЗрдбрд░ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд▓рд┐рдП 0.0 рдХрд╛ рдЕрд▓реНрдлрд╛ рдорд╛рди рдХреНрдпреЛрдВ рднреЗрдЬрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЪрдВрджреНрд░рдорд╛ рдХреЛ рд╕рдореНрдорд┐рд╢реНрд░рдг рдХреЗ рд╕рд╛рде рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:</font></font><br><br> <code>//        . <br> <br> // cb12_v266.xyz ,      . <br> //  (1.54, 2.82, 4.13) <br> float3 moonSurfaceGlowColor = cb12_v266.xyz; <br> <br> float3 moonColor = lunarPhase * moonSurfaceGlowColor; <br> moonColor = moonColorTex * moonColor; <br> <br> // cb_v2.xyz - , , ,  (1.0, 1.0, 1.0) <br> moonColor *= cb2_v2.xyz; <br> <br> //   ,    , .  -   . <br> //     ,         , <br> //   . <br> float paramHorizon = saturate(1.0 - IN.param1.w); <br> paramHorizon *= cb2_v2.w; <br> <br> moonColor *= paramHorizon; <br> <br> //        <br> return float4(moonColor, 0.0);</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d9/549/32c/2d954932c188bcdcdd0a156796b85da7.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЖрдкрдХреЛ рдкреГрд╖реНрдарднреВрдорд┐ (рдЖрдХрд╛рд╢) рд░рдВрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдпрджрд┐ рдпрд╣ рд╢реЗрдбрд░ рдХрд╛рд▓рд╛ рд▓реМрдЯрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдПрдХ рдкреВрд░реНрдг shader рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕реЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдореЗрдВ рдмрдбрд╝реЗ рдирд┐рд░рдВрддрд░ рдмрдлрд╝рд░реНрд╕ рд╣реИрдВ рдФрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдореВрд▓ shader рдХреЗ рдмрдЬрд╛рдп RenderDoc рдореЗрдВ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП (рдмрд╕ "MoonPS" рдХрд╛ рдирд╛рдо рдмрджрд▓рдХрд░ "EditedShaderPS")ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЖрдЦрд┐рд░реА: рдореИрдВ рдЖрдкрдХреЗ рд╕рд╛рде рдкрд░рд┐рдгрд╛рдо рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рдИрдВ рдУрд░ рдореЗрд░рд╛ shader рд╣реИ, рджрд╛рдИрдВ рдУрд░ рдЦреЗрд▓ рд╕реЗ рдореВрд▓ shader рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрддрд░ рдиреНрдпреВрдирддрдо рд╣реИ рдФрд░ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff8/c4a/8fa/ff8c4a8fa103b9592941c965ad060729.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕ shader рдХреЛ рдмрд╣рд▓рд╛рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рдерд╛ред </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 9. рдЬреА-рдмрдлрд░ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рднрд╛рдЧ рдореЗрдВ, рдореИрдВ The Witcher 3 рдореЗрдВ gbuffer рдХреЗ рдХреБрдЫ рд╡рд┐рд╡рд░рдгреЛрдВ рдХреЛ рдкреНрд░рдХрдЯ рдХрд░реВрдБрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдорд╛рдиреЗрдВрдЧреЗ рдХрд┐ рдЖрдк рдЖрд╕реНрдердЧрд┐рдд рдЫрд╛рдпрд╛рдВрдХрди рдХреА рдореВрд▓ рдмрд╛рддреЗрдВ рдЬрд╛рдирддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐: рдмрдВрдж рд░рдЦрдиреЗ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рд╕рднреА рддреИрдпрд╛рд░ рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рдФрд░ рдЫрд╛рдпрд╛рдВрдХрди рдХреА рдЧрдгрдирд╛ рдПрдХ рдмрд╛рд░ рдореЗрдВ рдирд╣реАрдВ рдХрд░рдирд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рдЧрдгрдирд╛рдУрдВ рдХреЛ рджреЛ рдЪрд░рдгреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ (рдЬреНрдпрд╛рдорд┐рддрд┐ рдкрд╛рд╕) рдореЗрдВ рд╣рдо рд╕рддрд╣ рдбреЗрдЯрд╛ (рд╕реНрдерд┐рддрд┐, рдорд╛рдирдХ, рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рд░рдВрдЧ, рдЖрджрд┐ ...) рдХреЗ рд╕рд╛рде GBuffer рдХреЛ рднрд░рддреЗ рд╣реИрдВ, рдФрд░ рджреВрд╕рд░реЗ (рд▓рд╛рдЗрдЯрд┐рдВрдЧ рдкрд╛рд╕) рдореЗрдВ рд╣рдо рд╕рдм рдХреБрдЫ рдЧрдардмрдВрдзрди рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рдХрд╛рд╢ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╕реНрдердЧрд┐рдд рдЫрд╛рдпрд╛рдВрдХрди рдПрдХ рдмрд╣реБрдд рд╣реА рд▓реЛрдХрдкреНрд░рд┐рдп рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЖрдкрдХреЛ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯрд╛рдЗрд▓</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдбрд┐рдлрд░реНрдб рдЫрд╛рдпрд╛рдВрдХрди рдЬреИрд╕реА рддрдХрдиреАрдХреЛрдВ рджреНрд╡рд╛рд░рд╛ рдПрдХрд▓-рд╕реНрдХреНрд░реАрди рдкрд╛рд╕ рдореЗрдВ рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдЬреЛ рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рддрд╛ рд╣реИред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдзреЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ рдХрд╣реЗрдВ, GBuffer рдЬреНрдпрд╛рдорд┐рддрд┐ рдЧреБрдгреЛрдВ рдХреЗ рд╕рд╛рде рдмрдирд╛рд╡рдЯ рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рд╕рд╣реА рд╕рдВрд░рдЪрдирд╛ рдмрдирд╛рдирд╛ рдмрд╣реБрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬреАрд╡рди рд╕реЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рдЖрдк </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crysis 3 рдкреНрд░рддрд┐рдкрд╛рджрди рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдХрд╛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдзреНрдпрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкрд░рд┐рдЪрдп рдХреЗ рдмрд╛рдж, рдЖрдЗрдП рдж рд╡рд┐рдЪрд░ 3: рдмреНрд▓рдб рдПрдВрдб рд╡рд╛рдЗрди рд╕реЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдлреНрд░реЗрдо рджреЗрдЦреЗрдВ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c3/6f5/537/2c36f5537e82217c31d0f5f682b17b6c.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toussent</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Basic </font><i><font style="vertical-align: inherit;">GBuffer рдХреЗ рдХрдИ рд╣реЛрдЯрд▓реЛрдВ рдореЗрдВ</font></i><font style="vertical-align: inherit;"> рд╕реЗ рдПрдХ рдореЗрдВ DXGI_FORMAT_R8G8B8A8_UNORM рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рддреАрди рдкреВрд░реНрдг-рд╕реНрдХреНрд░реАрди рд░реЗрдВрдбрд░ рд▓рдХреНрд╖реНрдп рдФрд░ DXGI -FORMAT_D24_UNORM_S8_UINT рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдЧрд╣рд░рд╛рдИ рдмрдлрд░ + рд╕реНрдЯреИрдВрд╕рд┐рд▓ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдЙрдирдХреЗ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рд╣реИрдВ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/309/dec/857/309dec857a7839f41984b44ff82516ab.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЗрдВрдбрд░ рдЯрд╛рд░рдЧреЗрдЯ 0 - рдЖрд░рдЬреАрдмреА рдЪреИрдирд▓, рд╕рддрд╣ рдХрд╛ рд░рдВрдЧ</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/16c/44c/b90/16c44cb90b067cb420d921e101319bb0.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЗрдВрдбрд░ рдЯрд╛рд░рдЧреЗрдЯ 0 - рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ред </font><font style="vertical-align: inherit;">рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ, рдореБрдЭреЗ рдирд╣реАрдВ рдкрддрд╛ рдХрд┐ рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдХреНрдпрд╛ рд╣реИред</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de9/f1a/cf3/de9f1acf36c9f9e18ec6f4a9708ede11.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЗрдВрдбрд░ рдЯрд╛рд░рдЧреЗрдЯ 1 - RGB рдЪреИрдирд▓ред </font><font style="vertical-align: inherit;">рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рд╡реИрдХреНрдЯрд░ [0-1] рдпрд╣рд╛рдВ рджрд░реНрдЬ рдХрд┐рдП рдЧрдП рд╣реИрдВред</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a5/a60/1e8/0a5a601e893d88a619b94f1ed7d21ae2.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЗрдВрдбрд░ рдЯрд╛рд░рдЧреЗрдЯ 1 - рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ред </font><font style="vertical-align: inherit;">рдкрд░рд╛рд╡рд░реНрддрди рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ!</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7fa/8f5/d61/7fa8f5d61cfc903b764eec1e9b46c431.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЗрдВрдбрд░ рдЯрд╛рд░рдЧреЗрдЯ 2 - RGB рдЪреИрдирд▓ред </font><font style="vertical-align: inherit;">рд▓рдЧ рд░рд╣рд╛ рд╣реИ рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рдХрд▓рд░! </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рджреГрд╢реНрдп рдореЗрдВ, рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ рдХрд╛рд▓рд╛ рд╣реИ (рд▓реЗрдХрд┐рди рдмрд╛рдж рдореЗрдВ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e7e/27d/dab/e7e27ddab2102174b3f63bb9037e28a0.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрдлрд╝рд░ рдХреА рдЧрд╣рд░рд╛рдИред </font><font style="vertical-align: inherit;">рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЙрд▓реНрдЯреЗ рдЧрд╣рд░рд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣рд╛рдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4e/77d/daa/e4e77ddaa01705381f956410f546fdf4.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдЯреИрдВрд╕рд┐рд▓ рдмрдлрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рдХрд╛рд░ рдХреЗ рдкрд┐рдХреНрд╕реЗрд▓ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рддреНрд╡рдЪрд╛, рд╡рдирд╕реНрдкрддрд┐, рдЖрджрд┐)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрд╣ рдкреВрд░рд╛ рдЬреАрдмреАрдлрд╛рдпрд░ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд▓рд╛рдЗрдЯрд┐рдВрдЧ рдкрд╛рд╕ рднреА рдкреНрд░рдХрд╛рд╢ рдЬрд╛рдВрдЪ рдФрд░ рдЕрдиреНрдп рдмрдлрд╝рд░реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВ рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдЙрдирдХреА рдЪрд░реНрдЪрд╛ рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреЛрд╕реНрдЯ рдХреЗ "рдореБрдЦреНрдп" рднрд╛рдЧ рдкрд░ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдореИрдВ рд╕рд╛рдорд╛рдиреНрдп рдЕрд╡рд▓реЛрдХрди рджреВрдВрдЧрд╛:</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рдорд╛рдиреНрдп рдЕрд╡рд▓реЛрдХрди </font></font></h3><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) рдХреЗрд╡рд▓ рдмрдлрд░ рдХреЛ рд╕рд╛рдл рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЧрд╣рд░рд╛рдИ / рд╕реНрдЯреИрдВрд╕рд┐рд▓ рдмрдлрд░ рд╣реИред</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрджрд┐ рдЖрдк рдПрдХ рдЕрдЪреНрдЫреЗ рдлреНрд░реЗрдо рдПрдирд╛рд▓рд╛рдЗрдЬрд╝рд░ рдореЗрдВ рдЙрдкрд░реНрдпреБрдХреНрдд рдмрдирд╛рд╡рдЯ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдереЛрдбрд╝рд╛ рдЖрд╢реНрдЪрд░реНрдп рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЧрд╣рд░рд╛рдИ / рд╕реНрдЯреИрдВрд╕рд┐рд▓ рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде "рдХреНрд▓рд┐рдпрд░" рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, RenderTarget1 рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ (рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ "рд╕рдмрд╕реЗ рджреВрд░ рдХреЗ рд╡рд┐рдорд╛рди рдкрд░ рдзреБрдВрдзрд▓реЗ"):</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22a/16a/3a7/22a16a3a7df971c2d1609f15e254cd06.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рд╕рд░рд▓ рдФрд░ рд╕реНрдорд╛рд░реНрдЯ рдЕрдиреБрдХреВрд▓рди рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рдмрдХ: </font><font style="vertical-align: inherit;">рдЖрдкрдХреЛ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClearRenderTargetView</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЙрд▓ рдкрд░ </font><font style="vertical-align: inherit;">рд╕рдВрд╕рд╛рдзрди рдЦрд░реНрдЪ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдиреЗ рдкрд░ рд╣реА рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) рдЙрд▓рдЯрд╛ рдЧрд╣рд░рд╛рдИ - рдпрд╣ рд╢рд╛рдВрдд рд╣реИ</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдИ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдЦ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рд╕реЗ рд╣реА </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд┐рдЦрд╛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪрд▓ рдмрд┐рдиреНрджреБ рдХреЗ рд╕рд╛рде рдЧрд╣рд░рд╛рдИ рдмрдлрд░ рдХреА рд╕рдЯреАрдХрддрд╛ рдХреЗ рдмрд╛рд░реЗред рд╡рд┐рдЪрд░ 3 рдЙрд▓рдЯ-рдЬреЗрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рд▓рдВрдмреА рдЦреБрд▓реА рджреВрд░реА рдХреЗ рд╕рд╛рде рдЗрд╕ рддрд░рд╣ рдХреЗ рдЦреБрд▓реЗ рд╡рд┐рд╢реНрд╡ рдЦреЗрд▓ рдХреЗ рд▓рд┐рдП рдпрд╣ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд╡рд┐рдХрд▓реНрдк рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд╛рдпрд░реЗрдХреНрдЯрдПрдХреНрд╕ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реЛрдЧрд╛: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдП) рд╣рдо "0" рд▓рд┐рдЦрдХрд░ рдЧрд╣рд░рд╛рдИ рдмрдлрд░ рдХреЛ рд╕рд╛рдл рдХрд░рддреЗ рд╣реИрдВ, рди рдХрд┐ "1"ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рд░рдВрдкрд░рд┐рдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдореЗрдВ, рдЧрд╣рд░рд╛рдИ рдмрдлрд░ рдХреЛ рд╕рд╛рдл рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП "1" рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдЧрд╣рд░рд╛рдИ рд╕реЗ рдлрд╝реНрд▓рд┐рдк рдХреЗ рдмрд╛рдж, рдирдпрд╛ "рджреВрд░" рдорд╛рди 0 рд╣реЛ рдЧрдпрд╛, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рд╕рдм рдХреБрдЫ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦ) рдкреНрд░реЛрдЬреЗрдХреНрд╢рди рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╕рдордп рдирд┐рдХрдЯ рдФрд░ рджреВрд░ рдХреА рд╕реАрдорд╛рдУрдВ рдХреА рдЕрджрд▓рд╛-рдмрджрд▓реА рдХрд░реЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реА) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдУрдкрди </font><font style="vertical-align: inherit;">рдЪреЗрдХ рдХреЛ "рдХрдо" рд╕реЗ "рдЕрдзрд┐рдХ" рдореЗрдВ рдмрджрд▓реЗрдВред </font><font style="vertical-align: inherit;">рдУрдкрдирдЬреАрдПрд▓ рдХреЗ рд▓рд┐рдП, рдереЛрдбрд╝рд╛ рдФрд░ рдХрд╛рдо рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдКрдкрд░ рд╡рд░реНрдгрд┐рдд рд▓реЗрдЦ рджреЗрдЦреЗрдВ), рд▓реЗрдХрд┐рди рдпрд╣ рдЗрд╕рдХреЗ рд▓рд╛рдпрдХ рд╣реИред </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) рд╣рдо рджреБрдирд┐рдпрд╛ рдореЗрдВ рдЕрдкрдирд╛ рд╕реНрдерд╛рди рдирд╣реАрдВ рд░рдЦрддреЗ рд╣реИрдВред</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рд╛рдБ, рд╕рдм рдХреБрдЫ рдЗрддрдирд╛ рд╕рд░рд▓ рд╣реИред </font><font style="vertical-align: inherit;">рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреЗ рдорд╛рд░реНрдЧ рдореЗрдВ, рд╣рдо рдЧрд╣рд░рд╛рдИ рд╕реЗ рджреБрдирд┐рдпрд╛ рдореЗрдВ рдПрдХ рд╕реНрдерд┐рддрд┐ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рддреЗ рд╣реИрдВред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд┐рдХреНрд╕реЗрд▓ shader </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рднрд╛рдЧ рдореЗрдВ, рдореИрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░ рджрд┐рдЦрд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ рдЬреЛ GBuffer рдХреЛ рд╕рддрд╣ рдбреЗрдЯрд╛ рдХреА рдЖрдкреВрд░реНрддрд┐ рдХрд░рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреЛ рдЕрдм рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд░рдВрдЧ, рдорд╛рдирджрдВрдбреЛрдВ рдФрд░ рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рдХреЛ рдХреИрд╕реЗ рд╕реНрдЯреЛрд░ рдХрд┐рдпрд╛ рдЬрд╛рдПред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рд╕рдм рдХреБрдЫ рдЙрддрдирд╛ рд╕рд░рд▓ рдирд╣реАрдВ рд╣реИ рдЬрд┐рддрдирд╛ рдЖрдк рд╕реЛрдЪ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░ рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЗрд╕рдореЗрдВ рдХрдИ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╡реЗ рдЙрдирдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдП рдЧрдП рдмрдирд╛рд╡рдЯ рдХреА рд╕рдВрдЦреНрдпрд╛ рдФрд░ рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рднрд┐рдиреНрди рд╣реЛрддреЗ рд╣реИрдВ (рд╢рд╛рдпрдж рд╕рд╛рдордЧреНрд░реА рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╕реЗ)ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдЗрд╕ рд╕реБрдВрджрд░ рдмреИрд░рд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/262/635/aa0/262635aa0a42dde5353586c867bc91d1.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рд╡реАрд░ рдкреНрд░рддрд┐ рдмреИрд░рд▓! </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреГрдкрдпрд╛ рдмрдирд╛рд╡рдЯ рдХрд╛ рд╕реНрд╡рд╛рдЧрдд рдХрд░реЗрдВ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e4/fde/9bb/9e4fde9bbe2ebcc3c1088eff5e3ea40d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрд▓реНрдмреЗрдбреЛ рд╣реИ, рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢рд╛ рд╣реИ, рдФрд░ рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рд░рдВрдЧ рд╣реИред рд╕реБрдВрджрд░ рдорд╛рдирдХ рдорд╛рдорд▓рд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЬреНрдпрд╛рдорд┐рддрд┐ рдЗрдирдкреБрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рд╢рдмреНрдж: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЛ рд╕реНрдерд┐рддрд┐, рдЯреЗрдХреНрд╕рдХреЛрд░реНрдбреНрд╕, рд╕рд╛рдорд╛рдиреНрдп рдФрд░ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рдмрдлрд╝рд░реНрд╕ рдХреЗ рд╕рд╛рде рдкреНрд░реЗрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрдЯреЗрдХреНрд╕ рд╢реЗрдбрд░ </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдо рд╕реЗ рдХрдо</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЯреЗрдХреНрд╕рдХреЛрд░реНрдбреНрд╕, рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ / рд╕рд╛рдорд╛рдиреНрдп / рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╡реИрдХреНрдЯрд░ рдХреЛ рджреЛ рдмрд┐рдВрджреБрдУрдВ </font><u><font style="vertical-align: inherit;">рдкрд░</font></u><font style="vertical-align: inherit;"> рдЖрдЙрдЯрдкреБрдЯ рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдЬреЛ рдкрд╣рд▓реЗ рд╡рд┐рд╢реНрд╡ рдореИрдЯреНрд░рд┐рдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╕рд╛рдордЧреНрд░рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рджреЛ рдлреИрд▓рдиреЗ рд╡рд╛рд▓реЗ рдирдХреНрд╢реЗ рдпрд╛ рджреЛ рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢реЗ рдХреЗ рд╕рд╛рде), рд╡рд░реНрдЯреЗрдХреНрд╕ рд╢реЗрдбрд░ рдЕрдиреНрдп рдбреЗрдЯрд╛ рдХреЛ рдЖрдЙрдЯрдкреБрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВ рдпрд╣рд╛рдВ рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реЗрдВрдмрд▓рд░ рдХреЛрдб рдореЗрдВ рдкрд┐рдХреНрд╕реЗрд▓ shader: рдПрдХ </font><font style="vertical-align: inherit;">shader рдореЗрдВ рдХрдИ рдЪрд░рдг рд╣реЛрддреЗ рд╣реИрдВред рдореИрдВ рдЗрд╕ shader рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдореБрдЦ рднрд╛рдЧ рдХрд╛ рдЕрд▓рдЧ рд╕реЗ рд╡рд░реНрдгрди рдХрд░реВрдБрдЧрд╛ред</font></font><br><br> <code>ps_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb4[3], immediateIndexed <br> dcl_sampler s0, mode_default <br> dcl_sampler s13, mode_default <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_resource_texture2d (float,float,float,float) t1 <br> dcl_resource_texture2d (float,float,float,float) t2 <br> dcl_resource_texture2d (float,float,float,float) t13 <br> dcl_input_ps linear v0.zw <br> dcl_input_ps linear v1.xyzw <br> dcl_input_ps linear v2.xyz <br> dcl_input_ps linear v3.xyz <br> dcl_input_ps_sgv v4.x, isfrontface <br> dcl_output o0.xyzw <br> dcl_output o1.xyzw <br> dcl_output o2.xyzw <br> dcl_temps 3 <br> 0: sample_indexable(texture2d)(float,float,float,float) r0.xyzw, v1.xyxx, t1.xyzw, s0 <br> 1: sample_indexable(texture2d)(float,float,float,float) r1.xyz, v1.xyxx, t0.xyzw, s0 <br> 2: add r1.w, r1.y, r1.x <br> 3: add r1.w, r1.z, r1.w <br> 4: mul r2.x, r1.w, l(0.333300) <br> 5: add r2.y, l(-1.000000), cb4[1].x <br> 6: mul r2.y, r2.y, l(0.500000) <br> 7: mov_sat r2.z, r2.y <br> 8: mad r1.w, r1.w, l(-0.666600), l(1.000000) <br> 9: mad r1.w, r2.z, r1.w, r2.x <br> 10: mul r2.xzw, r1.xxyz, cb4[0].xxyz <br> 11: mul_sat r2.xzw, r2.xxzw, l(1.500000, 0.000000, 1.500000, 1.500000) <br> 12: mul_sat r1.w, abs(r2.y), r1.w <br> 13: add r2.xyz, -r1.xyzx, r2.xzwx <br> 14: mad r1.xyz, r1.wwww, r2.xyzx, r1.xyzx <br> 15: max r1.w, r1.z, r1.y <br> 16: max r1.w, r1.w, r1.x <br> 17: lt r1.w, l(0.220000), r1.w <br> 18: movc r1.w, r1.w, l(-0.300000), l(-0.150000) <br> 19: mad r1.w, v0.z, r1.w, l(1.000000) <br> 20: mul o0.xyz, r1.wwww, r1.xyzx <br> 21: add r0.xyz, r0.xyzx, l(-0.500000, -0.500000, -0.500000, 0.000000) <br> 22: add r0.xyz, r0.xyzx, r0.xyzx <br> 23: mov r1.x, v0.w <br> 24: mov r1.yz, v1.zzwz <br> 25: mul r1.xyz, r0.yyyy, r1.xyzx <br> 26: mad r1.xyz, v3.xyzx, r0.xxxx, r1.xyzx <br> 27: mad r0.xyz, v2.xyzx, r0.zzzz, r1.xyzx <br> 28: uge r1.x, l(0), v4.x <br> 29: if_nz r1.x <br> 30: dp3 r1.x, v2.xyzx, r0.xyzx <br> 31: mul r1.xyz, r1.xxxx, v2.xyzx <br> 32: mad r0.xyz, -r1.xyzx, l(2.000000, 2.000000, 2.000000, 0.000000), r0.xyzx <br> 33: endif <br> 34: sample_indexable(texture2d)(float,float,float,float) r1.xyz, v1.xyxx, t2.xyzw, s0 <br> 35: max r1.w, r1.z, r1.y <br> 36: max r1.w, r1.w, r1.x <br> 37: lt r1.w, l(0.200000), r1.w <br> 38: movc r2.xyz, r1.wwww, r1.xyzx, l(0.120000, 0.120000, 0.120000, 0.000000) <br> 39: add r2.xyz, -r1.xyzx, r2.xyzx <br> 40: mad o2.xyz, v0.zzzz, r2.xyzx, r1.xyzx <br> 41: lt r1.x, r0.w, l(0.330000) <br> 42: mul r1.y, r0.w, l(0.950000) <br> 43: movc r1.x, r1.x, r1.y, l(0.330000) <br> 44: add r1.x, -r0.w, r1.x <br> 45: mad o1.w, v0.z, r1.x, r0.w <br> 46: dp3 r0.w, r0.xyzx, r0.xyzx <br> 47: rsq r0.w, r0.w <br> 48: mul r0.xyz, r0.wwww, r0.xyzx <br> 49: max r0.w, abs(r0.y), abs(r0.x) <br> 50: max r0.w, r0.w, abs(r0.z) <br> 51: lt r1.xy, abs(r0.zyzz), r0.wwww <br> 52: movc r1.yz, r1.yyyy, abs(r0.zzyz), abs(r0.zzxz) <br> 53: movc r1.xy, r1.xxxx, r1.yzyy, abs(r0.yxyy) <br> 54: lt r1.z, r1.y, r1.x <br> 55: movc r1.xy, r1.zzzz, r1.xyxx, r1.yxyy <br> 56: div r1.z, r1.y, r1.x <br> 57: div r0.xyz, r0.xyzx, r0.wwww <br> 58: sample_l(texture2d)(float,float,float,float) r0.w, r1.xzxx, t13.yzwx, s13, l(0) <br> 59: mul r0.xyz, r0.wwww, r0.xyzx <br> 60: mad o1.xyz, r0.xyzx, l(0.500000, 0.500000, 0.500000, 0.000000), l(0.500000, 0.500000, 0.500000, 0.000000) <br> 61: mov o0.w, cb4[2].x <br> 62: mov o2.w, l(0) <br> 63: ret</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓реЗрдХрд┐рди рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣ - рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╕реЗ рдореВрд▓реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e94/24c/abb/e9424cabbd31630a47b7489e0e32c6af.jpg"></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> albedo </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЬрдЯрд┐рд▓ рдЪреАрдЬреЛрдВ рд╕реЗ рд╢реБрд░реБрдЖрдд рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рд┐рд░реНрдл </font></font><strike><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"OutputColor.rgb = Texture.Sample (uv) .rgb" рдирд╣реАрдВ</font></font></strike> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реИ RGB рд░рдВрдЧ рдмрдирд╛рд╡рдЯ (рдкрдВрдХреНрддрд┐ 1) рдХреЗ рдирдореВрдиреЗ рдХреЗ рдмрд╛рдж, рдЕрдЧрд▓реА 14 рдкрдВрдХреНрддрд┐рдпрд╛рдБ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдореИрдВ "рд╕рдВрддреГрдкреНрддрд┐ рдХрдореА рдмрдлрд░" рдХрд╣рддрд╛ рд╣реВрдВред </font><font style="vertical-align: inherit;">рдореБрдЭреЗ рдЖрдкрдХреЛ рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдХреЛрдб рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ: </font><font style="vertical-align: inherit;">рдЕрдзрд┐рдХрд╛рдВрд╢ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдХреЛрдб рдмрдирд╛рд╡рдЯ рдХреЗ рдореВрд▓ рд░рдВрдЧ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХреБрдЫ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЗрд╕реА "рднреМрддрд┐рдХ cbuffer" рдореВрд▓реНрдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">cb4_v1.x рдХрд╛ рдорд╛рди 1.0 рд╣реИ, рдЬреЛ 0.0 рдХрд╛ рдорд╛рд╕реНрдХ рджреЗрддрд╛ рд╣реИ рдФрд░ </font><i><font style="vertical-align: inherit;">рд▓реЗрд░рдк</font></i><font style="vertical-align: inherit;"> рдирд┐рд░реНрджреЗрд╢ рд╕реЗ рдЗрдирдкреБрдЯ рд░рдВрдЧ рджреЗрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐, рдХреБрдЫ рдЕрдкрд╡рд╛рдж рд╣реИрдВред </font><font style="vertical-align: inherit;">рдореБрдЭреЗ </font><i><font style="vertical-align: inherit;">рдорд┐рд▓рд╛</font></i><font style="vertical-align: inherit;"> рд╕рдмрд╕реЗ рдмрдбрд╝рд╛ </font><i><font style="vertical-align: inherit;">desaturationFactor</font></i><font style="vertical-align: inherit;"> 4.0 рд╣реИ (рдпрд╣ 1.0 рд╕реЗ рдХрдо рдХрднреА рдирд╣реАрдВ рд╣реИ), рдФрд░ </font><i><font style="vertical-align: inherit;">desaturatedColor</font></i></font><br><br> <code>float3 albedoColorFilter( in float3 color, in float desaturationFactor, in float3 desaturationValue ) <br> { <br> float sumColorComponents = color.r + color.g + color.b; <br> <br> float averageColorComponentValue = 0.3333 * sumColorComponents; <br> float oneMinusAverageColorComponentValue = 1.0 - averageColorComponentValue; <br> <br> float factor = 0.5 * (desaturationFactor - 1.0); <br> <br> float avgColorComponent = lerp(averageColorComponentValue, oneMinusAverageColorComponentValue, saturate(factor)); <br> float3 desaturatedColor = saturate(color * desaturationValue * 1.5); <br> <br> float mask = saturate( avgColorComponent * abs(factor) ); <br> <br> float3 finalColor = lerp( color, desaturatedColor, mask ); <br> return finalColor; <br> }</code> <br> <br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдордЧреНрд░реА рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдХреБрдЫ рдРрд╕рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (0.2, 0.3, 0.4); </font><font style="vertical-align: inherit;">рдХреЛрдИ рд╕рдЦреНрдд рдирд┐рдпрдо рдирд╣реАрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдореИрдВ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ DX11 рдврд╛рдВрдЪреЗ рдореЗрдВ рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рд░реЛрдз рдирд╣реАрдВ рдХрд░ рд╕рдХрд╛, рдФрд░ рдпрд╣рд╛рдВ рдРрд╕реЗ рдкрд░рд┐рдгрд╛рдо рд╣реИрдВ рдЬрд╣рд╛рдВ рд╕рднреА </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaturatedColor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдорд╛рди </font><font style="vertical-align: inherit;">рдлреНрд▓реЛрдЯ 3 (0.25, 0.3, 0.45) рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИрдВ</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/12f/184/2d9/12f1842d9d272fc057f35bc73439c4c1.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaturationFactor = 1.0 (рдХреЛрдИ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ рд╣реИ)</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/03c/ead/3a3/03cead3a3d5a713e051e7d863d99ecb0.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaturationFactor = 2.0</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/caf/c81/992/cafc81992ebb70914c1e9d6605b8ba17.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaturationFactor = 3.0</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f37/193/7fb/f371937fb39f94a887410a951f9eb628.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desaturationFactor = 4.0</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореБрдЭреЗ рдпрдХреАрди рд╣реИ рдХрд┐ рдпрд╣ рдХреЗрд╡рд▓ рднреМрддрд┐рдХ рдорд╛рдкрджрдВрдбреЛрдВ рдХрд╛ рдПрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рд╣реИ, рд▓реЗрдХрд┐рди рдПрд▓реНрдмрд┐рдбреЛ рднрд╛рдЧ рдХреЗ рдЕрдВрдд рдореЗрдВ рдкреНрд░рджрд░реНрд╢рди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд╛рдЗрдиреЗрдВ 15-20 рдЕрдВрддрд┐рдо рд╕реНрдкрд░реНрд╢реЛрдВ рдХреЛ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рддреА рд╣реИрдВ </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">v0.z рд╢реАрд░реНрд╖ рдЫрд╛рдпрд╛рдХрд░реНрддрд╛ рд╕реЗ рдЖрдЙрдЯрдкреБрдЯ рд╣реИ, рдФрд░ рд╡реЗ рд╢реВрдиреНрдп рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдордд рднреВрд▓рдирд╛, рдХреНрдпреЛрдВрдХрд┐ v0.z рдмрд╛рдж рдореЗрдВ рдХрдИ рдмрд╛рд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЧреБрдгрд╛рдВрдХ рд╣реИ, рдФрд░ рдкреВрд░рд╛ рдХреЛрдб рдереЛрдбрд╝рд╛ рдХрдорд┐рдВрдЧ рдЕрд▓реНрдмреЗрдбреЛ рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЪреВрдВрдХрд┐ v0.z 0 рд╣реИ, рд░рдВрдЧ рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд░рд╣рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">HLSL: RT0.a рдХреЗ </font><font style="vertical-align: inherit;">рдмрд╛рд░реЗ рдореЗрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рд╕рд╛рдордЧреНрд░реА рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╕реЗ рд▓реА рдЧрдИ рд╣реИ, рд▓реЗрдХрд┐рди рдЪреВрдВрдХрд┐ shader рдореЗрдВ рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреА рдХреЛрдИ рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдХрд╣рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ рдХрд┐ рдпрд╣ рдХреНрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╢рд╛рдпрдж рдкрд╛рд░рднрд╛рд╕реА? </font><font style="vertical-align: inherit;">рд╣рдо рдкрд╣рд▓реЗ рдкреНрд░рд╕реНрддреБрдд рд▓рдХреНрд╖реНрдп рдХреЗ рд╕рд╛рде рдХрд░ рд░рд╣реЗ рд╣реИрдВ!</font></font><br><br> <code>15: max r1.w, r1.z, r1.y <br> 16: max r1.w, r1.w, r1.x <br> 17: lt r1.w, l(0.220000), r1.w <br> 18: movc r1.w, r1.w, l(-0.300000), l(-0.150000) <br> 19: mad r1.w, v0.z, r1.w, l(1.000000) <br> 20: mul o0.xyz, r1.wwww, r1.xyzx</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>/* ALBEDO */ <br> //     (?) <br> float3 albedoColor = albedoColorFilter( colorTex, cb4_v1.x, cb4_v0.rgb ); <br> float albedoMaxComponent = getMaxComponent( albedoColor ); <br> <br> //   ,   <br> //       "paramZ"   0 <br> float paramZ = Input.out0.z; // ,    0 <br> <br> // ,  0.70  0.85      <br> //       lerp,     . <br> float param = (albedoMaxComponent &gt; 0.22) ? 0.70 : 0.85; <br> float mulParam = lerp(1, param, paramZ); <br> <br> //  <br> pout.RT0.rgb = albedoColor * mulParam; <br> pout.RT0.a = cb4_v2.x;</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> normals </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдирдЪрд┐рддреНрд░ рдХреЛ рдЕрдирдкреИрдХ рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░реЗрдВ, рдФрд░ рдлрд┐рд░, рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рд╣рдо рдорд╛рдирджрдВрдбреЛрдВ рдХреЛ рдмрд╛рдВрдзреЗрдВрдЧреЗ: </font><font style="vertical-align: inherit;">рдЕрднреА рддрдХ, рдЖрд╢реНрдЪрд░реНрдп рдХреА рдмрд╛рдд рдирд╣реАрдВ рд╣реИред </font><i><font style="vertical-align: inherit;">28-33 рдХреА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦреЗрдВ:</font></i><font style="vertical-align: inherit;"> рд╣рдо рдореЛрдЯреЗ рддреМрд░ рдкрд░ рдЙрдиреНрд╣реЗрдВ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ: </font><font style="vertical-align: inherit;">рдпрдХреАрди рдирд╣реАрдВ рд╣реЛрддрд╛ рдХрд┐ рдпрд╣ рд▓рд┐рдЦрдирд╛ рд╕рд╣реА рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдЧрдгрд┐рддреАрдп рдСрдкрд░реЗрд╢рди рдХреНрдпрд╛ рд╣реИ, рддреЛ рдореБрдЭреЗ рдмрддрд╛рдПрдВред </font><font style="vertical-align: inherit;">рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдкрд┐рдХреНрд╕реЗрд▓ shader SV_IsFrontFace рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред</font></font><br><br> <code>/*  */ <br> float3 sampledNormal = ((normalTex.xyz - 0.5) * 2); <br> <br> //     TBN <br> float3 Tangent = Input.TangentW.xyz; <br> float3 Normal = Input.NormalW.xyz; <br> float3 Bitangent; <br> Bitangent.x = Input.out0.w; <br> Bitangent.yz = Input.out1.zw; <br> <br> //      ;  ,  ,   normal-tbn <br> //      'mad'   'mov' <br> Bitangent = saturate(Bitangent); <br> <br> float3x3 TBN = float3x3(Tangent, Bitangent, Normal); <br> float3 normal = mul( sampledNormal, TBN );</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <i><font style="vertical-align: inherit;"></font></i> <br><br> <code>28: uge r1.x, l(0), v4.x <br> 29: if_nz r1.x <br> 30: dp3 r1.x, v2.xyzx, r0.xyzx <br> 31: mul r1.xyz, r1.xxxx, v2.xyzx <br> 32: mad r0.xyz, -r1.xyzx, l(2.000000, 2.000000, 2.000000, 0.000000), r0.xyzx <br> 33: endif</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>[branch] if (bIsFrontFace &lt;= 0) <br> { <br> float cosTheta = dot(Input.NormalW, normal); <br> float3 invNormal = cosTheta * Input.NormalW; <br> normal = normal - 2*invNormal; <br> }</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br>  рдпрд╣ рдХреНрдпрд╛ рд╣реИ<font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд▓реЗрдЦрди</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдорджрдж рдХреЗ рд▓рд┐рдП рдЖрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">(рдореИрдВ "msdn" рд▓рд┐рдЦрдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛, рд▓реЗрдХрд┐рди ...):</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рддреНрд░рд┐рдХреЛрдг рдХреИрдорд░реЗ рдХреЛ рджреЗрдЦ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рд▓рд╛рдЗрдиреЛрдВ рдФрд░ рдмрд┐рдВрджреБрдУрдВ рдХреЗ рд▓рд┐рдП, IsFrontFace рд╕рдЪ рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рдЕрдкрд╡рд╛рдж рддреНрд░рд┐рдХреЛрдг (рд╡рд╛рдпрд░рдлреНрд░реЗрдо рдореЛрдб) рд╕реЗ рдЦреАрдВрдЪреА рдЧрдИ рд░реЗрдЦрд╛рдПрдВ рд╣реИрдВ, рдЬреЛ рдареЛрд╕ рдореЛрдб рдореЗрдВ рдПрдХ рддреНрд░рд┐рднреБрдЬ рдХреЛ рд░реЗрдЦрд╛рдкреБрдВрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП IsFrontFace рдХреЛ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рд╕реЗрдЯ рдХрд░рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рд▓рд┐рдЦрдирд╛ рдПрдХ рдЬреНрдпрд╛рдорд┐рддрд┐ shader рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕реЗ рдкрд┐рдХреНрд╕реЗрд▓ shader рджреНрд╡рд╛рд░рд╛ рдкрдврд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдВ рдЗрд╕реЗ рдЕрдкрдиреЗ рджрдо рдкрд░ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдФрд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдкреНрд░рднрд╛рд╡ рдХреЗрд╡рд▓ рд╡рд╛рдпрд░рдлреНрд░реЗрдо рдореЛрдб рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИред </font><font style="vertical-align: inherit;">рдореЗрд░рд╛ рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ рд╡рд╛рдпрд░рдлрд╝реНрд░реЗрдо рдореЛрдб рдореЗрдВ рдорд╛рдирджрдВрдбреЛрдВ рдХреА рд╕рд╣реА рдЧрдгрдирд╛ (рдФрд░ рдЗрд╕рд▓рд┐рдП рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛) рдХреЗ рд▓рд┐рдП рдЗрд╕ рдХреЛрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдПрдХ рддреБрд▓рдирд╛ рд╣реИ: рджреЛрдиреЛрдВ рджреГрд╢реНрдп рдХреЗ рдлреНрд░реЗрдо рдХреЗ рд░рдВрдЧ рдЗрд╕ рдЪрд╛рд▓ рдХреЗ рд╕рд╛рде / рдмрдВрдж, рд╕рд╛рде рд╣реА рд╕рд╛рде gbuffer рдХреА рдмрдирд╛рд╡рдЯ [0-1] рдорд╛рдирджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рдЪрд╛рд▓ / рдмрдВрдж:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/598/46b/81b/59846b81b8b9ed57f0441f29e22e6656.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд┐рдирд╛ рдЫрд▓ рдХреЗ рджреГрд╢реНрдп рдХрд╛ рд░рдВрдЧ</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/590/7e1/a97/5907e1a978e58b6fa362ef2e4b6187a8.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдЯрдВрдЯ рдХреЗ рд╕рд╛рде рд░рдВрдЧ рджреГрд╢реНрдп</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/745/09a/c0e/74509ac0e56fa639ec4ae2d70a39be44.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп [0-1] рдХреЛрдИ рдЪрд╛рд▓ рдирд╣реАрдВ</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db8/2f8/622/db82f86223182135807d316fe479ff08.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЪрд╛рд▓ рдХреЗ рд╕рд╛рде рд╕рд╛рдорд╛рдиреНрдп [0-1]</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреНрдпрд╛ рдЖрдкрдиреЗ рджреЗрдЦрд╛ рд╣реИ рдХрд┐ GBuffer рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд░реЗрдВрдбрд░ рд▓рдХреНрд╖реНрдп R8G8B8A8_UNORM рдкреНрд░рд╛рд░реВрдк рд╣реИ? рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдкреНрд░рддрд┐ рдШрдЯрдХ 256 рд╕рдВрднрд╛рд╡рд┐рдд рдореВрд▓реНрдп рд╣реИрдВред рдХреНрдпрд╛ рдпрд╣ рдорд╛рдирджрдВрдбреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gbuffer рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдЙрдЪреНрдЪ рдЧреБрдгрд╡рддреНрддрд╛ рд╡рд╛рд▓реЗ рдорд╛рдирджрдВрдбреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдирд╛ рдПрдХ рдЬреНрдЮрд╛рдд рдореБрджреНрджрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕реМрднрд╛рдЧреНрдп </font><font style="vertical-align: inherit;">рд╕реЗ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рд╕реАрдЦрдиреЗ рдХреЗ</font></a><font style="vertical-align: inherit;"> рд▓рд┐рдП </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдИ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд▓рдЧ-рдЕрд▓рдЧ </font></font></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдордЧреНрд░рд┐рдпрд╛рдВ </font></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢рд╛рдпрдж рдЖрдк рдореЗрдВ рд╕реЗ рдХреБрдЫ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣рд╛рдВ рдХрд┐рд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдореБрдЭреЗ рдХрд╣рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЗ рдкреВрд░реЗ рдорд╛рд░реНрдЧ рдореЗрдВ рд╕реНрд▓реЙрдЯ 13 рд╕реЗ рдЬреБрдбрд╝реА рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдмрдирд╛рд╡рдЯ рд╣реИ ...:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab1/e4a/0bf/ab1e4a0bf128bfed8837d3cd081748f8.jpg"></div><br><br>  рд╣рд╛!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Witcher 3 рдПрдХ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЗрд╕реНрдЯ рдлрд┐рдЯ рдиреЙрд░реНрдореНрд╕</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рдореИрдВ рдЗрд╕реЗ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдирд╣реАрдВ рдмрддрд╛рдКрдВрдЧрд╛ (рдкреНрд░рд╕реНрддреБрддрд┐ рджреЗрдЦреЗрдВ)ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдХреНрд░рд╛рдпрдЯреЗрдХ рджреНрд╡рд╛рд░рд╛ 2009-2010 рдХреЗ рдЖрд╕рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рдЪреВрдВрдХрд┐ рдХреНрд░рд╛рдпреНрд╡реЗрдирдЗрди рдХрд╛ рдЦреБрд▓рд╛ рд╕реНрд░реЛрдд рд╣реИ, рдмреАрдПрдлрдПрди рднреА </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦреБрд▓рд╛ рд╕реНрд░реЛрдд рд╣реИ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BFN рдорд╛рдирджрдВрдбреЛрдВ рдХреА рдмрдирд╛рд╡рдЯ рдХреЛ "рджрд╛рдиреЗрджрд╛рд░" рд░реВрдк рджреЗрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреАрдПрдлрдПрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдорд╛рдирджрдВрдбреЛрдВ рдХреЛ рд╕реНрдХреЗрд▓ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЙрдиреНрд╣реЗрдВ рдЕрдВрддрд░рд╛рд▓ [-1; 1] рд╕реЗ [0, 1] рддрдХ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рддреЗ рд╣реИрдВред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓рд┐рдП рд▓рд╛рдЗрди 34 рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рдЯреЗрдХреНрд╕рдЪрд░ рдХрд╛ рдирдореВрдирд╛ </font><font style="vertical-align: inherit;">рд▓реЗрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдПрдХ "рдбрд┐рдорд┐рдВрдЧ" рдлрд┐рд▓реНрдЯрд░ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдо рдЕрд▓рдмреЗрдбреЛ рд╕реЗ рдЬрд╛рдирддреЗ рд╣реИрдВ: рд╣рдо </font><font style="vertical-align: inherit;">рдЕрдзрд┐рдХрддрдо рдХреЗ рд╕рд╛рде рдШрдЯрдХ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдореВрд▓реНрдп, рдФрд░ рдлрд┐рд░ "рдбрд╛рд░реНрдХ" рд░рдВрдЧ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдореВрд▓ рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рд░рдВрдЧ рдХреЗ рд╕рд╛рде рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рдХрд░реЗрдВ, рд╡рд░реНрдЯрд┐рдХрд▓ рд╢реЗрдбрд░ рд╕реЗ рдкреИрд░рд╛рдореАрдЯрд░ рд▓реЗ рд░рд╣рд╛ рд╣реИ ... рдЬреЛ 0 рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рд╣рдореЗрдВ рдмрдирд╛рд╡рдЯ рд╕реЗ рд░рдВрдЧ рдорд┐рд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">HLSL:</font></font><br><br> <code>34: sample_indexable(texture2d)(float,float,float,float) r1.xyz, v1.xyxx, t2.xyzw, s0 <br> 35: max r1.w, r1.z, r1.y <br> 36: max r1.w, r1.w, r1.x <br> 37: lt r1.w, l(0.200000), r1.w <br> 38: movc r2.xyz, r1.wwww, r1.xyzx, l(0.120000, 0.120000, 0.120000, 0.000000) <br> 39: add r2.xyz, -r1.xyzx, r2.xyzx <br> 40: mad o2.xyz, v0.zzzz, r2.xyzx, r1.xyzx</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>/* SPECULAR */ <br> float3 specularTex = texture2.Sample( samplerAnisoWrap, Texcoords ).rgb; <br> <br> //   ,    Albedo.  . ,    <br> // -        "". <br> //      paramZ   0,    <br> //  . <br> float specularMaxComponent = getMaxComponent( specularTex ); <br> float3 specB = (specularMaxComponent &gt; 0.2) ? specularTex : float3(0.12, 0.12, 0.12); <br> float3 finalSpec = lerp(specularTex, specB, paramZ); <br> pout.RT2.xyz = finalSpec;</code> <br> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреА рдХреНрд╖рдорддрд╛ рдХреЛ рджрд░реНрд╢рд╛рддреА рд╣реИ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореБрдЭреЗ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдирд╛рдо рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдореБрдЭреЗ рдирд╣реАрдВ рдкрддрд╛ рдХрд┐ рдпрд╣ рдкреНрд░рдХрд╛рд╢ рдХреЗ рдкрд╛рд░рд┐рдд рд╣реЛрдиреЗ рдХреЛ рдХреИрд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдЗрдирдкреБрдЯ рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢реЗ рдХреЗ рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рдбреЗрдЯрд╛ рд╣реИ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d2/9e5/bd1/5d29e5bd1cb4888593139c38630e3f8e.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ рдмрдирд╛рд╡рдЯ "рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢рд╛"ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб: </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдкреБрд░рд╛рдиреЗ рдорд┐рддреНрд░ рдХреЛ рдирдорд╕реНрддреЗ рдХрд╣реЗрдВ - v0.z! </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдЕрд░реНрде рдЕрд▓реНрдмреЗрдбреЛ рдФрд░ рд╕реНрдкреЗрдХреБрд▓рд░ рдХреЗ рд╕рдорд╛рди рд╣реИ:</font></font><br><br> <code>41: lt r1.x, r0.w, l(0.330000) <br> 42: mul r1.y, r0.w, l(0.950000) <br> 43: movc r1.x, r1.x, r1.y, l(0.330000) <br> 44: add r1.x, -r0.w, r1.x <br> 45: mad o1.w, v0.z, r1.x, r0.w</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>/* REFLECTIVITY */ <br> float reflectivity = normalTex.a; <br> float reflectivity2 = (reflectivity &lt; 0.33) ? (reflectivity * 0.95) : 0.33; <br> <br> float finalReflectivity = lerp(reflectivity, reflectivity2, paramZ); <br> pout.RT1.a = finalReflectivity;</code> <br> <br>  рдмрд╣реБрдд рдмрдврд╝рд┐рдпрд╛!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреЗ рдкрд╣рд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд╛ рдЕрдВрдд рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдореВрд▓ (рджрд╛рдПрдВ) рдХреЗ рд╕рд╛рде рдореЗрд░реЗ shader (рдмрд╛рдПрдВ) рдХреА рддреБрд▓рдирд╛ рд╣реИ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c1/f18/47b/2c1f1847b5ceef3cd0e2f8dfba45d2a6.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпреЗ рдЕрдВрддрд░ рдЧрдгрдирд╛рдУрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣рд╛рдВ рдореЗрд░рд╛ рдХрд╛рдо рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░: рдЕрд▓рдмреЗрдбреЛ + рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдХрд▓реНрдк </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк рджрд┐рдЦрд╛рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛, рдЕрдм рдХреЗрд╡рд▓ рдПрд▓реНрдмреЗрдбреЛ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢реЗ рдХреЗ рд╕рд╛рде, рдмрд┐рдирд╛ рд╕реНрдкреЗрдХреБрд▓рд░ рдмрдирд╛рд╡рдЯ рдХреЗред рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдереЛрдбрд╝рд╛ рд▓рдВрдмрд╛ рд╣реИ: </font><font style="vertical-align: inherit;">рдЗрд╕ рдФрд░ рдкрд┐рдЫрд▓реЗ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рдмреАрдЪ рдХрд╛ рдЕрдВрддрд░ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╣реИ: </font><font style="vertical-align: inherit;">рдП) </font><b><font style="vertical-align: inherit;">рд▓рд╛рдЗрдиреЗрдВ 1, 19</font></b><font style="vertical-align: inherit;"> : рдЗрдВрдЯрд░рдкреЛрд▓реЗрд╢рди рдкреИрд░рд╛рдореАрдЯрд░ v0.z рдХреЛ cb4 [0] .x рд╕реЗ рдирд┐рд░рдВрддрд░ рдмрдлрд░ рд╕реЗ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЙрддреНрдкрд╛рдж рдХреЗрд╡рд▓ рд▓рд╛рдЗрди 19 рдкрд░ рдЗрдВрдЯрд░рдкреЛрд▓реЗрд╢рди рдЕрд▓реНрдмреЗрдбреЛ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЕрдиреНрдп рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд▓рд┐рдП, v0.z рдХреЗ "рд╕рд╛рдорд╛рдиреНрдп" рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">b) </font><b><font style="vertical-align: inherit;">рд▓рд╛рдЗрдиреЗрдВ 54-55</font></b><font style="vertical-align: inherit;"> : o2.w рдЕрдм рдЗрд╕ рд╢рд░реНрдд рдХреЗ рддрд╣рдд рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВ рдХрд┐ (cb4 [7] .x&gt; 0.0) </font><font style="vertical-align: inherit;">рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕ рдкреИрдЯрд░реНрди рдХреЛ "рдХреБрдЫ рдкреНрд░рдХрд╛рд░ рдХреА рддреБрд▓рдирд╛ - рдФрд░" рдЪрдордХ рд╣рд┐рд╕реНрдЯреЛрдЧреНрд░рд╛рдо рдХреА рдЧрдгрдирд╛ рд╕реЗ рдкрд╣рдЪрд╛рдирддреЗ рд╣реИрдВред рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: </font><font style="vertical-align: inherit;">рд╕реА) </font><b><font style="vertical-align: inherit;">рд▓рд╛рдЗрдиреЗрдВ 34-42</font></b><font style="vertical-align: inherit;"> : рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рдЧрдгрдирд╛ред</font></font><br><br> <code>ps_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb4[8], immediateIndexed <br> dcl_sampler s0, mode_default <br> dcl_sampler s13, mode_default <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_resource_texture2d (float,float,float,float) t1 <br> dcl_resource_texture2d (float,float,float,float) t13 <br> dcl_input_ps linear v0.zw <br> dcl_input_ps linear v1.xyzw <br> dcl_input_ps linear v2.xyz <br> dcl_input_ps linear v3.xyz <br> dcl_input_ps_sgv v4.x, isfrontface <br> dcl_output o0.xyzw <br> dcl_output o1.xyzw <br> dcl_output o2.xyzw <br> dcl_temps 4 <br> 0: mul r0.x, v0.z, cb4[0].x <br> 1: sample_indexable(texture2d)(float,float,float,float) r1.xyzw, v1.xyxx, t1.xyzw, s0 <br> 2: sample_indexable(texture2d)(float,float,float,float) r0.yzw, v1.xyxx, t0.wxyz, s0 <br> 3: add r2.x, r0.z, r0.y <br> 4: add r2.x, r0.w, r2.x <br> 5: add r2.z, l(-1.000000), cb4[2].x <br> 6: mul r2.yz, r2.xxzx, l(0.000000, 0.333300, 0.500000, 0.000000) <br> 7: mov_sat r2.w, r2.z <br> 8: mad r2.x, r2.x, l(-0.666600), l(1.000000) <br> 9: mad r2.x, r2.w, r2.x, r2.y <br> 10: mul r3.xyz, r0.yzwy, cb4[1].xyzx <br> 11: mul_sat r3.xyz, r3.xyzx, l(1.500000, 1.500000, 1.500000, 0.000000) <br> 12: mul_sat r2.x, abs(r2.z), r2.x <br> 13: add r2.yzw, -r0.yyzw, r3.xxyz <br> 14: mad r0.yzw, r2.xxxx, r2.yyzw, r0.yyzw <br> 15: max r2.x, r0.w, r0.z <br> 16: max r2.x, r0.y, r2.x <br> 17: lt r2.x, l(0.220000), r2.x <br> 18: movc r2.x, r2.x, l(-0.300000), l(-0.150000) <br> 19: mad r0.x, r0.x, r2.x, l(1.000000) <br> 20: mul o0.xyz, r0.xxxx, r0.yzwy <br> 21: add r0.xyz, r1.xyzx, l(-0.500000, -0.500000, -0.500000, 0.000000) <br> 22: add r0.xyz, r0.xyzx, r0.xyzx <br> 23: mov r1.x, v0.w <br> 24: mov r1.yz, v1.zzwz <br> 25: mul r1.xyz, r0.yyyy, r1.xyzx <br> 26: mad r0.xyw, v3.xyxz, r0.xxxx, r1.xyxz <br> 27: mad r0.xyz, v2.xyzx, r0.zzzz, r0.xywx <br> 28: uge r0.w, l(0), v4.x <br> 29: if_nz r0.w <br> 30: dp3 r0.w, v2.xyzx, r0.xyzx <br> 31: mul r1.xyz, r0.wwww, v2.xyzx <br> 32: mad r0.xyz, -r1.xyzx, l(2.000000, 2.000000, 2.000000, 0.000000), r0.xyzx <br> 33: endif <br> 34: add r0.w, -r1.w, l(1.000000) <br> 35: log r1.xyz, cb4[3].xyzx <br> 36: mul r1.xyz, r1.xyzx, l(2.200000, 2.200000, 2.200000, 0.000000) <br> 37: exp r1.xyz, r1.xyzx <br> 38: mad r0.w, r0.w, cb4[4].x, cb4[5].x <br> 39: mul_sat r1.xyz, r0.wwww, r1.xyzx <br> 40: log r1.xyz, r1.xyzx <br> 41: mul r1.xyz, r1.xyzx, l(0.454545, 0.454545, 0.454545, 0.000000) <br> 42: exp r1.xyz, r1.xyzx <br> 43: max r0.w, r1.z, r1.y <br> 44: max r0.w, r0.w, r1.x <br> 45: lt r0.w, l(0.200000), r0.w <br> 46: movc r2.xyz, r0.wwww, r1.xyzx, l(0.120000, 0.120000, 0.120000, 0.000000) <br> 47: add r2.xyz, -r1.xyzx, r2.xyzx <br> 48: mad o2.xyz, v0.zzzz, r2.xyzx, r1.xyzx <br> 49: lt r0.w, r1.w, l(0.330000) <br> 50: mul r1.x, r1.w, l(0.950000) <br> 51: movc r0.w, r0.w, r1.x, l(0.330000) <br> 52: add r0.w, -r1.w, r0.w <br> 53: mad o1.w, v0.z, r0.w, r1.w <br> 54: lt r0.w, l(0), cb4[7].x <br> 55: and o2.w, r0.w, l(0.064706) <br> 56: dp3 r0.w, r0.xyzx, r0.xyzx <br> 57: rsq r0.w, r0.w <br> 58: mul r0.xyz, r0.wwww, r0.xyzx <br> 59: max r0.w, abs(r0.y), abs(r0.x) <br> 60: max r0.w, r0.w, abs(r0.z) <br> 61: lt r1.xy, abs(r0.zyzz), r0.wwww <br> 62: movc r1.yz, r1.yyyy, abs(r0.zzyz), abs(r0.zzxz) <br> 63: movc r1.xy, r1.xxxx, r1.yzyy, abs(r0.yxyy) <br> 64: lt r1.z, r1.y, r1.x <br> 65: movc r1.xy, r1.zzzz, r1.xyxx, r1.yxyy <br> 66: div r1.z, r1.y, r1.x <br> 67: div r0.xyz, r0.xyzx, r0.wwww <br> 68: sample_l(texture2d)(float,float,float,float) r0.w, r1.xzxx, t13.yzwx, s13, l(0) <br> 69: mul r0.xyz, r0.wwww, r0.xyzx <br> 70: mad o1.xyz, r0.xyzx, l(0.500000, 0.500000, 0.500000, 0.000000), l(0.500000, 0.500000, 0.500000, 0.000000) <br> 71: mov o0.w, cb4[6].x <br> 72: ret</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>pout.RT2.w = (cb4_v7.x &gt; 0.0) ? (16.5/255.0) : 0.0;</code> <br> <br><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рдХреЛрдИ рднреА рд╕реНрдкреЗрдХреБрд▓рд░ рдЯреЗрдХреНрд╕рдЪрд░ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕ рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рджреЗрдЦреЗрдВ: </font><font style="vertical-align: inherit;">рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рдордиреЗ рдпрд╣рд╛рдБ (1 - рдкрд░рд┐рд▓рдХреНрд╖рд┐рдд рдХреНрд╖рдорддрд╛) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдореЗрдВ рдпрд╣ рд▓рд┐рдЦрдирд╛ рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИ: </font><font style="vertical-align: inherit;">рдореИрдВ рдпрд╣ рдЬреЛрдбрд╝рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ рдХрд┐ рдЗрд╕ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдирд┐рд░рдВрддрд░ рдмрдлрд░ рдереЛрдбрд╝рд╛ рдмрдбрд╝рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ, рдЗрди рдЕрддрд┐рд░рд┐рдХреНрдд рдорд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рд░рдВрдЧ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╢реЗрд╖ shader рдкрд┐рдЫрд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рдХреА рддрд░рд╣ рд╣реА рд╣реИред </font><font style="vertical-align: inherit;">WinMerge рдореЗрдВ 72 рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рдХреЛрдбрд╛рдВрддрд░рдХ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЬреНрдпрд╛рджрд╛ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдореЗрд░рд╛ рд╢рдмреНрдж рд▓реЗрдВ: рдореЗрд░рд╛ рдХреЛрдб рдореВрд▓ рдХреЗ рд╕рдорд╛рди рд╣реА рдирд┐рдХрд▓рд╛ред </font><font style="vertical-align: inherit;">рдпрд╛ рдЖрдк рдореЗрд░реЗ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">HLSLexplorer</font></a><font style="vertical-align: inherit;"> рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">рдФрд░ рдЕрдкрдиреЗ рд▓рд┐рдП рджреЗрдЦ </font><font style="vertical-align: inherit;">рд╕рдХрддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВ!</font></font><br><br> <code>34: add r0.w, -r1.w, l(1.000000) <br> 35: log r1.xyz, cb4[3].xyzx <br> 36: mul r1.xyz, r1.xyzx, l(2.200000, 2.200000, 2.200000, 0.000000) <br> 37: exp r1.xyz, r1.xyzx <br> 38: mad r0.w, r0.w, cb4[4].x, cb4[5].x <br> 39: mul_sat r1.xyz, r0.wwww, r1.xyzx <br> 40: log r1.xyz, r1.xyzx <br> 41: mul r1.xyz, r1.xyzx, l(0.454545, 0.454545, 0.454545, 0.000000) <br> 42: exp r1.xyz, r1.xyzx</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>float oneMinusReflectivity = 1.0 - normalTex.a; <br> float3 specularTex = pow(cb4_v3.rgb, 2.2); <br> oneMinusReflectivity = oneMinusReflectivity * cb4_v4.x + cb4_v5.x; <br> specularTex = saturate(specularTex * oneMinusReflectivity); <br> specularTex = pow(specularTex, 1.0/2.2); <br> <br> //     ... <br> float specularMaxComponent = getMaxComponent( specularTex ); <br> ...</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рджреЗрдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... рдФрд░ рдЕрдЧрд░ рдЖрдк рдЗрд╕реЗ рдпрд╣рд╛рдБ рдкрдврд╝рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рд╢рд╛рдпрдж рдереЛрдбрд╝рд╛ рдФрд░ рдЧрд╣рд░рд╛рдИ рдореЗрдВ рдЬрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬреАрд╡рди рдореЗрдВ рдЬреЛ рд╕рд░рд▓ рд▓рдЧрддрд╛ рд╣реИ рд╡рд╣ рдЕрдХреНрд╕рд░ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ gbuffer рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдЯреНрд░рд╛рдВрд╕рдлрд░ The Witcher 3 рдХреЛрдИ рдЕрдкрд╡рд╛рдж рдирд╣реАрдВ рдерд╛ред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЖрдкрдХреЛ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдб рдХреЗ рдХреЗрд╡рд▓ рд╕рдмрд╕реЗ рд╕рд░рд▓ рд╕рдВрд╕реНрдХрд░рдг рджрд┐рдЦрд╛рдП, рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдЕрд╡рд▓реЛрдХрди рднреА рджрд┐рдП рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╕реНрдердЧрд┐рдд рдЫрд╛рдпрд╛рдВрдХрди рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд░реЛрдЧреА рдХреЗ рд▓рд┐рдП, рдкрд╛рд╕реНрдЯрдмрд┐рди рдореЗрдВ рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдб рдХреЗ рд▓рд┐рдП рджреЛ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ: </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдХрд▓реНрдк 1 - рд╕реНрдкреЗрдХреБрд▓рд░ рдЯреЗрдХреНрд╕рдЪрд░ рдХреЗ рд╕рд╛рде </font></font></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдХрд▓реНрдк 2 - рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рдЯреЗрдХреНрд╕рдЪрд░ рдХреЗ рдмрд┐рдирд╛</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 10. рджреВрд░реА рдореЗрдВ рдмрд╛рд░рд┐рд╢ рдХреЗ рдкрд░реНрджреЗ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рднрд╛рдЧ рдореЗрдВ рд╣рдо рдПрдХ рдЕрджреНрднреБрдд рд╡рд╛рдпреБрдордВрдбрд▓реАрдп рдкреНрд░рднрд╛рд╡ рджреЗрдЦреЗрдВрдЧреЗ рдЬреЛ рдореБрдЭреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкрд╕рдВрдж рд╣реИ - </font><font style="vertical-align: inherit;">рдХреНрд╖рд┐рддрд┐рдЬ рдХреЗ рдкрд╛рд╕ </font><font style="vertical-align: inherit;">рджреВрд░ рдХреА </font><font style="vertical-align: inherit;">рдмрд╛рд░рд┐рд╢ / рд╣рд▓реНрдХреЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░реНрджреЗ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдЦреЗрд▓ рдореЗрдВ, рд╡реЗ рд╕реНрдХреАрд▓рд┐рдВрдЧ рджреНрд╡реАрдк рдкрд░ рдорд┐рд▓рдирд╛ рдЖрд╕рд╛рди рд╣реИред</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VXt4PEEqV2k" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ, рдореИрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕ рд╡рд╛рдпреБрдордВрдбрд▓реАрдп рдШрдЯрдирд╛ рдХреЛ рдкрд╕рдВрдж рдХрд░рддрд╛ рд╣реВрдВ рдФрд░ рдЙрддреНрд╕реБрдХ рдерд╛ рдХрд┐ рд╕реАрдбреА рдкреНрд░реЙрдЬреЗрдХреНрдЯ рд░реЗрдб рдЧреНрд░рд╛рдлрд┐рдХреНрд╕ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░реНрд╕ рдиреЗ рдЗрд╕реЗ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рд░рд┐рд╢ рдХреЗ рдкрд░реНрджреЗ рд▓рдЧрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдФрд░ рдмрд╛рдж рдореЗрдВ рдпрд╣рд╛рдВ рджреЛ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рджрд┐рдП рдЧрдП рд╣реИрдВ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9a/62a/eb6/a9a62aeb6050efd2404f9d352fc89d33.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рд░рд┐рд╢ рдХреЗ рдкрд░реНрджреЗ рддрдХ</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9aa/e43/fcf/9aae43fcf34413a4810778e101b8a209.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рд░рд┐рд╢ рдХреЗ рдкрд░реНрджреЗ рдХреЗ рдмрд╛рдж</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬреНрдпрд╛рдорд┐рддрд┐ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдЬреНрдпрд╛рдорд┐рддрд┐ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдПрдХ рдЫреЛрдЯреЗ рд╕рд┐рд▓реЗрдВрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рд╣реИ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc4/df3/add/fc4df3addf2524bc18f91c46a42fcd6a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдерд╛рдиреАрдп рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рдПрдХ рд╕рд┐рд▓реЗрдВрдбрд░ рд╕реНрдерд╛рдиреАрдп рд╕реНрдерд╛рди</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдЕрдкрдиреА рд╕реНрдерд┐рддрд┐ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдпрд╣ рдХрд╛рдлреА рдЫреЛрдЯрд╛ рд╣реИ - рдЗрд╕рдХреА рд╕реНрдерд┐рддрд┐ рд╕реАрдорд╛ рдореЗрдВ рд╣реИ (0.0 / 1.0)ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдбреНрд░реЙ рдХреЙрд▓ рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ рд╕рд░реНрдХрд┐рдЯ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ ...</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c1d/a35/c00/c1da35c0080225e7a47d8010c42aeab8.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдпрд╣рд╛рдБ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ: рдЯреЗрдХреНрд╕рдХреЛрд░реНрдбрд░реНрд╕ рдФрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕_рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдоред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЗрдХреНрд╕рдХреЛрд░реНрдб рдХрд╛рдлреА рд╕рд░рд▓рддрд╛ рд╕реЗ рд▓рд┐рдкрдЯреЗ рд╣реБрдП рд╣реИрдВ: рдКрдкрд░реА рдФрд░ рдирд┐рдЪрд▓реЗ рдЖрдзрд╛рд░реЛрдВ рдХрд╛ рдпреВ рдЕрдВрддрд░рд╛рд▓ [0.02777 - 1.02734] рдореЗрдВ рд╣реИред рдирд┐рдЪрд▓реЗ рдЖрдзрд╛рд░ рдкрд░ V 1.0 рд╣реИ, рдФрд░ рдКрдкрд░реА - 0.0 рдкрд░ред рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк рдХрд╛рдлреА рд╕рд░рд▓рддрд╛ рд╕реЗ рдЗрд╕ рдЬрд╛рд▓ рдХреЛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдерд╛рдиреАрдп рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рдЗрд╕ рдЫреЛрдЯреЗ рд╕рд┐рд▓реЗрдВрдбрд░ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЗрдирдкреБрдЯ рддрддреНрд╡ INSTANCE_TRYFORM рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рд╡рд┐рд╢реНрд╡ рдореИрдЯреНрд░рд┐рдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рдЗрд╕реЗ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВред рдЖрдЗрдП рдЗрд╕ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e88/791/17e/e8879117edb6f1dd9b53d3e7334a22df.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/adf/fb8/697/adffb8697a86ac86b935a00d6ae23dda.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/608/599/f6c/608599f6cf3930889c92df1a256991af.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╣реБрдд рдбрд░рд╛рд╡рдирд╛ рд▓рдЧрддрд╛ рд╣реИ, рд╣реИ рдирд╛? </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЪрд┐рдВрддрд╛ рдордд рдХрд░реЛ, рд╣рдо рдЗрд╕ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВрдЧреЗ рдФрд░ рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдпрд╣ рдХреНрдпрд╛ рдЫреБрдкрд╛рддрд╛ рд╣реИ! </font><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рд╣реИрдВ: </font><font style="vertical-align: inherit;">рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рдлреНрд░реЗрдо рдореЗрдВ рдХреИрдорд░реЗ рдХреА рд╕реНрдерд┐рддрд┐ рдЬрд╛рдирдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ: (-116.5338, 234.8695, 2.09) </font><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдордиреЗ рд╕рд┐рд▓реЗрдВрдбрд░ рдХреЛ рд╡рд┐рд╢реНрд╡ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рдХрд╛рдлреА рдмрдбрд╝рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреЗрд▓ рдХрд┐рдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">(TW3- </font><font style="vertical-align: inherit;">рдЬреЗрдб рдЕрдХреНрд╖ рдХрд╛ рдирд┐рд░реНрджреЗрд╢рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ), рдЗрд╕реЗ рдХреИрдорд░рд╛ рд╕реНрдерд┐рддрд┐ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджрд┐рдпрд╛ рд╣реИ , рдФрд░ рдореБрдбрд╝рд╛ред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рджреЗрдЦреЗрдВ рдХрд┐ рд╕рд┐рд▓реЗрдгреНрдбрд░ рд╢реЗрдбрд░ рдХреЗ рд╕рд╛рде рд░реВрдкрд╛рдВрддрд░рдг рдХреЗ рдмрд╛рдж рд╕рд┐рд▓реЗрдВрдбрд░ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ:</font></font><br><br> <code>XMMATRIX mat( -227.7472, 159.8043, 374.0736, -116.4951, <br> -194.7577, -173.3836, -494.4982, 238.6908, <br> -14.16466, -185.4743, 784.564, -1.45565, <br> 0.0, 0.0, 0.0, 1.0 ); <br> <br> mat = XMMatrixTranspose( mat ); <br> <br> XMVECTOR vScale; <br> XMVECTOR vRotateQuat; <br> XMVECTOR vTranslation; <br> XMMatrixDecompose( &amp;vScale, &amp;vRotateQuat, &amp;vTranslation, mat ); <br> <br> //  ... <br> XMMATRIX matRotate = XMMatrixRotationQuaternion( vRotateQuat );</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>vRotateQuat: (0.0924987569, -0.314900011, 0.883411944, -0.334462732) <br> <br> vScale: (299.999969, 300.000000, 1000.00012) <br> <br> vTranslation: (-116.495102, 238.690796, -1.45564997)</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f60/457/ca6/f60457ca61dd2d15ec3805b387e71def.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрдЯрд┐рдХрд▓ рд╢реЗрдбрд░ рджреНрд╡рд╛рд░рд╛ рд░реВрдкрд╛рдВрддрд░рдг рдХреЗ рдмрд╛рдж рд╕рд┐рд▓реЗрдВрдбрд░ред </font><font style="vertical-align: inherit;">рджреЗрдЦреЗрдВ рдХрд┐ рдпрд╣ рджреГрд╢реНрдпрддрд╛ рдХреЗ рдкрд┐рд░рд╛рдорд┐рдб рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдХреИрд╕реЗ рд╕реНрдерд┐рдд рд╣реИред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд░реНрдЯреЗрдХреНрд╕ рд╢реЗрдбрд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдирдкреБрдЯ рдЬреНрдпрд╛рдорд┐рддрд┐ рдФрд░ рд╡рд░реНрдЯреЗрдХрд░ рд╢реЗрдбрд░ рдПрдХ рджреВрд╕рд░реЗ рдкрд░ рдХрдбрд╝рд╛рдИ рд╕реЗ рдирд┐рд░реНрднрд░ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП, </font><font style="vertical-align: inherit;">рд╡рд░реНрдЯрд┐рдХрд▓ </font><font style="vertical-align: inherit;">рд╢реЗрдбрд░ рдХреЗ рд▓рд┐рдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдкрд░ рдХрд░реАрдм рд╕реЗ рдирдЬрд╝рд░ рдбрд╛рд▓рддреЗ рд╣реИрдВ: </font><font style="vertical-align: inherit;">рд╕рд░рд▓ рдкрд╛рд╕рд┐рдВрдЧ рдЯреЗрдХреНрд╕рдХреЛрд░реНрдбреНрд╕ (рд▓рд╛рдЗрди 0) рдФрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕_рдУрдбреА_рдкрд░рд╛рдо (рд▓рд╛рдЗрди 8) рдХреЗ рд╕рд╛рде, рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд▓рд┐рдП рджреЛ рдФрд░ рддрддреНрд╡реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: SV_Position (рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ) рдФрд░ рджреБрдирд┐рдпрд╛ рдореЗрдВ рд╕реНрдерд┐рддрд┐ рдХреА рдКрдВрдЪрд╛рдИ (рдШрдЯрдХ .z)ред </font><font style="vertical-align: inherit;">рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рд╕реНрдерд╛рдиреАрдп рд╕реНрдерд╛рди [0-1] рд░реЗрдВрдЬ рдореЗрдВ рд╣реИ? рдЗрд╕рд▓рд┐рдП, рд╡рд┐рд╢реНрд╡ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рд╕реЗ рдареАрдХ рдкрд╣рд▓реЗ, рд╡рд░реНрдЯреЗрдХреНрд╕ рд╢реЗрдбрд░ рд╕реНрдерд╛рдиреАрдп рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдкреИрдорд╛рдиреЗ рдФрд░ рд╡рд┐рдЪрд▓рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рд╕реНрдорд╛рд░реНрдЯ рдЪрд╛рд▓! </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕реНрдХреЗрд▓ = рдлреНрд▓реЛрдЯ 3 (4, 4, 2), рдФрд░ рдмрд╛рдпрд╕ = рдлреНрд▓реЛрдЯ 3 (-2, -1, -1)ред &lt; </font><font style="vertical-align: inherit;">рдЬреЛ рдкреИрдЯрд░реНрди 9 рдФрд░ 28 рдХреЗ рдмреАрдЪ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ, рд╡рд╣ рджреЛ рдкрдВрдХреНрддрд┐-рдкреНрд░рдореБрдЦ </font><font style="vertical-align: inherit;">рдкрд░рд┐рдкрдХреНрд╡рддрд╛рдУрдВ </font><font style="vertical-align: inherit;">рдХрд╛ рдЧреБрдгрди рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП, рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдкрд░ рддреИрдпрд╛рд░ рд╡рд░реНрдХрдЯ рд╢реЗрдЕрд░ рдХреЛ рджреЗрдЦреЗрдВ:</font></font><br><br> <code>vs_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb1[7], immediateIndexed <br> dcl_constantbuffer cb2[6], immediateIndexed <br> dcl_input v0.xyz <br> dcl_input v1.xy <br> dcl_input v4.xyzw <br> dcl_input v5.xyzw <br> dcl_input v6.xyzw <br> dcl_input v7.xyzw <br> dcl_output o0.xyz <br> dcl_output o1.xyzw <br> dcl_output_siv o2.xyzw, position <br> dcl_temps 2 <br> 0: mov o0.xy, v1.xyxx <br> 1: mul r0.xyzw, v5.xyzw, cb1[6].yyyy <br> 2: mad r0.xyzw, v4.xyzw, cb1[6].xxxx, r0.xyzw <br> 3: mad r0.xyzw, v6.xyzw, cb1[6].zzzz, r0.xyzw <br> 4: mad r0.xyzw, cb1[6].wwww, l(0.000000, 0.000000, 0.000000, 1.000000), r0.xyzw <br> 5: mad r1.xyz, v0.xyzx, cb2[4].xyzx, cb2[5].xyzx <br> 6: mov r1.w, l(1.000000) <br> 7: dp4 o0.z, r1.xyzw, r0.xyzw <br> 8: mov o1.xyzw, v7.xyzw <br> 9: mul r0.xyzw, v5.xyzw, cb1[0].yyyy <br> 10: mad r0.xyzw, v4.xyzw, cb1[0].xxxx, r0.xyzw <br> 11: mad r0.xyzw, v6.xyzw, cb1[0].zzzz, r0.xyzw <br> 12: mad r0.xyzw, cb1[0].wwww, l(0.000000, 0.000000, 0.000000, 1.000000), r0.xyzw <br> 13: dp4 o2.x, r1.xyzw, r0.xyzw <br> 14: mul r0.xyzw, v5.xyzw, cb1[1].yyyy <br> 15: mad r0.xyzw, v4.xyzw, cb1[1].xxxx, r0.xyzw <br> 16: mad r0.xyzw, v6.xyzw, cb1[1].zzzz, r0.xyzw <br> 17: mad r0.xyzw, cb1[1].wwww, l(0.000000, 0.000000, 0.000000, 1.000000), r0.xyzw <br> 18: dp4 o2.y, r1.xyzw, r0.xyzw <br> 19: mul r0.xyzw, v5.xyzw, cb1[2].yyyy <br> 20: mad r0.xyzw, v4.xyzw, cb1[2].xxxx, r0.xyzw <br> 21: mad r0.xyzw, v6.xyzw, cb1[2].zzzz, r0.xyzw <br> 22: mad r0.xyzw, cb1[2].wwww, l(0.000000, 0.000000, 0.000000, 1.000000), r0.xyzw <br> 23: dp4 o2.z, r1.xyzw, r0.xyzw <br> 24: mul r0.xyzw, v5.xyzw, cb1[3].yyyy <br> 25: mad r0.xyzw, v4.xyzw, cb1[3].xxxx, r0.xyzw <br> 26: mad r0.xyzw, v6.xyzw, cb1[3].zzzz, r0.xyzw <br> 27: mad r0.xyzw, cb1[3].wwww, l(0.000000, 0.000000, 0.000000, 1.000000), r0.xyzw <br> 28: dp4 o2.w, r1.xyzw, r0.xyzw <br> 29: ret</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>cbuffer cbPerFrame : register (b1) <br> { <br> row_major float4x4 g_viewProjMatrix; <br> row_major float4x4 g_rainShaftsViewProjMatrix; <br> } <br> <br> cbuffer cbPerObject : register (b2) <br> { <br> float4x4 g_mtxWorld; <br> float4 g_modelScale; <br> float4 g_modelBias; <br> } <br> <br> struct VS_INPUT <br> { <br> float3 PositionW : POSITION; <br> float2 Texcoord : TEXCOORD; <br> float3 NormalW : NORMAL; <br> float3 TangentW : TANGENT; <br> float4 InstanceTransform0 : INSTANCE_TRANSFORM0; <br> float4 InstanceTransform1 : INSTANCE_TRANSFORM1; <br> float4 InstanceTransform2 : INSTANCE_TRANSFORM2; <br> float4 InstanceLODParams : INSTANCE_LOD_PARAMS; <br> }; <br> <br> struct VS_OUTPUT <br> { <br> float3 TexcoordAndZ : Texcoord0; <br> <br> float4 LODParams : LODParams; <br> float4 PositionH : SV_Position; <br> }; <br> <br> VS_OUTPUT RainShaftsVS( VS_INPUT Input ) <br> { <br> VS_OUTPUT Output = (VS_OUTPUT)0; <br> <br> //    <br> Output.TexcoordAndZ.xy = Input.Texcoord; <br> Output.LODParams = Input.InstanceLODParams; <br> <br> //   <br> float3 meshScale = g_modelScale.xyz; // float3( 4, 4, 2 ); <br> float3 meshBias = g_modelBias.xyz; // float3( -2, -2, -1 ); <br> float3 PositionL = Input.PositionW * meshScale + meshBias; <br> <br> //    instanceWorld  float4s: <br> float4x4 matInstanceWorld = float4x4(Input.InstanceTransform0, Input.InstanceTransform1, <br> Input.InstanceTransform2 , float4(0, 0, 0, 1) ); <br> <br> //     (.z) <br> float4x4 matWorldInstanceLod = mul( g_rainShaftsViewProjMatrix, matInstanceWorld ); <br> Output.TexcoordAndZ.z = mul( float4(PositionL, 1.0), transpose(matWorldInstanceLod) ).z; <br> <br> // SV_Posiiton <br> float4x4 matModelViewProjection = mul(g_viewProjMatrix, matInstanceWorld ); <br> Output.PositionH = mul( float4(PositionL, 1.0), transpose(matModelViewProjection) ); <br> <br> return Output; <br> }</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрд░реЗ shader рдХреА рддреБрд▓рдирд╛ (рдмрд╛рдПрдВ) рдФрд░ рдореВрд▓ (рджрд╛рдПрдВ): </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef3/4f3/4ed/ef34f34edbc63113a08f47b7cde00df0.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорддрднреЗрдж рдЧрдгрдирд╛рдУрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЕрдкрдиреЗ рд╢реЗрдбрд░ рдХреЛ рдлреНрд░реЗрдо рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдФрд░ рд╕рдм рдХреБрдЫ рдЕрднреА рднреА рдареАрдХ рдерд╛!</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд┐рдХреНрд╕реЗрд▓ shader </font></font></h3><br>  рдЕрдВрдд рдореЗрдВ!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВ рдЖрдкрдХреЛ рдЗрдирдкреБрдЯ рджрд┐рдЦрд╛рдКрдВрдЧрд╛: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣рд╛рдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рд╢реЛрд░ рдмрдирд╛рд╡рдЯ рдФрд░ рдЧрд╣рд░рд╛рдИ рдмрдлрд░:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83a/558/fc3/83a558fc3c8c7e723eb85308b12657d6.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db5/0da/111/db50da111880f6b934d8bed6b74491e6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирд┐рд░рдВрддрд░ рдмрдлрд╝рд░ рд╕реЗ рдорд╛рди: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a12/394/bdc/a12394bdc039e522beeff97b8e41cd80.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37a/c47/485/37ac47485335960b2efbefc9f315ef14.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e7/e70/38a/4e7e7038a1bc956aadbb695d70b80ded.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ae/775/bc4/7ae775bc4a9388feceaa1ddf8c0a214a.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдкрд┐рдХреНрд╕реЗрд▓ shader рдХреЗ рд▓рд┐рдП рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб: </font></font><br><br> <code>ps_5_0 <br> dcl_globalFlags refactoringAllowed <br> dcl_constantbuffer cb0[8], immediateIndexed <br> dcl_constantbuffer cb2[3], immediateIndexed <br> dcl_constantbuffer cb12[23], immediateIndexed <br> dcl_constantbuffer cb4[8], immediateIndexed <br> dcl_sampler s0, mode_default <br> dcl_sampler s15, mode_default <br> dcl_resource_texture2d (float,float,float,float) t0 <br> dcl_resource_texture2d (float,float,float,float) t15 <br> dcl_input_ps linear v0.xyz <br> dcl_input_ps linear v1.w <br> dcl_input_ps_siv v2.xy, position <br> dcl_output o0.xyzw <br> dcl_temps 1 <br> 0: mul r0.xy, cb0[0].xxxx, cb4[5].xyxx <br> 1: mad r0.xy, v0.xyxx, cb4[4].xyxx, r0.xyxx <br> 2: sample_indexable(texture2d)(float,float,float,float) r0.x, r0.xyxx, t0.xyzw, s0 <br> 3: add r0.y, -cb4[2].x, cb4[3].x <br> 4: mad_sat r0.x, r0.x, r0.y, cb4[2].x <br> 5: mul r0.x, r0.x, v0.y <br> 6: mul r0.x, r0.x, v1.w <br> 7: mul r0.x, r0.x, cb4[1].x <br> 8: mul r0.yz, v2.xxyx, cb0[1].zzwz <br> 9: sample_l(texture2d)(float,float,float,float) r0.y, r0.yzyy, t15.yxzw, s15, l(0) <br> 10: mad r0.y, r0.y, cb12[22].x, cb12[22].y <br> 11: mad r0.y, r0.y, cb12[21].x, cb12[21].y <br> 12: max r0.y, r0.y, l(0.000100) <br> 13: div r0.y, l(1.000000, 1.000000, 1.000000, 1.000000), r0.y <br> 14: add r0.y, r0.y, -v0.z <br> 15: mul_sat r0.y, r0.y, cb4[6].x <br> 16: mul_sat r0.x, r0.y, r0.x <br> 17: mad r0.y, cb0[7].y, r0.x, -r0.x <br> 18: mad r0.x, cb4[7].x, r0.y, r0.x <br> 19: mul r0.xyz, r0.xxxx, cb4[0].xyzx <br> 20: log r0.xyz, r0.xyzx <br> 21: mul r0.xyz, r0.xyzx, l(2.200000, 2.200000, 2.200000, 0.000000) <br> 22: exp r0.xyz, r0.xyzx <br> 23: mul r0.xyz, r0.xyzx, cb2[2].xyzx <br> 24: mul o0.xyz, r0.xyzx, cb2[2].wwww <br> 25: mov o0.w, l(0) <br> 26: ret</code> <br> <br>  рд╡рд╛рд╣!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рдлреА рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╕рдм рдХреБрдЫ рдЗрддрдирд╛ рдмреБрд░рд╛ рдирд╣реАрдВ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ? </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо cbuffer (cb0 [0] .x) рдФрд░ рд╕реНрдХреЗрд▓ / рдСрдлрд╕реЗрдЯ рд╕реЗ рдмреАрддрд╛ рд╣реБрдЖ рд╕рдордп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдирд┐рдореЗрдЯреЗрдб UVs рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрди рдЯреЗрдХреНрд╕рдХреЛрд░реНрдбреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╢реЛрд░ рдмрдирд╛рд╡рдЯ (рд▓рд╛рдЗрди 2) рд╕реЗ рдирдореВрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрдирд╛рд╡рдЯ рд╕реЗ рд╢реЛрд░ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдиреНрдпреВрдирддрдо / рдЕрдзрд┐рдХрддрдо рдореВрд▓реНрдпреЛрдВ (рдЖрдорддреМрд░ рдкрд░ 0 рдФрд░ 1) рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрдм рд╣рдо рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдмрдирд╛рд╡рдЯ V рдХреЗ рд╕рдордиреНрд╡рдп рджреНрд╡рд╛рд░рд╛ (рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рд╕рдордиреНрд╡рдп V 1 рд╕реЗ 0 рддрдХ рдЬрд╛рддрд╛ рд╣реИ?) - рдкрдВрдХреНрддрд┐ 5. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдордиреЗ "рдЪрдордХ рдореБрдЦреМрдЯрд╛" рдХреА рдЧрдгрдирд╛ рдХреА - рдпрд╣ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/064/1a8/801/0641a88012fb6ec18797c0b143fb5f27.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рджреВрд░ рдХреА рд╡рд╕реНрддреБрдПрдВ (рдПрдХ рдкреНрд░рдХрд╛рд╢ рд╕реНрддрдВрдн, рдкрд╣рд╛рдбрд╝ ...) рдЧрд╛рдпрдм рд╣реЛ рдЧрдИ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реБрдЖ рдХреНрдпреЛрдВрдХрд┐ рд╕рд┐рд▓реЗрдВрдбрд░ рдЧрд╣рд░рд╛рдИ рдкрд░реАрдХреНрд╖рдг рд╕реЗ рдЧреБрдЬрд░рддрд╛ рд╣реИ - рд╕рд┐рд▓реЗрдВрдбрд░ рджреВрд░ рддрд▓ рдкрд░ рдирд╣реАрдВ рд╣реИ рдФрд░ рдЗрди рд╡рд╕реНрддреБрдУрдВ рдХреЗ рдКрдкрд░ рдЦреАрдВрдЪрд╛ рдЧрдпрд╛ рд╣реИ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/106/8f5/ffd/1068f5ffde6b0efba2c4894b88d5ddf5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд╣рд░рд╛рдИ рдкрд░реАрдХреНрд╖рдг</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдпрд╣ рдЕрдиреБрдХрд░рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдмрд╛рд░рд┐рд╢ рдХрд╛ рдкрд░реНрджрд╛ рджреВрд░ рд╣реИ (рд▓реЗрдХрд┐рди рдЬрд░реВрд░реА рдирд╣реАрдВ рдХрд┐ рджреВрд░ рдХреЗ рд╡рд┐рдорд╛рди рдкрд░)ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рдФрд░ рдореБрдЦреМрдЯрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ, "рджреВрд░ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдореБрдЦреМрдЯрд╛ред" </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреА рдЧрдгрдирд╛ рдирд┐рдореНрди рд╕реВрддреНрд░ рджреНрд╡рд╛рд░рд╛ рдХреА рдЬрд╛рддреА рд╣реИ: </font></font><br><br> <code>farObjectsMask = saturate( (FrustumDepth - CylinderWorldSpaceHeight) * 0.001 );</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(0.001 рдХреЛ рдмрдлрд░ рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ), рдЬреЛ рд╣рдореЗрдВ рд╡рд╛рдВрдЫрд┐рдд рдорд╛рд╕реНрдХ рджреЗрддрд╛ рд╣реИ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ff/02a/153/9ff02a1534054fb27b370d5cd58e7a75.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(рдкреИрдирд╛рдкрди рдкреНрд░рднрд╛рд╡ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ, рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рддрд╣реА рд░реВрдк рд╕реЗ рд╕рдордЭрд╛рдпрд╛ рдХрд┐ рджреГрд╢реНрдпрддрд╛ рдХреЗ рдкрд┐рд░рд╛рдорд┐рдб рдХреА рдЧрд╣рд░рд╛рдИ рдЧрд╣рд░рд╛рдИ рдмрдлрд░ рд╕реЗ рдХреИрд╕реЗ рдирд┐рдХрд╛рд▓реА рдЬрд╛рддреА рд╣реИред) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ, рдпрд╣ рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рджреГрд╢реНрдпрддрд╛ рдХреЗ рдкрд┐рд░рд╛рдорд┐рдб рдХреА рдЧрд╣рд░рд╛рдИ рдХреЛ рдПрдХ рдЫреЛрдЯреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рдХреЗ рд╡рд┐рд╢реНрд╡ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рдКрдВрдЪрд╛рдИ рдХреА рдЧрдгрдирд╛ рдХрд┐рдП рдмрд┐рдирд╛ рдЗрд╕ рдкреНрд░рднрд╛рд╡ рдХреЛ рдХрдо рдЦрд░реНрдЪреАрд▓рд╛ рдорд╣рд╕реВрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдПред 0.0004ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рджреЛрдиреЛрдВ рдореБрдЦреМрдЯреЗ рдХреЛ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЕрдВрддрд┐рдо рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c49/fb2/c1e/c49fb2c1e1dd2ee8d38d81c0cccb0daf.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдЕрдВрддрд┐рдо рдорд╛рд╕реНрдХ (рд▓рд╛рдЗрди 16) рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдПрдХ рдФрд░ рдкреНрд░рдХреНрд╖реЗрдк рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рд▓рдЧрднрдЧ рдХреБрдЫ рднреА рдирд╣реАрдВ (рдХрдо рд╕реЗ рдХрдо рдкрд░реАрдХреНрд╖рдг рдХрд┐рдП рдЧрдП рдорд╛рдорд▓реЗ рдореЗрдВ) рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдкрд░реНрджреЗ (рд▓рд╛рдЗрди 19) рдХреЗ рд░рдВрдЧ рд╕реЗ рдЕрдВрддрд┐рдо рдорд╛рд╕реНрдХ рдХреЛ рдЧреБрдгрд╛ рдХрд░реЗрдВ, рдЧрд╛рдорд╛ рд╕реБрдзрд╛рд░ (рд▓рд╛рдЗрдиреЗрдВ 20) рдХрд░реЗрдВ -22) рдФрд░ рдЕрдВрддрд┐рдо рдЧреБрдгрди (23-24)ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рд╣рдо рдПрдХ рд╢реВрдиреНрдп рдЕрд▓реНрдлрд╛ рдорд╛рди рдХреЗ рд╕рд╛рде рдПрдХ рд░рдВрдЧ рд╡рд╛рдкрд╕ рдХрд░рддреЗ рд╣реИрдВред рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рдкрд╛рд╕ рдкрд░ рдорд┐рд╢реНрд░рдг рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: </font></font><br><br> <code>FinalColor = SourceColor * 1.0 + (1.0 - SourceAlpha) * DestColor</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдпрд╣ рдирд╣реАрдВ рд╕рдордЭрддреЗ рд╣реИрдВ рдХрд┐ рдорд┐рд╢реНрд░рдг рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣рд╛рдВ рдПрдХ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SourceColor рдкрд┐рдХреНрд╕реЗрд▓ shader рд╕реЗ RGB рдЖрдЙрдЯрдкреБрдЯ рд╣реИ, рдФрд░ DestColor рд▓рдХреНрд╖реНрдп рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдореЗрдВ рдкрд┐рдХреНрд╕реЗрд▓ рдХрд╛ рд╡рд░реНрддрдорд╛рди RGB рд░рдВрдЧ рд╣реИ ред рдЪреВрдВрдХрд┐ SourceAlpha рд╣рдореЗрд╢рд╛ 0.0 рдХреЗ рдмрд░рд╛рдмрд░, рдЙрдкрд░реЛрдХреНрдд рд╕рдореАрдХрд░рдг рдХреЛ рдХрдо рдХрд░ рджреЗрддрд╛ рд╣реИ: </font></font><code>FinalColor = SourceColor + DestColor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдзреЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ рдХрд╣реЗрдВ, рддреЛ рдпрд╣рд╛рдВ рд╣рдо рдпреЛрдЧрд╛рддреНрдордХ рдорд┐рд╢реНрд░рдг рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░ рд░рд╣реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░ рд╡рд╛рдкрд╕ рдЖрддрд╛ рд╣реИ (0, 0, 0), рддреЛ рд░рдВрдЧ рд╕рдорд╛рди рд░рд╣реЗрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рд╕рдорд╛рдкреНрдд рдПрдЪрдПрд▓рдПрд╕рдПрд▓ рдХреЛрдб рд╣реИ - рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╕рдордЭрд╛рдиреЗ рдХреЗ рдмрд╛рдж рдпрд╣ рд╕рдордЭрдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реЛрдЧрд╛: </font><font style="vertical-align: inherit;">рдореИрдВ рдЦреБрд╢реА рд╕реЗ рдХрд╣ рд╕рдХрддрд╛ рд╣реВрдВ рдХрд┐ рдореЗрд░рд╛ рдкрд┐рдХреНрд╕реЗрд▓ рд╢реЗрдбрд░ рдореВрд▓ рдХреЗ рд╕рдорд╛рди рдХреЛрдбрд╛рдВрддрд░рдХ рдХреЛрдб рдмрдирд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рд▓реЗрдЦ рдкрд╕рдВрдж рдЖрдпрд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж!</font></font><br><br> <code>struct VS_OUTPUT <br> { <br> float3 TexcoordAndWorldspaceHeight : Texcoord0; <br> float4 LODParams : LODParams; // float4(1,1,1,1) <br> float4 PositionH : SV_Position; <br> }; <br> <br> float getFrustumDepth( in float depth ) <br> { <br> // from [1-0] to [0-1] <br> float d = depth * cb12_v22.x + cb12_v22.y; <br> <br> // special coefficents <br> d = d * cb12_v21.x + cb12_v21.y; <br> <br> // return frustum depth <br> return 1.0 / max(d, 1e-4); <br> } <br> <br> float4 EditedShaderPS( in VS_OUTPUT Input ) : SV_Target0 <br> { <br> // * Input from Vertex Shader <br> float2 InputUV = Input.TexcoordAndWorldspaceHeight.xy; <br> float WorldHeight = Input.TexcoordAndWorldspaceHeight.z; <br> float LODParam = Input.LODParams.w; <br> <br> // * Inputs <br> float elapsedTime = cb0_v0.x; <br> float2 uvAnimation = cb4_v5.xy; <br> float2 uvScale = cb4_v4.xy; <br> float minValue = cb4_v2.x; // 0.0 <br> float maxValue = cb4_v3.x; // 1.0 <br> float3 shaftsColor = cb4_v0.rgb; // RGB( 147, 162, 173 ) <br> <br> float3 finalColorFilter = cb2_v2.rgb; // float3( 1.175, 1.296, 1.342 ); <br> float finalEffectIntensity = cb2_v2.w; <br> <br> float2 invViewportSize = cb0_v1.zw; <br> <br> float depthScale = cb4_v6.x; // 0.001 <br> <br> // sample noise <br> float2 uvOffsets = elapsedTime * uvAnimation; <br> float2 uv = InputUV * uvScale + uvOffsets; <br> float disturb = texture0.Sample( sampler0, uv ).x; <br> <br> // * Intensity mask <br> float intensity = saturate( lerp(minValue, maxValue, disturb) ); <br> intensity *= InputUV.y; // transition from (0, 1) <br> intensity *= LODParam; // usually 1.0 <br> intensity *= cb4_v1.x; // 1.0 <br> <br> // Sample depth <br> float2 ScreenUV = Input.PositionH.xy * invViewportSize; <br> float hardwareDepth = texture15.SampleLevel( sampler15, ScreenUV, 0 ).x; <br> float frustumDepth = getFrustumDepth( hardwareDepth ); <br> <br> <br> // * Calculate mask covering distant objects behind cylinder. <br> <br> // Seems that the input really is world-space height (.z component, see vertex shader) <br> float depth = frustumDepth - WorldHeight; <br> float distantObjectsMask = saturate( depth * depthScale ); <br> <br> // * calculate final mask <br> float finalEffectMask = saturate( intensity * distantObjectsMask ); <br> <br> // cb0_v7.y and cb4_v7.x are set to 1.0 so I didn't bother with naming them :) <br> float paramX = finalEffectMask; <br> float paramY = cb0_v7.y * finalEffectMask; <br> float effectAmount = lerp(paramX, paramY, cb4_v7.x); <br> <br> // color of shafts comes from contant buffer <br> float3 effectColor = effectAmount * shaftsColor; <br> <br> // gamma correction <br> effectColor = pow(effectColor, 2.2); <br> <br> // final multiplications <br> effectColor *= finalColorFilter; <br> effectColor *= finalEffectIntensity; <br> <br> // return with zero alpha 'cause the blending used here is: <br> // SourceColor * 1.0 + (1.0 - SrcAlpha) * DestColor <br> return float4( effectColor, 0.0 ); <br> }</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi437100/">https://habr.com/ru/post/hi437100/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi437088/index.html">рд╡рд┐рджреЗрд╢ рдореЗрдВ рдПрдХ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдХрд╛ рдкреНрд░рдЪрд╛рд░: рдордзреНрдпрдо рдХреЗ рд╕рд╛рде рд╣рдЬрд╛рд░реЛрдВ-рд▓рд╛рдЦреЛрдВ рдЕрдВрдЧреНрд░реЗрдЬреА рдмреЛрд▓рдиреЗ рд╡рд╛рд▓реЗ рдкрд╛рдардХреЛрдВ рддрдХ рдХреИрд╕реЗ рдкрд╣реБрдВрдЪреЗ</a></li>
<li><a href="../hi437092/index.html">рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреА рд╕реБрд░рдХреНрд╖рд╛ред рдЕрдЬрдЧрд░ рдХрд╛ рд╣рдорд▓рд╛</a></li>
<li><a href="../hi437094/index.html">рд╣рдордиреЗ рдПрдЯрд▓рд╕рд┐рдпрди рд╕рд░реНрд╡рд┐рд╕ рдбреЗрд╕реНрдХ рдХреЛ рдкрдВрдк рдХрд┐рдпрд╛ - рдорд╛рдЗрдЯреИрдк рдФрд░ рд▓рд╛рдЗрд╡ рдкреНрд░рд╕рд╛рд░рдг рдХреА рдШреЛрд╖рдгрд╛</a></li>
<li><a href="../hi437096/index.html">UDBред рдпрд╣ рдХреНрдпрд╛ рд╣реИ? рднрд╛рдЧ 4. рджрддреНрддрдкрде ALU</a></li>
<li><a href="../hi437098/index.html">6 рдлрд░рд╡рд░реА, рдореЙрд╕реНрдХреЛ, рдбрд┐ рдЯреЗрд▓реАрдЧреНрд░рд╛рдл - рдЙрддреНрдкрд╛рдж рдбрд┐рдЬрд╛рдЗрди рдкрд░ рдмрд┐рдЧ QIWI рд░рд╕реЛрдИ</a></li>
<li><a href="../hi437102/index.html">рдиреНрдпреВ рд▓реЗрдЧреЛ рдЪреИрдВрдкрд┐рдпрди рдореАрдЯ: рд▓реЗрдЧреЛ рдмреВрд╕реНрдЯ</a></li>
<li><a href="../hi437104/index.html">рдЗрдВрдЯреНрд░реЛрд╕реНрдХреЛрдк: рдареАрдХ рд╣реИ, рдмрд╣реБрдд рдЖрд▓рд╕реА рдЗрдХрд╛рдИ рдкрд░реАрдХреНрд╖рдг</a></li>
<li><a href="../hi437106/index.html">рдЬреЛрди рдореЗрдВ рдЖрдИрдЯреА .it</a></li>
<li><a href="../hi437108/index.html">рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЧреНрд░рдВрде рдкрд╛рдЧрд▓ рд▓реЛрдЧреЛрдВ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдЦреЗ рдЧрдП рд╣реИрдВред</a></li>
<li><a href="../hi437110/index.html">рдиреИрдиреЛрдореАрдЯрд░ рд╕рд╛рдордЧреНрд░реА рд╣рдорд╛рд░реА рджреБрдирд┐рдпрд╛ рдмрджрд▓ рд░рд╣реА рд╣реИ, рдФрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рднреА рдЙрдирдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд╣реАрдВ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>