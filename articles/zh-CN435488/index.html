<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ›ï¸ ğŸ‚ğŸ½ ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ» Spockæ¡†æ¶ä¸­çš„å°æ ·ï¼Œå­˜æ ¹å’Œé—´è° ğŸ“ˆ ğŸŒ¾ ğŸ‘©ğŸ»â€ğŸ¤â€ğŸ‘¨ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Spockæä¾›äº†3ä¸ªåŠŸèƒ½å¼ºå¤§ï¼ˆä½†æœ¬è´¨ä¸Šæœ‰æ‰€ä¸åŒï¼‰çš„å·¥å…·ï¼Œå¯ç®€åŒ–ç¼–å†™æµ‹è¯•çš„è¿‡ç¨‹ï¼šMockï¼ŒStubå’ŒSpyã€‚ 



 é€šå¸¸ï¼Œéœ€è¦æµ‹è¯•çš„ä»£ç éœ€è¦ä¸ç§°ä¸ºä¾èµ–é¡¹çš„å¤–éƒ¨æ¨¡å—è¿›è¡Œäº¤äº’ï¼ˆåŸå§‹æ–‡ç« ä½¿ç”¨åä½œè€…ä¸€è¯ï¼Œåœ¨ä¿„è¯­ç¯å¢ƒä¸­å¹¶ä¸å¸¸è§ï¼‰ã€‚ 


 å•å…ƒæµ‹è¯•é€šå¸¸è®¾è®¡ä¸ºä½¿ç”¨mokçš„å„ç§å˜ä½“ï¼ˆæ¨¡æ‹Ÿï¼Œå­˜æ ¹å’Œé—´è°ï¼‰æµ‹è¯•å•ä¸ªéš”...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spockæ¡†æ¶ä¸­çš„å°æ ·ï¼Œå­˜æ ¹å’Œé—´è°</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/435488/"><p>  Spockæä¾›äº†3ä¸ªåŠŸèƒ½å¼ºå¤§ï¼ˆä½†æœ¬è´¨ä¸Šæœ‰æ‰€ä¸åŒï¼‰çš„å·¥å…·ï¼Œå¯ç®€åŒ–ç¼–å†™æµ‹è¯•çš„è¿‡ç¨‹ï¼šMockï¼ŒStubå’ŒSpyã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mp/b1/16/mpb116loygy7rcfeicuihzm8oym.jpeg"></div><br><p> é€šå¸¸ï¼Œéœ€è¦æµ‹è¯•çš„ä»£ç éœ€è¦ä¸ç§°ä¸ºä¾èµ–é¡¹çš„å¤–éƒ¨æ¨¡å—è¿›è¡Œäº¤äº’ï¼ˆåŸå§‹æ–‡ç« ä½¿ç”¨åä½œè€…ä¸€è¯ï¼Œåœ¨ä¿„è¯­ç¯å¢ƒä¸­å¹¶ä¸å¸¸è§ï¼‰ã€‚ </p><br><p> å•å…ƒæµ‹è¯•é€šå¸¸è®¾è®¡ä¸ºä½¿ç”¨mokçš„å„ç§å˜ä½“ï¼ˆæ¨¡æ‹Ÿï¼Œå­˜æ ¹å’Œé—´è°ï¼‰æµ‹è¯•å•ä¸ªéš”ç¦»çš„ç±»ã€‚ å› æ­¤ï¼Œéšç€ä¾èµ–ä»£ç çš„å‘å±•ï¼Œæµ‹è¯•å°†æ›´åŠ å¯é ï¼Œå¹¶ä¸”ä¸ä¼šç ´è£‚ã€‚ </p><br><p> å½“æ›´æ”¹ä¾èµ–å…³ç³»å®ç°çš„å†…éƒ¨ç»†èŠ‚æ—¶ï¼Œæ­¤ç±»éš”ç¦»çš„æµ‹è¯•ä¸å¤ªå®¹æ˜“å‡ºç°é—®é¢˜ã€‚ </p><br><p>  <em>è¯‘è€…çš„è¯ï¼š</em>æ¯æ¬¡æˆ‘ä½¿ç”¨Spockæ¡†æ¶ç¼–å†™æµ‹è¯•æ—¶ï¼Œæˆ‘éƒ½è§‰å¾—é€‰æ‹©æ›¿ä»£ä¾èµ–çš„æ–¹å¼æ—¶ä¼šçŠ¯é”™ã€‚ æœ¬æ–‡æä¾›äº†æœ€çŸ­çš„å¤‡å¿˜å•ï¼Œç”¨äºé€‰æ‹©åˆ›å»ºMokasçš„æœºåˆ¶ã€‚ </p><a name="habracut"></a><br><h2 id="tldr">  TL; DR </h2><br><h3 id="mocks"> å˜²å¼„ </h3><br><p> ä½¿ç”¨æ¨¡æ‹Ÿæ¥ï¼š </p><br><ul><li> æµ‹è¯•ä»£ç å’Œä¾èµ–é¡¹ä¹‹é—´çš„åˆåŒæ£€æŸ¥ </li><li> æ£€æŸ¥ä¾èµ–æ–¹æ³•çš„æ­£ç¡®æ¬¡æ•° </li><li> éªŒè¯ä¾èµ–ä»£ç è¢«è°ƒç”¨çš„å‚æ•° </li></ul><br><h3 id="stubs"> å­˜æ ¹ </h3><br><p> ä½¿ç”¨å­˜æ ¹å¯ä»¥ï¼š </p><br><ul><li> æä¾›é¢„å®šä¹‰çš„é€šè¯ç»“æœ </li><li> æ‰§è¡Œä¾èµ–é¡¹æœŸæœ›çš„é¢„å®šä¹‰æ“ä½œï¼Œä¾‹å¦‚å¼•å‘å¼‚å¸¸ </li></ul><br><h3 id="spies"> é—´è° </h3><br><p> ææƒ§é—´è°ã€‚ æ­£å¦‚Spockæ–‡æ¡£æ‰€è¿°ï¼š </p><br><blockquote> ä½¿ç”¨æ­¤æœºåˆ¶å‰è¯·ä¸‰æ€ã€‚ ä¹Ÿè®¸æ‚¨åº”è¯¥é‡æ–°è®¾è®¡è§£å†³æ–¹æ¡ˆå¹¶é‡æ–°ç»„ç»‡ä»£ç ã€‚ </blockquote><p> ä½†æ˜¯ç¢°å·§çš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨é—ç•™ä»£ç ã€‚ æ—§ç‰ˆä»£ç å¯èƒ½å¾ˆéš¾ç”šè‡³ä¸å¯èƒ½ç”¨æš´æ°‘å’Œå­˜æ ¹è¿›è¡Œæµ‹è¯•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨Spyã€‚ </p><br><p> æœ€å¥½è®©æ—§ä»£ç åŒ…å«åœ¨ä½¿ç”¨Spyçš„æµ‹è¯•ä¸­ï¼Œè€Œä¸è¦å®Œå…¨æ²¡æœ‰æ—§æµ‹è¯•ã€‚ </p><br><p> ä½¿ç”¨é—´è°å¯ä»¥ï¼š </p><br><ul><li> æµ‹è¯•æ— æ³•é€šè¿‡å…¶ä»–æ–¹æ³•æµ‹è¯•çš„æ—§ç‰ˆä»£ç  </li><li> æ£€æŸ¥ä¾èµ–æ–¹æ³•çš„æ­£ç¡®æ¬¡æ•° </li><li> éªŒè¯ä¼ é€’çš„å‚æ•° </li><li> æä¾›é¢„å®šä¹‰çš„ä¾èµ–é¡¹å“åº” </li><li> æ‰§è¡Œé¢„å®šä¹‰çš„æ“ä½œä»¥å“åº”å¯¹ä¾èµ–æ–¹æ³•çš„è°ƒç”¨ </li></ul><br><h2 id="mocks-1"> å˜²å¼„ </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zi/3q/vj/zi3qvjii7ug7tkq4bczo5f-jo7u.jpeg"></div><br><p>å½“å•å…ƒæµ‹è¯•çš„ä»»åŠ¡æ˜¯éªŒè¯è¢«æµ‹ä»£ç ä¸ä¾èµ–é¡¹ä¹‹é—´çš„çº¦å®šæ—¶ï¼Œmoxasçš„æ‰€æœ‰åŠŸèƒ½éƒ½å¾—åˆ°ä½“ç°ã€‚ è®©æˆ‘ä»¬çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä½¿ç”¨<code>FooService</code>ä½œä¸ºä¾èµ–é¡¹çš„<code>FooController</code>æ§åˆ¶å™¨ï¼Œå¹¶é€šè¿‡<code>FooService</code>æµ‹è¯•äº†æ­¤åŠŸèƒ½ã€‚ </p><br><p> <code>FooController.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">FooService fooService def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) } }</code> </pre> <br><p> <code>FooService.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-string"><span class="hljs-string">"Hi ${name}, FooService did something"</span></span> } }</code> </pre> <br><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¥æµ‹è¯•ï¼š </p><br><ul><li>  <code>FooController</code>å’Œ<code>FooService</code>ä¹‹é—´çš„åˆåŒ </li><li>  <code>FooService.doSomething(name)</code>è¢«è°ƒç”¨çš„æ­£ç¡®æ¬¡æ•° </li><li> ä½¿ç”¨æ­£ç¡®çš„å‚æ•°è°ƒç”¨<code>FooService.doSomething(name)</code> </li></ul><br><p> çœ‹ä¸€ä¸‹æµ‹è¯•ï¼š </p><br><p> <code>MockSpec.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> grails.testing.web.controllers.ControllerUnitTest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spock.lang.Specification <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MockSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Specification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerUnitTest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-string"><span class="hljs-string">"Mock FooService"</span></span>() { given: <span class="hljs-string"><span class="hljs-string">"  "</span></span> def fooService = Mock(FooService) and: <span class="hljs-string"><span class="hljs-string">"    "</span></span> controller.fooService = fooService when: <span class="hljs-string"><span class="hljs-string">"  "</span></span> controller.doSomething() then: <span class="hljs-string"><span class="hljs-string">"         "</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) and: <span class="hljs-string"><span class="hljs-string">"  ''    - 'null'"</span></span> response.text == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>.toString() } }</code> </pre> <br><p> ä¸Šé¢çš„æµ‹è¯•åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡æ¨¡æ‹Ÿï¼š </p><br><pre> <code class="java hljs">def fooService = Mock(FooService)</code> </pre> <br><p> è¯¥æµ‹è¯•è¿˜æ£€æŸ¥<code>FooService.doSomething(name)</code>æ˜¯å¦è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¼ é€’ç»™å®ƒçš„å‚æ•°ä¸å­—ç¬¦ä¸²<code>"Sally"</code>åŒ¹é…ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>)</code> </pre> <br><p> ä¸Šé¢çš„ä»£ç è§£å†³äº†4ä¸ªé‡è¦é—®é¢˜ï¼š </p><br><ul><li> ä¸º<code>FooService</code>åˆ›å»ºæ¨¡æ‹Ÿ </li><li> éªŒè¯æ˜¯å¦ä½¿ç”¨<code>String</code>å‚æ•°å’Œå€¼<code>"Sally"</code>æ°å¥½ä¸€æ¬¡è°ƒç”¨äº†<code>FooService.doSomething(String name)</code> </li><li> éš”ç¦»æµ‹è¯•ä»£ç ï¼Œæ›¿æ¢ä¾èµ–å…³ç³»å®ç° </li></ul><br><h2 id="stubs-1"> å­˜æ ¹ </h2><br><p> è¢«æµ‹è¯•çš„ä»£ç æ˜¯å¦ä½¿ç”¨ä¾èµ–å…³ç³»ï¼Ÿ æµ‹è¯•çš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿ä¸ä¾èµ–é¡¹è¿›è¡Œäº¤äº’æ—¶ï¼Œè¢«æµ‹ä»£ç èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Ÿ ä¾èµ–æ–¹æ³•è°ƒç”¨çš„ç»“æœæ˜¯å¦è¾“å…¥äº†è¢«æµ‹ä»£ç çš„å€¼ï¼Ÿ </p><br><p> å¦‚æœæµ‹è¯•ä»£ç çš„è¡Œä¸ºæ ¹æ®ä¾èµ–é¡¹çš„è¡Œä¸ºè€Œå˜åŒ–ï¼Œåˆ™éœ€è¦ä½¿ç”¨å­˜æ ¹ï¼ˆStubï¼‰ã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸‹é¢çš„<code>FooController</code>å’Œ<code>FooService</code>ç¤ºä¾‹ï¼Œå¹¶ä½¿ç”¨å­˜æ ¹æµ‹è¯•æ§åˆ¶å™¨åŠŸèƒ½ã€‚ </p><br><p> <code>FooController.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">FooService fooService def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) } }</code> </pre> <br><p> <code>FooService.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-string"><span class="hljs-string">"Hi ${name}, FooService did something"</span></span> } }</code> </pre> <br><p> æµ‹è¯•ä»£ç ï¼š </p><br><p> <code>StubSpec.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> grails.testing.web.controllers.ControllerUnitTest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spock.lang.Specification <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StubSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Specification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerUnitTest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-string"><span class="hljs-string">"Stub FooService"</span></span>() { given: <span class="hljs-string"><span class="hljs-string">"  "</span></span> def fooService = Stub(FooService) { doSomething(_) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"Stub did something"</span></span> } and: <span class="hljs-string"><span class="hljs-string">"    "</span></span> controller.fooService = fooService when: <span class="hljs-string"><span class="hljs-string">"  "</span></span> controller.doSomething() then: <span class="hljs-string"><span class="hljs-string">"   "</span></span> <span class="hljs-comment"><span class="hljs-comment">// 1 * fooService.doSomething() //        response.text == "Stub did something" } }</span></span></code> </pre> <br><p> æ‚¨å¯ä»¥è¿™æ ·åˆ›å»ºä¸€ä¸ªå­˜æ ¹ï¼š </p><br><pre> <code class="java hljs">def fooService = Stub(FooService) { doSomething(_) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"Stub did something"</span></span> }</code> </pre> <br><p> ä¸Šé¢çš„ä»£ç è§£å†³äº†4ä¸ªé‡è¦é—®é¢˜ï¼š </p><br><ul><li> åˆ›å»ºä¸€ä¸ªå­˜æ ¹<code>FooService</code> </li><li> ç¡®ä¿æ— è®ºä¼ é€’çš„å‚æ•°å¦‚ä½•ï¼Œ <code>FooService.doSomething(String name)</code>éƒ½å°†è¿”å›å­—ç¬¦ä¸²<code>"Stub did something"</code> ï¼ˆå› æ­¤æˆ‘ä»¬ä½¿ç”¨äº†<code>_</code>å­—ç¬¦ï¼‰ </li><li> éš”ç¦»æµ‹è¯•çš„ä»£ç ï¼Œç”¨å­˜æ ¹æ›¿æ¢ä¾èµ–å®ç° </li></ul><br><h2 id="spies-1"> é—´è° </h2><br><p> è¯·ä¸è¦é˜…è¯»æœ¬èŠ‚ã€‚ </p><br><p> ä¸è¦çœ‹ </p><br><p> è·³åˆ°ä¸‹ä¸€ä¸ªã€‚ </p><br><p> è¿˜åœ¨è¯»ä¹¦å—ï¼Ÿ å¥½å§ï¼Œå¥½çš„ï¼Œè®©æˆ‘ä»¬å¤„ç†Spyã€‚ </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b9/sj/lk/b9sjlk13izmu8rbtb4yv4zncwvm.jpeg"></div><br><p> ä¸è¦ä½¿ç”¨é—´è°ã€‚ æ­£å¦‚Spockæ–‡æ¡£æ‰€è¿°ï¼š </p><br><blockquote> ä½¿ç”¨æ­¤æœºåˆ¶å‰è¯·ä¸‰æ€ã€‚ ä¹Ÿè®¸æ‚¨åº”è¯¥é‡æ–°è®¾è®¡è§£å†³æ–¹æ¡ˆå¹¶é‡æ–°ç»„ç»‡ä»£ç ã€‚ </blockquote><p> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰äº›æƒ…å†µä¸‹æˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨é—ç•™ä»£ç ã€‚ æ—§ç‰ˆä»£ç æ— æ³•ä½¿ç”¨å°æ€ªæˆ–å­˜æ ¹è¿›è¡Œæµ‹è¯•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé—´è°ä»ç„¶æ˜¯å”¯ä¸€å¯è¡Œçš„é€‰æ‹©ã€‚ </p><br><p> é—´è°ä¸mokasæˆ–stubæœ‰æ‰€ä¸åŒï¼Œå› ä¸ºå®ƒä»¬ä¸åƒstubé‚£æ ·å·¥ä½œã€‚ </p><br><p> ç”¨mokæˆ–stubæ›¿æ¢ä¾èµ–é¡¹æ—¶ï¼Œå°†åˆ›å»ºæµ‹è¯•å¯¹è±¡ï¼Œå¹¶ä¸”ä¸æ‰§è¡Œä¾èµ–é¡¹çš„å®é™…æºä»£ç ã€‚ </p><br><p> å¦ä¸€æ–¹é¢ï¼Œé—´è°å°†æ‰§è¡Œä¸ºå…¶åˆ›å»ºé—´è°çš„ä¾èµ–é¡¹çš„ä¸»è¦æºä»£ç ï¼Œä½†é—´è°å°†å…è®¸æ‚¨æ›´æ”¹é—´è°è¿”å›çš„å†…å®¹å¹¶æ£€æŸ¥æ–¹æ³•è°ƒç”¨ï¼Œå°±åƒmokaså’Œstubä¸€æ ·ã€‚  ï¼ˆå› æ­¤å‘½åä¸ºSpyï¼‰ã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸‹é¢çš„<code>FooController</code>ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹ä½¿ç”¨<code>FooService</code> ï¼Œç„¶åä½¿ç”¨é—´è°æµ‹è¯•åŠŸèƒ½ã€‚ </p><br><p> <code>FooController.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">FooService fooService def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) } }</code> </pre> <br><p> <code>FooService.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.transform.CompileStatic <span class="hljs-meta"><span class="hljs-meta">@CompileStatic</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-string"><span class="hljs-string">"Hi ${name}, FooService did something"</span></span> } }</code> </pre> <br><p> æµ‹è¯•ä»£ç ï¼š </p><br><p> <code>SpySpec.groovy</code> </p> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.myapp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> grails.testing.web.controllers.ControllerUnitTest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spock.lang.Specification <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpySpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Specification</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControllerUnitTest</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooController</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-string"><span class="hljs-string">"Spy FooService"</span></span>() { given: <span class="hljs-string"><span class="hljs-string">" -"</span></span> def fooService = Spy(FooService) and: <span class="hljs-string"><span class="hljs-string">"   "</span></span> controller.fooService = fooService when: <span class="hljs-string"><span class="hljs-string">"  "</span></span> controller.doSomething() then: <span class="hljs-string"><span class="hljs-string">"     "</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"A Spy can modify implementation"</span></span> and: <span class="hljs-string"><span class="hljs-string">'     '</span></span> response.text == <span class="hljs-string"><span class="hljs-string">"A Spy can modify implementation"</span></span> } }</code> </pre> <br><p> åˆ›å»ºä¸€ä¸ªé—´è°å®ä¾‹éå¸¸ç®€å•ï¼š </p><br><pre> <code class="java hljs">def fooService = Spy(FooService)</code> </pre> <br><p> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé—´è°ç¨‹åºä½¿æˆ‘ä»¬å¯ä»¥æ£€æŸ¥å¯¹<code>FooService.doSomething(name)</code>çš„è°ƒç”¨ï¼Œè°ƒç”¨æ•°é‡å’Œå‚æ•°å€¼ã€‚ è€Œä¸”ï¼Œé—´è°æ›´æ”¹äº†æ–¹æ³•çš„å®ç°ä»¥è¿”å›ä¸åŒçš„å€¼ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> * fooService.doSomething(<span class="hljs-string"><span class="hljs-string">"Sally"</span></span>) &gt;&gt; <span class="hljs-string"><span class="hljs-string">"A Spy can modify implementation"</span></span></code> </pre> <br><p> ä¸Šé¢çš„ä»£ç è§£å†³äº†4ä¸ªé‡è¦é—®é¢˜ï¼š </p><br><ul><li> ä¸º<code>FooService</code>åˆ›å»ºä¸€ä¸ªé—´è°å®ä¾‹ </li><li> æ£€æŸ¥ä¾èµ–é¡¹äº¤äº’ </li><li> æ ¹æ®ä¾èµ–æ–¹æ³•è°ƒç”¨çš„æŸäº›ç»“æœæ£€æŸ¥åº”ç”¨ç¨‹åºçš„å·¥ä½œæ–¹å¼ </li><li> éš”ç¦»æµ‹è¯•çš„ä»£ç ï¼Œç”¨å­˜æ ¹æ›¿æ¢ä¾èµ–å®ç° </li></ul><br><h2 id="faq"> å¸¸è§é—®é¢˜ </h2><br><p>  <strong>ä½¿ç”¨å“ªä¸ªé€‰é¡¹ï¼šæ¨¡æ‹Ÿï¼Œå­˜æ ¹æˆ–é—´è°ï¼Ÿ</strong> </p><br><p> è¿™æ˜¯è®¸å¤šå¼€å‘äººå‘˜é¢ä¸´çš„é—®é¢˜ã€‚ å¦‚æœä¸ç¡®å®šä½¿ç”¨å“ªç§æ–¹æ³•ï¼Œæ­¤å¸¸è§é—®é¢˜è§£ç­”å¯ä»¥æä¾›å¸®åŠ©ã€‚ </p><br><p>  <strong>é—®ï¼š</strong>æµ‹è¯•çš„ç›®çš„æ˜¯ä¸ºäº†éªŒè¯è¢«æµ‹ä»£ç ä¸ä¾èµ–é¡¹ä¹‹é—´çš„å¥‘çº¦ï¼Ÿ </p><br><p>  <strong>ç­”ï¼š</strong>å¦‚æœå›ç­”æ˜¯ï¼Œè¯·ä½¿ç”¨æ¨¡æ‹Ÿ </p><br><p>  <strong>é—®ï¼š</strong>æµ‹è¯•çš„ç›®çš„æ˜¯ç¡®ä¿ä¸ä¾èµ–é¡¹è¿›è¡Œäº¤äº’æ—¶è¢«æµ‹ä»£ç èƒ½å¤Ÿæ­£å¸¸å·¥ä½œå—ï¼Ÿ </p><br><p>  <strong>ç­”ï¼š</strong>å¦‚æœå›ç­”æ˜¯ï¼Œè¯·ä½¿ç”¨å­˜æ ¹ </p><br><p>  <strong>é—®ï¼š</strong>è°ƒç”¨ä¾èµ–æ–¹æ³•çš„ç»“æœæ˜¯å¦è¾“å…¥äº†è¢«æµ‹ä»£ç çš„å€¼ï¼Ÿ </p><br><p>  <strong>ç­”ï¼š</strong>å¦‚æœå›ç­”æ˜¯ï¼Œè¯·ä½¿ç”¨å­˜æ ¹ </p><br><p>  <strong>é—®ï¼š</strong>æ‚¨æ˜¯å¦ä½¿ç”¨æ—§ä»£ç ï¼Œè¿™å¾ˆéš¾æµ‹è¯•ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–é€‰æ‹©ï¼Ÿ </p><br><p>  <strong>ç­”ï¼š</strong>å°è¯•ä½¿ç”¨é—´è° </p><br><h2 id="kod-primerov"> ä»£ç ç¤ºä¾‹ </h2><br><p> æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°æœ¬æ–‡æ‰€æœ‰ç¤ºä¾‹çš„ä»£ç ï¼š </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/ddelponte/mock-stub-spy</a> </p><br><h2 id="poleznye-ssylki"> æœ‰ç”¨çš„é“¾æ¥ </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://spockframework.org/spock/docs/1.1/all_in_one.html#_interaction_based_testing</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://martinfowler.com/bliki/UnitTest.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://martinfowler.com/articles/mocksArentStubs.html</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN435488/">https://habr.com/ru/post/zh-CN435488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN435470/index.html">Reactæ•™ç¨‹ï¼Œç¬¬8éƒ¨åˆ†ï¼šåœ¨TODOåº”ç”¨ç¨‹åºä¸Šç»§ç»­å·¥ä½œï¼Œä»‹ç»ç»„ä»¶å±æ€§</a></li>
<li><a href="../zh-CN435476/index.html">Mkcertï¼šæœ¬åœ°ä¸»æœºçš„æœ‰æ•ˆHTTPSè¯ä¹¦</a></li>
<li><a href="../zh-CN435480/index.html">å¾®è½¯å’Œå…‹ç½—æ ¼å°†åœ¨äºšé©¬é€Šé¢†åŸŸå±•å¼€æ–—äº‰...é£Ÿå“è´¸æ˜“</a></li>
<li><a href="../zh-CN435482/index.html">Zirconé‡ç‚¹ä»‹ç»ï¼švDSOï¼ˆè™šæ‹ŸåŠ¨æ€å…±äº«å¯¹è±¡ï¼‰</a></li>
<li><a href="../zh-CN435484/index.html">ç»’æ¯›é£æ ¼1989</a></li>
<li><a href="../zh-CN435490/index.html">2019å¹´Googleç¨æ”¶å˜åŒ–</a></li>
<li><a href="../zh-CN435494/index.html">æ— ç¼å®¢æˆ·ç«¯æœåŠ¡å™¨</a></li>
<li><a href="../zh-CN435496/index.html">ç‰¹æ–¯æ‹‰èµ·è¯‰Så‹é©¾é©¶å‘˜å’Œä¹˜å®¢æ­»äº¡çš„äº‹æ•…</a></li>
<li><a href="../zh-CN435498/index.html">vCloud Director Extenderï¼šè¿ç§»</a></li>
<li><a href="../zh-CN435500/index.html">èµ›è½¦ç”Ÿç‰©è¯†åˆ«æ‰‹å¥—</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>