<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌭 🤾🏻 💪🏿 Mentransfer backend PHP ke Redis stream bus dan memilih perpustakaan yang tidak bergantung pada framework 👨🏿‍🚀 🙆🏻 🧔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kata Pengantar 
 Situs saya, yang saya lakukan sebagai hobi, dirancang untuk menyimpan halaman rumah dan situs pribadi yang menarik. Topik ini mulai m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mentransfer backend PHP ke Redis stream bus dan memilih perpustakaan yang tidak bergantung pada framework</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483584/"><img src="https://habrastorage.org/webt/wk/hw/mm/wkhwmmingyzwy7-r1esz_9vna54.png"><br><br><h2>  Kata Pengantar </h2><br>  Situs saya, yang saya lakukan sebagai hobi, dirancang untuk menyimpan halaman rumah dan situs pribadi yang menarik.  Topik ini mulai menarik minat saya di awal jalur saya dalam pemrograman, pada saat itu saya senang menemukan profesional hebat yang menulis tentang diri mereka sendiri, hobi dan proyek mereka.  Kebiasaan menemukan mereka tetap ada untuk saat ini: di hampir setiap iklan dan tidak di situs web, saya terus mencari ke catatan kaki untuk mencari tautan ke penulis. <br><a name="habracut"></a><br><h2>  Implementasi ide </h2><br>  Versi pertama hanya halaman html di situs pribadi saya, tempat saya menaruh tautan dengan tanda tangan di daftar ul.  Setelah mengetik 20 halaman untuk beberapa waktu, saya mulai berpikir bahwa itu tidak terlalu efektif dan memutuskan untuk mencoba mengotomatiskan proses.  Pada stackoverflow, saya perhatikan bahwa banyak situs menunjukkan dalam profil mereka, jadi saya menulis parser php yang baru saja berjalan melalui profil, mulai dari yang pertama (alamat pada SO dan sampai hari ini seperti ini: `/ users / 1`), tautan yang diekstraksi dari tag yang diinginkan dan ditumpuk dalam SQLite. <br><br>  Ini bisa disebut versi kedua: kumpulan puluhan ribu URL dalam plat SQLite yang menggantikan daftar statis dalam html.  Saya melakukan pencarian sederhana pada daftar ini.  Karena  hanya ada url, maka pencarian hanya untuk mereka. <br><br>  Pada tahap ini, saya meninggalkan proyek dan kembali ke sana, setelah waktu yang lama.  Pada tahap ini, pengalaman kerja saya sudah lebih dari tiga tahun dan saya merasa bisa melakukan sesuatu yang lebih serius.  Selain itu, ada keinginan besar untuk menguasai teknologi yang relatif baru untuk diri mereka sendiri. <br><br><h2>  Versi modern </h2><br>  <a href="https://hpdb.ru/">Proyek ini</a> ditempatkan di buruh pelabuhan, basis data dipindahkan ke mongoDb, dan, relatif baru-baru ini, lobak ditambahkan, yang pada awalnya hanya untuk caching.  Sebagai dasar, salah satu mikroframe PHP digunakan. <br><br><h4>  Masalah </h4><br>  Situs baru ditambahkan oleh perintah konsol yang secara sinkron melakukan hal berikut: <br><br><ul><li>  Unduh konten dengan URL <br></li><li>  Tandai apakah HTTPS tersedia <br></li><li>  Mempertahankan esensi situs web <br></li><li>  Sumber HTML dan Header Menyimpan ke Riwayat Pengindeksan <br></li><li>  Mengurai konten, mengambil Judul dan Deskripsi <br></li><li>  Menyimpan data ke koleksi terpisah. <br></li></ul><br>  Ini cukup untuk hanya menyimpan situs dan menampilkannya dalam daftar: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a4/914/0f8/5a49140f8a7a27eac0e22c21b24ada69.png"><br><br>  Tetapi gagasan untuk secara otomatis mengindeks, mengelompokkan, dan memberi peringkat pada segala sesuatu, menjaga agar semuanya selalu mutakhir, cocok dengan paradigma ini dengan lemah.  Bahkan hanya menambahkan metode web untuk menambahkan halaman diperlukan duplikasi dan pemblokiran kode untuk menghindari potensi DDoS. <br><br>  Secara umum, tentu saja, semuanya dapat dilakukan secara serempak, dan dalam metode web, cukup simpan URL untuk memastikan bahwa daemon dahsyat melakukan semua tugas untuk URL dari daftar.  Tapi semua sama, bahkan di sini kata "turn" memohon.  Dan jika antrian diimplementasikan, maka semua tugas dapat dibagi dan dilakukan setidaknya secara tidak sinkron. <br><br><h4>  Solusi </h4><br>  Memperkenalkan antrian dan membuat sistem pemrosesan yang digerakkan oleh peristiwa untuk semua tugas.  Dan untuk waktu yang lama saya ingin mencoba Redis Streams. <br><br><h2>  Menggunakan aliran Redis di PHP </h2><br>  Karena  Saya tidak memiliki kerangka kerja dari tiga raksasa Symfony, Laravel, Yii, dan saya ingin mencari perpustakaan independen.  Tetapi, ternyata (pada pemeriksaan pertama), tidak mungkin menemukan perpustakaan yang serius.  Segala sesuatu yang terkait dengan antrian adalah proyeksi 3 komit lima tahun lalu, atau terikat pada suatu kerangka kerja. <br><br>  Saya telah mendengar tentang Symfony sebagai penyedia beberapa komponen yang berguna, dan saya sudah menggunakan beberapa.  Dan juga dari Laravel, sesuatu juga dapat digunakan, misalnya, ORM mereka, tanpa kehadiran kerangka itu sendiri. <br><br><h4>  symfony / messenger </h4><br>  Kandidat pertama segera tampak ideal, dan tanpa ragu saya memasangnya.  Tapi itu lebih sulit untuk google contoh penggunaan di luar Symfony.  Bagaimana cara mengumpulkan dari tumpukan kelas dengan universal, tidak berbicara nama apa pun, bus untuk mengirim pesan, dan bahkan pada Redis? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2b/1bf/ac0/f2b1bfac07a1e307d7b5826a1b191e3d.png"><br><br>  Dokumentasi di situs resmi cukup rinci, tetapi inisialisasi hanya dijelaskan untuk Symfony menggunakan YML favorit mereka dan metode sihir lainnya untuk non-symphonist.  Saya tidak tertarik dengan proses instalasi, terutama selama liburan Tahun Baru.  Tapi saya harus melakukan ini untuk waktu yang lama. <br><br>  Mencoba mencari cara bagaimana membuat sistem menggunakan sumber Symfony juga bukan tugas yang paling sepele untuk tenggat waktu yang ketat: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc7/de8/991/bc7de89919463a8e7e4bfc5adec9df27.png"><br><br>  Mengaduk-aduk hal ini dan mencoba melakukan sesuatu dengan tangan saya, saya sampai pada kesimpulan bahwa saya sedang melakukan semacam kruk dan memutuskan untuk mencoba sesuatu yang lain. <br><br><h4>  menerangi / mengantri </h4><br>  Ternyata perpustakaan ini terikat erat dengan infrastruktur Laravel dan banyak dependensi lainnya, jadi saya tidak menghabiskan banyak waktu untuk itu: menginstal, melihat, melihat dependensi, dan menghapusnya. <br><br><h4>  yiisoft / yii2-antrian </h4><br>  Nah, ini dia langsung diasumsikan dari namanya, lagi-lagi pengikat ketat untuk Yii2.  Saya harus menggunakan perpustakaan ini dan itu tidak buruk, tapi saya tidak berpikir itu sepenuhnya tergantung pada Yii2. <br><br><h4>  Sisanya </h4><br>  Semua hal lain yang saya temukan di github adalah proyeksi usang dan ditinggalkan yang tidak dapat diandalkan tanpa bintang, garpu dan sejumlah besar komitmen. <br><br><h2>  Kembali ke symfony / messenger, detail teknis </h2><br>  Saya harus berurusan dengan perpustakaan ini dan setelah menghabiskan lebih banyak waktu, saya bisa melakukannya.  Ternyata semuanya cukup ringkas dan sederhana.  Untuk instantiation bus, saya membuat pabrik kecil, karena  Saya punya beberapa ban dengan penangan yang berbeda. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/970/723/ab2/970723ab2c86a6b4adfb35f32208fa76.png"><br><br>  Hanya beberapa langkah: <br><br><ul><li>  Buat penangan pesan yang seharusnya bisa dipanggil <br></li><li>  Bungkus mereka dalam HandlerDescriptor (kelas dari perpustakaan) <br></li><li>  Kami membungkus "Deskriptor" ini dalam contoh HandlersLocator. <br></li><li>  Tambahkan HandlerLocator ke instance MessageBus <br></li><li>  Kami memberikan kepada SendersLocator seperangkat `SenderInterface`, dalam kasus saya contoh dari kelas` RedisTransport`, yang dikonfigurasi dengan cara yang jelas. <br></li><li>  Tambahkan SendersLocator ke instance MessageBus <br></li></ul><br>  MessageBus memiliki metode `-&gt; dispatch ()`, yang mencari penangan yang tepat di HandlersLocator dan meneruskan pesan kepada mereka, menggunakan `SenderInterface` yang sesuai untuk mengirim melalui bus (Redis stream). <br><br>  Dalam konfigurasi wadah (dalam hal ini php-di), seluruh kumpulan ini dapat dikonfigurasi sebagai berikut: <br><br><pre><code class="php hljs">CONTAINER_REDIS_TRANSPORT_SECRET =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisTransport( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_SECRET), $c-&gt;get(CONTAINER_SERIALIZER)) ; }, CONTAINER_REDIS_TRANSPORT_LOG =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisTransport( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_LOG), $c-&gt;get(CONTAINER_SERIALIZER)) ; }, CONTAINER_REDIS_STREAM_RECEIVER_SECRET =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisReceiver( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_SECRET), $c-&gt;get(CONTAINER_SERIALIZER) ); }, CONTAINER_REDIS_STREAM_RECEIVER_LOG =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisReceiver( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_LOG), $c-&gt;get(CONTAINER_SERIALIZER) ); }, CONTAINER_REDIS_STREAM_BUS =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ $sendersLocator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendersLocator([ \App\Messages\SecretJsonMessages::class =&gt; [CONTAINER_REDIS_TRANSPORT_SECRET], \App\Messages\DaemonLogMessage::class =&gt; [CONTAINER_REDIS_TRANSPORT_LOG], ], $c); $middleware[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessageMiddleware($sendersLocator); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageBus($middleware); }, CONTAINER_REDIS_STREAM_CONNECTION_SECRET =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ $host = <span class="hljs-string"><span class="hljs-string">'bu-02-redis'</span></span>; $port = <span class="hljs-number"><span class="hljs-number">6379</span></span>; $dsn = <span class="hljs-string"><span class="hljs-string">"redis://$host:$port"</span></span>; $options = [ <span class="hljs-string"><span class="hljs-string">'stream'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'secret'</span></span>, <span class="hljs-string"><span class="hljs-string">'group'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'consumer'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Connection::fromDsn($dsn, $options); }, CONTAINER_REDIS_STREAM_CONNECTION_LOG =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ $host = <span class="hljs-string"><span class="hljs-string">'bu-02-redis'</span></span>; $port = <span class="hljs-number"><span class="hljs-number">6379</span></span>; $dsn = <span class="hljs-string"><span class="hljs-string">"redis://$host:$port"</span></span>; $options = [ <span class="hljs-string"><span class="hljs-string">'stream'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'log'</span></span>, <span class="hljs-string"><span class="hljs-string">'group'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'consumer'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Connection::fromDsn($dsn, $options); },</code> </pre> <br>  Dapat dilihat bahwa di SendersLocator kami menetapkan "transport" yang berbeda untuk dua pesan yang berbeda, masing-masing memiliki koneksi sendiri ke stream yang sesuai. <br><br>  Saya membuat proyek demo terpisah yang menunjukkan aplikasi tiga setan berkomunikasi satu sama lain menggunakan bus semacam itu: <a href="https://github.com/backend-university/products/tree/master/products/02-redis-streams-bus">https://github.com/backend-university/products/tree/master/products/02-redis-streams-bus</a> . <br><br>  Tetapi saya akan menunjukkan kepada Anda bagaimana konsumen dapat diatur: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">DaemonLogMessage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>\<span class="hljs-title"><span class="hljs-title">HandlerDescriptor</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>\<span class="hljs-title"><span class="hljs-title">HandlersLocator</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">MessageBus</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Middleware</span></span>\<span class="hljs-title"><span class="hljs-title">HandleMessageMiddleware</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Middleware</span></span>\<span class="hljs-title"><span class="hljs-title">SendMessageMiddleware</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Transport</span></span>\<span class="hljs-title"><span class="hljs-title">Sender</span></span>\<span class="hljs-title"><span class="hljs-title">SendersLocator</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../vendor/autoload.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \Psr\Container\ContainerInterface $container */</span></span> $container = <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'config/container.php'</span></span>); $handlers = [ DaemonLogMessage::class =&gt; [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlerDescriptor( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DaemonLogMessage $m)</span></span></span><span class="hljs-function"> </span></span>{ \error_log(<span class="hljs-string"><span class="hljs-string">'DaemonLogHandler: message handled: / '</span></span> . $m-&gt;getMessage()); }, [<span class="hljs-string"><span class="hljs-string">'from_transport'</span></span> =&gt; CONTAINER_REDIS_TRANSPORT_LOG] ) ], ]; $middleware = []; $middleware[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandleMessageMiddleware(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlersLocator($handlers)); $sendersLocator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendersLocator([<span class="hljs-string"><span class="hljs-string">'*'</span></span> =&gt; [CONTAINER_REDIS_TRANSPORT_LOG]], $container); $middleware[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessageMiddleware($sendersLocator); $bus = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageBus($middleware); $receivers = [ CONTAINER_REDIS_TRANSPORT_LOG =&gt; $container-&gt;get(CONTAINER_REDIS_STREAM_RECEIVER_LOG), ]; $w = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Symfony\Component\Messenger\Worker($receivers, $bus, $container-&gt;get(CONTAINER_EVENT_DISPATCHER)); $w-&gt;run();</code> </pre><br><h2>  Menggunakan infrastruktur ini dalam suatu aplikasi </h2><br>  Setelah menerapkan bus di backend saya, saya memilih langkah-langkah individu dari tim sinkron lama dan membuat penangan terpisah, yang masing-masing terlibat dalam bisnisnya sendiri. <br><br>  Pipa untuk menambahkan situs baru ke database adalah sebagai berikut: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1a/ccf/202/f1accf2020c51b0ae5e5c39033d7d375.png"><br><br>  Dan tepat setelah itu menjadi lebih mudah bagi saya untuk menambahkan fungsionalitas baru, misalnya, mengekstraksi dan mem-parsing Rss.  Karena  Karena proses ini juga memerlukan konten sumber, penangan-ekstraktor dari tautan rss, serta WebsiteIndexHistoryPersistor, berlangganan pesan "Content / HtmlContent", memprosesnya, dan meneruskan pesan yang diinginkan pada pipeline lebih lanjut. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8cc/641/d52/8cc641d52b4a394c5381967360187ab0.png"><br><br>  Pada akhirnya, ternyata beberapa setan, yang masing-masing hanya memiliki koneksi ke sumber daya yang diperlukan.  Sebagai contoh, daemon <i>perayap</i> berisi semua penangan yang perlu pergi ke Internet untuk konten, dan daemon <i>persister</i> menjaga koneksi ke database. <br><br>  Sekarang, alih-alih memilih dari database, id yang diperlukan setelah dimasukkan oleh persister hanya dilewatkan melalui bus ke semua penangan yang tertarik. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id483584/">https://habr.com/ru/post/id483584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id483568/index.html">Membuat komputer primitif dari awal</a></li>
<li><a href="../id483570/index.html">Tetapi bagaimana jika bumi itu rata?</a></li>
<li><a href="../id483574/index.html">Analisis Keandalan Peralatan Elektronik Shock dan Getaran - Tinjauan Umum</a></li>
<li><a href="../id483578/index.html">Berita dari dunia OpenStreetMap No. 493 (12.24.2019 - 12.30.2019)</a></li>
<li><a href="../id483580/index.html">VIM - Ini bukan hanya editor, ini adalah integrasi dengan semua lingkungan kerja Anda</a></li>
<li><a href="../id483586/index.html">Dasar-dasar bekerja dengan zmq dalam python, membuat penyimpanan kunci / nilai sederhana</a></li>
<li><a href="../id483588/index.html">Cara mencoba memblokir situs apa pun menggunakan ILV</a></li>
<li><a href="../id483590/index.html">Cari kesalahan FDCAN yang tidak</a></li>
<li><a href="../id483594/index.html">Ekonomi masa depan untuk fisikawan</a></li>
<li><a href="../id483598/index.html">Bahkan lebih banyak telur Paskah yang musikal: kami terus berbicara tentang hadiah untuk pendengar yang penuh perhatian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>