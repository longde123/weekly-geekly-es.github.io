<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòú üë©üèΩ‚Äçü§ù‚Äçüë®üèº üî¢ CSTroN: un monitor casero en una matriz CSTN cl√°sica con una entrada VGA y una placa de control FPGA üë©‚Äç‚ù§Ô∏è‚Äçüë® üë©üèΩ‚Äçü§ù‚Äçüë©üèº üñ®Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øQu√© pasa si nunca se inventaron TFT? LCD de matriz CSTN 

 Entrada 
 Cuando prevalecieron los monitores CRT, se present√≥ el siguiente argumento a su ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CSTroN: un monitor casero en una matriz CSTN cl√°sica con una entrada VGA y una placa de control FPGA</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444762/"><img src="https://habrastorage.org/webt/ts/vw/uo/tsvwuobygirooozzafy1gnmiiua.jpeg"><br><br>  ¬øQu√© pasa si nunca se inventaron TFT?  LCD de matriz CSTN <br><br><h1>  Entrada </h1><br>  Cuando prevalecieron los monitores CRT, se present√≥ el siguiente argumento a su favor: a pesar de todas las mejoras, las pantallas LCD nunca superar√°n las pantallas de tubo en calidad de imagen.  Ellos, como antes, encontrar√°n aplicaci√≥n solo donde se requiera eficiencia energ√©tica y peque√±o espesor [1].  Han pasado d√©cadas, y ahora sabemos si los partidarios de este argumento ten√≠an raz√≥n.  Pero hoy es interesante mirar las pantallas LCD de esa √©poca: ¬øson realmente tan de baja calidad?  ¬øC√≥mo es mirar la matriz CSTN en 2019? <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/fm/yv/rf/fmyvrfvnpiqfyih0abovza8tn-m.jpeg"><br><br>  <i>TFT izquierda, CSTN derecha, ambas pantallas de los noventa</i> <br><br><h1>  LCD en el siglo pasado </h1><br>  Antes de cambiar a TFT, se utilizaron una variedad de tecnolog√≠as de visualizaci√≥n en las computadoras port√°tiles.  Al principio, usaron los mismos monitores CRT que en las computadoras de escritorio, solo que los m√°s peque√±os.  Por ejemplo, en Compaq Portable (1983), IBM 5155 (1984) o Commodore SX-64 (tambi√©n 1984). <br><br><img src="https://habrastorage.org/webt/ge/nb/za/genbzaejmhqeermw61pdxau4nli.jpeg"><br><br>  <i>IBM 5155, autor: Soupmeister, con licencia: CC-BY-SA-2.0, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desde aqu√≠</a></i> <br><br>  Llevar una PC con usted a todas partes fue dif√≠cil, una cosa completamente diferente: una computadora port√°til con una TN-LCD (giro nem√°tico), por ejemplo, IBM 5140 (1986), Toshiba T1000 (1987).  Estas pantallas tienen bajo contraste y √°ngulo de visi√≥n. <br><br><img src="https://habrastorage.org/webt/ee/u8/xr/eeu8xrwciq0nl2cl6z8cha0zu5u.jpeg"><br><br>  <i>Toshiba T1100 con pantalla TN monocroma, autor: Johann H. Addicks, licencia: GFDL, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">por lo tanto</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el</a> enlace est√° roto, tambi√©n en el original</i> <br><br>  Algunos fabricantes experimentaron con matrices de descarga de gas, ya que Toshiba T3200 (1987) e IBM PS / 2 P70 (1991) vieron la luz del d√≠a.  Proporcionaron un alto contraste y varias gradaciones de brillo de luz rojo-naranja, pero eran bastante caros.  Finalmente, se desarrollaron STN-LCD (supertwist nematic), como, por ejemplo, en Electronics MC1504 y su prototipo Toshiba T1100.  El contraste fue mucho mejor: de 1: 5 a 1:50, y varias gradaciones de brillo fueron suficientes para las aplicaciones comerciales (usar una computadora port√°til en la vida cotidiana todav√≠a era demasiado costoso).  Pero, ¬øqu√© pasa si el usuario quiere una imagen en color?  En este caso, le ofrecieron dos tecnolog√≠as: TFT y CSTN (supertwist de color nematic).  La primera computadora port√°til con TFT - NEC PC9801NC - se introdujo en 1990, la calidad de imagen para esos a√±os fue sobre todo elogio, pero cost√≥ "tal juguete" es mucho m√°s caro que otras computadoras port√°tiles costosas.  Bueno, una pantalla CSTN es solo una pantalla STN, en la que se superpone un filtro.  Durante mucho tiempo, las computadoras port√°tiles usaron matrices de ambos tipos.  Y en el metro de Nueva York, los monitores CSTN a√∫n funcionan. <br><br><img src="https://habrastorage.org/webt/kk/ch/bd/kkchbdoyuc75xvwabt_3zwmrcp0.jpeg"><br><br>  <i>Uno de ellos, fuente: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Transit + PLUS</a></i> <br><br><h1>  Cstron </h1><br>  El autor quer√≠a mirar la pantalla CSTN.  Como?  Para empezar, solo compre una computadora port√°til vieja y √∫sela.  Result√≥ ser un procesador AMD 5x86-P133.  Es decir, lo m√°s din√°mico que puedes ejecutar son los juegos de DOS (bueno, MPEG1 extraer√° QV - traductor en el programa).  Por supuesto, jugarlos es genial, pero quer√≠a ver c√≥mo se ve YouTube, por ejemplo, o un juego moderno en esa pantalla, pero esto es imposible. <br><br>  O? <br><br>  En general, debe agregarle de alguna manera una entrada VGA o HDMI, y puede enviar una se√±al desde algo moderno.  Las pantallas TFT de las computadoras port√°tiles se vuelven a convertir en monitores con bastante frecuencia.  Simplemente compre un tablero que coincida con la matriz, y ya est√°.  Y puede hacer su propio prefijo en el FPGA, que convierte una se√±al VGA o HDMI en un flujo de datos de p√≠xeles. <br><br>  √ârase una vez, tambi√©n se produjeron placas para convertir matrices CSTN en monitores VGA, pero esto ya no se encuentra.  Pero puede adaptar la placa de depuraci√≥n para FPGA ML505 para esto. <br><br><img src="https://habrastorage.org/webt/ts/vw/uo/tsvwuobygirooozzafy1gnmiiua.jpeg"><br><br>  <i>El resultado final.</i>  <i>Es bastante inusual observar esto en una pantalla CSTN: 16 GB de RAM.</i> <br><br><h1>  Gesti√≥n de matrices </h1><br>  Comencemos con lo b√°sico.  Al igual que cualquier pantalla de matriz, la pantalla CSTN tiene filas y columnas.  ¬øAlguna vez has controlado una matriz LED desde un microcontrolador?  Aqu√≠ es lo mismo, pero los voltajes son variables.  Debe aplicar ciertas se√±ales a las filas y columnas seleccionadas y no seleccionadas, y el p√≠xel en la intersecci√≥n de la fila y columna seleccionadas mostrar√° lo que necesita.  La forma de las se√±ales es muy compleja, el valor cuadrado medio del voltaje, el cambio de fase entre los voltajes en la fila y la columna, y el desplazamiento ... Y as√≠, p√≠xel por p√≠xel, se forma una imagen. <br><br>  Afortunadamente, no se requieren FPGA para generar todas estas se√±ales, e incluso en una cantidad tan grande de l√≠neas.  Todo esto lo hace el m√≥dulo integrado en la pantalla.  All√≠, el convertidor de pulso aumenta el voltaje constante, pasa a trav√©s del divisor y el repetidor, por lo que se obtiene el voltaje de polarizaci√≥n.  Los controladores de fila y columna convierten este voltaje en una variable de la forma requerida.  Todo lo que se requiere es enviar una secuencia de datos de estado de p√≠xeles al m√≥dulo de visualizaci√≥n. <br><br>  En un TFT-LCD con una interfaz DPI (interfaz paralela digital), todos los datos sobre un p√≠xel llegan de una vez en un ciclo.  En la l√≠nea de sincronizaci√≥n horizontal y de trama, se reciben pulsos despu√©s de cada l√≠nea y trama, respectivamente.  Los p√≠xeles simplemente se transmiten continuamente l√≠nea por l√≠nea, cuadro por cuadro.  Si la transmisi√≥n de fotograma completo tarda 1/60 s, la frecuencia de actualizaci√≥n es de 60 Hz.  El ancho del bus de datos es igual a la profundidad de color en bits, generalmente 16 (5 bits para rojo y azul, 6 para verde), 18 (6 bits para cada color) o 24 (8 bits para cada color).  LVDS es lo mismo, solo los bits no se transmiten en paralelo, sino secuencialmente en pares diferenciales, pero en MIPI DSI tambi√©n se combinan en paquetes.  El bus SPI / i80 le permite transmitir varios comandos al controlador y, al ejecutarlos, genera se√±ales para DPI o una interfaz similar.  Lo que, a su vez, recuerda un poco a VGA, solo los datos sobre el brillo de cada uno de los colores no se reciben en forma anal√≥gica, sino digital.  Hay convertidores de VGA a DPI y viceversa.  Las placas son muy convenientes, ya que le permiten recibir una se√±al VGA de la Raspberry Pi, aunque inicialmente esta computadora solo produce HDMI y video compuesto. <br><br>  Las se√±ales muy similares a las suministradas a una matriz TFT con una interfaz DPI se deben suministrar al m√≥dulo de visualizaci√≥n de la matriz CSTN.  La hoja de datos del SX21V001 [2] muestra c√≥mo controlar una pantalla CSTN con una resoluci√≥n de 640x480: <br><br><img src="https://habrastorage.org/webt/ga/au/fu/gaaufudmnscsyjt2mj89ir2hj-g.png"><br><br>  Esto muestra la transferencia de todo el marco.  La se√±al llega a la l√≠nea CL1 despu√©s de cada l√≠nea, a FLM despu√©s de cada trama.  Y hay un bus de datos de 16 l√≠neas.  En realidad, se cometi√≥ un error en esta figura: durante la transmisi√≥n de las l√≠neas primera y segunda, los datos Y1 e Y2, y no X1 y X2, sino Y140 e Y242, respectivamente, se reciben en las l√≠neas UD0-UD7.  Aqu√≠ U y L son, respectivamente, superior e inferior, es decir, la pantalla consta de dos matrices con una resoluci√≥n de 640x240, ubicadas una encima de la otra.  Aqu√≠ est√°, el misterioso "escaneo dual" de un viejo anuncio de computadora port√°til, del cual proviene una franja horizontal en toda la pantalla.  Para las pantallas STN y CSTN, el contraste es inversamente proporcional al n√∫mero de l√≠neas, por lo que esta separaci√≥n permite aumentarlo.  Pero esta no es la √∫nica forma en que difieren en la forma en que se controlan desde el TFT. <br><br><img src="https://habrastorage.org/webt/po/cu/_2/pocu_2wfevtfpev7hbuapasb2va.png"><br><br>  No est√° claro por qu√© el eje horizontal se llamaba Y ... En cualquier caso, CL2 aqu√≠ es una l√≠nea para suministrar pulsos de reloj que cambian p√≠xeles.  Pero en los buses UD y LD en un ciclo, no se transmiten datos sobre un p√≠xel de m√∫ltiples bits, como en TFT, sino datos sobre varios p√≠xeles a la vez, tres bits cada uno.  Un bit por color, tres bits por p√≠xel: ocho colores en total. <br><br><img src="https://habrastorage.org/webt/ur/dr/6u/urdr6uzrqstflu-gy2r5q-opazy.jpeg"><br><br>  Pero como es eso?  Est√° claro que las pantallas CSTN tienen pocos colores, por ejemplo, 4096 o 32768, pero no 8.  Resulta que PWM se aplica aqu√≠.  Los LED se controlan de esta manera, lo que significa que los p√≠xeles de LCD son posibles.  Necesita, por ejemplo, un brillo del 50%: encienda el p√≠xel en cuadros pares y ap√°guelo en cuadros impares.  Este m√©todo se llama FRC (control de velocidad de cuadro), pero PWM en este contexto se llama control de brillo de p√≠xeles de la misma manera, pero dentro de dos o m√°s cuadros, pero uno.  FRC implementa un dispositivo externo, y PWM implementa chips de m√≥dulos de pantalla, si hay soporte para esta funci√≥n.  El autor no conoce las pantallas CSTN con PWM, pero sugiere que estas son matrices de tipo HPA.  En cualquier caso, dado que PWM no est√° disponible, se puede obtener la profundidad de color necesaria utilizando FRC. <br><br><img src="https://habrastorage.org/webt/2s/fv/ui/2sfvuishe3qnnb9fytk4mmbthju.jpeg"><br><br>  El parpadeo ser√° el precio de esto, por lo que se pueden encontrar velocidades de cuadro monstruosas (en comparaci√≥n con TFT) en las pantallas CSTN.  Por ejemplo, este m√≥dulo inicialmente ten√≠a 120 Hz, y el autor lo aceler√≥ a 240. <br><br><h1>  C√≥mo se implement√≥ </h1><br>  El desarrollador enfrent√≥ varias dificultades a la vez: <br><br>  - la se√±al de entrada tiene una velocidad de cuadro de 60 Hz, debe duplicarse o incluso cuadruplicarse <br><br>  - en la se√±al de entrada, el cuadro no se divide en mitades superior e inferior de 640x240 p√≠xeles cada una, pero aqu√≠ es necesario dividir <br><br>  - tambi√©n necesita implementar FRC, de lo contrario la profundidad de color ser√° de 3 bits por p√≠xel <br><br>  Los primeros dos puntos significan que se necesita un framebuffer, y no uno simple, sino uno de dos puertos.  Bueno, la tercera tarea se resuelve utilizando GLDP LUT (tabla de b√∫squeda de patrones de visualizaci√≥n en escala de grises) [3].  La tabla de b√∫squeda tiene dos tipos de datos de entrada: el color que se mostrar√° y el estado del contador de cuadros.  Y un tipo de salida: esos tres bits que deben enviarse a los subp√≠xeles de un p√≠xel dado en un momento dado.  Por lo tanto, se requerir√°n los siguientes nodos: <br><br><img src="https://habrastorage.org/webt/fi/lx/4-/filx4-nrwyepv-5jjdvjd5jvgh0.png"><br><br>  Lo primero que debe hacer es llenar toda la pantalla con algo de color.  En esta etapa, no es necesario saber d√≥nde se encuentra el p√≠xel, es suficiente para asegurarse de que el m√≥dulo de visualizaci√≥n entregue las se√±ales de forma necesarias a la matriz.  El c√≥digo para completar el FPGA est√° <a href="">aqu√≠</a> . <br><br><img src="https://habrastorage.org/webt/_m/ux/-q/_mux-qskx5al8bielsybiavnvba.jpeg"><br><br>  Ahora intenta sacar algo y con un brillo incompleto tambi√©n.  Buscando tablas de b√∫squeda de FRC para minimizar el parpadeo.  Al autor se le ocurrieron dos tablas aplicadas a p√≠xeles en un patr√≥n de tablero de ajedrez.  Por lo tanto, cada dos p√≠xeles vecinos parpadean de forma asincr√≥nica.  El codigo esta <a href="">aqui</a> . <br><br><img src="https://habrastorage.org/webt/f2/vl/n9/f2vln9pc18h0txrwkm632snrlns.jpeg"><br><br>  Entonces, ya hemos "ense√±ado" al tablero a mostrar la imagen, lo siguiente que se requerir√° es un framebuffer.  Con 640x480 y 5 bits para cada uno de los colores, su volumen ser√° de unos 600 kilobytes.  No mucho, pero muchos en FPGA.  Bueno, la placa tiene RAM como DDR2 y Xilinx MIG para controlarlo.  Se implementan dos FIFO, uno para lectura y otro para escritura.  El √°rbitro decide si el pr√≥ximo intercambio de datos con DDR2 es de lectura o escritura.  Hay dos buffers, el registro va a uno, se lee del otro, y cuando cambian los marcos, cambian de lugar.  El c√≥digo del √°rbitro est√° <a href="">aqu√≠</a> . <br><br>  Queda por implementar la captura de video, en uno de los proyectos anteriores, el autor ya tiene un tiempo de funcionamiento similar, despu√©s del refinamiento, el c√≥digo para el convertidor de VGA a DPI se ha vuelto <a href="">as√≠</a> . <br><br><h1>  Y que paso </h1><br>  M√≠ralo! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/hsehw-7-VTM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Este es el tercer proyecto FPGA para el autor, fue interesante trabajar con Xilinx MIG y DDR2, as√≠ como con un transportador simple.  Se planea un mejor FRC con modulaci√≥n delta sigma, as√≠ como experimentos con paneles CSTN posteriores utilizando la tecnolog√≠a HPA (direccionamiento de alto rendimiento) de Sharp. <br><br>  Gracias por su atencion! <br><br><h1>  Fuentes </h1><br>  1. Li, W. y Guo, Q. (2000).  Tecnolog√≠a de aplicaci√≥n de pantalla de cristal l√≠quido.  Beijing: prensa de la industria el√©ctrica. <br><br>  2. HITACHI (1999).  SX21V001-Z4 Especificaciones de aceptaci√≥n del cliente. <br><br>  3. Hsueh, Y. y Lee, J. (2008).  M√©todo de mejora de imagen para el controlador de velocidad de fotogramas LCD.  Simposio internacional IEEE 2008 sobre electr√≥nica de consumo.  doi: 10.1109 / isce.2008.4559534 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/444762/">https://habr.com/ru/post/444762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444748/index.html">3 cualidades clave de un gerente de producto exitoso: Yuri Golikov, VP de Ingenier√≠a Wrike</a></li>
<li><a href="../444752/index.html">La historia de SXSW: c√≥mo comenz√≥ todo</a></li>
<li><a href="../444756/index.html">DARPA desarrollar√° un motor nuclear de cohete</a></li>
<li><a href="../444758/index.html">Diferencias t√©cnicas de los sistemas de BI (Power BI, Qlik Sense, Tableau)</a></li>
<li><a href="../444760/index.html">M√°quina CNC de lo que yac√≠a en el garaje</a></li>
<li><a href="../444764/index.html">Criptograf√≠a en Java</a></li>
<li><a href="../444766/index.html">Los empleados de Facebook ten√≠an acceso a las contrase√±as de usuario de Facebook e Instagram</a></li>
<li><a href="../444768/index.html">Reducci√≥n de la dependencia de datos etiquetados para redes de contenci√≥n generativa</a></li>
<li><a href="../444770/index.html">C√≥mo buscamos una fuga de datos en SimilarWeb</a></li>
<li><a href="../444774/index.html">Error con la migraci√≥n de ru-RU locale en Google Chrome y c√≥mo deshacerse de ella</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>