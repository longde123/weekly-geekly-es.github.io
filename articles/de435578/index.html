<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõå ‚ìÇÔ∏è üë®üèΩ‚Äç‚öñÔ∏è Weltraumspaziergang zu Weihnachten üè© üñáÔ∏è üé†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 

 Kurz vor Weihnachten wurde beschlossen, Spacewalk in der IT-Abteilung zu studieren - dies ist das Red Hat-System, ein kostenloses Analo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Weltraumspaziergang zu Weihnachten</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435578/"> Hallo Habr! <br><br>  Kurz vor Weihnachten wurde beschlossen, Spacewalk in der IT-Abteilung zu studieren - dies ist das Red Hat-System, ein kostenloses Analogon von Satellite, f√ºr zentrales Konfigurationsmanagement, Systemaktualisierungen und bequemen Support f√ºr den gesamten Serverpark. <br><br>  Aufgrund der Tatsache, dass die auf der offiziellen Website verf√ºgbare Dokumentation f√ºr zus√§tzliche Kommentare zu verschiedenen Arten der Fehlerbehebung eher knapp ist, bestand die Aufgabe darin, das Produkt f√ºr seine schrittweise Einf√ºhrung zun√§chst in Testserver und anschlie√üend in Produkte zu untersuchen. <br><br>  Die Hauptidee bei der Einf√ºhrung von Spacewalk war nicht nur die Zentralisierung und Vereinfachung der Steuerung, sondern auch, dass niemand mit spielerischen Stiften Updates auf den Servern des neuen Projekts abspielen konnte, da es bereits Pr√§zedenzf√§lle gab. <br><br>  Nach zweiw√∂chiger Arbeit wurde das gesamte Wissen, das ich erhielt, in das interne Analogon von Confluence eingegeben, und ein freier Tag veranlasste mich, einen Artikel √ºber Habr zu schreiben. <br><a name="habracut"></a><br>  Bevor ich anfange, m√∂chte ich kurz hervorheben, was betroffen war und was nicht, um mich nicht f√ºr das vollst√§ndige Handbuch f√ºr die Arbeit mit Spacewalk zu qualifizieren: <br><br>  + Installation und Konfiguration des Servers / Clients <br>  + Systemeinrichtung in der GUI <br>  + Fehlerbehebung bei Installations- / Update-Paketen, Arbeiten mit Konfigurationen <br>  + Errata (Sammeln von Informationen zu kritischen Updates, Schwachstellen usw.) <br><br>  - Proxy (die Notwendigkeit verschwand, nachdem HA aufgegeben wurde) <br>  - Schuster / Kickstart <br>  - OpenSCAP <br><br><h3>  Systemanforderungen </h3><br>  Aufgrund der Tatsache, dass die gesamte Infrastruktur auf VMWare ausgef√ºhrt wird, wurden die Arbeiten auf einer VM ausgef√ºhrt, auf der CentOS 7 ausgef√ºhrt wird. Empfohlene Systemanforderungen des Entwicklers sind: <br><br><ul><li>  4 GB RAM </li><li>  6 GB freier Speicherplatz f√ºr / var / Satellit / </li><li>  12 GB f√ºr DB </li></ul><br>  Ich habe verwendet: <br><br><ul><li>  6 GB RAM </li><li>  4 CPU (s) </li><li>  40 GB Festplatte </li></ul><br>  Ich rate Ihnen auch, SELinux zu deaktivieren und, falls Sie Firewalld nicht verwenden, diese zu verwenden.  Oder f√ºgen Sie den http-Dienst zu den Ausnahmen hinzu. <br><br>  Hinweis: Am Ende des Artikels befinden sich Playbooks f√ºr Ansible, sowohl f√ºr den Client- als auch f√ºr den Serverteil, sowie Bash-Skripte.  Mit ihrer Hilfe k√∂nnen Sie die gesamte Infrastruktur in wenigen Minuten bereitstellen. <br><br><h3>  Installation </h3><br>  Die Installation selbst ist sowohl in der offiziellen Dokumentation als auch an mehreren Stellen beschrieben. Um die Integrit√§t des Artikels zu gew√§hrleisten, m√∂chte ich diesen Punkt hier erw√§hnen. <br><br>  Spacewalk arbeitet mit zwei DBMS: PostgreSQL und Oracle RDBMS.  Ich habe Erfahrung mit dem ersten und werde es jetzt verwenden. <br><br>  Es gibt zwei Installationsoptionen: sowohl √ºber das automatische Installationsprogramm von Spacewalk, das sich selbst und die Datenbank installiert und konfiguriert, jedoch auf demselben Server, als auch √ºber die manuelle Installation, bei der Sie die Datenbank und die Anwendung auf verschiedenen Servern ablegen k√∂nnen.  Ich werde beide Optionen in Betracht ziehen und mit einer separaten Installation beginnen. <br><br><h4>  PostgreSQL </h4><br><pre><code class="bash hljs">yum install -y postgresql-server</code> </pre> <br>  Es ist auch erforderlich, PL / Tcl-Module f√ºr PG anzuschlie√üen: <br><br><pre> <code class="bash hljs">yum install -y postgresql-pltcl postgresql-setup initdb systemctl start postgresql</code> </pre> <br>  Erstellen Sie eine Datenbank, einen Benutzer und verbinden Sie das Modul: <br><br><pre> <code class="bash hljs">su - postgres -c <span class="hljs-string"><span class="hljs-string">'PGPASSWORD=verystrong; createdb spcwlkdb ; createlang plpgsql spcwlkdb ; createlang pltclu spcwlkdb ; yes $PGPASSWORD | createuser -P -sDR spcwlkuser'</span></span></code> </pre> <br>  Um Verbindungsprobleme zu vermeiden, sollten Sie <i>/var/lib/pgsql/data/pg_hba.conf</i> √§ndern und die Zeilen VOR der Zeile alle hinzuf√ºgen: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb spcwlkuser md5 host spcwlkdb spcwlkuser 127.0.0.1/8 md5 <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> spcwlkdb postgres ident</code> </pre> <br>  Starten Sie alles neu: <br><br><pre> <code class="bash hljs">systemctl restart postgresql</code> </pre> <br>  Wenn Sie die Anwendung und die Datenbank auf verschiedenen Servern installieren <i>m√∂chten</i> , stellen Sie sicher, dass das Paket <i>postgresql-contrib</i> auf dem Datenbankserver installiert ist. <br><br><h4>  Weltraumspaziergang </h4><br>  Wir verbinden Repositories: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm</code> </pre> <br>  Verbinden Sie auch epel: <br><br><pre> <code class="bash hljs">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code> </pre> <br>  Java: <br><br><pre> <code class="bash hljs">(<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo)</code> </pre> <br>  Jetzt direkt das Installationsprogramm f√ºr Spacewalk-postgres: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql</code> </pre> <br>  Stellen Sie eine Verbindung zu unserer Datenbank her: <br><br><pre> <code class="bash hljs">spacewalk-setup-postgresql create --db spcwlkdb --user spcwlkuser --password verystrong</code> </pre> <br>  <i>Wenn</i> Sie eine separate Datenbank- / Anwendungsmethode verwenden, m√ºssen Sie das Flag <i>--standalone</i> hinzuf√ºgen und die IP-Adresse des Datenbankservers angeben. Vergessen Sie auch nicht, Port 5432 zu √∂ffnen. <br><br>  <i>Hinweis: Ich empfehle, die Datenbank entsprechend Ihrer Hardware zu optimieren, um einen produktiveren Betrieb des gesamten Systems zu gew√§hrleisten.</i> <br><br>  Installieren Sie nun Spacewalk selbst und f√ºhren Sie die Installation aus: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-postgresql spacewalk-setup --external-postgresql</code> </pre> <br>  Als n√§chstes werden mehrere Fragen gestellt, sowohl zum SSL-Zertifikat als auch zur Datenbank.  Sie k√∂nnen alle Werte manuell eingeben oder das <i>Flag --answer-file</i> verwenden und den Pfad zur Datei mit den Antworten angeben, um die Installation in Zukunft zu automatisieren: <br><br><pre> <code class="bash hljs">admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = HMP ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-tftp=Y</code> </pre> <br>  Um die Anwendung direkt zu steuern, sollten Sie Folgendes verwenden: <br><br><pre> <code class="bash hljs">/usr/sbin/spacewalk-service [stop|start|restart]</code> </pre> <br>  So zeigen Sie alle Dienste von Drittanbietern an, die zur Anwendung beitragen: <br><br><pre> <code class="bash hljs">spacewalk-service status</code> </pre> <br><h4>  Option Zwei, automatische Installation </h4><br>  Richten Sie nach dem Verbinden der Repositorys Folgendes ein und f√ºhren Sie es aus: <br><br><pre> <code class="bash hljs">yum -y install spacewalk-setup-postgresql yum -y install spacewalk-postgresql spacewalk-setup</code> </pre> <br>  Auch hier werden Fragen zur Datenbank und zu SSL gestellt. Wir verwenden den Schl√ºssel <i>--answer-file</i> und den Pfad zur Datei mit den Antworten. <br><br><h3>  Basis- und Kinderkan√§le, Repos </h3><br>  F√ºr die Verwaltung von Client-Stationen verwendet Spacewalk ein System sogenannter Kan√§le, die entweder main (child) oder child (child) sein k√∂nnen. Jedem Kanal ist ein Repository zugeordnet, das Sie ben√∂tigen, sowie ein Schl√ºssel, mit dem der Client gekoppelt ist Server. <br><br>  Infolgedessen werden Repositorys mit Kan√§len synchronisiert, die wiederum mit Clients verbunden sind, und Spacewalk funktioniert im Allgemeinen.  Erw√§hnenswert sind auch Errata, die an Kan√§le gebunden werden k√∂nnen, was die Aktualisierung und Paketkontrolle vereinfacht. <br><br>  Alle Clients k√∂nnen nach verschiedenen Kriterien gruppiert werden, sowohl mit denselben Kan√§len als auch mit unterschiedlichen Kan√§len oder Repositorys. Es ist m√∂glich, mit einer gro√üen Anzahl von Clients gleichzeitig zu arbeiten, wodurch Aktualisierungen auf √ºber 100 Servern durchgef√ºhrt werden k√∂nnen. <br><br>  Eine Liste aller installierten Pakete ist verf√ºgbar und kann nach der Synchronisierung der Repositorys installiert werden.  Einige Punkte sind intuitiv und es macht keinen Sinn, jedes Element Zeile f√ºr Zeile zu betrachten. <br><br>  Alle Aktionen in Spacewalk finden nach einem Zeitplan (Zeitplan) statt. Fast jede Aktion kann f√ºr die Zeit konfiguriert werden, die f√ºr Sie am bequemsten ist. <br><br>  Nach der Installation k√∂nnen Sie zur Adresse Ihres Servers gehen und die weitere Konfiguration √ºber die grafische Oberfl√§che vornehmen: <br><br><img src="https://habrastorage.org/webt/bb/iq/co/bbiqcow_kswo_i91vsqceeg6g0s.png"><br><br>  Geben Sie das Kennwort, den Administratornamen und den Organisationsnamen ein (dies ist auch eine der M√∂glichkeiten zum Verwalten von Clients) und rufen Sie das Startfenster auf. <br><br>  Im Moment k√∂nnen Sie entweder die verf√ºgbaren Optionen selbst erkunden oder Kan√§le erstellen. <br><br>  <i>Kan√§le - Software-Kan√§le verwalten - Kanal erstellen:</i> <br><br><img src="https://habrastorage.org/webt/5m/6o/f9/5m6of99m6ey7yq0rxbdmenvhcuw.png"><br><br>  Ich empfehle, die Kanalnamen entsprechend den Typen und dem Typ des Betriebssystems <i>festzulegen</i> , das an diesen Kanal gebunden wird, z. B. <i>CentOS_7_x86_64</i> . Sie k√∂nnen sicher sha256 als Pr√ºfung ausw√§hlen. Das Feld Kanalzusammenfassung ist f√ºr eine kleine Beschreibung des Kanals vorgesehen.  Optional k√∂nnen Sie zus√§tzliche Informationen bereitstellen. <br><br>  Erstellen Sie nun einen untergeordneten Kanal und binden Sie ihn an den Hauptkanal.  Wir gehen genauso vor wie beim Erstellen des Hauptkanals, nur geben wir im Feld Elternkanal den zuvor erstellten Kanal an. <br><br>  Binden Sie die Repositories an die Haupt- und Nebenkan√§le. <br>  <i>Kan√§le - Repositorys verwalten</i> <br><br><img src="https://habrastorage.org/webt/a3/gq/ok/a3gqokxrwd10mlfq4geiw0f1nqy.png"><br><br>  F√ºr die Hauptkan√§le verwende ich Basisressourcen, f√ºr die Nebenkan√§le - Updates. <br><br>  Nachdem Sie die Repositorys erstellt haben, m√ºssen Sie sie mit den Kan√§len verbinden. <br>  <i>Kan√§le - Verwalten Sie Softwarekan√§le</i> , √∂ffnen Sie Ihren Hauptkanal und √∂ffnen Sie den Abschnitt Repositorys. <br><br><img src="https://habrastorage.org/webt/hw/ro/og/hwroogjvybx0p1z2mslzxf8nunq.png"><br><br>  Es werden alle erstellten Repositorys angezeigt. W√§hlen Sie das gew√ºnschte aus, markieren Sie es und klicken Sie auf Ressourcen aktualisieren. <br><br>  √ñffnen Sie als N√§chstes den Unterschl√ºssel Synchronisieren: <br><br><img src="https://habrastorage.org/webt/ho/j7/4m/hoj74mhjkorduvftwkwbteuxzk4.png"><br><br>  Wenn Sie das Repository und den Kanal synchronisieren k√∂nnen, konfigurieren Sie den Zeitplan f√ºr die Synchronisierung. <br><br>  <i>Hinweis: Bei verspielten Stiften musste ich das Standard-Repository vom Client-System l√∂schen.</i> <br><br><h4>  Client-Installation, Pairing des Clients mit dem Server, Schl√ºsselverwaltung, Einrichten des Konfigurationskanals </h4><br>  Wie bereits erw√§hnt, verwendet Spacewalk ein Schl√ºsselsystem von Red Hat Network, das f√ºr das Pairing und die Verwaltung verwendet wird. <br><br>  Um einen Schl√ºssel zu erstellen, gehen Sie zu <i>Systeme - Aktivierungsschl√ºssel - Schl√ºssel erstellen:</i> <br><br><img src="https://habrastorage.org/webt/ea/df/vf/eadfvfezxpeh1s_lt9blgfox3j8.png"><br><br>  Hier ist alles sehr einfach. Erw√§hnenswert ist, dass Sie den Schl√ºssel selbst einstellen k√∂nnen. Das Format ist immer <i>1-XXXXXX</i> . Au√üerdem ist jeder Schl√ºssel an den Kanal angeschlossen.  Das Universal Default-Flag zwingt neue Systeme, wichtige Parameter zu erfassen. <br><br>  <b>Client-Installation</b> <br><br>  Verbinden Sie das Client-Repository und installieren Sie die erforderlichen Pakete: <br><br><pre> <code class="bash hljs">rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm</code> </pre> <br><br>  <i>Hinweis: Damit die Konfigurationen und die Fernbedienung ordnungsgem√§√ü funktionieren, sind rhncfg-Aktionen und deltarpm erforderlich.</i> <br><br>  Spacewalk synchronisiert den Client-Server mit rhn_check, der alle 4 Stunden ausgef√ºhrt wird.  Dieser Wert kann auf 60 Minuten reduziert werden, aber f√ºr mich war keine der Optionen optimal, daher gibt es zwei Optionen: Verwenden Sie osad, das mit Spacewalk geliefert wird, oder f√ºgen Sie einfach einen Cronjob f√ºr rhn_check hinzu, zum Beispiel f√ºr jede Minute, w√§hrend wir Testen Sie das System, dann kann der Wert nach Belieben ge√§ndert werden. <br><br><pre> <code class="bash hljs">crontab -e * * * * * /usr/sbin/rhn_check</code> </pre> <br>  Es wird auch nicht schaden, / usr / bin / rhn-action-control --enable-all zu Cron hinzuzuf√ºgen, es wird zum Bereitstellen von Konfigurationen verwendet und manchmal wird es langweilig. <br><br>  Wir kehren zur Schl√ºsselverwaltung zur√ºck, kopieren die von uns erstellte Schl√ºssel-ID und f√ºhren Folgendes aus: <br><br><pre> <code class="bash hljs">rhnreg_ks --serverUrl=http://your-server-ip/XMLRPC --activationkey=1-YOURKEY --force</code> </pre> <br>  Vergessen Sie jedoch nicht, die IP- und Schl√ºsselwerte in Ihre eigenen zu √§ndern.  Auch hier <i>rate</i> ich Ihnen, das Flag <i>--force zu</i> verwenden, da ich Probleme festgestellt habe, ohne dieses Flag zu verwenden. <br><br>  Wir kehren zu <i>Systems zur√ºck -</i> Wir freuen uns alle √ºber unser System.  Sie k√∂nnen es jetzt √∂ffnen und untersuchen, was und wie es dort ist. Im Moment empfehle ich jedoch dringend, eine Gruppe f√ºr eine bequemere Systemverwaltung zu erstellen. <br><br>  <i>Systeme - Systemgruppen - Gruppe erstellen</i> , Name und Beschreibung ausf√ºllen, speichern, die neu erstellte Gruppe √∂ffnen, zum Abschnitt <i>Systeme</i> gehen und das System der Gruppe hinzuf√ºgen. <br><br>  Abonnieren Sie nun das System f√ºr den Kanal <i>Systeme - Ihr System - Softwareordner - Unterordner f√ºr Softwarekan√§le:</i> <br><br><img src="https://habrastorage.org/webt/7f/hp/lu/7fhplurd2imupn4cio2n7ymcz1y.png"><br><br>  W√§hlen Sie Ihren Kanal und klicken Sie auf Best√§tigung.  Zum Spa√ü k√∂nnen Sie versuchen, das Paket <i>Software - Pakete - Installieren zu installieren</i> . <br><br>  <b>Konfigurationskanal</b> <br><br>  Um Konfigurationen zwischen dem Client-Server / dem lokalen Computer sowie der Fernsteuerung zu verwalten, sollten Sie den Konfigurationskanal einrichten und das System damit verbinden. <br>  Wir gehen zu <i>Konfiguration - Konfigurationskan√§le - Konfigurationskanal erstellen</i> , setzen den Namen, die Beschreibung, speichern, dann unter <i>Konfiguration - Konfigurationskan√§le verwalten - Kan√§le abonnieren</i> und signieren den Konfigurationskanal f√ºr den Softwarekanal und das System. <br><br><img src="https://habrastorage.org/webt/jy/ki/wt/jykiwtrdmame71pab7yyzr40lay.png"><br><br>  Jetzt k√∂nnen wir Konfigurationen sowohl vom Server als auch von lokalen Computern bereitstellen und Partitionen erstellen. <br><br>  <i>Konfiguration - Dateien hinzuf√ºgen - Datei erstellen / Datei hochladen:</i> <br><br><img src="https://habrastorage.org/webt/cf/js/ie/cfjsieqwp21zlmem7goijg7cqui.png"><br><br>  Wir k√∂nnen auch Remote-Befehle in Form eines Bash-Skripts senden: <br><br><img src="https://habrastorage.org/webt/hy/xw/d-/hyxwd-znezglfc-glf5yhn44wsq.png"><br><br>  Ich erinnere Sie daran, dass alle Aktionen einen Zeitplan durchlaufen. Eine Liste aller auf dieses System angewendeten Aktionen finden Sie im Abschnitt Ereignisse: <br><br><img src="https://habrastorage.org/webt/9m/fp/hj/9mfphjmglxmqpxfd_cdqpsf8g2s.png"><br><br>  <b>Errata</b> <br><br>  Eine der wichtigsten Funktionen in Spacewalk ist die Errata-Unterst√ºtzung, die bequem an Kan√§le gebunden wird und es Ihnen erm√∂glicht, den Wichtigkeitsgrad der letzten Updates zu √ºberwachen.  Dies wird direkt auf dem Server konfiguriert. Zus√§tzlich zu den Skripten m√ºssen Sie die erforderlichen Pakete f√ºr Pearl herunterladen: <br><br><pre> <code class="bash hljs">yum -y install perl-Frontier-RPC perl-Text-Unidecode wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl chmod +x errata-import.pl</code> </pre> <br>  Erstellen Sie dann die Haupt-Errata f√ºr Aktualisierungs- und Sammlungsskripte, die in <i>/ etc / rhn /</i> gespeichert werden <i>:</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='root' export SPACEWALK_PASS='verystrong' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS</span></span></code> </pre> <br>  Geben Sie beim Export den Namen und das Kennwort des Spacewalk-Administrators an, die Sie ganz am Anfang angegeben haben. <br><br>  Machen wir das Skript ausf√ºhrbar und f√ºgen es Cron hinzu: <br><br><pre> <code class="bash hljs">chmod +x spcwlk_errata.sh crontab -e 0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata.sh</code> </pre> <br>  Lassen Sie es uns jetzt ausf√ºhren, um √Ñnderungen in der grafischen Oberfl√§che zu sehen.  Die Ausf√ºhrung wird einige Zeit dauern. <br><br><img src="https://habrastorage.org/webt/5v/yy/v9/5vyyv9a4xpmq7c2lqqglozhdrsk.png"><br><br><h4>  Zusammenfassung </h4><br>  Ein wichtiger Punkt, den ich pers√∂nlich vermisst habe, ist das Einrichten und Installieren eines Proxys sowie das Erh√∂hen des gesamten Systems als HA.  Ich hatte die Idee, die Anwendung √ºber den Schrittmacher zu konfigurieren und in der Datenbank zu synchronisieren.  Infolgedessen wurde beschlossen, diese Idee angesichts der nicht sehr gro√üen Serverflotte von Client-Stationen aufzugeben.  Wenn sich das System jedoch in den n√§chsten sechs Monaten als √§u√üerst n√ºtzlich erweist, m√ºssen Sie m√∂glicherweise den urspr√ºnglichen Server erweitern. <br><br><h4>  Automatisierung </h4><br>  <b>Server:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Bash-Skript f√ºr die Serverbereitstellung (DISABLES firewalld):</b> <div class="spoiler_text"><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm (cd /etc/yum.repos.d &amp;&amp; curl -O https://copr.fedorainfracloud.org/coprs/g/spacewalkproject/java-packages/repo/epel-7/group_spacewalkproject-java-packages-epel-7.repo) yum -y install spacewalk-setup-postgresql spacewalk-postgresql wget perl-Frontier-RPC perl-Text-Unidecode perl-XML-Simple # mkdir /usr/share/spcwlk-tmp/ echo 'admin-email = root@localhost ssl-set-cnames = spcwlkserver ssl-set-org = Unicorn ssl-set-org-unit = EOH ssl-set-city = Prague ssl-set-state = SCK ssl-set-country = CZ ssl-password = verystrong ssl-set-email = root@localhost ssl-config-sslvhost = Y db-backend=postgresql db-name=spcwlkdb db-user=spcwlkuser db-password=verystrong db-host=localhost db-port=5432 enable-tftp=Y' &gt; /usr/share/spcwlk-tmp/spcwlk_answer spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer # systemctl stop firewalld systemctl disable firewalld #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Bash-Skript zum Installieren von Errata (legen Sie zuerst den Namen und das Kennwort f√ºr den Spacewalk-Administrator fest):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # wget https://raw.githubusercontent.com/stevemeier/cefs/master/errata-import.pl -P /etc/rhn/ echo '#!/bin/bash cd /etc/rhn/ wget -N http://cefs.steve-meier.de/errata.latest.xml wget -N https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml export SPACEWALK_USER='gui username' export SPACEWALK_PASS='Password to your gui account' ./errata-import.pl --server YourServerIPAddress --errata errata.latest.xml --rhsa-oval com.redhat.rhsa-all.xml --publish unset SPACEWALK_USER unset SPACEWALK_PASS' &gt; /etc/rhn/spcwlk_errata.sh # chmod +x /etc/rhn/errata-import.pl chmod +x /etc/rhn/spcwlk_errata.sh # echo '#!/bin/bash # /etc/rhn/./spcwlk_errata.sh' &gt; /etc/rhn/spcwlk_errata_cron.sh chmod +x /etc/rhn/spcwlk_errata_cron.sh echo '0 2 * * 7 /usr/bin/sh /etc/rhn/spcwlk_errata_cron.sh' &gt;&gt; /var/spool/cron/root /etc/rhn/./spcwlk_errata.sh #</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ansible Playbook f√ºr die Serverbereitstellung (vergessen Sie nicht, die Antwortdatei hinzuzuf√ºgen):</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-server tasks: - name: Install Spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8/epel-7-x86_64/00736372-spacewalk-repo/spacewalk-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install epel repo yum: name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm state: present - name: Install PostgreSQL packages yum: name: - spacewalk-setup-postgresql - spacewalk-postgresql - wget - perl-Frontier-RPC - perl-Text-Unidecode - perl-XML-Simple - name: Creates directory <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Spacewalk answer file file: path: /usr/share/spcwlk-tmp/ state: directory mode: 0755 - name: Deploy answer file copy: src: /etc/ansible/spcwlk_answer dest: /usr/share/spcwlk-tmp/spcwlk_answer - name: Spacewalk Server Deploy shell: spacewalk-setup --answer-file=/usr/share/spcwlk-tmp/spcwlk_answer - name: Stop firewalld systemd: name: firewalld state: stopped enabled: no</code> </pre> <br></div></div><br>  <b>Kunde:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Bash-Skript f√ºr die Clientbereitstellung (IP und Schl√ºssel nicht vergessen):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # rpm -Uvh https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm yum -y install rhn-client-tools rhn-check rhn-setup rhnsd m2crypto yum-rhn-plugin rhncfg-actions deltarpm wget echo '#!/bin/bash # /usr/sbin/rhn_check' &gt; rhn_check.sh mv rhn_check.sh /etc/cron.hourly/ chmod +x /etc/cron.hourly/rhn_check.sh echo '* * * * * /usr/bin/sh /etc/cron.hourly/rhn_check.sh' &gt;&gt; /var/spool/cron/root /usr/bin/rhn-actions-control --enable-all cd /usr/share/rhn/ wget http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT rhnreg_ks --serverUrl=http://172.22.64.41/XMLRPC --activationkey=1-xxxxxxxxxxxxxxxxxxxxxxxxxxxx --force</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Anisble Playbook f√ºr die Clientbereitstellung:</b> <div class="spoiler_text"><pre> <code class="bash hljs">- hosts: spcwlk-clients tasks: - name: Install spacewalk repo yum: name: https://copr-be.cloud.fedoraproject.org/results/@spacewalkproject/spacewalk-2.8-client/epel-7-x86_64/00742644-spacewalk-repo/spacewalk-client-repo-2.8-11.el7.centos.noarch.rpm state: present - name: Install client packages yum: name: - rhn-client-tools - rhn-check - rhn-setup - rhnsd - m2crypto - yum-rhn-plugin - rhncfg-actions - deltarpm - wget - name: Create cronjob <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rhn_check cron: name: <span class="hljs-string"><span class="hljs-string">"rhn_check"</span></span> minute: <span class="hljs-string"><span class="hljs-string">"*"</span></span> hour: <span class="hljs-string"><span class="hljs-string">"*"</span></span> day: <span class="hljs-string"><span class="hljs-string">"*"</span></span> month: <span class="hljs-string"><span class="hljs-string">"*"</span></span> weekday: <span class="hljs-string"><span class="hljs-string">"*"</span></span> job: <span class="hljs-string"><span class="hljs-string">"/usr/sbin/rhn_check"</span></span> - name: Enable controls <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> config and remote control deployment shell: /usr/bin/rhn-actions-control --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>-all - name: Get certificate from server to client get_url: url: http://YourServerIPAddress/pub/RHN-ORG-TRUSTED-SSL-CERT dest: /usr/share/rhn/ - name: Register client to server rhn_register: state: present server_url: http://YourServerIPAddress/XMLRPC activationkey: <span class="hljs-string"><span class="hljs-string">"{{ activation_key }}"</span></span></code> </pre> <br></div></div><br>  Vielen Dank f√ºr das Lesen des Artikels.  Viel Gl√ºck </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de435578/">https://habr.com/ru/post/de435578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de435564/index.html">Verwenden von GtkApplication. Librsvg-Rendering-Funktionen</a></li>
<li><a href="../de435568/index.html">VyOS OpenSource Router</a></li>
<li><a href="../de435572/index.html">Anycubic i3 Mega: Qualit√§ts-Remake von Prusa i3</a></li>
<li><a href="../de435574/index.html">Wie funktioniert Zickzack?</a></li>
<li><a href="../de435576/index.html">1C, keine Schmerzen</a></li>
<li><a href="../de435580/index.html">Java, Spring, Kurento und Media Services</a></li>
<li><a href="../de435582/index.html">Wie f√ºge ich einen Index auf einem geladenen System rund um die Uhr ohne Ausfallzeiten hinzu?</a></li>
<li><a href="../de435584/index.html">Slush 2018. Erster Tag, Zweiter Tag</a></li>
<li><a href="../de435586/index.html">Die Kunst des Schamanismus oder der benutzerdefinierten Firmware f√ºr Olinuxino. Kernel und Ubuntu Teil 3</a></li>
<li><a href="../de435588/index.html">F√∂rderung einer mobilen Anwendung mit echter Erfahrung in Zahlen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>