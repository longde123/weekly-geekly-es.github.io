<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßï ü§ôüèæ üë©üèº‚Äçüöí Identifica√ß√£o de clientes em sites sem senhas e cookies: solicita√ß√£o de padr√£o üéÅ üëàüèø üßïüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Caro habrozhitel! Caros especialistas! Apresento para sua avalia√ß√£o um novo conceito de identifica√ß√£o de usu√°rio em sites que, espero, com sua ajuda s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Identifica√ß√£o de clientes em sites sem senhas e cookies: solicita√ß√£o de padr√£o</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472310/"><img src="https://habrastorage.org/webt/zx/gv/lz/zxgvlzpzrabaux0m9y-brjkhhpi.jpeg" alt="imagem"><br><br>  Caro habrozhitel!  Caros especialistas!  Apresento para sua avalia√ß√£o um novo conceito de identifica√ß√£o de usu√°rio em sites que, espero, com sua ajuda se tornar√° um padr√£o aberto da Internet, tornando esse mundo da Internet um pouco melhor.  Esta √© uma vers√£o preliminar do protocolo de autentica√ß√£o sem senha, desenvolvido como um artigo gratuito.  E se a id√©ia subjacente receber uma avalia√ß√£o positiva de voc√™, caro leitor, continuarei a public√°-la no reddit.com e no rfc-editor.org.  E espero poder interessar aos desenvolvedores dos principais navegadores em sua implementa√ß√£o.  Portanto, espero cr√≠ticas construtivas de voc√™. <br><br>  Aten√ß√£o: muito texto. <br><br><a name="habracut"></a><br>  Ent√£o a quest√£o √©.  √â poss√≠vel identificar inequivocamente os visitantes do site sem divulgar seus dados pessoais e rastrear entre sites diferentes?  √â poss√≠vel, resolvendo esse problema, abandonar completamente a forma mais primitiva de autoriza√ß√£o por login / senha e usar cookie / localStorage? <br><br>  Por um lado, os sites precisam reconhecer um cliente para, por exemplo, "restaurar" suas configura√ß√µes, cesta de produtos, an√∫ncios, artigos etc.  Por outro lado, os visitantes desejam permanecer o mais an√¥nimos poss√≠vel, sem revelar seus dados pessoais e impedir que sites de terceiros os rastreiem.  E o √∫ltimo pode fazer isso trocando entre si os dados coletados. <br><br>  Parece uma tarefa garantir que os lobos estejam cheios e as ovelhas seguras.  Isso √© real? <br><br>  Eu, at√© certo ponto, eu acho - realmente. <br><br><h1>  Sum√°rio </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1 conceito de autentica√ß√£o sem senha</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.1 Chaves e tokens em vez de logins e senhas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.2 Estrutura do Token</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/472310/&amp;usg=ALkJrhjn8uZpGp2EBcotWFU8veafGusbrw#">1.3 cabe√ßalhos de protocolo HTTP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.4 Como os clientes identificam sites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.4.2 Como sei se um site suporta este protocolo?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.5 Como os clientes autorizam sites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.6 Como implementar uma identifica√ß√£o confi√°vel do cliente?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.7 Autoriza√ß√£o no site pelos olhos do usu√°rio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.8 Como a chave do site muda?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.9 Como a autoriza√ß√£o entre dom√≠nios √© implementada?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.10 Como implementar a autentica√ß√£o entre dom√≠nios?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.11 Mobilidade da conta</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2 Descri√ß√£o t√©cnica do protocolo</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.0 Algoritmo de gera√ß√£o de chave de dom√≠nio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.1 o algoritmo para calcular o token de origem</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.2 Algoritmo de prote√ß√£o de token durante a transfer√™ncia</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.3 Procedimento de troca de sal entre o navegador e o servidor</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.4 Regras para a forma√ß√£o do campo Contexto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.5 Regras para definir os campos Remetente e Destinat√°rio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.6 Detalhes sobre tabelas de defini√ß√£o de contexto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.7 Cen√°rios de protocolo</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.8 Processando tokens no servidor</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.9 Autentica√ß√£o entre dom√≠nios</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3 Recomenda√ß√µes de seguran√ßa</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3.1 Prote√ß√£o das principais informa√ß√µes contra acesso n√£o autorizado</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3.2 Sobre senhas como chaves de dom√≠nio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3.3 Riscos de perder / comprometer chaves e minimiz√°-las</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4 Ataques ao regime de autoriza√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.1 Rastreamento de usu√°rio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.2 Ataque XSS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.3 Ataque do CSRF</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.4 Rastreando usando SSO</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.5 Compromisso de chave para SSO</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.6 Compromisso de token durante a transfer√™ncia</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.7 Hackeando um site e comprometendo tokens</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conclus√£o</a> <br><br><br><div class="spoiler">  <b class="spoiler_title">O que h√° de errado com senhas?</b> <div class="spoiler_text">  Sim, n√£o √© verdade.  Eles podem ser perdidos.  Eles podem ser roubados.  Eles devem ser lembrados.  De qualquer forma, por que sou obrigado a preencher alguma forma de registro e criar outra senha para ver o tempo ou baixar esse arquivo?  Finalmente, as senhas s√£o um pouco menos que muitas.  Quantos sites voc√™ gosta, tantas senhas.  E, portanto, muitos realmente usam uma senha em todos os sites.  Algu√©m usa um algoritmo complicado para lembr√°-los.  Ou um gerenciador de senhas.  Ou, estupidamente, um caderno.  Ou prefere a autentica√ß√£o entre dom√≠nios: voc√™ faz login uma vez em um site, e √© isso!  Sim, n√£o todos.  Isto √©, se o site suportar. <br>  Todas essas abordagens t√™m desvantagens. <br>  Use uma senha em sites diferentes - Moveton.  O que duas pessoas sabem, o porco tamb√©m sabe.  Nem todos os sites (mesmo grandes e respeit√°veis) cumprem honestamente as regras de seguran√ßa para armazenar suas senhas.  Alguns sites armazenam senhas de forma aberta, enquanto outros acham que armazenar hashes de senhas j√° as protege o suficiente.  Como resultado, vazamentos de senhas e outros dados pessoais dos clientes ocorrem regularmente. <br>  Com o gerenciador de senhas j√° √© melhor.  √â verdade que ningu√©m garante que ela n√£o mescla suas senhas em algum lugar.  E procure um gerente que possa sincronizar suas contas em todos os dispositivos (netbook dom√©stico, telefone, computador de trabalho).  N√£o excluo que isso exista. <br>  Mas, de qualquer forma, a ideia em si: primeiro registre-se em nosso site (ao mesmo tempo, envie um e-mail, celular, doe sangue para an√°lise), depois invente / lembre-se de seu nome de usu√°rio e senha e tenha a gentileza de lembr√°-los, mas mantenha-os em segredo - abordagem, eu lhe digo, mais ou menos.  E nem um √∫nico gerenciador de senhas o resolver√°.  Mas resolve o <abbr title="Tecnologia Single Sign-On implementada por v√°rios protocolos como SAML, OAuth, Kerberos">SSO</abbr> . <br>  Isso √© apenas azar: se voc√™ perder a senha do site SSO e esquec√™-la, ou ela foi roubada de voc√™ ... Voc√™ perde o acesso de todos os seus sites de uma s√≥ vez ou voluntariamente a entrega a qualquer pessoa e n√£o est√° claro com quais inten√ß√µes.  <b>N√£o guarde todos os ovos em uma cesta!</b> <br>  E n√£o √© fato que o site SSO seja confi√°vel.  Ou n√£o armazena suas senhas em texto n√£o criptografado.  Ou n√£o os mescla voluntariamente, al√©m de oferecer aos outros a oportunidade de rastrear voc√™ entre sites.  Bem, voc√™ entendeu. <br>  Portanto: login + senha = mal.  E todo o mal do mundo deve ser bebido seriamente e por muito tempo.  E um biscoito tamb√©m.  Juntamente com seus crocodilos de sess√£o PHPSESSIONID, JSESSIONID e seus an√°logos. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">E o que fazer?</b> <div class="spoiler_text">  Primeiro, voc√™ precisa considerar situa√ß√µes t√≠picas, das quais ficar√° claro: por que os sites querem lembrar de seus clientes e √© realmente necess√°rio para eles? <br><ol><li>  Blog pessoal "Vasya Pupkina", no qual, por exemplo, coment√°rios s√£o permitidos.  O registro √© necess√°rio apenas para se proteger de bots, realizar vota√ß√µes gratuitas, contar "curtidas" e outras "miau" e atribuir uma classifica√ß√£o aos comentaristas.  I.e.  Aqui <b>, a funcionalidade de rastreamento √© necess√°ria exclusivamente pelo site</b> , e apenas em pequena medida - pelo usu√°rio (se ele valorizar sua classifica√ß√£o de "comentarista" neste site). </li><li>  Sites de redes sociais e outros usu√°rios da Internet (ICQ, Skype - tamb√©m).  O registro √© necess√°rio para implementar o conte√∫do nomeado (autor), para identificar os visitantes.  I.e.  Aqui <b>, a funcionalidade de identifica√ß√£o √© necess√°ria em maior medida pelos pr√≥prios usu√°rios</b> .  Embora os sites das redes sociais sejam os primeiros na lista de "pecadores", coletando as informa√ß√µes mais completas sobre os visitantes e lembrando voc√™ com seriedade e por um longo tempo.  Portanto, ainda n√£o se sabe quem precisa mais de identifica√ß√£o. </li><li>  Site corporativo com conte√∫do fechado.  O registro ou autoriza√ß√£o aqui √© necess√°rio principalmente para restringir o acesso ao conte√∫do.  Todos os tipos de: escolas on-line, bibliotecas, sites privados n√£o p√∫blicos e assim por diante.  Aqui <b>, a funcionalidade de autoriza√ß√£o √© necess√°ria em maior medida pelo site</b> .  Como regra, n√£o h√° formul√°rios de registro abertos.  As credenciais s√£o compartilhadas por outros canais. </li><li>  Uma loja online e outra plataforma semelhante que vende itens, servi√ßos ou conte√∫do.  Tamb√©m incluirei sites de an√∫ncios classificados pagos / gratuitos.  O registro √© principalmente necess√°rio para armazenar o hist√≥rico dos pedidos dos clientes e, para que ele possa rastrear seu status atual, armazenar suas prefer√™ncias (favoritos);  para formular ofertas pessoais ao cliente com base no hist√≥rico e nas prefer√™ncias da compra.  Aqui <b>, a funcionalidade de identifica√ß√£o √© igualmente necess√°ria para o cliente e a loja</b> .  Mas mais, √© claro, para a loja.  Para vapor, vapor e vapor. </li><li>  Quaisquer contas pessoais de usu√°rios de servi√ßos de Internet: e-mail, servi√ßos p√∫blicos, Sberbank-online, megafone-online, escrit√≥rios de provedores, CMS de hosters, etc.  Aqui <b>, o pr√≥prio usu√°rio est√° interessado principalmente na identifica√ß√£o correta e confi√°vel</b> .  Afinal, ele gerencia informa√ß√µes importantes para si, que em algumas situa√ß√µes t√™m consequ√™ncias legais e financeiras.  N√£o cheira a anonimato.  Ela √© prejudicial aqui. </li><li>  Roteadores, consoles de gerenciamento, vers√µes da Web para gerenciar algo em sua rede dom√©stica ou corporativa. </li></ol><br><br>  √â claro que em situa√ß√µes diferentes, pode haver riscos diferentes.  Em alguns casos, a identifica√ß√£o incorreta, a perda de dados de autentica√ß√£o ou mesmo o roubo / falsifica√ß√£o deles n√£o trar√° consequ√™ncias significativas para o site ou para o usu√°rio.  Em outros, ser√° apenas desagrad√°vel (perdi o carma em Habr√© - "√© um desastre ...") ou levar√° a inconvenientes (n√£o posso me afundar em Yula, ver meus an√∫ncios; tenho acesso a meus projetos por perfil no github - ok nova conta, projetos de fork).  Em terceiro lugar, pode acarretar consequ√™ncias jur√≠dicas e financeiras.  Portanto, deve-se presumir que o esquema de autoriza√ß√£o proposto n√£o √© uma ‚Äúbala de prata‚Äù para todos os casos, especialmente ‚Äúvazio‚Äù.  <b>Onde informa√ß√µes confidenciais s√£o gerenciadas, vale a pena usar outros m√©todos de identifica√ß√£o e autentica√ß√£o</b> ou sua combina√ß√£o (autentica√ß√£o de dois fatores, criptografia de chave assim√©trica, seguran√ßa 3D, eToken, OTP-Token etc.). <br><br>  Oh bem.  Qual √© o seu TK? <br></div></div><br><div class="spoiler">  <b class="spoiler_title">O que o novo protocolo oferece?</b> <div class="spoiler_text">  Da perspectiva do usu√°rio final: <br><ol><li>  O site deve lembrar e reconhecer o visitante sem nenhuma entrada do usu√°rio;  o site deve reconhec√™-lo na sess√£o e entre diferentes sess√µes.  Sem cookies, senhas ou registros.  Ao mesmo tempo, sites diferentes n√£o devem ser capazes <i>de</i> identificar exclusivamente o mesmo visitante, podendo rastrear suas atividades nesses e em outros sites.  I.e.  os sites n√£o devem poder agregar informa√ß√µes para seus visitantes. </li><li>  O usu√°rio deve ser capaz de " <b>esquecer qualquer site</b> " a qualquer momento;  e o site esquecer√° o usu√°rio.  Deve haver a possibilidade de conceder direitos ao site para lembrar o cliente por iniciativa do cliente (sem pop-up obsessivo).  O usu√°rio deve poder migrar com seguran√ßa sua identidade virtual entre diferentes dispositivos e navegadores (se necess√°rio) para ter uma √∫nica autoriza√ß√£o em seus sites favoritos. </li></ol><br><br>  Eu vejo.  E que b√¥nus os desenvolvedores de sites devem obter disso? <br><ol><li>  Um procedimento de identifica√ß√£o mais simples: n√£o √© necess√°rio criar pela mil√©sima vez a pr√≥xima forma de login, logout, registro, altera√ß√£o e recupera√ß√£o de senha.  Basta ativar o m√≥dulo de suporte de protocolo para sua estrutura favorita, implementada com base no padr√£o. </li><li>  N√£o h√° necessidade de um designer desenhar um formul√°rio de login e pensar sobre onde escond√™-lo em uma pequena tela m√≥vel.  O protocolo torna os formul√°rios desnecess√°rios.  Bem, exceto que o formul√°rio de inscri√ß√£o.  Onde est√° sem eles ent√£o.  Infelizmente. </li></ol><br><br>  Finalmente: <br><ol><li>  O protocolo de autentica√ß√£o deve ser unificado e padronizado;  Verificado por especialistas em seguran√ßa  Aprovado e recomendado pelos comit√™s de padroniza√ß√£o da web.  Como resultado, a possibilidade de cometer erros cl√°ssicos pelos webmasters no desenvolvimento de formul√°rios padr√£o de logon / logout, altera√ß√£o / recupera√ß√£o de senhas (transfer√™ncia de senhas de forma clara, uso incorreto de hash, armazenamento de senhas ou hashes "n√£o salgados" no banco de dados, seq√ºestrando senhas de usu√°rios quando site de hackers). </li><li>  A autoriza√ß√£o deve ser confi√°vel at√© certo ponto (protegida contra falsifica√ß√£o, acesso n√£o autorizado, com autentica√ß√£o garantida);  N√£o crie novas vulnerabilidades em p√°ginas da web e navegadores;  se poss√≠vel, reduza os riscos de ataques de rede conhecidos imediatamente.  Bem, ou pelo menos uma redu√ß√£o significativa nos riscos de sua implementa√ß√£o bem-sucedida. </li></ol><br><br>  Com base nesses requisitos, passamos ao mais interessante: projetar um novo protocolo. <br></div></div><br><br><a name="part1"></a><h1>  1 conceito de autentica√ß√£o sem senha </h1><br><br><a name="tokens_vs_passwords"></a><h2>  1.1 Chaves e tokens em vez de logins e senhas </h2><br>  Para cada dom√≠nio, incluindo os filhos, o navegador do cliente gera aleatoriamente uma chave exclusiva de 256 bits <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  .  <b>Essa chave nunca √© transmitida.</b>  Permanece constante na sess√£o do usu√°rio.  Cada nova sess√£o cria uma nova chave. <br>  Baseado em chave <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  o navegador gera um token de 256 bits <sup>*</sup> usando um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">algoritmo especial</a> <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  para identificar o usu√°rio com um dom√≠nio espec√≠fico.  Token de identifica√ß√£o <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  o usu√°rio (doravante chamado de token) serve como um substituto para cookies de sess√£o como PHPSESSIONID e JSESSIONID. <br>  Key <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  pode ser " <b>corrigido</b> " pelo usu√°rio.  A corre√ß√£o da chave permitir√° que o usu√°rio permane√ßa autorizado no site por um tempo ilimitado em diferentes sess√µes do navegador e retorne a autoriza√ß√£o existente anteriormente.  Este √© <b>um an√°logo da fun√ß√£o "lembre-se de mim"</b> . <br>  Quando a confirma√ß√£o √© cancelada, o navegador "esquece" essa chave e come√ßa novamente a gerar uma chave aleat√≥ria para esse dom√≠nio para cada nova sess√£o (a partir da atual), que <b>√© an√°loga √† "sa√≠da"</b> do usu√°rio do site.  A sa√≠da √© instant√¢nea, n√£o exigindo o recarregamento da p√°gina. <br>  O usu√°rio pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">criar uma chave permanente para o dom√≠nio</a> .  A chave permanente, assim como a chave fixa, permitir√° ao usu√°rio retornar a autoriza√ß√£o anterior.  De fato, essa <b>chave se torna um substituto para a conex√£o de senha de login.</b> <br>  O usu√°rio tem a oportunidade de controlar quando o navegador do dom√≠nio usar√° uma chave constante e quando - aleatoriamente.  Este √© <b>um an√°logo da fun√ß√£o de logon / logout</b> .  O conceito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√© apresentado nas imagens abaixo</a> . <br>  Os m√©todos para gerar chaves de dom√≠nio persistentes fornecem a mobilidade de contas de usu√°rio entre diferentes dispositivos.  O protocolo define o seguinte: <br><ul><li>  gera√ß√£o de uma chave de dom√≠nio com base em uma chave mestra do usu√°rio </li><li>  formar individualmente uma chave de dom√≠nio com base em um sensor de n√∫mero aleat√≥rio biol√≥gico </li><li>  Importando Chaves Existentes de um Arquivo de Chaves de Outro Dispositivo </li></ul><br><br><a name="token_structure"></a><h2>  1.2 Estrutura do Token </h2><br>  O token √© uma estrutura de 256 bits, representada como uma sequ√™ncia hexadecimal: <br><div class="scrollable-table"><table><tbody><tr><td>  84bc3da1b3e33a18e8d5e1bdd7a18d7a </td><td>  166d77ac1b46a1ec38aa35ab7e628ab5 </td></tr><tr><td>  parte de identifica√ß√£o </td><td>  parte de autentica√ß√£o </td></tr></tbody></table></div><br>  A parte de identifica√ß√£o do token (os 128 bits mais altos) √© semelhante ao logon.  Por essa sequ√™ncia de bits, o servidor pode identificar exclusivamente o usu√°rio. <br>  A parte de autentica√ß√£o do token (os 128 bits inferiores) √© semelhante √† senha.  Essa sequ√™ncia de bits ajuda o servidor a validar o token. <br>  As regras de valida√ß√£o de token s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descritas abaixo</a> . <br><br><a name="http_headers"></a><h2>  1.3 cabe√ßalhos de protocolo HTTP </h2><br>  <b>Cabe√ßalhos usados ‚Äã‚Äãpelo cliente:</b> <br><br>  <b>CSI-Token</b> : &lt;Token&gt; √© usado para enviar um token para o servidor <br>  <b>Token CSI</b> : &lt;Token1&gt;;  <b>Alterado para</b> &lt;Token2&gt; √© usado para alterar o token atual: <br><ul><li>  ao autorizar uma chave permanente, </li><li>  ao registrar uma chave permanente, </li><li>  ao alterar a chave permanente. </li></ul><br>  <b>CSI-Token</b> : &lt;Token&gt; <b>Permanente √©</b> usado ao corrigir a chave aleat√≥ria atual pelo usu√°rio. <br>  <b>CSI-Token</b> : &lt;Token&gt; O <b>logout √©</b> usado para finalizar prematuramente a sess√£o atual. <br><br>  <b>Cabe√ßalhos usados ‚Äã‚Äãpelo servidor:</b> <br>  <b>Suporte CSI: yes</b> diz ao cliente que o servidor suporta o protocolo de autoriza√ß√£o CSI. <br>  <b>CSI-Token-Action: sucesso √©</b> usado para notificar o navegador sobre a aceita√ß√£o de um novo token de usu√°rio (chave Change-To). <br>  <b>CSI-Token-Action: abort</b> cancela o procedimento de altera√ß√£o de tokens (revers√£o para o token anterior). <br>  <b>A√ß√£o CSI-token: o registro</b> informa ao navegador que o novo token de usu√°rio ainda est√° em processo de registro. <br>  <b>CSI-Token-Action:</b> erro <b>inv√°lido</b> de verifica√ß√£o do token do lado do servidor. <br><br>  Finalmente <br>  <b>O CSI-Salt √©</b> enviado pelo navegador e pelo servidor ao trocar o ‚Äúsalt‚Äù usado para proteger o token (parte de autentica√ß√£o).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Veja abaixo para</a> mais detalhes. <br><br><a name="how_site_identify_us"></a><h2>  1.4 Como os clientes identificam sites? </h2><br>  Um site pode usar um token para identificar um visitante do site.  Ao mesmo tempo, o esquema de gera√ß√£o de tokens e sua capacidade de 256 bits <b>garantem tokens exclusivos para cada par:</b> dom√≠nio do usu√°rio.  Outro dom√≠nio ver√° outro token de usu√°rio.  Mesmo se executado no contexto do site de destino (via IFRAME, IMG, LINK, SCRIPT).  Al√©m disso, um algoritmo especial de gera√ß√£o de token protege os usu√°rios contra ataques XSS, SRF e torna imposs√≠vel rastrear um usu√°rio sem seu conhecimento.  Mas, ao mesmo tempo, a tecnologia <abbr title="Tecnologia Single Sign-On implementada por v√°rios protocolos como SAML, OAuth, Kerberos">SSO permanece</abbr> poss√≠vel com sua permiss√£o e identifica√ß√£o entre dom√≠nios. <br>  O token <b>√© transmitido no cabe√ßalho HTTP CSI-Token</b> <u>com todas as solicita√ß√µes</u> para qualquer recurso de dom√≠nio (p√°gina, documento, imagem, script, estilo, fonte, arquivo, solicita√ß√£o ajax, ...): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ki/mv/0k/kimv0kx4wvesmftizvvlgpfe088.png"></div><br>  O token √© <b>recalculado <i>a cada</i> solicita√ß√£o HTTP (S)</b> : p√°gina, imagem, solicita√ß√£o ajax. <br>  Para otimizar os c√°lculos, o cache de tokens pelo navegador √© permitido, mas apenas durante a sess√£o e somente se as condi√ß√µes para atender √† solicita√ß√£o permanecerem inalteradas. <br>  Como observado acima, o token pode servir como um substituto para cookies de sess√£o como PHPSESSIONID e JSESSIONID.  A √∫nica diferen√ßa √© que, se o site gerou anteriormente um identificador para o visitante rastrear um usu√°rio espec√≠fico entre suas diferentes solicita√ß√µes (afinal, milhares de solicita√ß√µes de usu√°rios diferentes chegam ao site ao mesmo tempo), agora o pr√≥prio cliente executa essa fun√ß√£o. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa identifica√ß√£o √© suficiente para permitir que voc√™ fa√ßa compras na loja online, anuncie em sites apropriados, escreva em f√≥runs, redes sociais, artigos da Wikipedia ou da Habr√©. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim, o usu√°rio permanece an√¥nimo para o site. Mas pode ser um "familiar" an√¥nimo para o site. E o servidor pode salvar o token de um usu√°rio assim, juntamente com seus dados (conta pessoal com compras, prefer√™ncias, karma, p√£es, gostos e outros b√¥nus). Mas apenas para manter a condi√ß√£o de conclus√£o de qualquer processo comercial: compra, envio do an√∫ncio, etc. As condi√ß√µes s√£o determinadas pelo pr√≥prio site.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ pode ver, o protocolo √© o mais simples poss√≠vel para sites que n√£o precisam registr√°-lo antes de dar a oportunidade de executar qualquer a√ß√£o. </font><font style="vertical-align: inherit;">Mas aqueles que precisam ter√£o um pouco mais de dificuldade. </font><font style="vertical-align: inherit;">Mas mais sobre isso abaixo.</font></font><br><br><a name="how_we_know_what_sci_supported"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.4.2 Como sei se um site suporta este protocolo? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O site deve passar o cabe√ßalho http do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Support: yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na se√ß√£o Cabe√ßalhos de resposta de sua resposta:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/gs/zu/lygszusqavjk8yjnljig4pgojdm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao ver esse t√≠tulo, o navegador informar√° discretamente o usu√°rio que ele pode se salvar no site. </font><font style="vertical-align: inherit;">Por exemplo, o s√≠mbolo da chave na barra de endere√ßo:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ar/ff/bt/arffbt4ibbg__wlp7eyvaei_gvq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clicar em uma chave, por exemplo, criar√° uma chave para o dom√≠nio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fq/7c/4p/fq7c4piubz15qir9xtxchg9639o.jpeg"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A forma√ß√£o de uma nova chave n√£o leva ao seu uso autom√°tico. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A chave permanente come√ßa a ser usada apenas quando ativada pelo usu√°rio. </font></font><br><br><a name="how_make_authorization"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.5 Como os clientes autorizam sites? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â importante entender que o token ainda n√£o torna o usu√°rio autorizado em um site espec√≠fico - apenas reconhec√≠vel. </font><font style="vertical-align: inherit;">Mas, como j√° foi dito, por enquanto voc√™ √© simplesmente uma "pessoa an√¥nima" reconhec√≠vel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o site precisar associar seu token a voc√™ pessoalmente, o registro nesse site, infelizmente, n√£o poder√° ser evitado. </font><font style="vertical-align: inherit;">Mas no protocolo proposto, isso √© um pouco mais f√°cil.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â importante que os desenvolvedores entendam: a maioria dos sites n√£o precisa de um question√°rio. </font><font style="vertical-align: inherit;">Evite for√ßar os visitantes a se registrarem. </font><font style="vertical-align: inherit;">Nas situa√ß√µes mais comuns, voc√™ pode executar um processo de neg√≥cios sem coletar visitantes do PD.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preencher formul√°rios de registro tediosos "com ou sem" √© desagrad√°vel. </font><font style="vertical-align: inherit;">Mas com o novo protocolo, n√£o √© mais necess√°rio criar outro login e senha. </font><font style="vertical-align: inherit;">Somente o bot√£o Confirmar e salvar me:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/__/0i/1x/__0i1xkyu82-ne_cnghuongzrfy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviamente, voc√™ precisar√° primeiro criar uma chave permanente para o site. </font><font style="vertical-align: inherit;">Mas isso √© quest√£o de alguns cliques do mouse. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E, com certeza, voc√™ ser√° solicitado a confirmar seu telefone ou endere√ßo de correspond√™ncia. </font><font style="vertical-align: inherit;">Mas isso j√° depende do site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s a autoriza√ß√£o bem-sucedida, o servidor, por meio de um cabe√ßalho HTTP especial, o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Token-Action</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> informar√° o navegador que aceitou a nova chave. </font><font style="vertical-align: inherit;">Mais detalhes no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cap√≠tulo II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="how_implement_reliable_identification"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.6 Como implementar uma identifica√ß√£o confi√°vel do cliente? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em situa√ß√µes mais graves (conta pessoal do provedor, hospedagem, banco), a autentica√ß√£o de dois fatores deve e pode ser realizada, e a comprova√ß√£o da posse do token pode ser feita atrav√©s do pr√©-registro e confirma√ß√£o da identidade de outras maneiras: por e-mail, SMS ou mesmo fixando em papel o token do usu√°rio. </font><font style="vertical-align: inherit;">(Sim, sim. Os certificados s√£o gravados em papel, porque n√£o os tokens).</font></font><br><br><a name="user_view_concept"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.7 Autoriza√ß√£o no site pelos olhos do usu√°rio </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O navegador notifica o usu√°rio que o site suporta autoriza√ß√£o CSI atrav√©s do √≠cone de cadeado na barra de endere√ßo. </font><font style="vertical-align: inherit;">Se voc√™ executar algumas a√ß√µes no site, pe√ßa ao site para lembrar de voc√™. </font><font style="vertical-align: inherit;">A partir deste momento, o servidor reconhecer√° o usu√°rio mesmo entre diferentes sess√µes:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/up/et/3q/upet3q-qbs8ikn4ba9t0ycn8voy.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustra√ß√£o</font></font></b> <div class="spoiler_text">     ,  .       ,   ,  ,   .    ,   .    .    .   ,   , ,      .   .  . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em vez de fixar a chave, o usu√°rio pode criar uma chave permanente para o site e se registrar no local. </font><font style="vertical-align: inherit;">Ilustra√ß√£o animada:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/32/82/tm/3282tmri0zwdfx1jqi_zgd76zu0.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustra√ß√£o</font></font></b> <div class="spoiler_text">   .   .  .      . <br>     ,  ¬´ ¬ª.      . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E quando o usu√°rio tem uma chave permanente para o site e essa chave √© registrada l√°, o processo de login √© bastante simplificado: </font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u4/cm/_g/u4cm_gdewg2j7ree3gq3phuz6x4.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustra√ß√£o</font></font></b> <div class="spoiler_text">   . ,    .  ,  ¬´¬ª.   ,  . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O maior poder do protocolo se manifesta quando o usu√°rio cria uma chave para o site com base na chave mestra. </font><font style="vertical-align: inherit;">Nesse caso, o </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">problema de sua identifica√ß√£o em sites de outros dispositivos</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© facilmente </font><u><font style="vertical-align: inherit;">resolvido</font></u><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A anima√ß√£o a seguir demonstra isso. </font><font style="vertical-align: inherit;">Sup√µe-se que voc√™ j√° tenha distribu√≠do sua chave mestra uma vez entre seus dispositivos / navegadores:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/ye/tx/xsyetxguxoesirmridywcy-2rts.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustra√ß√£o</font></font></b> <div class="spoiler_text">      .       -.  .    (  ). <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para sites com autoriza√ß√£o de dois fatores, o "reconhecimento" pode ser assim: </font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/du/ab/cl/duabclss3t9nkxpnjygrqfxjdha.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustra√ß√£o</font></font></b> <div class="spoiler_text">   .   .       .   ;    .   . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sair √© ainda mais f√°cil. </font><font style="vertical-align: inherit;">Clique em "Logout" no navegador e pronto:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/do/2r/fe/do2rfebsd3orgwphl0ujrt_o52q.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O navegador envia uma solicita√ß√£o para o site (em qualquer p√°gina) com o m√©todo HEAD, no qual envia o cabe√ßalho CSI-Token &lt;&gt;; </font><font style="vertical-align: inherit;">Sair.</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/gj/s1/mtgjs1i1jmtbehjyus_hfukqsq4.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O servidor, vendo esse cabe√ßalho, efetua um logout. </font><font style="vertical-align: inherit;">Se fosse uma chave fixa, o site excluir√° todas as informa√ß√µes sobre o usu√°rio (mais do que essa chave nunca aparecer√°). </font><font style="vertical-align: inherit;">Se fosse uma chave permanente, apenas interrompe a sess√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qualquer outra atividade do site transforma o usu√°rio em um an√¥nimo desconhecido para o site: recarregar a p√°gina, tentar fazer uma solicita√ß√£o de ajax, baixar um arquivo etc. </font><font style="vertical-align: inherit;">- O navegador enviar√° um token gerado j√° com base em uma chave aleat√≥ria.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode gerenciar as chaves no gerenciador de chaves: altere a chave permanente, exporte a chave permanente para um arquivo, importe de um arquivo de outro dispositivo. </font><font style="vertical-align: inherit;">Configure a "sa√≠da autom√°tica" ap√≥s fechar uma guia ou navegador. </font><font style="vertical-align: inherit;">Defina a dura√ß√£o de uma chave fixa.</font></font></blockquote><br><br><a name="how_user_can_change_key"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.8 Como a chave do site muda? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Substituir a chave permanente do site √© tecnicamente o mesmo que mudar de uma chave aleat√≥ria para uma permanente. </font><font style="vertical-align: inherit;">Isso √© descrito em mais detalhes no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cap√≠tulo II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No caso de alterar a chave permanente do site, o navegador notifica o site da altera√ß√£o correspondente no token, enviando um </font><font style="vertical-align: inherit;">cabe√ßalho </font><b><font style="vertical-align: inherit;">CSI-Token</font></b><font style="vertical-align: inherit;"> com a chave </font><b><font style="vertical-align: inherit;">Changed-To </font></b></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em cada solicita√ß√£o subsequente</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xk/rp/75/xkrp75ivdr3kjj1_i2sh9iwfqaa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O site deve processar corretamente essa solicita√ß√£o. </font><font style="vertical-align: inherit;">E, se um determinado token de usu√°rio estiver armazenado em seu banco de dados, ele dever√° fazer uma substitui√ß√£o apropriada. </font><font style="vertical-align: inherit;">Ao mesmo tempo, o site deve responder ao navegador sobre a altera√ß√£o bem-sucedida do token. </font><font style="vertical-align: inherit;">Ele faz isso no cabe√ßalho Response Headers com o par√¢metro: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Token-Action: success</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , indicando o token aplicado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O site tem o direito de rejeitar uma tentativa de alterar o token (por exemplo, se n√£o houvesse esse token no banco de dados ou se n√£o os salvasse) com o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par√¢metro CSI-Token-Action: abortado. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At√© que o navegador receba o cabe√ßalho CSI-Token-Action, ele adicionar√° a chave Changed-To a cada solicita√ß√£o de CSI-Token no site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um an√°logo da "altera√ß√£o de senha" do usu√°rio.</font></font></b> <br><br><a name="how_make_cross_domain_auth"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.9 Como a autoriza√ß√£o entre dom√≠nios √© implementada? </font></font></h2><script type="text/javascript">function gtElInit() {var lib = new google.translate.TranslateService();lib.translatePage('ru', 'pt', function () {});}</script><script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=gtElInit&amp;client=wt"></script><br>  A autoriza√ß√£o cl√°ssica de dom√≠nio cruzado usando a tecnologia <abbr title="Tecnologia Single Sign-On implementada por v√°rios protocolos como SAML, OAuth, Kerberos">SSO</abbr> tem muitas vantagens para o usu√°rio.  Voc√™ n√£o precisa se lembrar de v√°rias senhas de v√°rios sites.  N√£o h√° necessidade de se registrar e preencher os formul√°rios tristes.  Alguns servidores de autoriza√ß√£o perguntam quais direitos conceder ao site que solicitou o SSO. <br>  Mas tamb√©m h√° desvantagens.  <b>Voc√™ depende do provedor de SSO.</b>  Se o servidor SSO n√£o funcionar, voc√™ n√£o chegar√° ao site de destino.  Se voc√™ perder sua senha ou sua conta for roubada - voc√™ perder√° o acesso de todos os sites de uma s√≥ vez. <br>  Para desenvolvedores web, as coisas s√£o um pouco mais complicadas.  Desde o in√≠cio, voc√™ precisa registrar seu site no servidor de autoriza√ß√£o, obter as chaves, aprender a trabalhar com o protocolo ( <abbr title="Um padr√£o aberto para a troca de dados de autentica√ß√£o e autoriza√ß√£o entre um provedor de contas e um provedor de servi√ßos">SAML</abbr> , <abbr title="Um protocolo de autoriza√ß√£o aberto que permite fornecer a terceiros acesso limitado aos recursos protegidos do usu√°rio sem precisar transferir um login e senha para terceiros">OAuth</abbr> etc.) e as bibliotecas correspondentes, verifique se a chave n√£o expira, se o servidor de autoriza√ß√£o n√£o bloqueia seu site por seus motivos e etc.  √â uma taxa pelo fato de voc√™ n√£o precisar manter contas de usu√°rio, fazer formul√°rios de registro, fazer login etc.  A verdade aumenta o custo de manuten√ß√£o (na forma de reparar falhas repentinas).  Novamente, se o servidor estiver subitamente indispon√≠vel no site, ent√£o, infelizmente. <br>  Esse esquema de autoriza√ß√£o torna o SSO um pouco mais seguro e a autoriza√ß√£o para todos os participantes √© mais f√°cil.  A seguran√ßa ser√° discutida abaixo na se√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Compromisso de chave para SSO".</a> <br><br>  D√™ uma olhada no site S, que suporta o SSO do Google.  Suponha que voc√™ tenha uma conta do Google.  Para fazer login, clique no link "Fazer login com o Google", que abrir√° a guia de autoriza√ß√£o do Google.  O navegador informar√° que voc√™ tem uma chave para o Google.  E o Google informar√° quais direitos S. solicita. <br>  Se voc√™ concordar, clique em "Login" no gerenciador de chaves.  A p√°gina ser√° recarregada.  O Google j√° receber√° seu token v√°lido, reconhecer√° e autorizar√° voc√™.  E com uma solicita√ß√£o entre servidores, ele informar√° o Site S sobre as informa√ß√µes da sua conta, de acordo com os campos solicitados. <br>  A p√°gina recarregada conter√° um bot√£o "Avan√ßar" que o levar√° ao site de destino. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><div class="spoiler">  <b class="spoiler_title">Na ilustra√ß√£o</b> <div class="spoiler_text">  Ele dar√° um exemplo desse algoritmo ao se registrar no site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.youtube.com</a> usando a autoriza√ß√£o entre dom√≠nios atrav√©s de accounts.google.com. <br></div></div><br>  O Site S pode decidir salvar dados sobre voc√™ no banco de dados ou n√£o.  Esta quest√£o est√° al√©m do escopo do esquema de autoriza√ß√£o proposto.  Al√©m disso, onde consideraremos os riscos de perder a chave do SSO, o site √© recomendado para manter o token e o identificador do usu√°rio do SSO de lado e recomenda-se que o usu√°rio crie uma chave permanente para S. <br><blockquote>  <b>Vulnerabilidade:</b> ap√≥s essa autoriza√ß√£o, os sites S1, S2, S3, ... (onde voc√™ acessou o Google) poder√£o reconhec√™-lo (pelo identificador atribu√≠do a voc√™ pelo Google) e, como resultado, rastrear sua atividade. </blockquote><br><blockquote>  <b>Op√ß√£o de prote√ß√£o:</b> n√£o trabalhe simultaneamente em sites se voc√™ se registrou atrav√©s do SSO do mesmo provedor.  Se poss√≠vel, efetue logout no servidor de autoriza√ß√£o imediatamente ap√≥s a conclus√£o da autoriza√ß√£o ("sa√≠da autom√°tica" para o dom√≠nio). </blockquote><br><br><a name="how_make_sub_domain_identify"></a><h2>  1.10 Como implementar a autentica√ß√£o entre dom√≠nios? </h2><br>  Tudo isso, claro, √© bom.  Enquanto o trabalho √© realizado em um navegador - est√° tudo bem.  Mas e as realidades modernas quando uma pessoa tem dois telefones celulares, um computador em funcionamento e v√°rios navegadores, um computador dom√©stico e outro laptop?  Al√©m de um tablet comum para a esposa / filhos. <br>  De alguma forma, teremos que resolver o problema da transfer√™ncia de chaves de dom√≠nio entre navegadores, dispositivos.  E tamb√©m resolva o problema de sua sincroniza√ß√£o correta. <br>  Um dos mecanismos para resolver esse problema √© calcular v√°rias chaves de dom√≠nio com base em uma chave mestra comum, sem a possibilidade de recupera√ß√£o reversa da chave mestra de uma chave de dom√≠nio conhecida. <br>  Ao criar uma chave pessoal K para o dom√≠nio D usando a chave mestre M em um dispositivo, o usu√°rio poder√° criar a mesma chave K para o dom√≠nio D e em qualquer outra usando a mesma chave mestre M e um √∫nico algoritmo.  Mais precisamente, isso ser√° feito n√£o pelo usu√°rio, mas pelo navegador.  Com essa abordagem, √© suficiente para o usu√°rio distribuir sua chave mestra entre todos os navegadores usados ‚Äã‚Äãpor ele e ele "transfere todas as suas chaves" de dom√≠nios de uma s√≥ vez.  Ao mesmo tempo, faz backups dessa maneira. <br>  M√°xima comodidade do usu√°rio.  <b>Mas tamb√©m o risco m√°ximo</b> em caso de comprometimento da chave mestra.  Portanto, este √∫ltimo deve ser protegido adequadamente.  Os riscos de perda ou comprometimento da chave mestra e as formas de minimizar esses riscos est√£o descritos no cap√≠tulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"3 Recomenda√ß√µes de seguran√ßa"</a> . <br>  Usar apenas uma chave mestra para gerar todas as chaves para todos os dom√≠nios nem sempre √© uma op√ß√£o conveniente.  Em primeiro lugar, o que fazer se de repente a chave do dom√≠nio for comprometida e precisar ser alterada?  Em segundo lugar, e se voc√™ precisar compartilhar uma chave de dom√≠nio com outra pessoa?  Por exemplo, entre membros da fam√≠lia.  Ou √© uma conta corporativa de acesso ao correio p√∫blico.  Como, ent√£o, "pegar" sua chave (porque na verdade ela foi comprometida)? <br>  Portanto, a gera√ß√£o de chaves de dom√≠nio individuais usando um sensor de n√∫mero aleat√≥rio biol√≥gico deve ser suportada pelos navegadores.  Mas voltamos novamente √† quest√£o de nossa mobilidade e aos problemas de sincroniza√ß√£o, √†s fun√ß√µes de exportar e importar chaves no navegador e criar c√≥pias de backup. <br><br><h3>  Transferir atrav√©s de um dispositivo f√≠sico alien√°vel </h3><br>  Cart√µes inteligentes e tokens USB podem ser bastante adequados como armazenamento seguro de informa√ß√µes importantes (porque foram criadas para isso).  A autentica√ß√£o de dois fatores protege as chaves contra acesso n√£o autorizado com acesso direto ao dispositivo. <br>  √â verdade que os cart√µes inteligentes requerem leitores especiais (para n√£o mencionar drivers), o que limita seu uso apenas √†s esta√ß√µes de trabalho equipadas com esses leitores. <br>  Com tokens USB um pouco mais f√°cil.  Somente drivers s√£o necess√°rios.  Mas voc√™ n√£o pode colocar esse s√≠mbolo no telefone.  E embora para telefones celulares existam tokens feitos na forma de cart√µes SD, para n√£o dizer que esta solu√ß√£o aumenta a mobilidade.  Tente desenhar um cart√£o de um telefone celular, mas insira-o em outro.  E n√£o √© que isso seja imposs√≠vel.  O problema √© que n√£o √© conveniente. <br>  E se o token quebrar?  Ent√£o todas as suas chaves ir√£o para o Grande Cthulhu. <br>  Portanto, haver√° uma tenta√ß√£o com esse esquema de usar v√°rios dispositivos duplicados.  Mas voc√™ ainda precisar√° resolver o problema de sincroniza√ß√£o de chaves se tiver v√°rios cart√µes inteligentes. <br>  E, francamente, esses dispositivos n√£o est√£o protegidos contra keyloggers.  Agora, se o c√≥digo PIN for inserido no pr√≥prio cart√£o / token.  Ent√£o outra coisa.  Mas eu n√£o vi isso na natureza. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/1g/js/gq1gjsgtxvfjjvs79syif5_u8_w.png"></div><br><blockquote>  <b>Pr√≥s:</b> chaves aleat√≥rias de 256 bits podem ser usadas;  alta seguran√ßa atrav√©s do uso de autentica√ß√£o de dois fatores;  o mais alto n√≠vel de prote√ß√£o contra adultera√ß√£o direta. <br>  <b>Contras:</b> depend√™ncia do dispositivo;  requer custos financeiros;  baixa mobilidade;  a necessidade de reservar cart√µes e, como resultado, sincronizar dados entre eles;  permanece vulner√°vel a keyloggers. <br></blockquote><br><h3>  Sincronizar via servi√ßo online </h3><br>  A "tecnologia em nuvem" agora √© empurrada sempre que poss√≠vel.  Parece que eles, juntamente com o blockchain, se tornaram um substituto para a "tecnologia da banana".  Naturalmente, existe o desejo de usar uma certa plataforma da Internet para a troca de informa√ß√µes importantes.  Um tipo de cart√£o inteligente "online". <br>  O que?  Voc√™ efetua login usando nosso esquema anonimamente em um site desse tipo;  envie suas chaves criptografadas com uma senha l√°;  Voc√™ vai de outro dispositivo para o mesmo site com a mesma chave / senha;  voc√™ pega as chaves de l√°;  Voc√™ sincroniza as altera√ß√µes na data da edi√ß√£o.  Semelhante ao gerenciador de senhas, somente isso est√° online. <br>  Isso √© justo, ningu√©m garante que o servi√ßo on-line n√£o ser√° invadido ou n√£o mesclar√° suas chaves, embora criptografadas, "onde necess√°rio".  Quem implementar√° esse servi√ßo gratuitamente.  √â isso. <br>  Embora, √© claro, a senha proteja as chaves do uso direto.  Mas sua senha √© resistente √† for√ßa bruta "offline"?  Essa √© outra quest√£o. <br><blockquote>  <b>Pr√≥s:</b> alta mobilidade de credenciais;  independ√™ncia de dispositivo e navegador;  voc√™ precisa de apenas uma senha (embora elas n√£o tenham deixado a senha, j√° √© melhor). <br>  <b>Desvantagens:</b> menos seguro do que armazenar chaves em um meio alien√°vel.  De fato, a seguran√ßa das chaves √© baseada na for√ßa da senha da sele√ß√£o. <br></blockquote><br>  Obviamente, voc√™ pode usar uma chave mestra para criptografar outras chaves.  Aquele com o qual outras chaves de dom√≠nio s√£o calculadas.  Como uma op√ß√£o <br><br><a name="part2"></a><h1>  2 Descri√ß√£o t√©cnica do protocolo </h1><br><br><a name="perm_key_algo"></a><h2>  2.0 Algoritmo de gera√ß√£o de chave de dom√≠nio </h2><br>  Este protocolo define apenas 2 m√©todos para gerar chaves de dom√≠nio. <br><br><ul><li>  com base em um gerador de n√∫meros aleat√≥rios (de prefer√™ncia biol√≥gico) </li><li>  com base em uma chave mestra de 256 bits </li></ul><br>  No √∫ltimo caso, a chave do dom√≠nio √© calculada como: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/3aa/d39/ac7/3aad39ac79fc322d157a9f4c58a793f2.svg" alt="$ K = HMAC_ {M_ {key}} (Dom√≠nio) $" data-tex="display"></p>  onde <math></math><img src="https://habrastorage.org/getpro/habr/formulas/0b7/f4d/5a6/0b7f4d5a6dcc0d36804bd9dfc0ff9403.svg" alt="$ M_ {key} $" data-tex="inline">  - chave mestra de 256 bits, Dom√≠nio - nome do dom√≠nio para o qual a chave foi feita. <br>  A seguir, o <i>HMAC</i> √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um algoritmo criptogr√°fico de hash</a> baseado em uma implementa√ß√£o de 256 bits da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fun√ß√£o de</a> hash <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SHA-2</a> . <br><blockquote>  A divulga√ß√£o comprometida ou volunt√°ria de uma chave de dom√≠nio n√£o compromete a chave mestra original. </blockquote><br>  A chave mestra fornece um mecanismo para a mobilidade das credenciais do usu√°rio. <br><div class="spoiler">  <b class="spoiler_title">Nota</b> <div class="spoiler_text">  Na vers√£o inicial do protocolo, a op√ß√£o de gerar chaves de dom√≠nio com base na senha do usu√°rio foi considerada como assegurando a mobilidade do usu√°rio e protegendo contra comprometimento de senha ao invadir um site.  Mas no cap√≠tulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚Äú3 Recomenda√ß√µes de Seguran√ßa‚Äù,</a> ser√£o dadas explica√ß√µes sobre por que foi decidido recusar tal esquema. </div></div><br>  Se a chave criada com base no "mestre" foi comprometida ou o token calculado a partir dessa chave (como resultado da invas√£o do site) foi comprometido, a chave deve ser alterada.  Voc√™ pode alter√°-lo para uma chave aleat√≥ria de 256 bits ou ger√°-lo a partir do mesmo "assistente", com a adi√ß√£o de uma vers√£o: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/eae/301/46b/eae30146bac887a402418464641e617e.svg" alt="$ K = HMAC_ {Mkey} (vers√£o do dom√≠nio \ cup) $" data-tex="display"></p>  A seguir, o s√≠mbolo <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ x√≠cara $" data-tex="inline">  ser√° usado para opera√ß√£o de concatena√ß√£o de strings (matrizes de bytes). <br><br><a name="token_algo"></a><h2>  2.1 o algoritmo para calcular o token de origem </h2><br>  O token de autentica√ß√£o do usu√°rio √© calculado com todas as solicita√ß√µes de qualquer recurso de dom√≠nio.  Para calcular o token de solicita√ß√£o, os seguintes dados s√£o obtidos: <br><br><ul><li>  <i>Remetente</i> - o nome de dom√≠nio do iniciador da solicita√ß√£o (pode ser uma p√°gina com um iframe ou um script do dom√≠nio de outra pessoa que realiza a busca), </li><li>  <i>Destinat√°rio</i> - nome de dom√≠nio do destinat√°rio (para onde a solicita√ß√£o √© enviada), </li><li>  <i>Contexto</i> - solicite o contexto de execu√ß√£o, </li><li>  <i>Prote√ß√£o</i> - uma sequ√™ncia aleat√≥ria de 32 bytes (256 bits), se o Contexto estiver vazio;  caso contr√°rio vazio </li></ul><br>  Esses dados s√£o concatenados e agrupados com SHA-2 de 256 bits <b>na chave K do dom√≠nio que inicia a solicita√ß√£o</b> : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8d1/bd1/cbc/8d1bd1cbc81815e0121976c9bb5e4ccc.svg" alt="$ K = HMAC_M (Remetente \ copo Destinat√°rio \ copo contexto / prote√ß√£o Cup) $" data-tex="display"></p><blockquote>  Um token v√°lido √© obtido quando o Contexto n√£o est√° vazio.  Para uma identifica√ß√£o adequada no site de destino, a condi√ß√£o Remetente = Destinat√°rio = Contexto deve ser atendida. </blockquote><br>  O campo Contexto, junto com Prote√ß√£o, √© usado para proteger contra ataques <abbr title="Script entre sites - &quot;script entre sites&quot;">XSS</abbr> e <abbr title="Falsifica√ß√£o de solicita√ß√£o entre sites - &quot;falsifica√ß√£o de solicita√ß√£o entre sites&quot;">CSRF</abbr> , bem como do rastreamento de usu√°rios. <br>  Explica√ß√µes mais detalhadas sobre as regras para determinar Remetente / Destinat√°rio / Contexto ser√£o fornecidas abaixo. <br><br><a name="token_validation_algo"></a><h2>  2.2 Algoritmo de prote√ß√£o de token durante a transfer√™ncia </h2><br>  O token do cliente original √© transmitido extremamente raramente.  Somente ao transferir um token n√£o registrado no momento em que a sess√£o foi criada. <br>  <b>Um token √© considerado n√£o registrado</b> se: √© criado com base em uma chave aleat√≥ria (n√£o fixa);  n√£o foi aceito pelo servidor ap√≥s o envio da chave Alterar para ou Permanente.  Para mais detalhes, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúProcessando tokens no servidor‚Äù</a> . <br>  O navegador e o servidor geram conjuntamente um par de n√∫meros aleat√≥rios, os chamados  salt (Salt), com o qual os 128 bits inferiores do token s√£o hash.  Ambos trocam esses n√∫meros de acordo com o protocolo.  Para detalhes, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúServidor de Procedimentos de Troca de Sal‚Äù</a> . <br>  Portanto, o servidor do site v√™ o seguinte token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$ T = Ol√° (T_s) \ x√≠cara HMAC_ {salt} (Lo (T_s)) $" data-tex="display"></p>  onde <math></math><img src="https://habrastorage.org/getpro/habr/formulas/69c/826/a5b/69c826a5bc2d0953c3db1dbcc842a035.svg" alt="$ Ol√° (T_s) $" data-tex="inline">  - 128 bits altos, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/73a/cbf/6b4/73acbf6b426b5d3dff599b4cba44ebfd.svg" alt="$ Lo (T_s) $" data-tex="inline">  - os 128 bits inferiores do token original, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ x√≠cara $" data-tex="inline">  - concatena√ß√£o de strings.  Nesse caso, o token inicial <math></math><img src="https://habrastorage.org/getpro/habr/formulas/c39/070/036/c39070036bed1c9b371606081981a5fb.svg" alt="$ T_s $" data-tex="inline">  j√° deve ser conhecido pelo servidor. <br><br>  Idealmente, o CSI-Salt deve mudar toda vez que um navegador solicita um servidor.  No entanto, isso pode ser um requisito caro em termos de recursos de computa√ß√£o.  Al√©m disso, ele pode "matar" a capacidade de enviar solicita√ß√µes paralelas ao servidor. <br>  Portanto, para otimizar os c√°lculos, √© permitido manter os valores de CSI-Salt inalterados em diferentes solicita√ß√µes, <u>mas n√£o mais que uma sess√£o</u> .  Pode ser um limite de tempo (altera√ß√£o do CSI-Salt a cada 5 minutos) ou uma rea√ß√£o √† intensidade das solicita√ß√µes (altera√ß√£o do CSI-Salt a cada 100 solicita√ß√µes) ou ap√≥s cada s√©rie de solicita√ß√µes (no momento da pausa, cliente-servidor) ou uma vers√£o mista.  Aqui a decis√£o √© deixada para os desenvolvedores do navegador. <br>  Manter o CSI-Salt inalterado por muito tempo enfraquece a prote√ß√£o do token transmitido, permitindo que o invasor, ao interceptar o token, use-o at√© que o usu√°rio leg√≠timo conclua o Logout e fa√ßa uma solicita√ß√£o n√£o autorizada em nome da v√≠tima. <br><br><a name="salt_exchange_algo"></a><h2>  2.3 Procedimento de troca de sal entre o navegador e o servidor </h2><br>  2.3.1 Token baseado em uma chave de servidor <sup>[1]</sup> aleat√≥ria ou n√£o registrada. <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Navegador</b> </th><th>  <b>Servidor</b> </th></tr><tr><td colspan="2">  <b>Solicita√ß√£o inicial (inicializa√ß√£o da sess√£o do usu√°rio)</b> </td></tr><tr><td>  O navegador envia o token como est√°. <br>  <b>Sua solicita√ß√£o est√° faltando CSI-Salt.</b> <br></td><td>  O servidor v√™ pela primeira vez esse token. <br><div class="spoiler">  <b class="spoiler_title">a prop√≥sito</b> <div class="spoiler_text">  O servidor pode n√£o ser o primeiro a ver esse token.  E o navegador √© considerado n√£o registrado.  Isso pode acontecer <u>quando voc√™ recriar a chave com base na chave mestra em outro dispositivo</u> .  Portanto, essa situa√ß√£o tamb√©m deve ser levada em considera√ß√£o. </div></div><br>  Percebe como √© (considera desprotegido).  Usa esse token como um identificador de sess√£o. <br>  Gera seu <i><sub>sal</sub> S.</i> <br>  <b>Retorna na resposta no cabe√ßalho CSI-Salt.</b> <br></td></tr><tr><td colspan="2">  <b>Segundo pedido</b> </td></tr><tr><td>  Gera sal <i>Com <sub>sal</sub></i> . <br>  O navegador conecta <sup>[3]</sup> seu sal e o sal do servidor. <br>  O navegador envia a solicita√ß√£o, passando um token de sal compartilhado. <br>  <b>Envia CSI-Salt.</b> <br></td><td>  O servidor recebe a solicita√ß√£o e <b>recupera o cliente CSI-Salt</b> . <br>  O servidor conecta o salt do navegador ao seu pr√≥prio e o utiliza para verificar o token. <br><br>  Se a valida√ß√£o do token for bem-sucedida, ele fornecer√° ao usu√°rio conte√∫do de acordo com seus direitos. <br><br>  Em erros de verifica√ß√£o, retorna o cabe√ßalho <b>CSI-Token-Action: inv√°lido</b> para o cliente.  Retornar conte√∫do ou retornar uma resposta vazia: depende do servidor. <br></td></tr><tr><td colspan="2">  <b>Solicita√ß√µes subsequentes</b> </td></tr><tr><td>  O navegador envia a solicita√ß√£o, passando um token de sal compartilhado. <br>  <b>Sua solicita√ß√£o est√° faltando CSI-Salt.</b> <br></td><td>  O servidor recebe a solicita√ß√£o e verifica seu token. <br><br>  Se a valida√ß√£o do token for bem-sucedida, ele fornecer√° ao usu√°rio conte√∫do de acordo com seus direitos. <br><br>  Em erros de verifica√ß√£o, retorna o cabe√ßalho <b>CSI-Token-Action: inv√°lido</b> para o cliente.  Retornar conte√∫do ou retornar uma resposta vazia: depende do servidor. <br></td></tr><tr><td colspan="2">  <b>Depois de um tempo <sup>[2]</sup></b> </td></tr><tr><td>  Gera um novo sal <i>C <sub>sal</sub></i> . <br>  Conecte o novo sal ao servidor. <br>  Envia uma solicita√ß√£o, passando um token protegido por um novo sal comum. <br>  <b>Envia CSI-Salt.</b> <br></td><td>  O servidor recebe a solicita√ß√£o e <b>recupera o novo cliente CSI-Salt</b> . <br>  O servidor conecta o salt do navegador ao seu pr√≥prio e o utiliza para verificar o token. <br><br>  Se a valida√ß√£o do token for bem-sucedida, ele fornecer√° ao usu√°rio conte√∫do de acordo com seus direitos. <br><br>  Em erros de verifica√ß√£o, retorna o cabe√ßalho <b>CSI-Token-Action: inv√°lido</b> para o cliente.  Retornar conte√∫do ou retornar uma resposta vazia: depende do servidor. <br></td></tr></tbody></table></div><br>  2.3.2 Token baseado na chave registrada pelo servidor <sup>[1]</sup> . <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Navegador</b> </th><th>  <b>Servidor</b> </th></tr><tr><td colspan="2">  <b>Solicita√ß√£o inicial (inicializa√ß√£o da sess√£o do usu√°rio)</b> </td></tr><tr><td>  Gera sal <i>Com <sub>sal</sub></i> . <br>  <b>Envia CSI-Salt.</b> <br>  Transfere o token em um formul√°rio protegido. <br></td><td>  O servidor recebe a solicita√ß√£o e <b>recupera o cliente CSI-Salt</b> . <br>  L√™ um token protegido. <br>  Localiza o token de cliente completo em seu banco de dados (usa o primeiro token de 128 bits recebido na solicita√ß√£o de pesquisa). <br>  Porque  essa √© a solicita√ß√£o inicial, o servidor n√£o enviou sal ao cliente e a <b>valida√ß√£o</b> do <b>token neste est√°gio √© realizada apenas pelo sal do cliente</b> . <br><br>  Em erros de verifica√ß√£o, retorna o cabe√ßalho <b>CSI-Token-Action: inv√°lido</b> para o cliente.  Retornar conte√∫do ou retornar uma resposta vazia: depende do servidor. <br><br>  Se a valida√ß√£o do token for bem-sucedida, ele fornecer√° ao usu√°rio conte√∫do de acordo com seus direitos. <br><br>  Gera seu <i><sub>sal</sub> S.</i> <br>  <b>Retorna na resposta no cabe√ßalho CSI-Salt</b> . <br></td></tr><tr><td colspan="2">  <b>Solicita√ß√µes subsequentes</b> </td></tr><tr><td>  O navegador combina o sal e o sal do servidor. <br>  O navegador envia a solicita√ß√£o, passando um token de sal compartilhado. <br>  <b>Sua solicita√ß√£o est√° faltando CSI-Salt</b> . <br></td><td>  O servidor recebe a solicita√ß√£o e verifica seu token. <br><br>  Se a valida√ß√£o do token for bem-sucedida, ele fornecer√° ao usu√°rio conte√∫do de acordo com seus direitos. <br><br>  Em erros de verifica√ß√£o, retorna o cabe√ßalho <b>CSI-Token-Action: inv√°lido</b> para o cliente.  Retornar conte√∫do ou retornar uma resposta vazia: depende do servidor. <br></td></tr><tr><td colspan="2">  <b>Depois de um tempo <sup>[2]</sup></b> </td></tr><tr><td>  Gera um novo sal <i>C <sub>sal</sub></i> . <br>  O navegador conecta o novo sal ao servidor. <br>  O navegador envia a solicita√ß√£o, passando um token protegido pelo novo sal compartilhado. <br>  <b>Envia CSI-Salt</b> . <br></td><td>  O servidor recebe a solicita√ß√£o e <b>recupera o novo cliente CSI-Salt</b> . <br>  O servidor conecta o salt do navegador ao seu pr√≥prio e o utiliza para verificar o token. <br><br>  Se a valida√ß√£o do token for bem-sucedida, ela fornecer√° ao usu√°rio o conte√∫do de acordo com seus direitos. <br><br>  Em erros de verifica√ß√£o, retorna o cabe√ßalho <b>CSI-Token-Action: inv√°lido</b> para o cliente.  Retornar conte√∫do ou retornar uma resposta vazia: depende do servidor. <br></td></tr></tbody></table></div><hr>  <sup>[1] Um token √© considerado n√£o registrado se: √© criado com base em uma chave aleat√≥ria;</sup>  <sup>n√£o foi aceito pelo servidor ap√≥s o envio da chave Alterar para ou Permanente com a resposta CSI-Token-Action: success.</sup> <sup><br></sup>  <sup>[2] O tempo durante o qual a altera√ß√£o CSI-Salt √© feita √© determinado pelos pr√≥prios navegadores.</sup>  <sup>Isso pode acontecer ap√≥s uma s√©rie de solicita√ß√µes, ap√≥s um tempo limite, ap√≥s um determinado n√∫mero de solicita√ß√µes.</sup> <sup>  ‚Äì <b>     CSI-Salt    </b> . <br> [3]     16-  128- .     ,   : <i> <sub>salt</sub></i> || <i>S <sub>salt</sub></i> .       ‚Äì     ,    .      ,    ,    .</sup> <br><br><a name="context_rules"></a><h2> 2.4    Context </h2><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text">      .   ,  -  .            . <br>       ,   .      ,     . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s chamaremos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nosso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dom√≠nio de cuja p√°gina estamos carregando (exibido na barra de endere√ßos do navegador). Os dom√≠nios restantes ser√£o chamados </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mesmo que esses sejam dom√≠nios filhos de um dado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chamamos o recurso de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se ele foi baixado de um dom√≠nio externo. Chamaremos o recurso de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interno</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se ele tiver sido baixado do nosso dom√≠nio. O recurso pode ser um script, imagem, solicita√ß√£o de ajax e qualquer outro arquivo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um script √© considerado externo se tiver sido baixado de um dom√≠nio externo. O script colocado na tag &lt;script&gt; criada, criada por um script externo, tamb√©m ser√° considerado externo. O script localizado na tag &lt;script&gt; modificada √© declarado externo se tiver sido modificado por um script externo ou se um script externo estiver presente na cadeia de chamadas quando seu conte√∫do for alterado. Mesmo se, ao mesmo tempo, esse &lt;script&gt; estivesse originalmente na p√°gina ou fosse criado por um script interno. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomearemos as tags LINK, SCRIPT, IMG, IFAME e outras, que exigem que o navegador carregue algum recurso assim que ele for atendido pelo analisador DOM - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tags de recurso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomearemos as tags FORM, A, META e outras, que podem iniciar o carregamento da p√°gina sob determinadas condi√ß√µes (enviar, clicar,timeout) - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iniciando tags</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s chamaremos a tag </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est√°tica</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se ela estava originalmente presente na p√°gina quando foi emitida pela primeira vez pelo servidor. Chamaremos a tag de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">din√¢mica</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se ela foi criada no processo de execu√ß√£o dos scripts. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tag FORM √© declarada din√¢mica, mesmo que n√£o apenas a tag em si tenha sido alterada, mas tamb√©m os valores de todos os campos INPUT associados a este formul√°rio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√≥s chamaremos uma tag din√¢mica </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nossa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se o script que a criou pertencer ao nosso dom√≠nio e a cadeia de chamadas da instru√ß√£o que gerou essa tag n√£o tiver uma fun√ß√£o pertencente a um script externo. Caso contr√°rio, consideramos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inadequada</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uma tag din√¢mica </font><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O carregamento da p√°gina √© acionado iniciando tags.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tag inicial pode ser ativada diretamente pelo usu√°rio, ou ativada pelo script, executando o comando click (para o link) e enviando (para o formul√°rio), ou pelo script que gera os eventos onclick / onsubmit correspondentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, a tag inicial pode ser ativada pelo navegador. </font><font style="vertical-align: inherit;">Um exemplo dessa tag √© META com os par√¢metros http-equiv = "refresh" content = "0". </font></font><br><br> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabela P. Valores de contexto sob diferentes condi√ß√µes de abertura da p√°gina</font></font></sup> <br><a name="context_table_P"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M√©todo de abertura </font></font></th><th colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quem acionou o carregamento da p√°gina? </font></font></th></tr><tr><th>  Usu√°rio </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√≥prio. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o navegador </font></font></th></tr><tr><td rowspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup> </td><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Est√°tico </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1 </font><font style="vertical-align: inherit;">Referenciador</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2 </font><font style="vertical-align: inherit;">Variante </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P3 </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P4 </font><font style="vertical-align: inherit;">Herdar</font></font></td></tr><tr><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Din√¢mico </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pr√≥prio </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5 </font><font style="vertical-align: inherit;">Herdar</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6 </font><font style="vertical-align: inherit;">Variante </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P7 </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8 </font><font style="vertical-align: inherit;">Herdar</font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Impr√≥pria </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P9 </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA. </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PB. </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC. </font><font style="vertical-align: inherit;">Vazio</font></font></td></tr><tr><td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Diretamente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD. </font><font style="vertical-align: inherit;">Dom√≠nio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE. </font><font style="vertical-align: inherit;">Variante </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pf. </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG. </font><font style="vertical-align: inherit;">Variante </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></sup> </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesma tabela, apenas imagem</font></font></b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/cq/l-/6e/cql-6eob6gouvsqsrdy5ltykhfg.gif" align="right"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a tag do recurso foi alterada por um script (por exemplo, o atributo SRC do IMG) e o recurso foi carregado automaticamente pelo navegador, acreditamos que o conte√∫do / recurso foi acionado pelo analisador, o m√©todo de carregamento √© a tag, mas o status dessa tag torna-se "din√¢mico". </font></font><br><br> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabela R. Valores de contexto sob diferentes condi√ß√µes para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">carregar conte√∫do / recurso</font></font></b></sup> <br><a name="context_table_R"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M√©todo de Download </font></font></th><th colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quem causou o download do conte√∫do? </font></font></th></tr><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Analisador de Dom </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√≥prio. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext. </font><font style="vertical-align: inherit;">Js</font></font></th></tr><tr><td rowspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup> </td><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Est√°tico </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1. </font><font style="vertical-align: inherit;">Page</font></font></td><td></td><td></td></tr><tr><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Din√¢mico </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pr√≥prio </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4. </font><font style="vertical-align: inherit;">Page</font></font></td><td></td><td></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Impr√≥pria </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R7. </font><font style="vertical-align: inherit;">Vazio</font></font></td><td></td><td></td></tr><tr><td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Diretamente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RA. </font><font style="vertical-align: inherit;">Referenciador</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB. </font><font style="vertical-align: inherit;">Page</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RC </font><font style="vertical-align: inherit;">Referenciador</font></font></td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesma tabela, apenas imagem</font></font></b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/dl/zi/mn/dlzimnup-7etmrsysxzlxjw1zd8.gif" align="right"></div></div><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[1] Iniciando tag </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[2] Resource tag </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[3] Herdar para p√°ginas pr√≥prias, Vazio ao abrir p√°ginas de dom√≠nios estrangeiros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[4] Herdar ao redirecionar servidores para suas p√°ginas, Vazio ao redirecionar para outros dom√≠nios ou abrir uma p√°gina de fontes externas (consulte . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clarifica√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></sup> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abrevia√ß√µes</font></font></b> <div class="spoiler_text"> <b>Referrer</b> ‚Äì     Referrer. <br> <b>Page</b> ‚Äì   (Tab)      . <br> <b>Empty</b> ‚Äì  . <br> <b>Domain</b> ‚Äì  Context     <br> <b>Inherit</b> ‚Äì  Context     <br> <b>Variant</b> ‚Äì  Context    ¬´-¬ª   <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Marcas no formato P1..PF, R1..RC ser√£o usadas para se referir √† c√©lula correspondente na tabela ao analisar situa√ß√µes espec√≠ficas. </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">referenciador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dom√≠nio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destacados </font><font style="vertical-align: inherit;">na primeira tabela. </font><font style="vertical-align: inherit;">Voc√™ s√≥ pode ser autorizado em um site quando voc√™ mesmo o abrir em um endere√ßo direto ou por um link de outro site, com o recarregamento subsequente da p√°gina por sua pr√≥pria iniciativa.</font></font></blockquote><br><br><a name="sender_recipient_rules"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.5 Regras para definir os campos Remetente e Destinat√°rio </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remetente √© o dom√≠nio da p√°gina / script / estilo do qual a solicita√ß√£o vem. </font><font style="vertical-align: inherit;">A p√°gina solicita estilos, imagens, scripts. </font><font style="vertical-align: inherit;">Os scripts solicitam conte√∫do via ajax. </font><font style="vertical-align: inherit;">Estilos podem carregar outros estilos. </font><font style="vertical-align: inherit;">Estes s√£o os iniciadores da solicita√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Destinat√°rio √© o dom√≠nio para o qual a solicita√ß√£o realmente vai. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para que n√£o restem perguntas, vamos considerar exemplos espec√≠ficos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que haja um site site.net. </font><font style="vertical-align: inherit;">Na p√°gina principal do site √©:</font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estilo site.net/css/common.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> os estilos common.css importam estilos de fonts.google.com/fonts/Roboto.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O estilo Roboto.css importa a fonte fonts.google.com/fonts/Roboto.ttf </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagem levando a img.site.net/picture1.jpg </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quadro carregado de adriver.ru/frame </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de adm.site.net/admin.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Deixe no quadro (com adriver.ru) conectar: </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estilo de adriver.ru/style.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foto de img.adriver.ru/img/01.png </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de adriver.ru/libs.js </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de api.adriver.ru/v1/ad.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valores de remetente / destinat√°rio ao carregar recursos com o analisador DOM </font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recurso para download </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valor do Remetente </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valor do Destinat√°rio </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/css/common.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.ttf </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net/picture1.jpg </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/frame </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/style.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru/img/01.png </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, vejamos os valores de Remetente / Destinat√°rio ao carregar conte√∫do com scripts durante a execu√ß√£o de solicita√ß√µes de ajax. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valores de remetente / destinat√°rio ao carregar conte√∫do com scripts</font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Script execut√°vel </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para onde est√° indo a solicita√ß√£o? </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Remetente </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Destinat√°rio </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru / ... </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru </font></font></td></tr></tbody></table></div><br><br><a name="context_tables_comments"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.6 Detalhes sobre tabelas de defini√ß√£o de contexto </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vamos considerar com mais detalhes quais op√ß√µes de abertura de p√°ginas (guias no navegador) temos e qual valor de contexto ser√° obtido. </font></font><br><br><a name="P1"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o usu√°rio na p√°gina anterior clicou no link ou no bot√£o enviar no formul√°rio. O manipulador de navegador de eventos padr√£o para o link / formul√°rio redirecionou o usu√°rio para esta p√°gina. Situa√ß√£o normal. Transi√ß√£o segura entre p√°ginas de um dom√≠nio ou dom√≠nios diferentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao alternar para o site.net de outro dom√≠nio do google.com, o Contexto ser√° igual ao dom√≠nio anterior (google.com). E o usu√°rio no novo dom√≠nio site.net n√£o ser√° autorizado (mesmo que a guia vizinha deste site onde o usu√°rio est√° autorizado esteja aberta). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A transi√ß√£o independente repetida do usu√°rio (sem a assist√™ncia de scripts) por meio do link para o mesmo site levar√° novamente √† situa√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas o Contexto j√° ser√° igual ao dom√≠nio site.net, porque pela regra Contexto = Referenciador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â feito para proteger contra</font></font><abbr title="Falsifica√ß√£o de solicita√ß√£o entre sites - &quot;falsifica√ß√£o de solicita√ß√£o entre sites&quot;"><font style="vertical-align: inherit;"></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ataque </font><abbr title="ross Site Request Forgery ‚Äî ¬´  ¬ª"><font style="vertical-align: inherit;">CSRF</font></abbr><font style="vertical-align: inherit;"> .</font></font><br><br><a name="P5"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o usu√°rio da p√°gina anterior clicou no link criado / modificado por um script baixado do dom√≠nio da p√°gina anterior; </font><font style="vertical-align: inherit;">ou o usu√°rio na p√°gina anterior clicou no bot√£o enviar do formul√°rio criado / modificado pelo script (alterando a tag FORM, incluindo seus campos INPUT). </font><font style="vertical-align: inherit;">O manipulador de navegador de eventos padr√£o para o link / formul√°rio redirecionou o usu√°rio para esta p√°gina.</font></font><br><br><a name="P9"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P9</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© igual a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o script era externo ou existe uma fun√ß√£o de um script externo na cadeia de chamadas (prote√ß√£o contra a edi√ß√£o das fun√ß√µes de script do script do site por um script de terceiros).</font></font><br><br><a name="PD"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o usu√°rio abriu a p√°gina em um endere√ßo direto. </font><font style="vertical-align: inherit;">Abertura segura.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O usu√°rio deve abrir a p√°gina digitando o URL na barra de endere√ßo. </font><font style="vertical-align: inherit;">Ou abra um site a partir dos favoritos do navegador.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao abrir um link a partir de um atalho na √°rea de trabalho de outro programa, qualquer outra situa√ß√£o em que o SO envie um comando ao navegador para abrir o link deve ser considerado um caso de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (a abertura do link √© iniciada pelo navegador). Mesmo se o usu√°rio pressionar F5 para recarregar a p√°gina, isso deve ser considerado um caso de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Somente se o usu√°rio entrar na barra de endere√ßos e pressionar Enter ser√° considerado pelo navegador como um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© feito para proteger ataques CSRF de outros programas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguir o link de outro programa levar√° o usu√°rio ao site atacado com um token inv√°lido e um Contexto vazio, que ser√° salvo mesmo que o usu√°rio pressione F5 (atualize a p√°gina). Voc√™ n√£o pode fazer login at√© que o usu√°rio abra qualquer link para as p√°ginas do site (situa√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, se um invasor de outro programa decidir inserir um link para a p√°gina do site site.net que est√° executando um comando, o usu√°rio autorizado n√£o poder√° fazer isso com facilidade. Ser√° necess√°rio for√ßar o usu√°rio a clicar em outro link nesta p√°gina, for√ßar o usu√°rio a se autenticar l√°, e somente ent√£o ... Ent√£o, o usu√°rio provavelmente estar√° em outra p√°gina do site.net.</font></font><br><br><a name="P2"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - na p√°gina anterior de um link ou formul√°rio originalmente colocado na p√°gina, um script nativo da p√°gina anterior gerava um evento de clique / envio. </font><font style="vertical-align: inherit;">N√£o havia fun√ß√µes na cadeia de chamadas que pertenciam a scripts externos. </font><font style="vertical-align: inherit;">O navegador redirecionou o usu√°rio para esta p√°gina. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a nova p√°gina pertencer ao mesmo dom√≠nio, o contexto ser√° herdado da p√°gina anterior. </font><font style="vertical-align: inherit;">Se a nova p√°gina pertencer a um dom√≠nio externo, o Contexto ficar√° em branco.</font></font><br><br><a name="P6"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o mesmo que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o link / formul√°rio foi criado / modificado por seu pr√≥prio script.</font></font><br><br><a name="PA"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o mesmo que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o link / formul√°rio foi criado / modificado por um script externo.</font></font><br><br><a name="PE"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o script da p√°gina anterior provocou a abertura desta p√°gina com o comando window.location.href ou window.open (...). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o script da p√°gina site.net redirecionar o usu√°rio para a p√°gina do mesmo dom√≠nio, o campo Contexto ser√° herdado da p√°gina geradora. Nesse caso, Context = site.net. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a p√°gina ya.ru foi aberta e o script nos transferiu para maps.ya.ru, o Contexto da nova p√°gina j√° estar√° vazio. Nas a√ß√µes subseq√ºentes do usu√°rio, o Contexto quase sempre permanecer√° vazio, o que complicar√° a autoriza√ß√£o do usu√°rio no site. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O protocolo implica que abrir um site de outro √© uma opera√ß√£o insegura. Isso protege o usu√°rio contra rastreamento n√£o autorizado por esses sites e contra ataques de CSRF.</font></font><br><br><a name="P3"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o evento de clique / envio foi acionado por um script externo. </font><font style="vertical-align: inherit;">O contexto fica vazio (uma sequ√™ncia aleat√≥ria de bytes √© enviada), o que protege sites de terceiros do rastreamento do site (redes de banners).</font></font><br><br><a name="P7"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o link / formul√°rio foi criado / modificado por um script externo.</font></font><br><br><a name="PB"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o link / formul√°rio foi criado / modificado por um script externo.</font></font><br><br><a name="PF"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PF</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o roteiro provocativo era externo.</font></font><br><br><a name="P4"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o navegador recarregou a p√°gina como resultado do processamento da tag &lt;META&gt;. </font><font style="vertical-align: inherit;">A tag estava originalmente na p√°gina. </font><font style="vertical-align: inherit;">Redirecionamento legal. </font><font style="vertical-align: inherit;">O contexto persistir√° da p√°gina original. </font><font style="vertical-align: inherit;">Como √© o caso do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="P8"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o navegador recarregou a p√°gina como resultado do processamento da tag &lt;META&gt;. </font><font style="vertical-align: inherit;">Mas a tag foi criada / modificada por seu pr√≥prio script. </font><font style="vertical-align: inherit;">Isso √© v√°lido, mas o contexto persistir√° da p√°gina original. </font><font style="vertical-align: inherit;">Como √© o caso do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">N√£o ser√° poss√≠vel atrair o token legal do usu√°rio dessa maneira.</font></font><br><br><a name="PC"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas script externo. </font><font style="vertical-align: inherit;">O site aberto receber√° um n√∫mero aleat√≥rio como contexto.</font></font><br><br><a name="PG"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - navegador abre links sob comando no sistema operacional. </font><font style="vertical-align: inherit;">Pode ser que voc√™ clique em um link de outro programa, abra um atalho na √°rea de trabalho. </font><font style="vertical-align: inherit;">Este pode ser um comando de outro programa, sem o seu conhecimento. </font><font style="vertical-align: inherit;">Nesse caso, a fonte n√£o √© confi√°vel e o campo Contexto permanecer√° vazio durante qualquer manipula√ß√£o do usu√°rio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© feito para proteger ataques CSRF de outros programas.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se o pr√≥prio navegador abrir as guias salvas anteriormente, o Contexto da p√°gina ser√° definido igual ao valor desta p√°gina no momento do fechamento do navegador. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, esta categoria inclui todas as situa√ß√µes em que o navegador √© redirecionado pelo servidor para outra p√°gina (de seu dom√≠nio ou de outra pessoa) como resultado do processamento do cabe√ßalho HTTP do cabe√ßalho. </font><font style="vertical-align: inherit;">Se o redirecionamento for para sua pr√≥pria p√°gina, o valor de Contexto ser√° herdado. </font><font style="vertical-align: inherit;">Se o redirecionamento for para o de outra pessoa, ele ser√° redefinido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© feito para proteger contra o rastreamento de ataques de servidores da web.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A prop√≥sito, essa regra pode causar problemas com a implementa√ß√£o atual da autoriza√ß√£o entre dom√≠nios. </font><font style="vertical-align: inherit;">Se ap√≥s a autoriza√ß√£o, o servidor SSO redirecionar o usu√°rio de volta ao site de destino, o √∫ltimo ser√° an√¥nimo l√°.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para impedir que o usu√°rio "perca" a autoriza√ß√£o original no site de destino, √© necess√°rio transmitir informa√ß√µes de autentica√ß√£o entre as solicita√ß√µes do servidor. </font><font style="vertical-align: inherit;">O algoritmo pode ser o seguinte:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o usu√°rio cria e ativa uma chave permanente para o site de destino; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vai do site de destino para o servidor SSO, clicando no link apropriado; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ativa a chave permanente existente do servidor SSO; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ap√≥s receber a chave Changed-To, o servidor SSO envia uma solicita√ß√£o entre servidores para o site de destino; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o usu√°rio clica no bot√£o "Continuar" na p√°gina de autoriza√ß√£o, que o retorna de volta ao site de destino; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para cumprir a regra </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o site de destino oferece ao usu√°rio que clique no bot√£o de link novamente, levando a ele (por exemplo, para a p√°gina inicial de um participante autorizado).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o usu√°rio clica no bot√£o de link, a p√°gina √© recarregada e o usu√°rio j√° est√° autorizado no site de destino. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A descri√ß√£o do algoritmo parece realmente mais complicada do que sua implementa√ß√£o. </font><font style="vertical-align: inherit;">Uma implementa√ß√£o de interface do usu√°rio pode ter esta apar√™ncia:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A reintrodu√ß√£o no site de destino n√£o requer mais autoriza√ß√£o do SSO do usu√°rio. </font><font style="vertical-align: inherit;">√â o suficiente para ativar a chave permanente.</font></font></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora, vamos examinar mais de perto as op√ß√µes de carregamento de conte√∫do nas p√°ginas e qual valor de contexto ser√° obtido mediante solicita√ß√£o. </font></font><br><br><a name="R1"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o recurso √© carregado pelo navegador como resultado da an√°lise da p√°gina (o navegador encontrou uma etiqueta de recurso). </font><font style="vertical-align: inherit;">O valor de contexto ao gerar uma solicita√ß√£o para um recurso √© obtido na p√°gina Contexto que cont√©m a marca do recurso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, se site.net tiver um quadro adriver.ru no qual a imagem de img.disk.com √© carregada, ao gerar uma solicita√ß√£o HTTP para img.disk.com, o navegador utilizar√° o valor calculado como o Contexto da p√°gina site.net.</font></font><br><br><a name="R4"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o mesmo que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Somente a tag de recurso foi criada / modificada por seu pr√≥prio script, como resultado do qual o Analisador DOM do navegador funcionou. Por exemplo, na p√°gina site.net/index.html, nosso pr√≥prio script site.net/require.js inseriu outro script personalizado (&lt;script src = ...&gt; tag) site.net/min.js, que for√ßou o navegador a gerar uma solicita√ß√£o de download de arquivo main.js. O campo Contexto nesta solicita√ß√£o ser√° definido como o valor calculado para a p√°gina site.net.</font></font><br><br><a name="R7"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© o mesmo que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por√©m, como a tag do recurso foi criada / modificada por um script externo, quando o recurso √© solicitado, o navegador gera um token com base em um Contexto vazio e uma sequ√™ncia aleat√≥ria de 256 bits. Como resultado, o script externo do invasor evil.com/drop.js, incorporado na p√°gina do dom√≠nio site.net atacado, tentando atender a uma solicita√ß√£o ao site.net de destino em nome da v√≠tima falhar√°, porque o servidor receber√° uma solicita√ß√£o com um token aleat√≥rio e n√£o poder√° identificar o remetente da solicita√ß√£o.</font></font><br><br><a name="RA"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> analisador de </font><b><font style="vertical-align: inherit;">RA</font></b><font style="vertical-align: inherit;"> baixa o conte√∫do como resultado da an√°lise de outro conte√∫do. Por exemplo, a folha de estilo site.net/css/common.css, baixada para a p√°gina site.net/index.html, importa a folha de estilo fonts.google.com/fonts/Roboto.css, que for√ßa o navegador a solicitar fonts.google .com em nome de Referrer = site.net/css/common.css. O valor do contexto neste caso ser√° igual ao referenciador. Em seguida, o arquivo de estilos Roboto.css importa a fonte Roboto.ttf, que for√ßa o navegador a solicitar fonts.google.com/fonts/Roboto.ttf em nome de Referrer = fonts.google.com/fonts/Roboto.css. O valor do contexto ser√° igual a Referrer neste caso, mas √© diferente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suponha, hipoteticamente, que o arquivo Roboto.css (recurso externo) n√£o importe uma fonte / estilo, mas tente realizar um ataque CSRF com esta instru√ß√£o:</font></font><pre><code class="css">@import "https://site.net/api/payment?victim_params"</code> </pre>  esperando atender √† solicita√ß√£o no site.net em nome de um usu√°rio autorizado.  Mas o problema do invasor √© que o site.net espera receber um token do usu√°rio: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/18c/ba0/6d3/18cba06d3ab48142219dbf3e3f4e2330.svg" alt="$ T_s ^ 1 = HMAC_k (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  Ent√£o, como em uma solicita√ß√£o CSRF, o navegador criar√° um token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/466/929/b86/466929b86ade0b848996042a3ac12f25.svg" alt="$ T_s ^ 2 = HMAC_k (fonts.google.com \ cup site.net \ cup fonts.google.com) $" data-tex="display"></p><br>  E uma solicita√ß√£o para o site vir√° em nome de um site an√¥nimo que n√£o possui direitos de acesso para executar essas opera√ß√µes. <br><br><a name="RB"></a>  <b>RB</b> - o conte√∫do √© carregado pelo pr√≥prio script do site.  Nesse caso, o contexto √© usado para calcular o token de solicita√ß√£o, que √© igual √† p√°gina que cont√©m o script.  Para o script site.net/1.js da p√°gina de contexto site.net, ser√° igual ao contexto da pr√≥pria p√°gina. <br><blockquote>  Observe que o contexto da p√°gina em si nem sempre √© igual ao nome de dom√≠nio da p√°gina e depende de como foi aberto originalmente. </blockquote>  Suponha que o site do atacante evil.com abra a p√°gina do site atacado site.net, onde o script site.net/util.js executa uma solicita√ß√£o com par√¢metros passados ‚Äã‚Äãpelo URL da p√°gina.  O invasor espera, ao passar "seus par√¢metros" pela URL, for√ßar seu pr√≥prio script site.net/util.js a executar uma solicita√ß√£o ajax para executar a√ß√µes importantes em nome da v√≠tima. <br><br>  Suponha que o pr√≥prio usu√°rio tenha acessado o evil.com por um link direto.  Ent√£o o contexto para evil.com ser√° evil.com.  Ent√£o, evil.com abre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site.net/api/payment?victim_params</a> com um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">script</a> , na esperan√ßa de iniciar um ataque, mas o campo Contexto para site.net estar√° vazio (caso de PE / PF).  O script site.net/utils.js, executando uma solicita√ß√£o ajax, for√ßar√° o navegador a obter o Contexto da p√°gina site.net.  E est√° vazio conosco.  Mas o site.net receber√° uma solicita√ß√£o ajax com este token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/866/a41/990/866a41990a710d17dbe34a04ecb2e28c.svg" alt="$ T = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup aleat√≥rio) $" data-tex="display"></p><br>  considerando que para um usu√°rio autorizado, √© esperado: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/025/1b3/fad/0251b3fadaf0e4f1535b6aa8a67df332.svg" alt="$ T_s = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  site.net ver√° um token desconhecido e n√£o poder√° identificar o usu√°rio.  A prote√ß√£o funcionou. <br><blockquote>  A prop√≥sito, por causa desse esquema, a realiza√ß√£o de autoriza√ß√£o entre dom√≠nios por meio de pop-ups ser√° irrealista. </blockquote>  Para implementar o SSO sob o protocolo, voc√™ deve abrir uma nova guia para a p√°gina do servidor de autoriza√ß√£o.  E, ao mesmo tempo, o usu√°rio deve abrir essa guia.  A melhor op√ß√£o √© abrir ao usu√°rio o link apropriado no site de destino. <br><br><a name="RC"></a>  <b>RC</b> - o conte√∫do √© carregado com um script de site externo.  Nesse caso, o contexto √© usado para calcular o token de solicita√ß√£o, que √© igual ao campo Referenciador de solicita√ß√£o. <br><br>  Apesar do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RA</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RB</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RC</a> protegerem contra ataques CSRF, eles levam √† gera√ß√£o de tokens constantes.  E <b>isso permite implementar a autentica√ß√£o entre dom√≠nios e</b> a <b>autentica√ß√£o de</b> usu√°rio <b>entre dom√≠nios</b> (quando voc√™ precisar determinar que v√°rias solicita√ß√µes para servidores diferentes vieram desse usu√°rio).  O que pode ser implementado para fornecer a ele autoridade igual em um grupo de dom√≠nios relacionados. <br><br>  Se a <b>p√°gina</b> do <b>site foi aberta automaticamente a</b> partir de outro site, voc√™ n√£o poder√° fazer login l√°, mesmo se voc√™ mesmo recarregar o site.  Porque a origem herdar√° de um valor nulo.  O navegador deve sinalizar para o usu√°rio sobre esse fato (Fonte = Aleat√≥rio): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1h/pr/ew/1hprewdwumpuwpzmzkqfmbds104.jpeg"></div><br>  Isso √© feito para proteger contra sites que for√ßam a abertura de outras janelas pop-up (eles mesmos ou seus scripts externos) e, nos sites que abrirem, eles ser√£o reinicializados ou criar√£o falsos bot√µes "fechar" em toda a tela, levando aos mesmos sites.  I.e.  isso evita uma tentativa de rastrear voc√™, na esperan√ßa de obter um token v√°lido. <br><br>  <b>Qualquer tentativa do site de imitar suas a√ß√µes com um script externo</b> , ou uma tentativa de um script externo de criar direta ou indiretamente uma tag inicial e envi√°-la para voc√™, levar√° a uma Origem vazia e √† adi√ß√£o de bytes aleat√≥rios no momento do c√°lculo do hash do token. <br><br>  O truque para criar ou modificar a tag &lt;script&gt; na p√°gina atacada no DOM n√£o ajudar√°.  O campo Origem permanecer√° em branco. <br><br>  Mas, nas mesmas condi√ß√µes, os scripts internos levar√£o a consultas com o Source igual ao seu valor anterior.  E se a p√°gina original tivesse Source = Domain, tudo ficaria bem.  O usu√°rio permanecer√° autorizado para tais solicita√ß√µes. <br><br>  Por√©m, com scripts baixados de recursos de terceiros (CDN), alguns problemas podem surgir.  E est√° certo, porque  A integridade do c√≥digo CDN n√£o √© garantida.  Se voc√™ n√£o perder a autoriza√ß√£o do usu√°rio, mantenha os scripts no seu site e fa√ßa o download deles no seu dom√≠nio.  Isso √© algo como a proibi√ß√£o de usar links http em p√°ginas https. <br><br>  Descrevemos a situa√ß√£o em que um desenvolvedor pode cair.  Como resultado das a√ß√µes do usu√°rio, seu script redireciona um usu√°rio autorizado para uma das p√°ginas do site (por exemplo, isso √© feito por um formul√°rio), exigindo que o usu√°rio permane√ßa autorizado.  Seu script chama, por exemplo, $ (form) .submit () usando um script jQuery carregado a partir da CDN.  Nesse caso, o navegador v√™ que na pilha de chamadas que acionou o evento de envio do formul√°rio, h√° uma fun√ß√£o de um script externo.  Para evitar ataques <abbr title="Script entre sites - &quot;script entre sites&quot;">XSS</abbr> / <abbr title="Falsifica√ß√£o de solicita√ß√£o entre sites - &quot;falsifica√ß√£o de solicita√ß√£o entre sites&quot;">CSRF</abbr> , o navegador deixa o campo Origem vazio e adiciona bytes aleat√≥rios √† gera√ß√£o do token (caso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">P9</a> ).  Como resultado, o usu√°rio na nova p√°gina repentinamente se torna n√£o autorizado e n√£o pode concluir a opera√ß√£o.  Isso pode ser confuso para desenvolvedores acostumados a usar CDNs. <br><br><a name="protocol_scenario"></a><h2>  2.7 Cen√°rios de protocolo </h2><br>  Aqui est√£o os principais cen√°rios prov√°veis ‚Äã‚Äãdo usu√°rio que trabalha com o site, afetando todas as situa√ß√µes poss√≠veis e os est√°gios de sua implementa√ß√£o (login an√¥nimo, "lembre-se de mim", "esque√ßa-me"), passe a usar uma chave permanente, autoriza√ß√£o e sa√≠da, registro e autentica√ß√£o de dois fatores, exporta√ß√£o / importa√ß√£o de chaves, substitui√ß√£o de chaves etc.) <br><div class="scrollable-table"><table><tbody><tr><th colspan="3">  1 F√≥rum, Blog, Wikipedia </th></tr><tr><th>  Usu√°rio </th><th>  Navegador </th><th>  Servidor do site </th></tr><tr><td>  1.1 Primeiro acesso a este site. </td><td>  Gera uma chave aleat√≥ria.  Envia um token inseguro de uma chave aleat√≥ria. </td><td>  Consideramos o usu√°rio an√¥nimo.  Usamos esse token como o identificador da sess√£o do usu√°rio. </td></tr><tr><td>  1.2 Visualizar p√°ginas. </td><td>  Envia um token seguro contra uma chave aleat√≥ria. </td><td>  Fornece conte√∫do p√∫blico.  Verifica o bit de token de 128 bits mais baixo. </td></tr><tr><td>  1.3 Tentando executar a√ß√µes (adicionar coment√°rios, etc.) </td><td>  Envia um token seguro contra uma chave aleat√≥ria. </td><td>  Informa ao usu√°rio que ele precisa se apresentar ao sistema.  Nesta fase, o site est√° confiante de que a chave √© aleat√≥ria. </td></tr><tr><td>  1.4 Diz ao navegador para que o site se lembre dele. </td><td>  Corrige a chave atual.  Envia uma chave permanente.  O token, como antes, √© transmitido de forma protegida.  Envia essa chave at√© receber sucesso do servidor. </td><td>  Agora o site sabe que a chave est√° corrigida.  Envia CSI-Token-Action: sucesso.  Ele pode aplicar a t√©cnica de memoriza√ß√£o do usu√°rio por um longo tempo: ele salva um token no banco de dados para recupera√ß√£o futura da sess√£o com o usu√°rio.  Ou mant√©m a sess√£o por mais tempo (salve em arquivo). </td></tr><tr><td>  1.5 Executa a√ß√µes (adicionando postagens, votando etc.) </td><td>  Envia um CSI-Token seguro a partir de uma chave fixa. </td><td>  Registra a√ß√µes deste usu√°rio. </td></tr><tr><td>  1.6 Fecha a guia do navegador. </td><td>  Nada. </td><td>  Est√° aguardando as seguintes solicita√ß√µes do usu√°rio. </td></tr><tr><td>  1.7 Volta ao site. </td><td>  Envia uma chave fixa segura. </td><td>  Continua a trabalhar com o usu√°rio.  Os dados da sess√£o s√£o obtidos do banco de dados ou arquivo tempor√°rio por token. </td></tr><tr><td>  1.8 Desfaz a fixa√ß√£o da chave (esque√ßa-me neste site) </td><td>  Envia uma chave de logout </td><td>  Exclui dados do usu√°rio no banco de dados, como  era uma chave fixa e o usu√°rio nunca poder√° recuper√°-la novamente.  Termina a sess√£o.  O navegador nunca enviar√° esse token novamente. </td></tr><tr><td>  1.9 Quando voc√™ acessa o site pela primeira vez ap√≥s o Logout. </td><td>  Gera uma chave aleat√≥ria.  Envia um token inseguro de uma chave aleat√≥ria. </td><td>  Este site j√° √© um novo usu√°rio.  Consideramos o usu√°rio an√¥nimo.  Usamos o token como o identificador da sess√£o do usu√°rio. </td></tr><tr><td>  1.10 Navegue pelas p√°ginas. </td><td>  Envia um token seguro contra uma chave aleat√≥ria. </td><td>  Fornece conte√∫do p√∫blico.  Verifica o bit de token de 128 bits mais baixo. </td></tr><tr><td>  1.11 Fecha a guia do navegador. </td><td>  Nada. </td><td>  Interrompe uma sess√£o ap√≥s um tempo limite. </td></tr><tr><td>  1.12 Volta ao site. </td><td>  Gera uma chave aleat√≥ria.  Envia um token inseguro de uma chave aleat√≥ria. </td><td>  Consideramos o usu√°rio an√¥nimo.  Usamos esse token como o identificador da sess√£o do usu√°rio. </td></tr><tr><td>  1.13 Cria uma chave de site permanente. </td><td>  Nada. </td></tr><tr><td>  1.14 Ativa√ß√£o da chave permanente. </td><td>  <b>Pergunta ao usu√°rio: voc√™ realmente deseja que o site se lembre da sua chave?</b>  <b>Verifique se este site √© quem ele afirma ser.</b> <br>  Envia Alterar para.  Somente nesse momento o navegador passa o token para o desprotegido.  Nos seguintes hor√°rios, o navegador sempre transmitir√° um token protegido no login.  Mas, para isso, o site deve confirmar a altera√ß√£o de tokens atrav√©s do CSI-Token-Action: success. </td><td>  Lembre-se do novo token de usu√°rio no banco de dados.  Muda o ID da sess√£o.  Continua a aguardar solicita√ß√µes do novo token.  Envia CSI-Token-Action: sucesso. </td></tr><tr><td>  1.15 Executa a√ß√µes (adicionando postagens, votando etc.) </td><td>  Envia um token seguro de uma chave permanente </td><td>  Registra a√ß√µes deste usu√°rio.  Verifica o token de 128 bits inferior. </td></tr><tr><td>  1.16 Faz a "Sa√≠da". </td><td>  Envia uma chave de logout </td><td>  Interrompe a sess√£o </td></tr><tr><td>  1.17 Volta ao site. </td><td>  Gera uma chave aleat√≥ria.  Envia um token inseguro de uma chave aleat√≥ria. </td><td>  Consideramos o usu√°rio an√¥nimo.  Usamos o token como o identificador da sess√£o do usu√°rio. </td></tr><tr><td>  1.18 Ativa√ß√£o da chave permanente. </td><td>  Envia Alterar para.  O token j√° est√° protegido, porque  a √∫ltima vez que o site nos respondeu CSI-Token-Action: success. </td><td>  Carregamos os dados do usu√°rio salvos no banco de dados.  Muda o ID da sess√£o.  Trabalhamos com o token salvo.  Sabemos que um token √© baseado em uma chave permanente. </td></tr><tr><td>  1.19 Fecha a guia do navegador. </td><td>  Nada.  Ou a tecla Logout, se a op√ß√£o "sa√≠da autom√°tica" estiver configurada quando a guia estiver fechada. </td><td>  Interrompe uma sess√£o ap√≥s um tempo limite ou ap√≥s o recebimento de uma chave de Logout. </td></tr><tr><th colspan="3">  2 Loja Online ou Site de An√∫ncios </th></tr><tr><th>  Usu√°rio </th><th>  Navegador </th><th>  Servidor do site </th></tr><tr><td>  2.1 Inclu√≠do pela primeira vez neste site. </td><td>  Gera uma chave aleat√≥ria.  Envia um token inseguro de uma chave aleat√≥ria. </td><td>  Consideramos o usu√°rio an√¥nimo.  Usamos esse token como o identificador da sess√£o do usu√°rio. </td></tr><tr><td>  2.2 Visualizar p√°ginas. </td><td>  Envia um token seguro contra uma chave aleat√≥ria. </td><td>  Fornece conte√∫do p√∫blico.  Verifica o bit de token de 128 bits mais baixo. </td></tr><tr><td>  2.3 Tentando executar a√ß√µes (adicionar an√∫ncios, compras, etc.) </td><td>  Envia um token seguro contra uma chave aleat√≥ria. </td><td>  Informa ao usu√°rio que ele precisa se apresentar ao sistema.  Nesta fase, o site est√° confiante de que a chave √© aleat√≥ria. </td></tr><tr><td>  2.4 Diz ao navegador para fazer o site se lembrar dele. </td><td>  Corrige a chave atual.  Antes da primeira solicita√ß√£o, ele envia um CSI-Token seguro com a chave Permanente.  Depois de receber sucesso, ele para de enviar essa chave. </td><td>  Agora o site sabe que a chave est√° corrigida.  Ele pode aplicar a t√©cnica de memoriza√ß√£o do usu√°rio por um longo tempo: ele salva um token no banco de dados para recupera√ß√£o futura da sess√£o com o usu√°rio.  Ou mant√©m a sess√£o por mais tempo (v√°rios dias). </td></tr><tr><td>  2.5 Executa a√ß√µes (adicionando an√∫ncios, compras, etc.) </td><td>  Envia um CSI-Token seguro a partir de uma chave fixa. </td><td>  Registra a√ß√µes deste usu√°rio.  Verifica o token. </td></tr><tr><td>  2.6 Fecha a guia do navegador. </td><td>  Nada. </td><td>  Realiza a sess√£o.  Com inatividade prolongada, ele salva os dados da sess√£o da RAM em um arquivo ou banco de dados. </td></tr><tr><td>  2.7 Efetua login no site novamente. </td><td>  Envia uma chave fixa segura. </td><td>  A sess√£o continua.  Trabalhamos com o usu√°rio, como se nada tivesse acontecido. </td></tr><tr><td>  2.8 <b>Cria ou importa uma</b> chave de site persistente. </td><td>  Nada. </td></tr><tr><td>  2.9 Ativa√ß√£o da chave permanente.  Aqui, de fato, h√° uma transi√ß√£o do uso de uma chave fixa para uma permanente. </td><td>  Envia uma chave de altera√ß√£o.  O token √© transmitido <b>desprotegido</b> para a chave rec√©m-criada e o token n√£o registrado no servidor.  O token √© transferido <b>protegido</b> para a chave importada. </td><td>  2.9.A.  Token com base na nova chave. <br>  Se o token antigo foi salvo no banco de dados - basta alterar o token no banco de dados. <br><br>  2.9.V.  Token com base na chave importada. <br>  Se o token antigo foi salvo no banco de dados - exclua-o.  Ao mesclar dois perfis de um usu√°rio (o que voc√™ pode perguntar a ele) - porque  de fato, o usu√°rio possui dois tokens armazenados no banco de dados: de uma chave fixa e de uma importada.  Muda o ID da sess√£o.  Envia CSI-Token-Action: sucesso.  Ele continua aguardando solicita√ß√µes do novo token. </td></tr><tr><td>  2.10 Executa a√ß√µes (compras, publica√ß√£o de an√∫ncios, carrinho de compras, favoritos, revis√µes, compara√ß√µes) </td><td>  Envia um token seguro de uma chave permanente </td><td>  Registra a√ß√µes deste usu√°rio.  Verifica o token de 128 bits inferior. </td></tr><tr><td>  2.11 Fecha a guia do navegador. </td><td>  Nada.  Ou a tecla Logout, se a op√ß√£o "sa√≠da autom√°tica" estiver configurada quando a guia estiver fechada. </td><td>  Interrompe uma sess√£o ap√≥s um tempo limite ou ap√≥s o recebimento de uma chave de Logout. </td></tr><tr><th colspan="3">  3 sites com pr√©-registro obrigat√≥rio (rede social) </th></tr><tr><th>  Usu√°rio </th><th>  Navegador </th><th>  Servidor do site </th></tr><tr><td>  3.1 Inclu√≠do neste site. </td><td>  Gera uma chave aleat√≥ria.  Envia um token inseguro de uma chave aleat√≥ria. </td><td>  Consideramos o usu√°rio an√¥nimo.  Usamos esse token como o identificador da sess√£o do usu√°rio.  N√≥s deixamos apenas em se√ß√µes p√∫blicas.  Quando voc√™ tenta acessar o conte√∫do fechado, traduzimos para o formul√°rio de autoriza√ß√£o. </td></tr><tr><td>  3.2 Cria uma chave permanente do site </td><td>  Nada </td></tr><tr><td>  3.3 Ativa√ß√£o da chave permanente. </td><td>  <b>Pergunta ao usu√°rio: voc√™ realmente deseja que o site se lembre da sua chave?</b>  <b>Verifique se este site √© quem ele afirma ser.</b> <br><br>  Envia Alterar para. <br>  <b>O token √© transmitido de forma clara</b> . </td><td>  Lembre-se do novo token.  N√£o temos pressa em salvar no banco de dados at√© que o registro seja conclu√≠do ainda.  Mantemos o usu√°rio no formul√°rio "Registro" at√© que seja feita a confirma√ß√£o de propriedade (por telefone, correio).  Envia CSI-Token-Action: registro </td></tr><tr><td>  3.4 Insira seus detalhes de contato. </td><td>  Envia solicita√ß√µes ajax.  Envia Alterar para.  Token antigo na mesma chave aleat√≥ria. <br>  <b>O novo token j√° est√° sendo transferido de forma protegida</b> . <br><br>  Assim que obt√©m sucesso, ele passa a usar um novo token (chave permanente). </td><td>  Verifica os detalhes do contato.  Se tudo der certo, ele envia CSI-Token-Action: success.  Caso contr√°rio: CSI-Token-Action: registro.  Se CSI-Token-Action: abort for enviado, o registro n√£o ser√° bem-sucedido.  O navegador deve voltar a usar um n√∫mero aleat√≥rio (cancelando a entrada).  E relate isso ao usu√°rio. </td></tr><tr><td>  3.5 Vai para a se√ß√£o fechada do site </td><td>  Envia um token seguro de uma chave permanente. </td><td>  Fornece acesso verificando o token de 128 bits inferior. </td></tr><tr><td>  3.6 Executa a√ß√µes (compras, publica√ß√£o de an√∫ncios, carrinho de compras, favoritos, revis√µes, compara√ß√µes) </td><td>  Envia um token seguro de uma chave permanente. </td><td>  Registra a√ß√µes deste usu√°rio.  Verifica o token de 128 bits inferior. </td></tr><tr><td>  3.7 Fecha a guia do navegador. </td><td>  Nada.  Ou a tecla Logout, se a op√ß√£o "sa√≠da autom√°tica" estiver configurada quando a guia estiver fechada. </td><td>  Interrompe uma sess√£o ap√≥s um tempo limite ou ap√≥s o recebimento de uma chave de Logout. </td></tr><tr><td>  3.8 Inclu√≠do neste site. </td><td>  Gera uma chave aleat√≥ria.  Envia um token inseguro de uma chave aleat√≥ria. </td><td>  Consideramos o usu√°rio an√¥nimo.  Usamos esse token como o identificador da sess√£o do usu√°rio.  N√≥s deixamos apenas em se√ß√µes p√∫blicas.  Quando tentamos acessar o conte√∫do fechado, informamos ao usu√°rio que ele √© um usu√°rio an√¥nimo. </td></tr><tr><td>  3.9 Ativa√ß√£o da chave permanente. </td><td>  Envia Alterar para.  Ambos os tokens s√£o transmitidos de maneira segura. </td><td>  Carregamos dados do usu√°rio do banco de dados por token (o mais alto de 128 bits).  Agora o site sabe quem √© esse usu√°rio. </td></tr><tr><td>  3.10 Altera a chave permanente do dom√≠nio (para outra permanente) </td><td>  <b>Pergunta ao usu√°rio: voc√™ realmente deseja que o site se lembre da sua nova chave?</b>  <b>Verifique se este site √© quem ele afirma ser.</b> <br><br>  Envia Alterar para. <br>  <b>O novo token √© transferido de forma clara;</b>  <b>antigo - protegido</b> <br></td><td>  Altera o token no banco de dados para um novo.  Carrega dados do perfil.  Usa um novo token das seguintes solicita√ß√µes.  Envia CSI-Token-Action: sucesso </td></tr><tr><td>  3.11 Executa a√ß√µes (adicionando postagens, votando etc.) </td><td>  Envia um token seguro de uma nova chave </td><td>  Registra a√ß√µes deste usu√°rio.  Verifica o token de 128 bits inferior. </td></tr><tr><td>  3.12 Faz uma "sa√≠da". </td><td>  Envia uma chave de logout </td><td>  Interrompe a sess√£o </td></tr><tr><td>  3.13 Inclu√≠do neste site. </td><td>  Gera uma chave aleat√≥ria.  Envia um token inseguro de uma chave aleat√≥ria. </td><td>  Consideramos o usu√°rio an√¥nimo.  Usamos esse token como o identificador da sess√£o do usu√°rio.  Traduzimos para o formul√°rio de autoriza√ß√£o. </td></tr><tr><td>  3.14 Ativando uma chave permanente </td><td>  Envia Alterar para.  Ambos os tokens s√£o transmitidos de maneira segura. </td><td>  Carregamos dados do usu√°rio do banco de dados por token (o mais alto de 128 bits). </td></tr><tr><td>  3.15 Importa uma chave diferente para este dom√≠nio. <br>  <b>Importante: a chave importada deve estar registrada no servidor.</b> <br></td><td>  Envia uma chave Logout Muda para o uso de uma chave aleat√≥ria. </td><td>  Interrompe a sess√£o </td></tr><tr><td>  3.16 Ativa uma nova chave </td><td>  Envia Alterar para. <br>  <b>Ambos os tokens s√£o transmitidos de maneira segura.</b> <br><br>  Observe que a tecla ‚Äúanterior‚Äù j√° √© uma tecla aleat√≥ria (consulte 3.15). </td><td>  Essa chave deve ser conhecida pelo banco de dados.  <b>A exporta√ß√£o de chave</b> do navegador √© permitida apenas para tokens registrados.  Assim, o navegador tem certeza de que a <b>chave importada √© conhecida pelo servidor</b> e a envia segura.  Caso contr√°rio, o servidor n√£o poder√° reconhecer o token do usu√°rio e n√£o poder√° autoriz√°-lo. </td></tr><tr><td>  3.17 Executa a√ß√µes (adicionando postagens, votando etc.) </td><td>  Envia um token seguro de uma nova chave </td><td>  Registra a√ß√µes deste usu√°rio.  Verifica o token de 128 bits inferior. </td></tr><tr><td>  3.18 sai </td><td>  Envia uma chave de logout </td><td>  Interrompe a sess√£o </td></tr><tr><th colspan="3">  4 sites com autoriza√ß√£o de dois fatores (Sberbank Online) </th></tr><tr><th>  Usu√°rio </th><th>  Navegador </th><th>  Servidor do site </th></tr><tr><td>  4.1 Inclu√≠do neste site. </td><td>  Gera uma chave aleat√≥ria.  Envia um token inseguro de uma chave aleat√≥ria. </td><td>  Consideramos o usu√°rio an√¥nimo.  Usamos esse token como o identificador da sess√£o do usu√°rio.  Traduzimos para o formul√°rio de autoriza√ß√£o. </td></tr><tr><td>  4.2 Cria uma chave permanente do site </td><td>  Nada </td></tr><tr><td>  4.3 Ativa√ß√£o da chave permanente. </td><td>  <b>Pergunta ao usu√°rio: voc√™ realmente deseja que o site se lembre da sua chave?</b>  <b>Verifique se este site √© quem ele afirma ser.</b> <br><br>  Envia Alterar para. <br>  <b>O token √© transmitido de forma clara</b> . </td><td>  O token n√£o √© conhecido no site.  Lembre-se do novo token.     .  CSI-Token-Action: registration. </td></tr><tr><td> 4.4     .  ¬´¬ª </td><td>  Change-To      success.       . <br> <b>      .</b> <br></td><td>   .    . </td></tr><tr><td> 4.5      . </td><td>  ajax-.      Change-To. <br><br>    success,      ( ). </td><td>   .      ( ).  CSI-Token-Action: success <br>       . <br>    ,  CSI-Token-Action: registration. <br><br>      CSI-Token-Action: abort.    ,      . </td></tr><tr><td> 4.6    . </td><td>   Token    </td><td>        . </td></tr><tr><td> 4.7  ¬´¬ª   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.8    . </td><td>   .      . </td><td>   .        .          ¬´¬ª. </td></tr><tr><td> 4.9   . </td><td>  Change-To. <br> <b>    </b> (..   ;    ). </td><td>        ( 128-).  ,        .      ,   .    .   CSI-Token-Action: success </td></tr><tr><td> 4.10      . </td><td>  ajax-.         . </td><td>  .  .  .       . </td></tr><tr><td> 4.11    . </td><td>   Token   . </td><td>        . </td></tr><tr><td> 4.12  ¬´¬ª   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.12     (). </td><td>    Logout,   ¬´¬ª   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 5  :   ESXi </th></tr><tr><th>  Usu√°rio </th><th>  Navegador </th><th>   </th></tr><tr><td> 5.1    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.2    . </td><td></td><td></td></tr><tr><td> 5.3     ( ,   ).  ,   <i></i> . </td><td></td><td></td></tr><tr><td> 5.4     (SSH, RDP).      (  .htaccess ‚Äì .  ) </td><td></td><td></td></tr><tr><td> 5.5   </td><td>  </td><td>     </td></tr><tr><td> 5.6    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.7   . </td><td>  Change-To. <br> <b>    </b> (..  ,         ;     <i></i> ). </td><td>        (. ). <br><br>     ( 128-). <br>    128-.     . <br>   CSI-Token-Action: success. <br>   CSI-Token-Action: abort (    ),   403 ‚Äì Forbidden. <br>     . </td></tr><tr><td> 5.8    </td><td>      . </td><td>        . </td></tr><tr><td> 5.9   </td><td>    Logout,   ¬´¬ª   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 6  :   </th></tr><tr><th>  Usu√°rio </th><th>  Navegador </th><th>   </th></tr><tr><td> 6.1    . </td><td>   .      . </td><td>   .        . <b>   .</b>   CSI-Support: yes; </td></tr><tr><td> 6.2   . </td><td></td><td></td></tr><tr><td> 6.3   . </td><td> <b> :   ,     ? ,     ,    .</b> <br><br>  Change-To. <br> <b>    </b> . </td><td>  ,   CSI-Token-Action: registration, ..   . </td></tr><tr><td> 6.4  /  ¬´ ¬ª </td><td>  / POST-  .      Change-To,    . </td><td>  /.    .    .  CSI-Token-Action: success </td></tr><tr><td> 6.5           ¬´¬ª </td><td>     Token    </td><td>    /.  . </td></tr><tr><td> 6.6  </td><td>   Logout </td><td>   </td></tr><tr><td> 6.7    . </td><td>   .      . </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Considera o usu√°rio an√¥nimo. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exibe a mensagem "Acesso negado"</font></font></b> <br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.8 Ativa√ß√£o da chave permanente. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envia Alterar para. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O token √© transmitido de forma protegida</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (j√° que ele √© conhecido pelo dispositivo; passamos o registro anteriormente).</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identifica o usu√°rio pelo token de 128 bits mais alto. </font><font style="vertical-align: inherit;">Verifica bits baixos.</font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.9 Executa a√ß√µes privilegiadas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envia um token seguro de uma chave permanente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Executa a√ß√µes de acordo com os privil√©gios do usu√°rio. </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.10 Sai </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envia uma chave de logout </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interrompe a sess√£o </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Um exemplo de configura√ß√£o de acesso ao token com base no arquivo .htaccess. </font></font><br><pre> <code class="apache">&lt;Directory "/var/www/html"&gt; AuthType CSI AuthName "Restricted Content" AuthTokensFile /etc/apache2/.csi_keys Require valid-user &lt;/Directory&gt;</code> </pre><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cat /etc/apache2/.csi_keys </font></font></pre><pre> <code class="bash"># # Client Self Identification tokens file # # CSI-Domain-Key UserName Role 84bc3da1b3e33a18e8d5e1bdd7a18d7a166d77ac1b46a1ec38aa35ab7e628ab5 MelnikovIN admin 6d7fce9fee471194aa8b5b6e47267f0348a24b70a0b376535542b996af517398 BoshirovAM user</code> </pre> <br><br><a name="token_algo_for_server"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.7.1 Algoritmo para calcular poss√≠veis tokens de usu√°rio de um site usando uma chave conhecida </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se conhecermos a chave de dom√≠nio K, podemos calcular facilmente o poss√≠vel token "v√°lido" T do usu√°rio que vir√° com suas solicita√ß√µes. </font><font style="vertical-align: inherit;">Para isso, √© necess√°rio que a condi√ß√£o seja atendida: o iniciador das solicita√ß√µes, o receptor das solicita√ß√µes e o contexto de execu√ß√£o devem corresponder e ser iguais ao dom√≠nio. </font><font style="vertical-align: inherit;">Em outras palavras, se tivermos o nome de dom√≠nio vsphere.local, ent√£o:</font></font><br><pre> <code class="plaintext">Sender = Recipient = Context = vsphere.local</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A partir daqui, o token original (bruto) √© calculado como: </font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/af8/1c2/5b0/af81c25b054111db5d526fcfb8c4fb8c.svg" alt="$T_s = HMAC_{K}(Sender \cup Recipient \cup Context)$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s a transmiss√£o, o token original ficar√° mais protegido. </font><font style="vertical-align: inherit;">Os 128 bits inferiores do token ser√£o hash com o sal passado no cabe√ßalho da solicita√ß√£o CSI-Salt </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Assim, o site ver√° o seguinte token:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$T = Hi(T_s) \cup HMAC_{salt}( Lo(T_s) )$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Onde </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© os 128 bits mais altos, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© os 128 bits mais baixos do token original. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geralmente, para consoles de gerenciamento fechados em uma rede corporativa, os consoles da Web n√£o carregam scripts externos, quadros etc. </font><font style="vertical-align: inherit;">Portanto, essa condi√ß√£o ser√° atendida na maioria dos casos.</font></font><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Para o m√©todo de forma√ß√£o de sal, consulte a se√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Procedimento de troca de sal entre o navegador e o servidor".</font></font></a></sup> <br><br><a name="server_token_processing"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.8 Processando tokens no servidor </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enviando um token para o servidor (sem chaves) </font></font></h3><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Status do token T na sess√£o do site </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A√ß√µes do servidor do site </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Desconhecido </font></font></td><td>         ,              . <br><br>   .   . <br>   128       . <br>     .      CSI-Salt. <br><br></td></tr><tr><td>  ( 128 ) </td><td>   . <br>      CSI-Salt ‚Äì   . <br>    .       CSI-Token. <br><br>   ,  CSI-Token-Action: invalid.    400. <br><br>    ‚Äì  200. <br><br></td></tr></tbody></table></div><br><br><h3>     Permanent </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O navegador bloqueia a chave do cliente. </font><font style="vertical-align: inherit;">O usu√°rio deseja que o site lembre-se do cliente por mais de uma sess√£o. </font><font style="vertical-align: inherit;">Se o token do usu√°rio deve ser armazenado em seu banco de dados √© uma decis√£o do servidor. </font><font style="vertical-align: inherit;">Retornamos CSI-Token-Action: success ou CSI-Token-Action: abort ao cliente.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enviando um token com uma chave Logout </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indica que o token atual n√£o ser√° mais usado pelo navegador. </font><font style="vertical-align: inherit;">√â enviado quando o usu√°rio clica em "Sair" no navegador ou fecha a guia e a op√ß√£o √© configurada (sair automaticamente ao fechar a guia) ou se recusa a usar uma chave fixa ("esque√ßa-me neste site").</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autologin, a prop√≥sito, n√£o deveria ser. </font><font style="vertical-align: inherit;">Por raz√µes de seguran√ßa.</font></font></blockquote><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enviando um token com uma chave Change-To </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos chamar o token antigo T, o novo - T '. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMPORTANTE:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como o novo token T ', o valor real do token √© enviado (pela primeira vez, para os n√£o registrados), enquanto o token antigo √© enviado com hash (os 128 bits mais baixos).</font></font><br><div class="scrollable-table"><table><tbody><tr><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status do token no banco de dados do servidor </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup> </td><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A√ß√µes do servidor do site </font></font></td></tr><tr><td>  T </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> T ' </font></font></td></tr><tr><td>  n√£o </td><td>  n√£o </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Raz√£o: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registro legal do</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usu√°rio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Altere o identificador da sess√£o do usu√°rio para T ' </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envie ao cliente CSI-Token-Action: success. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O usu√°rio fez uma chave permanente para o site e realizou o "Login". </font><font style="vertical-align: inherit;">O servidor pode armazenar esse token de lado. </font><font style="vertical-align: inherit;">Antes disso, ofere√ßa-se para preencher o formul√°rio de inscri√ß√£o (se necess√°rio).</font></font><br><br>    CSI-Token-Action: registration,   ,     (        ).        Change-To (   )   ,     success  abort.   ,  ,     .   ‚Äì      (  ). <br></td></tr><tr><td>  n√£o </td><td>  </td><td> : <b> Login</b> . <br><br>    T'  .   .   .   CSI-Token-Action: success. <br><br> <b></b> .         Change-To   ,    CSI-Token-Action: success, <b>  </b>    Change-To   <b>  </b> . <br>    ,       .          . <br>  <b>     </b> ,       ¬´¬ª .    <b>      </b> ,       -.  Porque    ¬´  ¬ª,    . <br></td></tr><tr><td>  </td><td>  n√£o </td><td> : <b>  </b>   . <br><br>    T     T'.   . <br>   CSI-Token-Action: success. <br></td></tr><tr><td> , <br>  <br>  <br></td><td>  </td><td> : <b>     </b> <br><br>  ,         ,      -.                  -     . <br><br>            (  ).      ‚Äì . <br><br>   .   CSI-Token-Action: success <br></td></tr><tr><td> , <br>  <br>  <br> . <br></td><td>  </td><td>  .            .   .  CSI-Token-Action: abort.   . <br><br>  256-       SHA-2.      ( )         . <br><br>          : <ul><li>      ; </li><li>         ; </li><li>    </li></ul>      .   , ‚Äì  -    . <br>     ,      .        Logout   .   Login  .  . <br></td></tr></tbody></table></div><hr> <sup>*        ,    .</sup> <br><br><a name="sub_domain_identify"></a><h2> 2.9 -  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como mencionado anteriormente, os sites podem interagir com outros sites parceiros ou seus subdom√≠nios para fornecer ao usu√°rio algumas das funcionalidades. O exemplo mais comum √© quando, no site site.ru, alguns recursos s√£o carregados dos subdom√≠nios img.site.ru, parte do download.site.ru e outra parte de outros. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, o site site.ru precisa ser capaz de informar os dom√≠nios de seus parceiros sobre quem exatamente solicita√ß√µes s√£o feitas. De fato, se voc√™ est√° autorizado no site.ru, isso n√£o o autoriza automaticamente em outros sites, incluindo subdom√≠nios do site. Eles ver√£o outros tokens seus. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos ver como o token √© calculado e como isso pode nos ajudar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permita que o usu√°rio efetue login no site.ru com uma chave permanente e tenha um token:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/a5a/e9b/500/a5ae9b500f4fd8f2600eafdb3a315d32.svg" alt="$T_1 = HMAC_{site.ru-key}(site.ru \cup site.ru \cup site.ru)$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Todas as solicita√ß√µes provenientes da p√°gina do site site.ru at√© o dom√≠nio site.ru e causadas por: </font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tags de recursos da p√°gina (est√°tica ou din√¢mica nativa) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> scripts pr√≥prios </font></font></li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ter√° um token T </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (consulte as regras </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Essas s√£o solicita√ß√µes leg√≠timas para site.ru. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora deixe o cliente baixar o arquivo restrito da p√°gina site.ru, mas o link leva a download.site.ru. </font><font style="vertical-align: inherit;">Nesse caso, o subdom√≠nio receber√° o seguinte token (regras </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/445/897/361/445897361e99df033e11f354f37071af.svg" alt="$T_2 = HMAC_{site.ru-key}(site.ru \cup download.site.ru \cup site.ru)$" data-tex="display"></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exatamente o mesmo token download.site.ru receber√° se uma solicita√ß√£o ajax da p√°gina site.ru for executada nele (regras de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro dom√≠nio de dom√≠nio receber√° um token:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/231/d05/899/231d058996ea04e27a4a67dbdadf68ee.svg" alt="$T_3 = HMAC_{site.ru-key}(site.ru \cup domain \cup site.ru)$" data-tex="display"></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por√©m, observe que, se as condi√ß√µes para o atendimento de solicita√ß√µes n√£o forem alteradas, para um determinado pacote de dom√≠nios A, B, C, o navegador sempre gerar√° um token constante. </font><font style="vertical-align: inherit;">Para que possamos realizar a identifica√ß√£o entre dom√≠nios. </font><font style="vertical-align: inherit;">Por exemplo, assim. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No site.ru, fazemos solicita√ß√µes ajax para subdom√≠nios. </font><font style="vertical-align: inherit;">Passamos o ID do identificador! = T1 </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usu√°rio, emitido pelo site.ru. </font><font style="vertical-align: inherit;">Os subdom√≠nios receber√£o tokens T </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o mesmo usu√°rio </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cada um dos subdom√≠nios criar√° um monte de seu token com o ID do usu√°rio. </font><font style="vertical-align: inherit;">Os subdom√≠nios j√° compartilhar√£o informa√ß√µes sobre o ID do usu√°rio e seus direitos com solicita√ß√µes de servidor para servidor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O grupo √© feito uma vez. </font><font style="vertical-align: inherit;">Posteriormente, os subdom√≠nios ser√£o guiados por seus pr√≥prios tokens, conforme </font><font style="vertical-align: inherit;">eles tamb√©m ser√£o permanentes para a chave permanente site.ru.</font></font><br><br><a name="part3"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3 Recomenda√ß√µes de seguran√ßa </font></font></h1><br><div class="spoiler">  <b class="spoiler_title">Nota</b> <div class="spoiler_text">      .          . </div></div><br><br><a name="keys_NAA_protection"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.1 Prote√ß√£o das principais informa√ß√µes contra acesso n√£o autorizado </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O protocolo de autoriza√ß√£o proposto protege o usu√°rio contra keyloggers que roubam suas senhas, porque o esquema proposto n√£o usa senhas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por√©m, maneiras de proteger chaves de comprometimento devem ser consideradas com mais detalhes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As chaves podem ser comprometidas por:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> copiar informa√ß√µes importantes por malware (acesso remoto) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acesso direto ao arquivo com as principais informa√ß√µes "offline" (acesso direto) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no momento da distribui√ß√£o entre dispositivos </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supondo que as principais informa√ß√µes sejam armazenadas em um cart√£o inteligente (consideramos essa op√ß√£o na se√ß√£o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mobilidade da conta"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), a tarefa de proteger as principais informa√ß√µes √© transferida para o chip. √â verdade que existe uma vulnerabilidade aos keyloggers que podem interceptar o c√≥digo PIN inserido; Bem, inconveniente de usar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m dos cart√µes inteligentes, a criptografia sim√©trica pode ser usada para proteger contra o acesso direto √†s informa√ß√µes principais. Mas a quest√£o √©: qual chave levar para criptografia? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se essa chave √© gerada com base na senha do usu√°rio, em primeiro lugar, temos uma vulnerabilidade √† sele√ß√£o da senha ‚Äúoffline‚Äù e, em segundo lugar, de fato, do que eles deixaram, chegaram a isso: ‚Äúnovamente algumas senhas‚Äù. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma op√ß√£o mais correta √© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">costurar de maneira especial </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">essa chave no conjunto do navegador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ou em uma de suas bibliotecas especializadas). Cada atualiza√ß√£o do navegador altera a chave e sua localiza√ß√£o no arquivo compilado. Essa abordagem n√£o dar√° 100% de garantia de prote√ß√£o, mas complicar√° seriamente a tarefa de descriptografia. Primeiro, o invasor precisar√° descobrir a vers√£o exata da montagem, depois encontr√°-la, desmontar e descobrir como a chave √© montada.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, as pr√≥prias chaves de dom√≠nio devem ser armazenadas diretamente em um arquivo separado e n√£o em conjunto com a configura√ß√£o para uso (ou seja, apenas as chaves e nada mais). Ent√£o, sua descriptografia por sele√ß√£o de chave (de conjuntos conhecidos) ser√° imposs√≠vel, porque √© imposs√≠vel distinguir uma chave descriptografada corretamente de uma sequ√™ncia aleat√≥ria de bytes. Em seguida, as tentativas de selecionar uma chave mestra sem conhecer a vers√£o exata do conjunto do navegador e desmontar diretamente seu c√≥digo ser√£o imposs√≠veis. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode usar a op√ß√£o combinada: criptografia com a chave do navegador + criptografia com a senha do usu√°rio da conta do SO (se a API do SO permitir). Al√©m disso, a chave √© sempre gerada em tempo real. Ent√£o a for√ßa bruta offline se tornar√° ainda mais cara.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, depois de alterar a senha do usu√°rio no sistema operacional, a chave tamb√©m ser√° alterada. </font><font style="vertical-align: inherit;">E se voc√™ n√£o descriptografar a chave antiga, isso ser√° protegido contra situa√ß√µes em que o administrador do computador altere sua senha para obter acesso √† sua conta e executar a√ß√µes em seu nome. </font><font style="vertical-align: inherit;">Situa√ß√µes do tipo: largou o emprego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ primeiro far√° uma c√≥pia de backup das chaves (exportar√° as chaves para um arquivo). </font><font style="vertical-align: inherit;">A menos, √© claro, que voc√™ j√° tenha feito isso antes ao distribuir chaves para outros dispositivos.</font></font><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Por exemplo, uma chave de 32 bytes √© distribu√≠da aleatoriamente na se√ß√£o 64K de um arquivo execut√°vel. </font><font style="vertical-align: inherit;">E apenas o c√≥digo fonte sabe como coletar a chave estimada desses bytes.</font></font></sup> <br><br><a name="why_password_for_keys_not_good"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.2 Sobre senhas como chaves de dom√≠nio </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em uma das vers√µes iniciais do protocolo, a chave do dom√≠nio pode ser gerada com base na senha do usu√°rio. O algoritmo foi complicado, excluindo chaves duplicadas para dom√≠nios diferentes para a mesma senha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso foi posicionado como uma maneira conveniente de contas de mobilidade. Digite uma senha e n√£o se preocupe com nada. Mas ent√£o aconteceu o seguinte:</font></font><br><br><ol><li>     ,     ¬´¬ª ,        ,   .   ,       -,          . <br><br>  (),     8-  ,       ,    .: ~!@#$%^&amp;.   : 26 + 26 + 10 + 8 = 70 . 8-       70 <sup>8</sup> . <br><br> ,     ,         10 <sup>12</sup>   .      70 <sup>8</sup> / 10 <sup>12</sup> = ~576 .  I.e.       ~10 .          5       . 10-      15 .      10 ,      1-2 . <br><br>           ,        . </li><li>       ,     . </li><li>                ,     .  I.e.      (       SHA-2). </li><li>  , ,  ,      .        . </li></ol><br><br><a name="risks_loss_keys"></a><h2> 3.3  /     </h2><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E se eu perder a chave mestra?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Isso pode acontecer se voc√™ alterar sua senha ou reinstalar o sistema operacional. Quais s√£o os riscos? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, voc√™ n√£o chegar√° aos sites onde estava antes. Perca seu hist√≥rico de compras em lojas on-line, seus an√∫ncios em sites on-line, carma nos f√≥runs. Isso n√£o importa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, quem impede o procedimento de recadastramento com um novo token e o confirma atrav√©s do n√∫mero de telefone indicado no mesmo an√∫ncio? Acontece que o site precisa fazer uma forma de re-registro do token (um an√°logo de "recupera√ß√£o de senha")? Onde est√° a prometida aus√™ncia de "todo tipo de formas"? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato, um site que precisa n√£o apenas identificar o visitante, mas tamb√©m saber quem ele realmente √©, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ter√° que</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fa√ßa um formul√°rio de inscri√ß√£o. </font><font style="vertical-align: inherit;">Na verdade, este formul√°rio pode ser usado para re-registro. </font><font style="vertical-align: inherit;">Voc√™ especifica exatamente os mesmos dados de antes (email, celular). </font><font style="vertical-align: inherit;">Confirme se voc√™ possui esses dados (carta, SMS). </font><font style="vertical-align: inherit;">O sistema v√™ que essa conta j√° existe, os dados s√£o 100% seus, mas o token √© diferente - ele reescreve o token. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainda assim, √© melhor n√£o perder a chave mestra.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como prevenir a perda? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie uma c√≥pia de backup, proteja-a com uma senha e armazene-a em m√≠dia descart√°vel. </font><font style="vertical-align: inherit;">Al√©m disso, na verdade, como √© feito com as chaves do bitcoin. </font><font style="vertical-align: inherit;">Em princ√≠pio, voc√™ pode converter as chaves mestras em formato impresso e salv√°-las em um peda√ßo de papel. </font><font style="vertical-align: inherit;">Para esse assunto. </font><font style="vertical-align: inherit;">E, em seguida, restaure pela entrada manual. </font><font style="vertical-align: inherit;">Mas isso √© para pessoas bastante "paran√≥icas" como eu.</font></font><br></blockquote><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas e se uma chave mestra for roubada de mim?</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Isso j√° √© s√©rio. Embora as recomenda√ß√µes descritas aqui para armazenar a chave mestra (n√£o inclu√≠das no protocolo) as protejam contra viola√ß√µes diretas, keyloggers e trojans, no entanto, o risco de comprometer a chave mestra permanece. Infelizmente, a prote√ß√£o perfeita n√£o existe. A chave pode ser invadida diretamente da mem√≥ria do navegador atrav√©s de uma vulnerabilidade de mecanismo javascript. Como exemplo. Ou voc√™ perde seu telefone celular ... </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o, quais s√£o os riscos de roubar uma chave mestra?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √â essencial receber informa√ß√µes sobre voc√™ e at√© mesmo agir em seu nome. Obten√ß√£o da capacidade de um invasor efetuar login sob voc√™ e no modo de leitura para obter acesso a informa√ß√µes confidenciais.</font></font> Calmo e quieto.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou baixe todos os seus v√≠deos particulares de colegas de uma vez. √â desagrad√°vel para voc√™. F√£s de selos se alegram. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui voc√™ precisa se registrar rapidamente com uma nova chave em sites importantes. E, se algo terr√≠vel aconteceu, registrar seu novo token no banco de dados do provedor de servi√ßos de uma maneira oficial √© a √∫nica op√ß√£o certa. Voc√™ pode pensar em v√°rios m√©todos de registro: desde a fixa√ß√£o em papel em uma carta oficial at√© um aplicativo atrav√©s do servi√ßo de suporte t√©cnico do site, com confirma√ß√£o de sua identidade de maneiras aceit√°veis. Mas isso √© apenas para sites s√©rios, como bancos online.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maneiras de minimizar riscos. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O uso de chaves individuais para dom√≠nios (mas isso reduz a mobilidade das contas). </font><font style="vertical-align: inherit;">Autentica√ß√£o de dois fatores via canais independentes. </font><font style="vertical-align: inherit;">O site mostra os endere√ßos IP e dispositivos de onde a conex√£o estava da √∫ltima vez, para que voc√™ ao menos note um comprometimento.</font></font><br></blockquote><br><br><a name="part4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4 Ataques ao regime de autoriza√ß√£o </font></font></h1><br><br><a name="attack_user_tracking"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.1 Rastreamento de usu√°rio </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um site confi√°vel pode mesclar descaradamente informa√ß√µes sobre voc√™ com outros sites. </font><font style="vertical-align: inherit;">Na Internet, existem sites de colecionador que agregam essas informa√ß√µes e as vendem para todos. </font><font style="vertical-align: inherit;">M√©tricas Yandex, Google Analytics - um site raro fica sem elas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para que dois sites diferentes possam determinar que est√£o trabalhando com o mesmo cliente, duas t√©cnicas s√£o usadas:</font></font><br><br><ol><li>              (     ,     ). </li><li>       (    )       . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° uma pequena desvantagem no Esquema 2: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o o usu√°rio √© identificado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas o navegador. Mas muitas vezes o navegador == cliente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece que o token √© mais adequado para uso no esquema n√∫mero 2. Afinal, se o usu√°rio permitir "lembrar-se" de dois sites (atuando como um par), nosso token permanente poder√° atuar como uma "impress√£o digital", n√£o apenas o navegador, mas o pr√≥prio usu√°rio. O problema para sites aqui √© que eles </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">receber√£o tokens diferentes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas os sites podem tentar aplicar tamb√©m o esquema n ¬∞ 1. Em seguida, o seguinte ser√° o resultado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site 1 recebe do c√≥digo do navegador H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e Site 2 √© realizada no contexto de um site 1 - H C√≥digo </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Parece que agora os sites podem formar um par (H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , H</font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) e at√© mesmo pass√°-lo para algum site agregador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deixe que haja outro site 3, emparelhado com o site 2, tentando rastrear voc√™. </font><font style="vertical-align: inherit;">O site 3 receber√° o token H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do navegador </font><font style="vertical-align: inherit;">e o site 2, executado no contexto do site 3, </font><font style="vertical-align: inherit;">receber√° o </font><font style="vertical-align: inherit;">token H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 '</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! = H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (veja como os tokens s√£o formados). </font><font style="vertical-align: inherit;">Como resultado, √© imposs√≠vel combinar os dados obtidos, porque </font><font style="vertical-align: inherit;">eles n√£o t√™m partes sobrepostas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isso n√£o significa que os sites n√£o poder√£o usar um navegador de impress√µes digitais para monitorar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ele afirma apenas que o pr√≥prio esquema de gera√ß√£o de tokens √© bastante confi√°vel e protege contra rastreamento. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Op√ß√£o de prote√ß√£o:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saia dos sites com os quais voc√™ terminou de trabalhar. </font><font style="vertical-align: inherit;">O navegador pode fazer isso automaticamente quando voc√™ fecha a guia.</font></font><br><br><a name="attack_XSS"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.2 Ataque XSS </font></font></h2><br><br> <abbr title="Cross-Site Scripting ‚Äî ¬´ ¬ª"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSS</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© um tipo de ataque que envolve a introdu√ß√£o de c√≥digo malicioso na p√°gina do site v√≠tima.com. </font><font style="vertical-align: inherit;">Por exemplo, por meio de um script afiliado ou de uma CDN invadida de uma estrutura popular. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo malicioso pode usar a autoriza√ß√£o do usu√°rio no site para obter acesso autorizado a ele ou roubar dados de autentica√ß√£o do usu√°rio. </font><font style="vertical-align: inherit;">O c√≥digo malicioso pode ser inserido em uma p√°gina por meio de uma vulnerabilidade em um servidor Web (hacking trivial), por meio de redes afiliadas (fontes n√£o confi√°veis), por meio de uma vulnerabilidade no computador do usu√°rio (rastreamento por Trojan). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A principal prote√ß√£o contra esses ataques para o nosso esquema de autoriza√ß√£o s√£o regras especiais para gerar o campo Origem ao calcular tokens. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vulnerabilidade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: para XSS armazenado (quando o script √© inserido diretamente no site atacado e carregado a partir dele como resultado da invas√£o do servidor), a prote√ß√£o n√£o funciona. </font><font style="vertical-align: inherit;">Porque o navegador n√£o conseguir√° identificar um script como "externo". </font><font style="vertical-align: inherit;">O mesmo problema ocorrer√° quando um invasor proxies o tr√°fego cliente-servidor.</font></font><br><br><a name="attack_CSRF"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.3 Ataque do CSRF </font></font></h2><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A v√≠tima visita o site evil.com, criado por um invasor. Em seu nome, uma solicita√ß√£o (GET / POST / HEAD / PUT / DELETE) √© executada em um site em que o usu√°rio j√° est√° autorizado (por exemplo, em um servidor do sistema de pagamento). A solicita√ß√£o em si realiza algum tipo de opera√ß√£o maliciosa (por exemplo, transfer√™ncia de dinheiro para a conta do invasor). De acordo com a supervis√£o dos desenvolvedores, o site n√£o verifica os campos do Referer e n√£o solicita informa√ß√µes de verifica√ß√£o adicionais do usu√°rio. Como resultado, o ataque foi bem sucedido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O esquema de autoriza√ß√£o de site proposto suprime a maioria dos cen√°rios de ataque </font></font><abbr title="ross Site Request Forgery ‚Äî ¬´  ¬ª"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSRF</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, devido ao algoritmo de gera√ß√£o de token. </font><font style="vertical-align: inherit;">Qualquer solicita√ß√£o entre sites resultar√° no site atacado receber um token inv√°lido do usu√°rio. </font><font style="vertical-align: inherit;">Como resultado, nessa situa√ß√£o, o usu√°rio do site atacado ser√° an√¥nimo e an√¥nimo. </font><font style="vertical-align: inherit;">Mesmo uma tentativa de executar uma solicita√ß√£o GET inofensiva de um site atacante para um atacado (upload de uma foto) resultar√° no recebimento de um token inv√°lido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso deve simplificar bastante a vida dos desenvolvedores de sites.</font></font><br><br><a name="attack_SSO"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.4 Rastreando usando SSO </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dois sites S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nos quais o usu√°rio confia e possui chaves para eles, decidem aplicar uma tecnologia semelhante ao SSO para rastreamento do usu√°rio. Mas desde voc√™ n√£o pode incorporar um site em outro (um deles receber√° um token inv√°lido), n√£o pode abrir o site de um parceiro com um script (pelo mesmo motivo) e, em seguida, o site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> decide usar uma t√©cnica complicada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em uma das p√°ginas, ele coloca uma etiqueta transl√∫cida A, cobrindo a janela inteira. O link leva ao site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e o identificador do usu√°rio (de S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) e o token H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 s√£o</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transmitidos no endere√ßo </font><font style="vertical-align: inherit;">. O usu√°rio n√£o v√™ o link. Ao clicar em qualquer √°rea do site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , inicia a abertura de uma nova guia no site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atualmente S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o recebe um token v√°lido. </font><font style="vertical-align: inherit;">O recarregamento autom√°tico com uma tag tamb√©m n√£o o ajudar√°</font></font><br><pre> <code class="xml">&lt;meta http-equiv="refresh" content="0"&gt;</code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou script. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas o S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode criar a tag A em toda a p√°gina na forma de um bot√£o Fechar falso:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/is/n5/jh/isn5jhlcnubhl580cvv6lgdloye.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esse link primeiro recarrega o site e depois o fecha. </font><font style="vertical-align: inherit;">No momento da reinicializa√ß√£o, o navegador envia o </font><font style="vertical-align: inherit;">token H </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> j√° v√°lido </font><font style="vertical-align: inherit;">para o site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (porque a regra 2.4 P1 foi seguida: o usu√°rio abriu pessoalmente os dois links). </font><font style="vertical-align: inherit;">Como resultado, S </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> receber√° informa√ß√µes sobre as a√ß√µes de seu usu√°rio no site S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> , associar√° o token H </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> ao seu H </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> e enviar√° ao H </font><sub><font style="vertical-align: inherit;">2 uma</font></sub><font style="vertical-align: inherit;"> solicita√ß√£o entre servidores para S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No futuro, os sites S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> e S </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> poder√£o trocar qualquer informa√ß√£o sobre o usu√°rio por troca de servidor, conforme </font><font style="vertical-align: inherit;">agora eles podem identific√°-lo de forma √∫nica e mutuamente </font><b><font style="vertical-align: inherit;">separados um do outro</font></b></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os usu√°rios m√≥veis s√£o particularmente vulner√°veis ‚Äã‚Äãa esse ataque, pois </font><font style="vertical-align: inherit;">tentar fechar uma p√°gina desnecess√°ria pode clicar acidentalmente em um link falso que ocupa toda a tela do celular.</font></font></blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo de prote√ß√£o:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interrompa automaticamente a sess√£o quando a guia estiver fechada. </font><font style="vertical-align: inherit;">Em seguida, o site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o p√¥de receber um token v√°lido at√© que o pr√≥prio usu√°rio efetuasse login nele. </font><font style="vertical-align: inherit;">√â verdade que isso n√£o protege contra situa√ß√µes em que o pr√≥prio usu√°rio abriu as guias e efetuou login em S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">E s√≥ ent√£o os sites conduziram esse ataque.</font></font><br><br><a name="attack_sso_key_discredit"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.5 Compromisso de chave para SSO </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permita que uma conta de usu√°rio em um servidor de autentica√ß√£o que suporte SSO seja comprometida. </font><font style="vertical-align: inherit;">Avaliaremos os poss√≠veis riscos com nosso esquema de autentica√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os tokens para cada site s√£o calculados individualmente com base nas chaves de dom√≠nio.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comprometer uma chave de dom√≠nio n√£o compromete automaticamente todas as outras.</font></font></b> </blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maioria dos sites em que voc√™ efetuou login anteriormente usando o SSO provavelmente salvar√° seu token com o seu perfil no servidor SSO no banco de dados. </font><font style="vertical-align: inherit;">Em nosso esquema, o site simplesmente puxa um token do banco de dados e o reconhece.</font></font> I.e.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O servidor SSO n√£o √© mais necess√°rio nesses sites - ele executou sua fun√ß√£o no est√°gio de registro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em outras palavras, voc√™ n√£o perde automaticamente todos os seus acessos de uma s√≥ vez. Um invasor ser√° identificado nos mesmos sites que outra pessoa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma tentativa de reconduzir a autentica√ß√£o entre dom√≠nios tamb√©m n√£o ajudar√° o invasor: o site deve bloquear as tentativas de criar uma nova conta com o antigo usu√°rio de ID do SSO e o novo token do site. Ou, tentativas de reescrever o token do usu√°rio para um ID existente no processo SSO devem ser bloqueadas. O fato disso deve causar suspeitas razo√°veis ‚Äã‚Äãno lado do site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um token de usu√°rio pode ser alterado legalmente de apenas uma maneira (consulte. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúCen√°rios de opera√ß√£o do protocolo‚Äù</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Risco.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o site n√£o salvar seu token e perfil em seu banco de dados, mas se basear inteiramente no mecanismo SSO, o invasor precisar√° executar apenas a autentica√ß√£o entre dom√≠nios para efetuar login usando seu nome. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimiza√ß√£o de riscos em caso de comprometimento.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Curiosamente, mas essa √© a preserva√ß√£o pelos sites de tokens e perfis de usu√°rio do lado deles. Uma tentativa de um invasor de realizar autentica√ß√£o entre dom√≠nios pode causar um conflito entre o antigo usu√°rio de ID e seu novo token. A situa√ß√£o em si, quando o usu√°rio alterou o token de qualquer outra maneira que n√£o a especificada no protocolo, deve ser percebida com suspeita ou completamente rejeitada. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Risco m√°ximo:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autoriza√ß√£o em seu nome em outros sites (onde voc√™ n√£o esteve). Acesso aos seus dados de perfil. Cometer atos ilegais em seu nome. E para que o leg√≠timo propriet√°rio n√£o possa retornar nada, um invasor pode alterar seu token no servidor de autoriza√ß√£o de maneira legal. Esse risco, no entanto, coincide com os riscos ao usar os esquemas de autoriza√ß√£o tradicionais. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maneiras de prote√ß√£o.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recusa em usar o SSO (especialmente porque o esquema proposto foi concebido como uma maneira de se afastar dos esquemas de autentica√ß√£o centralizados). Use v√°rios SSOs (n√£o guarde todos os ovos em uma cesta!). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o SSO suportar autentica√ß√£o de dois fatores com autentica√ß√£o por outros atributos (email, telefone), existe a possibilidade de recuperar o controle sobre a conta do servidor de autoriza√ß√£o.</font></font><br><br><a name="attack_token_compromise_due_transmit"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.6 Compromisso de token durante a transfer√™ncia </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â claro que o mecanismo proposto para os tokens de hash durante a transfer√™ncia </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o oferece uma garantia de 100% de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sua prote√ß√£o. </font><font style="vertical-align: inherit;">Um invasor pode interceptar o tr√°fego da v√≠tima no momento da transfer√™ncia de um token inseguro (no momento do registro prim√°rio da chave permanente), como exemplo. </font><font style="vertical-align: inherit;">E ent√£o use-o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, o uso de SSL √© incentivado. </font><font style="vertical-align: inherit;">Mas n√£o tome HTTPS como uma panac√©ia. </font><font style="vertical-align: inherit;">Este protocolo tamb√©m √© exposto, assim como HTTP. </font><font style="vertical-align: inherit;">S√≥ um pouco mais. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â verdade que uma transfer√™ncia t√£o rara de um token aberto, bem como o uso de um token individual para cada dom√≠nio, reduz o risco de explorar a vulnerabilidade. </font><font style="vertical-align: inherit;">No entanto.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro perigo √© a intercepta√ß√£o e reutiliza√ß√£o do token na sess√£o atual do usu√°rio. </font><font style="vertical-align: inherit;">Como eu disse anteriormente, o ideal √© que o token seja hash com um novo sal a cada solicita√ß√£o do cliente. </font><font style="vertical-align: inherit;">No entanto, isso eliminar√° a possibilidade de processamento paralelo de solicita√ß√µes no servidor e impossibilitar√° o envio de solicita√ß√µes paralelas do cliente. </font><font style="vertical-align: inherit;">Calcular e verificar hashes geralmente √© uma opera√ß√£o cara que reduz o desempenho.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, o token passado no cabe√ßalho nunca deve estar dispon√≠vel no Javascript. </font><font style="vertical-align: inherit;">Semelhante ao Cookie com o sinalizador HttpOnly. </font><font style="vertical-align: inherit;">Mesmo ao receber solicita√ß√µes de ajax por scripts.</font></font></blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo de opera√ß√£o:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interceptando a solicita√ß√£o de um usu√°rio, extraindo o valor atual do token, enviando outra opera√ß√£o com o mesmo token (como em nome do mesmo usu√°rio). </font><font style="vertical-align: inherit;">√â verdade que o sistema cl√°ssico baseado em cookies de sess√£o tamb√©m √© vulner√°vel a esse tipo de ataque. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo de prote√ß√£o:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> confirma√ß√£o de opera√ß√µes significativas atrav√©s de outros canais de comunica√ß√£o, por exemplo, via SMS ou correio; </font><font style="vertical-align: inherit;">pr√©-registro do token por outros canais de comunica√ß√£o (certificado em papel, como exemplo).</font></font><br><br><a name="attack_token_compromise_due_site_hacking"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.7 Hackeando um site e comprometendo tokens </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sites de hackers ocorrem constantemente. </font><font style="vertical-align: inherit;">At√© sites grandes e bem protegidos quebram. </font><font style="vertical-align: inherit;">Existem muitas maneiras de invadir: de uma inje√ß√£o trivial a um "dreno" interno. </font><font style="vertical-align: inherit;">Portanto, o comprometimento do seu token em qualquer site √© um evento muito prov√°vel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas o protocolo proposto, da mesma forma, torna o evento de invas√£o do site o menos doloroso para voc√™.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O comprometimento do token n√£o leva ao comprometimento da chave do dom√≠nio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com base na qual foi calculado. </font><font style="vertical-align: inherit;">Al√©m disso, esse </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">evento n√£o leva ao comprometimento de seus outros tokens</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">E, nesse caso, o acesso a outros sites permanece inacess√≠vel.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© especialmente agrad√°vel quando as chaves s√£o feitas para a maioria dos sites usando uma chave mestra: √© imposs√≠vel restaur√°-la por engenharia reversa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas, ao mesmo tempo, √© imposs√≠vel usar a chave de dom√≠nio cujo token foi comprometido, por raz√µes √≥bvias. </font><font style="vertical-align: inherit;">Tem que mudar a chave. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A chave do dom√≠nio em que ocorreu o vazamento oficial pode ser feita com base em um n√∫mero aleat√≥rio ou com base em uma chave mestra, com a adi√ß√£o de um n√∫mero de vers√£o:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/b1c/9ee/9ac/b1c9ee9ac9a8f065c9a394045a24edb9.svg" alt="$DomainKey = HMAC_{M_{key}}( DomainName \cup VersionNumber )$" data-tex="display"></p><br><br><a name="epilog"></a><h1>  Conclus√£o </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V√°rios de meus amigos a quem mostrei o artigo me fizeram essencialmente a mesma pergunta: "Qual √© a principal coisa aqui?" </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visto do alto</font></font></b> <div class="spoiler_text">  ,        (     ),     (?)  ,   . <br><br> ,     ,  -  .  ,    ,       ,           .       (   ,   ).    ,        ¬´ ¬ª      ¬´-¬ª. <br><br>  -    ¬´ ¬ª. <s>  </s>    ,  <s></s> ¬´¬ª.     ,    .     (   Google ,  Facebook ‚Äì       ).     (  DDOS-    . ‚Äì <abbr title="            "><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a></abbr>  )   - .   ,     SSO       ,        .   ? <br><br>   , , ,       .  ,     -     -.  ,     .,     .     email,  .      .  ,             .    ? <br><br> <b>  -.  ?</b> SSO ‚Äì    . <br><br> ,        ¬´ ¬ª.         .      .       .             .   , . <br><br>      -      ¬´¬ª  .    ,    ¬´ ¬ª.          ,    . <br><br>  -,         ? <br></div></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh, n√£o h√° chip principal!</font></font></b>  Infelizmente.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas h√° v√°rios detalhes que tornam o protocolo mais lucrativo do que o esquema tradicional de login / senha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Voc√™ provavelmente notou esse pop-up irritante em muitos sites.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúNosso site salva cookies! </font><font style="vertical-align: inherit;">Coloque o capacete e fique vigilante, porque o irm√£o mais velho est√° observando voc√™! </font><font style="vertical-align: inherit;">Clique em "Sim", porque voc√™ ainda n√£o tem escolha. "</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este √© outro pop-up para muitos outros igualmente intrusivos e muito necess√°rios. </font><font style="vertical-align: inherit;">E tudo isso gra√ßas ao GDPR europeu (um an√°logo da nossa lei de DP). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o aqui. </font><font style="vertical-align: inherit;">Em nosso esquema, os cookies n√£o s√£o mais necess√°rios para fins de identifica√ß√£o! </font><font style="vertical-align: inherit;">Da palavra "completamente". </font><font style="vertical-align: inherit;">O usu√°rio decide se o site deve ser identificado e quando e por quanto tempo. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menos um pop-up irritante, +1 no karma do protocolo.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. O desenvolvedor n√£o precisa mais executar formul√°rios de autoriza√ß√£o e recupera√ß√£o de senha. </font><font style="vertical-align: inherit;">N√£o h√° necessidade de implementar algoritmos SSO complexos e dominar bibliotecas complexas: OAuth, SAML, Kerberos etc., siga o procedimento para registrar seu site, alterar chaves de autoriza√ß√£o, monitorar sua seguran√ßa; </font><font style="vertical-align: inherit;">e se algo deu errado com o SSO, entenda urgentemente: "o que deu errado e por qu√™". </font><font style="vertical-align: inherit;">Al√©m disso, o servidor de autoriza√ß√£o pode bloquear seu site por raz√µes desconhecidas. </font><font style="vertical-align: inherit;">V√° descobrir isso. </font><font style="vertical-align: inherit;">Ontem tudo funcionou, mas hoje ... E aqui basta ler o token no cabe√ßalho e verificar se existe algum em nosso banco de dados. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simples = confi√°vel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas dizendo ...</font></font></b> <div class="spoiler_text">      .     .       ,   -  -  .       . .  . <br><br>    -, -,  ¬´ ¬ª   . <br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. O usu√°rio n√£o precisa inserir e lembrar um monte de senhas. Use os servi√ßos de sites de terceiros ou n√£o se sabe por quem e como os programas s√£o escritos. Voc√™ n√£o pode ter medo de acessar um computador por terceiros, keyloggers e cavalos de Tr√≥ia. Basta fazer uma c√≥pia de seguran√ßa da chave mestra, proteg√™-la com uma senha e armazen√°-la em algum lugar em uma unidade flash USB. Como uma carteira de bitcoin. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que n√£o √© um recurso?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4. Se o site for invadido, voc√™ n√£o arrisca nada. Bem, gere novamente a chave. Embora a senha vazada para os crackers do site possa causar muitos problemas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. O protocolo foi criado levando em considera√ß√£o a experi√™ncia de ataques de rede conhecidos. Sua arquitetura j√° inclui prote√ß√£o b√°sica contra XSS, CSRF. Novamente, os webmasters achar√£o mais f√°cil desenvolver sites. E seus usu√°rios - mais calmos.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Independ√™ncia do protocolo de um provedor de servi√ßos espec√≠fico e seus caprichos. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O protocolo te liberta.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. Finalmente, o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocolo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proposto </font><b><font style="vertical-align: inherit;">reivindica o futuro padr√£o aberto</font></b><font style="vertical-align: inherit;"> . E o padr√£o, se adotado pelos participantes, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imp√µe obriga√ß√µes de implementar a funcionalidade de acordo com a especifica√ß√£o</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e de n√£o cercar o farm coletivo de suas pr√≥prias decis√µes de autoriza√ß√£o, inventando novamente a forma de login, registro, recupera√ß√£o de senha e logout. E n√£o mexa com hash de senha ou inje√ß√£o de SQL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E o mais importante, como qualquer padr√£o aberto, ele </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode e deve ser verificado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especialistas independentes. </font><font style="vertical-align: inherit;">Mesmo que o autor da vers√£o original do protocolo tenha ‚Äúestragado‚Äù os detalhes, a comunidade online pode identificar oportunamente essa corre√ß√£o. </font><font style="vertical-align: inherit;">Bem, ou envie meu protocolo para o recado. </font><font style="vertical-align: inherit;">Infelizmente para mim, e "malvado" para todos os outros.</font></font><br><br><blockquote> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acho que devo parar com isso</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E. Wiles</font></font><br></blockquote><br><br><hr>  <b>PS</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ pode se familiarizar com a op√ß√£o de um artigo completo em um formato offline. </font><font style="vertical-align: inherit;">Ao escrever o material em Habr, eu poderia fazer erros de digita√ß√£o. </font><font style="vertical-align: inherit;">Se voc√™ tiver coment√°rios s√©rios, √© melhor verificar o original e deixar coment√°rios no artigo (revis√µes) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nesse arquivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Envie-me suas altera√ß√µes no mail sergey201991 [] gmail. </font><font style="vertical-align: inherit;">N√£o sou polvo, mas tentarei responder. </font><font style="vertical-align: inherit;">Vou adicionar v√°rios coment√°rios correspondentes / interessantes a este artigo. </font><font style="vertical-align: inherit;">Juntamente com as respostas para eles. </font><font style="vertical-align: inherit;">Uma variante de um artigo de coment√°rio separado n√£o √© descartada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim, eu sei que o protocolo pode ter problemas:</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o h√° como fazer login na sua conta no dispositivo de outra pessoa se voc√™ n√£o tiver uma chave em m√£os, mas precisar dela com urg√™ncia; </font><font style="vertical-align: inherit;">senhas s√£o mais convenientes aqui</font></font></li><li>      ;           ,  SSO </li><li>       ¬´¬ª, -  : -      (   ) </li><li>    -  </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em rela√ß√£o √† p√°gina 1 - Eu estava pensando seriamente em voltar √† id√©ia de gerar uma chave de dom√≠nio com base em uma senha, protegendo contra a for√ßa bruta, complicando o processo de gera√ß√£o da chave: digamos, aumentando o n√∫mero de rodadas de hash para 1000. Mas o problema com a poss√≠vel colis√£o de senhas para diferentes usu√°rios em um O site me assombra. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em rela√ß√£o √† p√°gina 2 - isso √© tratado pelo tempo. </font><font style="vertical-align: inherit;">Voc√™ precisa se acostumar com as novas interfaces. </font><font style="vertical-align: inherit;">No in√≠cio, n√£o ficar√° claro, depois ser√° simples. </font><font style="vertical-align: inherit;">D√™ a um homem dos anos 80 um smartphone moderno, ele tamb√©m n√£o teria descoberto como gerenci√°-lo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muito obrigado se voc√™ ler at√© o final!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt472310/">https://habr.com/ru/post/pt472310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt472296/index.html">Sistema de prote√ß√£o contra vazamentos para uma m√°quina de lavar</a></li>
<li><a href="../pt472298/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 385 (14 a 20 de outubro de 2019)</a></li>
<li><a href="../pt472300/index.html">Descida de gradiente estoc√°stico (SGD) para a fun√ß√£o de perda logar√≠tmica (LogLoss) em um problema de classifica√ß√£o bin√°ria</a></li>
<li><a href="../pt472304/index.html">NASA contrata engenheiros para desenvolver rob√¥ human√≥ide de pr√≥xima gera√ß√£o</a></li>
<li><a href="../pt472306/index.html">PHP Digest No. 166 (7 a 21 de outubro de 2019)</a></li>
<li><a href="../pt472312/index.html">Experi√™ncia na transfer√™ncia de um projeto Maven para o Jar Multi-Release: j√° poss√≠vel, mas ainda dif√≠cil</a></li>
<li><a href="../pt472314/index.html">Eu gosto de pessoas de papel√£o</a></li>
<li><a href="../pt472318/index.html">Rastreamento distribu√≠do no Istio</a></li>
<li><a href="../pt472320/index.html">Entrevista com o Zabbix: 12 respostas francas</a></li>
<li><a href="../pt472326/index.html">Nossa ind√∫stria espacial ... E se voc√™ olhar para os problemas da ind√∫stria da perspectiva de um nerd?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>