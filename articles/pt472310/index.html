<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧕 🤙🏾 👩🏼‍🚒 Identificação de clientes em sites sem senhas e cookies: solicitação de padrão 🎁 👈🏿 🧕🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Caro habrozhitel! Caros especialistas! Apresento para sua avaliação um novo conceito de identificação de usuário em sites que, espero, com sua ajuda s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Identificação de clientes em sites sem senhas e cookies: solicitação de padrão</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472310/"><img src="https://habrastorage.org/webt/zx/gv/lz/zxgvlzpzrabaux0m9y-brjkhhpi.jpeg" alt="imagem"><br><br>  Caro habrozhitel!  Caros especialistas!  Apresento para sua avaliação um novo conceito de identificação de usuário em sites que, espero, com sua ajuda se tornará um padrão aberto da Internet, tornando esse mundo da Internet um pouco melhor.  Esta é uma versão preliminar do protocolo de autenticação sem senha, desenvolvido como um artigo gratuito.  E se a idéia subjacente receber uma avaliação positiva de você, caro leitor, continuarei a publicá-la no reddit.com e no rfc-editor.org.  E espero poder interessar aos desenvolvedores dos principais navegadores em sua implementação.  Portanto, espero críticas construtivas de você. <br><br>  Atenção: muito texto. <br><br><a name="habracut"></a><br>  Então a questão é.  É possível identificar inequivocamente os visitantes do site sem divulgar seus dados pessoais e rastrear entre sites diferentes?  É possível, resolvendo esse problema, abandonar completamente a forma mais primitiva de autorização por login / senha e usar cookie / localStorage? <br><br>  Por um lado, os sites precisam reconhecer um cliente para, por exemplo, "restaurar" suas configurações, cesta de produtos, anúncios, artigos etc.  Por outro lado, os visitantes desejam permanecer o mais anônimos possível, sem revelar seus dados pessoais e impedir que sites de terceiros os rastreiem.  E o último pode fazer isso trocando entre si os dados coletados. <br><br>  Parece uma tarefa garantir que os lobos estejam cheios e as ovelhas seguras.  Isso é real? <br><br>  Eu, até certo ponto, eu acho - realmente. <br><br><h1>  Sumário </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1 conceito de autenticação sem senha</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.1 Chaves e tokens em vez de logins e senhas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.2 Estrutura do Token</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/472310/&amp;usg=ALkJrhjn8uZpGp2EBcotWFU8veafGusbrw#">1.3 cabeçalhos de protocolo HTTP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.4 Como os clientes identificam sites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.4.2 Como sei se um site suporta este protocolo?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.5 Como os clientes autorizam sites?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.6 Como implementar uma identificação confiável do cliente?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.7 Autorização no site pelos olhos do usuário</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.8 Como a chave do site muda?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.9 Como a autorização entre domínios é implementada?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.10 Como implementar a autenticação entre domínios?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1.11 Mobilidade da conta</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2 Descrição técnica do protocolo</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.0 Algoritmo de geração de chave de domínio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.1 o algoritmo para calcular o token de origem</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.2 Algoritmo de proteção de token durante a transferência</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.3 Procedimento de troca de sal entre o navegador e o servidor</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.4 Regras para a formação do campo Contexto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.5 Regras para definir os campos Remetente e Destinatário</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.6 Detalhes sobre tabelas de definição de contexto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.7 Cenários de protocolo</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.8 Processando tokens no servidor</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2.9 Autenticação entre domínios</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3 Recomendações de segurança</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3.1 Proteção das principais informações contra acesso não autorizado</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3.2 Sobre senhas como chaves de domínio</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">3.3 Riscos de perder / comprometer chaves e minimizá-las</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4 Ataques ao regime de autorização</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.1 Rastreamento de usuário</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.2 Ataque XSS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.3 Ataque do CSRF</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.4 Rastreando usando SSO</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.5 Compromisso de chave para SSO</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.6 Compromisso de token durante a transferência</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.7 Hackeando um site e comprometendo tokens</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conclusão</a> <br><br><br><div class="spoiler">  <b class="spoiler_title">O que há de errado com senhas?</b> <div class="spoiler_text">  Sim, não é verdade.  Eles podem ser perdidos.  Eles podem ser roubados.  Eles devem ser lembrados.  De qualquer forma, por que sou obrigado a preencher alguma forma de registro e criar outra senha para ver o tempo ou baixar esse arquivo?  Finalmente, as senhas são um pouco menos que muitas.  Quantos sites você gosta, tantas senhas.  E, portanto, muitos realmente usam uma senha em todos os sites.  Alguém usa um algoritmo complicado para lembrá-los.  Ou um gerenciador de senhas.  Ou, estupidamente, um caderno.  Ou prefere a autenticação entre domínios: você faz login uma vez em um site, e é isso!  Sim, não todos.  Isto é, se o site suportar. <br>  Todas essas abordagens têm desvantagens. <br>  Use uma senha em sites diferentes - Moveton.  O que duas pessoas sabem, o porco também sabe.  Nem todos os sites (mesmo grandes e respeitáveis) cumprem honestamente as regras de segurança para armazenar suas senhas.  Alguns sites armazenam senhas de forma aberta, enquanto outros acham que armazenar hashes de senhas já as protege o suficiente.  Como resultado, vazamentos de senhas e outros dados pessoais dos clientes ocorrem regularmente. <br>  Com o gerenciador de senhas já é melhor.  É verdade que ninguém garante que ela não mescla suas senhas em algum lugar.  E procure um gerente que possa sincronizar suas contas em todos os dispositivos (netbook doméstico, telefone, computador de trabalho).  Não excluo que isso exista. <br>  Mas, de qualquer forma, a ideia em si: primeiro registre-se em nosso site (ao mesmo tempo, envie um e-mail, celular, doe sangue para análise), depois invente / lembre-se de seu nome de usuário e senha e tenha a gentileza de lembrá-los, mas mantenha-os em segredo - abordagem, eu lhe digo, mais ou menos.  E nem um único gerenciador de senhas o resolverá.  Mas resolve o <abbr title="Tecnologia Single Sign-On implementada por vários protocolos como SAML, OAuth, Kerberos">SSO</abbr> . <br>  Isso é apenas azar: se você perder a senha do site SSO e esquecê-la, ou ela foi roubada de você ... Você perde o acesso de todos os seus sites de uma só vez ou voluntariamente a entrega a qualquer pessoa e não está claro com quais intenções.  <b>Não guarde todos os ovos em uma cesta!</b> <br>  E não é fato que o site SSO seja confiável.  Ou não armazena suas senhas em texto não criptografado.  Ou não os mescla voluntariamente, além de oferecer aos outros a oportunidade de rastrear você entre sites.  Bem, você entendeu. <br>  Portanto: login + senha = mal.  E todo o mal do mundo deve ser bebido seriamente e por muito tempo.  E um biscoito também.  Juntamente com seus crocodilos de sessão PHPSESSIONID, JSESSIONID e seus análogos. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">E o que fazer?</b> <div class="spoiler_text">  Primeiro, você precisa considerar situações típicas, das quais ficará claro: por que os sites querem lembrar de seus clientes e é realmente necessário para eles? <br><ol><li>  Blog pessoal "Vasya Pupkina", no qual, por exemplo, comentários são permitidos.  O registro é necessário apenas para se proteger de bots, realizar votações gratuitas, contar "curtidas" e outras "miau" e atribuir uma classificação aos comentaristas.  I.e.  Aqui <b>, a funcionalidade de rastreamento é necessária exclusivamente pelo site</b> , e apenas em pequena medida - pelo usuário (se ele valorizar sua classificação de "comentarista" neste site). </li><li>  Sites de redes sociais e outros usuários da Internet (ICQ, Skype - também).  O registro é necessário para implementar o conteúdo nomeado (autor), para identificar os visitantes.  I.e.  Aqui <b>, a funcionalidade de identificação é necessária em maior medida pelos próprios usuários</b> .  Embora os sites das redes sociais sejam os primeiros na lista de "pecadores", coletando as informações mais completas sobre os visitantes e lembrando você com seriedade e por um longo tempo.  Portanto, ainda não se sabe quem precisa mais de identificação. </li><li>  Site corporativo com conteúdo fechado.  O registro ou autorização aqui é necessário principalmente para restringir o acesso ao conteúdo.  Todos os tipos de: escolas on-line, bibliotecas, sites privados não públicos e assim por diante.  Aqui <b>, a funcionalidade de autorização é necessária em maior medida pelo site</b> .  Como regra, não há formulários de registro abertos.  As credenciais são compartilhadas por outros canais. </li><li>  Uma loja online e outra plataforma semelhante que vende itens, serviços ou conteúdo.  Também incluirei sites de anúncios classificados pagos / gratuitos.  O registro é principalmente necessário para armazenar o histórico dos pedidos dos clientes e, para que ele possa rastrear seu status atual, armazenar suas preferências (favoritos);  para formular ofertas pessoais ao cliente com base no histórico e nas preferências da compra.  Aqui <b>, a funcionalidade de identificação é igualmente necessária para o cliente e a loja</b> .  Mas mais, é claro, para a loja.  Para vapor, vapor e vapor. </li><li>  Quaisquer contas pessoais de usuários de serviços de Internet: e-mail, serviços públicos, Sberbank-online, megafone-online, escritórios de provedores, CMS de hosters, etc.  Aqui <b>, o próprio usuário está interessado principalmente na identificação correta e confiável</b> .  Afinal, ele gerencia informações importantes para si, que em algumas situações têm consequências legais e financeiras.  Não cheira a anonimato.  Ela é prejudicial aqui. </li><li>  Roteadores, consoles de gerenciamento, versões da Web para gerenciar algo em sua rede doméstica ou corporativa. </li></ol><br><br>  É claro que em situações diferentes, pode haver riscos diferentes.  Em alguns casos, a identificação incorreta, a perda de dados de autenticação ou mesmo o roubo / falsificação deles não trará consequências significativas para o site ou para o usuário.  Em outros, será apenas desagradável (perdi o carma em Habré - "é um desastre ...") ou levará a inconvenientes (não posso me afundar em Yula, ver meus anúncios; tenho acesso a meus projetos por perfil no github - ok nova conta, projetos de fork).  Em terceiro lugar, pode acarretar consequências jurídicas e financeiras.  Portanto, deve-se presumir que o esquema de autorização proposto não é uma “bala de prata” para todos os casos, especialmente “vazio”.  <b>Onde informações confidenciais são gerenciadas, vale a pena usar outros métodos de identificação e autenticação</b> ou sua combinação (autenticação de dois fatores, criptografia de chave assimétrica, segurança 3D, eToken, OTP-Token etc.). <br><br>  Oh bem.  Qual é o seu TK? <br></div></div><br><div class="spoiler">  <b class="spoiler_title">O que o novo protocolo oferece?</b> <div class="spoiler_text">  Da perspectiva do usuário final: <br><ol><li>  O site deve lembrar e reconhecer o visitante sem nenhuma entrada do usuário;  o site deve reconhecê-lo na sessão e entre diferentes sessões.  Sem cookies, senhas ou registros.  Ao mesmo tempo, sites diferentes não devem ser capazes <i>de</i> identificar exclusivamente o mesmo visitante, podendo rastrear suas atividades nesses e em outros sites.  I.e.  os sites não devem poder agregar informações para seus visitantes. </li><li>  O usuário deve ser capaz de " <b>esquecer qualquer site</b> " a qualquer momento;  e o site esquecerá o usuário.  Deve haver a possibilidade de conceder direitos ao site para lembrar o cliente por iniciativa do cliente (sem pop-up obsessivo).  O usuário deve poder migrar com segurança sua identidade virtual entre diferentes dispositivos e navegadores (se necessário) para ter uma única autorização em seus sites favoritos. </li></ol><br><br>  Eu vejo.  E que bônus os desenvolvedores de sites devem obter disso? <br><ol><li>  Um procedimento de identificação mais simples: não é necessário criar pela milésima vez a próxima forma de login, logout, registro, alteração e recuperação de senha.  Basta ativar o módulo de suporte de protocolo para sua estrutura favorita, implementada com base no padrão. </li><li>  Não há necessidade de um designer desenhar um formulário de login e pensar sobre onde escondê-lo em uma pequena tela móvel.  O protocolo torna os formulários desnecessários.  Bem, exceto que o formulário de inscrição.  Onde está sem eles então.  Infelizmente. </li></ol><br><br>  Finalmente: <br><ol><li>  O protocolo de autenticação deve ser unificado e padronizado;  Verificado por especialistas em segurança  Aprovado e recomendado pelos comitês de padronização da web.  Como resultado, a possibilidade de cometer erros clássicos pelos webmasters no desenvolvimento de formulários padrão de logon / logout, alteração / recuperação de senhas (transferência de senhas de forma clara, uso incorreto de hash, armazenamento de senhas ou hashes "não salgados" no banco de dados, seqüestrando senhas de usuários quando site de hackers). </li><li>  A autorização deve ser confiável até certo ponto (protegida contra falsificação, acesso não autorizado, com autenticação garantida);  Não crie novas vulnerabilidades em páginas da web e navegadores;  se possível, reduza os riscos de ataques de rede conhecidos imediatamente.  Bem, ou pelo menos uma redução significativa nos riscos de sua implementação bem-sucedida. </li></ol><br><br>  Com base nesses requisitos, passamos ao mais interessante: projetar um novo protocolo. <br></div></div><br><br><a name="part1"></a><h1>  1 conceito de autenticação sem senha </h1><br><br><a name="tokens_vs_passwords"></a><h2>  1.1 Chaves e tokens em vez de logins e senhas </h2><br>  Para cada domínio, incluindo os filhos, o navegador do cliente gera aleatoriamente uma chave exclusiva de 256 bits <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  .  <b>Essa chave nunca é transmitida.</b>  Permanece constante na sessão do usuário.  Cada nova sessão cria uma nova chave. <br>  Baseado em chave <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  o navegador gera um token de 256 bits <sup>*</sup> usando um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">algoritmo especial</a> <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  para identificar o usuário com um domínio específico.  Token de identificação <math></math><img src="https://habrastorage.org/getpro/habr/formulas/175/f98/839/175f98839ab732db76d5f20cd6ce2ce9.svg" alt="$ T $" data-tex="inline">  o usuário (doravante chamado de token) serve como um substituto para cookies de sessão como PHPSESSIONID e JSESSIONID. <br>  Key <math></math><img src="https://habrastorage.org/getpro/habr/formulas/8b1/9d8/49a/8b19d849a66473b36d68c78d06462129.svg" alt="$ K $" data-tex="inline">  pode ser " <b>corrigido</b> " pelo usuário.  A correção da chave permitirá que o usuário permaneça autorizado no site por um tempo ilimitado em diferentes sessões do navegador e retorne a autorização existente anteriormente.  Este é <b>um análogo da função "lembre-se de mim"</b> . <br>  Quando a confirmação é cancelada, o navegador "esquece" essa chave e começa novamente a gerar uma chave aleatória para esse domínio para cada nova sessão (a partir da atual), que <b>é análoga à "saída"</b> do usuário do site.  A saída é instantânea, não exigindo o recarregamento da página. <br>  O usuário pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">criar uma chave permanente para o domínio</a> .  A chave permanente, assim como a chave fixa, permitirá ao usuário retornar a autorização anterior.  De fato, essa <b>chave se torna um substituto para a conexão de senha de login.</b> <br>  O usuário tem a oportunidade de controlar quando o navegador do domínio usará uma chave constante e quando - aleatoriamente.  Este é <b>um análogo da função de logon / logout</b> .  O conceito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">é apresentado nas imagens abaixo</a> . <br>  Os métodos para gerar chaves de domínio persistentes fornecem a mobilidade de contas de usuário entre diferentes dispositivos.  O protocolo define o seguinte: <br><ul><li>  geração de uma chave de domínio com base em uma chave mestra do usuário </li><li>  formar individualmente uma chave de domínio com base em um sensor de número aleatório biológico </li><li>  Importando Chaves Existentes de um Arquivo de Chaves de Outro Dispositivo </li></ul><br><br><a name="token_structure"></a><h2>  1.2 Estrutura do Token </h2><br>  O token é uma estrutura de 256 bits, representada como uma sequência hexadecimal: <br><div class="scrollable-table"><table><tbody><tr><td>  84bc3da1b3e33a18e8d5e1bdd7a18d7a </td><td>  166d77ac1b46a1ec38aa35ab7e628ab5 </td></tr><tr><td>  parte de identificação </td><td>  parte de autenticação </td></tr></tbody></table></div><br>  A parte de identificação do token (os 128 bits mais altos) é semelhante ao logon.  Por essa sequência de bits, o servidor pode identificar exclusivamente o usuário. <br>  A parte de autenticação do token (os 128 bits inferiores) é semelhante à senha.  Essa sequência de bits ajuda o servidor a validar o token. <br>  As regras de validação de token são <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descritas abaixo</a> . <br><br><a name="http_headers"></a><h2>  1.3 cabeçalhos de protocolo HTTP </h2><br>  <b>Cabeçalhos usados ​​pelo cliente:</b> <br><br>  <b>CSI-Token</b> : &lt;Token&gt; é usado para enviar um token para o servidor <br>  <b>Token CSI</b> : &lt;Token1&gt;;  <b>Alterado para</b> &lt;Token2&gt; é usado para alterar o token atual: <br><ul><li>  ao autorizar uma chave permanente, </li><li>  ao registrar uma chave permanente, </li><li>  ao alterar a chave permanente. </li></ul><br>  <b>CSI-Token</b> : &lt;Token&gt; <b>Permanente é</b> usado ao corrigir a chave aleatória atual pelo usuário. <br>  <b>CSI-Token</b> : &lt;Token&gt; O <b>logout é</b> usado para finalizar prematuramente a sessão atual. <br><br>  <b>Cabeçalhos usados ​​pelo servidor:</b> <br>  <b>Suporte CSI: yes</b> diz ao cliente que o servidor suporta o protocolo de autorização CSI. <br>  <b>CSI-Token-Action: sucesso é</b> usado para notificar o navegador sobre a aceitação de um novo token de usuário (chave Change-To). <br>  <b>CSI-Token-Action: abort</b> cancela o procedimento de alteração de tokens (reversão para o token anterior). <br>  <b>Ação CSI-token: o registro</b> informa ao navegador que o novo token de usuário ainda está em processo de registro. <br>  <b>CSI-Token-Action:</b> erro <b>inválido</b> de verificação do token do lado do servidor. <br><br>  Finalmente <br>  <b>O CSI-Salt é</b> enviado pelo navegador e pelo servidor ao trocar o “salt” usado para proteger o token (parte de autenticação).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Veja abaixo para</a> mais detalhes. <br><br><a name="how_site_identify_us"></a><h2>  1.4 Como os clientes identificam sites? </h2><br>  Um site pode usar um token para identificar um visitante do site.  Ao mesmo tempo, o esquema de geração de tokens e sua capacidade de 256 bits <b>garantem tokens exclusivos para cada par:</b> domínio do usuário.  Outro domínio verá outro token de usuário.  Mesmo se executado no contexto do site de destino (via IFRAME, IMG, LINK, SCRIPT).  Além disso, um algoritmo especial de geração de token protege os usuários contra ataques XSS, SRF e torna impossível rastrear um usuário sem seu conhecimento.  Mas, ao mesmo tempo, a tecnologia <abbr title="Tecnologia Single Sign-On implementada por vários protocolos como SAML, OAuth, Kerberos">SSO permanece</abbr> possível com sua permissão e identificação entre domínios. <br>  O token <b>é transmitido no cabeçalho HTTP CSI-Token</b> <u>com todas as solicitações</u> para qualquer recurso de domínio (página, documento, imagem, script, estilo, fonte, arquivo, solicitação ajax, ...): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ki/mv/0k/kimv0kx4wvesmftizvvlgpfe088.png"></div><br>  O token é <b>recalculado <i>a cada</i> solicitação HTTP (S)</b> : página, imagem, solicitação ajax. <br>  Para otimizar os cálculos, o cache de tokens pelo navegador é permitido, mas apenas durante a sessão e somente se as condições para atender à solicitação permanecerem inalteradas. <br>  Como observado acima, o token pode servir como um substituto para cookies de sessão como PHPSESSIONID e JSESSIONID.  A única diferença é que, se o site gerou anteriormente um identificador para o visitante rastrear um usuário específico entre suas diferentes solicitações (afinal, milhares de solicitações de usuários diferentes chegam ao site ao mesmo tempo), agora o próprio cliente executa essa função. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Essa identificação é suficiente para permitir que você faça compras na loja online, anuncie em sites apropriados, escreva em fóruns, redes sociais, artigos da Wikipedia ou da Habré. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim, o usuário permanece anônimo para o site. Mas pode ser um "familiar" anônimo para o site. E o servidor pode salvar o token de um usuário assim, juntamente com seus dados (conta pessoal com compras, preferências, karma, pães, gostos e outros bônus). Mas apenas para manter a condição de conclusão de qualquer processo comercial: compra, envio do anúncio, etc. As condições são determinadas pelo próprio site.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como você pode ver, o protocolo é o mais simples possível para sites que não precisam registrá-lo antes de dar a oportunidade de executar qualquer ação. </font><font style="vertical-align: inherit;">Mas aqueles que precisam terão um pouco mais de dificuldade. </font><font style="vertical-align: inherit;">Mas mais sobre isso abaixo.</font></font><br><br><a name="how_we_know_what_sci_supported"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.4.2 Como sei se um site suporta este protocolo? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O site deve passar o cabeçalho http do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Support: yes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na seção Cabeçalhos de resposta de sua resposta:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/gs/zu/lygszusqavjk8yjnljig4pgojdm.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao ver esse título, o navegador informará discretamente o usuário que ele pode se salvar no site. </font><font style="vertical-align: inherit;">Por exemplo, o símbolo da chave na barra de endereço:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ar/ff/bt/arffbt4ibbg__wlp7eyvaei_gvq.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clicar em uma chave, por exemplo, criará uma chave para o domínio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.youtube.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fq/7c/4p/fq7c4piubz15qir9xtxchg9639o.jpeg"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A formação de uma nova chave não leva ao seu uso automático. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A chave permanente começa a ser usada apenas quando ativada pelo usuário. </font></font><br><br><a name="how_make_authorization"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.5 Como os clientes autorizam sites? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">É importante entender que o token ainda não torna o usuário autorizado em um site específico - apenas reconhecível. </font><font style="vertical-align: inherit;">Mas, como já foi dito, por enquanto você é simplesmente uma "pessoa anônima" reconhecível. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o site precisar associar seu token a você pessoalmente, o registro nesse site, infelizmente, não poderá ser evitado. </font><font style="vertical-align: inherit;">Mas no protocolo proposto, isso é um pouco mais fácil.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">É importante que os desenvolvedores entendam: a maioria dos sites não precisa de um questionário. </font><font style="vertical-align: inherit;">Evite forçar os visitantes a se registrarem. </font><font style="vertical-align: inherit;">Nas situações mais comuns, você pode executar um processo de negócios sem coletar visitantes do PD.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preencher formulários de registro tediosos "com ou sem" é desagradável. </font><font style="vertical-align: inherit;">Mas com o novo protocolo, não é mais necessário criar outro login e senha. </font><font style="vertical-align: inherit;">Somente o botão Confirmar e salvar me:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/__/0i/1x/__0i1xkyu82-ne_cnghuongzrfy.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obviamente, você precisará primeiro criar uma chave permanente para o site. </font><font style="vertical-align: inherit;">Mas isso é questão de alguns cliques do mouse. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E, com certeza, você será solicitado a confirmar seu telefone ou endereço de correspondência. </font><font style="vertical-align: inherit;">Mas isso já depende do site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Após a autorização bem-sucedida, o servidor, por meio de um cabeçalho HTTP especial, o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Token-Action</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> informará o navegador que aceitou a nova chave. </font><font style="vertical-align: inherit;">Mais detalhes no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capítulo II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="how_implement_reliable_identification"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.6 Como implementar uma identificação confiável do cliente? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em situações mais graves (conta pessoal do provedor, hospedagem, banco), a autenticação de dois fatores deve e pode ser realizada, e a comprovação da posse do token pode ser feita através do pré-registro e confirmação da identidade de outras maneiras: por e-mail, SMS ou mesmo fixando em papel o token do usuário. </font><font style="vertical-align: inherit;">(Sim, sim. Os certificados são gravados em papel, porque não os tokens).</font></font><br><br><a name="user_view_concept"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.7 Autorização no site pelos olhos do usuário </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O navegador notifica o usuário que o site suporta autorização CSI através do ícone de cadeado na barra de endereço. </font><font style="vertical-align: inherit;">Se você executar algumas ações no site, peça ao site para lembrar de você. </font><font style="vertical-align: inherit;">A partir deste momento, o servidor reconhecerá o usuário mesmo entre diferentes sessões:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/up/et/3q/upet3q-qbs8ikn4ba9t0ycn8voy.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustração</font></font></b> <div class="spoiler_text">     ,  .       ,   ,  ,   .    ,   .    .    .   ,   , ,      .   .  . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em vez de fixar a chave, o usuário pode criar uma chave permanente para o site e se registrar no local. </font><font style="vertical-align: inherit;">Ilustração animada:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/32/82/tm/3282tmri0zwdfx1jqi_zgd76zu0.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustração</font></font></b> <div class="spoiler_text">   .   .  .      . <br>     ,  « ».      . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E quando o usuário tem uma chave permanente para o site e essa chave é registrada lá, o processo de login é bastante simplificado: </font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u4/cm/_g/u4cm_gdewg2j7ree3gq3phuz6x4.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustração</font></font></b> <div class="spoiler_text">   . ,    .  ,  «».   ,  . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O maior poder do protocolo se manifesta quando o usuário cria uma chave para o site com base na chave mestra. </font><font style="vertical-align: inherit;">Nesse caso, o </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">problema de sua identificação em sites de outros dispositivos</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é facilmente </font><u><font style="vertical-align: inherit;">resolvido</font></u><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A animação a seguir demonstra isso. </font><font style="vertical-align: inherit;">Supõe-se que você já tenha distribuído sua chave mestra uma vez entre seus dispositivos / navegadores:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/ye/tx/xsyetxguxoesirmridywcy-2rts.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustração</font></font></b> <div class="spoiler_text">      .       -.  .    (  ). <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para sites com autorização de dois fatores, o "reconhecimento" pode ser assim: </font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/du/ab/cl/duabclss3t9nkxpnjygrqfxjdha.gif"></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na ilustração</font></font></b> <div class="spoiler_text">   .   .       .   ;    .   . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sair é ainda mais fácil. </font><font style="vertical-align: inherit;">Clique em "Logout" no navegador e pronto:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/do/2r/fe/do2rfebsd3orgwphl0ujrt_o52q.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O navegador envia uma solicitação para o site (em qualquer página) com o método HEAD, no qual envia o cabeçalho CSI-Token &lt;&gt;; </font><font style="vertical-align: inherit;">Sair.</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/gj/s1/mtgjs1i1jmtbehjyus_hfukqsq4.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O servidor, vendo esse cabeçalho, efetua um logout. </font><font style="vertical-align: inherit;">Se fosse uma chave fixa, o site excluirá todas as informações sobre o usuário (mais do que essa chave nunca aparecerá). </font><font style="vertical-align: inherit;">Se fosse uma chave permanente, apenas interrompe a sessão. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qualquer outra atividade do site transforma o usuário em um anônimo desconhecido para o site: recarregar a página, tentar fazer uma solicitação de ajax, baixar um arquivo etc. </font><font style="vertical-align: inherit;">- O navegador enviará um token gerado já com base em uma chave aleatória.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você pode gerenciar as chaves no gerenciador de chaves: altere a chave permanente, exporte a chave permanente para um arquivo, importe de um arquivo de outro dispositivo. </font><font style="vertical-align: inherit;">Configure a "saída automática" após fechar uma guia ou navegador. </font><font style="vertical-align: inherit;">Defina a duração de uma chave fixa.</font></font></blockquote><br><br><a name="how_user_can_change_key"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.8 Como a chave do site muda? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Substituir a chave permanente do site é tecnicamente o mesmo que mudar de uma chave aleatória para uma permanente. </font><font style="vertical-align: inherit;">Isso é descrito em mais detalhes no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">capítulo II</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No caso de alterar a chave permanente do site, o navegador notifica o site da alteração correspondente no token, enviando um </font><font style="vertical-align: inherit;">cabeçalho </font><b><font style="vertical-align: inherit;">CSI-Token</font></b><font style="vertical-align: inherit;"> com a chave </font><b><font style="vertical-align: inherit;">Changed-To </font></b></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em cada solicitação subsequente</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xk/rp/75/xkrp75ivdr3kjj1_i2sh9iwfqaa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O site deve processar corretamente essa solicitação. </font><font style="vertical-align: inherit;">E, se um determinado token de usuário estiver armazenado em seu banco de dados, ele deverá fazer uma substituição apropriada. </font><font style="vertical-align: inherit;">Ao mesmo tempo, o site deve responder ao navegador sobre a alteração bem-sucedida do token. </font><font style="vertical-align: inherit;">Ele faz isso no cabeçalho Response Headers com o parâmetro: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSI-Token-Action: success</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , indicando o token aplicado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O site tem o direito de rejeitar uma tentativa de alterar o token (por exemplo, se não houvesse esse token no banco de dados ou se não os salvasse) com o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">parâmetro CSI-Token-Action: abortado. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Até que o navegador receba o cabeçalho CSI-Token-Action, ele adicionará a chave Changed-To a cada solicitação de CSI-Token no site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este é </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um análogo da "alteração de senha" do usuário.</font></font></b> <br><br><a name="how_make_cross_domain_auth"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.9 Como a autorização entre domínios é implementada? </font></font></h2><script type="text/javascript">function gtElInit() {var lib = new google.translate.TranslateService();lib.translatePage('ru', 'pt', function () {});}</script><script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=gtElInit&amp;client=wt"></script><br>  A autorização clássica de domínio cruzado usando a tecnologia <abbr title="Tecnologia Single Sign-On implementada por vários protocolos como SAML, OAuth, Kerberos">SSO</abbr> tem muitas vantagens para o usuário.  Você não precisa se lembrar de várias senhas de vários sites.  Não há necessidade de se registrar e preencher os formulários tristes.  Alguns servidores de autorização perguntam quais direitos conceder ao site que solicitou o SSO. <br>  Mas também há desvantagens.  <b>Você depende do provedor de SSO.</b>  Se o servidor SSO não funcionar, você não chegará ao site de destino.  Se você perder sua senha ou sua conta for roubada - você perderá o acesso de todos os sites de uma só vez. <br>  Para desenvolvedores web, as coisas são um pouco mais complicadas.  Desde o início, você precisa registrar seu site no servidor de autorização, obter as chaves, aprender a trabalhar com o protocolo ( <abbr title="Um padrão aberto para a troca de dados de autenticação e autorização entre um provedor de contas e um provedor de serviços">SAML</abbr> , <abbr title="Um protocolo de autorização aberto que permite fornecer a terceiros acesso limitado aos recursos protegidos do usuário sem precisar transferir um login e senha para terceiros">OAuth</abbr> etc.) e as bibliotecas correspondentes, verifique se a chave não expira, se o servidor de autorização não bloqueia seu site por seus motivos e etc.  É uma taxa pelo fato de você não precisar manter contas de usuário, fazer formulários de registro, fazer login etc.  A verdade aumenta o custo de manutenção (na forma de reparar falhas repentinas).  Novamente, se o servidor estiver subitamente indisponível no site, então, infelizmente. <br>  Esse esquema de autorização torna o SSO um pouco mais seguro e a autorização para todos os participantes é mais fácil.  A segurança será discutida abaixo na seção <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Compromisso de chave para SSO".</a> <br><br>  Dê uma olhada no site S, que suporta o SSO do Google.  Suponha que você tenha uma conta do Google.  Para fazer login, clique no link "Fazer login com o Google", que abrirá a guia de autorização do Google.  O navegador informará que você tem uma chave para o Google.  E o Google informará quais direitos S. solicita. <br>  Se você concordar, clique em "Login" no gerenciador de chaves.  A página será recarregada.  O Google já receberá seu token válido, reconhecerá e autorizará você.  E com uma solicitação entre servidores, ele informará o Site S sobre as informações da sua conta, de acordo com os campos solicitados. <br>  A página recarregada conterá um botão "Avançar" que o levará ao site de destino. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><div class="spoiler">  <b class="spoiler_title">Na ilustração</b> <div class="spoiler_text">  Ele dará um exemplo desse algoritmo ao se registrar no site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.youtube.com</a> usando a autorização entre domínios através de accounts.google.com. <br></div></div><br>  O Site S pode decidir salvar dados sobre você no banco de dados ou não.  Esta questão está além do escopo do esquema de autorização proposto.  Além disso, onde consideraremos os riscos de perder a chave do SSO, o site é recomendado para manter o token e o identificador do usuário do SSO de lado e recomenda-se que o usuário crie uma chave permanente para S. <br><blockquote>  <b>Vulnerabilidade:</b> após essa autorização, os sites S1, S2, S3, ... (onde você acessou o Google) poderão reconhecê-lo (pelo identificador atribuído a você pelo Google) e, como resultado, rastrear sua atividade. </blockquote><br><blockquote>  <b>Opção de proteção:</b> não trabalhe simultaneamente em sites se você se registrou através do SSO do mesmo provedor.  Se possível, efetue logout no servidor de autorização imediatamente após a conclusão da autorização ("saída automática" para o domínio). </blockquote><br><br><a name="how_make_sub_domain_identify"></a><h2>  1.10 Como implementar a autenticação entre domínios? </h2><br>  Tudo isso, claro, é bom.  Enquanto o trabalho é realizado em um navegador - está tudo bem.  Mas e as realidades modernas quando uma pessoa tem dois telefones celulares, um computador em funcionamento e vários navegadores, um computador doméstico e outro laptop?  Além de um tablet comum para a esposa / filhos. <br>  De alguma forma, teremos que resolver o problema da transferência de chaves de domínio entre navegadores, dispositivos.  E também resolva o problema de sua sincronização correta. <br>  Um dos mecanismos para resolver esse problema é calcular várias chaves de domínio com base em uma chave mestra comum, sem a possibilidade de recuperação reversa da chave mestra de uma chave de domínio conhecida. <br>  Ao criar uma chave pessoal K para o domínio D usando a chave mestre M em um dispositivo, o usuário poderá criar a mesma chave K para o domínio D e em qualquer outra usando a mesma chave mestre M e um único algoritmo.  Mais precisamente, isso será feito não pelo usuário, mas pelo navegador.  Com essa abordagem, é suficiente para o usuário distribuir sua chave mestra entre todos os navegadores usados ​​por ele e ele "transfere todas as suas chaves" de domínios de uma só vez.  Ao mesmo tempo, faz backups dessa maneira. <br>  Máxima comodidade do usuário.  <b>Mas também o risco máximo</b> em caso de comprometimento da chave mestra.  Portanto, este último deve ser protegido adequadamente.  Os riscos de perda ou comprometimento da chave mestra e as formas de minimizar esses riscos estão descritos no capítulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"3 Recomendações de segurança"</a> . <br>  Usar apenas uma chave mestra para gerar todas as chaves para todos os domínios nem sempre é uma opção conveniente.  Em primeiro lugar, o que fazer se de repente a chave do domínio for comprometida e precisar ser alterada?  Em segundo lugar, e se você precisar compartilhar uma chave de domínio com outra pessoa?  Por exemplo, entre membros da família.  Ou é uma conta corporativa de acesso ao correio público.  Como, então, "pegar" sua chave (porque na verdade ela foi comprometida)? <br>  Portanto, a geração de chaves de domínio individuais usando um sensor de número aleatório biológico deve ser suportada pelos navegadores.  Mas voltamos novamente à questão de nossa mobilidade e aos problemas de sincronização, às funções de exportar e importar chaves no navegador e criar cópias de backup. <br><br><h3>  Transferir através de um dispositivo físico alienável </h3><br>  Cartões inteligentes e tokens USB podem ser bastante adequados como armazenamento seguro de informações importantes (porque foram criadas para isso).  A autenticação de dois fatores protege as chaves contra acesso não autorizado com acesso direto ao dispositivo. <br>  É verdade que os cartões inteligentes requerem leitores especiais (para não mencionar drivers), o que limita seu uso apenas às estações de trabalho equipadas com esses leitores. <br>  Com tokens USB um pouco mais fácil.  Somente drivers são necessários.  Mas você não pode colocar esse símbolo no telefone.  E embora para telefones celulares existam tokens feitos na forma de cartões SD, para não dizer que esta solução aumenta a mobilidade.  Tente desenhar um cartão de um telefone celular, mas insira-o em outro.  E não é que isso seja impossível.  O problema é que não é conveniente. <br>  E se o token quebrar?  Então todas as suas chaves irão para o Grande Cthulhu. <br>  Portanto, haverá uma tentação com esse esquema de usar vários dispositivos duplicados.  Mas você ainda precisará resolver o problema de sincronização de chaves se tiver vários cartões inteligentes. <br>  E, francamente, esses dispositivos não estão protegidos contra keyloggers.  Agora, se o código PIN for inserido no próprio cartão / token.  Então outra coisa.  Mas eu não vi isso na natureza. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/1g/js/gq1gjsgtxvfjjvs79syif5_u8_w.png"></div><br><blockquote>  <b>Prós:</b> chaves aleatórias de 256 bits podem ser usadas;  alta segurança através do uso de autenticação de dois fatores;  o mais alto nível de proteção contra adulteração direta. <br>  <b>Contras:</b> dependência do dispositivo;  requer custos financeiros;  baixa mobilidade;  a necessidade de reservar cartões e, como resultado, sincronizar dados entre eles;  permanece vulnerável a keyloggers. <br></blockquote><br><h3>  Sincronizar via serviço online </h3><br>  A "tecnologia em nuvem" agora é empurrada sempre que possível.  Parece que eles, juntamente com o blockchain, se tornaram um substituto para a "tecnologia da banana".  Naturalmente, existe o desejo de usar uma certa plataforma da Internet para a troca de informações importantes.  Um tipo de cartão inteligente "online". <br>  O que?  Você efetua login usando nosso esquema anonimamente em um site desse tipo;  envie suas chaves criptografadas com uma senha lá;  Você vai de outro dispositivo para o mesmo site com a mesma chave / senha;  você pega as chaves de lá;  Você sincroniza as alterações na data da edição.  Semelhante ao gerenciador de senhas, somente isso está online. <br>  Isso é justo, ninguém garante que o serviço on-line não será invadido ou não mesclará suas chaves, embora criptografadas, "onde necessário".  Quem implementará esse serviço gratuitamente.  É isso. <br>  Embora, é claro, a senha proteja as chaves do uso direto.  Mas sua senha é resistente à força bruta "offline"?  Essa é outra questão. <br><blockquote>  <b>Prós:</b> alta mobilidade de credenciais;  independência de dispositivo e navegador;  você precisa de apenas uma senha (embora elas não tenham deixado a senha, já é melhor). <br>  <b>Desvantagens:</b> menos seguro do que armazenar chaves em um meio alienável.  De fato, a segurança das chaves é baseada na força da senha da seleção. <br></blockquote><br>  Obviamente, você pode usar uma chave mestra para criptografar outras chaves.  Aquele com o qual outras chaves de domínio são calculadas.  Como uma opção <br><br><a name="part2"></a><h1>  2 Descrição técnica do protocolo </h1><br><br><a name="perm_key_algo"></a><h2>  2.0 Algoritmo de geração de chave de domínio </h2><br>  Este protocolo define apenas 2 métodos para gerar chaves de domínio. <br><br><ul><li>  com base em um gerador de números aleatórios (de preferência biológico) </li><li>  com base em uma chave mestra de 256 bits </li></ul><br>  No último caso, a chave do domínio é calculada como: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/3aa/d39/ac7/3aad39ac79fc322d157a9f4c58a793f2.svg" alt="$ K = HMAC_ {M_ {key}} (Domínio) $" data-tex="display"></p>  onde <math></math><img src="https://habrastorage.org/getpro/habr/formulas/0b7/f4d/5a6/0b7f4d5a6dcc0d36804bd9dfc0ff9403.svg" alt="$ M_ {key} $" data-tex="inline">  - chave mestra de 256 bits, Domínio - nome do domínio para o qual a chave foi feita. <br>  A seguir, o <i>HMAC</i> é <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um algoritmo criptográfico de hash</a> baseado em uma implementação de 256 bits da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">função de</a> hash <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SHA-2</a> . <br><blockquote>  A divulgação comprometida ou voluntária de uma chave de domínio não compromete a chave mestra original. </blockquote><br>  A chave mestra fornece um mecanismo para a mobilidade das credenciais do usuário. <br><div class="spoiler">  <b class="spoiler_title">Nota</b> <div class="spoiler_text">  Na versão inicial do protocolo, a opção de gerar chaves de domínio com base na senha do usuário foi considerada como assegurando a mobilidade do usuário e protegendo contra comprometimento de senha ao invadir um site.  Mas no capítulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">“3 Recomendações de Segurança”,</a> serão dadas explicações sobre por que foi decidido recusar tal esquema. </div></div><br>  Se a chave criada com base no "mestre" foi comprometida ou o token calculado a partir dessa chave (como resultado da invasão do site) foi comprometido, a chave deve ser alterada.  Você pode alterá-lo para uma chave aleatória de 256 bits ou gerá-lo a partir do mesmo "assistente", com a adição de uma versão: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/eae/301/46b/eae30146bac887a402418464641e617e.svg" alt="$ K = HMAC_ {Mkey} (versão do domínio \ cup) $" data-tex="display"></p>  A seguir, o símbolo <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ xícara $" data-tex="inline">  será usado para operação de concatenação de strings (matrizes de bytes). <br><br><a name="token_algo"></a><h2>  2.1 o algoritmo para calcular o token de origem </h2><br>  O token de autenticação do usuário é calculado com todas as solicitações de qualquer recurso de domínio.  Para calcular o token de solicitação, os seguintes dados são obtidos: <br><br><ul><li>  <i>Remetente</i> - o nome de domínio do iniciador da solicitação (pode ser uma página com um iframe ou um script do domínio de outra pessoa que realiza a busca), </li><li>  <i>Destinatário</i> - nome de domínio do destinatário (para onde a solicitação é enviada), </li><li>  <i>Contexto</i> - solicite o contexto de execução, </li><li>  <i>Proteção</i> - uma sequência aleatória de 32 bytes (256 bits), se o Contexto estiver vazio;  caso contrário vazio </li></ul><br>  Esses dados são concatenados e agrupados com SHA-2 de 256 bits <b>na chave K do domínio que inicia a solicitação</b> : <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8d1/bd1/cbc/8d1bd1cbc81815e0121976c9bb5e4ccc.svg" alt="$ K = HMAC_M (Remetente \ copo Destinatário \ copo contexto / proteção Cup) $" data-tex="display"></p><blockquote>  Um token válido é obtido quando o Contexto não está vazio.  Para uma identificação adequada no site de destino, a condição Remetente = Destinatário = Contexto deve ser atendida. </blockquote><br>  O campo Contexto, junto com Proteção, é usado para proteger contra ataques <abbr title="Script entre sites - &quot;script entre sites&quot;">XSS</abbr> e <abbr title="Falsificação de solicitação entre sites - &quot;falsificação de solicitação entre sites&quot;">CSRF</abbr> , bem como do rastreamento de usuários. <br>  Explicações mais detalhadas sobre as regras para determinar Remetente / Destinatário / Contexto serão fornecidas abaixo. <br><br><a name="token_validation_algo"></a><h2>  2.2 Algoritmo de proteção de token durante a transferência </h2><br>  O token do cliente original é transmitido extremamente raramente.  Somente ao transferir um token não registrado no momento em que a sessão foi criada. <br>  <b>Um token é considerado não registrado</b> se: é criado com base em uma chave aleatória (não fixa);  não foi aceito pelo servidor após o envio da chave Alterar para ou Permanente.  Para mais detalhes, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">“Processando tokens no servidor”</a> . <br>  O navegador e o servidor geram conjuntamente um par de números aleatórios, os chamados  salt (Salt), com o qual os 128 bits inferiores do token são hash.  Ambos trocam esses números de acordo com o protocolo.  Para detalhes, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">“Servidor de Procedimentos de Troca de Sal”</a> . <br>  Portanto, o servidor do site vê o seguinte token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$ T = Olá (T_s) \ xícara HMAC_ {salt} (Lo (T_s)) $" data-tex="display"></p>  onde <math></math><img src="https://habrastorage.org/getpro/habr/formulas/69c/826/a5b/69c826a5bc2d0953c3db1dbcc842a035.svg" alt="$ Olá (T_s) $" data-tex="inline">  - 128 bits altos, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/73a/cbf/6b4/73acbf6b426b5d3dff599b4cba44ebfd.svg" alt="$ Lo (T_s) $" data-tex="inline">  - os 128 bits inferiores do token original, <math></math><img src="https://habrastorage.org/getpro/habr/formulas/a47/285/a28/a47285a2828b9a69edf64fea3e240a0d.svg" alt="$ \ xícara $" data-tex="inline">  - concatenação de strings.  Nesse caso, o token inicial <math></math><img src="https://habrastorage.org/getpro/habr/formulas/c39/070/036/c39070036bed1c9b371606081981a5fb.svg" alt="$ T_s $" data-tex="inline">  já deve ser conhecido pelo servidor. <br><br>  Idealmente, o CSI-Salt deve mudar toda vez que um navegador solicita um servidor.  No entanto, isso pode ser um requisito caro em termos de recursos de computação.  Além disso, ele pode "matar" a capacidade de enviar solicitações paralelas ao servidor. <br>  Portanto, para otimizar os cálculos, é permitido manter os valores de CSI-Salt inalterados em diferentes solicitações, <u>mas não mais que uma sessão</u> .  Pode ser um limite de tempo (alteração do CSI-Salt a cada 5 minutos) ou uma reação à intensidade das solicitações (alteração do CSI-Salt a cada 100 solicitações) ou após cada série de solicitações (no momento da pausa, cliente-servidor) ou uma versão mista.  Aqui a decisão é deixada para os desenvolvedores do navegador. <br>  Manter o CSI-Salt inalterado por muito tempo enfraquece a proteção do token transmitido, permitindo que o invasor, ao interceptar o token, use-o até que o usuário legítimo conclua o Logout e faça uma solicitação não autorizada em nome da vítima. <br><br><a name="salt_exchange_algo"></a><h2>  2.3 Procedimento de troca de sal entre o navegador e o servidor </h2><br>  2.3.1 Token baseado em uma chave de servidor <sup>[1]</sup> aleatória ou não registrada. <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Navegador</b> </th><th>  <b>Servidor</b> </th></tr><tr><td colspan="2">  <b>Solicitação inicial (inicialização da sessão do usuário)</b> </td></tr><tr><td>  O navegador envia o token como está. <br>  <b>Sua solicitação está faltando CSI-Salt.</b> <br></td><td>  O servidor vê pela primeira vez esse token. <br><div class="spoiler">  <b class="spoiler_title">a propósito</b> <div class="spoiler_text">  O servidor pode não ser o primeiro a ver esse token.  E o navegador é considerado não registrado.  Isso pode acontecer <u>quando você recriar a chave com base na chave mestra em outro dispositivo</u> .  Portanto, essa situação também deve ser levada em consideração. </div></div><br>  Percebe como é (considera desprotegido).  Usa esse token como um identificador de sessão. <br>  Gera seu <i><sub>sal</sub> S.</i> <br>  <b>Retorna na resposta no cabeçalho CSI-Salt.</b> <br></td></tr><tr><td colspan="2">  <b>Segundo pedido</b> </td></tr><tr><td>  Gera sal <i>Com <sub>sal</sub></i> . <br>  O navegador conecta <sup>[3]</sup> seu sal e o sal do servidor. <br>  O navegador envia a solicitação, passando um token de sal compartilhado. <br>  <b>Envia CSI-Salt.</b> <br></td><td>  O servidor recebe a solicitação e <b>recupera o cliente CSI-Salt</b> . <br>  O servidor conecta o salt do navegador ao seu próprio e o utiliza para verificar o token. <br><br>  Se a validação do token for bem-sucedida, ele fornecerá ao usuário conteúdo de acordo com seus direitos. <br><br>  Em erros de verificação, retorna o cabeçalho <b>CSI-Token-Action: inválido</b> para o cliente.  Retornar conteúdo ou retornar uma resposta vazia: depende do servidor. <br></td></tr><tr><td colspan="2">  <b>Solicitações subsequentes</b> </td></tr><tr><td>  O navegador envia a solicitação, passando um token de sal compartilhado. <br>  <b>Sua solicitação está faltando CSI-Salt.</b> <br></td><td>  O servidor recebe a solicitação e verifica seu token. <br><br>  Se a validação do token for bem-sucedida, ele fornecerá ao usuário conteúdo de acordo com seus direitos. <br><br>  Em erros de verificação, retorna o cabeçalho <b>CSI-Token-Action: inválido</b> para o cliente.  Retornar conteúdo ou retornar uma resposta vazia: depende do servidor. <br></td></tr><tr><td colspan="2">  <b>Depois de um tempo <sup>[2]</sup></b> </td></tr><tr><td>  Gera um novo sal <i>C <sub>sal</sub></i> . <br>  Conecte o novo sal ao servidor. <br>  Envia uma solicitação, passando um token protegido por um novo sal comum. <br>  <b>Envia CSI-Salt.</b> <br></td><td>  O servidor recebe a solicitação e <b>recupera o novo cliente CSI-Salt</b> . <br>  O servidor conecta o salt do navegador ao seu próprio e o utiliza para verificar o token. <br><br>  Se a validação do token for bem-sucedida, ele fornecerá ao usuário conteúdo de acordo com seus direitos. <br><br>  Em erros de verificação, retorna o cabeçalho <b>CSI-Token-Action: inválido</b> para o cliente.  Retornar conteúdo ou retornar uma resposta vazia: depende do servidor. <br></td></tr></tbody></table></div><br>  2.3.2 Token baseado na chave registrada pelo servidor <sup>[1]</sup> . <br><div class="scrollable-table"><table><tbody><tr><th>  <b>Navegador</b> </th><th>  <b>Servidor</b> </th></tr><tr><td colspan="2">  <b>Solicitação inicial (inicialização da sessão do usuário)</b> </td></tr><tr><td>  Gera sal <i>Com <sub>sal</sub></i> . <br>  <b>Envia CSI-Salt.</b> <br>  Transfere o token em um formulário protegido. <br></td><td>  O servidor recebe a solicitação e <b>recupera o cliente CSI-Salt</b> . <br>  Lê um token protegido. <br>  Localiza o token de cliente completo em seu banco de dados (usa o primeiro token de 128 bits recebido na solicitação de pesquisa). <br>  Porque  essa é a solicitação inicial, o servidor não enviou sal ao cliente e a <b>validação</b> do <b>token neste estágio é realizada apenas pelo sal do cliente</b> . <br><br>  Em erros de verificação, retorna o cabeçalho <b>CSI-Token-Action: inválido</b> para o cliente.  Retornar conteúdo ou retornar uma resposta vazia: depende do servidor. <br><br>  Se a validação do token for bem-sucedida, ele fornecerá ao usuário conteúdo de acordo com seus direitos. <br><br>  Gera seu <i><sub>sal</sub> S.</i> <br>  <b>Retorna na resposta no cabeçalho CSI-Salt</b> . <br></td></tr><tr><td colspan="2">  <b>Solicitações subsequentes</b> </td></tr><tr><td>  O navegador combina o sal e o sal do servidor. <br>  O navegador envia a solicitação, passando um token de sal compartilhado. <br>  <b>Sua solicitação está faltando CSI-Salt</b> . <br></td><td>  O servidor recebe a solicitação e verifica seu token. <br><br>  Se a validação do token for bem-sucedida, ele fornecerá ao usuário conteúdo de acordo com seus direitos. <br><br>  Em erros de verificação, retorna o cabeçalho <b>CSI-Token-Action: inválido</b> para o cliente.  Retornar conteúdo ou retornar uma resposta vazia: depende do servidor. <br></td></tr><tr><td colspan="2">  <b>Depois de um tempo <sup>[2]</sup></b> </td></tr><tr><td>  Gera um novo sal <i>C <sub>sal</sub></i> . <br>  O navegador conecta o novo sal ao servidor. <br>  O navegador envia a solicitação, passando um token protegido pelo novo sal compartilhado. <br>  <b>Envia CSI-Salt</b> . <br></td><td>  O servidor recebe a solicitação e <b>recupera o novo cliente CSI-Salt</b> . <br>  O servidor conecta o salt do navegador ao seu próprio e o utiliza para verificar o token. <br><br>  Se a validação do token for bem-sucedida, ela fornecerá ao usuário o conteúdo de acordo com seus direitos. <br><br>  Em erros de verificação, retorna o cabeçalho <b>CSI-Token-Action: inválido</b> para o cliente.  Retornar conteúdo ou retornar uma resposta vazia: depende do servidor. <br></td></tr></tbody></table></div><hr>  <sup>[1] Um token é considerado não registrado se: é criado com base em uma chave aleatória;</sup>  <sup>não foi aceito pelo servidor após o envio da chave Alterar para ou Permanente com a resposta CSI-Token-Action: success.</sup> <sup><br></sup>  <sup>[2] O tempo durante o qual a alteração CSI-Salt é feita é determinado pelos próprios navegadores.</sup>  <sup>Isso pode acontecer após uma série de solicitações, após um tempo limite, após um determinado número de solicitações.</sup> <sup>  – <b>     CSI-Salt    </b> . <br> [3]     16-  128- .     ,   : <i> <sub>salt</sub></i> || <i>S <sub>salt</sub></i> .       –     ,    .      ,    ,    .</sup> <br><br><a name="context_rules"></a><h2> 2.4    Context </h2><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text">      .   ,  -  .            . <br>       ,   .      ,     . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós chamaremos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nosso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> domínio de cuja página estamos carregando (exibido na barra de endereços do navegador). Os domínios restantes serão chamados </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externos</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mesmo que esses sejam domínios filhos de um dado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chamamos o recurso de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">externo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se ele foi baixado de um domínio externo. Chamaremos o recurso de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interno</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se ele tiver sido baixado do nosso domínio. O recurso pode ser um script, imagem, solicitação de ajax e qualquer outro arquivo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um script é considerado externo se tiver sido baixado de um domínio externo. O script colocado na tag &lt;script&gt; criada, criada por um script externo, também será considerado externo. O script localizado na tag &lt;script&gt; modificada é declarado externo se tiver sido modificado por um script externo ou se um script externo estiver presente na cadeia de chamadas quando seu conteúdo for alterado. Mesmo se, ao mesmo tempo, esse &lt;script&gt; estivesse originalmente na página ou fosse criado por um script interno. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomearemos as tags LINK, SCRIPT, IMG, IFAME e outras, que exigem que o navegador carregue algum recurso assim que ele for atendido pelo analisador DOM - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tags de recurso</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nomearemos as tags FORM, A, META e outras, que podem iniciar o carregamento da página sob determinadas condições (enviar, clicar,timeout) - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iniciando tags</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós chamaremos a tag </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estática</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se ela estava originalmente presente na página quando foi emitida pela primeira vez pelo servidor. Chamaremos a tag de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dinâmica</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se ela foi criada no processo de execução dos scripts. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tag FORM é declarada dinâmica, mesmo que não apenas a tag em si tenha sido alterada, mas também os valores de todos os campos INPUT associados a este formulário. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós chamaremos uma tag dinâmica </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nossa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se o script que a criou pertencer ao nosso domínio e a cadeia de chamadas da instrução que gerou essa tag não tiver uma função pertencente a um script externo. Caso contrário, consideramos </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inadequada</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uma tag dinâmica </font><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O carregamento da página é acionado iniciando tags.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A tag inicial pode ser ativada diretamente pelo usuário, ou ativada pelo script, executando o comando click (para o link) e enviando (para o formulário), ou pelo script que gera os eventos onclick / onsubmit correspondentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Além disso, a tag inicial pode ser ativada pelo navegador. </font><font style="vertical-align: inherit;">Um exemplo dessa tag é META com os parâmetros http-equiv = "refresh" content = "0". </font></font><br><br> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabela P. Valores de contexto sob diferentes condições de abertura da página</font></font></sup> <br><a name="context_table_P"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Método de abertura </font></font></th><th colspan="4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quem acionou o carregamento da página? </font></font></th></tr><tr><th>  Usuário </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">próprio. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o navegador </font></font></th></tr><tr><td rowspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup> </td><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Estático </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1 </font><font style="vertical-align: inherit;">Referenciador</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2 </font><font style="vertical-align: inherit;">Variante </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P3 </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P4 </font><font style="vertical-align: inherit;">Herdar</font></font></td></tr><tr><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dinâmico </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Próprio </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5 </font><font style="vertical-align: inherit;">Herdar</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6 </font><font style="vertical-align: inherit;">Variante </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P7 </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8 </font><font style="vertical-align: inherit;">Herdar</font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Imprópria </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P9 </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA. </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PB. </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC. </font><font style="vertical-align: inherit;">Vazio</font></font></td></tr><tr><td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Diretamente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD. </font><font style="vertical-align: inherit;">Domínio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE. </font><font style="vertical-align: inherit;">Variante </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pf. </font><font style="vertical-align: inherit;">Vazio</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG. </font><font style="vertical-align: inherit;">Variante </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></sup> </td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesma tabela, apenas imagem</font></font></b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/cq/l-/6e/cql-6eob6gouvsqsrdy5ltykhfg.gif" align="right"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a tag do recurso foi alterada por um script (por exemplo, o atributo SRC do IMG) e o recurso foi carregado automaticamente pelo navegador, acreditamos que o conteúdo / recurso foi acionado pelo analisador, o método de carregamento é a tag, mas o status dessa tag torna-se "dinâmico". </font></font><br><br> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabela R. Valores de contexto sob diferentes condições para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">carregar conteúdo / recurso</font></font></b></sup> <br><a name="context_table_R"></a><div class="scrollable-table"><table><tbody><tr><th colspan="3" rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Método de Download </font></font></th><th colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quem causou o download do conteúdo? </font></font></th></tr><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Analisador de Dom </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">próprio. </font><font style="vertical-align: inherit;">Js</font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ext. </font><font style="vertical-align: inherit;">Js</font></font></th></tr><tr><td rowspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup> </td><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Estático </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1. </font><font style="vertical-align: inherit;">Page</font></font></td><td></td><td></td></tr><tr><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dinâmico </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Próprio </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4. </font><font style="vertical-align: inherit;">Page</font></font></td><td></td><td></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Imprópria </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R7. </font><font style="vertical-align: inherit;">Vazio</font></font></td><td></td><td></td></tr><tr><td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Diretamente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RA. </font><font style="vertical-align: inherit;">Referenciador</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB. </font><font style="vertical-align: inherit;">Page</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RC </font><font style="vertical-align: inherit;">Referenciador</font></font></td></tr></tbody></table></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mesma tabela, apenas imagem</font></font></b> <div class="spoiler_text">  <img src="https://habrastorage.org/webt/dl/zi/mn/dlzimnup-7etmrsysxzlxjw1zd8.gif" align="right"></div></div><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[1] Iniciando tag </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[2] Resource tag </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[3] Herdar para páginas próprias, Vazio ao abrir páginas de domínios estrangeiros </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[4] Herdar ao redirecionar servidores para suas páginas, Vazio ao redirecionar para outros domínios ou abrir uma página de fontes externas (consulte . </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clarificação</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></sup> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abreviações</font></font></b> <div class="spoiler_text"> <b>Referrer</b> –     Referrer. <br> <b>Page</b> –   (Tab)      . <br> <b>Empty</b> –  . <br> <b>Domain</b> –  Context     <br> <b>Inherit</b> –  Context     <br> <b>Variant</b> –  Context    «-»   <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Marcas no formato P1..PF, R1..RC serão usadas para se referir à célula correspondente na tabela ao analisar situações específicas. </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">referenciador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">domínio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destacados </font><font style="vertical-align: inherit;">na primeira tabela. </font><font style="vertical-align: inherit;">Você só pode ser autorizado em um site quando você mesmo o abrir em um endereço direto ou por um link de outro site, com o recarregamento subsequente da página por sua própria iniciativa.</font></font></blockquote><br><br><a name="sender_recipient_rules"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.5 Regras para definir os campos Remetente e Destinatário </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remetente é o domínio da página / script / estilo do qual a solicitação vem. </font><font style="vertical-align: inherit;">A página solicita estilos, imagens, scripts. </font><font style="vertical-align: inherit;">Os scripts solicitam conteúdo via ajax. </font><font style="vertical-align: inherit;">Estilos podem carregar outros estilos. </font><font style="vertical-align: inherit;">Estes são os iniciadores da solicitação. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Destinatário é o domínio para o qual a solicitação realmente vai. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para que não restem perguntas, vamos considerar exemplos específicos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que haja um site site.net. </font><font style="vertical-align: inherit;">Na página principal do site é:</font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estilo site.net/css/common.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> os estilos common.css importam estilos de fonts.google.com/fonts/Roboto.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O estilo Roboto.css importa a fonte fonts.google.com/fonts/Roboto.ttf </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagem levando a img.site.net/picture1.jpg </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quadro carregado de adriver.ru/frame </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de adm.site.net/admin.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Deixe no quadro (com adriver.ru) conectar: </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estilo de adriver.ru/style.css </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> foto de img.adriver.ru/img/01.png </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de adriver.ru/libs.js </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script de api.adriver.ru/v1/ad.js </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valores de remetente / destinatário ao carregar recursos com o analisador DOM </font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recurso para download </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valor do Remetente </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Valor do Destinatário </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/css/common.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com/fonts/Roboto.ttf </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonts.google.com </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net/picture1.jpg </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/frame </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/style.css </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru/img/01.png </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> img.adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, vejamos os valores de Remetente / Destinatário ao carregar conteúdo com scripts durante a execução de solicitações de ajax. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valores de remetente / destinatário ao carregar conteúdo com scripts</font></font><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Script executável </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para onde está indo a solicitação? </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Remetente </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Destinatário </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net/admin.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adm.site.net </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> site.net </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/libs.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru/api/ </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adriver.ru </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru/v1/ad.js </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru / ... </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.adriver.ru </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> api.2gis.ru </font></font></td></tr></tbody></table></div><br><br><a name="context_tables_comments"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.6 Detalhes sobre tabelas de definição de contexto </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vamos considerar com mais detalhes quais opções de abertura de páginas (guias no navegador) temos e qual valor de contexto será obtido. </font></font><br><br><a name="P1"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o usuário na página anterior clicou no link ou no botão enviar no formulário. O manipulador de navegador de eventos padrão para o link / formulário redirecionou o usuário para esta página. Situação normal. Transição segura entre páginas de um domínio ou domínios diferentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao alternar para o site.net de outro domínio do google.com, o Contexto será igual ao domínio anterior (google.com). E o usuário no novo domínio site.net não será autorizado (mesmo que a guia vizinha deste site onde o usuário está autorizado esteja aberta). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A transição independente repetida do usuário (sem a assistência de scripts) por meio do link para o mesmo site levará novamente à situação </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas o Contexto já será igual ao domínio site.net, porque pela regra Contexto = Referenciador. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">É feito para proteger contra</font></font><abbr title="Falsificação de solicitação entre sites - &quot;falsificação de solicitação entre sites&quot;"><font style="vertical-align: inherit;"></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ataque </font><abbr title="ross Site Request Forgery — «  »"><font style="vertical-align: inherit;">CSRF</font></abbr><font style="vertical-align: inherit;"> .</font></font><br><br><a name="P5"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o usuário da página anterior clicou no link criado / modificado por um script baixado do domínio da página anterior; </font><font style="vertical-align: inherit;">ou o usuário na página anterior clicou no botão enviar do formulário criado / modificado pelo script (alterando a tag FORM, incluindo seus campos INPUT). </font><font style="vertical-align: inherit;">O manipulador de navegador de eventos padrão para o link / formulário redirecionou o usuário para esta página.</font></font><br><br><a name="P9"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P9</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é igual a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o script era externo ou existe uma função de um script externo na cadeia de chamadas (proteção contra a edição das funções de script do script do site por um script de terceiros).</font></font><br><br><a name="PD"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o usuário abriu a página em um endereço direto. </font><font style="vertical-align: inherit;">Abertura segura.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O usuário deve abrir a página digitando o URL na barra de endereço. </font><font style="vertical-align: inherit;">Ou abra um site a partir dos favoritos do navegador.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao abrir um link a partir de um atalho na área de trabalho de outro programa, qualquer outra situação em que o SO envie um comando ao navegador para abrir o link deve ser considerado um caso de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (a abertura do link é iniciada pelo navegador). Mesmo se o usuário pressionar F5 para recarregar a página, isso deve ser considerado um caso de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Somente se o usuário entrar na barra de endereços e pressionar Enter será considerado pelo navegador como um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso é feito para proteger ataques CSRF de outros programas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seguir o link de outro programa levará o usuário ao site atacado com um token inválido e um Contexto vazio, que será salvo mesmo que o usuário pressione F5 (atualize a página). Você não pode fazer login até que o usuário abra qualquer link para as páginas do site (situação </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, se um invasor de outro programa decidir inserir um link para a página do site site.net que está executando um comando, o usuário autorizado não poderá fazer isso com facilidade. Será necessário forçar o usuário a clicar em outro link nesta página, forçar o usuário a se autenticar lá, e somente então ... Então, o usuário provavelmente estará em outra página do site.net.</font></font><br><br><a name="P2"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - na página anterior de um link ou formulário originalmente colocado na página, um script nativo da página anterior gerava um evento de clique / envio. </font><font style="vertical-align: inherit;">Não havia funções na cadeia de chamadas que pertenciam a scripts externos. </font><font style="vertical-align: inherit;">O navegador redirecionou o usuário para esta página. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a nova página pertencer ao mesmo domínio, o contexto será herdado da página anterior. </font><font style="vertical-align: inherit;">Se a nova página pertencer a um domínio externo, o Contexto ficará em branco.</font></font><br><br><a name="P6"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é o mesmo que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o link / formulário foi criado / modificado por seu próprio script.</font></font><br><br><a name="PA"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é o mesmo que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o link / formulário foi criado / modificado por um script externo.</font></font><br><br><a name="PE"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o script da página anterior provocou a abertura desta página com o comando window.location.href ou window.open (...). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o script da página site.net redirecionar o usuário para a página do mesmo domínio, o campo Contexto será herdado da página geradora. Nesse caso, Context = site.net. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se a página ya.ru foi aberta e o script nos transferiu para maps.ya.ru, o Contexto da nova página já estará vazio. Nas ações subseqüentes do usuário, o Contexto quase sempre permanecerá vazio, o que complicará a autorização do usuário no site. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O protocolo implica que abrir um site de outro é uma operação insegura. Isso protege o usuário contra rastreamento não autorizado por esses sites e contra ataques de CSRF.</font></font><br><br><a name="P3"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o evento de clique / envio foi acionado por um script externo. </font><font style="vertical-align: inherit;">O contexto fica vazio (uma sequência aleatória de bytes é enviada), o que protege sites de terceiros do rastreamento do site (redes de banners).</font></font><br><br><a name="P7"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o link / formulário foi criado / modificado por um script externo.</font></font><br><br><a name="PB"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o link / formulário foi criado / modificado por um script externo.</font></font><br><br><a name="PF"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PF</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas o roteiro provocativo era externo.</font></font><br><br><a name="P4"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o navegador recarregou a página como resultado do processamento da tag &lt;META&gt;. </font><font style="vertical-align: inherit;">A tag estava originalmente na página. </font><font style="vertical-align: inherit;">Redirecionamento legal. </font><font style="vertical-align: inherit;">O contexto persistirá da página original. </font><font style="vertical-align: inherit;">Como é o caso do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="P8"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o navegador recarregou a página como resultado do processamento da tag &lt;META&gt;. </font><font style="vertical-align: inherit;">Mas a tag foi criada / modificada por seu próprio script. </font><font style="vertical-align: inherit;">Isso é válido, mas o contexto persistirá da página original. </font><font style="vertical-align: inherit;">Como é o caso do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Não será possível atrair o token legal do usuário dessa maneira.</font></font><br><br><a name="PC"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - semelhante ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas script externo. </font><font style="vertical-align: inherit;">O site aberto receberá um número aleatório como contexto.</font></font><br><br><a name="PG"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - navegador abre links sob comando no sistema operacional. </font><font style="vertical-align: inherit;">Pode ser que você clique em um link de outro programa, abra um atalho na área de trabalho. </font><font style="vertical-align: inherit;">Este pode ser um comando de outro programa, sem o seu conhecimento. </font><font style="vertical-align: inherit;">Nesse caso, a fonte não é confiável e o campo Contexto permanecerá vazio durante qualquer manipulação do usuário. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso é feito para proteger ataques CSRF de outros programas.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se o próprio navegador abrir as guias salvas anteriormente, o Contexto da página será definido igual ao valor desta página no momento do fechamento do navegador. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Além disso, esta categoria inclui todas as situações em que o navegador é redirecionado pelo servidor para outra página (de seu domínio ou de outra pessoa) como resultado do processamento do cabeçalho HTTP do cabeçalho. </font><font style="vertical-align: inherit;">Se o redirecionamento for para sua própria página, o valor de Contexto será herdado. </font><font style="vertical-align: inherit;">Se o redirecionamento for para o de outra pessoa, ele será redefinido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso é feito para proteger contra o rastreamento de ataques de servidores da web.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A propósito, essa regra pode causar problemas com a implementação atual da autorização entre domínios. </font><font style="vertical-align: inherit;">Se após a autorização, o servidor SSO redirecionar o usuário de volta ao site de destino, o último será anônimo lá.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para impedir que o usuário "perca" a autorização original no site de destino, é necessário transmitir informações de autenticação entre as solicitações do servidor. </font><font style="vertical-align: inherit;">O algoritmo pode ser o seguinte:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o usuário cria e ativa uma chave permanente para o site de destino; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vai do site de destino para o servidor SSO, clicando no link apropriado; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ativa a chave permanente existente do servidor SSO; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Após receber a chave Changed-To, o servidor SSO envia uma solicitação entre servidores para o site de destino; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o usuário clica no botão "Continuar" na página de autorização, que o retorna de volta ao site de destino; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para cumprir a regra </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o site de destino oferece ao usuário que clique no botão de link novamente, levando a ele (por exemplo, para a página inicial de um participante autorizado).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o usuário clica no botão de link, a página é recarregada e o usuário já está autorizado no site de destino. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A descrição do algoritmo parece realmente mais complicada do que sua implementação. </font><font style="vertical-align: inherit;">Uma implementação de interface do usuário pode ter esta aparência:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w5/u1/aa/w5u1aahv-_os9k2d81c819d5zhg.gif"></div><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A reintrodução no site de destino não requer mais autorização do SSO do usuário. </font><font style="vertical-align: inherit;">É o suficiente para ativar a chave permanente.</font></font></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora, vamos examinar mais de perto as opções de carregamento de conteúdo nas páginas e qual valor de contexto será obtido mediante solicitação. </font></font><br><br><a name="R1"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - o recurso é carregado pelo navegador como resultado da análise da página (o navegador encontrou uma etiqueta de recurso). </font><font style="vertical-align: inherit;">O valor de contexto ao gerar uma solicitação para um recurso é obtido na página Contexto que contém a marca do recurso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, se site.net tiver um quadro adriver.ru no qual a imagem de img.disk.com é carregada, ao gerar uma solicitação HTTP para img.disk.com, o navegador utilizará o valor calculado como o Contexto da página site.net.</font></font><br><br><a name="R4"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é o mesmo que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Somente a tag de recurso foi criada / modificada por seu próprio script, como resultado do qual o Analisador DOM do navegador funcionou. Por exemplo, na página site.net/index.html, nosso próprio script site.net/require.js inseriu outro script personalizado (&lt;script src = ...&gt; tag) site.net/min.js, que forçou o navegador a gerar uma solicitação de download de arquivo main.js. O campo Contexto nesta solicitação será definido como o valor calculado para a página site.net.</font></font><br><br><a name="R7"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R7</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é o mesmo que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Porém, como a tag do recurso foi criada / modificada por um script externo, quando o recurso é solicitado, o navegador gera um token com base em um Contexto vazio e uma sequência aleatória de 256 bits. Como resultado, o script externo do invasor evil.com/drop.js, incorporado na página do domínio site.net atacado, tentando atender a uma solicitação ao site.net de destino em nome da vítima falhará, porque o servidor receberá uma solicitação com um token aleatório e não poderá identificar o remetente da solicitação.</font></font><br><br><a name="RA"></a> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> analisador de </font><b><font style="vertical-align: inherit;">RA</font></b><font style="vertical-align: inherit;"> baixa o conteúdo como resultado da análise de outro conteúdo. Por exemplo, a folha de estilo site.net/css/common.css, baixada para a página site.net/index.html, importa a folha de estilo fonts.google.com/fonts/Roboto.css, que força o navegador a solicitar fonts.google .com em nome de Referrer = site.net/css/common.css. O valor do contexto neste caso será igual ao referenciador. Em seguida, o arquivo de estilos Roboto.css importa a fonte Roboto.ttf, que força o navegador a solicitar fonts.google.com/fonts/Roboto.ttf em nome de Referrer = fonts.google.com/fonts/Roboto.css. O valor do contexto será igual a Referrer neste caso, mas é diferente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suponha, hipoteticamente, que o arquivo Roboto.css (recurso externo) não importe uma fonte / estilo, mas tente realizar um ataque CSRF com esta instrução:</font></font><pre><code class="css">@import "https://site.net/api/payment?victim_params"</code> </pre>  esperando atender à solicitação no site.net em nome de um usuário autorizado.  Mas o problema do invasor é que o site.net espera receber um token do usuário: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/18c/ba0/6d3/18cba06d3ab48142219dbf3e3f4e2330.svg" alt="$ T_s ^ 1 = HMAC_k (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  Então, como em uma solicitação CSRF, o navegador criará um token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/466/929/b86/466929b86ade0b848996042a3ac12f25.svg" alt="$ T_s ^ 2 = HMAC_k (fonts.google.com \ cup site.net \ cup fonts.google.com) $" data-tex="display"></p><br>  E uma solicitação para o site virá em nome de um site anônimo que não possui direitos de acesso para executar essas operações. <br><br><a name="RB"></a>  <b>RB</b> - o conteúdo é carregado pelo próprio script do site.  Nesse caso, o contexto é usado para calcular o token de solicitação, que é igual à página que contém o script.  Para o script site.net/1.js da página de contexto site.net, será igual ao contexto da própria página. <br><blockquote>  Observe que o contexto da página em si nem sempre é igual ao nome de domínio da página e depende de como foi aberto originalmente. </blockquote>  Suponha que o site do atacante evil.com abra a página do site atacado site.net, onde o script site.net/util.js executa uma solicitação com parâmetros passados ​​pelo URL da página.  O invasor espera, ao passar "seus parâmetros" pela URL, forçar seu próprio script site.net/util.js a executar uma solicitação ajax para executar ações importantes em nome da vítima. <br><br>  Suponha que o próprio usuário tenha acessado o evil.com por um link direto.  Então o contexto para evil.com será evil.com.  Então, evil.com abre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site.net/api/payment?victim_params</a> com um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">script</a> , na esperança de iniciar um ataque, mas o campo Contexto para site.net estará vazio (caso de PE / PF).  O script site.net/utils.js, executando uma solicitação ajax, forçará o navegador a obter o Contexto da página site.net.  E está vazio conosco.  Mas o site.net receberá uma solicitação ajax com este token: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/866/a41/990/866a41990a710d17dbe34a04ecb2e28c.svg" alt="$ T = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup aleatório) $" data-tex="display"></p><br>  considerando que para um usuário autorizado, é esperado: <br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/025/1b3/fad/0251b3fadaf0e4f1535b6aa8a67df332.svg" alt="$ T_s = HMAC_ {site.ru-key} (site.net \ cup site.net \ cup site.net) $" data-tex="display"></p><br>  site.net verá um token desconhecido e não poderá identificar o usuário.  A proteção funcionou. <br><blockquote>  A propósito, por causa desse esquema, a realização de autorização entre domínios por meio de pop-ups será irrealista. </blockquote>  Para implementar o SSO sob o protocolo, você deve abrir uma nova guia para a página do servidor de autorização.  E, ao mesmo tempo, o usuário deve abrir essa guia.  A melhor opção é abrir ao usuário o link apropriado no site de destino. <br><br><a name="RC"></a>  <b>RC</b> - o conteúdo é carregado com um script de site externo.  Nesse caso, o contexto é usado para calcular o token de solicitação, que é igual ao campo Referenciador de solicitação. <br><br>  Apesar do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RA</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RB</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RC</a> protegerem contra ataques CSRF, eles levam à geração de tokens constantes.  E <b>isso permite implementar a autenticação entre domínios e</b> a <b>autenticação de</b> usuário <b>entre domínios</b> (quando você precisar determinar que várias solicitações para servidores diferentes vieram desse usuário).  O que pode ser implementado para fornecer a ele autoridade igual em um grupo de domínios relacionados. <br><br>  Se a <b>página</b> do <b>site foi aberta automaticamente a</b> partir de outro site, você não poderá fazer login lá, mesmo se você mesmo recarregar o site.  Porque a origem herdará de um valor nulo.  O navegador deve sinalizar para o usuário sobre esse fato (Fonte = Aleatório): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1h/pr/ew/1hprewdwumpuwpzmzkqfmbds104.jpeg"></div><br>  Isso é feito para proteger contra sites que forçam a abertura de outras janelas pop-up (eles mesmos ou seus scripts externos) e, nos sites que abrirem, eles serão reinicializados ou criarão falsos botões "fechar" em toda a tela, levando aos mesmos sites.  I.e.  isso evita uma tentativa de rastrear você, na esperança de obter um token válido. <br><br>  <b>Qualquer tentativa do site de imitar suas ações com um script externo</b> , ou uma tentativa de um script externo de criar direta ou indiretamente uma tag inicial e enviá-la para você, levará a uma Origem vazia e à adição de bytes aleatórios no momento do cálculo do hash do token. <br><br>  O truque para criar ou modificar a tag &lt;script&gt; na página atacada no DOM não ajudará.  O campo Origem permanecerá em branco. <br><br>  Mas, nas mesmas condições, os scripts internos levarão a consultas com o Source igual ao seu valor anterior.  E se a página original tivesse Source = Domain, tudo ficaria bem.  O usuário permanecerá autorizado para tais solicitações. <br><br>  Porém, com scripts baixados de recursos de terceiros (CDN), alguns problemas podem surgir.  E está certo, porque  A integridade do código CDN não é garantida.  Se você não perder a autorização do usuário, mantenha os scripts no seu site e faça o download deles no seu domínio.  Isso é algo como a proibição de usar links http em páginas https. <br><br>  Descrevemos a situação em que um desenvolvedor pode cair.  Como resultado das ações do usuário, seu script redireciona um usuário autorizado para uma das páginas do site (por exemplo, isso é feito por um formulário), exigindo que o usuário permaneça autorizado.  Seu script chama, por exemplo, $ (form) .submit () usando um script jQuery carregado a partir da CDN.  Nesse caso, o navegador vê que na pilha de chamadas que acionou o evento de envio do formulário, há uma função de um script externo.  Para evitar ataques <abbr title="Script entre sites - &quot;script entre sites&quot;">XSS</abbr> / <abbr title="Falsificação de solicitação entre sites - &quot;falsificação de solicitação entre sites&quot;">CSRF</abbr> , o navegador deixa o campo Origem vazio e adiciona bytes aleatórios à geração do token (caso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">P9</a> ).  Como resultado, o usuário na nova página repentinamente se torna não autorizado e não pode concluir a operação.  Isso pode ser confuso para desenvolvedores acostumados a usar CDNs. <br><br><a name="protocol_scenario"></a><h2>  2.7 Cenários de protocolo </h2><br>  Aqui estão os principais cenários prováveis ​​do usuário que trabalha com o site, afetando todas as situações possíveis e os estágios de sua implementação (login anônimo, "lembre-se de mim", "esqueça-me"), passe a usar uma chave permanente, autorização e saída, registro e autenticação de dois fatores, exportação / importação de chaves, substituição de chaves etc.) <br><div class="scrollable-table"><table><tbody><tr><th colspan="3">  1 Fórum, Blog, Wikipedia </th></tr><tr><th>  Usuário </th><th>  Navegador </th><th>  Servidor do site </th></tr><tr><td>  1.1 Primeiro acesso a este site. </td><td>  Gera uma chave aleatória.  Envia um token inseguro de uma chave aleatória. </td><td>  Consideramos o usuário anônimo.  Usamos esse token como o identificador da sessão do usuário. </td></tr><tr><td>  1.2 Visualizar páginas. </td><td>  Envia um token seguro contra uma chave aleatória. </td><td>  Fornece conteúdo público.  Verifica o bit de token de 128 bits mais baixo. </td></tr><tr><td>  1.3 Tentando executar ações (adicionar comentários, etc.) </td><td>  Envia um token seguro contra uma chave aleatória. </td><td>  Informa ao usuário que ele precisa se apresentar ao sistema.  Nesta fase, o site está confiante de que a chave é aleatória. </td></tr><tr><td>  1.4 Diz ao navegador para que o site se lembre dele. </td><td>  Corrige a chave atual.  Envia uma chave permanente.  O token, como antes, é transmitido de forma protegida.  Envia essa chave até receber sucesso do servidor. </td><td>  Agora o site sabe que a chave está corrigida.  Envia CSI-Token-Action: sucesso.  Ele pode aplicar a técnica de memorização do usuário por um longo tempo: ele salva um token no banco de dados para recuperação futura da sessão com o usuário.  Ou mantém a sessão por mais tempo (salve em arquivo). </td></tr><tr><td>  1.5 Executa ações (adicionando postagens, votando etc.) </td><td>  Envia um CSI-Token seguro a partir de uma chave fixa. </td><td>  Registra ações deste usuário. </td></tr><tr><td>  1.6 Fecha a guia do navegador. </td><td>  Nada. </td><td>  Está aguardando as seguintes solicitações do usuário. </td></tr><tr><td>  1.7 Volta ao site. </td><td>  Envia uma chave fixa segura. </td><td>  Continua a trabalhar com o usuário.  Os dados da sessão são obtidos do banco de dados ou arquivo temporário por token. </td></tr><tr><td>  1.8 Desfaz a fixação da chave (esqueça-me neste site) </td><td>  Envia uma chave de logout </td><td>  Exclui dados do usuário no banco de dados, como  era uma chave fixa e o usuário nunca poderá recuperá-la novamente.  Termina a sessão.  O navegador nunca enviará esse token novamente. </td></tr><tr><td>  1.9 Quando você acessa o site pela primeira vez após o Logout. </td><td>  Gera uma chave aleatória.  Envia um token inseguro de uma chave aleatória. </td><td>  Este site já é um novo usuário.  Consideramos o usuário anônimo.  Usamos o token como o identificador da sessão do usuário. </td></tr><tr><td>  1.10 Navegue pelas páginas. </td><td>  Envia um token seguro contra uma chave aleatória. </td><td>  Fornece conteúdo público.  Verifica o bit de token de 128 bits mais baixo. </td></tr><tr><td>  1.11 Fecha a guia do navegador. </td><td>  Nada. </td><td>  Interrompe uma sessão após um tempo limite. </td></tr><tr><td>  1.12 Volta ao site. </td><td>  Gera uma chave aleatória.  Envia um token inseguro de uma chave aleatória. </td><td>  Consideramos o usuário anônimo.  Usamos esse token como o identificador da sessão do usuário. </td></tr><tr><td>  1.13 Cria uma chave de site permanente. </td><td>  Nada. </td></tr><tr><td>  1.14 Ativação da chave permanente. </td><td>  <b>Pergunta ao usuário: você realmente deseja que o site se lembre da sua chave?</b>  <b>Verifique se este site é quem ele afirma ser.</b> <br>  Envia Alterar para.  Somente nesse momento o navegador passa o token para o desprotegido.  Nos seguintes horários, o navegador sempre transmitirá um token protegido no login.  Mas, para isso, o site deve confirmar a alteração de tokens através do CSI-Token-Action: success. </td><td>  Lembre-se do novo token de usuário no banco de dados.  Muda o ID da sessão.  Continua a aguardar solicitações do novo token.  Envia CSI-Token-Action: sucesso. </td></tr><tr><td>  1.15 Executa ações (adicionando postagens, votando etc.) </td><td>  Envia um token seguro de uma chave permanente </td><td>  Registra ações deste usuário.  Verifica o token de 128 bits inferior. </td></tr><tr><td>  1.16 Faz a "Saída". </td><td>  Envia uma chave de logout </td><td>  Interrompe a sessão </td></tr><tr><td>  1.17 Volta ao site. </td><td>  Gera uma chave aleatória.  Envia um token inseguro de uma chave aleatória. </td><td>  Consideramos o usuário anônimo.  Usamos o token como o identificador da sessão do usuário. </td></tr><tr><td>  1.18 Ativação da chave permanente. </td><td>  Envia Alterar para.  O token já está protegido, porque  a última vez que o site nos respondeu CSI-Token-Action: success. </td><td>  Carregamos os dados do usuário salvos no banco de dados.  Muda o ID da sessão.  Trabalhamos com o token salvo.  Sabemos que um token é baseado em uma chave permanente. </td></tr><tr><td>  1.19 Fecha a guia do navegador. </td><td>  Nada.  Ou a tecla Logout, se a opção "saída automática" estiver configurada quando a guia estiver fechada. </td><td>  Interrompe uma sessão após um tempo limite ou após o recebimento de uma chave de Logout. </td></tr><tr><th colspan="3">  2 Loja Online ou Site de Anúncios </th></tr><tr><th>  Usuário </th><th>  Navegador </th><th>  Servidor do site </th></tr><tr><td>  2.1 Incluído pela primeira vez neste site. </td><td>  Gera uma chave aleatória.  Envia um token inseguro de uma chave aleatória. </td><td>  Consideramos o usuário anônimo.  Usamos esse token como o identificador da sessão do usuário. </td></tr><tr><td>  2.2 Visualizar páginas. </td><td>  Envia um token seguro contra uma chave aleatória. </td><td>  Fornece conteúdo público.  Verifica o bit de token de 128 bits mais baixo. </td></tr><tr><td>  2.3 Tentando executar ações (adicionar anúncios, compras, etc.) </td><td>  Envia um token seguro contra uma chave aleatória. </td><td>  Informa ao usuário que ele precisa se apresentar ao sistema.  Nesta fase, o site está confiante de que a chave é aleatória. </td></tr><tr><td>  2.4 Diz ao navegador para fazer o site se lembrar dele. </td><td>  Corrige a chave atual.  Antes da primeira solicitação, ele envia um CSI-Token seguro com a chave Permanente.  Depois de receber sucesso, ele para de enviar essa chave. </td><td>  Agora o site sabe que a chave está corrigida.  Ele pode aplicar a técnica de memorização do usuário por um longo tempo: ele salva um token no banco de dados para recuperação futura da sessão com o usuário.  Ou mantém a sessão por mais tempo (vários dias). </td></tr><tr><td>  2.5 Executa ações (adicionando anúncios, compras, etc.) </td><td>  Envia um CSI-Token seguro a partir de uma chave fixa. </td><td>  Registra ações deste usuário.  Verifica o token. </td></tr><tr><td>  2.6 Fecha a guia do navegador. </td><td>  Nada. </td><td>  Realiza a sessão.  Com inatividade prolongada, ele salva os dados da sessão da RAM em um arquivo ou banco de dados. </td></tr><tr><td>  2.7 Efetua login no site novamente. </td><td>  Envia uma chave fixa segura. </td><td>  A sessão continua.  Trabalhamos com o usuário, como se nada tivesse acontecido. </td></tr><tr><td>  2.8 <b>Cria ou importa uma</b> chave de site persistente. </td><td>  Nada. </td></tr><tr><td>  2.9 Ativação da chave permanente.  Aqui, de fato, há uma transição do uso de uma chave fixa para uma permanente. </td><td>  Envia uma chave de alteração.  O token é transmitido <b>desprotegido</b> para a chave recém-criada e o token não registrado no servidor.  O token é transferido <b>protegido</b> para a chave importada. </td><td>  2.9.A.  Token com base na nova chave. <br>  Se o token antigo foi salvo no banco de dados - basta alterar o token no banco de dados. <br><br>  2.9.V.  Token com base na chave importada. <br>  Se o token antigo foi salvo no banco de dados - exclua-o.  Ao mesclar dois perfis de um usuário (o que você pode perguntar a ele) - porque  de fato, o usuário possui dois tokens armazenados no banco de dados: de uma chave fixa e de uma importada.  Muda o ID da sessão.  Envia CSI-Token-Action: sucesso.  Ele continua aguardando solicitações do novo token. </td></tr><tr><td>  2.10 Executa ações (compras, publicação de anúncios, carrinho de compras, favoritos, revisões, comparações) </td><td>  Envia um token seguro de uma chave permanente </td><td>  Registra ações deste usuário.  Verifica o token de 128 bits inferior. </td></tr><tr><td>  2.11 Fecha a guia do navegador. </td><td>  Nada.  Ou a tecla Logout, se a opção "saída automática" estiver configurada quando a guia estiver fechada. </td><td>  Interrompe uma sessão após um tempo limite ou após o recebimento de uma chave de Logout. </td></tr><tr><th colspan="3">  3 sites com pré-registro obrigatório (rede social) </th></tr><tr><th>  Usuário </th><th>  Navegador </th><th>  Servidor do site </th></tr><tr><td>  3.1 Incluído neste site. </td><td>  Gera uma chave aleatória.  Envia um token inseguro de uma chave aleatória. </td><td>  Consideramos o usuário anônimo.  Usamos esse token como o identificador da sessão do usuário.  Nós deixamos apenas em seções públicas.  Quando você tenta acessar o conteúdo fechado, traduzimos para o formulário de autorização. </td></tr><tr><td>  3.2 Cria uma chave permanente do site </td><td>  Nada </td></tr><tr><td>  3.3 Ativação da chave permanente. </td><td>  <b>Pergunta ao usuário: você realmente deseja que o site se lembre da sua chave?</b>  <b>Verifique se este site é quem ele afirma ser.</b> <br><br>  Envia Alterar para. <br>  <b>O token é transmitido de forma clara</b> . </td><td>  Lembre-se do novo token.  Não temos pressa em salvar no banco de dados até que o registro seja concluído ainda.  Mantemos o usuário no formulário "Registro" até que seja feita a confirmação de propriedade (por telefone, correio).  Envia CSI-Token-Action: registro </td></tr><tr><td>  3.4 Insira seus detalhes de contato. </td><td>  Envia solicitações ajax.  Envia Alterar para.  Token antigo na mesma chave aleatória. <br>  <b>O novo token já está sendo transferido de forma protegida</b> . <br><br>  Assim que obtém sucesso, ele passa a usar um novo token (chave permanente). </td><td>  Verifica os detalhes do contato.  Se tudo der certo, ele envia CSI-Token-Action: success.  Caso contrário: CSI-Token-Action: registro.  Se CSI-Token-Action: abort for enviado, o registro não será bem-sucedido.  O navegador deve voltar a usar um número aleatório (cancelando a entrada).  E relate isso ao usuário. </td></tr><tr><td>  3.5 Vai para a seção fechada do site </td><td>  Envia um token seguro de uma chave permanente. </td><td>  Fornece acesso verificando o token de 128 bits inferior. </td></tr><tr><td>  3.6 Executa ações (compras, publicação de anúncios, carrinho de compras, favoritos, revisões, comparações) </td><td>  Envia um token seguro de uma chave permanente. </td><td>  Registra ações deste usuário.  Verifica o token de 128 bits inferior. </td></tr><tr><td>  3.7 Fecha a guia do navegador. </td><td>  Nada.  Ou a tecla Logout, se a opção "saída automática" estiver configurada quando a guia estiver fechada. </td><td>  Interrompe uma sessão após um tempo limite ou após o recebimento de uma chave de Logout. </td></tr><tr><td>  3.8 Incluído neste site. </td><td>  Gera uma chave aleatória.  Envia um token inseguro de uma chave aleatória. </td><td>  Consideramos o usuário anônimo.  Usamos esse token como o identificador da sessão do usuário.  Nós deixamos apenas em seções públicas.  Quando tentamos acessar o conteúdo fechado, informamos ao usuário que ele é um usuário anônimo. </td></tr><tr><td>  3.9 Ativação da chave permanente. </td><td>  Envia Alterar para.  Ambos os tokens são transmitidos de maneira segura. </td><td>  Carregamos dados do usuário do banco de dados por token (o mais alto de 128 bits).  Agora o site sabe quem é esse usuário. </td></tr><tr><td>  3.10 Altera a chave permanente do domínio (para outra permanente) </td><td>  <b>Pergunta ao usuário: você realmente deseja que o site se lembre da sua nova chave?</b>  <b>Verifique se este site é quem ele afirma ser.</b> <br><br>  Envia Alterar para. <br>  <b>O novo token é transferido de forma clara;</b>  <b>antigo - protegido</b> <br></td><td>  Altera o token no banco de dados para um novo.  Carrega dados do perfil.  Usa um novo token das seguintes solicitações.  Envia CSI-Token-Action: sucesso </td></tr><tr><td>  3.11 Executa ações (adicionando postagens, votando etc.) </td><td>  Envia um token seguro de uma nova chave </td><td>  Registra ações deste usuário.  Verifica o token de 128 bits inferior. </td></tr><tr><td>  3.12 Faz uma "saída". </td><td>  Envia uma chave de logout </td><td>  Interrompe a sessão </td></tr><tr><td>  3.13 Incluído neste site. </td><td>  Gera uma chave aleatória.  Envia um token inseguro de uma chave aleatória. </td><td>  Consideramos o usuário anônimo.  Usamos esse token como o identificador da sessão do usuário.  Traduzimos para o formulário de autorização. </td></tr><tr><td>  3.14 Ativando uma chave permanente </td><td>  Envia Alterar para.  Ambos os tokens são transmitidos de maneira segura. </td><td>  Carregamos dados do usuário do banco de dados por token (o mais alto de 128 bits). </td></tr><tr><td>  3.15 Importa uma chave diferente para este domínio. <br>  <b>Importante: a chave importada deve estar registrada no servidor.</b> <br></td><td>  Envia uma chave Logout Muda para o uso de uma chave aleatória. </td><td>  Interrompe a sessão </td></tr><tr><td>  3.16 Ativa uma nova chave </td><td>  Envia Alterar para. <br>  <b>Ambos os tokens são transmitidos de maneira segura.</b> <br><br>  Observe que a tecla “anterior” já é uma tecla aleatória (consulte 3.15). </td><td>  Essa chave deve ser conhecida pelo banco de dados.  <b>A exportação de chave</b> do navegador é permitida apenas para tokens registrados.  Assim, o navegador tem certeza de que a <b>chave importada é conhecida pelo servidor</b> e a envia segura.  Caso contrário, o servidor não poderá reconhecer o token do usuário e não poderá autorizá-lo. </td></tr><tr><td>  3.17 Executa ações (adicionando postagens, votando etc.) </td><td>  Envia um token seguro de uma nova chave </td><td>  Registra ações deste usuário.  Verifica o token de 128 bits inferior. </td></tr><tr><td>  3.18 sai </td><td>  Envia uma chave de logout </td><td>  Interrompe a sessão </td></tr><tr><th colspan="3">  4 sites com autorização de dois fatores (Sberbank Online) </th></tr><tr><th>  Usuário </th><th>  Navegador </th><th>  Servidor do site </th></tr><tr><td>  4.1 Incluído neste site. </td><td>  Gera uma chave aleatória.  Envia um token inseguro de uma chave aleatória. </td><td>  Consideramos o usuário anônimo.  Usamos esse token como o identificador da sessão do usuário.  Traduzimos para o formulário de autorização. </td></tr><tr><td>  4.2 Cria uma chave permanente do site </td><td>  Nada </td></tr><tr><td>  4.3 Ativação da chave permanente. </td><td>  <b>Pergunta ao usuário: você realmente deseja que o site se lembre da sua chave?</b>  <b>Verifique se este site é quem ele afirma ser.</b> <br><br>  Envia Alterar para. <br>  <b>O token é transmitido de forma clara</b> . </td><td>  O token não é conhecido no site.  Lembre-se do novo token.     .  CSI-Token-Action: registration. </td></tr><tr><td> 4.4     .  «» </td><td>  Change-To      success.       . <br> <b>      .</b> <br></td><td>   .    . </td></tr><tr><td> 4.5      . </td><td>  ajax-.      Change-To. <br><br>    success,      ( ). </td><td>   .      ( ).  CSI-Token-Action: success <br>       . <br>    ,  CSI-Token-Action: registration. <br><br>      CSI-Token-Action: abort.    ,      . </td></tr><tr><td> 4.6    . </td><td>   Token    </td><td>        . </td></tr><tr><td> 4.7  «»   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.8    . </td><td>   .      . </td><td>   .        .          «». </td></tr><tr><td> 4.9   . </td><td>  Change-To. <br> <b>    </b> (..   ;    ). </td><td>        ( 128-).  ,        .      ,   .    .   CSI-Token-Action: success </td></tr><tr><td> 4.10      . </td><td>  ajax-.         . </td><td>  .  .  .       . </td></tr><tr><td> 4.11    . </td><td>   Token   . </td><td>        . </td></tr><tr><td> 4.12  «»   </td><td>   Logout </td><td>   </td></tr><tr><td> 4.12     (). </td><td>    Logout,   «»   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 5  :   ESXi </th></tr><tr><th>  Usuário </th><th>  Navegador </th><th>   </th></tr><tr><td> 5.1    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.2    . </td><td></td><td></td></tr><tr><td> 5.3     ( ,   ).  ,   <i></i> . </td><td></td><td></td></tr><tr><td> 5.4     (SSH, RDP).      (  .htaccess – .  ) </td><td></td><td></td></tr><tr><td> 5.5   </td><td>  </td><td>     </td></tr><tr><td> 5.6    . </td><td>   .      . </td><td>   .        .   . </td></tr><tr><td> 5.7   . </td><td>  Change-To. <br> <b>    </b> (..  ,         ;     <i></i> ). </td><td>        (. ). <br><br>     ( 128-). <br>    128-.     . <br>   CSI-Token-Action: success. <br>   CSI-Token-Action: abort (    ),   403 – Forbidden. <br>     . </td></tr><tr><td> 5.8    </td><td>      . </td><td>        . </td></tr><tr><td> 5.9   </td><td>    Logout,   «»   .  . </td><td>  ,     Logout.   . </td></tr><tr><th colspan="3"> 6  :   </th></tr><tr><th>  Usuário </th><th>  Navegador </th><th>   </th></tr><tr><td> 6.1    . </td><td>   .      . </td><td>   .        . <b>   .</b>   CSI-Support: yes; </td></tr><tr><td> 6.2   . </td><td></td><td></td></tr><tr><td> 6.3   . </td><td> <b> :   ,     ? ,     ,    .</b> <br><br>  Change-To. <br> <b>    </b> . </td><td>  ,   CSI-Token-Action: registration, ..   . </td></tr><tr><td> 6.4  /  « » </td><td>  / POST-  .      Change-To,    . </td><td>  /.    .    .  CSI-Token-Action: success </td></tr><tr><td> 6.5           «» </td><td>     Token    </td><td>    /.  . </td></tr><tr><td> 6.6  </td><td>   Logout </td><td>   </td></tr><tr><td> 6.7    . </td><td>   .      . </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Considera o usuário anônimo. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exibe a mensagem "Acesso negado"</font></font></b> <br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.8 Ativação da chave permanente. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envia Alterar para. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O token é transmitido de forma protegida</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (já que ele é conhecido pelo dispositivo; passamos o registro anteriormente).</font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identifica o usuário pelo token de 128 bits mais alto. </font><font style="vertical-align: inherit;">Verifica bits baixos.</font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.9 Executa ações privilegiadas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envia um token seguro de uma chave permanente </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Executa ações de acordo com os privilégios do usuário. </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.10 Sai </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Envia uma chave de logout </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interrompe a sessão </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Um exemplo de configuração de acesso ao token com base no arquivo .htaccess. </font></font><br><pre> <code class="apache">&lt;Directory "/var/www/html"&gt; AuthType CSI AuthName "Restricted Content" AuthTokensFile /etc/apache2/.csi_keys Require valid-user &lt;/Directory&gt;</code> </pre><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cat /etc/apache2/.csi_keys </font></font></pre><pre> <code class="bash"># # Client Self Identification tokens file # # CSI-Domain-Key UserName Role 84bc3da1b3e33a18e8d5e1bdd7a18d7a166d77ac1b46a1ec38aa35ab7e628ab5 MelnikovIN admin 6d7fce9fee471194aa8b5b6e47267f0348a24b70a0b376535542b996af517398 BoshirovAM user</code> </pre> <br><br><a name="token_algo_for_server"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.7.1 Algoritmo para calcular possíveis tokens de usuário de um site usando uma chave conhecida </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se conhecermos a chave de domínio K, podemos calcular facilmente o possível token "válido" T do usuário que virá com suas solicitações. </font><font style="vertical-align: inherit;">Para isso, é necessário que a condição seja atendida: o iniciador das solicitações, o receptor das solicitações e o contexto de execução devem corresponder e ser iguais ao domínio. </font><font style="vertical-align: inherit;">Em outras palavras, se tivermos o nome de domínio vsphere.local, então:</font></font><br><pre> <code class="plaintext">Sender = Recipient = Context = vsphere.local</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A partir daqui, o token original (bruto) é calculado como: </font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/af8/1c2/5b0/af81c25b054111db5d526fcfb8c4fb8c.svg" alt="$T_s = HMAC_{K}(Sender \cup Recipient \cup Context)$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Após a transmissão, o token original ficará mais protegido. </font><font style="vertical-align: inherit;">Os 128 bits inferiores do token serão hash com o sal passado no cabeçalho da solicitação CSI-Salt </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Assim, o site verá o seguinte token:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/8ea/b59/cc3/8eab59cc3e5060cfec9956f984807b5f.svg" alt="$T = Hi(T_s) \cup HMAC_{salt}( Lo(T_s) )$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Onde </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hi</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é os 128 bits mais altos, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é os 128 bits mais baixos do token original. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geralmente, para consoles de gerenciamento fechados em uma rede corporativa, os consoles da Web não carregam scripts externos, quadros etc. </font><font style="vertical-align: inherit;">Portanto, essa condição será atendida na maioria dos casos.</font></font><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Para o método de formação de sal, consulte a seção </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Procedimento de troca de sal entre o navegador e o servidor".</font></font></a></sup> <br><br><a name="server_token_processing"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.8 Processando tokens no servidor </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enviando um token para o servidor (sem chaves) </font></font></h3><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Status do token T na sessão do site </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ações do servidor do site </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Desconhecido </font></font></td><td>         ,              . <br><br>   .   . <br>   128       . <br>     .      CSI-Salt. <br><br></td></tr><tr><td>  ( 128 ) </td><td>   . <br>      CSI-Salt –   . <br>    .       CSI-Token. <br><br>   ,  CSI-Token-Action: invalid.    400. <br><br>    –  200. <br><br></td></tr></tbody></table></div><br><br><h3>     Permanent </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O navegador bloqueia a chave do cliente. </font><font style="vertical-align: inherit;">O usuário deseja que o site lembre-se do cliente por mais de uma sessão. </font><font style="vertical-align: inherit;">Se o token do usuário deve ser armazenado em seu banco de dados é uma decisão do servidor. </font><font style="vertical-align: inherit;">Retornamos CSI-Token-Action: success ou CSI-Token-Action: abort ao cliente.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enviando um token com uma chave Logout </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indica que o token atual não será mais usado pelo navegador. </font><font style="vertical-align: inherit;">É enviado quando o usuário clica em "Sair" no navegador ou fecha a guia e a opção é configurada (sair automaticamente ao fechar a guia) ou se recusa a usar uma chave fixa ("esqueça-me neste site").</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autologin, a propósito, não deveria ser. </font><font style="vertical-align: inherit;">Por razões de segurança.</font></font></blockquote><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enviando um token com uma chave Change-To </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos chamar o token antigo T, o novo - T '. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMPORTANTE:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> como o novo token T ', o valor real do token é enviado (pela primeira vez, para os não registrados), enquanto o token antigo é enviado com hash (os 128 bits mais baixos).</font></font><br><div class="scrollable-table"><table><tbody><tr><td colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Status do token no banco de dados do servidor </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup> </td><td rowspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ações do servidor do site </font></font></td></tr><tr><td>  T </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> T ' </font></font></td></tr><tr><td>  não </td><td>  não </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Razão: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registro legal do</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usuário. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Altere o identificador da sessão do usuário para T ' </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envie ao cliente CSI-Token-Action: success. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O usuário fez uma chave permanente para o site e realizou o "Login". </font><font style="vertical-align: inherit;">O servidor pode armazenar esse token de lado. </font><font style="vertical-align: inherit;">Antes disso, ofereça-se para preencher o formulário de inscrição (se necessário).</font></font><br><br>    CSI-Token-Action: registration,   ,     (        ).        Change-To (   )   ,     success  abort.   ,  ,     .   –      (  ). <br></td></tr><tr><td>  não </td><td>  </td><td> : <b> Login</b> . <br><br>    T'  .   .   .   CSI-Token-Action: success. <br><br> <b></b> .         Change-To   ,    CSI-Token-Action: success, <b>  </b>    Change-To   <b>  </b> . <br>    ,       .          . <br>  <b>     </b> ,       «» .    <b>      </b> ,       -.  Porque    «  »,    . <br></td></tr><tr><td>  </td><td>  não </td><td> : <b>  </b>   . <br><br>    T     T'.   . <br>   CSI-Token-Action: success. <br></td></tr><tr><td> , <br>  <br>  <br></td><td>  </td><td> : <b>     </b> <br><br>  ,         ,      -.                  -     . <br><br>            (  ).      – . <br><br>   .   CSI-Token-Action: success <br></td></tr><tr><td> , <br>  <br>  <br> . <br></td><td>  </td><td>  .            .   .  CSI-Token-Action: abort.   . <br><br>  256-       SHA-2.      ( )         . <br><br>          : <ul><li>      ; </li><li>         ; </li><li>    </li></ul>      .   , –  -    . <br>     ,      .        Logout   .   Login  .  . <br></td></tr></tbody></table></div><hr> <sup>*        ,    .</sup> <br><br><a name="sub_domain_identify"></a><h2> 2.9 -  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como mencionado anteriormente, os sites podem interagir com outros sites parceiros ou seus subdomínios para fornecer ao usuário algumas das funcionalidades. O exemplo mais comum é quando, no site site.ru, alguns recursos são carregados dos subdomínios img.site.ru, parte do download.site.ru e outra parte de outros. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, o site site.ru precisa ser capaz de informar os domínios de seus parceiros sobre quem exatamente solicitações são feitas. De fato, se você está autorizado no site.ru, isso não o autoriza automaticamente em outros sites, incluindo subdomínios do site. Eles verão outros tokens seus. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos ver como o token é calculado e como isso pode nos ajudar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permita que o usuário efetue login no site.ru com uma chave permanente e tenha um token:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/a5a/e9b/500/a5ae9b500f4fd8f2600eafdb3a315d32.svg" alt="$T_1 = HMAC_{site.ru-key}(site.ru \cup site.ru \cup site.ru)$" data-tex="display"></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Todas as solicitações provenientes da página do site site.ru até o domínio site.ru e causadas por: </font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tags de recursos da página (estática ou dinâmica nativa) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> scripts próprios </font></font></li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terá um token T </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (consulte as regras </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">Essas são solicitações legítimas para site.ru. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora deixe o cliente baixar o arquivo restrito da página site.ru, mas o link leva a download.site.ru. </font><font style="vertical-align: inherit;">Nesse caso, o subdomínio receberá o seguinte token (regras </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/445/897/361/445897361e99df033e11f354f37071af.svg" alt="$T_2 = HMAC_{site.ru-key}(site.ru \cup download.site.ru \cup site.ru)$" data-tex="display"></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exatamente o mesmo token download.site.ru receberá se uma solicitação ajax da página site.ru for executada nele (regras de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro domínio de domínio receberá um token:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/231/d05/899/231d058996ea04e27a4a67dbdadf68ee.svg" alt="$T_3 = HMAC_{site.ru-key}(site.ru \cup domain \cup site.ru)$" data-tex="display"></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Porém, observe que, se as condições para o atendimento de solicitações não forem alteradas, para um determinado pacote de domínios A, B, C, o navegador sempre gerará um token constante. </font><font style="vertical-align: inherit;">Para que possamos realizar a identificação entre domínios. </font><font style="vertical-align: inherit;">Por exemplo, assim. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No site.ru, fazemos solicitações ajax para subdomínios. </font><font style="vertical-align: inherit;">Passamos o ID do identificador! = T1 </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usuário, emitido pelo site.ru. </font><font style="vertical-align: inherit;">Os subdomínios receberão tokens T </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o mesmo usuário </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cada um dos subdomínios criará um monte de seu token com o ID do usuário. </font><font style="vertical-align: inherit;">Os subdomínios já compartilharão informações sobre o ID do usuário e seus direitos com solicitações de servidor para servidor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O grupo é feito uma vez. </font><font style="vertical-align: inherit;">Posteriormente, os subdomínios serão guiados por seus próprios tokens, conforme </font><font style="vertical-align: inherit;">eles também serão permanentes para a chave permanente site.ru.</font></font><br><br><a name="part3"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3 Recomendações de segurança </font></font></h1><br><div class="spoiler">  <b class="spoiler_title">Nota</b> <div class="spoiler_text">      .          . </div></div><br><br><a name="keys_NAA_protection"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.1 Proteção das principais informações contra acesso não autorizado </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O protocolo de autorização proposto protege o usuário contra keyloggers que roubam suas senhas, porque o esquema proposto não usa senhas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Porém, maneiras de proteger chaves de comprometimento devem ser consideradas com mais detalhes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As chaves podem ser comprometidas por:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> copiar informações importantes por malware (acesso remoto) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> acesso direto ao arquivo com as principais informações "offline" (acesso direto) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no momento da distribuição entre dispositivos </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supondo que as principais informações sejam armazenadas em um cartão inteligente (consideramos essa opção na seção </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Mobilidade da conta"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), a tarefa de proteger as principais informações é transferida para o chip. É verdade que existe uma vulnerabilidade aos keyloggers que podem interceptar o código PIN inserido; Bem, inconveniente de usar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Além dos cartões inteligentes, a criptografia simétrica pode ser usada para proteger contra o acesso direto às informações principais. Mas a questão é: qual chave levar para criptografia? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se essa chave é gerada com base na senha do usuário, em primeiro lugar, temos uma vulnerabilidade à seleção da senha “offline” e, em segundo lugar, de fato, do que eles deixaram, chegaram a isso: “novamente algumas senhas”. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma opção mais correta é </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">costurar de maneira especial </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">essa chave no conjunto do navegador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ou em uma de suas bibliotecas especializadas). Cada atualização do navegador altera a chave e sua localização no arquivo compilado. Essa abordagem não dará 100% de garantia de proteção, mas complicará seriamente a tarefa de descriptografia. Primeiro, o invasor precisará descobrir a versão exata da montagem, depois encontrá-la, desmontar e descobrir como a chave é montada.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Além disso, as próprias chaves de domínio devem ser armazenadas diretamente em um arquivo separado e não em conjunto com a configuração para uso (ou seja, apenas as chaves e nada mais). Então, sua descriptografia por seleção de chave (de conjuntos conhecidos) será impossível, porque é impossível distinguir uma chave descriptografada corretamente de uma sequência aleatória de bytes. Em seguida, as tentativas de selecionar uma chave mestra sem conhecer a versão exata do conjunto do navegador e desmontar diretamente seu código serão impossíveis. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você pode usar a opção combinada: criptografia com a chave do navegador + criptografia com a senha do usuário da conta do SO (se a API do SO permitir). Além disso, a chave é sempre gerada em tempo real. Então a força bruta offline se tornará ainda mais cara.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Além disso, depois de alterar a senha do usuário no sistema operacional, a chave também será alterada. </font><font style="vertical-align: inherit;">E se você não descriptografar a chave antiga, isso será protegido contra situações em que o administrador do computador altere sua senha para obter acesso à sua conta e executar ações em seu nome. </font><font style="vertical-align: inherit;">Situações do tipo: largou o emprego. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você primeiro fará uma cópia de backup das chaves (exportará as chaves para um arquivo). </font><font style="vertical-align: inherit;">A menos, é claro, que você já tenha feito isso antes ao distribuir chaves para outros dispositivos.</font></font><br><hr> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Por exemplo, uma chave de 32 bytes é distribuída aleatoriamente na seção 64K de um arquivo executável. </font><font style="vertical-align: inherit;">E apenas o código fonte sabe como coletar a chave estimada desses bytes.</font></font></sup> <br><br><a name="why_password_for_keys_not_good"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.2 Sobre senhas como chaves de domínio </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em uma das versões iniciais do protocolo, a chave do domínio pode ser gerada com base na senha do usuário. O algoritmo foi complicado, excluindo chaves duplicadas para domínios diferentes para a mesma senha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso foi posicionado como uma maneira conveniente de contas de mobilidade. Digite uma senha e não se preocupe com nada. Mas então aconteceu o seguinte:</font></font><br><br><ol><li>     ,     «» ,        ,   .   ,       -,          . <br><br>  (),     8-  ,       ,    .: ~!@#$%^&amp;.   : 26 + 26 + 10 + 8 = 70 . 8-       70 <sup>8</sup> . <br><br> ,     ,         10 <sup>12</sup>   .      70 <sup>8</sup> / 10 <sup>12</sup> = ~576 .  I.e.       ~10 .          5       . 10-      15 .      10 ,      1-2 . <br><br>           ,        . </li><li>       ,     . </li><li>                ,     .  I.e.      (       SHA-2). </li><li>  , ,  ,      .        . </li></ol><br><br><a name="risks_loss_keys"></a><h2> 3.3  /     </h2><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E se eu perder a chave mestra?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Isso pode acontecer se você alterar sua senha ou reinstalar o sistema operacional. Quais são os riscos? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, você não chegará aos sites onde estava antes. Perca seu histórico de compras em lojas on-line, seus anúncios em sites on-line, carma nos fóruns. Isso não importa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, quem impede o procedimento de recadastramento com um novo token e o confirma através do número de telefone indicado no mesmo anúncio? Acontece que o site precisa fazer uma forma de re-registro do token (um análogo de "recuperação de senha")? Onde está a prometida ausência de "todo tipo de formas"? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato, um site que precisa não apenas identificar o visitante, mas também saber quem ele realmente é, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terá que</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faça um formulário de inscrição. </font><font style="vertical-align: inherit;">Na verdade, este formulário pode ser usado para re-registro. </font><font style="vertical-align: inherit;">Você especifica exatamente os mesmos dados de antes (email, celular). </font><font style="vertical-align: inherit;">Confirme se você possui esses dados (carta, SMS). </font><font style="vertical-align: inherit;">O sistema vê que essa conta já existe, os dados são 100% seus, mas o token é diferente - ele reescreve o token. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainda assim, é melhor não perder a chave mestra.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como prevenir a perda? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie uma cópia de backup, proteja-a com uma senha e armazene-a em mídia descartável. </font><font style="vertical-align: inherit;">Além disso, na verdade, como é feito com as chaves do bitcoin. </font><font style="vertical-align: inherit;">Em princípio, você pode converter as chaves mestras em formato impresso e salvá-las em um pedaço de papel. </font><font style="vertical-align: inherit;">Para esse assunto. </font><font style="vertical-align: inherit;">E, em seguida, restaure pela entrada manual. </font><font style="vertical-align: inherit;">Mas isso é para pessoas bastante "paranóicas" como eu.</font></font><br></blockquote><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas e se uma chave mestra for roubada de mim?</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Isso já é sério. Embora as recomendações descritas aqui para armazenar a chave mestra (não incluídas no protocolo) as protejam contra violações diretas, keyloggers e trojans, no entanto, o risco de comprometer a chave mestra permanece. Infelizmente, a proteção perfeita não existe. A chave pode ser invadida diretamente da memória do navegador através de uma vulnerabilidade de mecanismo javascript. Como exemplo. Ou você perde seu telefone celular ... </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Então, quais são os riscos de roubar uma chave mestra?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> É essencial receber informações sobre você e até mesmo agir em seu nome. Obtenção da capacidade de um invasor efetuar login sob você e no modo de leitura para obter acesso a informações confidenciais.</font></font> Calmo e quieto.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou baixe todos os seus vídeos particulares de colegas de uma vez. É desagradável para você. Fãs de selos se alegram. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui você precisa se registrar rapidamente com uma nova chave em sites importantes. E, se algo terrível aconteceu, registrar seu novo token no banco de dados do provedor de serviços de uma maneira oficial é a única opção certa. Você pode pensar em vários métodos de registro: desde a fixação em papel em uma carta oficial até um aplicativo através do serviço de suporte técnico do site, com confirmação de sua identidade de maneiras aceitáveis. Mas isso é apenas para sites sérios, como bancos online.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maneiras de minimizar riscos. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O uso de chaves individuais para domínios (mas isso reduz a mobilidade das contas). </font><font style="vertical-align: inherit;">Autenticação de dois fatores via canais independentes. </font><font style="vertical-align: inherit;">O site mostra os endereços IP e dispositivos de onde a conexão estava da última vez, para que você ao menos note um comprometimento.</font></font><br></blockquote><br><br><a name="part4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4 Ataques ao regime de autorização </font></font></h1><br><br><a name="attack_user_tracking"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.1 Rastreamento de usuário </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um site confiável pode mesclar descaradamente informações sobre você com outros sites. </font><font style="vertical-align: inherit;">Na Internet, existem sites de colecionador que agregam essas informações e as vendem para todos. </font><font style="vertical-align: inherit;">Métricas Yandex, Google Analytics - um site raro fica sem elas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para que dois sites diferentes possam determinar que estão trabalhando com o mesmo cliente, duas técnicas são usadas:</font></font><br><br><ol><li>              (     ,     ). </li><li>       (    )       . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Há uma pequena desvantagem no Esquema 2: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não o usuário é identificado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas o navegador. Mas muitas vezes o navegador == cliente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parece que o token é mais adequado para uso no esquema número 2. Afinal, se o usuário permitir "lembrar-se" de dois sites (atuando como um par), nosso token permanente poderá atuar como uma "impressão digital", não apenas o navegador, mas o próprio usuário. O problema para sites aqui é que eles </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">receberão tokens diferentes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas os sites podem tentar aplicar também o esquema n ° 1. Em seguida, o seguinte será o resultado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Site 1 recebe do código do navegador H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e Site 2 é realizada no contexto de um site 1 - H Código </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Parece que agora os sites podem formar um par (H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , H</font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) e até mesmo passá-lo para algum site agregador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deixe que haja outro site 3, emparelhado com o site 2, tentando rastrear você. </font><font style="vertical-align: inherit;">O site 3 receberá o token H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do navegador </font><font style="vertical-align: inherit;">e o site 2, executado no contexto do site 3, </font><font style="vertical-align: inherit;">receberá o </font><font style="vertical-align: inherit;">token H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 '</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! = H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (veja como os tokens são formados). </font><font style="vertical-align: inherit;">Como resultado, é impossível combinar os dados obtidos, porque </font><font style="vertical-align: inherit;">eles não têm partes sobrepostas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isso não significa que os sites não poderão usar um navegador de impressões digitais para monitorar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ele afirma apenas que o próprio esquema de geração de tokens é bastante confiável e protege contra rastreamento. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Opção de proteção:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saia dos sites com os quais você terminou de trabalhar. </font><font style="vertical-align: inherit;">O navegador pode fazer isso automaticamente quando você fecha a guia.</font></font><br><br><a name="attack_XSS"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.2 Ataque XSS </font></font></h2><br><br> <abbr title="Cross-Site Scripting — « »"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSS</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é um tipo de ataque que envolve a introdução de código malicioso na página do site vítima.com. </font><font style="vertical-align: inherit;">Por exemplo, por meio de um script afiliado ou de uma CDN invadida de uma estrutura popular. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O código malicioso pode usar a autorização do usuário no site para obter acesso autorizado a ele ou roubar dados de autenticação do usuário. </font><font style="vertical-align: inherit;">O código malicioso pode ser inserido em uma página por meio de uma vulnerabilidade em um servidor Web (hacking trivial), por meio de redes afiliadas (fontes não confiáveis), por meio de uma vulnerabilidade no computador do usuário (rastreamento por Trojan). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A principal proteção contra esses ataques para o nosso esquema de autorização são regras especiais para gerar o campo Origem ao calcular tokens. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vulnerabilidade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: para XSS armazenado (quando o script é inserido diretamente no site atacado e carregado a partir dele como resultado da invasão do servidor), a proteção não funciona. </font><font style="vertical-align: inherit;">Porque o navegador não conseguirá identificar um script como "externo". </font><font style="vertical-align: inherit;">O mesmo problema ocorrerá quando um invasor proxies o tráfego cliente-servidor.</font></font><br><br><a name="attack_CSRF"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.3 Ataque do CSRF </font></font></h2><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A vítima visita o site evil.com, criado por um invasor. Em seu nome, uma solicitação (GET / POST / HEAD / PUT / DELETE) é executada em um site em que o usuário já está autorizado (por exemplo, em um servidor do sistema de pagamento). A solicitação em si realiza algum tipo de operação maliciosa (por exemplo, transferência de dinheiro para a conta do invasor). De acordo com a supervisão dos desenvolvedores, o site não verifica os campos do Referer e não solicita informações de verificação adicionais do usuário. Como resultado, o ataque foi bem sucedido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O esquema de autorização de site proposto suprime a maioria dos cenários de ataque </font></font><abbr title="ross Site Request Forgery — «  »"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSRF</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, devido ao algoritmo de geração de token. </font><font style="vertical-align: inherit;">Qualquer solicitação entre sites resultará no site atacado receber um token inválido do usuário. </font><font style="vertical-align: inherit;">Como resultado, nessa situação, o usuário do site atacado será anônimo e anônimo. </font><font style="vertical-align: inherit;">Mesmo uma tentativa de executar uma solicitação GET inofensiva de um site atacante para um atacado (upload de uma foto) resultará no recebimento de um token inválido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso deve simplificar bastante a vida dos desenvolvedores de sites.</font></font><br><br><a name="attack_SSO"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.4 Rastreando usando SSO </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dois sites S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nos quais o usuário confia e possui chaves para eles, decidem aplicar uma tecnologia semelhante ao SSO para rastreamento do usuário. Mas desde você não pode incorporar um site em outro (um deles receberá um token inválido), não pode abrir o site de um parceiro com um script (pelo mesmo motivo) e, em seguida, o site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> decide usar uma técnica complicada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em uma das páginas, ele coloca uma etiqueta translúcida A, cobrindo a janela inteira. O link leva ao site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , e o identificador do usuário (de S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) e o token H </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 são</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transmitidos no endereço </font><font style="vertical-align: inherit;">. O usuário não vê o link. Ao clicar em qualquer área do site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , inicia a abertura de uma nova guia no site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atualmente S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> não recebe um token válido. </font><font style="vertical-align: inherit;">O recarregamento automático com uma tag também não o ajudará</font></font><br><pre> <code class="xml">&lt;meta http-equiv="refresh" content="0"&gt;</code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou script. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas o S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode criar a tag A em toda a página na forma de um botão Fechar falso:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/is/n5/jh/isn5jhlcnubhl580cvv6lgdloye.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esse link primeiro recarrega o site e depois o fecha. </font><font style="vertical-align: inherit;">No momento da reinicialização, o navegador envia o </font><font style="vertical-align: inherit;">token H </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> já válido </font><font style="vertical-align: inherit;">para o site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (porque a regra 2.4 P1 foi seguida: o usuário abriu pessoalmente os dois links). </font><font style="vertical-align: inherit;">Como resultado, S </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> receberá informações sobre as ações de seu usuário no site S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> , associará o token H </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> ao seu H </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> e enviará ao H </font><sub><font style="vertical-align: inherit;">2 uma</font></sub><font style="vertical-align: inherit;"> solicitação entre servidores para S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">No futuro, os sites S </font><sub><font style="vertical-align: inherit;">1</font></sub><font style="vertical-align: inherit;"> e S </font><sub><font style="vertical-align: inherit;">2</font></sub><font style="vertical-align: inherit;"> poderão trocar qualquer informação sobre o usuário por troca de servidor, conforme </font><font style="vertical-align: inherit;">agora eles podem identificá-lo de forma única e mutuamente </font><b><font style="vertical-align: inherit;">separados um do outro</font></b></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os usuários móveis são particularmente vulneráveis ​​a esse ataque, pois </font><font style="vertical-align: inherit;">tentar fechar uma página desnecessária pode clicar acidentalmente em um link falso que ocupa toda a tela do celular.</font></font></blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Método de proteção:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interrompa automaticamente a sessão quando a guia estiver fechada. </font><font style="vertical-align: inherit;">Em seguida, o site S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> não pôde receber um token válido até que o próprio usuário efetuasse login nele. </font><font style="vertical-align: inherit;">É verdade que isso não protege contra situações em que o próprio usuário abriu as guias e efetuou login em S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e S </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">E só então os sites conduziram esse ataque.</font></font><br><br><a name="attack_sso_key_discredit"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.5 Compromisso de chave para SSO </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permita que uma conta de usuário em um servidor de autenticação que suporte SSO seja comprometida. </font><font style="vertical-align: inherit;">Avaliaremos os possíveis riscos com nosso esquema de autenticação. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os tokens para cada site são calculados individualmente com base nas chaves de domínio.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comprometer uma chave de domínio não compromete automaticamente todas as outras.</font></font></b> </blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A maioria dos sites em que você efetuou login anteriormente usando o SSO provavelmente salvará seu token com o seu perfil no servidor SSO no banco de dados. </font><font style="vertical-align: inherit;">Em nosso esquema, o site simplesmente puxa um token do banco de dados e o reconhece.</font></font> I.e.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O servidor SSO não é mais necessário nesses sites - ele executou sua função no estágio de registro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em outras palavras, você não perde automaticamente todos os seus acessos de uma só vez. Um invasor será identificado nos mesmos sites que outra pessoa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma tentativa de reconduzir a autenticação entre domínios também não ajudará o invasor: o site deve bloquear as tentativas de criar uma nova conta com o antigo usuário de ID do SSO e o novo token do site. Ou, tentativas de reescrever o token do usuário para um ID existente no processo SSO devem ser bloqueadas. O fato disso deve causar suspeitas razoáveis ​​no lado do site. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um token de usuário pode ser alterado legalmente de apenas uma maneira (consulte. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Cenários de operação do protocolo”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Risco.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o site não salvar seu token e perfil em seu banco de dados, mas se basear inteiramente no mecanismo SSO, o invasor precisará executar apenas a autenticação entre domínios para efetuar login usando seu nome. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minimização de riscos em caso de comprometimento.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Curiosamente, mas essa é a preservação pelos sites de tokens e perfis de usuário do lado deles. Uma tentativa de um invasor de realizar autenticação entre domínios pode causar um conflito entre o antigo usuário de ID e seu novo token. A situação em si, quando o usuário alterou o token de qualquer outra maneira que não a especificada no protocolo, deve ser percebida com suspeita ou completamente rejeitada. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Risco máximo:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autorização em seu nome em outros sites (onde você não esteve). Acesso aos seus dados de perfil. Cometer atos ilegais em seu nome. E para que o legítimo proprietário não possa retornar nada, um invasor pode alterar seu token no servidor de autorização de maneira legal. Esse risco, no entanto, coincide com os riscos ao usar os esquemas de autorização tradicionais. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maneiras de proteção.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recusa em usar o SSO (especialmente porque o esquema proposto foi concebido como uma maneira de se afastar dos esquemas de autenticação centralizados). Use vários SSOs (não guarde todos os ovos em uma cesta!). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se o SSO suportar autenticação de dois fatores com autenticação por outros atributos (email, telefone), existe a possibilidade de recuperar o controle sobre a conta do servidor de autorização.</font></font><br><br><a name="attack_token_compromise_due_transmit"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.6 Compromisso de token durante a transferência </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">É claro que o mecanismo proposto para os tokens de hash durante a transferência </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não oferece uma garantia de 100% de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sua proteção. </font><font style="vertical-align: inherit;">Um invasor pode interceptar o tráfego da vítima no momento da transferência de um token inseguro (no momento do registro primário da chave permanente), como exemplo. </font><font style="vertical-align: inherit;">E então use-o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, o uso de SSL é incentivado. </font><font style="vertical-align: inherit;">Mas não tome HTTPS como uma panacéia. </font><font style="vertical-align: inherit;">Este protocolo também é exposto, assim como HTTP. </font><font style="vertical-align: inherit;">Só um pouco mais. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">É verdade que uma transferência tão rara de um token aberto, bem como o uso de um token individual para cada domínio, reduz o risco de explorar a vulnerabilidade. </font><font style="vertical-align: inherit;">No entanto.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro perigo é a interceptação e reutilização do token na sessão atual do usuário. </font><font style="vertical-align: inherit;">Como eu disse anteriormente, o ideal é que o token seja hash com um novo sal a cada solicitação do cliente. </font><font style="vertical-align: inherit;">No entanto, isso eliminará a possibilidade de processamento paralelo de solicitações no servidor e impossibilitará o envio de solicitações paralelas do cliente. </font><font style="vertical-align: inherit;">Calcular e verificar hashes geralmente é uma operação cara que reduz o desempenho.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Além disso, o token passado no cabeçalho nunca deve estar disponível no Javascript. </font><font style="vertical-align: inherit;">Semelhante ao Cookie com o sinalizador HttpOnly. </font><font style="vertical-align: inherit;">Mesmo ao receber solicitações de ajax por scripts.</font></font></blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Método de operação:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interceptando a solicitação de um usuário, extraindo o valor atual do token, enviando outra operação com o mesmo token (como em nome do mesmo usuário). </font><font style="vertical-align: inherit;">É verdade que o sistema clássico baseado em cookies de sessão também é vulnerável a esse tipo de ataque. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Método de proteção:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> confirmação de operações significativas através de outros canais de comunicação, por exemplo, via SMS ou correio; </font><font style="vertical-align: inherit;">pré-registro do token por outros canais de comunicação (certificado em papel, como exemplo).</font></font><br><br><a name="attack_token_compromise_due_site_hacking"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.7 Hackeando um site e comprometendo tokens </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sites de hackers ocorrem constantemente. </font><font style="vertical-align: inherit;">Até sites grandes e bem protegidos quebram. </font><font style="vertical-align: inherit;">Existem muitas maneiras de invadir: de uma injeção trivial a um "dreno" interno. </font><font style="vertical-align: inherit;">Portanto, o comprometimento do seu token em qualquer site é um evento muito provável. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas o protocolo proposto, da mesma forma, torna o evento de invasão do site o menos doloroso para você.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O comprometimento do token não leva ao comprometimento da chave do domínio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com base na qual foi calculado. </font><font style="vertical-align: inherit;">Além disso, esse </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">evento não leva ao comprometimento de seus outros tokens</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">E, nesse caso, o acesso a outros sites permanece inacessível.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso é especialmente agradável quando as chaves são feitas para a maioria dos sites usando uma chave mestra: é impossível restaurá-la por engenharia reversa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas, ao mesmo tempo, é impossível usar a chave de domínio cujo token foi comprometido, por razões óbvias. </font><font style="vertical-align: inherit;">Tem que mudar a chave. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A chave do domínio em que ocorreu o vazamento oficial pode ser feita com base em um número aleatório ou com base em uma chave mestra, com a adição de um número de versão:</font></font><br><p></p><p><math></math><img src="https://habrastorage.org/getpro/habr/formulas/b1c/9ee/9ac/b1c9ee9ac9a8f065c9a394045a24edb9.svg" alt="$DomainKey = HMAC_{M_{key}}( DomainName \cup VersionNumber )$" data-tex="display"></p><br><br><a name="epilog"></a><h1>  Conclusão </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vários de meus amigos a quem mostrei o artigo me fizeram essencialmente a mesma pergunta: "Qual é a principal coisa aqui?" </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visto do alto</font></font></b> <div class="spoiler_text">  ,        (     ),     (?)  ,   . <br><br> ,     ,  -  .  ,    ,       ,           .       (   ,   ).    ,        « »      «-». <br><br>  -    « ». <s>  </s>    ,  <s></s> «».     ,    .     (   Google ,  Facebook –       ).     (  DDOS-    . – <abbr title="            "><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a></abbr>  )   - .   ,     SSO       ,        .   ? <br><br>   , , ,       .  ,     -     -.  ,     .,     .     email,  .      .  ,             .    ? <br><br> <b>  -.  ?</b> SSO –    . <br><br> ,        « ».         .      .       .             .   , . <br><br>      -      «»  .    ,    « ».          ,    . <br><br>  -,         ? <br></div></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oh, não há chip principal!</font></font></b>  Infelizmente.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas há vários detalhes que tornam o protocolo mais lucrativo do que o esquema tradicional de login / senha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Você provavelmente notou esse pop-up irritante em muitos sites.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Nosso site salva cookies! </font><font style="vertical-align: inherit;">Coloque o capacete e fique vigilante, porque o irmão mais velho está observando você! </font><font style="vertical-align: inherit;">Clique em "Sim", porque você ainda não tem escolha. "</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este é outro pop-up para muitos outros igualmente intrusivos e muito necessários. </font><font style="vertical-align: inherit;">E tudo isso graças ao GDPR europeu (um análogo da nossa lei de DP). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Então aqui. </font><font style="vertical-align: inherit;">Em nosso esquema, os cookies não são mais necessários para fins de identificação! </font><font style="vertical-align: inherit;">Da palavra "completamente". </font><font style="vertical-align: inherit;">O usuário decide se o site deve ser identificado e quando e por quanto tempo. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menos um pop-up irritante, +1 no karma do protocolo.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. O desenvolvedor não precisa mais executar formulários de autorização e recuperação de senha. </font><font style="vertical-align: inherit;">Não há necessidade de implementar algoritmos SSO complexos e dominar bibliotecas complexas: OAuth, SAML, Kerberos etc., siga o procedimento para registrar seu site, alterar chaves de autorização, monitorar sua segurança; </font><font style="vertical-align: inherit;">e se algo deu errado com o SSO, entenda urgentemente: "o que deu errado e por quê". </font><font style="vertical-align: inherit;">Além disso, o servidor de autorização pode bloquear seu site por razões desconhecidas. </font><font style="vertical-align: inherit;">Vá descobrir isso. </font><font style="vertical-align: inherit;">Ontem tudo funcionou, mas hoje ... E aqui basta ler o token no cabeçalho e verificar se existe algum em nosso banco de dados. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simples = confiável</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apenas dizendo ...</font></font></b> <div class="spoiler_text">      .     .       ,   -  -  .       . .  . <br><br>    -, -,  « »   . <br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. O usuário não precisa inserir e lembrar um monte de senhas. Use os serviços de sites de terceiros ou não se sabe por quem e como os programas são escritos. Você não pode ter medo de acessar um computador por terceiros, keyloggers e cavalos de Tróia. Basta fazer uma cópia de segurança da chave mestra, protegê-la com uma senha e armazená-la em algum lugar em uma unidade flash USB. Como uma carteira de bitcoin. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que não é um recurso?</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4. Se o site for invadido, você não arrisca nada. Bem, gere novamente a chave. Embora a senha vazada para os crackers do site possa causar muitos problemas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. O protocolo foi criado levando em consideração a experiência de ataques de rede conhecidos. Sua arquitetura já inclui proteção básica contra XSS, CSRF. Novamente, os webmasters acharão mais fácil desenvolver sites. E seus usuários - mais calmos.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Independência do protocolo de um provedor de serviços específico e seus caprichos. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O protocolo te liberta.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. Finalmente, o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocolo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proposto </font><b><font style="vertical-align: inherit;">reivindica o futuro padrão aberto</font></b><font style="vertical-align: inherit;"> . E o padrão, se adotado pelos participantes, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impõe obrigações de implementar a funcionalidade de acordo com a especificação</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e de não cercar o farm coletivo de suas próprias decisões de autorização, inventando novamente a forma de login, registro, recuperação de senha e logout. E não mexa com hash de senha ou injeção de SQL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E o mais importante, como qualquer padrão aberto, ele </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode e deve ser verificado</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">especialistas independentes. </font><font style="vertical-align: inherit;">Mesmo que o autor da versão original do protocolo tenha “estragado” os detalhes, a comunidade online pode identificar oportunamente essa correção. </font><font style="vertical-align: inherit;">Bem, ou envie meu protocolo para o recado. </font><font style="vertical-align: inherit;">Infelizmente para mim, e "malvado" para todos os outros.</font></font><br><br><blockquote> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acho que devo parar com isso</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E. Wiles</font></font><br></blockquote><br><br><hr>  <b>PS</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Você pode se familiarizar com a opção de um artigo completo em um formato offline. </font><font style="vertical-align: inherit;">Ao escrever o material em Habr, eu poderia fazer erros de digitação. </font><font style="vertical-align: inherit;">Se você tiver comentários sérios, é melhor verificar o original e deixar comentários no artigo (revisões) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nesse arquivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Envie-me suas alterações no mail sergey201991 [] gmail. </font><font style="vertical-align: inherit;">Não sou polvo, mas tentarei responder. </font><font style="vertical-align: inherit;">Vou adicionar vários comentários correspondentes / interessantes a este artigo. </font><font style="vertical-align: inherit;">Juntamente com as respostas para eles. </font><font style="vertical-align: inherit;">Uma variante de um artigo de comentário separado não é descartada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim, eu sei que o protocolo pode ter problemas:</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não há como fazer login na sua conta no dispositivo de outra pessoa se você não tiver uma chave em mãos, mas precisar dela com urgência; </font><font style="vertical-align: inherit;">senhas são mais convenientes aqui</font></font></li><li>      ;           ,  SSO </li><li>       «», -  : -      (   ) </li><li>    -  </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em relação à página 1 - Eu estava pensando seriamente em voltar à idéia de gerar uma chave de domínio com base em uma senha, protegendo contra a força bruta, complicando o processo de geração da chave: digamos, aumentando o número de rodadas de hash para 1000. Mas o problema com a possível colisão de senhas para diferentes usuários em um O site me assombra. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em relação à página 2 - isso é tratado pelo tempo. </font><font style="vertical-align: inherit;">Você precisa se acostumar com as novas interfaces. </font><font style="vertical-align: inherit;">No início, não ficará claro, depois será simples. </font><font style="vertical-align: inherit;">Dê a um homem dos anos 80 um smartphone moderno, ele também não teria descoberto como gerenciá-lo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muito obrigado se você ler até o final!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt472310/">https://habr.com/ru/post/pt472310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt472296/index.html">Sistema de proteção contra vazamentos para uma máquina de lavar</a></li>
<li><a href="../pt472298/index.html">O resumo de materiais frescos do mundo do front-end da última semana n ° 385 (14 a 20 de outubro de 2019)</a></li>
<li><a href="../pt472300/index.html">Descida de gradiente estocástico (SGD) para a função de perda logarítmica (LogLoss) em um problema de classificação binária</a></li>
<li><a href="../pt472304/index.html">NASA contrata engenheiros para desenvolver robô humanóide de próxima geração</a></li>
<li><a href="../pt472306/index.html">PHP Digest No. 166 (7 a 21 de outubro de 2019)</a></li>
<li><a href="../pt472312/index.html">Experiência na transferência de um projeto Maven para o Jar Multi-Release: já possível, mas ainda difícil</a></li>
<li><a href="../pt472314/index.html">Eu gosto de pessoas de papelão</a></li>
<li><a href="../pt472318/index.html">Rastreamento distribuído no Istio</a></li>
<li><a href="../pt472320/index.html">Entrevista com o Zabbix: 12 respostas francas</a></li>
<li><a href="../pt472326/index.html">Nossa indústria espacial ... E se você olhar para os problemas da indústria da perspectiva de um nerd?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>