<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÖ üçü üçÖ Servidor DHCP + Mysql em Python üßöüèΩ üë©üèø‚Äçü§ù‚Äçüë®üèΩ üçØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O objetivo deste projeto foi: 



- Aprendendo DHCP atrav√©s de uma rede IPv4 
- Aprendendo Python (um pouco mais que do zero;)) 
- substituindo o serv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servidor DHCP + Mysql em Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445338/"><img src="https://habrastorage.org/webt/ju/n4/fb/jun4fbrj-eabxfgou112uxc5lac.png"><br><br>  O objetivo deste projeto foi: <br><br><ul><li>  Aprendendo DHCP atrav√©s de uma rede IPv4 </li><li>  Aprendendo Python (um pouco mais que do zero;)) </li><li>  substituindo o servidor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DB2DHCP</a> (meu fork), o original <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> , que √© cada vez mais dif√≠cil de montar no novo sistema operacional.  Sim, e eu n√£o gosto que o bin√°rio, que n√£o √© poss√≠vel "mudar agora" </li><li>  obten√ß√£o de um servidor DHCP em funcionamento com a capacidade de selecionar o endere√ßo IP do assinante pelo mac do assinante ou um monte de comutadores mac + porta (op√ß√£o 82) </li><li>  escrevendo outra bicicleta (Oh! esse √© meu passatempo favorito) </li><li>  recebendo Lyuli sobre seus estrabismo em Habrahabr (ou melhor, convite);) </li></ul><br>  Resultado: funciona;) Testado no FreeBSD e Ubuntu OS.  Teoricamente, pode ser solicitado que o c√≥digo funcione em qualquer sistema operacional, porque  n√£o h√° liga√ß√µes espec√≠ficas no c√≥digo. <br>  Cuidado  Muito mais longe. <br><a name="habracut"></a><br>  Link para o reposit√≥rio para que os f√£s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"toquem vivos"</a> . <br><br>  O processo de instala√ß√£o, configura√ß√£o e uso do resultado do "estudo do hardware" √© muito mais baixo e, em seguida, um pouco de teoria sobre o protocolo DHCP.  Para mim.  E para a hist√≥ria;) <br><br><h1>  Um pouco de teoria </h1><br><h2>  O que √© DHCP? </h2><br>  Este √© um protocolo de rede que permite que um dispositivo descubra seu endere√ßo IP (bem, outros par√¢metros como um gateway, DNS etc.) de um servidor DHCP.  Pacotes s√£o trocados por UDP.  O princ√≠pio geral de opera√ß√£o do dispositivo ao solicitar par√¢metros de rede √© o seguinte: <br><br><ol><li>  O dispositivo (cliente) envia uma solicita√ß√£o de transmiss√£o UDP (DHCPDISCOVER) pela rede com a solicita√ß√£o "Bem, algu√©m, me d√™ um endere√ßo IP".  E geralmente (mas nem sempre) a solicita√ß√£o √© da porta 68 (origem) e o destino √© a porta 67 (destino).  Alguns dispositivos tamb√©m enviam pacotes da porta 67.  Dentro do pacote DHCPDISCOVER, o endere√ßo MAC do dispositivo cliente est√° inclu√≠do. </li><li>  Todos os servidores DHCP localizados na rede (e podem existir v√°rios) para o dispositivo que enviou a DHCPDISCOVER uma senten√ßa DHCPOFFER com as configura√ß√µes de rede e tamb√©m a transmite pela rede.  A identifica√ß√£o a quem este pacote se destina vai para o endere√ßo MAC do cliente fornecido anteriormente na solicita√ß√£o DHCPDISCOVER. </li><li>  O cliente recebe pacotes com ofertas de configura√ß√µes de rede, seleciona os mais atraentes (os crit√©rios podem ser diferentes, por exemplo, no momento da entrega dos pacotes, no n√∫mero de rotas intermedi√°rias) e faz com que o servidor DHCP ‚Äúsolicite oficialmente‚Äù o DHCPREQUEST com as configura√ß√µes de rede.  Nesse caso, o pacote vai para um servidor DHCP espec√≠fico. </li><li>  O servidor que recebeu DHCPREQUEST envia um pacote DHCPACK no qual lista novamente as configura√ß√µes de rede para este cliente </li></ol><br><img src="https://habrastorage.org/webt/ki/vj/cn/kivjcno-qcqpx8jgqxra1rnspvi.png"><br><br>  Al√©m disso, existem pacotes DHCPINFORM provenientes do cliente, cuja finalidade √© informar ao servidor DHCP que o "cliente est√° ativo" e usa as configura√ß√µes de rede emitidas.  Na implementa√ß√£o deste servidor, esses pacotes s√£o ignorados. <br><br><h2>  Formato de pacote </h2><br><br>  Em geral, o quadro de pacotes Ethernet √© mais ou menos assim: <br><br><img src="https://habrastorage.org/webt/x6/uj/n0/x6ujn0ood0nch96zosj6ldkjt4s.png"><br><br>  No nosso caso, consideraremos apenas os dados diretamente do conte√∫do do pacote UDP, sem os cabe√ßalhos de protocolo da camada OSI, a saber, a estrutura DHCP: <br><br><h3>  DHCPDISCOVER </h3><br>  Portanto, o processo de obten√ß√£o do endere√ßo IP do dispositivo come√ßa com o fato de o cliente DHCP enviar uma solicita√ß√£o de transmiss√£o da porta 68 para 255.255.255.255:67.  Neste pacote, o cliente inclui seu endere√ßo MAC, bem como o que deseja receber do servidor DHCP.  A estrutura do pacote √© descrita na tabela abaixo. <br><br><div class="spoiler">  <b class="spoiler_title">Tabela de estrutura de pacotes DHCPDISCOVER</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Posi√ß√£o do pacote </td><td align="left">  Nome do valor </td><td align="right">  Exemplo </td><td align="center">  Submiss√£o </td><td align="center">  Byte </td><td align="left">  Explica√ß√£o </td></tr><tr><td align="right">  1 </td><td align="left">  Solicita√ß√£o de inicializa√ß√£o </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Tipo de mensagem.  1 - solicita√ß√£o do cliente para o servidor, 2 - resposta do servidor para o cliente </td></tr><tr><td align="right">  2 </td><td align="left">  Tipo de hardware </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Tipo de endere√ßo de hardware, neste protocolo 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Hardware adrees comprimento </td><td align="right">  6 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Comprimento do endere√ßo MAC do dispositivo </td></tr><tr><td align="right">  4 </td><td align="left">  L√∫pulo </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  N√∫mero de rotas intermedi√°rias </td></tr><tr><td align="right">  5 </td><td align="left">  ID da transa√ß√£o </td><td align="right">  23: cf: de: 1d </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Identificador de transa√ß√£o exclusivo.  Gerado pelo cliente no in√≠cio da opera√ß√£o de solicita√ß√£o </td></tr><tr><td align="right">  7 </td><td align="left">  Segundo decorrido </td><td align="right">  0 0 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Tempo em segundos desde o in√≠cio do processo de obten√ß√£o do endere√ßo </td></tr><tr><td align="right">  9 </td><td align="left">  Sinalizadores de Bootp </td><td align="right">  0 0 </td><td align="center">  Hex </td><td align="right">  2 </td><td align="left">  Alguns sinalizadores que podem ser definidos como uma indica√ß√£o dos par√¢metros do protocolo </td></tr><tr><td align="right">  11 </td><td align="left">  Endere√ßo IP do cliente </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do cliente (se houver) </td></tr><tr><td align="right">  15 </td><td align="left">  O endere√ßo IP do seu cliente </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP proposto pelo servidor (se houver) </td></tr><tr><td align="right">  19 </td><td align="left">  Endere√ßo IP do pr√≥ximo servidor </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do servidor (se conhecido) </td></tr><tr><td align="right">  23 </td><td align="left">  Endere√ßo IP do agente de retransmiss√£o </td><td align="right">  172.16.114.41 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do agente de retransmiss√£o (por exemplo, um comutador) </td></tr><tr><td align="right">  27 </td><td align="left">  Endere√ßo MAC do cliente </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Hex </td><td align="right">  6 </td><td align="left">  Endere√ßo MAC do remetente do pacote (cliente) </td></tr><tr><td align="right">  31 </td><td align="left">  Preenchimento de endere√ßo de hardware do cliente </td><td align="right"></td><td align="center">  Hex </td><td align="right">  10 </td><td align="left">  Lugar reservado.  Geralmente zeros </td></tr><tr><td align="right">  41. </td><td align="left">  Nome do host do servidor </td><td align="right"></td><td align="center">  String </td><td align="right">  64 </td><td align="left">  O nome do servidor DHCP.  Geralmente n√£o transmitido </td></tr><tr><td align="right">  105 </td><td align="left">  Nome do arquivo de inicializa√ß√£o </td><td align="right"></td><td align="center">  String </td><td align="right">  128 </td><td align="left">  O nome do arquivo no servidor usado pelas esta√ß√µes sem disco durante a inicializa√ß√£o </td></tr><tr><td align="right">  235 </td><td align="left">  Biscoito m√°gico </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  O n√∫mero "m√°gico", pelo qual incl.  voc√™ pode determinar que este pacote pertence ao protocolo DHCP </td></tr><tr><td colspan="7" align="center">  Op√ß√µes de DHCP.  Pode ir em qualquer ordem </td></tr><tr><td align="right">  236 </td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  53 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  Op√ß√£o 53 que especifica o tipo de pacote DHCP <br><br>  1 - DHCPDISCOVER <br>  3 - DHCPREQUEST <br>  2 - DHCPOFFER <br>  5 - DHCPACK <br>  8 - DHCPINFORM </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  1 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  1 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  50. </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  Qual endere√ßo IP o cliente deseja receber </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  4 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  172.16.134.61 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  55 </td><td align="center"></td><td align="right">  1 </td><td rowspan="3" align="left">  Os par√¢metros de rede solicitados pelo cliente.  A composi√ß√£o pode ser diferente <br><br>  01 - M√°scara de rede <br>  03 - Gateway <br>  06 - DNS <br>  oc - nome do host <br>  0f - nome de dom√≠nio da rede <br>  1c - endere√ßo da solicita√ß√£o de transmiss√£o (Broadcast) <br>  42 - nome do servidor TFTP <br>  79 - Rota est√°tica sem classe </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  8 </td><td align="center"></td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  01: 03: 06: 0c: 0f: 1c: 42: 79 </td><td align="center"></td><td align="right">  8 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  82 </td><td align="center">  Dez </td><td align="left"></td><td rowspan="3" align="left">  Op√ß√£o 82, na qual o endere√ßo MAC do dispositivo repetidor e alguns valores adicionais s√£o transmitidos. <br><br>  Na maioria das vezes, a porta do switch na qual o cliente final do DHCP √© executado. Op√ß√µes adicionais s√£o "incorporadas" nessa op√ß√£o.O primeiro byte √© o n√∫mero da "subop√ß√£o", o segundo √© o comprimento e, em seguida, o valor. <br><br>  Nesse caso, na op√ß√£o 82, as subop√ß√µes s√£o aninhadas: <br>  ID do circuito do agente = 00: 04: 00: 01: 00: 04, em que os dois √∫ltimos bytes s√£o a porta do cliente DHCP da qual a solicita√ß√£o veio <br><br>  ID remoto do agente = 00: 06: c8: be: 19: 93: 11: 48 - endere√ßo MAC do dispositivo de retransmiss√£o DHCP </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  18 </td><td align="center">  Dez </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  01:06 <br>  00: 04: 00: 01: 00: 04 <br>  02:08 <br>  00: 06: c8: be: 19: 93: 11: 48 </td><td align="center">  Hex </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Fim do pacote </td><td align="right">  255 </td><td align="center">  Dez </td><td align="right">  1 </td><td align="left">  255 simboliza o final da embalagem </td></tr></tbody></table><br></div></div><br><h3>  DHCPOFFER </h3><br>  Assim que o servidor recebe o pacote DHCPDISCOVER e se v√™ que ele pode oferecer algo ao cliente solicitado, ent√£o forma uma resposta para ele - DHCPOFFER.  A resposta √© enviada para a porta "de onde veio", Broadcast, porque  neste momento, o cliente ainda n√£o possui um endere√ßo IP; portanto, ele pode receber um pacote apenas se for enviado para difus√£o.  O cliente reconhece que √© um pacote para ele pelo MAC em seu endere√ßo dentro do pacote, bem como o n√∫mero da transa√ß√£o que ele gera no momento da cria√ß√£o do primeiro pacote. <br><br><div class="spoiler">  <b class="spoiler_title">Tabela de estrutura de pacotes DHCPOFFER</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Posi√ß√£o do pacote </td><td align="left">  Nome do valor (comum) </td><td align="right">  Exemplo </td><td align="center">  Submiss√£o </td><td align="center">  Byte </td><td align="left">  Explica√ß√£o </td></tr><tr><td align="right">  1 </td><td align="left">  Solicita√ß√£o de inicializa√ß√£o </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Tipo de mensagem.  1 - solicita√ß√£o do cliente para o servidor, 2 - resposta do servidor para o cliente </td></tr><tr><td align="right">  2 </td><td align="left">  Tipo de hardware </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Tipo de endere√ßo de hardware, neste protocolo 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Hardware adrees comprimento </td><td align="right">  6 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Comprimento do endere√ßo MAC do dispositivo </td></tr><tr><td align="right">  4 </td><td align="left">  L√∫pulo </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  N√∫mero de rotas intermedi√°rias </td></tr><tr><td align="right">  5 </td><td align="left">  ID da transa√ß√£o </td><td align="right">  23: cf: de: 1d </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Identificador de transa√ß√£o exclusivo.  Gerado pelo cliente no in√≠cio da opera√ß√£o de solicita√ß√£o </td></tr><tr><td align="right">  7 </td><td align="left">  Segundo decorrido </td><td align="right">  0 0 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Tempo em segundos desde o in√≠cio do processo de obten√ß√£o do endere√ßo </td></tr><tr><td align="right">  9 </td><td align="left">  Sinalizadores de Bootp </td><td align="right">  0 0 </td><td align="center">  Hex </td><td align="right">  2 </td><td align="left">  Alguns sinalizadores que podem ser definidos como uma indica√ß√£o dos par√¢metros do protocolo.  Nesse caso, 0 significa o tipo de solicita√ß√£o Unicast </td></tr><tr><td align="right">  11 </td><td align="left">  Endere√ßo IP do cliente </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do cliente (se houver) </td></tr><tr><td align="right">  15 </td><td align="left">  O endere√ßo IP do seu cliente </td><td align="right">  172.16.134.61 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP proposto pelo servidor (se houver) </td></tr><tr><td align="right">  19 </td><td align="left">  Endere√ßo IP do pr√≥ximo servidor </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do servidor (se conhecido) </td></tr><tr><td align="right">  23 </td><td align="left">  Endere√ßo IP do agente de retransmiss√£o </td><td align="right">  172.16.114.41 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do agente de retransmiss√£o (por exemplo, um comutador) </td></tr><tr><td align="right">  27 </td><td align="left">  Endere√ßo MAC do cliente </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Hex </td><td align="right">  6 </td><td align="left">  Endere√ßo MAC do remetente do pacote (cliente) </td></tr><tr><td align="right">  31 </td><td align="left">  Preenchimento de endere√ßo de hardware do cliente </td><td align="right"></td><td align="center">  Hex </td><td align="right">  10 </td><td align="left">  Lugar reservado.  Geralmente zeros </td></tr><tr><td align="right">  41. </td><td align="left">  Nome do host do servidor </td><td align="right"></td><td align="center">  String </td><td align="right">  64 </td><td align="left">  O nome do servidor DHCP.  Geralmente n√£o transmitido </td></tr><tr><td align="right">  105 </td><td align="left">  Nome do arquivo de inicializa√ß√£o </td><td align="right"></td><td align="center">  String </td><td align="right">  128 </td><td align="left">  O nome do arquivo no servidor usado pelas esta√ß√µes sem disco durante a inicializa√ß√£o </td></tr><tr><td align="right">  235 </td><td align="left">  Biscoito m√°gico </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  O n√∫mero "m√°gico", pelo qual incl.  voc√™ pode determinar que este pacote pertence ao protocolo DHCP </td></tr><tr><td colspan="6" align="center">  Op√ß√µes de DHCP.  Pode ir em qualquer ordem </td></tr><tr><td align="right">  236 </td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  53 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  Op√ß√£o 53 que especifica o tipo de pacote DHCP 2 - DHCPOFFER </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  1 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  2 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  1 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  Op√ß√£o que oferece m√°scara de rede do cliente DHCP </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  4 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  255.255.224.0 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  3 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  Op√ß√£o que oferece gateway padr√£o do cliente DHCP </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  4 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  172.16.12.1 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  6 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  Op√ß√£o que oferece DHCP ao cliente DNS </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  4 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  8.8.8.8 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  51 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  A vida √∫til dos par√¢metros de rede emitidos em segundos, ap√≥s os quais o cliente DHCP deve solicit√°-los novamente </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  4 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  86400 </td><td align="center">  Dez </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  82 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  A op√ß√£o 82 repete o que veio no DHCPDISCOVER </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  18 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  01: 08: 00: 06: 00 <br>  01: 01: 00: 00: 01 <br>  02: 06: 00: 03: 0f <br>  26: 4d: ec </td><td align="center">  Dez </td><td align="right">  18 </td></tr><tr><td align="left"></td><td align="left">  Fim do pacote </td><td align="right">  255 </td><td align="center">  Dez </td><td align="right">  1 </td><td align="left">  255 simboliza o final da embalagem </td></tr></tbody></table><br></div></div><br><h3>  DHCPREQUEST </h3><br>  Depois que o cliente recebe o DHCPOFFER, ele forma um pacote com uma solicita√ß√£o de par√¢metros de rede, n√£o para todos os servidores DHCP da rede, mas apenas para um espec√≠fico, cuja proposta do DHCPOFFER mais "gostou".  Os crit√©rios para "curtir" podem ser diferentes e dependem da implementa√ß√£o do cliente DHCP.  O destinat√°rio da solicita√ß√£o √© indicado usando o endere√ßo MAC do servidor DHCP.  Al√©m disso, o pacote DHCPREQUEST pode ser enviado pelo cliente sem formar o DHCPDISCOVER anteriormente, se o endere√ßo IP do servidor tiver sido recebido anteriormente anteriormente. <br><br><div class="spoiler">  <b class="spoiler_title">Tabela de estrutura de pacotes DHCPREQUEST</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Posi√ß√£o do pacote </td><td align="left">  Nome do valor (comum) </td><td align="right">  Exemplo </td><td align="center">  Submiss√£o </td><td align="center">  Byte </td><td align="left">  Explica√ß√£o </td></tr><tr><td align="right">  1 </td><td align="left">  Solicita√ß√£o de inicializa√ß√£o </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Tipo de mensagem.  1 - solicita√ß√£o do cliente para o servidor, 2 - resposta do servidor para o cliente </td></tr><tr><td align="right">  2 </td><td align="left">  Tipo de hardware </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Tipo de endere√ßo de hardware, neste protocolo 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Hardware adrees comprimento </td><td align="right">  6 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Comprimento do endere√ßo MAC do dispositivo </td></tr><tr><td align="right">  4 </td><td align="left">  L√∫pulo </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  N√∫mero de rotas intermedi√°rias </td></tr><tr><td align="right">  5 </td><td align="left">  ID da transa√ß√£o </td><td align="right">  23: cf: de: 1d </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Identificador de transa√ß√£o exclusivo.  Gerado pelo cliente no in√≠cio da opera√ß√£o de solicita√ß√£o </td></tr><tr><td align="right">  7 </td><td align="left">  Segundo decorrido </td><td align="right">  0 0 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Tempo em segundos desde o in√≠cio do processo de obten√ß√£o do endere√ßo </td></tr><tr><td align="right">  9 </td><td align="left">  Sinalizadores de Bootp </td><td align="right">  8000 </td><td align="center">  Hex </td><td align="right">  2 </td><td align="left">  Alguns sinalizadores que podem ser definidos como uma indica√ß√£o dos par√¢metros do protocolo.  Nesse caso, "Broadcast" </td></tr><tr><td align="right">  11 </td><td align="left">  Endere√ßo IP do cliente </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do cliente (se houver) </td></tr><tr><td align="right">  15 </td><td align="left">  O endere√ßo IP do seu cliente </td><td align="right">  172.16.134.61 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP proposto pelo servidor (se houver) </td></tr><tr><td align="right">  19 </td><td align="left">  Endere√ßo IP do pr√≥ximo servidor </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do servidor (se conhecido) </td></tr><tr><td align="right">  23 </td><td align="left">  Endere√ßo IP do agente de retransmiss√£o </td><td align="right">  172.16.114.41 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do agente de retransmiss√£o (por exemplo, um comutador) </td></tr><tr><td align="right">  27 </td><td align="left">  Endere√ßo MAC do cliente </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Hex </td><td align="right">  6 </td><td align="left">  Endere√ßo MAC do remetente do pacote (cliente) </td></tr><tr><td align="right">  31 </td><td align="left">  Preenchimento de endere√ßo de hardware do cliente </td><td align="right"></td><td align="center">  Hex </td><td align="right">  10 </td><td align="left">  Lugar reservado.  Geralmente zeros </td></tr><tr><td align="right">  41. </td><td align="left">  Nome do host do servidor </td><td align="right"></td><td align="center">  String </td><td align="right">  64 </td><td align="left">  O nome do servidor DHCP.  Geralmente n√£o transmitido </td></tr><tr><td align="right">  105 </td><td align="left">  Nome do arquivo de inicializa√ß√£o </td><td align="right"></td><td align="center">  String </td><td align="right">  128 </td><td align="left">  O nome do arquivo no servidor usado pelas esta√ß√µes sem disco durante a inicializa√ß√£o </td></tr><tr><td align="right">  235 </td><td align="left">  Biscoito m√°gico </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  O n√∫mero "m√°gico", pelo qual incl.  voc√™ pode determinar que este pacote pertence ao protocolo DHCP </td></tr><tr><td colspan="6" align="center">  Op√ß√µes de DHCP.  Pode ir em qualquer ordem </td></tr><tr><td align="right">  236 </td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  53 </td><td align="center">  Dez </td><td align="right">  3 </td><td rowspan="3" align="left">  Op√ß√£o 53 que especifica o tipo de pacote DHCP 3 - DHCPREQUEST </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  1 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  3 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  61 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  ID do cliente: 01 (para Ehernet) + endere√ßo MAC do cliente </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  7 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  01: 2c: ab: 25: ff: 72: a6 </td><td align="center">  Hex </td><td align="right">  7 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  60 </td><td align="center">  Dez </td><td align="left"></td><td rowspan="3" align="left">  "Identificador da classe do fornecedor."  No meu caso, a vers√£o do cliente DHCP √© relatada.  Talvez outros dispositivos retornem outra coisa.  O Windows, por exemplo, relata o MSFT 5.0 </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  11 </td><td align="center">  Dez </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  udhcp 0.9.8 </td><td align="center">  String </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  55 </td><td align="center"></td><td align="right">  1 </td><td rowspan="3" align="left">  Os par√¢metros de rede solicitados pelo cliente.  A composi√ß√£o pode ser diferente <br><br>  01 - M√°scara de rede <br>  03 - Gateway <br>  06 - DNS <br>  oc - nome do host <br>  0f - nome de dom√≠nio da rede <br>  1c - endere√ßo da solicita√ß√£o de transmiss√£o (Broadcast) <br>  42 - nome do servidor TFTP <br>  79 - Rota est√°tica sem classe </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  8 </td><td align="center"></td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  01: 03: 06: 0c: 0f: 1c: 42: 79 </td><td align="center"></td><td align="right">  8 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  82 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  A op√ß√£o 82 repete o que veio no DHCPDISCOVER </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  18 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  01: 08: 00: 06: 00 <br>  01: 01: 00: 00: 01 <br>  02: 06: 00: 03: 0f <br>  26: 4d: ec </td><td align="center">  Dez </td><td align="right">  18 </td></tr><tr><td align="left"></td><td align="left">  Fim do pacote </td><td align="right">  255 </td><td align="center">  Dez </td><td align="right">  1 </td><td align="left">  255 simboliza o final da embalagem </td></tr></tbody></table><br></div></div><br><h3>  DHCPACK </h3><br>  Como confirma√ß√£o do fato de que "sim, √© o seu endere√ßo IP e eu n√£o o darei a mais ningu√©m" do servidor DHCP, h√° um pacote no formato DHCPACK do servidor para o cliente.  √â o mesmo que o resto dos pacotes enviados transmitidos.  Embora, no c√≥digo abaixo do servidor DHCP implementado em Python, por via das d√∫vidas, duplique qualquer solicita√ß√£o de transmiss√£o enviando um pacote para um IP de cliente espec√≠fico, se ele j√° for conhecido.  Al√©m disso, o servidor DHCP n√£o se importa se o pacote DHCPACK chegou ao cliente.  Se o cliente n√£o receber DHCPACK, depois de um tempo, ele simplesmente repetir√° o DHCPREQUEST <br><br><div class="spoiler">  <b class="spoiler_title">Tabela de estrutura de pacotes DHCPACK</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Posi√ß√£o do pacote </td><td align="left">  Nome do valor (comum) </td><td align="right">  Exemplo </td><td align="center">  Submiss√£o </td><td align="center">  Byte </td><td align="left">  Explica√ß√£o </td></tr><tr><td align="right">  1 </td><td align="left">  Solicita√ß√£o de inicializa√ß√£o </td><td align="right">  2 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Tipo de mensagem.  1 - solicita√ß√£o do cliente para o servidor, 2 - resposta do servidor para o cliente </td></tr><tr><td align="right">  2 </td><td align="left">  Tipo de hardware </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Tipo de endere√ßo de hardware, neste protocolo 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Hardware adrees comprimento </td><td align="right">  6 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Comprimento do endere√ßo MAC do dispositivo </td></tr><tr><td align="right">  4 </td><td align="left">  L√∫pulo </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  N√∫mero de rotas intermedi√°rias </td></tr><tr><td align="right">  5 </td><td align="left">  ID da transa√ß√£o </td><td align="right">  23: cf: de: 1d </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Identificador de transa√ß√£o exclusivo.  Gerado pelo cliente no in√≠cio da opera√ß√£o de solicita√ß√£o </td></tr><tr><td align="right">  7 </td><td align="left">  Segundo decorrido </td><td align="right">  0 0 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Tempo em segundos desde o in√≠cio do processo de obten√ß√£o do endere√ßo </td></tr><tr><td align="right">  9 </td><td align="left">  Sinalizadores de Bootp </td><td align="right">  8000 </td><td align="center">  Hex </td><td align="right">  2 </td><td align="left">  Alguns sinalizadores que podem ser definidos como uma indica√ß√£o dos par√¢metros do protocolo.  Nesse caso, "Broadcast" </td></tr><tr><td align="right">  11 </td><td align="left">  Endere√ßo IP do cliente </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do cliente (se houver) </td></tr><tr><td align="right">  15 </td><td align="left">  O endere√ßo IP do seu cliente </td><td align="right">  172.16.134.61 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP proposto pelo servidor (se houver) </td></tr><tr><td align="right">  19 </td><td align="left">  Endere√ßo IP do pr√≥ximo servidor </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do servidor (se conhecido) </td></tr><tr><td align="right">  23 </td><td align="left">  Endere√ßo IP do agente de retransmiss√£o </td><td align="right">  172.16.114.41 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Endere√ßo IP do agente de retransmiss√£o (por exemplo, um comutador) </td></tr><tr><td align="right">  27 </td><td align="left">  Endere√ßo MAC do cliente </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Hex </td><td align="right">  6 </td><td align="left">  Endere√ßo MAC do remetente do pacote (cliente) </td></tr><tr><td align="right">  31 </td><td align="left">  Preenchimento de endere√ßo de hardware do cliente </td><td align="right"></td><td align="center">  Hex </td><td align="right">  10 </td><td align="left">  Lugar reservado.  Geralmente zeros </td></tr><tr><td align="right">  41. </td><td align="left">  Nome do host do servidor </td><td align="right"></td><td align="center">  String </td><td align="right">  64 </td><td align="left">  O nome do servidor DHCP.  Geralmente n√£o transmitido </td></tr><tr><td align="right">  105 </td><td align="left">  Nome do arquivo de inicializa√ß√£o </td><td align="right"></td><td align="center">  String </td><td align="right">  128 </td><td align="left">  O nome do arquivo no servidor usado pelas esta√ß√µes sem disco durante a inicializa√ß√£o </td></tr><tr><td align="right">  235 </td><td align="left">  Biscoito m√°gico </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  O n√∫mero "m√°gico", pelo qual incl.  voc√™ pode determinar que este pacote pertence ao protocolo DHCP </td></tr><tr><td colspan="6" align="center">  Op√ß√µes de DHCP.  Pode ir em qualquer ordem </td></tr><tr><td align="right">  236 </td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  53 </td><td align="center">  Dez </td><td align="right">  3 </td><td rowspan="3" align="left">  Op√ß√£o 53 especificando pacote DHCP tipo 5 - DHCPACK </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  1 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  5 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  1 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  Op√ß√£o que oferece m√°scara de rede do cliente DHCP </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  4 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  255.255.224.0 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  3 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  Op√ß√£o que oferece gateway padr√£o do cliente DHCP </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  4 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  172.16.12.1 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  6 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  Op√ß√£o que oferece DHCP ao cliente DNS </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  4 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  8.8.8.8 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  51 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  A vida √∫til dos par√¢metros de rede emitidos em segundos, ap√≥s os quais o cliente DHCP deve solicit√°-los novamente </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  4 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  86400 </td><td align="center">  Dez </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  N√∫mero da op√ß√£o </td><td align="right">  82 </td><td align="center">  Dez </td><td align="right">  1 </td><td rowspan="3" align="left">  A op√ß√£o 82 repete o que veio no DHCPDISCOVER </td></tr><tr><td align="left"></td><td align="left">  Comprimento da op√ß√£o </td><td align="right">  18 </td><td align="center">  Dez </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor da op√ß√£o </td><td align="right">  01: 08: 00: 06: 00 <br>  01: 01: 00: 00: 01 <br>  02: 06: 00: 03: 0f <br>  26: 4d: ec </td><td align="center">  Dez </td><td align="right">  18 </td></tr><tr><td align="left"></td><td align="left">  Fim do pacote </td><td align="right">  255 </td><td align="center">  Dez </td><td align="right">  1 </td><td align="left">  255 simboliza o final da embalagem </td></tr></tbody></table><br></div></div><br><br><h1>  Instala√ß√£o </h1><br>  A instala√ß√£o consiste na instala√ß√£o dos m√≥dulos python necess√°rios para o trabalho.  Sup√µe-se que o MySQL j√° esteja instalado e configurado. <br><br><h2>  Freebsd </h2><br><pre>  pkg install python3
 python3 -m surepip
 instalar o pip3 mysql-connector </pre><br><h2>  Ubuntu </h2><br><pre>  sudo apt-get install python3
 sudo apt-get install pip3
 sudo pip3 instala o mysql-connector </pre><br>  Criamos o banco de dados MySQL, preenchemos o dump pydhcp.sql, configuramos o arquivo de configura√ß√£o. <br><br><h1>  Configura√ß√£o </h1><br>  Todas as configura√ß√µes do servidor est√£o no formato de arquivo xml.  Arquivo de refer√™ncia: <br><br><pre>  &lt;? xml version = "1.0"?&gt;
 &lt;config&gt;
     &lt;dhcpserver&gt;
	 &lt;host&gt; 0.0.0.0 &lt;/host&gt;
         &lt;broadcast&gt; 255.255.255.255 &lt;/broadcast&gt;
         &lt;DHCPServer&gt; 192.168.0.71 &lt;/DHCPServer&gt;
	 &lt;LeaseTime&gt; 8600 &lt;/LeaseTime&gt;
	 &lt;ThreadLimit&gt; 1 &lt;/ThreadLimit&gt;
         &lt;defaultMask&gt; 255.255.255.0 &lt;/defaultMask&gt;
         &lt;defaultRouter&gt; 192.168.0.1 &lt;/defaultRouter&gt;
         &lt;defaultDNS&gt; 8.8.8.8 &lt;/defaultDNS&gt;
     &lt;/dhcpserver&gt;
     &lt;mysql&gt;
         &lt;host&gt; localhost &lt;/host&gt;
	 &lt;username&gt; test &lt;/username&gt;
	 &lt;senha&gt; teste &lt;/senha&gt;
	 &lt;basename&gt; pydhcp &lt;/basename&gt;
     &lt;/mysql&gt;
     &lt;op√ß√µes&gt;
        &lt;op√ß√£o&gt; option_82_hex: sw_port1: 20:22 &lt;/option&gt;       
        &lt;op√ß√£o&gt; option_82_hex: sw_port2: 16:18 &lt;/option&gt;       
        &lt;op√ß√£o&gt; option_82_hex: sw_mac: 26: 40 &lt;/option&gt;
     &lt;/options&gt;    
     &lt;query&gt;
         &lt;offer_count&gt; 3 &lt;/offer_count&gt;
	 &lt;offer_1&gt; selecione IP, m√°scara, roteador, DNS dos usu√°rios em que superior (mac) = superior ('{option_82_AgentRemoteId_hex}') e superior (porta) = superior ('{option_82_AgentCircuitId_port_hex}') &lt;/offer_1&gt;
         &lt;offer_2&gt; selecione ip, mascara, roteador, dns dos usu√°rios onde superior (mac) = superior ('{sw_mac}') e superior (porta) = superior ('{sw_port2}') &lt;/offer_2&gt;
         &lt;offer_3&gt; selecione ip, mask, router, dns dos usu√°rios em que upper (mac) = upper ('{ClientMacAddress}') &lt;/offer_3&gt;
	 &lt;history_sql&gt; insere no hist√≥rico (id, dt, mac, ip, comment) valores (null, now (), '{ClientMacAddress}', '{RequestedIpAddress}', 'DHCPACK / INFORM') &lt;/history_sql&gt;
     &lt;/query&gt;
 &lt;/config&gt; </pre><br>  Agora com mais detalhes nas tags: <br><br>  A se√ß√£o dhcpserver descreve as configura√ß√µes b√°sicas para iniciar o servidor, a saber: <br><ul><li>  host - qual endere√ßo IP o servidor est√° escutando na porta 67 </li><li>  broadcast - qual ip √© um Broadcast para DHCPOFFER e DHCPACK </li><li>  DHCPServer - qual √© o ip do servidor DHCP </li><li>  Hora de concess√£o do endere√ßo IP emitido </li><li>  ThreadLimit - quantos threads est√£o executando simultaneamente para processar pacotes UDP de entrada na porta 67. Sup√µe-se que isso ajude em projetos altamente carregados;) </li><li>  defaultMask, defaultRouter, defaultDNS - o que √© oferecido ao assinante por padr√£o se o IP for encontrado no banco de dados, mas nenhum par√¢metro adicional for especificado para ele </li></ul><br>  Se√ß√£o Mysql: <br><br>  host, nome de usu√°rio, senha, nome de base - tudo fala por si.  Estrutura de banco de dados de amostra postada no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> <br><br>  Se√ß√£o de consulta: Esta se√ß√£o descreve os pedidos de OFERTA / ACK: <br><br><ul><li>  offer_count - o n√∫mero de linhas com solicita√ß√µes que retornam um resultado do formul√°rio ip, mask, router, dns </li><li>  offer_n √© a string de consulta.  Se o retorno estiver vazio, a seguinte solicita√ß√£o de oferta ser√° executada </li><li>  history_sql - solicita√ß√£o de grava√ß√£o, por exemplo, no "hist√≥rico de autoriza√ß√£o" do assinante </li></ul><br>  Quaisquer vari√°veis ‚Äã‚Äãda se√ß√£o de op√ß√µes ou op√ß√µes do protocolo DHCP podem participar de solicita√ß√µes. <br><br>  Op√ß√µes de se√ß√£o.  Aqui j√° √© mais interessante.  Aqui, podemos criar vari√°veis ‚Äã‚Äãque podemos usar posteriormente na se√ß√£o de consulta. <br><br>  Por exemplo: <br><br><pre><code class="plaintext hljs">option_82_hex:sw_port1:20:22</code> </pre> <br>  , esta linha √© o comando para pegar toda a linha que veio na solicita√ß√£o DHCP da op√ß√£o 82, em formato hexadecimal, no intervalo de 20 a 22 bytes, inclusive, e coloc√°-la na nova vari√°vel sw_port1 (a porta do switch de onde a solicita√ß√£o veio) <br><br><pre> <code class="plaintext hljs">option_82_hex:sw_mac:26:40</code> </pre> <br>  , defina a vari√°vel sw_mac, usando hexadecimal do intervalo 26:40 <br><br>  Voc√™ pode ver todas as op√ß√µes poss√≠veis que podem ser usadas nas consultas iniciando o servidor com a op√ß√£o -d.  Veremos algo como este log: <br><br><pre>  - o pacote DHCPINFORM veio na porta 67, de 0025224ad764, b '\ x91 \ xa5 \ xe0 \ xa3 \ xa5 \ xa9- \ x8f \ x8a', ('172.30.114.25', 68)
 {'ClientMacAddress': '0025224ad764',
  'ClientMacAddressByte': b '\ x00% "J \ xd7d',
  'HType': 'Ethernet',
  'HostName': b '\ x91 \ xa5 \ xe0 \ xa3 \ xa5 \ xa9- \ x8f \ x8a',
  'ReqListDNS': True,
  'ReqListDomainName': True,
  'ReqListPerfowmRouterDiscover': True,
  'ReqListRouter': True,
  'ReqListStaticRoute': True,
  'ReqListSubnetMask': True,
  'ReqListVendorSpecInfo': 43,
  'RequestedIpAddress': '0.0.0.0',
  'Fornecedor': b'MSFT 5.0 ',
  'chaddr': '0025224ad764',
  ¬´ciaddr¬ª: ¬´172.30.128.13¬ª,
  'sinalizadores': b '\ x00 \ x00',
  ¬´giaddr¬ª: ¬´172.30.114.25¬ª,
  ¬´gpoz¬ª: 308,
  ¬´hlen¬ª: 6,
  ¬´l√∫pulo¬ª: 1,
  'htype': 'MAC',
  'magic_cookie': b'c \ x82Sc ',
  'op': 'DHCPINFORM',
  'op√ß√£o12': 12,
  ¬´op√ß√£o53¬ª: 53,
  ¬´op√ß√£o55¬ª: 55,
  ¬´op√ß√£o60¬ª: 60,
  ¬´op√ß√£o61¬ª: 61,
  ¬´op√ß√£o82¬ª: 82,
  'op√ß√£o_82_byte': b '\ x12 \ x01 \ x06 \ x00 \ x04 \ x00 \ x01 \ x00 \ x06 \ x02 \ x08 \ x00'
                    b '\ x06 \ x00 \ x1eX \ x9e \ xb2 \ xad',
  'option_82_hex': '12010600040001000602080006001e589eb2ad',
  'option_82_len': 18,
  'option_82_str': "b '\\ x12 \\ x01 \\ x06 \\ x00 \\ x04 \\ x00 \\ x01 \\ x00 \\ x06 \\ x02 \\ x08 \\ x00 \\ x06 \\ x00 \ \ x1eX \\ x9e \\ xb2 \\ xad '",
  'resultado': falso,
  ¬´secs¬ª: 768,
  'siaddr': '0.0.0.0',
  'sw_mac': '001e589eb2ad',
  'sw_port1': '06',
  'xidbyte': b '&lt;\ x89} \ x8c',
  'xidhex': '3c897d8c',
  'yiaddr': '0.0.0.0'} </pre><br>  Assim, podemos agrupar qualquer vari√°vel em {} e ela ser√° usada na consulta SQL. <br><br>  Vamos capturar para o hist√≥rico que o cliente recebeu o endere√ßo IP: <br><br><img src="https://habrastorage.org/webt/mc/le/bu/mclebuj5du2u4mjtlaf9-a2ibo0.png"><br><br><img src="https://habrastorage.org/webt/eo/1q/lt/eo1qltnt_1ewtf0uwkenwywme3m.png"><br><br><h1>  In√≠cio do servidor </h1><br>  ./pydhcpdb.py -d -c config.xml <br><br>  - d modo de sa√≠da para o console DEBUG <br>  - c &lt;file_name&gt; arquivo de configura√ß√£o <br><br><h1>  Debriefing </h1><br>  E agora mais sobre a implementa√ß√£o do servidor em Python.  Isso √© uma dor.  Python foi estudado em tempo real.  Muitos momentos s√£o feitos no estilo de: "uau, de alguma maneira eu fiz o que funciona".  N√£o √© otimizado e √© deixado nessa forma principalmente devido √† pequena experi√™ncia de desenvolvimento em python.  Vou abordar os momentos mais interessantes da implementa√ß√£o do servidor no "c√≥digo". <br><br><h2>  Analisador de arquivo de configura√ß√£o XML </h2><br>  O m√≥dulo Python padr√£o xml.dom √© usado.  Parece ser simples, mas durante a implementa√ß√£o houve uma not√°vel falta de documenta√ß√£o e exemplos sensatos na rede usando este m√≥dulo. <br><br><pre>  √°rvore = minidom.parse (gconfig ["config_file"])
     mconfig = tree.getElementsByTagName ("mysql")
     para elem no mconfig:        
         gconfig ["mysql_host"] = elem.getElementsByTagName ("host") [0] .firstChild.data      
         gconfig ["mysql_username"] = elem.getElementsByTagName ("nome de usu√°rio") [0] .firstChild.data      
         gconfig ["mysql_password"] = elem.getElementsByTagName ("senha") [0] .firstChild.data      
         gconfig ["mysql_basename"] = elem.getElementsByTagName ("basename") [0] .firstChild.data      
     dconfig = tree.getElementsByTagName ("dhcpserver")
     para elem no dconfig:        
         gconfig ["broadcast"] = elem.getElementsByTagName ("broadcast") [0] .firstChild.data      
         gconfig ["dhcp_host"] = elem.getElementsByTagName ("host") [0] .firstChild.data      
         gconfig ["dhcp_LeaseTime"] = elem.getElementsByTagName ("LeaseTime") [0] .firstChild.data      
         gconfig ["dhcp_ThreadLimit"] = int (elem.getElementsByTagName ("ThreadLimit") [0] .firstChild.data)              
         gconfig ["dhcp_Server"] = elem.getElementsByTagName ("DHCPServer") [0] .firstChild.data              
         gconfig ["dhcp_defaultMask"] = elem.getElementsByTagName ("defaultMask") [0] .firstChild.data              
         gconfig ["dhcp_defaultRouter"] = elem.getElementsByTagName ("defaultRouter") [0] .firstChild.data              
         gconfig ["dhcp_defaultDNS"] = elem.getElementsByTagName ("defaultDNS") [0] .firstChild.data              
     qconfig = tree.getElementsByTagName ("query")
     para elem no qconfig:  
         gconfig ["offer_count"] = elem.getElementsByTagName ("offer_count") [0] .firstChild.data                          
         para num no intervalo (int (gconfig ["offer_count"])):
             gconfig ["oferta _" + str (num + 1)] = elem.getElementsByTagName ("oferta _" + str (num + 1)) [0] .firstChild.data      
         gconfig ["history_sql"] = elem.getElementsByTagName ("history_sql") [0] .firstChild.data                          
     options = tree.getElementsByTagName ("op√ß√µes")       
     para elem nas op√ß√µes:          
         node = elem.getElementsByTagName ("op√ß√£o")
         para op√ß√µes no n√≥:
             optionsMod.append (options.firstChild.data) </pre><br><h2>  Multithreading </h2><br>  Curiosamente, o multithreading no Python √© implementado de maneira muito clara e simples. <br><br><pre>  def PacketWork (dados, endere√ßo): 
 ...
 # implementa√ß√£o da an√°lise do pacote recebido e a resposta a ele
 ...


 enquanto True:
     data, addr = udp_socket.recvfrom (1024) # aguarde o pacote UDP
     thread = threading.Thread (target = PacketWork, args = (dados, endere√ßo,)). start () # como veio - execute a fun√ß√£o PacketWork definida anteriormente no fundo com par√¢metros
     enquanto threading.active_count ()&gt; gconfig ["dhcp_ThreadLimit"]:
        time.sleep (1) # se o n√∫mero de threads j√° em execu√ß√£o for maior que nas configura√ß√µes, aguarde at√© que se tornem menos </pre><br><br><h2>  Receber / enviar pacote DHCP </h2><br>  Para interceptar pacotes UDP vindos da placa de rede, voc√™ precisa "aumentar" o soquete: <br><pre>  udp_socket = socket.socket (socket.AF_INET, socket.SOCK_DGRAM, socket.IPPROTO_UDP)
 udp_socket.bind ((gconfig ["dhcp_host"], 67)) </pre><br>  onde as bandeiras est√£o: <br><br><ul><li>  AF_INET - significa que o formato do endere√ßo ser√° IP: port.  Talvez AF_UNIX - onde o endere√ßo √© dado pelo nome do arquivo. </li><li>  SOCK_DGRAM - significa que estamos aceitando n√£o um "pacote bruto", mas j√° passamos por um firewall e com pacote parcialmente cortado.  I.e.  obtemos apenas o pacote UDP sem o componente "f√≠sico" do wrapper de pacote UDP.  Se voc√™ usar o sinalizador SOCK_RAW, ainda precisar√° analisar esse "wrapper". </li></ul><br>  O envio de um pacote pode ser como um Broadcast: <br><br><pre>  udp_socket.setsockopt (socket.SOL_SOCKET, socket.SO_BROADCAST, 1) # alterna o soquete para o modo Broadcast
                     rz = udp_socket.sendto (pacote de pacote, (gconfig ["broadcast"], 68)) </pre><br>  e para o endere√ßo "de onde veio o pacote": <br><pre>  udp_socket.setsockopt (socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) # alterne o soquete para o modo "muitos ouvintes"
                         rz = udp_socket.sendto (pacote, endere√ßo) </pre><br>  em que SOL_SOCKET significa "n√≠vel de protocolo" para definir op√ß√µes, <br><br>  A op√ß√£o SO_BROADCAST √© que o pacote de capacete Broadcast <br><br>  A op√ß√£o SO_REUSEADDR alterna o soquete para o modo de ouvinte m√∫ltiplo.  Em teoria, √© desnecess√°rio neste caso, mas em um dos servidores FreeBSD em que testei, o c√≥digo n√£o funcionou sem essa op√ß√£o. <br><br><h2>  An√°lise de pacotes DHCP </h2><br>  √â aqui que eu realmente gostei de Python.  Acontece que a "caixa" permite que voc√™ lide facilmente com o bytecode.  Permitindo que seja muito simples traduzir para valores decimais, seq√º√™ncias de caracteres e hexadecimal - ou seja,  o que realmente precisamos entender a estrutura do pacote.  Por exemplo, voc√™ pode obter um intervalo de bytes em HEX e apenas bytes: <br><br><pre>  res ["xidhex"] = dados [4: 8] .hex ()
     res ["xidbyte"] = dados [4: 8] </pre><br>  , compactar bytes em uma estrutura: <br><br><pre>  res ["flags"] = pacote ('BB', dados [10], dados [11]) </pre><br>  Obter IP da estrutura: <br><br><pre>  res ["ciaddr"] = socket.inet_ntoa (pacote ('BBBB', dados [12], dados [13], dados [14], dados [15])); </pre><br><br>  E vice-versa: <br><br><pre>  res = res + socket.inet_pton (socket.AF_INET, gconfig ["dhcp_Server"]) </pre><br>  Isso √© tudo;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt445338/">https://habr.com/ru/post/pt445338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt445326/index.html">Automa√ß√£o implac√°vel. Corte do Diretor</a></li>
<li><a href="../pt445328/index.html">Repensando a rob√≥tica infantil</a></li>
<li><a href="../pt445330/index.html">Criptografia em Java. Classe de assinatura</a></li>
<li><a href="../pt445334/index.html">Temos DevOps. Vamos demitir todos os testadores</a></li>
<li><a href="../pt445336/index.html">FlexiRemap¬Æ vs RAID</a></li>
<li><a href="../pt445340/index.html">Aumente a seguran√ßa da rede usando um analisador de nuvem</a></li>
<li><a href="../pt445344/index.html">Plataforma de comunica√ß√µes unificadas OpenVox</a></li>
<li><a href="../pt445346/index.html">Como escrever uma API incorreta</a></li>
<li><a href="../pt445348/index.html">SNA Hackathon 2019: Simplifique a Arquitetura - Simplifique os Recursos</a></li>
<li><a href="../pt445350/index.html">Sonata - servidor de provisionamento SIP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>