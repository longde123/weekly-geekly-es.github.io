<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçò üçõ ‚ñ™Ô∏è Wie verwende ich PHP zur Implementierung von Microservices? üèØ üî¥ üí™üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Warum sollte √ºber Service Governance gesprochen werden? 


 Mit der zunehmenden Popularit√§t des Internets ist die traditionelle MVC-Architektur immer ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie verwende ich PHP zur Implementierung von Microservices?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460855/"><p><img src="https://habrastorage.org/getpro/habr/post_images/287/fa2/ee0/287fa2ee0642f5411410b78c86702e82.jpg" alt="Swoft"></p><br><h3 id="why-should-talk-service-governance">  Warum sollte √ºber Service Governance gesprochen werden? </h3><br><p>  Mit der zunehmenden Popularit√§t des Internets ist die traditionelle MVC-Architektur immer aufgebl√§hter und sehr schwierig zu warten, da der Umfang der Anwendungen weiter zunimmt. </p><br><p>  Wir m√ºssen Ma√ünahmen ergreifen, um ein gro√ües System gem√§√ü den Gesch√§ftsmerkmalen in mehrere Anwendungen aufzuteilen.  Beispielsweise kann ein gro√ües E-Commerce-System ein Benutzersystem, ein Produktsystem, ein Bestellsystem, ein Bewertungssystem usw. umfassen, und wir k√∂nnen sie in mehrere einzelne Anwendungen aufteilen.  Die Merkmale einer Architektur mit mehreren Anwendungen sind Anwendungen, die unabh√§ngig voneinander ausgef√ºhrt werden und sich nicht gegenseitig aufrufen k√∂nnen. </p><a name="habracut"></a><br><p>  Obwohl mehrere Anwendungen das Problem der aufgebl√§hten Anwendung l√∂sen, sind die Anwendungen unabh√§ngig voneinander und gemeinsame Dienste oder Codes k√∂nnen nicht wiederverwendet werden. </p><br><h3 id="official-link">  Offizieller Link </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/swoft-cloud/swoft</a> <br><br><h2 id="single-application-solution">  Einzelanwendungsl√∂sung </h2></li></ul><br><p>  Bei einem gro√üen Internet-System enth√§lt es normalerweise mehrere Anwendungen mit gemeinsamen Diensten, und jede Anwendung hat eine Anrufbeziehung untereinander.  Dar√ºber hinaus gibt es weitere Herausforderungen f√ºr das gro√üe Internet-System, z. B. den Umgang mit schnell wachsenden Benutzern, die Verwaltung von Forschungs- und Entwicklungsteams zur schnellen Iteration der Systementwicklung, die stabile Aufrechterhaltung des System-Upgrades usw. </p><br><p>  Daher, um Dienste gut wiederzuverwenden und Module zu warten, um einfach zu erweitern.  Wir m√∂chten, dass die Dienste von der Anwendung getrennt werden.  Ein Dienst befindet sich nicht mehr in einer Anwendung, sondern wird als separater Dienst verwaltet.  Die Anwendung selbst ist kein aufgebl√§hter Modulstapel mehr, sondern eine modulare Servicekomponente. </p><br><h2 id="servitization">  Servitisierung </h2><br><h3 id="features">  Eigenschaften </h3><br><p>  Was ist die Funktion von "Servitization"? </p><br><ul><li>  Eine Anwendung wird von Unternehmen in Dienste aufgeteilt </li><li>  Einzelne Dienste k√∂nnen unabh√§ngig voneinander bereitgestellt werden </li><li>  Der Dienst kann von mehreren Anwendungen gemeinsam genutzt werden </li><li>  Dienste k√∂nnen untereinander kommunizieren </li><li>  Die Architektur des Systems ist klarer </li><li>  Kernmodule sind stabil, und durch die Aktualisierung von Servicekomponenten in Einheiten kann das Risiko h√§ufiger Neuerscheinungen vermieden werden </li><li>  Einfach f√ºr Entwicklung und Verwaltung </li><li>  Die Wartung kann von einem einzelnen Team mit klaren Arbeitsabl√§ufen und Verantwortlichkeiten durchgef√ºhrt werden </li><li>  Wiederverwendung von Diensten, Wiederverwendung von Codes </li><li>  Sehr einfach zu erweitern <cut></cut></li></ul><br><h3 id="the-challenge-of-servitization">  Die Herausforderung der Wartung </h3><cut></cut><br><p> Nach der Systemwartung ist die Abh√§ngigkeit des Systems kompliziert und die Anzahl der Interaktionen zwischen Diensten wird erh√∂ht.  Da im Entwicklungsmodus von <code>fpm</code> der residente Speicher nicht bereitgestellt werden kann, muss jede Anforderung bei Null beginnen, indem ein Prozess geladen wird, um den Prozess zu beenden, wodurch viel nutzloser Overhead entsteht.  Au√üerdem kann die Datenbankverbindung nicht wiederverwendet und nicht gesch√ºtzt werden, da <code>fpm</code> prozessbasiert ist und die Anzahl der <code>fpm</code> Prozesse auch die Anzahl der gleichzeitigen bestimmt.  Dies sind die Probleme, die uns durch die einfache Entwicklung von <code>fpm</code> .  Dies sind die Gr√ºnde, warum <code>Java</code> auf der Internetplattform im Vergleich zu <code>.NET</code> und <code>PHP</code> immer beliebter wird.  Abgesehen von <code>PHP non-memory resident</code> , m√ºssen noch viele andere Probleme behoben werden. </p><br><ul><li>  Mehr Services, mehr Komplexit√§t des Konfigurationsmanagements </li><li>  Komplexe Dienstabh√§ngigkeiten </li><li>  Lastausgleich zwischen Diensten </li><li>  Serviceerweiterung </li><li>  Service√ºberwachung </li><li>  Service-Downgrade </li><li>  Dienstauthentifizierung </li><li>  Service online und offline </li><li>  Servicedokumentation <br>  ...... </li></ul><cut></cut><br><p>  Sie k√∂nnen sich vorstellen, welche Vorteile das residente Ged√§chtnis f√ºr uns bringt. </p><br><ul><li><p>  <strong>Starten Sie die Framework-Initialisierung erst, wenn</strong> wir uns auf die Verarbeitung von Anforderungen konzentrieren k√∂nnen, da das Framework beim einmaligen Start f√ºr den residenten Speicher nur einmal im Speicher initialisiert werden kann </p><br></li><li><p>  <strong>Verbindungsmultiplex</strong> , einige Ingenieure k√∂nnen nicht verstehen, wenn sie keinen Verbindungspool verwenden. Was ist die Folge des Herstellens von Verbindungen f√ºr jede Anforderung?  Es verursacht zu viele Backend-Ressourcen in Verbindungen.  F√ºr einige Basisdienste wie Redis, Datenbanken, sind Verbindungen ein teurer Abfluss. </p><br></li></ul><br><p>  Gibt es also eine gute L√∂sung?  Die Antwort lautet ja, und viele Leute verwenden das Framework namens <code>Swoft</code> .  <code>Swoft</code> ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RPC-</a> Framework mit der <code>Service Governance</code> Funktion.  <code>Swoft</code> ist das erste PHP-residente Speicher-Coroutine-Full-Stack-Framework, das auf dem Kernkonzept des <code>Spring Boot</code> basiert. Die Konvention ist gr√∂√üer als die Konfiguration. </p><br><p>  <code>Swoft</code> bietet eine elegantere M√∂glichkeit, <code>RPC</code> Dienste wie <code>Dubbo</code> und <code>Swoft</code> bietet eine √§hnliche Leistung wie <code>Golang</code> .  Hier ist das Stresstestergebnis der <code>Swoft</code> Leistung auf meinem <code>PC</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3a4/aa7/97e/3a4aa797eb0e94c2e5adfa3207308076.png" alt="Swoft"></p><br><p>  Die Verarbeitungsgeschwindigkeit ist im <code>ab</code> Stresstest sehr erstaunlich.  Mit der <code>i7 generation 8</code> CPU und <code>16GB</code> Speicher verwenden <code>100000</code> Anfragen nur <code>5s</code> .  Die Zeit ist im <code>fpm</code> Entwicklungsmodus grunds√§tzlich nicht zu erreichen.  Der Test reicht auch aus, um die hohe Leistung und Stabilit√§t von <code>Swoft</code> zu demonstrieren. </p><br><h2 id="elegant-service-governance">  Elegante Service-Governance </h2><cut></cut><br><h3 id="service-registration-and-discoveryhttpsenswoftorgdocs2xenmsgovernregister-discoveryhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Serviceregistrierung und -ermittlung</a> </h3><br><p>  Im Governance-Prozess von Microservices ist h√§ufig die Registrierung von Diensten involviert, die f√ºr Cluster von Drittanbietern wie Consul / etcd initiiert wurden.  In diesem Kapitel wird die swoft-consul-Komponente im Swoft-Framework verwendet, um die Registrierung und Erkennung von Diensten zu implementieren. <br><img src="https://habrastorage.org/getpro/habr/post_images/16a/482/683/16a482683d8376d8f179f6158135384a.png" alt="Swoft"><br>  Implementierungslogik </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">ReflectionException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Inject</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ContainerException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Agent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ClientException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ServerException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Rpc</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Rpc</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>\<span class="hljs-title"><span class="hljs-title">Contract</span></span>\<span class="hljs-title"><span class="hljs-title">ProviderInterface</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class RpcProvider * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RpcProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProviderInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Agent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $agent; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Client $client * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ReflectionException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ContainerException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ClientException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ServerException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@example</span></span></span><span class="hljs-comment"> * [ * 'host:port', * 'host:port', * 'host:port', * ] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Client $client)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Get health service from consul $services = $this-&gt;agent-&gt;services(); $services = [ ]; return $services; } }</span></span></code> </pre> <br><h3 id="service-circuit-breakerhttpsenswoftorgdocs2xenmsgovernbreakerhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Leistungsschalter warten</a> </h3><cut></cut><br><p>  In einer verteilten Umgebung, insbesondere einem verteilten System mit Mikroservice-Architektur, ruft ein Softwaresystem h√§ufig ein anderes Remote-System auf.  Der Angerufene eines solchen Fernanrufs kann ein anderer Prozess oder ein anderer Host im Netzwerk sein.  Der gr√∂√üte Unterschied zwischen diesem Remote-Anruf und dem internen Anruf des Prozesses besteht darin, dass der Remote-Anruf m√∂glicherweise fehlschl√§gt oder h√§ngen bleibt.  Keine Antwort bis zum Timeout.  Schlimmer noch, wenn mehrere Anrufer denselben angehaltenen Dienst aufrufen, ist es sehr wahrscheinlich, dass sich das Timeout eines Dienstes schnell auf das gesamte verteilte System ausbreitet, was zu einer Kettenreaktion f√ºhrt, die die gesamte Menge an Ressourcen in verteilten Systemen verbraucht.  Schlie√ülich kann es zu einer Systeml√§hmung kommen. </p><cut></cut><br><p>  Der Leistungsschaltermodus wurde entwickelt, um Katastrophen zu verhindern, die durch solche wasserfallartigen Kettenreaktionen in verteilten Systemen verursacht werden. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0f7/357/6f0/0f73576f06e519937755982867922c34.png"></p><br><p>  Im grundlegenden Leistungsschaltermodus wird sichergestellt, dass der Lieferant nicht angerufen wird, wenn der Leistungsschalter ge√∂ffnet ist. Wir ben√∂tigen jedoch auch eine zus√§tzliche Methode, um den Leistungsschalter zur√ºckzusetzen, nachdem der Lieferant den Betrieb wieder aufgenommen hat.  Eine m√∂gliche L√∂sung besteht darin, dass der Leistungsschalter regelm√§√üig erkennt, ob der Dienst des Lieferanten wieder aufgenommen wird.  Nach der Wiederaufnahme wird der Status auf Schlie√üen gesetzt.  Der Zustand ist halb ge√∂ffnet, wenn der Leistungsschalter erneut versucht. </p><cut></cut><br><p>  Die Verwendung der Sicherung ist einfach und leistungsstark.  Es kann mit einem <code>@Breaker</code> kommentiert werden.  Die Sicherung des <code>Swoft</code> kann in jedem Szenario verwendet werden, z. B. wenn ein Dienst aufgerufen wird.  Es kann herabgestuft oder nicht aufgerufen werden, wenn ein Dienst eines Drittanbieters angefordert wird. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Breaker</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Breaker</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class BreakerLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BreakerLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Breaker</span></span></span><span class="hljs-comment">(fallback="loopFallback") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> Exception */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Do something throw new Exception('Breaker exception'); } /** * @return string * @throws Exception */ public function loopFallback(): string { // Do something } }</span></span></code> </pre> <cut></cut><br><h3 id="service-restrictionhttpsenswoftorgdocs2xenmsgovernlimiterhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Serviceeinschr√§nkung</a> </h3><br><p>  <strong>Durchflussbegrenzung, Leistungsschalter, Service-Downgrade</strong> Diese k√∂nnen wiederholt hervorgehoben werden, da sie wirklich wichtig sind.  Wenn der Dienst nicht funktioniert, muss er unterbrochen werden.  Durchflussbegrenzung ist ein Werkzeug, um sich selbst zu sch√ºtzen.  Wenn es keinen Selbstschutzmechanismus gibt und Verbindungen empfangen werden, egal wie viele sie sind, bleibt das Front-End definitiv h√§ngen, wenn der Datenverkehr sehr gro√ü ist, w√§hrend das Back-End nicht alle Verbindungen verarbeiten kann. </p><br><p>  Die Flussbeschr√§nkung besteht darin, die Anzahl der gleichzeitigen und die Anzahl der Anforderungen beim Zugriff auf knappe Ressourcen wie Flash-Verkaufsg√ºter zu begrenzen, um den Spitzenwert effektiv zu senken und die Flusskurve zu gl√§tten.  Der Zweck der Flussbeschr√§nkung besteht darin, die Rate des gleichzeitigen Zugriffs und gleichzeitiger Anforderungen zu begrenzen oder die Geschwindigkeit der Anforderung innerhalb eines Zeitfensters zu begrenzen, um das System zu sch√ºtzen.  Sobald das Ratenlimit erreicht oder √ºberschritten ist, k√∂nnen die Anforderungen abgelehnt oder in die Warteschlange gestellt werden. </p><br><p>  Die unterste Ebene der <code>Swoft</code> von <code>Swoft</code> verwendet den Token-Bucket-Algorithmus, und die zugrunde liegende Ebene basiert auf <code>Redis</code> , um die verteilte <code>Swoft</code> zu implementieren. </p><br><p>  Die Swoft-Flussbeschr√§nkung begrenzt nicht nur Controller, sondern auch die Methoden in jeder Bean und steuert die Zugriffsrate der Methoden.  Das folgende Beispiel ist die ausf√ºhrliche Erkl√§rung. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Limiter</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">RateLimiter</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class LimiterLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LimiterLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RequestMapping</span></span></span><span class="hljs-comment">() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RateLimiter</span></span></span><span class="hljs-comment">(rate=20, fallback="limiterFallback") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestLimiter2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $uri = $request-&gt;getUriPath(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'requestLimiter2'</span></span>, $uri]; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limiterFallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $uri = $request-&gt;getUriPath(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'limiterFallback'</span></span>, $uri]; } }</code> </pre> <br><p>  Dies unterst√ºtzt den <code>symfony/expression-language</code> .  Wenn die Geschwindigkeit begrenzt ist, wird die im <code>fallback</code> definierte <code>limiterFallback</code> Methode aufgerufen. </p><cut></cut><br><h3 id="configuration-centerhttpsenswoftorgdocs2xenmsgovernconfightml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Konfigurationscenter</a> </h3><br><p>  Bevor wir √ºber das Konfigurationscenter sprechen, lassen Sie uns √ºber die Konfigurationsdatei sprechen.  Wir sind kein Fremder.  Es bietet uns die M√∂glichkeit, das Programm dynamisch zu √§ndern.  Ein Zitat von jemandem ist: </p><br><blockquote>  Dynamische Anpassung der Fluglage der Systemlaufzeit! </blockquote><p>  Ich kann unsere Arbeit anrufen, um Teile in schnell fliegenden Flugzeugen zu reparieren.  Wir Menschen sind immer nicht in der Lage, alles zu kontrollieren und vorherzusagen.  F√ºr unser System m√ºssen wir immer einige Steuerleitungen reservieren, um Anpassungen vorzunehmen, wenn wir sie ben√∂tigen, um die Systemrichtung zu steuern (z. B. Grausteuerung, Anpassung der Durchflussbeschr√§nkung), was besonders f√ºr die Internetbranche wichtig ist, die √Ñnderungen ber√ºcksichtigt. </p><br><p>  F√ºr die eigenst√§ndige Version nennen wir es die Konfiguration (Datei);  F√ºr das verteilte Clustersystem nennen wir es das Konfigurationszentrum (System). </p><br><h4 id="what-exactly-is-a-distributed-configuration-center">  Was genau ist ein verteiltes Konfigurationscenter? </h4><cut></cut><br><p>  Mit der Entwicklung des Gesch√§fts und der Aktualisierung der Mikrodienstarchitektur nehmen die Anzahl der Dienste und die Konfiguration von Programmen (verschiedene Mikrodienste, verschiedene Serveradressen, verschiedene Parameter) sowie die traditionelle Konfigurationsdateimethode und Datenbankmethode zu kann die Anforderungen von Entwicklern im Konfigurationsmanagement nicht erf√ºllen: </p><br><ul><li>  Sicherheit: Die Konfiguration folgt dem in der Codebasis gespeicherten Quellcode, was leicht zu Konfigurationslecks f√ºhren kann. </li><li>  Aktualit√§t: √Ñndern Sie die Konfiguration und starten Sie den Dienst neu, damit er wirksam wird. </li><li>  Einschr√§nkungen: Dynamische Anpassungen k√∂nnen nicht unterst√ºtzt werden: z. B. Protokollschalter, Funktionsschalter; </li></ul><br><p>  Daher m√ºssen wir das Center konfigurieren, um die Konfiguration zu verwalten!  Um Gesch√§ftsentwickler von komplexen und umst√§ndlichen Konfigurationen zu befreien, m√ºssen sie sich nur auf den Gesch√§ftscode selbst konzentrieren, was die Entwicklung und die betriebliche Effizienz erheblich verbessern kann.  Gleichzeitig wird die Konfiguration und Freigabe des Pakets die Erfolgsrate der Freigabe weiter verbessern und die Feinabstimmung der Steuerung und die Notfallbehandlung von Betrieb und Wartung stark unterst√ºtzen. </p><br><p>  In Bezug auf verteilte Konfigurationszentren gibt es im Web viele Open Source-L√∂sungen, z. </p><br><p>  Apollo ist ein verteiltes Konfigurationscenter, das von der Framework-Abteilung von Ctrip entwickelt wurde.  Es kann die Konfiguration verschiedener Umgebungen und verschiedener Anwendungscluster zentral verwalten.  Sie kann nach √Ñnderung der Konfiguration in Echtzeit an das Anwendungsende √ºbertragen werden.  Es verf√ºgt √ºber die Funktionen eines standardisierten Berechtigungs- und Prozessmanagements und eignet sich f√ºr die Szenarien zum Konfigurieren und Verwalten von Microservices. </p><cut></cut><br><p>  In diesem Kapitel wird <code>Apollo</code> als Beispiel verwendet, um Konfigurations- und sichere Neustartdienste aus dem Remote-Konfigurationscenter abzurufen.  Wenn Sie mit <code>Apollo</code> vertraut sind, k√∂nnen Sie sich zun√§chst die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Apollo</code></a> Komponente der <code>Swoft</code> Erweiterung <code>Swoft</code> und die offizielle <code>Apollo</code> Dokumentation lesen. </p><br><p>  In diesem Kapitel wird <code>Apollo</code> in <code>Swoft</code> als Beispiel verwendet.  Wenn sich die <code>Apollo</code> Konfiguration √§ndert, starten Sie den Dienst neu (http-server / rpc-server / ws-server).  Das folgende Beispiel zeigt einen Agenten: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Apollo</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Apollo</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ApolloException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Inject</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class ApolloLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApolloLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Config */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ApolloException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pull</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config-&gt;pull(<span class="hljs-string"><span class="hljs-string">'application'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Print data var_dump($data); } }</span></span></code> </pre> <br><p>  Das Obige ist ein einfacher Apollo-Konfigurationszug. Zus√§tzlich zu dieser Methode bietet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Swoft-Apollo</code></a> weitere Verwendungsm√∂glichkeiten. </p><cut></cut><br><h2 id="official-link-1">  Offizieller Link </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/swoft-cloud/swoft</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460855/">https://habr.com/ru/post/de460855/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460843/index.html">Einf√ºhrung in den neuen 3CX Call Flow Designer und den 3CX CRM Template Generator</a></li>
<li><a href="../de460845/index.html">Fernando Corbato, der Vater Ihres Computers (und Passworts), starb im Alter von 93 Jahren</a></li>
<li><a href="../de460847/index.html">12,3 Millionen gleichzeitige WebSockets</a></li>
<li><a href="../de460849/index.html">Teil 4. Ein Diagrammmodell zur Berechnung logischer Funktionen f√ºr asynchrone parallele Prozesse</a></li>
<li><a href="../de460851/index.html">SamsPcbGuide, Teil 10: Technologie - L√∂ten bleifreier Komponenten</a></li>
<li><a href="../de460857/index.html">Wie Namecoin Blockchain Research RTM-Cyber-Angriffe vorhersagte</a></li>
<li><a href="../de460859/index.html">IThink # 3 Konferenz in Kharkov - basierend auf WWDC 2019</a></li>
<li><a href="../de460861/index.html">JavaScript lexikalischer Umfang und Abschluss</a></li>
<li><a href="../de460863/index.html">Details zum Cloudflare-Absturz 2. Juli 2019</a></li>
<li><a href="../de460865/index.html">Menschen auf dem Mond. Quellen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>