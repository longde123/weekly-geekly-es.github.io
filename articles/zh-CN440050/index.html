<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§™ğŸ¾ ğŸ›ƒ ğŸ’†ğŸ» Node.JSä¸Šçš„è‡ªå·±åŠ¨æ‰‹DNSä»£ç† ğŸ¥‚ ğŸ‘©ğŸ½â€ğŸ« ğŸ’‘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨é¥è¿œçš„æ£®æ—ä¸­é¢ ç°¸çš„DNSæ•°æ®åŒ…... 
 L. Kaganovâ€œåº•éƒ¨çš„å“ˆå§†é›·ç‰¹â€ 

 å¼€å‘ç½‘ç»œåº”ç”¨ç¨‹åºæ—¶ï¼Œæœ‰æ—¶æœ‰å¿…è¦åœ¨æœ¬åœ°è¿è¡Œå®ƒï¼Œä½†è¦ä½¿ç”¨çœŸå®åŸŸåè®¿é—®å®ƒã€‚ ç»è¿‡éªŒè¯çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆæ˜¯åœ¨domainsæ–‡ä»¶ä¸­æ³¨å†ŒåŸŸã€‚ è¯¥æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ä¸»æœºéœ€è¦åŸŸåçš„æ˜ç¡®å¯¹åº”å…³ç³»ï¼Œå³ ä¸æ”¯æŒæ˜Ÿæ˜Ÿã€‚ å³ å¦‚æœå­˜åœ¨ä»¥ä¸‹å½¢å¼çš„åŸŸ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Node.JSä¸Šçš„è‡ªå·±åŠ¨æ‰‹DNSä»£ç†</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440050/"><blockquote>åœ¨é¥è¿œçš„æ£®æ—ä¸­é¢ ç°¸çš„DNSæ•°æ®åŒ…... <br>  <em>L. Kaganovâ€œåº•éƒ¨çš„å“ˆå§†é›·ç‰¹â€</em> </blockquote><p> å¼€å‘ç½‘ç»œåº”ç”¨ç¨‹åºæ—¶ï¼Œæœ‰æ—¶æœ‰å¿…è¦åœ¨æœ¬åœ°è¿è¡Œå®ƒï¼Œä½†è¦ä½¿ç”¨çœŸå®åŸŸåè®¿é—®å®ƒã€‚ ç»è¿‡éªŒè¯çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆæ˜¯åœ¨domainsæ–‡ä»¶ä¸­æ³¨å†ŒåŸŸã€‚ è¯¥æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ä¸»æœºéœ€è¦åŸŸåçš„æ˜ç¡®å¯¹åº”å…³ç³»ï¼Œå³ ä¸æ”¯æŒæ˜Ÿæ˜Ÿã€‚ å³ å¦‚æœå­˜åœ¨ä»¥ä¸‹å½¢å¼çš„åŸŸï¼š </p><br><pre><code class="plaintext hljs">dom1.example.com, dom2.example.com, dom3.example.com, ................ domN.example.com,</code> </pre> <br><p> ç„¶ååœ¨ä¸»æœºä¸­ï¼Œæ‚¨éœ€è¦å…¨éƒ¨æ³¨å†Œã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œäº‹å…ˆä¸çŸ¥é“ç¬¬ä¸‰çº§åŸŸã€‚ æœ‰ä¸€ç§æ„¿æœ›ï¼ˆæˆ‘ä¸ºè‡ªå·±å†™çš„ï¼Œä¹Ÿè®¸æœ‰äººä¼šè¯´è¿™å¾ˆæ­£å¸¸ï¼‰ï¼Œå¸Œæœ›é€šè¿‡è¿™æ ·çš„è¯ï¼š </p><br><pre> <code class="plaintext hljs">*.example.com</code> </pre> <br><p> è§£å†³è¯¥é—®é¢˜çš„æ–¹æ³•å¯èƒ½æ˜¯ä½¿ç”¨æ‚¨è‡ªå·±çš„DNSæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å°†æ ¹æ®æŒ‡å®šçš„é€»è¾‘å¤„ç†è¯·æ±‚ã€‚ æœ‰è¿™æ ·çš„æœåŠ¡å™¨ï¼Œå®ƒä»¬æ˜¯å®Œå…¨å…è´¹çš„ï¼Œå¹¶å…·æœ‰æ–¹ä¾¿çš„å›¾å½¢ç•Œé¢ï¼Œä¾‹å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CoreDNS</a> ã€‚ æ‚¨è¿˜å¯ä»¥æ›´æ”¹è·¯ç”±å™¨ä¸Šçš„DNSè®°å½•ã€‚ æœ€åï¼Œä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">xip.ioä¹‹</a>ç±»çš„æœåŠ¡ï¼Œå®ƒè™½ç„¶ä¸æ˜¯å®Œå…¨æˆç†Ÿçš„DNSæœåŠ¡å™¨ï¼Œä½†æ˜¯å¯¹äºæŸäº›ä»»åŠ¡è€Œè¨€å´æ˜¯å®Œç¾çš„ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå­˜åœ¨ç°æˆçš„è§£å†³æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼Œè€Œä¸å¿…è´¹å¿ƒã€‚ </p><br><p> ä½†æ˜¯æœ¬æ–‡ä»‹ç»äº†å¦ä¸€ç§æ–¹å¼-ç¼–å†™è‡ªå·±çš„è‡ªè¡Œè½¦ï¼Œè¿™æ˜¯åˆ›å»ºç±»ä¼¼äºä¸Šé¢æ‰€åˆ—å·¥å…·çš„èµ·ç‚¹ã€‚ æˆ‘ä»¬å°†ç¼–å†™æˆ‘ä»¬çš„DNSä»£ç†ï¼Œå®ƒå°†ä¾¦å¬ä¼ å…¥çš„DNSæŸ¥è¯¢ï¼Œå¦‚æœè¯·æ±‚çš„åŸŸååœ¨åˆ—è¡¨ä¸­ï¼Œå®ƒå°†è¿”å›æŒ‡å®šçš„IPï¼Œå¦‚æœä¸æ˜¯ï¼Œå®ƒå°†è¯·æ±‚æ›´é«˜çš„DNSæœåŠ¡å™¨å¹¶è½¬å‘æ¥æ”¶åˆ°çš„å“åº”ï¼Œè€Œæ— éœ€æ›´æ”¹è¯·æ±‚çš„ç¨‹åºã€‚ </p><a name="habracut"></a><br><p> åŒæ—¶ï¼Œæ‚¨å¯ä»¥è®°å½•è¯·æ±‚å’Œæ”¶åˆ°çš„å“åº”ã€‚ ç”±äºæ¯ä¸ªäººéƒ½éœ€è¦DNSï¼ŒåŒ…æ‹¬æµè§ˆå™¨ï¼Œé€šè®¯ç¨‹åºå’Œé˜²ç—…æ¯’è½¯ä»¶ä»¥åŠæ“ä½œç³»ç»ŸæœåŠ¡ç­‰ï¼Œå› æ­¤å®ƒå¯èƒ½ä¼šæä¾›å¾ˆå¤šä¿¡æ¯ã€‚ </p><br><p> åŸç†å¾ˆç®€å•ã€‚ åœ¨IPv4çš„ç½‘ç»œè¿æ¥è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ­£åœ¨è¿è¡Œçš„è‡ªå†™DNSä»£ç†å°†DNSæœåŠ¡å™¨åœ°å€æ›´æ”¹ä¸ºè®¡ç®—æœºçš„åœ°å€ï¼ˆå¦‚æœä¸é€šè¿‡ç½‘ç»œå·¥ä½œåˆ™ä¸º127.0.0.1ï¼‰ï¼Œå¹¶åœ¨å…¶è®¾ç½®ä¸­æŒ‡å®šè¾ƒé«˜DNSæœåŠ¡å™¨çš„åœ°å€ã€‚ è€Œä¸”ï¼Œçœ‹æ¥ï¼Œä»…æ­¤è€Œå·²ï¼ </p><br><p> æˆ‘ä»¬å°†ä¸ä½¿ç”¨æ ‡å‡†å‡½æ•°æ¥è§£æ<em>nslookup</em>å’Œ<em>nsresolve</em>åŸŸåï¼Œå› æ­¤DNSç³»ç»Ÿè®¾ç½®å’Œ<em>hostsæ–‡ä»¶</em>çš„å†…å®¹ä¸ä¼šå½±å“ç¨‹åºçš„è¿è¡Œã€‚ æ ¹æ®æƒ…å†µï¼Œå®ƒå¯èƒ½æœ‰ç”¨æˆ–æ— æ•ˆï¼Œæ‚¨åªéœ€è¦è®°ä½è¿™ä¸€ç‚¹å³å¯ã€‚ ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†è‡ªå·±é™äºåŸºæœ¬åŠŸèƒ½æœ¬èº«çš„å®ç°ï¼š </p><br><ul><li>  IPæ¬ºéª—ä»…é€‚ç”¨äºAç±»ï¼ˆä¸»æœºåœ°å€ï¼‰å’ŒINç±»ï¼ˆInternetï¼‰çš„è®°å½• </li><li> æ¬ºéª—æ€§IPåœ°å€ï¼ˆä»…ç‰ˆæœ¬4ï¼‰ </li><li> ä»…é€šè¿‡UDPè¿æ¥æœ¬åœ°ä¼ å…¥è¯·æ±‚ </li><li> é€šè¿‡UDPæˆ–TLSè¿æ¥åˆ°ä¸Šæ¸¸DNSæœåŠ¡å™¨ </li><li> å¦‚æœæœ‰å¤šä¸ªç½‘ç»œæ¥å£ï¼Œåˆ™å°†åœ¨ä»»ä½•ä¸€ä¸ªæ¥å£ä¸Šæ¥å—ä¼ å…¥çš„æœ¬åœ°è¯·æ±‚ </li><li> ä¸æ”¯æŒEDNS </li></ul><br><div class="spoiler">  <b class="spoiler_title">è°ˆåˆ°æµ‹è¯•</b> <div class="spoiler_text"><p> é¡¹ç›®ä¸­å‡ ä¹æ²¡æœ‰å•å…ƒæµ‹è¯•ã€‚ æ²¡é”™ï¼Œå®ƒä»¬æ˜¯æŒ‰ç…§ä»¥ä¸‹åŸåˆ™å·¥ä½œçš„ï¼šæˆ‘å¯åŠ¨äº†å®ƒï¼Œå¦‚æœæ§åˆ¶å°ä¸­æ˜¾ç¤ºäº†ä¸€äº›ç†æ™ºçš„ä¸œè¥¿ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯å¦‚æœæœ‰å¼‚å¸¸å‘ç”Ÿï¼Œé‚£ä¹ˆå°±æœ‰é—®é¢˜äº†ã€‚ ä½†æ˜¯ï¼Œå³ä½¿è¿™æ ·ç¬¨æ‹™çš„æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿æ‚¨æˆåŠŸåœ°å®šä½é—®é¢˜ï¼Œå› æ­¤ä½¿ç”¨Unitã€‚ </p></div></div><br><h2 id="nachalo--server-na-53-m-portu"> å¯åŠ¨-ç«¯å£53ä¸Šçš„æœåŠ¡å™¨ </h2><br><p> è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦æ•™ä¼šåº”ç”¨ç¨‹åºæ¥å—ä¼ å…¥çš„DNSæŸ¥è¯¢ã€‚ æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„TCPæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä»…ä¾¦å¬ç«¯å£53å¹¶è®°å½•ä¼ å…¥çš„è¿æ¥ã€‚ åœ¨ç½‘ç»œè¿æ¥çš„å±æ€§ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™DNSæœåŠ¡å™¨127.0.0.1çš„åœ°å€ï¼Œå¯åŠ¨åº”ç”¨ç¨‹åºï¼Œè¿›å…¥æµè§ˆå™¨ä»¥æŸ¥çœ‹å¤šä¸ªé¡µé¢-å¹¶åœ¨æ§åˆ¶å°ä¸­ä¿æŒé™éŸ³ï¼Œæµè§ˆå™¨å°†æ­£å¸¸æ˜¾ç¤ºè¯¥é¡µé¢ã€‚ å¥½äº†ï¼Œæˆ‘ä»¬å°†TCPæ›´æ”¹ä¸ºUDPï¼Œæˆ‘ä»¬å¼€å§‹ï¼Œæˆ‘ä»¬é€šè¿‡æµè§ˆå™¨-åœ¨æµè§ˆå™¨ä¸­å­˜åœ¨è¿æ¥é”™è¯¯ï¼Œä¸€äº›äºŒè¿›åˆ¶æ•°æ®è¢«æ³¨å…¥æ§åˆ¶å°ã€‚ å› æ­¤ï¼Œç³»ç»Ÿé€šè¿‡UDPå‘é€è¯·æ±‚ï¼Œæˆ‘ä»¬å°†åœ¨ç«¯å£53ä¸Šé€šè¿‡UDPç›‘å¬ä¼ å…¥çš„è¿æ¥ã€‚ åŠå°æ—¶çš„å·¥ä½œï¼Œå…¶ä¸­15åˆ†é’Ÿæ˜¯è°·æ­Œå¦‚ä½•åœ¨NodeJSä¸Šå¯åŠ¨TCPå’ŒUDPæœåŠ¡å™¨-æˆ‘ä»¬å·²ç»è§£å†³äº†è¯¥é¡¹ç›®çš„åŸºç¡€ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡ç¡®å®šäº†æœªæ¥åº”ç”¨ç¨‹åºçš„ç»“æ„ã€‚ ä»£ç å¦‚ä¸‹ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dgram = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'dgram'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = dgram.createSocket(<span class="hljs-string"><span class="hljs-string">'udp4'</span></span>); <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">function</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">server</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">on</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'error'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (err</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`server error:\n</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${err.stack}</span></span></span><span class="hljs-string">`</span></span>); server.close(); }); server.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (localReq, linfo) =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(localReq); <span class="hljs-comment"><span class="hljs-comment">//            }); server.on('listening', () =&gt; { const address = server.address(); console.log(`server listening ${address.address}:${address.port}`); }); const localListenPort = 53; const localListenAddress = 'localhost'; server.bind(localListenPort, localListenAddress); // server listening 0.0.0.0:53 }());</span></span></code> </pre> <br><p>  <em>æ¸…å•1.æ¥æ”¶æœ¬åœ°DNSæŸ¥è¯¢æ‰€éœ€çš„æœ€ä½ä»£ç </em> </p><br><p> æ¥ä¸‹æ¥çš„ä¸€ç‚¹æ˜¯é˜…è¯»æ¶ˆæ¯ï¼Œä»¥äº†è§£æ˜¯éœ€è¦è¿”å›æˆ‘ä»¬çš„IPæ¥å“åº”å®ƒï¼Œè¿˜æ˜¯ç›´æ¥ä¼ é€’å®ƒã€‚ </p><br><h2 id="dns-soobschenie">  DNSæ¶ˆæ¯ </h2><br><p>  DNSæ¶ˆæ¯çš„ç»“æ„åœ¨RFC-1035ä¸­æè¿°ã€‚ è¯·æ±‚å’Œå“åº”éƒ½éµå¾ªæ­¤ç»“æ„ï¼Œå¹¶ä¸”åŸåˆ™ä¸Šåœ¨æ¶ˆæ¯å¤´ä¸­åªæœ‰ä¸€ä½æ ‡å¿—ï¼ˆQRå­—æ®µï¼‰ä¸åŒã€‚ è¯¥æ¶ˆæ¯åŒ…æ‹¬äº”ä¸ªéƒ¨åˆ†ï¼š </p><br><pre> <code class="plaintext hljs">+---------------------+ | Header | +---------------------+ | Question | the question for the name server +---------------------+ | Answer | RRs answering the question +---------------------+ | Authority | RRs pointing toward an authority +---------------------+ | Additional | RRs holding additional information +---------------------+</code> </pre> <br><p>  <em>å¸¸è§„DNSæ¶ˆæ¯ç»“æ„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://tools.ietf.org/html/rfc1035#section-4.1</a></em> </p><br><p>  DNSæ¶ˆæ¯ä»¥å›ºå®šé•¿åº¦çš„æ ‡å¤´ï¼ˆå³æ‰€è°“çš„<em>æ ‡å¤´</em>éƒ¨åˆ†ï¼‰ <em>å¼€å¤´</em> ï¼Œè¯¥<em>æ ‡å¤´</em>åŒ…å«ä»1ä½åˆ°ä¸¤ä¸ªå­—èŠ‚é•¿çš„å­—æ®µï¼ˆå› æ­¤ï¼Œæ ‡å¤´ä¸­çš„ä¸€ä¸ªå­—èŠ‚å¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µï¼‰ã€‚ æ ‡å¤´ä»¥IDå­—æ®µå¼€å¤´-è¿™æ˜¯16ä½è¯·æ±‚æ ‡è¯†ç¬¦ï¼Œå“åº”å¿…é¡»å…·æœ‰ç›¸åŒçš„IDã€‚ æ¥ä¸‹æ¥æ˜¯æè¿°è¯·æ±‚ç±»å‹ï¼Œè¯·æ±‚æ‰§è¡Œç»“æœä»¥åŠæ¶ˆæ¯çš„æ¯ä¸ªåç»­éƒ¨åˆ†ä¸­çš„è®°å½•æ•°çš„å­—æ®µã€‚ é•¿æ—¶é—´æè¿°å®ƒä»¬ï¼Œæ‰€ä»¥è°åœ¨ä¹-RFCï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//tools.ietf.org/html/rfc1035#section-4.1.1</a> ã€‚  <em>æ ‡å¤´</em>éƒ¨åˆ†å§‹ç»ˆå­˜åœ¨äºDNSæ¶ˆæ¯ä¸­ã€‚ </p><br><pre> <code class="plaintext hljs"> 1 1 1 1 1 1 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+ | ID | +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+ |QR| Opcode |AA|TC|RD|RA| Z | RCODE | +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+ | QDCOUNT | +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+ | ANCOUNT | +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+ | NSCOUNT | +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+ | ARCOUNT | +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+</code> </pre> <br><p>  <em>DNSé‚®ä»¶æ ‡å¤´ç»“æ„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://tools.ietf.org/html/rfc1035#section-4.1.1</a></em> </p><br><h3 id="sekciya-question"> é—®é¢˜éƒ¨åˆ† </h3><br><p>  <em>é—®é¢˜</em>éƒ¨åˆ†åŒ…å«ä¸€ä¸ªæ¡ç›®ï¼Œå‘Šè¯‰æœåŠ¡å™¨ç¡®åˆ‡éœ€è¦ä»æœåŠ¡å™¨ä¸­è·å–ä»€ä¹ˆä¿¡æ¯ã€‚ ä»ç†è®ºä¸Šè®²ï¼Œåœ¨æ­¤ç±»è®°å½•çš„éƒ¨åˆ†ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œå®ƒä»¬çš„ç¼–å·åœ¨æ¶ˆæ¯å¤´çš„QDCOUNTå­—æ®µä¸­æŒ‡ç¤ºï¼Œå¹¶ä¸”å¯ä»¥ä¸º0ã€1æˆ–æ›´å¤§ã€‚ ä½†å®é™…ä¸Šï¼Œâ€œé—®é¢˜â€éƒ¨åˆ†åªèƒ½åŒ…å«ä¸€ä¸ªæ¡ç›®ã€‚ å¦‚æœâ€œ <em>é—®é¢˜â€</em>éƒ¨åˆ†åŒ…å«å¤šä¸ªè®°å½•ï¼Œå¹¶ä¸”å…¶ä¸­ä¸€ä¸ªè®°å½•åœ¨æœåŠ¡å™¨ä¸Šå¤„ç†è¯·æ±‚æ—¶ä¼šå¯¼è‡´é”™è¯¯ï¼Œåˆ™å°†å‡ºç°ä¸ç¡®å®šçš„æƒ…å†µã€‚ å°½ç®¡æœåŠ¡å™¨å°†åœ¨å“åº”æ¶ˆæ¯çš„RCODEå­—æ®µä¸­è¿”å›é”™è¯¯ä»£ç ï¼Œä½†å®ƒæ— æ³•æŒ‡ç¤ºä½•æ—¶å¤„ç†è®°å½•é—®é¢˜çš„è®°å½•ï¼Œä½†è§„èŒƒå¹¶æœªå¯¹æ­¤è¿›è¡Œæè¿°ã€‚ è®°å½•ä¹Ÿæ²¡æœ‰åŒ…å«æŒ‡ç¤ºé”™è¯¯åŠå…¶ç±»å‹çš„å­—æ®µã€‚ å› æ­¤ï¼Œæœ‰ä¸€ä¸ªåè®®ï¼ˆæœªè®°å½•ï¼‰ï¼Œæ ¹æ®è¯¥åè®®ï¼Œ <em>Question</em>éƒ¨åˆ†åªèƒ½åŒ…å«ä¸€ä¸ªè®°å½•ï¼Œå¹¶ä¸”QDCOUNTå­—æ®µçš„å€¼ä¸º1ã€‚å¦‚æœå®ƒä»ç„¶åŒ…å«<em>Question</em>ä¸­çš„å¤šä¸ªè®°å½•ï¼Œé‚£ä¹ˆè¿˜ä¸æ¸…æ¥šå¦‚ä½•åœ¨æœåŠ¡å™¨ç«¯å¤„ç†è¯·æ±‚ã€‚ æœ‰äººå»ºè®®è¿”å›å¸¦æœ‰è¯·æ±‚é”™è¯¯çš„æ¶ˆæ¯ã€‚ å¹¶ä¸”ï¼Œä¾‹å¦‚ï¼ŒGoogle DNSä»…å¤„ç†â€œ <em>é—®é¢˜â€</em>éƒ¨åˆ†ä¸­çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œè€Œåªæ˜¯å¿½ç•¥å…¶ä½™éƒ¨åˆ†ã€‚ æ˜¾ç„¶ï¼Œè¿™ä»ç”±DNSæœåŠ¡çš„å¼€å‘äººå‘˜è‡ªè¡Œå†³å®šã€‚ </p><br><p> åœ¨æ¥è‡ªæœåŠ¡å™¨çš„å“åº”DNSæ¶ˆæ¯ä¸­ï¼Œâ€œ <em>é—®é¢˜â€</em>éƒ¨åˆ†ä¹Ÿå­˜åœ¨ï¼Œå¹¶ä¸”åº”å®Œå…¨å¤åˆ¶è¯·æ±‚çš„â€œ <em>é—®é¢˜â€</em> ï¼ˆä¸ºäº†é¿å…å†²çªï¼Œä»¥é˜²ä¸€ä¸ªIDå­—æ®µä¸å¤Ÿç”¨ï¼‰ã€‚ </p><br><p>  <em>é—®é¢˜</em>éƒ¨åˆ†ä¸­çš„å”¯ä¸€æ¡ç›®åŒ…å«ä»¥ä¸‹å­—æ®µï¼šQNAMEï¼ˆåŸŸåï¼‰ï¼ŒQTYPEï¼ˆç±»å‹ï¼‰ï¼ŒQCLASSï¼ˆç±»ï¼‰ã€‚  QTYPEå’ŒQCLASSæ˜¯åŒå­—èŠ‚æ•°å­—ï¼ŒæŒ‡ç¤ºè¯·æ±‚çš„ç±»å‹å’Œç±»åˆ«ã€‚ å¯èƒ½çš„ç±»å‹å’Œç±»åœ¨RFC-1035 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://tools.ietf.org/html/rfc1035#section-3.2ä¸­</a>è¿›è¡Œäº†æè¿°ï¼Œåœ¨é‚£é‡Œä¸€åˆ‡éƒ½æ¸…æ¥šäº†ã€‚ ä½†æ˜¯ï¼Œåœ¨è®°å½•åŸŸåçš„æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬å°†åœ¨â€œè®°å½•åŸŸåçš„æ ¼å¼â€éƒ¨åˆ†ä¸­è¯¦ç»†ä»‹ç»ã€‚ </p><br><p> å¯¹äºæŸ¥è¯¢ï¼ŒDNSæ¶ˆæ¯é€šå¸¸ä»¥â€œ <em>é—®é¢˜â€</em>éƒ¨åˆ†ç»“å°¾ï¼Œæœ‰æ—¶å¯ä»¥åœ¨â€œ <em>é™„åŠ â€</em>éƒ¨åˆ†ä¹‹åã€‚ </p><br><p> å¦‚æœåœ¨æœåŠ¡å™¨ä¸Šå¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œé”™è¯¯åœ°ç”Ÿæˆäº†ä¼ å…¥è¯·æ±‚ï¼‰ï¼Œåˆ™å“åº”æ¶ˆæ¯ä¹Ÿå°†ä»¥<em>Question</em>æˆ–<em>Additional</em>éƒ¨åˆ†ç»“å°¾ï¼Œå¹¶ä¸”å“åº”æ¶ˆæ¯å¤´çš„RCODEå­—æ®µå°†åŒ…å«é”™è¯¯ä»£ç ã€‚ </p><br><h3 id="sekcii-answer-authority-i-additional">  <em>ç­”æ¡ˆ</em> ï¼Œ <em>æƒé™</em>å’Œ<em>å…¶ä»–</em>éƒ¨åˆ† </h3><br><p> ä»¥ä¸‹å„èŠ‚åˆ†åˆ«æ˜¯<em>Answer</em> ï¼Œ <em>Authority</em>å’Œ<em>Additional</em> ï¼ˆ <em>Answer</em>å’Œ<em>Authority</em>åªåŒ…å«åœ¨å“åº”DNSæ¶ˆæ¯ä¸­ï¼Œ <em>Additional</em>å¯èƒ½ä¼šå‡ºç°åœ¨è¯·æ±‚å’Œå“åº”ä¸­ï¼‰ã€‚ å®ƒä»¬æ˜¯å¯é€‰çš„ï¼Œå³ æ ¹æ®è¦æ±‚ï¼Œå®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥å­˜åœ¨æˆ–ä¸å­˜åœ¨ã€‚ è¿™äº›éƒ¨åˆ†å…·æœ‰ç›¸åŒçš„ç»“æ„ï¼Œå¹¶åŒ…å«æ‰€è°“çš„â€œèµ„æºè®°å½•â€ï¼ˆ <em>èµ„æºè®°å½•</em>æˆ–RRï¼‰æ ¼å¼çš„ä¿¡æ¯ã€‚ å½¢è±¡åœ°è¯´ï¼Œè¿™äº›éƒ¨åˆ†ä¸­çš„æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯èµ„æºè®°å½•çš„æ•°ç»„ï¼Œè€Œè®°å½•æ˜¯å…·æœ‰å­—æ®µçš„å¯¹è±¡ã€‚ æ¯ä¸ªéƒ¨åˆ†å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªè®°å½•ï¼Œå®ƒä»¬çš„ç¼–å·åœ¨æ¶ˆæ¯æ ‡é¢˜çš„ç›¸åº”å­—æ®µä¸­åˆ†åˆ«æŒ‡ç¤ºï¼ˆåˆ†åˆ«ä¸ºANCOUNTï¼ŒNSCOUNTå’ŒARCOUNTï¼‰ã€‚ ä¾‹å¦‚ï¼Œå¯¹åŸŸâ€œ google.comâ€çš„IPè¯·æ±‚å°†è¿”å›å¤šä¸ªIPåœ°å€ï¼Œå› æ­¤â€œ <em>ç­”æ¡ˆâ€</em>éƒ¨åˆ†è¿˜å°†æœ‰å¤šä¸ªæ¡ç›®ï¼Œæ¯ä¸ªåœ°å€ä¸€ä¸ªã€‚ å¦‚æœè¯¥éƒ¨åˆ†ä¸å­˜åœ¨ï¼Œåˆ™ç›¸åº”çš„æ ‡é¢˜å­—æ®µåŒ…å«0ã€‚ </p><br><p> æ¯ä¸ª<em>èµ„æºè®°å½•</em> ï¼ˆRRï¼‰ä»¥åŒ…å«åŸŸåçš„NAMEå­—æ®µå¼€å¤´ã€‚ è¯¥å­—æ®µçš„æ ¼å¼ä¸â€œ <em>é—®é¢˜â€</em>éƒ¨åˆ†çš„â€œ QNAMEâ€å­—æ®µç›¸åŒã€‚ <br>  NAMEæ—è¾¹æ˜¯TYPEï¼ˆè®°å½•ç±»å‹ï¼‰å’ŒCLASSï¼ˆå…¶ç±»ï¼‰å­—æ®µï¼Œä¸¤ä¸ªå­—æ®µå‡ä¸º16ä½æ•°å­—ï¼Œè¡¨ç¤ºè®°å½•çš„ç±»å‹å’Œç±»ã€‚ è¿™ä¹Ÿç±»ä¼¼äºâ€œ <em>é—®é¢˜â€</em>éƒ¨åˆ†ï¼Œä¸åŒä¹‹å¤„åœ¨äºå…¶QTYPEå’ŒQCLASSå¯ä»¥å…·æœ‰ä¸TYPEå’ŒCLASSç›¸åŒçš„æ‰€æœ‰å€¼ï¼Œä»¥åŠå®ƒä»¬è‡ªå·±å”¯ä¸€çš„å…¶ä»–å€¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æ¯ç‡¥çš„ç§‘å­¦è¯­è¨€ï¼ŒQTYPEå’ŒQCLASSå€¼çš„é›†åˆæ˜¯TYPEå’ŒCLASSå€¼çš„è¶…é›†ã€‚ åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://tools.ietf.org/html/rfc1035#section-3.2.2ä¸Š</a>äº†è§£æœ‰å…³å·®å¼‚çš„æ›´å¤šä¿¡æ¯ã€‚ <br> å…¶ä½™å­—æ®µä¸ºï¼š </p><br><ul><li>  TTLæ˜¯ä¸€ä¸ª32ä½æ•°å­—ï¼ŒæŒ‡ç¤ºè®°å½•çš„æŒç»­æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ </li><li>  RDLENGTHæ˜¯ä¸€ä¸ª16ä½æ•°å­—ï¼ŒæŒ‡ç¤ºä¸‹ä¸€ä¸ªRDATAå­—æ®µçš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ </li><li>  RDATAå®é™…ä¸Šæ˜¯æœ‰æ•ˆè½½è·ï¼Œå…¶æ ¼å¼å–å†³äºè®°å½•çš„ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºç±»å‹Aï¼ˆä¸»æœºåœ°å€ï¼‰å’Œç±»INï¼ˆäº’è”ç½‘ï¼‰çš„è®°å½•ï¼Œå®ƒä»¬æ˜¯4ä¸ªå­—èŠ‚ï¼Œä»£è¡¨ä¸€ä¸ªIPv4åœ°å€ã€‚ </li></ul><br><h2 id="format-zapisi-domennyh-imyon"> åŸŸåè®°å½•æ ¼å¼ </h2><br><p> å¦‚æœQNAMEå’ŒNAMEå­—æ®µä»¥åŠRDATAå­—æ®µçš„åŸŸåè®°å½•æ ¼å¼æ˜¯ç›¸åŒçš„ï¼ˆå¦‚æœå®ƒæ˜¯CNAMEï¼ŒMXï¼ŒNSæˆ–å…¶ä»–å‡å®šåŸŸåä¸ºåŸŸåçš„ç±»è®°å½•ï¼‰ã€‚ </p><br><p> åŸŸåæ˜¯ä¸€ç³»åˆ—æ ‡ç­¾ï¼ˆåç§°çš„å„ä¸ªéƒ¨åˆ†ï¼Œå­åŸŸ-è¿™æ˜¯åŸå§‹<strong>æ ‡ç­¾</strong> ï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°æ›´å¥½çš„ç¿»è¯‘ï¼‰ã€‚ æ ‡ç­¾æ˜¯ä¸€ä¸ªé•¿åº¦ä¸ºä¸€ä¸ªå­—èŠ‚çš„å­—èŠ‚ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ•°å­—-æ ‡ç­¾å†…å®¹çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œåè·Ÿä¸€ä¸ªæŒ‡å®šé•¿åº¦çš„å­—èŠ‚åºåˆ—ã€‚ æ ‡ç­¾ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è·Ÿéšï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªé•¿åº¦ä¸º0çš„å­—èŠ‚ä¸ºæ­¢ï¼Œç¬¬ä¸€ä¸ªæ ‡ç­¾çš„é•¿åº¦ç«‹å³ä¸ºé›¶ï¼Œè¿™è¡¨ç¤ºæ ¹åŸŸï¼ˆRoot Domainï¼‰çš„åŸŸåä¸ºç©ºï¼ˆæœ‰æ—¶å†™ä¸ºâ€œâ€ï¼‰ã€‚ </p><br><p> åœ¨æ—©æœŸç‰ˆæœ¬çš„DNSä¸­ï¼Œæ ‡ç­¾ä¸­çš„å­—èŠ‚å¯ä»¥å…·æœ‰ï¼ˆ0åˆ°255ï¼‰ä¹‹é—´çš„ä»»ä½•å€¼ã€‚ æœ‰ä¸€äº›ç´§æ€¥å»ºè®®çš„è§„åˆ™ï¼šæ ‡ç­¾ä»¥å­—æ¯å¼€å¤´ï¼Œä»¥å­—æ¯æˆ–æ•°å­—ç»“å°¾ï¼Œå¹¶ä¸”ä»…åŒ…å«7ä½ASCIIç¼–ç çš„å­—æ¯ï¼Œæ•°å­—æˆ–è¿å­—ç¬¦ï¼Œä¸”æœ€é«˜æœ‰æ•ˆä½ä¸ºé›¶ã€‚ å½“å‰çš„EDNSè§„èŒƒå·²ç»æ˜ç¡®è¦æ±‚éµå®ˆè¿™äº›è§„åˆ™ï¼Œå¹¶ä¸”æ²¡æœ‰åå·®ã€‚ </p><br><p> é•¿åº¦å­—èŠ‚çš„ä¸¤ä¸ªæœ€é«˜æœ‰æ•ˆä½ç”¨ä½œæ ‡ç­¾ç±»å‹å±æ€§ã€‚ å¦‚æœå®ƒä»¬ä¸ºé›¶ï¼ˆ <em>0b00xxxxxx</em> ï¼‰ï¼Œåˆ™è¿™æ˜¯ä¸€ä¸ªå¸¸è§„æ ‡ç­¾ï¼Œé•¿åº¦å­—èŠ‚çš„å…¶ä½™ä½æŒ‡ç¤ºå…¶ç»„æˆä¸­åŒ…å«çš„æ•°æ®å­—èŠ‚æ•°ã€‚ æ ‡ç­¾çš„æœ€å¤§é•¿åº¦ä¸º63ä¸ªå­—ç¬¦ã€‚ äºŒè¿›åˆ¶ç¼–ç ä¸­çš„63åªæ˜¯<em>0b00111111</em> ã€‚ </p><br><p> å¦‚æœä¸¤ä¸ªæœ€é«˜æœ‰æ•ˆä½åˆ†åˆ«ä¸º0å’Œ1ï¼ˆ <em>0b01xxxxxx</em> ï¼‰ï¼Œåˆ™è¿™æ˜¯EDNSæ ‡å‡†çš„æ‰©å±•ç±»å‹æ ‡ç­¾ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://tools.ietf.org/html/rfc2671#section-3.1</a> ï¼‰ï¼Œè¯¥æ ‡ç­¾äº2019å¹´2æœˆ1æ—¥å‘å¸ƒã€‚ ä½å…­ä½å°†åŒ…å«æ ‡ç­¾å€¼ã€‚ æˆ‘ä»¬ä¸åœ¨æœ¬æ–‡ä¸­è®¨è®ºEDNSï¼Œä½†æ˜¯çŸ¥é“è¿™ä¹Ÿä¼šå‘ç”Ÿæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ </p><br><p> ä¿ç•™ç­‰äº1å’Œ0ï¼ˆ <em>0b10xxxxxx</em> ï¼‰çš„ä¸¤ä¸ªæœ€é«˜æœ‰æ•ˆä½çš„ç»„åˆï¼Œä»¥ä¾›å°†æ¥ä½¿ç”¨ã€‚ </p><br><p> å¦‚æœä¸¤ä¸ªé«˜ä½éƒ½ç­‰äº1ï¼ˆ <em>0b11xxxxxx</em> ï¼‰ï¼Œåˆ™æ„å‘³ç€åŸŸåè¢«å‹ç¼©ï¼ˆ <em>compression</em> ï¼‰ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢è¯¦ç»†ä»‹ç»ã€‚ </p><br><h3 id="szhatie-domennyh-imyon"> åŸŸåå‹ç¼© </h3><br><p> å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªå­—èŠ‚çš„é•¿åº¦å…·æœ‰ç­‰äº1ï¼ˆ <em>0b11xxxxxx</em> ï¼‰çš„ä¸¤ä¸ªé«˜ä½ï¼Œåˆ™è¡¨æ˜åŸŸåå‹ç¼©ã€‚ å‹ç¼©ç”¨äºä½¿æ¶ˆæ¯æ›´çŸ­ï¼Œæ›´ç®€æ´ã€‚ å½“ä½¿ç”¨UDPå¤„ç†DNSæ¶ˆæ¯çš„æ€»é•¿åº¦é™åˆ¶ä¸º512å­—èŠ‚æ—¶ï¼ˆå°¤å…¶æ˜¯è¿™æ˜¯æ—§æ ‡å‡†ï¼Œè¯·å‚é˜…<em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://tools.ietf.org/html/rfc1035#section-2.3.4</a>å¤§å°é™åˆ¶</em> ï¼Œæ–°çš„EDNSï¼‰å…è®¸å‘é€UPDæ¶ˆæ¯åŠæ›´é•¿çš„æ¶ˆæ¯ï¼‰ã€‚ è¯¥è¿‡ç¨‹çš„æœ¬è´¨æ˜¯ï¼Œå¦‚æœDNSæ¶ˆæ¯åŒ…å«å…·æœ‰ç›¸åŒé¡¶çº§å­åŸŸçš„åŸŸåï¼ˆä¾‹å¦‚ï¼Œ <em>mail.yandex.ru</em>å’Œ<em>yandex.ru</em> ï¼‰ï¼Œåˆ™<em>ä¸å…¶</em>é‡æ–°æŒ‡å®šæ•´ä¸ªåŸŸåï¼Œ <em>ä¸å¦‚</em>ä»DNSæ¶ˆæ¯ä¸­æå–å­—èŠ‚æ•°ç»§ç»­é˜…è¯»åŸŸåã€‚ è¿™å¯ä»¥æ˜¯DNSæ¶ˆæ¯çš„ä»»ä½•å­—èŠ‚ï¼Œä¸ä»…å¯ä»¥åœ¨å½“å‰è®°å½•æˆ–éƒ¨åˆ†ä¸­ï¼Œè¿˜å¯ä»¥æ˜¯åŸŸæ ‡ç­¾é•¿åº¦çš„ä¸€ä¸ªå­—èŠ‚ã€‚ æ‚¨ä¸èƒ½å‚è€ƒæ ‡è®°çš„ä¸­é—´ã€‚ å‡è®¾æ¶ˆæ¯ä¸­æœ‰ä¸€ä¸ª<em>mail.yandex.ru</em>åŸŸï¼Œé‚£ä¹ˆåœ¨å‹ç¼©çš„å¸®åŠ©ä¸‹ï¼Œè¿˜å¯ä»¥æŒ‡å®š<em>yandex.ru</em> ï¼Œ <em>ru</em>å’Œrootâ€œâ€åŸŸï¼ˆå½“ç„¶ï¼Œæ ¹æ— éœ€å‹ç¼©å°±æ›´å®¹æ˜“ç¼–å†™ï¼Œä½†æ˜¯ä»æŠ€æœ¯ä¸Šè®²ï¼Œå¯ä»¥é€šè¿‡å‹ç¼©æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼‰ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œä½¿<em>ndex.ru</em>æ— æ³•æ­£å¸¸å·¥ä½œã€‚ åŒæ ·ï¼Œæ‰€æœ‰æ´¾ç”ŸåŸŸåéƒ½å°†ä»¥æ ¹åŸŸç»“å°¾ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå†™ï¼Œä¾‹å¦‚<em>mail.yandex</em>ä¹Ÿå°†å¤±è´¥ã€‚ </p><br><p> åŸŸåå¯ä»¥ï¼š </p><br><ul><li> è¢«å®Œæ•´è®°å½•è€Œæ— éœ€å‹ç¼©ï¼Œ </li><li> ä»ä½¿ç”¨å‹ç¼©çš„åœ°æ–¹å¼€å§‹ </li><li> ä»ä¸€ä¸ªæˆ–å¤šä¸ªæœªå‹ç¼©çš„æ ‡ç­¾å¼€å§‹ï¼Œç„¶ååˆ‡æ¢åˆ°å‹ç¼©ï¼Œ </li><li> ä¸ºç©ºï¼ˆå¯¹äºæ ¹åŸŸï¼‰ã€‚ </li></ul><br><p> ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ­£åœ¨ç¼–è¯‘DNSæ¶ˆæ¯ï¼Œå¹¶ä¸”å·²ç»åœ¨å…¶ä¸­é‡åˆ°äº†åç§°â€œ dom3.example.comâ€ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦æŒ‡å®šâ€œ dom4.dom3.example.comâ€ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥è®°å½•â€œ dom4â€éƒ¨åˆ†è€Œä¸è¿›è¡Œå‹ç¼©ï¼Œç„¶ååˆ‡æ¢åˆ°å‹ç¼©ï¼Œå³æ·»åŠ æŒ‡å‘â€œ dom3.example.comâ€çš„é“¾æ¥ã€‚ åä¹‹äº¦ç„¶ï¼Œå¦‚æœä»¥å‰æ›¾é‡åˆ°åç§°â€œ dom4.dom3.example.comâ€ï¼Œåˆ™è¦è¡¨ç¤ºâ€œ dom3.example.comâ€ï¼Œæ‚¨å¯ä»¥é€šè¿‡å¼•ç”¨å…¶ä¸­çš„æ ‡ç­¾â€œ dom3â€ç«‹å³ä½¿ç”¨å‹ç¼©ã€‚ æ­£å¦‚æˆ‘ä»¬å·²ç»è¯´è¿‡çš„ï¼Œæˆ‘ä»¬ä¸èƒ½é€šè¿‡å‹ç¼©æ¥æŒ‡ç¤ºâ€œ dom4.dom3â€çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºåç§°å¿…é¡»ä»¥é¡¶å±‚éƒ¨åˆ†ç»“å°¾ã€‚ å¦‚æœæ‚¨çªç„¶éœ€è¦ä»ä¸­é—´æŒ‡å®šç‰‡æ®µï¼Œåˆ™æ— éœ€å‹ç¼©å³å¯ç®€å•åœ°æŒ‡ç¤ºå®ƒä»¬ã€‚ </p><br><p> ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬çš„ç¨‹åºä¸çŸ¥é“å¦‚ä½•é€šè¿‡å‹ç¼©æ¥å†™åŸŸåï¼Œå®ƒåªèƒ½è¯»å–ã€‚ è¯¥æ ‡å‡†å…è®¸è¿™æ ·åšï¼Œé˜…è¯»å¿…é¡»ä¸€å®šè¦å®ç°ï¼Œå†™ä½œæ˜¯å¯é€‰çš„ã€‚ ä»æŠ€æœ¯ä¸Šè®²ï¼Œè¯»å–æ˜¯è¿™æ ·å®ç°çš„ï¼šå¦‚æœä¸€ä¸ªå­—èŠ‚é•¿åº¦çš„ä¸¤ä¸ªæœ€é«˜æœ‰æ•ˆä½åŒ…å«1ï¼Œåˆ™æˆ‘ä»¬è¯»å–ç´§éšå…¶åçš„å­—èŠ‚ï¼Œå¹¶å°†è¿™ä¸¤ä¸ªå­—èŠ‚è§†ä¸º16ä½æ— ç¬¦å·æ•´æ•°ï¼Œå¹¶æŒ‰Big Endianä½çš„é¡ºåºè¿›è¡Œå¤„ç†ã€‚ æˆ‘ä»¬ä¸¢å¼ƒä¸¤ä¸ªæœ€é«˜æœ‰æ•ˆä½ï¼ˆåŒ…å«1ï¼‰ï¼Œè¯»å–ç»“æœ14ä½æ•°å­—ï¼Œå¹¶ç»§ç»­ä»DNSæ¶ˆæ¯ä¸­ä¸è¯¥æ•°å­—å¯¹åº”çš„æ•°å­—çš„å­—èŠ‚ä¸­è¯»å–åŸŸåã€‚ </p><br><p> åŸŸåè¯»å–åŠŸèƒ½çš„ä»£ç å¦‚ä¸‹ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readDomainName</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">buf, startOffset, objReturnValue = {}</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentByteIndex = startOffset; <span class="hljs-comment"><span class="hljs-comment">//    ,  DNS- ,      let initOctet = buf.readUInt8(currentByteIndex); let domain = ''; //      , ..       0, //  ,      // "the root domain name has no labels." (c) RFC-1035, p. 4.1.4. Message compression objReturnValue['endOffset'] = currentByteIndex; let lengthOctet = initOctet; while (lengthOctet &gt; 0) { //     var label; if (lengthOctet &gt;= 192) { //   :  0b1100 0000   const pointer = buf.readUInt16BE(currentByteIndex) - 49152; // 49152 === 0b1100 0000 0000 0000 === 192 * 256 const returnValue = {} label = readDomainName(buf, pointer, returnValue); domain += ('.' + label); objReturnValue['endOffset'] = currentByteIndex + 1; //      ,      break; } else { currentByteIndex++; label = buf.toString('ascii', currentByteIndex, currentByteIndex + lengthOctet); domain += ('.' + label); currentByteIndex += lengthOctet; lengthOctet = buf.readUInt8(currentByteIndex); objReturnValue['endOffset'] = currentByteIndex; } } return domain.substring(1); //    â€”  "." }</span></span></code> </pre> <br><p>  <em>æ¸…å•2.ä»DNSæŸ¥è¯¢ä¸­è¯»å–åŸŸå</em> </p><br><p> ä»äºŒè¿›åˆ¶ç¼“å†²åŒºè¯»å–DNSè®°å½•çš„åŠŸèƒ½çš„å®Œæ•´ä»£ç ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æ¸…å•3.ä»äºŒè¿›åˆ¶ç¼“å†²åŒºè¯»å–DNSè®°å½•</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseDnsMessageBytes</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">buf</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> msgFields = {}; <span class="hljs-comment"><span class="hljs-comment">// (c) RFC 1035 p. 4.1.1. Header section format msgFields['ID'] = buf.readUInt16BE(0); const byte_2 = buf.readUInt8(2); //  #2 (starting from 0) const mask_QR = 0b10000000; msgFields['QR'] = !!(byte_2 &amp; mask_QR); //  : 0 "false" =&gt; , 1 "true" =&gt;  const mask_Opcode = 0b01111000; const opcode = (byte_2 &amp; mask_Opcode) &gt;&gt;&gt; 3; //   (): 0, 1, 2,   msgFields['Opcode'] = opcode; const mask_AA = 0b00000100; msgFields['AA'] = !!(byte_2 &amp; mask_AA); const mask_TC = 0b00000010; msgFields['TC'] = !!(byte_2 &amp; mask_TC); const mask_RD = 0b00000001; msgFields['RD'] = !!(byte_2 &amp; mask_RD); const byte_3 = buf.readUInt8(3); //  #3 const mask_RA = 0b10000000; msgFields['RA'] = !!(byte_3 &amp; mask_RA); const mask_Z = 0b01110000; msgFields['Z'] = (byte_3 &amp; mask_Z) &gt;&gt;&gt; 4; //  0,  const mask_RCODE = 0b00001111; msgFields['RCODE'] = (byte_3 &amp; mask_RCODE); // 0 =&gt; no error; (dec) 1, 2, 3, 4, 5 - errors, see RFC msgFields['QDCOUNT'] = buf.readUInt16BE(4); //     Question,   0  1 msgFields['ANCOUNT'] = buf.readUInt16BE(6); //     Answer msgFields['NSCOUNT'] = buf.readUInt16BE(8); //     Authority msgFields['ARCOUNT'] = buf.readUInt16BE(10); //     Additional //    Question let currentByteIndex = 12; //  Question   12-  DNS- (c) RFC 1035 p. 4.1.2. Question section format msgFields['questions'] = []; for (let qdcount = 0; qdcount &lt; msgFields['QDCOUNT']; qdcount++) { const question = {}; const resultByteIndexObj = { endOffset: undefined }; const domain = readDomainName(buf, currentByteIndex, resultByteIndexObj); currentByteIndex = resultByteIndexObj.endOffset + 1; question['domainName'] = domain; question['qtype'] = buf.readUInt16BE(currentByteIndex); // 1 =&gt; "A" record currentByteIndex += 2; question['qclass'] = buf.readUInt16BE(currentByteIndex); // 1 =&gt; "IN" Internet currentByteIndex += 2; msgFields['questions'].push(question); } // (c) RFC 1035 p. 4.1.3. Resource record format //    (Resourse Records, RR)  Answer, Authority, Additional ['answer', 'authority', 'additional'].forEach(function(section, i, arr) { let msgFieldsName, countFieldName; switch(section) { case 'answer': msgFieldsName = 'answers'; countFieldName = 'ANCOUNT'; break; case 'authority': msgFieldsName = 'authorities'; countFieldName = 'NSCOUNT'; break; case 'additional': msgFieldsName = 'additionals'; countFieldName = 'ARCOUNT'; break; } msgFields[msgFieldsName] = []; for (let recordsCount = 0; recordsCount &lt; msgFields[countFieldName]; recordsCount++) { let record = {}; const objReturnValue = {}; const domain = readDomainName(buf, currentByteIndex, objReturnValue); currentByteIndex = objReturnValue['endOffset'] + 1; record['domainName'] = domain; record['type'] = buf.readUInt16BE(currentByteIndex); // 1 =&gt; "A" record currentByteIndex += 2; record['class'] = buf.readUInt16BE(currentByteIndex); // 1 =&gt; "IN" Internet currentByteIndex += 2; // TTL  4  record['ttl'] = buf.readUIntBE(currentByteIndex, 4); currentByteIndex += 4; record['rdlength'] = buf.readUInt16BE(currentByteIndex); currentByteIndex += 2; const rdataBinTempBuf = buf.slice(currentByteIndex, currentByteIndex + record['rdlength']); record['rdata_bin'] = Buffer.alloc(record['rdlength'], rdataBinTempBuf); if (record['type'] === 1 &amp;&amp; record['class'] === 1) { //      IPv4,      let ipStr = ''; for (ipv4ByteIndex = 0; ipv4ByteIndex &lt; 4; ipv4ByteIndex++) { ipStr += '.' + buf.readUInt8(currentByteIndex).toString(); currentByteIndex++; } record['IPv4'] = ipStr.substring(1); //    '.' } else { //    ,   currentByteIndex += record['rdlength']; } msgFields[msgFieldsName].push(record); } }); return msgFields; }</span></span></code> </pre> <br><p> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¸…å•3.ä»äºŒè¿›åˆ¶ç¼“å†²åŒºè¯»å–DNSè®°å½•</font></font></em> </p></div></div><br><p> ,       . ,     ,   ,    .   ,     DNS-,     ,   .  ,       . </p><br><p>  ,        - <code>server.on("message", () =&gt; {})</code>   1.   : </p><br><div class="spoiler"> <b class="spoiler_title"> 4.    DNS-</b> <div class="spoiler_text"><pre> <code class="javascript hljs">server.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (localReq, linfo) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dnsRequest = functions.parseDnsMessageBytes(localReq); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> question = dnsRequest.questions[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// currently, only one question per query is supported by DNS implementations let forgingHostParams = undefined; // ,         IP for (let i = 0; i &lt; config.requestsToForge.length; i++) { const requestToForge = config.requestsToForge[i]; const targetDomainName = requestToForge.hostName; if (functions.domainNameMatchesTemplate(question.domainName, targetDomainName) &amp;&amp; question.qclass === 1 &amp;&amp; question.qtype === 1) { forgingHostParams = requestToForge; break; } } //  ,    DNS-      if (!!forgingHostParams) { const forgeIp = forgingHostParams.ip; const answers = []; answers.push({ domainName: question.domainName, type: question.qtype, class: question.qclass, ttl: forgedRequestsTTL, rdlength: 4, rdata_bin: functions.ip4StringToBuffer(forgeIp), IPv4: forgeIp }); const localDnsResponse = { ID: dnsRequest.ID, QR: dnsRequest.QR, Opcode: dnsRequest.Opcode, AA: dnsRequest.AA, TC: false, // dnsRequest.TC, RD: dnsRequest.RD, RA: true, Z: dnsRequest.Z, RCODE: 0, // dnsRequest.RCODE, 0 - no errors, look in RFC-1035 for other error conditions QDCOUNT: dnsRequest.QDCOUNT, ANCOUNT: answers.length, NSCOUNT: dnsRequest.NSCOUNT, ARCOUNT: dnsRequest.ARCOUNT, questions: dnsRequest.questions, answers: answers } //     DNS-    const responseBuf = functions.composeDnsMessageBin(localDnsResponse); console.log('response composed for: ', localDnsResponse.questions[0]); server.send(responseBuf, linfo.port, linfo.address, (err, bytes) =&gt; {}); } // ,     DNS-,         else { //     DNS-  UDP,     const responseBuf = await functions.getRemoteDnsResponseBin(localReq, upstreamDnsIP, upstreamDnsPort); //        server.send(responseBuf, linfo.port, linfo.address, (err, bytes) =&gt; {}); //     DNS-  TLS,   , .  9 } });</span></span></code> </pre> <br><p> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¸…å•4.å¤„ç†ä¼ å…¥çš„æœ¬åœ°DNSæŸ¥è¯¢</font></font></em> </p></div></div><br><h2 id="dobavlyaem-podderzhku-tls">   TLS </h2><br><p>        DNS-.    ,      DNS-   TLS (HTTPS    ).  DNS-  TLS     TCP,    ,   TLS    .          TCP,   RFC-7766 DNS Transport over TCP ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://tools.ietf.org/html/rfc7766</a> ).    ,  :      TLS,   TCP   ( ,       DNS  TCP,      TLS-  TCP-,     ). </p><br><h3 id="ustanovka-tls-soedineniya">  TLS- </h3><br><p>  TLS-           ,       ,   .  ,         TLS-,       .  RFC-7858 -        : </p><br><pre> <code class="plaintext hljs">In order to amortize TCP and TLS connection setup costs, clients and servers SHOULD NOT immediately close a connection after each response. Instead, clients and servers SHOULD reuse existing connections for subsequent queries as long as they have sufficient resources. In some cases, this means that clients and servers may need to keep idle connections open for some amount of time. () https://tools.ietf.org/html/rfc7858#section-3.4</code> </pre> <br><p>       ,   TLS-,   ,     ,   ,   ,       .   ,        30 ,   ,      ,        DNS-.  30  ~  ~   ,   15  60 ,         .        ,         .   - . </p><br><p> TLS-     NodeJS.    ,    TLS-     : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tls = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'tls'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TLS_SOCKET_IDLE_TIMEOUT = <span class="hljs-number"><span class="hljs-number">30000</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    ,     TLS- function Module(connectionOptions, funcOnData, funcOnError, funcOnClose, funcOnEnd) { let socket; function connect() { socket = tls.connect(connectionOptions, () =&gt; { console.log('client connection established:', socket.authorized ? 'authorized' : 'unauthorized'); }); socket.on('data', funcOnData); // connection.on('end', () =&gt; {}); socket.on('close', (hasTransmissionError) =&gt; { //   ,     . //   ,     console.log('connection closed; transmission error:', hasTransmissionError); }); socket.on('end', () =&gt; { console.log('remote TLS server connection closed.') }); socket.on('error', (err) =&gt; { console.log('connection error:', err); console.log('\tmessage:', err.message); console.log('\tstack:', err.stack); }) socket.setTimeout(TLS_SOCKET_IDLE_TIMEOUT); socket.on('timeout', () =&gt; { console.log('socket idle timeout, disconnected.'); socket.end(); }); } this.write = function (dataBuf) { if (socket &amp;&amp; socket.writable) { //  ,     } else { connect(); } socket.write(dataBuf); } return this; } module.exports = Module;</span></span></code> </pre> <br><p> <em> 5. ,   TLS-</em> </p><br><p>       DNS-over-TLS ,   Google DNS.        ,               <code>socket = tls.connect(connectionOptions, () =&gt; {})</code> .     NodeJS: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://nodejs.org/api/tls.html#tls_tls_connect_options_callback</a> ,       . </p><br><p>  TLS-   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">port</span></span>: config.upstreamDnsTlsPort, <span class="hljs-comment"><span class="hljs-comment">//        host: config.upstreamDnsTlsHost } const onData = (data) =&gt; { //     , .       7 }; remoteTlsClient = new TlsClient(options, onData);</span></span></code> </pre> <br><p> <em> 6.  TLS-</em> </p><br><p>     ,        TCP-.   TCP/TLS-      DNS-,     ,    ,     ,   .    TCP (  TLS),  DNS-   512 ,    UDP (,  EDNS    UDP  ).  ,  DNS-    UDP,             .       <strong>onData()</strong>   6. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onData = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    DNS-,       TLS-   //    ,     2 ,       let dataCurrentPos = 0; try { while (dataCurrentPos &lt; data.length) { const respLen = data.readUInt16BE(dataCurrentPos); respBuf = data.slice(dataCurrentPos + 2, dataCurrentPos + 2 + respLen); const respData = functions.parseDnsMessageBytes(respBuf); const requestKey = functions.getRequestIdentifier(respData); const localResponseParams = localRequestsAwaiting.get(requestKey); localRequestsAwaiting.delete(requestKey); server.send(respBuf, localResponseParams.port, localResponseParams.address, (err, bytesNum) =&gt; {}); dataCurrentPos += 2 + respLen; } } catch (err) { console.error(err); //   ,     throw err; } };</span></span></code> </pre> <br><p> <em> 7.   TLS-   DNS-   6</em> </p><br><h3 id="poryadok-otvetov-ot-udalyonnogo-dns-servera">     DNS- </h3><br><p>  ,            ,     .   ,         ID     QNAME, QTYPE  QCLASS  <em>Question</em> : </p><br><pre> <code class="plaintext hljs">Since pipelined responses can arrive out of order, clients MUST match responses to outstanding queries on the same TLS connection using the Message ID. If the response contains a Question Section, the client MUST match the QNAME, QCLASS, and QTYPE fields. () https://tools.ietf.org/html/rfc7858#section-3.3</code> </pre> <br><p>     ,  ,    ,   ID   <em>Question</em> (   ,      ). </p><br><p>        UDP (.  4),    ,         -,    ,   UDP-     .        ,       DNS-,       .          ,       -.  ,         ,      UDP-         -.  ,  ,    . </p><br><p>      TLS,               .         (IP  ),    ,       . </p><br><p>        IP      "-".   ,    ,   ,     DNS-.   ,    ,         IP  ,     .        7: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//        const requestKey = functions.getRequestIdentifier(respData); //    IP    ,   const localResponseParams = localRequestsAwaiting.get(requestKey); localRequestsAwaiting.delete(requestKey); //      IP   server.send(respBuf, localResponseParams.port, localResponseParams.address, (err, bytesNum) =&gt; {});</span></span></code> </pre> <br><p> <em> 8.        7</em> </p><br><p>      TLS-: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   ,     const localReqParams = { address: linfo.address, port: linfo.port }; //        const requestKey = functions.getRequestIdentifier(dnsRequest); //       localRequestsAwaiting.set(requestKey, localReqParams); //       ,      const lenBuf = Buffer.alloc(2); lenBuf.writeUInt16BE(localReq.length); const prepReqBuf = Buffer.concat([lenBuf, localReq], 2 + localReq.length); remoteTlsClient.write(prepReqBuf); //  RFC-7766 p.8, 2               </span></span></code> </pre> <br><p> <em> 9.    DNS-  TLS- (  .  4)</em> </p><br><h2 id="chtenie-konfiguracii-iz-fayla-i-eyo-obnovlenie">        </h2><br><p>   ,   ,      .     JSON,    ,   NodeJS   JSON-      .  JSON â€”      ,      .  ,    JSON-  "comment" (  )       . ,  ,  ,    ,  .  ,        ,     .      ,   -  ,    ,            NodeJS.    ,   ,     .  ,         ,       ;   ,   .           ,     - . </p><br><div class="spoiler"> <b class="spoiler_title"> 10.     </b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CONFIG_FILE_PATH = path.resolve(<span class="hljs-string"><span class="hljs-string">'./config.json'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Module</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// config  -,       . //    config        , //         . ,    : // const conf = config; //   conf     ,    : // const requestsToForge = config.requestsToForge; //    , requestsToForge   . const config = {}; Object.defineProperty(this, 'config', { get() { return config; }, enumerable: true }) this.initConfig = async function() { const fileContents = await readConfigFile(CONFIG_FILE_PATH); console.log('initConfig:'); console.log(fileContents); console.log('fileContents logged ^^'); const parsedConfigData = parseConfig(fileContents); Object.assign(config, parsedConfigData); }; async function readConfigFile(configPath) { const promise = new Promise((resolve, reject) =&gt; { fs.readFile(configPath, { encoding: 'utf8', flag: 'r' }, (err, data) =&gt; { if (err) { console.log('readConfigFile err to throw'); throw err; } resolve(data); }); }) .then( fileContents =&gt; { return fileContents; } ) .catch(err =&gt; { console.log('readConfigFile error: ', err); }); return promise; } function parseConfig(fileContents) { const configData = JSON.parse(fileContents); return configData; } //   ,       . //  Windows,    fs.watch     , //      ,   configReadInProgress let configReadInProgress = false; fs.watch(CONFIG_FILE_PATH, async () =&gt; { if(!configReadInProgress) { configReadInProgress = true; console.log('===== config changed, run initConfig() ====='); try { await this.initConfig(); } catch (err) { console.log('===== error initConfig(), skip =====,', err); configReadInProgress = false; } configReadInProgress = false; } else { console.log('===== config changed, initConfig() already running, skip ====='); } }); } let instance; async function getInstance() { if(!instance) { instance = new Module(); await instance.initConfig(); } return instance; } module.exports = getInstance;</span></span></code> </pre> <br><p> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¸…å•10.é˜…è¯»å™¨å’Œé…ç½®æ›´æ–°æ¨¡å—</font></font></em> </p></div></div><br><h2 id="itogo"> åˆè®¡ </h2><br><p>    DNS-  NodeJS,     <em>npm</em>   .    ,        ,   ,  ,         . </p><br><p> <strong><a href="">   GitHub</a></strong> </p><br><h3 id="istochniki"> : </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RFC-1035</a> DOMAIN NAMES â€” IMPLEMENTATION AND SPECIFICATION </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RFC-7858</a> Specification for DNS over Transport Layer Security (TLS) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RFC-7766</a> DNS Transport over TCP â€” Implementation Requirements </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://stackoverflow.com/questions/4082081/requesting-a-and-aaaa-records-in-single-dns-query/4083071#4083071</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN440050/">https://habr.com/ru/post/zh-CN440050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN440036/index.html">è§¦æ‘¸æ‰“å­—</a></li>
<li><a href="../zh-CN440040/index.html">åœ¨å‘å±•ä¸­-å„è‡ªä¸ºæˆ˜ã€‚ ä½†æ˜¯æœ‰æ—¶å€™è¿™ä¼šå¯¼è‡´æ­»èƒ¡åŒã€‚</a></li>
<li><a href="../zh-CN440044/index.html">é«˜é€šè¯¦ç»†å†å²</a></li>
<li><a href="../zh-CN440046/index.html">å…¬å¼€è¯¾â€œåœ¨Springä¸Šåˆ›å»ºRESTå®¢æˆ·ç«¯â€</a></li>
<li><a href="../zh-CN440048/index.html">æœ€å–œæ¬¢çš„æŒ‡æ ‡ï¼šæ¯ä¸ªé”€å”®å›¢é˜Ÿéƒ½å¿…é¡»éµå¾ªçš„5ä¸ªæŒ‡æ ‡</a></li>
<li><a href="../zh-CN440052/index.html">é™æ€BIOS / UEFIåˆ†ææˆ–å¦‚ä½•è·å–ä¾èµ–å…³ç³»å›¾</a></li>
<li><a href="../zh-CN440054/index.html">ä½¿ç”¨AWSå°†WebæœåŠ¡ä¼ è¾“åˆ°Yandex.Cloud</a></li>
<li><a href="../zh-CN440058/index.html">2018-2019å¹´äº’è”ç½‘é—®é¢˜å’Œå¯ç”¨æ€§æŠ¥å‘Š</a></li>
<li><a href="../zh-CN440060/index.html">Apache Igniteä¸Šçš„TensorFlow</a></li>
<li><a href="../zh-CN440062/index.html">è§„åˆ’æ„‰å¿«ã€‚ æˆ‘ä»¬å¦‚ä½•åœ¨æ²¡æœ‰ç»ç†çš„æƒ…å†µä¸‹å»ºç«‹æµç¨‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>