<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêù ‚ÜñÔ∏è üë± Active Restore: la reprise apr√®s sinistre peut-elle √™tre plus rapide? Beaucoup plus vite? üë∑üèº üßë‚Äçü§ù‚Äçüßë üîâ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La sauvegarde de donn√©es importantes est une bonne chose. Mais que se passe-t-il si le travail doit √™tre poursuivi imm√©diatement et que chaque minute ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Active Restore: la reprise apr√®s sinistre peut-elle √™tre plus rapide? Beaucoup plus vite?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acronis/blog/477658/">  La sauvegarde de donn√©es importantes est une bonne chose.  Mais que se passe-t-il si le travail doit √™tre poursuivi imm√©diatement et que chaque minute compte?  Chez Acronis, nous avons d√©cid√© de v√©rifier dans quelle mesure il est possible de r√©soudre la t√¢che de d√©marrage du syst√®me le plus rapidement possible.  Et c'est le premier article de la s√©rie Active Restore dans lequel je vais vous dire comment nous avons commenc√© le projet avec Innopolis University, quelle solution nous avons trouv√©e et sur quoi nous travaillons aujourd'hui.  D√©tails - sous la coupe. <br><br><img src="https://shydyrond.ru/backend/uploads/Kak%20uvelichit%27%20skorost%27%20raboty%20komp%27yutera/kak-uvelichit-skorost-raboty-kompyutera.jpg" alt="image"><br><a name="habracut"></a><br>  Salut  Je m'appelle Daulet Tumbaev et aujourd'hui, je veux partager avec vous mon exp√©rience dans le d√©veloppement d'un syst√®me qui acc√©l√®re la reprise apr√®s sinistre.  Pour parler de l'ensemble du chemin de d√©veloppement du projet, commen√ßons un peu √† distance.  Je travaille actuellement chez Acronis, mais je suis √©galement dipl√¥m√© de l'Universit√© Innopolis, que j'ai dipl√¥m√© du programme de ma√Ætrise en gestion du d√©veloppement logiciel (connu sous le nom de MSIT-SE).  Innopolis est une jeune universit√© et le programme est encore plus jeune.  Mais ensuite, il est construit sur le programme d'√©tudes de l'Universit√© Carnegie Mellon (Universit√© Carnegie Mellon), dans les r√©alisations desquelles il existe un sujet tel que les projets industriels. <br><br>  Le projet industriel a pour objectif de plonger l'√©tudiant dans un v√©ritable d√©veloppement et de consolider les connaissances acquises dans la pratique.  Pour ce faire, l'universit√© coop√®re avec des entreprises telles que Yandex, Acronis, MTC et des dizaines d'autres (au total, l'universit√© comptait 144 partenaires pour 2018).  Dans le cadre de la coop√©ration, les entreprises proposent leurs orientations de travail √† l'universit√©, et les √©tudiants choisissent l'un des projets les plus proches d'eux dans leur int√©r√™t et leur niveau de formation.  Il y a tout juste deux ans, j'√©tais toujours ¬´de l'autre c√¥t√© des barricades¬ª et je travaillais en tant qu'√©tudiant sur un autre projet Acronis.  Mais cette fois, je suis devenu consultant technique pour les √©tudiants de l'entreprise et j'ai propos√© le projet Active Restore √† Innopolis.  L'id√©e d'Active Restore a √©t√© formul√©e par l'√©quipe Kernel d'Acronis, mais le d√©veloppement de la solution a commenc√© avec l'Universit√© Innopolis. <br><br><h3>  Restauration active - pourquoi est-ce n√©cessaire? </h3> <br>  Traditionnellement, la reprise apr√®s sinistre fonctionne selon un sch√©ma standard.  Apr√®s des probl√®mes avec l'ordinateur, vous acc√©dez √† l'interface Web d'un syst√®me de sauvegarde, par exemple, Acronis True Image, et cliquez sur le gros bouton ¬´restaurer¬ª.  Ensuite, vous devez attendre N minutes, et seulement apr√®s cela, vous pouvez continuer √† travailler. <br><br><img src="https://habrastorage.org/webt/lr/qz/at/lrqzata7ct47-wrmeeiqxvrnoq8.jpeg"><br><br>  Le probl√®me est que ce nombre N, √©galement appel√© RTO (objectif de temps de r√©cup√©ration), le temps de r√©cup√©ration autoris√©, peut √™tre assez impressionnant, qui d√©pend de la vitesse de connexion (si la r√©cup√©ration √† partir du cloud se produit), du volume du disque dur de votre ordinateur et un certain nombre d'autres facteurs.  Peut-il √™tre r√©duit?  Oui, vous le pouvez, car pour reprendre le travail, vous n'avez pas toujours besoin d'un disque d'ordinateur complet.  Les m√™mes photos et vid√©os n'affectent pas les fonctionnalit√©s de l'appareil et peuvent √™tre remont√©es plus tard en arri√®re-plan. <br><br><h3>  Pilote n√©cessaire ... </h3><br>  Le syst√®me d'exploitation pr√©voit de d√©marrer avec un disque enti√®rement termin√©.  Par cons√©quent, Windows effectue une s√©rie de v√©rifications de l'int√©grit√© du disque.  Le syst√®me ne permettra pas un d√©marrage normal en l'absence ou en cas de dommages de certains fichiers que le syst√®me d'exploitation s'attend √† trouver.  Pour r√©soudre ce probl√®me, il a √©t√© d√©cid√© de mettre sur le disque les fichiers dits de redirection que nous avons cr√©√©s, qui remplacent les fichiers manquants ou endommag√©s, mais sont en fait des mannequins.  Cr√©er de tels redirecteurs n'est pas long, car en fait ils n'ont pas de contenu. <br><br>  Une r√©cup√©ration suppl√©mentaire se produit comme suit.  Processus d'arri√®re-plan, en parall√®le avec le fonctionnement du syst√®me d'exploitation, les ¬´nuls¬ª sont remplis de donn√©es.  Le processus de r√©cup√©ration en arri√®re-plan prend en compte la charge sur le disque et ne d√©passe pas la limite d√©finie.  Cependant, l'utilisateur ou le syst√®me d'exploitation lui-m√™me peut soudainement demander un fichier qui n'existe pas encore.  C'est l√† que le deuxi√®me mode de r√©cup√©ration entre en jeu.  La priorit√© du fichier demand√© est augment√©e au maximum et le processus de r√©cup√©ration t√©l√©charge d'urgence le fichier sur le disque.  Le syst√®me d'exploitation re√ßoit le fichier souhait√©, mais avec un l√©ger retard. <br><br>  Cela ressemble √† une image parfaite.  Cependant, dans le monde r√©el, il y a un grand nombre d'√©cueils et d'impasses potentielles.  Avec les √©tudiants de premier cycle d'Innopolis, nous avons d√©cid√© d'√©tudier ce sc√©nario de r√©tablissement, d'√©valuer le gain en RTO et de comprendre si cette approche est r√©alisable?  En effet, de telles d√©cisions sur le march√© n'existaient tout simplement pas √† l'√©poque. <br><br>  Et si je d√©cidais de c√©der le composant de service aux gars d'Innopolis, alors √† l'int√©rieur d'Acronis, le travail sur un <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ifs/file-system-minifilter-drivers">pilote de syst√®me de fichiers mini-filtre a</a> commenc√©.  Cela a √©t√© fait par l'√©quipe Windows Kernel.  Le plan √©tait le suivant: <br><br><ul><li>  Ex√©cutez le pilote √† un stade pr√©coce du d√©marrage du syst√®me d'exploitation, </li><li>  Pendant le fonctionnement, lorsque <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode">l'espace utilisateur</a> est enti√®rement pr√™t, t√©l√©chargez le service </li><li>  Le service traite les demandes des conducteurs et coordonne ses travaux ult√©rieurs. </li></ul><br><img src="https://habrastorage.org/webt/2a/vl/qf/2avlqfvl30ekh3xdix5xjwjggdu.jpeg"><br><h3>  Les subtilit√©s de l'ing√©nierie du pilote </h3><br>  Si mes coll√®gues parleront du service dans un autre article, alors dans ce texte, nous r√©v√©lerons les subtilit√©s du d√©veloppement des pilotes.  Le mini-filtre de pilote d√©j√† d√©velopp√© a deux modes de fonctionnement: lorsque le syst√®me a d√©marr√© en mode normal et lorsque le syst√®me vient de subir une d√©faillance et que sa r√©cup√©ration se produit.  Avant de charger les biblioth√®ques utilisateur et les applications, et donc notre service, le pilote se comporte de la m√™me mani√®re.  Il ne sait pas dans quel √©tat se trouve le syst√®me actuellement.  En cons√©quence, chaque cr√©ation, lecture et √©criture est enregistr√©e, toutes les m√©tadonn√©es sont enregistr√©es.  Et lorsque le service est en ligne, le pilote fournit ces informations au service. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x4/x0/0c/x4x00ccpfivzeboam8r6zdvx4re.png"></div><br>  Dans le cas d'un d√©marrage normal, le service transmet un signal ¬´Relax¬ª au conducteur pour qu'il se ¬´d√©tende¬ª et cesse d'enregistrer scrupuleusement toutes les donn√©es.  Dans ce cas, le pilote passe √† la journalisation uniquement des modifications sur le disque et les signale au service qui, √† l'aide d'autres outils Acronis, conserve la sauvegarde de disque dans l'√©tat le plus √† jour sur le support que l'utilisateur a d√©fini.  Cela peut √™tre une sauvegarde cloud, distante, progressive ou nocturne. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/34/he/x1/34hex17zyywzzuv7rlivamn46e0.png"></div><br>  Si le mode de r√©cup√©ration est activ√©, le service informe le pilote qu'il doit travailler en mode ¬´R√©cup√©ration¬ª.  Le syst√®me vient de r√©cup√©rer apr√®s une panne, et d√®s qu'il donne une demande d'ouverture d'un fichier sur le disque, le mini-filtre doit intercepter cette op√©ration, faire cette demande lui-m√™me, v√©rifier s'il y a un tel fichier sur le disque et s'il peut √™tre ouvert. <br><br>  S'il n'y a pas de fichier, le mini-filtre transf√®re ces informations au service, ce qui augmente la priorit√© de r√©cup√©ration des fichiers (pendant tout ce temps, la r√©cup√©ration est en cours).  Il s'av√®re que ce fichier saute juste au d√©but de la file d'attente.  Apr√®s cela, le service lui-m√™me (ou par d'autres outils Acronis) restaure ce fichier et indique au pilote que tout va bien, maintenant le syst√®me d'exploitation peut y acc√©der et le pilote ¬´lib√®re¬ª la demande d'origine, du syst√®me vers le disque. <br><br>  Si la r√©cup√©ration n'est pas possible, le service informe le pilote qu'il n'y a pas non plus de fichier dans la sauvegarde.  Notre pilote de mini-filtre ignore simplement la demande syst√®me et le demandeur d'origine (le syst√®me d'exploitation lui-m√™me ou l'application) re√ßoit une erreur ¬´fichier introuvable¬ª.  Cependant, cela est tout √† fait normal si le fichier n'√©tait vraiment pas sur le disque et dans la sauvegarde. <br><br><img src="https://habrastorage.org/webt/yv/8w/qe/yv8wqetbjrg3kq2hkr2vosj8dve.png"><br><br>  Bien s√ªr, le syst√®me d'exploitation fonctionnera beaucoup plus lentement, car la lecture de tout fichier ou biblioth√®que se d√©roule en plusieurs √©tapes, et √©ventuellement avec acc√®s √† des ressources distantes.  Mais alors, l'utilisateur peut commencer √† travailler d√®s que possible pendant que la r√©cup√©ration est en cours. <br><br><h3>  Besoin plus bas, encore plus bas ... </h3><br>  Le prototype a fait ses preuves.  Mais nous avons √©galement constat√© la n√©cessit√© de continuer, car dans certains cas, des blocages se produisent toujours.  Par exemple, le syst√®me d'exploitation peut demander diverses biblioth√®ques dans plusieurs threads, ce qui entra√Æne la fermeture de notre service √† lui-m√™me. <br><br>  Le probl√®me sur lequel je travaille maintenant augmente la vitesse de la restauration active et augmente le niveau de s√©curit√© du syst√®me.  Supposons que le syst√®me n'ait pas besoin d'un fichier entier, seulement une partie de celui-ci est n√©cessaire.  Pour cela, un autre pilote a √©t√© d√©velopp√© - un pilote de filtre de disque.  Cela ne fonctionne plus sur le fichier, mais au niveau du bloc.  Le principe de fonctionnement est similaire: en fonctionnement normal, le pilote enregistre simplement les blocs modifi√©s sur le disque, et en mode de r√©cup√©ration, il essaie de lire le bloc par lui-m√™me, en cas d'√©chec, il demande au service d'augmenter la priorit√©.  Cependant, toutes les autres parties du syst√®me restent les m√™mes.  Par exemple, un service au niveau du syst√®me d'exploitation ne soup√ßonne m√™me pas qu'il est propos√© de communiquer avec un autre pilote, car la t√¢che principale consiste √† fournir au syst√®me d'exploitation exactement les donn√©es n√©cessaires au fonctionnement.  Cette direction n√©cessite des am√©liorations importantes, ne serait-ce que parce que le service ne sait toujours pas penser au niveau du bloc. <br><br>  L'√©tape suivante, j'ai d√©cid√© d'ex√©cuter le pilote plus en profondeur et plus t√¥t, en passant au niveau des pilotes UEFI et des applications Windows natives au lieu du service.  Pour cela, un <a href="https://edk2-docs.gitbooks.io/edk-ii-uefi-driver-writer-s-guide/3_foundation/37_uefi_images/372_drivers.html">pilote de d√©marrage UEFI</a> (ou pilote DXE) a √©t√© d√©velopp√©, qui d√©marre et s'√©teint avant le d√©marrage du syst√®me d'exploitation.  Mais l '¬´historique¬ª des pilotes UEFI, les d√©tails de l'assemblage et de l'installation, ainsi que les sp√©cificit√©s des applications natives Windows, nous en tiendrons compte dans le prochain billet.  Alors abonnez-vous √† notre blog, et pour l'instant je vais pr√©parer une histoire sur la prochaine √©tape du travail.  Je serais heureux de vos commentaires et conseils. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr477658/">https://habr.com/ru/post/fr477658/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr477646/index.html">Les math√©maticiens coupent des formes √† la recherche de parties d'√©quations</a></li>
<li><a href="../fr477648/index.html">MVCC dans PostgreSQL-3. Versions en ligne</a></li>
<li><a href="../fr477650/index.html">Cryptage du trafic TLS selon les algorithmes GOST-2012 avec Stunnel</a></li>
<li><a href="../fr477654/index.html">Essayer l'op√©rateur instanceof am√©lior√© dans Java 14</a></li>
<li><a href="../fr477656/index.html">Alors, pourquoi avez-vous besoin de faire?</a></li>
<li><a href="../fr477662/index.html">Acc√®s aux pneus Redd sur les ponts FTDI</a></li>
<li><a href="../fr477668/index.html">29 novembre, 18 h - devleads-mitap</a></li>
<li><a href="../fr477670/index.html">Ce qui donne l'automatisation des tests</a></li>
<li><a href="../fr477672/index.html">Droits et obligations des membres de l'√©quipe: aspects juridiques et culturels</a></li>
<li><a href="../fr477674/index.html">AI signifie amour?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>