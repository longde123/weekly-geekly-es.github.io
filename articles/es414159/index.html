<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôçüèæ üóíÔ∏è ü§≤ Notas del proveedor de IoT. LoRaWAN y RS-485 ‚èØÔ∏è ü§òüèº üí¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola queridos amantes de Internet de las cosas. Contin√∫o mi serie de art√≠culos. 
 Parte uno ‚Üí Parte dos ‚Üí Parte tres ‚Üí Parte cuatro ‚Üí Parte cinco 



...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Notas del proveedor de IoT. LoRaWAN y RS-485</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414159/"><p>  Hola queridos amantes de Internet de las cosas.  Contin√∫o mi serie de art√≠culos. </p><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte uno</a> ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dos</a> ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tres</a> ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte cuatro</a> ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte cinco</a> <br><br><p>  Entonces, aprendimos c√≥mo trabajar con la salida de pulso de los contadores y el cifrado masterizado.  ¬øCu√°l es el siguiente paso?  La respuesta es obvia.  RS-485. <br><br>  Un poco de teor√≠a  RS-485 (Est√°ndar recomendado) es una interfaz asincr√≥nica de capa f√≠sica.  Obtuvo una inmensa popularidad en Internet industrial, que abarca desde servicios p√∫blicos y termina en varias f√°bricas y empresas. </p><br><p>  En principio, casi cualquier medidor que quiera darnos no uno, sino varios par√°metros, muy probablemente, estar√° equipado con RS-485.  Con menos frecuencia, RS-232 o M-Bus, pero por ahora dej√©moslos a un lado y analicemos el ejemplo m√°s revelador.  M√°s precisamente, problemas para trabajar con √©l. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/mv/l-/1o/mvl-1ovohfb0plrjqkcajlcexdg.png"></div><a name="habracut"></a><br><h2>  Problema de velocidad </h2><br><p>  RS-485 es un est√°ndar cableado.  LoRa: inal√°mbrico.  Es l√≥gico que debe haber un cierto dispositivo capaz de hacer amigos con ellos. <br><br>  De acuerdo  Casi todos los fabricantes del terminal en la l√≠nea tienen un m√≥dulo de radio con soporte RS-485.  Funciona seg√∫n el principio de un canal transparente.  Todos los paquetes que pasan por el cable se empaquetan como una carga √∫til de paquetes LoRaWAN y se env√≠an a la transmisi√≥n.  O son recibidos y convertidos en impulsos el√©ctricos. </p><br><p>  Y aqu√≠ est√° el primer problema.  RS-485 es una interfaz de muy alta velocidad.  Los paquetes en √©l van a velocidades de varios kilobits / seg o incluso varias decenas.  Por ejemplo, una de las velocidades t√≠picas de Modbus es 9.6 kbit / s. </p><br><p>  LoRa, incluso con el mejor SF = 7 (125 kHz, 4/5) exprimir√° 5,5 kbit / s.  Con mayor SF habr√° a√∫n menos. <br><br>  Esto significa que el estudio de los valores de algunos medidores el√©ctricos no tomar√° segundos, y ni siquiera decenas de segundos.  El puntaje durar√° minutos.  Y esto es con un tiempo de espera ajustado adecuadamente.  Si deja la configuraci√≥n predeterminada, lo m√°s probable es que su encuesta termine en un error de tiempo de espera.  No menciono las restricciones sobre la longitud de los paquetes de LoRaWAN.  Solo hay problemas. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/bo/fc/1i/bofc1ir2_slwuqekzlcmtiwgc80.png"></div><br><h2>  Problema de sondeo </h2><br><p>  Con salidas de pulso, todo es simple.  Contamos los pulsos, los multiplicamos por el precio de divisi√≥n y obtenemos la lectura del medidor.  Cualquier interfaz simple puede manejar esto.  Y dicha interfaz, adem√°s de la simplicidad, ser√° m√°s universal. </p><br><p>  Con RS-485, todo es mucho peor.  Sorprendentemente, muchos no entienden una cosa importante. <br>  ¬°RS-485 NO ES UN PROTOCOLO DE INTERCAMBIO!  No especifica el formato de los paquetes que van dentro de √©l.  De hecho, es solo un medio de transmisi√≥n.  Solo se especifican las caracter√≠sticas el√©ctricas y temporales de la interfaz.  Eso es todo!  Todo en la parte superior ya debe desmontarse por separado. </p><br><p>  ¬°Y hay algo que desmontar!  Adem√°s de nuestro entorno, cada fabricante puede terminar lo que quiere.  Bueno, o lo que result√≥ ser conveniente para √©l personalmente.  Por ejemplo, el medidor de calor VKT-7 se comunicar√° con nosotros a trav√©s de ModBus.  Y Energomera - a trav√©s de GOST R IEC 61107-2001. </p><br><p>  Todos estos protocolos se superponen en el medio de transmisi√≥n desde arriba y tienen un nivel m√°s alto.  Cada protocolo tiene su propia composici√≥n del marco, requiere que sus propios equipos realicen ciertas acciones, proporciona un almacenamiento diferente (y, por lo tanto, sondeo) de valores.  Por lo tanto, cada dispositivo necesita su propio script de sondeo.  Adem√°s, incluso dentro del marco de un protocolo (el mismo ModBus), este script diferir√° de un dispositivo a otro. </p><br><p>  Los protocolos en s√≠ mismos no son secretos y, en su mayor parte, est√°n abiertos.  Adem√°s, el sitio web de cada fabricante a menudo contiene una utilidad gratuita con la que puede interrogar a los dispositivos.  Pero estas utilidades no son universales y est√°n afiladas para un fabricante.  Y recordamos que casi siempre tenemos un zool√≥gico de dispositivos.  Y poner varios programas en el cliente al mismo tiempo ... bueno, esto no es demasiado conveniente. </p><br><p>  Hay dos salidas.  O escribe algo tuyo.  O tome un programa en el que ya se hayan compilado los scripts de sondeo para los dispositivos m√°s populares.  Hay muchas soluciones preparadas en el mercado, por ejemplo, "contabilidad LERS" o "YaEnergetik".  Pero se les paga y cuestan mucho dinero.  As√≠ como el desarrollo de su software. <br><br>  Adem√°s, si hablamos de Internet industrial (es decir, vamos m√°s all√° del marco de la vivienda y los servicios comunales), las soluciones universales ya no le ayudar√°n.  Como ser </p><br><p>  De ninguna manera </p><br><p>  Si todav√≠a planea sondear a trav√©s de LoRa a trav√©s de un canal transparente, a√∫n se encontrar√° con l√≠mites de velocidad y tiempos de espera.  Puede que no sea inmediato y no con el primer dispositivo, pero suceder√°. </p><br><h2>  Problema est√°ndar </h2><br><p>  Adem√°s de todos los problemas, tenemos uno m√°s.  Porque  RS-485 implica que podemos contactar el dispositivo en cualquier momento, el m√≥dulo de radio LoRa con su soporte debe ser de clase C. Es decir, siempre escuche la transmisi√≥n y est√© listo para responder. <br><br>  Perm√≠tame recordarle que la clase C no implica energ√≠a de la bater√≠a, pero el problema no es tan grave.  T√≠picamente, el RS-485 es donde se puede obtener energ√≠a externa. </p><br><p>  Peor es otro. <br><br>  Por ley, podemos operar en dos rangos de frecuencia.  ¬øRecuerdas el l√≠mite de 864-865 MHz?  ¬øNo m√°s del 0.1% del tiempo en el aire?  Esto significa que cada dispositivo tomado por separado puede estar en el aire, por ejemplo, no m√°s de 3.6 segundos por hora.  Pero durante este tiempo, en SF = 12 ni siquiera enviaremos tres paquetes. <br><br>  Puede intentar exprimir al m√°ximo los canales 868.7-869.2.  Sin embargo, otra restricci√≥n de los est√°ndares regionales de especificaci√≥n LoRaWAN entra en vigencia aqu√≠: no m√°s del 1 por ciento del tiempo de aire para cada dispositivo terminal (ciclo de trabajo).  OK, ya m√°s f√°cil, 36 segundos.  Solo que el sentido todav√≠a no es realmente. </p><br><p><img src="https://habrastorage.org/webt/e5/li/l4/e5lil4lqoixst3yyl6ong-c8j1k.png"></p><br><p>  En alg√∫n momento, podemos decir: ¬°oh, ellos, estas tonter√≠as!  ¬°Me sentar√© en el aire todo el tiempo que sea necesario!  Pero luego aparece: </p><br><h2>  Problema de capacidad de √©ter </h2><br><p>  LoRa no es en vano intercambiando paquetes cortos y raros.  De hecho, todo el est√°ndar se basa en esto.  Es necesario que cada dispositivo tome el menor tiempo posible en el aire.  Luego, reduciremos el riesgo de colisiones y podremos lograr esa densidad fant√°stica de varios miles de radim√≥dulos por BS.  ¬øQu√© suceder√° si un m√≥dulo de radio garabatea en paquetes como una ametralladora?  Su frecuencia est√° ocupada en el momento de la transmisi√≥n.  Y en el momento de la respuesta, todas las frecuencias est√°n ocupadas, ya que  la estaci√≥n base no escucha nada cuando se transmite. </p><br><p>  Por supuesto, nadie cancel√≥ los retrasos para aumentar la capacidad.  Es decir  Si hay dos BS en el √°rea de cobertura de un m√≥dulo de radio, uno seguir√° respondiendo y el segundo puede escuchar alg√∫n otro paquete.  Sin embargo, el √©ter no es de goma.  Si cada m√≥dulo de radio tomar√° un minuto para intercambiar paquetes, entonces en una hora no podemos colgar m√°s de 60 dispositivos terminales por BS, esto est√° sujeto a la ausencia de colisiones.  Muy poco, especialmente si recuerdas que el radio de acci√≥n de cada BS en la ciudad es de aproximadamente 2 km, o tal vez m√°s. </p><br><h2>  Entonces no? </h2><br><p>  Resulta que nuestra red LoRaWAN est√° limitada solo a dispositivos con salida de pulso y sistemas de vigilancia, ¬ød√≥nde se registra el hecho de un viaje? </p><br><p>  No <br><br>  Solo tratamos de usar el concepto de Internet de las personas donde esto no se puede hacer.  De acuerdo, es un h√°bito para nosotros usar excesivamente un canal de Internet estable.  Por ejemplo, abra un video, tomando acciones en el b√∫fer y no mire.  Es decir  el tr√°fico pasar√°, pero de hecho no se utilizar√°. <br><br>  Sin embargo, todo es diferente aqu√≠.  Tenemos poca velocidad, tampoco hay tiempo en el aire.  Debe usarse con moderaci√≥n.  ¬øQu√© se te ocurre? </p><br><p>  La respuesta est√° en la superficie.  No conduzca un mont√≥n de tr√°fico de sobrecarga de protocolo a trav√©s de RS-485 a trav√©s de LoRa. <br><br>  La secuencia de comandos de sondeo se puede descargar en el propio m√≥dulo de radio.  Interrogar√° el medidor en el lugar con cierta frecuencia y nos enviar√° solo valores secos, previamente acordados. </p><br><p>  Este m√©todo tiene dos desventajas: </p><br><p></p><ul><li>  Tal m√≥dulo de radio requiere ciertos recursos inform√°ticos.  Este no es un gran problema en el nivel actual de desarrollo tecnol√≥gico. </li><li>  Tal m√≥dulo de radio consume m√°s energ√≠a.  Pero en el caso de un canal transparente, nos vemos obligados a usar la clase C, que tampoco funciona con bater√≠as.  Eso es lo que es. </li></ul><br><p>  Pero obtenemos toda la informaci√≥n que necesitamos en 2-3 paquetes.  Y luego todo encajar√° en uno, si necesita literalmente varios par√°metros.  De hecho, a menudo sucede que no necesitamos pasar TODO, un conjunto de valores bastante limitado. <br><br>  El m√≥dulo de radio puede transmitir datos, por ejemplo, una vez por hora.  Y en el lado del servidor, los pondremos en almacenamiento.  Si necesita acceder al archivo, el servidor ni siquiera tiene que sondear el dispositivo. </p><br><p>  Por supuesto, debe tener alg√∫n tipo de m√≥dulo de radio universal en el que se carguen varios scripts.  Y una interfaz capaz de percibir dicha informaci√≥n.  Esta no es una manera f√°cil, pero solo cumple con todos los requisitos y limitaciones. <br><br>  En este momento, m√°s y m√°s fabricantes est√°n tomando esta decisi√≥n.  Vega est√° preparando dispositivos similares; icbcom, ORION M2M y otros ya lo tienen. <br><br>  Porque  Si usamos una interfaz autoescrita, entonces tenemos desarrollos similares.  En alg√∫n momento, qued√≥ claro que si no profundiz√°bamos, simplemente no podr√≠amos trabajar. </p><br><p>  Adem√°s de los trucos para ahorrar tr√°fico, a√∫n necesitamos una buena red en la que los dispositivos funcionen a una velocidad m√≠nima y m√°xima de SF.  Lo enfatizo, no es una red en la que todos los dispositivos con SF = 7.  A√∫n no lograr√°s esto. </p><br><p>  Tal red que busca SF = 7.  Esto significa planificaci√≥n competente y ADR. </p><br><p>  En la salida, obtenemos velocidades suficientes para que viajen los paquetes, todav√≠a una gran cantidad de m√≥dulos de radio por BS y la capacidad de trabajar con interfaces de un nivel superior a la salida de pulso.  Lo cual fue requerido. </p><br><p>  PD Colegas, estoy agradecido a todos por los comentarios.  Dime, ¬øtodav√≠a est√°s interesado en aprender sobre LoRaWAN o el Internet de las cosas?  Las respuestas pueden escribirme en PM o en los comentarios.  Para las solicitudes m√°s interesantes o masivas, se publicar√°n art√≠culos. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414159/">https://habr.com/ru/post/es414159/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414141/index.html">7 reglas para dise√±ar placas de circuito impreso</a></li>
<li><a href="../es414149/index.html">Las razones del mal sonido de la mayor√≠a de los tel√©fonos inteligentes Android</a></li>
<li><a href="../es414151/index.html">Fintech-digest: los bancos informar√°n da√±os por ataques de hackers, Western Union se niega a trabajar con criptomonedas</a></li>
<li><a href="../es414155/index.html">Sistemas de eventos en Unity3D</a></li>
<li><a href="../es414157/index.html">M√°s f√°cil de lo que parece. Cap√≠tulos 6-7</a></li>
<li><a href="../es414161/index.html">Choque de titanes de nuestros d√≠as: un debate entre V. Vapnik y L. Jakel sobre el futuro de SVM y las redes neuronales</a></li>
<li><a href="../es414163/index.html">Informe en vivo desde el nacimiento de un jugador importante en IA de hardware que acelera TensorFlow y compite con NVidia</a></li>
<li><a href="../es414165/index.html">Curso de aprendizaje profundo en dedos de los pies</a></li>
<li><a href="../es414167/index.html">Estado de giro "s√≥lido" en una red de panal artificial</a></li>
<li><a href="../es414169/index.html">Peque√±as historias de negocios: Vladivostok</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>