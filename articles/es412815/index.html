<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèæ üßóüèª ‚òîÔ∏è Administrador web Llaves de cliente OpenVPN VPNFace Lite ‚úåÔ∏è üë©üèø‚Äçü§ù‚Äçüë®üèæ ‚öìÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introducci√≥n 


 La creciente demanda de las letras m√°gicas VPN y sus razones, lejos de las tecnolog√≠as de red, ni siquiera es interesante para bromea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Administrador web Llaves de cliente OpenVPN VPNFace Lite</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412815/"><h1 id="intro">  Introducci√≥n </h1><br><p>  La creciente demanda de las letras m√°gicas VPN y sus razones, lejos de las tecnolog√≠as de red, ni siquiera es interesante para bromear. </p><br><blockquote>  Hola, eres bueno en computadoras?  ayudarme sobre vpn? </blockquote><a name="habracut"></a><br><p>  De hecho, incluso me alegra que las personas comiencen a aprender los conceptos b√°sicos de las redes de computadoras (¬øqu√© es vpn, qu√© sucede y por qu√© comienzan a abrirse diferentes sitios con √©l?), Y, si es posible, ayuda.  Intento impulsar los procesos de autoconfiguraci√≥n de mis propios servidores VPN, pero entiendo que <em>no todos son administradores de sistemas</em> , por lo que algunos amigos solo sugieren comprar un servidor y d√°rmelo para la configuraci√≥n. </p><br><p>  Pero cualquier programador debe ser flojo para no repetir lo mismo repetidamente.  Realizar las mismas acciones una y otra vez perfecciona las habilidades, pero mata todo el inter√©s del desarrollo y la creatividad (y el tiempo). </p><br><p>  Y as√≠, al configurar el tercer servidor VPN, me di cuenta de que era necesario automatizar todo esto y hacer que el <em>usuario sea f√°cil</em> , de modo que despu√©s de una breve instrucci√≥n, incluso el usuario m√°s com√∫n podr√≠a compartir la clave ovpn con un amigo o familiar.  Y a√∫n mejor: para instalar el sistema, el usuario podr√≠a independientemente con un m√≠nimo de habilidades y conocimientos. </p><br><p>  As√≠ naci√≥ el proyecto VPNFace: un conjunto de scripts de servidor para administrar las claves de usuario de los servidores OpenVPN y un panel de control web para ellos.  Y despu√©s de unos d√≠as de desarrollo, me sorprend√≠ pensando que en alg√∫n lugar alrededor del 25% de la funcionalidad que se establecer√° nunca ser√° reclamada por este mismo "usuario ordinario", y el prefijo Lite se agreg√≥ al nombre, y el concepto principal del proyecto cambi√≥ de <em>un dise√±ador de prop√≥sito general</em> a un <em>de mente estrecha herramienta</em> , que al mismo tiempo tambi√©n redujo significativamente el tiempo de desarrollo antes del lanzamiento. </p><br><p>  Por supuesto, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Esquema de Google VPN">bueno, nunca sucedi√≥</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="Pritunl">as√≠</a> , ¬øpor qu√© otro gerente de OpenVPN?  Para ser honesto, la idea de otros proyectos de gerentes vpn me vino a la mente cuando el n√∫cleo principal ya estaba funcionando, y vi todo tipo de peque√±as cosas.  Al principio estaba molesto porque era tan est√∫pido y ni siquiera hice un estudio m√≠nimo (porque no me gusta producir bicicletas), pero despu√©s de estudiar los proyectos anteriores, me di cuenta de que el m√≠o tambi√©n tiene su propio nicho. </p><br><p>  Caracter√≠sticas clave </p><br><ol><li>  Minimalismo funcional: un usuario com√∫n, cuando interact√∫a con vpn como administrador, requiere solo unas pocas funciones: crear una llave, bloquear y desbloquear.  Es poco probable que piense en crear otro servidor VPN si tiene uno que funcione o en escalar para cambiar los datos del centro de certificados.  Pocas personas necesitar√°n hermosos gr√°ficos de tr√°fico y la funcionalidad del servidor de la empresa, con el fin de <em>utilizar con calma un telegrama</em> . </li><li>  Minimalismo de software: el √∫nico programa que necesita el usuario es el cliente oficial de OpenVPN, disponible en todos los sistemas y dispositivos.  El panel de control de teclas es una aplicaci√≥n web que se ejecuta en un navegador.  La autorizaci√≥n administrativa se realiza mediante la clave vpn. </li><li>  Configuraci√≥n semi-fija: el 80 por ciento de los usuarios necesitan lo mismo, y no les importa qu√© direcciones IP est√°n dentro de las redes (ni siquiera saben que est√°n all√≠), otro 15% requiere un poco m√°s, pero, de manera similar, una y la misma Adem√°s, el 5% restante escribe cosas similares ellos mismos, implementando todo lo que necesitan en ellos, por lo que no puede preocuparse por ellos.  Sin embargo, el panel se puede conectar manualmente a los servidores ya abiertos vpn, o corregir los datos del certificado antes de la instalaci√≥n est√°ndar. </li><li>  Desprendimiento absoluto a las empresas de alojamiento u otros servicios de terceros: hay bastantes copias rotas en disputas sobre el alojamiento m√°s m√°gico, esto queda completamente a elecci√≥n del usuario.  El sistema operativo del servidor es m√°s importante para el script: est√° escrito en los sistemas Ubuntu / Debian, pero todos los servidores los tienen.  El sistema se mantendr√° tranquilo tanto en la red dom√©stica interna como en la corporativa. </li><li>  El proceso de instalaci√≥n m√°s simplificado en un servidor limpio reci√©n comprado: si se puede hacer algo sin la participaci√≥n del usuario, esto se hace mediante c√≥digo duro.  Porque Lite  S√≠, no fue posible lograr el instalador como Google Outline, requiere una conexi√≥n de usuario a trav√©s de ssh para comenzar la instalaci√≥n y una compra independiente del servidor, pero fue posible lograr ese conocimiento de "c√≥mo conectarse a trav√©s de ssh".  Con la "configuraci√≥n predeterminada", el usuario se configura con una configuraci√≥n "est√°ndar" sin ninguna pregunta. </li></ol><br><h1 id="panel-upravleniya-klyuchami">  Panel de control clave </h1><br><p>  Durante una instalaci√≥n predeterminada, se crean tres servidores VPN: administrador, Internet y oscuro: no es dif√≠cil adivinar los nombres, el primero sirve para el acceso del administrador al servidor y el panel de control de teclas (y ssh, si es necesario), el segundo libera a los usuarios inmediatamente a Internet, y el tercero lleva transparentemente todo el tr√°fico posible a la red tor (el tr√°fico udp excepto DNS no va a ninguna parte, y DNS va a tor) </p><br><p><img src="https://habrastorage.org/webt/3g/wh/lv/3gwhlv6hr0jbzvhfd6jfrjeldsm.png"></p><br><p>  Se decidi√≥ que el panel de control se hiciera en un sexto AngularJS nuevo ( <em>durante la instalaci√≥n, se descarga una versi√≥n compilada del panel, por lo que las bibliotecas angulares no son necesarias para el trabajo</em> ).  Me gusta el concepto de aplicaciones web, e intento desarrollar en esta direcci√≥n, si es posible.  Tambi√©n quer√≠a estudiar materiales angulares durante mucho tiempo para crear paneles de administraci√≥n de Google en varios proyectos. </p><br><p>  La gesti√≥n de claves, como ya se indic√≥, se simplifica al m√≠nimo: </p><br><p>  Nueva clave: </p><br><p><img src="https://habrastorage.org/webt/tr/ld/k_/trldk_mwy4vblg-n-pcdvh3gurk.png"></p><br><p>  Bloqueo de teclas: </p><br><p><img src="https://habrastorage.org/webt/b_/pa/i9/b_pai9e-us8hdshodi5irijqrm4.png"></p><br><p>  Desbloqueo clave: </p><br><p><img src="https://habrastorage.org/webt/4x/sd/hi/4xsdhithv5rglkaazhu9j1o1ptw.png"></p><br><p>  El bot√≥n de descarga proporciona el archivo ovpn terminado para la conexi√≥n. </p><br><p>  La ayuda m√≠nima para el usuario est√° integrada en el panel: </p><br><p><img src="https://habrastorage.org/webt/di/eb/ck/diebckjumhsfakj7hzkjmbaq4u4.png"></p><br><p>  Y la documentaci√≥n compilada se incluye en el proyecto, que por defecto aumenta para la subred administrativa en el puerto 81: </p><br><p><img src="https://habrastorage.org/webt/ty/2n/2i/ty2n2i9ntmsqykn74qffv7nrz5s.png"></p><br><p>  El significado de la versi√≥n Lite tambi√©n limita el soporte de idiomas: en este momento, todo el proyecto existe solo en ruso, y el multiling√ºismo ni siquiera est√° establecido en el n√∫cleo. </p><br><h1 id="servernaya-chast">  Lado del servidor </h1><br><p>  El lado del servidor se ejecuta en los scripts nodejs y bash.  ¬øPor qu√© un nodo?  Me gusta y tengo muchos proyectos sobre ella.  Tener una colecci√≥n vpn-manager me pareci√≥ una buena idea.  La secuencia de comandos de instalaci√≥n extrae el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">administrador de versiones de nodo</a> , instala el nodo v10 a trav√©s de √©l y crea un enlace a la carpeta de todo el sistema para que funcionen los servicios escritos en nodejs. </p><br><p>  Los paquetes instalados en el nodo tambi√©n son m√≠nimos: servicio para siempre, para siempre, para iniciar el proyecto como un servicio del sistema, express, para API web, shelljs, para ejecutar comandos de consola, direcci√≥n IP y calculadora de subred, salida de color de tiza a la consola.  Por supuesto, esta lista se puede acortar con el perfeccionismo del minimalismo, pero <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la segunda ley de Akin</a> naci√≥ claramente de la nada (la misma ley se puede aplicar a la pregunta "¬øpor qu√© nodejs?" Y algunas otras) y a pesar del deseo de minimalismo en otros temas, aqu√≠ Decid√≠ no profundizar. </p><br><p>  La secuencia de comandos del servidor gestiona los servidores openvpn a trav√©s de un conjunto de secuencias de comandos bash y requiere una estructura de archivo de directorio ra√≠z espec√≠fica y una configuraci√≥n de archivo openvpn.  Se utilizan dos archivos json como base de datos, lo que permite: </p><br><ol><li>  deshacerse de la interacci√≥n con bases de datos como mongo / sql y las dependencias y complicaciones relacionadas </li><li>  sin ning√∫n problema, prepare las "bases" (y la estructura de directorios y archivos) manualmente o mediante script, cuando instale en un servidor de trabajo configurado, cuando el instalador incluido en el kit pueda incluso ser da√±ino y deba evitarse el proceso de instalaci√≥n predeterminado (la necesidad de instalaci√≥n se verifica precisamente por la presencia y el contenido de json archivos de base de datos) </li></ol><br><p>  Una ventaja adicional del panel de control como una aplicaci√≥n web independiente fue la separaci√≥n de la funcionalidad del servidor en un conjunto separado de puntos finales http api, lo que abre la posibilidad de que los programas de terceros administren claves de usuario a trav√©s de solicitudes http regulares. </p><br><h1 id="prostaya-ustanovka-po-umolchaniyu">  Instalaci√≥n f√°cil (por defecto) </h1><br><p>  Se supone que dicha instalaci√≥n se ejecutar√° en servidores nuevos y limpios.  Si el servidor ya est√° configurado para algunas tareas, es mejor consultar la instalaci√≥n manual (para no da√±ar la funcionalidad existente). </p><br><p>  Me gusta la instalaci√≥n de nvm (administrador de versiones de nodo) en el que el usuario necesita ejecutar solo un comando en el terminal, que copia desde el sitio del proyecto, por lo que el instalador predeterminado funciona de la misma manera.  Mientras se ejecuta el script bash de instalaci√≥n de inicio, el paquete iptables-persistent le pedir√° al usuario que guarde las reglas actuales de iptables. </p><br><p><img src="https://habrastorage.org/webt/f_/vc/ke/f_vckeeni_hi396mjlwhkjmuuko.png"></p><br><p>  La elecci√≥n del usuario no hace ninguna diferencia, ya que al finalizar la instalaci√≥n, la √∫ltima acci√≥n reconfigurar√° el firewall y el nuevo conjunto de reglas sobrescribir√° la selecci√≥n actual.  Al final del trabajo, el script le pedir√° que complete la instalaci√≥n a trav√©s de la interfaz web. </p><br><p><img src="https://habrastorage.org/webt/ih/d2/-e/ihd2-en90hmiyiynxpqjexvxljc.png"></p><br><p>  La instalaci√≥n web comienza con la confirmaci√≥n de la direcci√≥n IP p√∫blica del servidor.  Por defecto, el script web toma datos de la url de la cadena del navegador.  Centr√°ndose en esta ip, el c√≥digo del servidor busca la interfaz de direcci√≥n de red para la configuraci√≥n futura del firewall y los servidores openvpn. </p><br><p><img src="https://habrastorage.org/webt/cs/mh/hg/csmhhgijn6e6epp86hfwemjtyc8.png"></p><br><p>  Despu√©s de recibir los datos de la red, el instalador crea un servidor vpn de administrador.  La generaci√≥n de claves criptogr√°ficas durante la configuraci√≥n del directorio ra√≠z lleva alg√∫n tiempo, y durante el desarrollo, en la misma m√°quina, este tiempo vari√≥ de 1 a 15 minutos. </p><br><p>  Cuando se crea e inicia el servidor, el instalador contin√∫a con el segundo paso, donde solicita al usuario que cree una clave de administrador. </p><br><p><img src="https://habrastorage.org/webt/ct/ib/r9/ctibr9x0ju5opuhykwxyhz4w0gc.png"></p><br><p>  Luego pasa al modo de espera para conectar el administrador vpn.  Se espera que vpn se conecte en el mismo dispositivo desde el que se realiza la instalaci√≥n. </p><br><p><img src="https://habrastorage.org/webt/ib/s-/am/ibs-am0zswrpurcj2izew-bwlws.png"></p><br><p>  Cuando un usuario se conecta al servidor vpn de administrador, est√° disponible en la direcci√≥n 10.1.0.1, y una solicitud jsonp de la p√°gina del instalador pasa con √©xito all√≠, lo que se convierte en una se√±al para redirigir la p√°gina a la direcci√≥n interna y completar la instalaci√≥n. </p><br><p><img src="https://habrastorage.org/webt/ug/uv/si/uguvsiqhx4tege1hc6opgol94dk.png"></p><br><p>  En la etapa final de la instalaci√≥n, se crean y configuran los dos servidores vpn restantes (tiempo para generar criptograf√≠a * 2), tor, nginx e iptalbles.  Al recibir una se√±al para completar la instalaci√≥n del lado del servidor, el script redirigir√° la p√°gina al panel de control principal. </p><br><h1 id="ruchnaya-ustanovka">  Instalaci√≥n manual </h1><br><p>  La instalaci√≥n manual del panel de control en la estructura de trabajo de los servidores OpenVPN requiere varios pasos y es t√©cnicamente factible por el administrador de Linux (y no creo que alguien m√°s que ellos pueda necesitar la instalaci√≥n manual): </p><br><ol><li>  preparaci√≥n del entorno de nodejs de acuerdo con los requisitos de seguridad del servidor actual y organizaci√≥n del script en la forma requerida (servicio, manual, etc.) </li><li>  preparando la estructura de archivos de datos y directorios del servidor, creando "bases de datos" json </li><li>  configurar el proxy nginx en el panel de control y la documentaci√≥n, si es necesario </li></ol><br><p>  Los detalles y detalles t√©cnicos se pueden encontrar en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠nea</a> . </p><br><h1 id="v-kachestve-zaklyucheniya">  En conclusi√≥n </h1><br><p>  Espero que el proyecto sea √∫til para alguien. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Repositorio de proyectos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Repositorio de c√≥digo fuente del panel web angular</a> <br>  El proyecto se distribuye bajo la licencia MIT y se publica en apoyo del movimiento DIGITAL RESITANCE. </p><br><p>  PD: desarrolle ideas por encima del techo, y fije el multiling√ºismo, y elimine los momentos codificados en el c√≥digo, y agregue funcionalidad para crear servidores, administrar enrutamiento y firewall, convertir el sistema en un <em>dise√±ador universal</em> , etc.  etc., pero ¬øc√≥mo y cu√°ndo se implementar√° todo esto?  Sin una pista, el futuro se mostrar√°. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es412815/">https://habr.com/ru/post/es412815/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es412805/index.html">Mis pasos, √©xitos y errores en el mundo del desarrollo de juegos con el ejemplo de un bot de juegos en Telegram</a></li>
<li><a href="../es412807/index.html">Notas del proveedor de IoT. Propiedad</a></li>
<li><a href="../es412809/index.html">Autenticaci√≥n de dos factores en el sitio utilizando un token USB. ¬øC√≥mo hacer seguro el acceso al portal de servicios?</a></li>
<li><a href="../es412811/index.html">C DevTools en Elbrus: informes v√≠vidos de HolyJS 2018 Piter</a></li>
<li><a href="../es412813/index.html">Encabezados HTTP innecesarios</a></li>
<li><a href="../es412819/index.html">Viernes de calentamiento para la mente: Karma perfecto para Habrahabr</a></li>
<li><a href="../es412821/index.html">Mira, mira, mira: ¬øcu√°l es la diferencia?</a></li>
<li><a href="../es412823/index.html">Entrevista en ingl√©s: c√≥mo hacerlo no es peor que el amigo del hijo de la madre</a></li>
<li><a href="../es412825/index.html">Dispositivos de bloque QEMU</a></li>
<li><a href="../es412827/index.html">Pavel Durov: despu√©s de la apelaci√≥n de ILV, Apple bloque√≥ las actualizaciones de Telegram en todo el mundo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>