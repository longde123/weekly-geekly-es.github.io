<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶å üè® üë¶üèª Como eu escrevi a biblioteca C ++ 11 padr√£o ou por que o impulso √© t√£o assustador? Cap√≠tulo 4.3 üöµüèª üë¶üèΩ üõÄüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Resumo das pe√ßas anteriores 
 Devido a restri√ß√µes na capacidade de usar compiladores C ++ 11 e, devido √† falta de altern√¢ncia, o boost queria escrever...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como eu escrevi a biblioteca C ++ 11 padr√£o ou por que o impulso √© t√£o assustador? Cap√≠tulo 4.3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418347/"><img src="https://habrastorage.org/webt/lr/zq/if/lrzqifvfeajppx2fdvqbxnwf4ce.png" alt="Continuamos a aventura." width="300" height="350" align="left"><h3>  Resumo das pe√ßas anteriores </h3><br>  Devido a restri√ß√µes na capacidade de usar compiladores C ++ 11 e, devido √† falta de altern√¢ncia, o boost queria escrever sua pr√≥pria implementa√ß√£o da biblioteca C ++ 11 padr√£o na parte superior da biblioteca C ++ 98 / C ++ 03 fornecida com o compilador. <br><br>  <b>Static_assert</b> , no <b>exceto</b> , <b>countof</b> foram implementados e, tamb√©m, depois de considerar todos os recursos n√£o padr√£o e de <b>defini√ß√£o do</b> compilador, surgiram informa√ß√µes sobre a funcionalidade suportada pelo compilador atual.  √â <b>inclu√≠da</b> sua pr√≥pria implementa√ß√£o do <b>nullptr</b> , que √© selecionada no est√°gio de compila√ß√£o. <br><br>  Chegou a <b>hora</b> de <b>type_traits</b> e todo esse "modelo especial de m√°gica".  Nas partes anteriores deste cap√≠tulo, examinamos minha implementa√ß√£o dos modelos b√°sicos da biblioteca padr√£o e, nesta parte, falaremos sobre a combina√ß√£o da t√©cnica SFINAE com modelos e um pouco sobre gera√ß√£o de c√≥digo. <br><br>  Link para o GitHub com o resultado de hoje para impacientes e n√£o leitores: <br><blockquote>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Compromissos e cr√≠ticas construtivas s√£o bem-vindos</a></b> </blockquote>  Mais modelos de C ++ em cat. <br><a name="habracut"></a><br><h4>  Sum√°rio </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1. Introdu√ß√£o</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cap√≠tulo 1. Viam supervadet vadens</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cap√≠tulo 2. #ifndef __CPP11_SUPPORT__ #define __COMPILER_SPECIFIC_BUILT_IN_AND_MACRO_HELL__ #endif</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cap√≠tulo 3. Localizando a Implementa√ß√£o NULLPTR Perfeita</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cap√≠tulo 4. C ++ Template Magic</a> <br>  .... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.1 Come√ßamos pequenos</a> <br>  .... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.2 Sobre quantos erros milagrosos o log compila para n√≥s</a> <br>  .... <b>4.3 Ponteiros e tudo-tudo-tudo</b> <br>  .... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4.4 O que mais √© necess√°rio para a biblioteca de modelos</a> <br>  Cap√≠tulo 5 <br>  ... <br><br><h3>  Cap√≠tulo 4. Modelo C ++ "m√°gico".  Continua√ß√£o </h3><br><h4>  4.3 Ponteiros e tudo-tudo-tudo </h4><br>  Nesta fase, eu s√≥ conseguia obter informa√ß√µes sobre se o tipo √© uma matriz para <i>std :: is_array</i> e foi poss√≠vel iniciar modelos para ponteiros.  A implementa√ß√£o tamb√©m foi trivial, mas n√£o sem suposi√ß√µes. <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// is_array template&lt;class&gt; struct is_array : public false_type { }; template&lt;class _Tp, std::size_t _Size&gt; struct is_array&lt;_Tp[_Size]&gt; : public true_type { }; /*template&lt;class _Tp&gt; struct is_array&lt;_Tp[]&gt;: public true_type { }; */</span></span></code> </pre> <br>  Uma especializa√ß√£o de modelo simples para matrizes de um determinado comprimento "captura" todos os tipos de matrizes; no entanto, o problema surge com o tipo incompleto <i>T []</i> (uma matriz sem especificar o comprimento).  O fato √© que esse tipo n√£o √© definido por alguns compiladores (C ++ Builder) ao especializar um modelo, e ainda n√£o encontrei uma solu√ß√£o universal aqui. <br><br>  Depois que a biblioteca foi ‚Äúensinada‚Äù a definir tipos internos, alinhamento na mem√≥ria de tipos, trabalhar com modificadores de tipos e outras coisas b√°sicas atrav√©s de modelos em tempo de compila√ß√£o, chegou a hora de apontadores e refer√™ncias. <br><br><img src="https://habrastorage.org/webt/ti/rp/mi/tirpmiwggsavcvlxyjbo8dlv5ee.png" alt="imagem" width="300" height="280" align="left">  No C ++, dois grupos de ponteiros podem ser distinguidos - ponteiros para membros da classe e ponteiros para outros objetos.  Por que essa separa√ß√£o √© importante para a implementa√ß√£o adicional da biblioteca padr√£o?  O fato √© que os ponteiros para os alunos t√™m uma diferen√ßa significativa de outros indicadores pela presen√ßa <b>disso</b> , ou seja,  ponteiro para um objeto desta classe.  E, por padr√£o, os ponteiros para um membro da classe t√™m uma sintaxe separada para defini√ß√£o, s√£o um tipo separado e n√£o podem ser representados por um ponteiro regular.  Na pr√°tica, isso se traduz no fato de que o tamanho de um ponteiro para um membro da classe geralmente √© maior que o tamanho de um ponteiro comum (que <i>==</i> <b>sizeof (void *)</b> ), porque  para implementar fun√ß√µes membro virtuais da classe, bem como armazenar <b>esse</b> ponteiro, os compiladores geralmente implementam ponteiros para um membro da classe como uma estrutura (leia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sobre</a> fun√ß√µes e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estrutura</a> virtuais).  A maneira de apresentar indicadores para os alunos √© deixada, de acordo com o padr√£o, a crit√©rio do compilador, mas lembraremos dessa diferen√ßa de tamanho e apresenta√ß√£o ao considerar mais c√≥digos. <br><br>  Para definir um ponteiro regular para um objeto, escreveremos um modelo <i>is_pointer</i> simples, bem como um modelo <i>is_lvalue_reference</i> para refer√™ncias a objetos (separamos <i>o</i> is_rvalue_reference, porque at√© o 11¬∫ padr√£o n√£o havia operador <i>&amp;&amp;</i> , bem como toda a sem√¢ntica do movimento): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> detail { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_pointer_helper</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> false_type { }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_pointer_helper</span></span></span><span class="hljs-class">&lt;_Tp*&gt; :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> true_type { }; } <span class="hljs-comment"><span class="hljs-comment">// is_pointer template&lt;class _Tp&gt; struct is_pointer : public detail::_is_pointer_helper&lt;typename remove_cv&lt;_Tp&gt;::type&gt;::type { }; // is_lvalue_reference template&lt;class&gt; struct is_lvalue_reference : public false_type { }; template&lt;class _Tp&gt; struct is_lvalue_reference&lt;_Tp&amp;&gt; : public true_type { };</span></span></code> </pre><br>  N√£o h√° mais nada fundamentalmente novo aqui, o mesmo foi feito nas partes anteriores deste cap√≠tulo.  Vamos continuar definindo ponteiros para objetos - agora vamos olhar para ponteiros para fun√ß√µes. <br><blockquote>  √â importante entender que uma fun√ß√£o e uma fun√ß√£o membro de uma classe s√£o entidades completamente diferentes de acordo com o padr√£o: <br><br><ul><li>  O primeiro ponteiro ser√° normal (um ponteiro para um objeto), o segundo ter√° um ponteiro para um membro da classe. </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (*func_ptr)(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  'func_ptr'    'void func(int){}' void (ClassType::*mem_func_ptr)(int); //  'mem_func_ptr'  -  'ClassType'  'void ClassType::func(int){}'</span></span></code> </pre><br><ul><li>  Voc√™ pode criar um link para o primeiro (link do objeto), mas n√£o pode criar um segundo link. </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (&amp;func_ref)(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  'func_ref'    'void func(int){}' //-------------------- //   -    </span></span></code> </pre></blockquote>  Aqui vou mencionar um pouco sobre gera√ß√£o de c√≥digo.  Como antes do C ++ 11 n√£o havia modelos com um n√∫mero vari√°vel de par√¢metros, todos os modelos em que poderia haver um n√∫mero diferente de par√¢metros foram <a href="">determinados por meio da especializa√ß√£o do modelo principal com um grande n√∫mero de par√¢metros</a> na entrada e sua inicializa√ß√£o pelos par√¢metros fict√≠cios padr√£o.  O mesmo se aplica √†s sobrecargas de fun√ß√µes, como  Tamb√©m n√£o havia macros com um n√∫mero vari√°vel de par√¢metros.  Como escrever de 60 a 70 linhas do mesmo tipo de especializa√ß√£o de modelos com as m√£os, sobrecarregar fun√ß√µes √© uma tarefa bastante mon√≥tona e in√∫til, al√©m de estar repleta da possibilidade de cometer um erro.Eu escrevi um gerador simples de c√≥digo para modelos e sobrecargas de fun√ß√µes para esses fins.  Decidi me limitar a definir fun√ß√µes para 24 par√¢metros e isso parece bastante complicado no c√≥digo, mas simples e claro: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> detail { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_ptr_helper</span></span></span><span class="hljs-class"> :</span></span> false_type {}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> &gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_ptr_helper</span></span></span><span class="hljs-class">&lt;R(*)()&gt; :</span></span> true_type {}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> &gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_ptr_helper</span></span></span><span class="hljs-class">&lt;R(*)(...)&gt; :</span></span> true_type {}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T0</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_ptr_helper</span></span></span><span class="hljs-class">&lt;R(*)(T0)&gt; :</span></span> true_type {}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T0</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_ptr_helper</span></span></span><span class="hljs-class">&lt;R(*)(T0 ...)&gt; :</span></span> true_type {};</code> </pre><br>  <b>...</b> <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T0</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T2</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T3</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T4</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T5</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T6</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T7</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T8</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T9</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T10</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T11</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T12</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T13</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T14</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T15</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T16</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T17</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T18</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T19</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T20</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T21</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T22</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T23</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T24</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_ptr_helper</span></span></span><span class="hljs-class">&lt;R(*)(T0, T1, T2, T3, T4, T5, T6, T7, T8, T9, T10, T11, T12, T13, T14, T15, T16, T17, T18, T19, T20, T21, T22, T23, T24)&gt; :</span></span> true_type {}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T0</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T2</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T3</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T4</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T5</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T6</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T7</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T8</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T9</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T10</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T11</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T12</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T13</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T14</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T15</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T16</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T17</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T18</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T19</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T20</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T21</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T22</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T23</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T24</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_ptr_helper</span></span></span><span class="hljs-class">&lt;R(*)(T0, T1, T2, T3, T4, T5, T6, T7, T8, T9, T10, T11, T12, T13, T14, T15, T16, T17, T18, T19, T20, T21, T22, T23, T24 ...)&gt; :</span></span> true_type {}; }</code> </pre><br>  Definimos os tipos familiares para n√≥s no cap√≠tulo anterior da t√©cnica SFINAE: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> detail { <span class="hljs-comment"><span class="hljs-comment">// SFINAE magic typedef char _yes_type; struct _no_type { char padding[8]; }; }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Mais algumas macros para conveni√™ncia</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> detail { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _IS_MEM_FUN_PTR_CLR \ template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(T::*const volatile*)(ARGS)); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(T::*const volatile*)(ARGS...)); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(T::*const volatile*)(ARGS) const); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(T::*const volatile*)(ARGS) volatile); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(T::*const volatile*)(ARGS) const volatile); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(T::*const volatile*)(ARGS...) const); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(T::*const volatile*)(ARGS...) volatile); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(T::*const volatile*)(ARGS...) const volatile); #ifdef _STDEX_CDECL _no_type _STDEX_CDECL _is_mem_function_ptr(...); #define _IS_MEM_FUN_CDECL_PTR \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__cdecl T::*const volatile*)(ARGS)); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__cdecl T::*const volatile*)(ARGS) const); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__cdecl T::*const volatile*)(ARGS) volatile); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__cdecl T::*const volatile*)(ARGS) const volatile); #define _IS_MEM_FUN_STDCALL_PTR \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__stdcall T::*const volatile*)(ARGS)); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__stdcall T::*const volatile*)(ARGS) const); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__stdcall T::*const volatile*)(ARGS) volatile); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__stdcall T::*const volatile*)(ARGS) const volatile); #define _IS_MEM_FUN_FASTCALL_PTR \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__fastcall T::*const volatile*)(ARGS)); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__fastcall T::*const volatile*)(ARGS) const); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__fastcall T::*const volatile*)(ARGS) volatile); \ template &lt;class R, class T TYPES &gt; \ _yes_type _is_mem_function_ptr(R(__fastcall T::*const volatile*)(ARGS) const volatile); #else _no_type _is_mem_function_ptr(...); #define _IS_MEM_FUN_CDECL_PTR #define _IS_MEM_FUN_STDCALL_PTR #define _IS_MEM_FUN_FASTCALL_PTR #endif #define _IS_MEM_FUN_PTR \ _IS_MEM_FUN_PTR_CLR \ _IS_MEM_FUN_CDECL_PTR \ _IS_MEM_FUN_STDCALL_PTR \ _IS_MEM_FUN_FASTCALL_PTR }</span></span></span></span></code> </pre><br></div></div><br>  As macros s√£o definidas para que seja relativamente conveniente redefinir <b>TYPES</b> e <b>ARGS</b> define como uma lista de tipos e par√¢metros, substituindo a macro <b>_IS_MEM_FUN_PTR para</b> gerar defini√ß√µes para todos os tipos de fun√ß√µes poss√≠veis pelo pr√©-processador.  Tamb√©m vale a pena prestar aten√ß√£o ao fato de que, para os compiladores da Microsoft, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">os contratos de chamada</a> ( <b>__fastcall</b> , <b>__stdcall</b> e <b>__cdecl</b> ) tamb√©m s√£o <b>importantes</b> , porque  com conven√ß√µes diferentes, as fun√ß√µes ser√£o diferentes, embora tenham o mesmo conjunto de argumentos e valor de retorno.  Como resultado, todo esse grandioso design de macro √© usado de maneira bastante compacta: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> detail { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TYPES #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ARGS _IS_MEM_FUN_PTR #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> TYPES #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> ARGS #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TYPES , class T0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ARGS T0 _IS_MEM_FUN_PTR #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> TYPES #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> ARGS #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TYPES , class T0, class T1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ARGS T0, T1 _IS_MEM_FUN_PTR #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> TYPES #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> ARGS</span></span></code> </pre><br>  <b>...</b> <br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TYPES , class T0, class T1, class T2, class T3, class T4, class T5, class T6, class T7, class T8, class T9, class T10, class T11, class T12, class T13, class T14, class T15, class T16, class T17, class T18, class T19, class T20, class T21, class T22, class T23, class T24 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ARGS T0, T1, T2, T3, T4, T5, T6, T7, T8, T9, T10, T11, T12, T13, T14, T15, T16, T17, T18, T19, T20, T21, T22, T23, T24 _IS_MEM_FUN_PTR #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> TYPES #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">undef</span></span></span><span class="hljs-meta"> ARGS </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//      define  : #undef _IS_MEM_FUN_PTR #undef _IS_MEM_FUN_PTR_CLR #undef _IS_MEM_FUN_CDECL_PTR #undef _IS_MEM_FUN_STDCALL_PTR #undef _IS_MEM_FUN_FASTCALL_PTR }</span></span></span></span></code> </pre><br>  E agora, para o que foi tudo escrito: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> detail { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsRef</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_mem_function_ptr_impl</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> _Tp *p; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> value = (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(_is_mem_function_ptr(_is_mem_function_ptr_impl::p)) == <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(_yes_type)); <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> integral_constant&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, _is_mem_function_ptr_impl::value == <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>)&gt;::type type; }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_mem_function_ptr_impl</span></span></span><span class="hljs-class">&lt;_Tp, true&gt;:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> false_type {}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_mem_function_ptr_helper</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> _is_mem_function_ptr_impl&lt;_Tp, is_reference&lt;_Tp&gt;::value&gt;::type {}; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsMemberFunctionPtr</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_chooser_impl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> false_type { }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_chooser_impl</span></span></span><span class="hljs-class">&lt;_Tp, false&gt; :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> _is_function_ptr_helper&lt;_Tp*&gt; { }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsRef</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_chooser</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> false_type { }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_function_chooser</span></span></span><span class="hljs-class">&lt;_Tp, false&gt; {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> value = _is_function_chooser_impl&lt;_Tp, _is_mem_function_ptr_helper&lt;_Tp&gt;::value&gt;::value; }; }</code> </pre><br>  Para verificar se um tipo √© uma fun√ß√£o membro de uma classe, primeiro √© verificado se o tipo √© uma refer√™ncia.  Em seguida, um ponteiro desse tipo √© criado e substitu√≠do na fun√ß√£o de teste.  Usando a t√©cnica SFINAE, o compilador seleciona a sobrecarga necess√°ria das fun√ß√µes do probe para esse ponteiro e, com base no resultado da compara√ß√£o com <i>_yes_type,</i> forma o resultado. <br><br>  Com base em uma verifica√ß√£o em uma fun√ß√£o membro de uma classe, uma verifica√ß√£o de tipo √© escrita por pertencer ao tipo de fun√ß√£o.  Verificamos se o tipo √© refer√™ncia, caso contr√°rio, procuramos uma especializa√ß√£o adequada de estruturas de an√°lise de modelo para um ponteiro desse tipo, que ser√° <i>true_type</i> para qualquer ponteiro de fun√ß√£o com at√© 24 par√¢metros. <br><br>  E agora usamos o resultado para implementar <i>is_function</i> .  Aqui, pelo mesmo motivo da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">parte anterior</a> , n√£o pude herdar essa estrutura de <i>integral_constant</i> , portanto o comportamento de <i>integral_constant √©</i> "simulado". <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// is_function template&lt;class _Tp&gt; struct is_function { static const bool value = detail::_is_function_chooser&lt;_Tp, is_reference&lt;_Tp&gt;::value&gt;::value; typedef const bool value_type; typedef integral_constant&lt;bool, is_function::value == bool(true)&gt; type; operator value_type() const { // return stored value return (value); } value_type operator()() const { // return stored value return (value); } };</span></span></code> </pre><br>  E para implementar <i>is_member_function_pointer</i> , ainda √© mais simples: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// is_member_function_pointer template&lt;class _Tp&gt; struct is_member_function_pointer : public detail::_is_mem_function_ptr_helper&lt;typename remove_cv&lt;_Tp&gt;::type&gt;::type { };</span></span></code> </pre><br>  Al√©m disso, com base nesses padr√µes, podemos determinar se o tipo √© um membro da classe em princ√≠pio: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> detail { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_member_object_pointer_impl1</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> _not_&lt; _or_&lt;_is_function_ptr_helper&lt;_Tp&gt;, _is_mem_function_ptr_helper&lt;_Tp&gt; &gt; &gt;::type { }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_member_object_pointer_impl2</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> false_type { }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cp</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_member_object_pointer_impl2</span></span></span><span class="hljs-class">&lt;_Tp _Cp::*&gt; :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> true_type { }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_member_object_pointer_helper</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> _and_&lt;_is_member_object_pointer_impl1&lt;_Tp&gt;, _is_member_object_pointer_impl2&lt;_Tp&gt; &gt;::type {}; } <span class="hljs-comment"><span class="hljs-comment">// is_member_object_pointer template&lt;class _Tp&gt; struct is_member_object_pointer : public detail::_is_member_object_pointer_helper&lt;typename remove_cv&lt;_Tp&gt;::type&gt;::type { };</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Utilizou opera√ß√µes l√≥gicas 'e', ‚Äã‚Äã'ou', 'n√£o' em tipos da primeira parte</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> detail { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void_type</span></span></span><span class="hljs-class"> {</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//typedef void void_type; template&lt;class _B1 = void_type, class _B2 = void_type, class _B3 = void_type, class _B4 = void_type&gt; struct _or_ : public conditional&lt;_B1::value, _B1, _or_&lt;_B2, _or_&lt;_B3, _B4&gt; &gt; &gt;::type { }; template&lt;&gt; struct _or_&lt;void_type, void_type, void_type, void_type&gt;; template&lt;class _B1&gt; struct _or_&lt;_B1, void_type, void_type, void_type&gt; : public _B1 { }; template&lt;class _B1, class _B2&gt; struct _or_&lt;_B1, _B2, void_type, void_type&gt; : public conditional&lt;_B1::value, _B1, _B2&gt;::type { }; template&lt;class _B1, class _B2, class _B3&gt; struct _or_&lt;_B1, _B2, _B3, void_type&gt; : public conditional&lt;_B1::value, _B1, _or_&lt;_B2, _B3&gt; &gt;::type { }; template&lt;class _B1 = void_type, class _B2 = void_type, class _B3 = void_type, class _B4 = void_type&gt; struct _and_; template&lt;&gt; struct _and_&lt;void_type, void_type, void_type, void_type&gt;; template&lt;class _B1&gt; struct _and_&lt;_B1, void_type, void_type, void_type&gt; : public _B1 { }; template&lt;class _B1, class _B2&gt; struct _and_&lt;_B1, _B2, void_type, void_type&gt; : public conditional&lt;_B1::value, _B2, _B1&gt;::type { }; template&lt;class _B1, class _B2, class _B3&gt; struct _and_&lt;_B1, _B2, _B3, void_type&gt; : public conditional&lt;_B1::value, _and_&lt;_B2, _B3&gt;, _B1&gt;::type { }; template&lt;class _Pp&gt; struct _not_ { static const bool value = !bool(_Pp::value); typedef const bool value_type; typedef integral_constant&lt;bool, _not_::value == bool(true)&gt; type; operator value_type() const { // return stored value return (value); } value_type operator()() const { // return stored value return (value); } }; }</span></span></code> </pre><br></div></div><br>  Aqui, usamos opera√ß√µes l√≥gicas em tipos que, com a ajuda do modelo <i>condicional</i> , eventualmente selecionam o tipo de modelo apropriado.  Como programa√ß√£o de modelos em toda a sua gl√≥ria, como resultado, no est√°gio de compila√ß√£o, j√° temos informa√ß√µes sobre se o tipo √© membro da classe.  Muito "furioso", mas como espetacular e eficaz! <br><br>  Um pouco de programa√ß√£o de modelos mais pura com os mesmos elementos l√≥gicos e temos <i>is_fundamental</i> , <i>is_compound</i> , etc.  sinais (isso me encanta, mas voc√™?): <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// is_arithmetic template&lt;class _Tp&gt; struct is_arithmetic : public detail::_or_&lt;is_integral&lt;_Tp&gt;, is_floating_point&lt;_Tp&gt; &gt;::type { }; // is_fundamental template&lt;class _Tp&gt; struct is_fundamental : public detail::_or_&lt;is_arithmetic&lt;_Tp&gt;, is_void&lt;_Tp&gt;, is_null_pointer&lt;_Tp&gt; &gt;::type {}; // is_object template&lt;class _Tp&gt; struct is_object : public detail::_not_&lt; detail::_or_&lt; is_function&lt;_Tp&gt;, is_reference&lt;_Tp&gt;, is_void&lt;_Tp&gt; &gt; &gt;::type {}; // is_scalar template&lt;class _Tp&gt; struct is_scalar : public detail::_or_&lt;is_arithmetic&lt;_Tp&gt;, is_pointer&lt;_Tp&gt;, is_member_pointer&lt;_Tp&gt;, is_null_pointer&lt;_Tp&gt;/*, is_enum&lt;_Tp&gt;*/ &gt;::type {}; // is_compound template&lt;class _Tp&gt; struct is_compound: public detail::_not_&lt;is_fundamental&lt;_Tp&gt; &gt;::type { };</span></span></code> </pre><blockquote>  Um leitor atento perceber√° que a defini√ß√£o de <i>is_enum est√°</i> comentada.  O fato √© que n√£o encontrei maneiras de distinguir <b>enum</b> de outros tipos, mas acho que isso √© vi√°vel sem o uso de macros dependentes do compilador.  Talvez um leitor atento e experiente lhe diga seu caminho ou linha de pensamento a esse respeito. </blockquote>  Para determinar o fato de que um tipo √© uma classe, nada mais √© necess√°rio agora <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> detail { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsReference</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_class_helper</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> integral_constant&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>&gt; type; }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tp</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_class_helper</span></span></span><span class="hljs-class">&lt;_Tp, false&gt; {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> integral_constant&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, (is_scalar&lt;_Tp&gt;::value == <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//&amp;&amp; !is_union&lt;_Tp&gt;::value &gt;::value &amp;&amp; (is_array&lt;_Tp&gt;::value == bool(false)) &amp;&amp; (is_void&lt;_Tp&gt;::value == bool(false)) &amp;&amp; (is_function&lt;_Tp&gt;::value == bool(false))&gt; type; }; } // is_class template&lt;class _Tp&gt; struct is_class : public detail::_is_class_helper&lt;typename remove_cv&lt;_Tp&gt;::type, is_reference&lt;_Tp&gt;::value&gt;::type { };</span></span></code> </pre><br>  E tudo ficaria bem, mas a <b>uni√£o</b> em C ++ n√£o pode ser distinguida de uma classe no caso geral.  Porque eles s√£o muito semelhantes em suas "manifesta√ß√µes externas" e n√£o pude verificar as diferen√ßas (por exemplo, a incapacidade de herdar da <b>uni√£o</b> ) sem erros de compila√ß√£o.  Talvez algu√©m lhe diga uma manobra complicada para determinar a <b>uni√£o</b> na compila√ß√£o, ent√£o <i>is_class</i> corresponder√° exatamente ao padr√£o. <br><br>  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">parte final</a> deste cap√≠tulo, falarei sobre como <i>std :: decay</i> e <i>std :: common_type foram implementados</i> , bem como o que resta a ser adicionado aos <b>type_traits</b> . <br><br>  Obrigado pela aten√ß√£o. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418347/">https://habr.com/ru/post/pt418347/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418335/index.html">Confronto no Positive Hack Days 8: analisando cadeias de ataques</a></li>
<li><a href="../pt418337/index.html">DataGrip quente e de ver√£o 2018.2</a></li>
<li><a href="../pt418339/index.html">Manipulador "Manual"</a></li>
<li><a href="../pt418341/index.html">Feliz dia do administrador do sistema! Cart√£o com significado</a></li>
<li><a href="../pt418345/index.html">Documenta√ß√£o de formatos de troca de informa√ß√µes - f√°cil e simples</a></li>
<li><a href="../pt418349/index.html">Servi√ßo de Kubernetes do Azure (AKS) e PowerShell</a></li>
<li><a href="../pt418353/index.html">Mapa mental em vez de um caso de teste ou Como a visualiza√ß√£o permite testar o aplicativo mais rapidamente</a></li>
<li><a href="../pt418355/index.html">Classificando ... por uma tabela de hash (tamb√©m por uma contagem de √°rvores e um HashMap)</a></li>
<li><a href="../pt418357/index.html">DEFCON 23. "Confiss√µes de um cyberstalker profissional". Ken Westin</a></li>
<li><a href="../pt418359/index.html">Resumo da Fintech: identifica√ß√£o de cidad√£os do supermercado financeiro, ex-funcion√°rio da QIWI extraiu 2,4% de bitcoins, BRICS e blockchain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>