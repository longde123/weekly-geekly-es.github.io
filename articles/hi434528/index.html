<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЖФ ЁЯТЕЁЯП┐ ЁЯН▒ рдкреЛрд╕реНрдЯрдХрд╛рд░реНрдб рдХреЗ рдЖрдХрд╛рд░ рдХрд╛ рд░реЗ рдЯреНрд░реЗрд╕рд░ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди ЁЯОИ ЁЯР╡ ЁЯдШ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""рдЙрдиреНрд╣реЛрдВрдиреЗ рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рдХрд┐рдпрд╛!" - рдкрд┐рдХреНрд╕рд░ рдлреНрд▓рд╛рдпрд░ [1] рдХреЗ рдкреАрдЫреЗ рджреЗрдЦрдиреЗ рдкрд░ рдпрд╣ рдкрд╣рд▓реА рдмрд╛рдд рд╣реИ, рдЬреЛ рдХреЛрдб рд╕реЗ рдкреВрд░реА рддрд░рд╣ рднрд░реА рд╣реБрдИ рдереАред рдПрдВрдбреНрд░рдпреВ рдХреЗрдиреНрд╕рд▓рд░ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рджреНрд╡...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдкреЛрд╕реНрдЯрдХрд╛рд░реНрдб рдХреЗ рдЖрдХрд╛рд░ рдХрд╛ рд░реЗ рдЯреНрд░реЗрд╕рд░ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434528/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/cr/xz/vj/crxzvjqqbw5gl4mv3wxxx2zw6wa.png"></div><br>  "рдЙрдиреНрд╣реЛрдВрдиреЗ рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рдХрд┐рдпрд╛!" - рдкрд┐рдХреНрд╕рд░ рдлреНрд▓рд╛рдпрд░ <sup>[1]</sup> рдХреЗ рдкреАрдЫреЗ рджреЗрдЦрдиреЗ рдкрд░ рдпрд╣ рдкрд╣рд▓реА рдмрд╛рдд рд╣реИ, рдЬреЛ рдХреЛрдб рд╕реЗ рдкреВрд░реА рддрд░рд╣ рднрд░реА рд╣реБрдИ рдереАред  рдПрдВрдбреНрд░рдпреВ рдХреЗрдиреНрд╕рд▓рд░ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рджреНрд╡рд╛рд░рд╛ рдирд┐рдЪрд▓реЗ рджрд╛рдПрдВ рдХреЛрдиреЗ рдореЗрдВ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЗ рдПрдХ рдХреНрд▓рд╕реНрдЯрд░ рдкрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд┐рдП рдЧрдП рдереЗред  рдЬреЛ рд▓реЛрдЧ рдЙрд╕реЗ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ, рдЙрдирдХреЗ рд▓рд┐рдП рдореИрдВ рдХрд╣реВрдВрдЧрд╛: рдПрдВрдбреНрд░рдпреВ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рд╣реИ, рдЬрд┐рд╕рдиреЗ 2009 рдореЗрдВ 1337-рдмрд╛рдЗрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмрд┐рдЬрдиреЗрд╕ рдХрд╛рд░реНрдб рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рд░реЗ рдЯреНрд░реЗрд╕рд░</a> рдХрд╛ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдХрд┐рдпрд╛ рдерд╛ред <br><br>  рдЗрд╕ рдмрд╛рд░, рдПрдВрдбреНрд░рдпреВ рдХреБрдЫ рдФрд░ рдЕрдзрд┐рдХ рдЪрдордХрджрд╛рд░ рдХреЗ рд╕рд╛рде рдЖрдпрд╛, рд▓реЗрдХрд┐рди рдмрд╣реБрдд рдЕрдзрд┐рдХ рджрд┐рд▓рдЪрд╕реНрдк рджреГрд╢реНрдп рдкрд░рд┐рдгрд╛рдо рдХреЗ рд╕рд╛рдеред  рдЪреВрдВрдХрд┐ рдореИрдВрдиреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡реБрд▓реНрдл 3 рдбреА</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбреАрдУрдУрдПрдо рдХреЗ</a> рдмрд╛рд░реЗ рдореЗрдВ рдЕрдкрдиреЗ рдЧреЗрдо рдЗрдВрдЬрди рдмреНрд▓реИрдХ рдмреБрдХреНрд╕ рдХреЛ рд▓рд┐рдЦрдирд╛ рд╕рдорд╛рдкреНрдд рдХрд░ рджрд┐рдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореЗрд░реЗ рдкрд╛рд╕ рдЗрд╕рдХреЗ рдЧреВрдврд╝ рдХреЛрдб рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордп рдерд╛ред  рдФрд░ рд▓рдЧрднрдЧ рддреБрд░рдВрдд, рдореИрдВ рд╕рдЪрдореБрдЪ рдЙрд╕рдХреА рдЦреЛрдЬ рдХреА рдЧрдИ рддрдХрдиреАрдХреЛрдВ рд╕реЗ рдореЛрд╣рд┐рдд рд╣реЛ рдЧрдпрд╛ рдерд╛ред  рд╡реЗ "рдорд╛рдирдХ" рдХрд┐рд░рдг рдЕрдиреБрд░реЗрдЦрдХ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдВрдбреНрд░рдпреВ рдХреЗ рдкрд┐рдЫрд▓реЗ рдХрд╛рдо рд╕реЗ рдмрд╣реБрдд рдЕрд▓рдЧ рдереЗред  рдореБрдЭреЗ рд░реЗ рдорд╛рд░реНрдЪрд┐рдВрдЧ, рд░рдЪрдирд╛рддреНрдордХ рд╡реЙрд▓реНрдпреВрдореЗрдЯреНрд░рд┐рдХ рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ, рдореЛрдВрдЯреЗ рдХрд╛рд░реНрд▓реЛ рд░реЗрдВрдбрд░рд┐рдВрдЧ / рдкрд╛рде рдЯреНрд░реЗрд╕рд┐рдВрдЧ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдХрдИ рдЕрдиреНрдп рдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рджрд┐рд▓рдЪрд╕реНрдкреА рдереА, рдЬреЛ рдЙрд╕рдиреЗ рдХрд╛рдЧрдЬ рдХреЗ рдЗрддрдиреЗ рдЫреЛрдЯреЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рдХреЛрдб рдХреЛ рдирд┐рдЪреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдерд╛ред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yc/z4/nt/ycz4ntg3qh91i6m2wymfccaekvk.png"></div><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lf/2o/qv/lf2oqvd5d39pyfwxyixvjnrmlqq.png"></div><br><h2>  рд╕реНрд░реЛрдд рдХреЛрдб </h2><br><hr><br>  рдлреНрд▓рд╛рдпрд░ рдХреЗ рд╕рд╛рдордиреЗ рдкрд┐рдХреНрд╕рд░ рднрд░реНрддреА рд╡рд┐рднрд╛рдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдЬреНрдЮрд╛рдкрди рд╣реИред  рд░рд┐рд╡рд░реНрд╕ рд╕рд╛рдЗрдб рдкрд░ C ++ рдХреЛрдб рдХреЗ 2,037 рдмрд╛рдЗрдЯреНрд╕ рдЫрдкреЗ рд╣реИрдВ, рдЬреЛ рдЫреЛрдЯреА рд╕реЗ рдЫреЛрдЯреА рд╕рдВрднрд╛рд╡рд┐рдд рд╕рддрд╣ рдкрд░ рдХрдмреНрдЬрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдзрд┐рдд рд╣реИред <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; // card &gt; pixar.ppm #include &lt;stdio.h&gt; #include &lt;math.h&gt; #define R return #define O operator typedef float F;typedef int I;struct V{F x,y,z;V(F v=0){x=y=z=v;}V(F a,F b,F c=0){x=a;y=b;z=c;}V O+(V r){RV(x+rx,y+ry,z+rz);}VO*(V r){RV(x*rx,y*r. y,z*rz);}FO%(V r){R x*r.x+y*r.y+z*rz;}VO!(){R*this*(1/sqrtf(*this%*this) );}};FL(F l,F r){R l&lt;r?l:r;}FU(){R(F)rand()/RAND_MAX;}FB(V p,V l,V h){l=p +l*-1;h=h+p*-1;RL(L(L(lx,hx),L(ly,hy)),L(lz,hz));}FS(V p,I&amp;m){F d=1\ e9;V f=p;fz=0;char l[]="5O5_5W9W5_9_COC_AOEOA_E_IOQ_I_QOUOY_Y_]OWW[WaOa_aW\ eWa_e_cWiO";for(I i=0;i&lt;60;i+=4){V b=V(l[i]-79,l[i+1]-79)*.5,e=V(l[i+2]-79,l [i+3]-79)*.5+b*-1,o=f+(b+e*L(-L((b+f*-1)%e/(e%e),0),1))*-1;d=L(d,o%o);}d=sq\ rtf(d);V a[]={V(-11,6),V(11,6)};for(I i=2;i--;){V o=f+a[i]*-1;d=L(d,ox&gt;0?f\ absf(sqrtf(o%o)-2):(o.y+=oy&gt;0?-2:2,sqrtf(o%o)));}d=powf(powf(d,8)+powf(pz, 8),.125)-.5;m=1;F r=L(-L(B(p,V(-30,-.5,-30),V(30,18,30)),B(p,V(-25,17,-25),V (25,20,25))),B(V(fmodf(fabsf(px),8),py,pz),V(1.5,18.5,-25),V(6.5,20,25))) ;if(r&lt;d)d=r,m=2;F s=19.9-py;if(s&lt;d)d=s,m=3;R d;}IM(V o,V d,V&amp;h,V&amp;n){I m,s= 0;F t=0,c;for(;t&lt;100;t+=c)if((c=S(h=o+d*t,m))&lt;.01||++s&gt;99)R n=!V(S(h+V(.01,0 ),s)-c,S(h+V(0,.01),s)-c,S(h+V(0,0,.01),s)-c),m;R 0;}VT(V o,V d){V h,n,r,t= 1,l(!V(.6,.6,1));for(I b=3;b--;){I m=M(o,d,h,n);if(!m)break;if(m==1){d=d+n*( n%d*-2);o=h+d*.1;t=t*.2;}if(m==2){F i=n%l,p=6.283185*U(),c=U(),s=sqrtf(1-c), g=nz&lt;0?-1:1,u=-1/(g+nz),v=nx*ny*u;d=V(v,g+ny*ny*u,-ny)*(cosf(p)*s)+V( 1+g*nx*nx*u,g*v,-g*nx)*(sinf(p)*s)+n*sqrtf(c);o=h+d*.1;t=t*.2;if(i&gt;0&amp;&amp;M(h +n*.1,l,h,n)==3)r=r+t*V(500,400,100)*i;}if(m==3){r=r+t*V(50,80,100);break;}} R r;}I main(){I w=960,h=540,s=16;V e(-22,5,25),g=!(V(-3,4,0)+e*-1),l=!V(gz, 0,-gx)*(1./w),u(gy*lz-gz*ly,gz*lx-gx*lz,gx*ly-gy*lx);printf("P\ 6 %d %d 255 ",w,h);for(I y=h;y--;)for(I x=w;x--;){V c;for(I p=s;p--;)c=c+T(e ,!(g+l*(xw/2+U())+u*(yh/2+U())));c=c*(1./s)+14./241;V o=c+1;c=V(cx/ox,c. y/oy,cz/oz)*255;printf("%c%c%c",(I)cx,(I)cy,(I)cz);}}// Andrew Kensler</span></span></span></span></code> </pre> <br><h2>  рдХреНрдпрд╛ рд╡рд╣ рдХрд╛рдо рднреА рдХрд░рддрд╛ рд╣реИ? </h2><br><hr><br>  рдХреЛрдб рдХреЗ рд╕рд╛рде рдЗрд╕рдХреЗ рд▓реЙрдиреНрдЪ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рд░реНрджреЗрд╢ рд╣реИред  рд╡рд┐рдЪрд╛рд░ рдорд╛рдирдХ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╣реИред  рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ, рд╣рдо рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдЙрдЯрдкреБрдЯ рд╕реНрд╡рд░реВрдк рдПрдХ рдкрд╛рда рдЫрд╡рд┐ рдкреНрд░рд╛рд░реВрдк рд╣реИ рдЬрд┐рд╕реЗ рдиреЗрдЯрдкреАрдмреАрдПрдо <sup>[2]</sup> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><pre>  $ clang -o card2 -O3 raytracer.cpp
 $ рд╕рдордп ред/card&gt; pixar.ppm<font></font>
<font></font>
 рд╡рд╛рд╕реНрддрд╡рд┐рдХ 2m58.524
 рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ 2m57.567s
 sys 0m0.415s </pre><br>  рджреЛ рдорд┐рдирдЯ рдФрд░ рдЕрдбрд╝рддрд╛рд▓реАрд╕ рд╕реЗрдХрдВрдб <sup>[3]</sup> рдХреЗ рдмрд╛рдж, рдирд┐рдореНрди рдЫрд╡рд┐ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИред  рдпрд╣ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд╣реИ рдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдХрд┐рддрдирд╛ рдХрдо рдХреЛрдб рдЖрд╡рд╢реНрдпрдХ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cae/b34/b5c/caeb34b5c6c57c4598adc8f6b3f28f38.webp"></div><br>  рдЖрдк рдКрдкрд░ рдХреА рдЫрд╡рд┐ рд╕реЗ рдмрд╣реБрдд рдХреБрдЫ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред  рдЧреНрд░рд┐рдЯ рдПрдХ "рдкрде рдЕрдиреБрд░реЗрдЦрдХ" рдХрд╛ рдПрдХ рд╕реНрдкрд╖реНрдЯ рд╕рдВрдХреЗрдд рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рд░реЗрдВрдбрд░рд░ рдХрд┐рд░рдгреЛрдВ рд╕реЗ рдЕрд▓рдЧ рд╣реЛрддреЗ рд╣реИрдВ рдХрд┐ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрддреЛрдВ рддрдХ рдХрд┐рд░рдгреЛрдВ рдХрд╛ рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓рддрд╛ рд╣реИред  рдЗрд╕ рдкрджреНрдзрддрд┐ рдореЗрдВ, рдкреНрд░рддрд┐ рдкрд┐рдХреНрд╕реЗрд▓ рд╣рдЬрд╛рд░реЛрдВ рдХрд┐рд░рдгреЗрдВ рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдЙрддреНрд╕рд░реНрдЬрд┐рдд рд╣реЛрддреА рд╣реИрдВ рдФрд░ рдХрд╛рд░реНрдпрдХреНрд░рдо рдЙрдирдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддрд╛ рд╣реИ, рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╡реЗ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рдкрд╛рдПрдВрдЧреЗред  рдпрд╣ рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рддрдХрдиреАрдХ рд╣реИ, рдЬреЛ рдХрд┐рд░рдг рдЕрдиреБрд░реЗрдЦрдг рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдмреЗрд╣рддрд░ рд╣реИ, рдкрд░рд┐рд╡реЗрд╢ рд░реЛрдбрд╝рд╛, рдирд░рдо рдЫрд╛рдпрд╛, рдХрд╛рд╕реНрдЯрд┐рдХ, рдФрд░ рд░реЗрдбрд┐рдпреЛрд╕рд┐рдЯреА рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреЛ рд╕рдВрднрд╛рд▓ рд╕рдХрддрд╛ рд╣реИред <br><br><h2>  рд╣рдо рдХреЛрдб рдХреЛ рднрд╛рдЧреЛрдВ рдореЗрдВ рддреЛрдбрд╝ рджреЗрдВрдЧреЗ </h2><br><hr><br>  CLION рдореЗрдВ рдЗрдирдкреБрдЯ рдкрд╛рд╕ рдХрд░рдирд╛ рдХреЛрдб рдХреЛ рдкреНрд░рд╛рд░реВрдкрд┐рдд рдХрд░рддрд╛ рд╣реИ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдЖрдЙрдЯрдкреБрдЯ рджреЗрдЦреЗрдВ) рдФрд░ рдЗрд╕реЗ рдЫреЛрдЯреЗ рднрд╛рдЧреЛрдВ / рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рддреЛрдбрд╝ рджреЗрддрд╛ рд╣реИред <br><br><pre>  <font color="grey">#include &lt;stdlib.h&gt; // card&gt; pixar.ppm</font> <font color="grey">
</font>  <font color="grey"># рдЕрд▓рдЧ рдХрд░реЗрдВ</font> <font color="grey">
</font>  <font color="grey"># рдкрд┐рди рдХрд░реЗрдВ &lt;math.h&gt;</font> </pre><br><pre>  <font color="fuchsia"># рдбреЗрдлрд┐рди рдЖрд░ рд╡рд╛рдкрд╕реА</font> <font color="fuchsia">
</font>  <font color="fuchsia"># рдУрдлрд┐рди рд╣реЗ рдСрдкрд░реЗрдЯрд░</font> <font color="fuchsia">
</font>  <font color="fuchsia">typedef float F; рдЯрд╛рдЗрдкрдбреАрдл int int I;</font> </pre><pre>  <font color="blue">рд╕рдВрд░рдЪрдирд╛ V {F x, y, z; V (F v = 0) {x = y = z = v;} V (F a, F b, F</font> <font color="blue">
</font>  <font color="blue">c = 0) {x = a; y = b; z = c;} V O + (V r) {RV (x + rx, y + ry, z + rz);} VO * (V r) {RV; x * рдЖрд░рдПрдХреНрд╕, рд╡рд╛рдИ * рдЖрд░ред</font> <font color="blue">
</font>  <font color="blue">y, z * rz);} FO% (V r) {R x * r.x + y * r.y + z * rzред} VO! () {R * this * (1 / sqrtf (* this%) * рдпрд╣)</font> <font color="blue">
</font>  <font color="blue">);}};</font> </pre><pre>  <font color="orange">FL (F l, F r) {R l &lt;r? L: r;} FU () {R (F) рд░реИрдВрдб () / RAND_MAX;} FB (V p, V l, V h) {l = p</font> <font color="orange">
</font>  <font color="orange">+ l * -1; h = h + p * -1; RL (L (L (Lx, hx), L (ly, hy)), L (lz, hz));};</font> </pre><pre>  <font color="LimeGreen">FS (V p, I &amp; m) {F d = 1 \</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">e9; V f = p; fz = 0; char l [] = "5O5_5W9W5_9_COC_AOEOA_E_IOQ_I_QOUOY_Y_] OWW [WaOa_aW \ _</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">eWa_e_cWiO "; рдХреЗ рд▓рд┐рдП (I i = 0; рдореИрдВ &lt;60; рдореИрдВ + = 4) {V b = V (l [i] -79, l [i + 1] -79) *ред 5, e = V (l [] i + 2] -79, рдПрд▓</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">[i + 3] -79) *ред 5 + рдмреА * -1, рдУ = рдПрдл + (рдмреА + рдИ * рдПрд▓ (рдПрд▓ - (рдмреА + рдПрдл * -1)% рдИ / (рдИ% рдИ), 0), 1)) * - 1; d = L (d, o% o);} d = sq \ _</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">rtf (d); V a [] = {V (-11.6), V (11.6)}, рдХреЗ рд▓рд┐рдП (I i = 2; i -;) {V o = f + a [i] * -1; рдбреА = рдПрд▓ (рдбреА, рдСрдХреНрд╕&gt; 0? рдПрдл *</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">absf (sqrtf (o% o) -2) :( o.y + = oy&gt; 0; -2: 2, sqrtf (o% o));} d = powf (powf (d, 8) + powf (pz) ред</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">8), 125) -ред 5; рдПрдо = 1; рдПрдл рдЖрд░ = рдПрд▓ (рдПрд▓ (рдмреА (рдкреА, рд╡реА -30, - 5, -30), рд╡реА (30,18,30), рдмреАред (рдкреА, рд╡реА (-25.17, -25), рд╡реА</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">(25,20,25))), B (V (fmodf (fbsf) (px), 8), py, pz), V (1.5,18.5, -25), V (6.5,20,25))</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">, рдЕрдЧрд░ (r &lt;d) d = r, m = 2; F s = 19.9-py; рдЕрдЧрд░ (s &lt;d) d = s, m = 3; R d;};</font> </pre><pre>  <font color="black">IM (V o, V d, V &amp; h, V &amp; n) {I m, s =</font> <font color="black">
</font>  <font color="black">0; рдПрдл рдЯреА = 0, рд╕реА; рдХреЗ рд▓рд┐рдП (?; рдЯреА &lt;100; рдЯреА + = рд╕реА) рдЕрдЧрд░ ((рд╕реА = рдПрд╕ (рдПрдЪ = рдУ + рдбреА * рдЯреА, рдПрдо)) &lt;ред 01 || ++ s&gt; 99) рдЖрд░ n =! рд╡реА (рдПрд╕ (рдПрдЪ + рд╡реА (.01,0)</font> <font color="black">
</font>  <font color="black">), s) -c, S (h + V (0, .01), s) -c, S (h + V (0,0, .01), s) -c), m; R 0;}</font> </pre><pre>  <font color="SkyBlue">рд╡реАрдЯреА (рд╡реА рдУ, рд╡реА рдбреА) {рд╡реА рдПрдЪ, рдПрди, рдЖрд░, рдЯреА =</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">1, l (! V (.6, .6,1)); рдХреЗ рд▓рд┐рдП (I b = 3; b -;) {I m = M (o, d, h, n); if (! M) рдмреНрд░реЗрдХ , рдЕрдЧрд░ (m == 1) {d = d + n * (</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">n% d * -2); o = h + d * .1; t = t * .2;} рдЕрдЧрд░ (m == 2) {F i = n% l, p = 6.283185 * U (), c = U (), s = sqrtf (1-c),</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">g = nz &lt;0? -1: 1, u = -1 / (g + nz), v = nx *y * u; d = V (v, g + ny * ny * u, -ny) * (cosf) (p) * s) + V (</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">1 + g * nx * nx * u, g * v, -g * nx) * (sinf (p) * s) + n * sqrtf (c); o = h + d * .1; t = t *ред 2; рдпрджрд┐ (i&gt; 0 &amp;&amp; M (h)</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">+ n * .1, l, h, n) == 3) r = r + t * V (500,400,400)) * i;} рдЕрдЧрд░ (m == 3) {r = r + t * V (50,80,100) ; рд╡рд┐рд░рд╛рдо;}}</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">R r;}</font> </pre><pre>  <font color="red">I рдореБрдЦреНрдп () {I w = 960, h = 540, s = 16; V e (-22,5,25), g =! (((-3,4,0) + e * -1), l =! рд╡реА (gz,</font> <font color="red">
</font>  <font color="red">0, -gx) * (1./w), u (gy * lz-gz * ly, gz * lx-gx * lz, gx * ly-gy * lx); printf ("P \")</font> <font color="red">
</font>  <font color="red">6% d% d 255 ", w, h); рдХреЗ рд▓рд┐рдП (I y = h; y -;) рдХреЗ рд▓рд┐рдП (I x = w; x -;) {V c; рдХреЗ рд▓рд┐рдП (I p = s; p- -;) рд╕реА = рд╕реА + рдЯреА (рдИ)</font> <font color="red">
</font>  <font color="red">; (g + l * (xw / 2 + U ()) + u * (yh / 2 + U ()))); c = c * (1./s) + 14. / 241; V o = c + 1; c = V (cx / ox, c)</font> <font color="red">
</font>  <font color="red">y / oy, cz / oz) * 255; рдкреНрд░рд┐рдВрдЯрдл ("% c% c% c", (I) cx, (I) рд╕рд╛рдЗрдмрд░, (I) cz);})</font> </pre><pre>  <font color="LightGray">// рдПрдВрдбреНрд░рдпреВ рдХреЗрд╕рд▓рд░</font> </pre><br>  рдкреНрд░рддреНрдпреЗрдХ рдЕрдиреБрднрд╛рдЧ рдХреЛ рд╢реЗрд╖ рд▓реЗрдЦ рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд░реНрдгрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: <br>  <font color="fuchsia">тЦа</font> - рд╕рд╛рдзрд╛рд░рдг рдЪрд╛рд▓, <font color="blue">тЦа</font> - рд╡реЗрдХреНрдЯрд░ рд╡рд░реНрдЧ, <font color="orange">тЦа</font> - рд╕рд╣рд╛рдпрдХ рдХреЛрдб, <font color="LimeGreen">тЦа</font> - рдбреЗрдЯрд╛рдмреЗрд╕, <font color="black">тЦа</font> - рд░реЗ рдорд╛рд░реНрдЪрд┐рдВрдЧ, <font color="SkyBlue">тЦа</font> - рдирдореВрдирд╛, <font color="red">тЦа</font> - рдореБрдЦреНрдп рдХреЛрдбред <br><br><h2>  #Define рдФрд░ typedef рдХреЗ рд╕рд╛рде рд╕рд╛рдорд╛рдиреНрдп рдЯреНрд░рд┐рдХ </h2><br><hr><br>  рдХреЙрдорди рдЯреНрд░рд┐рдХреНрд╕ рдХреЛрдб рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП #define рдФрд░ typedef рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдпрд╣рд╛рдВ рд╣рдо рдПрдл = рдлреНрд▓реЛрдЯ, рдЖрдИ = рдЗрдВрдЯ, рдЖрд░ = рд░рд┐рдЯрд░реНрди, рдФрд░ рдУ = рдСрдкрд░реЗрдЯрд░ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВред  рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рддреБрдЪреНрдЫ рд╣реИред <br><br><h2>  рдХрдХреНрд╖рд╛ рд╡реА </h2><br><hr><br>  рдЗрд╕рдХреЗ рдмрд╛рдж рдХрдХреНрд╖рд╛ V рдЖрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдореИрдВрдиреЗ Vec рдХрд╛ рдирд╛рдо рджрд┐рдпрд╛ (рднрд▓реЗ рд╣реА, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рдиреАрдЪреЗ рджреЗрдЦреЗрдВрдЧреЗ, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ RGB рдЪреИрдирд▓ рдХреЛ рдлрд╝реНрд▓реЛрдЯ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)ред <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vec</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x, y, z; Vec(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> v = <span class="hljs-number"><span class="hljs-number">0</span></span>) { x = y = z = v; } Vec(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span>) { x = a; y = b; z = c;} Vec <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>+(Vec r) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vec(x + rx, y + ry, z + rz); } Vec <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>*(Vec r) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vec(x * rx, y * ry, z * rz); } <span class="hljs-comment"><span class="hljs-comment">// dot product float operator%(Vec r) { return x * rx + y * ry + z * rz; } // inverse square root Vec operator!() {return *this * (1 / sqrtf(*this % *this) );} };</span></span></code> </pre> <br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреЛрдИ рдШрдЯрд╛рд╡ рдСрдкрд░реЗрдЯрд░ (-) рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП "X = A - B" рд▓рд┐рдЦрдиреЗ рдХреЗ рдмрдЬрд╛рдп, "X = A + B * -1" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЙрд▓рдЯрд╛ рд╡рд░реНрдЧрдореВрд▓ рдмрд╛рдж рдореЗрдВ рд╡реИрдХреНрдЯрд░ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдЖрддрд╛ рд╣реИред <br><br><h2>  рдореБрдЦреНрдп рд╕рдорд╛рд░реЛрд╣ </h2><br><hr><br>  main () рдПрдХрдорд╛рддреНрд░ рдРрд╕рд╛ рдЪрд░рд┐рддреНрд░ рд╣реИ рдЬрд┐рд╕реЗ рдмрд╛рдзрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ libc рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ _start рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд╛рдпрдХ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реЛрдЧрд╛ред  рдкрд╣рд▓реЗ рдкрддреНрд░реЛрдВ рдХреЗ рдЕрд░реНрде рдирд┐рдХрд╛рд▓рдиреЗ рдореЗрдВ рдореБрдЭреЗ рдереЛрдбрд╝рд╛ рд╕рдордп рд▓рдЧрд╛, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдХреБрдЫ рдкрдардиреАрдп рдмрдирд╛рдиреЗ рдореЗрдВ рдХрд╛рдордпрд╛рдм рд░рд╣рд╛ред <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w = <span class="hljs-number"><span class="hljs-number">960</span></span>, h = <span class="hljs-number"><span class="hljs-number">540</span></span>, samplesCount = <span class="hljs-number"><span class="hljs-number">16</span></span>; <span class="hljs-function"><span class="hljs-function">Vec </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-22</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">25</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; Vec goal = !(Vec(<span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) + position * <span class="hljs-number"><span class="hljs-number">-1</span></span>); Vec left = !Vec(goal.z, <span class="hljs-number"><span class="hljs-number">0</span></span>, -goal.x) * (<span class="hljs-number"><span class="hljs-number">1.</span></span> / w); <span class="hljs-comment"><span class="hljs-comment">// Cross-product to get the up vector Vec up(goal.y * left.z - goal.z * left.y, goal.z * left.x - goal.x * left.z, goal.x * left.y - goal.y * left.x); printf("P6 %d %d 255 ", w, h); for (int y = h; y--;) for (int x = w; x--;) { Vec color; for (int p = samplesCount; p--;) color = color + Trace(position, !(goal + left * (x - w / 2 + randomVal())+ up * (y - h / 2 + randomVal()))); // Reinhard tone mapping color = color * (1. / samplesCount) + 14. / 241; Vec o = color + 1; color = Vec(color.x / ox, color.y / oy, color.z / oz) * 255; printf("%c%c%c", (int) color.x, (int) color.y, (int) color.z); } }</span></span></code> </pre> <br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдлреНрд▓реЛрдЯ рд▓рд┐рдЯрд░рд▓ рдореЗрдВ "рдПрдл" рдЕрдХреНрд╖рд░ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдЕрдВрддрд░рд┐рдХреНрд╖ рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдВрд╢рд┐рдХ рднрд╛рдЧ рдХреЛ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдиреАрдЪреЗ рдЙрд╕реА рдЪрд╛рд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдкреВрд░реНрдгрд╛рдВрдХ рднрд╛рдЧ рдЧрд┐рд░рд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдлреНрд▓реЛрдЯ x = .5)ред  рдмреНрд░реЗрдХ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдЕрдВрджрд░ рдбрд╛рд▓реА рдЧрдИ рдПрдХ рдкреБрдирд░рд╛рд╡реГрддрд┐ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд╕рд╛рде рднреА рдЕрд╕рд╛рдорд╛рдиреНрдп "рдХреЗ рд▓рд┐рдП" рдирд┐рд░реНрдорд╛рдг рд╣реИред <br><br>  рдпрд╣ рдПрдХ рдХрд┐рд░рдг / рдкрде рдЕрдиреБрд░реЗрдЦрдХ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реБрдВрджрд░ рдорд╛рдирдХ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рд╣реИред  рдХреИрдорд░рд╛ рд╡реИрдХреНрдЯрд░ рдпрд╣рд╛рдВ рд▓рдЧрд╛рдП рдЧрдП рд╣реИрдВ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рд▓рд┐рдП рдХрд┐рд░рдгреЗрдВ рдЙрддреНрд╕рд░реНрдЬрд┐рдд рд╣реЛрддреА рд╣реИрдВред  рдХрд┐рд░рдг рдЕрдиреБрд░реЗрдЦрдХ рдФрд░ рдкрде рдЕрдиреБрд░реЗрдЦрдХ рдХреЗ рдмреАрдЪ рдХрд╛ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рдЯреАрдкреА рдореЗрдВ рдкреНрд░рддрд┐ рдкрд┐рдХреНрд╕реЗрд▓ рдХрдИ рдХрд┐рд░рдгреЗрдВ рдЙрддреНрд╕рд░реНрдЬрд┐рдд рд╣реЛрддреА рд╣реИрдВ, рдЬрд┐рдиреНрд╣реЗрдВ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдереЛрдбрд╝рд╛ рд╢рд┐рдлреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдлрд┐рд░ рдПрдХ рдкрд┐рдХреНрд╕реЗрд▓ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдХрд┐рд░рдг рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рдкреНрдд рд░рдВрдЧ рддреАрди рдлреНрд▓реЛрдЯ рдЪреИрдирд▓ рдЖрд░, рдмреА, рдЬреА рдореЗрдВ рдЬрдорд╛ рд╣реЛрддрд╛ рд╣реИред  рдЕрдВрдд рдореЗрдВ, рд░рд┐рдЗрдирд╣рд╛рд░реНрдб рд╡рд┐рдзрд┐ рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХрд╛ рдЯреЛрдирд▓ рд╕реБрдзрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣рд┐рд╕реНрд╕рд╛ рдирдореВрдирд╛ рд╣реИ, рдЬреЛ рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдФрд░ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЛ рдЧрддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП 1 рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдпрд╣рд╛рдВ 1 рд╕реЗ 2048 рддрдХ рдХреЗ рдирдореВрдирд╛ рдореВрд▓реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдирдореВрдирд╛ рд░реЗрдВрдбрд░рд┐рдВрдЧ рд╣реИрдВред <br><br><div class="spoiler">  <b class="spoiler_title">рд╕реНрдкрд╛рдпрд▓рд░ рд╣реЗрдбрд┐рдВрдЧ</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/550/e66/b2b/550e66b2b1347f8cafdf18c50d89e40d.png"><br><br>  1 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f49/724/1f0/f497241f0e3bb43fcc9913d8a2745419.png"><br><br>  2 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f71/3f3/35c/f713f335c2842b995936db1499e307e5.png"><br><br>  4 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b4f/6d4/f56/b4f6d4f56198a64b8e569a62f7159e8a.png"><br><br>  8 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a70/200/3c6/a702003c61d4080c2f92fe84844238cd.png"><br><br>  16 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bcf/0d6/43c/bcf0d643c501839c2506c7c026bc445c.png"><br><br>  32 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f0/5cf/569/8f05cf5690fa3265a1a4fa6f60a35749.png"><br><br>  64 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ebd/c87/660/ebdc87660263ff14eb6bf03a95865f34.png"><br><br>  128 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d17/0d3/1ae/d170d31aed20aeafc54d877ed447a1cc.png"><br><br>  256 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb9/52c/4df/fb952c4dfd0a4cb14245cedd060dcf05.png"><br><br>  512 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/460/50f/715/46050f71582834ddebbeb29dd86940fc.png"><br><br>  1024 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/947/ea8/88b/947ea888b63c32f0892cc1e25b187bf8.png"><br><br>  2048 </div></div><br><h2>  рд╣реЗрд▓реНрдкрд░ рдХреЛрдб </h2><br><hr><br>  рдХреЛрдб рдХрд╛ рдПрдХ рдФрд░ рд╕рд░рд▓ рдЯреБрдХрдбрд╝рд╛ рд╕рд╣рд╛рдпрдХ рдХрд╛рд░реНрдп рд╣реИред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рддреБрдЪреНрдЫ рдлрд╝рдВрдХреНрд╢рди рдорд┐рдирдЯ (), рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдореВрд▓реНрдп рдЬрдирд░реЗрдЯрд░ [0,1] рдФрд░ рдПрдХ рдмрд╣реБрдд рдЕрдзрд┐рдХ рджрд┐рд▓рдЪрд╕реНрдк рдмреЙрдХреНрд╕рдЯреЗрд╕реНрдЯ () рд╣реИ, рдЬреЛ рджреБрдирд┐рдпрд╛ рдХреЛ рдХрд╛рдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд┐рд╡ рд╕реЙрд▓рд┐рдб рдЬреНрдпрд╛рдорд┐рддрд┐ (рд╕реАрдПрд╕рдЬреА) рдкреНрд░рдгрд╛рд▓реА рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред  CSG рдХреА рдЪрд░реНрдЪрд╛ рдЕрдЧрд▓реЗ рднрд╛рдЧ рдореЗрдВ рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> l &lt; r ? l : r; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randomVal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) rand() / RAND_MAX; } <span class="hljs-comment"><span class="hljs-comment">// Rectangle CSG equation. Returns minimum signed distance from // space carved by lowerLeft vertex and opposite rectangle // vertex upperRight. float BoxTest(Vec position, Vec lowerLeft, Vec upperRight) { lowerLeft = position + lowerLeft * -1; upperRight = upperRight + position * -1; return -min( min( min(lowerLeft.x, upperRight.x), min(lowerLeft.y, upperRight.y) ), min(lowerLeft.z, upperRight.z)); }</span></span></code> </pre> <br><h2>  рд░рдЪрдирд╛рддреНрдордХ рд╡реЙрд▓реНрдпреВрдореЗрдЯреНрд░рд┐рдХ рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЗ рдХрд╛рд░реНрдп </h2><br><hr><br>  рдХреЛрдб рдореЗрдВ рдХреЛрдИ рдХреЛрдиреЗ рдирд╣реАрдВ рд╣реИрдВред  рд╕рдм рдХреБрдЫ CSG рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдЙрдирдХреЗ рд╕рд╛рде рдЕрдкрд░рд┐рдЪрд┐рдд рд╣реИрдВ, рддреЛ рдмрд╕ рдпрд╣ рдХрд╣реЗрдВ рдХрд┐ рдпреЗ рдРрд╕реЗ рдХрд╛рд░реНрдп рд╣реИрдВ рдЬреЛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╕рдордиреНрд╡рдп рд╡рд╕реНрддреБ рдХреЗ рдЕрдВрджрд░ рд╣реИ рдпрд╛ рдмрд╛рд╣рд░ред  рдпрджрд┐ рдлрд╝рдВрдХреНрд╢рди рд╕рдХрд╛рд░рд╛рддреНрдордХ рджреВрд░реА рд▓реМрдЯрд╛рддрд╛ рд╣реИ, рддреЛ рдмрд┐рдВрджреБ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдЕрдВрджрд░ рд╣реИред  рдПрдХ рдирдХрд╛рд░рд╛рддреНрдордХ рджреВрд░реА рдЗрдВрдЧрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдмрд┐рдВрджреБ рд╡рд╕реНрддреБ рдХреЗ рдмрд╛рд╣рд░ рд╣реИред  рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдХрд╛рд░реНрдп рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╕рд░рд▓реАрдХрд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдЗрдП рдПрдХ рдХреНрд╖реЗрддреНрд░ рдФрд░ рджреЛ рдмрд┐рдВрджреБрдУрдВ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рд▓реЗрддреЗ рд╣реИрдВ, рдП рдФрд░ рдмреАред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56f/424/13a/56f42413a77c51a3d06e12fd4b4b385e.svg" alt="рдЫрд╡рд┐"></div><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Signed distance point(p) to sphere(c,r) float testSphere(Vec p, Vec c, float r) { Vec delta = c - p; float distance = sqrtf(delta%delta); return radius - distance; } Vec A {4, 6}; Vec B {3, 2}; Vec C {4, 2}; float r = 2.; testSphere(A, C, r); // == -1 (outside) testSphere(B, C, r); // == 1 (inside)</span></span></code> </pre> <br>  TestSphere () рдлрд╝рдВрдХреНрд╢рди A рдХреЗ рд▓рд┐рдП -1 рд░рд┐рдЯрд░реНрди рджреЗрддрд╛ рд╣реИ (рдЬреЛ рдХрд┐, рдпрд╣ рдмрд╛рд╣рд░ рд╣реИ) рдФрд░ B рдХреЗ рд▓рд┐рдП 1 (рдпрд╛рдиреА рдпрд╣ рдЕрдВрджрд░ рд╣реИ)ред  рджреВрд░рд┐рдпреЛрдВ рдкрд░ рд╕рдВрдХреЗрдд рд╕рд┐рд░реНрдл рдПрдХ рдЪрд╛рд▓ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрдк рдПрдХ рд╣реА рдореВрд▓реНрдп рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдПрдХ рдХреЗ рдмрдЬрд╛рдп рджреЛ рдЯреБрдХрдбрд╝реЛрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдПрдХ рд╕рдорд╛рди рдкреНрд░рдХрд╛рд░ рдХреЗ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдПрдХ рд╕рдорд╛рдВрддрд░ рдЪрддреБрд░реНрднреБрдЬ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдмреЙрдХреНрд╕рдЯреЗрд╕реНрдЯ рдореЗрдВ рдРрд╕рд╛ рд╣реА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)ред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/757/1cd/25b/7571cd25baa7d2f9cfbd01f62e84aef1.svg"></div><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Signed distance point(p) to Box(c1,c2) float testRectangle(Vec p, Vec c1, Vec c2) { c1 = p + c1 * -1; c2 = c2 + position * -1; return min( min( min(c1.x, c2.x), min(c1.y, c2.y)), min(c1.z, c2.z)); } Vec A {3, 3}; Vec B {4, 6}; Vec C1 {2, 2}; Vec C2 {5, 4}; testRectangle(A, C1, C2); // 1.41 (inside) testRectangle(B, C1, C2); // -2.23 (outside)</span></span></code> </pre> <br>  рдЕрдм рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдпрджрд┐ рдЖрдк рд░рд┐рдЯрд░реНрди рд╡реИрд▓реНрдпреВ рдХрд╛ рдЪрд┐рдиреНрд╣ рдлреНрд▓рд┐рдк рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛ред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dcd/017/bd8/dcd017bd89a9e9d3955c94be3645aa20.svg"></div><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Signed distance point(p) to carved box(c1,c2) float testCarveBox(Vec p, Vec c1, Vec c2) { c1 = p + c1 * -1; c2 = c2 + position * -1; return -min( min( min(c1.x, c2.x), min(c1.y, c2.y)), min(c1.z, c2.z)); } Vec A {3, 3}; Vec B {4, 6}; Vec C1 {2, 2}; Vec C2 {5, 4}; testCarveBox(A, C1, C2); // == -1.41 (outside) testCarveBox(B, C1, C2); // == 2.23 (inside)</span></span></code> </pre> <br>  рдЕрдм рд╣рдо рдХрд┐рд╕реА рдареЛрд╕ рд╡рд╕реНрддреБ рдХрд╛ рд╡рд░реНрдгрди рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рдкреВрд░реА рджреБрдирд┐рдпрд╛ рдХреЛ рдареЛрд╕ рдШреЛрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕рдореЗрдВ рдЦрд╛рд▓реА рдЬрдЧрд╣ рдХрд╛рдЯ рджреЗрддреЗ рд╣реИрдВред  рдИрдВрдЯреЛрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд░реВрдк рдореЗрдВ рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╕рдВрдпреБрдХреНрдд рд╣реЛрдиреЗ рдкрд░ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд░реВрдкреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рддрд╛рд░реНрдХрд┐рдХ рдЬреЛрдбрд╝ рдСрдкрд░реЗрдЯрд░ (рдиреНрдпреВрдирддрдо рдлрд╝рдВрдХреНрд╢рди) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдо рдЖрдпрддреЛрдВ рдХреА рдПрдХ рдЬреЛрдбрд╝реА рдХреЛ рдПрдХ рдХреЗ рдКрдкрд░ рдПрдХ рдХрд╛рдЯ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛ред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48b/f78/615/48bf786150f9d37af1f51fd12987162e.svg"></div><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Signed distance point to room float testRoom(Vec p) { Vec C1 {2, 4}; Vec C2 {5, 2}; // Lower room Vec C3 {3, 5}; Vec C4 {4, 4}; // Upper room // min() is the union of the two carved volumes. return min(testCarvedBox(p, C1, C2), testCarvedBox(p, C3, C4)); } Vec A {3, 3}; Vec B {4, 6}; testRoom(A, C1, C2); // == -1.41 (outside) testRoom(B, C1, C2); // == 1.00 (inside)</span></span></code> </pre> <br>  рдпрджрд┐ рдЖрдк рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрддреЗ рд╣реИрдВ, рддреЛ рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдЬрд┐рд╕ рдХрдорд░реЗ рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдирд┐рдЪрд▓рд╛ рдХрдорд░рд╛ рдмрд┐рд▓реНрдХреБрд▓ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╡реНрдпрдХреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ - рджреЛ рдХрдЯреЗ рд╣реБрдП рд╕рдорд╛рдирд╛рдВрддрд░ рдЪрддреБрд░реНрднреБрдЬреЛрдВ рдХреА рдорджрдж рд╕реЗред <br><br>  рдЕрдм, CSG рдХреЗ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдЬреНрдЮрд╛рди рдореЗрдВ рдорд╣рд╛рд░рдд рд╣рд╛рд╕рд┐рд▓ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдХреЛрдб рдкрд░ рд▓реМрдЯ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдирд┐рдкрдЯрдирд╛ рд╕рдмрд╕реЗ рдореБрд╢реНрдХрд┐рд▓ рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HIT_NONE 0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HIT_LETTER 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HIT_WALL 2 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HIT_SUN 3 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Sample the world using Signed Distance Fields. float QueryDatabase(Vec position, int &amp;hitType) { float distance = 1e9; Vec f = position; // Flattened position (z=0) fz = 0; char letters[15*4+1] = // 15 two points lines "5O5_" "5W9W" "5_9_" // P (without curve) "AOEO" "COC_" "A_E_" // I "IOQ_" "I_QO" // X "UOY_" "Y_]O" "WW[W" // A "aOa_" "aWeW" "a_e_" "cWiO"; // R (without curve) for (int i = 0; i &lt; sizeof(letters); i += 4) { Vec begin = Vec(letters[i] - 79, letters[i + 1] - 79) * .5; Vec e = Vec(letters[i + 2] - 79, letters[i + 3] - 79) * .5 + begin * -1; Vec o = f + (begin + e * min(-min((begin + f * -1) % e / (e % e), 0), 1) ) * -1; distance = min(distance, o % o); // compare squared distance. } distance = sqrtf(distance); // Get real distance, not square distance. // Two curves (for P and R in PixaR) with hard-coded locations. Vec curves[] = {Vec(-11, 6), Vec(11, 6)}; for (int i = 2; i--;) { Vec o = f + curves[i] * -1; distance = min(distance, ox &gt; 0 ? fabsf(sqrtf(o % o) - 2) : (oy += oy &gt; 0 ? -2 : 2, sqrtf(o % o)) ); } distance = powf(powf(distance, 8) + powf(position.z, 8), .125) - .5; hitType = HIT_LETTER; float roomDist ; roomDist = min(// min(A,B) = Union with Constructive solid geometry //-min carves an empty space -min(// Lower room BoxTest(position, Vec(-30, -.5, -30), Vec(30, 18, 30)), // Upper room BoxTest(position, Vec(-25, 17, -25), Vec(25, 20, 25)) ), BoxTest( // Ceiling "planks" spaced 8 units apart. Vec(fmodf(fabsf(position.x), 8), position.y, position.z), Vec(1.5, 18.5, -25), Vec(6.5, 20, 25) ) ); if (roomDist &lt; distance) distance = roomDist, hitType = HIT_WALL; float sun = 19.9 - position.y ; // Everything above 19.9 is light source. if (sun &lt; distance)distance = sun, hitType = HIT_SUN; return distance; }</span></span></span></span></code> </pre> <br>  рдЖрдк рдпрд╣рд╛рдВ рд╕рдорд╛рдВрддрд░ рдЪрддреБрд░реНрднреБрдЬ "рдХрдЯрд┐рдВрдЧ" рдХрд╛ рдХрд╛рд░реНрдп рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдкреВрд░реЗ рдХрдорд░реЗ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рджреЛ рдЖрдпрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рд╣рдорд╛рд░рд╛ рдорд╕реНрддрд┐рд╖реНрдХ рдмрд╛рдХреА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рджреАрд╡рд╛рд░реЛрдВ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИ)ред  рдХреНрд╖реИрддрд┐рдЬ рд╕реАрдврд╝реА рд╢реЗрд╖ рд╡рд┐рднрд╛рдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ CSG рдлрд╝рдВрдХреНрд╢рди рд╣реИред  рдФрд░ рдЕрдВрдд рдореЗрдВ, PIXAR рд╢рдмреНрдж рдПрдХ рдореВрд▓ рдФрд░ рдбреЗрд▓реНрдЯрд╛ рдЬреЛрдбрд╝реА рдХреЗ рд╕рд╛рде 15 рд▓рд╛рдЗрдиреЛрдВ рд╕реЗ рдмрдирд╛ рд╣реИ рдФрд░ P рдФрд░ R рдЕрдХреНрд╖рд░ рдореЗрдВ рдШрдЯрддрд╛ рдХреЗ рд▓рд┐рдП рджреЛ рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓реЗ рд╣реИрдВред <br><br><h2>  рд░реЗ рдорд╛рд░реНрдЪрд┐рдВрдЧ </h2><br><hr><br>  рджреБрдирд┐рдпрд╛ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ CSG рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рд╣реЛрдирд╛, рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдореБрдЦреНрдп () рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдЙрддреНрд╕рд░реНрдЬрд┐рдд рд╕рднреА рдХрд┐рд░рдгреЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред  рд░реЗ рдорд╛рд░реНрдЪрд┐рдВрдЧ рдбрд┐рд╕реНрдЯреЗрдВрд╕ рдлрдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдирдореВрдирд╛ рд╕реНрдерд┐рддрд┐ рдирд┐рдХрдЯрддрдо рдмрд╛рдзрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рджреВрд░реА рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рддреА рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Perform signed sphere marching // Returns hitType 0, 1, 2, or 3 and update hit position/normal int RayMarching(Vec origin, Vec direction, Vec &amp;hitPos, Vec &amp;hitNorm) { int hitType = HIT_NONE; int noHitCount = 0; float d; // distance from closest object in world. // Signed distance marching for (float total_d=0; total_d &lt; 100; total_d += d) if ((d = QueryDatabase(hitPos = origin + direction * total_d, hitType)) &lt; .01 || ++noHitCount &gt; 99) return hitNorm = !Vec(QueryDatabase(hitPos + Vec(.01, 0), noHitCount) - d, QueryDatabase(hitPos + Vec(0, .01), noHitCount) - d, QueryDatabase(hitPos + Vec(0, 0, .01), noHitCount) - d) , hitType; // Weird return statement where a variable is also updated. return 0; }</span></span></code> </pre> <br>  рджреВрд░реА рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХрд┐рд░рдг рдорд╛рд░реНрдЪрд┐рдВрдЧ рдХрд╛ рд╡рд┐рдЪрд╛рд░ рдирд┐рдХрдЯрддрдо рд╡рд╕реНрддреБ рдХреА рджреВрд░реА рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдирд╛ рд╣реИред  рдЕрдВрдд рдореЗрдВ, рдХрд┐рд░рдг рд╕рддрд╣ рдкрд░ рдЗрд╕ рдХрджрд░ рдкрд╣реБрдВрдЪ рдЬрд╛рдПрдЧреА рдХрд┐ рдЗрд╕реЗ рдШрдЯрдирд╛ рдХрд╛ рдмрд┐рдВрджреБ рдорд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e99/774/398/e997743989aa1cb22fb65e6d5d8e93f2.svg"></div><br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрд┐рд░рдг рдорд╛рд░реНрдЪрд┐рдВрдЧ рд╕рддрд╣ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдЪреНрдЪреЗ рдЪреМрд░рд╛рд╣реЗ рдХреЛ рд╡рд╛рдкрд╕ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рд╕рдиреНрдирд┐рдХрдЯрдиред  рдЗрд╕реАрд▓рд┐рдП d &lt;0.01f рд╣реЛрдиреЗ рдкрд░ рдХреЛрдб рдореЗрдВ рдорд╛рд░реНрдЪрд┐рдВрдЧ рд░реБрдХ рдЬрд╛рддреА рд╣реИред <br><br><h2>  рдпрд╣ рд╕рдм рдПрдХ рд╕рд╛рде рд▓рд╛рдирд╛: рдирдореВрдирд╛ рд▓реЗрдирд╛ </h2><br><hr><br>  рдкрде рдЕрдиреБрд░реЗрдЦрдХ рдХреА рдЬрд╛рдВрдЪ рд▓рдЧрднрдЧ рдкреВрд░реА рд╣реЛ рдЪреБрдХреА рд╣реИред  рд╣рдо рдПрдХ рдкреБрд▓ рдХреЛ рдпрд╛рдж рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдЬреЛ рдореБрдЦреНрдп () рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХрд┐рд░рдг рдорд╛рд░реНрдЪрд░ рд╕реЗ рдЬреЛрдбрд╝рддрд╛ рд╣реИред  рдпрд╣ рдЕрдВрддрд┐рдо рднрд╛рдЧ, рдЬрд┐рд╕реЗ рдореИрдВрдиреЗ "рдЯреНрд░реЗрд╕" рдХрд╛ рдирд╛рдо рджрд┐рдпрд╛, рд╡рд╣ "рдорд╕реНрддрд┐рд╖реНрдХ" рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХрд┐рд░рдгреЗрдВ рдЙрдЫрд╛рд▓ рдпрд╛ рд░реБрдХрддреА рд╣реИрдВ, рдЬреЛ рдЙрд╕ рдореБрдарднреЗрдбрд╝ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Vec </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Trace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Vec origin, Vec direction)</span></span></span><span class="hljs-function"> </span></span>{ Vec sampledPosition, normal, color, attenuation = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-function"><span class="hljs-function">Vec </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lightDirection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(!Vec(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">.6</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">.6</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">))</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// Directional light for (int bounceCount = 3; bounceCount--;) { int hitType = RayMarching(origin, direction, sampledPosition, normal); if (hitType == HIT_NONE) break; // No hit. This is over, return color. if (hitType == HIT_LETTER) { // Specular bounce on a letter. No color acc. direction = direction + normal * ( normal % direction * -2); origin = sampledPosition + direction * 0.1; attenuation = attenuation * 0.2; // Attenuation via distance traveled. } if (hitType == HIT_WALL) { // Wall hit uses color yellow? float incidence = normal % lightDirection; float p = 6.283185 * randomVal(); float c = randomVal(); float s = sqrtf(1 - c); float g = normal.z &lt; 0 ? -1 : 1; float u = -1 / (g + normal.z); float v = normal.x * normal.y * u; direction = Vec(v, g + normal.y * normal.y * u, -normal.y) * (cosf(p) * s) + Vec(1 + g * normal.x * normal.x * u, g * v, -g * normal.x) * (sinf(p) * s) + normal * sqrtf(c); origin = sampledPosition + direction * .1; attenuation = attenuation * 0.2; if (incidence &gt; 0 &amp;&amp; RayMarching(sampledPosition + normal * .1, lightDirection, sampledPosition, normal) == HIT_SUN) color = color + attenuation * Vec(500, 400, 100) * incidence; } if (hitType == HIT_SUN) { // color = color + attenuation * Vec(50, 80, 100); break; // Sun Color } } return color; }</span></span></code> </pre> <br>  рдЕрдиреБрдордд рдмреАрдо рдкреНрд░рддрд┐рдмрд┐рдВрдм рдХреА рдЕрдзрд┐рдХрддрдо рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдВрдиреЗ рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдереЛрдбрд╝рд╛ рдкреНрд░рдпреЛрдЧ рдХрд┐рдпрд╛ред  рдорд╛рди "2" рдЕрдХреНрд╖рд░реЛрдВ рдХреЛ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд░реВрдк рд╕реЗ рд╕реБрдВрджрд░ рд▓реИрдХреНрдХреЗрд░реЗрдб рд╡реИрдиреНрдЯрдмреНрд▓реИрдХ рд░рдВрдЧ <sup>[4] рджреЗрддрд╛ рд╣реИ</sup> ред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d10/940/a3e/d10940a3ed7efab3271097904ce50d77.png"></div><br>  <i>1</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0c/8b2/c3b/e0c8b2c3b249057b1f5fd0d166e12014.png"></div><br>  <i>2</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb9/52c/4df/fb952c4dfd0a4cb14245cedd060dcf05.png"></div><br>  <i>3</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/65c/2f5/716/65c2f5716578caaa2fcc454a49376578.png"></div><br>  <i>4</i> <br><br><h2>  рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд╛рдл рд╕реНрд░реЛрдд рдХреЛрдб </h2><br><hr><br>  рд╕рдм рдХреБрдЫ рдПрдХ рд╕рд╛рде рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реНрд╡рдЪреНрдЫ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реНрд░реЛрдд рдХреЛрдб рдмрдирд╛рдпрд╛</a> ред <br><br><h2>  рд╕рдВрджрд░реНрдн рд╕рд╛рдордЧреНрд░реА </h2><br><hr><br>  [рез] рд╕реНрд░реЛрдд: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">f рдЕрдХреНрдЯреВрдмрд░ реирежрез le рдХреЛ рдЯреНрд╡рд┐рдЯрд░ рдкреЛрд╕реНрдЯ</a> <br><br>  [реи] рд╕реНрд░реЛрдд: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рдХрд┐рдкреАрдбрд┐рдпрд╛: NetPBM рдЫрд╡рд┐ рдкреНрд░рд╛рд░реВрдк</a> <br><br>  [рей] рд╕реНрд░реЛрдд: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рдЬрд╝реБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдиреЗ рд╕рдмрд╕реЗ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдореИрдХрдмреБрдХ рдкреНрд░реЛ, реирежрез Visual рдкрд░ рдкреНрд░рджрд░реНрд╢рди рдХрд┐рдпрд╛</a> <br><br>  [рек] рд╕реНрд░реЛрдд: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рдХрд┐рдкреАрдбрд┐рдпрд╛</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi434528/">https://habr.com/ru/post/hi434528/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi434514/index.html">"рд╕реАрдХреНрд░реЗрдЯ" DPAPI рдпрд╛ DPAPI рдкреЗрдВрдЯреЗрд╕реНрдЯрд░реНрд╕ рдХреЗ рд▓рд┐рдП</a></li>
<li><a href="../hi434516/index.html">рдЕрдкрдиреЗ рдХреИрд░рд┐рдпрд░ рдХреА рдЖрдХрд╛рдВрдХреНрд╖рд╛рдУрдВ рд╕реЗ рдирд┐рдкрдЯрдиреЗ рдХрд╛ рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ред</a></li>
<li><a href="../hi434518/index.html">рддрд╛рд▓рд┐рдпрд╛рдБ рдФрд░ рдЬрдпрдХрд╛рд░: рдРрдкреНрдкрд▓ рд╕реНрдЯреЛрд░реНрд╕ рдореЗрдВ рдзреНрдпрд╛рди рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдирд╛рдЯрдХ</a></li>
<li><a href="../hi434522/index.html">рдХрд╛рд░реНрдп рдФрдЪрд┐рддреНрдп рдкреИрдЯрд░реНрди рдФрд░ рдПрдВрдЯреАрдкреИрдЯрд░реНрди</a></li>
<li><a href="../hi434524/index.html">рдПрдХ рд╢реБрд░реБрдЖрдд рдХреА рдЖрдБрдЦреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ Kubernetes Ingress</a></li>
<li><a href="../hi434530/index.html">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреИрд▓реЗрдВрдбрд░, рдПрд▓рдбреАрдПрдкреА рдореЗрдВ рд╕реБрдзрд╛рд░ рдФрд░ рдЬреЛрдореНрдмреНрд░рд╛ 8.8.11 рдореЗрдВ рдЕрдиреНрдп рдирд╡рд╛рдЪрд╛рд░ рд╣реИрдВ</a></li>
<li><a href="../hi434532/index.html">рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреА рдХрд╣рд╛рдиреА: рдЬрдм рдПрдХ рдЯреАрдо рдореЗрдВ рдПрдХ рд╡рд░рд┐рд╖реНрда рдбреЗрд╡рд▓рдкрд░ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ</a></li>
<li><a href="../hi434534/index.html">ONYX BOOX "рдореЗрд░реА рдкрд╣рд▓реА рдкреБрд╕реНрддрдХ": рдорд╛рдБ рдФрд░ рдмрдЪреНрдЪреЗ рдХреЗ рд▓рд┐рдП рд╣рд╛рдирд┐рд░рд╣рд┐рдд рдкрдврд╝рдирд╛</a></li>
<li><a href="../hi434538/index.html">рдЕрдВрддрд░рд┐рдХреНрд╖ рдХреЗ рд▓рд┐рдП рд▓рдбрд╝рд╛рдИ: рдЙрдкрдЧреНрд░рд╣ рдЗрдВрдЯрд░рдиреЗрдЯ рдмрд╛рдЬрд╛рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ</a></li>
<li><a href="../hi434540/index.html">рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд░реЛрдмреЛрдЯ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>