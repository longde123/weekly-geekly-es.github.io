<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤œğŸ¾ âœğŸ¿ ğŸ‘¨ğŸ½â€ğŸ’¼ å­¦ä¹ åœ¨RIDEå’ŒRIDE4DAPPSä¸Šç¼–å†™Wavesæ™ºèƒ½åˆçº¦ã€‚ ç¬¬2éƒ¨åˆ†ï¼ˆDAO-æƒåŠ›ä¸‹æ”¾çš„è‡ªæ²»ç»„ç»‡ï¼‰ ğŸ…ğŸ¾ ğŸ’ƒğŸ¿ ğŸ’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ï¼ 


 åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ç ”ç©¶äº†å¦‚ä½•åœ¨Waves RIDE IDEä¸­åˆ›å»ºå’Œä½¿ç”¨dAppï¼ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ç¨‹åºï¼‰ã€‚ 


 ç°åœ¨è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸ªå°ä¾‹å­ ã€‚ 
 é˜¶æ®µ3.æµ‹è¯•dAppå¸æˆ· 



 Alice dAppå¸æˆ·ä¼šç«‹å³å‘ç°å“ªäº›é—®é¢˜ï¼Ÿ 
 é¦–å…ˆï¼š 
 Boobå’ŒCooperå¯èƒ½ä¼šé€šè¿‡æ­£å¸¸...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å­¦ä¹ åœ¨RIDEå’ŒRIDE4DAPPSä¸Šç¼–å†™Wavesæ™ºèƒ½åˆçº¦ã€‚ ç¬¬2éƒ¨åˆ†ï¼ˆDAO-æƒåŠ›ä¸‹æ”¾çš„è‡ªæ²»ç»„ç»‡ï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447808/"><p><img src="https://habrastorage.org/webt/dv/gy/ai/dvgyaisyoan4t42fb2fh-gepdzy.png"></p><br><p> å¤§å®¶å¥½ï¼ </p><br><p> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€</a>éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ç ”ç©¶äº†å¦‚ä½•åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Waves RIDE IDEä¸­</a>åˆ›å»ºå’Œä½¿ç”¨dAppï¼ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ç¨‹åºï¼‰ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç°åœ¨</a>è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸ªå°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¾‹å­</a> ã€‚ </p><br><h4> é˜¶æ®µ3.æµ‹è¯•dAppå¸æˆ· </h4><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/gp/sc/10/gpsc10yhhtxgqau9qbvs5l5qcda.png"></p><br><blockquote> Alice <strong>dApp</strong>å¸æˆ·ä¼šç«‹å³å‘ç°å“ªäº›é—®é¢˜ï¼Ÿ <br>  <strong>é¦–å…ˆï¼š</strong> <br>  Boobå’ŒCooperå¯èƒ½ä¼šé€šè¿‡æ­£å¸¸çš„<strong>è½¬è´¦</strong>äº¤æ˜“æ„å¤–åœ°å°†èµ„é‡‘å‘é€åˆ°dAppï¼Œå› æ­¤å°†æ— æ³•å–å›èµ„é‡‘ã€‚ <br><br>  <strong>å…¶æ¬¡ï¼š</strong> <br> æœªç»Boobå’Œ/æˆ–Cooperçš„åŒæ„ï¼Œæˆ‘ä»¬ä¸é™åˆ¶Aliceæå–èµ„é‡‘ã€‚ ç”±äºè¦æ³¨æ„éªŒè¯ï¼Œå› æ­¤å°†æ‰§è¡Œæ¥è‡ªAliceçš„æ‰€æœ‰äº‹åŠ¡ã€‚ <br><br>  <strong>ç¬¬ä¸‰ï¼š</strong> <br> åªéœ€å°†å…¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">publicKeyæ›¿æ¢</a>ä¸ºäº‹åŠ¡ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä»Aliceå¸æˆ·æ‰§è¡Œä»»ä½•æ“ä½œï¼š <br><pre><code class="scala hljs">const unsignedTransferTx = transfer({ amount: <span class="hljs-number"><span class="hljs-number">1</span></span>, recipient: <span class="hljs-symbol"><span class="hljs-symbol">'3P6fVra21KmTfWHBdib45iYV6aFduh4WwC</span></span>2', <span class="hljs-comment"><span class="hljs-comment">//senderPublicKey is required if you omit seed senderPublicKey: '6nR7CXVV7Zmt9ew11BsNzSvVmuyM5PF6VPbWHW9BHgPq' })</span></span></code> </pre> <br></blockquote><p>  <em>ä¸å¹¸çš„æ˜¯ï¼ŒWavesæ™ºèƒ½åˆçº¦å°šæœªå…è®¸æ‚¨é˜»æ­¢å¸æˆ·ä¸­çš„ä¼ å…¥äº¤æ˜“ï¼Œå› æ­¤Boobå’ŒCooperå¿…é¡»è‡ªå·±æ§åˆ¶å…¶ä¼ å‡ºäº¤æ˜“ã€‚</em> </p><br><p> è®©æˆ‘ä»¬é€šè¿‡<strong>ç¦ç”¨</strong> Aliceè®¾ç½®é™¤<strong>SetScriptTransaction</strong>ä¹‹å¤–çš„æ‰€æœ‰äº‹åŠ¡çš„æ–¹æ³•æ¥ä¿®å¤ç¬¬äºŒå’Œç¬¬ä¸‰<strong>é¡¹</strong> ï¼Œ <strong>å¹¶</strong>é€šè¿‡åœ¨@Verifierä¸­æŒ‡å®šå…¶å…¬å…±å¯†é’¥æ¥<strong>ç¦ç”¨</strong>å…¶ä½™äº‹åŠ¡ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä»…å…è®¸Aliceï¼ˆä½œä¸ºdAppå¼€å‘äººå‘˜ï¼‰åœ¨ä¸€æ®µæ—¶é—´å†…æ›´æ–°/æ›´æ­£æ™ºèƒ½åˆçº¦ã€‚ </p><br><blockquote> æ˜¯çš„ï¼Œçˆ±ä¸½ä¸å¯ä»¥éšæ—¶æ›´æ–°è„šæœ¬ä»¥è·å–æ›´å¤šæƒé™å¹¶ç®¡ç†â€œç”¨æˆ·â€çš„æ‰‹æ®µï¼Œä½†æ˜¯åªæœ‰å¥¹å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å°†çœ‹åˆ°æœªç»æˆæƒæ›´æ”¹åˆåŒçš„æ—¶åˆ»å¹¶å¯ä»¥é‡‡å–è¡ŒåŠ¨ã€‚ ä½†æ˜¯åªè¦æœªé˜»æ­¢invokeScriptä»¥å¤–çš„å…¶ä»–äº‹åŠ¡ï¼ŒAliceå°±éœ€è¦ä¿¡ä»»å®¢æˆ·ç«¯ã€‚ </blockquote><p> éƒ¨ç½²æ›´æ­£çš„è„šæœ¬ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-meta"><span class="hljs-meta">@Verifier</span></span>(tx) func verify() = { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> d: <span class="hljs-type"><span class="hljs-type">SetScriptTransaction</span></span> =&gt; sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], base58<span class="hljs-symbol"><span class="hljs-symbol">'x51ySWMyhE8G2AqJqmDpe3qoQM2aBwmieiJzZLK33J</span></span>W') <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><p> æˆ‘ä»¬æ­£åœ¨å°è¯•ä½¿ç”¨dApp AliceåŠå…¶ç­¾åæå–ç¡¬å¸ã€‚ æˆ‘ä»¬å¾—åˆ°é”™è¯¯ï¼š </p><br><p><img src="https://habrastorage.org/webt/7w/6x/ar/7w6xarwrxdrfe8exzr0x3dlzgmu.png"></p><br><p> æˆ‘ä»¬å°è¯•é€šè¿‡ææ¬¾é€€å‡ºï¼š </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"withdraw"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">1000000</span></span>}]}, payment: []}))</code> </pre> <br><p> è¯¥è„šæœ¬æœ‰æ•ˆï¼Œç¬¬äºŒç‚¹æˆ‘ä»¬å°±ææ¸…æ¥šäº†ï¼ </p><br><h4> é˜¶æ®µ4.æˆ‘ä»¬é€šè¿‡æŠ•ç¥¨åˆ›å»ºDAO </h4><br><p> ä¸å¹¸çš„æ˜¯ï¼ŒRIDEè¯­è¨€å°šæœªæä¾›ä½¿ç”¨é›†åˆï¼ˆå­—å…¸ï¼Œå­—å…¸ï¼Œè¿­ä»£å™¨ï¼Œå½’çº¦å™¨ç­‰ï¼‰çš„åŠŸèƒ½ã€‚ ä½†æ˜¯ï¼Œå¯¹äºå…·æœ‰å¹³å¦<strong>é”®å€¼</strong>é›†åˆçš„ä»»ä½•æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªç³»ç»Ÿæ¥åˆ†åˆ«ä½¿ç”¨å¸¦æœ‰é”®åŠå…¶è§£å¯†çš„å­—ç¬¦ä¸²ã€‚ <br> å­—ç¬¦ä¸²å¾ˆå®¹æ˜“è¿æ¥ï¼›å¯ä»¥æŒ‰ç´¢å¼•æ‹†åˆ†å­—ç¬¦ä¸²ã€‚ </p><br><p> æˆ‘ä»¬æ‹¥æœ‰ç¼–å†™å¤æ‚çš„<strong>DAO dApp</strong>é€»è¾‘æ‰€éœ€çš„ä¸€åˆ‡ï¼ </p><br><div class="spoiler">  <b class="spoiler_title">æ•°æ®äº¤æ˜“</b> <div class="spoiler_text"><p> æ•°æ®äº¤æ˜“ï¼š <br>  â€œå¯†é’¥çš„æœ€å¤§å¤§å°ä¸º100ä¸ªå­—ç¬¦ï¼Œå¯†é’¥å¯ä»¥åŒ…å«ä»»æ„Unicodeä»£ç ç‚¹ï¼ŒåŒ…æ‹¬ç©ºæ ¼å’Œå…¶ä»–ä¸å¯æ‰“å°çš„ç¬¦å·ã€‚ å­—ç¬¦ä¸²å€¼çš„é™åˆ¶ä¸º32,768å­—èŠ‚ï¼Œæ•°æ®äº‹åŠ¡ä¸­æœ€å¤§å¯èƒ½çš„æ¡ç›®æ•°ä¸º100ã€‚æ€»çš„æ¥è¯´ï¼Œæ•°æ®äº‹åŠ¡çš„æœ€å¤§å¤§å°çº¦ä¸º140kb-ä¾›å‚è€ƒï¼Œå‡ ä¹ä¸èå£«æ¯”äºšæˆå‰§ã€Šç½—å¯†æ¬§ä¸æœ±ä¸½å¶ã€‹çš„é•¿åº¦å®Œå…¨ä¸€æ ·ã€‚ â€ </p></div></div><br><p>  <u><strong>åˆ›å»ºå…·æœ‰ä»¥ä¸‹æ¡ä»¶çš„DAOï¼š</strong></u> <br> ä¸ºäº†ä½¿ä¸€å®¶åˆåˆ›å…¬å¸è·å¾—èèµ„ï¼Œè°ƒç”¨<strong>getFundsï¼ˆï¼‰</strong>è‡³å°‘éœ€è¦2ä½å‚ä¸è€…ï¼ˆDAOæŠ•èµ„è€…<strong>ï¼‰</strong>çš„æ”¯æŒã€‚ å¯ä»¥æå–ä¸DAOæ‰€æœ‰è€…æŒ‡ç¤ºçš„æ€»é‡‘é¢å®Œå…¨ç›¸åŒçš„é‡‘é¢ã€‚ </p><br><blockquote> è®©æˆ‘ä»¬åˆ¶ä½œ3ç§ç±»å‹çš„é”®ï¼Œå¹¶åœ¨2ä¸ªæ–°åŠŸèƒ½voteå’ŒgetFundsä¸­æ·»åŠ ç”¨äºå¤„ç†ä½™é¢çš„é€»è¾‘ï¼š <br>  xx ... xx <strong>_ia</strong> =æŠ•èµ„è€…ï¼Œå¯ç”¨ä½™é¢<em>ï¼ˆæŠ•ç¥¨ï¼Œå­˜æ¬¾ï¼Œææ¬¾ï¼‰</em> <br>  xx ... xx <strong>_sv</strong> =åˆ›ä¸šå…¬å¸ï¼ŒæŠ•ç¥¨æ•°<em>ï¼ˆæŠ•ç¥¨ï¼ŒgetFundsï¼‰</em> <br>  xx ... xx <strong>_sf</strong> =åˆ›ä¸šå…¬å¸ï¼ŒæŠ•ç¥¨æ•°<em>ï¼ˆæŠ•ç¥¨ï¼ŒgetFundsï¼‰</em> <br>  xx ... xx =å…¬å…±åœ°å€ï¼ˆ35ä¸ªå­—ç¬¦ï¼‰ </blockquote><p> è¯·æ³¨æ„ï¼Œåœ¨â€œæŠ•ç¥¨â€ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€æ¬¡æ›´æ–°å‡ ä¸ªå­—æ®µï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-type"><span class="hljs-type">WriteSet</span></span>([<span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(key1, value1), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(key2, value2)]),</code> </pre> <br><p>  WriteSetå…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ª<strong>invokeScript</strong>äº‹åŠ¡ä¸­ä¸€æ¬¡åˆ¶ä½œå¤šæ¡è®°å½•ã€‚ </p><br><p> åœ¨Bobå’ŒCooperè¡¥å……<strong>äº†</strong>å­˜æ¬¾ä¹‹åï¼Œè¿™å°±æ˜¯DAO dAppé”®å€¼å­˜å‚¨ä¸­çš„<strong>æ ·å­</strong> ï¼š </p><br><p><img src="https://habrastorage.org/webt/ao/8l/fq/ao8lfq7uk_qihgu3iiz1uiurw5q.png"></p><br><p> å­˜æ¬¾åŠŸèƒ½ç•¥æœ‰å˜åŒ–ï¼š </p><br><p><img src="https://habrastorage.org/webt/_u/28/ne/_u28nezib91y5t62tqi8p_ennfu.png"></p><br><p> ç°åœ¨æ˜¯DAOæ´»åŠ¨ä¸­æœ€é‡è¦çš„æ—¶åˆ»-ä¸ºèèµ„é¡¹ç›®<strong>æŠ•ç¥¨</strong> ã€‚ </p><br><p>  BobæŠ•ç¥¨æ”¯æŒNeliçš„500,000ä¸ªWaveleté¡¹ç›®ï¼š </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"vote"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">500000</span></span>}, {<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>, value: <span class="hljs-string"><span class="hljs-string">"3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"</span></span>}]}, payment: []}))</code> </pre> <br><p> æŠ•ç¥¨åŠŸèƒ½ä»£ç ï¼š </p><br><pre> <code class="scala hljs"><span class="hljs-meta"><span class="hljs-meta">@Callable</span></span>(i) func vote(amount: <span class="hljs-type"><span class="hljs-type">Int</span></span>, address: <span class="hljs-type"><span class="hljs-type">String</span></span>) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"ib"</span></span> let xxxStartupFund = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"sf"</span></span> let xxxStartupVotes = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + <span class="hljs-string"><span class="hljs-string">"sv"</span></span> let flagKey = address + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + currentKey let flag = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, flagKey) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentAmount = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxInvestorBalance) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentVotes = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxStartupVotes) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } let currentFund = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> getInteger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, xxxStartupFund) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> a:<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; a <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amount &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Can't withdraw negative amount"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amount &gt; currentAmount) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Not enough balance!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flag &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) then <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>(<span class="hljs-string"><span class="hljs-string">"Only one vote per project is possible!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">WriteSet</span></span>([ <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxInvestorBalance, currentAmount - amount), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxStartupVotes, currentVotes + <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(flagKey, <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-type"><span class="hljs-type">DataEntry</span></span>(xxxStartupFund, currentFund + amount) ]) }</code> </pre> <br><p> åœ¨æ•°æ®ä»“åº“ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Neliåœ°å€çš„æ‰€æœ‰å¿…è¦æ¡ç›®ï¼š </p><br><p><img src="https://habrastorage.org/webt/ot/su/t5/otsut5kwwj5vqholnxw4r17hgxk.png"></p><br><p> åº“ç€è¿˜æŠ•ç¥¨æ”¯æŒNelié¡¹ç›®ã€‚ </p><br><p><img src="https://habrastorage.org/webt/in/t5/o4/int5o4ktc3-kula5nzlaw3xmrnu.png"></p><br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<strong>getFunds</strong>å‡½æ•°<strong>ä»£ç </strong> ã€‚  Neliå¿…é¡»è‡³å°‘æ”¶é›†2ç¥¨æ‰èƒ½ä»DAOæå–èµ„é‡‘ã€‚ </p><br><p><img src="https://habrastorage.org/webt/-h/gy/lh/-hgylhk5ohku6fpxmqokigwxaii.png"></p><br><p> å†…è‰å°†æå–å§”æ‰˜ç»™å¥¹çš„æ¬¾é¡¹çš„ä¸€åŠï¼š </p><br><pre> <code class="scala hljs">broadcast(invokeScript({dappAddress: address(env.accounts[<span class="hljs-number"><span class="hljs-number">1</span></span>]), call:{function:<span class="hljs-string"><span class="hljs-string">"getFunds"</span></span>,args:[{<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>:<span class="hljs-string"><span class="hljs-string">"integer"</span></span>, value: <span class="hljs-number"><span class="hljs-number">500000</span></span>}]}, payment: []}))</code> </pre> <br><p><img src="https://habrastorage.org/webt/pi/tt/sr/pittsrw2bxznsoqjgn4uvg1ralu.png"></p><br><p> å¥¹æˆåŠŸäº†ï¼Œé‚£å°±æ˜¯DAOçš„ä½œå“ï¼ </p><br><p> æˆ‘ä»¬ç ”ç©¶äº†ä½¿ç”¨<strong>RIDE4DAPPS</strong>è¯­è¨€åˆ›å»ºDAOçš„è¿‡ç¨‹ã€‚ <br> åœ¨ä»¥ä¸‹éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°è®¨è®ºä»£ç é‡æ„å’Œæ¡ˆä¾‹æµ‹è¯•ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Waves RIDE IDEä¸­çš„</a>å®Œæ•´ä»£ç ç‰ˆæœ¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼š</a> </p><br><pre> <code class="scala hljs"># <span class="hljs-type"><span class="hljs-type">In</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> example multiple accounts can deposit their funds to <span class="hljs-type"><span class="hljs-type">DAO</span></span> and safely take them back, no one can interfere <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>. # <span class="hljs-type"><span class="hljs-type">DAO</span></span> participants can also vote <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> particular addresses and let them withdraw invested funds then quorum has reached. # <span class="hljs-type"><span class="hljs-type">An</span></span> inner state is maintained as mapping `address=&gt;waves`. # https:<span class="hljs-comment"><span class="hljs-comment">//medium.com/waves-lab/waves-announces-funding-for-ride-for-dapps-developers-f724095fdbe1 # You can try this contract by following commands in the IDE (ide.wavesplatform.com) # Run commands as listed below # From account #0: # deploy() # From account #1: deposit funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"deposit",args:[]}, payment: [{amount: 100000000, asset:null }]})) # From account #2: deposit funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"deposit",args:[]}, payment: [{amount: 100000000, asset:null }]})) # From account #1: vote for startup # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"vote",args:[{type:"integer", value: 500000}, {type:"string", value: "3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"}]}, payment: []})) # From account #2: vote for startup # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"vote",args:[{type:"integer", value: 500000}, {type:"string", value: "3MrXEKJr9nDLNyVZ1d12Mq4jjeUYwxNjMsH"}]}, payment: []})) # From account #3: get invested funds # broadcast(invokeScript({dappAddress: address(env.accounts[1]), call:{function:"getFunds",args:[{type:"integer", value: 500000}]}, payment: []})) {-# STDLIB_VERSION 3 #-} {-# CONTENT_TYPE DAPP #-} {-# SCRIPT_TYPE ACCOUNT #-} @Callable(i) func deposit() = { let pmt = extract(i.payment) if (isDefined(pmt.assetId)) then throw("can hodl waves only at the moment") else { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount + pmt.amount WriteSet([DataEntry(xxxInvestorBalance, newAmount)]) } } @Callable(i) func withdraw(amount: Int) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount - amount if (amount &lt; 0) then throw("Can't withdraw negative amount") else if (newAmount &lt; 0) then throw("Not enough balance") else ScriptResult( WriteSet([DataEntry(xxxInvestorBalance, newAmount)]), TransferSet([ScriptTransfer(i.caller, amount, unit)]) ) } @Callable(i) func getFunds(amount: Int) = { let quorum = 2 let currentKey = toBase58String(i.caller.bytes) let xxxStartupFund = currentKey + "_" + "sf" let xxxStartupVotes = currentKey + "_" + "sv" let currentAmount = match getInteger(this, xxxStartupFund) { case a:Int =&gt; a case _ =&gt; 0 } let totalVotes = match getInteger(this, xxxStartupVotes) { case a:Int =&gt; a case _ =&gt; 0 } let newAmount = currentAmount - amount if (amount &lt; 0) then throw("Can't withdraw negative amount") else if (newAmount &lt; 0) then throw("Not enough balance") else if (totalVotes &lt; quorum) then throw("Not enough votes. At least 2 votes required!") else ScriptResult( WriteSet([ DataEntry(xxxStartupFund, newAmount) ]), TransferSet([ScriptTransfer(i.caller, amount, unit)]) ) } @Callable(i) func vote(amount: Int, address: String) = { let currentKey = toBase58String(i.caller.bytes) let xxxInvestorBalance = currentKey + "_" + "ib" let xxxStartupFund = address + "_" + "sf" let xxxStartupVotes = address + "_" + "sv" let flagKey = address + "_" + currentKey let flag = match getInteger(this, flagKey) { case a:Int =&gt; a case _ =&gt; 0 } let currentAmount = match getInteger(this, xxxInvestorBalance) { case a:Int =&gt; a case _ =&gt; 0 } let currentVotes = match getInteger(this, xxxStartupVotes) { case a:Int =&gt; a case _ =&gt; 0 } let currentFund = match getInteger(this, xxxStartupFund) { case a:Int =&gt; a case _ =&gt; 0 } if (amount &lt;= 0) then throw("Can't withdraw negative amount") else if (amount &gt; currentAmount) then throw("Not enough balance!") else if (flag &gt; 0) then throw("Only one vote per project is possible!") else WriteSet([ DataEntry(xxxInvestorBalance, currentAmount - amount), DataEntry(xxxStartupVotes, currentVotes + 1), DataEntry(flagKey, 1), DataEntry(xxxStartupFund, currentFund + amount) ]) } @Verifier(tx) func verify() = { match tx { case d: SetScriptTransaction =&gt; sigVerify(tx.bodyBytes, tx.proofs[0], base58'x51ySWMyhE8G2AqJqmDpe3qoQM2aBwmieiJzZLK33JW') case _ =&gt; false } }</span></span></code> </pre> <br><hr><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€éƒ¨åˆ†</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Githubä»£ç </a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Waves RIDE IDE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">èµ æ¬¾è®¡åˆ’å…¬å‘Š</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN447808/">https://habr.com/ru/post/zh-CN447808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN447794/index.html">å…³äºç®€å•çš„äº‹æƒ…ï¼Œå¤æ‚çš„ã€‚ åŒ–å­¦å®¶ç»™3Dæ‰“å°æœºçš„ä¸€å°ä¿¡ã€‚ å¡‘æ–™æº¶å‰‚åŠå…¶é˜²æŠ¤</a></li>
<li><a href="../zh-CN447798/index.html">å¦‚ä½•ç”Ÿæˆå…·æœ‰æ´—é’±æ¨¡å¼çš„å·¨å¤§é‡‘èå›¾ï¼Ÿ</a></li>
<li><a href="../zh-CN447802/index.html">ä¼Šèè´æ‹‰2</a></li>
<li><a href="../zh-CN447804/index.html">çŸ®äººè¦å¡æ”¾å¼ƒäº†æ–‡å­—å›¾å½¢ï¼Œä½†æ²¡æœ‰æ”¾å¼ƒå…¶æœ¬è´¨</a></li>
<li><a href="../zh-CN447806/index.html">ä½¿ç”¨æ•£åˆ—åŠ å¿«ç¥ç»ç½‘ç»œçš„æ€§èƒ½</a></li>
<li><a href="../zh-CN447810/index.html">Azure DevOps Servicesçš„åˆ†æç°å·²å…¬å¼€å¯ç”¨</a></li>
<li><a href="../zh-CN447812/index.html">æˆ‘ä»¬å¦‚ä½•å°†æŒç»­æ›´æ–°äº¤ä»˜åˆ°å®¢æˆ·å¹³å°</a></li>
<li><a href="../zh-CN447814/index.html">åœ¨å“ªé‡Œä»¥åŠå¦‚ä½•å¼€è®¾å¼€å‘ä¸­å¿ƒï¼Ÿ</a></li>
<li><a href="../zh-CN447816/index.html">ä¸€ç‚¹C ++æ¨¡æ¿é­”æœ¯å’ŒCRTPæ¥æ§åˆ¶ç¼–è¯‘æ—¶ç¨‹åºå‘˜åŠ¨ä½œçš„æ­£ç¡®æ€§</a></li>
<li><a href="../zh-CN447818/index.html">æ•æ·æ—¥2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>