<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîí üöÑ üèø Energ√≠a de la bater√≠a para dispositivos MySensors üî§ üë©üèæ‚Äçü§ù‚Äçüë®üèΩ üëçüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta m√∫sica durar√° para siempre si cambio las pilas (C) 





 Esta obra est√° dedicada a mi investigaci√≥n sobre el poder de los dispositivos inal√°mbri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Energ√≠a de la bater√≠a para dispositivos MySensors</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465393/"><p>  <em>Esta m√∫sica durar√° para siempre si cambio las pilas (C)</em> </p><br><p><img src="https://habrastorage.org/webt/ut/-j/xu/ut-jxulgxugkbo3hrs8ax8metkg.jpeg"></p><br><p>  Esta obra est√° dedicada a mi investigaci√≥n sobre el poder de los dispositivos inal√°mbricos aut√≥nomos que forman parte del sistema de hogar inteligente MySensors. </p><br><h2 id="sperva-byl-litiy">  Primero hubo litio ... </h2><br><p>  M√°s bien, bater√≠as de iones de litio y pol√≠meros de litio. </p><br><p> Durante mucho tiempo, estas bater√≠as de aparatos viejos se acumularon en una caja.  Pens√©: aqu√≠ est√°, potencia universal para todos los microcontroladores de peque√±o tama√±o.  Adem√°s, el voltaje de 3.3-4.2V es excelente para AVR, as√≠ como para todo tipo de ESP y STM.  Para mayor confiabilidad, puede colocar un estabilizador LDO de la potencia requerida y obtener un 3.3 estable para MK y toda la periferia. </p><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/sl/by/e1/slbye1sktidu-9qymebtsw7gwzy.jpeg"></p><br><p>  Pero result√≥ que no todo es tan bueno. </p><br><ol><li>  Las bater√≠as necesitaban ser cargadas.  Para hacer esto, era necesario hacerlos extra√≠bles o agregar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un m√≥dulo de carga</a> a su dispositivo, lo que, a su vez, le dio un costo adicional, dimensiones y agujeros de carga en el estuche.  Y no siempre es conveniente cargar dispositivos, por ejemplo, un sensor meteorol√≥gico fuera de la ventana. </li><li>  Las bater√≠as de litio (como la mayor√≠a de las fuentes de alimentaci√≥n en general) no son adecuadas para su uso a bajas temperaturas.  En un sensor meteorol√≥gico conectado a la ventana, en invierno, la bater√≠a se hundi√≥ inmediatamente en las heladas. </li><li>  Durante la operaci√≥n a largo plazo, si el voltaje de la bater√≠a no se monitorea a tiempo, puede descargarlo "a cero", es decir, por debajo del valor permitido, que garantiza matarlo.  Por lo tanto, necesita protecci√≥n contra el exceso de descarga. </li><li>  Una variedad de tama√±os y capacidades de bater√≠a limita significativamente la repetibilidad de dispositivos en gabinetes id√©nticos.  Y las reservas de bater√≠as viejas llegaron r√°pidamente a su fin; como resultado, era necesario comprar un lugar nuevo.  Y, como result√≥, el costo de tales fuentes de energ√≠a result√≥ ser bastante centavo y agreg√≥ al menos $ 2 al costo de cada dispositivo (y teniendo en cuenta la placa de carga y m√°s).  Adem√°s, no hab√≠a econom√≠a por la recarga, ya que la mayor√≠a de los controladores aut√≥nomos consum√≠an muy poca energ√≠a y pod√≠an funcionar durante muchos meses sin recargar. </li></ol><br><p>  NiMH y otras bater√≠as AA / AAA fueron a√∫n peores.  Necesitaban cargarse en un cargador especial, ten√≠an un "efecto memoria" y un voltaje inicialmente bajo (1.2-1.3V), y cuando se conectaban en serie debido a la diferencia en la resistencia interna, una de las bater√≠as pod√≠a descargarse m√°s que otras, lo que nuevamente conduc√≠a a su deterioro </p><br><h2 id="i-vnov-litiy-">  Y de nuevo, litio ... </h2><br><p>  Ahora hay bater√≠as redondas de litio de 3.0V de tama√±o peque√±o, a favor de las cuales decid√≠ abandonar las bater√≠as caprichosas y caras. </p><br><p>  Las bater√≠as CR2032 se utilizan en una gran cantidad de computadoras BIOS, medidores el√©ctricos y otros dispositivos con RTC, relojes, calculadoras y varios juguetes.  Con peque√±as dimensiones y bajo precio, tienen un voltaje de 3.0V, que es bastante suficiente para MK y una capacidad decente de 200-250mA / h para sus dimensiones. </p><br><p><img src="https://habrastorage.org/webt/-x/4l/rx/-x4lrx1wg7c5gxmliml_lufiuyi.jpeg"></p><br><p>  Pero de nuevo, problemas.  El hecho del asunto.  que la corriente continua de tal bater√≠a es solo 0.4mA.  Si lo carga con una corriente m√°s alta, el voltaje de la bater√≠a caer√°, aunque luego puede recuperarse parcial o completamente.  Un modo de suspensi√≥n Mysensor t√≠pico consume varios microamperios.  Pero en el modo de transferencia, ya alrededor de 15-20 mA.  Al mismo tiempo, las nuevas versiones de la biblioteca MySensors obligan a los dispositivos a enviar muchos paquetes: ping, saludo, presentaciones, b√∫squeda de una puerta de enlace o enrutador, lo que resulta en una operaci√≥n larga, a veces de varios segundos, del m√≥dulo de radio.  Con un voltaje de aproximadamente 2V, los NRF24L01 chinos baratos comienzan a fallar, y a veces ni siquiera es posible ponerlos en modo de suspensi√≥n () desde MySensors. </p><br><p>  Como resultado, todo funciona de alguna manera con una bater√≠a nueva, pero a medida que la bater√≠a se descarga, aumentan los problemas de comunicaci√≥n, el m√≥dulo de radio comienza a inundar m√°s en el aire, aumentando la descarga de la bater√≠a.  Al final, el voltaje cae hasta el punto de que todo el dispositivo deja de dormir, y luego se produce un reinicio c√≠clico hasta que la bater√≠a se agota por completo. </p><br><p>  Dependiendo del fabricante y la "frescura" de la bater√≠a, el dispositivo puede funcionar desde un par de d√≠as hasta un mes.  Si compra bater√≠as baratas en AliExpress, entonces hay una loter√≠a.  La transici√≥n a los CR2450 y CR2477 m√°s potentes ahorra un poco, pero no saben c√≥mo dar una corriente de m√°s de 0,5 mA durante mucho tiempo. </p><br><p>  Durante un tiempo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">experiment√© con convertidores de impulso</a> que permitieron que la bater√≠a mantuviera un voltaje de funcionamiento normal para el MK hasta las √∫ltimas migajas de energ√≠a, pero ten√≠an una corriente de reposo peque√±a, pero no nula, que redujo la vida √∫til general. </p><br><h2 id="palchiki---mizinchiki">  Peque√±os dedos - peque√±os dedos </h2><br><p><img src="https://habrastorage.org/webt/ym/3r/sp/ym3rsphakzuewavswscm7ot7vvi.jpeg"></p><br><p>  Es hora de calmarse y adoptar la experiencia china "avanzada", para alimentar todos sus dispositivos desde tres AAA (las bater√≠as no est√°n incluidas).  Pero decidi√≥ buscar una soluci√≥n con al menos dos bater√≠as de 1.5 voltios. </p><br><p>  Me detuve en ese esquema con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estabilizador creciente NCP1400</a> : </p><br><p><img src="https://habrastorage.org/webt/zy/bv/ii/zybviid6dds-ng2kwivuenh9gli.jpeg"></p><br><p>  Dos bater√≠as AAA alcalinas conectadas en serie dan inicialmente 2.7-3.1V al final del per√≠odo de producci√≥n, reduciendo el voltaje a 1-2V </p><br><p>  Cuando el NCP1400 est√° apagado (nivel bajo en la entrada de control), la energ√≠a de la bater√≠a pasa inmediatamente al MC a trav√©s de la bobina L1 y el diodo Schottky d1 con una ca√≠da de voltaje m√≠nima de aproximadamente 0.1V.  Si se aplica un nivel alto a la entrada de control, entonces el estabilizador NCP1400 se inicia y proporciona un voltaje de 3.3V al MK con un voltaje de bater√≠a total de 0.8V a 3.1V. </p><br><h4 id="algoritm-raboty-takoy">  El algoritmo de operaci√≥n es el siguiente: </h4><br><ol><li>  La hora principal en que el controlador est√° en modo PowerDown, todos los perif√©ricos, incluido el NRF24, est√°n desactivados o tambi√©n en modo de bajo consumo. </li><li>  El MC sale del modo de suspensi√≥n por interrupci√≥n del temporizador o por una interrupci√≥n externa (por ejemplo, en interruptores por interrupci√≥n del bot√≥n), se mide el voltaje de alimentaci√≥n VCC (funci√≥n incorporada de los controladores AVR). </li><li>  Si el voltaje de suministro es superior a 3 V (u otro voltaje suficiente para un funcionamiento perif√©rico estable), entonces el NCP1400 no se inicia y todo el procesamiento se lleva a cabo con este voltaje de suministro hasta el siguiente ciclo de reposo. </li><li>  Si el voltaje es inferior a 3 V, el estabilizador NCP1400 se inicia, el voltaje de suministro se establece en 3,3 V, se realiza todo el procesamiento regular del dispositivo, incluido el env√≠o de datos a trav√©s de NRF24 </li><li>  Adem√°s, si el voltaje es superior a 1,7 V (voltaje suficiente para salir del MC del modo de suspensi√≥n), el NCP1400 se apaga hasta el pr√≥ximo ciclo de activaci√≥n. </li><li>  Si el voltaje es menor a 1.7 (el voltaje m√≠nimo del MK), entonces el NCP1400 no se apaga hasta que el controlador se reinicia o hasta que el voltaje de suministro cae por debajo de 0.8V (voltaje del NCP1400) </li></ol><br><div class="spoiler">  <b class="spoiler_title">Bosquejo de este algoritmo</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MY_RF24_CE_PIN 9 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MY_RF24_CS_PIN 10 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MY_RF24_POWER_PIN 8 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MY_RADIO_NRF24 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;MySensors.h&gt; #define PIN_NCP1400 2 #define CHILD_ID_VCC 0 MyMessage msgVcc(CHILD_ID_VCC, V_VOLTAGE); bool low_power = false; int readVcc(); // void before(){ pinMode(PIN_NCP1400,OUTPUT); digitalWrite(PIN_NCP1400,HIGH); } void presentation(){ sendSketchInfo("NCP1400 test", "1.0"); present(CHILD_ID_VCC, S_MULTIMETER,"mV"); } // void loop(){ int vcc = 1000; if( low_power == false ){ vcc = readVcc(); digitalWrite(PIN_NCP1400,HIGH); //  NRF1400 } if( vcc &lt; 1700 )low_power = true; //      NRF1400 send(msgVcc.set(vcc)); //  VCC if( low_power == false )digitalWrite(PIN_NCP1400,LOW); //  NRF1400 sleep( 300000 ); //      5  } /** *     VCC  */ int readVcc() { long result; // Read 1.1V reference against AVcc ADMUX = _BV(REFS0) | _BV(MUX3) | _BV(MUX2) | _BV(MUX1); delay(2); // Wait for Vref to settle ADCSRA |= _BV(ADSC); // Convert while (bit_is_set(ADCSRA,ADSC)); result = ADCL; result |= ADCH&lt;&lt;8; result = (1100L * 1023)/result; return((int)result); }</span></span></span></span></code> </pre> </div></div><br><h2 id="testirovanie">  Prueba </h2><br><p>  ¬øY c√≥mo lidiamos con el consumo actual en la pr√°ctica?  Conecto mi circuito al LBP y tomo medidas del consumo de corriente y el voltaje de salida. </p><br><p><img src="https://habrastorage.org/webt/ti/ss/_z/tiss_zsvv77ac2gpbmcmkigrwge.jpeg"></p><br><p>  La corriente de ralent√≠ con el NCP1400 apagado y un voltaje de entrada de 1-3 V fue de 0.3 ŒºA.  Incluso m√°s bajo que el declarado por la hoja de datos 0.5mkA (o tal vez en este rango mis dispositivos dan un gran error).  Pero con el estabilizador encendido sin carga, la corriente result√≥ ser inesperadamente grande: m√°s de 0.3 mA.  Result√≥ que la resistencia pull-up R1 caus√≥ un gran consumo.  Reemplazando la clasificaci√≥n R1 de 10K a 150K, obtuve 30 ŒºA a un voltaje de entrada de 3.0 V y 44 ŒºA a 1.0 V. </p><br><p>  Si elimina completamente la resistencia R1, el estabilizador, en ausencia de conectar esta entrada al MC, se consumir√° constantemente con un 2V entrante de aproximadamente 11 ŒºA. <br>  Ahora conecto el microcontrolador con NRF24L01 y el sensor HUD21, trabajando de acuerdo con el algoritmo descrito anteriormente: </p><br><ul><li>  Voltaje de entrada 3.0V - modo activo (NCP1400 est√° encendido) 32mA, modo inactivo (NCP1400 est√° apagado) 9mkA </li><li>  Voltaje de entrada 2.0V - modo activo (NCP1400 est√° encendido) 51mA, modo inactivo (NCP1400 est√° apagado) 6mA </li><li>  Voltaje de entrada 1.7V - modo activo (NCP1400 encendido) 63mA, modo inactivo (NCP1400 apagado) 5.6mA </li><li>  Voltaje de entrada 1.0V - NCP1400 est√° constantemente encendido - modo de suspensi√≥n 197mkA </li><li>  Voltaje de entrada 0.5V - NCP1400 est√° constantemente encendido - 397ŒºA modo de reposo </li></ul><br><p>  El consumo activo de la bater√≠a aumenta cuando se reduce la potencia.  El voltaje de 1.7V fue seleccionado experimentalmente.  Por debajo de este valor, es posible que el microcontrolador ya no funcione de manera estable.  Cuando el voltaje de la bater√≠a cae por debajo de este umbral, el estabilizador NCP1400 ya no se apaga y el consumo en modo de suspensi√≥n es bastante alto.  En este modo, las bater√≠as no durar√°n mucho, pero habr√° tiempo suficiente para reemplazarlas. </p><br><h2 id="voploschenie-v-zheleze">  Encarnaci√≥n en la gl√°ndula </h2><br><p>  Dise√±√© tableros de alimentaci√≥n universales para mis dispositivos dom√©sticos inteligentes </p><br><p><img src="https://habrastorage.org/webt/q5/gv/io/q5gviogxu9mb_biahhyvvdv0bpo.jpeg"></p><br><p><img src="https://habrastorage.org/webt/eg/da/sc/egdasc6nwhiv_frbsr_glatlqsy.jpeg"></p><br><p>  Y aunque los dispositivos terminados no eran tan compactos como con las bater√≠as de litio, el resultado fue bastante bueno para m√≠.  especialmente teniendo en cuenta el costo de las pilas alcalinas en las tiendas de Galomart, Kastorama, Leroyle, etc. </p><br><p><img src="https://habrastorage.org/webt/zp/vw/sm/zpvwsmw1ocdc7plhi0pupkqhmww.jpeg"></p><br><p>  Actualmente, opero en casa m√°s de una docena de dispositivos diferentes para controlar la temperatura, la humedad del suelo, etc. en el sistema MuSensors / MajorDoMo. </p><br><p>  Leer m√°s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en mi blog</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/465393/">https://habr.com/ru/post/465393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../465373/index.html">No es una revisi√≥n del ASUS ZenBook Pro 15 UX580GE: casi un a√±o con casi la parte superior</a></li>
<li><a href="../465375/index.html">Venta de servidores dedicados en Holanda y Mosc√∫</a></li>
<li><a href="../465377/index.html">Hazlo tu mismo Skype</a></li>
<li><a href="../465379/index.html">Control de bomba de insulina aut√≥nomo inal√°mbrico hecho en casa</a></li>
<li><a href="../465391/index.html">Siguiendo los pasos del movimiento ruso Scala. Parte 1</a></li>
<li><a href="../465395/index.html">¬øCu√°l es la diferencia principal entre la inyecci√≥n de dependencia y el localizador de servicios?</a></li>
<li><a href="../465397/index.html">¬øC√≥mo apareci√≥ el traductor Nitro, que ayuda a los desarrolladores en localizaci√≥n y soporte t√©cnico?</a></li>
<li><a href="../465399/index.html">Implemente el almacenamiento distribuido CEPH y con√©ctelo a Kubernetes</a></li>
<li><a href="../465401/index.html">5 actividades para acelerar la resoluci√≥n de problemas en cualquier equipo de TI</a></li>
<li><a href="../465403/index.html">Achtung! Nuevas c√°maras en el camino o informaci√≥n actualizada sobre radares y detectores de radar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>