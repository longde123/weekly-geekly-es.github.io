<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßíüèø üè™ ü•ù 1C Developer Tales: Epicafe üçÅ üè™ üåã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A todos nos encanta hablar de nuestros √©xitos y realmente no nos gusta hablar de fracasos. Pero la experiencia de los errores suele ser m√°s valiosa qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>1C Developer Tales: Epicafe</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470207/">  A todos nos encanta hablar de nuestros √©xitos y realmente no nos gusta hablar de fracasos.  Pero la experiencia de los errores suele ser m√°s valiosa que la ganancia de un negocio completado con √©xito.  Por lo tanto, me gustar√≠a hablar sobre estos casos hoy.  Entonces vamos ... <br><a name="habracut"></a><br><h2>  ¬°Olla, no cocines! </h2><br>  Esta historia sucedi√≥ hace unos a√±os, al comienzo de mi carrera como desarrollador de 1C. <br><br>  Ha aparecido un proyecto en nuestra empresa para optimizar la operaci√≥n de una base muy cargada de un cliente muy grande y respetado.  El cliente estaba con un servicio de seguridad tan paranoico que no hab√≠a ni acceso remoto a los servidores desde el exterior.  Para conectarse a las bases directamente a nuestra oficina, se instal√≥ una red de √°rea local separada con VPN de hardware y se instalaron estaciones de trabajo con software estrictamente negociado.  Por supuesto, sin los derechos de un administrador local. <br><br>  Como cualquier otro proyecto de este tipo, comenz√≥ con la recopilaci√≥n de datos.  Se asumi√≥ que primero recopilaremos varios indicadores dentro de un mes, y luego nos dedicaremos a optimizar la base de informaci√≥n en s√≠.  C√≥mo y cu√°nto tiempo en este entorno burocr√°tico tom√≥ para establecer el CCM, este es material para una historia separada.  Pero ahora, en alg√∫n momento, sucedi√≥, el MCC se configur√≥ y se inici√≥.  Despu√©s de eso, el experto que dirigi√≥ este proyecto (Dima, ¬°hola!), Se subi√≥ a su lujoso autom√≥vil y se fue a viajar por nuestro vasto pa√≠s, y luego m√°s a los pa√≠ses vecinos.  Pero, de hecho, todav√≠a sab√≠a poco y sab√≠a c√≥mo, pero ya me consideraban un desarrollador bastante responsable.  Por lo tanto, antes de partir, Dmitry me instruy√≥ una tarea muy importante y seria: 2 veces al d√≠a, en el momento de la carga m√°xima, ten√≠a que ir a esa computadora muy secreta y comenzar las mediciones en el CCM, y apagarlas despu√©s de una hora.  Las instrucciones fueron extremadamente simples y claras: <br><br>  - Mire, presiona este peque√±o bot√≥n verde "reproducir", se ejecutan diferentes gr√°ficos, espere una hora, luego presiona este bot√≥n - "detener".  Eso es todo. <br><br>  ¬øQu√© podr√≠a ser m√°s f√°cil, verdad?  ¬øEn vano estudi√© durante 5 a√±os en la facultad de matem√°ticas? <br><br>  Toda la semana observ√© estrictamente este ritual en la ma√±ana y en la noche.  Y todo estuvo bien hasta el √∫ltimo d√≠a.  Despu√©s del almuerzo, el viernes, como de costumbre, comenc√© a recopilar datos, y luego ... Bueno, ya sabes c√≥mo sucede ... Viernes, por la noche, tenemos que terminar algunos asuntos urgentes, terminar algunas tareas, despu√©s del trabajo llevar a mi esposa a mi suegra, en el camino caer en una tienda, un segundo, etc.  En general, dej√© el trabajo, olvid√°ndome por completo de este MCC desafortunado. <br><br>  El s√°bado por la ma√±ana comenz√≥ con una llamada.  Tenemos TODA la 1¬™ base en el cliente.  Achtung y desastre!  Nuestro experto est√° en alg√∫n lugar entre Dzheyrakh y Pasanauri, fuera del √°rea de acceso a la red.  El administrador principal del cliente tambi√©n est√° en alguna casa de campo e inaccesible.  Tratando de averiguar por tel√©fono, ¬øcu√°l es la raz√≥n?  De alguna manera resulta que el espacio en disco se ha agotado, por lo que el servicio del agente 1C se levant√≥.  Aqu√≠ ya comenc√© a sospechar algo ... <br><br>  Como recordar√°s, no hay udalenka.  La computadora no solo est√° aislada de Internet, sino tambi√©n fuera de nuestra red local.  Nada que hacer, ir a trabajar.  Mientras se preparaban y conduc√≠an, los administradores se dieron cuenta de que los registros de MCC ocuparon todo el lugar e hicieron lo que pensaron que era m√°s razonable: lo cortaron a trav√©s del administrador de tareas.  Adelante  No puede simplemente eliminar registros del disco: perderemos los datos de medici√≥n.  De alguna manera encontraron suficiente espacio en la red compartida y copiaron los archivos all√≠.  El trabajo parece haberse reanudado. <br><br>  El domingo por la ma√±ana comenz√≥ con una llamada.  Tenemos TODA la 1¬™ base en el cliente.  ¬°Achtung y el desastre toman dos!  Todo el p√°nico se acab√≥, el lugar se acab√≥.  Pero como es eso?  MCC apagado?  A toda prisa, voy a volver a trabajar, tirando los troncos para liberar espacio.  Y todos crecen y crecen, ¬°malditos sean!  Bajo el temor de las ejecuciones m√°s perversas, los administradores me prohibieron comenzar cualquier cosa o configurar cualquier cosa.  Durante el resto del domingo, estuve sentado frente a la computadora y copiando los registros a la pelota para que las bases no volvieran a levantarse. <br><br>  Solo a altas horas de la noche, Dima se puso en contacto y dijo que solo necesita eliminar un peque√±o archivo en el servidor 1C.  M√°s tarde, un par de semanas despu√©s, le√≠ sobre √©l en un conocido libro de "escritorio", pero ese d√≠a, exhausto, el torturado se fue a casa a dormir. <br><br>  El lunes por la ma√±ana, nuestra cuenta fue bloqueada hasta que Dmitry regres√≥ de vacaciones, y se dijo claramente a mi cuenta: "¬°Para que no lo volvamos a ver!" <br><br>  As√≠ es como termin√≥ mi primer proyecto de optimizaci√≥n. <br><br><h2>  Dos veces en un embudo </h2><br>  Gran explotaci√≥n.  18 bases de informaci√≥n con id√©ntica configuraci√≥n, ubicadas en todo el pa√≠s.  La actualizaci√≥n se realiza una vez por semana y es el mismo ritual: el archivo de entrega debe prepararse con anticipaci√≥n, cargarse en la nube, asegurarse de que se haya descargado en todas las sucursales (incluso en 2018, en algunas regiones, Internet es m√°s lento que el t√≠pico 1C: ERP), compruebe que las copias de seguridad se crearon en todas partes (no parecemos ser responsables de esto, pero la amarga experiencia nos ense√±√≥ a estar seguros), luego ejecute el script de actualizaci√≥n manualmente en cada rama y aseg√∫rese de que funcion√≥ sin errores.  A menudo, en el √∫ltimo momento, se descubre que se debe incluir una tarea m√°s en la entrega y esta es una correcci√≥n menor, porque la pr√≥xima actualizaci√≥n es solo en una semana. <br><br>  Entonces fue ese momento.  Un desarrollador experimentado con muchos a√±os de experiencia a toda prisa cometi√≥ un error en una l√≠nea al transferir una tarea a un circuito de combate.  El error result√≥ ser cr√≠tico, se descubri√≥ despu√©s de actualizar todas las bases de datos. <br><br>  Bien que hacer  El desarrollador corrige r√°pidamente el c√≥digo.  No deja que nadie pruebe: <br><br>  - S√≠, hay basura ... ¬øNo puedo cometer un error dos veces en una l√≠nea? <br><br>  Una hora despu√©s, 18 sucursales se actualizaron por tercera vez. <br><br><h2>  Desarrollador que podr√≠a </h2><br>  La historia contada por un colega en Skype. <br>  [Colega]: ¬°Hab√≠a una vez un "Desarrollador que pod√≠a!"  Ten√≠a un traje de desarrollo.  Quer√≠a abrir una prueba, pero fall√≥ y abri√≥ una productiva ... <br>  [Colega]: ¬øPero esto podr√≠a detener al "Desarrollador que podr√≠a"?  No! <br>  [I]: ¬øY al actualizar, no entendi√≥ que hab√≠a gente sentada all√≠, por as√≠ decirlo?  ))) <br>  [Colega]: Adem√°s, √©l ve que el konf est√° en soporte ... ¬øPero crees que esto podr√≠a detener al "Desarrollador que podr√≠a"?  No! <br>  [Colega]: Elimina la configuraci√≥n del soporte (!) Y ve su mod sin pasar por todos los repositorios ... <br>  [I]: ¬°Eso no es todo!  Terminar la historia, actualizaci√≥n din√°mica))) <br>  [Colega]: Actualizaciones ... El sistema dice: "¬°Hay 18 sesiones activas en la base de datos!".  Pero, ¬øc√≥mo podr√≠a esto detener al "Desarrollador que podr√≠a"?  ¬°No y no otra vez! <br>  [Colega]: Actualiza la base de datos y pasa la tarea a la prueba ... <br>  [Colega]: El consultor no puede encontrar el atuendo ... y solo entonces, despu√©s de mucho tiempo, se da cuenta de que se lo perdi√≥. <br>  [Colega]: tuve que rega√±arlo ... <br>  [Colega]: lo llamo ... y me r√≠o del tel√©fono ... <br>  [Colega]: Simplemente no entiendo ... ¬øC√ìMO? <br><br><h2>  Colapso del transporte </h2><br>  La historia contada por un colega y registrada a partir de sus palabras. <br><br>  Sucedi√≥ en una gran empresa de log√≠stica.  La mayor√≠a de los procesos comerciales se concentran en una base de informaci√≥n.  Usuarios competitivos para 2012: alrededor de 3.000 personas de todas las regiones del pa√≠s. <br><br>  Establece una tarea simple.  Seg√∫n √©l, hizo su propio registro de informaci√≥n, en el que los datos se escriben cuando se publican ciertos documentos.  Aunque no hay muchos tipos de documentos, la cantidad de estos documentos por d√≠a es enorme.  En teor√≠a, la operaci√≥n de escritura que agregu√© al registro no deber√≠a cargar mucho el sistema.  Pero hubo un matiz en la implementaci√≥n de la tarea: al grabar un conjunto, la propiedad Overwrite se estableci√≥ en False.  Es decir, cada documento que contiene entradas agregadas al registro.  Esto era necesario de acuerdo con las condiciones del problema, pero pr√°cticamente no afectaba el rendimiento, porque  De acuerdo con las condiciones de selecci√≥n, siempre hab√≠a entre 1 y 10 entradas. <br><br>  La prueba funcional fue exitosa.  Realizamos varias docenas de documentos, nos aseguramos de que las entradas en el registro fueran correctas, no notaron nada sospechoso y las enviamos a los productivos. <br><br>  Ese desafortunado viernes por la ma√±ana, actualizamos la base de combate y los usuarios comenzaron a trabajar.  3000 personas llenaron documentos alegremente y el registro comenz√≥ a llenarse de datos.  Despu√©s de verificar que todo iba bien, unas horas despu√©s nos fuimos a casa con un alma tranquila (trabajamos en diferentes zonas horarias con los principales usuarios de la base de informaci√≥n). <br><br>  Cabe se√±alar que los servidores en los que se ejecutaba el IS son casi uno de los m√°s potentes en Rusia utilizados bajo 1C.  Pero despu√©s de unas horas "algo sali√≥ mal" (c). <br><br>  Los usuarios comenzaron a notar una disminuci√≥n en el rendimiento del sistema.  Todas las operaciones comenzaron a disminuir.  Las respuestas a cualquier acci√≥n se hicieron m√°s largas.  La carga en el equipo aument√≥ constantemente.  Mientras el departamento de TI entend√≠a lo que estaba sucediendo, el trabajo en el sistema casi se detuvo.  El equipo no pod√≠a hacer frente, las colas en los discos eran m√°s largas que en las oficinas de correos de Rusia.  Si el equipo fuera m√°s d√©bil, el problema se detectar√≠a casi de inmediato.  Pero los servidores m√°s poderosos resistieron heroicamente mis manos torcidas durante medio d√≠a. <br><br>  "De las palabras" de MSSQL, la solicitud m√°s severa de repente se convirti√≥ en una solicitud de lectura en mi registro.  Aunque no hice ninguna lectura.  Se descubri√≥ r√°pidamente un problema en el c√≥digo 1C.  Olvid√© establecer selecciones en un conjunto de registros.  Si la propiedad "Sobrescribir" se estableciera en "Verdadero", entonces inmediatamente encontrar√≠a un error, porque  cada entrada borrar√≠a todo el registro.  Pero en nuestro caso esto no sucedi√≥.  En el ejemplo de una docena de documentos, por supuesto, no notamos ninguna p√©rdida de rendimiento.  Pero cuando el registro comenz√≥ a llenarse con decenas y cientos de miles de l√≠neas, el sistema cada vez tuvo que verificar todo el registro para buscar registros coincidentes. <br><br>  En ese momento, seg√∫n algunos usuarios, ya se hab√≠a producido un colapso del transporte, porque  los autom√≥viles no recibieron documentos del 1C y no pudieron abandonar los puntos de descarga. <br><br>  Entonces, "solo" olvidando poner una selecci√≥n en el conjunto de registros, puse una de las bases de datos 1C m√°s grandes de Rusia. <br><br><h2>  PD Ver tambi√©n: </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1C Developer Tales: admin</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/470207/">https://habr.com/ru/post/470207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../470193/index.html">Protecci√≥n universal contra ataques xss e inyecciones sql</a></li>
<li><a href="../470195/index.html">F # 4: Let / Use / Do</a></li>
<li><a href="../470197/index.html">¬øPuedo hacer? Considere el patr√≥n Has</a></li>
<li><a href="../470199/index.html">Memo a un desarrollador novato de juegos de computadora</a></li>
<li><a href="../470203/index.html">La aguja de aprobaci√≥n del karma, como espejo de la evoluci√≥n del homo</a></li>
<li><a href="../470209/index.html">Transformaci√≥n de c√≥digo en Android 2. An√°lisis AST</a></li>
<li><a href="../470215/index.html">CAGR como una maldici√≥n sobre especialistas, o errores en la predicci√≥n de procesos exponenciales</a></li>
<li><a href="../470217/index.html">Falso DS18B20 a prueba de agua: ¬øqu√© hacer?</a></li>
<li><a href="../470219/index.html">F # 5: Operadores</a></li>
<li><a href="../470221/index.html">Holivar Historia de Runet. Parte 3. Motores de b√∫squeda: Yandex vs Rambler. ¬øC√≥mo no hacer una inversi√≥n?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>