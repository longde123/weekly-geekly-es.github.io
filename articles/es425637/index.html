<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>А  大Ⅲン Algoritmo de establecimiento de conexi贸n SSH  锔 </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(El t铆tulo inicial del art铆culo "Algoritmo de Operaci贸n del Protocolo SSH" fue cambiado de acuerdo con las recomendaciones de Vindicar , Karroplan y o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Algoritmo de establecimiento de conexi贸n SSH</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425637/"> <i>(El t铆tulo inicial del art铆culo "Algoritmo de Operaci贸n del Protocolo SSH" fue cambiado de acuerdo con las recomendaciones de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Vindicar</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Karroplan</a> y otros miembros de la comunidad de habro)</i> <br><br>  Mientras le铆a peri贸dicamente art铆culos sobre SSH, not茅 que sus autores a veces no tienen idea de c贸mo funciona este protocolo.  En la mayor铆a de los casos, se limitan a considerar el tema de la generaci贸n de claves y describir las opciones de los comandos principales.  Incluso los administradores de sistemas experimentados a menudo no tienen sentido cuando discuten problemas de SSH, emitiendo opus con estilo: los datos transmitidos se cifran con la clave SSH p煤blica del cliente y se descifran con la clave privada, o: el algoritmo RSA se utiliza para cifrar datos durante la transmisi贸n. <br><br>  Tratar茅 de aportar algo de claridad al funcionamiento del protocolo SSH y, al mismo tiempo, considerar el papel del algoritmo RSA y las claves de autorizaci贸n del usuario ... <br><br><img src="https://habrastorage.org/webt/nh/ea/cr/nheacr1id9mw1cn3-bqnkuibjom.png" alt="imagen"><br><a name="habracut"></a><br>  El algoritmo de protocolo SSH se puede dividir en tres niveles, cada uno de los cuales se encuentra por encima del anterior: transporte (apertura de un canal seguro), autenticaci贸n, conexi贸n.  En aras de la integridad de la imagen, tambi茅n agregar茅 un nivel de configuraci贸n de conexi贸n de red, aunque oficialmente este nivel est谩 por debajo de SSH. <br><br><h4>  1. Establecer una conexi贸n TCP </h4><br>  No me detendr茅 en el principio de la pila TCP / IP, ya que este tema est谩 bien documentado en Runet.  Si es necesario, puede encontrar informaci贸n f谩cilmente. <br><br>  En este punto, el cliente se conecta al servidor en el puerto TCP especificado en la opci贸n Puerto (predeterminado: 22) en el archivo de configuraci贸n del servidor / etc / ssh / sshd_config. <br><br><h4>  2. Abrir un canal seguro </h4><br>  <b>2.1 Intercambio de identidad</b> <br><br>  Una vez establecida la conexi贸n TCP, el cliente y el servidor (en adelante, las partes) intercambian versiones del protocolo SSH y otros datos de respaldo necesarios para determinar la compatibilidad del protocolo y seleccionar algoritmos de operaci贸n. <br><br>  <b>2.2 Elecci贸n de algoritmos: intercambio de claves, cifrado, compresi贸n, etc.</b> <br><br>  SSH utiliza muchos algoritmos, algunos de ellos se utilizan para el cifrado, el segundo para el intercambio de claves, el tercero para la compresi贸n de los datos transmitidos, etc.  En este paso, las partes se env铆an entre s铆 listas de algoritmos compatibles, los algoritmos en la parte superior de cada lista tienen la m谩xima prioridad.  Luego, los algoritmos en las listas obtenidas se comparan con los algoritmos disponibles en el sistema, y se selecciona el primero que coincide en cada lista. <br><br>  La lista de algoritmos de intercambio de claves del lado del cliente disponibles (utilizados para obtener una clave de sesi贸n) se puede ver con el comando: <br><br><pre><code class="bash hljs">ssh -Q kex</code> </pre> <br>  Lista de algoritmos sim茅tricos disponibles en el sistema (utilizados para el cifrado de canales): <br><br><pre> <code class="bash hljs">ssh -Q cipher</code> </pre> <br>  La lista de tipos de clave para autorizaci贸n en el cliente: <br><br><pre> <code class="bash hljs">ssh -Q key-cert</code> </pre> <br>  <i>Actualizado por el comentario <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">onix74</a> :</i> <br>  Todos los comandos utilizados en la publicaci贸n son relevantes para OpenSSH versi贸n 7.6 de Ubuntu 18.04 LTS. <br><br>  <b>2.3 Obtenci贸n de una clave de cifrado de sesi贸n</b> <br><br>  El proceso de obtenci贸n de una clave de sesi贸n puede diferir seg煤n la versi贸n del algoritmo, pero en t茅rminos generales se reduce a lo siguiente: <br><br><ul><li>  El servidor env铆a su clave al cliente (DSA, RSA, etc., de acuerdo con el acuerdo entre las partes presentado en la cl谩usula 2.2). </li><li>  Si el cliente se conecta a este servidor por primera vez (como lo indica la falta de una entrada en el archivo /home/username/.ssh/known_hosts en el cliente), se le preguntar谩 al usuario si puede confiar en la clave del servidor.  Si la conexi贸n con este servidor ya se ha establecido anteriormente, el cliente compara la clave enviada con la clave registrada en /home/username/.ssh/known_hosts.  Si las claves no coinciden, el usuario recibir谩 una advertencia sobre un posible intento de pirater铆a.  Sin embargo, puede omitir esta comprobaci贸n si llama a ssh con la opci贸n StrictHostKeyChecking: <br><pre> <code class="bash hljs">ssh -o StrictHostKeyChecking=no username@servername</code> </pre>  Adem谩s, si el usuario necesita eliminar la antigua clave del servidor (por ejemplo, cuando existe una certeza exacta de que la clave se ha cambiado en el servidor), se utiliza el comando: <br><pre> <code class="bash hljs">ssh-keygen -R servername</code> </pre> <br></li><li>  Una vez que el cliente ha determinado la confianza en la clave del servidor, utilizando una de las implementaciones (la versi贸n se define en la Secci贸n 2.2) del algoritmo Diffie-Hellman, el cliente y el servidor generan una clave de sesi贸n que se utilizar谩 para el cifrado de canal sim茅trico. <br></li></ul><br>  Una clave de sesi贸n se crea exclusivamente para la vida del canal y se destruye cuando se cierra la conexi贸n. <br><br><h4>  3. Autenticaci贸n del cliente </h4><br>  Y solo ahora, cuando el cliente y el servidor han establecido un canal para la transmisi贸n de datos encriptados, pueden autenticarse con una contrase帽a o claves. <br><br>  En t茅rminos generales, la autenticaci贸n de clave se realiza de la siguiente manera: <br><br><ul><li>  El cliente env铆a al servidor un nombre de usuario (nombre de usuario) y su clave p煤blica. </li><li>  El servidor busca en el archivo /home/username/.ssh/authorized_keys la clave p煤blica enviada por el cliente.  Si se encuentra la clave p煤blica, el servidor genera un n煤mero aleatorio y lo cifra con la clave p煤blica del cliente, despu茅s de lo cual el resultado se env铆a al cliente. </li><li>  El cliente descifra el mensaje con su clave privada y env铆a el resultado al servidor. </li><li>  El servidor verifica que el resultado coincida con el n煤mero que cifr贸 originalmente con la clave p煤blica del cliente, y si coincide, considera que la autenticaci贸n fue exitosa. </li></ul><br><h4>  4. Nivel de conexi贸n </h4><br>  Despu茅s de llevar a cabo todos los procedimientos anteriores, el usuario tiene la oportunidad de enviar comandos al servidor o copiar archivos. <br><br>  En este nivel, se proporciona: multiplicaci贸n de canales (la capacidad de operar m煤ltiples canales en un servidor combin谩ndolos en un canal), t煤neles, etc. <br><br><h2>  De la teor铆a a la pr谩ctica. </h2><br>  Bueno, creo que los lectores tienen una pregunta completamente l贸gica: 驴por qu茅 necesita conocer todos estos detalles del protocolo SSH? Si para el trabajo diario hay suficiente conocimiento de los comandos de creaci贸n de claves (ssh-keygen), abrir una sesi贸n de terminal (ssh), transferencia de archivos ( scp)? <br><br>  Como respuesta, podemos recordar el tema de cambiar el puerto SSH est谩ndar a otro, que constantemente se convierte en la causa del holivar en Habr ... <br><br>  En mi propia pr谩ctica, no recuerdo un solo servidor mirando la red externa que no ser铆a aprovechada diariamente en el puerto 22.  En una situaci贸n en la que SSH funciona para usted en un puerto est谩ndar (y no est谩 protegido por nada), incluso si la autenticaci贸n mediante claves y sin adivinar las contrase帽as da miedo, entonces, debido a solicitudes constantemente mentirosas de clientes deshonestos, el servidor todav铆a se ve obligado a hacer un gran trabajo in煤til: establecer una conexi贸n TCP, seleccionar algoritmos, generar una clave de sesi贸n, enviar solicitudes de autenticaci贸n, escribir un archivo de registro. <br><br>  En una situaci贸n en la que no hay nada en el puerto 22, o el puerto est谩 protegido mediante iptables (o complementos como fail2ban), el atacante caer谩 en la etapa de establecer una conexi贸n TCP. <br><br>  El m谩s interesante descrito parece una tabla * <br><table><tbody><tr><th>  Configuracion </th><th>  Hacking Chance </th><th>  P茅rdidas por inundaci贸n ** </th></tr><tr><td>  22 puerto <br>  autorizaci贸n de contrase帽a, <br>  sin protecci贸n </td><td>  alto </td><td>  alto </td></tr><tr><td>  22 puerto <br>  autorizaci贸n clave, <br>  sin protecci贸n </td><td>  promedio *** </td><td>  alto </td></tr><tr><td>  22 puerto <br>  autorizaci贸n clave, <br>  protecci贸n basada en la restricci贸n de intentos fallidos de autorizaci贸n </td><td>  bajo </td><td>  medio **** </td></tr><tr><td>  Puerto no est谩ndar, <br>  autorizaci贸n de contrase帽a, <br>  sin protecci贸n </td><td>  alto </td><td>  bajo </td></tr><tr><td>  Puerto no est谩ndar, <br>  autorizaci贸n clave, <br>  sin protecci贸n </td><td>  promedio *** </td><td>  bajo </td></tr><tr><td>  Puerto no est谩ndar, <br>  autorizaci贸n clave, <br>  protecci贸n basada en la restricci贸n de intentos fallidos de autorizaci贸n </td><td>  bajo </td><td>  bajo </td></tr></tbody></table><br>  * - los valores de los par谩metros (alto, medio, bajo) son de naturaleza relativa y solo sirven para comparar indicadores. <br>  **: esto significa el consumo de recursos del servidor (procesador, disco, canal de red, etc.) para procesar una avalancha de solicitudes que generalmente van al puerto 22. <br>  ***: piratear si se utilizan claves RSA para la autorizaci贸n es muy dif铆cil, pero un n煤mero ilimitado de intentos de autorizaci贸n lo hace posible. <br>  ****: el n煤mero de intentos de autorizaci贸n es limitado, pero el servidor todav铆a tiene que procesarlos desde una gran cantidad de intrusos. <br><br><h2>  Materiales adicionales </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fuentes de SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Especificaciones del protocolo SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Algoritmo Diffie-Hellman</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Algoritmo RSA</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C贸mo apareci贸 SSH en el puerto 22</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lo que est谩 escrito en el archivo .ssh / known_hosts</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Memo a los usuarios de ssh</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es425637/">https://habr.com/ru/post/es425637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es425627/index.html">IaaS para desarrollar servicios: qui茅n y por qu茅 se cambi贸 a infraestructura virtual</a></li>
<li><a href="../es425629/index.html">C贸mo hicimos un juego de mesa con control remoto</a></li>
<li><a href="../es425631/index.html">La red social "Vkontakte" habl贸 sobre c贸mo y por qu茅 proporciona datos de usuario</a></li>
<li><a href="../es425633/index.html">Volkswagen + Microsoft = tecnolog铆a de Internet para un viaje c贸modo</a></li>
<li><a href="../es425635/index.html">El resumen de materiales frescos del mundo del front-end para la 煤ltima semana No. 333 (1 al 7 de octubre de 2018)</a></li>
<li><a href="../es425641/index.html">Los residentes de la ciudad canadiense han desarrollado un "servicio Uber" con autobuses, no autom贸viles</a></li>
<li><a href="../es425643/index.html">Eventos digitales en Mosc煤 del 8 al 14 de octubre</a></li>
<li><a href="../es425645/index.html">SpaceX y SAOCOM - 1A Nueva misi贸n. Hecho</a></li>
<li><a href="../es425647/index.html">Prueba de IU: comprobaci贸n del sistema a diferentes resoluciones</a></li>
<li><a href="../es425649/index.html">BDSM, Gore y la b煤squeda del desarrollador de Drupal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>