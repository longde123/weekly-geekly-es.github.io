<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õèÔ∏è ü§öüèæ üßïüèΩ PVS-Studio in den Clouds: Azure DevOps üì¥ üôç üíÜüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dies ist ein zweiter Artikel, der sich auf die Verwendung des PVS-Studio-Analysators in Cloud-CI-Systemen konzentriert. Dieses Mal betrachten wir die ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio in den Clouds: Azure DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/467357/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b53/5ba/6e6/b535ba6e6cf6250ad0c89d5315918d38.png" alt="Bild 9"></div><br>  Dies ist ein zweiter Artikel, der sich auf die Verwendung des PVS-Studio-Analysators in Cloud-CI-Systemen konzentriert.  Dieses Mal betrachten wir die Plattform Azure DevOps - eine Cloud-CI \ CD-L√∂sung von Microsoft.  Wir werden das ShareX-Projekt analysieren. <br><a name="habracut"></a><br>  Wir brauchen drei Komponenten.  Der erste ist der PVS-Studio-Analysator.  Das zweite ist Azure DevOps, in das wir den Analysator integrieren werden.  Das dritte ist das Projekt, das wir √ºberpr√ºfen werden, um die F√§higkeiten von PVS-Studio bei der Arbeit in einer Cloud zu demonstrieren.  Also lass uns loslegen. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PVS-Studio</a> ist ein statischer Code-Analysator zum Auffinden von Fehlern und Sicherheitsm√§ngeln.  Das Tool unterst√ºtzt die Analyse von C-, C ++ - und C # -Code. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Azure DevOps</a> .  Die Azure DevOps-Plattform enth√§lt Tools wie Azure Pipeline, Azure Board, Azure Artifacts und andere, die das Erstellen von Software beschleunigen und deren Qualit√§t verbessern. <br><br>  ShareX ist eine kostenlose App, mit der Sie jeden Teil des Bildschirms erfassen und aufzeichnen k√∂nnen.  Das Projekt ist in C # geschrieben und eignet sich hervorragend zur Darstellung der Konfiguration des Starts des statischen Analysators.  Der Projektquellcode ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf GitHub verf√ºgbar</a> . <br><br>  Die Ausgabe des Befehls cloc f√ºr das ShareX-Projekt: <br><div class="scrollable-table"><table><tbody><tr><td> Sprache <br></td><td>  Dateien <br></td><td>  leer <br></td><td>  Kommentar <br></td><td>  Code <br></td></tr><tr><td>  C # <br></td><td>  696 <br></td><td>  20658 <br></td><td>  24423 <br></td><td>  102565 <br></td></tr><tr><td>  MSBuild-Skript <br></td><td>  11 <br></td><td>  1 <br></td><td>  77 <br></td><td>  5859 <br></td></tr></tbody></table></div>  Mit anderen Worten, das Projekt ist klein, aber v√∂llig ausreichend, um die Arbeit von PVS-Studio zusammen mit der Cloud-Plattform zu demonstrieren. <br><br><h2>  Beginnen wir mit der Konfiguration </h2><br>  Um mit der Arbeit in Azure DevOps zu beginnen, folgen Sie dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> und klicken Sie auf "Kostenlos mit GitHub starten". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0dc/3d3/8d0/0dc3d38d0375af0a89db1b7be1b4f284.png" alt="Bild 2"></div><br>  Gew√§hren Sie der Microsoft-Anwendung Zugriff auf die GitHub-Kontodaten. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b38/543/12b/b3854312bb046df2c1dd50d2025a0b25.png" alt="Bild 1"></div><br>  Sie m√ºssen ein Microsoft-Konto erstellen, um Ihre Registrierung abzuschlie√üen. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f5/7a9/878/8f57a9878354a257a8ca68261b5b472a.png" alt="Bild 12"></div><br>  Erstellen Sie nach der Registrierung ein Projekt: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e69/a61/59a/e69a6159ac5c51089e075c37fc5e2465.png" alt="Bild 5"></div><br>  Als n√§chstes m√ºssen wir zu "Pipelines" - "Builds" wechseln und eine neue Build-Pipeline erstellen. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fa/4d2/751/2fa4d27513aaf869962e11b9ea37214b.png" alt="Bild 8"></div><br>  Auf die Frage, wo sich unser Code befindet, antworten wir - GitHub. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a80/787/363/a80787363d8b260b9aac0ac64c66aeaf.png" alt="Bild 13"></div><br>  Autorisieren Sie Azure Pipelines und w√§hlen Sie das Repository mit dem Projekt aus, f√ºr das wir den Lauf des statischen Analysators konfigurieren. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/df6/47e/1c1df647e46b8445c43b9cf39968d7ed.png" alt="Bild 7"></div><br>  W√§hlen Sie im Vorlagenauswahlfenster "Starter-Pipeline". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ac/11d/09f/8ac11d09f180433fe9e14a6279f2a059.png" alt="Bild 17"></div><br>  Wir k√∂nnen die statische Code-Analyse des Projekts auf zwei Arten ausf√ºhren: mithilfe von Microsoft-gehosteten oder selbst gehosteten Agenten. <br><br>  Zun√§chst verwenden wir von Microsoft gehostete Agenten.  Solche Agenten sind normale virtuelle Maschinen, die beim Ausf√ºhren unserer Pipeline gestartet werden.  Sie werden entfernt, wenn die Aufgabe erledigt ist.  Durch die Verwendung solcher Agenten k√∂nnen wir keine Zeit f√ºr deren Support und Aktualisierung verschwenden, sondern bestimmte Einschr√§nkungen auferlegen, z. B. die Unf√§higkeit, zus√§tzliche Software zu installieren, die zum Erstellen eines Projekts verwendet wird. <br><br>  Ersetzen wir die vorgeschlagene Standardkonfiguration durch die folgende f√ºr die Verwendung von von Microsoft gehosteten Agenten: <br><br><pre><code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta"># Setting up run triggers # Run only for changes in the master branch trigger: - master # Since the installation of random software in virtual machines # is prohibited, we'll use a Docker container, # launched on a virtual machine with Windows Server 1803 pool: vmImage: 'win1803' container: microsoft/dotnet-framework:4.7.2-sdk-windowsservercore-1803 steps: # Download the analyzer distribution - task: PowerShell@2 inputs: targetType: 'inline' script: 'Invoke-WebRequest -Uri https://files.viva64.com/PVS-Studio_setup.exe -OutFile PVS-Studio_setup.exe' - task: CmdLine@2 inputs: workingDirectory: $(System.DefaultWorkingDirectory) script: | # Restore the project and download dependencies nuget restore .\ShareX.sln # Create the directory, where files with analyzer reports will be saved md .\PVSTestResults # Install the analyzer PVS-Studio_setup.exe /VERYSILENT /SUPPRESSMSGBOXES /NORESTART /COMPONENTS=Core # Create the file with configuration and license information "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" credentials -u $(PVS_USERNAME) -n $(PVS_KEY) # Run the static analyzer and convert the report in html. "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" -t .\ShareX.sln -o .\PVSTestResults\ShareX.plog "C:\Program Files (x86)\PVS-Studio\PlogConverter.exe" -t html -o .\PVSTestResults\ .\PVSTestResults\ShareX.plog # Save analyzer reports - task: PublishBuildArtifacts@1 inputs: pathToPublish: PVSTestResults artifactName: PVSTestResults</span></span></code> </pre> <br>  <b>Hinweis:</b> Gem√§√ü der <a href="">Dokumentation</a> muss der verwendete Container im Image der virtuellen Maschine zwischengespeichert werden. Zum Zeitpunkt des Schreibens des Artikels funktioniert er jedoch nicht und der Container wird bei jedem Start der Aufgabe heruntergeladen, was sich negativ auswirkt der Ausf√ºhrungszeitpunkt. <br><br>  Speichern Sie die Pipeline und erstellen Sie Variablen, die zum Erstellen der Lizenzdatei verwendet werden.  √ñffnen Sie dazu das Pipeline-Bearbeitungsfenster und klicken Sie oben rechts auf "Variablen". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be8/bc0/e1c/be8bc0e1c3555c6375eac94465d27b9d.png" alt="Bild 14"></div><br>  <i>F√ºgen</i> Sie dann zwei Variablen hinzu - <i>PVS_USERNAME</i> und <i>PVS_KEY</i> , die den Benutzernamen bzw. den Lizenzschl√ºssel enthalten.  Vergessen Sie beim Erstellen der Variablen <i>PVS_KEY</i> nicht, "Diesen Wert geheim halten" auszuw√§hlen, um die Werte der Variablen mit einem 2048-Bit-RSA-Schl√ºssel zu verschl√ºsseln und die Ausgabe des Variablenwerts im Aufgabenleistungsprotokoll zu unterdr√ºcken. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/1e3/35e/9961e335e18b368820d930f14f01d796.png" alt="Bild 15"></div><br>  Speichern Sie Variablen und f√ºhren Sie die Pipeline aus, indem Sie auf "Ausf√ºhren" klicken. <br><br>  Die zweite Option zum Ausf√ºhren der Analyse: Verwenden Sie einen selbst gehosteten Agenten.  Wir k√∂nnen selbst gehostete Agenten selbst anpassen und verwalten.  Solche Agenten bieten mehr M√∂glichkeiten zur Installation von Software, die zum Erstellen und Testen unseres Softwareprodukts erforderlich ist. <br><br>  Bevor Sie solche Agenten verwenden, m√ºssen Sie sie gem√§√ü den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">konfigurieren</a> und den statischen Analysator installieren und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">konfigurieren</a> . <br><br>  Um die Aufgabe auf einem selbst gehosteten Agenten auszuf√ºhren, ersetzen wir die vorgeschlagene Konfiguration durch die folgende: <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta"># Setting up triggers # Run the analysis for master-branch trigger: - master # The task is run on a self-hosted agent from the pool 'MyPool' pool: 'MyPool' steps: - task: CmdLine@2 inputs: workingDirectory: $(System.DefaultWorkingDirectory) script: | # Restore the project and download dependencies nuget restore .\ShareX.sln # Create the directory where files with analyzer reports will be saved md .\PVSTestResults # Run the static analyzer and convert the report in html. "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" -t .\ShareX.sln -o .\PVSTestResults\ShareX.plog "C:\Program Files (x86)\PVS-Studio\PlogConverter.exe" -t html -o .\PVSTestResults\ .\PVSTestResults\ShareX.plog # Save analyzer reports - task: PublishBuildArtifacts@1 inputs: pathToPublish: PVSTestResults artifactName: PVSTestResults</span></span></code> </pre> <br>  Sobald die Aufgabe abgeschlossen ist, k√∂nnen Sie das Archiv mit den Analyseberichten auf der Registerkarte "Zusammenfassung" herunterladen oder die Erweiterung "E- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mail senden" verwenden</a> , mit der Sie E-Mails konfigurieren oder ein anderes praktisches Tool auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Marktplatz in</a> Betracht ziehen k√∂nnen. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/529/df2/932/529df29320ae9e253462e42fe2bfd596.png" alt="Bild 21"></div><br><h2>  Analyseergebnisse </h2><br>  Schauen wir uns nun einige Fehler im getesteten Projekt ShareX an. <br><br>  <b>√úberm√§√üige √úberpr√ºfungen</b> <br><br>  Beginnen wir zum Aufw√§rmen mit einfachen Fehlern im Code, n√§mlich mit redundanten √úberpr√ºfungen: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PbThumbnail_MouseMove</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, MouseEventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... IDataObject dataObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataObject(DataFormats.FileDrop, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { Task.Info.FilePath }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataObject != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Program.MainForm.AllowDrop = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; dragBoxFromMouseDown = Rectangle.Empty; pbThumbnail.DoDragDrop(dataObject, DragDropEffects.Copy | DragDropEffects.Move); Program.MainForm.AllowDrop = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022</a> [CWE-571] Der Ausdruck 'dataObject! = Null' ist immer wahr.  TaskThumbnailPanel.cs 415 <br><br>  <i>Achten</i> wir auf die √úberpr√ºfung der <i>dataObject-</i> Variablen auf <i>null</i> .  Warum ist es hier?  <i>dataObject</i> kann in diesem Fall nicht <i>null sein</i> , da es durch eine Referenz auf ein erstelltes Objekt initialisiert wird.  Infolgedessen haben wir eine √ºberm√§√üige √úberpr√ºfung.  Kritisch?  Nein, nein.  Sieht pr√§gnant aus?  Nein, nein.  Diese √úberpr√ºfung ist eindeutig besser zu entfernen, um den Code nicht zu √ºberladen. <br><br>  Schauen wir uns ein weiteres Codefragment an, das wir auf √§hnliche Weise kommentieren k√∂nnen: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Image </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDIBImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MemoryStream ms</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(bmp); .... } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gcHandle != IntPtr.Zero) { GCHandle.FromIntPtr(gcHandle).Free(); } } .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Image </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetImageAlternative</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MemoryStream ms = dataObject.GetData(format) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MemoryStream) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ms != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Image img = GetDIBImage(ms); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (img != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> img; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { DebugHelper.WriteException(e); } } } .... }</code> </pre> <br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022</a> [CWE-571] Der Ausdruck 'img! = Null' ist immer wahr.  ClipboardHelpers.cs 289 <br><br>  In der <i>GetImageAlternative-</i> Methode wird die Variable <i>img</i> √ºberpr√ºft, dass sie direkt nach dem <i>Erstellen</i> einer neuen Instanz der <i>Bitmap-</i> Klasse nicht null ist.  Der Unterschied zum vorherigen Beispiel besteht darin, dass wir die <i>GetDIBImage-</i> Methode anstelle des Konstruktors verwenden, um die <i>img-</i> Variable zu initialisieren.  Der Code-Autor schl√§gt vor, dass bei dieser Methode eine Ausnahme auftreten k√∂nnte, deklariert jedoch nur blocks <i>try</i> und <i>schlie√ülich das</i> Auslassen von <i>catch</i> .  Wenn eine Ausnahme auftritt, erh√§lt die Aufrufermethode <i>GetImageAlternative daher</i> keinen Verweis auf ein Objekt vom Typ <i>Bitmap</i> , sondern muss die Ausnahme in einem eigenen <i>catch-</i> Block behandeln.  In diesem Fall wird die Variable <i>img</i> nicht initialisiert und der Ausf√ºhrungsthread erreicht nicht einmal die Pr√ºfung <i>img! = Null</i> , sondern gelangt in den catch-Block.  Folglich wies der Analysator auf eine √ºberm√§√üige √úberpr√ºfung hin. <br><br>  Betrachten wir das folgende Beispiel einer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022-</a> Warnung: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btnCopyLink_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lvClipboardFormats.SelectedItems.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { url = lvClipboardFormats.Items[<span class="hljs-number"><span class="hljs-number">0</span></span>].SubItems[<span class="hljs-number"><span class="hljs-number">1</span></span>].Text; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lvClipboardFormats.SelectedItems.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { url = lvClipboardFormats.SelectedItems[<span class="hljs-number"><span class="hljs-number">0</span></span>].SubItems[<span class="hljs-number"><span class="hljs-number">1</span></span>].Text; } .... }</code> </pre> <br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022</a> [CWE-571] Der Ausdruck 'lvClipboardFormats.SelectedItems.Count&gt; 0' ist immer wahr.  AfterUploadForm.cs 155 <br><br>  Schauen wir uns den zweiten bedingten Ausdruck genauer an.  Dort √ºberpr√ºfen wir den Wert der schreibgesch√ºtzten <i>Count-</i> Eigenschaft.  Diese Eigenschaft zeigt die Anzahl der Elemente in der Instanz der Auflistung <i>SelectedItems an</i> .  Die Bedingung wird nur ausgef√ºhrt, wenn die <i>Count-</i> Eigenschaft gr√∂√üer als Null ist.  Es w√§re alles in Ordnung, aber in der externen <i>if-</i> Anweisung <i>Count</i> ist bereits auf 0 gepr√ºft. Die Instanz der <i>SelectedItems-</i> Auflistung kann nicht die Anzahl der Elemente kleiner als Null haben, daher ist <i>Count</i> entweder gleich oder gr√∂√üer als 0. Da wir haben Die <i>Count-</i> Pr√ºfung f√ºr 0 wurde bereits in der ersten <i>if-</i> Anweisung durchgef√ºhrt, und sie war falsch. Es macht keinen Sinn, eine weitere <i>Count-</i> Pr√ºfung zu schreiben, <i>wenn</i> sie im Zweig else gr√∂√üer als Null ist. <br><br>  Das letzte Beispiel f√ºr eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022-</a> Warnung ist das folgende Codefragment: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawCursorGraphics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Graphics g</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cursorOffsetX = <span class="hljs-number"><span class="hljs-number">10</span></span>, cursorOffsetY = <span class="hljs-number"><span class="hljs-number">10</span></span>, itemGap = <span class="hljs-number"><span class="hljs-number">10</span></span>, itemCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; Size totalSize = Size.Empty; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> magnifierPosition = <span class="hljs-number"><span class="hljs-number">0</span></span>; Bitmap magnifier = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Options.ShowMagnifier) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) totalSize.Height += itemGap; .... } .... }</code> </pre> <br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3022 Der</a> Ausdruck 'itemCount&gt; 0' ist immer falsch.  RegionCaptureForm.cs 1100 <br><br>  Der Analysator hat festgestellt, dass die Bedingung <i>itemCount&gt; 0</i> immer falsch ist, da die Variable <i>itemCount</i> deklariert und gleichzeitig oben Null zugewiesen wird.  Diese Variable wird bis zur Bedingung nirgendwo verwendet, daher hatte der Analysator Recht mit dem bedingten Ausdruck, dessen Wert immer falsch ist. <br><br>  Nun, schauen wir uns jetzt etwas wirklich Faules an. <br><br>  <b>Der beste Weg, einen Fehler zu verstehen, besteht darin, einen Fehler zu visualisieren</b> <br><br>  Es scheint uns, dass an dieser Stelle ein ziemlich interessanter Fehler gefunden wurde: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pixelate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bitmap bmp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pixelSize</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, g = <span class="hljs-number"><span class="hljs-number">0</span></span>, b = <span class="hljs-number"><span class="hljs-number">0</span></span>, a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> weightedCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y2 = y; y2 &lt; yLimit; y2++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x2 = x; x2 &lt; xLimit; x2++) { ColorBgra color = unsafeBitmap.GetPixel(x2, y2); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>; r += color.Red * pixelWeight; g += color.Green * pixelWeight; b += color.Blue * pixelWeight; a += color.Alpha * pixelWeight; weightedCount += pixelWeight; } } .... ColorBgra averageColor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColorBgra((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(b / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(g / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(r / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(a / pixelCount)); .... }</code> </pre> <br>  Ich m√∂chte nicht alle Karten zeigen und enth√ºllen, was unser Analysator gefunden hat, also lassen Sie es uns f√ºr eine Weile beiseite legen. <br><br>  Unter dem Namen der Methode l√§sst sich leicht erraten, was sie tut - Sie geben ihr ein Bild oder ein Fragment eines Bildes und es verpixelt es.  Der Code der Methode ist ziemlich lang, daher werden wir ihn nicht vollst√§ndig zitieren, sondern nur versuchen, den Algorithmus zu erkl√§ren und zu erkl√§ren, welche Art von Fehler PVS-Studio gefunden hat. <br><br>  Diese Methode empf√§ngt zwei Parameter: ein Objekt vom Typ <i>Bitmap</i> und den Wert vom Typ <i>int</i> , der die Gr√∂√üe der Pixelierung angibt.  Der Operationsalgorithmus ist recht einfach: <br><br>  1) Teilen Sie das empfangene Bildfragment in Quadrate mit der Seite, die der Gr√∂√üe der Pixelierung entspricht.  Wenn wir beispielsweise eine Pixelgr√∂√üe von 15 haben, erhalten wir ein Quadrat mit 15 x 15 = 225 Pixel. <br><br>  2) Ferner durchlaufen wir jedes Pixel in diesem Quadrat und akkumulieren die Werte der Felder <i>Rot</i> , <i>Gr√ºn</i> , <i>Blau</i> und <i>Alpha</i> in Zwischenvariablen. <i>Davor</i> multiplizieren wir den Wert der entsprechenden Farbe und des Alphakanals mit der <i>pixelWeight-</i> Variablen, die durch erhalten wird Teilen des <i>Alpha-</i> Werts durch 255 (die <i>Alpha-</i> Variable ist vom <i>Bytetyp</i> ).  Auch beim Durchlaufen von Pixeln <i>addieren</i> wir die in <i>pixelWeight</i> geschriebenen <i>Werte</i> in die Variable <i>weightedCount</i> .  Das Codefragment, das die obigen Aktionen ausf√ºhrt, lautet wie folgt: <br><br><pre> <code class="cs hljs">ColorBgra color = unsafeBitmap.GetPixel(x2, y2); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>; r += color.Red * pixelWeight; g += color.Green * pixelWeight; b += color.Blue * pixelWeight; a += color.Alpha * pixelWeight; weightedCount += pixelWeight;</code> </pre> <br>  Beachten Sie √ºbrigens, dass <i>pixelWeight</i> der <i>weightedCount-</i> Variablen keinen Wert f√ºr dieses Pixel hinzuf√ºgt, wenn der Wert der <i>Alpha-</i> Variablen Null ist.  Das werden wir in Zukunft brauchen. <br><br>  3) Nachdem wir alle Pixel im aktuellen Quadrat durchlaufen haben, k√∂nnen wir eine gemeinsame "durchschnittliche" Farbe f√ºr dieses Quadrat erstellen.  Der Code daf√ºr sieht wie folgt aus: <br><br><pre> <code class="cs hljs">ColorBgra averageColor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColorBgra((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(b / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(g / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(r / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(a / pixelCount));</code> </pre> <br>  4) Wenn wir nun die endg√ºltige Farbe erhalten und in die Variable <i>meanColor geschrieben haben</i> , k√∂nnen wir erneut jedes Pixel des Quadrats durchlaufen und ihm einen Wert von <i>durchschnittlicher Farbe zuweisen</i> . <br><br>  5) Gehen Sie zur√ºck zu Punkt 2, w√§hrend wir nicht behandelte Quadrate haben. <br><br>  Auch hier entspricht die Variable <i>weightedCount</i> nicht der Anzahl aller Pixel in einem Quadrat.  Wenn ein Bild beispielsweise ein vollst√§ndig transparentes Pixel enth√§lt (Nullwert im Alphakanal), ist die Variable <i>pixelWeight</i> f√ºr dieses Pixel Null ( <i>0/255</i> = 0).  Daher wirkt sich dieses Pixel nicht auf die Bildung der Variable <i>weightedCount aus</i> .  Es ist ziemlich logisch - es macht keinen Sinn, die Farben eines vollst√§ndig transparenten Pixels zu ber√ºcksichtigen. <br><br>  Es scheint also alles vern√ºnftig - die Pixelierung muss korrekt funktionieren.  Und das tut es tats√§chlich.  Dies gilt nur nicht f√ºr PNG-Bilder, die Pixel mit Werten im Alphakanal unter 255 und ungleich Null enthalten.  Beachten Sie das pixelige Bild unten: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/460/17b/7b5/46017b7b58a5206d0a51620fcce1a16f.png" alt="Bild 3"></div><br>  Hast du die Pixelierung gesehen?  Wir auch nicht.  Okay, jetzt lassen Sie uns diese kleine Intrige enth√ºllen und erkl√§ren, wo genau sich der Fehler in dieser Methode versteckt.  Der Fehler hat sich in die Zeile der <i>pixelWeight-</i> Variablenberechnung eingeschlichen: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>;</code> </pre> <br>  Tatsache ist, dass der Code-Autor beim Deklarieren der <i>pixelWeight-</i> Variablen als <i>float</i> angedeutet hat, dass er beim Teilen des <i>Alpha-</i> Felds durch 255 zus√§tzlich zu Null und Eins Bruchzahlen erh√§lt.  Hier verbirgt sich das Problem, da die <i>Alpha-</i> Variable vom <i>Bytetyp ist</i> .  Wenn wir um 255 tauchen, erhalten wir einen ganzzahligen Wert.  Erst danach wird es implizit in den <i>Float-</i> Typ umgewandelt, was bedeutet, dass der Bruchteil verloren geht. <br><br>  Es ist leicht zu erkl√§ren, warum es unm√∂glich ist, PNG-Bilder mit etwas Transparenz zu pixelieren.  Da f√ºr diese Pixel die Werte des Alphakanals im Bereich 0 &lt;Alpha &lt;255 liegen, ergibt die <i>Alpha-</i> Variable geteilt durch 255 immer 0. Daher werden auch die Werte der Variablen <i>pixelWeight</i> , <i>r</i> , <i>g</i> , <i>b</i> , <i>a</i> , <i>weightedCount verwendet</i> Immer 0. Daher hat unsere <i>durchschnittliche Farbe</i> in allen Kan√§len Nullwerte: Rot - 0, Blau - 0, Gr√ºn - 0, Alpha - 0. Durch Malen eines Quadrats in dieser Farbe wird die urspr√ºngliche Farbe nicht ge√§ndert der Pixel, da die <i>durchschnittliche Farbe</i> absolut transparent ist.  Um diesen Fehler zu beheben, m√ºssen wir das <i>Alpha-</i> Feld nur explizit in den <i>Float-</i> Typ <i>umwandeln</i> .  Die feste Version der Codezeile k√∂nnte folgenderma√üen aussehen: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>;</code> </pre> <br>  Nun, es ist h√∂chste Zeit, die Nachricht von PVS-Studio f√ºr den falschen Code zu zitieren: <br><br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3041</a> [CWE-682] Der Ausdruck wurde implizit vom Typ 'int' in den Typ 'float' umgewandelt.  Erw√§gen Sie die Verwendung eines expliziten Typgusses, um den Verlust eines Bruchteils zu vermeiden.  Ein Beispiel: double A = (double) (X) / Y;  ImageHelpers.cs 1119 <br><br>  Zum Vergleich zitieren wir den Screenshot eines wirklich pixeligen Bildes, das mit der korrigierten Anwendungsversion erhalten wurde: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/977/0bc/e73/9770bce73229e72b6781f0349128aa3e.png" alt="Bild 6"></div><br>  <b>M√∂gliche NullReferenceException</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddMetadata</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Image img, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span> { .... pi.Value = bytesText; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pi != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { img.SetPropertyItem(pi); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3095</a> [CWE-476] Das ' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pi'</a> -Objekt wurde verwendet, bevor es gegen null verifiziert wurde.  √úberpr√ºfen Sie die Zeilen: 801, 803. ImageHelpers.cs 801 <br><br>  Dieses Codefragment zeigt, dass der Autor erwartet hat, dass die <i>pi-</i> Variable <i>null sein</i> kann. Deshalb findet vor dem Aufrufen der Methode <i>SetPropertyItem</i> die Pr√ºfung <i>pi! = Null</i> statt.  Es ist seltsam, dass der Eigenschaft vor dieser √úberpr√ºfung ein Array von Bytes zugewiesen wird, denn wenn <i>pi</i> <i>null ist</i> , wird eine Ausnahme vom Typ <i>NullReferenceException</i> ausgel√∂st. <br><br>  Eine √§hnliche Situation wurde an einer anderen Stelle festgestellt: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task_TaskCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WorkerTask task</span></span></span><span class="hljs-function">)</span></span> { .... task.KeepImage = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.RequestSettingUpdate) { Program.MainForm.UpdateCheckStates(); } .... } .... }</code> </pre> <br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3095</a> [CWE-476] Das Objekt 'task' wurde verwendet, bevor es gegen null verifiziert wurde.  √úberpr√ºfen Sie die Zeilen: 268, 270. TaskManager.cs 268 <br><br>  PVS-Studio hat einen weiteren √§hnlichen Fehler gefunden.  Der Punkt ist der gleiche, so dass das Codefragment nicht unbedingt zitiert werden muss. Die Analysatormeldung reicht aus. <br><br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3095</a> [CWE-476] Das Objekt 'Config.PhotobucketAccountInfo' wurde verwendet, bevor es gegen Null verifiziert wurde.  √úberpr√ºfen Sie die Zeilen: 216, 219. UploadersConfigForm.cs 216 <br><br>  <b>Der gleiche R√ºckgabewert</b> <br><br>  In der <i>EvalWindows-</i> Methode der <i>WindowsList-</i> Klasse wurde ein verd√§chtiges Codefragment gefunden, das in allen F√§llen <i>true</i> zur√ºckgibt: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WindowsList</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;IntPtr&gt; IgnoreWindows { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WindowsList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IgnoreWindows = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IntPtr&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WindowsList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr ignoreWindow</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IgnoreWindows.Add(ignoreWindow); } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EvalWindows</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr hWnd, IntPtr lParam</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IgnoreWindows.Any(window =&gt; hWnd == window)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } windows.Add(new WindowInfo(hWnd)); return true; // &lt;= } }</span></span></code> </pre> <br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3009</a> Es ist seltsam, dass diese Methode immer ein und denselben Wert von 'true' zur√ºckgibt.  WindowsList.cs 82 <br><br>  Es scheint logisch, dass die Methode <i>false zur√ºckgeben</i> muss, wenn in der Liste mit dem Namen <i>IgnoreWindows</i> ein Zeiger mit demselben Namen wie <i>hWnd vorhanden</i> ist. <br><br>  Die <i>IgnoreWindows-</i> Liste kann entweder beim Aufrufen des Konstruktors <i>WindowsList (IntPtr ignoreWindow)</i> oder direkt durch Zugriff auf die √∂ffentliche Eigenschaft gef√ºllt werden.  Laut Visual Studio ist diese Liste derzeit im Code nicht gef√ºllt.  Dies ist ein weiterer seltsamer Ort dieser Methode. <br><br>  <b>Unsicherer Aufruf von Ereignishandlern</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNewsLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NewsLoaded != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { NewsLoaded(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EventArgs.Empty); } }</code> </pre> <br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3083</a> [CWE-367] Unsicherer Aufruf des Ereignisses 'NewsLoaded', NullReferenceException ist m√∂glich.  √úberlegen Sie, ob Sie einer lokalen Variablen ein Ereignis zuweisen m√∂chten, bevor Sie sie aufrufen.  NewsListControl.cs 111 <br><br>  Hier kann ein sehr b√∂ser Fall auftreten.  Nach dem √úberpr√ºfen der <i>NewsLoaded-</i> Variablen auf null kann die Methode, die ein Ereignis behandelt, beispielsweise in einem anderen Thread abgemeldet werden.  In diesem Fall ist die Variable <i>NewsLoaded</i> bereits null, wenn wir in den Hauptteil der if-Anweisung <i>gelangen</i> .  Eine <i>NullReferenceException</i> kann auftreten, wenn versucht wird, Abonnenten √ºber das Ereignis <i>NewsLoaded anzurufen</i> , das null ist.  Es ist viel sicherer, einen nullbedingten Operator zu verwenden und den obigen Code wie folgt neu zu schreiben: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNewsLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { NewsLoaded?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EventArgs.Empty); }</code> </pre> <br>  Der Analysator zeigte auf <b>68</b> √§hnliche Fragmente.  Wir werden sie nicht alle beschreiben - sie haben alle ein √§hnliches Anrufmuster. <br><br>  <b>Geben Sie null von ToString zur√ºck</b> <br><br>  K√ºrzlich habe ich aus einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><u>interessanten Artikel</u></a> meines Kollegen herausgefunden, dass Microsoft nicht empfiehlt, null von der √ºberschriebenen Methode <i>ToString zur√ºckzugeben</i> .  PVS-Studio ist sich dessen bewusst: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (loggerLock) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sbMessages != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; sbMessages.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sbMessages.ToString(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3108</a> Es wird nicht empfohlen, 'null' von der Methode 'ToSting ()' zur√ºckzugeben.  Logger.cs 167 <br><br>  <b>Warum zugewiesen, wenn nicht verwendet?</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SeafileCheckAccInfoResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAccountInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"account/info/?format=json"</span></span>); .... }</code> </pre> <br>  <b>PVS-Studio-Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V3008</a> Der Variablen 'url' werden zweimal hintereinander Werte zugewiesen.  Vielleicht ist das ein Fehler.  Kontrollzeilen: 197, 196. Seafile.cs 197 <br><br>  Wie wir aus dem Beispiel sehen k√∂nnen, wird der <i>URL-</i> Variable beim Deklarieren ein Wert zugewiesen, der von der Methode <i>FixPrefix zur√ºckgegeben wird</i> .  In der n√§chsten Zeile l√∂schen wir den erhaltenen Wert, auch ohne ihn irgendwo zu verwenden.  Wir bekommen etwas √Ñhnliches wie toten Code: Es funktioniert, hat aber keinen Einfluss auf das Ergebnis.  Dieser Fehler ist h√∂chstwahrscheinlich auf ein Kopieren und Einf√ºgen zur√ºckzuf√ºhren, da solche Codefragmente in 9 weiteren Methoden auftreten.  Als Beispiel nennen wir zwei Methoden mit einer √§hnlichen ersten Zeile: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckAuthToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"auth/ping/?format=json"</span></span>); .... } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckAPIURL</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"ping/?format=json"</span></span>); .... }</code> </pre> <br><h2>  Schlussfolgerungen </h2><br>  Wie wir sehen k√∂nnen, h√§ngt die Konfigurationskomplexit√§t der automatischen Analysatorpr√ºfungen nicht von einem ausgew√§hlten CI-System ab.  Wir brauchten buchst√§blich 15 Minuten und mehrere Mausklicks, um die √úberpr√ºfung unseres Projektcodes mit einem statischen Analyseger√§t zu konfigurieren. <br><br>  Abschlie√üend laden wir Sie ein, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Analysator</a> f√ºr Ihre Projekte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">herunterzuladen und zu testen</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de467357/">https://habr.com/ru/post/de467357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de467345/index.html">Hit IT-Blogs und 4 Trainingsebenen: ein Interview mit Sergei Abdulmanov aus Mosigra</a></li>
<li><a href="../de467347/index.html">Buch ‚ÄûErstellen solider Smart-Vertr√§ge f√ºr die Ethereum-Blockchain. Praktischer Leitfaden</a></li>
<li><a href="../de467349/index.html">Umzug eines Programmierers nach Estland: Arbeit, Geld und Lebenshaltungskosten</a></li>
<li><a href="../de467353/index.html">Codeoptimierungsmethoden f√ºr Redd. Teil 1: Cache-Effekt</a></li>
<li><a href="../de467355/index.html">Interview mit Marktforschern und Softwareentwicklungstrends in Mittel- und Osteuropa, Eugene Schwab-Chesaru</a></li>
<li><a href="../de467359/index.html">PVS-Studio geht in die Cloud: Azure DevOps</a></li>
<li><a href="../de467361/index.html">Wir haben die Delegierung in JavaScript vergessen. Ereignisdelegation reagieren</a></li>
<li><a href="../de467363/index.html">Verwenden benutzerdefinierter Verlustfunktionen und Lernen von Qualit√§tsmetriken in Keras</a></li>
<li><a href="../de467365/index.html">Relais zur √úberwachung der Wohnspannung</a></li>
<li><a href="../de467369/index.html">RubyRussia 2019. Mikhail Pronyakin: Ist Ruby sicher?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>