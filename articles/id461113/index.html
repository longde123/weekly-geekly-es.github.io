<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏒 📭 ♓️ Lima tahun menggunakan C ++ untuk proyek-proyek mikrokontroler dalam produksi 🤸🏻 👨🏻‍🎓 🗳️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel ini saya akan memberitahu Anda bagaimana saya mentransfer perusahaan tempat saya bekerja selama lebih dari lima tahun dari mengelola pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lima tahun menggunakan C ++ untuk proyek-proyek mikrokontroler dalam produksi</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461113/">  Dalam artikel ini saya akan memberitahu Anda bagaimana saya mentransfer perusahaan tempat saya bekerja selama lebih dari lima tahun dari mengelola proyek untuk mikrokontroler ke C ke C ++ dan apa yang terjadi (spoiler: semuanya buruk). <br><a name="habracut"></a><br><h2>  Sedikit tentang dirimu </h2><br>  Saya mulai menulis di bawah mikrokontroler C, hanya memiliki pengalaman sekolah dengan Pascal, kemudian saya belajar assembler dan menghabiskan sekitar 3 tahun mempelajari berbagai arsitektur mikrokontroler dan periferal mereka.  Kemudian ada pengalaman kerja nyata dalam C # dan C ++ dengan studi paralel mereka, yang memakan waktu beberapa tahun.  Setelah periode ini, saya kembali dan untuk waktu yang lama kembali ke pemrograman mikrokontroler, sudah memiliki dasar teori yang diperlukan untuk bekerja pada proyek nyata. <br><br><h2>  Tahun pertama </h2><br>  Saya tidak menentang gaya prosedural C, tetapi perusahaan yang memulai praktik nyata saya pada proyek nyata menggunakan "pemrograman C dalam gaya berorientasi objek."  Itu terlihat seperti ini. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">uart_init</span></span></span><span class="hljs-class"> {</span></span> USART_TypeDef *USARTx; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> baudrate; ... } <span class="hljs-keyword"><span class="hljs-keyword">uart_cfg_t</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uart_init</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uart_cfg_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *cfg)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uart_start_tx</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *d, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uart_tx</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *d, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timeout)</span></span></span></span>;</code> </pre> <br>  Pendekatan ini memiliki keuntungan sebagai berikut: <br><br><ol><li>  kode terus menjadi kode C. Keuntungan berikut mengikuti dari ini: <ul><li>  lebih mudah untuk mengontrol "objek", karena mudah untuk melacak siapa dan di mana menyebabkan apa dan dalam urutan apa (dengan pengecualian gangguan, tetapi tidak dalam artikel ini); </li><li>  untuk menyimpan "pointer ke objek" itu cukup untuk mengingat fd yang dikembalikan; </li><li>  jika "objek" dihapus, maka ketika Anda mencoba menggunakannya, Anda akan menerima kesalahan yang sesuai dalam nilai pengembalian fungsi; </li></ul></li><li>  abstraksi objek semacam itu di atas HAL yang digunakan di sana memungkinkan untuk menulis objek yang dapat dikustomisasi untuk tugas dari struktur inisialisasi sendiri (dan dalam kasus kurangnya fungsi HAL, orang dapat menyembunyikan akses ke register di dalam "objek"). </li></ol><br>  Cons: <br><br><ol><li>  jika seseorang menghapus "objek", dan kemudian membuat yang baru dari tipe yang berbeda, mungkin saja yang baru mendapatkan fd dari yang lama dan perilaku selanjutnya tidak akan ditentukan.  Perilaku ini dapat dengan mudah diubah dengan biaya konsumsi memori kecil untuk daftar tertaut alih-alih menggunakan array dengan nilai kunci (array untuk setiap indeks dan menyimpan pointer ke struktur objek). </li><li>  tidak mungkin untuk secara statis menandai memori di bawah "objek global".  Karena di sebagian besar aplikasi "objek" dibuat sekali dan tidak dihapus lebih lanjut, itu tampak seperti "penopang".  Di sini, ketika membuat objek, akan dimungkinkan untuk melewatkan pointer ke struktur internalnya, yang dialokasikan secara statis selama tata letak, tetapi ini selanjutnya akan membingungkan kode inisialisasi dan memecah enkapsulasi. </li></ol><br>  Ketika ditanya tentang mengapa C ++ tidak dipilih ketika membangun seluruh infrastruktur, mereka menjawab sesuatu seperti berikut: "Yah, C ++ mengarah ke biaya tambahan yang kuat, biaya memori yang tidak terkendali, serta file firmware yang besar dan dapat dieksekusi."  Mungkin mereka benar.  Memang, pada saat awal desain, hanya ada GCC 3.0.5, yang tidak bersinar dengan keramahan khusus untuk C ++ (kami masih harus bekerja dengannya untuk menulis program di bawah QNX6).  Tidak ada constexpr dan C ++ 11/14, yang memungkinkan Anda untuk membuat objek global, yang intinya adalah data di area .data, dihitung pada tahap kompilasi dan metode untuknya. <br><br>  Untuk pertanyaan itu, mengapa tidak menulis di register - saya mendapat jawaban yang jelas bahwa penggunaan "objek" memungkinkan Anda untuk mengkonfigurasi jenis aplikasi yang sama "dalam sehari". <br><br>  Menyadari semua ini dan menyadari bahwa sekarang C ++ tidak sama dengan GCC 3.0.5, saya mulai menulis ulang bagian utama fungsi di C ++.  Untuk memulai, bekerjalah dengan periferal perangkat keras mikrokontroler, kemudian periferal perangkat eksternal.  Sebenarnya, ini hanya shell yang lebih nyaman daripada apa yang tersedia saat itu. <br><br><h2>  Tahun kedua dan ketiga </h2><br>  Saya menulis ulang semua yang saya butuhkan untuk proyek saya di C ++ dan terus menulis modul baru segera di C ++.  Namun, ini hanya lebih dari C. Setelah menyadari bahwa saya tidak cukup menggunakan C ++, saya mulai menggunakan kekuatannya: templat, kelas header-only, constexpr, dan banyak lagi.  Segalanya berjalan baik. <br><br><h2>  Tahun Keempat dan Kelima </h2><br><ul><li>  semua objek bersifat global dan menyertakan tautan satu sama lain pada tahap kompilasi (sesuai dengan arsitektur proyek); </li><li>  semua objek dialokasikan memori pada tahap tata letak; </li><li>  berdasarkan objek kelas untuk setiap pin; </li><li>  sebuah objek yang merangkum semua pin untuk menginisialisasi mereka dengan satu metode; </li><li>  objek kontrol RCC yang merangkum semua objek yang ada di bus perangkat keras; </li><li>  BISA &lt;-&gt; proyek konverter RS485 sesuai dengan protokol pelanggan berisi 60 objek; </li><li>  seandainya ada sesuatu yang berada pada level itu di HAL atau level kelas dari suatu objek, Anda tidak hanya harus “memperbaiki masalah”, tetapi juga memikirkan cara memperbaikinya sehingga perbaikan ini bekerja pada semua kemungkinan konfigurasi modul ini. ; </li><li>  templat dan constexpr yang digunakan tidak dapat dihitung sebelum melihat peta, file asm dan bin dari firmware terakhir (atau meluncurkan debugging di mikrokontroler); </li><li>  dalam hal terjadi kesalahan dalam templat, pesan dengan panjang sepertiga dari konfigurasi proyek dari GCC adalah output.  Membaca dan memahami sesuatu darinya merupakan prestasi tersendiri. </li></ul><br><h2>  Ringkasan </h2><br>  Sekarang saya mengerti yang berikut: <ol><li>  penggunaan "konstruktor modul universal" hanya mempersulit program.  Jauh lebih mudah untuk menyesuaikan register konfigurasi untuk proyek baru daripada menyelidiki hubungan antara objek, dan kemudian juga di perpustakaan HAL; </li><li>  jangan takut untuk menggunakan C ++ karena takut itu akan "melahap banyak memori" atau "kurang dioptimalkan daripada C".  Tidak, tidak.  Anda perlu takut bahwa menggunakan objek dan banyak lapisan abstraksi akan membuat kode tidak terbaca, dan men-debug itu akan menjadi prestasi heroik; </li><li>  jika Anda tidak menggunakan sesuatu yang “menyulitkan”, seperti templat, warisan, dan pesona C ++ yang menarik lainnya, lalu mengapa menggunakan C ++ sama sekali?  Hanya demi benda?  Apakah itu sepadan?  Dan demi objek global statis tanpa menggunakan / menghapus baru dilarang pada beberapa proyek? </li></ol><br>  Kesimpulannya, kita dapat mengatakan bahwa kesederhanaan nyata menggunakan C ++ ternyata hanyalah alasan untuk berulang kali meningkatkan kompleksitas proyek tanpa peningkatan kecepatan atau memori. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id461113/">https://habr.com/ru/post/id461113/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id461095/index.html">Apollo Guidance Computer - arsitektur dan perangkat lunak sistem. Bagian 1</a></li>
<li><a href="../id461099/index.html">Game AirAttack! - Pengalaman pengembangan VR pertama kami</a></li>
<li><a href="../id461101/index.html">Android Jetpack Membuat Kesan Pertama</a></li>
<li><a href="../id461105/index.html">5 plugin webpack bermanfaat</a></li>
<li><a href="../id461107/index.html">Dosimeter untuk Seryozha. Bagian II Tabung centenary vs atom damai</a></li>
<li><a href="../id461121/index.html">Eksperimen multitasking kecil dalam mikrokontroler</a></li>
<li><a href="../id461125/index.html">Tugas membuat kode numerik berurutan untuk penomoran pesan dalam kode sumber di Visual Studio (mis. C #)</a></li>
<li><a href="../id461127/index.html">Analisis kinerja VM di VMware vSphere. Bagian 3: Penyimpanan</a></li>
<li><a href="../id461129/index.html">Tentang kote, istri, dua putra, ide ... dan tidak hanya. Cerita dengan kelanjutan</a></li>
<li><a href="../id461131/index.html">Truk kereta ROS Bagian 2. Perangkat lunak</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>