<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ùï üåÉ ü§úüèø D√©couvrez 2 millions de sessions sans t√™te üöì üìπ ü¶ï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Publi√© le 4 juin 2018 sur le blog d'entreprise sans navigateur. 

 Nous sommes heureux d'annoncer que nous avons r√©cemment franchi la ligne des deux m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©couvrez 2 millions de sessions sans t√™te</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413547/">  <font color="gray">Publi√© le 4 juin 2018 sur le blog d'entreprise sans navigateur.</font> <br><br>  Nous sommes heureux d'annoncer que nous avons r√©cemment franchi la ligne des <b>deux millions de sessions desservies</b> !  Ce sont des <i>millions de</i> captures d'√©cran g√©n√©r√©es, de PDF imprim√©s et de sites test√©s.  Nous avons fait presque tout ce que vous pouvez penser avec un navigateur sans t√™te. <br><br>  Bien qu'il soit agr√©able d'atteindre un tel jalon, mais en cours de route, il y avait clairement <i>beaucoup de</i> chevauchements et de probl√®mes.  En raison de l'√©norme trafic re√ßu, je voudrais prendre du recul et √©noncer des recommandations g√©n√©rales pour le lancement de navigateurs sans t√™te (et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">marionnettistes</a> ) en production. <br><br>  Voici quelques conseils. <br><a name="habracut"></a><br><h1>  1. N'utilisez pas du tout de navigateur sans t√™te </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/cae/85f/438/cae85f438e0037a0f87f1ae6619cfc33.png"><br><br><h3>  Consommation de ressources Chrome sans t√™te </h3><br>  En aucun cas, si possible, <i>ne d√©marrez pas du tout le navigateur en mode sans t√™te</i> .  Surtout sur la m√™me infrastructure que votre application (voir ci-dessus).  Le navigateur sans t√™te est impr√©visible, gourmand et se reproduit comme M. Misix de Rick et Morty.  Presque tout ce qu'un navigateur peut faire (√† l'exception de l'interpolation et de l'ex√©cution de JavaScript) peut √™tre fait √† l'aide de simples outils Linux.  Les biblioth√®ques Cheerio et autres offrent une √©l√©gante API Node pour r√©cup√©rer des donn√©es avec des requ√™tes HTTP et le scraping, si tel est votre objectif. <br><br>  Par exemple, vous pouvez r√©cup√©rer une page (en supposant qu'il s'agit d'une sorte de code HTML) et la supprimer avec des commandes simples comme celles-ci: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cheerio <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'cheerio'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fetch <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'node-fetch'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(url); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> html = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> res.test(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $ = cheerio.load(html); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $(<span class="hljs-string"><span class="hljs-string">'buy-now.price'</span></span>).text(); } getPrice(<span class="hljs-string"><span class="hljs-string">'https://my-cool-website.com/'</span></span>);</code> </pre> <br>  De toute √©vidence, le script ne couvre pas tous les cas d'utilisation, et si vous lisez cet article, vous <i>devrez</i> probablement utiliser un navigateur sans t√™te.  Commen√ßons donc. <br><br><h1>  2. Ne lancez pas inutilement un navigateur sans t√™te </h1><br>  Nous avons rencontr√© de nombreux utilisateurs qui essaient de faire fonctionner le navigateur m√™me s'il n'est pas utilis√© (avec des connexions ouvertes).  Bien que cela puisse √™tre une bonne strat√©gie pour acc√©l√©rer une session, elle se bloquera dans quelques heures.  En grande partie parce que les navigateurs <i>aiment</i> tout mettre <i>en</i> cache et mangent progressivement de la m√©moire.  D√®s que vous arr√™tez d'utiliser intensivement le navigateur, fermez-le imm√©diatement! <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> browser = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> puppeteer.launch(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> page = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> browser.newPage(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://www.example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// More stuff ...page.click() page.type() browser.close(); // &lt;- Always do this! }</span></span></code> </pre> <br>  En mode sans navigateur, nous corrigeons g√©n√©ralement cette erreur pour les utilisateurs nous-m√™mes, en d√©finissant toujours une sorte de minuteur pour la session et en fermant le navigateur lorsque WebSocket est d√©connect√©.  Mais si vous n'utilisez pas notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">service</a> ou l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">image Docker de sauvegarde</a> , assurez-vous <i>de</i> fermer <i>automatiquement</i> le navigateur, car ce sera d√©sagr√©able lorsque tout tombera au milieu de la nuit. <br><br><h1>  3. Votre page d'amis <code>page.evaluate</code> </h1><br><blockquote>  Soyez prudent avec les transpilers comme babel ou dactylographi√©, car ils aiment cr√©er des fonctions d'aide et supposent qu'ils sont accessibles avec des fermetures.  Autrement dit, le rappel .evaluate <i>peut ne pas</i> fonctionner correctement. </blockquote><br>  Puppeteer propose de nombreuses m√©thodes int√©ressantes, telles que le stockage de s√©lecteurs DOM et d'autres choses dans un environnement Node.  Bien que cela soit tr√®s pratique, vous pouvez facilement vous tirer une balle dans le pied si quelque chose sur la page force ce n≈ìud DOM √† <i>muter</i> .  Ce n'est peut-√™tre pas si cool, mais en r√©alit√©, il vaut mieux faire tout le travail c√¥t√© navigateur <i>dans le contexte du navigateur</i> .  Cela signifie g√©n√©ralement charger <code>page.evaulate</code> pour tout le travail √† effectuer. <br><br>  Par exemple, au lieu de quelque chose comme √ßa ( <i>trois</i> actions asynchrones): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $anchor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.$(<span class="hljs-string"><span class="hljs-string">'a.buy-now'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> link = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> $anchor.getProperty(<span class="hljs-string"><span class="hljs-string">'href'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> $anchor.click(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> link;</code> </pre> <br>  Il vaut mieux le faire (une action asynchrone): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.evaluate(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> $anchor = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'a.buy-now'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = $anchor.href; $anchor.click(); });</code> </pre> <br>  Un autre avantage √† encapsuler les actions dans un appel d' <code>evaluate</code> est la portabilit√©: ce code peut √™tre ex√©cut√© dans un navigateur pour v√©rifier au lieu d'essayer de r√©√©crire le code Node.  Bien s√ªr, il est toujours recommand√© d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utiliser un d√©bogueur</a> pour r√©duire le temps de d√©veloppement. <br><br>  Une r√®gle g√©n√©rale simple consiste √† compter le nombre d' <code>await</code> ou <code>then</code> dans le code.  S'il y en a plusieurs, il est probablement pr√©f√©rable d'ex√©cuter le code √† l'int√©rieur de l'appel <code>page.evaluate</code> .  La raison en est que toutes les actions asynchrones vont et viennent entre l'ex√©cution du n≈ìud et le navigateur, ce qui signifie une s√©rialisation et une d√©s√©rialisation JSON constantes.  Bien qu'il n'y ait pas une telle quantit√© d'analyse (car tout est pris en charge par WebSockets), cela prend encore du temps, ce qui est mieux d√©pens√© pour autre chose. <br><br><h1>  4. Parall√©lisez les navigateurs, pas les pages Web </h1><br>  Nous avons donc r√©alis√© que le lancement d'un navigateur n'est pas bon et nous devons le faire uniquement en cas d'urgence.  L'astuce suivante consiste √† ex√©cuter une seule session par navigateur.  Bien qu'en r√©alit√©, il soit possible d'√©conomiser des ressources en parall√©lisant le travail sur les <code>pages</code> , mais si une page tombe, elle peut planter tout le navigateur.  De plus, il n'est pas garanti que chaque page soit parfaitement propre (les cookies et le stockage peuvent devenir un casse-t√™te, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme on le voit</a> ). <br><br>  Au lieu de cela: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Launch one browser and capture the promise const launch = puppeteer.launch(); const runJob = async (url) { // Re-use the browser here const browser = await launch; const page = await browser.newPage(); await page.goto(url); const title = await page.title(); browser.close(); return title; };</span></span></code> </pre> <br>  Mieux vaut faire ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> runJob = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (url) { <span class="hljs-comment"><span class="hljs-comment">// Launch a clean browser for every "job" const browser = puppeteer.launch(); const page = await browser.newPage(); await page.goto(url); const title = await page.title(); browser.close(); return title; };</span></span></code> </pre> <br>  Chaque nouvelle instance de navigateur obtient un <code>--user-data-dir</code> propre ( <a href="">sauf indication contraire</a> ).  Autrement dit, il est compl√®tement trait√© comme une nouvelle session.  Si Chrome se bloque pour une raison quelconque, il ne tirera pas d'autres sessions avec lui. <br><br><h1>  5. Limite de file d'attente et de simultan√©it√© </h1><br>  L'une des principales caract√©ristiques de sans navigateur est la possibilit√© de limiter soigneusement la parall√©lisation et la file d'attente.  Les applications clientes ex√©cutent donc simplement <code>puppeteer.connect</code> , mais elles ne pensent pas √† l'impl√©mentation de la file d'attente.  Cela √©vite une √©norme quantit√© de probl√®mes, principalement avec les instances simultan√©es de Chrome qui engloutissent toutes les ressources disponibles de votre application. <br><br>  La meilleure et la plus simple consiste √† prendre notre image Docker et √† l'ex√©cuter avec les param√®tres n√©cessaires: <br><br><pre> <code class="hljs pgsql"># Pull <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Puppeteer@<span class="hljs-number"><span class="hljs-number">1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> support $ docker pull browserless/chrome:<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-puppeteer<span class="hljs-number"><span class="hljs-number">-1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> $ docker run -e "MAX_CONCURRENT_SESSIONS=10" browserless/chrome:<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-puppeteer<span class="hljs-number"><span class="hljs-number">-1.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br>  Cela limite le nombre de demandes simultan√©es √† dix (y compris les sessions de d√©bogage et plus).  La file d'attente est configur√©e par la variable <code>MAX_QUEUE_LENGTH</code> .  En r√®gle g√©n√©rale, vous pouvez effectuer environ 10 demandes simultan√©es par gigaoctet de m√©moire.  Le pourcentage d'utilisation du processeur peut varier pour diff√©rentes t√¢ches, mais en gros, vous aurez besoin de beaucoup et de beaucoup de RAM. <br><br><h1>  6. N'oubliez pas <code>page.waitForNavigation</code> </h1><br>  L'un des probl√®mes les plus courants que nous avons rencontr√©s concerne les actions qui d√©marrent le chargement des pages avec la fermeture soudaine des scripts.  Cela est d√ª au fait que les actions qui d√©clenchent le <code>pageload</code> provoquent souvent la d√©glutition des travaux ult√©rieurs.  Pour contourner le probl√®me, vous devez g√©n√©ralement appeler l'action de chargement de page - et imm√©diatement apr√®s l'attente du chargement. <br><br>  Par exemple, un tel <code>console.log</code> ne fonctionne pas au m√™me endroit ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://chrome.browserless.io/%3Fscript%3Dawait%2520page.goto(%2527">voir d√©mo</a> ): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.click(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.title(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(title);</code> </pre> <br>  Mais √ßa <i>marche</i> dans un autre ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://chrome.browserless.io/%3Fscript%3Dawait%2520page.goto(%2527">voir d√©mo</a> ). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com'</span></span>); page.click(<span class="hljs-string"><span class="hljs-string">'a'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.waitForNavigation(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.title(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(title);</code> </pre> <br>  Vous pouvez en savoir plus sur waitForNavigation <a href="">ici</a> .  Cette fonction a approximativement les m√™mes param√®tres d'interface que <code>page.goto</code> , mais uniquement avec la partie ¬´wait¬ª. <br><br><h1>  7. Utilisez Docker pour tout ce dont vous avez besoin. </h1><br>  Chrome a besoin de beaucoup de d√©pendances pour fonctionner correctement.  Vraiment beaucoup.  M√™me apr√®s avoir install√© tout ce dont vous avez besoin, vous devez vous soucier de choses comme les polices et les processus fant√¥mes.  Par cons√©quent, il est id√©al d'utiliser une sorte de conteneur pour tout y mettre.  Docker est presque sp√©cialement con√ßu pour cette t√¢che, car vous pouvez limiter la quantit√© de ressources disponibles et l'isoler.  Si vous souhaitez cr√©er votre propre <code>Dockerfile</code> , v√©rifiez ci-dessous toutes les d√©pendances n√©cessaires: <br><br><pre> <code class="hljs tex"># Dependencies needed for packages downstream RUN apt-get update &amp;&amp; apt-get install -y <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>unzip <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>fontconfig <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>locales <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>gconf-service <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libasound2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libatk1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libc6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libcairo2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libcups2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libdbus-1-3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libexpat1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libfontconfig1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgcc1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgconf-2-4 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgdk-pixbuf2.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libglib2.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libgtk-3-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libnspr4 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libpango-1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libpangocairo-1.0-0 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libstdc++6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libx11-6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libx11-xcb1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcb1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcomposite1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxcursor1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxdamage1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxext6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxfixes3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxi6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxrandr2 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxrender1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxss1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libxtst6 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>ca-certificates <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>fonts-liberation <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libappindicator1 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>libnss3 <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>lsb-release <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>xdg-utils <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>wget</code> </pre> <br>  Et afin d'√©viter les processus zombies (une chose courante dans Chrome), il est pr√©f√©rable d'utiliser quelque chose comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dumb-init</a> pour fonctionner correctement: <br><br><pre> <code class="hljs powershell">ADD https://github.com/Yelp/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span>/releases/download/v1.<span class="hljs-number"><span class="hljs-number">2.0</span></span>/dumb<span class="hljs-literal"><span class="hljs-literal">-init_1</span></span>.<span class="hljs-number"><span class="hljs-number">2.0</span></span>_amd64 /usr/local/bin/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span> RUN chmod +x /usr/local/bin/dumb<span class="hljs-literal"><span class="hljs-literal">-init</span></span></code> </pre> <br>  Si vous voulez en savoir plus, jetez un ≈ìil √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre Dockerfile</a> . <br><br><h1>  8. N'oubliez pas deux temps d'ex√©cution diff√©rents. </h1><br>  Il est utile de se rappeler qu'il existe <i>deux</i> environnements d'ex√©cution JavaScript (n≈ìud et navigateur).  Ceci est id√©al pour s√©parer les t√¢ches, mais une confusion se produit in√©vitablement car certaines m√©thodes n√©cessitent un passage de lien explicite au lieu de levage. <br><br>  Par exemple, prenez <code>page.evaluate</code> .  Au fond des entrailles du protocole, il y a une <a href="">strictification <i>litt√©rale</i> de la fonction et de son transfert vers Chrome</a> .  Par cons√©quent, des choses comme les fermetures et les ascenseurs <i>ne fonctionneront pas du tout</i> .  Si vous devez transmettre des r√©f√©rences ou des valeurs √† l'appel d'√©valuation, ajoutez-les simplement en tant qu'arguments qui seront trait√©s correctement. <br><br>  Ainsi, au lieu de r√©f√©rencer le <code>selector</code> via des fermetures: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> anchor = <span class="hljs-string"><span class="hljs-string">'a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// `selector` here is `undefined` since we're in the browser context const clicked = await page.evaluate(() =&gt; document.querySelector(anchor).click());</span></span></code> </pre> <br>  Meilleur param√®tre de passage: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> anchor = <span class="hljs-string"><span class="hljs-string">'a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">'https://example.com/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Here we add a `selector` arg and pass in the reference in `evaluate` const clicked = await page.evaluate((selector) =&gt; document.querySelector(selector).click(), anchor);</span></span></code> </pre> <br>  <code>page.evaluate</code> pouvez ajouter un ou plusieurs arguments √† la fonction <code>page.evaluate</code> , car elle est variable ici.  Assurez-vous d'en profiter! <br><br><h1>  Le futur </h1><br>  Nous sommes incroyablement optimistes quant √† l'avenir des navigateurs sans t√™te et √† toute l'automatisation qu'ils peuvent r√©aliser.  En utilisant des outils puissants comme marionnettiste et sans navigateur, nous esp√©rons que le d√©bogage et l'ex√©cution de l'automatisation sans t√™te en production seront plus faciles et plus rapides.  Bient√¥t, nous lancerons la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">facturation au fur</a> et √† mesure des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comptes</a> et des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctions</a> qui vous aideront √† mieux faire face √† votre travail sans t√™te! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413547/">https://habr.com/ru/post/fr413547/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413529/index.html">Pourquoi les nouveaux appareils i-SENSYS peuvent √™tre appel√©s r√©volutionnaires</a></li>
<li><a href="../fr413531/index.html">Le livre "Unity pour le d√©veloppeur. Jeux multiplateformes mobiles ¬ª</a></li>
<li><a href="../fr413539/index.html">Un contr√¥leur simple bas√© sur une logique floue. Cr√©ation et personnalisation</a></li>
<li><a href="../fr413543/index.html">Angular Cli 6: pourquoi vous en avez besoin et comment l'utiliser</a></li>
<li><a href="../fr413545/index.html">L'humour dans l'image de marque - pourquoi ce n'est pas toujours bon</a></li>
<li><a href="../fr413549/index.html">Cours de d√©veloppement Web</a></li>
<li><a href="../fr413551/index.html">D√©filement et attention (√©tude 2018)</a></li>
<li><a href="../fr413553/index.html">Le registraire REG.RU a priv√© le partenaire de l'acc√®s √† 70 000 domaines et a pris ses services pour lui-m√™me</a></li>
<li><a href="../fr413555/index.html">Interop√©rabilit√© s√©curis√©e dans les syst√®mes distribu√©s</a></li>
<li><a href="../fr413557/index.html">NewSQL: SQL ne va nulle part</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>