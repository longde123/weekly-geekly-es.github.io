<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßöüèº üî¨ üê∫ Maschinelles Lernen f√ºr Ihre Wohnungssuche. Teil 1 ‚õπüèº ü§úüèª ‚õëÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Haben Sie jemals nach einer Wohnung gesucht? M√∂chten Sie etwas maschinelles Lernen hinzuf√ºgen und einen Prozess interessanter gestalten? 



 Heute we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Maschinelles Lernen f√ºr Ihre Wohnungssuche. Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468053/"><p>  Haben Sie jemals nach einer Wohnung gesucht?  M√∂chten Sie etwas maschinelles Lernen hinzuf√ºgen und einen Prozess interessanter gestalten? </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/af/w7/7e/afw77esq32gd2e0admnmjfby4kk.png" alt="Wohnungen in Jekaterinburg"></div><a name="habracut"></a><br><p>  Heute werden wir √ºberlegen, maschinelles Lernen anzuwenden, um eine optimale Wohnung zu finden. </p><br><h2 id="introduction">  Einf√ºhrung </h2><br><p>  Zun√§chst m√∂chte ich diesen Moment kl√§ren und erkl√§ren, was "eine optimale Wohnung" bedeutet.  Es ist eine Wohnung mit einer Reihe von verschiedenen Merkmalen wie "Fl√§che", "Bezirk", "Anzahl der Balkone" und so weiter.  Und f√ºr diese Eigenschaften der Wohnung erwarten wir einen bestimmten Preis.  Sieht aus wie eine Funktion, die mehrere Parameter akzeptiert und eine Zahl zur√ºckgibt.  Oder vielleicht eine Black Box, die etwas Magie bietet. </p><br><p>  Aber ... es gibt ein gro√ües "aber", manchmal kann man sich einer Wohnung stellen, die aus einer Reihe von Gr√ºnden wie einer guten Geoposition √ºberteuert ist.  Es gibt auch prestigetr√§chtigere Bezirke im Zentrum einer Stadt und Bezirke au√üerhalb der Stadt.  Oder ... manchmal wollen Menschen ihre Wohnungen verkaufen, weil sie an einen anderen Punkt der Erde ziehen.  Mit anderen Worten, es gibt viele Faktoren, die den Preis beeinflussen k√∂nnen.  Kommt Ihnen das bekannt vor? </p><br><h2 id="little-stepaside">  Kleiner Schritt zur Seite </h2><br><p>  Bevor ich fortfahre, m√∂chte ich einen kleinen lyrischen Exkurs machen. <br>  Ich lebte 5 Jahre in Jekaterinburg (der Stadt zwischen Europa und Asien, einer der St√§dte, in denen 2018 die Fu√üball-Weltmeisterschaft ausgetragen wurde). </p><br><p>  Ich war in diesen konkreten Dschungel verliebt.  Und ich hasste diese Stadt f√ºr den Winter und die √∂ffentlichen Verkehrsmittel.  Es ist eine wachsende Stadt und jeden Monat gibt es Tausende und Abertausende von Wohnungen zu verkaufen. </p><br><p>  Ja, es ist eine √ºberf√ºllte, verschmutzte Stadt.  Gleichzeitig ist es ein guter Ort, um einen Immobilienmarkt zu analysieren.  Ich habe viele Anzeigen f√ºr Wohnungen aus dem Internet erhalten.  Und ich werde diese Informationen in weiterem Umfang nutzen. </p><br><p>  Au√üerdem habe ich versucht, verschiedene Angebote auf Jekaterinburgs Karte zu visualisieren.  Ja, es ist das auff√§llige Bild von Habracut, das auf Kepler.gl gemacht wurde </p><br><p><img src="https://habrastorage.org/webt/af/w7/7e/afw77esq32gd2e0admnmjfby4kk.png" alt="Bild"></p><br><p>  Es gibt √ºber zweitausend 1-Zimmer-Wohnungen, die im Juli 2019 in Jekaterinburg verkauft wurden.  Sie hatten einen anderen Preis, von weniger als einer Million bis fast 14 Millionen Rubel. </p><br><p>  Diese Punkte beziehen sich auf ihre geografische Position.  Die Farbe der Punkte auf der Karte stellt den Preis dar. Je niedriger der Preis in der N√§he der blauen Farbe ist, desto h√∂her ist der Preis in der N√§he der roten Farbe.  Sie k√∂nnen es als Analogie zu kalten und warmen Farben betrachten, je w√§rmer die Farbe ist, desto gr√∂√üer ist der Preis. <br>  Bitte denken Sie daran, dass je r√∂ter die Farbe ist, desto h√∂her ist der Wert von etwas.  Die gleiche Idee funktioniert f√ºr Blau, aber in Richtung des niedrigsten Preises. </p><br><p>  Jetzt haben Sie einen <em>allgemeinen</em> √úberblick √ºber das Bild und es wird Zeit f√ºr die Analyse. </p><br><h3 id="goal">  Ziel </h3><br><p>  Was wollte ich, als ich in Jekaterinburg lebte?  Ich habe nach einer Wohnung gesucht, die gut genug ist, oder wenn wir √ºber ML sprechen - ich wollte ein Modell bauen, das mir eine Kaufempfehlung gibt. </p><br><p>  Wenn eine Wohnung zu teuer ist, sollte das Modell einerseits empfehlen, auf eine Preissenkung zu warten, indem der erwartete Preis f√ºr diese Wohnung angezeigt wird. <br>  Auf der anderen Seite - wenn ein Preis je nach Marktlage gut genug ist - sollte ich dieses Angebot vielleicht in Betracht ziehen. </p><br><p>  Nat√ºrlich gibt es nichts Ideales und ich war bereit, einen Fehler in den Berechnungen zu akzeptieren.  Normalerweise verwenden Sie f√ºr diese Art von Aufgabe einen mittleren Vorhersagefehler und ich war bereit, 10% Fehler zu machen.  Wenn Sie zum Beispiel 2-3 Millionen russische Rubel haben, k√∂nnen Sie Fehler in 200-300 Tausend ignorieren, Sie k√∂nnen es sich leisten.  Wie es mir schien. </p><br><h2 id="preparing">  Vorbereiten </h2><br><p>  Wie ich bereits erw√§hnt habe, gab es viele Wohnungen. Schauen wir sie uns genauer an. <br>  Pandas als pd importieren </p><br><pre><code class="python hljs">df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'flats.csv'</span></span>) df.shape</code> </pre> <br><p><img src="https://habrastorage.org/webt/qx/_0/qg/qx_0qgrsiuprxgsbno2ccihjdia.png" alt="Bild"></p><br><p>  2310 Wohnungen f√ºr einen Monat, wir k√∂nnten etwas N√ºtzliches daraus extrahieren.  Was ist mit einer allgemeinen Daten√ºbersicht? </p><br><pre> <code class="python hljs">df.describe()</code> </pre> <br><p><img src="https://habrastorage.org/webt/is/pi/tj/ispitjyk3gpg-cbkhwfwnrayloa.png" alt="Bild"><br>  Es gibt nichts Au√üergew√∂hnliches - L√§ngengrad, Breitengrad, Preis einer Wohnung (das Etikett " <em>Kosten</em> ") und so weiter.  Ja, f√ºr diesen Moment habe ich " <em>Kosten</em> " anstelle von " <em>Preis</em> " verwendet. Ich hoffe, dass dies nicht zu Missverst√§ndnissen f√ºhrt. Bitte betrachten Sie sie als gleich. </p><br><h2 id="cleaning">  Reinigung </h2><br><p>  Hat jeder Datensatz die gleiche Bedeutung?  Einige von ihnen sind Wohnungen wie eine Kabine, Sie k√∂nnen dort arbeiten, aber Sie m√∂chten dort nicht leben.  Es sind kleine, beengte R√§ume, keine echte Wohnung.  Lassen Sie sie entfernen. </p><br><pre> <code class="python hljs">df = df[df.total_area &gt;= <span class="hljs-number"><span class="hljs-number">20</span></span>]</code> </pre> <br><p>  Der Prognosepreis f√ºr eine Wohnung stammt aus den √§ltesten Fragen der Wirtschaft und verwandten Bereichen.  Es gab nichts mit dem Begriff "ML" zu tun und die Leute versuchten, den Preis anhand von Quadratmetern / Fu√ü zu erraten. <br>  Also schauen wir uns diese Spalten / Beschriftungen an und versuchen, ihre Verteilung zu ermitteln. </p><br><pre> <code class="python hljs">numerical_fields = [<span class="hljs-string"><span class="hljs-string">'total_area'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> numerical_fields: mask = ~np.isnan(df[col]) sns.distplot(df[col][mask], color=<span class="hljs-string"><span class="hljs-string">"r"</span></span>,label=col) plot.show()</code> </pre> <br><p><img src="https://habrastorage.org/webt/w2/kj/eq/w2kjeqg-gr-qzcum6hcgqnoz6eo.png" alt="Bild"></p><br><p>  Nun ... es gibt nichts Besonderes, sieht aus wie eine Normalverteilung.  Vielleicht m√ºssen wir tiefer gehen? </p><br><pre> <code class="python hljs">sns.pairplot(df[numerical_fields])</code> </pre> <br><p><img src="https://habrastorage.org/webt/df/fw/lg/dffwlggd_vemlbfl96qdw-0h3fw.png" alt="Bild"></p><br><p>  Ups ... da stimmt etwas nicht.  Bereinigen Sie Ausrei√üer in diesen Feldern und versuchen Sie erneut, unsere Daten zu analysieren. </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#Remove outliers df = df[abs(df.total_area - df.total_area.mean()) &lt;= (3 * df.total_area.std())] df = df[abs(df.cost - df.cost.mean()) &lt;= (3 * df.cost.std())] #Redraw our data sns.pairplot(df[numerical_fields])</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/uu/zp/ok/uuzpokfgmae_4d2bxqvsmp53jns.png" alt="Bild"></p><br><p>  Ausrei√üer sind gegangen, und jetzt sieht es besser aus. </p><br><h2 id="transformation">  Transformation </h2><br><p>  Das Label "Jahr", das auf ein Baujahr hinweist, sollte in etwas Informativeres umgewandelt werden.  Es sei das Zeitalter des Bauens, mit anderen Worten, wie alt ein bestimmtes Haus ist. </p><br><pre> <code class="python hljs">df[<span class="hljs-string"><span class="hljs-string">'age'</span></span>] = <span class="hljs-number"><span class="hljs-number">2019</span></span> -df[<span class="hljs-string"><span class="hljs-string">'year'</span></span>]</code> </pre> <br><p>  Schauen wir uns das Ergebnis an. </p><br><pre> <code class="python hljs">df.head()</code> </pre> <br><p><img src="https://habrastorage.org/webt/wq/j_/h-/wqj_h-w8jwshp3fi0ofyhhuanca.png" alt="Bild"></p><br><p>  Es gibt alle Arten von Daten, kategoriale Daten, Nan-Werte, Textbeschreibungen und einige Geoinformationen (L√§ngen- und Breitengrad).  Lassen Sie uns die letzten beiseite legen, denn auf dieser B√ºhne sind sie nutzlos.  Wir werden sp√§ter darauf zur√ºckkommen. </p><br><pre> <code class="python hljs">df.drop(columns=[<span class="hljs-string"><span class="hljs-string">"lon"</span></span>,<span class="hljs-string"><span class="hljs-string">"lat"</span></span>,<span class="hljs-string"><span class="hljs-string">"description"</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><h3 id="categorical-data">  Kategoriale Daten </h3><br><p>  Normalerweise verwenden Benutzer f√ºr kategoriale Daten verschiedene Arten der Codierung oder Dinge wie CatBoost, die die M√∂glichkeit bieten, mit ihnen wie mit numerischen Variablen zu arbeiten. <br>  Aber k√∂nnten wir etwas logischeres und intuitiveres verwenden?  Jetzt ist es an der Zeit, unsere Daten verst√§ndlicher zu machen, ohne ihre Bedeutung zu verlieren. </p><br><h3 id="districts">  Bezirke </h3><br><p>  Nun, es gibt √ºber zwanzig m√∂gliche Bezirke. K√∂nnen wir unserem Modell √ºber 20 zus√§tzliche Variablen hinzuf√ºgen?  Nat√ºrlich k√∂nnten wir, aber ... sollten wir?  Wir sind Menschen und wir k√∂nnten Dinge vergleichen, nicht wahr? <br>  Erstens - nicht jeder Bezirk ist einem anderen gleichgestellt.  Im Zentrum der Stadt sind die Preise f√ºr einen Quadratmeter h√∂her, weiter von der Innenstadt entfernt - es wird sinken.  Klingt es logisch?  K√∂nnten wir das nutzen? <br>  Ja, definitiv k√∂nnten wir jeden Bezirk mit einem bestimmten Koeffizienten abgleichen und der weitere Bezirk sind die billigeren Wohnungen. </p><br><p>  Nach dem Abgleichen der Stadt und der Verwendung einer anderen Webdienstkarte (ArcGIS Online) ge√§ndert und hat eine √§hnliche Ansicht <br><img src="https://habrastorage.org/webt/ji/a6/sw/jia6swan_kxipvxp4y2p1ycfqk4.png" alt="Bild"></p><br><p>  Ich habe die gleiche Idee wie f√ºr die Visualisierung von Flat verwendet.  Das "prestigetr√§chtigste" und "teuerste" Viertel, rot und am wenigsten blau gef√§rbt.  Eine Farbtemperatur, erinnerst du dich daran? <br>  Au√üerdem sollten wir einige Manipulationen an unserem Datenrahmen vornehmen. </p><br><pre> <code class="python hljs">district_map = {<span class="hljs-string"><span class="hljs-string">'alpha'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'beta'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, ... <span class="hljs-string"><span class="hljs-string">'delta'</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>, ... <span class="hljs-string"><span class="hljs-string">'epsilon'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} df.district = df.district.str.lower() df.replace({<span class="hljs-string"><span class="hljs-string">"district"</span></span>: district_map}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Der gleiche Ansatz wird zur Beschreibung der internen Qualit√§t der Wohnung verwendet.  Manchmal muss es repariert werden, manchmal ist die Wohnung recht gut und bereit zum Leben.  In anderen F√§llen sollten Sie zus√§tzliches Geld daf√ºr ausgeben, dass es besser aussieht (um die Wasserh√§hne zu wechseln, W√§nde zu streichen).  Es k√∂nnten auch Koeffizienten verwendet werden. </p><br><pre> <code class="python hljs">repair = {<span class="hljs-string"><span class="hljs-string">'A'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>: <span class="hljs-number"><span class="hljs-number">0.6</span></span>, <span class="hljs-string"><span class="hljs-string">'C'</span></span>: <span class="hljs-number"><span class="hljs-number">0.7</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>} df.repair.fillna(<span class="hljs-string"><span class="hljs-string">'D'</span></span>, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df.replace({<span class="hljs-string"><span class="hljs-string">"repair"</span></span>: repair}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  √úbrigens √ºber W√§nde.  Nat√ºrlich beeinflusst es auch den Wohnungspreis.  Modernes Material ist besser als √§lter, Ziegel ist besser als Beton.  W√§nde aus Holz sind ein ziemlich kontroverser Moment, vielleicht ist es eine gute Wahl f√ºr die Landschaft, aber nicht so gut f√ºr das st√§dtische Leben. </p><br><p>  Wir verwenden den gleichen Ansatz wie zuvor und machen einen Vorschlag zu Zeilen, von denen wir nichts wissen.  Ja, manchmal geben die Leute nicht alle Informationen √ºber ihre Wohnung an.  Dar√ºber hinaus k√∂nnen wir anhand der Geschichte versuchen, das Material von W√§nden zu erraten.  In einem bestimmten Zeitraum (zum Beispiel Chruschtschows f√ºhrender Zeitraum) kennen wir typische Baumaterialien. </p><br><pre> <code class="python hljs">walls_map = {<span class="hljs-string"><span class="hljs-string">'brick'</span></span>: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, ... <span class="hljs-string"><span class="hljs-string">'concrete'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, <span class="hljs-string"><span class="hljs-string">'block'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, ... <span class="hljs-string"><span class="hljs-string">'monolith'</span></span>: <span class="hljs-number"><span class="hljs-number">0.9</span></span>, <span class="hljs-string"><span class="hljs-string">'wood'</span></span>: <span class="hljs-number"><span class="hljs-number">0.4</span></span>} mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">2010</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'monolith'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">2000</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'concrete'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">1990</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'block'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'block'</span></span> df.replace({<span class="hljs-string"><span class="hljs-string">"walls"</span></span>: walls_map}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'year'</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Es gibt auch Informationen √ºber den Balkon.  Meiner bescheidenen Meinung nach ist der Balkon eine wirklich n√ºtzliche Sache, daher konnte ich mir nicht helfen, dar√ºber nachzudenken. <br>  Leider gibt es einige Nullwerte.  Wenn der Autor einer Anzeige Informationen dar√ºber √ºberpr√ºft h√§tte, h√§tten wir realistischere Informationen. <br>  Wenn es keine Informationen gibt, bedeutet dies "es gibt keinen Balkon". </p><br><pre> <code class="python hljs">df.balcony.fillna(<span class="hljs-number"><span class="hljs-number">0</span></span>,inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Danach l√∂schen wir Spalten mit Informationen √ºber das Baujahr (wir haben eine gute Alternative daf√ºr).  Au√üerdem entfernen wir Spalten mit Informationen zum Geb√§udetyp, da diese viele NaN-Werte aufweisen und ich keine M√∂glichkeit gefunden habe, diese L√ºcken zu schlie√üen.  Und wir lassen alle Zeilen mit NaN fallen, die wir haben. </p><br><pre> <code class="python hljs">df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'type_house'</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df = df.astype(np.float64) df.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><h2 id="checking">  √úberpr√ºfen </h2><br><p>  Also ... haben wir einen nicht standardm√§√üigen Ansatz verwendet und kategoriale Werte durch ihre numerische Darstellung ersetzt.  Und jetzt haben wir eine Transformation unserer Daten abgeschlossen. <br>  Ein Teil der Daten wurde gel√∂scht, aber im Allgemeinen handelt es sich um einen recht guten Datensatz.  Betrachten wir die Korrelation zwischen unabh√§ngigen Variablen. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show_correlation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(df)</span></span></span><span class="hljs-function">:</span></span> sns.set(style=<span class="hljs-string"><span class="hljs-string">"whitegrid"</span></span>) corr = df.corr() * <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-comment"><span class="hljs-comment"># Select upper triangle of correlation matrix mask = np.zeros_like(corr, dtype=np.bool) mask[np.triu_indices_from(mask)] = True # Set up the matplotlib figure f, ax = plt.subplots(figsize=(15, 11)) # Generate a custom diverging colormap cmap = sns.diverging_palette(220, 10) # Draw the heatmap with the mask and correct aspect ratio sns.heatmap(corr, mask=mask, cmap=cmap, center=0, linewidths=1, cbar_kws={"shrink": .7}, annot=True, fmt=".2f") plot.show() # df[columns] = scale(df[columns]) return df df1 = show_correlation(df.drop(columns=['cost']))</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/ht/dv/ir/htdvirxheiytace3nmaujf3wet8.png" alt="Bild"></p><br><p>  √Ñhm ... es wurde sehr interessant. <br>  <strong>Positive Korrelation</strong> <br>  <em>Gesamtfl√§che - Balkone</em> .  Warum nicht?  Wenn unsere Wohnung gro√ü ist, gibt es einen Balkon. <br>  <strong>Negative Korrelation</strong> <br>  <em>Gesamtfl√§che - Alter</em> .  Je neuer flach ist, desto gr√∂√üer ist eine Wohnfl√§che.  Klingt logisch, neue sind ger√§umiger als √§ltere. <br>  <em>Alter - Balkon</em> .  Je √§lter flach ist, desto weniger Balkone hat es.  Scheint wie eine Korrelation durch eine andere Variable.  Vielleicht ist es ein Dreieck Age-Balcony-Area, in dem eine Variable einen impliziten Einfluss auf eine andere hat.  Halten Sie das f√ºr eine Weile auf Eis. <br>  <em>Alter - Bezirk.</em>  Die √§ltere Wohnung ist die gro√üe Wahrscheinlichkeit, die in den prestigetr√§chtigeren Bezirken platziert wird.  K√∂nnte es mit einem h√∂heren Preis in der N√§he des Zentrums zusammenh√§ngen? </p><br><p>  Wir konnten auch die Korrelation mit der abh√§ngigen Variablen sehen </p><br><pre> <code class="python hljs">plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>)) corr = df.corr()*<span class="hljs-number"><span class="hljs-number">100.0</span></span> sns.heatmap(corr[[<span class="hljs-string"><span class="hljs-string">'cost'</span></span>]], cmap= sns.diverging_palette(<span class="hljs-number"><span class="hljs-number">220</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), center=<span class="hljs-number"><span class="hljs-number">0</span></span>, linewidths=<span class="hljs-number"><span class="hljs-number">1</span></span>, cbar_kws={<span class="hljs-string"><span class="hljs-string">"shrink"</span></span>: <span class="hljs-number"><span class="hljs-number">.7</span></span>}, annot=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, fmt=<span class="hljs-string"><span class="hljs-string">".2f"</span></span>)</code> </pre> <br><p><img src="https://habrastorage.org/webt/o7/ax/m1/o7axm1zph-x3eterypsfcod38zo.png" alt="Bild"></p><br><p>  Los geht's ... </p><br><p>  Die sehr starke Korrelation zwischen Wohnungsfl√§che und Preis.  Wenn Sie einen gr√∂√üeren Wohnraum haben m√∂chten, ben√∂tigen Sie mehr Geld. <br>  Es besteht eine negative Korrelation zwischen den Paaren " <em>Alter / Kosten</em> " und " <em>Bezirk / Kosten</em> ".  Eine Wohnung in einem neueren Haus, das weniger erschwinglich ist als das alte.  Und auf dem Land sind Wohnungen billiger. <br>  Wie auch immer, es scheint klar und verst√§ndlich zu sein, also habe ich mich daf√ºr entschieden. </p><br><h2 id="model">  Modell </h2><br><p>  Verwenden Sie f√ºr Aufgaben, die sich normalerweise auf den Preis der Vorhersageebene beziehen, die lineare Regression.  Aufgrund einer signifikanten Korrelation aus einem fr√ºheren Stadium k√∂nnten wir versuchen, es auch zu verwenden.  Es ist ein Arbeitstier, das f√ºr viele Aufgaben geeignet ist. <br>  Bereiten Sie unsere Daten f√ºr die n√§chsten Aktionen vor </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split y = df.cost X = df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'cost'</span></span>]) X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number"><span class="hljs-number">0.2</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">42</span></span>)</code> </pre> <br><p>  Au√üerdem erstellen wir einige einfache Funktionen zur Vorhersage und Auswertung des Ergebnisses.  Lassen Sie uns unseren ersten Versuch machen, den Preis vorherzusagen! </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y_test, model)</span></span></span><span class="hljs-function">:</span></span> y = model.predict(X) score = round((r2_score(y_test, y) * <span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>) print(<span class="hljs-string"><span class="hljs-string">f'Score on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{model.__class__.__name__}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{score}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y, regressor)</span></span></span><span class="hljs-function">:</span></span> model = regressor.fit(X, y) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.linear_model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LinearRegression regressor = LinearRegression() model = train_model(X_train, y_train, regressor) predict(X_test, y_test, model)</code> </pre> <br><p><img src="https://habrastorage.org/webt/ak/v3/_a/akv3_antf7wwaxndcpjwx90rvju.png" alt="Bild"></p><br><p>  Nun ... 76,67% der Genauigkeit.  Ist es eine gro√üe Zahl oder nicht?  Meiner Meinung nach ist es nicht schlecht.  Dar√ºber hinaus ist es ein guter Ausgangspunkt.  Nat√ºrlich ist es nicht ideal und es gibt Verbesserungspotential. </p><br><p>  Gleichzeitig haben wir versucht, nur einen Teil der Daten vorherzusagen.  Was ist mit der Anwendung derselben Strategie auf andere Daten?  Ja, Zeit f√ºr eine Kreuzvalidierung. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_cross_validation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y, model)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> KFold, cross_val_score regressor_name = model.__class__.__name__ fold = KFold(n_splits=<span class="hljs-number"><span class="hljs-number">10</span></span>, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">0</span></span>) scores_on_this_split = cross_val_score(estimator=model, X=X, y=y, cv=fold, scoring=<span class="hljs-string"><span class="hljs-string">'r2'</span></span>) scores_on_this_split = np.round(scores_on_this_split * <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) mean_accuracy = scores_on_this_split.mean() print(<span class="hljs-string"><span class="hljs-string">f'Crossvaladaion accuracy on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{model.__class__.__name__}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{mean_accuracy}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mean_accuracy do_cross_validation(X, y, model)</code> </pre> <br><p><img src="https://habrastorage.org/webt/yn/uf/3y/ynuf3yr9ew4kgjrvnb-nifevbnq.png" alt="Bild"></p><br><p>  Das Ergebnis der Kreuzvalidierung Jetzt nehmen wir ein anderes Ergebnis.  73 ist weniger als 76. Aber es ist auch ein guter Kandidat, bis wir einen besseren haben werden.  Dies bedeutet auch, dass eine lineare Regression in unserem Datensatz ziemlich stabil funktioniert. </p><br><p>  Und jetzt ist eine Zeit f√ºr den letzten Schritt. </p><br><p>  Wir werden das beste Merkmal der linearen Regression betrachten - die <strong>Interpretierbarkeit</strong> . <br>  Diese Modellfamilie hat im Gegensatz zu komplexeren eine bessere F√§higkeit zum Verst√§ndnis.  Es gibt nur einige Zahlen mit Koeffizienten, und Sie k√∂nnen Ihre Zahlen in die Gleichung einf√ºgen, einfache Berechnungen anstellen und ein Ergebnis erzielen. </p><br><p>  Versuchen wir, unser Modell zu interpretieren </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">estimate_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(model)</span></span></span><span class="hljs-function">:</span></span> sns.set(style=<span class="hljs-string"><span class="hljs-string">"white"</span></span>, context=<span class="hljs-string"><span class="hljs-string">"talk"</span></span>) f, ax = plot.subplots(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), sharex=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) sns.barplot(x=model.coef_, y=X.columns, palette=<span class="hljs-string"><span class="hljs-string">"vlag"</span></span>, ax=ax) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(model.coef_.astype(int)): ax.text(v + <span class="hljs-number"><span class="hljs-number">3</span></span>, i + <span class="hljs-number"><span class="hljs-number">.25</span></span>, str(v), color=<span class="hljs-string"><span class="hljs-string">'black'</span></span>) ax.set_title(<span class="hljs-string"><span class="hljs-string">f"Coefficients"</span></span>) estimate_model(regressor)</code> </pre> <br><p><img src="https://habrastorage.org/webt/1j/bc/_a/1jbc_apacascsr3cakmwz4qbnu8.png" alt="Die Koeffizienten unseres Modells"></p><br><p>  Das Bild sieht ziemlich logisch aus.  <em>Balkon / W√§nde / Fl√§che / Reparatur</em> leisten einen <strong>positiven</strong> Beitrag zu einem Pauschalpreis. <br>  Je weiter flach, desto gr√∂√üer ist ein <strong>negativer Beitrag</strong> .  Gilt auch f√ºr das Alter.  Die √§ltere Wohnung ist der niedrigere Preis. </p><br><p>  Es war also eine faszinierende Reise. <br>  Wir haben von Grund auf begonnen und den untypischen Ansatz f√ºr die Datentransformation verwendet, der auf der menschlichen Sichtweise (Zahlen statt Dummy-Variablen), √ºberpr√ºften Variablen und ihrer Beziehung zueinander basiert.  Danach erstellen wir unser einfaches Modell, das durch Kreuzvalidierung getestet wird.  Und als Kirsche auf dem Kuchen - schauen Sie sich die Einbauten des Modells an, was uns Vertrauen in unseren Weg gibt. </p><br><p>  Aber!  Es ist nicht das Ende unserer Reise, sondern nur eine Pause.  Wir werden versuchen, unser Modell in Zukunft zu √§ndern, und vielleicht (nur vielleicht) erh√∂ht es die Genauigkeit der Vorhersage. </p><br><p>  <strong>Danke f√ºrs Lesen!</strong> </p><br><blockquote>  Der zweite Teil ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">da</a> <br></blockquote><p>  PS Dort befinden sich die Quelldaten und das Ipython-Notebook </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468053/">https://habr.com/ru/post/de468053/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468041/index.html">Ank√ºndigung der Kubernetes Web View-Weboberfl√§che (und eine kurze √úbersicht √ºber andere Web-Benutzeroberfl√§chen f√ºr Kubernetes)</a></li>
<li><a href="../de468043/index.html">So erstellen Sie ein UI-Kit, das zum Verkauf steht. Entwicklungsstadien eines kommerziellen Designsystems</a></li>
<li><a href="../de468047/index.html">Arbeiten mit Hierarchien in lsFusion</a></li>
<li><a href="../de468049/index.html">Verwenden von werf zum Ausrollen komplexer Helmdiagramme</a></li>
<li><a href="../de468051/index.html">VDS mit lizenziertem Windows Server f√ºr 100 Rubel: Mythos oder Realit√§t?</a></li>
<li><a href="../de468057/index.html">Unix-√§hnliche Betriebssystementwicklung - Multitasking und Systemaufrufe (7)</a></li>
<li><a href="../de468059/index.html">Meine zweite Woche mit Haiku: viele versteckte Diamanten und angenehme √úberraschungen sowie einige Probleme</a></li>
<li><a href="../de468061/index.html">Cron unter Linux: Verlauf, Verwendung und Ger√§t</a></li>
<li><a href="../de468063/index.html">Angulareact</a></li>
<li><a href="../de468065/index.html">Mentale Produktmanagementmodelle f√ºr alle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>