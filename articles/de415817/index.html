<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äç‚öïÔ∏è ü¶Ö üë®‚Äçüë©‚Äçüë¶‚Äçüë¶ Wir √ºbertakten das Backup. Yandex Vortrag üè§ ü§∑üèø üÖøÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mehrere bevorstehende Vortr√§ge basieren auf dem ersten Y. Subbotnik √ºber Datenbanken, die im Fr√ºhjahr stattfinden . Zun√§chst sprach Entwickler Andrei ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir √ºbertakten das Backup. Yandex Vortrag</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/415817/">  Mehrere bevorstehende Vortr√§ge basieren auf dem ersten Y. Subbotnik √ºber Datenbanken, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Fr√ºhjahr stattfinden</a> .  Zun√§chst sprach Entwickler Andrei Borodin bei Y. Subbotnik.  Er sprach √ºber WAL-G, ein einfaches und effektives Tool zum Sichern von PostgreSQL in der Cloud, sowie √ºber Algorithmen und Technologien, mit denen WAL-G Backups schneller erstellen kann.  Das Hauptmerkmal von WAL-G sind Delta-Backups.  In der Vorlesung erfahren Sie mehr √ºber deren Implementierung und wie sich die Unterst√ºtzung f√ºr diese Technologie in PostgreSQL entwickelt. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/bXuN4Na0cEo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - Hallo!  Ich bin ein Yandex-Entwickler aus Jekaterinburg.  Zur Technologie der schnellen Sicherung.  Wir f√ºhren seit geraumer Zeit Backups durch. Es gab Berichte von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vladimir Borodin</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Evgeny Dyukov</a> dar√ºber, wie wir recherchieren und was wir entwickeln, um Daten sicher, zuverl√§ssig, bequem und effizient zu speichern.  Diese Reihe widmet sich den neuesten Entwicklungen in diesem Bereich. <br><br>  Lassen Sie uns im Prinzip √ºber Backups in PostgreSQL sprechen.  Das Standarddienstprogramm zum √úbertragen von Daten - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pg_dump</a> - ist als Konsolendienstprogramm definiert, das eine Datei mit einer logischen Darstellung Ihrer Daten erstellt. <br><a name="habracut"></a><br>  Dass es sich um eine logische Kopie handelt, ist sehr praktisch.  Sie k√∂nnen jederzeit Daten zwischen verschiedenen Versionen √ºbertragen, Ihre Datenbank in St√ºcke schneiden und dies ist ein Standardwerkzeug, das beispielsweise in einer Box mit dem PgAdmin-Verwaltungsdienstprogramm geliefert wird. <br><br><img src="https://habrastorage.org/webt/3j/zs/kh/3jzskhrdbobeb5pfvdyebjvv9bi.jpeg"><br>  Zu pg_dump m√ºssen Sie zun√§chst wissen, dass dies ein Entwicklertool ist. <br><br>  Dies ist kein Datenbankwartungstool.  pg_dump ist nicht f√ºr die Arbeit mit einer hoch geladenen Datenbank ausgelegt. <br><br><img src="https://habrastorage.org/webt/rb/sk/yf/rbskyfdmcwqb9ctu6-idvcj6ywm.jpeg"><br>  Angenommen, alles ist ernst und Sie m√∂chten die "Point-in-Time-Recovery" -Technologie verwenden, die die PostgreSQL-API f√ºr die Arbeit mit Online-Backups verwendet.  Sie rufen die Funktion pg_start_backup auf und erstellen eine Dateikopie der Datenbank.  Tats√§chlich zwingt pg_start_backup die Datenbank, CHECKPOINT auszuf√ºhren.  und aktivieren Sie ganzseitige Schreibvorg√§nge im Vorausschreibprotokoll.  Die Kopie der Datenbank, die Sie beim Aufrufen der API erstellen, ist keine konsistente Kopie der Daten.  Sie ben√∂tigen au√üerdem ein Vorausschreibprotokoll, um Ihre Datenbank f√ºr die Dauer des Aufrufs pg_stop_backup, dh am Ende der Sicherung, wiederherstellen zu k√∂nnen. <br><br><img src="https://habrastorage.org/webt/0a/aw/v1/0aawv1w0gp9okkkbjuja0k-ywg4.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link von der Folie</a></sup></sub> </h5><br>  Nach der Endzeit des Entfernens der Sicherung und bei Vorhandensein eines f√ºhrenden Datensatzes k√∂nnen Sie den gew√ºnschten Zeitpunkt in der Lebensdauer Ihrer Datenbank wiederherstellen. <br><br>  Das Dienstprogramm pg_basebackup ist im Lieferumfang enthalten. Es implementiert all diese Technologien in kanonischer Form und erm√∂glicht Ihnen das Sichern mit der minimal erforderlichen Funktionalit√§t. <br><br>  Wenn Sie immer noch ernsthafter sind als zuvor, verwenden Sie eine Art Backup-Management-Software, und normalerweise ist es Barman. <br><br>  Er hat mehrere Vorteile.  Das Hauptplus ist ein sehr verbreitetes Dienstprogramm, es hat eine riesige Community, eine gro√üe Anzahl von Fragen zum Stapel√ºberlauf. <br><br><img src="https://habrastorage.org/webt/hk/_s/xx/hk_sxxzzua_byoapw4kvxdexymm.jpeg"><br><br>  Sie m√ºssen nur einen Sicherungsserver ausw√§hlen und dort alle Ihre PostgreSQL-Daten sichern.  Dies ist sehr praktisch - solange ein Sicherungsserver f√ºr Sie ausreicht. <br><br>  Sobald Sie viele Sicherungsserver haben, m√ºssen Sie √ºberwachen, ob einer von ihnen voll ist.  Im Falle eines Ausfalls eines Sicherungsservers m√ºssen Sie wissen, welche Ihrer Datenbanken jetzt in Gefahr sind.  Sie m√ºssen im Prinzip verstehen, wo ein neuer Datenbankcluster beim Erstellen kopiert werden muss. <br><br>  Es gibt ein viel einfacheres Dienstprogramm zum Entfernen von Backups namens WAL-E. <br><br><img src="https://habrastorage.org/webt/jf/l1/a0/jfl1a07ymxdr0luksh1zg_cb7ii.jpeg"><br>  WAL-E f√ºhrt vier Hauptbefehle aus.  Der WAL-PUSH-Befehl sendet eine WAL-Datei an die Cloud, und der WAL-FETCH nimmt eine WAL-Datei, wenn der Befehl restore_command wiederhergestellt werden muss. <br><br>  Es gibt auch BACKUP-PUSH (implementiert das Entfernen der Backup-API) und BACKUP-FETCH (nimmt alle Daten aus der Cloud).  Daten werden in der Cloud gespeichert, sodass Sie nichts √ºberwachen m√ºssen. Dies ist bereits ein Cloud-Service-Problem. So stellen Sie sicher, dass Ihre Daten bei Bedarf verf√ºgbar sind.  Dies ist wahrscheinlich der Hauptvorteil des WAL-E. <br><br><img src="https://habrastorage.org/webt/tz/2e/h5/tz2eh51uc_vtsp-oylcltmgep1i.jpeg"><br>  Es gibt ziemlich viele Funktionen.  Es gibt eine Liste von Sicherungen, es gibt eine Aufbewahrungsrichtlinie, dh wir m√∂chten beispielsweise Sicherungen f√ºr die letzten sieben Tage oder die letzten f√ºnf Sicherungen, so etwas, speichern.  Und WAL-E kann auf einer Vielzahl von Cloud-Diensten sichern: S3, Azure, Google und das lokale Dateisystem k√∂nnen als Cloud bezeichnet werden. <br><br><img src="https://habrastorage.org/webt/n9/wj/uz/n9wjuz9n4tg_w8cvkkbp4g7_imi.jpeg"><br>  Es hat mehrere Eigenschaften.  Erstens ist es in Python geschrieben und verwendet aktiv die Unix-Pipeline, teilweise aus diesem Grund hat es Abh√§ngigkeiten und ist nicht sehr produktiv.  Dies ist normal, da sich WAL-E auf Benutzerfreundlichkeit und einfache Einrichtung konzentriert, damit Sie bei der Erstellung eines Sicherungsplans keinen Fehler machen k√∂nnen.  Und das ist eine sehr gute Idee. <br><br>  In WAL-E sind viele Funktionen geschrieben, und wo die Autoren sie weiterentwickelt haben, war den Autoren nicht sehr klar.  Die Idee kam, dass ich ein neues Werkzeug brauche. <br><br><img src="https://habrastorage.org/webt/ov/tj/ed/ovtjeduv1bhofpvnrbv2oong4ok.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link von der Folie</a></sup></sub> </h5><br>  Das Hauptmerkmal ist, dass es in Go neu geschrieben wurde, fast keine externen Abh√§ngigkeiten aufweist, wenn Sie keine externe Verschl√ºsselung verwenden, und dass es viel produktiver ist. <br><br><img src="https://habrastorage.org/webt/fl/pl/h2/flplh2x6ugfya5ydixenji9hmxg.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link von der Folie</a></sup></sub> </h5><br>  WAL-G wurde urspr√ºnglich von zwei Autoren von Citus Data erstellt. Der Hauptvorteil wird in diesem Histogramm gezeigt - die Geschwindigkeit beim Senden von ‚ÄûWellen‚Äú.  Wir sehen, dass WAL-E schnell ist, es kann alles sein, es kann eine gro√üe Spalte nahe Null sein. <br><br><img src="https://habrastorage.org/webt/r_/si/dn/r_sidnqgiipagw5sosfzo8ze90e.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link von der Folie</a></sup></sub> </h5><br>  WAL-G hat eine ziemlich stabile Bandbreite.  Bei Tests bei Citus Data zeigte er, dass er stabil etwa 800 Mb / s ‚ÄûWellen‚Äú sendet. <br><br>  Au√üerdem habe ich in WAL-G beispielsweise eine Funktion geschrieben, die die Sicherung von einem Replikat implementiert.  Sie m√ºssen Ihren DB-Master nicht mit einer Leselast laden, sondern k√∂nnen die Sicherung aus dem Replikat entfernen. <br><br><img src="https://habrastorage.org/webt/ck/bl/jj/ckbljjqa0ujh35rnlmncx5guauw.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link von der Folie</a></sup></sub> </h5><br>  Aber es gibt ein kleines Problem.  In dem Moment, in dem Sie mit der Sicherung beginnen, sollten Sie die Sicherung irgendwie benennen.  Der Name enth√§lt eine Zeitleiste, die ge√§ndert wird, wenn ein Replikat heraufgestuft wird.  Wenn in der Replikatkette vor dem Replikat, mit dem Sie sichern, ein Failover auftritt, werden Sie einige der Replikate bemerken und die Zeitachse wird ge√§ndert.  WAL-G ist sich bewusst, dass diese Situation nicht konsistent ist, da der Name einen Namen auf der alten Zeitachse enth√§lt und Ihnen verspricht, dass Sie die Entwicklung des Datenbankverlaufs in jede vorhandene Richtung fortsetzen k√∂nnen.  Das ist aber nicht so.  Sie sind bereits in eine der Richtungen gegangen und k√∂nnen mit dem hinteren Auto nicht zu einer anderen Zeitachse springen.  Daher versteht WAL-G diese Situation und l√§dt keine steuerliche JSON-Datei in die Cloud hoch.  Sie erstellen eine physische Kopie.  Es ist jedoch ein Eingreifen des Administrators erforderlich, damit diese Kopie verwendet werden kann. <br><br><img src="https://habrastorage.org/webt/no/yo/nv/noyonvp7l8d-0myokmscgjts31w.jpeg"><br><br>  Wir haben Delta-Kopien in WAL-G implementiert, ich habe auch an dieser Entwicklung gearbeitet.  Auf diese Weise k√∂nnen Sie bei der n√§chsten Basissicherung weniger Daten aufnehmen. Sie erstellen keine Kopie der Datenseiten, die sich gegen√ºber der vorherigen Sicherung nicht ge√§ndert haben. <br><br><img src="https://habrastorage.org/webt/dt/cn/ag/dtcnaglkk_z3i6rsm_hvs56m28o.jpeg"><br>  Beim Einrichten von WAL-G geben Sie die Anzahl der Schritte an, die am weitesten von der Basissicherung, der Delta-Sicherung, entfernt sind, und geben die Delta-Kopierrichtlinie an.  Entweder erstellen Sie eine Kopie des letzten vorhandenen Deltas oder Sie erstellen ein Delta aus der urspr√ºnglichen vollst√§ndigen Sicherung.  Dies ist erforderlich, wenn sich in Ihrer Datenbank immer dieselbe Datenbankkomponente √§ndert und sich dieselben Daten st√§ndig √§ndern. <br><br>  Warum brauchen wir grunds√§tzlich Delta-Kopien der Datenbank?  Theoretisch haben Sie eine WAL und k√∂nnen also √ºberall rollen. <br><br>  Auf einem ausgelasteten Server kann das Spielen der WAL von f√ºnf physischen Sekunden der Vergangenheit vier physische Sekunden der Gegenwart dauern.  Wenn Sie aufgefordert werden, die WAL in vier Tagen zu w√ºrfeln, bedeutet dies, dass die Person, die dies w√ºnscht, m√∂glicherweise weitere drei Tage warten sollte.  Nicht immer eine akzeptable Situation. <br><br>  Sie ben√∂tigen f√ºr jeden Tag Basissicherungen, k√∂nnen jedoch nicht 7 oder 14 vollst√§ndige Kopien Ihrer Datenbank dort speichern, obwohl WAL-G sie archiviert, sie ist jedoch immer noch recht gro√ü.  In diesem Fall helfen Delta-Kopien. <br><br><img src="https://habrastorage.org/webt/xw/aw/-l/xwaw-ll2y9911p6gjynx3dxhfb0.jpeg"><br>  Bei der Entwicklung von Delta-Kopien wurden mehrere m√∂gliche Datendateiformate diskutiert.  Zun√§chst wurde das Format vorgeschlagen. Wenn wir die Seite nicht verunsichern, machen wir sie einfach ung√ºltig.  Wir sind jedoch zu dem Schluss gekommen, dass dies kein sehr effektiver Weg ist. Die Nullen werden dann effektiv komprimiert. Wir haben diese Speichermethode jedoch abgelehnt, da es schwierig ist, sie in Notfallsituationen zu debuggen. <br><br><img src="https://habrastorage.org/webt/y1/cd/m-/y1cdm-xvhv7sq-4wt8e3y_xzaia.jpeg"><br>  Die n√§chste Technologie, die in Betracht gezogen wurde, besteht darin, zuerst die Blocknummer und dann den ge√§nderten Block zu speichern.  Hier sehen wir uns jedoch mit der Besonderheit der Speicherung in TAR-Dateien konfrontiert, dass wir zuerst die Gr√∂√üe der TAR-Dateien angeben m√ºssen, in denen wir unsere Delta-Kopie speichern, und dann mit der Aufzeichnung beginnen m√ºssen.  Ich wollte die Implementierung der Technologie mit einem Minimum an verbrauchtem RAM durchf√ºhren, also mussten wir das dritte Format verwenden, in dem wir zuerst jede Datendatei vollst√§ndig lesen, nach den ge√§nderten Datenseiten suchen, zuerst die Nummern der ge√§nderten Bl√∂cke in der TAR-Datei speichern und erst dann die ge√§nderten Bl√∂cke selbst. <br><br><img src="https://habrastorage.org/webt/ew/le/eo/ewleeouqovcrezeke5wv6nndmby.jpeg"><br><img src="https://habrastorage.org/webt/mj/qx/rg/mjqxrg9h-jhu0nlatbxarh1jaaw.jpeg"><br><br>  Diese Funktion wurde noch nicht implementiert.  Ich schaue sie an oder suche jemanden, der eine Pull-Anfrage in WAL-G stellen m√∂chte.  Bei der Wiederherstellung von einer Delta-Kopie √ºberlebt die Datenbank jede Reinkarnation der Datenbank bei jedem Schritt der Delta-Sicherung.  Manchmal werden mitten im Leben einige Dateien gel√∂scht.  Gleichzeitig m√ºssten wir uns keine Sorgen um ihren Zustand machen, wenn sie trotzdem gel√∂scht und dann aus der Delta-Kopie neu erstellt w√ºrden.  Dies scheint keine sehr komplizierte Funktion zu sein. Wenn Sie also etwas √ºber Go schreiben m√∂chten, schauen Sie sich diese Funktion an. <br><br><img src="https://habrastorage.org/webt/g3/fa/7d/g3fa7d6otwscpktvrov045nvmni.jpeg"><br>  Zeitplan f√ºr die Verwendung von Netzwerk, CPU und Festplatte.  Wie wir sehen k√∂nnen, ist das Backup bei WAL-E hier noch nicht beendet. Es begann um ein Uhr morgens in Moskau und endete nicht beim letzten Bericht, den wir sehen.  Der WAL-G-Zeitplan ist abgelaufen, er arbeitet schneller und ist sogar noch ressourcenschonender. <br><br>  Das Interessanteste ist das Diagramm des Ressourcenverbrauchs w√§hrend einer Delta-Kopie.  Wir sehen, dass alle Ressourcen fast Null geworden sind.  Die Belastung der CPU entspricht fast der Standardlast der Datenbank. Nachts werden einige Abfragen ausgef√ºhrt.  Wir sehen einen gro√üen Stift beim Lesen.  Ich besch√§ftige mich auch damit, ich w√ºrde auch gerne eine Anfrage ziehen oder ich werde es im Sommer selbst machen.  Das Fazit ist, dass wir unsere Daten noch lesen m√ºssen, um herauszufinden, was sich an ihnen ge√§ndert hat.  Dieses Lesen h√§tte vermieden werden k√∂nnen. <br><br><img src="https://habrastorage.org/webt/6g/bz/w7/6gbzw7p2zf7bbczdq3hnc-z1ni8.jpeg"><br><br>  In WAL-G wird gel√∂scht, wenn die Anzahl der Sicherungen oder das Datum angegeben wird, ab dem alle WALs und alle Basissicherungen gespeichert werden m√ºssen.  Und WAL-G besch√§ftigt sich bereits mit der Frage, welche WALs und Basissicherungen ben√∂tigt werden.  Bisher haben wir keine Funktionen, die alles l√∂schen w√ºrden.  In WAL-E ist dies auch ein Anlass f√ºr eine Pull-Anfrage.  Ein interessanter Befehl ALLES L√ñSCHEN wurde noch nicht implementiert. <br><br><img src="https://habrastorage.org/webt/5q/1t/aw/5q1tawrrz1gj-l4wu1igxubfd4q.jpeg"><br><br>  Es gibt eine Liste von Backups. <br><br><img src="https://habrastorage.org/webt/kq/gs/mw/kqgsmwqqiezwwifwb8puxmzlugm.jpeg"><br>  Wir legen die Umgebungsvariable fest, die f√ºr die Funktion von WAL-G erforderlich ist, und rufen das Konsolendienstprogramm WAL-G auf.  Die Backups, die wir anzeigen m√ºssen, werden angezeigt. <br><br><img src="https://habrastorage.org/webt/id/uv/rg/iduvrgdmb1nca0nbfcpvs0cxfc8.jpeg"><br>  WAL-G implementiert eine Vielzahl von Technologien zur Parallelisierung von Backups und allgemein verschiedenen Vorg√§ngen.  Diese Technologie wird beispielsweise verwendet, um ‚ÄûWellen‚Äú an das Archiv zu senden.  Sobald PostgreSQL archive_command aufruft, um eine Datei zu senden, pr√ºft WAL-G, ob weitere Dateien in der N√§he bereitstehen. <br><br>  Im Allgemeinen ist dies keine sehr dokumentierte Funktion, sie ist in den neuesten Versionen von PostgreSQL sehr stabil, viele Technologien verwenden sie.  Wir pr√ºfen, ob sich fertige WAL-Dateien im Archivstatus befinden, und senden sie zusammen mit der Datei, die die Datenbank an das Archiv senden soll.  Und wenn PostgreSQL sie zum Senden auffordert, haben wir sie bereits gesendet, wir sind bereit.  Dies beschleunigt das Senden von WALs auf geladenen Basen erheblich und erm√∂glicht es Ihnen, diese nicht als Single-Threaded zu erstellen.  Normalerweise bereitet PostgreSQL eine Datei vor, wartet dann darauf, dass sie abl√§uft, und bereitet die n√§chste vor.  Wir schaffen es, diese konsequente Arbeit zu vermeiden. <br><br><img src="https://habrastorage.org/webt/pc/3k/5f/pc3k5fkukjj7o5zqxm7hsjr3way.jpeg"><br>  W√§hrend WAL-FETCH, wenn der Cluster wiederhergestellt ist, versuchen wir auch, die folgenden N Dateien herunterzuladen, die ben√∂tigt werden, und versuchen, die Pausen zwischen den Starts der Voreinstellung neuer WAL-Dateien auszugleichen, damit wir alle Ressourcen, die wir haben, so weit wie m√∂glich nutzen k√∂nnen: entweder in das Netzwerk laufen oder in seltenen F√§llen auf eine Festplatte sto√üen. <br><br><img src="https://habrastorage.org/webt/pd/v2/mn/pdv2mnfn4_ne1jbp00nhl35n7y4.jpeg"><br>  Dies wird alles durch Umgebungsvariablen festgelegt. <br><br><img src="https://habrastorage.org/webt/oe/ro/k5/oerok5u-varh4b3rcwq4dgwarmm.jpeg"><br>  Es besteht auch die M√∂glichkeit, eine Kopie zu erstellen.  Obwohl diese Funktion in verschiedenen Versionen nicht vorhanden ist - A. B. wurde im Juni 2018 in Version 0.1.10 ver√∂ffentlicht -, k√∂nnen Sie aufgrund der Parallelit√§t des Lesens von der Festplatte garantiert entweder auf ein Netzwerk oder eine Festplatte zugreifen.  Dies ist bei einer geladenen Datenbank nicht sehr gut.  WAL-E hatte eine Funktion, die das Drosseln erm√∂glichte.  Bisher haben wir das nicht.  Es ist notwendig, die Geschwindigkeit des Entfernens von Backups zu begrenzen, damit die Basis ihr eigenes Leben f√ºhren und die Last bedienen kann. <br><br>  Unser Hauptmerkmal ist nicht wirklich Technologie. <br><br>  Vor zwei Jahren hat Zhenya Dyukov die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Delta-Backup-Technologie</a> f√ºr Barman implementiert. Sie wurde noch nicht durchgef√ºhrt, die Community diskutiert immer noch dar√ºber. <br><br>  Vor fast einem Jahr hat Zhenya den WAL-E-Fehler behoben und wir haben ihn sechs Monate lang gesendet ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link zu GitHub</a> - ca. Ed.).  Sehr oft gibt es bei Open Source-L√∂sungen ein Problem mit der Tatsache, dass sie nicht sehr gut gewartet werden. <br><br><img src="https://habrastorage.org/webt/jy/hg/mf/jyhgmfxdz_srayrm8vsxdnq-a3q.jpeg"><br>  Mit WAL-G ist alles ganz einfach: Wir verwenden es und ich pflege es.  Wenn wir oder Sie etwas brauchen, melden Sie einfach, dass Sie ein Problem haben.  Wir werden versuchen, es zu l√∂sen. <br><br>  Die Standardanfrage der Community ist einfach: "Lass es uns am meisten tun." <br><br>  Mehr Kryptographie, mehr Plattformen.  Vielleicht nicht nur PostgreSQL, sondern auch MySQL noch Backup oder etwas anderes?  Ich sehe noch ein paar andere Dinge. <br><br><img src="https://habrastorage.org/webt/yi/sg/ck/yisgckbaa1bhbae-ixrx_u-fetm.jpeg"><br>  Zun√§chst konnten wir beim Senden der ‚ÄûWelle‚Äú verstehen, welche Datenbankbl√∂cke sich ge√§ndert haben, diese WAL-Dateien scannen und Informationen dar√ºber speichern, was sich ge√§ndert hat. <br><br>  Und wenn cron mit einem anderen Delta-Backup ankommt, konnten wir nicht die gesamte Datenbank scannen, den Zahn des Festplattenlesens ablegen und nur wissen, welche Seiten wir in die Cloud ziehen m√ºssen. <br><br>  Wir haben versucht, die Page-Track-Technologie zu verwenden.  Es implementiert die Verfolgung von Seiten√§nderungen auf der Ebene des Datenbankkerns.  Backup wird sehr schnell entfernt.  Das Hauptproblem bei PTRACK ist, dass es sehr invasiv ist.  Es enth√§lt viele √Ñnderungen im PostgreSQL-Kern an sehr sensiblen Stellen, so dass es unwahrscheinlich ist, dass es bald √ºbernommen wird. <br><br><img src="https://habrastorage.org/webt/4z/ea/px/4zeapxt_ji4odqmc57wnjpxilik.jpeg"><br>  Au√üerdem unterscheiden sich seine Deltas geringf√ºgig von den Deltas, die wir jetzt haben.  Beim Entfernen des LSN-basierten Deltas werden alle √Ñnderungen in der Delta-Datei entfernt, die vom vorherigen Start bis zur aktuellen Zeit aufgetreten sind. <br><br><img src="https://habrastorage.org/webt/ul/oh/pi/ulohpi0sz8mtyz5g018fxactms8.jpeg"><br>  Im Fall von PTRACK erhalten wir √Ñnderungen in der Delta-Datei, beginnend mit dem zuvor empfangenen Delta.  Wir haben nicht die genaue Deltazeit vor dem Start der Sicherung, vor dem Beginn der √Ñnderungen.  Dies ist nicht das Hauptproblem von PTRACK, im Allgemeinen funktioniert es gut, aber bisher ist es schwer zu akzeptieren. <br><br><img src="https://habrastorage.org/webt/9-/qv/ou/9-qvouutaphuo35-ag0q_w1nnww.jpeg"><br>  PTRACK erlaubt keine Delta-Entfernung im LATEST_FULL-Modus, da eine Karte mit ge√§nderten Bl√∂cken aus der vorherigen Entfernung dieser Karte gespeichert wird.  Oracle hat eine interessante Technologie, es gibt 8 vorherige Karten, die sie f√ºr alle F√§lle speichern.  Vielleicht k√∂nnten wir etwas √Ñhnliches tun, aber bisher arbeiten wir nicht in diese Richtung. <br><br><img src="https://habrastorage.org/webt/bx/do/z-/bxdoz-i2yzsnya6y6kzqbc30e3y.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link von der Folie</a></sup></sub> </h5><br>  Im September letzten Jahres habe ich versucht, der Community eine Technologie anzubieten, die auf der Tatsache basiert, dass wir nur die erforderlichen Hooks zum Kernel hinzuf√ºgen und das Tracking f√ºr ge√§nderte Seiten in Erweiterung implementieren, damit der Seitenverfolgungs-Patch nicht zu invasiv ist.  Nachdem wir diese Technologie besprochen hatten, kamen wir zu dem Schluss, dass wir mehrere Prototypen ben√∂tigen, und wir werden Haken hinzuf√ºgen, wenn es Prototypen gibt.  Vielleicht werden wir sehen, wie sie funktionieren.  Ich arbeite derzeit an Prototypen dieser Erweiterungen, die Kernel-Hooks verwenden k√∂nnten, um Datenbank√§nderungen zu verfolgen. <br><br>  In der Community gibt es den Ausdruck, dass jeder Postgresista sein eigenes Backup-Tool haben muss.  Das ist schlecht.  Jeder macht sein eigenes Ding, das gesch√§ftskritische Aufgaben erledigt.  Es muss eine Sache geben, in der alles in der Box sein wird, alles wird in einer idealen Welt perfekt sein. <br><br>  Was m√∂chte ich in einer Box in Basebackup sehen?  Wir m√∂chten wahrscheinlich sehen, dass in der Cloud archiviert wird.  Und Delta-Kopien. <br><br><img src="https://habrastorage.org/webt/6w/ea/zh/6weazhzi3fkxbhvzz2tlrdj4ujg.jpeg"><br>  Ich m√∂chte auch Komprimierung, Parallelit√§t, Verschl√ºsselung, Drosselung, Auflistung von Sicherungen, √úberpr√ºfung, Validierung von Sicherungen ... Viele Dinge.  Wir verstehen, dass wenn all dies jetzt der Community angeboten wird, dies zu mehreren Dutzend Patches f√ºhren wird, die durch Commitfest nur schwer zu diskutieren und zu implementieren sind.  Daher verwenden wir jetzt immer noch ein separates Tool, aber es besteht der Wunsch, der Community Zeit und Technologie zu widmen, um PostgreSQL besser zu machen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de415817/">https://habr.com/ru/post/de415817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de415805/index.html">Modifikation des Doorhan GSM Barrier Moduls zur Internetsteuerung</a></li>
<li><a href="../de415809/index.html">Verwendung von Soja, Requirejs und Backbone-Js in Plugins f√ºr Atlassian Jira</a></li>
<li><a href="../de415811/index.html">KI, praktischer Kurs. √úbersicht √ºber neuronale Netze zur Bildklassifizierung</a></li>
<li><a href="../de415813/index.html">Einige Hinweise zum aktuellen Status von Cloud Gaming</a></li>
<li><a href="../de415815/index.html">An der Spitze der Wissenschaft: eine Analyse der Artikel von arxiv.org</a></li>
<li><a href="../de415819/index.html">Bericht des Club of Rome 2018, Kapitel 3.16: Globale Regierung</a></li>
<li><a href="../de415821/index.html">Der Weg, um ein "intelligentes" Haus mit einer m√∂glichst breiten elektrischen Steuerung zu organisieren</a></li>
<li><a href="../de415823/index.html">FindFace schlie√üt f√ºr blo√üe Sterbliche</a></li>
<li><a href="../de415829/index.html">Einf√ºhrung in Datenklassen</a></li>
<li><a href="../de415831/index.html">Die neuen zehn Gebote des Roskosmos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>