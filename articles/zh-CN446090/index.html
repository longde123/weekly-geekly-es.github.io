<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜´ ğŸ–•ğŸ¼ âœŒï¸ GSM + GPSæ¨¡å—A9Gä¸Šçš„Micropython âœï¸ ğŸ‘¨ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ§‘ğŸ¼â€ğŸ¤â€ğŸ§‘ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¿™æ¬¡ï¼Œæˆ‘è€ƒè™‘è¿‡å°†GPSè¿½è¸ªå™¨è—åœ¨è‡ªè¡Œè½¦ä¸­ä½œä¸ºé¢„é˜²æªæ–½ã€‚ å¸‚åœºä¸Šæœ‰è®¸å¤šç”¨äºè·Ÿè¸ªæ±½è½¦ï¼Œè´§ç‰©ï¼Œè‡ªè¡Œè½¦ï¼Œè¡Œæï¼Œå„¿ç«¥å’ŒåŠ¨ç‰©çš„è‡ªåŠ¨è£…ç½®ã€‚ ä»–ä»¬ä¸­çš„ç»å¤§å¤šæ•°é€šè¿‡çŸ­ä¿¡ä¸ç”¨æˆ·äº’åŠ¨ã€‚ æ›´æ˜‚è´µçš„é€‰é¡¹æä¾›â€œæŸ¥æ‰¾æˆ‘çš„ç”µè¯â€åŠŸèƒ½ï¼Œä½†ä¸ç‰¹å®šçš„åœ¨çº¿æœåŠ¡ç›¸å…³ã€‚ 
 ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘æƒ³å®Œå…¨æ§åˆ¶è·Ÿè¸ªå™¨ï¼šåœ¨æ²¡æœ‰SMSå’Œæ³¨å†Œçš„ä¾¿æ·æ¨¡å¼ä¸‹ä½¿ç”¨å®ƒ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GSM + GPSæ¨¡å—A9Gä¸Šçš„Micropython</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446090/"><p> è¿™æ¬¡ï¼Œæˆ‘è€ƒè™‘è¿‡å°†GPSè¿½è¸ªå™¨è—åœ¨è‡ªè¡Œè½¦ä¸­ä½œä¸ºé¢„é˜²æªæ–½ã€‚ å¸‚åœºä¸Šæœ‰è®¸å¤šç”¨äºè·Ÿè¸ªæ±½è½¦ï¼Œè´§ç‰©ï¼Œè‡ªè¡Œè½¦ï¼Œè¡Œæï¼Œå„¿ç«¥å’ŒåŠ¨ç‰©çš„è‡ªåŠ¨è£…ç½®ã€‚ ä»–ä»¬ä¸­çš„ç»å¤§å¤šæ•°é€šè¿‡çŸ­ä¿¡ä¸ç”¨æˆ·äº’åŠ¨ã€‚ æ›´æ˜‚è´µçš„é€‰é¡¹æä¾›â€œæŸ¥æ‰¾æˆ‘çš„ç”µè¯â€åŠŸèƒ½ï¼Œä½†ä¸ç‰¹å®šçš„åœ¨çº¿æœåŠ¡ç›¸å…³ã€‚ <br> ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘æƒ³å®Œå…¨æ§åˆ¶è·Ÿè¸ªå™¨ï¼šåœ¨æ²¡æœ‰SMSå’Œæ³¨å†Œçš„ä¾¿æ·æ¨¡å¼ä¸‹ä½¿ç”¨å®ƒã€‚ è‚¤æµ…çš„Googleç»™æˆ‘å¸¦æ¥äº†å‡ ä¸ªæ¥è‡ªä¸­å›½çš„æ¨¡å—ï¼Œæˆ‘è®¢è´­äº†å…¶ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼ˆA9Gå¸ƒä¸æ¿ï¼‰ï¼ˆã€œ15ç¾å…ƒï¼‰ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f7f/b34/fe0/f7fb34fe016bb3a6c532712b9b2e75e1.png" alt="æ¨¡ç»„"></p><br><p> æœ¬æ–‡æ˜¯å…³äºæˆ‘å¦‚ä½•ä½¿pythonåœ¨æ­¤æ¨¡å—ä¸Šå·¥ä½œçš„ã€‚ </p><a name="habracut"></a><br><p> å¦‚æœA9Gæ˜¯ESPçš„ç±»ä¼¼ç‰©ï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼Œåˆ¶é€ å•†æ˜¯ç›¸åŒçš„ï¼‰ï¼Œé‚£ä¹ˆå¸ƒä¸æ¿æœ¬èº«å°±æ˜¯NodeMCUæ¿çš„ç±»ä¼¼ç‰©ï¼Œåªæ˜¯å¸ƒä¸æ¿æ²¡æœ‰å†…ç½®çš„USB-UARTè½¬æ¢å™¨ã€‚ ä½†æ˜¯è¿˜æœ‰è®¸å¤šå…¶ä»–æœ‰è¶£çš„äº‹æƒ…ã€‚  <a href="">åˆ¶é€ å•†</a>è§„æ ¼ï¼š </p><br><ul><li>  32ä½æ ¸å¿ƒï¼ˆRISCï¼‰ï¼Œæœ€é«˜312MHz </li><li>  29ä¸ªGPIOï¼ˆå‡å·²ç„Šæ¥ï¼Œæ‰€æœ‰æ¥å£å‡åŒ…å«åœ¨æ­¤ç¼–å·ä¸­ï¼‰ </li><li> æ‰‹è¡¨å’Œçœ‹é—¨ç‹— </li><li>  1ä¸ªUSB 1.1æ¥å£ï¼ˆæˆ‘åœ¨é‚£é‡Œæ‰¾ä¸åˆ°ï¼Œä½†æ˜¯å¯ä»¥ä»å¼‚åœ°å¤åˆ¶ï¼‰å’ŒmicroUSBä¾›ç”µ </li><li>  2ä¸ªUARTï¼ˆ+1æœåŠ¡ï¼‰ </li><li>  2x SPIï¼ˆæœªå°è¯•ï¼‰ </li><li>  3x I2Cï¼ˆæœªå°è¯•ï¼‰ </li><li>  1ä¸ªSDMMCï¼ˆå¸¦æœ‰ç‰©ç†æ’æ§½ï¼‰ </li><li>  2ä¸ªæ¨¡æ‹Ÿè¾“å…¥ï¼ˆ10ä½ï¼Œé”‚ç”µæ± æ§åˆ¶å™¨å¯èƒ½ä½¿ç”¨å…¶ä¸­ä¹‹ä¸€ï¼‰ </li><li>  4Mbé—ªå­˜ </li><li>  4Mb PSRAM </li><li>  ADCï¼ˆéº¦å…‹é£ï¼Œç‰©ç†å­˜åœ¨äºæ¿ä¸Šï¼‰å’ŒDACï¼ˆæ‰¬å£°å™¨ï¼Œä¸å­˜åœ¨ï¼‰ </li><li> ç”µæ± å……ç”µæ§åˆ¶å™¨ï¼ˆæœ¬èº«æ²¡æœ‰ç”µæ± ï¼‰ </li><li> å®é™…ä¸Šï¼Œå¸¦æœ‰SMSï¼Œè¯­éŸ³å’ŒGPRSçš„GSMï¼ˆ800ã€900ã€1800ã€1900 MHzï¼‰ </li><li>  GPSé€šè¿‡UART2è¿æ¥ï¼ˆæ²¡æœ‰â€œ A9â€æ¨¡å—ï¼‰ </li><li>  SIMå¡æ’æ§½ï¼ˆnanoSIMï¼‰ </li><li> ä¸¤ä¸ªæŒ‰é’®ï¼ˆä¸€ä¸ªå¤ä½ï¼Œå¦ä¸€ä¸ª-åŒ…å«å’Œå¯ç¼–ç¨‹åŠŸèƒ½ï¼‰ </li><li> ä¸¤ä¸ªLED </li></ul><br><p> å·¥ä½œç”µå‹ä¸º3.3Vï¼Œè¾“å…¥ç”µå‹ä¸º5-3.8Vï¼ˆå–å†³äºè¿æ¥ï¼‰ã€‚ é€šå¸¸ï¼Œè¯¥æ¨¡å—å…·æœ‰æ‰€æœ‰å¿…éœ€çš„ç¡¬ä»¶ï¼Œä»¥ä¾¿æ ¹æ®å…¶ç»„è£…ç®€å•çš„æŒ‰é’®å¼ç§»åŠ¨è®¾å¤‡ã€‚ ä½†æ˜¯ä»è¿™äº›ä¾‹å­ä¸­ï¼Œä¼¼ä¹ä¸­å›½äººæ­£åœ¨ä»è€è™æœºæˆ–è€è™æœºæˆ–ç±»ä¼¼çš„ä¸œè¥¿ä¸Šè´­ä¹°å®ƒæ¥å‡ºå”®ã€‚ è¯¥æ¨¡å—çš„æ›¿ä»£å“æ˜¯ç›¸å½“æµè¡Œçš„SIM800æ¨¡å—ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¯¥æ¨¡å—åœ¨å…¬å…±é¢†åŸŸä¸­æ²¡æœ‰SDKï¼ˆå³ï¼Œè¿™äº›æ¨¡å—ä½œä¸ºATè°ƒåˆ¶è§£è°ƒå™¨å‡ºå”®ï¼‰ã€‚ </p><br><h1> å¼€å‘åŒ… </h1><br><p>è¯¥æ¨¡å—éšé™„äº†ä»¤äººæ»¡æ„çš„è‹±è¯­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SDK</a> ã€‚ åœ¨Ubuntuä¸‹å®‰è£…ï¼Œä½†æ˜¯Windowså’Œå®¹å™¨æ˜¯é¦–é€‰ã€‚ ä¸€åˆ‡éƒ½å¯ä»¥é€šè¿‡åœ¨GUIä¸­æˆ³æ¥å®Œæˆï¼šæ­¤æ¨¡å—çš„ESPtoolå°šæœªè¿˜åŸã€‚ å›ºä»¶æœ¬èº«ç”±Makefileæ„å»ºã€‚ å­˜åœ¨è°ƒè¯•å™¨ï¼šå†»ç»“ä¹‹å‰ï¼Œæ¨¡å—å°†å †æ ˆè·Ÿè¸ªæŠ›å‡ºåˆ°æœåŠ¡ç«¯å£ä¸­ã€‚ ä½†å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘æ— æ³•å°†åœ°å€è½¬æ¢ä¸ºä»£ç è¡Œï¼ˆgdbæŠ¥å‘Šè¯¥åœ°å€ä¸ä»»ä½•å†…å®¹éƒ½ä¸å¯¹åº”ï¼‰ã€‚ å¯èƒ½æ˜¯ç”±äºå¯¹Linuxè¿™æ ·çš„æ”¯æŒä¸ä½³æ‰€è‡´ã€‚ å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³ä¿®æ”¹æ¨¡å—-å°è¯•åœ¨Windowsä¸‹è¿›è¡Œï¼ˆå¹¶åœ¨githubä¸Šé€€è®¢ï¼‰ã€‚ å¦åˆ™ï¼Œè¿™æ˜¯Linuxçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯´æ˜</a> ã€‚ å®‰è£…åï¼Œæ‚¨éœ€è¦æ£€æŸ¥.bashrcä¸­è·¯å¾„çš„æ­£ç¡®æ€§ï¼Œå¹¶åˆ é™¤ï¼ˆé‡å‘½åï¼‰æ‰€æœ‰<code>CSDTK/lib/libQt*</code> ï¼šå¦åˆ™ï¼Œç”±äºå¯èƒ½ä¸å·²å®‰è£…çš„libQtå‘ç”Ÿå†²çªï¼Œåˆ·æ–°ç¨‹åºï¼ˆå³è°ƒè¯•å™¨ï¼‰å°†æ— æ³•å¯åŠ¨ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7a7/955/5bc/7a79555bca02e1ad6363b8da9559c91e.png" alt="é—ªå…‰å™¨"></p><br><p> é—ªå…‰ç¯ä¸Šæœ‰ä¸€æ¡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŒ‡ç¤º</a> ã€‚ </p><br><h1> è¿æ¥æ–¹å¼ </h1><br><p> ä¸€åˆ‡éƒ½æ¯”åœ¨NodeMCUä¸Šå¤æ‚ã€‚ è¿™äº›æ¨¡å—çœ‹èµ·æ¥å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯å¸ƒä¸æ¿ä¸Šæ²¡æœ‰USB-TTYèŠ¯ç‰‡ï¼ŒmicroUSBä»…ç”¨äºä¾›ç”µã€‚ å› æ­¤ï¼Œæ‚¨å°†éœ€è¦3.3Vçš„USB-TTYã€‚ ä¸¤ç§æ¯”è¾ƒå¥½ï¼šä¸€ç§ç”¨äºè°ƒè¯•ç«¯å£ï¼Œä¸€ç§ç”¨äºUART1ï¼šç¬¬ä¸€ç§ç”¨äºä¸Šä¼ å›ºä»¶ï¼Œç¬¬äºŒç§å¯ä»¥ç”¨ä½œå¸¸è§„ç»ˆç«¯ã€‚ ä¸ºäº†ä¸å°†æ‰€æœ‰è¿™äº›é¼»æ¶•æ‹–åˆ°è®¡ç®—æœºä¸Šï¼Œæˆ‘è¿˜è´­ä¹°äº†å¸¦ä¸¤ç±³ç”µç¼†å’Œå¤–éƒ¨ç”µæºçš„4ç«¯å£USBåˆ†é…å™¨ï¼ˆå¿…éœ€ï¼‰ã€‚ è¯¥å¥—ä»¶ä¸æ¨¡å—æœ¬èº«çš„æ€»æˆæœ¬ä¸º25-30ç¾å…ƒï¼ˆä¸å¸¦ç”µæºï¼šå¯é€šè¿‡ç”µè¯ä½¿ç”¨ï¼‰ã€‚ </p><br><h1> éŸ§ä½“ </h1><br><p> è¯¥æ¨¡å—éšé™„ATå›ºä»¶ï¼šæ‚¨å¯ä»¥è¿æ¥åˆ°3.3V arduinoï¼Œå¹¶é€šè¿‡UART1å°†å…¶ç”¨ä½œè°ƒåˆ¶è§£è°ƒå™¨ã€‚ ä»–ä»¬çš„å›ºä»¶ä½¿ç”¨Cè¯­è¨€ç¼–å†™ã€‚makeåˆ›å»ºäº†ä¸¤ä¸ªå›ºä»¶æ–‡ä»¶ï¼šä¸€ä¸ªç¼åˆ¶äº†å¤§çº¦ä¸€åˆ†é’Ÿï¼Œå¦ä¸€ä¸ªç¼åˆ¶å¾—è¶³å¤Ÿå¿«ã€‚ åªèƒ½ç¼åˆ¶ä»¥ä¸‹æ–‡ä»¶ä¸­çš„ä¸€ä¸ªï¼šç¬¬ä¸€æ¬¡è¾ƒå¤§ï¼Œä»¥åè¾ƒå°ã€‚ æ€»çš„æ¥è¯´ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘åœ¨æ¡Œé¢ä¸Šæ‰“å¼€äº†ä¸­æ–‡SDKï¼ˆ <code>coolwatcher</code> ï¼‰ï¼Œç”¨äºç®¡ç†æ¨¡å—ï¼Œminitermï¼ˆä½œä¸ºstdioå’Œä»£ç ç¼–è¾‘å™¨ï¼‰ã€‚ </p><br><h1>  API </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">API</a>çš„å†…å®¹åæ˜ äº†ä¸Šé¢çš„åˆ—è¡¨ï¼Œç±»ä¼¼äºESP8266çš„æ—©æœŸç‰ˆæœ¬ï¼šæˆ‘èŠ±äº†å¤§çº¦3ä¸ªå°æ—¶æ¥å¯åŠ¨HelloWorldã€‚ ä¸å¹¸çš„æ˜¯ï¼Œç”¨æˆ·å¯ç”¨çš„åŠŸèƒ½é›†éå¸¸æœ‰é™ï¼šä¾‹å¦‚ï¼Œæ— æ³•è®¿é—®SIMå¡ä¸Šçš„ç”µè¯ç°¿ï¼Œæœ‰å…³è¿æ¥åˆ°èœ‚çªç½‘ç»œçš„ä½çº§ä¿¡æ¯ç­‰ç­‰ã€‚  APIæ–‡æ¡£ç”šè‡³è¿˜ä¸å¤Ÿå®Œå–„ï¼Œå› æ­¤æ‚¨å¿…é¡»ä¾é ç¤ºä¾‹ï¼ˆå…¶ä¸­æœ‰ä¸¤ä¸ªæ‰“æ ·ï¼‰å¹¶åŒ…å«æ–‡ä»¶ã€‚ ä¸è¿‡ï¼Œè¯¥æ¨¡å—å¯ä»¥å®Œæˆè®¸å¤šå·¥ä½œï¼Œç›´è‡³SSLè¿æ¥ï¼šæ˜¾ç„¶ï¼Œåˆ¶é€ å•†ä¸“æ³¨äºæœ€ä¼˜å…ˆçš„åŠŸèƒ½ã€‚ </p><br><p> ä½†æ˜¯ï¼Œå¿…é¡»å–œæ¬¢é€šè¿‡ä¸­æ–‡APIè¿›è¡Œä¸­æ–‡å¾®æ§åˆ¶å™¨çš„ç¼–ç¨‹ã€‚ å¯¹äºå…¶ä»–æ‰€æœ‰äººï¼Œåˆ¶é€ å•†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¼€å§‹å°†</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">micropythonç§»æ¤</a>åˆ°æ­¤æ¨¡å—ã€‚ æˆ‘å†³å®šå°è¯•ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå¹¶ç»§ç»­è¿›è¡Œè¿™é¡¹å‡ºè‰²çš„å·¥ä½œï¼ˆæœ¬æ–‡ç»“å°¾å¤„çš„é“¾æ¥ï¼‰ã€‚ </p><br><h1> å¾®å‹èŸ’è›‡ </h1><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9a1/b46/e00/9a1b46e00d290db2f478ebb54f7d9e74.jpg" alt="å¾½æ ‡"></p><br><p>  Micropythonæ˜¯ä¸€ä¸ªå°†cPythonç§»æ¤åˆ°å¾®æ§åˆ¶å™¨çš„å¼€æºé¡¹ç›®ã€‚ å¼€å‘æ˜¯ä»ä¸¤ä¸ªæ–¹å‘è¿›è¡Œçš„ã€‚ é¦–å…ˆæ˜¯å¯¹æ‰€æœ‰å¾®æ§åˆ¶å™¨é€šç”¨çš„æ ¸å¿ƒåº“çš„æ”¯æŒå’Œå¼€å‘ï¼Œè¿™äº›åº“æè¿°äº†å¦‚ä½•ä½¿ç”¨pythonä¸­çš„ä¸»è¦æ•°æ®ç±»å‹ï¼šå¯¹è±¡ï¼Œå‡½æ•°ï¼Œç±»ï¼Œå­—ç¬¦ä¸²ï¼ŒåŸå­ç±»å‹ç­‰ã€‚ ç¬¬äºŒä¸ªå®é™…ä¸Šæ˜¯ç«¯å£ï¼šå¯¹äºæ¯ä¸ªå¾®æ§åˆ¶å™¨ï¼Œæœ‰å¿…è¦â€œæ•™â€è¯¥åº“ä»¥ä½¿ç”¨UARTè¿›è¡Œè¾“å…¥è¾“å‡ºï¼Œä¸ºè™šæ‹Ÿæœºé€‰æ‹©å †æ ˆï¼ŒæŒ‡å®šä¸€ç»„ä¼˜åŒ–ã€‚ å¯é€‰åœ°ï¼Œæè¿°äº†ä¸ç¡¬ä»¶ä¸€èµ·ä½¿ç”¨ï¼šGPIOï¼Œç”µæºï¼Œæ— çº¿ï¼Œæ–‡ä»¶ç³»ç»Ÿã€‚ <br> æ‰€æœ‰è¿™äº›éƒ½æ˜¯ç”¨å¸¦æœ‰å®çš„çº¯Cè¯­è¨€ç¼–å†™çš„ï¼šmicropythonæœ‰ä¸€ç»„å»ºè®®çš„é…æ–¹ï¼Œä»åœ¨ROMä¸­å£°æ˜å­—ç¬¦ä¸²åˆ°ç¼–å†™æ¨¡å—ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å®Œå…¨æ”¯æŒpythonè‡ªå†™æ¨¡å—ï¼ˆä¸»è¦æ˜¯ä¸è¦å¿˜è®°å†…å­˜å¤§å°ï¼‰ã€‚ è¯¥é¡¹ç›®çš„ç­–å±•äºº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†å‘å¸ƒdzhanga</a> ï¼ˆå¸¦æœ‰é¢åŒ…çš„å›¾ç‰‡ï¼‰çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœºä¼š</a>ä½œä¸ºä»–ä»¬çš„ç›®æ ‡ã€‚ ä½œä¸ºå¹¿å‘Šï¼šè¯¥é¡¹ç›®ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pyboard</a>å­¦ç”Ÿå‡ºå”®è‡ªå·±çš„å¼€å‘æ¿ï¼Œä½†ESP8266å’ŒESP32æ¨¡å—çš„ç«¯å£ä¹Ÿå¾ˆå—æ¬¢è¿ã€‚ </p><br><p> å‡†å¤‡å¥½å›ºä»¶å¹¶ä¸Šè½½å-æ‚¨åªéœ€é€šè¿‡UARTè¿æ¥åˆ°å¾®æ§åˆ¶å™¨ï¼Œç„¶åè¿›å…¥Python REPLã€‚ </p><br><pre> <code class="bash hljs">$ miniterm.py /dev/ttyUSB1 115200 --raw MicroPython cd2f742 on 2017-11-29; unicorn with Cortex-M3 Type <span class="hljs-string"><span class="hljs-string">"help()"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information. &gt;&gt;&gt; <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"hello"</span></span>) hello</code> </pre> <br><p> ä¹‹åï¼Œæ‚¨å¯ä»¥å¼€å§‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨å‡ ä¹æ™®é€šçš„python3</a>ç¼–å†™ä»£ç <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼Œ</a>è€Œä¸å¿…æ‹…å¿ƒå†…å­˜é™åˆ¶ã€‚ </p><br><p>  A9Gæ¨¡å—ä¸å—å®˜æ–¹æ”¯æŒï¼ˆ <code>micropython/ports</code>æä¾›äº†å®˜æ–¹æ”¯æŒçš„æ¨¡å—åˆ—è¡¨ï¼Œå…¶ä¸­å¤§çº¦æœ‰åäºŒä¸ªï¼‰ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œé’¢é“åˆ¶é€ å•†åˆ†å‰äº†micropythonå¹¶ä¸ºA9Gç«¯å£åˆ›å»ºäº†ç¯å¢ƒï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>micropython/ports/gprs_a9</code></a> ï¼Œä¸ºæ­¤ï¼Œä»–è¡¨ç¤ºäº†å¾ˆå¤šè°¢æ„ã€‚ å½“æˆ‘å¯¹è¿™ä¸ªé—®é¢˜æ„Ÿå…´è¶£æ—¶ï¼Œè¯¥ç«¯å£å·²æˆåŠŸç¼–è¯‘ï¼Œå¾®æ§åˆ¶å™¨å‘æˆ‘è‡´æ•¬REPLã€‚ ä½†æ˜¯ï¼Œä¸å¹¸çš„æ˜¯ï¼Œåœ¨ç¬¬ä¸‰æ–¹æ¨¡å—ä¸­ï¼Œåªèƒ½ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå’ŒGPIOï¼šæ²¡æœ‰ä¸æ— çº¿ç½‘ç»œå’ŒGPSç›¸å…³çš„å†…å®¹ã€‚ æˆ‘å†³å®šä¿®å¤æ­¤ç¼ºé™·ï¼Œå¹¶ä¸ºè‡ªå·±è®¾å®šäº†ç§»æ¤GPSè·Ÿè¸ªå™¨æ‰€éœ€çš„æ‰€æœ‰åŠŸèƒ½çš„ç›®æ ‡ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯¥</a>æ¡ˆä¾‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„å®˜æ–¹æ–‡æ¡£</a>è¿‡äºç®€æ´ï¼šå› æ­¤ï¼Œæˆ‘ä¸å¾—ä¸åœ¨ä»£ç ä¸­å››å¤„å¼ æœ›ã€‚ </p><br><h2> ä»å“ªé‡Œå¼€å§‹ </h2><br><p> é¦–å…ˆï¼Œè½¬åˆ°<code>micropython/ports</code>ç„¶åå°†<code>micropython/ports/minimal</code>å¤åˆ¶åˆ°ç«¯å£å°†ä½äºçš„æ–°æ–‡ä»¶å¤¹ä¸­ã€‚ ç„¶åï¼Œä¸ºæ‚¨çš„å¹³å°ç¼–è¾‘<code>main.c</code> è¯·è®°ä½ï¼Œæ‰€æœ‰å¥½åƒçš„ä¸œè¥¿éƒ½åœ¨<code>main</code>å‡½æ•°ä¸­ï¼Œæ‚¨éœ€è¦åœ¨å…¶ä¸­è°ƒç”¨<code>mp_init()</code>åˆå§‹åŒ–å™¨ï¼Œä¹‹å‰å·²<code>mp_init()</code>å‡†å¤‡äº†å¾®æ§åˆ¶å™¨å’Œå †æ ˆè®¾ç½®ã€‚ ç„¶åï¼Œå¯¹äºäº‹ä»¶é©±åŠ¨çš„APIï¼Œæ‚¨éœ€è¦è°ƒç”¨<code>pyexec_event_repl_init()</code>å¹¶å°†é€šè¿‡UARTè¾“å…¥çš„å­—ç¬¦æä¾›ç»™<code>pyexec_event_repl_process_char(char)</code>å‡½æ•°ã€‚ è¿™å°†é€šè¿‡REPLæä¾›äº’æ“ä½œæ€§ã€‚ ç¬¬äºŒä¸ªæ–‡ä»¶æ˜¯<code>micropython/ports/minimal/uart_core.c</code>æè¿°äº†é˜»æ­¢UARTä¸­çš„è¾“å…¥å’Œè¾“å‡ºã€‚ æˆ‘ä¸ºé‚£äº›æ‡’æƒ°çš„äººå¸¦æ¥äº†STM32çš„åŸå§‹ä»£ç ã€‚ </p><br><p> <code>main.c</code> </p> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **argv)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_dummy; stack_top = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)&amp;stack_dummy; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> MICROPY_ENABLE_GC gc_init(heap, heap + sizeof(heap)); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> mp_init(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> MICROPY_ENABLE_COMPILER #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> MICROPY_REPL_EVENT_DRIVEN pyexec_event_repl_init(); for (;;) { int c = mp_hal_stdin_rx_chr(); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (pyexec_event_repl_process_char(c)) { break; } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> pyexec_friendly_repl(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//do_str("print('hello world!', list(x+1 for x in range(10)), end='eol\\n')", MP_PARSE_SINGLE_INPUT); //do_str("for i in range(10):\r\n print(i)", MP_PARSE_FILE_INPUT); #else pyexec_frozen_module("frozentest.py"); #endif mp_deinit(); return 0; }</span></span></span></span></code> </pre> <br><p> <code>uart_core.c</code> </p> <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Receive single character int mp_hal_stdin_rx_chr(void) { unsigned char c = 0; #if MICROPY_MIN_USE_STDOUT int r = read(0, &amp;c, 1); (void)r; #elif MICROPY_MIN_USE_STM32_MCU // wait for RXNE while ((USART1-&gt;SR &amp; (1 &lt;&lt; 5)) == 0) { } c = USART1-&gt;DR; #endif return c; } // Send string of given length void mp_hal_stdout_tx_strn(const char *str, mp_uint_t len) { #if MICROPY_MIN_USE_STDOUT int r = write(1, str, len); (void)r; #elif MICROPY_MIN_USE_STM32_MCU while (len--) { // wait for TXE while ((USART1-&gt;SR &amp; (1 &lt;&lt; 7)) == 0) { } USART1-&gt;DR = *str++; } #endif }</span></span></code> </pre> <br><p> ä¹‹åï¼Œæ‚¨éœ€è¦ä½¿ç”¨åˆ¶é€ å•†çš„å»ºè®®/ç¼–è¯‘å™¨é‡å†™Makefileï¼šæ­¤å¤„çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯å•ç‹¬çš„ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ä¸€åˆ‡éƒ½åº”è¯¥è¶³å¤Ÿï¼šæˆ‘ä»¬æ”¶é›†ï¼Œå¡«å†™å›ºä»¶ï¼Œç„¶ååœ¨UARTä¸­æŸ¥çœ‹REPLã€‚ <br> æ¢å¤<code>micropython</code>æ‚¨éœ€è¦ç…§é¡¾å¥½å®ƒçš„å¥åº·ï¼šè®¾ç½®åƒåœ¾æ”¶é›†å™¨ï¼Œå¯¹Ctrl-Dçš„æ­£ç¡®ååº”ï¼ˆè½¯å¤ä½ï¼‰ä»¥åŠå…¶ä»–æˆ‘ä¸æ„¿<code>mpconfigport.h</code>å…¶ä»–äº‹é¡¹ï¼šè¯·å‚é˜…<code>mpconfigport.h</code>æ–‡ä»¶ã€‚ </p><br><h2> åˆ›å»ºä¸€ä¸ªæ¨¡å— </h2><br><p> æœ€æœ‰è¶£çš„æ˜¯ç¼–å†™è‡ªå·±çš„æ¨¡å—ã€‚ å› æ­¤ï¼Œæ¨¡å—ï¼ˆä¸æ˜¯å¿…éœ€çš„ï¼Œä½†å¯å–çš„ï¼‰ä»¥å…¶è‡ªå·±çš„<code>mod[].c</code>æ–‡ä»¶å¼€å¤´ï¼Œè¯¥æ–‡ä»¶ç”±<code>Makefile</code>æ·»åŠ ï¼ˆå¦‚æœéµå¾ªçº¦å®šï¼Œ <code>SRC_C</code>å˜é‡ï¼‰ã€‚ ç©ºæ¨¡å—å¦‚ä¸‹ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// nlr - non-local return:  C  ,      goto-  . //  nlr_raise             . #include "py/nlr.h" //   .  ,  mp_map_elem_t,  ,   . #include "py/obj.h" //   . mp_raise_ValueError(char* msg)  mp_raise_OSError(int errorcode)   . //  ,   mp_call_function_*     Callable (  callback-). #include "py/runtime.h" #include "py/binary.h" //  header   :       #include "portmodules.h" //    --  .     MP_QSTR_[ ]. MP_OBJ_NEW_QSTR   . //             RAM. //      -      __name__ STATIC const mp_map_elem_t mymodule_globals_table[] = { { MP_OBJ_NEW_QSTR(MP_QSTR___name__), MP_OBJ_NEW_QSTR(MP_QSTR_mymodule) }, }; //      STATIC MP_DEFINE_CONST_DICT (mp_module_mymodule_globals, mymodule_globals_table); //   :             const mp_obj_module_t mp_module_mymodule = { .base = { &amp;mp_type_module }, .globals = (mp_obj_dict_t*)&amp;mp_module_mymodule_globals, };</span></span></code> </pre> <br><p> å½“ç„¶ï¼Œç«¯å£æœ¬èº«æ— æ³•è¯†åˆ«<code>mp_module_mymodule</code>å¸¸æ•°ï¼šå¿…é¡»å°†å…¶æ·»åŠ åˆ°<code>mpconfigport.h</code>ç«¯å£<code>mpconfigport.h</code>çš„<code>MICROPY_PORT_BUILTIN_MODULES</code>å˜é‡ä¸­ã€‚ é¡ºä¾¿è¯´ä¸€å¥ <del> æ— èŠçš„å£çº¸ </del> èŠ¯ç‰‡åç§°å’Œç«¯å£åç§°ä¹Ÿåœ¨æ­¤å¤„æ›´æ”¹ã€‚ å®Œæˆæ‰€æœ‰è¿™äº›æ›´æ”¹åï¼Œæ‚¨å¯ä»¥å°è¯•ç¼–è¯‘æ¨¡å—å¹¶ä»REPLå¯¼å…¥å®ƒã€‚ åªæœ‰ä¸€ä¸ªå…·æœ‰æ¨¡å—åç§°çš„<code>__name__</code>å±æ€§å¯ç”¨äºè¯¥æ¨¡å—ï¼ˆè¿™æ˜¯é€šè¿‡Tabä½¿ç”¨REPLæ£€æŸ¥è‡ªåŠ¨å®Œæˆçš„ä¸€ç§å¥½æ–¹æ³•ï¼‰ã€‚ </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mymodule &gt;&gt;&gt; mymodule.__name__ <span class="hljs-string"><span class="hljs-string">'mymodule'</span></span></code> </pre> <br><h2> å¸¸æ•° </h2><br><p> å¤æ‚æ€§çš„ä¸‹ä¸€ä¸ªé˜¶æ®µæ˜¯æ·»åŠ å¸¸é‡ã€‚ è®¾ç½®é€šå¸¸éœ€è¦å¸¸é‡ï¼ˆ <code>INPUT</code> ï¼Œ <code>OUTPUT</code> ï¼Œ <code>HIGH</code> ï¼Œ <code>LOW</code>ç­‰ï¼‰ã€‚è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ã€‚ ä¾‹å¦‚ï¼Œè¿™é‡Œçš„å¸¸æ•°<code>magic_number = 10</code> ï¼š </p><br><pre> <code class="cpp hljs">STATIC <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mp_map_elem_t</span></span> mymodule_globals_table[] = { { MP_OBJ_NEW_QSTR(MP_QSTR___name__), MP_OBJ_NEW_QSTR(MP_QSTR_mymodule) }, { MP_OBJ_NEW_QSTR(MP_QSTR_magic_number), MP_OBJ_NEW_SMALL_INT(<span class="hljs-number"><span class="hljs-number">10</span></span>) }, };</code> </pre> <br><p> æµ‹è¯•ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mymodule &gt;&gt;&gt; mymodule.magic_number <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><h2> åŠŸèƒ½ä»‹ç» </h2><br><p> å‘æ¨¡å—æ·»åŠ åŠŸèƒ½éµå¾ªä»¥ä¸‹ä¸€èˆ¬åŸåˆ™ï¼šå£°æ˜ï¼ŒåŒ…è£…ï¼Œæ·»åŠ ï¼ˆæˆ‘ç»™å‡ºçš„ç¤ºä¾‹æ¯”æ–‡æ¡£ä¸­çš„ç¤ºä¾‹ç¨å¾®å¤æ‚ä¸€äº›ï¼‰ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  STATIC mp_obj_t conditional_add_one(mp_obj_t value) { //   int.         -  :   . int value_int = mp_obj_get_int(value); value_int ++; if (value_int == 10) { //  None return mp_const_none; } //   int return mp_obj_new_int(value); } //    .     // runtime.h   . STATIC MP_DEFINE_CONST_FUN_OBJ_1(conditional_add_one_obj, conditional_add_one); //  STATIC const mp_map_elem_t mymodule_globals_table[] = { { MP_OBJ_NEW_QSTR(MP_QSTR___name__), MP_OBJ_NEW_QSTR(MP_QSTR_mymodule) }, { MP_OBJ_NEW_QSTR(MP_QSTR_magic_number), MP_OBJ_NEW_SMALL_INT(10) }, { MP_OBJ_NEW_QSTR(MP_QSTR_conditional_add_one), (mp_obj_t)&amp;conditional_add_one_obj }, };</span></span></code> </pre> <br><p> æµ‹è¯•ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mymodule &gt;&gt;&gt; mymodule.conditional_add_one(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> &gt;&gt;&gt; mymodule.conditional_add_one(<span class="hljs-number"><span class="hljs-number">9</span></span>) &gt;&gt;&gt;</code> </pre> <br><h2> ç±»ï¼ˆç±»å‹ï¼‰ </h2><br><p> ä½¿ç”¨ç±»ï¼ˆç±»å‹ï¼‰ï¼Œä¸€åˆ‡ä¹Ÿéƒ½ç›¸å¯¹ç®€å•ã€‚ è¿™æ˜¯æ–‡æ¡£ä¸­çš„ä¸€ä¸ªç¤ºä¾‹ï¼ˆå·®ä¸å¤šï¼‰ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//     STATIC const mp_map_elem_t mymodule_hello_locals_dict_table[] = {}; //   STATIC MP_DEFINE_CONST_DICT(mymodule_hello_locals_dict, mymodule_hello_locals_dict_table); // ,  ,   const mp_obj_type_t mymodule_helloObj_type = { //    { &amp;mp_type_type }, // : helloObj .name = MP_QSTR_helloObj, //  .locals_dict = (mp_obj_dict_t*)&amp;mymodule_hello_locals_dict, }; //    STATIC const mp_map_elem_t mymodule_globals_table[] = { { MP_OBJ_NEW_QSTR(MP_QSTR___name__), MP_OBJ_NEW_QSTR(MP_QSTR_mymodule) }, { MP_OBJ_NEW_QSTR(MP_QSTR_magic_number), MP_OBJ_NEW_SMALL_INT(10) }, { MP_OBJ_NEW_QSTR(MP_QSTR_conditional_add_one), (mp_obj_t)&amp;conditional_add_one_obj }, { MP_OBJ_NEW_QSTR(MP_QSTR_conditional_add_one), (mp_obj_t)&amp;mymodule_helloObj_type }, };</span></span></code> </pre> <br><p> æµ‹è¯•ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>mymodule.helloObj &lt;type <span class="hljs-string"><span class="hljs-string">'helloObj'</span></span>&gt;</code> </pre> <br><p> å¯ä»¥ç»§æ‰¿ï¼Œæ¯”è¾ƒç»“æœç±»å‹ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰æ„é€ å‡½æ•°æˆ–ä»»ä½•å…³è”æ•°æ®ã€‚ æ•°æ®è¢«æ·»åŠ åˆ°æ„é€ å‡½æ•°çš„â€œæ—è¾¹â€ï¼šå»ºè®®åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç»“æ„ï¼Œåœ¨è¯¥ç»“æ„ä¸­Pythonç±»å‹å°†è¢«å•ç‹¬å­˜å‚¨ï¼Œå³ä¸€ä¸ªä»»æ„æ•°æ®é›†ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  -. ,    typedef struct _mymodule_hello_obj_t { //   mp_obj_base_t base; // -  uint8_t hello_number; } mymodule_hello_obj_t;</span></span></code> </pre> <br><p> å¦‚ä½•ä¸è¿™äº›æ•°æ®è¿›è¡Œäº¤äº’ï¼Ÿ æœ€å›°éš¾çš„æ–¹æ³•ä¹‹ä¸€æ˜¯é€šè¿‡æ„é€ å‡½æ•°ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// -,   (,  ,   mymodule_helloObj_type //   ,     - ),   (args  kwargs)  //        : args, kwargs STATIC mp_obj_t mymodule_hello_make_new( const mp_obj_type_t *type, size_t n_args, size_t n_kw, const mp_obj_t *args ) { //    mp_arg_check_num(n_args, n_kw, 1, 1, true); //   mymodule_hello_obj_t *self = m_new_obj(mymodule_hello_obj_t); //     self-&gt;base.type = &amp;mymodule_hello_type; //   self-&gt;hello_number = mp_obj_get_int(args[0]) //   return MP_OBJ_FROM_PTR(self); //    __init__, ,  } //      make_new const mp_obj_type_t mymodule_helloObj_type = { { &amp;mp_type_type }, .name = MP_QSTR_helloObj, .locals_dict = (mp_obj_dict_t*)&amp;mymodule_hello_locals_dict, //  .make_new = mymodule_hello_make_new, };</span></span></code> </pre> <br><p> åœ¨å…¶ä»–é¢†åŸŸä¸­ï¼Œè¿˜æœ‰<code>.print</code> ï¼Œæˆ‘çŒœæƒ³<code>Python3</code>çš„å…¶ä»–é­”åŠ›ã€‚ </p><br><p> ä½†æ˜¯è·å–ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹æ ¹æœ¬ä¸éœ€è¦<code>make_new</code> ï¼šåˆå§‹åŒ–å¯ä»¥åœ¨ä»»æ„å‡½æ•°ä¸­å®Œæˆã€‚ è¿™æ˜¯æ¥è‡ª<code>micropython/ports/esp32/modsocket.c</code>ä¸€ä¸ªå¥½ä¾‹å­ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   :       STATIC mp_obj_t get_socket(size_t n_args, const mp_obj_t *args) { socket_obj_t *sock = m_new_obj_with_finaliser(socket_obj_t); sock-&gt;base.type = &amp;socket_type; sock-&gt;domain = AF_INET; sock-&gt;type = SOCK_STREAM; sock-&gt;proto = 0; sock-&gt;peer_closed = false; if (n_args &gt; 0) { sock-&gt;domain = mp_obj_get_int(args[0]); if (n_args &gt; 1) { sock-&gt;type = mp_obj_get_int(args[1]); if (n_args &gt; 2) { sock-&gt;proto = mp_obj_get_int(args[2]); } } } sock-&gt;fd = lwip_socket(sock-&gt;domain, sock-&gt;type, sock-&gt;proto); if (sock-&gt;fd &lt; 0) { exception_from_errno(errno); } _socket_settimeout(sock, UINT64_MAX); return MP_OBJ_FROM_PTR(sock); } //     0-3  STATIC MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(get_socket_obj, 0, 3, get_socket);</span></span></code> </pre> <br><h2> ç»‘å®šæ–¹æ³• </h2><br><p> ä¸‹ä¸€æ­¥æ˜¯æ·»åŠ ç»‘å®šæ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œè¿™ä¸æ‰€æœ‰å…¶ä»–æ–¹æ³•å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚ æˆ‘ä»¬ä»æ–‡æ¡£ä¸­è¿”å›ç¤ºä¾‹ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    :     1 (self) STATIC mp_obj_t mymodule_hello_increment(mp_obj_t self_in) { mymodule_hello_obj_t *self = MP_OBJ_TO_PTR(self_in); self-&gt;hello_number += 1; return mp_const_none; } //     MP_DEFINE_CONST_FUN_OBJ_1(mymodule_hello_increment_obj, mymodule_hello_increment); //      'inc' STATIC const mp_map_elem_t mymodule_hello_locals_dict_table[] = { { MP_OBJ_NEW_QSTR(MP_QSTR_inc), (mp_obj_t)&amp;mymodule_hello_increment_obj }, }</span></span></code> </pre> <br><p> ä»…æ­¤è€Œå·²ï¼ </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>x = mymodule.helloObj(<span class="hljs-number"><span class="hljs-number">12</span></span>) &gt;&gt;&gt; x.inc()</code> </pre> <br><h2> æ‰€æœ‰å…¶ä»–å±æ€§ï¼š <strong>getattr</strong> ï¼Œ <strong>setattr</strong> </h2><br><p> å¦‚ä½•ä½¿ç”¨<code>@property</code>å’Œé€šå¸¸ä½¿ç”¨è‡ªå·±çš„<code>__getattr__</code>æ·»åŠ éåŠŸèƒ½ï¼Ÿ è¯·ï¼šé€šè¿‡ç»•è¿‡<code>mymodule_hello_locals_dict_table</code>æ‰‹åŠ¨å®Œæˆã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//     ... STATIC void mymodule_hello_attr(mp_obj_t self_in, qstr attr, mp_obj_t *dest) { mymodule_hello_obj_t *self = MP_OBJ_TO_PTR(self_in); if (dest[0] != MP_OBJ_NULL) { // __setattr__ if (attr == MP_QSTR_val) { self-&gt;val = dest[1]; dest[0] = MP_OBJ_NULL; } } else { // __getattr__ if (attr == MP_QSTR_val) { dest[0] = self-&gt;val; } } } // ...     attr const mp_obj_type_t mymodule_helloObj_type = { { &amp;mp_type_type }, .name = MP_QSTR_helloObj, //     //.locals_dict = (mp_obj_dict_t*)&amp;mymodule_hello_locals_dict, .make_new = mymodule_hello_make_new, //   - attr .attr = mymodule_hello_attr, };</span></span></code> </pre><br><p> æ‚¨è¯´ï¼Œç®€æ˜æ‰¼è¦çš„attrç»“æœå‡ºä¹æ„æ–™ã€‚ è¿™äº›<code>mp_raise_AttributeError</code>éƒ½åœ¨å“ªé‡Œï¼ˆ <em>æ³¨æ„</em> ï¼šè¿™æ ·çš„å‡½æ•°ä¸å­˜åœ¨ï¼‰ï¼Ÿ å®é™…ä¸Šï¼Œå°†è‡ªåŠ¨è°ƒç”¨<code>AttributeError</code> ã€‚ ç§˜å¯†åœ¨äº<code>dest</code>æ˜¯ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚ ç¬¬ä¸€ä¸ªå…ƒç´ çš„å«ä¹‰æ˜¯â€œè¾“å‡ºâ€ï¼Œä»…å†™ï¼šå¦‚æœéœ€è¦å†™å…¥è¯¥å€¼ï¼Œåˆ™å–å€¼<code>MP_OBJ_NULL</code>å¦‚æœéœ€è¦è¯»å–ï¼Œåˆ™<code>MP_OBJ_NULL</code> ã€‚ å› æ­¤ï¼Œåœ¨å‡½æ•°é€€å‡ºæ—¶ï¼Œåœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹æœŸæœ›<code>mp_obj_t</code> ï¼Œåœ¨ç¬¬äºŒç§æƒ…å†µä¸‹æœŸæœ›<code>mp_obj_t</code> ã€‚ è¾“å…¥çš„ç¬¬äºŒä¸ªå…ƒç´ æ˜¯åªè¯»çš„ï¼šå¦‚æœéœ€è¦å†™å…¥è¯¥å€¼ï¼Œåˆ™å–è¦å†™å…¥çš„å¯¹è±¡çš„å€¼ï¼›å¦‚æœéœ€è¦è¯»å–è¯¥å€¼ï¼Œåˆ™å–<code>MP_OBJ_NULL</code> ã€‚ æ‚¨ä¸éœ€è¦æ›´æ”¹å®ƒã€‚ </p><br><p> ä»…æ­¤è€Œå·²ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>x = mymodule.helloObj(<span class="hljs-number"><span class="hljs-number">12</span></span>) &gt;&gt;&gt; x.val = <span class="hljs-number"><span class="hljs-number">3</span></span> &gt;&gt;&gt; x.val <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p> æœ€æœ‰è¶£çš„æ˜¯ï¼ŒREPLä¸­çš„åˆ¶è¡¨ç¬¦<code>.val</code>ä»ç„¶å¯ä»¥ä½¿ç”¨å¹¶æä¾›<code>.val</code> ï¼ è€å®è¯´ï¼Œæˆ‘ä¸æ˜¯Cè¯­è¨€æ–¹é¢çš„ä¸“å®¶ï¼Œæ‰€ä»¥æˆ‘åªèƒ½çŒœæµ‹è¿™æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼ˆé€šè¿‡é‡æ–°å®šä¹‰è¿ç®—ç¬¦'=='ï¼‰ã€‚ </p><br><h2> æ¸¯å£ </h2><br><p> å›åˆ°A9Gæ¨¡å—ï¼Œæˆ‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æè¿°äº†</a>å¯¹æ‰€æœ‰åŸºæœ¬åŠŸèƒ½<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„</a>æ”¯æŒï¼Œå³SMSï¼ŒGPRSï¼ˆç”µå­ä¿¡å·ï¼‰ï¼ŒGPSï¼Œç”µæºç®¡ç†ã€‚ ç°åœ¨ï¼Œæ‚¨å¯ä»¥å°†ç±»ä¼¼è¿™æ ·çš„å†…å®¹ä¸Šä¼ åˆ°æ¨¡å—ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸å·¥ä½œï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cellular <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> usocket <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> gps <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> machine <span class="hljs-comment"><span class="hljs-comment">#   print("Waiting network registration ...") while not c.is_network_registered(): time.sleep(1) time.sleep(2) #  GPRS print("Activating ...") c.gprs_activate("internet", "", "") print("Local IP:", sock.get_local_ip()) #  GPS gps.on() #    thingspeak host = "api.thingspeak.com" api_key = "some-api-key" fields = ('latitude', 'longitude', 'battery', 'sat_visible', 'sat_tracked') #  ,      ! fields = dict(zip(fields, map(lambda x: "field{}".format(x+1), range(len(fields))) )) x, y = gps.get_location() level = machine.get_input_voltage()[1] sats_vis, sats_tracked = gps.get_satellites() s = sock.socket() print("Connecting ...") s.connect((host, 80)) print("Sending ...") #      ,     HTTP.           HTTP, SSL   print("Sent:", s.send("GET /update?api_key={}&amp;{latitude}={:f}&amp;{longitude}={:f}&amp;{battery}={:f}&amp;{sat_visible}={:d}&amp;{sat_tracked}={:d} HTTP/1.1\r\nHost: {}\r\nConnection: close\r\n\r\n".format( api_key, x, y, level, sats_vis, sats_tracked, host, **fields ))) print("Receiving ...") print("Received:", s.recv(128)) s.close()</span></span></code> </pre> <br><p> è¯¥é¡¹ç›®æ¬¢è¿ä»»ä½•å¯è¡Œçš„å¸®åŠ©ã€‚ å¦‚æœæ‚¨å–œæ¬¢è¯¥é¡¹ç›®å’Œ/æˆ–æœ¬æ–‡ï¼Œè¯·ä¸è¦å¿˜è®°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨githubä¸Š</a>ç•™ä¸‹ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">èµ</a> ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN446090/">https://habr.com/ru/post/zh-CN446090/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN446078/index.html">â€œå£°éŸ³â€ï¼šè®¨è®ºæœ‰å…³éŸ³é¢‘æŠ€æœ¯çš„æ’­å®¢</a></li>
<li><a href="../zh-CN446080/index.html">åœ¨ç¾å›½ï¼Œæ³•é™¢å»ºè®®ç¦æ­¢è¿›å£æŸäº›å‹å·çš„iPhoneï¼Œå› ä¸ºå®ƒä»¬ä¾µçŠ¯äº†é«˜é€šå…¬å¸çš„è‹¹æœä¸“åˆ©</a></li>
<li><a href="../zh-CN446082/index.html">åŠç¯çš„æ•…äº‹</a></li>
<li><a href="../zh-CN446086/index.html">Linuxå†å²ã€‚ ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ–°å¸‚åœºå’Œæ—§â€œæ•Œäººâ€</a></li>
<li><a href="../zh-CN446088/index.html">æˆ‘åœ¨2018å¹´ä¸çŸ¥é“çš„äº‹æƒ…</a></li>
<li><a href="../zh-CN446092/index.html">åªæœ‰æ²¡æœ‰åŒæ‰‹ï¼ ä¸é‡å¤ç”¨æˆ·æ“ä½œçš„æœºå™¨äºº</a></li>
<li><a href="../zh-CN446094/index.html">æœ‰ç”Ÿå‘½å‘¨æœŸè¡¨</a></li>
<li><a href="../zh-CN446096/index.html">ã€Š TasteVillï¼šå¦‚ä½•ä½¿é›¶å”®ä¸šå‘ç”Ÿé©å‘½ï¼Œåšé”™ä¸€åˆ‡ã€‹</a></li>
<li><a href="../zh-CN446098/index.html">è‹è”æ—¶ä»£çš„â€œä¸œæ–¹å·â€å’Œâ€œæ—¥å‡ºå·â€é£è¡Œæ§åˆ¶ä¸­å¿ƒ</a></li>
<li><a href="../zh-CN446100/index.html">é€šè¿‡Excelç”µå­è¡¨æ ¼è‡ªåŠ¨åˆ›å»ºAndroidå’ŒiOSæœ¬åœ°åŒ–æ–‡ä»¶</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>