<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•§ üëÑ ü§¥üèø RabbitMQ vs. Kafka: Utilisation de Kafka dans des applications orient√©es √©v√©nements üéÜ üõÅ üëÜüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans un article pr√©c√©dent, nous avons examin√© les mod√®les et les topologies utilis√©s dans RabbitMQ. Dans cette partie, nous allons nous tourner vers K...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RabbitMQ vs. Kafka: Utilisation de Kafka dans des applications orient√©es √©v√©nements</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/418389/"><p>  Dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent,</a> nous avons examin√© les mod√®les et les topologies utilis√©s dans RabbitMQ.  Dans cette partie, nous allons nous tourner vers Kafka et le comparer avec RabbitMQ pour avoir quelques id√©es sur leurs diff√©rences.  Il convient de garder √† l'esprit que les architectures d'applications orient√©es √©v√©nements seront compar√©es plut√¥t que les pipelines de traitement de donn√©es, bien que la fronti√®re entre ces deux concepts soit plut√¥t floue dans ce cas.  En g√©n√©ral, il s'agit plus d'un spectre que d'une s√©paration claire.  Notre comparaison se concentrera simplement sur la partie de ce spectre li√©e aux applications √©v√©nementielles. </p><br><p><img src="https://habrastorage.org/webt/fu/xp/vw/fuxpvw1pzsm4miouvpbwo7qxq-m.png"></p><a name="habracut"></a><br><p>  La premi√®re diff√©rence qui vient √† l'esprit est que les m√©canismes de nouvelle tentative de message et de rappel d'alarme utilis√©s par RabbitMQ pour travailler avec des messages de lettres mortes dans Kafka n'ont aucun sens.  Dans RabbitMQ, les messages sont temporaires, ils sont transmis et disparaissent.  Par cons√©quent, les rajouter est un cas d'utilisation absolument r√©el.  Et √† Kafka, le magazine occupe une place centrale.  R√©soudre les probl√®mes de remise en renvoyant un message √† la file d'attente n'a pas de sens et ne fait que nuire au journal.  L'un des avantages est la distribution claire et garantie des messages √† travers les partitions du journal, les messages r√©p√©t√©s confondent un sch√©ma bien organis√©.  Dans RabbitMQ, vous pouvez d√©j√† envoyer des messages √† la file d'attente avec laquelle un destinataire travaille, et sur la plateforme Kafka il y a un journal pour tous les destinataires.  Les retards de livraison et les probl√®mes de livraison des messages ne nuisent pas beaucoup au fonctionnement du journal, mais Kafka ne contient pas de m√©canismes de retard int√©gr√©s. </p><br><p>  La mani√®re de remettre des messages sur la plate-forme Kafka sera discut√©e dans la section sur les sch√©mas de messagerie. </p><br><p>  La deuxi√®me grande diff√©rence qui affecte les sch√©mas de messagerie possibles est que RabbitMQ stocke beaucoup moins les messages que Kafka.  Lorsqu'un message a d√©j√† √©t√© remis au destinataire dans RabbitMQ, il est supprim√© sans laisser de trace de son existence.  Dans Kafka, chaque message est conserv√© dans un journal jusqu'√† ce qu'il soit effac√©.  La fr√©quence de nettoyage d√©pend de la quantit√© de donn√©es disponibles, de la quantit√© d'espace disque que vous pr√©voyez de leur allouer et des sch√©mas de messagerie que vous souhaitez garantir. Vous pouvez utiliser la fen√™tre de temps pendant laquelle nous stockons les messages pendant une p√©riode donn√©e: les derniers jours / semaines / mois. </p><br><p>  De cette fa√ßon, Kafka permet au destinataire de revoir ou de r√©cup√©rer les messages pr√©c√©dents.  Cela ressemble √† une technologie pour envoyer des messages, bien qu'elle ne fonctionne pas de la m√™me mani√®re que dans RabbitMQ. </p><br><p>  Si RabbitMQ d√©place des messages et fournit des √©l√©ments puissants pour cr√©er des sch√©mas de routage complexes, Kafka enregistre l'√©tat actuel et pr√©c√©dent du syst√®me.  Cette plate-forme peut √™tre utilis√©e comme source de donn√©es historiques fiables, contrairement √† RabbitMQ. </p><br><h3>  Exemple de sch√©ma de messagerie sur la plate-forme Kafka <br></h3><br><p> L'exemple le plus simple d'utilisation de RabbitMQ et de Kafka est la diffusion d'informations selon le sch√©ma ¬´√©diteur-abonn√©¬ª.  Un ou plusieurs √©diteurs ajoutent des messages au journal partitionn√©, et ces messages sont re√ßus par l'abonn√© d'un ou plusieurs groupes d'abonn√©s. </p><br><p><img src="https://habrastorage.org/webt/rx/lw/56/rxlw56hzrjigugjyiiu01avpxho.png"><br>  <em>Figure 1. Plusieurs √©diteurs envoient des messages au journal partitionn√© et plusieurs groupes de destinataires les re√ßoivent.</em> </p><br><p>  Si vous n'entrez pas dans les d√©tails sur la fa√ßon dont l'√©diteur envoie des messages aux sections n√©cessaires de la revue et sur la fa√ßon dont les groupes de destinataires sont coordonn√©s entre eux, ce sch√©ma ne diff√®re pas de la topologie de fanout (√©change fourchu) utilis√©e dans RabbitMQ. <br>  Dans un article pr√©c√©dent, tous les sch√©mas et topologies de messagerie RabbitMQ ont √©t√© discut√©s.  Peut-√™tre qu'√† un moment donn√©, vous pensiez "Je n'ai pas besoin de toutes ces difficult√©s, je veux juste envoyer et recevoir des messages dans la file d'attente", et le fait que vous puissiez rembobiner le magazine √† des positions pr√©c√©dentes a parl√© des avantages √©vidents de Kafka. </p><br><p>  Pour les personnes habitu√©es aux fonctionnalit√©s traditionnelles des syst√®mes de files d'attente, le fait de la possibilit√© de reculer l'horloge et de rembobiner le journal des √©v√©nements dans le pass√© est incroyable.  Cette propri√©t√© (disponible en utilisant le journal au lieu de la file d'attente) est tr√®s utile pour r√©cup√©rer des √©checs.  J'ai (l'auteur de l'article en anglais) commenc√© √† travailler pour mon client actuel il y a 4 ans en tant que responsable technique du groupe de support du syst√®me serveur.  Nous avions plus de 50 applications qui recevaient des informations en temps r√©el sur les √©v√©nements commerciaux via MSMQ, et la chose habituelle √©tait que lorsqu'une erreur se produisait dans l'application, le syst√®me ne la d√©tectait que le lendemain.  Malheureusement, souvent les messages disparaissaient en cons√©quence, mais en g√©n√©ral, nous pouvions obtenir les donn√©es initiales d'un syst√®me tiers et transmettre les messages uniquement √† ¬´l'abonn√©¬ª qui avait le probl√®me.  Cela nous a oblig√©s √† cr√©er une infrastructure de messagerie pour les destinataires.  Et si nous avions la plateforme Kafka, il ne serait pas plus difficile de faire un tel travail que de changer le lien vers l'emplacement du dernier message re√ßu pour l'application dans laquelle l'erreur s'est produite. </p><br><h3 id="integraciya-dannyh-v-sobytiyno-orientirovannyh-prilozheniyah-i-sistemah">  Int√©gration de donn√©es dans des applications et des syst√®mes orient√©s √©v√©nements </h3><br><p>  Ce sch√©ma est √† bien des √©gards un moyen de g√©n√©rer des √©v√©nements, bien qu'il ne soit pas li√© √† une seule application.  Il existe deux niveaux de g√©n√©ration d'√©v√©nements: le logiciel et le syst√®me.  Le sch√©ma actuel est associ√© √† ce dernier. </p><br><h4 id="programmnyy-uroven-porozhdeniya-sobytiy">  G√©n√©ration d'√©v√©nements au niveau du programme </h4><br><p>  L'application g√®re son propre √©tat via une s√©quence immuable d'√©v√©nements de modification qui sont stock√©s dans le magasin d'√©v√©nements.  Afin d'obtenir l'√©tat actuel de l'application, vous devez lire ou combiner ses √©v√©nements dans la s√©quence correcte.  Habituellement, dans un tel mod√®le, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le</a> mod√®le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CQRS</a> Kafka peut √™tre utilis√© comme syst√®me. </p><br><h4 id="vzaimodeystvie-mezhdu-prilozheniyami-na-urovne-sistemy">  Interaction entre les applications au niveau du syst√®me. </h4><br><p>  Les applications ou services peuvent g√©rer leur √©tat de la mani√®re que leur d√©veloppeur souhaite g√©rer, par exemple, dans une base de donn√©es relationnelle r√©guli√®re. </p><br><p>  Mais les applications ont souvent besoin de donn√©es les unes sur les autres, ce qui conduit √† des architectures sous-optimales, par exemple, des bases de donn√©es communes, un flou des limites des entit√©s ou des API REST peu pratiques. </p><br><p>  J'ai (l'auteur de l'article en anglais) √©cout√© le podcast ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Software Engineering Daily</a> ¬ª, qui d√©crit un sc√©nario √©v√©nementiel pour les profils de service sur les r√©seaux sociaux.  Il existe un certain nombre de services connexes dans le syst√®me, tels que la recherche, un syst√®me de graphiques sociaux, un moteur de recommandation, etc., tous doivent √™tre inform√©s d'un changement de statut d'un profil utilisateur.  Lorsque j'ai (l'auteur de l'article en anglais) travaill√© en tant qu'architecte de l'architecture d'un syst√®me li√© au transport a√©rien, nous avions deux grands syst√®mes logiciels avec une myriade de petits services connexes.  Les services d'assistance ont requis les donn√©es de commande et de vol.  Chaque fois qu'une commande √©tait cr√©√©e ou modifi√©e, lorsqu'un vol √©tait retard√© ou annul√©, ces services devaient √™tre activ√©s. </p><br><p>  Il fallait une technique pour g√©n√©rer des √©v√©nements.  Mais d'abord, examinons certains probl√®mes courants qui surviennent dans les grands syst√®mes logiciels et voyons comment la g√©n√©ration d'√©v√©nements peut les r√©soudre. </p><br><p>  Un grand syst√®me d'entreprise int√©gr√© se d√©veloppe g√©n√©ralement de mani√®re organique;  des migrations vers de nouvelles technologies et de nouvelles architectures sont effectu√©es, ce qui peut ne pas affecter 100% du syst√®me.  Les donn√©es sont distribu√©es dans diff√©rentes parties de l'institution, les applications divulguent des bases de donn√©es √† l'usage du public afin que l'int√©gration se fasse le plus rapidement possible, et personne ne peut pr√©dire avec certitude comment tous les √©l√©ments du syst√®me interagiront. </p><br><h4 id="neuporyadochennoe-rasprostranenie-dannyh">  Distribution al√©atoire des donn√©es </h4><br><p>  Les donn√©es sont distribu√©es √† diff√©rents endroits et g√©r√©es √† diff√©rents endroits, il est donc difficile de comprendre: </p><br><ul><li>  comment les donn√©es se d√©placent dans les processus m√©tier; </li><li>  comment les changements dans une partie du syst√®me peuvent affecter d'autres parties; </li><li>  que faire des conflits de donn√©es qui surviennent du fait qu'il existe de nombreuses copies de donn√©es qui se propagent lentement. </li></ul><br><p>  S'il n'y a pas de limites claires des entit√©s de domaine, les modifications seront co√ªteuses et risqu√©es, car elles affectent de nombreux syst√®mes √† la fois. </p><br><h4 id="centralizovannaya-raspredelennaya-baza-dannyh">  Base de donn√©es distribu√©e centralis√©e </h4><br><p>  Une base de donn√©es ouverte au public peut provoquer plusieurs probl√®mes: </p><br><ul><li>  Elle n'est pas suffisamment optimis√©e pour chaque application s√©par√©ment. Tr√®s probablement, cette base de donn√©es contient un ensemble de donn√©es excessivement complet pour l'application, de plus, elle est normalis√©e de telle sorte que les applications devront ex√©cuter des requ√™tes tr√®s complexes pour les recevoir. </li><li>  En utilisant une base de donn√©es commune, les applications peuvent affecter le travail de l'autre. </li><li>  Les changements dans la structure logique de la base de donn√©es n√©cessitent une coordination √† grande √©chelle et des travaux sur la migration des donn√©es, et le d√©veloppement de services individuels sera arr√™t√© pendant toute la dur√©e de ce processus. </li><li>  Personne ne veut changer la structure de stockage.  Les changements que tout le monde attend sont trop douloureux. </li></ul><br><h4 id="ispolzovanie-neudobnogo-rest-api">  Utilisation de l'API REST peu pratique </h4><br><p>  Obtenir des donn√©es √† partir d'autres syst√®mes via l'API REST, d'une part, ajoute la commodit√© et l'isolement, mais peut ne pas toujours r√©ussir.  Chacune de ces interfaces peut avoir son propre style sp√©cial et ses propres conventions.  Obtenir les donn√©es n√©cessaires peut n√©cessiter beaucoup de requ√™tes HTTP et √™tre assez compliqu√©. </p><br><p>  Nous nous dirigeons de plus en plus vers une approche centr√©e sur les API, et de telles architectures offrent de nombreux avantages, en particulier lorsque les services eux-m√™mes sont hors de notre contr√¥le.  Il existe tellement de fa√ßons pratiques de cr√©er une API pour le moment que nous n'avons pas besoin d'√©crire autant de code que n√©cessaire auparavant.  N√©anmoins, ce n'est pas le seul outil disponible, et il existe des alternatives pour l'architecture interne du syst√®me. </p><br><h4 id="kafka-kak-hranilische-sobytiy">  Kafka comme r√©f√©rentiel d'√©v√©nements </h4><br><p>  Nous donnons un exemple.  Il existe un syst√®me qui g√®re les r√©servations dans une base de donn√©es relationnelle.  Le syst√®me utilise toutes les garanties d'atomicit√©, de coh√©rence, d'isolement et de durabilit√© offertes par la base de donn√©es afin de g√©rer efficacement leurs caract√©ristiques et tout le monde est content.  La r√©partition des responsabilit√©s en √©quipes et demandes, la g√©n√©ration d'√©v√©nements, les microservices sont absents, en g√©n√©ral, d'un monolithe de construction traditionnelle.  Mais il existe une multitude de services d'assistance (√©ventuellement des microservices) li√©s aux r√©servations: notifications push, distribution d'e-mails, syst√®me anti-fraude, programme de fid√©lit√©, facturation, syst√®me d'annulation, etc.  La liste s'allonge encore et encore.  Tous ces services n√©cessitent des d√©tails de r√©servation, et il existe de nombreuses fa√ßons de les obtenir.  Ces services produisent eux-m√™mes des donn√©es qui peuvent √™tre utiles √† d'autres applications. </p><br><p><img src="https://habrastorage.org/webt/tk/e6/rc/tke6rcvglscapqo_nbx4yk228si.png"><br>  <em>Figure 2. Diff√©rents types d'int√©gration de donn√©es.</em> </p><br><p>  Architecture alternative bas√©e sur Kafka.  Chaque fois que vous effectuez une nouvelle r√©servation ou modifiez une r√©servation pr√©c√©dente, le syst√®me envoie des donn√©es compl√®tes sur l'√©tat actuel de cette r√©servation √† Kafka.  En consolidant le journal, vous pouvez raccourcir les messages afin que seules les informations sur le dernier statut de r√©servation y soient laiss√©es.  Dans ce cas, la taille du journal sera sous contr√¥le. </p><br><p><img src="https://habrastorage.org/webt/gq/bq/j2/gqbqj2zxxu_zk2sgd-qxrvd17pm.png"><br>  <em>Figure 3. Int√©gration des donn√©es bas√©e sur Kafka comme base pour la g√©n√©ration d'√©v√©nements</em> </p><br><p>  Pour toutes les applications pour lesquelles cela est n√©cessaire, ces informations sont la source de v√©rit√© et la seule source de donn√©es.  Du coup, nous passons d'un r√©seau int√©gr√© de d√©pendances et de technologies √† l'envoi et la r√©ception de donn√©es vers / depuis les sujets Kafka. </p><br><p>  Kafka comme r√©f√©rentiel d'√©v√©nements: </p><br><ul><li>  S'il n'y a pas de probl√®me d'espace disque, Kafka peut stocker tout l'historique des √©v√©nements, c'est-√†-dire qu'une nouvelle application peut √™tre d√©ploy√©e et t√©l√©charger toutes les informations n√©cessaires depuis le journal.  Les enregistrements d'√©v√©nements qui refl√®tent pleinement les caract√©ristiques des objets peuvent √™tre compress√©s en compilant le journal, ce qui rendra cette approche plus justifi√©e pour de nombreux sc√©narios. </li><li>  Que faire si les √©v√©nements doivent √™tre jou√©s dans le bon ordre?  Tant que les enregistrements d'√©v√©nements sont correctement distribu√©s, vous pouvez d√©finir l'ordre de leur lecture et appliquer des filtres, des outils de conversion, etc., afin que la lecture des donn√©es se termine toujours sur les informations n√©cessaires.  Selon la possibilit√© de distribution des donn√©es, il est possible d'assurer leur traitement hautement parall√©lis√© dans le bon ordre. </li><li>  Un changement de mod√®le de donn√©es peut √™tre n√©cessaire.  Lors de la cr√©ation d'une nouvelle fonction de filtrage / transformation, il peut √™tre n√©cessaire de lire les enregistrements de tous les √©v√©nements ou √©v√©nements de la semaine derni√®re. </li></ul><br><p>  Les messages peuvent provenir de Kafka non seulement √† partir des applications de votre organisation qui envoient des messages sur toutes les modifications de leurs caract√©ristiques (ou les r√©sultats de ces modifications), mais aussi √† partir de services tiers int√©gr√©s √† votre syst√®me.  Cela se produit de la mani√®re suivante: </p><br><ul><li>  Exportation, transfert, importation p√©riodique des donn√©es re√ßues de services tiers et leur t√©l√©chargement vers Kafka. </li><li>  T√©l√©chargement de donn√©es √† partir de services tiers √† Kafka. </li><li>  Les donn√©es de CSV et d'autres formats t√©l√©charg√©s √† partir de services tiers sont t√©l√©charg√©es sur Kafka. </li></ul><br><p>  Revenons aux questions que nous avons examin√©es pr√©c√©demment.  L'architecture bas√©e sur Kafka simplifie la distribution des donn√©es.  Nous savons o√π se trouve la source de la v√©rit√©, nous savons o√π se trouvent ses sources de donn√©es et toutes les applications cibles fonctionnent avec des copies <strong>d√©riv√©es</strong> de ces donn√©es.  Les donn√©es vont de l'exp√©diteur aux destinataires.  Les donn√©es source n'appartiennent qu'√† l'exp√©diteur, mais d'autres sont libres de travailler avec leurs projections.  Ils peuvent les filtrer, les transformer, les compl√©ter avec des donn√©es provenant d'autres sources, les enregistrer dans leurs propres bases de donn√©es. </p><br><p><img src="https://habrastorage.org/webt/hw/i7/jw/hwi7jw2n5m5t2hkqb9kx2rqi49c.png"><br>  <em>Fig 4. Donn√©es source et sortie</em> </p><br><p>  Chaque application qui a besoin de donn√©es de r√©servation et de vol les recevra pour elle-m√™me, car elle est ¬´abonn√©e¬ª aux sections de Kafka qui contiennent ces donn√©es.  Pour cette application, ils peuvent utiliser SQL, Cypher, JSON ou tout autre langage de requ√™te.  Une application peut ensuite enregistrer les donn√©es dans son syst√®me comme bon lui semble.  Le sch√©ma de distribution des donn√©es peut √™tre modifi√© sans affecter le fonctionnement d'autres applications. </p><br><p>  La question peut se poser: pourquoi tout cela ne peut pas √™tre fait en utilisant RabbitMQ?  La r√©ponse est que RabbitMQ peut √™tre utilis√© pour traiter des √©v√©nements en temps r√©el, mais pas comme base pour g√©n√©rer des √©v√©nements.  RabbitMQ est une solution compl√®te uniquement pour r√©pondre aux √©v√©nements qui se produisent actuellement.  Lorsqu'une nouvelle application est ajout√©e qui a besoin de sa propre partie des donn√©es de r√©servation pr√©sent√©es dans un format optimis√© pour les t√¢ches de cette application, RabbitMQ ne pourra pas vous aider.  Avec RabbitMQ, nous revenons aux bases de donn√©es partag√©es ou √† l'API REST. </p><br><p>  Deuxi√®mement, l'ordre dans lequel les √©v√©nements sont trait√©s est important.  Si vous travaillez avec RabbitMQ, lorsque vous ajoutez un deuxi√®me destinataire √† la file d'attente, la garantie de conformit√© avec la commande est perdue.  Ainsi, l'ordre correct d'envoi des messages n'est observ√© que pour un seul destinataire, mais cela, bien s√ªr, n'est pas suffisant. </p><br><p>  Kafka, en revanche, peut fournir toutes les donn√©es dont cette application a besoin pour cr√©er sa propre copie des donn√©es et maintenir les donn√©es √† jour, tandis que Kafka suit l'ordre dans lequel les messages sont envoy√©s. </p><br><p>  Revenons maintenant aux architectures centr√©es sur l'API.  Ces interfaces seront-elles toujours le meilleur choix?  Lorsque vous souhaitez ouvrir l'acc√®s aux donn√©es en lecture seule, je pr√©f√®re une architecture √©mettrice d'√©v√©nements.  Il emp√™chera les d√©faillances en cascade et raccourcira la dur√©e de vie associ√©e √† une augmentation du nombre de d√©pendances sur d'autres services.  Il y aura plus d'opportunit√©s pour une organisation cr√©ative et efficace des donn√©es au sein des syst√®mes.  Mais parfois, vous devez modifier les donn√©es de mani√®re synchrone dans votre syst√®me et dans un autre syst√®me, et dans une telle situation, des syst√®mes centr√©s sur l'API seront utiles.  Beaucoup les pr√©f√®rent √† d'autres m√©thodes asynchrones.  Je pense que c'est une question de go√ªt. </p><br><h3 id="prilozheniya-chuvstvitelnye-k-vysokomu-trafiku-i-poryadku-obrabotki-sobytiy">  Applications sensibles au trafic √©lev√© et au traitement des √©v√©nements. </h3><br><p>  Il n'y a pas si longtemps, un probl√®me est survenu avec l'un des r√©cepteurs de RabbitMQ, qui a re√ßu des fichiers en file d'attente d'un service tiers.  La taille totale du fichier √©tait importante et l'application √©tait sp√©cifiquement configur√©e pour recevoir un tel volume de donn√©es.  Le probl√®me √©tait que les donn√©es arrivaient de mani√®re incoh√©rente, ce qui a cr√©√© beaucoup de probl√®mes. </p><br><p>  De plus, il y avait parfois un probl√®me dans le fait que parfois deux fichiers √©taient destin√©s √† la m√™me destination, et leur heure d'arriv√©e diff√©rait de plusieurs secondes.  Ils ont tous deux subi un traitement et ont d√ª √™tre t√©l√©charg√©s sur un serveur.  Et apr√®s que le deuxi√®me message a √©t√© enregistr√© sur le serveur, le premier message qui le suit √©crase le second.  Ainsi, tout s'est termin√© par la sauvegarde de donn√©es invalides.  RabbitMQ a rempli son r√¥le et envoy√© des messages dans le bon ordre, mais tout de m√™me, tout s'est termin√© dans le mauvais ordre dans l'application elle-m√™me. </p><br><p>  Ce probl√®me a √©t√© r√©solu en lisant l'horodatage √† partir des enregistrements existants et l'absence de r√©ponse si le message √©tait ancien.  De plus, un hachage coh√©rent a √©t√© appliqu√© lors de l'√©change de donn√©es et la file d'attente a √©t√© divis√©e, comme avec le m√™me partitionnement sur la plate-forme Kafka. </p><br><p>  Dans le cadre de la partition, Kafka stocke les messages dans l'ordre dans lequel ils leur ont √©t√© envoy√©s.  L'ordre des messages n'existe que dans la partition.  Dans l'exemple ci-dessus, en utilisant Kafka, nous avons d√ª appliquer la fonction de hachage √† l'id de la destination pour s√©lectionner la partition souhait√©e.  Nous avons d√ª cr√©er un ensemble de partitions, il devrait y en avoir plus que le client n'en avait besoin.  L'ordre de traitement des messages aurait d√ª √™tre atteint car chaque partition est destin√©e √† un seul destinataire.  Simple et efficace. </p><br><p>  Kafka, par rapport √† RabbitMQ, pr√©sente certains avantages associ√©s au fractionnement des messages √† l'aide du hachage.  Il n'y a rien sur la plate-forme RabbitMQ qui emp√™cherait les conflits de destinataires au sein de la m√™me file d'attente g√©n√©r√©e dans le cadre de l'√©change de donn√©es √† l'aide d'un hachage coh√©rent.  RabbitMQ n'aide pas √† coordonner les destinataires afin qu'un seul destinataire de la file d'attente enti√®re utilise le message.  Kafka fournit tout cela gr√¢ce √† l'utilisation de groupes de destinataires et d'un n≈ìud de coordination.  Cela vous permet de vous assurer qu'un seul destinataire dans la section est garanti pour utiliser le message et que l'ordre de traitement des donn√©es est garanti. </p><br><h3 id="lokalnost-dannyh">  Localit√© de donn√©es </h3><br><p>  √Ä l'aide d'une fonction de hachage pour distribuer les donn√©es sur les partitions, Kafka fournit la localit√© des donn√©es.  Par exemple, les messages de l'utilisateur avec l'ID 1001 doivent toujours aller au destinataire 3. Comme les √©v√©nements de l'utilisateur 1001 vont toujours au destinataire 3, le destinataire 3 peut effectivement effectuer certaines op√©rations qui seraient beaucoup plus difficiles si un acc√®s r√©gulier √† une base de donn√©es externe ou √† d'autres syst√®mes √©tait n√©cessaire pour recevoir. les donn√©es.  Nous pouvons lire des donn√©es, effectuer des agr√©gations, etc.  directement avec des informations dans la m√©moire du destinataire.  C'est l'endroit o√π les applications orient√©es √©v√©nements et le streaming de donn√©es commencent √† se combiner. </p><br><p>  Comment Kafka fournit-elle la localisation des donn√©es?  Pour commencer, il est important de noter que Kafka ne permet pas d'augmenter et de diminuer √©lastiquement le nombre de partitions.  Tout d'abord, vous ne pouvez pas du tout r√©duire le nombre de partitions: s'il y en a 10, vous ne pouvez pas r√©duire le nombre √† 9.  Mais, d'autre part, cela n'est pas obligatoire.  Chaque destinataire peut utiliser 1 ou plusieurs partitions, il n'est donc pas n√©cessaire de r√©duire leur nombre.  La cr√©ation de partitions suppl√©mentaires sur Kafka entra√Æne un retard au moment du r√©√©quilibrage, nous essayons donc de faire √©voluer le nombre de partitions en tenant compte des pics de charges. </p><br><p>  Mais si nous devons encore augmenter le nombre de partitions et de destinataires pour √©voluer, nous n'aurons besoin que de co√ªts indirects ponctuels si un r√©√©quilibrage est n√©cessaire.  Il convient de noter que lors de la mise √† l'√©chelle, les anciennes donn√©es restent dans les m√™mes partitions o√π elles se trouvaient.  Mais les nouveaux messages entrants seront d√©j√† achemin√©s diff√©remment et les nouvelles partitions commenceront √† recevoir de nouveaux messages.  Les messages de l'utilisateur 1001 peuvent d√©sormais aller au destinataire 4 (car les donn√©es sur l'utilisateur 1001 sont d√©sormais divis√©es en deux sections). </p><br><p>  De plus, nous comparerons et comparerons la s√©mantique de livraison des messages de livraison dans les deux syst√®mes.  Le sujet du r√©√©quilibrage et du partitionnement m√©rite un article s√©par√©, dont nous discuterons dans la partie suivante. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418389/">https://habr.com/ru/post/fr418389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418379/index.html">Proth√®se bio√©lectrique pour enfants. 2e partie</a></li>
<li><a href="../fr418381/index.html">Nouveaut√©s de DevTools dans Chrome version 68</a></li>
<li><a href="../fr418383/index.html">Animations Android bas√©es sur Kotlin et RxJava</a></li>
<li><a href="../fr418385/index.html">Comment j'ai assembl√© un ordinateur pour les anciens jeux</a></li>
<li><a href="../fr418387/index.html">Les physiciens dialoguent sur l'√¢me</a></li>
<li><a href="../fr418391/index.html">OSPF (premi√®re partie)</a></li>
<li><a href="../fr418393/index.html">[Vendredi] Comment nous avons sci√© le Web 3D</a></li>
<li><a href="../fr418395/index.html">Elon Musk: des g√©n√©rateurs locaux de champ √©lectromagn√©tique prot√©geront les colons sur Mars</a></li>
<li><a href="../fr418397/index.html">Vendredi Gestion: Webinaires Skillbox gratuits</a></li>
<li><a href="../fr418399/index.html">Sur la vague de Selectel FM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>