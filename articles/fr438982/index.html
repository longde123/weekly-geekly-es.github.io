<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï¥üèø üëàüèΩ üçç Guide Kubernetes, Partie 1: Applications, microservices et conteneurs ü•§ üë©üèæ‚Äçüîß ü§¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä notre demande, Habr a cr√©√© le hub Kubernetes et nous sommes heureux d'y publier la premi√®re publication. Abonnez-vous! 
 Kubernetes est facile. Pour...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide Kubernetes, Partie 1: Applications, microservices et conteneurs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/438982/"><blockquote>  √Ä notre demande, Habr a cr√©√© le hub <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kubernetes</a> et nous sommes heureux d'y publier la premi√®re publication.  Abonnez-vous! </blockquote><br>  Kubernetes est facile.  Pourquoi les banques me paient-elles beaucoup d'argent pour travailler dans ce domaine, alors que n'importe qui peut ma√Ætriser cette technologie en quelques heures seulement? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/d3/4l/ic/d34licaikjsxfxisetkc9arcpdi.jpeg"></a> <br><a name="habracut"></a><br>  Si vous doutez que Kubernetes puisse √™tre appris si rapidement, je vous sugg√®re d'essayer de le faire vous-m√™me.  A savoir, apr√®s avoir ma√Ætris√© ce mat√©riel, vous pourrez ex√©cuter l'application bas√©e sur des microservices dans le cluster Kubernetes.  Je peux le garantir, car c'est pr√©cis√©ment par la m√©thodologie utilis√©e ici que je forme Kubernetes √† travailler avec nos clients.  Qu'est-ce qui distingue ce manuel des autres?  En fait - beaucoup de choses.  Ainsi, la plupart de ces documents commencent par une explication de choses simples - les concepts de Kubernetes et les fonctionnalit√©s de l'√©quipe kubectl.  Les auteurs de ces documents estiment que leur lecteur conna√Æt le d√©veloppement d'applications, les microservices et les conteneurs Docker.  Nous irons dans l'autre sens.  Voyons d'abord comment ex√©cuter une application bas√©e sur des microservices sur un ordinateur.  Consid√©rez ensuite l'assemblage d'images de conteneurs pour chaque microservice.  Apr√®s cela, nous apprendrons √† conna√Ætre Kubernetes et analyserons le d√©ploiement d'une application bas√©e sur des microservices dans un cluster g√©r√© par Kubernetes. <br><br>  Une telle approche, avec une approche progressive de Kubernetes, donnera la profondeur de la compr√©hension qui arrive √† une personne ordinaire afin de comprendre √† quel point tout est organis√© dans Kubernetes.  Kubernetes est, bien s√ªr, une technologie simple, √† condition que quiconque veut l'apprendre sache o√π et comment il est utilis√©. <br><br>  Maintenant, sans plus tarder, mettons-nous au travail et parlons de l'application avec laquelle nous allons travailler. <br><br><h2>  <font color="#3AC1EF">Application exp√©rimentale</font> </h2><br>  Notre application ne remplira qu'une seule fonction.  Il accepte, en entr√©e, une phrase, puis, en utilisant les moyens d'analyse de texte, effectue une analyse des sentiments de cette phrase, en recevant une estimation de l'attitude √©motionnelle de l'auteur de la phrase envers un certain objet. <br><br>  Voici √† quoi ressemble la fen√™tre principale de cette application. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/674/7e1/415/6747e14151585819867c880f52fa9d21.gif"></div><br>  <i><font color="#999999">Application Web pour l'analyse du sentiment de texte</font></i> <br><br>  D'un point de vue technique, l'application se compose de trois microservices, chacun r√©solvant un certain ensemble de t√¢ches: <br><br><ul><li>  SA-Frontend est un serveur Web Nginx qui sert des fichiers statiques React. </li><li>  SA-WebApp est une application Web bas√©e sur Java qui traite les demandes du front-end. </li><li>  SA-Logic est une application Python qui effectue une analyse de sentiment de texte. </li></ul><br>  Il est important de noter que les microservices n'existent pas isol√©ment.  Ils mettent en ≈ìuvre l'id√©e de "s√©paration des t√¢ches", mais ils doivent cependant interagir les uns avec les autres. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94b/f93/0c0/94bf930c03220c1eec6957a0f7308046.gif"></div><br>  <i><font color="#999999">Flux de donn√©es d'application</font></i> <br><br>  Dans le diagramme ci-dessus, vous pouvez voir les √©tapes num√©rot√©es du syst√®me, illustrant les flux de donn√©es dans l'application.  Analysons-les: <br><br><ol><li> Le navigateur demande le fichier <code>index.html</code> au serveur (qui, √† son tour, t√©l√©charge le package d'application React). </li><li>  L'utilisateur interagit avec l'application, ce qui provoque un appel √† une application Web bas√©e sur Spring. </li><li>  L'application Web redirige la demande d'analyse de texte vers l'application Python. </li><li>  L'application Python analyse la tonalit√© du texte et renvoie le r√©sultat en r√©ponse √† la demande. </li><li>  L'application Spring envoie une r√©ponse √† l'application React (et elle montre √† son tour le r√©sultat de l'analyse de texte √† l'utilisateur). </li></ol><br>  Le code de toutes ces applications se trouve <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Je vous recommande maintenant de copier ce r√©f√©rentiel pour vous-m√™me, car il y a beaucoup d'exp√©riences int√©ressantes devant nous. <br><br><h2>  <font color="#3AC1EF">D√©marrage d'une application bas√©e sur un microservice sur un ordinateur local</font> </h2><br>  Pour que l'application fonctionne, nous devons ex√©cuter les trois microservices.  Commen√ßons par les plus mignons d'entre eux - avec l'application frontale. <br><br><h3>  <font color="#3AC1EF">‚ñçConfigurer React pour le d√©veloppement local</font> </h3><br>  Pour ex√©cuter l'application React, vous devez installer les plates-formes Node.js et NPM sur votre ordinateur.  Apr√®s avoir install√© tout cela, passez par le terminal dans le dossier du projet <code>sa-frontend</code> et ex√©cutez la commande suivante: <br><br><pre> <code class="plaintext hljs">npm install</code> </pre> <br>  Gr√¢ce √† l'ex√©cution de cette commande, les d√©pendances de l'application React, dont les entr√©es se trouvent dans le fichier <code>package.json</code> , seront charg√©es dans le dossier <code>node_modules</code> .  Une fois les d√©pendances t√©l√©charg√©es dans le m√™me dossier, ex√©cutez la commande suivante: <br><br><pre> <code class="plaintext hljs">npm start</code> </pre> <br>  C‚Äôest tout.  Maintenant que l'application React est en cours d'ex√©cution, vous pouvez y acc√©der en acc√©dant √† l'adresse <code>localhost:3000</code> dans le navigateur.  Vous pouvez changer quelque chose dans son code.  Vous verrez imm√©diatement l'effet de ces changements dans le navigateur.  Ceci est possible gr√¢ce au remplacement dit "√† chaud" des modules.  Gr√¢ce √† cela, le d√©veloppement frontal devient une t√¢che simple et agr√©able. <br><br><h3>  <font color="#3AC1EF">‚ñçPr√©paration d'une application React de sortie en production</font> </h3><br>  Pour une utilisation r√©elle de l'application React, nous devons la convertir en un ensemble de fichiers statiques et les remettre aux clients utilisant un serveur Web. <br><br>  Pour cr√©er l'application React, √† nouveau, √† l'aide du terminal, acc√©dez au dossier <code>sa-frontend</code> et ex√©cutez la commande suivante: <br><br><pre> <code class="plaintext hljs">npm run build</code> </pre> <br>  Cela cr√©era un r√©pertoire de <code>build</code> dans le dossier du projet.  Il contiendra tous les fichiers statiques n√©cessaires au fonctionnement de l'application React. <br><br><h3>  <font color="#3AC1EF">‚ñçService de fichiers statiques √† l'aide des outils Nginx</font> </h3><br>  Vous devez d'abord installer et ex√©cuter le serveur Web Nginx.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ici,</a> vous pouvez le t√©l√©charger et trouver les instructions d'installation et de d√©marrage.  Ensuite, vous devez copier le contenu du dossier <code>sa-frontend/build</code> dossier <code>[your_nginx_installation_dir]/html</code> . <br><br>  Avec cette approche, le fichier <code>index.html</code> g√©n√©r√© lors de la construction de l'application React sera disponible dans <code>[your_nginx_installation_dir]/html/index.html</code> .  Il s'agit du fichier que, par d√©faut, le serveur Nginx √©met lors de son acc√®s.  Le serveur est configur√© pour √©couter sur le port <code>80</code> , mais vous pouvez le configurer selon vos besoins en modifiant le fichier <code>[your_nginx_installation_dir]/conf/nginx.conf</code> . <br><br>  Ouvrez maintenant votre navigateur et acc√©dez √† <code>localhost:80</code> .  Vous verrez la page d'application React. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a50/b83/f39/a50b83f390ff0434ef817f357a041941.png"></div><br>  <i><font color="#999999">Application React servie par le serveur Nginx</font></i> <br><br>  Si vous tapez quelque chose dans le champ <code>Type your sentence</code> maintenant et cliquez sur le bouton <code>Send</code> , rien ne se passera.  Mais, si vous regardez la console, vous pouvez y voir des messages d'erreur.  Afin de comprendre exactement o√π ces erreurs se produisent, analysons le code de l'application. <br><br><h3>  <font color="#3AC1EF">‚ñçAnalyse du code de l'application frontale</font> </h3><br>  <code>App.js</code> regard√© le code du fichier <code>App.js</code> , nous pouvons voir que cliquer sur le bouton <code>Send</code> appelle la m√©thode <code>analyzeSentence()</code> .  Le code de cette m√©thode est donn√© ci-dessous.  Dans le m√™me temps, faites attention au fait que pour chaque ligne pour laquelle il y a un commentaire du formulaire <code># </code> , il y a une explication donn√©e sous le code.  De la m√™me mani√®re, nous analyserons d'autres morceaux de code. <br><br><pre> <code class="plaintext hljs">analyzeSentence() {   fetch('http://localhost:8080/sentiment', {  // #1       method: 'POST',       headers: {           'Content-Type': 'application/json'       },       body: JSON.stringify({                      sentence: this.textField.getValue()})// #2   })       .then(response =&gt; response.json())       .then(data =&gt; this.setState(data));  // #3 }</code> </pre> <br>  <b>1.</b> URL √† laquelle la requ√™te POST est ex√©cut√©e.  Il est entendu que cette adresse contient une application qui attend de telles demandes. <br><br>  <b>2.</b> L'organisme de demande envoy√© √† la demande.  Voici un exemple de corps de demande: <br><br><pre> <code class="plaintext hljs">{   sentence: "I like yogobella!" }</code> </pre> <br>  <b>3.</b> D√®s r√©ception d'une r√©ponse √† la demande, l'√©tat du composant est mis √† jour.  Cela provoque le rendu du composant.  Si nous recevons des donn√©es (c'est-√†-dire un objet JSON contenant les donn√©es entr√©es et le score de texte calcul√©), nous afficherons la composante <code>Polarity</code> , car les conditions correspondantes seront remplies.  Voici comment nous d√©crivons le composant: <br><br><pre> <code class="plaintext hljs">const polarityComponent = this.state.polarity !== undefined ?   &lt;Polarity sentence={this.state.sentence}             polarity={this.state.polarity}/&gt; :   null;</code> </pre> <br>  Le code semble fonctionner assez bien.  Qu'est-ce qui ne va pas ici, apr√®s tout?  Si vous supposez qu'√† l'adresse o√π l'application essaie d'envoyer une demande POST, il n'y a jusqu'√† pr√©sent rien qui puisse accepter et traiter cette demande, alors vous aurez absolument raison.  √Ä savoir, pour traiter les demandes arrivant √† l'adresse <code>http://localhost:8080/sentiment</code> , nous devons ex√©cuter une application Web bas√©e sur Spring. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/848/f16/5a3/848f165a308f9ae73ffd3f8186b23aee.png"></div><br>  <i><font color="#999999">Nous avons besoin d'une application Spring qui peut accepter une demande POST.</font></i> <br><br><h3>  <font color="#3AC1EF">‚ñçConfigurez une application Web bas√©e sur Spring</font> </h3><br>  Pour d√©ployer l'application Spring, vous aurez besoin de JDK8 et Maven et de variables d'environnement correctement configur√©es.  Apr√®s avoir install√© tout cela, vous pouvez continuer √† travailler sur notre projet. <br><br><h3>  <font color="#3AC1EF">‚ñçEmballage de l'application dans un fichier jar</font> </h3><br>  Acc√©dez, √† l'aide du terminal, au dossier <code>sa-webapp</code> et entrez la commande suivante: <br><br><pre> <code class="plaintext hljs">mvn install</code> </pre> <br>  Apr√®s avoir ex√©cut√© cette commande, le r√©pertoire <code>target</code> sera cr√©√© dans le dossier <code>sa-webapp</code> .  Il y aura une application Java emball√©e dans un fichier jar repr√©sent√© par <code>sentiment-analysis-web-0.0.1-SNAPSHOT.jar</code> . <br><br><h3>  <font color="#3AC1EF">‚ñçD√©marrez l'application Java</font> </h3><br>  Acc√©dez au dossier <code>target</code> et lancez l'application avec la commande suivante: <br><br><pre> <code class="plaintext hljs">java -jar sentiment-analysis-web-0.0.1-SNAPSHOT.jar</code> </pre> <br>  Une erreur se produira lors de l'ex√©cution de cette commande.  Afin de commencer √† le r√©parer, nous pouvons analyser les informations d'exception dans les donn√©es de trace de pile: <br><br><pre> <code class="plaintext hljs">Error creating bean with name 'sentimentController': Injection of autowired dependencies failed; nested exception is java.lang.IllegalArgumentException: Could not resolve placeholder 'sa.logic.api.url' in value "${sa.logic.api.url}"</code> </pre> <br>  Pour nous, la chose la plus importante ici est la mention de l'impossibilit√© de d√©terminer la signification de <code>sa.logic.api.url</code> .  Analysons le code dans lequel l'erreur se produit. <br><br><h3>  <font color="#3AC1EF">‚ñç Analyse de code d'application Java</font> </h3><br>  Voici l'extrait de code o√π l'erreur se produit. <br><br><pre> <code class="plaintext hljs">@CrossOrigin(origins = "*") @RestController public class SentimentController {   @Value("${sa.logic.api.url}")    // #1   private String saLogicApiUrl;   @PostMapping("/sentiment")   public SentimentDto sentimentAnalysis(       @RequestBody SentenceDto sentenceDto)   {       RestTemplate restTemplate = new RestTemplate();       return restTemplate.postForEntity(               saLogicApiUrl + "/analyse/sentiment",    // #2               sentenceDto, SentimentDto.class)               .getBody();   } }</code> </pre> <br><ol><li>  S <code>entimentController</code> a un champ <code>saLogicApiUrl</code> .  Sa valeur est d√©finie par la propri√©t√© <code>sa.logic.api.url</code> . </li><li>  La cha√Æne <code>saLogicApiUrl</code> concat√©n√©e avec la valeur <code>/analyse/sentiment</code> .  Ensemble, ils forment une adresse pour acc√©der √† un microservice qui effectue une analyse de texte. </li></ol><br><h3>  <font color="#3AC1EF">‚ñçD√©finir la valeur de la propri√©t√©</font> </h3><br>  Dans Spring, la source standard des valeurs de propri√©t√© est le fichier <code>application.properties</code> , qui se trouve dans <code>sa-webapp/src/main/resources</code> .  Mais son utilisation n'est pas le seul moyen de d√©finir des valeurs de propri√©t√©.  Vous pouvez le faire avec une commande comme la suivante: <br><br><pre> <code class="plaintext hljs">java -jar sentiment-analysis-web-0.0.1-SNAPSHOT.jar --sa.logic.api.url=WHAT.IS.THE.SA.LOGIC.API.URL</code> </pre> <br>  La valeur de cette propri√©t√© doit pointer vers l'adresse de notre application Python. <br><br>  En le configurant, nous indiquons √† l'application Web Spring o√π elle doit aller pour ex√©cuter les demandes d'analyse de texte. <br><br>  Afin de ne pas compliquer nos vies, nous d√©cidons que l'application Python sera disponible sur <code>localhost:5000</code> et essayons de ne pas l'oublier.  Par cons√©quent, la commande pour lancer l'application Spring ressemblera √† ceci: <br><br><pre> <code class="plaintext hljs">java -jar sentiment-analysis-web-0.0.1-SNAPSHOT.jar --sa.logic.api.url=http://localhost:5000</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30d/445/815/30d44581533865907366e867c029124e.png"></div><br>  <i><font color="#999999">Notre syst√®me n'a pas d'application Python</font></i> <br><br>  Il ne nous reste plus qu'√† d√©marrer l'application Python et le syst√®me fonctionnera comme pr√©vu. <br><br><h3>  <font color="#3AC1EF">‚ñçConfiguration d'une application Python</font> </h3><br>  Pour ex√©cuter une application Python, vous devez avoir install√© Python 3 et Pip, et vous devez d√©finir correctement les variables d'environnement appropri√©es. <br><br><h3>  <font color="#3AC1EF">‚ñçInstallation de d√©pendances</font> </h3><br>  Acc√©dez au dossier du projet <code>sa-logic/sa</code> et ex√©cutez les commandes suivantes: <br><br><pre> <code class="plaintext hljs">python -m pip install -r requirements.txt python -m textblob.download_corpora</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçD√©marrez l'application</font> </h3><br>  Apr√®s avoir install√© les d√©pendances, nous sommes pr√™ts √† lancer l'application: <br><br><pre> <code class="plaintext hljs">python sentiment_analysis.py</code> </pre> <br>  Apr√®s avoir ex√©cut√© cette commande, nous serons inform√©s des √©l√©ments suivants: <br><br><pre> <code class="plaintext hljs">* Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</code> </pre> <br>  Cela signifie que l'application est en cours d'ex√©cution et attend les demandes sur <code>localhost:5000/</code> <br><br><h3>  <font color="#3AC1EF">‚ñç Recherche de code</font> </h3><br>  Consid√©rez le code d'application Python pour comprendre comment il r√©pond aux demandes: <br><br><pre> <code class="plaintext hljs">from textblob import TextBlob from flask import Flask, request, jsonify app = Flask(__name__)                                   #1 @app.route("/analyse/sentiment", methods=['POST'])      #2 def analyse_sentiment():   sentence = request.get_json()['sentence']           #3   polarity = TextBlob(sentence).sentences[0].polarity #4   return jsonify(                                     #5       sentence=sentence,       polarity=polarity   ) if __name__ == '__main__':   app.run(host='0.0.0.0', port=5000)                #6</code> </pre> <br><ol><li>  Initialisation d'un objet <code>Flask</code> . </li><li>  D√©finition de l'adresse pour lui ex√©cuter des requ√™tes POST. </li><li>  R√©cup√©ration de la propri√©t√© de <code>sentence</code> du corps de la requ√™te. </li><li>  Initialisation de l'objet <code>TextBlob</code> anonyme et obtention de la valeur de <code>polarity</code> pour la premi√®re phrase dans le corps de la requ√™te (dans notre cas, c'est la seule phrase pass√©e pour analyse). </li><li>  Le retour de la r√©ponse, dans le corps duquel se trouve le texte de la proposition et l'indice de <code>polarity</code> calcul√© pour celle-ci. </li><li>  Lancement de l'application Flask, qui sera disponible √† l'adresse <code>0.0.0.0:5000</code> (vous pouvez √©galement y acc√©der en utilisant un design du formulaire <code>localhost:5000</code> ). </li></ol><br>  Maintenant, les microservices qui composent l'application sont en cours d'ex√©cution.  Ils sont configur√©s pour interagir les uns avec les autres.  Voici √† quoi ressemble le diagramme d'application √† ce stade du travail. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75a/fcc/135/75afcc1352ed237efaf0a2280c2df295.png"></div><br>  <i><font color="#999999">Tous les microservices qui composent l'application sont port√©s √† un √©tat sain.</font></i> <br><br>  Maintenant, avant de continuer, ouvrez l'application React dans un navigateur et essayez d'analyser certaines suggestions en l'utilisant.  Si tout est fait correctement, apr√®s avoir cliqu√© sur le bouton <code>Send</code> , vous verrez les r√©sultats de l'analyse sous la zone de texte. <br><br>  Dans la section suivante, nous expliquerons comment ex√©cuter nos microservices dans des conteneurs Docker.  Cela est n√©cessaire pour pr√©parer le lancement de l'application dans le cluster Kubernetes. <br><br><h2>  <font color="#3AC1EF">Conteneurs Docker</font> </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kubernetes</a> est un syst√®me d'automatisation du d√©ploiement, de la mise √† l'√©chelle et de la gestion des applications conteneuris√©es.  Il est √©galement appel√© ¬´orchestrateur de conteneurs¬ª.  Si Kubernetes fonctionne avec des conteneurs, nous devons d'abord acqu√©rir ces conteneurs avant d'utiliser ce syst√®me.  Mais d'abord, parlons de ce que sont les conteneurs.  Peut-√™tre que la meilleure r√©ponse √† la question de savoir de quoi il s'agit se trouve dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> de Docker: <br><br>  <i>Une image de conteneur est un package ex√©cutable l√©ger et autonome contenant une application qui comprend tout ce dont vous avez besoin pour l'ex√©cuter: code d'application, runtime, outils et biblioth√®ques syst√®me et param√®tres.</i>  <i>Les programmes conteneuris√©s peuvent √™tre utilis√©s dans des environnements Linux et Windows, et ils fonctionneront toujours de la m√™me mani√®re, quelle que soit l'infrastructure.</i> <br><br>  Cela signifie que les conteneurs peuvent √™tre ex√©cut√©s sur n'importe quel ordinateur, y compris les serveurs de production, et dans n'importe quel environnement, les applications qu'ils contiennent fonctionneront de la m√™me mani√®re. <br><br>  Afin d'explorer les fonctionnalit√©s des conteneurs et de les comparer avec d'autres fa√ßons de lancer des applications, consid√©rez un exemple de service d'une application React √† l'aide d'une machine virtuelle et d'un conteneur. <br><br><h3>  <font color="#3AC1EF">‚ñçServing React application static files using virtual machine</font> </h3><br>  En essayant d'organiser la maintenance des fichiers statiques au moyen de machines virtuelles, nous rencontrerons les inconv√©nients suivants: <br><br><ol><li>  Utilisation inefficace des ressources, car chaque machine virtuelle est un syst√®me d'exploitation √† part enti√®re. </li><li>  D√©pend de la plateforme.  Ce qui fonctionne sur un certain ordinateur local peut ne pas fonctionner sur un serveur de production. </li><li>  Mise √† l'√©chelle lente et gourmande en ressources d'une solution bas√©e sur une machine virtuelle. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c26/927/523/c26927523b6072ce65bfaf8b01a1e330.png"></div><br>  <i><font color="#999999">Serveur Web Nginx static server s'ex√©cutant sur une machine virtuelle</font></i> <br><br>  Si les conteneurs sont utilis√©s pour r√©soudre un probl√®me similaire, alors, par rapport aux machines virtuelles, leurs forces suivantes peuvent √™tre not√©es: <br><br><ol><li>  Utilisation efficace des ressources: travailler avec le syst√®me d'exploitation √† l'aide de Docker. </li><li>  Ind√©pendance de la plateforme.  Un conteneur qu'un d√©veloppeur peut ex√©cuter sur son ordinateur fonctionnera n'importe o√π. </li><li>  D√©ploiement l√©ger gr√¢ce √† l'utilisation de couches d'image. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28b/593/b01/28b593b01ce003c246843d9c9f2bd05f.png"></div><br>  <i><font color="#999999">Serveur Web Nginx static server s'ex√©cutant dans un conteneur</font></i> <br><br>  Nous n'avons compar√© les machines virtuelles et les conteneurs que sur quelques points, mais m√™me cela suffit pour ressentir les points forts des conteneurs.  En savoir plus sur les conteneurs Docker ici. <br><br><h3>  <font color="#3AC1EF">‚ñç Assemblage d'une image de conteneur pour une application React</font> </h3><br>  Le bloc de construction principal du conteneur Docker est le <code>Dockerfile</code> .  Au d√©but de ce fichier, enregistrez l'image de base du conteneur, puis incluez une s√©quence d'instructions qui indique l'ordre dans lequel le conteneur sera cr√©√© et qui r√©pondra aux besoins d'une certaine application. <br><br>  Avant de <code>Dockerfile</code> √† travailler avec le <code>Dockerfile</code> , rappelons-nous ce que nous avons fait afin de pr√©parer les fichiers d'application React √† t√©l√©charger sur le serveur Nginx: <br><br><ol><li>  Cr√©ez un package d'application React ( <code>npm run build</code> ). </li><li>  D√©marrage du serveur Nginx. </li><li>  Copiez le contenu du r√©pertoire de <code>build</code> du dossier du projet <code>sa-frontend</code> dans le dossier du serveur <code>nginx/html</code> . </li></ol><br>  Ci-dessous, vous pouvez voir les parall√®les entre la cr√©ation du conteneur et les actions ci-dessus effectu√©es sur l'ordinateur local. <br><br><h3>  <font color="#3AC1EF">‚ñçPr√©paration d'un Dockerfile pour SA-Frontend</font> </h3><br>  Les instructions qui seront contenues dans le <code>Dockerfile</code> pour l'application <code>SA-Frontend</code> consistent en seulement deux commandes.  Le fait est que l'√©quipe de d√©veloppement de Nginx a pr√©par√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">image de</a> base pour Nginx, que nous utiliserons pour cr√©er notre image.  Voici les deux √©tapes que nous devons d√©crire: <br><br><ol><li>  La base de l'image dont vous avez besoin pour cr√©er l'image de Nginx. </li><li>  Le contenu du dossier <code>sa-frontend/build</code> doit √™tre copi√© dans le dossier image <code>nginx/html</code> . </li></ol><br>  Si nous passons de cette description au <code>Dockerfile</code> , cela ressemblera √† ceci: <br><br><pre> <code class="plaintext hljs">FROM nginx COPY build /usr/share/nginx/html</code> </pre> <br>  Comme vous pouvez le voir, tout est tr√®s simple ici, tandis que le contenu du fichier est m√™me assez lisible et compr√©hensible.  Ce fichier indique au syst√®me de prendre l'image <code>nginx</code> avec tout ce qu'il poss√®de d√©j√† et de copier le contenu du r√©pertoire de <code>build</code> r√©pertoire <code>nginx/html</code> . <br><br>  Ici, vous pouvez avoir une question concernant d'o√π je sais exactement o√π copier les fichiers du dossier de <code>build</code> , c'est-√†-dire d'o√π vient le chemin <code>/usr/share/nginx/html</code> .  En fait, et il n'y a rien de compliqu√©.  Le fait est que les informations pertinentes peuvent √™tre trouv√©es dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">description de l'</a> image. <br><br><h3>  <font color="#3AC1EF">‚ñçConstruction d'une image et t√©l√©chargement vers le r√©f√©rentiel</font> </h3><br>  Avant de pouvoir travailler avec l'image finie, nous devons l'envoyer au r√©f√©rentiel d'images.  Pour ce faire, nous utiliserons la plateforme cloud gratuite pour l'h√©bergement des images Docker Hub.  √Ä ce stade du travail, vous devez effectuer les op√©rations suivantes: <br><br><ol><li>  Installez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Docker</a> . </li><li>  Inscrivez-vous sur le site Web de Docker Hub. </li><li>  Connectez-vous au compte en ex√©cutant la commande suivante dans le terminal: <br><br><pre> <code class="plaintext hljs">docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"</code> </pre> </li></ol><br>  Vous devez maintenant utiliser le terminal pour acc√©der au r√©pertoire <code>sa-frontend</code> et y ex√©cuter la commande suivante: <br><br><pre> <code class="plaintext hljs">docker build -f Dockerfile -t $DOCKER_USER_ID/sentiment-analysis-frontend .</code> </pre> <br>  Ci-apr√®s dans des commandes similaires, <code>$DOCKER_USER_ID</code> doit √™tre remplac√© par votre nom d'utilisateur sur le Docker Hub.  Par exemple, cette partie de la commande pourrait ressembler √† ceci: <code>rinormaloku/sentiment-analysis-frontend</code> . <br><br>  Dans le m√™me temps, cette commande peut √™tre raccourcie en supprimant <code>-f Dockerfile</code> , car ce fichier existe d√©j√† dans le dossier dans lequel nous ex√©cutons cette commande. <br><br>  Afin d'envoyer l'image finie au r√©f√©rentiel, nous avons besoin de la commande suivante: <br><br><pre> <code class="plaintext hljs">docker push $DOCKER_USER_ID/sentiment-analysis-frontend</code> </pre> <br>  Apr√®s son ex√©cution, v√©rifiez la liste de vos r√©f√©rentiels sur le Docker Hub afin de comprendre si l'image a √©t√© envoy√©e avec succ√®s dans le cloud. <br><br><h3>  <font color="#3AC1EF">‚ñçD√©marrer le conteneur</font> </h3><br>  D√©sormais, n'importe qui peut t√©l√©charger et ex√©cuter une image connue sous le nom de <code>$DOCKER_USER_ID/sentiment-analysis-frontend</code> .  Pour ce faire, vous devez ex√©cuter la s√©quence de commandes suivante: <br><br><pre> <code class="plaintext hljs">docker pull $DOCKER_USER_ID/sentiment-analysis-frontend docker run -d -p 80:80 $DOCKER_USER_ID/sentiment-analysis-frontend</code> </pre> <br>  Maintenant, le conteneur est lanc√© et nous pouvons continuer √† travailler, cr√©ant les autres images dont nous avons besoin.  Mais, avant de continuer, <code>80:80</code> construction <code>80:80</code> , qui se trouve dans la commande de lancement d'image et peut sembler incompr√©hensible. <br><br><ul><li>  Le premier num√©ro <code>80</code> est le num√©ro de port h√¥te (c'est-√†-dire l'ordinateur local). </li><li>  Le deuxi√®me num√©ro <code>80</code> est le port du conteneur vers lequel la demande doit √™tre redirig√©e. </li></ul><br>  Consid√©rez l'illustration suivante. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/775/394/6cd/7753946cde3287113b82f00921ced889.png"></div><br>  <i><font color="#999999">Transfert de port</font></i> <br><br>  Le syst√®me redirige les demandes du port <code>&lt;hostPort&gt;</code> vers le port <code>&lt;containerPort&gt;</code> .  Autrement dit, l'acc√®s au port <code>80</code> ordinateur est redirig√© vers le port <code>80</code> conteneur. <br><br>  Le port <code>80</code> ouvert sur l'ordinateur local, vous pouvez acc√©der √† l'application √† partir de cet ordinateur sur <code>localhost:80</code> .  Si votre syst√®me ne prend pas en charge Docker, vous pouvez ex√©cuter l'application sur la machine virtuelle Docker, dont l'adresse ressemblera √† <code>&lt;docker-machine ip&gt;:80</code> .  Afin de d√©couvrir l'adresse IP de la machine virtuelle Docker, vous pouvez utiliser la commande <code>docker-machine ip</code> . <br><br>  √Ä ce stade, apr√®s avoir lanc√© avec succ√®s le conteneur d'application frontale, vous devriez pouvoir ouvrir sa page dans un navigateur. <br><br><h3>  <font color="#3AC1EF">‚ñç Fichier .dockerignore</font> </h3><br>  En collectant l'image de l'application <code>SA-Frontend</code> , nous avons pu remarquer que ce processus est extr√™mement lent.  Cela se produit du fait que le contexte de g√©n√©ration de l'image doit √™tre envoy√© au d√©mon Docker.  Le r√©pertoire repr√©sentant le contexte de g√©n√©ration est sp√©cifi√© par le dernier argument de la <code>docker build</code> .  Dans notre cas, √† la fin de cette commande est un point.  Il en r√©sulte que la structure suivante est incluse dans le contexte d'assemblage: <br><br><pre> <code class="plaintext hljs">sa-frontend: |   .dockerignore |   Dockerfile |   package.json |   README.md +---build +---node_modules +---public \---src</code> </pre> <br>  Mais de tous les dossiers pr√©sents ici, nous n'avons besoin que du dossier de <code>build</code> .  T√©l√©charger quoi que ce soit d'autre est une perte de temps.  Les builds peuvent √™tre acc√©l√©r√©s en indiquant √† Docker quels r√©pertoires ignorer.  C'est pour cela que nous avons besoin d'un fichier <code>.dockerignore</code> .  Si vous connaissez le fichier <code>.gitignore</code> , la structure de ce fichier vous semblera s√ªrement famili√®re.  Il r√©pertorie les r√©pertoires que le syst√®me d'assemblage d'images peut ignorer.  Dans notre cas, le contenu de ce fichier ressemble √† ceci: <br><br><pre> <code class="plaintext hljs">node_modules src public</code> </pre> <br>  Le fichier <code>.dockerignore</code> doit se trouver dans le m√™me dossier que le <code>Dockerfile</code> .  L'assemblage de l'image prendra maintenant quelques secondes. <br><br>  Jetons maintenant un ≈ìil √† l'application Java. <br><br><h3> <font color="#3AC1EF">‚ñç    Java-</font> </h3><br>  ,           .       . <br><br>   <code>Dockerfile</code> ,      <code>sa-webapp</code> .      ,         ,     <code>ENV</code>  <code>EXPOSE</code> : <br><br><pre> <code class="plaintext hljs">ENV SA_LOGIC_API_URL http://localhost:5000 ‚Ä¶ EXPOSE 8080</code> </pre> <br>   <code>ENV</code>       Docker.  ,       URL    API ,   . <br><br>   <code>EXPOSE</code>   Docker  ,    .          .   ,   <code>Dockerfile</code>   <code>SA-Frontend</code>   .      ,  ,     ,    <code>Dockerfile</code> . <br><br>           ,    .           ‚Äî       <code>README.md</code>   <code>sa-webapp</code> . <br><br><h3> <font color="#3AC1EF">‚ñç    Python-</font> </h3><br>       <code>Dockerfile</code>   <code>sa-logic</code> ,         .               ,  ,        ,     <code>README.md</code>   <code>sa-logic</code> . <br><br><h3> <font color="#3AC1EF">‚ñç  </font> </h3><br>     - ,    ?    .   . <br><br><ol><li>    <code>sa-logic</code>       <code>5050</code> : <br><br><pre> <code class="plaintext hljs">docker run -d -p 5050:5000 $DOCKER_USER_ID/sentiment-analysis-logic</code> </pre> </li><li>    <code>sa-webapp</code>       <code>8080</code> .  ,    ,   Python-     Java-,    <code>SA_LOGIC_API_URL</code> : <br><br><pre> <code class="plaintext hljs">$ docker run -d -p 8080:8080 -e SA_LOGIC_API_URL='http://&lt;container_ip or docker machine ip&gt;:5000' $DOCKER_USER_ID/sentiment-analysis-web-app</code> </pre> </li></ol><br>      ,   IP-     Docker ‚Äî    <a href="">README</a> . <br><br>    <code>sa-frontend</code> : <br><br><pre> <code class="plaintext hljs">docker run -d -p 80:80 $DOCKER_USER_ID/sentiment-analysis-frontend</code> </pre> <br>     ,       <code>localhost:80</code>   . <br><br>    ,       <code>sa-webapp</code> ,        Docker,     <code>App.js</code>   <code>sa-frontend</code> ,  IP-      <code>analyzeSentence()</code> ,      .         . <br><br>       . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/71e/87a/79671e87adea76c8873cac180e2fe8c0.png"></div><br> <i><font color="#999999">   </font></i> <br><br><h2> <font color="#3AC1EF">:    Kubernetes?</font> </h2><br>      <code>Dockerfile</code> ,   ,         Docker.  ,     ,   <code>.dockerignore</code> .         Docker.          ,   Kubernetes.          .      : <br> ,   -      .       .  ,   <code>sa-webapp</code>  <code>sa-logic</code>     .   ,    ? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438982/">https://habr.com/ru/post/fr438982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438972/index.html">Le cerveau de l'int√©rieur (visualisation du passage du motif √† travers le mod√®le de r√©seau de neurones artificiels)</a></li>
<li><a href="../fr438974/index.html">La r√©alit√© virtuelle aide √† faire face aux troubles mentaux</a></li>
<li><a href="../fr438976/index.html">Le livre "Spring. Tous les mod√®les de conception ¬ª</a></li>
<li><a href="../fr438978/index.html">Apprendre toujours et partout! Podcasts pour les d√©veloppeurs en anglais</a></li>
<li><a href="../fr438980/index.html">Spring Boot 2: quoi de neuf?</a></li>
<li><a href="../fr438984/index.html">Guide Kubernetes, Partie 2: Cr√©ation et utilisation d'un cluster</a></li>
<li><a href="../fr438986/index.html">Tutoriel React Partie 14: Atelier sur les composants bas√©s sur les classes, √©tat des composants</a></li>
<li><a href="../fr438988/index.html">Tutoriel React Partie 15: Ateliers sur l'√©tat des composants</a></li>
<li><a href="../fr438992/index.html">Journal du d√©veloppeur ou mauvaises d√©cisions</a></li>
<li><a href="../fr438994/index.html">Intel Xeon W-3175X, un batteur √† chaud. Test</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>