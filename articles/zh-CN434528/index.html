<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘²ğŸ¼ ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ ğŸ¥… æ˜ä¿¡ç‰‡å¤§å°çš„å°„çº¿è¿½è¸ªå™¨è§£å¯† â™¨ï¸ â™¨ï¸ ğŸ‘©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="â€œä»–åˆåšäº†ä¸€æ¬¡ï¼â€-è¿™æ˜¯æˆ‘çœ‹ç€çš®å…‹æ–¯ä¼ å•[1]çš„èƒŒé¢æ—¶æƒ³åˆ°çš„ç¬¬ä¸€ä»¶äº‹ï¼Œä¼ å•å®Œå…¨å……æ»¡äº†ä»£ç ã€‚ åœ¨å³ä¸‹è§’ï¼Œç”±å®‰å¾·é²Â·è‚¯æ–¯å‹’ï¼ˆAndrew Kenslerï¼‰ç­¾åäº†ä¸€ç»„æ„é€ å’Œè¡¨è¾¾ã€‚ å¯¹äºé‚£äº›ä¸è®¤è¯†ä»–çš„äººï¼Œæˆ‘ä¼šè¯´ï¼šAndrewæ˜¯ä¸€ä½ç¨‹åºå‘˜ï¼Œä»–äº2009å¹´å‘æ˜äº†1337å­—èŠ‚åç‰‡å¤§å°çš„å°„çº¿è¿½è¸ªå™¨ ã€‚ 

 è¿™æ¬¡ï¼Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æ˜ä¿¡ç‰‡å¤§å°çš„å°„çº¿è¿½è¸ªå™¨è§£å¯†</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434528/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/cr/xz/vj/crxzvjqqbw5gl4mv3wxxx2zw6wa.png"></div><br>  â€œä»–åˆåšäº†ä¸€æ¬¡ï¼â€-è¿™æ˜¯æˆ‘çœ‹ç€çš®å…‹æ–¯ä¼ å•<sup>[1]</sup>çš„èƒŒé¢æ—¶æƒ³åˆ°çš„ç¬¬ä¸€ä»¶äº‹ï¼Œä¼ å•å®Œå…¨å……æ»¡äº†ä»£ç ã€‚ åœ¨å³ä¸‹è§’ï¼Œç”±å®‰å¾·é²Â·è‚¯æ–¯å‹’ï¼ˆAndrew Kenslerï¼‰ç­¾åäº†ä¸€ç»„æ„é€ å’Œè¡¨è¾¾ã€‚ å¯¹äºé‚£äº›ä¸è®¤è¯†ä»–çš„äººï¼Œæˆ‘ä¼šè¯´ï¼šAndrewæ˜¯ä¸€ä½ç¨‹åºå‘˜ï¼Œä»–äº2009å¹´å‘æ˜äº†1337å­—èŠ‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åç‰‡å¤§å°çš„å°„çº¿è¿½è¸ªå™¨</a> ã€‚ <br><br> è¿™æ¬¡ï¼Œå®‰å¾·é²æƒ³å‡ºäº†å¾ˆå¤šä¸œè¥¿ï¼Œä½†è§†è§‰æ•ˆæœå´æ›´æœ‰è¶£ã€‚ è‡ªä»æˆ‘å†™å®Œæœ‰å…³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wolf3D</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DOOMçš„</a>æ¸¸æˆå¼•æ“é»‘çš®ä¹¦<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»¥æ¥</a> ï¼Œæˆ‘å°±æœ‰æ—¶é—´å­¦ä¹ å…¶éšç§˜ä»£ç çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†…å¹•</a> ã€‚ å‡ ä¹ç«‹å³ï¼Œæˆ‘å¯¹ä»–èº«ä¸Šå‘ç°çš„æŠ€æœ¯ç€è¿·äº†ã€‚ å®ƒä»¬ä¸å®‰å¾·é²ä»¥å‰çš„å·¥ä½œå®Œå…¨ä¸åŒï¼Œåè€…åŸºäºâ€œæ ‡å‡†â€å°„çº¿è¿½è¸ªå™¨ã€‚ æˆ‘æ„Ÿå…´è¶£çš„æ˜¯äº†è§£å°„çº¿è¡Œè¿›ï¼Œæ„é€ ä½“ç§¯å‡ ä½•çš„åŠŸèƒ½ï¼Œè’™ç‰¹å¡æ´›æ¸²æŸ“/è·¯å¾„è·Ÿè¸ªä»¥åŠä»–ç”¨æ¥å°†ä»£ç å‹ç¼©åˆ°è¿™ä¹ˆå°çš„çº¸ä¸Šçš„è®¸å¤šå…¶ä»–æŠ€å·§ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yc/z4/nt/ycz4ntg3qh91i6m2wymfccaekvk.png"></div><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lf/2o/qv/lf2oqvd5d39pyfwxyixvjnrmlqq.png"></div><br><h2> æºä»£ç  </h2><br><hr><br> ä¼ å•çš„æ­£é¢æ˜¯çš®å…‹æ–¯æ‹›è˜éƒ¨é—¨çš„å¹¿å‘Šã€‚ åœ¨èƒŒé¢ï¼Œæ‰“å°äº†2037ä¸ªå­—èŠ‚çš„C ++ä»£ç ï¼Œå®ƒä»¬ç»è¿‡æ··æ·†å¤„ç†ä»¥å æ®å°½å¯èƒ½å°çš„è¡¨é¢ã€‚ <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt; // card &gt; pixar.ppm #include &lt;stdio.h&gt; #include &lt;math.h&gt; #define R return #define O operator typedef float F;typedef int I;struct V{F x,y,z;V(F v=0){x=y=z=v;}V(F a,F b,F c=0){x=a;y=b;z=c;}V O+(V r){RV(x+rx,y+ry,z+rz);}VO*(V r){RV(x*rx,y*r. y,z*rz);}FO%(V r){R x*r.x+y*r.y+z*rz;}VO!(){R*this*(1/sqrtf(*this%*this) );}};FL(F l,F r){R l&lt;r?l:r;}FU(){R(F)rand()/RAND_MAX;}FB(V p,V l,V h){l=p +l*-1;h=h+p*-1;RL(L(L(lx,hx),L(ly,hy)),L(lz,hz));}FS(V p,I&amp;m){F d=1\ e9;V f=p;fz=0;char l[]="5O5_5W9W5_9_COC_AOEOA_E_IOQ_I_QOUOY_Y_]OWW[WaOa_aW\ eWa_e_cWiO";for(I i=0;i&lt;60;i+=4){V b=V(l[i]-79,l[i+1]-79)*.5,e=V(l[i+2]-79,l [i+3]-79)*.5+b*-1,o=f+(b+e*L(-L((b+f*-1)%e/(e%e),0),1))*-1;d=L(d,o%o);}d=sq\ rtf(d);V a[]={V(-11,6),V(11,6)};for(I i=2;i--;){V o=f+a[i]*-1;d=L(d,ox&gt;0?f\ absf(sqrtf(o%o)-2):(o.y+=oy&gt;0?-2:2,sqrtf(o%o)));}d=powf(powf(d,8)+powf(pz, 8),.125)-.5;m=1;F r=L(-L(B(p,V(-30,-.5,-30),V(30,18,30)),B(p,V(-25,17,-25),V (25,20,25))),B(V(fmodf(fabsf(px),8),py,pz),V(1.5,18.5,-25),V(6.5,20,25))) ;if(r&lt;d)d=r,m=2;F s=19.9-py;if(s&lt;d)d=s,m=3;R d;}IM(V o,V d,V&amp;h,V&amp;n){I m,s= 0;F t=0,c;for(;t&lt;100;t+=c)if((c=S(h=o+d*t,m))&lt;.01||++s&gt;99)R n=!V(S(h+V(.01,0 ),s)-c,S(h+V(0,.01),s)-c,S(h+V(0,0,.01),s)-c),m;R 0;}VT(V o,V d){V h,n,r,t= 1,l(!V(.6,.6,1));for(I b=3;b--;){I m=M(o,d,h,n);if(!m)break;if(m==1){d=d+n*( n%d*-2);o=h+d*.1;t=t*.2;}if(m==2){F i=n%l,p=6.283185*U(),c=U(),s=sqrtf(1-c), g=nz&lt;0?-1:1,u=-1/(g+nz),v=nx*ny*u;d=V(v,g+ny*ny*u,-ny)*(cosf(p)*s)+V( 1+g*nx*nx*u,g*v,-g*nx)*(sinf(p)*s)+n*sqrtf(c);o=h+d*.1;t=t*.2;if(i&gt;0&amp;&amp;M(h +n*.1,l,h,n)==3)r=r+t*V(500,400,100)*i;}if(m==3){r=r+t*V(50,80,100);break;}} R r;}I main(){I w=960,h=540,s=16;V e(-22,5,25),g=!(V(-3,4,0)+e*-1),l=!V(gz, 0,-gx)*(1./w),u(gy*lz-gz*ly,gz*lx-gx*lz,gx*ly-gy*lx);printf("P\ 6 %d %d 255 ",w,h);for(I y=h;y--;)for(I x=w;x--;){V c;for(I p=s;p--;)c=c+T(e ,!(g+l*(xw/2+U())+u*(yh/2+U())));c=c*(1./s)+14./241;V o=c+1;c=V(cx/ox,c. y/oy,cz/oz)*255;printf("%c%c%c",(I)cx,(I)cy,(I)cz);}}// Andrew Kensler</span></span></span></span></code> </pre> <br><h2> ä»–ç”šè‡³å·¥ä½œå—ï¼Ÿ </h2><br><hr><br> æœ‰äº†ä»£ç ï¼Œä¾¿æœ‰ä¸€ä¸ªå¯åŠ¨è¯´æ˜ã€‚ è¿™ä¸ªæƒ³æ³•æ˜¯å°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ã€‚ é€šè¿‡æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾è¾“å‡ºæ ¼å¼æ˜¯ä¸€ç§ç§°ä¸ºNetPBM <sup>[2]</sup>çš„æ–‡æœ¬å›¾åƒæ ¼å¼ã€‚ <br><br><pre>  $ clang -o card2 -O3 raytracer.cpp
 $æ—¶é—´./card&gt; pixar.ppm<font></font>
<font></font>
çœŸå®2m58.524s
ç”¨æˆ·2m57.567s
 sys 0m0.415s </pre><br> åœ¨2åˆ†58ç§’<sup>[3]ä¹‹å</sup> ï¼Œå°†ç”Ÿæˆä»¥ä¸‹å›¾åƒã€‚ ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå‡ ä¹ä¸éœ€è¦å¤šå°‘ä»£ç ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cae/b34/b5c/caeb34b5c6c57c4598adc8f6b3f28f38.webp"></div><br> æ‚¨å¯ä»¥ä»ä¸Šå›¾ä¸­æå–å¾ˆå¤šå†…å®¹ã€‚ åšéŸ§æ˜¯â€œè·¯å¾„è¿½è¸ªå™¨â€çš„æ˜æ˜¾æ ‡å¿—ã€‚ è¿™ç§ç±»å‹çš„æ¸²æŸ“å™¨ä¸å°„çº¿è·Ÿè¸ªçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå°„çº¿ä¸ä¼šè¿½æº¯åˆ°å…‰æºã€‚ åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªåƒç´ ä»å…‰æºå‘å°„å‡ºæ•°åƒæ¡å…‰çº¿ï¼Œç¨‹åºå¯¹å…¶è¿›è¡Œç›‘è§†ï¼Œå¸Œæœ›å®ƒä»¬èƒ½å¤Ÿæ‰¾åˆ°å…‰æºã€‚ è¿™æ˜¯ä¸€ç§æœ‰è¶£çš„æŠ€æœ¯ï¼Œå®ƒæ¯”å…‰çº¿è·Ÿè¸ªå¥½å¾—å¤šï¼Œå®ƒå¯ä»¥å¤„ç†ç¯å¢ƒå…‰é®æŒ¡ï¼ŒæŸ”å’Œé˜´å½±ï¼Œç„¦æ•£å’Œæ”¾å°„çº¿çš„æ¸²æŸ“ã€‚ <br><br><h2> æˆ‘ä»¬å°†æŠŠä»£ç åˆ†æˆå‡ éƒ¨åˆ† </h2><br><hr><br> å°†è¾“å…¥ä¼ é€’ç»™CLionä¼šæ ¼å¼åŒ–ä»£ç ï¼ˆè¯·å‚é˜…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>çš„è¾“å‡ºï¼‰ï¼Œå¹¶å°†å…¶åˆ†æˆè¾ƒå°çš„éƒ¨åˆ†/ä»»åŠ¡ã€‚ <br><br><pre>  <font color="grey">#include &lt;stdlib.h&gt; //å¡&gt; pixar.ppm</font> <font color="grey">
</font>  <font color="grey">#include &lt;stdio.h&gt;</font> <font color="grey">
</font>  <font color="grey">#include &lt;math.h&gt;</font> </pre><br><pre>  <font color="fuchsia">ï¼ƒå®šä¹‰Rè¿”å›</font> <font color="fuchsia">
</font>  <font color="fuchsia">ï¼ƒå®šä¹‰Oè¿ç®—ç¬¦</font> <font color="fuchsia">
</font>  <font color="fuchsia">typedef float F; typedef int I;</font> </pre><pre>  <font color="blue">ç»“æ„V {F xï¼Œyï¼Œz; Vï¼ˆF v = 0ï¼‰{x = y = z = v;} Vï¼ˆF aï¼ŒF bï¼ŒF</font> <font color="blue">
</font>  <font color="blue">c = 0ï¼‰{x = a; y = b; z = c;} V O +ï¼ˆV rï¼‰{RVï¼ˆx + rxï¼Œy + ryï¼Œz + rzï¼‰;} VO *ï¼ˆV rï¼‰{RVï¼ˆ x * rxï¼Œy * rã€‚</font> <font color="blue">
</font>  <font color="blue">yï¼Œz * rzï¼‰;} FOï¼…ï¼ˆV rï¼‰{R x * r.x + y * r.y + z * rz;} VOï¼ï¼ˆï¼‰{R *æ­¤*ï¼ˆ1 / sqrtfï¼ˆ*æ­¤ï¼… *è¿™ä¸ªï¼‰</font> <font color="blue">
</font>  <font color="blue">ï¼‰;}};</font> </pre><pre>  <font color="orange">FLï¼ˆF lï¼ŒF rï¼‰{R l &lt;rï¼ŸLï¼šr;} FUï¼ˆï¼‰{Rï¼ˆFï¼‰randï¼ˆï¼‰/ RAND_MAX;} FBï¼ˆV pï¼ŒV lï¼ŒV hï¼‰{l = p</font> <font color="orange">
</font>  <font color="orange">+ l * -1; h = h + p * -1; RLï¼ˆLï¼ˆLï¼ˆLï¼ˆlxï¼Œhxï¼‰ï¼ŒLï¼ˆlyï¼Œhyï¼‰ï¼‰ï¼ŒLï¼ˆlzï¼Œhzï¼‰ï¼‰;}</font> </pre><pre>  <font color="LimeGreen">FSï¼ˆV pï¼ŒIï¼†mï¼‰{F d = 1 \</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">e9; V f = p; fz = 0; char l [] =â€œ 5O5_5W9W5_9_COC_AOEOA_E_IOQ_I_QOUOY_Y_] OWW [WaOa_aW \</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">eWa_e_cWiOâ€œ;å¯¹äºï¼ˆI i = 0; i &lt;60; i + = 4ï¼‰{V b = Vï¼ˆl [i] -79ï¼Œl [i + 1] -79ï¼‰*ã€‚5ï¼Œe = Vï¼ˆl [ i + 2] -79ï¼Œl</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">[i + 3] -79ï¼‰*ã€‚5 + b * -1ï¼Œo = f +ï¼ˆb + e * Lï¼ˆ-Lï¼ˆï¼ˆb + f * -1ï¼‰ï¼…e /ï¼ˆeï¼…eï¼‰ï¼Œ0ï¼‰ï¼Œ 1ï¼‰ï¼‰*-1; d = Lï¼ˆdï¼Œoï¼…oï¼‰;} d = sq \</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">rtfï¼ˆdï¼‰; V a [] = {Vï¼ˆ-11.6ï¼‰ï¼ŒVï¼ˆ11.6ï¼‰};å¯¹äºï¼ˆI i = 2; i-;ï¼‰{V o = f + a [i] * -1; d = Lï¼ˆdï¼Œox&gt; 0ï¼ŸF \</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">absfï¼ˆsqrtfï¼ˆoï¼…oï¼‰-2ï¼‰:( o.y + = oy&gt; 0ï¼Ÿ-2ï¼š2ï¼Œsqrtfï¼ˆoï¼…oï¼‰ï¼‰ï¼‰;} d = powfï¼ˆpowfï¼ˆdï¼Œ8ï¼‰+ powfï¼ˆpz ï¼Œ</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">8ï¼‰,. 125ï¼‰-.5; m = 1; F r = Lï¼ˆ-Lï¼ˆBï¼ˆpï¼ŒVï¼ˆ-30ï¼Œ-ã€‚5ï¼Œ-30ï¼‰ï¼ŒVï¼ˆ30,18,30ï¼‰ï¼‰ï¼ŒB ï¼ˆpï¼ŒVï¼ˆ-25.17ï¼Œ-25ï¼‰ï¼ŒV</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">ï¼ˆ25,20,25ï¼‰ï¼‰ï¼‰ï¼ŒBï¼ˆVï¼ˆfmodfï¼ˆfabsfï¼ˆpxï¼‰ï¼Œ8ï¼‰ï¼Œpyï¼Œpzï¼‰ï¼ŒVï¼ˆ1.5,18.5ï¼Œ-25ï¼‰ï¼ŒVï¼ˆ6.5,20,25ï¼‰ï¼‰ï¼‰</font> <font color="LimeGreen">
</font>  <font color="LimeGreen">ï¼›å¦‚æœï¼ˆr &lt;dï¼‰d = rï¼Œm = 2ï¼› F s = 19.9-pyï¼›å¦‚æœï¼ˆs &lt;dï¼‰d = sï¼Œm = 3; R d;}</font> </pre><pre>  <font color="black">IMï¼ˆV oï¼ŒV dï¼ŒVï¼†hï¼ŒVï¼†nï¼‰{I mï¼Œs =</font> <font color="black">
</font>  <font color="black">0; F t = 0ï¼Œc;å¯¹äºï¼ˆ; t &lt;100; t + = cï¼‰å¦‚æœï¼ˆï¼ˆc = Sï¼ˆh = o + d * tï¼Œmï¼‰ï¼‰&lt;ã€‚01 || ++ s&gt; 99ï¼‰R n =ï¼Vï¼ˆSï¼ˆh + Vï¼ˆ.01,0</font> <font color="black">
</font>  <font color="black">ï¼‰ï¼Œsï¼‰-cï¼ŒSï¼ˆh + Vï¼ˆ0ï¼Œ.01ï¼‰ï¼Œsï¼‰-cï¼ŒSï¼ˆh + Vï¼ˆ0,0ï¼Œ.01ï¼‰ï¼Œsï¼‰-cï¼‰ï¼Œm; R 0;}</font> </pre><pre>  <font color="SkyBlue">VTï¼ˆV oï¼ŒV dï¼‰{V hï¼Œnï¼Œrï¼Œt =</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">1ï¼Œlï¼ˆï¼Vï¼ˆ.6ï¼Œ.6,1ï¼‰ï¼‰;å¯¹äºï¼ˆI b = 3; b-;ï¼‰{I m = Mï¼ˆoï¼Œdï¼Œhï¼Œnï¼‰;å¦‚æœï¼ˆï¼Mï¼‰ä¸­æ–­; ifï¼ˆm == 1ï¼‰{d = d + n *ï¼ˆ</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">nï¼…d * -2ï¼‰; o = h + d * .1; t = t * .2;}å¦‚æœï¼ˆm == 2ï¼‰{F i = nï¼…lï¼Œp = 6.283185 * Uï¼ˆï¼‰ï¼Œc = Uï¼ˆï¼‰ï¼Œs = sqrtfï¼ˆ1-cï¼‰ï¼Œ</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">g = nz &lt;0ï¼Ÿ-1ï¼š1ï¼Œu = -1 /ï¼ˆg + nzï¼‰ï¼Œv = nx * ny * u; d = Vï¼ˆvï¼Œg + ny * ny * uï¼Œ-nyï¼‰*ï¼ˆcosf ï¼ˆpï¼‰* sï¼‰+ Vï¼ˆ</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">1 + g * nx * nx * uï¼Œg * vï¼Œ-g * nxï¼‰*ï¼ˆsinfï¼ˆpï¼‰* sï¼‰+ n * sqrtfï¼ˆcï¼‰; o = h + d * .1; t = t *ã€‚ 2;å¦‚æœï¼ˆi&gt; 0 &amp;&amp; Mï¼ˆh</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">+ n * .1ï¼Œlï¼Œhï¼Œnï¼‰== 3ï¼‰r = r + t * Vï¼ˆ500,400,100ï¼‰* i;} ifï¼ˆm == 3ï¼‰{r = r + t * Vï¼ˆ50,80,100ï¼‰ ; break;}}</font> <font color="SkyBlue">
</font>  <font color="SkyBlue">R r;}</font> </pre><pre>  <font color="red">I mainï¼ˆï¼‰{I w = 960ï¼Œh = 540ï¼Œs = 16; V eï¼ˆ-22,5,25ï¼‰ï¼Œg =ï¼ï¼ˆVï¼ˆ-3,4,0ï¼‰+ e * -1ï¼‰ï¼Œl =ï¼Vï¼ˆgzï¼Œ</font> <font color="red">
</font>  <font color="red">0ï¼Œ-gxï¼‰*ï¼ˆ1./wï¼‰ï¼Œuï¼ˆgy * lz-gz * lyï¼Œgz * lx-gx * lzï¼Œgx * ly-gy * lxï¼‰; printfï¼ˆâ€œ P \</font> <font color="red">
</font>  <font color="red">6ï¼…dï¼…d 255â€œï¼Œwï¼Œhï¼‰;å¯¹äºï¼ˆI y = h; y-;ï¼‰å¯¹äºï¼ˆI x = w; x-;ï¼‰{V c;å¯¹äºï¼ˆI p = s; p- -;ï¼‰c = c + Tï¼ˆe</font> <font color="red">
</font>  <font color="red">ï¼Œï¼ï¼ˆg + l *ï¼ˆxw / 2 + Uï¼ˆï¼‰ï¼‰+ u *ï¼ˆyh / 2 + Uï¼ˆï¼‰ï¼‰ï¼‰ï¼‰ï¼‰; c = c *ï¼ˆ1./sï¼‰+ 14/241; V o = c +1; c = Vï¼ˆcx / oxï¼Œcã€‚</font> <font color="red">
</font>  <font color="red">y / oyï¼Œcz / ozï¼‰* 255; printfï¼ˆâ€œï¼…cï¼…cï¼…câ€ï¼Œï¼ˆIï¼‰cxï¼Œï¼ˆIï¼‰cyï¼Œï¼ˆIï¼‰czï¼‰;}}</font> </pre><pre>  <font color="LightGray">//å®‰å¾·é²Â·è‚¯æ–¯å‹’ï¼ˆAndrew Kenslerï¼‰</font> </pre><br> æœ¬æ–‡å…¶ä½™éƒ¨åˆ†å°†è¯¦ç»†ä»‹ç»æ¯ä¸ªéƒ¨åˆ†ï¼š <br>  <font color="fuchsia">â– </font> -æ™®é€šæŠ€å·§ï¼Œ <font color="blue">â– </font> -çŸ¢é‡ç±»ï¼Œ <font color="orange">â– </font> -è¾…åŠ©ä»£ç ï¼Œ <font color="LimeGreen">â– </font> -æ•°æ®åº“ï¼Œ <font color="black">â– </font> -å°„çº¿è¡Œè¿›ï¼Œ <font color="SkyBlue">â– </font> -é‡‡æ ·ï¼Œ <font color="red">â– </font> -ä¸»ä»£ç ã€‚ <br><br><h2>  #defineå’Œtypedefçš„å¸¸è§æŠ€å·§ </h2><br><hr><br> å¸¸è§çš„æŠ€å·§æ˜¯ä½¿ç”¨#defineå’Œtypedefæ¥æ˜¾ç€å‡å°‘ä»£ç é‡ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¡¨ç¤ºF =æµ®ç‚¹æ•°ï¼ŒI =æ•´æ•°ï¼ŒR =è¿”å›å€¼ï¼Œä»¥åŠO =è¿ç®—ç¬¦ã€‚ é€†å‘å·¥ç¨‹æ˜¯å¾®ä¸è¶³é“çš„ã€‚ <br><br><h2>  Vçº§ </h2><br><hr><br> æ¥ä¸‹æ¥æ˜¯Vç±»ï¼Œæˆ‘å°†å…¶é‡å‘½åä¸ºVecï¼ˆå°½ç®¡ï¼Œæ­£å¦‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢çœ‹åˆ°çš„é‚£æ ·ï¼Œå®ƒä¹Ÿç”¨äºä»¥æµ®ç‚¹æ ¼å¼å­˜å‚¨RGBé€šé“ï¼‰ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vec</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x, y, z; Vec(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> v = <span class="hljs-number"><span class="hljs-number">0</span></span>) { x = y = z = v; } Vec(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span>) { x = a; y = b; z = c;} Vec <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>+(Vec r) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vec(x + rx, y + ry, z + rz); } Vec <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>*(Vec r) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vec(x * rx, y * ry, z * rz); } <span class="hljs-comment"><span class="hljs-comment">// dot product float operator%(Vec r) { return x * rx + y * ry + z * rz; } // inverse square root Vec operator!() {return *this * (1 / sqrtf(*this % *this) );} };</span></span></code> </pre> <br> è¯·æ³¨æ„ï¼Œæ²¡æœ‰å‡æ³•è¿ç®—ç¬¦ï¼ˆ-ï¼‰ï¼Œå› æ­¤ä¸æ˜¯ä½¿ç”¨â€œ X = A-Bâ€ï¼Œè€Œæ˜¯ä½¿ç”¨â€œ X = A + B * -1â€ã€‚ å¹³æ–¹æ ¹åæ•°åœ¨ä»¥åæ–¹ä¾¿ä½¿ç”¨ä»¥æ ‡å‡†åŒ–å‘é‡ã€‚ <br><br><h2> ä¸»è¦åŠŸèƒ½ </h2><br><hr><br>  mainï¼ˆï¼‰æ˜¯å”¯ä¸€æ— æ³•æ··æ·†çš„å­—ç¬¦ï¼Œå› ä¸ºå®ƒæ˜¯ç”±libcåº“çš„_startå‡½æ•°è°ƒç”¨çš„ã€‚ é€šå¸¸å€¼å¾—ä¸€å¼€å§‹ï¼Œå› ä¸ºè¿™æ ·åšä¼šæ›´å®¹æ˜“ã€‚ æˆ‘èŠ±äº†ä¸€æ®µæ—¶é—´æ‰å¼„æ¸…é¦–å­—æ¯çš„å«ä¹‰ï¼Œä½†ä»ç„¶è®¾æ³•åˆ›å»ºäº†å¯è¯»çš„ä¸œè¥¿ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w = <span class="hljs-number"><span class="hljs-number">960</span></span>, h = <span class="hljs-number"><span class="hljs-number">540</span></span>, samplesCount = <span class="hljs-number"><span class="hljs-number">16</span></span>; <span class="hljs-function"><span class="hljs-function">Vec </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-22</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">25</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; Vec goal = !(Vec(<span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) + position * <span class="hljs-number"><span class="hljs-number">-1</span></span>); Vec left = !Vec(goal.z, <span class="hljs-number"><span class="hljs-number">0</span></span>, -goal.x) * (<span class="hljs-number"><span class="hljs-number">1.</span></span> / w); <span class="hljs-comment"><span class="hljs-comment">// Cross-product to get the up vector Vec up(goal.y * left.z - goal.z * left.y, goal.z * left.x - goal.x * left.z, goal.x * left.y - goal.y * left.x); printf("P6 %d %d 255 ", w, h); for (int y = h; y--;) for (int x = w; x--;) { Vec color; for (int p = samplesCount; p--;) color = color + Trace(position, !(goal + left * (x - w / 2 + randomVal())+ up * (y - h / 2 + randomVal()))); // Reinhard tone mapping color = color * (1. / samplesCount) + 14. / 241; Vec o = color + 1; color = Vec(color.x / ox, color.y / oy, color.z / oz) * 255; printf("%c%c%c", (int) color.x, (int) color.y, (int) color.z); } }</span></span></code> </pre> <br> è¯·æ³¨æ„ï¼Œæµ®ç‚¹æ–‡å­—ä¸åŒ…å«å­—æ¯â€œ fâ€ï¼Œå¹¶ä¸”å°æ•°éƒ¨åˆ†è¢«ä¸¢å¼ƒä»¥èŠ‚çœç©ºé—´ã€‚ ä¸‹é¢ä½¿ç”¨ç›¸åŒçš„æŠ€å·§ï¼Œå…¶ä¸­åˆ é™¤æ•´æ•°éƒ¨åˆ†ï¼ˆæµ®ç‚¹æ•°x = 0.5ï¼‰ã€‚ åŒæ ·ä¸å¯»å¸¸çš„æ˜¯åœ¨ä¸­æ–­æ¡ä»¶å†…æ’å…¥äº†è¿­ä»£è¡¨è¾¾å¼çš„â€œ forâ€æ„é€ ã€‚ <br><br> è¿™æ˜¯å…‰çº¿/è·¯å¾„è·Ÿè¸ªå™¨çš„ç›¸å½“æ ‡å‡†çš„ä¸»è¦åŠŸèƒ½ã€‚ åœ¨æ­¤è®¾ç½®ç›¸æœºçŸ¢é‡ï¼Œå¹¶ä¸ºæ¯ä¸ªåƒç´ å‘å°„å…‰çº¿ã€‚ å…‰çº¿è¿½è¸ªå™¨å’Œè·¯å¾„è¿½è¸ªå™¨ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼ŒTPä¸­çš„æ¯ä¸ªåƒç´ å‘å°„äº†å‡ æ¡å…‰çº¿ï¼Œè¿™äº›å…‰çº¿éšæœºåœ°éšæœºç§»åŠ¨ã€‚ ç„¶åï¼Œåœ¨ä¸‰ä¸ªæµ®åŠ¨é€šé“Rï¼ŒBï¼ŒGä¸­ç´¯ç§¯ä¸ºåƒç´ ä¸­çš„æ¯æ¡å°„çº¿è·å¾—çš„é¢œè‰²ã€‚ æœ€åï¼Œå¯¹Reinhardtæ–¹æ³•çš„ç»“æœè¿›è¡Œè‰²è°ƒæ ¡æ­£ã€‚ <br><br> æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯sampleCountï¼Œç†è®ºä¸Šå¯ä»¥å°†å…¶è®¾ç½®ä¸º1ä»¥åŠ å¿«æ¸²æŸ“å’Œè¿­ä»£é€Ÿåº¦ã€‚ ä»¥ä¸‹æ˜¯æ ·æœ¬æ¸²æŸ“ï¼Œæ ·æœ¬å€¼ä»‹äº1åˆ°2048ä¹‹é—´ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æ‰°æµæ¿æ–¹å‘</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/550/e66/b2b/550e66b2b1347f8cafdf18c50d89e40d.png"><br><br>  1ä¸ª <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f49/724/1f0/f497241f0e3bb43fcc9913d8a2745419.png"><br><br>  2 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f71/3f3/35c/f713f335c2842b995936db1499e307e5.png"><br><br>  4 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b4f/6d4/f56/b4f6d4f56198a64b8e569a62f7159e8a.png"><br><br>  8 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a70/200/3c6/a702003c61d4080c2f92fe84844238cd.png"><br><br>  16 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bcf/0d6/43c/bcf0d643c501839c2506c7c026bc445c.png"><br><br>  32 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f0/5cf/569/8f05cf5690fa3265a1a4fa6f60a35749.png"><br><br>  64 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ebd/c87/660/ebdc87660263ff14eb6bf03a95865f34.png"><br><br>  128 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d17/0d3/1ae/d170d31aed20aeafc54d877ed447a1cc.png"><br><br>  256 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb9/52c/4df/fb952c4dfd0a4cb14245cedd060dcf05.png"><br><br>  512 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/460/50f/715/46050f71582834ddebbeb29dd86940fc.png"><br><br>  1024 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/947/ea8/88b/947ea888b63c32f0892cc1e25b187bf8.png"><br><br>  2048 </div></div><br><h2> å¸®æ‰‹ä»£ç  </h2><br><hr><br> å¦ä¸€æ®µç®€å•çš„ä»£ç æ˜¯åŠ©æ‰‹åŠŸèƒ½ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªçç¢çš„å‡½æ•°minï¼ˆï¼‰ï¼Œä¸€ä¸ªåœ¨[0,1]åŒºé—´å†…çš„éšæœºå€¼ç”Ÿæˆå™¨ä»¥åŠä¸€ä¸ªæ›´æœ‰è¶£çš„boxTestï¼ˆï¼‰ï¼Œå®ƒæ˜¯ç”¨äºåˆ‡å‰²ä¸–ç•Œçš„æ„é€ å®ä½“å‡ ä½•ï¼ˆCSGï¼‰ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚ ä¸‹ä¸€èŠ‚å°†è®¨è®ºCSGã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> r)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> l &lt; r ? l : r; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randomVal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) rand() / RAND_MAX; } <span class="hljs-comment"><span class="hljs-comment">// Rectangle CSG equation. Returns minimum signed distance from // space carved by lowerLeft vertex and opposite rectangle // vertex upperRight. float BoxTest(Vec position, Vec lowerLeft, Vec upperRight) { lowerLeft = position + lowerLeft * -1; upperRight = upperRight + position * -1; return -min( min( min(lowerLeft.x, upperRight.x), min(lowerLeft.y, upperRight.y) ), min(lowerLeft.z, upperRight.z)); }</span></span></code> </pre> <br><h2> æ„é€ ä½“ç§¯å‡ ä½•çš„åŠŸèƒ½ </h2><br><hr><br> ä»£ç ä¸­æ²¡æœ‰é¡¶ç‚¹ã€‚ ä¸€åˆ‡éƒ½ä½¿ç”¨CSGåŠŸèƒ½å®Œæˆã€‚ å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰å®ƒä»¬ï¼Œåªéœ€è¯´è¿™äº›æ˜¯æè¿°åæ ‡æ˜¯åœ¨å¯¹è±¡å†…éƒ¨è¿˜æ˜¯å¤–éƒ¨çš„å‡½æ•°ã€‚ å¦‚æœå‡½æ•°è¿”å›æ­£è·ç¦»ï¼Œåˆ™è¯¥ç‚¹åœ¨å¯¹è±¡å†…éƒ¨ã€‚ è´Ÿè·ç¦»è¡¨ç¤ºè¯¥ç‚¹åœ¨å¯¹è±¡å¤–éƒ¨ã€‚ æœ‰è®¸å¤šç”¨äºæè¿°ä¸åŒå¯¹è±¡çš„å‡½æ•°ï¼Œä½†æ˜¯ä¸ºäº†ç®€åŒ–èµ·è§ï¼Œè®©æˆ‘ä»¬ä»¥ä¸€ä¸ªçƒä½“å’Œä¸¤ä¸ªç‚¹Aå’ŒBä¸ºä¾‹ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56f/424/13a/56f42413a77c51a3d06e12fd4b4b385e.svg" alt="å›¾ç‰‡"></div><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Signed distance point(p) to sphere(c,r) float testSphere(Vec p, Vec c, float r) { Vec delta = c - p; float distance = sqrtf(delta%delta); return radius - distance; } Vec A {4, 6}; Vec B {3, 2}; Vec C {4, 2}; float r = 2.; testSphere(A, C, r); // == -1 (outside) testSphere(B, C, r); // == 1 (inside)</span></span></code> </pre> <br>  testSphereï¼ˆï¼‰å‡½æ•°å¯¹äºç‚¹Aï¼ˆå³åœ¨å¤–éƒ¨ï¼‰è¿”å›-1ï¼Œå¯¹äºç‚¹Bï¼ˆå³åœ¨å†…éƒ¨ï¼‰è¿”å›1ã€‚ è¿œå¤„çš„ç¬¦å·åªæ˜¯ä¸€ä¸ªæŠ€å·§ï¼Œå®ƒä½¿æ‚¨å¯ä»¥è·å¾—ä¸¤æ¡ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å•ä¸ªå€¼çš„ä¿¡æ¯ã€‚ å¯ä»¥ç¼–å†™ç±»ä¼¼ç±»å‹çš„å‡½æ•°æ¥æè¿°å¹³è¡Œå››è¾¹å½¢ï¼ˆè¿™æ­£æ˜¯åœ¨BoxTestå‡½æ•°ä¸­æ‰§è¡Œçš„æ“ä½œï¼‰ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/757/1cd/25b/7571cd25baa7d2f9cfbd01f62e84aef1.svg"></div><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Signed distance point(p) to Box(c1,c2) float testRectangle(Vec p, Vec c1, Vec c2) { c1 = p + c1 * -1; c2 = c2 + position * -1; return min( min( min(c1.x, c2.x), min(c1.y, c2.y)), min(c1.z, c2.z)); } Vec A {3, 3}; Vec B {4, 6}; Vec C1 {2, 2}; Vec C2 {5, 4}; testRectangle(A, C1, C2); // 1.41 (inside) testRectangle(B, C1, C2); // -2.23 (outside)</span></span></code> </pre> <br> ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœç¿»è½¬è¿”å›å€¼çš„ç¬¦å·ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dcd/017/bd8/dcd017bd89a9e9d3955c94be3645aa20.svg"></div><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Signed distance point(p) to carved box(c1,c2) float testCarveBox(Vec p, Vec c1, Vec c2) { c1 = p + c1 * -1; c2 = c2 + position * -1; return -min( min( min(c1.x, c2.x), min(c1.y, c2.y)), min(c1.z, c2.z)); } Vec A {3, 3}; Vec B {4, 6}; Vec C1 {2, 2}; Vec C2 {5, 4}; testCarveBox(A, C1, C2); // == -1.41 (outside) testCarveBox(B, C1, C2); // == 2.23 (inside)</span></span></code> </pre> <br> ç°åœ¨æˆ‘ä»¬ä¸æè¿°å®ä½“ï¼Œè€Œæ˜¯å°†æ•´ä¸ªä¸–ç•Œå£°æ˜ä¸ºå®ä½“å¹¶åœ¨å…¶ä¸­åˆ‡å‡ºç©ºç™½ã€‚ åŠŸèƒ½å¯ä»¥ç”¨ä½œå»ºç­‘ç”¨ç –ï¼Œå°†å…¶ç»„åˆèµ·æ¥å¯ä»¥æè¿°æ›´å¤æ‚çš„å½¢å¼ã€‚ ä½¿ç”¨é€»è¾‘åŠ æ³•è¿ç®—ç¬¦ï¼ˆminå‡½æ•°ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€å¯¹çŸ©å½¢ä¸Šæ–¹åˆ‡å‡ºä¸€å¯¹çŸ©å½¢ï¼Œç»“æœå°†å¦‚ä¸‹æ‰€ç¤ºã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48b/f78/615/48bf786150f9d37af1f51fd12987162e.svg"></div><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// Signed distance point to room float testRoom(Vec p) { Vec C1 {2, 4}; Vec C2 {5, 2}; // Lower room Vec C3 {3, 5}; Vec C4 {4, 4}; // Upper room // min() is the union of the two carved volumes. return min(testCarvedBox(p, C1, C2), testCarvedBox(p, C3, C4)); } Vec A {3, 3}; Vec B {4, 6}; testRoom(A, C1, C2); // == -1.41 (outside) testRoom(B, C1, C2); // == 1.00 (inside)</span></span></code> </pre> <br> å¦‚æœæ‚¨è€ƒè™‘ä¸€ä¸‹ï¼Œå®ƒçœ‹èµ·æ¥å°±åƒæˆ‘ä»¬æ­£åœ¨ç ”ç©¶çš„æˆ¿é—´ï¼Œå› ä¸ºè¾ƒä½çš„æˆ¿é—´æ­£æ˜¯è¿™æ ·è¡¨è¾¾çš„-å€ŸåŠ©ä¸¤ä¸ªå¹³è¡Œå››è¾¹å½¢ã€‚ <br><br> ç°åœ¨ï¼Œåœ¨æŒæ¡äº†CSGçš„å¼ºå¤§çŸ¥è¯†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›ä»£ç å¹¶è€ƒè™‘æœ€éš¾å¤„ç†çš„æ•°æ®åº“åŠŸèƒ½ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HIT_NONE 0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HIT_LETTER 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HIT_WALL 2 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HIT_SUN 3 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Sample the world using Signed Distance Fields. float QueryDatabase(Vec position, int &amp;hitType) { float distance = 1e9; Vec f = position; // Flattened position (z=0) fz = 0; char letters[15*4+1] = // 15 two points lines "5O5_" "5W9W" "5_9_" // P (without curve) "AOEO" "COC_" "A_E_" // I "IOQ_" "I_QO" // X "UOY_" "Y_]O" "WW[W" // A "aOa_" "aWeW" "a_e_" "cWiO"; // R (without curve) for (int i = 0; i &lt; sizeof(letters); i += 4) { Vec begin = Vec(letters[i] - 79, letters[i + 1] - 79) * .5; Vec e = Vec(letters[i + 2] - 79, letters[i + 3] - 79) * .5 + begin * -1; Vec o = f + (begin + e * min(-min((begin + f * -1) % e / (e % e), 0), 1) ) * -1; distance = min(distance, o % o); // compare squared distance. } distance = sqrtf(distance); // Get real distance, not square distance. // Two curves (for P and R in PixaR) with hard-coded locations. Vec curves[] = {Vec(-11, 6), Vec(11, 6)}; for (int i = 2; i--;) { Vec o = f + curves[i] * -1; distance = min(distance, ox &gt; 0 ? fabsf(sqrtf(o % o) - 2) : (oy += oy &gt; 0 ? -2 : 2, sqrtf(o % o)) ); } distance = powf(powf(distance, 8) + powf(position.z, 8), .125) - .5; hitType = HIT_LETTER; float roomDist ; roomDist = min(// min(A,B) = Union with Constructive solid geometry //-min carves an empty space -min(// Lower room BoxTest(position, Vec(-30, -.5, -30), Vec(30, 18, 30)), // Upper room BoxTest(position, Vec(-25, 17, -25), Vec(25, 20, 25)) ), BoxTest( // Ceiling "planks" spaced 8 units apart. Vec(fmodf(fabsf(position.x), 8), position.y, position.z), Vec(1.5, 18.5, -25), Vec(6.5, 20, 25) ) ); if (roomDist &lt; distance) distance = roomDist, hitType = HIT_WALL; float sun = 19.9 - position.y ; // Everything above 19.9 is light source. if (sun &lt; distance)distance = sun, hitType = HIT_SUN; return distance; }</span></span></span></span></code> </pre> <br> æ‚¨å¯ä»¥åœ¨æ­¤å¤„çœ‹åˆ°â€œåˆ‡å‡ºâ€å¹³è¡Œå››è¾¹å½¢çš„åŠŸèƒ½ï¼Œå…¶ä¸­ä»…ä½¿ç”¨ä¸¤ä¸ªçŸ©å½¢æ¥æ„å»ºæ•´ä¸ªæˆ¿é—´ï¼ˆæˆ‘ä»¬çš„å¤§è„‘è´Ÿè´£å…¶ä½™éƒ¨åˆ†ï¼Œå®ƒä»£è¡¨å¢™å£ï¼‰ã€‚ æ°´å¹³é˜¶æ¢¯æ˜¯ä½¿ç”¨ä½™æ•°é™¤æ³•çš„ç¨å¾®å¤æ‚ä¸€äº›çš„CSGåŠŸèƒ½ã€‚ æœ€åï¼Œå•è¯PIXARçš„å­—æ¯ç”±15è¡Œç»„æˆï¼Œå¸¦æœ‰â€œåŸç‚¹/å¢é‡â€å¯¹ï¼Œä»¥åŠå­—æ¯På’ŒRçš„æ›²çº¿çš„ä¸¤ç§ç‰¹æ®Šæƒ…å†µã€‚ <br><br><h2> é›·è¡Œå†› </h2><br><hr><br> æœ‰äº†æè¿°ä¸–ç•Œçš„CSGå‡½æ•°æ•°æ®åº“ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·³è¿‡mainï¼ˆï¼‰å‡½æ•°ä¸­å‘å‡ºçš„æ‰€æœ‰å…‰çº¿ã€‚ å°„çº¿è¡Œè¿›ä½¿ç”¨è·ç¦»åŠŸèƒ½ã€‚ è¿™æ„å‘³ç€é‡‡æ ·ä½ç½®ä¼šå‘å‰ç§»åŠ¨ä¸€å®šè·ç¦»ï¼Œç›´åˆ°æœ€è¿‘çš„éšœç¢ç‰©ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Perform signed sphere marching // Returns hitType 0, 1, 2, or 3 and update hit position/normal int RayMarching(Vec origin, Vec direction, Vec &amp;hitPos, Vec &amp;hitNorm) { int hitType = HIT_NONE; int noHitCount = 0; float d; // distance from closest object in world. // Signed distance marching for (float total_d=0; total_d &lt; 100; total_d += d) if ((d = QueryDatabase(hitPos = origin + direction * total_d, hitType)) &lt; .01 || ++noHitCount &gt; 99) return hitNorm = !Vec(QueryDatabase(hitPos + Vec(.01, 0), noHitCount) - d, QueryDatabase(hitPos + Vec(0, .01), noHitCount) - d, QueryDatabase(hitPos + Vec(0, 0, .01), noHitCount) - d) , hitType; // Weird return statement where a variable is also updated. return 0; }</span></span></code> </pre> <br> åŸºäºè·ç¦»çš„å…‰çº¿è¡Œè¿›çš„æ€æƒ³æ˜¯å°†è·ç¦»å‘å‰ç§»åŠ¨åˆ°æœ€è¿‘çš„å¯¹è±¡ã€‚ æœ€åï¼Œå…‰æŸå°†éå¸¸æ¥è¿‘è¡¨é¢ï¼Œå› æ­¤å¯ä»¥å°†å…¶è§†ä¸ºå…¥å°„ç‚¹ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e99/774/398/e997743989aa1cb22fb65e6d5d8e93f2.svg"></div><br> è¯·æ³¨æ„ï¼Œå…‰çº¿è¡Œè¿›ä¸ä¼šè¿”å›ä¸æ›²é¢çš„çœŸå®ç›¸äº¤ï¼Œè€Œæ˜¯è¿”å›è¿‘ä¼¼å€¼ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“d &lt;0.01fæ—¶è¡Œè¿›åœ¨ä»£ç ä¸­åœæ­¢çš„åŸå› ã€‚ <br><br><h2> æ”¾åœ¨ä¸€èµ·ï¼šæŠ½æ · </h2><br><hr><br> è·¯å¾„è·Ÿè¸ªå™¨çš„ç ”ç©¶å³å°†å®Œæˆã€‚ æˆ‘ä»¬ç¼ºå°‘å°†mainï¼ˆï¼‰å‡½æ•°ä¸ray marcherè¿æ¥èµ·æ¥çš„æ¡¥æ¢ã€‚ æœ€åä¸€éƒ¨åˆ†ï¼ˆæˆ‘å°†å…¶é‡å‘½åä¸ºâ€œè¿¹çº¿â€ï¼‰æ˜¯â€œå¤§è„‘â€ï¼Œå…‰çº¿åœ¨å…¶ä¸­åå¼¹æˆ–åœæ­¢ï¼Œå…·ä½“å–å†³äºå®ƒä»¬é‡åˆ°çš„æƒ…å†µã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Vec </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Trace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Vec origin, Vec direction)</span></span></span><span class="hljs-function"> </span></span>{ Vec sampledPosition, normal, color, attenuation = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-function"><span class="hljs-function">Vec </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lightDirection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(!Vec(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">.6</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">.6</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">))</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// Directional light for (int bounceCount = 3; bounceCount--;) { int hitType = RayMarching(origin, direction, sampledPosition, normal); if (hitType == HIT_NONE) break; // No hit. This is over, return color. if (hitType == HIT_LETTER) { // Specular bounce on a letter. No color acc. direction = direction + normal * ( normal % direction * -2); origin = sampledPosition + direction * 0.1; attenuation = attenuation * 0.2; // Attenuation via distance traveled. } if (hitType == HIT_WALL) { // Wall hit uses color yellow? float incidence = normal % lightDirection; float p = 6.283185 * randomVal(); float c = randomVal(); float s = sqrtf(1 - c); float g = normal.z &lt; 0 ? -1 : 1; float u = -1 / (g + normal.z); float v = normal.x * normal.y * u; direction = Vec(v, g + normal.y * normal.y * u, -normal.y) * (cosf(p) * s) + Vec(1 + g * normal.x * normal.x * u, g * v, -g * normal.x) * (sinf(p) * s) + normal * sqrtf(c); origin = sampledPosition + direction * .1; attenuation = attenuation * 0.2; if (incidence &gt; 0 &amp;&amp; RayMarching(sampledPosition + normal * .1, lightDirection, sampledPosition, normal) == HIT_SUN) color = color + attenuation * Vec(500, 400, 100) * incidence; } if (hitType == HIT_SUN) { // color = color + attenuation * Vec(50, 80, 100); break; // Sun Color } } return color; }</span></span></code> </pre> <br> æˆ‘å¯¹è¯¥åŠŸèƒ½è¿›è¡Œäº†ä¸€äº›å®éªŒï¼Œä»¥æ›´æ”¹å…è®¸çš„æœ€å¤§å…‰æŸåå°„æ•°é‡ã€‚ å€¼â€œ 2â€èµ‹äºˆå­—æ¯ä»¤äººæƒŠè®¶çš„ç¾ä¸½æ¼†é¢Vantablacké¢œè‰²<sup>[4]</sup> ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d10/940/a3e/d10940a3ed7efab3271097904ce50d77.png"></div><br>  <i>1ä¸ª</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0c/8b2/c3b/e0c8b2c3b249057b1f5fd0d166e12014.png"></div><br>  <i>2</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb9/52c/4df/fb952c4dfd0a4cb14245cedd060dcf05.png"></div><br>  <i>3</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/65c/2f5/716/65c2f5716578caaa2fcc454a49376578.png"></div><br>  <i>4</i> <br><br><h2> å®Œå…¨æ¸…ç†çš„æºä»£ç  </h2><br><hr><br> ä¸ºäº†å°†æ‰€æœ‰å†…å®¹æ”¾åœ¨ä¸€èµ·ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªå®Œå…¨å¹²å‡€çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æºä»£ç </a> ã€‚ <br><br><h2> å‚è€ƒæ–‡çŒ® </h2><br><hr><br>  [1]æ¥æºï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">lexfrench Twitteräº2018å¹´10æœˆ8æ—¥å‘å¸ƒã€‚</a> <br><br>  [2]æ¥æºï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»´åŸºç™¾ç§‘ï¼šNetPBMå›¾åƒæ ¼å¼</a> <br><br>  [3]èµ„æ–™æ¥æºï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨åŠŸèƒ½æœ€å¼ºå¤§çš„MacBook Proä¸Šè¿›è¡Œçš„å¯è§†åŒ–ï¼Œ2017å¹´</a> <br><br>  [4]æ¥æºï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»´åŸºç™¾ç§‘ï¼šVantablack</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN434528/">https://habr.com/ru/post/zh-CN434528/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN434514/index.html">ç”¨äºâ€œæ¸—é€æµ‹è¯•è€…â€çš„â€œç§˜å¯†â€ DPAPIæˆ–DPAPI</a></li>
<li><a href="../zh-CN434516/index.html">ä¸€ç§å¤„ç†æ‚¨çš„èŒä¸šç†æƒ³çš„ç®€ä¾¿æ–¹æ³•ã€‚</a></li>
<li><a href="../zh-CN434518/index.html">æŒå£°å’Œæ¬¢å‘¼å£°ï¼šAppleå•†åº—ä¸­ç»è¿‡ç²¾å¿ƒæ§åˆ¶çš„æˆå‰§</a></li>
<li><a href="../zh-CN434522/index.html">ä»»åŠ¡è¯æ˜æ¨¡å¼å’Œåæ¨¡å¼</a></li>
<li><a href="../zh-CN434524/index.html">Kubernetesé€šè¿‡åˆå­¦è€…çš„çœ¼å…‰è¿›å…¥</a></li>
<li><a href="../zh-CN434530/index.html">é»˜è®¤æ—¥å†ï¼ŒLDAPä¸­çš„ä¿®å¤ç¨‹åºä»¥åŠZimbra 8.8.11ä¸­çš„å…¶ä»–åˆ›æ–°</a></li>
<li><a href="../zh-CN434532/index.html">ä¸€ä¸ªé¡¹ç›®çš„æ•…äº‹ï¼šå½“å›¢é˜Ÿæ²¡æœ‰é«˜çº§å¼€å‘äººå‘˜æ—¶</a></li>
<li><a href="../zh-CN434534/index.html">ONYX BOOXâ€œæˆ‘çš„ç¬¬ä¸€æœ¬ä¹¦â€ï¼šå¯¹æ¯å©´æ— å®³é˜…è¯»</a></li>
<li><a href="../zh-CN434538/index.html">å¤ªç©ºä¹‹æˆ˜ï¼šå«æ˜Ÿäº’è”ç½‘å¸‚åœºæ­£åœ¨å‘ç”Ÿä»€ä¹ˆ</a></li>
<li><a href="../zh-CN434540/index.html">ä¸å°†è¢«æœºå™¨äººå–ä»£çš„äººæ€ä¹ˆåŠï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>