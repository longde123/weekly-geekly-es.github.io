<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå´Ô∏è üèáüèø üíõ Interfaces no C # 8: suposi√ß√µes perigosas na implementa√ß√£o padr√£o üßúüèø üçö ü§≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! 

 Como parte da explora√ß√£o do t√≥pico do C # 8, sugerimos discutir o seguinte artigo sobre as novas regras para implementar interfaces. 



...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interfaces no C # 8: suposi√ß√µes perigosas na implementa√ß√£o padr√£o</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/471872/"> Ol√° Habr! <br><br>  Como parte da explora√ß√£o do t√≥pico do C # 8, sugerimos discutir o seguinte artigo sobre as novas regras para implementar interfaces. <br><br><img src="https://habrastorage.org/webt/vt/jp/uq/vtjpuqini0ddgc23gpr2kllk4aq.jpeg"><br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Observando atentamente como as</a> interfaces s√£o estruturadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no C # 8</a> , √© necess√°rio considerar que, ao implementar interfaces, voc√™ pode quebrar a lenha por padr√£o. <br><br>  <b>Suposi√ß√µes relacionadas √† implementa√ß√£o padr√£o podem levar a c√≥digo corrompido, exce√ß√µes de tempo de execu√ß√£o e desempenho ruim.</b> <br><br>  Um dos recursos anunciados ativamente das interfaces C # 8 √© que voc√™ pode adicionar membros a uma interface sem interromper os implementadores existentes.  Mas a desaten√ß√£o, neste caso, est√° repleta de grandes problemas.  Considere o c√≥digo no qual s√£o feitas as suposi√ß√µes erradas - isso tornar√° mais claro o quanto √© importante evitar esses problemas. <br><br>  <i>Todo o c√≥digo deste artigo est√° publicado no GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jeremybytes / interfaces-in-csharp-8</a> , especificamente no projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DangerousAssumptions</a></i> . <br><br>  <i>Nota: Este artigo discute os recursos do C # 8, atualmente implementados apenas no .NET Core 3.0.</i>  <i>Nos exemplos que usei, Visual Studio 16.3.0 e .NET Core 3.0.100</i> . <br><br>  <b>Suposi√ß√µes sobre detalhes de implementa√ß√£o</b> <br><br>  A principal raz√£o pela qual articulo esse problema √© a seguinte: Encontrei um artigo na Internet em que o autor oferece c√≥digo com suposi√ß√µes muito ruins sobre a implementa√ß√£o (n√£o indicarei o artigo porque n√£o quero que o autor seja enrolado com coment√°rios; entrarei em contato com ele pessoalmente) . <br><br>  O artigo fala sobre o qu√£o boa √© a implementa√ß√£o padr√£o, porque nos permite complementar as interfaces mesmo depois que o c√≥digo j√° tiver implementadores.  No entanto, v√°rias suposi√ß√µes incorretas s√£o feitas nesse c√≥digo (o c√≥digo est√° na pasta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BadInterface</a> da pasta no meu projeto GitHub) <br><br>  Aqui est√° a interface original: <br><br><img src="https://habrastorage.org/webt/e0/w_/zs/e0w_zsxwq2pw7gvs28a6b2zsgb0.png"><br><br>  O restante do artigo demonstra a implementa√ß√£o da interface MyFile (para mim, no arquivo <a href="">MyFile.cs</a> ): <br><br>  O artigo mostra como voc√™ pode adicionar o m√©todo <code>Rename</code> com a implementa√ß√£o padr√£o e n√£o interromper√° a classe <code>MyFile</code> existente. <br><br>  Aqui est√° a interface atualizada (do arquivo <a href="">IFileHandler.cs</a> ): <br><br><img src="https://habrastorage.org/webt/wt/1o/qo/wt1oqop87pe-7xcknbif6-vxcbu.png"><br><br>  O MyFile ainda funciona, ent√£o est√° tudo bem.  Ent√£o  Na verdade n√£o. <br><br>  <b>Suposi√ß√µes ruins</b> <br><br>  O principal problema com o m√©todo Rename √© o que uma suposi√ß√£o ENORME est√° associada a ele: implementa√ß√µes usam um arquivo f√≠sico localizado no sistema de arquivos. <br><br>  Considere a implementa√ß√£o que eu criei para uso em um sistema de arquivos localizado na RAM.  (Nota: este √© o meu c√≥digo. N√£o √© de um artigo que eu critico. Voc√™ encontrar√° a implementa√ß√£o completa no arquivo <a href="">MemoryStringFileHandler.cs</a> .) <br><br><img src="https://habrastorage.org/webt/8b/-g/mf/8b-gmffz-p1tclhw8imq0vanofa.png"><br><br>  Esta classe implementa um sistema de arquivos formal que usa um dicion√°rio localizado na RAM, que cont√©m arquivos de texto.  N√£o h√° nada aqui que afete o sistema de arquivos f√≠sico; geralmente n√£o h√° refer√™ncias ao <code>System.IO</code> . <br><br>  <b>Implementador com defeito</b> <br><br>  Ap√≥s atualizar a interface, essa classe est√° danificada. <br><br>  Se o c√≥digo do cliente chamar o m√©todo Rename, ele gerar√° um erro de tempo de execu√ß√£o (ou, pior, renomeie o arquivo armazenado no sistema de arquivos). <br><br>  Mesmo que nossa implementa√ß√£o funcione com arquivos f√≠sicos, ela pode acessar arquivos localizados no armazenamento em nuvem e esses arquivos n√£o podem ser acessados ‚Äã‚Äãatrav√©s do System.IO.File. <br><br>  Tamb√©m existe um problema em potencial quando se trata de teste de unidade.  Se o objeto simulado ou falso n√£o for atualizado e o c√≥digo testado for atualizado, ele tentar√° acessar o sistema de arquivos ao executar testes de unidade. <br><blockquote>  Como a suposi√ß√£o errada diz respeito √† interface, os implementadores dessa interface est√£o corrompidos. </blockquote>  <b>Medos irracionais?</b> <br><br>  √â in√∫til considerar esses medos infundados.  Quando falo de abusos no c√≥digo, eles me respondem: "Bem, √© que uma pessoa n√£o sabe como programar".  Eu n√£o posso discordar disso. <br><br>  Geralmente fa√ßo isso: espero e vejo como isso funcionar√°.  Por exemplo, eu tinha medo de que a possibilidade de "uso est√°tico" fosse abusada.  At√© agora, isso n√£o teve que ser convencido. <br><br>  <i><b>Deve-se ter em mente que essas id√©ias est√£o no ar; portanto, est√° ao nosso alcance ajudar outras pessoas a seguir um caminho mais conveniente, que n√£o ser√° t√£o dif√≠cil de seguir.</b></i> <i><br></i> <br><br>  <b>Problemas de desempenho</b> <br><br>  Comecei a pensar em quais outros problemas poderiam nos esperar se fiz√©ssemos suposi√ß√µes incorretas sobre os implementadores de interface. <br><br>  No exemplo anterior, √© chamado c√≥digo que est√° fora da pr√≥pria interface (nesse caso, fora do System.IO).  Voc√™ provavelmente concordar√° que tais a√ß√µes s√£o um sino perigoso.  Mas, se usarmos as coisas que j√° fazem parte da interface, tudo ficar√° bem, certo? <br><br>  Nem sempre. <br><br>  Como exemplo expresso, criei a interface IReader. <br><br>  <b>A interface de origem e sua implementa√ß√£o</b> <br><br>  Aqui est√° a interface IReader original (do arquivo <a href="">IReader.cs</a> - embora agora j√° haja atualiza√ß√µes neste arquivo): <br><br><img src="https://habrastorage.org/webt/fi/lt/z-/filtz-c6je1oksyxv_anoif7df4.png"><br><br>  Essa √© uma interface gen√©rica de m√©todo que permite obter uma cole√ß√£o de itens somente leitura. <br><br>  Uma das implementa√ß√µes dessa interface gera uma sequ√™ncia de n√∫meros de Fibonacci (sim, tenho um interesse prejudicial em gerar sequ√™ncias de Fibonacci).  Aqui est√° a interface <code>FibonacciReader</code> (do arquivo <a href="">FibonacciReader.cs</a> - tamb√©m √© atualizada no meu github): <br><br><img src="https://habrastorage.org/webt/hl/3y/rp/hl3yrppzww6gsi1jk8r0th_tro8.png"><br><br>  A classe <code>FibonacciSequence</code> √© uma implementa√ß√£o de <code>IEnumerable &lt;int&gt;</code> (do arquivo FibonacciSequence.cs).  Ele usa um n√∫mero inteiro de 32 bits como tipo de dados, para que o estouro ocorra rapidamente. <br><br><img src="https://habrastorage.org/webt/ne/jl/n2/nejln2hdhrbwjtejikx_a43ml_q.png"><br><br>  Se voc√™ estiver interessado nesta implementa√ß√£o, d√™ uma olhada no meu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">TDDing em uma sequ√™ncia de Fibonacci no</a> artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">C #</a> . <br><br>  O projeto DangerousAssumptions √© um aplicativo de console que exibe os resultados do FibonacciReader (do arquivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Program.cs</a> ): <br><br><img src="https://habrastorage.org/webt/no/th/06/noth06uvuy-aupnil7rirs_xm2u.png"><br><br>  E aqui est√° a conclus√£o: <br><br><img src="https://habrastorage.org/webt/kb/5b/tp/kb5btppuomd69iw_mdxfpy_cu8k.png"><br><br>  <b>Interface atualizada</b> <br><br>  Ent√£o agora temos o c√≥digo de trabalho.  Por√©m, mais cedo ou mais tarde, talvez seja necess√°rio obter um elemento separado do IReader, e n√£o a cole√ß√£o inteira de uma s√≥ vez.  Como usamos um tipo gen√©rico com a interface e ainda n√£o temos a propriedade "ID natural" no objeto, estenderemos o elemento localizado em um √≠ndice espec√≠fico. <br><br>  Aqui est√° nossa interface √† qual o m√©todo <code>GetItemAt</code> √© <code>GetItemAt</code> (da vers√£o final do arquivo <a href="">IReader.cs</a> ): <br><br><img src="https://habrastorage.org/webt/ok/tz/ex/oktzexqhidrdeejlrbkidjnpat4.png"><br><br>  <code>GetItemAt</code> aqui assume uma implementa√ß√£o padr√£o.  √Ä primeira vista - n√£o √© t√£o ruim.  Ele usa um membro da interface existente ( <code>GetItems</code> ), portanto, nenhuma suposi√ß√£o "externa" √© feita aqui.  Com os resultados, ele usa o m√©todo LINQ.  Sou um grande f√£ do LINQ, e esse c√≥digo, na minha opini√£o, √© constru√≠do razoavelmente. <br><br>  <b>Diferen√ßas de desempenho</b> <br><br>  Como a implementa√ß√£o padr√£o chama <code>GetItems</code> , exige que a cole√ß√£o inteira seja retornada antes que um item espec√≠fico seja selecionado. <br><br>  No caso de <code>FibonacciReader</code> isso implica que todos os valores ser√£o gerados.  Em um formul√°rio atualizado, o arquivo <a href="">Program.cs</a> conter√° o seguinte c√≥digo: <br><br><img src="https://habrastorage.org/webt/nq/de/6o/nqde6otfxvpelqgevulvoa1syks.png"><br><br>  Ent√£o, chamamos <code>GetItemAt</code> .  Aqui est√° a conclus√£o: <br><br><img src="https://habrastorage.org/webt/si/bp/xv/sibpxvefyrxeyrokzecxmamsf_c.png"><br><br>  Se colocarmos um ponto de verifica√ß√£o dentro do arquivo FibonacciSequence.cs, veremos que toda a sequ√™ncia √© gerada para isso. <br><br>  Ap√≥s iniciar o programa, encontraremos esse ponto de controle duas vezes: primeiro ao chamar <code>GetItems</code> e depois ao chamar <code>GetItemAt</code> . <br><br>  <b>Suposi√ß√£o prejudicial ao desempenho</b> <br><br>  O problema mais s√©rio com esse m√©todo √© que ele requer a recupera√ß√£o de toda a cole√ß√£o de elementos.  Se esse <code>IReader</code> for retir√°-lo do banco de dados, muitos elementos ter√£o que ser extra√≠dos dele e somente um deles ser√° selecionado.  Seria muito melhor se essa sele√ß√£o final fosse tratada em um banco de dados. <br><br>  Trabalhando com nosso <code>FibonacciReader</code> , calculamos cada novo elemento.  Assim, a lista inteira deve ser calculada inteiramente para obter apenas um elemento que precisamos.  O c√°lculo da sequ√™ncia de Fibonacci √© uma opera√ß√£o que n√£o carrega muito o processador, mas e se lidarmos com algo mais complicado, por exemplo, calcularemos n√∫meros primos? <br><br>  Voc√™ pode dizer: ‚ÄúBem, temos um m√©todo <code>GetItems</code> que retorna tudo.  Se funcionar por muito tempo, provavelmente n√£o deveria estar aqui.  E esta √© uma declara√ß√£o honesta. <br><br>  No entanto, o c√≥digo de chamada n√£o sabe nada sobre isso.  Se eu ligar para <code>GetItems</code> , sei que (provavelmente) minhas informa√ß√µes precisar√£o passar pela rede e esse processo <code>GetItems</code> muito tempo.  Se eu pedir um √∫nico item, por que devo esperar esses custos? <br><br>  <b>Otimiza√ß√£o de desempenho espec√≠fica</b> <br><br>  No caso do <code>FibonacciReader</code> podemos adicionar nossa pr√≥pria implementa√ß√£o para melhorar significativamente o desempenho (na vers√£o final do arquivo <a href="">FibonacciReader.cs</a> ): <br><br><img src="https://habrastorage.org/webt/b5/lm/nu/b5lmnudcmxo-_dw3l5r66wxkkne.png"><br><br>  O m√©todo <code>GetItemAt</code> substitui a implementa√ß√£o padr√£o fornecida na interface. <br><br>  Aqui eu uso o mesmo m√©todo LINQ <code>ElementAt</code> da implementa√ß√£o padr√£o.  No entanto, eu n√£o uso esse m√©todo com a cole√ß√£o somente leitura que GetItems retorna, mas com FibonacciSequence, que √© <code>IEnumerable</code> . <br><br>  Como <code>FibonacciSequence</code> √© <code>IEnumerable</code> , a chamada para <code>ElementAt</code> terminar√° assim que o programa atingir o elemento que selecionamos.  Portanto, n√£o geraremos a cole√ß√£o inteira, mas apenas os elementos localizados at√© a posi√ß√£o especificada no √≠ndice. <br><br>  Para tentar isso, deixe o ponto de controle que criamos acima no aplicativo e execute o aplicativo novamente.  Desta vez, encontramos um ponto de interrup√ß√£o apenas uma vez (ao chamar <code>GetItems</code> ).  Ao chamar <code>GetItemAt</code> isso n√£o acontecer√°. <br><br>  <b>Um exemplo um pouco artificial</b> <br><br>  Este exemplo √© um pouco exagerado, porque, como regra, voc√™ n√£o precisa selecionar elementos do conjunto de dados por √≠ndice.  No entanto, voc√™ pode imaginar algo semelhante que poderia acontecer se estiv√©ssemos trabalhando com a propriedade de identifica√ß√£o natural. <br><br>  Se extra√≠mos itens por ID, n√£o por √≠ndice, podemos ter enfrentado os mesmos problemas de desempenho com a implementa√ß√£o padr√£o.  A implementa√ß√£o padr√£o requer o retorno de todos os elementos, ap√≥s o qual apenas um deles √© selecionado.  Se voc√™ permitir que o banco de dados ou outro "leitor" puxe um elemento espec√≠fico por seu ID, essa opera√ß√£o seria muito mais eficiente. <br><br>  <b>Pense nas suas suposi√ß√µes</b> <br><br>  Suposi√ß√µes s√£o indispens√°veis.  Se tent√°ssemos levar em conta no c√≥digo poss√≠veis casos de uso de nossas bibliotecas, nenhuma tarefa seria conclu√≠da.  Mas voc√™ ainda precisa considerar cuidadosamente as suposi√ß√µes no c√≥digo. <br><br>  Isso n√£o significa que a implementa√ß√£o <code>GetElementAt</code> seja necessariamente ruim.  Sim, existem poss√≠veis problemas de desempenho.  No entanto, se os conjuntos de dados forem pequenos ou os elementos computados forem "baratos", a implementa√ß√£o padr√£o poder√° ser um compromisso razo√°vel. <br><br>  No entanto, n√£o aceito mudan√ßas na interface depois que ela j√° possui implementadores.  Mas entendo que tamb√©m existem cen√°rios em que as op√ß√µes alternativas s√£o preferidas.  A programa√ß√£o √© a solu√ß√£o de problemas e, ao solucionar problemas, √© necess√°rio avaliar os pr√≥s e contras inerentes a cada ferramenta e abordagem que usamos. <br><br>  A implementa√ß√£o padr√£o pode prejudicar os implementadores de interface (e possivelmente o c√≥digo que invocar√° essas implementa√ß√µes).  Portanto, voc√™ precisa ter um cuidado especial com as suposi√ß√µes relacionadas √†s implementa√ß√µes padr√£o. <br><br>  Boa sorte no seu trabalho! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt471872/">https://habr.com/ru/post/pt471872/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt471858/index.html">RabbitMQ vs. Kafka: Failover e alta disponibilidade em clusters</a></li>
<li><a href="../pt471860/index.html">Analisadores de Peg</a></li>
<li><a href="../pt471862/index.html">Implementa√ß√£o do Analisador PEG</a></li>
<li><a href="../pt471864/index.html">Gera√ß√£o de analisador PEG</a></li>
<li><a href="../pt471870/index.html">Uso efetivo do libdispatch</a></li>
<li><a href="../pt471876/index.html">PDU e Tudo-Tudo-Tudo: Distribui√ß√£o de Energia em Rack</a></li>
<li><a href="../pt471878/index.html">Como escrever um contrato inteligente para o WebAssembly em uma rede Ontology? Parte 1: Ferrugem</a></li>
<li><a href="../pt471884/index.html">10 utilit√°rios ApexSQL gratuitos para gerenciar bancos de dados do Microsoft SQL Server</a></li>
<li><a href="../pt471886/index.html">VMmanager 6: apresentando a caixa e comparando com a gera√ß√£o anterior</a></li>
<li><a href="../pt471890/index.html">Infer√™ncia Variacional - o que √© e o que come?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>