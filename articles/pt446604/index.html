<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÉüèø ‚úäüèΩ üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø ESET: Novos esquemas de entrega de backdoor de grupos cibern√©ticos da OceanLotus üï† üßòüèº üë©üèΩ‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em uma publica√ß√£o, descreveremos como o cibergrupo da OceanLotus (APT32 e APT-C-00) recentemente utilizou uma das explora√ß√µes p√∫blicas do CVE-2017-118...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ESET: Novos esquemas de entrega de backdoor de grupos cibern√©ticos da OceanLotus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/446604/">  Em uma publica√ß√£o, descreveremos como o cibergrupo da OceanLotus (APT32 e APT-C-00) recentemente utilizou uma das explora√ß√µes p√∫blicas do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE-2017-11882</a> , a vulnerabilidade de corrup√ß√£o de mem√≥ria no Microsoft Office e como o malware de grupo fornece persist√™ncia em sistemas comprometidos sem deixar vest√≠gios .  A seguir, descrevemos como, desde o in√≠cio de 2019, o grupo usou arquivos de extra√ß√£o autom√°tica para executar o c√≥digo. <br><br>  A OceanLotus √© especializada em espionagem cibern√©tica, com objetivos priorit√°rios no sudeste da √Åsia.  Os invasores falsificam documentos que atraem a aten√ß√£o de poss√≠veis v√≠timas para convenc√™-los a executar uma porta dos fundos e tamb√©m trabalham no desenvolvimento de ferramentas.  Os m√©todos usados ‚Äã‚Äãpara criar chamarizes variam em ataques diferentes - de arquivos com "extens√£o dupla", arquivos com extra√ß√£o autom√°tica, documentos com macros a explora√ß√µes conhecidas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ap/h9/mc/aph9mchsgkupnlpka6cf7g_u13g.jpeg"></div><br><a name="habracut"></a><h2>  Usando uma explora√ß√£o no Microsoft Equation Editor </h2><br>  Em meados de 2018, a OceanLotus lan√ßou uma campanha usando a vulnerabilidade CVE-2017-11882.  Um dos documentos maliciosos do cibergrupo foi analisado por especialistas do 360 Threat Intelligence Center (um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estudo em chin√™s</a> ), incluindo uma descri√ß√£o detalhada da explora√ß√£o.  Na postagem abaixo, uma vis√£o geral de um documento t√£o malicioso. <br><br><h3>  Primeira etapa </h3><br>  O <code>FW Report on demonstration of former CNRP in Republic of Korea.doc</code> (SHA-1: <code>D1357B284C951470066AAA7A8228190B88A5C7C3</code> ) √© semelhante ao mencionado no estudo acima.  √â interessante, pois visa usu√°rios interessados ‚Äã‚Äãna pol√≠tica cambojana (CNRP - Partido Nacional da Salva√ß√£o do Camboja, dissolvido no final de 2017).  Apesar da extens√£o .doc, o documento possui o formato RTF (veja a figura abaixo), cont√©m c√≥digo indesejado e tamb√©m est√° distorcido. <br><br><img src="https://habrastorage.org/webt/a-/gt/6y/a-gt6ylnd0rbyzvs8eecjpi04-a.png"><br>  <i>Figura 1. Lixo no RTF</i> <br><br>  Apesar da presen√ßa de elementos distorcidos, o Word abre com √™xito esse arquivo RTF.  Como pode ser visto na Figura 2, aqui est√° a estrutura EQNOLEFILEHDR com um deslocamento de 0xC00, seguido pelo cabe√ßalho MTEF e, em seguida, a entrada MTEF (Figura 3) para a fonte. <br><br><img src="https://habrastorage.org/webt/oh/ks/tb/ohkstbugzx97wthqqqnrdoo27di.png"><br>  <i>Figura 2. Valores do registro FONT</i> <br><br><img src="https://habrastorage.org/webt/jy/wj/b5/jywjb5bgsixdqywivkc_ndzcgiu.png"><br>  <i>Figura 3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Formato de grava√ß√£o FONT</a></i> <br><br>  √â poss√≠vel um estouro no campo de <i>nome</i> , porque seu tamanho n√£o √© verificado antes da c√≥pia.  Um nome muito longo desencadeia uma vulnerabilidade.  Como pode ser visto no conte√∫do do arquivo RTF (deslocamento 0xC26 na Figura 2), o buffer √© preenchido com o c√≥digo do shell, seguido por um comando fict√≠cio ( <code>0x90</code> ) e o endere√ßo de retorno <code>0x402114</code> .  O endere√ßo √© um item de di√°logo no <code>EQNEDT32.exe</code> que aponta para uma instru√ß√£o <code>RET</code> .  Isso faz com que o EIP aponte para o in√≠cio do campo de <i>nome que</i> cont√©m o c√≥digo de shell. <br><br><img src="https://habrastorage.org/webt/_9/gf/lo/_9gflo6k9zsefvvnq8jdaqosuua.png"><br>  <i>Figura 4. In√≠cio do c√≥digo de explora√ß√£o do shell</i> <br><br>  O endere√ßo <code>0x45BD3C</code> armazena uma vari√°vel que √© desreferenciada at√© atingir um ponteiro para a estrutura <code>MTEFData</code> atualmente carregada.  Aqui est√° o resto do c√≥digo de shell. <br><br>  O objetivo do c√≥digo do shell √© executar o segundo fragmento do c√≥digo do shell incorporado em um documento aberto.  Primeiro, o c√≥digo de shell de origem tenta encontrar o descritor de arquivo do documento aberto, <code>NtQuerySystemInformation</code> todos os descritores do sistema ( <code>NtQuerySystemInformation</code> com o argumento <code>SystemExtendedHandleInformation</code> ) e verificando se o <i>PID</i> do descritor e o <i>PID do</i> processo do <code>WinWord</code> e se o documento foi aberto com a m√°scara de acesso - <code>0x12019F</code> . <br><br>  Para confirmar a detec√ß√£o do descritor correto (e n√£o o descritor de outro documento aberto), o conte√∫do do arquivo √© exibido usando a fun√ß√£o <code>CreateFileMapping</code> , e o c√≥digo do shell verifica se os √∫ltimos quatro bytes do documento correspondem a " <code>yyyy</code> " (m√©todo de ca√ßa ao ovo).  Assim que uma correspond√™ncia √© encontrada, o documento √© copiado para uma pasta tempor√°ria ( <code>GetTempPath</code> ) como <code>ole.dll</code> .  Em seguida, os √∫ltimos 12 bytes do documento s√£o lidos. <br><br><img src="https://habrastorage.org/webt/w3/lq/xv/w3lqxvqbmerfijoryxi3vkitaao.png"><br>  <i>Figura 5. Marcadores de fim de documento</i> <br><br>  O valor de 32 bits entre os marcadores <code>AABBCCDD</code> e <code>yyyy</code> √© o deslocamento do pr√≥ximo <code>AABBCCDD</code> .  √â chamado usando a fun√ß√£o <code>CreateThread</code> .  Extraiu o mesmo c√≥digo de shell usado pelo OceanLotus antes.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O script de emula√ß√£o Python</a> que lan√ßamos em mar√ßo de 2018 ainda funciona para despejar o segundo est√°gio. <br><br><h3>  Segunda etapa </h3><br><h4>  Recupera√ß√£o de componentes </h4><br>  Os nomes de arquivos e diret√≥rios s√£o selecionados dinamicamente.  O c√≥digo seleciona aleatoriamente o nome de um arquivo execut√°vel ou DLL em <code>C:\Windows\system32</code> .  Ele, ent√£o, faz uma solicita√ß√£o aos seus recursos e recupera o campo <code>FileDescription</code> para uso como o nome da pasta.  Se isso n√£o funcionar, o c√≥digo seleciona aleatoriamente o nome da pasta nos diret√≥rios <code>%ProgramFiles%</code> ou <code>C:\Windows</code> (em GetWindowsDirectoryW).  Evita o uso de um nome que possa entrar em conflito com os arquivos existentes e garante que ele n√£o contenha as seguintes palavras: <code>windows</code> , <code>Microsoft</code> , <code>desktop</code> , <code>system</code> , <code>system32</code> ou <code>syswow64</code> .  Se o diret√≥rio j√° existir, "NLS_ {6 caracteres}" ser√° adicionado ao nome. <br><br>  O recurso <code>0x102</code> analisado e os arquivos s√£o despejados em <code>%ProgramFiles%</code> ou <code>%AppData%</code> , para uma pasta selecionada aleatoriamente.  O tempo de cria√ß√£o foi alterado para ter os mesmos valores que o <code>kernel32.dll</code> . <br><br>  Por exemplo, aqui est√° uma pasta e uma lista de arquivos criados, selecionando o arquivo execut√°vel <code>C:\Windows\system32\TCPSVCS.exe</code> como fonte de dados. <br><br><img src="https://habrastorage.org/webt/px/ls/xq/pxlsxqrz8s0beuxfybxu0cvz8dg.png"><br>  <i>Figura 6. Extraindo v√°rios componentes</i> <br><br>  A estrutura do recurso <code>0x102</code> no conta-gotas √© bastante complicada.  Em poucas palavras, cont√©m: <br>  - nomes de arquivos <br>  - Tamanho e conte√∫do dos arquivos <br>  - Formato de compacta√ß√£o ( <code>COMPRESSION_FORMAT_LZNT1</code> usado pela fun√ß√£o <code>RtlDecompressBuffer</code> ) <br><br>  O primeiro arquivo √© redefinido como <code>TCPSVCS.exe</code> , que √© o leg√≠timo <code>AcroTranscoder.exe</code> (de acordo com <code>FileDescription</code> , SHA-1: <code>2896738693A8F36CC7AD83EF1FA46F82F32BE5A3</code> ). <br><br>  Voc√™ pode ter notado que alguns arquivos DLL s√£o maiores que 11 MB.  Isso ocorre porque um grande buffer cont√≠guo de dados aleat√≥rios est√° localizado dentro do arquivo execut√°vel.  √â poss√≠vel que essa seja uma maneira de evitar a detec√ß√£o por alguns produtos de seguran√ßa. <br><br><h4>  Persist√™ncia </h4><br>  O recurso <code>0x101</code> no conta-gotas cont√©m dois n√∫meros inteiros de 32 bits que determinam como manter a persist√™ncia.  O valor do primeiro indica como o malware manter√° a persist√™ncia sem direitos de administrador. <br><br><img src="https://habrastorage.org/webt/f6/aw/1x/f6aw1xtjqv-tfril3uzrx_nzstw.png"><br>  <i>Tabela 1. Mecanismo de persist√™ncia sem direitos de administrador</i> <br><br>  O valor do segundo n√∫mero inteiro indica como o malware deve garantir a persist√™ncia enquanto trabalha como administrador. <br><br><img src="https://habrastorage.org/webt/db/p2/em/dbp2embzyazeoxdnk8h6uji9lm4.png"><br>  <i>Tabela 2. Mecanismo de persist√™ncia com direitos de administrador</i> <br><br>  Um nome de servi√ßo √© um nome de arquivo sem extens√£o;  o nome de exibi√ß√£o √© o nome da pasta, mas se ela j√° existir, a string " <code>Revision 1</code> " ser√° adicionada a ela (o n√∫mero aumenta at√© que um nome n√£o utilizado seja encontrado).  Os operadores garantiram que a persist√™ncia do servi√ßo fosse est√°vel - em caso de falha, o servi√ßo deve ser reiniciado ap√≥s 1 segundo.  Em seguida, o valor <code>WOW64</code> da nova chave de registro de servi√ßo √© definido como 4, o que indica que √© um servi√ßo de 32 bits. <br><br>  A tarefa agendada √© criada por meio de v√°rias interfaces COM: <code>ITaskScheduler</code> , <code>ITask</code> , <code>ITaskTrigger</code> , <code>IPersistFile</code> e <code>ITaskScheduler</code> .  Em ess√™ncia, o programa malicioso cria uma tarefa oculta, define as informa√ß√µes da conta junto com as informa√ß√µes sobre o usu√°rio ou administrador atual e, em seguida, define o gatilho. <br><br>  Essa √© uma tarefa di√°ria com dura√ß√£o de 24 horas e intervalos entre duas execu√ß√µes de 10 minutos, o que significa que ser√° executada continuamente. <br><br><h4>  Bit malicioso </h4><br>  Em nosso exemplo, o arquivo execut√°vel <code>TCPSVCS.exe</code> ( <code>AcroTranscoder.exe</code> ) √© um software leg√≠timo que baixa DLLs que s√£o despejadas nele.  Nesse caso, o <code>Flash Video Extension.dll</code> √© do seu interesse. <br><br>  Sua fun√ß√£o <code>DLLMain</code> simplesmente chama outra fun√ß√£o.  Alguns predicados difusos est√£o presentes: <br><br><img src="https://habrastorage.org/webt/b-/im/fe/b-imfeegcv30g23fj2n9qqowdeu.png"><br>  <i>Figura 7. Predicados nebulosos</i> <br><br>  Ap√≥s essas verifica√ß√µes enganosas, o c√≥digo recebe a se√ß√£o <code>TCPSVCS.exe</code> arquivo <code>TCPSVCS.exe</code> , altera sua prote√ß√£o para <code>PAGE_EXECUTE_READWRITE</code> e a substitui, adicionando instru√ß√µes fict√≠cias: <br><br><img src="https://habrastorage.org/webt/dp/e7/fn/dpe7fnpq2lrioo0i15ki742mhro.png"><br>  <i>Figura 8. A sequ√™ncia de instru√ß√µes</i> <br><br>  No final, a instru√ß√£o <code>CALL</code> √© adicionada ao endere√ßo da fun√ß√£o <code>FLVCore::Uninitialize(void)</code> exportada pelo <code>Flash Video Extension.dll</code> .  Isso significa que, ap√≥s carregar a DLL mal-intencionada, quando o tempo de execu√ß√£o chamar o <code>WinMain</code> no <code>TCPSVCS.exe</code> , o ponteiro da instru√ß√£o apontar√° para NOP, resultando na chamada de <code>FLVCore::Uninitialize(void)</code> , a pr√≥xima etapa. <br><br>  A fun√ß√£o simplesmente cria um mutex come√ßando com <code>{181C8480-A975-411C-AB0A-630DB8B0A221}</code> seguido pelo nome de usu√°rio atual.  Em seguida, ela l√™ o arquivo despejado com a extens√£o * .db3, que cont√©m c√≥digo independente da posi√ß√£o, e usa <code>CreateThread</code> para executar o conte√∫do. <br><br>  O conte√∫do do arquivo * .db3 √© o c√≥digo de shell comumente usado pelo grupo OceanLotus.  Mais uma vez, descompactamos sua carga √∫til com sucesso usando o script emulador que publicamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no GitHub</a> . <br><br>  O script recupera o est√°gio final.  Esse componente √© um backdoor que j√° analisamos em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estudo anterior da OceanLotus</a> .  Isso pode ser determinado pelo GUID <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}</code> arquivo bin√°rio.  A configura√ß√£o do malware ainda est√° criptografada no recurso do PE.  Possui aproximadamente a mesma configura√ß√£o, mas os servidores C&amp;C s√£o diferentes dos anteriores: <br><br> <code>- andreagahuvrauvin[.]com <br> - byronorenstein[.]com <br> - stienollmache[.]xyz</code> <br> <br>  O OceanLotus novamente demonstra uma combina√ß√£o de diferentes t√©cnicas para evitar a detec√ß√£o.  Eles retornaram com um esbo√ßo "refinado" do processo de infec√ß√£o.  Ao escolher nomes aleat√≥rios e preencher arquivos execut√°veis ‚Äã‚Äãcom dados aleat√≥rios, eles reduzem o n√∫mero de IoCs confi√°veis ‚Äã‚Äã(com base em hashes e nomes de arquivos).  Al√©m disso, gra√ßas ao uso de carregamento de DLL de terceiros, os invasores precisam apenas remover o bin√°rio leg√≠timo do <code>AcroTranscoder</code> . <br><br><h2>  Arquivos de extra√ß√£o autom√°tica </h2><br>  Ap√≥s os arquivos RTF, o grupo mudou para os arquivos de extra√ß√£o autom√°tica (SFX) com √≠cones de documentos comuns para confundir ainda mais o usu√°rio.  Isso foi escrito pelo Threatbook ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">link em chin√™s</a> ).  Ap√≥s o in√≠cio, os arquivos RAR de extra√ß√£o autom√°tica s√£o despejados e as DLLs com a extens√£o .ocx s√£o executadas, cuja carga final foi documentada anteriormente <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> .  Desde meados de janeiro de 2019, o OceanLotus reutilizou essa t√©cnica, mas com o tempo, algumas configura√ß√µes foram alteradas.  Nesta se√ß√£o, falaremos sobre tecnologia e mudan√ßas. <br><br><h4>  Cria√ß√£o de iscas </h4><br>  O documento <code>THICH-THONG-LAC-HANH-THAP-THIEN-VIET-NAM (1).EXE</code> (SHA-1: <code>AC10F5B1D5ECAB22B7B418D6E98FA18E32BBDEAB</code> ) foi encontrado pela primeira vez em 2018.  Este arquivo SFX foi criado com sabedoria - a descri√ß√£o ( <i>Informa√ß√µes da vers√£o</i> ) diz que esta √© uma imagem JPEG.  O script SFX √© o seguinte: <br><br><img src="https://habrastorage.org/webt/i7/tg/nz/i7tgnzif_wi8kcy7g3liki3la4e.png"><br>  <i>Figura 9. Comandos SFX</i> <br><br>  O malware redefine <code>{9ec60ada-a200-4159-b310-8071892ed0c3}.ocx</code> (SHA-1: <code>EFAC23B0E6395B1178BCF7086F72344B24C04DCC</code> ), al√©m da imagem <code>2018 thich thong lac.jpg.</code> <br><br>  A imagem da isca √© a seguinte: <br><br><img src="https://habrastorage.org/webt/x2/xh/sn/x2xhsnoscn9jdpm_phc4x5bms4q.jpeg"><br>  <i>Figura 10. A imagem da isca</i> <br><br>  Voc√™ deve ter notado que as duas primeiras linhas do script SFX chamam o arquivo OSX duas vezes, mas isso n√£o √© um erro. <br><br><h4>  {9ec60ada-a200-4159-b310-8071892ed0c3} .ocx (ShLd.dll) </h4><br>  O fluxo de controle de arquivo OSX √© muito semelhante a outros componentes do OceanLotus - h√° muitas sequ√™ncias de comandos <code>JZ/JNZ</code> e <code>PUSH/RET</code> alternando com o c√≥digo de lixo eletr√¥nico. <br><br><img src="https://habrastorage.org/webt/hs/1j/yd/hs1jydni8wxcqylyvtvimc7_ckm.png"><br>  <i>Figura 11. C√≥digo ofuscado</i> <br><br>  Ap√≥s filtrar o c√≥digo n√£o solicitado, a exporta√ß√£o <code>DllRegisterServer</code> chamada por <code>regsvr32.exe</code> fica assim: <br><br><img src="https://habrastorage.org/webt/qh/r3/ws/qhr3ws_knbm_pewxrzsqhrpzggi.png"><br>  <i>Figura 12. C√≥digo b√°sico do instalador</i> <br><br>  De fato, na primeira vez que <code>DllRegisterServer</code> chamado <code>DllRegisterServer</code> exporta√ß√£o define o valor do Registro <code>HKCU\SOFTWARE\Classes\CLSID\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\Model</code> para o deslocamento criptografado na DLL ( <code>0x10001DE0</code> ). <br><br>  Quando uma fun√ß√£o √© chamada pela segunda vez, ela l√™ o mesmo valor e √© executada nesse endere√ßo.  A partir daqui, um recurso √© lido e executado e v√°rias a√ß√µes na RAM. <br><br>  O shellcode √© o mesmo carregador de PE usado nas campanhas anteriores do OceanLotus.  Pode ser emulado usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nosso script</a> .  Como resultado, ele despeja o <code>db293b825dcc419ba7dc2c49fa2757ee.dll</code> , carrega-o na mem√≥ria e executa o <code>DllEntry</code> . <br><br>  A DLL extrai o conte√∫do de seu recurso, descriptografa (AES-256-CBC) e descompacta (LZMA).  O recurso possui um formato espec√≠fico que √© f√°cil de descompilar. <br><br><img src="https://habrastorage.org/webt/ge/l4/ss/gel4ssv32blxwcjjlxkc57g0vie.png"><br>  <i>Figura 13. Estrutura de configura√ß√£o do instalador (KaitaiStruct Visualizer)</i> <br><br>  A configura√ß√£o √© definida explicitamente - dependendo do n√≠vel de privil√©gio, os dados bin√°rios ser√£o gravados em <code>%appdata%\Intel\logs\BackgroundUploadTask.cpl</code> ou <code>%windir%\System32\BackgroundUploadTask.cpl</code> (ou <code>SysWOW64</code> para sistemas de 64 bits). <br><br>  A persist√™ncia √© garantida atrav√©s da cria√ß√£o de uma tarefa chamada <code>BackgroundUploadTask[junk].job</code> , em que <code>[junk]</code> √© um conjunto de bytes <code>0x9D</code> e <code>0xA0</code> . <br><br>  O nome do aplicativo da tarefa √© <code>%windir%\System32\control.exe</code> e o valor do par√¢metro √© o caminho para o arquivo bin√°rio descarregado.  A tarefa oculta √© executada todos os dias. <br><br>  Estruturalmente, o arquivo CPL √© uma DLL com o nome interno <code>ac8e06de0a6c4483af9837d96504127e.dll</code> , que exporta a fun√ß√£o <code>CPlApplet</code> .  Este arquivo descriptografa seu √∫nico recurso <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> , carrega essa DLL e chama sua √∫nica exporta√ß√£o <code>DllEntry</code> . <br><br><h4>  Arquivo de configura√ß√£o de backdoor </h4><br>  A configura√ß√£o de backdoor √© criptografada e incorporada em seus recursos.  A estrutura do arquivo de configura√ß√£o √© muito semelhante √† anterior. <br><br><img src="https://habrastorage.org/webt/as/2f/c8/as2fc8ivbc6_bku2pjs5h-6_qtw.png"><br>  <i>Figura 14. Estrutura de configura√ß√£o de backdoor (KaitaiStruct Visualizer)</i> <br><br>  Apesar da estrutura semelhante, os valores de muitos campos foram atualizados em compara√ß√£o com os dados fornecidos em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nosso antigo relat√≥rio</a> . <br><br>  O primeiro elemento da matriz bin√°ria cont√©m a DLL ( <code>HttpProv.dll</code> MD5: <code>2559738D1BD4A999126F900C7357B759</code> ) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">identificada pelo Tencent</a> .  Mas como o nome da exporta√ß√£o foi removido do bin√°rio, os hashes n√£o correspondem. <br><br><h3>  Pesquisa adicional </h3><br>  Coletando amostras, chamamos a aten√ß√£o para algumas caracter√≠sticas.  A amostra que acabou de descrever apareceu por volta de julho de 2018 e outras semelhantes recentemente, em meados de janeiro - in√≠cio de fevereiro de 2019.  Um arquivo SFX foi usado como vetor de infec√ß√£o, descarregando um documento de isca leg√≠timo e um arquivo OSX malicioso. <br><br>  Embora o OceanLotus use registros de data e hora falsos, notamos que os registros de data e hora dos arquivos SFX e OCX s√£o sempre os mesmos ( <code>0x57B0C36A</code> (14/08/2016 √†s 19:15 UTC) e <code>0x498BE80F</code> ( <code>0x498BE80F</code> √†s 19:34 UTC) ) respectivamente).  Isso provavelmente indica que os autores t√™m um certo "construtor" que usa os mesmos modelos e simplesmente altera algumas caracter√≠sticas. <br><br>  Entre os documentos que estudamos desde o in√≠cio de 2018, existem v√°rios nomes que indicam os pa√≠ses de interesse do ataque: <br><br>  <i>- As novas informa√ß√µes de contato do Cambodia Media (New) .xls.exe</i> <i><br></i>  <i>- ÊùéÂª∫ È¶ô (‰∏™‰∫∫ ÁÆÄÂéÜ) .exe (documento pdf falso de um CV)</i> <i><br></i>  <i>- feedback, Rally nos EUA de 28 a 29 de julho de 2018.exe</i> <br><br>  Desde a descoberta do backdoor <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> e a publica√ß√£o de sua an√°lise por v√°rios pesquisadores, observamos algumas altera√ß√µes nos dados de configura√ß√£o do malware. <br><br>  Primeiro, os autores come√ßaram a remover nomes das DLL DLLs auxiliares ( <code>DNSprov.dll</code> e duas vers√µes do <code>HttpProv.dll</code> ).  Em seguida, os operadores pararam de compactar a terceira DLL (a segunda vers√£o do <code>HttpProv.dll</code> ), optando por incorporar apenas uma. <br><br>  Em segundo lugar, muitos campos de configura√ß√£o de backdoor foram alterados, provavelmente para evitar a detec√ß√£o, pois muitas IoCs ficaram dispon√≠veis.  Entre os campos importantes modificados pelos autores est√£o os seguintes: <br><br><ul><li>  Chave de registro do AppX alterada (consulte IoCs) </li><li>  sequ√™ncia de codifica√ß√£o mutex ("def", "abc", "ghi") </li><li>  n√∫mero da porta </li></ul><br>  Finalmente, em todas as novas vers√µes analisadas, os novos C&amp;Cs s√£o listados na se√ß√£o IoCs. <br><br><h2>  Conclus√µes </h2><br>  OceanLotus continua a evoluir.  O cibergrupo est√° focado no refinamento e expans√£o de ferramentas e iscas.  Os autores mascaram cargas maliciosas com a ajuda de documentos que chamam a aten√ß√£o e s√£o relevantes para as supostas v√≠timas.  Eles desenvolvem novos designs e tamb√©m usam ferramentas publicamente dispon√≠veis, como a explora√ß√£o do Equation Editor.  Al√©m disso, eles est√£o aperfei√ßoando ferramentas para reduzir o n√∫mero de artefatos restantes nas m√°quinas das v√≠timas, reduzindo assim a chance de detec√ß√£o por software antiv√≠rus. <br><br><h2>  Indicadores de compromisso </h2><br>  Indicadores de compromisso e atributos MITRE ATT e CK est√£o dispon√≠veis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no Welivesecurity</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt446604/">https://habr.com/ru/post/pt446604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt446588/index.html">Verificando o c√≥digo fonte de Roslyn</a></li>
<li><a href="../pt446590/index.html">39 novos recursos dispon√≠veis no Java 12</a></li>
<li><a href="../pt446592/index.html">Verificando o c√≥digo fonte de Roslyn</a></li>
<li><a href="../pt446598/index.html">Recriando fontes CRT</a></li>
<li><a href="../pt446602/index.html">Corrente m√°xima DC atrav√©s do transistor de efeito de campo</a></li>
<li><a href="../pt446606/index.html">Verifique se voc√™ √© bom em tecnologia aditiva</a></li>
<li><a href="../pt446608/index.html">Superando a Terceira Lei da Gravidade Organizacional</a></li>
<li><a href="../pt446612/index.html">No momento em que come√ßamos a acreditar na inova√ß√£o</a></li>
<li><a href="../pt446614/index.html">Sistemas de arquivos virtuais Linux: por que eles s√£o necess√°rios e como eles funcionam? Parte 1</a></li>
<li><a href="../pt446616/index.html">Como fizemos o FaaS na nuvem dentro do Kubernetes e vencemos no Hackathon Tinkoff</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>