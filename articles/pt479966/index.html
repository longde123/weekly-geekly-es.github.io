<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê® üÜë üõèÔ∏è Playrix CI / CD: como constru√≠mos e testamos nossos jogos üßò üö∂üèΩ üç´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A equipe deve se concentrar na cria√ß√£o de jogos bonitos e bem-sucedidos, para todo o resto existe CI. 

 Onde aplicamos o IC? Quais abordagens e conce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Playrix CI / CD: como constru√≠mos e testamos nossos jogos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playrix/blog/479966/">  A equipe deve se concentrar na cria√ß√£o de jogos bonitos e bem-sucedidos, para todo o resto existe CI. <br><br>  Onde aplicamos o IC?  Quais abordagens e conceitos usamos?  Por que construir e testar compila√ß√µes?  A hist√≥ria detalhada sobre a CI e como ela √© organizada no Playrix far√° um curso de palestras.  Sob o corte - um breve aperto e alguns sotaques. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4e/54d/ab2/b4e54dab26c1357b27e3e31b88c9378d.png"></div><a name="habracut"></a><br>  Oi <br><br>  Primeiro, um pouco de aquecimento: o que √© integra√ß√£o cont√≠nua?  Se a equipe usar o reposit√≥rio e coletar compila√ß√µes noturnas - esse IC j√° est√°?  Qual √© a diferen√ßa entre Implanta√ß√£o Cont√≠nua e Entrega?  √â quase sem import√¢ncia.  Detalhes - para um c√≠rculo estreito de especialistas.  Se voc√™ quiser envolver toda a empresa em algum processo, crie um nome simples e bom para ela.  No Playrix, chamamos todas essas abordagens de CI.  Essa √© uma marca local e um logotipo legal: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebe/d97/d8e/ebed97d8e7a2fff88508b8e73c6b0e97.png" width="500"></div><br><h2>  Id√©ia </h2><br>  O IC n√£o √© uma meta, √© uma ferramenta.  Deve haver uma meta que voc√™ deseja alcan√ßar com a Integra√ß√£o Cont√≠nua, um problema que precisa ser resolvido.  Acontece que os processos de desenvolvimento e libera√ß√£o em uma equipe s√£o constru√≠dos com o princ√≠pio de "ora√ß√£o e produ√ß√£o".  √Äs vezes √© justificado, mas com pouca frequ√™ncia. <br><br>  Formulamos nosso objetivo da seguinte maneira: minimizar a probabilidade de problemas de integra√ß√£o, minimizar os recursos necess√°rios para corrigir os erros encontrados, reduzir o tempo das equipes de desenvolvimento de projetos para apoiar e apoiar os processos de IC. <br>  O CI √© a automa√ß√£o de processos de constru√ß√£o, teste de c√≥digo e sua entrega a v√°rios ambientes, automa√ß√£o de processos de desenvolvimento de rotina, integra√ß√£o m√∫tua de servi√ßos que todos usamos. <br><br>  A id√©ia est√° em um sistema que coleta tudo automaticamente, faz isso com frequ√™ncia, testa e entrega uma compila√ß√£o e tamb√©m direciona um relat√≥rio conveniente, ponto por ponto, se algo der errado. <br><br><h2>  Onde aplicamos o IC? </h2><br><ul><li>  Motor e utilit√°rios, </li><li>  nossos jogos para todas as plataformas, </li><li>  c√≥digo do servidor </li><li>  an√°lise, servi√ßos de marketing, automa√ß√£o diversa, servi√ßos de CI, </li><li>  a infraestrutura. </li></ul><br>  Isso est√° em todo lugar ou quase em todo lugar. <br><br>  Montagem e teste de cont√™ineres, implanta√ß√µes autom√°ticas nas atualiza√ß√µes de teste, preparo e produ√ß√£o, lamina√ß√£o e can√°rias - tudo isso que temos e mais aplic√°vel a servi√ßos e aplicativos da web.  Hoje vamos nos concentrar no CI para jogos: criar builds, test√°-los e entreg√°-los. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e87/bab/b31/e87babb31e40c7d90e3994f45be77792.png" width="500"></div><br><h2>  Paradigmas </h2><br>  Para atingir os objetivos mencionados acima, voc√™ precisa resolver v√°rios problemas.  Abaixo est√° um plano que estamos seguindo quando automatizamos algum processo em desenvolvimento, por exemplo, a montagem de um cliente de jogos para dispositivos m√≥veis.  √â muito conveniente ter uma lista de perguntas, respondendo as quais, voc√™ pode resolver qualquer problema que caia na equipe de IC. <br><br><ul><li><h3>  Documenta√ß√£o </h3></li></ul><br>  Instru√ß√µes de montagem de constru√ß√£o s√£o documenta√ß√£o, uma descri√ß√£o do nosso processo automatizado.  Muitas vezes, essa documenta√ß√£o est√° na cabe√ßa dos programadores.  Se uma equipe tiver um superespecialista na constru√ß√£o de compila√ß√µes e sem ela ningu√©m mais poder√° criar uma compila√ß√£o r√°pida e sem erros - √© hora de mudar alguma coisa, n√£o haver√° um envio. <br><br>  Bem, se essa documenta√ß√£o estiver enquadrada na forma de um script: entrei em uma linha de comando e em um conjunto de par√¢metros em uma m√°quina com um ambiente preparado - obtive uma compila√ß√£o. <br><br>  A melhor documenta√ß√£o do processo √© o c√≥digo do <s>gato</s> .  Mesmo que, por algum motivo, voc√™ precise repetir a opera√ß√£o manualmente, sempre poder√° faz√™-lo olhando para ela. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc1/b35/41c/bc1b3541c1eaf585466131dfc966a466.png" width="500"></div><ul><li><h3>  Registo </h3></li></ul><br>  O log de compila√ß√£o permite que voc√™ sempre diga com certeza: quem, quando, de qual confirma√ß√£o e com que resultado essa ou aquela compila√ß√£o foi coletada.  Ontem a constru√ß√£o estava prestes a acontecer, mas hoje n√£o estava.  N√≥s olhamos no log, encontramos a primeira compila√ß√£o de disquete, vemos a lista de confirma√ß√µes que chegaram l√° - lucro. <br><br>  A revista √© ainda mais √∫til quando se trata, por exemplo, de c√≥digo de servidor.  Se n√£o houver informa√ß√µes sobre quem atualizou o produto e quando, no caso geral, n√£o se sabe qual c√≥digo est√° funcionando no momento.  E √†s vezes √© muito importante, muito. <br><br>  Voc√™ pode manter esse di√°rio no livro, de prefer√™ncia em uma tabela ou wiki.  A lista de compila√ß√µes no sistema de IC n√£o tem pre√ßo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dc/a88/26c/4dca8826cad8ae341be5df436c3fcab4.png"></div><br><ul><li><h3>  Seguran√ßa </h3></li></ul><br>  Quando se trata de criar uma constru√ß√£o e implantar em algum tipo de ambiente, sempre surge a pergunta: onde armazenar senhas de login / acesso?  Eles geralmente precisam de muito: no reposit√≥rio para baixar os dados de origem, no armazenamento de arquivos para preencher os recursos do jogo, no HockeyApp para enviar caracteres, no servidor para atualizar o c√≥digo etc. <br><br>  Acontece que todos os acessos necess√°rios s√£o armazenados no reposit√≥rio.  Existe uma hip√≥tese de que isso n√£o seja muito bom.  Geralmente, voc√™ pode ver o campo "digitar a senha", digamos, em Jenkins, onde o autor da compila√ß√£o digita os caracteres ocultos. <br><br>  Lembrar todas as senhas de cor √© uma boa habilidade.  Nosso servidor de IC recebe os acessos necess√°rios, dependendo da montagem.  Geralmente, esses tokens de vida curta s√£o gerados no in√≠cio da constru√ß√£o e fornecem direitos m√≠nimos exatamente onde implantamos algo ou de onde lemos algo. <br><br>  O gerenciamento centralizado da montagem e implanta√ß√£o permite resolver o problema de diferenciar os direitos de acesso √† infraestrutura.  Por que dar a algu√©m acesso ao servidor se voc√™ s√≥ pode dar acesso ao conjunto da compila√ß√£o correspondente que faz a opera√ß√£o necess√°ria nesse servidor?  E como existe uma compila√ß√£o, temos documenta√ß√£o e di√°rio, bem, voc√™ entende. <br><br><ul><li><h3>  Rastreabilidade </h3></li></ul><br>  Geralmente, existem muitos tra√ßos deixados durante o tempo de compila√ß√£o.  N√£o, n√£o √© assim: durante a compila√ß√£o, √© necess√°rio deixar o maior n√∫mero poss√≠vel de tra√ßos.  No reposit√≥rio, no rastreador de tarefas, no sistema de distribui√ß√£o de constru√ß√£o.  Em todos os lugares, onde quer que voc√™ encontre uma constru√ß√£o, deve haver rastros que o levem a concluir informa√ß√µes sobre ela. <br><br>  Esses tra√ßos n√£o precisam ser varridos, pelo contr√°rio, devem ser cuidadosamente deixados e cuidadosamente preservados.  Al√©m disso, vou falar mais sobre isso, mas primeiro precisamos coletar nossa compila√ß√£o.  Vamos l√° <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75c/436/e91/75c436e91724a70d5442af7c6432516d.png" width="500"></div><h2>  Ganchos de pr√©-confirma√ß√£o </h2><br>  Novamente, a ideia √© um sistema que coleta, testa e relata tudo.  Mas por que construir uma constru√ß√£o se voc√™ n√£o pode constru√≠-la? <br><br>  Todos os desenvolvedores de nossos jogos t√™m ganchos de pr√©-confirma√ß√£o instalados, ou seja,  um conjunto de verifica√ß√µes que s√£o executadas ao tentar confirmar algo.  As verifica√ß√µes s√£o executadas apenas para arquivos modificados, mas implementamos um sistema de pesquisa de depend√™ncia cruzada muito esperto para verificar tamb√©m todo o conte√∫do relacionado.  I.e.  se o artista adicionou uma textura, os ganchos verificar√£o se eles n√£o se esqueceram de registr√°-la sempre que necess√°rio e nunca a selaram. <br><br>  Acontece que os ganchos capturam uma parte significativa de pequenos erros.  Eles economizam os recursos do sistema de compila√ß√£o e ajudam o desenvolvedor a resolver rapidamente o problema: ele v√™ uma mensagem que diz em detalhes o que deu errado.  E ele n√£o precisa alternar entre tarefas: ele literalmente apenas fez altera√ß√µes e est√° no contexto.  O tempo de corre√ß√£o de erros √© m√≠nimo. <br><br>  Gostamos tanto que at√© criamos um sistema que verifica se ganchos foram feitos para um commit que entrou no reposit√≥rio.  Caso contr√°rio, o autor dessa confirma√ß√£o receber√° automaticamente uma tarefa solicitando a configura√ß√£o e instru√ß√µes detalhadas sobre como fazer isso. <br><br>  Os ganchos s√£o padronizados para todos os projetos.  O n√∫mero de testes personalizados √© m√≠nimo.  Existe uma personaliza√ß√£o conveniente, incluindo dependendo do usu√°rio que est√° executando: isso √© muito conveniente para testar testes. <br><br><h2>  Construir </h2><br>  Para ver o problema na compila√ß√£o o mais cedo poss√≠vel, voc√™ precisa coletar e testar essas compila√ß√µes o mais r√°pido poss√≠vel.  Os clientes de nossos jogos se re√∫nem para todas as plataformas, para cada confirma√ß√£o, para todos os projetos.  Provavelmente existem algumas exce√ß√µes, mas n√£o muitas. <br><br>  Normalmente, um cliente, especialmente um m√≥vel, tem v√°rias vers√µes diferentes: com e sem truques, com assinatura diferente etc.  Para cada confirma√ß√£o, coletamos compila√ß√µes "regulares", que desenvolvedores e testadores usam constantemente. <br><br>  H√° builds usados ‚Äã‚Äãmuito raramente, por exemplo, a loja ios build - apenas uma vez em um envio, ou seja,  cerca de uma vez por m√™s.  No entanto, acreditamos que todas as compila√ß√µes devem ser coletadas regularmente.  Se ocorrer um problema com esse tipo de montagem, no lado do desenvolvimento ou da infraestrutura, a equipe do projeto saber√° sobre isso n√£o no dia em que a compila√ß√£o for entregue, mas muito antes, e poder√° responder e corrigir o problema com anteced√™ncia. <br><br>  Como resultado, temos uma regra simples: qualquer build √© iniciada pelo menos uma vez por dia.  A equipe de desenvolvimento do projeto descobre a presen√ßa de problemas em qualquer plataforma, no pior dos casos, na manh√£ seguinte, depois que esse problema apareceu no reposit√≥rio. <br><br>  Essa frequ√™ncia de montagens e testes requer uma abordagem especial para otimizar o tempo de execu√ß√£o. <br><br><ul><li>  Todas as compila√ß√µes regulares de clientes s√£o incrementais. </li><li>  Atlas de embalagem e prepara√ß√£o de recursos tamb√©m s√£o incrementais. </li><li>  As montagens s√£o granulares: algumas das etapas est√£o em configura√ß√µes de compila√ß√£o separadas - isso permite execut√°-las em paralelo e reutilizar resultados intermedi√°rios. </li></ul><br>  Esta √© uma captura de tela quase completa da cadeia de compila√ß√µes e testes do WildScapes.  O total n√£o p√¥de ser feito: √© duas vezes maior. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/672/415/771/67241577111cb4d6b5d1df70a54337e5.png"></div><br><h2>  Testes est√°ticos </h2><br>  Ap√≥s a montagem, √© realizado o teste est√°tico: pegamos a pasta com a compila√ß√£o e executamos um conjunto de verifica√ß√µes de todo o conte√∫do existente.  O c√≥digo tamb√©m √© conte√∫do, portanto sua an√°lise est√°tica (cppcheck + PVS-Studio) tamb√©m est√° aqui. <br><br>  Em um habr, havia <a href="https://habr.com/ru/company/playrix/blog/452926/">um material detalhado</a> sobre como implementamos o teste est√°tico, eu recomendo.  Enfatizo apenas que os testes est√°ticos ap√≥s a compila√ß√£o e nos ganchos de pr√©-confirma√ß√£o s√£o executados pelo mesmo c√≥digo.  Isso simplifica bastante o suporte ao sistema. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69f/195/0dd/69f1950dd3434591d233507574609672.png" width="500"></div><br><h2>  Testes de tempo de execu√ß√£o </h2><br>  Se a compila√ß√£o de testes est√°ticos foi bem-sucedida, voc√™ pode prosseguir e tentar executar a compila√ß√£o montada.  Estamos testando compila√ß√µes em todas as plataformas, exceto UWP, ou seja,  Windows, MacOs, iOS, Android.  UWP - tamb√©m ser√°, mas um pouco mais tarde. <br><br>  Por que testar a cria√ß√£o de desktops, se eles parecem necess√°rios apenas no desenvolvimento?  A resposta para a pergunta √©: √© ruim se um artista ou um designer de n√≠vel obtiver uma compila√ß√£o que trava na inicializa√ß√£o por algum motivo rid√≠culo.  Portanto, o Smoke-Test, o conjunto m√≠nimo de verifica√ß√µes de jogabilidade e jogabilidade b√°sica, √© realizado para todas as plataformas. <br><br>  Tudo o que foi escrito acima sobre compila√ß√µes tamb√©m √© v√°lido para testes em dispositivos - pelo menos uma vez por dia.  Com poucas exce√ß√µes: existem testes muito longos que n√£o t√™m tempo para concluir em um dia. <br><br>  Testes de fuma√ßa s√£o executados para cada confirma√ß√£o.  A conclus√£o bem-sucedida das verifica√ß√µes b√°sicas √© um pr√©-requisito para a constru√ß√£o entrar no sistema de distribui√ß√£o.  Geralmente, n√£o faz sentido conceder a algu√©m acesso a uma constru√ß√£o que obviamente n√£o funciona.  Aqui voc√™ pode objetar e criar exce√ß√µes.  Os projetos t√™m uma solu√ß√£o alternativa para dar acesso a uma compila√ß√£o que n√£o funciona, mas eles dificilmente a usam. <br><br>  Que outros testes existem: <br><br><ul><li>  Refer√™ncia: verificamos o desempenho no FPS e na mem√≥ria em v√°rias situa√ß√µes e em todos os dispositivos. </li><li>  Testes unit√°rios de combina√ß√£o 3: cada elemento e cada mec√¢nica s√£o testados individualmente e em todas as combina√ß√µes de intera√ß√£o. </li><li>  A passagem de todo o jogo do in√≠cio ao fim. </li><li>  V√°rios testes de regress√£o, por exemplo, testes de localiza√ß√£o ou que todas as janelas da interface do usu√°rio sejam abertas corretamente ou que as cenas de fishdom em Fishdom sejam reproduzidas sem erros. </li><li>  Mesmo assim, mas com <a href="https://en.wikipedia.org/wiki/AddressSanitizer">AddressSanitizer</a> . </li><li>  Testes de compatibilidade para vers√µes de jogos: leve o usu√°rio para salvar o arquivo das vers√µes anteriores, abra-o na nova vers√£o e verifique se est√° tudo bem. </li><li>  V√°rios testes personalizados relevantes para o mec√¢nico de um projeto espec√≠fico. </li></ul><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c7a/24e/992/c7a24e992e95338aa4e884f367168b9e.png" width="500"></div><br>  Para executar os testes, usamos nosso pr√≥prio suporte de teste para dispositivos iOS e Android.  Isso nos permite iniciar com flexibilidade as compila√ß√µes necess√°rias nos dispositivos, interagir com o dispositivo a partir do c√≥digo.  Temos controle total, um n√≠vel compreens√≠vel de confiabilidade, sabemos quais problemas podemos enfrentar e quanto tempo levar√° para resolv√™-los.  Nenhum dos servi√ßos em nuvem que fornecem dispositivos de teste oferece esse conforto. <br><br><h2>  GATOS </h2><br>  Os testes listados acima s√£o implementados dentro do c√≥digo do projeto.  Isso permite, em teoria, fazer um teste de qualquer complexidade, mas requer esfor√ßo e recursos do desenvolvimento do projeto para implementar e dar suporte a esses testes.  Esses recursos geralmente n√£o est√£o dispon√≠veis e o teste manual de regress√£o m√∫ltipla √© dif√≠cil e desnecess√°rio.  Eu realmente queria que os testadores fizessem a automa√ß√£o de testes.  E criamos uma estrutura para eles - o Sistema de Teste de Automa√ß√£o Cont√≠nua, ou CATS. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f1/40d/aab/9f140daab4981b2700a9e40358ceb51e.png" width="500"></div><br>  Qual √© a ideia: permitir que os autores do script de teste interajam com o aplicativo de jogos, absolutamente sem se importar com o modo como tudo funciona.  Escrevemos scripts em python primitivo, acessamos o aplicativo atrav√©s de um conjunto de abstra√ß√µes.  Por exemplo: "Homescapes, abra-me uma vitrine e compre esse e aquele produto".  Veja o resultado, bingo. <br><br>  Toda a implementa√ß√£o dos comandos de script est√° oculta por tr√°s de um conjunto de abstra√ß√µes.  A API que implementa a intera√ß√£o com o aplicativo permite executar qualquer a√ß√£o de v√°rias maneiras: <br><br><ul><li>  envie uma solicita√ß√£o http para o servidor, que est√° embutido no mecanismo de jogo, com algum tipo de comando.  Este comando √© processado pelo c√≥digo do jogo.  Geralmente isso √© algum tipo de trapa√ßa, pode ser arbitrariamente simples ou complexo.  Por exemplo, "forne√ßa as coordenadas do centro do bot√£o com o identificador especificado".  Ou "passe-me o jogo daqui para o n√≠vel com o n√∫mero indicado". </li><li>  Podemos abrir uma janela atrav√©s do truque ou descobrir as coordenadas do bot√£o pelo qual essa janela se abre, podemos emular o clique nesse bot√£o, podemos executar um clique virtual nele. </li><li>  Finalmente, podemos executar um clique "real" nas coordenadas especificadas, como se isso fosse feito com um dedo na tela. </li></ul><br>  O √∫ltimo m√©todo abre espa√ßo para a imagina√ß√£o dos testadores que frequentemente desejam testar compila√ß√µes de "combate", onde n√£o h√° truques.  Manter esses cen√°rios √© mais dif√≠cil, mas uma "compila√ß√£o de combate" √© uma compila√ß√£o de "combate". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e25/0de/9ce/e250de9ce8a6e45d5ecfc8495eec7cb2.png"></div><br>  Acabou sendo muito conveniente trabalhar com as coordenadas do centro do bot√£o: as coordenadas √†s vezes mudam, mas os identificadores de bot√£o s√£o raros.  Isso levou a outra propriedade importante do sistema: a capacidade de escrever um script de teste para todas as plataformas e todas as resolu√ß√µes de tela. <br><br><h2>  Entrega, relat√≥rios e rastreamentos </h2><br>  Com a entrega, tudo ficou bem simples: usamos um √∫nico armazenamento compartilhado para criar artefatos e para armazenamento no sistema de distribui√ß√£o.  O "carregamento" da compila√ß√£o se resume a chamar um par de solicita√ß√µes para a API do servi√ßo de distribui√ß√£o da compila√ß√£o, basicamente registrando-se.  Dessa forma, economizamos um pouco de tempo em bombear constru√ß√µes e dinheiro para seu armazenamento. <br><br>  Lembre-se de que voc√™ falou em minimizar os recursos necess√°rios para corrigir erros encontrados nas compila√ß√µes?  Relat√≥rios e trilhas - exatamente sobre isso: <br><br><ul><li>  Relatar um problema encontrado √© uma tarefa no Asana.  √â f√°cil de controlar, atribua-o ao desenvolvedor certo, transfira-o para a equipe de IC se algo der errado na infraestrutura. </li><li>  Coletamos compila√ß√µes para cada confirma√ß√£o.  Conhecemos o autor desse commit, portanto somente ele ver√° essa tarefa.  Portanto, economizamos tempo para outros desenvolvedores: eles n√£o precisam se distrair com problemas com os quais n√£o t√™m nada a ver e ajudar a resolver os quais, provavelmente, eles n√£o conseguir√£o. </li><li>  Se voc√™ criar uma compila√ß√£o a partir do pr√≥ximo commit, provavelmente ainda est√° com defeito.  Haver√° um coment√°rio na tarefa: ‚ÄúA compila√ß√£o ainda est√° quebrada‚Äù, o autor do novo commit n√£o ver√° a tarefa e n√£o perder√° tempo com o problema de outra pessoa. </li><li>  Enviamos relat√≥rios para o Slack.  Necessariamente - pessoalmente para quem "quebrou" a compila√ß√£o e, se o projeto quiser - para um canal especial ou para qualquer funcion√°rio da Playrix.  Tudo √© o mais flex√≠vel poss√≠vel. </li></ul><br>  Rastreios s√£o necess√°rios para que em todos os lugares haja informa√ß√µes completas sobre a constru√ß√£o e as altera√ß√µes das quais ela foi coletada.  Para n√£o procurar nada, para que tudo estivesse √† m√£o e n√£o houvesse necessidade de gastar tempo procurando detalhes que geralmente s√£o necess√°rios ao pesquisar um problema. <br><br><ul><li>  O relat√≥rio cont√©m um link para a compila√ß√£o, o log de compila√ß√£o, o texto do erro de compila√ß√£o encontrado e os nomes dos testes invertidos.  Geralmente, um programador, ap√≥s receber uma tarefa de relat√≥rio, pode corrigir imediatamente o erro: o nome do arquivo, a linha e o texto do erro est√£o no relat√≥rio. </li><li>  A mensagem no Slack cont√©m todos os mesmos + um link para a tarefa no Asana. </li><li>  No Teamcity, um link para uma tarefa.  O engenheiro de constru√ß√£o pode entrar imediatamente na tarefa; em um clique, voc√™ n√£o precisa procurar nada. </li><li>  No github - status com um link para a compila√ß√£o, no coment√°rio ao commit - um link para a tarefa para a qual essa compila√ß√£o foi feita.  Na tarefa - um coment√°rio com um link para o commit. </li><li>  No servi√ßo de distribui√ß√£o de build: link para o build, link para o commit. </li></ul><br>  N√£o h√° nada a lembrar, mas voc√™ entendeu a ideia: links para tudo, em qualquer lugar.  Isso acelera bastante o estudo de qualquer situa√ß√£o incompreens√≠vel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94d/4dc/1a0/94d4dc1a015d9f068e9c5dce0461b17a.png"></div><h2>  Fazenda </h2><br>  Coletamos e testamos compila√ß√µes para todas as plataformas.  Para isso, precisamos de muitos agentes diferentes.  Rastrear e mant√™-los manualmente √© longo e dif√≠cil.  Todos os agentes s√£o preparados automaticamente.  Usamos Packer e Ansible. <br><br>  Todos os logs de todos os agentes, Teamcity, todos os servi√ßos existentes, salvamos (no nosso caso - no ELK).  Todos os servi√ßos, processando uma compila√ß√£o, adicionam o n√∫mero dessa compila√ß√£o a cada linha de logs.  Podemos ver em uma √∫nica solicita√ß√£o todo o ciclo de vida da constru√ß√£o, desde a sua apar√™ncia na fila at√© o final do envio de todos os relat√≥rios. <br><br>  Implementamos nosso pr√≥prio mecanismo de otimiza√ß√£o de fila.  O do Teamcity n√£o funciona muito bem em nossos n√∫meros.  Falando em n√∫meros: <br><br><ul><li>  Coletamos cerca de 5.000 compila√ß√µes todos os dias.  S√£o cerca de 500 horas de trabalho da m√°quina. </li><li>  A constru√ß√£o do milion√©simo milion√©simo foi h√° um m√™s. </li><li>  Temos mais de 50 servidores de compila√ß√£o em 10 locais diferentes. </li><li>  Mais de 40 dispositivos m√≥veis em um banco de testes. </li><li>  Exatamente 1 servidor Teamcity. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e8/4eb/797/5e84eb79776709b09b73921f78cbb41a.png" width="500"></div><br><h2>  IC como servi√ßo </h2><br>  O Playrix CI √© um servi√ßo.  Existem muitos projetos, muitas id√©ias tamb√©m. <br><br>  Otimizamos o tempo desde a inser√ß√£o da constru√ß√£o na fila at√© o final de sua execu√ß√£o, porque √© exatamente isso que o "tempo de constru√ß√£o" √© considerado pelo usu√°rio do servi√ßo, o desenvolvedor.  Isso nos permite pesquisar e encontrar um equil√≠brio entre o tempo de constru√ß√£o e o tempo gasto na fila.  Parece l√≥gico que, com o crescimento da empresa e o n√∫mero de projetos, o farm de cria√ß√£o que coleta esses projetos tamb√©m crescer√°.  Mas, gra√ßas √†s otimiza√ß√µes, a taxa de crescimento da fazenda est√° muito aqu√©m da taxa de crescimento da empresa. <br><br>  Qualquer otimiza√ß√£o come√ßa com o monitoramento, com uma cole√ß√£o met√≥dica de estat√≠sticas.  Coletamos muitas estat√≠sticas e sabemos absolutamente tudo sobre nossas compila√ß√µes.  Mas, al√©m do volume do farm de builds, tamb√©m h√° uma equipe que oferece suporte ao sistema de IC e faz com que ele n√£o precise pensar sobre de onde v√™m os builds. <br><br>  A otimiza√ß√£o de processos nessa equipe tamb√©m √© um processo interessante e divertido.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, escrevemos testes para definir configura√ß√µes de compila√ß√µes, porque existem muitas dessas configura√ß√µes, sem testes semelhantes, n√£o √© f√°cil encontrar todos os locais que precisam ser editados. </font><font style="vertical-align: inherit;">Para quase todas as altera√ß√µes, primeiro escrevemos um teste e depois fazemos, ou seja, temos TDD. </font><font style="vertical-align: inherit;">Existem muitos processos relacionados a tarefas, gerenciamento de incidentes, agendamento do fluxo de tarefas recebidas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os desenvolvedores devem se concentrar na cria√ß√£o de jogos excelentes e bem-sucedidos sem se preocupar com a origem das compila√ß√µes. </font><font style="vertical-align: inherit;">Para isso, o Playrix tem um IC. </font><font style="vertical-align: inherit;">Deve haver uma meta que voc√™ deseja alcan√ßar com a Integra√ß√£o Cont√≠nua, um problema que precisa ser resolvido. </font><font style="vertical-align: inherit;">√â importante n√£o apresentar um problema, ou seja, encontr√°-lo. </font><font style="vertical-align: inherit;">E quando a encontrar, lembre-se da nossa experi√™ncia e fa√ßa melhor. </font><font style="vertical-align: inherit;">E lembre-se: a </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI nunca dorme </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vejo voc√™!</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/1f2/f01/7961f2f01ed13cee81c7ea0e604e7ace.png" width="500"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt479966/">https://habr.com/ru/post/pt479966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt479950/index.html">A hist√≥ria dos processadores de v√≠deo, parte 4: o advento da GPU de uso geral</a></li>
<li><a href="../pt479952/index.html">O que h√° dentro da shawarma: microsservi√ßos, sistemas distribu√≠dos e Kafka. Compartilhando materiais do Backend United # 5</a></li>
<li><a href="../pt479954/index.html">Tutorial de administra√ß√£o do Boot Spring</a></li>
<li><a href="../pt479958/index.html">Vulnerabilidades de firmware e processador</a></li>
<li><a href="../pt479960/index.html">O modelo da efic√°cia da publicidade na m√≠dia para lojas online</a></li>
<li><a href="../pt479968/index.html">O escrit√≥rio da Nginx est√° sendo revistado devido ao processo do Rambler Group. O servi√ßo de imprensa reclamante confirmou o processo</a></li>
<li><a href="../pt479970/index.html">Mil e uma erros de interface do usu√°rio ou como ajudar um desenvolvedor a evitar erros comuns da interface do usu√°rio</a></li>
<li><a href="../pt479972/index.html">Hist√≥rico de patches da Apple</a></li>
<li><a href="../pt479974/index.html">Ataques com clique zero: quando sua seguran√ßa n√£o depende de voc√™</a></li>
<li><a href="../pt479978/index.html">Como sem dor, sem captcha e gratuitamente para trazer extratos do Fundo Federal de Propriedade do Registro Federal dos Direitos Humanos do Estado para um leg√≠vel por humanos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>