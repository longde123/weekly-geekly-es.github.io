<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèúÔ∏è üë®üèª‚Äçüé§ üçø Bluetooth Wireless Audio-Technologie: Was ist besser? üï∂Ô∏è üêñ ü§òüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mit der Entwicklung der Technologie gehen die so bekannten analogen R√∂hrenkopfh√∂rer in die Geschichte ein - sie werden zunehmend durch drahtlose Bluet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bluetooth Wireless Audio-Technologie: Was ist besser?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433502/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/uz/_p/or/uz_por_7qlk9snfb7v_jg2x5iae.jpeg"></div><br>  Mit der Entwicklung der Technologie gehen die so bekannten analogen R√∂hrenkopfh√∂rer in die Geschichte ein - sie werden zunehmend durch drahtlose Bluetooth-Gegenst√ºcke ersetzt. <br><br>  Moderne Smartphones haben aus Gr√ºnden des Feuchtigkeits- und Staubschutzes keinen √ºblichen Anschluss. <br><br>  Entwickler ver√∂ffentlichen alle neuen Versionen des Bluetooth-Protokolls und alle neuen Versionen von Codecs und versprechen "schneller, h√∂her, st√§rker" - weniger Verz√∂gerungen bei der Wiedergabe und bessere Qualit√§t. <br><br>  Ist alles so gut  Mal sehen. <br><a name="habracut"></a><br><h2>  Einf√ºhrung </h2><br>  Ich werde mich nicht mit der technischen Implementierung der Protokolle sowie den langweiligen Spezifikationen befassen.  Lieber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ValdikSS</a> , der in diesem Artikel weitgehend als Inspiration und sogar als wissenschaftlicher Berater fungierte, bereitet umfassendes Material zu Codecs vor - und alles wird dort viel detaillierter und technisch korrekter dargestellt. <br><br>  Ich m√∂chte mehr √ºber pers√∂nliche Erfahrungen erz√§hlen.  Nun, ein wenig unterhaltsames (langweiliges?) √úben. <br><br>  Vor anderthalb Jahren war ich von der Idee von aptX begeistert.  Ja, ich habe viele solcher Bewertungen gelesen und an all diese technischen Wendungen geglaubt.  Ein Kind wurde geboren - und ich wollte unbedingt nachts mit meiner Frau Shows mit Kopfh√∂rern sehen, ohne L√§rm zu machen und niemanden im Haus zu wecken. <br><br>  Was hat es ergeben? <br><br><h2>  Qualit√§t </h2><br>  Beginnen wir mit Zahlen und Fakten (Hallo, Wikipedia!) <br><br>  <b>SBC</b> ist ein guter alter Codec, der dem A2DP-Standard entspricht.  Der Codec ist das Ergebnis der Arbeit von Frans de Bont <i>(F. de Bont, M. Groenewegen und W. Oomen, "Ein qualitativ hochwertiges Audiocodierungssystem mit 128 kb / s", 98. AES-Konvention, 25.-28. Februar 1995)</i> und seiner Verwendung die im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Patent EP-0400755B1</a> beschriebenen Algorithmen.  Es ist bemerkenswert, dass die Autoren des Patents die kostenlose Nutzung von SBC nur in der Bluetooth-Anmeldung zulassen. Das Patent ist jedoch am 2. Juni 2010 abgelaufen.  Da der A2DP-Standard sehr verbreitet ist, ist es √§u√üerst schwierig, Kopfh√∂rer oder Lautsprecher zu finden, die keine SBC-Unterst√ºtzung bieten. <br><br>  Der Codec bietet eine Abtastfrequenz von 16, 32, 44,1, 48 kHz mit einer Flussrate von 10-1500 kbit / s.  Ja, du hast richtig geh√∂rt.  Bis zu 1500 kbps.  Es gibt einfach keine Bitratenbegrenzung im Codec.  Aber dazu sp√§ter mehr. <br><br>  Der <b>aptX-</b> Codec <b>wurde</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1988 an der Queen's University in Belfast entwickelt</a> .  Ja, vor Bluetooth gab es noch ungef√§hr ein Dutzend Jahre, daher wurde der Codec in professionellen Audioger√§ten verwendet.  Qualcomm besitzt derzeit die Rechte und daher erfordert die Nutzung Lizenzen und Lizenzgeb√ºhren.  Ab 2014 betragen die Kosten ungef√§hr die folgenden: eine einmalige Zahlung von 6.000 USD und 1 USD f√ºr jedes Ger√§t, das f√ºr Parteien mit bis zu 10.000 Ger√§ten freigegeben wurde.  Aus diesem Grund sind viele Ger√§te mit Snapdragon 835, 845, 821, 820, 810, 805, 801, 800, 650, 615, 410 Chips durchaus m√∂glich und unterst√ºtzen aptX, werden dort jedoch nicht aktiviert, da die Lizenz nicht gekauft wurde.  Dar√ºber - auch unten. <br><br>  Mit einer Bittiefe von 16 Bit und einer Abtastfrequenz von 48 kHz kann der Codec eine Bitrate von 384 kbit / s (Zweikanal) bereitstellen. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Liste der Produkte, die aptX offiziell unterst√ºtzen</a> .  Sie k√∂nnen auf Aliexpress viele unbekannte Systeme mit aptX-Unterst√ºtzung finden, aber seien Sie darauf vorbereitet, dass es tats√§chlich denselben guten alten SBC geben wird - und nicht mehr. <br><br>  <b>aptX HD</b> - der gleiche Codec, jedoch mit einem anderen Codierungsprofil, hat eine Stream-Geschwindigkeit von 576 kbit / s, Unterst√ºtzung f√ºr Abtastfrequenzen bis zu 48 kHz und Bittiefe bis zu 24 Bit.  Einige Leute nennen diesen aptX Lossless-Codec - aber das ist v√∂lliger Unsinn, schon allein deshalb, weil es derzeit unm√∂glich ist, den Wert eines Streams zu erreichen, der verlustfreie Daten enthalten k√∂nnte.  Ein besonderer Vorteil dieses Codecs ist eine einstellbare Codierungsverz√∂gerung, die bei einer Abtastfrequenz von 48 kHz auf 1 ms reduziert werden kann.  Au√üerdem ist der Codec vom Standpunkt des Prozessorladens √§u√üerst vorteilhaft, was einen Vorteil gegen√ºber MP3 und AAS ausdr√ºckt. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Liste der Produkte, die aptX HD offiziell unterst√ºtzen</a> .  Er ist klein genug. <br><br>  <b>aptX Low Latency</b> (oder LL) ist eine spezielle Version des Codecs, mit der Sie die Tonverz√∂gerungszeit auf weniger als 40 ms reduzieren k√∂nnen.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Liste der Produkte, die aptX LL offiziell unterst√ºtzen</a> . <br><br><img src="https://habrastorage.org/webt/oz/nd/5q/oznd5qcoovjbj8f4xdtfydbl_ym.png" alt="Bild"><br><br>  Da ist sie.  Es war dieses Bild, das mich einmal mit Innereien gekauft hat.  Verz√∂gerungen!  Wer will schon den Klang einer Explosion in einem Actionfilm h√∂ren, den Schrei eines Monsters in einem Horrorfilm oder das Dr√∂hnen einer Menge bei einem Fu√üballspiel, wenn alles vorbei ist? <br><br>  Aber ist das alles wirklich so? <br><br>  Leider nein. <br><br>  Wie bei jedem Marketingmaterial sind die Zahlen weit hergeholt.  Die Verz√∂gerung h√§ngt weitgehend von der Pufferung im System und der Codec-Implementierung ab.  Die Verz√∂gerung mit SBC kann also durchaus weniger als 40 ms betragen, was angesichts der Standards der Fernseh√ºbertragung (+40 ms ... ‚Äì60 ms) durchaus akzeptabel ist. <br><br>  <u>Zusammenfassend:</u> <br><br><ol><li>  Kein vorhandener Codec kann besser sein als die kabelgebundene Technologie, da kein Codec eine echte verlustfreie Komprimierung erzielen kann. </li><li>  Der beliebteste Codec ist SBC.  Er ist am flexibelsten in Einstellungen.  Und trotz der Tatsache, dass aptX fr√ºher ver√∂ffentlicht wurde, konnte es die Popularit√§t von SBC nicht √ºbertreffen, anscheinend weil letzteres kostenlos war. </li><li>  Die Klangqualit√§t h√§ngt stark von der Implementierung des Codecs sowie von der Hardwareleistung der Kopfh√∂rer / Lautsprecher im Allgemeinen ab. Wenn der Lautsprecher selbst schwach ist, kann die Qualit√§t von keinem Codec verbessert werden.  Daher werden wir in Zukunft beim Vergleich der Qualit√§t davon sprechen, denselben Inhalt aus derselben Quelle auf denselben Lautsprechern / Kopfh√∂rern, jedoch mit unterschiedlichen Codecs abzuspielen. </li></ol><br><h2>  Praktische und sehr subjektive Ergebnisse </h2><br><img src="https://habrastorage.org/webt/fj/uf/kj/fjufkjmv-sxcezemnqcz3ztyue4.jpeg"><br><br>  Die Informationen basieren auf den bereits erw√§hnten anderthalb Jahren Erfahrung im Bedienen, Vergleichen und Anziehen von externen Zuh√∂rern. <br><br>  Die Erfahrung basiert auf dem verlustfreien H√∂ren auf dem SONY Walkman NWZ-A17-Player, auf dem der Codec ausgew√§hlt werden kann, sowie auf dem Ansehen verschiedener Programme mit Audioausgabe √ºber Avantree Priva III. <br><br>  Es gab drei Kopfh√∂rer: Sennheiser PMX 60, Koss Porta Pro und Koss UR-20. <br><br>  Jabra BT3030 (SBC) und Avantree Clipper Pro (aptX) wurden als drahtlose Signalempf√§nger verwendet. <br><br>  Ein Voombox Outdoor (SBC) -Lautsprecher und Aftershokz Trekz Titanium (aptX) -Knochenleitungskopfh√∂rer wurden ebenfalls verwendet. <br><br>  Alle Equalizer und Enhancer wurden ausgeschaltet - und das ist wichtig. <br><br>  <u>Gesamt:</u> <br><br><ol><li>  Die Klangqualit√§t einer Kabelverbindung ist immer besser.  Dies ist ohne Zweifel. </li><li>  Der Unterschied zwischen SBC und aptX ist √§u√üerst schwer zu h√∂ren - und nur bei einigen Arten von Musik.  Zum Beispiel h√∂rte der Autor des Artikels deutlich den Unterschied in Cellosoli in klassischen Kompositionen, w√§hrend der Unterschied bei Violinen- und Niederfrequenzinstrumenten weniger wahrnehmbar war.  In modernen Genres - Pop, elektronische Musik und Rock - ist der Unterschied nicht zu h√∂ren.  In einigen F√§llen schien es subjektiv, dass SBC den Ton besser √ºbertr√§gt als aptX. </li><li>  Die Verz√∂gerung zwischen SBC und aptX ist nur sichtbar, wenn Sie eine Verbindung zu derselben Quelle herstellen und verschiedene Empf√§nger in verschiedene Ohren einstecken (der linke Kanal ist beispielsweise SBC und der rechte ist aptX).  Es ist fast unm√∂glich, die Verz√∂gerung mit dem Bild zu sehen, aber weil die Geschichte, dass aptX f√ºr dynamische Szenen und Inhalte gedacht ist, ein Mythos ist. </li><li>  Die √úberraschung wurde durch die Klangqualit√§t der eher billigen und "nicht ber√ºhmten" Voombox Outdoor verursacht.  Anscheinend ist dies die erfolgreiche Implementierung von SBC, die oben erw√§hnt wurde. </li><li>  Die Implementierung von aptX in Kopfh√∂rern mit Knochenleitung ist v√∂llig unverst√§ndlich - die Technologie ist sehr spezifisch und daher ist der Qualit√§tsverlust aufgrund der Technologie selbst erheblich.  Angesichts des geringen Bereichs des ‚ÄûBereichs‚Äú des Ger√§tebetriebs und der √§u√üerst schlechten Implementierung der Kopplung mit zwei Ger√§ten kann ich sagen, dass Aftershokz ein Unternehmen ist, das mehr in Marketing als in Entwicklung investiert. </li></ol><br><br>  Ich behaupte nicht, dass Sie den Unterschied erkennen k√∂nnen und sollten, wenn Sie alle Arten von Spektralanalysatoren usw. anschlie√üen.  Aber das menschliche Ohr und noch schlimmer - das durchschnittliche menschliche Ohr - ist kein Spektralger√§t und h√∂rt daher nicht alle diese Nuancen. <br><br><h2>  √úbung: Fixieren, was repariert werden kann </h2><br><h3>  Teil 1. Schalten Sie aptX ein </h3><br>  Wie bereits erw√§hnt, ist bei einigen Ger√§ten die Verwendung von aptX deaktiviert, wahrscheinlich um Patentverfolgungen zu vermeiden. <br><br>  Dieses Problem kann ganz einfach gel√∂st werden, indem Sie das Bibliotheksger√§t verschieben, um den Codec zu implementieren, und die M√∂glichkeit schreiben, mit diesem Codec in build.prop zu arbeiten. <br><br>  Im Internet gibt es eine Vielzahl solcher L√∂sungen.  Ich nahm mir die Freiheit, sie zu einem zu kombinieren, w√§hrend ich es als Modul f√ºr Magisk realisierte.  Ja, dieses Projekt gef√§llt mir sehr gut und ich denke, dass die Implementierung von √Ñnderungen im System in Form von Magisk-Modulen eine bessere und sicherere L√∂sung darstellt, da das System in seiner urspr√ºnglichen Form gespeichert und auf einfache Weise zur√ºckgesetzt werden kann. <br><br>  Das Modul kann hier heruntergeladen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden</a> .  Ja, ich wei√ü √ºber Github Bescheid.  Und nein, bis ich Zeit habe, es dort abzulegen. <br><br>  Eintr√§ge in build.prop, einschlie√ülich aptX und, falls m√∂glich, aptX HD, werden vom Modul automatisch emuliert. <br><br><img src="https://habrastorage.org/webt/vg/lc/gu/vglcguyqsbbyxptonmhdw-5ta3y.png"><br><br><h3>  Teil 2. Erh√∂hen Sie die SBC-Bitrate </h3><br>  Wie bereits berichtet, unterliegt der SBC-Codec grunds√§tzlich keinen Bitratenbeschr√§nkungen.  Die Hersteller legen jedoch normalerweise einen Grenzwert von 342 kbit / s f√ºr Mono und 345 kbit / s f√ºr Stereo fest, um einen zuverl√§ssigen Betrieb mit allen Arten von Empfangsger√§ten zu gew√§hrleisten. <br><br>  Gleichzeitig verlangt die von 2007 bis 2015 aktive A2DP v1.2-Spezifikation, dass alle Decodierungsger√§te mit Bitraten von bis zu 320 kbit / s f√ºr Mono und 512 kbit / s bei einem Stereosignal korrekt arbeiten. <br><br>  In der neuen Version der Spezifikation gibt es √ºberhaupt keine Bitratenbegrenzung.  Es wird davon ausgegangen, dass moderne Kopfh√∂rer, die nach 2015 ver√∂ffentlicht wurden und EDR unterst√ºtzen, Bitraten von bis zu 730 kbps unterst√ºtzen k√∂nnen. <br><br>  In der Tat ist dies sicherlich nicht der Fall.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">In einer umfangreichen Studie</a> von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ValdikSS</a> wurde festgestellt, dass fast alle Empfangsger√§te zuverl√§ssig mit Bitraten von 454 kbit / s und eine relativ gro√üe Anzahl mit Bitraten von 507 kbit / s arbeiten. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">In seiner Forschung hat</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ValdikSS</a> auch gezeigt, dass es entgegen der weit verbreiteten Meinung √ºber die Klangqualit√§t des aptX-Codecs bei einigen Dateien zu schlechteren Ergebnissen f√ºhren kann als bei SBC mit einer Standardbitrate von 328 kbps, und beim Umschalten auf SBC mit hoher Bitrate wird h√§ufig ein Ton erzeugt, der h√§ufig √ºbersteigt aptX, auf jedem Kopfh√∂rer. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Basierend</a> auf diesen Daten hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ValdikSS</a> Kommentare an die Entwickler von Lineage OS und Google gesendet, aber bisher gab es keine Reaktion. <br><br>  Daher k√∂nnen wir den Bluetooth-Stack nur manuell √§ndern. <br><br>  Wir ben√∂tigen einen IDA Pro mit der F√§higkeit, ARM, jeden HEX-Editor (ich habe WinHEX verwendet) und die Datei bluetooth.default.so von unserem Ger√§t zu dekompilieren.  Normalerweise befindet es sich im Pfad / system / lib / hw und seltener - auch im Pfad / system / lib64 / hw (Root-Zugriff ist definitiv erforderlich). <br><br>  √ñffnen Sie daher die Datei bluetooth.default.so. Die unten beschriebenen Vorg√§nge und √Ñnderungen gelten nur f√ºr den urspr√ºnglichen Android-Stack (bluedroid).  Wenn in IDA Pro die Zeile "Ben√∂tigte Bibliothek 'com.qualcomm.qti.bluetooth_audio@1.0.so'" oder √§hnliches angezeigt wird, hilft Ihnen diese Anweisung mit hoher Wahrscheinlichkeit nicht weiter. <br><br><img src="https://habrastorage.org/webt/cf/3l/jb/cf3ljbjgckew4pd9tbutsy-tyaw.png"><br><br>  Unsere erste Aufgabe ist es, Joint Stereo in einer Standardkonfiguration durch Dual Channel zu ersetzen. <br><br>  Wir werden mit der <a href="">Funktion bta_av_build_src_cfg arbeiten</a> . <br><br>  Um dieses Verfahren in der IDA zu finden, verwenden wir die Zeilensuche <a href="">nach einer charakteristischen Nachricht im Debug-Protokoll "Cant parse src cap ret =% d"</a> : <br><br><img src="https://habrastorage.org/webt/wh/dk/ex/whdkexvibrxijvj7pqb-buzb0z8.png"><br><br><img src="https://habrastorage.org/webt/ea/2h/nh/ea2hnhbszbtyieokldywuch2qvi.png"><br><br>  Infolgedessen finden wir die Funktion selbst ziemlich schnell in Form von Code: <br><br><img src="https://habrastorage.org/webt/mf/5_/_9/mf5__9yydhgwip0lvemgqwcwocw.png"><br><br>  Unsere Aufgabe ist es, die urspr√ºngliche Struktur der Schecks zu ersetzen <br><br><pre><code class="plaintext hljs">if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_JOINT) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_JOINT; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;&lt;/code&gt;  &lt;code&gt; if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;</code> </pre> <br>  Es gibt verschiedene M√∂glichkeiten, dies zu tun. <br><br>  Das erste ist das Ersetzen der Anweisungen TST.W R0, # 1 durch TST.W R0, # 4 und MOVS R0, # 1 durch MOVS R0, # 4 in der Reihenfolge der √úberpr√ºfungen: <br><br><img src="https://habrastorage.org/webt/6e/zu/so/6ezusojttx0gavinlppmqeroet8.png"><br><br>  Im Bytecode ist dies der Ersatz von x01 bis x04.  Es ist wichtig, die charakteristische Folge von Bytes zu beachten, anhand derer dieses Muster gefunden werden kann.  Ohne auf Details einzugehen, m√∂chte ich sagen, dass es sich im Wesentlichen um eine Suche nach Sequenzen handelt <br><br><pre> <code class="plaintext hljs">10 20 8D F8 04 00 9D F8 0D 00 10 F0 01 0F ?? ?? 10 F0 02 0F ?? ?? 10 F0 04 0F ?? ?? 10 F0 08 0F ?? ?? 08 20 ?? ?? 01 20 ?? ?? 02 20 ?? ?? 04 20</code> </pre> <br>  und sein Ersatz durch <br><br><pre> <code class="plaintext hljs">?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ??</code> </pre> <br>  Dieses Verfahren hat jedoch Nachteile. <br><br>  Eine Reihe von Compilern √§ndert die Reihenfolge der Ausf√ºhrung von Befehlen abh√§ngig von der Optimierung.  In diesem Fall ist es nicht m√∂glich, das gew√ºnschte Muster zu finden, und manchmal wird der Pr√ºfmechanismus in der Struktur im Allgemeinen in den Inline-Code eingef√ºhrt.  Daher ist es zuverl√§ssiger, die Konstante <a href="">btif_av_sbc_default_config</a> zu √§ndern. <br><br>  F√ºr den Anfang - finden Sie sie.  Sie steht ganz am Anfang unserer Funktion, weil <br><br><pre> <code class="plaintext hljs">void bta_av_build_src_cfg (UINT8 *p_pref_cfg, UINT8 *p_src_cap) { tA2D_SBC_CIE src_cap; tA2D_SBC_CIE pref_cap; UINT8 status = 0; /* initialize it to default SBC configuration */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;btif_av_sbc_default_config, p_pref_cfg); /* now try to build a preferred one */ /* parse configuration */ if ((status = A2D_ParsSbcInfo(&amp;src_cap, p_src_cap, TRUE)) != 0) { APPL_TRACE_DEBUG(" Cant parse src cap ret = %d", status);</code> </pre> <br>  Und hier ist sie: <br><br><img src="https://habrastorage.org/webt/xi/j2/dt/xij2dtvma0evlnggxkxzqxkvdn4.png"><br><br><img src="https://habrastorage.org/webt/7a/z9/36/7az936re6naesontslfi1ogkd5c.png"><br><br>  Es ist ersichtlich, dass btif_av_sbc_default_config selbst eine Folge von Bytes 20 01 10 04 01 35 02 ist, w√§hrend das erste Byte die Abtastfrequenz codiert und 10 (48 kHz) und 20 (44 kHz) sein kann und daher nicht spezifisch ist.  Daher ist es unsere Aufgabe, die Sequenz zu ersetzen <br> <code>01 10 04 01 35 02</code> <br>  auf <br> <code>04 ?? ?? ?? ?? ??</code> <br> <br>  Auf diese Weise k√∂nnen Sie die Logik der Struktur auf √§hnliche Weise √§ndern. Gleichzeitig f√ºhrt die Optimierung des Compilers jedoch nicht zu Problemen. <br><br>  In einigen F√§llen stellen die Kopfh√∂rer oder Lautsprecher selbst die Verbindung her.  In diesem Fall wird der Modus durch die Funktion <a href="">bta_av_co_audio_init bestimmt</a> . <br><br>  Die Funktion ist <a href="">durch die Zeile ‚Äûbta_av_co_audio_init:% d‚Äú gekennzeichnet</a> und kann im Code leicht gesucht werden: <br><img src="https://habrastorage.org/webt/fi/5o/ku/fi5okug9tbn6gvleetxo93uk9qg.png"><br><br>  Die Aufz√§hlung m√∂glicher Verbindungsmodi erfolgt mit folgendem Befehl: <br><br><pre> <code class="plaintext hljs"> switch (index) { case BTIF_SV_AV_AA_SBC_INDEX: /* Set up for SBC codec for SRC*/ *p_codec_type = BTA_AV_CODEC_SBC; /* This should not fail because we are using constants for parameters */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;bta_av_co_sbc_caps, p_codec_info); /* Codec is valid */ return TRUE;</code> </pre> <br>  Die <a href="">Konstante bta_av_co_sbc_caps hat folgende Struktur</a> : <br><br><pre> <code class="plaintext hljs">const tA2D_SBC_CIE bta_av_co_sbc_caps = { (A2D_SBC_IE_SAMP_FREQ_44), /* samp_freq */ (A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL), /* ch_mode */ (A2D_SBC_IE_BLOCKS_16 | A2D_SBC_IE_BLOCKS_12 | A2D_SBC_IE_BLOCKS_8 | A2D_SBC_IE_BLOCKS_4), /* block_len */ (A2D_SBC_IE_SUBBAND_4 | A2D_SBC_IE_SUBBAND_8), /* num_subbands */ (A2D_SBC_IE_ALLOC_MD_L | A2D_SBC_IE_ALLOC_MD_S), /* alloc_mthd */ BTA_AV_CO_SBC_MAX_BITPOOL, /* max_bitpool */ A2D_SBC_IE_MIN_BITPOOL /* min_bitpool */ };</code> </pre> <br>  Die Konstante ist im Code leicht zu finden, in meinem Fall 20 0F F0 0C 03 35 02: <br><br><img src="https://habrastorage.org/webt/kj/hw/oi/kjhwoibpuk8brwa3kzvxiuxgeba.png"><br><br>  <b>Achten</b> Sie auf Byte <b>0F</b> - es bietet die M√∂glichkeit, eine Verbindung mit einem der g√ºltigen Modi <b>herzustellen</b> , da <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL = x08 | x02 | x01 | x04</code> </pre> <br>  Unsere Aufgabe ist es, diesen Wert wie folgt zu √§ndern: <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_DUAL = x04</code> </pre> <br>  Daher ist es notwendig zu ersetzen <br><br> <code>?? 0F F0 0C 03 35 02</code> <br>  auf <br> <code>?? 04 ?? ?? ?? ?? ??</code> <br> <br>  Daher haben wir den Stack gezwungen, im Zweikanalmodus eine Verbindung herzustellen, sowohl beim Herstellen einer Verbindung durch das Ger√§t als auch beim Herstellen einer Verbindung durch die Empfangsseite des Signals. <br><br>  Jetzt m√ºssen Sie die Einschr√§nkungen der Bitrate aufheben oder den oberen Schwellenwert erh√∂hen. <br><br>  <a href="">M√ºssen btif_media_task_get_sbc_rate behandeln</a> .  <a href="">Um</a> nach der <a href="">Kennlinie "Nicht-EDR-A2dP-Senke erkannt, Rate auf% d beschr√§nken" zu</a> suchen <a href="">,</a> suchen <a href="">wir in</a> √§hnlicher Weise nach der Funktion im Code: <br><img src="https://habrastorage.org/webt/kp/go/j2/kpgoj2xsq6vt8kbnexy81jy6j6s.png"><br><br>  Das Bitratenlimit wird in einer Zeichenfolge ausgedr√ºckt <br>  UINT16 rate = DEFAULT_SBC_BITRATE (was wiederum <a href="">328 kbps betr√§gt</a> ) <br><br>  Im Code ist dies: <br><br><img src="https://habrastorage.org/webt/tf/ba/bn/tfbabnrxfks3pejhzqzdegiwn04.png"><br><br>  √Ñndern Sie diesen Wert auf 454 kbit / s - er ist h√∂her als der Standard und funktioniert mit der √ºberwiegenden Mehrheit der Empf√§nger.  Ersetzen Sie dazu die Bytes <br><br> <code>B1 4F F4 A4 74 ?? E0</code> <br>  auf <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br> <br>  Sie sollten auch nach Muster suchen. <br><br> <code>E0 4F F4 A4 74 ?? E0</code> <br>  und ersetzen Sie es durch <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br>  - Dies ist f√ºr eine Reihe von Ger√§ten erforderlich. <br><br>  Der Wert von E3 kann abh√§ngig von der gew√ºnschten maximalen Bitrate unterschiedlich sein: <br><br><ul><li>  E3 - 454 kbps </li><li>  F1 - 482 kbps </li><li>  F3 - 486 kbps </li><li>  10 - 576 kbps </li><li>  48 - keine Begrenzung </li></ul><br>  Im Allgemeinen wird dies durch den Bytecode der Operation MOV.W R4, XXX bestimmt. <br><br>  In der Praxis lohnt es sich zu experimentieren und den Maximalwert zu w√§hlen, bei dem alle Ihre Empfangsger√§te einen stabilen Signalempfang erhalten. Es treten keine Risse, Unterbrechungen oder Verzerrungen auf. <br><br>  Bei allen Empf√§ngern in meinem Experiment (ich habe sie oben angegeben) betrug dieser Wert 576 kbit / s. Das Xiaomi Redmi 4x MIUI10 Android 7.1-Telefon war die Signalquelle. <br><br>  Basierend auf den beschriebenen Aktionen wurde ein generischer Patch erstellt, der die angegebenen Muster in Bluetooth.default.so findet und ersetzt.  einschlie√ülich erzwungenem Zweikanalmodus und Festlegen der Bitratengrenze auf 454 kbps.  Bei Bedarf kann der Grenzwert leicht durch Suchen und Ersetzen des entsprechenden Bytes ge√§ndert werden - ein aufmerksamer Leser wird dies ohne Schwierigkeiten tun. <br><br>  Ich betone: Der Patch funktioniert nur im Fall des Bluedroid-Stacks und wird h√∂chstwahrscheinlich im Fall des Fluoride-Stacks und der Android-Version 8 und h√∂her nicht erfolgreich sein. <br><br>  Der Patch kann hier heruntergeladen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden</a> . <br><br>  Es wird dringend empfohlen, die Originaldatei als Magisk-Module zu ersetzen. F√ºr mich selbst habe ich dies <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wie folgt</a> getan.  <b>Bitte beachten Sie</b> : Diese Module wurden von mir f√ºr das Xiaomi Redmi 4x 3/32 GB-Telefon mit der aktuellen globalen stabilen MIUI 10-Firmware zum Zeitpunkt des Schreibens erstellt. In Ihrem Fall muss die Datei bluetooth.default.so wie oben beschrieben durch Ihre eigene, gepatchte ersetzt werden.  Es ist auch m√∂glich, dass die Datei entlang des Pfads / system / lib64 / hw dupliziert werden muss - dies h√§ngt vom Modell und der Firmware-Version Ihres Telefons ab. <br><br>  Dieser Ansatz mit Magisk-Modulen erleichtert das √Ñndern der maximalen Bitrate und das generelle Deaktivieren von √Ñnderungen, wenn sich herausstellt, dass einige der empfangenden Ger√§te Dual Channel nicht unterst√ºtzen. <br><br><h2>  Fazit </h2><br>  Im Moment streben viele Unternehmen im Hinblick auf den Verkauf einige technologische Innovationen an, um einen h√∂heren Preis zu rechtfertigen. <br><br>  In der Praxis stellt sich heraus, dass vorhandene, billigere Technologien nicht vollst√§ndig entwickelt und technologische Innovationen nicht vollst√§ndig implementiert sind, was die Qualit√§t erheblich beeintr√§chtigt. <br><br>  Sehr oft erleben Benutzer den ‚ÄûPlacebo-Effekt‚Äú, der sich nur deshalb von der Perfektion eines Produkts √ºberzeugt, weil es neuer oder farbenfroher pr√§sentiert wird.  In der Tat ist diese Qualit√§t imagin√§r. <br><br>  Trotz der offensichtlichen Verschlechterung der Qualit√§t der drahtlosen Audio√ºbertragung im Vergleich zur kabelgebundenen Version scheinen die modernen Ger√§tehersteller auf einen vollst√§ndigen √úbergang zu drahtlosen Technologien ausgerichtet zu sein.  Gleichzeitig werden Marketingtricks verwendet, um die Preiserh√∂hung zu rechtfertigen: Schutz vor dem Eintauchen des Telefons in Wasser (wie k√∂nnen Sie unter Wasser sprechen? Warum das Ger√§t ins Wasser fallen lassen?), Verwendung teurerer Codecs usw.  Gleichzeitig wird das Potenzial des vorhandenen beliebten SBC-Codecs nicht voll ausgesch√∂pft. <br><br>  Wir konnten weder eine Kl√§rung des Bitratenlimits von 328 kbit / s von Google erhalten noch dieses Limit aufheben und die Option zum Aktivieren von Dual Channel im Bluetooth-Men√º von den Entwicklern von Lineage OS hinzuf√ºgen. <br><br>  Vielen Dank an alle, die bis zum Ende gelesen haben! <br><br>  Einige Fortsetzungen, die durch die Diskussion in den Kommentaren und einen Platz in Bezug auf den LDAC-Codec verursacht wurden, sind <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br><img src="https://habrastorage.org/webt/ob/mr/cc/obmrccmcn21gzh8g1ca3g3ykfs4.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de433502/">https://habr.com/ru/post/de433502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de433490/index.html">Creality CR-X 3D-Drucker√ºberpr√ºfung</a></li>
<li><a href="../de433494/index.html">10 englische Redewendungen, die Sie nie kennen werden</a></li>
<li><a href="../de433496/index.html">Staatliche Unternehmen verpflichten sich, bis 2022 auf inl√§ndische Software umzusteigen</a></li>
<li><a href="../de433498/index.html">Sberbank - Sie haben ein "Paket" f√ºr mich, aber ich werde es nicht nehmen ...</a></li>
<li><a href="../de433500/index.html">Der Berkeley-Kurierroboter ist aufgrund des fehlenden Status des √úberwachungssystems ausgebrannt</a></li>
<li><a href="../de433504/index.html">So beenden Sie das Schreiben von Firmware f√ºr Mikrocontroller und beginnen zu leben</a></li>
<li><a href="../de433506/index.html">Die EU strebt das Recht an, gro√üe Haushaltsger√§te zu reparieren</a></li>
<li><a href="../de433508/index.html">Der Eigent√ºmer der MIPS-Architektur beabsichtigt, seinen Befehlssatz (ISA) im Jahr 2019 zu √∂ffnen</a></li>
<li><a href="../de433510/index.html">Interkultureller Unterschied in Spielen</a></li>
<li><a href="../de433512/index.html">Theorie des Gl√ºcks. Schwindelerregender Flug eines Sandwichs mit Butter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>