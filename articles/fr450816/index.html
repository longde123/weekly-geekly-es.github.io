<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐈 💐 👩‍👧‍👦 En-têtes HTTP pour le développeur responsable 👨🏿 👨🏻‍🚒 👨🏻‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, être en ligne est une condition courante pour de nombreuses personnes. Nous achetons, communiquons, lisons des articles, recherchons des ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>En-têtes HTTP pour le développeur responsable</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/450816/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/9l/a1/ll/9la1llcyspwwfylwvmocsfvgnfe.jpeg"></div><br>  Aujourd'hui, être en ligne est une condition courante pour de nombreuses personnes.  Nous achetons, communiquons, lisons des articles, recherchons des informations sur divers sujets.  Le réseau nous connecte au monde entier, mais surtout, il connecte les gens.  J'utilise moi-même Internet depuis 20 ans et ma relation avec lui a changé il y a huit ans lorsque je suis devenu développeur Web. <br><br>  Les développeurs connectent les gens. <br>  Les développeurs aident les gens. <br>  Les développeurs donnent aux gens des opportunités. <br><br>  Les développeurs peuvent créer un réseau pour tout le monde, mais cette capacité doit être utilisée de manière responsable.  En fin de compte, il est important de créer des choses qui aident les gens et les responsabilisent.  Dans cet article, je veux parler de la façon dont les en-têtes HTTP peuvent vous aider à créer de meilleurs produits pour le meilleur travail de tous les utilisateurs sur Internet. <br><a name="habracut"></a><br><h2>  HTTP - Protocole de transfert hypertexte </h2><br>  Parlons d'abord de HTTP.  HTTP est un protocole utilisé par les ordinateurs pour demander et envoyer des données sur Internet. <br><br>  Lorsque le navigateur demande une ressource au serveur, il utilise HTTP.  Cette demande comprend un ensemble de paires clé-valeur contenant des informations telles que la version du navigateur ou les formats de fichier qu'elle comprend.  Ces paires sont appelées en-têtes de demande. <br><br>  Le serveur répond avec la ressource demandée, mais envoie également des en-têtes de réponse contenant des informations sur la ressource ou le serveur lui-même. <br><br><pre><code class="plaintext hljs">Request: GET https://the-responsible.dev/ Accept: text/html,application/xhtml+xml,application/xml Accept-Encoding: gzip, deflate, br Accept-Language: en-GB,en-US;q=0.9,en;q=0.8,de;q=0.7 ... Response: Connection: keep-alive Content-Type: text/html; charset=utf-8 Date: Mon, 11 Mar 2019 12:59:38 GMT ... Response Body</code> </pre> <br>  Aujourd'hui, HTTP est le fondement d'Internet et offre de nombreuses façons d'optimiser l'expérience utilisateur.  Voyons comment utiliser les en-têtes HTTP pour créer un réseau sécurisé et accessible. <br><br><h2>  Le réseau doit être sécurisé </h2><br>  Je ne me sentais jamais en danger lorsque je cherchais quelque chose sur Internet.  Mais plus j'en apprenais sur le World Wide Web, plus j'étais inquiet.  Vous pouvez lire comment les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pirates modifient les bibliothèques CDN mondiales</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des sites aléatoires exploitent des cryptomonnaies dans le navigateur de leurs visiteurs,</a> ainsi que comment, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">grâce à l'ingénierie sociale, les gens ont régulièrement accès à des projets open source réussis</a> .  Ce n'est pas bon.  Mais pourquoi devriez-vous vous en soucier? <br><br>  Si vous développez pour le Web aujourd'hui, n'écrivez pas seulement du code.  Aujourd'hui, dans le développement web, beaucoup de gens travaillent sur un seul site.  Vous pouvez également utiliser beaucoup d'open source.  De plus, à des fins de marketing, vous pouvez inclure plusieurs scripts tiers.  Des centaines de personnes fournissent du code exécuté sur votre site.  Et les développeurs doivent travailler dans de telles réalités. <br><br>  Peut-on faire confiance à toutes ces personnes et à tout le code source? <br><br>  Je ne pense pas qu'il faille faire confiance à un code tiers.  Heureusement, il existe des moyens de protéger votre site et de le rendre plus sécurisé.  De plus, des outils tels que le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">casque peuvent être utiles, par exemple, pour des applications express</a> . <br><br>  <i>Si vous souhaitez analyser la quantité de code tiers exécuté sur votre site, vous pouvez regarder dans le panneau des développeurs ou essayer de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">demander le générateur de carte.</a></i> <br><br><h2>  HTTPS et HSTS - assurez-vous que votre connexion est sécurisée </h2><br>  Une connexion sécurisée est le fondement d'un Internet sécurisé.  Sans demandes cryptées <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://developers.google.com/web/fundamentals/security/encrypt-in-transit/why-">passant par</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://developers.google.com/web/fundamentals/security/encrypt-in-transit/why-">HTTPS</a> , vous ne pouvez pas être sûr qu'il n'y a personne d'autre entre votre site et les visiteurs.  Une personne peut rapidement mettre en place un réseau Wi-Fi public et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lancer une attaque d'homme au milieu contre</a> quiconque se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">connecte à ce réseau</a> .  À quelle fréquence utilisez-vous le Wi-Fi public?  De plus, à quelle fréquence vérifiez-vous si elle est fiable? <br><br>  Heureusement, aujourd'hui, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les certificats TLS sont gratuits</a> ;  HTTPS est devenu la norme, et les navigateurs fournissent des fonctionnalités avancées uniquement pour les connexions sécurisées, et même marquent les sites Web non HTTPS comme dangereux, ce qui facilite la mise en œuvre de ce protocole.  Malheureusement, nous ne sommes pas toujours en sécurité lorsque nous sommes sur Internet.  Quand quelqu'un veut ouvrir un site, il n'entre pas le protocole dans la barre d'adresse (et pourquoi le devrait-il?).  Il en résulte une requête HTTP non chiffrée.  Les sites en cours d'exécution redirigent l'utilisateur vers HTTPS.  Mais que se passe-t-il si quelqu'un intercepte la première demande non sécurisée? <br><br>  Vous pouvez utiliser les en-têtes de réponse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HSTS</a> (HTTP Strict Transport Security) pour indiquer aux navigateurs que votre site ne fonctionne que via HTTPS. <br><br><pre> <code class="plaintext hljs">Strict-Transport-Security: max-age=1000; includeSubDomains; preload</code> </pre> <br>  Cet en-tête indique au navigateur que vous ne souhaitez pas utiliser les requêtes HTTP, puis il appliquera automatiquement les mêmes requêtes à la même source avec une connexion sécurisée.  Si vous essayez d'ouvrir la même URL via HTTP, le navigateur utilisera à nouveau HTTPS et redirigera l'utilisateur. <br><br>  Vous pouvez configurer la durée pendant laquelle cette option doit rester active ( <code>max-age</code> en secondes) si vous souhaitez réutiliser HTTP plus tard.  Si vous souhaitez activer les sous-domaines, vous pouvez le configurer à l'aide de <code>includeSubDomains</code> . <br><br>  Si vous souhaitez faire tout votre possible pour que le navigateur ne demande jamais votre site via HTTP, vous pouvez également définir le pointeur de <code>preload</code> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">envoyer votre site</a> à la liste globale.  Si la configuration HSTS de votre site correspond à l' <code>max-age</code> minimum minimum d'un an et est active pour les sous-domaines, elle peut être incluse dans la liste de navigation interne pour les sites qui fonctionnent uniquement via HTTPS. <br><br>  Vous êtes-vous déjà demandé pourquoi vous ne pouvez plus utiliser de variables d'environnement locales telles que <code>my-site.dev</code> dans votre navigateur via HTTP?  La raison en est précisément dans cette liste interne - <code>.dev</code> automatiquement inclus dans cette liste, car en février 2019, il est devenu un véritable domaine de premier niveau. <br><br>  L'en-tête HSTS rend non seulement votre site un peu plus sûr, mais accélère également son travail.  Imaginez que quelqu'un accède à une connexion mobile lente.  Si la première demande a été effectuée via HTTP uniquement pour recevoir une redirection, l'utilisateur ne peut rien voir à l'écran pendant plusieurs secondes.  Et avec HSTS, vous pouvez enregistrer ces secondes, et le navigateur utilisera automatiquement HTTPS. <br><br><h2>  CSP - indiquez clairement ce qui est autorisé sur votre site </h2><br>  Maintenant que votre site fonctionne via une connexion sécurisée, vous pouvez rencontrer un problème lorsque les navigateurs commencent à bloquer les demandes qui atteignent une adresse non sécurisée en raison de politiques de contenu mixtes.  L'en-tête <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CSP (Content Security Policy)</a> offre un excellent moyen de gérer ces situations.  Vous pouvez définir votre ensemble de règles CSP à l'aide de méta-éléments dans le code HTML fourni ou via les en-têtes HTTP. <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: upgrade-insecure-requests</code> </pre> <br>  Le pointeur de <code>upgrade-insecure-requests</code> oblige le navigateur à convertir comme par magie toutes les requêtes HTTP en requêtes HTTPS. <br><br>  Cependant, CSP n'est pas limité au protocole utilisé.  Il offre des moyens détaillés de déterminer quelles ressources et activités sont autorisées sur votre site.  Vous pouvez, par exemple, spécifier les scripts à exécuter ou où télécharger les images.  Si quelque chose n'est pas autorisé, le navigateur bloque cette action et empêche les attaques potentielles sur votre site. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e57/f6a/ef6/e57f6aef63f9ad95c2954539290a7caa.jpg"><br><br>  Au moment d'écrire ces lignes, il y avait 24 options de configuration différentes pour CSP.  Ils vont des scripts aux feuilles de style en passant par les techniciens de maintenance. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/281/7f5/713/2817f571357c4b488bd6dbcbbdec6ef0.png"><br><br>  <i>Vous pouvez trouver la critique complète sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MDN.</a></i> <br><br>  À l'aide de CSP, vous pouvez spécifier ce que votre site doit inclure et ce qui ne doit pas. <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: default-src 'self'; script-src 'self' just-comments.com www.google-analytics.com production-assets.codepen.io storage.googleapis.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: images.contentful.com images.ctfassets.net www.gravatar.com www.google-analytics.com just-comments.com; font-src 'self' data:; connect-src 'self' cdn.contentful.com images.contentful.com videos.contentful.com images.ctfassets.net videos.ctfassets.net service.just-comments.com www.google-analytics.com; media-src 'self' videos.contentful.com videos.ctfassets.net; object-src 'self'; frame-src codepen.io; frame-ancestors 'self'; worker-src 'self'; block-all-mixed-content; manifest-src 'self' 'self'; disown-opener; prefetch-src 'self'</code> </pre> <br>  L'ensemble de règles ci-dessus est pour mon site personnel, et si vous pensez que cet exemple de définition CSP est très compliqué, alors vous avez absolument raison.  J'ai implémenté ce kit lors de ma troisième tentative, déployant et annulant à nouveau, car il a cassé le site plusieurs fois.  Mais il y a une meilleure façon. <br><br>  Pour éviter de pirater votre site, CSP propose également un mode de génération de rapports uniquement. <br><br><pre> <code class="plaintext hljs">Content-Security-Policy-Report-Only: default-src 'self'; ... report-uri https://stefanjudis.report-uri.com/r/d/csp/reportOnly</code> </pre> <br>  En utilisant le mode <code>Content-Security-Policy-Report-Only</code> , les navigateurs enregistrent simplement les ressources qui seraient bloquées, au lieu de les bloquer.  Ce mécanisme de rapport vous permet de vérifier et de configurer votre ensemble de règles. <br><br>  Les deux en-têtes, <code>Content-Security-Policy</code> et <code>Content-Security-Policy-Report-Only</code> , offrent également un moyen de déterminer le point de terminaison pour envoyer un <code>report-uri</code> violation et des informations de journalisation ( <code>report-uri</code> ).  Vous pouvez configurer le serveur de journaux et utiliser les informations de journal envoyées pour configurer les règles CSP jusqu'à ce qu'il soit prêt à être envoyé. <br><br>  Le processus recommandé est le suivant: exécutez d'abord CSP en mode rapport, analysez les violations entrantes avec du trafic réel, et uniquement lorsqu'aucune violation de vos ressources contrôlées n'est détectée, activez-la. <br><br>  <i>Si vous cherchez un service qui pourrait vous aider à traiter avec ces magazines, je recommande l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">URI de rapport</a> , cela m'aide beaucoup.</i> <br><br><h2>  Implémentation générale du CSP </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Aujourd'hui, les navigateurs prennent bien en charge le</a> CSP, mais malheureusement, peu de sites l'utilisent.  Pour voir combien de sites fournissent du contenu à l'aide de CSP, j'ai envoyé une demande à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://">HTTParchive</a> et constaté que seulement 6% des sites consultés utilisent cette politique.  Je pense que nous pouvons rendre Internet plus sûr et protéger nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilisateurs</a> contre l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">extraction</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">involontaire de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">crypto-monnaies</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d4/e19/246/6d4e192464d326a3722530d617cbaf78.jpg"><br><br><h2>  Le réseau doit être accessible. </h2><br>  Pendant que j'écris cet article, je suis assis devant le relativement nouveau MacBook en utilisant une connexion Wi-Fi domestique rapide.  Les développeurs oublient souvent que cette situation n'est pas standard pour la plupart de nos utilisateurs.  Les personnes visitant nos sites utilisent de vieux téléphones et des connexions douteuses.  Les sites lourds et encombrés avec des centaines de requêtes leur laissent une mauvaise impression. <br><br>  Et ce n'est pas seulement une question d'impression.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les gens paient des montants différents pour le trafic en fonction de leur lieu de résidence</a> .  Imaginez que vous créez un site Web pour un hôpital.  Les informations à ce sujet peuvent être cruciales et sauver des vies.  Si la page du site Web de l'hôpital a une taille de 5 Mo, elle fonctionnera non seulement lentement, mais peut être trop chère pour ceux qui en ont le plus besoin.  Le prix de cinq mégaoctets de trafic en Europe ou aux États-Unis est négligeable par rapport au prix en Afrique.  Les développeurs sont responsables de rendre les pages Web accessibles à tous.  Cette responsabilité consiste à fournir les bonnes ressources, à choisir les bons outils (avez-vous vraiment besoin d'un framework JS pour atterrir?) Et à éviter les demandes. <br><br><h2>  Cache-Control - Évitez les demandes de ressources immuables </h2><br>  Aujourd'hui, un site peut contenir des centaines de ressources, du CSS aux scripts et aux images.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>  Cache-Control</code></a> , les développeurs peuvent spécifier la durée pendant laquelle la ressource doit être considérée comme «fraîche» et peut être renvoyée depuis le cache du navigateur. <br><br><pre> <code class="plaintext hljs">Cache-Control: max-age=30, public</code> </pre> <br>  Avec une configuration correcte de <code>Cache-Control</code> , le transfert de données est préservé et les fichiers peuvent être utilisés à partir du cache du navigateur pendant un certain nombre de secondes ( <code>max-age</code> ).  Les navigateurs doivent revérifier les ressources mises en cache après cette période. <br><br>  Cependant, si les visiteurs actualisent la page, les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">navigateurs la revérifieront quand même, y compris les liens vers les ressources</a> pour s'assurer que les données mises en cache sont toujours valides.  Les serveurs répondent avec un en-tête 304, signalant que les données mises en cache sont toujours valides, ou un en-tête 200 lors de la transmission de données mises à jour.  Cela vous permet d'enregistrer les données transférées, mais pas nécessairement les demandes faites. <br><br>  C'est là que la fonction <code>immutable</code> entre en jeu. <br><br><h2>  Immuable - ne demandez jamais une ressource deux fois </h2><br>  Dans les applications frontales modernes, les fichiers CSS et script ont généralement des noms uniques, par exemple <code>styles.123abc.css</code> .  Le nom de ce fichier dépend du contenu.  Et lorsque vous modifiez le contenu des fichiers, leurs noms changent également. <br><br>  Ces fichiers uniques pourraient potentiellement être mis en cache pour toujours, y compris lorsqu'un utilisateur actualise une page.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code> immutable</code></a> peut empêcher le navigateur de revérifier la ressource à un intervalle de temps spécifique.  Ceci est très important pour les objets avec des sommes de contrôle et permet d'éviter les demandes de validation répétées. <br><br><pre> <code class="plaintext hljs">Cache-Control: max-age=31536000, public, immutable</code> </pre> <br>  L'implémentation d'une mise en cache optimale est très difficile, et en particulier la mise en cache du navigateur n'est pas très intuitive, car elle a différentes configurations.  Je vous recommande de lire les documents suivants: <br><br><ul><li>  Harry Roberts a écrit un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">excellent guide pour gérer votre cache et ses paramètres</a> . <br></li><li>  Jack Archibald a donné des conseils sur les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">meilleures techniques de mise en cache</a> avec des illustrations. <br></li><li>  Ilya Grigorik a proposé un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/">excellent schéma technologique pour la mise en cache des en-têtes</a> . <br></li></ul><br><h2>  Accept-Encoding - compression maximale (au minimum) </h2><br>  Avec l'aide du <code>Cache control</code> du <code>Cache control</code> nous pouvons enregistrer les demandes et réduire la quantité de données transmises à plusieurs reprises sur le réseau.  Nous pouvons non seulement enregistrer les demandes, mais également réduire ce qui est transmis. <br><br>  Donnant des ressources, les développeurs doivent veiller à envoyer le moins de données possible.  Pour les ressources de texte telles que HTML, CSS et JavaScript, la compression joue un rôle important dans la sauvegarde des données transférées. <br><br>  La méthode de compression la plus populaire aujourd'hui est GZIP.  Les serveurs ont suffisamment de puissance pour compresser des fichiers texte à la volée et fournir des données compressées sur demande.  Mais GZIP n'est plus la meilleure option. <br><br>  Si vous examinez les demandes de fichiers texte générées par le navigateur, telles que HTML, CSS et JavaScript, et analysez les en-têtes, vous trouverez parmi eux un <code>accept-encoding</code> . <br><br><pre> <code class="plaintext hljs">Accept-Encoding: gzip, deflate, br</code> </pre> <br>  Cet en-tête indique au serveur les algorithmes de compression qu'il comprend.  Le paramètre <code>br</code> peu connu, signifie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">compression Brotli</a> et est utilisé sur les sites à fort trafic tels que Google et Facebook.  Pour utiliser Brotli, votre site doit fonctionner via HTTPS. <br><br>  Cet algorithme de compression a été créé en tenant compte de la petite taille du fichier.  Si vous essayez de compresser le fichier manuellement sur votre appareil local, vous constaterez que Brotli se comprime vraiment mieux que GZIP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d5/681/a2b/6d5681a2b412489aae991170e16428e8.jpg"><br><br>  Vous avez peut-être entendu que la compression Brotli est plus lente.  La raison en est que Brotli a 11 modes de compression, et par défaut celui qui sélectionne les plus petits fichiers est obtenu, ce qui allonge la procédure.  GZIP, d'autre part, dispose de 9 modes, et par défaut, un est sélectionné qui prend en compte à la fois la vitesse de compression et la taille du fichier.  Par conséquent, le mode Brotli n'est pas adapté à la compression à la volée par défaut, mais si vous changez le mode, vous pouvez compresser de petits fichiers à la même vitesse que GZIP.  Vous pouvez l'utiliser à la volée pour la compression et le considérer comme un remplacement potentiel de GZIP pour les navigateurs pris en charge. <br><br>  De plus, si vous souhaitez enregistrer des fichiers autant que possible, vous pouvez oublier la compression dynamique et pré-générer des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fichiers GZIP optimisés en utilisant les fichiers zopfli</a> et Brotli pour leur maintenance statique. <br><br>  <i>Si vous souhaitez en savoir plus sur la compression Brotli et sa comparaison avec GZIP, les employés d'Akamai ont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">effectué des recherches approfondies sur ce sujet</a></i> . <br><br><h2>  Accepter et accepter-CH - Servir des ressources individuelles pour l'utilisateur </h2><br>  L'optimisation des ressources de texte est très importante pour économiser des kilo-octets, mais qu'en est-il des ressources plus lourdes telles que les images pour enregistrer encore plus de données? <br><br><h4>  Accepter - maintenance des images au format correct </h4><br>  Les navigateurs nous montrent non seulement quels algorithmes de compression ils comprennent.  Lorsque le navigateur demande une image, il fournit également des informations sur les formats de fichier qu'il comprend. <br><br><pre> <code class="plaintext hljs">Accept: image/webp, image/apng, image/*,*/*;q=0.8</code> </pre> <br>  Pendant plusieurs années, une lutte a été menée autour d'un nouveau format d'image, mais a remporté le webp.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Webp est un format d'image inventé par Google</a> , et la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prise en charge de</a> ce format est désormais très pertinente. <br><br>  En utilisant cet en-tête de demande, les développeurs peuvent envoyer une image <code>webp</code> même si le navigateur a demandé <code>image.jpg</code> , ce qui entraîne une taille de fichier plus petite.  Dean Hume a écrit un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bon guide</a> sur la façon de l'appliquer.  Très cool! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ef/ce2/077/9efce2077a81469bfaa8840b8bb07b26.jpg"><br><br><h4>  Accept-CH - Servir des images de la bonne taille </h4><br>  Vous pouvez également activer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les invites client</a> pour les navigateurs prenant en charge cette fonctionnalité.  Les conseils client sont un moyen de dire aux navigateurs d'envoyer des informations supplémentaires sur la largeur de la zone de visualisation, la largeur de l'image et même les conditions du réseau, telles que RTT (heure de transmission et de confirmation) et le type de connexion, par exemple <code>2g</code> . <br><br>  Vous pouvez activer les conseils en ajoutant un méta-élément: <br><br><pre> <code class="plaintext hljs">&lt;meta http-equiv="Accept-CH" content="Viewport-Width, Downlink"&gt; &lt;meta http-equiv="Accept-CH-Lifetime" content="86400"&gt;</code> </pre> <br>  Ou en définissant des en-têtes dans la requête HTML d'origine: <br><br><pre> <code class="plaintext hljs">Accept-CH: Width, Viewport-Width Accept-CH-Lifetime: 100</code> </pre> <br>  Dans les demandes suivantes, les navigateurs commenceront à envoyer des informations supplémentaires pendant un certain temps ( <code>Accept-CH-Lifetime</code> en secondes), ce qui peut aider les développeurs à adapter les images aux conditions de l'utilisateur sans modifier le code HTML. <br><br>  Par exemple, pour plus d'informations, telles que la largeur de l'image côté serveur, vous pouvez fournir à vos images l'attribut <code>sizes</code> pour donner au navigateur des informations supplémentaires sur l'apparence de ces images. <br><br><pre> <code class="plaintext hljs">&lt;!-- this images is laid over the full width | 100 viewport width --&gt; &lt;img class="w-100" src="/img/header.jpg" alt="" sizes="100vw"&gt;</code> </pre> <br>  Une fois l'en <code>Accept-CH</code> tête de réponse <code>Accept-CH</code> reçu et les images avec l'attribut <code>sizes</code> , les navigateurs incluront les en <code>viewport-width</code> têtes <code>viewport-width</code> et <code>width</code> la <code>viewport-width</code> affichage dans les demandes d'image, vous indiquant l'image la mieux adaptée. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec1/fa5/15f/ec1fa515f2eaddf32e3f1ba8e3d9576c.jpg"><br><br>  Ayant un format et une taille d'image pris en charge, vous pouvez envoyer des données adaptées sans avoir à enregistrer des éléments d'image non fiables et faire attention uniquement au format et à la taille du fichier, comme indiqué ci-dessous. <br><br><pre> <code class="plaintext hljs">&lt;pictur&gt; &lt;!-- serve WebP to Chrome, Edge, Firefox and Opera --&gt; &lt;source media="(min-width: 50em)" sizes="50vw" srcset="/image/thing-200.webp 200w, /image/thing-400.webp 400w, /image/thing-800.webp 800w, /image/thing-1200.webp 1200w, /image/thing-1600.webp 1600w, /image/thing-2000.webp 2000w" type="image/webp"&gt; &lt;source sizes="(min-width: 30em) 100vw" srcset="/image/thing-crop-200.webp 200w, /image/thing-crop-400.webp 400w, /image/thing-crop-800.webp 800w, /image/thing-crop-1200.webp 1200w, /image/thing-crop-1600.webp 1600w, /image/thing-crop-2000.webp 2000w" type="image/webp"&gt; &lt;!-- serve JPEG to others --&gt; &lt;surce media="(min-width: 50em)" sizes="50vw" srcset="/image/thing-200.jpg 200w, /image/thing-400.jpg 400w, /image/thing-800.jpg 800w, /image/thing-1200.jpg 1200w, /image/thing-1600.jpg 1600w, /image/thing-2000.jpg 2000w"&gt; &lt;surce sizes="(min-width: 30em) 100vw" srcset="/image/thing-crop-200.jpg 200w, /image/thing-crop-400.jpg 400w, /image/thing-crop-800.jpg 800w, /image/thing-crop-1200.jpg 1200w, /image/thing-crop-1600.jpg 1600w, /image/thing-crop-2000.jpg 2000w"&gt; &lt;!-- fallback for browsers that don't support picture --&gt; &lt;img src="/image/thing.jpg" width="50%"&gt; &lt;/pictur&gt;</code> </pre> <br>  Si vous avez accès à la largeur de la fenêtre d'affichage et à la taille de l'image, vous pouvez placer la logique de redimensionnement des ressources au premier plan sur vos serveurs. <br><br>  Cependant, gardez à l'esprit que vous ne devez pas créer d'images pour une largeur quelconque simplement parce que vous avez la largeur exacte de l'image.  L'envoi d'images pour une plage de taille spécifique ( <code>image-200</code> , <code>image-300</code> , <code>...</code> ) permet d'utiliser la mise en cache CDN et économise du temps de calcul. <br><br>  De plus, avec les technologies modernes telles que les travailleurs de service, vous pouvez même intercepter et modifier les demandes directement dans le client pour servir les meilleurs fichiers image.  Les info-bulles client étant activées, les techniciens de maintenance ont accès aux informations de mise en page et, en combinaison avec l'API d'image, telle que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cloudinary,</a> vous pouvez configurer l'URL de l'image directement dans le navigateur pour recevoir des images de la bonne taille. <br><br>  <i>Si vous recherchez des informations plus détaillées sur les conseils des clients, vous pouvez lire des articles de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jeremy Wagner</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ilya Grigorik</a> sur ce sujet.</i> <br><br><h2>  Le réseau doit être prudent </h2><br>  Puisque chacun de nous passe de nombreuses heures par jour sur le réseau, il y a le dernier aspect que je considère très important - le réseau doit être prudent. <br><br><h4>  Précharge - réduire le temps d'attente </h4><br>  En tant que développeurs, nous apprécions le temps de nos utilisateurs.  Personne ne veut perdre de temps.      ,           .      ,   ,        . <br><br>  :       ,     ,    .      ,    HTML      .               ,   ,     .          . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Rel=preload</a>       ,       . <br><br>      HTML-: <br><br><pre> <code class="plaintext hljs">&lt;link rel="preload" href="/font.woff2" as="font" type="font/woff2" crossorigin="anonymous"&gt;</code> </pre> <br>  : <br><br><pre> <code class="plaintext hljs">Link: &lt;/font.woff2&gt;; rel=preload; as=font; no-push</code> </pre> <br>  ,       ,    ,      ,  .      . <br><br>                : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>   . <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>    preload   ,   prefetch  preconnect. <br></li></ul><br><h4> Feature-Policy —    </h4><br>      ,      .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>   . <br><br> <i>     </i> .         ,  .        .      ,      ,     —  . <br><br>  ,         ,          ?  ,       ? <br><br>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> Feature-Policy.      ,   ,       ,      ,    . <br><br><pre> <code class="plaintext hljs">Feature-Policy: vibrate 'none'; geolocation 'none'</code> </pre> <br>          .        , ,  ,         . <br><br><pre> <code class="plaintext hljs">&lt;iframe allow="camera 'none'; microphone 'none'"&gt;</code> </pre> <br>      <code>Feature-Policy</code> , , ,       .                ,     .      . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa8/ada/e56/fa8adae56924a72210fc2009641eb8cb.jpg"><br><br> <i>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MDN.</a></i> <br><br>    ,        — push-. ,   <code>Feature-Policy</code>  push- ,  .     ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub.</a> <br><br>  feature policy   ,           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> , ,  ,      . <br><br><h2>      </h2><br>         ,      .          ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«HTTP- —  »</a> . <br><br>  ,      —   .    , , ,  …     . ,      ,     ,       -,      ,    -    . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450816/">https://habr.com/ru/post/fr450816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450804/index.html">L'impression 3D de métaux dans l'industrie automobile: commencez petit</a></li>
<li><a href="../fr450806/index.html">Lorsqu'une variable d'environnement accélère le processus de 40 fois</a></li>
<li><a href="../fr450810/index.html">7 meilleures façons de vérifier rapidement les compétences des informaticiens avant l'entretien</a></li>
<li><a href="../fr450812/index.html">PSR-14 - l'événement principal en PHP</a></li>
<li><a href="../fr450814/index.html">Comment BGP fonctionne</a></li>
<li><a href="../fr450818/index.html">De la latence Ceph élevée au patch du noyau avec eBPF / BCC</a></li>
<li><a href="../fr450820/index.html">Comité du programme FrontendConf: cadres, horizons, expérience mondiale et mission de la conférence</a></li>
<li><a href="../fr450822/index.html">Cadres en voie de disparition</a></li>
<li><a href="../fr450824/index.html">L'état du CSS</a></li>
<li><a href="../fr450826/index.html">Comment parler avec le microcontrôleur de JS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>