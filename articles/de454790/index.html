<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úÖ üèø üîû Java Native Image: Usability-Pr√ºfung ‚ùï üôèüèæ üëâüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor nicht allzu langer Zeit hat Oracle die erste Version des GraalVM-Projekts ver√∂ffentlicht (https://www.graalvm.org/). Der Ver√∂ffentlichung wurde so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Java Native Image: Usability-Pr√ºfung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454790/"><img src="https://habrastorage.org/webt/ge/3k/12/ge3k12jjimph6xn8zteg9n3olqo.jpeg"><br><br>  Vor nicht allzu langer Zeit hat Oracle die erste Version des GraalVM-Projekts ver√∂ffentlicht (https://www.graalvm.org/).  Der Ver√∂ffentlichung wurde sofort die Nummer 19.0.0 zugewiesen, anscheinend um zu √ºberzeugen, dass das Projekt ausgereift und f√ºr den Einsatz in ernsthaften Anwendungen bereit ist.  Einer der Teile dieses Projekts: <a href="">Substrate VM</a> ist ein Framework, mit dem Sie Java-Anwendungen in native ausf√ºhrbare Dateien umwandeln k√∂nnen (sowie native Bibliotheken, die in Anwendungen verbunden werden k√∂nnen, die beispielsweise in C / C ++ geschrieben sind).  Diese Funktion wurde bisher als experimentell deklariert.  Es ist auch erw√§hnenswert, dass native Java-Anwendungen einige Einschr√§nkungen aufweisen: Sie m√ºssen alle Ressourcen auflisten, die verwendet werden, um sie in das native Programm aufzunehmen.  Sie m√ºssen alle Klassen auflisten, die mit Reflektion und anderen Einschr√§nkungen verwendet werden.  Eine vollst√§ndige Liste finden Sie hier. <a href="">Native Image Java-Einschr√§nkungen</a> .  Nach dem Studium dieser Liste ist es im Prinzip verst√§ndlich, dass die Einschr√§nkungen nicht so bedeutend sind, dass es unm√∂glich war, komplexere Anwendungen als H√∂llenw√∂rter zu entwickeln.  Ich habe mir dieses Ziel gesetzt: Entwicklung eines kleinen Programms mit integriertem Webserver, Verwendung einer Datenbank (√ºber die ORM-Bibliothek) und Kompilierung in eine native Bin√§rdatei, die auf Systemen ohne installierten Java-Computer ausgef√ºhrt werden kann. <br><a name="habracut"></a><br>  Ich werde mit Ubuntu 19.04 (Intel Core i3-6100 CPU bei 3,70 GHz √ó 4) experimentieren. <br><br><h2>  Installieren Sie GraalVM </h2><br>  Die GraalVM-Installation erfolgt bequem mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SDKMAN</a> .  GraalVM-Installationsbefehl: <br><br><pre><code class="bash hljs">sdk install java 19.0.0-grl</code> </pre> <br>  OpenJDK GraalVM CE 19.0.0 wird installiert, CE ist Community Edition.  Es gibt auch die Enterprise Edition (EE), diese Edition muss jedoch vom Oracle Technology Network <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">heruntergeladen</a> werden. Der Link befindet sich auf der Seite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GraalVM-Downloads</a> . <br><br>  Nach der Installation von GraalVM, das bereits den Gu-Komponenten-Update-Manager von GraalVM verwendet, habe ich die Kompilierungsunterst√ºtzung in der nativen Bin√§rdatei installiert. <br><br><pre> <code class="bash hljs">gu install native-image</code> </pre> <br>  Alles, Arbeitswerkzeuge sind bereit, jetzt k√∂nnen Sie mit der Entwicklung von Anwendungen beginnen. <br><br><h2>  Einfache native Anwendung </h2><br>  Als Build-System verwende ich Maven.  Um native Bin√§rdateien zu erstellen, gibt es ein Maven-Plugin: <br><br><div class="spoiler">  <b class="spoiler_title">native-image-maven-plugin</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.oracle.substratevm<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>native-image-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${graal.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>native-image<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>package<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">imageName</span></span></span><span class="hljs-tag">&gt;</span></span>nativej<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">imageName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buildArgs</span></span></span><span class="hljs-tag">&gt;</span></span> --no-server <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buildArgs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Es ist weiterhin erforderlich, die Hauptklasse der Anwendung festzulegen.  Dies kann sowohl im Native-Image-Maven-Plugin als auch auf herk√∂mmliche Weise √ºber Folgendes erfolgen: <br><br><div class="spoiler">  <b class="spoiler_title">Maven-Jar-Plugin</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-jar-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span>nativej.Startup<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Erstellen Sie die Hauptklasse: <br><br><div class="spoiler">  <b class="spoiler_title">Startup.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Startup</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>); } }</code> </pre><br></div></div><br>  Jetzt k√∂nnen Sie den Befehl maven ausf√ºhren, um die Anwendung zu erstellen: <br><br><pre> <code class="bash hljs">mvn clean package</code> </pre> <br>  Das Erstellen einer nativen Bin√§rdatei auf meinem Computer dauert 35 Sekunden.  Als Ergebnis wird eine Bin√§rdatei mit einer Gr√∂√üe von 2,5 MB im Zielverzeichnis abgerufen.  Das Programm ben√∂tigt keinen installierten Java-Computer und wird auf Computern ausgef√ºhrt, auf denen Java fehlt. <br><br>  Repository-Link: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github: native-java-helloworld-demo</a> . <br><br><h2>  JDBC Postgres-Treiber </h2><br>  Und so funktioniert eine einfache Anwendung, die "Hallo Welt" anzeigt.  Es wurden keine L√∂sungen ben√∂tigt.  Ich werde versuchen, eine Ebene h√∂her zu gehen: Ich werde den Postgres-JDBC-Treiber verbinden, um Daten aus der Datenbank anzufordern.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bei Problemen</a> mit dem GraalVM-Github treten Fehler im Zusammenhang mit dem Postgres-Treiber auf, jedoch mit GraalVM-Release-Kandidaten.  Alle von ihnen sind als fest markiert. <br><br>  Ich verbinde die postgresql-Abh√§ngigkeit: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.postgresql<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>postgresql<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>42.2.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Ich schreibe den Code zum Extrahieren von Daten aus der Datenbank (die einfachste Benutzerplatte wurde erstellt): <br><br><div class="spoiler">  <b class="spoiler_title">Startup.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Startup</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> SQLException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> PGSimpleDataSource ds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PGSimpleDataSource(); ds.setUrl(<span class="hljs-string"><span class="hljs-string">"jdbc:postgresql://localhost/demo_nativem"</span></span>); ds.setUser(<span class="hljs-string"><span class="hljs-string">"test"</span></span>); ds.setPassword(<span class="hljs-string"><span class="hljs-string">"test"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> ( Connection conn = ds.getConnection(); Statement stmt = conn.createStatement(); ResultSet rs = stmt.executeQuery(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM \"public\".\"user\""</span></span>); ) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(rs.next()){ System.out.print(<span class="hljs-string"><span class="hljs-string">"ID: "</span></span> + rs.getLong(<span class="hljs-string"><span class="hljs-string">"id"</span></span>)); System.out.println(<span class="hljs-string"><span class="hljs-string">", Name: "</span></span> + rs.getString(<span class="hljs-string"><span class="hljs-string">"name"</span></span>)); } } } }</code> </pre><br></div></div><br>  Ich sammle die native Bin√§rdatei und erhalte sofort einen Build-Fehler: <br><br> <code>Error: No instances are allowed in the image heap for a class that is initialized or reinitialized at image runtime: org.postgresql.Driver. Try marking this class for build-time initialization with --initialize-at-build-time=org.postgresql.Driver <br></code> <br><br>  Tatsache ist, dass der native Anwendungs-Builder alle statischen Felder w√§hrend des Erstellungsprozesses initialisiert (sofern nicht anders angegeben) und dies durch Untersuchen der Abh√§ngigkeiten von Klassen tut.  Mein Code bezieht sich nicht auf org.postgresql.Driver, sodass der Collector nicht wei√ü, wie er besser initialisiert werden kann (beim Erstellen oder beim Starten der Anwendung), und bietet an, ihn beim Erstellen f√ºr die Initialisierung zu registrieren.  Dies kann durch Hinzuf√ºgen zu den Maven-Argumenten des Native-Image-Maven-Plugin-Plugins erfolgen, wie in der Fehlerbeschreibung angegeben.  Nach dem Hinzuf√ºgen des Treibers wird der gleiche Fehler in Bezug auf org.postgresql.util.SharedTimer angezeigt.  Wieder sammle ich einen solchen Build-Fehler und sto√üe darauf: <br><br> <code>Error: Class initialization failed: org.postgresql.sspi.SSPIClient <br></code> <br><br>  Es gibt keine Empfehlungen zur Korrektur.  Wenn man sich jedoch die Quelle der Klasse ansieht, ist klar, dass es sich um die Ausf√ºhrung von Code unter Windows handelt.  Unter Linux schl√§gt die Initialisierung (die w√§hrend der Montage erfolgt) mit einem Fehler fehl.  Es besteht die M√∂glichkeit, die Initialisierung zu Beginn der Anwendung zu verz√∂gern: --initialize-at-run-time = org.postgresql.sspi.SSPIClient.  Die Initialisierung unter Linux findet nicht statt und es werden keine Fehler mehr in Bezug auf diese Klasse angezeigt.  Argumente erstellen: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buildArgs</span></span></span><span class="hljs-tag">&gt;</span></span> --no-server --no-fallback --initialize-at-build-time=org.postgresql.Driver --initialize-at-build-time=org.postgresql.util.SharedTimer --initialize-at-run-time=org.postgresql.sspi.SSPIClient <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buildArgs</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Die Montage dauerte 1 Minute 20 Sekunden und die Datei schwoll auf 11 MB an.  Ich habe ein zus√§tzliches Flag zum Erstellen der Bin√§rdatei hinzugef√ºgt: --no-fallback verbietet das Generieren einer nativen Bin√§rdatei, f√ºr die eine installierte Java-Maschine erforderlich ist.  Eine solche Bin√§rdatei wird erstellt, wenn der Kollektor die Verwendung von Sprachfunktionen erkennt, die entweder in der Substrate-VM nicht unterst√ºtzt werden oder eine Konfiguration erfordern, aber noch keine Konfiguration vorhanden ist.  In meinem Fall hat der Kollektor die m√∂gliche Verwendung von Reflexion im JDBC-Treiber entdeckt.  Dies ist jedoch nur eine m√∂gliche Verwendung, es ist in meinem Programm nicht erforderlich, und daher ist keine zus√§tzliche Konfiguration erforderlich (wie dies gemacht wird, wird sp√§ter gezeigt).  Es gibt auch das Flag --static, das den Generator zwingt, libc statisch zu verkn√ºpfen.  Wenn Sie es jedoch verwenden, st√ºrzt das Programm mit einem Segmentierungsfehler ab, wenn Sie versuchen, den Netzwerknamen in eine IP-Adresse aufzul√∂sen.  Ich habe nach L√∂sungen f√ºr dieses Problem gesucht, aber nichts Passendes gefunden, also habe ich die Programmabh√§ngigkeit von libc verlassen. <br><br>  Ich f√ºhre die resultierende Bin√§rdatei aus und erhalte den folgenden Fehler: <br><br> <code>Exception in thread "main" org.postgresql.util.PSQLException: Could not find a java cryptographic algorithm: TLS SSLContext not available. <br></code> <br><br>  Nach einigen Recherchen wurde die Fehlerursache identifiziert: Postgres stellt standardm√§√üig eine TLS-Verbindung mithilfe der elliptischen Kurve her.  SubstrateVM beinhaltet nicht die Implementierung solcher Algorithmen f√ºr TLS. Hier ist das entsprechende offene Problem - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Single-Binary ECC (ECDSA / ECDHE) TLS-Unterst√ºtzung f√ºr SubstrateVM</a> .  Es gibt verschiedene L√∂sungen: Platzieren Sie die Bibliothek aus dem GraalVM-Paket: libsunec.so neben der Anwendung, konfigurieren Sie die Liste der Algorithmen auf dem Postgres-Server, schlie√üen Sie Elliptic Curve-Algorithmen aus oder deaktivieren Sie einfach die TLS-Verbindung im Postgres-Treiber (diese Option wurde ausgew√§hlt): <br><br><pre> <code class="java hljs">dataSource.setSslMode(SslMode.DISABLE.value);</code> </pre><br>  Nachdem der Fehler beim Herstellen einer Verbindung mit Postgres behoben wurde, starte ich die native Anwendung, sie wird ausgef√ºhrt und zeigt Daten aus der Datenbank an. <br><br>  Repository-Link: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github: native-java-postgres-demo</a> . <br><br><h2>  DI-Framework und eingebetteter Webserver </h2><br>  Bei der Entwicklung einer komplexen Java-Anwendung wird normalerweise ein Framework verwendet, z. B. Spring Boot.  Nach diesem Artikel der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Unterst√ºtzung f√ºr native GraalVM-Images zu</a> urteilen, wird <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">uns</a> die Arbeit von Spring Boot im nativen Image "out of the box" nur in der Version von Spring Boot 5.3 versprochen. <br><br>  Aber es gibt ein wunderbares <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Micronaut-</a> Framework, das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">behauptet, im nativen GraalVM-Image zu funktionieren</a> .  Im Allgemeinen erfordert das Anschlie√üen eines Micronaut an eine Anwendung, die in einer Bin√§rdatei zusammengestellt wird, keine besonderen Einstellungen oder Probleml√∂sungen.  In Micronaut wurden bereits viele Einstellungen f√ºr die Verwendung von Reflection- und Verbindungsressourcen f√ºr die Substrate-VM vorgenommen.  √úbrigens k√∂nnen dieselben Einstellungen in Ihrer Anwendung in der Einstellungsdatei META-INF / native-image / $ {groupId} / $ {artefaktId} /native-image.properties platziert werden (ein solcher Pfad f√ºr die Einstellungsdatei wird von Substrate VM empfohlen) Dateiinhalt: <br><br><div class="spoiler">  <b class="spoiler_title">native-image.properties</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Args = \ -H:+ReportUnsupportedElementsAtRuntime \ -H:ResourceConfigurationResources=${.}/resource-config.json \ -H:ReflectionConfigurationResources=${.}/reflect-config.json \ -H:DynamicProxyConfigurationResources=${.}/proxy-config.json \ --initialize-at-build-time=org.postgresql.Driver \ --initialize-at-build-time=org.postgresql.util.SharedTimer \ --initialize-at-run-time=org.postgresql.sspi.SSPIClient</code> </pre><br></div></div><br>  Die Dateien resource-config.json, Reflect-config.json, Proxy-config.json enthalten Einstellungen zum Verbinden von Ressourcen, Reflection und verwendeten Proxys (Proxy.newProxyInstance).  Diese Dateien k√∂nnen manuell erstellt oder mit agentlib: native-image-agent abgerufen werden.  Wenn Sie native-image-agent verwenden, m√ºssen Sie das √ºbliche jar (und nicht die native Bin√§rdatei) mit dem Agenten ausf√ºhren: <br><br><pre> <code class="bash hljs">java -agentlib:native-image-agent=config-output-dir=output -jar my.jar</code> </pre><br>  Dabei ist die Ausgabe das Verzeichnis, in dem sich die oben beschriebenen Dateien befinden.  In diesem Fall muss das Programm nicht nur ausgef√ºhrt werden, sondern auch Skripts im Programm ausf√ºhren, da Einstellungen in die Dateien geschrieben werden, wenn Sie Reflection verwenden, Ressourcen √∂ffnen und einen Proxy erstellen.  Diese Dateien k√∂nnen META-INF / native-image / $ {groupId} / $ {artefaktId} abgelegt und in native-image.properties referenziert werden. <br><br>  Ich habe beschlossen, die Protokollierung mithilfe von Logback zu verbinden: Ich habe der logback-classic-Bibliothek und der Datei logback.xml eine Abh√§ngigkeit hinzugef√ºgt.  Danach habe ich ein normales Glas kompiliert und es mit native-image-agent ausgef√ºhrt.  Am Ende des Programms die notwendigen Einstellungsdateien.  Wenn Sie sich deren Inhalt ansehen, k√∂nnen Sie sehen, dass der Agent die Verwendung von logback.xml zum Kompilieren in die Bin√§rdatei registriert hat.  Au√üerdem enth√§lt die Datei Reflection-config.json alle F√§lle der Verwendung von Reflection: F√ºr bestimmte Klassen werden Metainformationen in die Bin√§rdatei √ºbertragen. <br><br>  Dann habe ich der micronaut-http-server-netty-Bibliothek eine Abh√§ngigkeit hinzugef√ºgt, um den netty-basierten eingebetteten Webserver zu verwenden, und einen Controller erstellt: <br><br><div class="spoiler">  <b class="spoiler_title">Startup.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span>(<span class="hljs-string"><span class="hljs-string">"/hello"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Get</span></span>(<span class="hljs-string"><span class="hljs-string">"/{name}"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Produces</span></span>(MediaType.TEXT_PLAIN) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HttpResponse&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponse.ok(<span class="hljs-string"><span class="hljs-string">"Hello "</span></span> + name); } }</code> </pre><br></div></div><br>  Und Hauptklasse: <br><br><div class="spoiler">  <b class="spoiler_title">HelloController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Startup</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Signal.handle(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Signal(<span class="hljs-string"><span class="hljs-string">"INT"</span></span>), sig -&gt; System.exit(<span class="hljs-number"><span class="hljs-number">0</span></span>)); Micronaut.run(Startup.class, args); } }</code> </pre><br></div></div><br>  Jetzt k√∂nnen Sie versuchen, eine native Bin√§rdatei zu erstellen.  Meine Montage dauerte 4 Minuten.  Wenn Sie es ausf√ºhren und zur Adresse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // localhost: 8080 / hello / user gehen</a> , tritt ein Fehler auf: <br><br><pre> <code class="plaintext hljs">{"_links":{"self":{"href":"/hello/user","templated":false}},"message":"More than 1 route matched the incoming request. The following routes matched /hello/user: GET - /hello/user, GET - /hello/user"}</code> </pre><br>  Ehrlich gesagt ist nicht ganz klar, warum dies passiert, aber nach der Suche durch Eingabe stellte ich fest, dass der Fehler verschwindet, wenn die folgenden Zeilen aus der Datei resource-config.json (die vom Agenten erstellt wurde) entfernt werden: <br><br><pre> <code class="plaintext hljs"> {"pattern":"META-INF/services/com.fasterxml.jackson.databind.Module"}, {"pattern":"META-INF/services/io.micronaut.context.env.PropertySourceLoader"}, {"pattern":"META-INF/services/io.micronaut.http.HttpResponseFactory"}, {"pattern":"META-INF/services/io.micronaut.inject.BeanConfiguration"}, {"pattern":"META-INF/services/io.micronaut.inject.BeanDefinitionReference"},</code> </pre><br>  Micronaut registriert diese Ressourcen und es scheint, dass eine erneute Registrierung zu einer doppelten Registrierung meines Controllers und einem Fehler f√ºhrt.  Wenn Sie nach dem Korrigieren der Datei die Bin√§rdatei neu erstellen und ausf√ºhren, treten keine Fehler mehr auf. Der Text ‚ÄûHallo Benutzer‚Äú wird unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // localhost: 8080 / hello / user</a> angezeigt. <br><br>  Ich m√∂chte auf die Verwendung der folgenden Zeile in der Hauptklasse aufmerksam machen: <br><br><pre> <code class="java hljs">Signal.handle(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Signal(<span class="hljs-string"><span class="hljs-string">"INT"</span></span>), sig -&gt; System.exit(<span class="hljs-number"><span class="hljs-number">0</span></span>));</code> </pre><br>  Es muss eingesetzt werden, damit Micronaut korrekt fertig ist.  Trotz der Tatsache, dass Micronaut einen Haken zum Herunterfahren aufh√§ngt, funktioniert dies nicht in der nativen Bin√§rdatei.  Es gibt ein entsprechendes Problem: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Shutdownhook wird nicht mit Native ausgel√∂st</a> .  Es ist als fest markiert, hat jedoch nur eine Problemumgehung mit der Signal-Klasse. <br><br>  Repository-Link: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github: native-java-postgres-micronaut-demo</a> . <br><br><h2>  ORM-Verbindung </h2><br>  JDBC ist gut, aber Reifen mit sich wiederholendem Code, endlosem SELECT und UPDATE.  Ich werde versuchen, mein Leben zu erleichtern (oder zu erschweren, je nachdem, auf welche Seite ich schauen soll), indem ich eine Art ORM verbinde. <br><br><h4>  Ruhezustand </h4><br>  Zuerst habe ich mich f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hibernate entschieden</a> , da es eines der h√§ufigsten ORMs f√ºr Java ist.  Aufgrund eines Erstellungsfehlers konnte ich jedoch kein natives Image mit Hibernate erstellen: <br><br><pre> <code class="plaintext hljs">Error: Field java.lang.reflect.Method.defaultValue is not present on type java.lang.reflect.Constructor. Error encountered while analysing java.lang.reflect.Method.getDefaultValue() Parsing context: parsing org.hibernate.annotations.common.annotationfactory.AnnotationProxy.getAnnotationValues(AnnotationProxy.java:63) parsing org.hibernate.annotations.common.annotationfactory.AnnotationProxy(AnnotationProxy.java:52) ...</code> </pre><br>  Es gibt ein entsprechendes offenes Problem: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[native-image] Micronaut + Hibernate f√ºhrt zu einem Fehler beim Analysieren von java.lang.reflect.Method.getDefaultValue ()</a> . <br><br><h4>  jOOQ </h4><br>  Dann habe ich beschlossen, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">jOOQ</a> zu versuchen.  Ich habe es geschafft, eine native Bin√§rdatei zu erstellen, obwohl ich viele Einstellungen vornehmen musste: Festlegen, welche Klassen initialisiert werden sollen (Buildtime, Runtime) und mit der Reflexion herumspielen.  Am Ende kam es darauf an, dass jOOQ beim Start der Anwendung den Proxy org.jooq.impl.ParserImpl $ Ignore als statisches Mitglied der Klasse org.jooq.impl.Tools initialisiert.  Und dieser Proxy verwendet MethodHandle, das Substrate VM <a href="">noch nicht unterst√ºtzt</a> .  Hier ist ein √§hnliches offenes Problem: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[native-image] Micronaut + Kafka kann kein natives Image mit dem MethodHandle-Argument erstellen und konnte nicht auf h√∂chstens einen einzigen Aufruf reduziert werden</a> . <br><br><h4>  Apache Cayennepfeffer </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apache Cayenne ist</a> weniger verbreitet, sieht aber recht funktionell aus.  Ich werde versuchen, es zu verbinden.  Ich habe XML-Dateien zur Beschreibung des Datenbankschemas erstellt. Sie k√∂nnen entweder manuell oder mit dem CayenneModeler-GUI-Tool oder basierend auf einer vorhandenen Datenbank erstellt werden.  Mit dem Cayenne-Maven-Plugin in der POM-Datei wird die Codegenerierung von Klassen durchgef√ºhrt, die den Datenbanktabellen entsprechen: <br><br><div class="spoiler">  <b class="spoiler_title">Cayennepfeffer-Maven-Plugin</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.cayenne.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>cayenne-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${cayenne.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">map</span></span></span><span class="hljs-tag">&gt;</span></span>src/main/resources/db/datamap.map.xml<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">map</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">destDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.build.directory}/generated-sources/cayenne<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">destDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>cgen<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Dann habe ich die CayenneRuntimeFactory-Klasse hinzugef√ºgt, um die Datenbankkontextfactory zu initialisieren: <br><br><div class="spoiler">  <b class="spoiler_title">CayenneRuntimeFactory.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Factory</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CayenneRuntimeFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DataSource dataSource; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CayenneRuntimeFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DataSource dataSource)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataSource = dataSource; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ServerRuntime </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cayenneRuntime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ServerRuntime.builder() .dataSource(dataSource) .addConfig(<span class="hljs-string"><span class="hljs-string">"db/cayenne-test.xml"</span></span>) .build(); } }</code> </pre><br></div></div><br>  HelloController Controller: <br><br><div class="spoiler">  <b class="spoiler_title">HelloController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span>(<span class="hljs-string"><span class="hljs-string">"/hello"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ServerRuntime cayenneRuntime; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HelloController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServerRuntime cayenneRuntime)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cayenneRuntime = cayenneRuntime; } <span class="hljs-meta"><span class="hljs-meta">@Get</span></span>(<span class="hljs-string"><span class="hljs-string">"/{name}"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Produces</span></span>(MediaType.TEXT_PLAIN) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HttpResponse&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ObjectContext context = cayenneRuntime.newContext(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> List&lt;User&gt; result = ObjectSelect.query(User.class).select(context); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).setName(name); } context.commitChanges(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponse.ok(result.stream() .map(x -&gt; MessageFormat.format(<span class="hljs-string"><span class="hljs-string">"{0}.{1}"</span></span>, x.getObjectId(), x.getName())) .collect(Collectors.joining(<span class="hljs-string"><span class="hljs-string">","</span></span>))); } }</code> </pre><br></div></div><br>  Anschlie√üend startete er das Programm als regul√§res JAR mit agentlib: native-image-agent, um Informationen √ºber die verwendeten Ressourcen und die Reflexion zu sammeln. <br><br>  Ich habe die native Bin√§rdatei gesammelt, sie ausgef√ºhrt, gehe zur Adresse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // localhost: 8080 / hello / user</a> und erhalte eine Fehlermeldung: <br><br><pre> <code class="plaintext hljs">{"message":"Internal Server Error: Provider com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl not found"}</code> </pre><br>  es stellt sich heraus, agentlib: native-image-agent hat die Verwendung dieser Klasse in der Reflexion nicht erkannt. <br><br>  Manuelles Hinzuf√ºgen zur Datei Reflect-Config.json: <br><br><pre> <code class="plaintext hljs">{ "name":"com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl", "allDeclaredConstructors":true }</code> </pre><br>  Wieder sammle ich die Bin√§rdatei, starte, aktualisiere die Webseite und erhalte einen weiteren Fehler: <br><br><pre> <code class="plaintext hljs">Caused by: java.util.MissingResourceException: Resource bundle not found org.apache.cayenne.cayenne-strings. Register the resource bundle using the option -H:IncludeResourceBundles=org.apache.cayenne.cayenne-strings.</code> </pre><br>  Hier ist alles klar, ich f√ºge die Einstellung hinzu, wie in der vorgeschlagenen L√∂sung angegeben.  Wieder sammle ich die Bin√§rdatei (dies ist 5 Minuten Zeit), ich starte sie immer wieder ein Fehler, ein anderer: <br><br><pre> <code class="plaintext hljs">No DataMap found, can't route query org.apache.cayenne.query.SelectQuery@2af96966[root=class name.voyachek.demos.nativemcp.db.User,name=]"}</code> </pre><br>  Ich musste an diesem Fehler basteln, nach zahlreichen Tests, bei denen die Quellen untersucht wurden, wurde klar, dass der Grund f√ºr den Fehler in dieser Zeile aus der Klasse org.apache.cayenne.resource.URLResource liegt: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URLResource(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(url, relativePath));</code> </pre><br>  Wie sich herausstellte, l√§dt Substrate VM die Ressource √ºber die URL, die als Basis angegeben wird, und nicht √ºber die URL, die auf der Basis von base und relativePath erstellt werden soll.  Wor√ºber das folgende Problem von mir registriert wurde: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ung√ºltiger Ressourceninhalt bei Verwendung einer neuen URL (URL-Kontext, Zeichenfolgenspezifikation)</a> . <br><br>  Der Fehler ist festgestellt. Jetzt m√ºssen Sie nach Problemumgehungen suchen.  Gl√ºcklicherweise erwies sich Apache Cayenne als eine ziemlich anpassbare Sache.  Sie mussten Ihren eigenen Ressourcenlader registrieren: <br><br><pre> <code class="java hljs">ServerRuntime.builder() .dataSource(dataSource) .addConfig(<span class="hljs-string"><span class="hljs-string">"db/cayenne-test.xml"</span></span>) .addModule(binder -&gt; { binder.bind(ResourceLocator.class).to(ClassLoaderResourceLocatorFix.class); binder.bind(Key.get(ResourceLocator.class, Constants.SERVER_RESOURCE_LOCATOR)).to(ClassLoaderResourceLocatorFix.class); }) .build();</code> </pre><br>  Hier ist sein Code: <br><br><div class="spoiler">  <b class="spoiler_title">ClassLoaderResourceLocatorFix.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassLoaderResourceLocatorFix</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceLocator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClassLoaderManager classLoaderManager; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClassLoaderResourceLocatorFix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Inject ClassLoaderManager classLoaderManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.classLoaderManager = classLoaderManager; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Collection&lt;Resource&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findResources</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Collection&lt;Resource&gt; resources = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Enumeration&lt;URL&gt; urls; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { urls = classLoaderManager.getClassLoader(name).getResources(name); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationException(<span class="hljs-string"><span class="hljs-string">"Error getting resources for "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (urls.hasMoreElements()) { resources.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URLResourceFix(urls.nextElement())); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resources; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLResourceFix</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">URLResource</span></span></span><span class="hljs-class"> </span></span>{ URLResourceFix(URL url) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(url); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Resource </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRelativeResource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String relativePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String url = getURL().toString(); url = url.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, url.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>) + relativePath; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URLResource(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URI(url).toURL()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MalformedURLException | URISyntaxException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CayenneRuntimeException( <span class="hljs-string"><span class="hljs-string">"Error creating relative resource '%s' : '%s'"</span></span>, e, getURL(), relativePath); } } } }</code> </pre><br></div></div><br>  Es hat eine Linie <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URLResource(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(url, relativePath));</code> </pre><br>  ersetzt durch: <br><br><pre> <code class="java hljs">String url = getURL().toString(); url = url.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, url.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>) + relativePath; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URLResource(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URI(url).toURL());</code> </pre><br>  Ich sammle die Bin√§rdatei (70 MB), starte sie, gehe zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // localhost: 8080 / hello / user</a> und alles funktioniert, die Daten aus der Datenbank werden auf der Seite angezeigt. <br><br>  Repository-Link: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github: native-micronaut-cayenne-demo</a> . <br><br><h2>  Schlussfolgerungen </h2><br>  Das Ziel wurde erreicht: Eine einfache Webanwendung mit Zugriff auf die Datenbank √ºber ORM wurde entwickelt.  Die Anwendung wird in eine native Bin√§rdatei kompiliert und kann auf Systemen ohne installierte Java-Maschine ausgef√ºhrt werden.  Trotz zahlreicher Probleme fand ich eine Kombination aus Frameworks, Einstellungen und Problemumgehungen, die es mir erm√∂glichten, ein Arbeitsprogramm zu erhalten. <br><br>  Ja, die M√∂glichkeit, regul√§re Bin√§rdateien aus Java-Quellcode zu erstellen, befindet sich noch im experimentellen Status.  Dies zeigt sich in der F√ºlle von Problemen und der Notwendigkeit, nach Problemumgehungen zu suchen.  Am Ende stellte sich jedoch heraus, dass das gew√ºnschte Ergebnis erzielt wurde.  Was habe ich bekommen? <br><br><ul><li>  Die einzige in sich geschlossene Datei (fast gibt es Abh√§ngigkeiten von Bibliotheken wie libc), die auf Systemen ohne Java-Computer ausgef√ºhrt werden kann. </li><li>  Die Startzeit betr√§gt durchschnittlich 40 Millisekunden gegen√ºber 2 Sekunden beim Starten eines normalen Glases. </li></ul><br>  Unter den M√§ngeln m√∂chte ich die lange Kompilierungszeit der nativen Bin√§rdatei erw√§hnen.  Ich brauche durchschnittlich f√ºnf Minuten und werde h√∂chstwahrscheinlich beim Schreiben von Code und beim Verbinden von Bibliotheken zunehmen.  Daher ist es sinnvoll, Bin√§rdateien basierend auf vollst√§ndig debuggtem Code zu erstellen.  Dar√ºber hinaus sind Debugging-Informationen f√ºr native Bin√§rdateien nur in der kommerziellen Edition von Graal VM - Enterprise Edition verf√ºgbar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de454790/">https://habr.com/ru/post/de454790/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de454774/index.html">Wir haben den n√ºtzlichsten Code in unserem Leben geschrieben, ihn aber in den Papierkorb geworfen. Bei uns</a></li>
<li><a href="../de454776/index.html">Freiberuflich oder im B√ºro? Freelancer-Antwort</a></li>
<li><a href="../de454778/index.html">Das Buch "Maschinelles Lernen: Algorithmen f√ºr Unternehmen"</a></li>
<li><a href="../de454780/index.html">Was wir √ºber Microservices wissen</a></li>
<li><a href="../de454788/index.html">Waffe eines vorsichtigen Anlegers: Wir betrachten den beizulegenden Zeitwert von Investmentanleihen</a></li>
<li><a href="../de454792/index.html">Vergleich von Austauschsortierungsalgorithmen</a></li>
<li><a href="../de454804/index.html">Erstellen Sie Ihre Komponente mit Mikrovorlagen</a></li>
<li><a href="../de454806/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 9. Die physische Welt der Schalter. Teil 1</a></li>
<li><a href="../de454808/index.html">√úber Raumfahrzeuge und Weltraum. So erstellen Sie eine Funktion, indem Sie das gesamte Produkt auf dem Weg √§ndern</a></li>
<li><a href="../de454810/index.html">Frische Luft auf dem Mars: Biegen Sie ein CO2-Molek√ºl und holen Sie sich Sauerstoff</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>