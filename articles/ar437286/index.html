<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙌🏻 🎍 👩🏾‍🤝‍👩🏼 أحاول. NET Core + Kubernetes + appmetrics + prometheus + grafana + jobs + check checks ⛴️ 👨🏽‍🤝‍👨🏼 🔔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="معرفة موجزة مع kubernetes للمطورين بمثال نشر موقع قالب بسيط ، وإعداده للمراقبة ، وتنفيذ المهام المجدولة والفحوصات الصحية (يتم إرفاق جميع أكواد المصدر)...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>أحاول. NET Core + Kubernetes + appmetrics + prometheus + grafana + jobs + check checks</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437286/" style=";text-align:right;direction:rtl">  معرفة موجزة مع kubernetes للمطورين بمثال نشر موقع قالب بسيط ، وإعداده للمراقبة ، وتنفيذ المهام المجدولة والفحوصات الصحية (يتم إرفاق جميع أكواد المصدر) <br><br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تثبيت Kubernetes</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تثبيت واجهة المستخدم</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">قم بتشغيل التطبيق الخاص بك في الكتلة</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">إضافة مقاييس مخصصة إلى التطبيق</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">جمع القياسات من خلال بروميثيوس</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">عرض المقاييس في غرافانا</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">المهام المجدولة</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التسامح مع الخطأ</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الاستنتاجات</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ملاحظات</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">المراجع</a> <br><a name="habracut"></a><br><a name="1"></a><h2 style=";text-align:right;direction:rtl">  تثبيت Kubernetes </h2><br>  <i>ليست مناسبة لمستخدمي لينكس ، يجب عليك استخدام <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">minikube</a></i> <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  هل لديك سطح مكتب عامل ميناء </li><li style=";text-align:right;direction:rtl">  في ذلك تحتاج إلى البحث عن وتمكين كتلة Kubernetes عقدة واحدة <br><img src="https://habrastorage.org/webt/zc/ij/zs/zcijzspy007dfz7ilba9xhv3mg0.png"></li><li style=";text-align:right;direction:rtl">  الآن لديك api <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http: // localhost: 8001 /</a> للعمل مع kubernetis </li><li style=";text-align:right;direction:rtl"> التواصل معه يحدث من خلال kubectl فائدة مريحة <br>  تحقق من إصداره باستخدام الأمر&gt; <code>kubectl version</code> <br>  آخر ما هو مكتوب هنا هو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://storage.googleapis.com/kubernetes-release/release/stable.txt</a> <br>  يمكنك تنزيله على الرابط المناسب <a href="">https://storage.googleapis.com/kubernetes-release/release/v1.13.2/bin/windows/amd64/kubectl.exe</a> </li><li style=";text-align:right;direction:rtl">  <code>kubectl cluster-info</code> أن الكتلة تعمل&gt; <code>kubectl cluster-info</code> </li></ol><br><a name="2"></a><h2 style=";text-align:right;direction:rtl">  تركيب واجهة المستخدم </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يتم نشر الواجهة في نفس الكتلة <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl create -f https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended/kubernetes-dashboard.yaml</code> </pre> </li><li style=";text-align:right;direction:rtl">  احصل على رمز مميز للوصول إلى الواجهة <pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl describe secret</code> </pre> <br>  ونسخة <br><img src="https://habrastorage.org/webt/9q/kl/fa/9qklfaacfs9863l1s5cy7nnz1-k.png"></li><li style=";text-align:right;direction:rtl">  الآن ابدأ الوكيل <pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl proxy</code> </pre> </li><li style=";text-align:right;direction:rtl">  ويمكنك استخدام <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=http://localhost:8001/api/v1/namespaces/kube-system/services/">http: // localhost: 8001 / api / v1 / مساحات الأسماء / kube-system / services / https: kubernetes-dashboard: / proxy /</a> <img src="https://habrastorage.org/webt/-w/si/i1/-wsii1ckz09obhzqxwsf25yauvm.png"></li></ol><br><br><a name="3"></a><h2 style=";text-align:right;direction:rtl">  تشغيل التطبيق الخاص بك في كتلة </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  لقد تقدمت بطلب mc netcoreapp2.1 قياسي من خلال الاستوديو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/SanSYS/kuberfirst</a> </li><li style=";text-align:right;direction:rtl">  Dockerfile: <pre style=";text-align:right;direction:rtl"> <code class="actionscript hljs">FROM microsoft/dotnet:<span class="hljs-number"><span class="hljs-number">2.1</span></span>-aspnetcore-runtime AS base WORKDIR /app EXPOSE <span class="hljs-number"><span class="hljs-number">80</span></span> FROM microsoft/dotnet:<span class="hljs-number"><span class="hljs-number">2.1</span></span>-sdk AS build WORKDIR /src COPY ./MetricsDemo.csproj . RUN ls RUN dotnet restore <span class="hljs-string"><span class="hljs-string">"MetricsDemo.csproj"</span></span> COPY . . RUN dotnet build <span class="hljs-string"><span class="hljs-string">"MetricsDemo.csproj"</span></span> -c Release -o /app FROM build AS publish RUN dotnet publish <span class="hljs-string"><span class="hljs-string">"MetricsDemo.csproj"</span></span> -c Release -o /app FROM base AS <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> WORKDIR /app COPY --from=publish /app . ENTRYPOINT [<span class="hljs-string"><span class="hljs-string">"dotnet"</span></span>, <span class="hljs-string"><span class="hljs-string">"MetricsDemo.dll"</span></span>]</code> </pre> </li><li style=";text-align:right;direction:rtl">  جمعت هذا الشيء مع علامة metricsdemo3 <pre style=";text-align:right;direction:rtl"> <code class="bash hljs">docker build -t metricsdemo3 .</code> </pre> </li><li style=";text-align:right;direction:rtl">  لكن!  يقوم Coober افتراضيًا بسحب الصور من المحور ، لذلك أرفع السجل المحلي </li><li style=";text-align:right;direction:rtl">  ملاحظة - لم يحاول تشغيل في kubernetis <pre style=";text-align:right;direction:rtl"> <code class="bash hljs">docker create -p 5000:5000 --restart always --name registry registry:2</code> </pre></li><li style=";text-align:right;direction:rtl">  وأنا أصف ذلك بأنه غير آمن: <br><img src="https://habrastorage.org/webt/0e/h3/5e/0eh35ewv6frgqwrwaqddcriqhpu.png"><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"registry-mirrors"</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">"insecure-registries"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"localhost:5000"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"debug"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"experimental"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> </li><li style=";text-align:right;direction:rtl">  قبل الدخول في السجل ، لفتات أكثر <pre style=";text-align:right;direction:rtl"> <code class="bash hljs">docker start registry docker tag metricsdemo3 localhost:5000/sansys/metricsdemo3 docker push localhost:5000/sansys/metricsdemo3</code> </pre> </li><li style=";text-align:right;direction:rtl">  سيبدو شيء مثل هذا: <br><img src="https://habrastorage.org/webt/ep/6i/5o/ep6i5ofhvqdr8cokxqbidrqisvk.png"></li><li style=";text-align:right;direction:rtl"><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">إطلاق عبر واجهة المستخدم</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/tv/oa/ed/tvoaedah5gqbrqftpcxjdlwrkpi.png"><br></div></div></li></ol><br><br><h4 style=";text-align:right;direction:rtl">  إذا بدأ ، فكل شيء على ما يرام ويمكنك البدء في العمل </h4><br>  إنشاء ملف نشر <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">1-نشر التطبيق. yaml</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kind: Deployment apiVersion: apps/v1 metadata: name: metricsdemo labels: app: web spec: replicas: 2 <span class="hljs-comment"><span class="hljs-comment">#    (  ) #  ,      selector: matchLabels: app: metricsdemo template: metadata: labels: app: metricsdemo #     selector  kind: Service spec: containers: - name: metricsdemo #   image: localhost:5000/sansys/metricsdemo3 #    ports: - containerPort: 80 #       # :    ,       --- kind: Service apiVersion: v1 metadata: name: metricsdemo #    __meta_kubernetes_service_name="metricsdemo",  https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config labels: apptype: business #    __meta_kubernetes_service_label_apptype="business" -  instancetype: web #    __meta_kubernetes_service_label_instancetype="web" spec: selector: app: metricsdemo #    labels:app type: LoadBalancer #      ports: - protocol: TCP #    _meta_kubernetes_service_port_protocol="TCP" port: 9376 targetPort: 80 name: portapi #    __meta_kubernetes_service_port_name="portapi"</span></span></code> </pre> </div></div><br>  وصف صغير <ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  النوع - يشير إلى نوع الكيان الموضح من خلال ملف yaml </li><li style=";text-align:right;direction:rtl">  apiVersion - ما api يتم نقل الكائن إلى </li><li style=";text-align:right;direction:rtl">  التسميات - تسميات فقط فقط (يمكن أن تفكر مفاتيح على اليسار والقيم من قبل نفسك) </li><li style=";text-align:right;direction:rtl">  محدد - يسمح لك بربط الخدمات مع النشر ، على سبيل المثال ، من خلال التسميات </li></ul><br>  التالي: <pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl create -f .\1-deployment-app.yaml</code> </pre><br>  وسترى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=http://localhost:8001/api/v1/namespaces/kube-system/services/">النشر</a> في الواجهة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=http://localhost:8001/api/v1/namespaces/kube-system/services/">http: // localhost: 8001 / api / v1 / مساحات الأسماء / kube-system / services / https: kubernetes-dashboard: / proxy / #! / Deployment؟ Namespace = default</a> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">الشاشة</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/8c/sp/gj/8cspgj27ws9tcjd-6euq5s3djig.png"></div></div><br>  يوجد داخلها مجموعة النسخ المتماثلة ، والتي تبين أن التطبيق يعمل في حالتين (Pods) وهناك خدمة واحدة ذات صلة بها عنوان من الخارج لفتح تطبيق مدبلج في المتصفح <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">لقطات</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zl/ix/tl/zlixtl8tehddvrk36ykdfx6hd48.png"><br><img src="https://habrastorage.org/webt/5u/kq/cx/5ukqcxek-nslcezxse0dqot_cym.png"><br></div></div><br><a name="4"></a><h2 style=";text-align:right;direction:rtl">  إضافة مقاييس مخصصة إلى التطبيق </h2><br>  إضافة الحزمة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://www.app-metrics.io/ إلى</a> التطبيق <br>  لن أصف بالتفصيل كيف سأضيفهم ، لفترة وجيزة الآن - أسجل الوسيطة لزيادة عدادات المكالمات إلى أساليب api <div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">هنا الوسيطة</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AutoDiscoverRoutes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpContext context</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (context.Request.Path.Value == <span class="hljs-string"><span class="hljs-string">"/favicon.ico"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; keys = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; vals = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> routeData = context.GetRouteData(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (routeData != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { keys.AddRange(routeData.Values.Keys); vals.AddRange(routeData.Values.Values.Select(p =&gt; p.ToString())); } keys.Add(<span class="hljs-string"><span class="hljs-string">"method"</span></span>); vals.Add(context.Request.Method); keys.Add(<span class="hljs-string"><span class="hljs-string">"response"</span></span>); vals.Add(context.Response.StatusCode.ToString()); keys.Add(<span class="hljs-string"><span class="hljs-string">"url"</span></span>); vals.Add(context.Request.Path.Value); Program.Metrics.Measure.Counter.Increment(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CounterOptions { Name = <span class="hljs-string"><span class="hljs-string">"api"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//ResetOnReporting = true, // ,     MeasurementUnit = Unit.Calls, Tags = new MetricTags(keys.ToArray(), vals.ToArray()) }); }</span></span></code> </pre></div></div><br>  والمقاييس التي تم جمعها متوفرة في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http: // localhost: 9376 / metrics</a> <br><br><img src="https://habrastorage.org/webt/yc/-h/9n/yc-h9ndhal2nj4kgeablgor4oba.png"><br><br>  * يمكن تسجيل IMetricRoot أو تجريده بسهولة في الخدمات واستخدامه في التطبيق ( <i>services.AddMetrics (Program.Metrics) ؛</i> ) <br><br><a name="5"></a><h2 style=";text-align:right;direction:rtl">  جمع القياسات من خلال بروميثيوس </h2><br>  أبسط بروميثيوس الإعداد: إضافة وظيفة جديدة إلى التكوين الخاص به (prometheus.yml) وإطعامها هدف جديد: <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">global: scrape_interval: 15s evaluation_interval: 15s rule_files: <span class="hljs-comment"><span class="hljs-comment"># - "first.rules" # - "second.rules" scrape_configs: - job_name: prometheus static_configs: - targets: ['localhost:9090', '__:']</span></span></code> </pre> <br>  ولكن لدى بروميثيوس دعم محلي لجمع المقاييس من kubernetis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config</a> <br>  أرغب في مراقبة كل خدمة على حدة من خلال التطبيق: علامة تجارية <br>  بعد التعرف على الرصيف ، تكون المهمة كما يلي: <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">- job_name: business-metrics <span class="hljs-comment"><span class="hljs-comment">#     metrics_path: /metrics kubernetes_sd_configs: - role: endpoints #   .   service,pod,ingress static_configs: - targets: - localhost:9090 relabel_configs: #       default   c  apptype = business - action: keep regex: default;business source_labels: - __meta_kubernetes_namespace - __meta_kubernetes_service_label_apptype</span></span></code> </pre> <br>  في kubernetis هناك مكان خاص لتخزين ملفات التكوين - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ConfigMap</a> <br>  أنا احفظ هذا التكوين هناك: <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">2-بروميثيوس-configmap.yaml</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">apiVersion: v1 kind: ConfigMap <span class="hljs-comment"><span class="hljs-comment">#  ,   metadata: name: prometheus-config #  - namespace: default labels: kubernetes.io/cluster-service: "true" addonmanager.kubernetes.io/mode: EnsureExists data: #     prometheus.yml: | global: scrape_interval: 5s # Default is every 1 minute. evaluation_interval: 5s # The default is every 1 minute. scrape_configs: - job_name: prometheus static_configs: - targets: - localhost:9090 - job_name: business-metrics #     metrics_path: /metrics kubernetes_sd_configs: - role: endpoints #   .   service,pod,ingress static_configs: - targets: - localhost:9090 relabel_configs: #       default   c  apptype = business - action: keep regex: default;business source_labels: - __meta_kubernetes_namespace - __meta_kubernetes_service_label_apptype</span></span></code> </pre></div></div><br>  رحيل إلى kubernetis <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl create -f .\2-prometheus-configmap.yaml</code> </pre> <br>  أنت الآن بحاجة إلى نشر prometheus مع ملف التكوين هذا <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">kubectl إنشاء -f. \ 3-الانتشار-prometheus.yaml</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">apiVersion: extensions/v1beta1 kind: Deployment metadata: name: prometheus namespace: default spec: replicas: 1 template: metadata: labels: app: prometheus-server spec: containers: - name: prometheus image: prom/prometheus args: - <span class="hljs-string"><span class="hljs-string">"--config.file=/etc/config/prometheus.yml"</span></span> - <span class="hljs-string"><span class="hljs-string">"--web.enable-lifecycle"</span></span> ports: - containerPort: 9090 volumeMounts: - name: prometheus-config-volume <span class="hljs-comment"><span class="hljs-comment">#    mountPath: /etc/config/ #     volumes: - name: prometheus-config-volume #     configMap: defaultMode: 420 name: prometheus-config #  - --- kind: Service apiVersion: v1 metadata: name: prometheus spec: selector: app: prometheus-server #    labels:app type: LoadBalancer #      ports: - protocol: TCP port: 9090 targetPort: 9090</span></span></code> </pre></div></div><br>  انتبه - لم يتم تحديد ملف prometheus.yml في أي مكان <br>  جميع الملفات التي تم تحديدها في الخريطة config تصبح ملفات في قسم prometheus-config-volume ، والتي يتم تحميلها في الدليل / etc / config / <br>  أيضا ، الحاوية لديه وسيطات بدء التشغيل مع المسار إلى التكوين <br>  --web.enable-lifecycle - يقول أنه يمكنك سحب POST / - / إعادة التحميل ، والتي ستطبق التكوينات الجديدة (مفيدة إذا تغير التكوين "على الطاير" ولا تريد إعادة تشغيل الحاوية) <br><br>  نشر فعلا <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl create -f .\3-deployment-prometheus.yaml</code> </pre> <br>  اتبع الخطوات الصغيرة وانتقل إلى العنوان <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http: // localhost: 9090 / أهداف</a> ، يجب أن تشاهد نقاط النهاية لخدمتك هناك <br><br><img src="https://habrastorage.org/webt/sz/vw/vg/szvwvg5evcq_gfbusz56mx1k-se.png"><br><br>  وفي الصفحة الرئيسية ، يمكنك كتابة الطلبات إلى بروميثيوس <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">sum by (response, action, url, app) (delta(application_api[15s]))</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">شريطة أن يقوم شخص ما بزيارة الموقع ، فسوف يتحول مثل هذا</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pq/gl/ss/pqglssktt2mud6b2i1nltnqptou.png"><br></div></div><br>  لغة الاستعلام - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://prometheus.io/docs/prometheus/latest/querying/basics/</a> <br><br><a name="6"></a><h2 style=";text-align:right;direction:rtl">  عرض المقاييس في غرافانا </h2><br>  كنا محظوظين - حتى الإصدار 5 ، يمكن فقط تهيئات لوحة المعلومات من خلال واجهة برمجة تطبيقات HTTP ، ولكن الآن يمكنك القيام بنفس الخدعة كما هو الحال مع Prometeus <br>  يمكن لـ Grafana افتراضيًا عند بدء التشغيل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">سحب ما يصل إلى</a> مصدر بيانات <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التكوينات</a> ولوحات المعلومات <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>/etc/grafana/provisioning/datasources/</code> - التكوينات المصدر (إعدادات للوصول إلى prometeus ، postgres ، zabbiks ، مرنة ، وما إلى ذلك) </li><li style=";text-align:right;direction:rtl">  <code>/etc/grafana/provisioning/dashboards/</code> - إعدادات وصول إلى <code>/etc/grafana/provisioning/dashboards/</code> </li><li style=";text-align:right;direction:rtl">  <code>/var/lib/grafana/dashboards/</code> - هنا سأقوم بتخزين لوحات المعلومات بأنفسهم في شكل ملفات json </li></ol><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">اتضح مثل هذا</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">apiVersion: v1 kind: ConfigMap metadata: creationTimestamp: null name: grafana-provisioning-datasources namespace: default data: all.yml: | datasources: - name: <span class="hljs-string"><span class="hljs-string">'Prometheus'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: <span class="hljs-string"><span class="hljs-string">'prometheus'</span></span> access: <span class="hljs-string"><span class="hljs-string">'proxy'</span></span> org_id: 1 url: <span class="hljs-string"><span class="hljs-string">'http://prometheus:9090'</span></span> is_default: <span class="hljs-literal"><span class="hljs-literal">true</span></span> version: 1 editable: <span class="hljs-literal"><span class="hljs-literal">true</span></span> --- apiVersion: v1 kind: ConfigMap metadata: creationTimestamp: null name: grafana-provisioning-dashboards namespace: default data: all.yml: | apiVersion: 1 providers: - name: <span class="hljs-string"><span class="hljs-string">'default'</span></span> orgId: 1 folder: <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: file disableDeletion: <span class="hljs-literal"><span class="hljs-literal">false</span></span> updateIntervalSeconds: 10 <span class="hljs-comment"><span class="hljs-comment">#how often Grafana will scan for changed dashboards options: path: /var/lib/grafana/dashboards --- apiVersion: v1 kind: ConfigMap metadata: creationTimestamp: null name: grafana-dashboards namespace: default data: service-http-requests.json: | { "annotations": { "list": [ { "builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations &amp; Alerts", "type": "dashboard" } ] }, "editable": true, "gnetId": null, "graphTooltip": 0, "links": [], "panels": [ { "aliasColors": {}, "bars": false, "dashLength": 10, "dashes": false, "fill": 1, "gridPos": { "h": 9, "w": 12, "x": 0, "y": 0 }, "id": 2, "legend": { "alignAsTable": false, "avg": false, "current": false, "max": false, "min": false, "rightSide": true, "show": true, "total": false, "values": false }, "lines": true, "linewidth": 1, "links": [], "nullPointMode": "null", "percentage": false, "pointradius": 5, "points": false, "renderer": "flot", "seriesOverrides": [], "spaceLength": 10, "stack": false, "steppedLine": false, "targets": [ { "expr": "sum by (response, action, url, app) (delta(application_api[15s]))", "format": "time_series", "interval": "15s", "intervalFactor": 1, "legendFormat": "{{app}} {{response}} - {{url}}", "refId": "A" } ], "thresholds": [], "timeFrom": null, "timeRegions": [], "timeShift": null, "title": "Http requests", "tooltip": { "shared": true, "sort": 0, "value_type": "individual" }, "type": "graph", "xaxis": { "buckets": null, "mode": "time", "name": null, "show": true, "values": [] }, "yaxes": [ { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true }, { "format": "short", "label": null, "logBase": 1, "max": null, "min": null, "show": true } ], "yaxis": { "align": false, "alignLevel": null } } ], "refresh": "5s", "schemaVersion": 16, "style": "dark", "tags": [], "templating": { "list": [] }, "time": { "from": "now-30m", "to": "now" }, "timepicker": { "refresh_intervals": [ "5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d" ], "time_options": [ "5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d" ] }, "timezone": "", "title": "Business metrics", "uid": "Dm0tD0Qik", "version": 1 }</span></span></code> </pre> </div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">نشر نفسها ، لا شيء جديد</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">apiVersion: extensions/v1beta1 kind: Deployment metadata: name: grafana namespace: default labels: app: grafana component: core spec: replicas: 1 template: metadata: labels: app: grafana component: core spec: containers: - image: grafana/grafana name: grafana imagePullPolicy: IfNotPresent resources: limits: cpu: 100m memory: 100Mi requests: cpu: 100m memory: 100Mi env: - name: GF_AUTH_BASIC_ENABLED value: <span class="hljs-string"><span class="hljs-string">"true"</span></span> - name: GF_AUTH_ANONYMOUS_ENABLED value: <span class="hljs-string"><span class="hljs-string">"true"</span></span> - name: GF_AUTH_ANONYMOUS_ORG_ROLE value: Admin readinessProbe: httpGet: path: /login port: 3000 <span class="hljs-comment"><span class="hljs-comment"># initialDelaySeconds: 30 # timeoutSeconds: 1 volumeMounts: - name: grafana-provisioning-datasources mountPath: /etc/grafana/provisioning/datasources/ - name: grafana-provisioning-dashboards mountPath: /etc/grafana/provisioning/dashboards/ - name: grafana-dashboards mountPath: /var/lib/grafana/dashboards/ volumes: - name: grafana-provisioning-datasources configMap: defaultMode: 420 name: grafana-provisioning-datasources - name: grafana-provisioning-dashboards configMap: defaultMode: 420 name: grafana-provisioning-dashboards - name: grafana-dashboards configMap: defaultMode: 420 name: grafana-dashboards nodeSelector: beta.kubernetes.io/os: linux --- apiVersion: v1 kind: Service metadata: name: grafana namespace: default labels: app: grafana component: core spec: type: LoadBalancer ports: - protocol: TCP port: 3000 targetPort: 3000 selector: app: grafana component: core</span></span></code> </pre> </div></div><br>  توسيع <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl create -f .\4-grafana-configmap.yaml kubectl create -f .\5-deployment-grafana.yaml</code> </pre> <br>  تذكر أن العنب لا يرتفع على الفور ، بل هو مبلل قليلا من الهجرات sqlite ، والتي يمكنك أن <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=http://localhost:8001/api/v1/namespaces/kube-system/services/">ترى في سجلات</a> <br>  اذهب الآن إلى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http: // localhost: 3000 /</a> <br>  وانقر على لوحة القيادة <br><br><img src="https://habrastorage.org/webt/-s/qu/vp/-squvpxh7r3uxz75j3oripxch_8.png"><br><img src="https://habrastorage.org/webt/pl/yp/ze/plypzemdf5a1z0lpshu6uli3tyi.png"><br><br>  إذا كنت ترغب في إضافة طريقة عرض جديدة أو تغيير طريقة عرض حالية - قم بتغييرها مباشرة في الواجهة ، ثم انقر فوق حفظ ، ستحصل على نافذة مشروطة مع json ، والتي تحتاج إلى وضعها في خريطة التكوين <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">يتم نشر كل شيء ويعمل بشكل رائع</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/go/id/tl/goidtlbneravv92p6g-4mkeonro.png"></div></div><br><a name="7"></a><h2 style=";text-align:right;direction:rtl">  المهام المجدولة </h2><br>  لأداء المهام على التاج في cuber ، هناك مفهوم CronJob <br>  مع CronJob ، يمكنك تعيين جدول زمني لأي مهمة ، أبسط مثال: <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># https://kubernetes.io/docs/tasks/job/automated-tasks-with-cron-jobs/ apiVersion: batch/v1beta1 kind: CronJob metadata: name: runapijob spec: schedule: "*/1 * * * *" jobTemplate: spec: template: spec: containers: - name: runapijob image: busybox args: - /bin/sh - -c - date; wget -O - http://metricsdemo:9376/api/job/run/wakeUp &gt; /dev/null restartPolicy: OnFailure</span></span></code> </pre> <br>  قسم الجدول الزمني يحدد القاعدة الكلاسيكية للتاج <br>  يبدأ المشغل قرنة الحاوية (busybox) التي أسحب فيها طريقة api لخدمة metricsdemo <br>  يمكنك استخدام الأمر لتتبع المهمة. <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl.exe get cronjob runapijob --watch</code> </pre> <br><img src="https://habrastorage.org/webt/vt/1y/9v/vt1y9vjfhpygkk3xzokbywcbvnc.png"><br><br>  يتم إطلاق الخدمة الرئيسية التي تنطلق من الوظيفة في العديد من الحالات ، لأن الاتصال بالخدمة يذهب إلى أحد الموقد مع انتشار منتظم تقريبًا <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">كيف يبدو في بروميثيوس</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/hu/v2/tt/huv2ttrdtjee5ddvgxyk4ucwkou.png"></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">من أجل تصحيح المهمة ، يمكنك التشغيل يدويًا</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ev/k2/c7/evk2c7bl5zdr4gdqf1jcwvddu_w.png"></div></div><br>  عرض توضيحي صغير على سبيل المثال لحساب عدد π ، حول الفرق في عمليات الإطلاق من وحدة التحكم <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,       -      kubectl run pi --image=perl -- perl -Mbignum=bpi -wle 'print bpi(2000)' #   . , ,  .   -   kubectl run pi --image=perl --restart=OnFailure -- perl -Mbignum=bpi -wle 'print bpi(2000)' #    5  kubectl run pi --image=perl --restart=OnFailure --schedule="0/5 * * * ?" -- perl -Mbignum=bpi -wle 'print bpi(2000)'</span></span></code> </pre> <br><br><a name="8"></a><h2 style=";text-align:right;direction:rtl">  خطأ التسامح </h2><br>  إذا تم إنهاء التطبيق بشكل غير متوقع ، تتم إعادة تشغيل نظام المجموعة <br>  على سبيل المثال ، لقد تقدمت بطريقة تسقط api <br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HttpGet(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"kill/me"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Kill</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Selfkill"</span></span>); }</code> </pre> <br>  <i>* الاستثناء الذي حدث في api في طريقة الفراغ غير المتزامن يعتبر استثناء غير معالَج ، والذي يعطل التطبيق بالكامل</i> <br><br>  أناشد نداء إلى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http: // localhost: 9376 / api / job / kill / me</a> <br>  تظهر قائمة الموقد أنه قد تمت إعادة تشغيل أحد مآخذ الخدمة <br><br><img src="https://habrastorage.org/webt/f9/qr/t3/f9qrt3v1y1oo1ks2bucvt5tarvi.png"><br><br>  يعرض أمر السجلات المخرجات الحالية ، وباستخدام الخيار -p سيعرض سجلات المثيل السابق.  بهذه الطريقة يمكنك معرفة سبب إعادة التشغيل. <br><br>  أعتقد بسقوط بسيط ، كل شيء واضح: سقط - وردة <br><br>  لكن يمكن أن يكون التطبيق مباشرًا على نحو مشروط ، أي  لا تسقط ، ولكن لا تفعل أي شيء ، أو القيام بعمله ، ولكن ببطء <br><br>  وفقًا <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">للوثائق ،</a> هناك نوعان على الأقل من اختبارات "البقاء على قيد الحياة" للتطبيقات الموجودة في السنفات <br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الاستعداد - يستخدم هذا النوع من التحقق لفهم ما إذا كان من الممكن بدء حركة المرور على هذا الملف.  إذا لم يكن الأمر كذلك ، يتم تحرير الجراب حتى يعود إلى طبيعته. <br></li><li style=";text-align:right;direction:rtl">  حيوية - التحقق من التطبيق "من أجل البقاء".  على وجه الخصوص ، إذا لم يكن هناك وصول إلى مورد حيوي أو إذا لم يستجب التطبيق على الإطلاق (على سبيل المثال ، حالة توقف تام وبالتالي مهلة) ، فسيتم إعادة تشغيل الحاوية.  جميع رموز المتشعب بين 200 و 400 تعتبر ناجحة ، والباقي تفشل <br></li></ol><br>  سوف أتحقق من إعادة التشغيل بحلول المهلة المحددة ، لذلك سأضيف طريقة api جديدة ، والتي وفقًا لأمر معين ستبدأ في إبطاء طريقة التحقق من البقاء لمدة 123 ثانية <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> deadlock; [HttpGet(<span class="hljs-string"><span class="hljs-string">"alive/{cmd}"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Kill</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cmd</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmd == <span class="hljs-string"><span class="hljs-string">"deadlock"</span></span>) { deadlock = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Deadlocked"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (deadlock) Thread.Sleep(<span class="hljs-number"><span class="hljs-number">123</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deadlock ? <span class="hljs-string"><span class="hljs-string">"Deadlocked!!!"</span></span> : <span class="hljs-string"><span class="hljs-string">"Alive"</span></span>; }</code> </pre> <br><br>  أقوم بإضافة قسمين إلى ملف 1-الانتشار-app.yaml في الحاوية: <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">containers: - name: metricsdemo image: localhost:5000/sansys/metricsdemo3:6 ports: - containerPort: 80 readinessProbe: <span class="hljs-comment"><span class="hljs-comment">#       httpGet: path: /health port: 80 initialDelaySeconds: 5 periodSeconds: 5 livenessProbe: #      httpGet: path: /api/job/alive/check port: 80 initialDelaySeconds: 5 periodSeconds: 5</span></span></code> </pre> <br>  Redeply ، أنا متأكد من أن التطبيق قد بدأ والاشتراك في الأحداث <br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">kubectl get events --watch</code> </pre> <br>  أضغط على القائمة Deadlock me ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http: // localhost: 9376 / api / job / alive / deadlock</a> ) <br><br><img src="https://habrastorage.org/webt/ed/ir/bb/edirbbiw3gjjoptubdh7992z6yy.png"><br><br>  وخلال خمس ثوان أبدأ في ملاحظة المشكلة وحلها <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">1s Warning Unhealthy Pod Liveness probe failed: Get http://10.1.0.137:80/api/job/alive/check: net/http: request canceled (Client.Timeout exceeded <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> awaiting headers) 1s Warning Unhealthy Pod Liveness probe failed: Get http://10.1.0.137:80/api/job/alive/check: net/http: request canceled (Client.Timeout exceeded <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> awaiting headers) 0s Warning Unhealthy Pod Liveness probe failed: Get http://10.1.0.137:80/api/job/alive/check: net/http: request canceled (Client.Timeout exceeded <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> awaiting headers) 0s Warning Unhealthy Pod Readiness probe failed: Get http://10.1.0.137:80/health: dial tcp 10.1.0.137:80: connect: connection refused 0s Normal Killing Pod Killing container with id docker://metricsdemo:Container failed liveness probe.. Container will be killed and recreated. 0s Normal Pulled Pod Container image <span class="hljs-string"><span class="hljs-string">"localhost:5000/sansys/metricsdemo3:6"</span></span> already present on machine 0s Normal Created Pod Created container 0s Normal Started Pod Started container</code> </pre> <br><br><a name="9"></a><h2 style=";text-align:right;direction:rtl">  الاستنتاجات </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  من ناحية ، تبين أن حد الدخول أقل بكثير مما كنت أعتقد ، من ناحية أخرى ، فهو ليس كتلة kubernetes حقيقية على الإطلاق ، ولكن فقط كمبيوتر مطور.  ولم يتم النظر في القيود المفروضة على الموارد ، والتطبيقات الحكومية ، واختبار a / b ، وما إلى ذلك. </li><li style=";text-align:right;direction:rtl">  جربت بروميتوس ذلك للمرة الأولى ، لكن قراءة مختلف الوثائق والأمثلة خلال مراجعة cuber أوضحت أنه من الجيد جدًا جمع المقاييس من المجموعة والتطبيقات </li><li style=";text-align:right;direction:rtl">  إنه جيد جدًا لدرجة أنه يسمح للمطور بتنفيذ ميزة على جهاز الكمبيوتر الخاص به وإرفاقها ، بالإضافة إلى المعلومات المتعلقة بالنشر ، ونشر الجدول الزمني في graphan.  ونتيجة لذلك ، فإن المقاييس الجديدة تلقائيًا دون إضافية.  ستبدأ الجهود ليتم عرضها على خشبة المسرح وهمز.  مريحة </li></ol><br><br><a name="10"></a><h2 style=";text-align:right;direction:rtl">  ملاحظات </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يمكن للتطبيقات الاتصال ببعضها البعض من خلال <code> :</code> ، وهو ما تم مع grafana → prometeus.  بالنسبة لأولئك المطلعين على عامل الميناء ، لا يوجد شيء جديد </li><li style=";text-align:right;direction:rtl">  <code>kubectl create -f file.yml</code> - إنشاء كيان </li><li style=";text-align:right;direction:rtl">  <code>kubectl delete -f file.yml</code> - حذف كيان </li><li style=";text-align:right;direction:rtl">  <code>kubectl get pod</code> - الحصول على قائمة بجميع الموقد (الخدمة ، نقاط النهاية ...) <ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  - مساحة الاسم <code>--namespace=kube-system</code> - التصفية حسب مساحة الاسم </li><li style=";text-align:right;direction:rtl">  <code>-n kube-system</code> - بالمثل </li></ul></li><li style=";text-align:right;direction:rtl">  <code>kubectl -it exec grafana-d8d4d9f5c-cvnkh -- /bin/bash</code> - مرفق في القاع </li><li style=";text-align:right;direction:rtl">  <code>kubectl delete service grafana</code> - حذف الخدمة ، جراب.  نشر (- جميع - حذف الكل) </li><li style=";text-align:right;direction:rtl">  <code>kubectl describe</code> - وصف الكيان (يمكنك القيام به في وقت واحد) </li><li style=";text-align:right;direction:rtl">  <code>kubectl edit service metricsdemo</code> - تحرير جميع yamls على الطاير من خلال إطلاق المفكرة <div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">عرض</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/xh/nc/c2/xhncc23bokunuyqam3ekkntdxrw.png"></div></div></li><li style=";text-align:right;direction:rtl">  <code>kubectl --help</code> - <code>kubectl --help</code> - <code>kubectl --help</code> كبيرة) </li><li style=";text-align:right;direction:rtl">  المشكلة النموذجية هي وجود جراب (ضع في اعتبارك الصورة قيد التشغيل) ، حدث خطأ ما ولا توجد خيارات ، باستثناء أنه لا توجد طريقة لتصحيح الأخطاء في الداخل (عبر tcpdump / nc وما إلى ذلك).  - Yuzai kubectl-debug <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">habr.com/ar/company/flant/blog/436112</a> <br></li></ol><br><br><a name="11"></a><h2 style=";text-align:right;direction:rtl">  المراجع </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ما هي مقاييس التطبيق؟</a> </li><li style=";text-align:right;direction:rtl">  Kubernetes <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes نشر البرنامج التعليمي للمبتدئين</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">عمليات النشر</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تشغيل تطبيق عديمي الجنسية باستخدام نشر</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ما هو ConfigMap</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">كرونوب</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">السبر تحقيقات الاستعداد</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ورقة الغش kubectl</a> </li></ul></li><li style=";text-align:right;direction:rtl">  بروميثيوس <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لغة الاستعلام</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التكوين Prometeus ل Coober</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">جهاز وآلية عمل مشغل بروميثيوس في Kubernetes</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التكوين مسبقا grafana</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لمعرفة كيف يفعل الناس</a> (ولكن هناك بالفعل بعض الأشياء التي عفا عليها الزمن) - هناك ، من حيث المبدأ ، هناك أيضا حول التسجيل ، والتنبيهات ، الخ </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Helm</a> - مدير الحزم في Kubernetes - من خلاله ، كان من السهل تنظيم prometeus + grafana ، لكن يدويًا - يظهر المزيد من التفاهم </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مكعبات بروميثيوس من كوبر</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">قصص فشل Kubernetes</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes-HA.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">نشر نظام تجاوز الفشل Kubernetes مع 5 المعالجات</a> </li></ol><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://github.com/favicon.ico" width="22"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">شفرة المصدر والمربيات المتاحة على جيثب</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar437286/">https://habr.com/ru/post/ar437286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar437274/index.html">رؤية نحو الملاحظة في الممارسة</a></li>
<li><a href="../ar437276/index.html">مصابيح الطاولة Remilicht مع المصابيح Sunlike</a></li>
<li><a href="../ar437280/index.html">من السهل القيام به بنفسك اللوجستية</a></li>
<li><a href="../ar437282/index.html">مقدمة إلى Kubernetes لمستخدمي VMware. الجزء 2. الممارسة</a></li>
<li><a href="../ar437284/index.html">المهن حديقة الحيوان المتعلقة بصناعة الصوت</a></li>
<li><a href="../ar437292/index.html">لماذا نموذج متجر التجزئة التقليدي قد مات بالفعل</a></li>
<li><a href="../ar437296/index.html">لماذا لا يستخدم الناس الأساليب الرسمية؟</a></li>
<li><a href="../ar437298/index.html">عن شخص واحد</a></li>
<li><a href="../ar437300/index.html">10 المهارات والمعرفة اللازمة للمطور مبتدئ دائرة الرقابة الداخلية</a></li>
<li><a href="../ar437304/index.html">كيفية شراء البطاطا إذا كنت مصابًا بالعمى</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>