<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∏üèΩ üçÑ üí¢ Jeu 3D sur three.js, nw.js üèôÔ∏è üàÅ üèÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="J'ai d√©cid√© de sortir une nouvelle version de mon ancien jeu par navigateur, qui depuis quelques ann√©es a √©t√© une application r√©ussie sur les r√©seaux ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jeu 3D sur three.js, nw.js</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450926/"> J'ai d√©cid√© de sortir une nouvelle version de mon ancien jeu par navigateur, qui depuis quelques ann√©es a √©t√© une application r√©ussie sur les r√©seaux sociaux.  Cette fois, j'ai d√©cid√© de le concevoir √©galement comme une application pour Windows (7-8-10) et de le placer dans divers magasins.  Bien s√ªr, √† l'avenir, vous pourrez cr√©er des assemblages pour MacOS et Linux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1c/tj/vi/1ctjvijgbjodkdjhwszw4atwgvm.jpeg"></div><br>  Le code du jeu est enti√®rement √©crit en javascript pur.  Pour afficher des graphiques 3D, la biblioth√®que three.js est utilis√©e comme lien entre le script et WebGL.  Cependant, c'√©tait le cas dans l'ancienne version du navigateur.  La chose la plus importante dans ce projet pour moi √©tait la raison, en parall√®le avec le jeu, d'ajouter ma propre biblioth√®que, con√ßue pour compl√©ter three.js avec les outils pour un travail pratique avec les objets de la sc√®ne, leur animation et de nombreuses autres fonctionnalit√©s.  Je l'ai ensuite abandonn√© pendant longtemps.  Il est temps de revenir vers elle. <br><a name="habracut"></a><br><br>  Ma biblioth√®que contient des outils pratiques pour ajouter et supprimer des objets de la sc√®ne, changer les propri√©t√©s de parties individuelles d'objets (maillages), une animation ind√©pendante du cadre du mouvement des objets 3D, un nuanceur de ciel avec la texture du ciel √©toil√© la nuit et bien plus encore.  Je vais vous parler de certains d'entre eux.  En ce qui concerne le ciel, j'ai impl√©ment√© sa cr√©ation avec une seule fonction qui prend un certain nombre de param√®tres d'entr√©e, initialise le shader, charge la texture du nuage (si n√©cessaire) et commence √† mettre √† jour le ciel avec une it√©ration donn√©e. <br><br>  Cependant, tout y est un peu plus compliqu√© - pour les fonctions p√©riodiques, mais rarement appel√©es, une autre construction fonctionne r√©ellement, en utilisant setInterval (), dans laquelle les √©v√©nements peuvent √™tre lanc√©s √† diff√©rents intervalles, et cela r√©duira tout cela √† un d√©nominateur commun et le calculera √† droite √©v√©nements n√©cessaires sur la liste.  L√†, vous pouvez √©galement lancer l'intervalle de mise √† jour du ciel.  Mais le mouvement des objets de jeu 3D pour plus de fluidit√© a d√©j√† √©t√© impl√©ment√© via requestAnimationFrame () ... <br><br>  Donc, puisque nous parlons du ciel, nous allons commencer par lui. <br><br><h3>  Le ciel </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ge/xw/da/gexwday-od32dav2p4gb48p1nme.jpeg"></div><br>  Ajouter le firmament √† la sc√®ne est le suivant. <br><br>  Vous devez d'abord ajouter la lumi√®re standard three.js √† la sc√®ne avec ses valeurs de luminosit√© maximales (initiales).  La sc√®ne enti√®re avec ses objets, sa lumi√®re et d'autres attributs, afin de ne pas encombrer l'espace global, sera stock√©e dans l'espace de noms apscene. <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  (AmbLight)   apscene.AmbLight=new THREE.AmbientLight(0xFFFFFF); apscene.scene.add(apscene.AmbLight); //  (AmbLightBk)   (      ) apscene.AmbLightBk=new THREE.AmbientLight(0xFFFFFF); apscene.sceneb.add(apscene.AmbLightBk); // (, )   var SFog=new THREE.FogExp2(0xaaaaaa, 0.0007); apscene.scene.fog=SFog; // (, )   var SFogBk=new THREE.FogExp2(0xa2a2aC, 0.0006); apscene.sceneb.fog=SFogBk; //  apscene.hemiLight=new THREE.HemisphereLight(0xFFFFFF, 0x999999, 1); apscene.scene.add(apscene.hemiLight); //        .       .        three.js   ,   ,     ,  ,   ... apscene.dirLight=new THREE.DirectionalLight(...) apscene.dirLightBk=new THREE.DirectionalLight(...)</span></span></code> </pre> <br>  Apr√®s cela, vous pouvez d√©j√† ex√©cuter l'animation du ciel avec des shaders, des textures (blackjack et ... enfin, d'accord) √† travers l'une de mes fonctions: <br><br><pre> <code class="javascript hljs">m3d.graph.skydom.initWorld( <span class="hljs-comment"><span class="hljs-comment">//  ,  ,         {saveStart:false}, { //ltamb (light ambient,    ) -       ltamb:{a1:-2, a2:8, k1:0.2, k2:0.75, obj:[ {obj:apscene.AmbLight.color, key:['r','g','b']} ]}, //a1  a2 -      (altitude,      ),     ,   obj,     (k1..k2),   k1  k2 -         // ,    ltamb :     -2  8 (    ),    (apscene.AmbLight.color),    r, g  b,    0.2  0.75     ( ,    ,    0xFFFFFF). //key -    ,        three.js //        (apscene.AmbLightBk.color).    (  altitude)  -4  12          0.3 ... 0.99    .  -4 , ,    0.3  ,   12   0.99   ltambb:{a1:-4, a2:12, k1:0.3, k2:0.99, obj:[ {obj:apscene.AmbLightBk.color, key:['r','g','b']} ]}, //      : ltdir:{a1:-2, a2:8, k1:0.0, k2:1, obj:[ {obj:apscene.dirLight, key:['intensity']}, {obj:apscene.dirLightBk, key:['intensity']} ]}, //       (apscene.dirLightBk)   ,    ,       . // ,      three.js    - inensity ( , apscene.dirLight.intensity).  ,  ,       three.js    . //  .   ,     ( 0.15  )     12  8 (, ,    8  12), : lthem:{a1:8, a2:12, k1:0.15, k2:0.3, obj:[ {obj:apscene.hemiLight, key:['intensity']} ]}, //         .       . //    ()   : ltambfog:{a1:-2, a2:8, k1:0.4, k2:1, obj:[ {obj:apscene.scene.fog.color, key:['r','g','b']} ]}, //  : ltambbfog:{a1:-2, a2:12, k1:0.25, k2:1, obj:[ {obj:apscene.sceneb.fog.color, key:['r','g','b']} ]}, //     .  ,         ,  . ltambfogd:{a1:8, a2:12, k1:0.2, k2:0.35, obj:[ {obj:apscene.scene.fog, key:['density']} ]}, //  ltambbfogd:{a1:6, a2:12, k1:0.2, k2:0.28, obj:[ {obj:apscene.sceneb.fog, key:['density']} ]}, //  ,      ( ,   ),   ,     ,   , -¬´¬ª     ,      skyplane1..6: planeAmb:{a1:-5, a2:12, k1:0.5, k2:1.0, obj:[ {obj:apscene.user.skyplane1.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane2.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane3.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane4.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane5.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane6.material.color, key:['r','g','b']} ]} //,     ,     ,  . };</span></span></code> </pre> <br>  En cons√©quence, un ciel dynamique appara√Æt sur la sc√®ne avec un changement en douceur de la hauteur du soleil et, par cons√©quent, un changement de l'heure de la journ√©e. <br><br>  Il n'est pas n√©cessaire d'utiliser tous les types d'√©clairage sur sc√®ne.  Et il n'est pas n√©cessaire de modifier tous les param√®tres en fonction de l'heure de la journ√©e.  Mais, en jouant avec leur luminosit√©, vous pouvez n√©anmoins cr√©er une image assez r√©aliste du changement de jour et de nuit.  Vous pouvez nommer les param√®tres comme vous le souhaitez, l'essentiel est d'observer les cl√©s des objets √† l'int√©rieur comme ils sont sp√©cifi√©s dans three.js. <br><br>  √Ä quoi cela ressemble, vous pouvez voir la vid√©o de la sc√®ne de d√©monstration: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/PoAPy3ByPRU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  C'est un jeu diff√©rent.  C'est juste que l'horizon n'est pas encombr√© de divers objets, et donc le travail de ce script est le plus clairement visible.  Mais dans le jeu dont l'histoire est discut√©e, exactement la m√™me approche est utilis√©e.  La vitesse √©lev√©e du passage du temps ici n'est r√©gl√©e qu'√† des fins de d√©monstration, et donc le temps s'√©coule, bien s√ªr, plus lentement, avec la m√™me √©tape de l'it√©ration mettant √† jour le firmament.  Dans cette d√©mo, au fait, un shader d'eau est impliqu√©, √©galement avec des param√®tres variables, en fonction de la hauteur du soleil ... Mais je ne l'ai pas encore finalis√©. <br><br><h3>  Performances </h3><br>  Tout cela demande tr√®s peu de fer.  Fonctionnant dans le navigateur Chrome, il charge le Xeon E5440 sous LGA775 (et avec 4 Go de RAM) de 20%, et le c≈ìur de la carte graphique GT730 de 45%.  Mais cela est uniquement d√ª √† l'animation de l'eau.  Si nous parlons d'un jeu o√π il n'y a pas d'eau, mais il y a une ville, celle-ci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0i/_k/se/0i_ksepjxwtge9qffnonerlnkes.jpeg"></div><br>  puis au moment o√π la voiture se d√©place dans la ville - 45% pour cent, 50% pour la carte vid√©o.  En principe, avec un certain fps (jusqu'√† environ 30 images par seconde), cela fonctionne assez bien m√™me sur Pentium4 3GHz (1 Go de RAM) et sur une tablette sur Intel Atom 1,3 GHz (2 Go de RAM). <br><br>  Tout ce mat√©riel est extr√™mement faible et d'autres jeux similaires sur WebGL et sur HTML5, m√™me certains 2D, √ßa me ralentit impie, au point qu'il devient impossible de les jouer.  Comme on dit, √©crivez le jeu vous-m√™me, selon vos besoins, et jouez. <br><br><h3>  Sc√®ne </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/zo/y1/jbzoy1gm1aomyfdgyp7udkziole.jpeg"></div><br>  La sc√®ne 3D dans three.js est un objet de sc√®ne et son tableau d'enfants est, en fait, tous les mod√®les 3D charg√©s dans la sc√®ne.  Afin de ne pas enregistrer un appel de chargeur de d√©marrage pour chaque mod√®le, j'ai d√©cid√© que la sc√®ne de jeu enti√®re serait d√©finie sous la forme d'une certaine configuration, avec un grand tableau associatif locd: {} (comme les donn√©es de localisation), qui contiendrait tous les param√®tres - lumi√®res, chemins des textures pr√©charg√©es et des images pour l'interface, des chemins vers tous les mod√®les qui devraient √™tre charg√©s sur la sc√®ne, et plus encore.  En g√©n√©ral, c'est la configuration compl√®te de la sc√®ne.  Il est d√©fini une fois dans le fichier js du jeu et envoy√© √† mon chargeur de sc√®ne. <br><br>  Et cet objet locd: {}, en particulier, contient les chemins d'acc√®s aux mod√®les 3D individuels qui doivent √™tre charg√©s.  Le chemin z√©ro est le chemin commun, puis les chemins relatifs pour chaque objet, tels que: <br><pre> <code class="javascript hljs">[<span class="hljs-string"><span class="hljs-string">'path/myObj'</span></span>, scale, y, x,z, r*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>]</code> </pre> <br>  Il est entendu que tous les mod√®les sont export√©s de l'√©diteur 3D au format json, c'est-√†-dire qu'ils ont des chemins comme path / myObj.json.  Viennent ensuite l'√©chelle (puisque l'√©diteur peut √™tre enregistr√© avec une √©chelle qui ne convient pas au jeu), la position de l'objet en hauteur (y), le long des axes (x) et (z), puis l'angle de rotation ¬Æ du mod√®le en (y), un certain nombre de param√®tres optionnels et le nom de la sc√®ne o√π charger le mod√®le - sur la sc√®ne principale (sc√®ne) ou sur l'arri√®re-plan (sc√®neb). <br><br>  Oui, il fallait l'impl√©menter non pas sous la forme d'un simple, mais sous la forme d'un tableau associatif.  Donc, l'ordre des param√®tres est incompr√©hensible m√™me sans documentation, ou du moins sans le type de fonction qui prend ces param√®tres, vous ne comprendrez pas.  Je pense qu'√† l'avenir je vais refaire ces lignes dans des tableaux associatifs.  En attendant, cela ressemble √† ceci: <br><pre> <code class="javascript hljs">landobj: [ [<span class="hljs-string"><span class="hljs-string">'gamePath/'</span></span>], [ [<span class="hljs-string"><span class="hljs-string">'landscape/ground'</span></span>, <span class="hljs-number"><span class="hljs-number">9.455</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], [<span class="hljs-string"><span class="hljs-string">'landscape/plants'</span></span>, <span class="hljs-number"><span class="hljs-number">9.455</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI,<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], [<span class="hljs-string"><span class="hljs-string">'landscape/buildings/house01'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-420</span></span>,<span class="hljs-number"><span class="hljs-number">420</span></span>, <span class="hljs-number"><span class="hljs-number">-0.75</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], ... ] ],</code> </pre> <br>  Ces mod√®les sont charg√©s sur la sc√®ne et plac√©s dans les coordonn√©es donn√©es ici dans l'espace.  En principe, tous les mod√®les peuvent √™tre charg√©s en tant qu'objet unique, c'est-√†-dire export√©s de l'√©diteur sous forme de sc√®ne de jeu enti√®re et charg√©s en coordonn√©es (0; 0; 0).  Ensuite, il n'y aura qu'une seule ligne: paysage / sol - j'ai ground.json - c'est la partie principale du monde du jeu.  Mais dans ce cas, il sera difficile de manipuler des objets individuels de la sc√®ne, car vous devrez d'abord regarder dans la console du navigateur et vous rappeler lequel des enfants de cet immense terrain est.  Et puis contactez-les par num√©ros.  Par cons√©quent, les mod√®les de jeux itin√©rants sont mieux charg√©s avec des objets s√©par√©s.  Ensuite, ils sont accessibles par nom √† partir du tableau associatif, qui sera automatiquement cr√©√© sp√©cialement √† cet effet. <br><br>  La configuration compl√®te du jeu peut ressembler, par exemple, √† ceci: <br><pre> <code class="javascript hljs">locd:{ <span class="hljs-comment"><span class="hljs-comment">// name: 'SeaBattle', type: 'game', menulabel: '', //    x:-420, y:70, z:-420, rot: -0.5, //    intsdistance: 200, // ambLtColor: 0xFFFFFF, ambLtColorBk: 0xFFFFFF, lightD: [0xDDDDDD,0.3,1000, 200000,0.3,-0.0003, -190,200000,-140,0,0,0, 200,-200,200,-200], lightDBk: [0xFFFFFF,0.3,10000, 40000,0.3,-0.0035, -190,1200,-140,0,0,0, 50000,-50000,50000,-50000], lightH: [0xFFFFFF,0x999999,1, 0,500,0], //      lightsP: [], //     lightsPDynamicAr: [ [0xffffff, 4, [0, -2000, 0], [50, 1.5] ] //[[distance], [decay]] ], //         (x,y,z) userPointLights: [ [0, -2000, 0] ], //   lightsS: [ [0xffffbb, 1.0, [0, 250, 180], [0, 0, 180], 0.5, 600,600,600, -0.0005] ], //  shadowMapCullFace:0, shadowsMode: 'all', //all,list,flag //  imagePaths: [ 'game/img/', 'interface.png', 'interface2.png' ], // 3D  landobj: [ ['game/models/'], [ ['landscape/land',1, 0, 0,0, 0.0*Math.PI,1,'','','',1,['','','',''],'scene'], ['landscape/sbp',1, 0, 0,180, 1.0*Math.PI,1,'','','',1,['','','',''],'scene'], ['landscape/sbu',1, 0, 0,1120, 1.0*Math.PI,1,'','','',1,['','','',''],'scene'] ] ], //        staffobj: [ ['game/models2/'], [ ] ], //  progobj: [ [ ] ] },</span></span></code> </pre> <br>  Oui, il vaut mieux refaire tous ces sous-r√©seaux en tableaux associatifs, sinon l'ordre des param√®tres n'est pas clair ... <br><br><h3>  Mod√®les 3D </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fz/fm/ql/fzfmqlr4yfw3_tkm79xjwlb_ccw.jpeg"></div><br>  Une autre chose int√©ressante.  Chargement des mod√®les.  Ma biblioth√®que accepte les mod√®les 3D avec des textures et d√©finit automatiquement certains param√®tres sur leurs √©l√©ments individuels (mailles), en fonction des noms.  Le fait est que si, par exemple, le mod√®le est configur√© pour projeter une ombre, il sera projet√© par chaque maillage inclus dans sa composition.  Il n'est pas toujours n√©cessaire que l'ensemble du mod√®le projette une ombre compl√®te ou acqui√®re d'autres propri√©t√©s qui affectent fortement les performances.  Par cons√©quent, si vous activez un certain indicateur signalant qu'il est n√©cessaire de consid√©rer chaque maillage s√©par√©ment, alors lors du chargement, il est possible de d√©terminer quel maillage aura telle ou telle propri√©t√© et laquelle ne le sera pas.  Eh bien, par exemple, il n'est absolument pas n√©cessaire que l'ombre soit projet√©e par le toit horizontal plat de la maison ou par de nombreux d√©tails mineurs non pertinents du mod√®le sur un grand arri√®re-plan.  N√©anmoins, le lecteur ne pourra pas voir ces ombres et la puissance du processeur vid√©o sera utilis√©e pour les traiter. <br><br>  Pour ce faire, dans l'√©diteur graphique (Blender, Max, etc.), vous pouvez imm√©diatement sp√©cifier les noms des mailles (dans le champ du nom de l'objet) selon une certaine r√®gle.  Il doit y avoir un trait de soulignement (_).  Les caract√®res de contr√¥le conditionnel doivent aller sur le c√¥t√© gauche, par exemple: d - double face (le maillage est bidirectionnel, sinon - unidirectionnel), c (ombre port√©e) - projette une ombre, r (re√ßoit l'ombre) - prend des ombres.  Autrement dit, le nom du maillage de tuyau dans la maison peut √™tre cr_tube.  De nombreuses autres lettres sont √©galement utilis√©es.  Par exemple, "l" est un collisionneur, c'est-√†-dire que le mur de la maison, ayant le nom crl_wall01, ne permettra pas au joueur de passer √† travers lui-m√™me, et projette √©galement et prend une ombre.  Il n'est pas n√©cessaire de fabriquer des collisionneurs, comme un toit ou une poign√©e de porte, et donc de d√©grader les performances.  Comme vous l'avez d√©j√† compris, lors du chargement d'un mod√®le, ma biblioth√®que analyse les noms des maillages et leur donne les propri√©t√©s correspondantes sur la sc√®ne.  Mais pour cela il faut nommer correctement toutes les mailles avant d'exporter le mod√®le depuis l'√©diteur 3D.  Cela r√©duira consid√©rablement les performances. <br><br>  Tous les indicateurs de contr√¥le pour les maillages √† l'int√©rieur d'un objet: <br><blockquote>  col_ ... est le collisionneur.  Un tel maillage sera affich√© simplement comme un collisionneur transparent et invisible.  Dans l'√©diteur, il peut ressembler √† tout, seule sa forme est importante.  Par exemple, il peut s'agir d'un parall√©l√©pip√®de autour de l'ensemble du mod√®le s'il est n√©cessaire que le joueur ne puisse pas passer par ce mod√®le (b√¢timent, grosse pierre, etc.). <br><br>  l_ ... est un objet collidable.  Donner √† n'importe quel maillage une propri√©t√© de collision. <br><br>  i_ ... - intersections.  Le maillage sera ajout√© √† la liste des intersections, qui peut √™tre utilis√©, par exemple, pour cliquer dessus, c'est-√†-dire pour donner de l'interactivit√© au jeu. <br><br>  j_ ... aussi des intersections.  Le m√™me que ci-dessus, seulement une version plus r√©cente - avec un algorithme am√©lior√© pour trouver des intersections dans le jeu et moins de consommation de ressources. <br><br>  e_ ... - intersections pour les portes des maisons (entr√©e / sortie).  Exclut l'intersection sur les autres maillages d'objets.  Il est utilis√© s'il est n√©cessaire dans les maisons √† un moment donn√© de ne rendre interactives que les portes, √† l'exclusion de tous les autres √©l√©ments interactifs.  Avec l'imagination, vous pouvez trouver cela et une tonne d'autres utilisations. <br><br>  c_ ... - projette des ombres.  Le maillage projette une ombre. <br><br>  r_ ... - recevoir des ombres.  Un maillage accepte les ombres de toutes les autres mailles qui les ont projet√©es. <br><br>  d_ ... - bilat√©ral (double face).  Visible des deux c√¥t√©s, la texture se superpose des deux c√¥t√©s. <br><br>  t_ ... - transparent (transparent), si l'objet entier est d√©fini sur alphatest dans three.js. <br><br>  u_ ... - transparent (transparent), avec une densit√© fixe (0.4), si l'objet entier ne sp√©cifie pas alphatest dans three.js. <br><br>  g_ ... - verre.  La transparence fixe est d√©finie (0,2). <br><br>  h_ ... - invisible (cach√©).  Pour les parties de l'objet (maillages) qui doivent √™tre masqu√©es lors de l'ajout de l'objet √† la sc√®ne.  Entr√© dans la liste des cach√©s. <br><br>  v_ ... visible.  Tous les objets √† l'exception de ceux marqu√©s avec "h" sont d√©j√† visibles, mais avec le drapeau "v", ils sont entr√©s dans une liste s√©par√©e visible pour une dissimulation ult√©rieure ou d'autres manipulations. </blockquote><br>  Par cons√©quent, le nom du maillage pourrait bien √™tre quelque chose comme ceci: crltj_box1 (jette, accepte une ombre, collisionneur, transparent, interactif).  Et un autre maillage faisant partie du m√™me mod√®le: cr_box2 (ne transforme et ne prend que des ombres), Naturellement, les caract√®res de contr√¥le peuvent √™tre d√©finis dans n'importe quel ordre.  Ainsi, depuis l'√©diteur, vous pouvez contr√¥ler l'affichage futur de parties de l'objet dans le jeu, ou plut√¥t, certaines de leurs propri√©t√©s, tout en √©conomisant de la puissance de calcul. <br><br><h3>  L'essence du jeu </h3><br>  En fait, le sens du jeu dont parle l'histoire est de se d√©placer dans le p√©rim√®tre du terrain carr√© et d'acheter des entreprises.  Le champ est r√©alis√© sous forme de rues 3D.  Le mod√®le √©conomique du jeu est sensiblement diff√©rent de ceux du genre.  Dans mon jeu, lorsque quelqu'un d√©marre une entreprise, votre b√©n√©fice attendu baisse.  Et vice versa, lorsque vous d√©couvrez quelque chose, cela augmente.  Tous les calculs de profits et pertes sont effectu√©s dans l'inspection fiscale du champ D√©but.  Vous pouvez √©galement contracter un emprunt aupr√®s d'une banque, n√©gocier des titres et faire un certain nombre d'autres choses.  J'ai am√©lior√© le comportement de l'IA par rapport √† l'ancienne version.  Refonte de presque tous les mod√®les et textures 3D du jeu et performances optimis√©es.  Faites plus de r√©glages et bien plus encore. <br><br><h3>  L'animation </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lw/7u/m_/lw7um_phbrcpp-yx78ec5ihw9jy.jpeg"></div><br>  Pour animer le mouvement des objets du jeu, le moteur le plus simple est utilis√©, qui avec une fr√©quence d'images donn√©e (il est limit√© au 60e) modifie tous les param√®tres num√©riques pour un intervalle de temps donn√©, transmettant des valeurs interm√©diaires au gestionnaire.  Et dans le gestionnaire, par exemple, le mod√®le s'affiche. <br><br>  Par exemple.  Nous devons d√©placer l'objet obj dans l'espace de la position (10; 10; 50) au point (100; 300; 60).  Nous d√©finissons 3 param√®tres en indiquant leurs valeurs initiales et finales.  La coordonn√©e x variera de 10 √† 100, y - de 10 √† 300 et z - de 50 √† 60. Et tout cela devrait arriver, disons, en 4 secondes. <br><pre> <code class="javascript hljs">m3d.lib.anim.add( <span class="hljs-string"><span class="hljs-string">'moveobj'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4000</span></span>, <span class="hljs-string"><span class="hljs-string">'and'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">userpar1</span></span>:<span class="hljs-number"><span class="hljs-number">111</span></span>, <span class="hljs-attr"><span class="hljs-attr">obj</span></span>:my3DObject}, [ {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>} ], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ myPeriodicFun(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ myFinishFun(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } ); m3d.lib.anim.play();</code> </pre> <br>  La premi√®re ligne de 5 param√®tres: moveobj - nom de l'animation (n'importe laquelle), 1 - num√©ro de flux (vous pouvez animer des objets en parall√®le dans un nombre illimit√© de flux), 4000 - temps d'animation de 4 secondes, et - tandis qu'un param√®tre inutilis√©, qui sera √† l'avenir responsable de la logique de transition entre les animations dans le m√™me flux, userpar est tout tableau associatif qui sera transmis au gestionnaire en tant que param√®tre, par exemple, avec un rayon calcul√©, des sinus, des cosinus et g√©n√©ralement toutes les valeurs calcul√©es pour cette animation, afin de ne pas √™tre calcul√©es dans  sur le temps de chaque it√©ration.  Ou en r√©f√©rence √† un objet 3D qui, en fait, s'animera. <br><br>  Vient ensuite un tableau avec des param√®tres modifiables.  Nous constatons que le premier param√®tre est le changement de la coordonn√©e x, le second est y, le troisi√®me est z.  Nous √©crivons pour chacun en lim1 et lim2, de quoi et √† quelle taille cela va changer.  Dans sstart et sfin, nous sp√©cifions les m√™mes valeurs.  Ici, vous pouvez sp√©cifier un d√©but, par exemple, √† partir d'une autre valeur, puis le param√®tre ¬´d√©filera¬ª dans un cercle de celui-ci, en contournant lim2 et en commen√ßant une nouvelle ¬´r√©volution¬ª avec lim1.  Eh bien, par exemple, cela est n√©cessaire si notre animation est boucl√©e entre certaines valeurs (lim1 et lim2), mais nous devons la d√©marrer non pas depuis le d√©but (c'est-√†-dire pas depuis lim1), mais √† partir d'une valeur interm√©diaire. <br><br>  t: 0 d√©finit simplement que l'animation de ce param√®tre est ex√©cut√©e 1 fois, en fonction du temps total (4000), comme si elle y √©tait √©tir√©e.  Si nous fixons un autre nombre, inf√©rieur √† l'heure principale, alors ce param√®tre sera mis en boucle et sera r√©p√©t√© jusqu'√† l'heure de l'animation principale (4000).  C'est pratique, par exemple, pour d√©finir la rotation de l'objet lorsque l'angle doit traverser la ligne √† 360 degr√©s de mani√®re r√©p√©t√©e et √™tre remis √† 0. <br><br>  Viennent ensuite 2 rappels - celui qui sera ex√©cut√© √† chaque it√©ration et celui qui sera ex√©cut√© une fois √† la fin de toute l'animation (point de sortie). <br><br>  Le premier rappel myPeriodicFun (this), par exemple, peut √™tre comme ceci: <br><pre> <code class="javascript hljs">myPeriodicFun:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state=self.par[<span class="hljs-number"><span class="hljs-number">0</span></span>].state, state_old=self.par[<span class="hljs-number"><span class="hljs-number">0</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state2=self.par[<span class="hljs-number"><span class="hljs-number">1</span></span>].state, state_old2=self.par[<span class="hljs-number"><span class="hljs-number">1</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state3=self.par[<span class="hljs-number"><span class="hljs-number">2</span></span>].state, state_old3=self.par[<span class="hljs-number"><span class="hljs-number">2</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((state!=state_old)||(state2!=state_old2)||(state3!=state_old3)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj=self.userpar.obj; obj.position.x=state; obj.position.y=state2; obj.position.z=state3; ap.cameraFollowObj(obj); }; },</code> </pre> <br>  C'est-√†-dire qu'√† chaque it√©ration du mouvement, un param√®tre (self) est lanc√© dans cette fonction contenant les valeurs interm√©diaires calcul√©es pour tous les param√®tres d'animation donn√©s: self.par [0] .state, self.par [1] .state, self.par [2] .√©tat.  Ce sont nos x, y et z √† l'heure actuelle.  Par exemple, si l'animation dure 4 secondes, apr√®s 2 secondes, x sera √©gal √† (100-10) / 2 = 45. Et donc pour toutes les coordonn√©es.  En cons√©quence, dans myPeriodicFun, nous affichons simplement notre objet dans ces coordonn√©es.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le navigateur commence √† prendre du retard ou s‚Äôex√©cute lentement sur ce mat√©riel, cela ne fait pas peur: la dur√©e totale de l‚Äôanimation ne changera pas, seule la fr√©quence d‚Äôimages diminuera et l‚Äôimage se transformera en diaporama. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi v√©rifier f ((state! = State_old) ..., c'est-√†-dire si la nouvelle valeur calcul√©e est √©gale √† l'ancienne (state_old se souvient du calcul√© dans l'it√©ration pr√©c√©dente), eh bien, par exemple, de sorte que si certains param√®tres changent moins d'un, alors ne redessinez pas l'objet entier et ne d√©pensez pas la puissance du syst√®me dessus, et le moteur d'animation produit des entiers dans state et state_old, qui, par exemple, peuvent √™tre interpr√©t√©s comme un pas √©gal √† un pixel. Et si l'objet ne bouge pas par rapport √† la position pr√©c√©dente m√™me par 1 pixel, il n'est pas n√©cessaire de le redessiner, car e la position sur l'√©cran ne change pas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En g√©n√©ral, l'animation est comprise comme un simple changement d'un nombre quelconque de param√®tres dans un certain temps avec la livraison de leurs valeurs interm√©diaires √† une fonction de rappel. Par exemple, vous pouvez ajouter un autre 4√®me param√®tre, qui sera responsable de l'angle de rotation de l'objet. Et vous pouvez g√©n√©ralement entasser les param√®tres de nombreux objets en une seule animation s'ils se d√©placent de mani√®re uniforme. Vous pouvez mettre des animations dans diff√©rents flux, puis elles seront trait√©es en parall√®le. Vous pouvez ajouter (m3d.lib.anim.add ()) √† un seul thread toute une s√©quence d'animations, et elles seront ex√©cut√©es l'une apr√®s l'autre. De plus, chaque thread aura sa propre s√©quence ind√©pendante. L'essentiel est que le syst√®me ait suffisamment de puissance et que tout ne se transforme pas en diaporama.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS. Les flux ici sont r√©alis√©s simplement par √©num√©ration s√©quentielle √† chaque it√©ration de toutes les animations parall√®les et calcul pour chacune d'elles de valeurs interm√©diaires de tous leurs param√®tres. </font><font style="vertical-align: inherit;">Autrement dit, il n'y a pas de v√©ritable multithreading en javascript. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le m√™me ¬´moteur¬ª peut √©galement √™tre utilis√© pour animer des √©l√©ments d'interface en les r√©glant pour changer 2 coordonn√©es sur le plan de l'√©cran et en affichant ces √©l√©ments dans des fonctions de rappel bas√©es sur les valeurs interm√©diaires obtenues. </font><font style="vertical-align: inherit;">Ce qui, en fait, se fait dans mon jeu.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ombres dynamiques </font></font></h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fd/4c/1-/fd4c1-dofkcz8fsysds0pbi_-eo.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'affichage des ombres sur toute la sc√®ne s'est av√©r√© √™tre un gaspillage si important que lors de leur activation, les images par seconde ont chut√© plusieurs fois. </font><font style="vertical-align: inherit;">Ce n'est pas bon. </font><font style="vertical-align: inherit;">Nous afficherons les ombres des objets dans un certain petit carr√© autour du joueur. </font><font style="vertical-align: inherit;">Je dirai tout de suite qu'une telle technique augmente consid√©rablement la fr√©quence d'images.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rien de compliqu√© ici. Les ombres de three.js sont projet√©es √† l'int√©rieur d'une certaine cam√©ra d'ombre sp√©cifi√©e par la bo√Æte (shadowCameraLeft, shadowCameraRight, shadowCameraTop, shadowCameraBottom). Il peut √™tre √©tendu √† l'ensemble de la sc√®ne ou cr√©√© de mani√®re √† ce qu'il suive la cam√©ra principale et que les ombres soient projet√©es uniquement autour d'elle. La seule chose que j'ai ajout√©e √† ce syst√®me est l'√©tape par laquelle les ombres seront mises √† jour. Il n'est absolument pas n√©cessaire de faire cette mise √† jour √† chaque fois que le joueur se secoue, car cela charge le syst√®me avec des calculs. Laissez-le d√©passer une certaine distance minimale le long de l'un des trois axes afin que les ombres soient mises √† jour.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ma biblioth√®que, lors de l'initialisation du monde 3D, un objet contr est cr√©√©, qui contient √† tout moment les coordonn√©es de la cam√©ra. Vous pouvez √©galement y d√©finir le param√®tre utilisateur contr.cameraForShadowStep, qui contient le pas de la position de la cam√©ra √† laquelle la position de la cam√©ra fant√¥me change. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si, par exemple, le parall√©l√©pip√®de de la cam√©ra fant√¥me a des dimensions 700x700x700, alors contr.cameraForShadowStep peut √™tre d√©fini, par exemple, sur 20. Et lorsque le joueur bouge de 20 sur l'un des axes, la position d'origine sera m√©moris√©e et les ombres autour du joueur seront mises √† jour. L'√©chelle du monde 3D peut √™tre quelconque, selon l'√©chelle √† laquelle tous les mod√®les ont √©t√© cr√©√©s dans l'√©diteur 3D. Et il est probable qu'au lieu de 700x700x700 et 20, vous devrez utiliser 7000x7000x7000 et 200. Mais cela ne change en rien l'essence.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, lorsque le soleil se d√©place dans le ciel, les ombres sont mises √† jour ind√©pendamment de ce syst√®me, car la direction des ombres devrait y changer. </font><font style="vertical-align: inherit;">Autrement dit, ils seront mis √† jour m√™me si le joueur est debout sans mouvement. </font><font style="vertical-align: inherit;">L√†, la fonction de mise √† jour des ombres en fonction de la p√©riode de mise √† jour du ciel est appel√©e sans ambages.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Syst√®me d'√©clairage ponctuel </font></font></h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kg/fa/be/kgfabepvwgn_zxwfctnyh2rce7g.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La pr√©sence de plus d'une douzaine de sources lumineuses ponctuelles sur la sc√®ne est aussi forte en fps que les ombres dynamiques. Et rend m√™me impossible de jouer l'ancien "Hemp". De plus, peu importe que ces sources soient dans le champ de vision du joueur (la plage de dessin du monde peut √™tre d√©finie) ou √† une distance consid√©rable. S'ils sont stupidement pr√©sents sur sc√®ne, alors tout fonctionne lentement. Par cons√©quent, j'ai fourni dans le menu des param√®tres du jeu, qui peut √™tre appel√© avant de charger le monde 3D, des options pour le nombre de ces sources (2, 4 ou 8) appel√©es "Light of Lanterns".</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mr/-g/sr/mr-gsrw4vfm6qjobtc5a36p432s.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, la nuit, allumer toutes les lumi√®res plac√©es sur la sc√®ne en m√™me temps ne fonctionnera pas. Ci-dessus, dans la description du sch√©ma d'initialisation du monde, j'ai pr√©sent√© des tableaux de userPointLights et lightsPDynamicAr. Dans userPointLights, les coordonn√©es de toutes les lampes de la lampe sur la sc√®ne sont d√©finies dans un tableau. Et lightsPDynamicAr contient les param√®tres d'√©clairage pour les 8 instances. Selon le r√©glage du nombre de lumi√®res, la biblioth√®que prendra la premi√®re d'entre elles et ajoutera √† la sc√®ne dans le champ de vision du joueur.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, pendant que le joueur se d√©place, une recherche est effectu√©e pour 2-8 lanternes les plus proches du joueur par le tableau de coordonn√©es des lanternes userPointLights. </font><font style="vertical-align: inherit;">Et les sources lumineuses ponctuelles se d√©placent sous elles. </font><font style="vertical-align: inherit;">En d'autres termes, 2-8 lampes d'√©clairage suivent le joueur, l'entourant. </font><font style="vertical-align: inherit;">De plus, cela ne se fait pas non plus avec chaque trame de fps, mais avec une √©tape donn√©e. </font><font style="vertical-align: inherit;">Il n'est absolument pas n√©cessaire de d√©marrer la fonction de recherche 60 fois par seconde, surtout si le joueur ne bouge pas - puis laissez br√ªler les lumi√®res d√©j√† trouv√©es autour de lui. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici √† quoi cela ressemble en mouvement (Xeon E5440, GeForce GT730):</font></font><br><iframe width="560" height="315" src="https://www.youtube.com/embed/IPuJrH8EJ_E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Construction de distribution </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme je n'utilise aucun environnement de d√©veloppement sophistiqu√© (√† l'exception du bloc-notes avanc√©), j'ai √©crit un fichier bat dans lequel le compilateur Google Closure est appel√© pour masquer le code de chaque fichier * .js. </font><font style="vertical-align: inherit;">Et puis nwjc.exe du bundle nw.js y est appel√© pour compiler js en binaires (* .bin). </font><font style="vertical-align: inherit;">Je vais donner un exemple pour l'un des fichiers:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">java -jar D: \ webservers \ Closure \ compiler.jar --js D: \ webservers \ proj \ m3d \ www \ game \ bus \ bus.js --js_output_file D: \ webservers \ proj \ nwProjects \ bus \ game \ bus \ bus.js </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd D: \ "Program Files" \ Web2Exe \ down \ nwjs-sdk-v0.35.5-win-ia32 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D: \ "Program Files" \ Web2Exe \ down \ nwjs-sdk-v0.35.5-win -ia32 \ nwjc.exe D: \ webservers \ proj \ nwProjects \ bus \ game \ bus \ bus.js D: \ webservers \ proj \ nwProjects \ bus \ game \ bus \ bus.bin </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">del D: \ webservers \ proj \ nwProjects \ bus \ game \ bus \ bus.js</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, j'utilise le simple utilitaire Web2Executable pour cr√©er un fichier exe avec assemblage sous Windows. J'ai choisi la version 0.35.5 de nw.js, bien que des versions plus r√©centes soient √©galement disponibles. Je n'ai remarqu√© aucun effet de leur part, sauf pour augmenter la taille de l'assemblage.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hk/_2/ed/hk_2ed5imb6en8ffx6vtfx_7t-o.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilitaire est capable de t√©l√©charger la version s√©lectionn√©e de nw.js dans le dossier sp√©cifi√© lui-m√™me. </font><font style="vertical-align: inherit;">La sortie est un assemblage. </font><font style="vertical-align: inherit;">Le fichier ex√©cutable de 35 m√©gaoctets contient, en fait, le jeu lui-m√™me. </font><font style="vertical-align: inherit;">Tout le reste est node-webkit. </font><font style="vertical-align: inherit;">Le dossier locales contient √©videmment des fichiers avec des ressources dans diff√©rentes langues. </font><font style="vertical-align: inherit;">Je les ai supprim√©s et n'ai laiss√© que ceux li√©s √† l'anglais. </font><font style="vertical-align: inherit;">Soit dit en passant, cela n'a pas emp√™ch√© le lancement de la version russe du jeu (dans le jeu, la langue bascule entre le russe et l'anglais). </font><font style="vertical-align: inherit;">Pourquoi tous ces fichiers alors, je ne sais pas. </font><font style="vertical-align: inherit;">Mais sans l'anglais, rien ne commence. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'assembl√©e enti√®re a finalement pris 167 Mo.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jp/ev/qq/jpevqq5deupdq0zkm7naffok4fa.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ensuite, j'ai tout emball√© dans un fichier de distribution ex√©cutable √† l'aide de l'un des utilitaires gratuits con√ßus √† cet effet, et la sortie √©tait de 70,2 Mo Businessman3DSetup.exe. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sf/xd/nn/sfxdnnsvu3fpp9ukkzsius2vqsm.jpeg"></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Publication </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai envoy√© l'assemblage √† diff√©rents magasins d'applications. La plupart d'entre eux sont encore en train de mod√©rer mon jeu. Pour le moment, seule la d√©mangeaison l'a publi√© jusqu'√† pr√©sent. Je vous pr√©viens tout de suite, le jeu est pay√©, le prix est de 3 $. Il n'y a pas encore d'achats, mais je n'ai pas encore √©t√© engag√© dans sa promotion. GOG a refus√© de publier, citant le fait que le jeu est assez simple et de niche. Je suis en principe d'accord. Epic Store, je pense, fera de m√™me.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La version publi√©e du jeu est mono-utilisateur, avec des bots d'un montant de 1 √† 5. Langue - russe et anglais. J'ai l'intention de terminer la version r√©seau. Mais en pensant - pour le publier sous la m√™me application ou sous la forme d'une version de navigateur Web disponible imm√©diatement sous Windows, Linux, iOs et MacOs, et g√©n√©ralement partout o√π le navigateur prend en charge WebGL. En effet, en fait, le webkit est un navigateur et le jeu y fonctionne tr√®s bien, dans Firefox, dans Edge et m√™me dans IE11 sous Windows, bien que dans ce dernier il soit tr√®s lent.</font></font><br><br><h3>  Conclusions </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kw/cf/wm/kwcfwmtwbwugbnnsb3gol4bshkk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suppose que je ne suis pas encore pr√™t √† disposer mon moteur pour une utilisation g√©n√©rale, car il n'est pas encore termin√©. Je vais d'abord √©crire un autre jeu dessus, juste celui de la vid√©o de d√©monstration sur les vaisseaux, car sur ce jeu vous pouvez "parcourir" le travail avec le shader d'eau. De plus, je pr√©vois d'y implanter un moteur physique simple. Oui, et vous devez toujours terminer toutes les autres fonctionnalit√©s, corriger tous les d√©fauts. Et il vaut mieux le faire sur deux jeux que sur un, car certaines nuances sont possibles. En attendant, mon moteur, √† mon avis, est encore trop aff√ªt√© pour un match.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, je ne suis pas du tout s√ªr que quelqu'un ait besoin de tout cela. </font><font style="vertical-align: inherit;">Si vous regardez sobrement, personne n'√©crit de jeux en pur javascript. </font><font style="vertical-align: inherit;">Mais je l'aime parce que les jeux sont assez faciles et rapides pour le navigateur. </font><font style="vertical-align: inherit;">Ils se chargent rapidement, ne n√©cessitent pas beaucoup de RAM et fonctionnent assez rapidement par rapport aux concurrents en html5, m√™me par rapport √† la 2D. </font><font style="vertical-align: inherit;">Je pense que je publierai plus d'un jeu de navigateur (et pas seulement) sur tous ces d√©veloppements.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450926/">https://habr.com/ru/post/fr450926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450914/index.html">Les n√©gociations ont √©chou√©: comment Oracle a tu√© Java EE</a></li>
<li><a href="../fr450916/index.html">Comparaison de la qualit√© des photos prises sur des t√©l√©phones avec diff√©rentes configurations de capteurs</a></li>
<li><a href="../fr450918/index.html">Gestion des connaissances informatiques: premi√®re conf√©rence et vue d'ensemble</a></li>
<li><a href="../fr450922/index.html">Promenade au bureau</a></li>
<li><a href="../fr450924/index.html">Tout sur les animations SVG</a></li>
<li><a href="../fr450928/index.html">Comment les centres de donn√©es sauvent les vacances</a></li>
<li><a href="../fr450930/index.html">Comment nous d√©veloppons # bigdataX5 et qui est n√©cessaire dans le Big Data</a></li>
<li><a href="../fr450938/index.html">Linux Install Fest 05.19 √† Nizhny Novgorod 18 mai 2019</a></li>
<li><a href="../fr450940/index.html">Vivaldi 2.5 - Macrocosme attrayant</a></li>
<li><a href="../fr450942/index.html">Sidecar pour un fractionnement de code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>