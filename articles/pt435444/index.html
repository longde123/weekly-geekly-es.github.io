<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≥ üì¢ üç≠ Estamos implementando o OSGI na plataforma Karaf üë©üèΩ‚Äçü§ù‚Äçüë©üèª „äôÔ∏è üíã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OSGI n√£o √© dif√≠cil 
 J√° vi muitas vezes que o OSGI √© dif√≠cil. Al√©m disso, ele pr√≥prio j√° teve essa opini√£o. Ano em 2009, para ser exato. Naquela √©poca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Estamos implementando o OSGI na plataforma Karaf</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435444/"><h2>  OSGI n√£o √© dif√≠cil </h2><br>  J√° vi muitas vezes que o OSGI √© dif√≠cil.  Al√©m disso, ele pr√≥prio j√° teve essa opini√£o.  Ano em 2009, para ser exato.  Naquela √©poca, coletamos projetos usando o Maven Tycho e os implantamos no Equinox.  E era realmente mais dif√≠cil do que desenvolver e montar projetos para JavaEE (naquele momento, apenas aparecia a vers√£o do EJB 3, para a qual trocamos).  O Equinox era muito menos conveniente que o Weblogic, por exemplo, e os benef√≠cios do OSGI n√£o eram √≥bvios para mim naquela √©poca. <br><br>  Mas, depois de muitos anos, tive que iniciar um projeto em um novo emprego, concebido com base no Apache Camel e Apache Karaf.  N√£o era minha id√©ia, eu conhecia Camel h√° muito tempo e decidi ler sobre Karaf, mesmo sem uma oferta.  Eu li uma noite e percebi - aqui est√°, simples e pronta, quase a mesma solu√ß√£o para alguns problemas de um JavaEE t√≠pico, semelhante ao que eu j√° havia feito de joelhos usando Weblogic WLST, Jython e Maven Aether. <br><br>  Ent√£o, digamos que voc√™ decida experimentar o OSGI na plataforma Karaf.  Por onde come√ßamos? <br><a name="habracut"></a><br><h3>  Se voc√™ quer uma compreens√£o mais profunda </h3><br>  Obviamente, voc√™ pode come√ßar lendo a documenta√ß√£o.  E √© poss√≠vel com Habr√© - havia artigos muito bons aqui, digamos h√° muito tempo.  Mas, em geral, o karaf recebeu at√© agora imerecidamente pouca aten√ß√£o.  Houve mais algumas cr√≠ticas a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">isto</a> ou a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">isto</a> .  √â melhor pular <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">essa</a> men√ß√£o ao karaf.  Como se costuma dizer, n√£o leia jornais sovi√©ticos durante a noite ... pois eles dir√£o l√° que o karaf √© uma estrutura OSGI - para que voc√™ n√£o acredite.  As estruturas OSGI s√£o Apache Felix ou Eclipse Equinox, com base nas quais o karaf simplesmente funciona.  Voc√™ pode escolher qualquer um deles. <br><br>  Deve-se notar que, quando o Jboss Fuse ou Apache ServiceMix √© mencionado, ele deve ser lido como "Karaf, com componentes pr√©-instalados", ou seja,  de fato - a mesma coisa, coletada apenas pelo fornecedor.  Eu n√£o recomendaria come√ßar com isso na pr√°tica, mas √© bem poss√≠vel ler artigos de revis√£o sobre o ServiceMix, por exemplo. <br><br>  Para come√ßar, tentarei determinar aqui muito brevemente o que √© OSGI e para que ele pode ser usado. <br><br>  Em geral, o OSGI √© uma ferramenta para criar aplicativos Java a partir de m√≥dulos.  Um anal√≥gico pr√≥ximo pode ser considerado, por exemplo, JavaEE, e, at√© certo ponto, os cont√™ineres OSGI podem executar m√≥dulos JavaEE (por exemplo, aplicativos da Web na forma de Guerra) e, por outro lado, muitos cont√™ineres JavaEE cont√™m OSGI como meio de implementar a modularidade " "  Ou seja, JavaEE e OSGI s√£o coisas semelhantes √† compatibilidade e complementares com √™xito. <br><br>  Uma parte importante de qualquer sistema modular √© a defini√ß√£o do pr√≥prio m√≥dulo.  No caso do OSGI, o m√≥dulo √© chamado de pacote configur√°vel e √© um arquivo jar conhecido por todos os desenvolvedores com algumas adi√ß√µes (ou seja, √© muito semelhante aqui, por exemplo, ao war or ear).  Por analogia com o JavaEE, os pacotes configur√°veis ‚Äã‚Äãpodem exportar e importar servi√ßos, que s√£o essencialmente m√©todos de classe (ou seja, um servi√ßo √© uma interface ou todos os m√©todos p√∫blicos de uma classe). <br><br>  Os metadados do pacote configur√°vel s√£o familiares a todos os META-INF / MANIFEST.MF.  Os cabe√ßalhos do manifesto OSGI n√£o se cruzam com os cabe√ßalhos do JRE, respectivamente, fora do pacote configur√°vel do cont√™iner OSGI √© um jar comum.  √â significativo que entre os metadados sempre haja: <br><br><pre><code class="plaintext hljs">Bundle-SymbolicName: com.example.myosgi Bundle-Version: 1.0.0</code> </pre> <br>  Essas s√£o as "coordenadas" do pacote configur√°vel, e o fato de podermos ter duas ou mais vers√µes instaladas e funcionando simultaneamente do mesmo pacote configur√°vel em um cont√™iner √© importante. <br><br>  Semelhante ao JavaEE, os pacotes configur√°veis ‚Äã‚Äãt√™m um ciclo de vida semelhante a este: <img src="https://habrastorage.org/getpro/habr/post_images/b71/a55/263/b71a5526390ea0fd4eaf02a3d5edc67a.png" alt="imagem">  Al√©m dos servi√ßos, os pacotes configur√°veis ‚Äã‚Äãtamb√©m podem importar e exportar pacotes (pacotes, no sentido usual do termo para java).  Pacotes exportados s√£o definidos dentro do pacote configur√°vel e disponibilizados para outros componentes quando o pacote configur√°vel √© instalado no sistema.  Os importados s√£o definidos em algum lugar externo, devem ser exportados por algu√©m e fornecidos ao pacote pelo cont√™iner antes que ele comece a funcionar. <br><br>  As importa√ß√µes de pacotes podem ser declaradas opcionais, bem como as importa√ß√µes de servi√ßos.  E √© bastante significativo que a importa√ß√£o e a exporta√ß√£o contenham uma indica√ß√£o da vers√£o (ou intervalo de vers√µes). <br><br><h4>  Diferen√ßas do JavaEE </h4><br>  Bem, √© bom que eles sejam parecidos - n√≥s entendemos.  E como eles diferem? <br><br>  Na minha opini√£o, a principal diferen√ßa √© que o OSGI nos d√° muito mais flexibilidade.  Quando o pacote est√° no estado INICIADO, as possibilidades s√£o limitadas apenas pela sua imagina√ß√£o.  Digamos que voc√™ possa criar facilmente threads (sim, sim, eu sei sobre o ManagedExecutorService), pools de conex√£o com bancos de dados, etc.  Um cont√™iner n√£o assume o controle de todos os recursos na mesma extens√£o que o JavaEE. <br><br>  Voc√™ pode exportar novos servi√ßos no processo.  Tente dizer no JavaEE criar dinamicamente um novo servlet?  E aqui √© bem poss√≠vel, al√©m disso, o cont√™iner do servlet karaf criado com base no jetty ser√° imediatamente detectado pelo servlet criado e estar√° dispon√≠vel para os clientes em uma URL espec√≠fica. <br><br>  Embora isso seja uma pequena simplifica√ß√£o, mas se o aplicativo JavaEE em sua forma cl√°ssica consistir principalmente em componentes: <br><br><ul><li>  passivo, aguardando uma liga√ß√£o do cliente </li><li>  definido estaticamente, ou seja, no momento da implanta√ß√£o do aplicativo. </li></ul><br>  Por outro lado, um aplicativo baseado em OSGI pode conter: <br><br><ul><li>  componentes programados ativos e passivos, realizando pesquisas, bem, ouvindo um soquete, etc. </li><li>  servi√ßos podem ser definidos e publicados dinamicamente </li><li>  Voc√™ pode se inscrever em eventos de estrutura, por exemplo, ouvir o registro de servi√ßos, pacotes configur√°veis, etc., receber links para outros pacotes configur√°veis ‚Äã‚Äãe servi√ßos e fazer muito mais. </li></ul><br>  Sim, no JavaEE, muito disso tamb√©m √© parcialmente poss√≠vel (por exemplo, atrav√©s do JNDI), mas no caso do OSGI, na pr√°tica, isso √© facilitado.  Embora haja provavelmente mais alguns riscos aqui. <br><br><h4>  Diferen√ßas entre karaf e OSGI puro </h4><br>  Al√©m da estrutura do karaf, existem muitas coisas √∫teis.  Em ess√™ncia, o karaf √© uma ferramenta para gerenciar convenientemente a estrutura OSGI - instalando pacotes configur√°veis ‚Äã‚Äã(incluindo grupos), configurando-os, monitorando, descrevendo o modelo e garantindo a seguran√ßa e assim por diante. <br><br><h2>  E vamos praticar j√°? </h2><br>  Bem, ent√£o, vamos come√ßar imediatamente com a instala√ß√£o.  N√£o h√° muito o que escrever aqui - v√° para karaf.apache.org, fa√ßa o download do pacote de distribui√ß√£o, descompacte-o.  As vers√µes do karaf diferem no suporte a diferentes especifica√ß√µes OSGI (4, 5 ou 6) e vers√µes Java.  Eu n√£o recomendo a fam√≠lia 2.x, mas aqui est√£o 3 (se voc√™ tiver Java 8, como o meu) e 4 podem ser usados, embora hoje apenas a fam√≠lia 4.x esteja em desenvolvimento (vers√£o atual 4.2.2, ela suporta OSGI 6 e Java at√© 10). <br><br>  O Karaf funciona bem no Windows e Linux, tudo o que voc√™ precisa para criar um servi√ßo e a execu√ß√£o autom√°tica est√£o dispon√≠veis.  Tamb√©m √© declarado o suporte para MacOS e muitos outros tipos de Unix. <br><br>  Geralmente, voc√™ pode iniciar o karaf imediatamente se estiver na Internet.  Caso contr√°rio, geralmente vale a pena consertar o arquivo de configura√ß√£o, indicando onde voc√™ possui reposit√≥rios.  Geralmente ser√° um Nexus corporativo, ou seja, Artifactory, quem quiser o que.  A configura√ß√£o do karaf est√° localizada na pasta etc da distribui√ß√£o.  Os nomes dos arquivos de configura√ß√£o n√£o s√£o muito √≥bvios, mas nesse caso voc√™ precisa do arquivo org.ops4j.pax.url.mvn.cfg.  O formato deste arquivo √© propriedades do java. <br><br>  Voc√™ pode especificar o (s) reposit√≥rio (s) no pr√≥prio arquivo de configura√ß√£o, listando a lista de URLs nas configura√ß√µes ou simplesmente mostrando onde est√° o settings.xml.  L√°, o karaf levar√° a localiza√ß√£o do seu proxy, o que geralmente √© necess√°rio saber na intranet. <br><br>  O Kafar precisa de v√°rias portas, estas s√£o HTTP, HTTPS (se a web estiver configurada, por padr√£o n√£o), SSH, RMI, JMX.  Se eles estiverem ocupados com voc√™, ou voc√™ quiser executar v√°rias c√≥pias no mesmo host, ser√° necess√°rio alter√°-las tamb√©m.  Existem aproximadamente cinco dessas portas. <br><br>  Portas como jmx e rmi - aqui: org.apache.karaf.management.cfg, ssh - org.apache.karaf.shell.cfg, para alterar as portas http / https, voc√™ precisar√° criar (provavelmente n√£o) o arquivo etc / org.ops4j.pax.web.cfg e escreva o valor org.osgi.service.http.port = port que voc√™ precisa. <br><br>  Ent√£o voc√™ pode definitivamente inici√°-lo e, como regra, tudo come√ßar√°.  Para uso industrial, obviamente, voc√™ precisar√° fazer altera√ß√µes no arquivo bin / setenv ou bin / setenv.bat, por exemplo, para alocar a quantidade necess√°ria de mem√≥ria, mas primeiro, para ver, isso n√£o √© necess√°rio. <br><br>  Voc√™ pode iniciar o Karaf imediatamente com o console, o comando karaf ou execut√°-lo em segundo plano com o comando start server e, em seguida, conectar-se a ele via SSH.  Este √© um SSH completamente padr√£o, com suporte para SCP e SFTP.  Voc√™ pode executar comandos e copiar arquivos para frente e para tr√°s.  √â poss√≠vel conectar-se a qualquer cliente, por exemplo, minha ferramenta favorita √© o Far NetBox.  O login est√° dispon√≠vel por login e senha, bem como por chaves.  Em crian√ßas jsch, com tudo o que isso implica. <br><br>  Eu recomendo ter uma janela de console adicional imediatamente para exibir os logs localizados em data / log / karaf.log (e outros arquivos geralmente est√£o l√°, embora isso seja personaliz√°vel).  Os logs s√£o √∫teis para voc√™, a partir de mensagens curtas no console, nem tudo est√° claro. <br><br>  Eu recomendaria instalar a web imediatamente e o console da web hawtio.  Essas duas coisas facilitar√£o muito a navega√ß√£o do que est√° acontecendo no cont√™iner e a condu√ß√£o do processo a partir de l√° em grande parte (como b√¥nus, voc√™ ter√° o jolokia e a capacidade de monitorar via http).  A instala√ß√£o do hawtio √© feita por dois comandos do console do karaf ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como descrito aqui</a> ) e, infelizmente, hoje a vers√£o do karaf 3.x n√£o √© mais suportada (voc√™ ter√° que procurar vers√µes mais antigas do hawtio). <br><br>  Os Https n√£o ser√£o imediatamente retirados da caixa; para isso, √© necess√°rio fazer alguns esfor√ßos, como gerar certificados, etc. A implementa√ß√£o √© baseada no jetty; portanto, todos esses esfor√ßos s√£o feitos da mesma maneira. <br><br><h2>  OK, come√ßou, o que vem a seguir? </h2><br><img src="https://habrastorage.org/webt/lh/ty/ge/lhtygefalzjfywb-3lr088qvrha.png"><br><br>  Na verdade, o que voc√™ esperava?  Eu disse que seria ssh.  Guia funciona, se isso. <br><br>  √â hora de instalar algum aplicativo.  Um aplicativo para OSGI √© um pacote configur√°vel ou consiste em v√°rios pacotes configur√°veis.  O Karaf pode implantar aplicativos em v√°rios formatos: <br><br><ul><li>  Um pacote configur√°vel jar, com ou sem um manifesto OSGI </li><li>  xml contendo Spring DM ou Blueprint </li><li>  xml que cont√©m o chamado recurso, que √© uma cole√ß√£o de pacotes configur√°veis, outros recursos e recursos (arquivos de configura√ß√£o) </li><li>  Arquivo .kar contendo v√°rios recursos e um reposit√≥rio maven com depend√™ncias </li><li>  Aplicativos JavaEE (sob algumas condi√ß√µes adicionais), por exemplo .war </li></ul><br>  Existem v√°rias maneiras de fazer isso: <br><br><ul><li>  coloque o aplicativo na pasta deploy </li><li>  instale a partir do console com o comando install </li><li>  instale o recurso com o comando do recurso: instalar console </li><li>  kar: install </li></ul><br>  Bem, em geral, isso √© bastante semelhante ao que um cont√™iner JavaEE t√≠pico pode fazer, mas √© um pouco mais conveniente (eu diria que √© muito mais conveniente). <br><br><h3>  Jarra simples </h3><br>  A op√ß√£o mais f√°cil √© instalar um jar comum.  Se voc√™ o possui no reposit√≥rio maven, o comando √© suficiente para instalar: <br><br><pre> <code class="bash hljs">install mvn:groupId/artifactId/version</code> </pre> <br>  Ao mesmo tempo, Karaf percebe que ele tem um jarro regular √† sua frente e o processa, criando um inv√≥lucro em tempo real, o chamado  wrapper, gerando um manifesto padr√£o, com importa√ß√µes e exporta√ß√µes de pacotes. <br><br>  A sensa√ß√£o de instalar apenas um jar geralmente n√£o √© muito grande, pois esse pacote ser√° passivo - ele apenas exporta classes que estar√£o dispon√≠veis para outros pacotes. <br><br>  Este m√©todo √© usado para instalar componentes como o Apache Commons Lang, por exemplo: <br><br><pre> <code class="bash hljs">install mvn:org.apache.commons.lang3/commons-lang/3.8.1</code> </pre> <br>  Mas n√£o funcionou :) Aqui est√£o as coordenadas corretas: <br><br><pre> <code class="bash hljs">install mvn:org.apache.commons/commons-lang3/3.8.1</code> </pre> <br>  Vamos ver o que aconteceu: list -u nos mostrar√° os pacotes e suas fontes: <br><br><pre> <code class="bash hljs">karaf@root()&gt; list -u START LEVEL 100 , List Threshold: 50 ID | State | Lvl | Version | Name | Update location ------------------------------------------------------------------------------------------------- 87 | Installed | 80 | 3.8.1 | Apache Commons Lang | mvn:org.apache.commons/commons-lang3/3.8.1 88 | Installed | 80 | 3.6.0 | Apache Commons Lang | mvn:org.apache.commons/commons-lang3/3.6</code> </pre> <br>  Como voc√™ pode ver, √© bem poss√≠vel instalar duas vers√µes de um componente.  Atualizar local - √© aqui que obtemos o pacote e onde ele pode ser atualizado, se necess√°rio. <br><br><h3>  Contexto Jar e Spring </h3><br>  Se houver um contexto de primavera dentro do seu jar, as coisas ficam mais interessantes.  O Karaf Deployer pesquisa automaticamente contextos xml na pasta META-INF / spring e os cria se todos os pacotes externos necess√°rios ao pacote foram encontrados com √™xito. <br><br>  Assim, todos os servi√ßos que estavam dentro dos contextos j√° ser√£o iniciados.  Se voc√™ tiver o Camel Spring l√°, por exemplo, as rotas do Camel tamb√©m ser√£o iniciadas.  Isso significa que dizemos que um servi√ßo REST ou um servi√ßo escutando uma porta TCP, voc√™ j√° pode iniciar.  Obviamente, o lan√ßamento de v√°rios servi√ßos que escutam em uma porta n√£o funcionar√° dessa maneira. <br><br><h3>  Contexto XML do Just Spring </h3><br>  Se voc√™ tivesse, por exemplo, defini√ß√µes de JDBC DataSources dentro do Spring Context, poder√° instal√°-las separadamente no Karaf.  I.e.  pegue um arquivo xml contendo apenas um DataSource na forma de &lt;bean&gt; ou qualquer outro conjunto de componentes, voc√™ pode coloc√°-lo na pasta deploy.  O contexto ser√° lan√ßado da maneira padr√£o.  O √∫nico problema √© que os DataSources criados dessa maneira n√£o ser√£o vis√≠veis para outros pacotes configur√°veis.  Eles precisam ser exportados para OSGI como servi√ßos.  Sobre isso - um pouco mais tarde. <br><br><h3>  Spring dm </h3><br>  Qual √© a diferen√ßa entre o Spring DM (vers√£o habilitada para OSGI) e o Spring cl√°ssico?  Portanto, no caso cl√°ssico, todos os beans no contexto s√£o criados no est√°gio de inicializa√ß√£o do contexto.  Os novos n√£o podem aparecer, os antigos n√£o ir√£o a lugar algum.  No caso do OSGI, novos pacotes configur√°veis ‚Äã‚Äãpodem ser instalados e pacotes antigos removidos.  O ambiente est√° se tornando mais din√¢mico, voc√™ precisa responder de alguma forma. <br><br>  O m√©todo de resposta √© chamado de servi√ßos.  Um servi√ßo geralmente √© uma determinada interface, com m√©todos pr√≥prios, publicados por alguns pacotes.  Um servi√ßo possui metadados que permitem sua pesquisa e distin√ß√£o de outro servi√ßo que implementa uma interface semelhante (obviamente, de outro DataSource).  Os metadados s√£o um conjunto simples de propriedades de valor-chave. <br><br>  Como os servi√ßos podem aparecer e desaparecer, aqueles que precisam deles podem se inscrever nos servi√ßos na inicializa√ß√£o ou ouvir eventos para descobrir sua apar√™ncia ou desaparecimento.  No n√≠vel do Spring DM, em XML, isso √© implementado como dois elementos, servi√ßo e refer√™ncia, cujo objetivo b√°sico √© bastante simples: publicar o bean existente a partir do contexto como um servi√ßo e assinar um servi√ßo externo publicando-o no contexto atual da primavera. <br><br>  Assim, ao inicializar um pacote, o cont√™iner encontrar√° os servi√ßos externos necess√°rios e publicar√° os pacotes implementados dentro dele, tornando-os acess√≠veis a partir do exterior.  Um pacote configur√°vel √© iniciado somente depois que os links de servi√ßo s√£o resolvidos. <br><br>  De fato, tudo √© um pouco mais complicado, porque o pacote pode usar uma lista de servi√ßos semelhantes e se inscrever imediatamente na lista.  I.e.  um servi√ßo, em geral, possui uma propriedade como cardinalidade, que assume o valor 0..N.  Nesse caso, a assinatura, em que 0..1 √© indicado, descreve um servi√ßo opcional e, nesse caso, o pacote configur√°vel √© iniciado com √™xito, mesmo que n√£o exista esse servi√ßo no sistema (e, em vez de um link para ele, ele receber√° um stub). <br><br>  Observo que um servi√ßo √© qualquer interface (ou voc√™ pode publicar apenas classes), para que voc√™ possa publicar o java.util.Map com dados como um servi√ßo. <br><br>  Entre outras coisas, o servi√ßo permite especificar metadados e a refer√™ncia permite procurar um servi√ßo por esses metadados. <br><br><h3>  Blueprint </h3><br>  Blueprint √© a encarna√ß√£o mais recente do Spring DM, que √© um pouco mais simples.  Ou seja, se no Spring voc√™ possui elementos XML personalizados, eles n√£o est√£o aqui, pois s√£o desnecess√°rios.  √Äs vezes, isso ainda causa inconveni√™ncia, mas com franqueza - com pouca frequ√™ncia.  Se voc√™ n√£o estiver migrando um projeto do Spring, poder√° come√ßar imediatamente com o Blueprint. <br><br>  A ess√™ncia aqui √© a mesma: o XML, que descreve os componentes dos quais o contexto do pacote configur√°vel √© montado.  Para quem conhece a primavera, n√£o h√° nada desconhecido. <br><br>  Aqui est√° um exemplo de como descrever um DataSource e export√°-lo como um servi√ßo: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blueprint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"oracle.jdbc.pool.OracleDataSource"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"URL"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"URL"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"USER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PASSWORD"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javax.sql.DataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ds"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service-properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entry</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"osgi.jndi.service.name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jdbc/ds"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service-properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blueprint</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Bem, implantamos esse arquivo na pasta de implanta√ß√£o e analisamos os resultados do comando list.  Eles viram que o pacote n√£o foi iniciado - no status Indtalled.  Tentamos iniciar e recebemos uma mensagem de erro. <br><br>  Agora na lista de pacotes configur√°veis ‚Äã‚Äãno status Falha.  O que houve?  Obviamente, ele tamb√©m precisa de depend√™ncias, neste caso, um Jar com classes JDBC Oracle ou, mais precisamente, o pacote oracle.jdbc.pool. <br>  N√≥s encontramos o jar necess√°rio no reposit√≥rio, ou baixamos do site Oracle e instalamos, conforme descrito anteriormente.  Nosso DataSource foi iniciado. <br><br>  Como usar tudo isso?  O link do servi√ßo √© chamado na refer√™ncia Blueprint (em algum lugar, no contexto de outro pacote configur√°vel): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javax.sql.DataSource"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  Ent√£o, esse bean se torna, como sempre, uma depend√™ncia para outros beans (no exemplo camel-sql): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sql"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.apache.camel.component.sql.SqlComponent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  Jar e ativador </h3><br>  A maneira can√¥nica de inicializar pacotes configur√°veis ‚Äã‚Äã√© usar uma classe que implementa a interface do Activator.  Essa √© uma interface t√≠pica do ciclo de vida que cont√©m m√©todos de in√≠cio e parada que passam pelo <i>contexto</i> .  Dentro deles, o pacote configur√°vel geralmente inicia seus encadeamentos, se necess√°rio, come√ßa a escutar portas, assina servi√ßos externos usando a API OSGI e assim por diante.  Esta √© talvez a maneira mais complexa, b√°sica e flex√≠vel.  Por tr√™s anos eu nunca precisei disso. <br><br><h2>  Defini√ß√µes e configura√ß√£o </h2><br>  √â claro que essa configura√ß√£o do DataSource, como mostra o exemplo, poucas pessoas precisam.  Login, senha e muito mais, tudo √© codificado dentro do XML.  √â necess√°rio remover esses par√¢metros. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"url"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${oracle.ds.url}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${oracle.ds.user}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${oracle.ds.password}"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  A solu√ß√£o √© bastante simples e semelhante √† usada na primavera cl√°ssica: em um certo ponto do ciclo de vida do contexto, os valores das propriedades s√£o substitu√≠dos por v√°rias fontes. <br><br>  Sobre isso, terminaremos a primeira parte.  Se houver interesse neste t√≥pico, continue.  Vamos considerar como montar aplicativos a partir de pacotes configur√°veis, configurar, monitorar e implantar sistemas automaticamente nesta plataforma. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt435444/">https://habr.com/ru/post/pt435444/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt435430/index.html">As not√≠cias mais legais CES 2019</a></li>
<li><a href="../pt435432/index.html">Ano Novo, Novo GitHub: Reposit√≥rios Privados Gratuitos Ilimitados</a></li>
<li><a href="../pt435436/index.html">5 tend√™ncias em infraestrutura de TI: previs√£o para 2019</a></li>
<li><a href="../pt435438/index.html">PHP: alterando a estrutura do banco de dados no desenvolvimento de equipes</a></li>
<li><a href="../pt435442/index.html">Funil de mudan√ßa</a></li>
<li><a href="../pt435446/index.html">Algoritmo Verhuff para um sistema arbitr√°rio de n√∫meros pares</a></li>
<li><a href="../pt435448/index.html">Sobre a experi√™ncia de comunica√ß√£o com um gerador de sinal atrav√©s do QTcpSocket e SCPI</a></li>
<li><a href="../pt435450/index.html">Feliz Ano Novo, Feliz Novo MQTT / UDP</a></li>
<li><a href="../pt435452/index.html">Teste de ponta a ponta de microsservi√ßos com o Catcher</a></li>
<li><a href="../pt435454/index.html">AOP vs Recursos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>