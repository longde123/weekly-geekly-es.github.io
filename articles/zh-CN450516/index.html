<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛 ♊️ 👩🏽‍🔧 合格的MacOS签名 🚡 🗓️ 💢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="根据RBC和Tensor的说法，2019年俄罗斯将发行460万份符合63-FZ要求的合格电子签名（CEP）证书。 事实证明，在800万个注册的IP和LLC中，第二个企业家使用电子签名。 除了用于EGAIS的CEP和用于提交银行和会计服务发布的报告的基于云的CEP外，带有安全令牌的通用CEP也特别受关...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>合格的MacOS签名</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450516/"><img src="https://habrastorage.org/webt/ex/qt/fa/exqtfaem0qdki9aiaggndkwcpsc.png" align="left"><br><p> 根据<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RBC</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Tensor的</a>说法，2019年俄罗斯将发行460万份符合63-FZ要求的合格电子签名（CEP）证书。 事实证明，在800万个注册的IP和LLC中，第二个企业家使用电子签名。 除了用于EGAIS的CEP和用于提交银行和会计服务发布的报告的基于云的CEP外，带有安全令牌的通用CEP也特别受关注。 此类证书使您可以登录状态门户网站并签署任何文档，从而使它们具有法律意义。 </p><br><p> 借助USB令牌上的CEP证书，您可以远程与交易对手或远程员工签订合同，将文件发送给法院； 在在线收银机上注册，结清欠款并在nalog.ru上的帐户中提交声明； 了解债务和即将进行的公共服务检查。 </p><br><p> 以下手册将帮助您<strong>使用macOS</strong>的CEP-无需学习CryptoPro论坛和使用Windows安装虚拟机。 </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">目录内容</b> <div class="spoiler_text"><p>  <strong>您需要使用CEP for macOS进行以下操作：</strong> </p><br><p>  <strong>为macOS安装和配置CEP</strong> </p><br><ol><li> 安装CryptoPro CSP </li><li> 安装Rootoken驱动程序 </li><li> 安装证书 <br>  3.1。 我们删除所有旧的GOST证书 <br>  3.2。 安装根证书 <br>  3.3。 下载认证中心证书 <br>  3.4。 使用Rutoken安装证书 </li><li> 安装特殊的浏览器Chromium-GOST </li><li> 安装浏览器扩展 <br>  5.1 CryptoPro EDS浏览器插件 <br>  5.2。 政府服务插件 <br>  5.3。 设置公共服务插件 <br>  5.4。 激活扩展 <br>  5.5。 我们配置扩展CryptoPro EDS Browser插件 </li><li> 检查一切正常。 <br>  6.1。 我们转到测试页面CryptoPro <br>  6.2。 我们进入nalog.ru上的个人帐户 <br>  6.3。 我们去公共服务 </li><li> 如果停止工作该怎么办 </li></ol><br><p>  <strong>更改容器PIN</strong> </p><br><ol><li> 我们找出容器CEP的名称 </li><li> 从终端更改PIN命令 </li></ol><br><p>  <strong>在macOS上签名文件</strong> </p><br><ol><li> 找出CEP证书的哈希值 </li><li> 使用终端命令签名文件 </li><li> 安装Apple Automator脚本 </li></ol><br><p>  <strong>验证文件上的签名</strong> </p></div></div><br><p> 以下所有信息均来自信誉良好的来源（CryptoPro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">＃1</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">＃2</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">＃3</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rutoken</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Corus-Consulting</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">乌拉尔联邦地区通信部</a> ），并建议从受信任的站点下载软件。 作者是独立顾问，与任何上述公司都不隶属。 按照此说明，您对任何操作和后果承担全部责任。 </p><br><h2 id="chto-nuzhno-dlya-raboty-s-kep-pod-macos"> 您需要使用CEP for macOS进行以下操作： </h2><br><ol><li>  <strong>USB令牌Rutoken Lite</strong>或<strong>Rutoken EDS</strong> <strong>上的</strong> CEP </li><li>  <strong>CryptoPro格式的cryptocontainer</strong> </li><li> 具有<strong>CryptoPro CSP的</strong>内置<strong>许可证</strong> </li><li> 公共证书必须存储在私钥容器中 </li></ol><br><p> 不支持将EToken和JaCarta媒体与CryptoPro for macOS结合使用。 运营商Rutoken Lite是最好的选择，它的价格为500..1000 =卢布，它运行智能，最多可以存储15个密钥。 </p><br><p>  macOS不支持VipNet，Signal-COM和LISSI密码提供程序。 转换容器不起作用。  CryptoPro是最佳选择，证书的费用应约为1300 =卢布。 对于SP和1600 =擦。 为Yul。 </p><br><p> 通常，CryptoPro CSP的年度许可证已连接到证书中，并且许多CA是免费提供的。 如果不是这样，则您需要购买并激活价值2700 =的CryptoPro CSP严格版本4的永久许可证。 适用于macOS的CryptoPro CSP版本5当前不起作用。 </p><br><p> 通常，公共证书存储在私钥容器中，但是在颁发CEP时需要对此进行澄清，并要求根据需要进行操作。 如果不起作用，则可以使用Windows的CryptoPro CSP自己将公共密钥导入封闭的容器中。 </p><br><h2 id="ustanavlivaem-i-nastraivaem-kep-pod-macos"> 为macOS安装和配置CEP </h2><br><div class="spoiler">  <b class="spoiler_title">明显的事情</b> <div class="spoiler_text"><ul><li> 所有下载的文件都下载到默认目录：〜/ Downloads /; </li><li> 我们不会在所有安装程序中进行任何更改，而是默认保留所有内容； </li><li> 如果macOS显示警告，提示正在启动的软件来自已卸载的开发人员，则需要在系统设置中确认启动： <em>系统偏好设置-&gt;安全和隐私-&gt;</em>仍然<em>打开</em> ； </li><li> 如果macOS要求输入用户密码和控制计算机的权限，则需要输入密码并同意一切。 </li></ul></div></div><br><h3 id="1-ustanavlivaem-kriptopro-csp">  1.安装CryptoPro CSP </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我们</a>在CryptoPro网站上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">注册</a> ，并从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载页面</a> <strong><a href="">下载</a></strong>并下载并安装<em>macOS</em>的<em>CryptoPro CSP <strong>4.0 R4</strong></em>版本。 </p><br><h3 id="2-ustanavlivaem-drayvery-rutoken">  2.安装Rootoken驱动程序 </h3><br><p> 该网站说它是可选的，但最好交付。 在Rutoken网站上的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载页面</a>上，下载并安装<em>KeyChain支持模块</em> -download。 </p><br><p> 接下来，连接usb令牌，运行终端并执行以下命令： </p><br><pre><code class="bash hljs">/opt/cprocsp/bin/csptest -card -enum</code> </pre> <br><p> 答案应该是： </p><br><blockquote>  Aktiv Rutoken ... <br> 卡存在... <br>  [错误代码：0x00000000] </blockquote><br><h3 id="3-ustanavlivaem-sertifikaty">  3.安装证书 </h3><br><h4 id="31-udalyaem-vse-starye-gostovskie-sertifikaty">  3.1。 我们删除所有旧的GOST证书 </h4><br><p> 如果以前曾尝试在macOS下运行CEP，则必须清除所有以前安装的证书。 终端中的这些命令仅会删除CryptoPro证书，并且不会影响macOS上来自Keychain的普通证书。 </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -delete -all -store mroot</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -delete -all -store uroot</code> </pre> <br><pre> <code class="bash hljs">/opt/cprocsp/bin/certmgr -delete -all</code> </pre> <br><p> 每个命令的响应应为： </p><br><blockquote> 没有符合条件的证书 </blockquote><p> 或 </p><br><blockquote> 删除完成 </blockquote><br><h4 id="32-ustanavlivaem-kornevye-sertifikaty">  3.2。 安装根证书 </h4><br><p> 根证书对于任何证书颁发机构颁发的所有CEP都是通用的。 从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">乌拉尔</a>联邦区交通部的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载页面下载</a> ： </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=4BC6DC14D97010C41A26E058AD851F81C842415A</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=8CAE88BBFD404A7A53630864F9033606E1DC45E2</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=0408435EB90E5C8796A160E69E4BFAC453435D1D</a> </li></ul><br><p> 在终端中安装以下命令： </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/4BC6DC14D97010C41A26E058AD851F81C842415A.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/8CAE88BBFD404A7A53630864F9033606E1DC45E2.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/0408435EB90E5C8796A160E69E4BFAC453435D1D.cer</code> </pre> <br><p> 每个团队应返回： </p><br><blockquote> 安装： <br>  ... <br>  [错误代码：0x00000000] </blockquote><br><h4 id="33-skachivaem-sertifikaty-udostoveryayuschego-centra">  3.3。 下载认证中心证书 </h4><br><p> 接下来，您需要在颁发CEP的位置安装证书颁发机构的证书。 通常，每个CA的根证书位于其网站的“下载”部分中。 </p><br><p> 或者，可以从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">交通部乌拉尔联邦区</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">网站</a>下载任何CA的证书。 为此，您需要在搜索表单中按名称查找CA，转到包含证书的页面并下载所有<strong>有效的</strong>证书-即那些第二个日期尚未到达<em>“有效”</em>字段的证书。 从<em>“版本说明”</em>字段下载链接。 </p><br><div class="spoiler">  <b class="spoiler_title">屏幕截图</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/k6/xx/q4/k6xxq4czjusuqkbsqols_hbliei.png"></p><br><p><img src="https://habrastorage.org/webt/dt/oc/tw/dtoctw3qxq3qr6sbusinltnei2y.png"></p></div></div><br><p> 在CA Corus Consulting的示例中：您需要从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载页面</a>下载4个证书： </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=15EB064ABCB96C5AFCE22B9FEA52A1964637D101</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=B9F1D3F78971D48C34AA73786CDCD138477FEE3F</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=55EC48193B6716D38E80BD9D1D2D827BC8A07DE3</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://e-trust.gosuslugi.ru/Shared/DownloadCert?thumbprint=A0D19D700E2A5F1CAFCE82D3EFE49A0D882559DF</a> </li></ul><br><p> 我们使用来自终端的命令安装下载的CA证书： </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/B9F1D3F78971D48C34AA73786CDCD138477FEE3F.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/A0D19D700E2A5F1CAFCE82D3EFE49A0D882559DF.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/55EC48193B6716D38E80BD9D1D2D827BC8A07DE3.cer</code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/certmgr -inst -store mroot -f ~/Downloads/15EB064ABCB96C5AFCE22B9FEA52A1964637D101.cer</code> </pre> <br><p>  <em>〜/ Downloads /之后</em>是下载文件的名称，对于每个CA，它们将有所不同。 </p><br><p> 每个团队应返回： </p><br><blockquote> 安装： <br>  ... <br>  [错误代码：0x00000000] </blockquote><br><h4 id="34-ustanavlivaem-sertifikat-s-rutoken">  3.4。 使用Rutoken安装证书 </h4><br><p> 终端中的命令： </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptestf -absorb -certs</code> </pre> <br><p> 团队必须返回： </p><br><blockquote> 好啦 <br>  [错误代码：0x00000000] </blockquote><br><h4 id="35-konfiguriruem-cryptopro-dlya-raboty-ssertifikatami-gost-r-3410-2012">  3.5。 配置CryptoPro以使用GOST R 34.10-2012证书 </h4><br><p> 要使用自2019年以来发行的证书在nalog.ru上正常工作，CryptoPro网站上的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">说明</a>建议： </p><br><p> 终端中的命令： </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/sbin/cpconfig -ini <span class="hljs-string"><span class="hljs-string">'\cryptography\OID\1.2.643.7.1.1.1.1!3'</span></span> -add string <span class="hljs-string"><span class="hljs-string">'Name'</span></span> <span class="hljs-string"><span class="hljs-string">'GOST R 34.10-2012 256 bit'</span></span></code> </pre> <br><pre> <code class="bash hljs">sudo /opt/cprocsp/sbin/cpconfig -ini <span class="hljs-string"><span class="hljs-string">'\cryptography\OID\1.2.643.7.1.1.1.2!3'</span></span> -add string <span class="hljs-string"><span class="hljs-string">'Name'</span></span> <span class="hljs-string"><span class="hljs-string">'GOST R 34.10-2012 512 bit'</span></span></code> </pre> <br><p> 团队不返回任何东西。 </p><br><h3 id="4-ustanavlivaem-specialnyy-brauzer-chromium-gost">  4.安装特殊的浏览器Chromium-GOST </h3><br><p> 要使用政府门户网站，您需要特殊的铬浏览器组件<strong>Chromium-GOST</strong> 。 该项目的源代码是开放的， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在CryptoPro网站</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上</a>提供<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">了</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub上存储库</a>的链接。 根据经验，其他浏览器<em>CryptoFox</em>和<em>Yandex.Browser</em>不适合与macOS的政府门户一起使用。 值得考虑的是，在Chromium-GOST的某些程序集中，nalog.ru上的个人帐户可能会冻结或滚动完全停止工作，因此建议使用旧的可靠<strong>程序集71.0.3578.98-</strong> <strong><a href="">下载</a></strong> 。 </p><br><p> 下载并解压缩存档，通过复制安装浏览器，或拖放到“应用程序”目录。 安装后，使用终端命令强制关闭Chromium-Gost，但尚未将其打开（我们在Safari中工作）： </p><br><pre> <code class="bash hljs">killall Chromium-Gost</code> </pre> <br><h3 id="5-ustanavlivaem-rasshireniya-dlya-brauzera">  5.安装浏览器扩展 </h3><br><h4 id="51-kriptopro-ecp-browser-plug-in">  5.1 CryptoPro EDS浏览器插件 </h4><br><p> 在CryptoPro网站上的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载页面</a>上， <em>为用户</em>下载并安装<em>CryptoPro EDS Browser插件版本2.0-</em> <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载</a></strong> 。 </p><br><h4 id="52-plagin-dlya-gosuslug">  5.2。 政府服务插件 </h4><br><p> 在Gosuslug门户的<a href="">下载页面</a>上，下载并安装<em>用于与政府服务门户（macOS的版本）配合使用的插件</em> - <strong><a href="">下载</a></strong> 。 </p><br><h4 id="53-nastraivaem-plagin-dlya-gosuslug">  5.3。 设置公共服务插件 </h4><br><p> 在标准GOST2012中下载正确的配置文件以扩展政府服务，以支持macOS和新的数字签名。 </p><br><p> 我们在终端中执行命令： </p><br><pre> <code class="bash hljs">sudo rm /Library/Internet\ Plug-Ins/IFCPlugin.plugin/Contents/ifc.cfg</code> </pre> <br><pre> <code class="bash hljs">sudo cp ~/Downloads/ifc.cfg /Library/Internet\ Plug-Ins/IFCPlugin.plugin/Contents</code> </pre> <br><pre> <code class="bash hljs">sudo cp /Library/Google/Chrome/NativeMessagingHosts/ru.rtlabs.ifcplugin.json /Library/Application\ Support/Chromium/NativeMessagingHosts</code> </pre> <br><h4 id="54-aktiviruem-rasshireniya">  5.4。 激活扩展 </h4><br><p> 我们启动Chromium-Gost浏览器，然后在地址栏中键入： </p><br><pre> <code class="plaintext hljs">chrome://extensions/</code> </pre> <br><p> 我们包括两个已安装的扩展： </p><br><ul><li> 用于CAdES浏览器插件的CryptoPro扩展 </li><li> 公共服务插件扩展 </li></ul><br><div class="spoiler">  <b class="spoiler_title">屏幕截图</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/7b/qz/0-/7bqz0-z9zmnua0q7xs9qdcr63ak.png"></p></div></div><br><h4 id="55-nastraivaem-rasshirenie-kriptopro-ecp-browser-plug-in">  5.5。 我们配置扩展CryptoPro EDS Browser插件 </h4><br><p> 在Chromium-Gost的地址栏中输入： </p><br><pre> <code class="plaintext hljs">/etc/opt/cprocsp/trusted_sites.html</code> </pre> <br><p> 在出现的页面上，我们将站点依次添加到受信任站点列表中： </p><br><pre> <code class="plaintext hljs">https://*.cryptopro.ru https://*.nalog.ru https://*.gosuslugi.ru</code> </pre> <br><p> 点击“保存”。 一个绿色的骰子应该出现： </p><br><blockquote> 可信站点列表已成功保存。 </blockquote><br><div class="spoiler">  <b class="spoiler_title">屏幕截图</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wy/xx/5h/wyxx5hsubwkvcxtw-luvoregeng.png"></p></div></div><br><h3 id="6-proveryaem-chto-vse-rabotaet">  6.检查一切正常 </h3><br><h4 id="61-zahodim-na-testovuyu-stranicu-kriptopro">  6.1。 我们转到测试页面CryptoPro </h4><br><p> 在Chromium-Gost的地址栏中输入： </p><br><pre> <code class="plaintext hljs">https://www.cryptopro.ru/sites/default/files/products/cades/demopage/cades_bes_sample.html</code> </pre> <br><p> 应该显示“已加载插件”，并且您的证书应该在下面的列表中。 <br> 从列表中选择一个证书，然后单击“签名”。 将要求证书PIN。 结果应显示 </p><br><blockquote> 签名生成成功 </blockquote><br><div class="spoiler">  <b class="spoiler_title">屏幕截图</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/v9/id/m_/v9idm_5w3mnwdcucyt5edpyhceo.png"></p></div></div><br><h4 id="62-zahodim-v-lichnyy-kabinet-na-nalogru">  6.2。 我们进入nalog.ru上的个人帐户 </h4><br><p> 可能无法访问nalog.ru网站上的链接，因为 支票将无法通过。 您需要转到直接链接： </p><br><ul><li>  <strong>IP</strong>个人帐户： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//lkipgost.nalog.ru/lk</a> </li><li>  <strong>法人实体的</strong>个人帐户： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//lkul.nalog.ru</a> </li></ul><br><div class="spoiler">  <b class="spoiler_title">屏幕截图</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fn/2f/gf/fn2fgfejidrtpokh3xdlap4j0ny.png"></p></div></div><br><h4 id="63-zahodim-na-gosuslugi">  6.3。 我们去公共服务 </h4><br><p> 授权期间，选择“使用电子签名登录”。 在出现的列表“选择用于电子签名验证密钥的证书”中，将显示所有证书，包括root和CA，您需要从usb令牌中选择您的证书并输入PIN。 </p><br><div class="spoiler">  <b class="spoiler_title">屏幕截图</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/k1/il/ie/k1iliepylyukk20xl-e_ooj4ab0.png"></p><br><p><img src="https://habrastorage.org/webt/gi/ex/hf/giexhftwmegvxgj_k4bahsn7sz4.png"></p></div></div><br><h3 id="7-chto-delat-esli-perestalo-rabotat">  7.如果停止工作该怎么办 </h3><br><ol><li><p> 我们重新连接usb令牌，并使用终端中的命令验证它是否可见： </p><br><pre> <code class="bash hljs">sudo /opt/cprocsp/bin/csptest -card -enum</code> </pre> <br></li><li><p> 我们一直清除浏览器缓存，为此我们在Chromium-Gost的地址栏中输入： </p><br><pre> <code class="plaintext hljs"> chrome://settings/clearBrowserData</code> </pre> <br></li><li><p> 使用终端中的命令重新安装CEP证书： </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptestf -absorb -certs</code> </pre> <br></li></ol><br><h2 id="smena-pin-koda-konteynera"> 更改容器PIN </h2><br><p>  Rutoken的默认PIN码为<em>12345678</em> ，您不能原样保留。  Rootoken PIN码的要求：最多16个字符，可以包含拉丁字母和数字。 </p><br><h3 id="1-vyyasnyaem-nazvanie-konteynera-kep">  1.找出容器CEP的名称 </h3><br><p> 在USB令牌和其他存储中，可以存储多个证书，您需要选择正确的证书。 插入usb令牌后，我们可以使用终端中的命令获取系统中所有容器的列表： </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptest -keyset -enum_cont -fqcn -verifycontext</code> </pre> <br><p> 团队必须带出至少1个容器并返回 </p><br><blockquote>  [错误代码：0x00000000] </blockquote><p> 我们需要的容器是以下形式 </p><br><blockquote>  \。\ Aktiv Rutoken lite \ XXXXXXXX </blockquote><p> 如果有多个这样的容器，则意味着在令牌上写入了多个证书，并且您知道需要哪一个。 需要将斜杠后的值<em>XXXXXXXX</em>复制并替换为以下命令。 </p><br><h3 id="2-smena-pin-komandoy-iz-terminal">  2.从终端更改PIN命令 </h3><br><pre> <code class="bash hljs">/opt/cprocsp/bin/csptest -passwd -qchange -container <span class="hljs-string"><span class="hljs-string">"XXXXXXXX"</span></span></code> </pre> <br><p> 其中<em>XXXXXXXX</em>是在步骤1中获得的容器名称（用引号引起）。 </p><br><p> 将出现一个CryptoPro对话框，要求输入旧的PIN码以访问证书，然后出现另一个对话框，输入新的PIN码。 做完了 </p><br><div class="spoiler">  <b class="spoiler_title">屏幕截图</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xh/fr/9i/xhfr9imuu1gh-uxgvekeqleptyw.png"></p></div></div><br><h2 id="podpis-faylov-v-macos"> 在macOS上签名文件 </h2><br><p> 在macOS中，可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CryptoArm</a>软件（许可证费用2500 =卢布）对文件进行签名，也可以通过终端使用简单的命令进行签名-免费。 </p><br><h3 id="1-vyyasnyaem-hesh-sertifikata-kep">  1.找出CEP证书的哈希值 </h3><br><p> 令牌和其他存储中可以有多个证书。 有必要唯一标识一个我们将继续与之签名文件的人。 完成一次。 <br> 必须插入令牌。 我们使用来自终端的命令获取存储库中的证书列表： </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/certmgr -list</code> </pre> <br><p> 团队必须至少显示以下格式的一张证书： </p><br><blockquote>  Certmgr 1.1©“ Crypto-Pro”，2007-2018。 <br> 用于管理证书，CRL和存储的程序 <br>  ===================== <br>  1 ------- <br> 发行人：E = help @ esphere.ru，... CN = KORUS Consulting CIS LLC ... <br> 主题：E = sergzah @ gmail.com，... CN = Zakharov Sergey Anatolyevich ... <br> 序列号：0x000000000000000000000000000000000000000000 <br>  SHA1哈希：XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX <br>  ... <br> 容器：SCARD \ rutoken_lt_00000000 \ 0000 \ 0000 <br>  ... <br>  ===================== <br>  [错误代码：0x00000000] </blockquote><p> 我们需要在Container参数中使用的证书的值应为<em>SCARD \ rutoken ....</em> 如果有多个具有此类值的证书，则意味着在令牌上写入了多个证书，并且您知道需要哪一个。 必须将<em>SHA1哈希</em>参数的值（40个字符）复制并替换为以下命令。 </p><br><h3 id="2-podpis-fayla-komandoy-iz-terminal">  2.使用来自终端的命令对文件签名 </h3><br><p> 在终端中，转到包含用于签名的文件的目录，然后运行命令： </p><br><pre> <code class="bash hljs">/opt/cprocsp/bin/cryptcp -signf -detach -cert -der -strict -thumbprint  FILE</code> </pre> <br><p> 其中<em>...</em>是在步骤1中获得的证书哈希，而<em>FILE</em>是要签名的文件的名称（带有所有扩展名，但没有路径）。 </p><br><p> 团队必须返回： </p><br><blockquote> 签名消息已创建。 <br>  [错误代码：0x00000000] </blockquote><p> 将创建扩展名为* .sgn的电子签名文件-这是CMS格式的，DER编码的断开签名。 </p><br><h3 id="3-ustanovka-apple-automator-script">  3.安装Apple Automator脚本 </h3><br><p> 为了每次都不能在终端上使用，可以安装一次Automator Script，使用该脚本可以从Finder上下文菜单中签名文档。 为此，请下载存档<strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-download</a></strong> 。 </p><br><ol><li> 解压档案<em>“使用CryptoPro.zip签名”</em> </li><li> 启动<em>自动器</em> </li><li> 查找并打开解压缩的文件<em>“使用CryptoPro.workflow签名”</em> </li><li> 在<em>Run Shell Script</em>块中，将文本<em></em>的文本<em>更改</em>为上面获得的CEP证书的<em>SHA1哈希</em>参数的值。 </li><li> 保存脚本：⌘Command+ S </li><li> 运行文件<em>“ Sign with CryptoPro.workflow”</em>并确认安装。 </li><li> 转到系统<em>偏好设置-&gt;扩展-&gt; Finder，</em>并验证是否选中了“ <em>使用CryptoPro签名”</em>快速操作。 </li><li> 在Finder中，调用任何文件的上下文菜单，然后在“ <em>快速操作</em>和/或<em>服务”</em>部分中，选择“ <strong>使用CryptoPro签名”</strong> </li><li> 在出现的CryptoPro对话框中，从CEP输入用户PIN </li><li> 扩展名为* .sgn的文件将出现在当前目录中-CMS格式的，DER编码的断开签名。 </li></ol><br><div class="spoiler">  <b class="spoiler_title">屏幕截图</b> <div class="spoiler_text"><p>  Apple Automator窗口： <br><img src="https://habrastorage.org/webt/ci/md/am/cimdamgbcmuwupqnikoxm4zlr0u.png"></p><br><p> 系统偏好设置： <br><img src="https://habrastorage.org/webt/ds/aj/4y/dsaj4ybkjxfuc72-ujruj0jor1c.png"></p><br><p> 上下文菜单查找器： </p><br><p><img src="https://habrastorage.org/webt/n5/sz/8y/n5sz8ylptnlud2tdd3o4pvkvqk4.png"></p></div></div><br><h2 id="proverit-podpis-na-dokumente"> 验证文件上的签名 </h2><br><p> 如果文档的内容不包含秘密和秘密，那么最简单的方法是在Gosuslug门户上使用Web服务-https: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//www.gosuslugi.ru/pgu/eds</a> 。 因此，您可以从权威资源中截取屏幕截图，并确保一切正常，并带有签名。 </p><br><div class="spoiler">  <b class="spoiler_title">屏幕截图</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/8u/8m/rk/8u8mrkglxf7z5nzdxmo4f7nj66k.png"></p><br><p><img src="https://habrastorage.org/webt/63/7p/od/637pod0rngetfm1nudyyse-3h2q.png"></p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN450516/">https://habr.com/ru/post/zh-CN450516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN450504/index.html">如何在几个小时内从网站制作应用程序并将其放置在Google Play上。 第1/2部分：渐进式Web应用</a></li>
<li><a href="../zh-CN450506/index.html">如何在几个小时内从网站制作应用程序并将其放置在Google Play上。 第2/2部分：受信任的Web活动</a></li>
<li><a href="../zh-CN450508/index.html">Joe Armstrong关于Elixir，Erlang，FP和OOP</a></li>
<li><a href="../zh-CN450510/index.html">高负载IT系统的操作和支持过程中的五个问题</a></li>
<li><a href="../zh-CN450514/index.html">CVT vs状态</a></li>
<li><a href="../zh-CN450518/index.html">Arduino和处理。 如何通过COM端口控制微控制器。 双向通讯</a></li>
<li><a href="../zh-CN450520/index.html">创建可靠且经过验证的AI：符合规范，可靠的培训和形式验证</a></li>
<li><a href="../zh-CN450522/index.html">互联网历史记录：衰变，第1部分</a></li>
<li><a href="../zh-CN450524/index.html">通过电报进行计算机控制</a></li>
<li><a href="../zh-CN450526/index.html">10. Check Point入门R80.20。 身份意识</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>