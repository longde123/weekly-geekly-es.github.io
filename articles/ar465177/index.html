<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌙 💄 🤐 ليست واحدة من بقايا جديدة: نظرة على Datadog و Atatus 🛰️ 🥠 🦗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="في بيئة SRE- / DevOps- المهندسين ، لن تتفاجأ من ظهور عميل (أو نظام مراقبة) في أحد الأيام ويقول: "كل شيء ضائع": الموقع لا يعمل ، المدفوعات لا تمر ، الح...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ليست واحدة من بقايا جديدة: نظرة على Datadog و Atatus</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/465177/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rp/lp/ct/rplpctt6yzam8cvxnufgkygd3um.png"><br><br>  في بيئة SRE- / DevOps- المهندسين ، لن تتفاجأ من ظهور عميل (أو نظام مراقبة) في أحد الأيام ويقول: "كل شيء ضائع": الموقع لا يعمل ، المدفوعات لا تمر ، الحياة قابلة للتلف ... بغض النظر عن الطريقة التي أرغب في المساعدة في هذا الموقف قد يكون من الصعب للغاية القيام بذلك بدون أداة بسيطة ومفهومة.  غالبًا ما يتم إخفاء المشكلة في رمز التطبيق نفسه - تحتاج فقط إلى توطينها. <br><br><h2 style=";text-align:right;direction:rtl">  وفي الحزن والفرح ... </h2><br>  لقد حدث ذلك منذ فترة طويلة كنا مغرمين جدا من بقايا جديدة.  لقد كانت ولا تزال أداة ممتازة لمراقبة أداء التطبيقات ، كما تتيح لك استخدام بنية الخدمة الميكروية (باستخدام وكيلك) وأكثر من ذلك بكثير.  وقد يكون كل شيء رائعًا ، إن لم يكن للتغيرات التي تطرأ على سياسة التسعير الخاصة بالخدمة: <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لقد</a> زادت تكلفتها ثلاث مرات أو أكثر <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">منذ عام 2013</a></b> .  بالإضافة إلى ذلك ، منذ العام الماضي ، يتطلب الحصول على حساب تجريبي التواصل مع مدير شخصي ، مما يجعل من الصعب تقديم المنتج إلى عميل محتمل. <a name="habracut"></a><br><br>  الوضع المعتاد: ليست هناك حاجة إلى Relic New "على أساس مستمر" ، ولا يتم تذكره إلا في الوقت الذي بدأت فيه المشكلات.  ولكن لا يزال يتعين عليك الدفع بانتظام (140 دولارًا أمريكيًا لكل خادم شهريًا) ، وفي البنية التحتية السحابية القابلة للتطوير تلقائيًا ، تكون المبالغ كبيرة إلى حد ما.  على الرغم من وجود إمكانية "الدفع أثناء الاستخدام" ، ولكن لتمكين ميزة New Relic ، فستحتاج إلى إعادة تشغيل التطبيق ، مما قد يؤدي إلى فقدان موقف المشكلة الذي بدأ كل شيء من أجله.  منذ وقت ليس ببعيد ، قدمت New Relic خطة تعريفة جديدة - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Essentials</a> ، والتي تبدو للوهلة الأولى بديلاً معقولًا عن Professional ... ولكن بعد الفحص الدقيق ، تبين أن بعض الوظائف المهمة مفقودة (على وجه الخصوص ، ليس لديها <i>معاملات أساسية</i> ، <i>تتبُّع التطبيقات المتقاطعة</i> ، <i>التتبع الموزع</i> ) . <br><br>  نتيجة لذلك ، فكرنا في إيجاد بديل أرخص ، ووقع خيارنا على خدمتين Datadog و Atatus.  لماذا بالضبط عليهم؟ <br><br><h2 style=";text-align:right;direction:rtl">  عن المنافسين </h2><br>  يجب أن أقول على الفور أن هناك حلول أخرى في السوق.  لقد درسنا حتى خيارات Open Source ، لكن ليس لكل عميل القدرة المجانية على استضافة حلول ذاتية الاستضافة ... - بالإضافة إلى ذلك ، سوف يحتاجون إلى صيانة إضافية.  تبين أن الزوجين اللذين اخترناهما قريبان من <b>احتياجاتنا</b> : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  دعم مدمج ومطور لتطبيقات PHP (مجموعة عملاءنا متنوعة للغاية ، لكنها رائدة بشكل واضح في سياق إيجاد بديل للآثار الجديدة) ؛ </li><li style=";text-align:right;direction:rtl">  التكلفة المعقولة (أقل من 100 دولار شهريًا لكل مضيف) ؛ </li><li style=";text-align:right;direction:rtl">  الأجهزة الآلية. </li><li style=";text-align:right;direction:rtl">  التكامل Kubernetes </li><li style=";text-align:right;direction:rtl">  تشابه واجهة New Relic هو علامة ملحوظة (لأن مهندسينا معتادون عليها). </li></ul><br>  لذلك ، في مرحلة الاختيار الأولي ، قمنا بإلغاء العديد من الحلول الشائعة الأخرى ، وعلى وجه الخصوص: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Tideways ، AppDynamics و Dynatrace - للحصول على السعر ؛ </li><li style=";text-align:right;direction:rtl">  Stackify - محظور في الاتحاد الروسي ويظهر القليل جدًا من البيانات. </li></ul><br>  تم تصميم المقالة التالية بطريقة تعرض الحلول قيد النظر لفترة وجيزة ، وبعد ذلك سأتحدث عن تفاعلنا النموذجي مع New Relic وتجربة / انطباعات أداء عمليات مماثلة في خدمات أخرى. <br><br><h3 style=";text-align:right;direction:rtl">  عرض المنافسين المختارين </h3><br><img src="https://habrastorage.org/webt/mu/el/kq/muelkqnuiwzgvaz_jtton8mrbzs.png"><br>  ربما سمع الجميع عن <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>بقايا جديدة</b></a> ؟  بدأت هذه الخدمة في تطويرها منذ أكثر من 10 سنوات ، في عام 2008.  لقد استخدمناها بنشاط منذ عام 2012 ولم نواجه مشكلات تكامل مع عدد كبير من التطبيقات في PHP و Ruby و Python ، كما كانت لدينا تجربة في الدمج مع C # و Go.  يمتلك مؤلفو الخدمة حلولًا لمراقبة التطبيق والبنية التحتية وتتبع البنية التحتية للخدمات الدقيقة والتطبيقات الملائمة لأجهزة المستخدمين التي تم إنشاؤها والمزيد. <br><br>  ومع ذلك ، فإن وكيل New Relic يعمل على بروتوكولات الملكية ، وليس لديه دعم OpenTracing.  تتطلب الأجهزة المتقدمة تعديلات خاصة بـ New Relic.  أخيرًا ، دعم Kubernetes له حالة تجريبية حتى الآن. <br><br><img src="https://habrastorage.org/webt/4t/ae/fp/4taefp5hohou0ekzzmcrnduvzlu.png"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>تبدو Datadog</b></a> ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>التي</b></a> بدأت تطويرها في عام 2010 ، أكثر إثارة للاهتمام بشكل ملحوظ من New Relic من حيث استخدامها في بيئات Kubernetes.  على وجه الخصوص ، يدعم التكامل مع بروتوكولات NGINX Ingress وجمع السجلات و statsd و OpenTracing ، مما يسمح لك بتتبع طلب المستخدم من لحظة اتصاله بنهاية العمل ، وكذلك البحث عن سجلات لهذا الطلب (سواء على جانب خادم الويب أو على جانبه consumer'ov). <br><br>  عند استخدام Datadog ، واجهنا حقيقة أنه في بعض الأحيان قد صمم بشكل غير صحيح خريطة خدمة دقيقة وبعض العيوب الفنية.  على سبيل المثال ، قام بتحديد نوع الخدمة بشكل غير صحيح (أخذ جانغو لخدمة تخزين مؤقت) وتسبب في حدوث الأخطاء رقم 500 في تطبيق PHP باستخدام مكتبة Predis الشائعة. <br><br><img src="https://habrastorage.org/webt/h5/te/m9/h5tem9e4arkqlsoed48qc0u9xha.png"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><b>Atatus</b></a> هو أصغر أداة ؛  أطلقت الخدمة في عام 2014.  من الواضح أن ميزانية التسويق أقل شأناً من المنافسين المدرجين في القائمة ، ويذكر أنها أقل شيوعًا.  ومع ذلك ، فإن الأداة نفسها تشبه إلى حد بعيد New Relic ، وليس فقط في الميزات (APM ، مراقبة المتصفح ، وما إلى ذلك) ، ولكن أيضًا في المظهر. <br><br>  عيب كبير هو دعم فقط ل Node.js و PHP.  من ناحية أخرى ، يتم تنفيذه أفضل بكثير من Datadog.  على عكس الأخير ، لا يتطلب Atatus من التطبيقات تعديل أو تعيين علامات إضافية في التعليمات البرمجية. <br><br><h2 style=";text-align:right;direction:rtl">  كيف نعمل مع بقايا جديدة </h2><br>  الآن دعونا نتعرف على الطريقة التي نستخدم بها بقايا جديدة.  لنفترض أن لدينا مشكلة تحتاج إلى حل: <br><br><img src="https://habrastorage.org/webt/mk/_t/bv/mk_tbvlysng7--qgh2gvhjum4cg.png"><br><br>  من السهل ملاحظة <b>زيادة</b> في الرسم البياني - نحللها.  في New Relic ، يتم تحديد المعاملات على شبكة الإنترنت فورًا لتطبيق الويب ، وتتم الإشارة إلى جميع المكونات في الرسم البياني للأداء ، وهناك لوحات معدل الخطأ ، وطلب معدل ... والأهم من ذلك ، يمكنك الانتقال مباشرة بين هذه اللوحات من أجزاء مختلفة من التطبيق (على سبيل المثال ، يؤدي النقر فوق MySQL إلى إلى قسم قاعدة البيانات). <br><br>  نظرًا لأننا في هذا المثال ، نرى طفرة في نشاط <b>PHP</b> ، انقر على هذا المخطط وانتقل تلقائيًا إلى <b>المعاملات</b> : <br><br><img src="https://habrastorage.org/webt/02/2v/b_/022vb_o0euwqk8jaf2qh1z4pges.png"><br><br>  يتم فرز قائمة المعاملات ، والتي هي أساسًا وحدات تحكم من طراز MVC ، بالفعل وفقًا <b>لمعظم الوقت الذي يستغرق وقتًا طويلًا</b> ، وهو مريح للغاية: نرى على الفور ما يفعله التطبيق.  فيما يلي أمثلة على الاستعلامات الطويلة التي يتم جمعها تلقائيًا بواسطة New Relic.  من السهل العثور على التبديل بين الفرز: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  وحدة تحكم التطبيق الأكثر تحميلا. </li><li style=";text-align:right;direction:rtl">  وحدة التحكم الأكثر طلبا </li><li style=";text-align:right;direction:rtl">  أبطأ من وحدات التحكم. </li></ul><br>  بالإضافة إلى ذلك ، يمكنك توسيع كل معاملة ومعرفة ما كان يقوم به التطبيق في وقت تنفيذ التعليمات البرمجية: <br><br><img src="https://habrastorage.org/webt/vq/bz/sk/vqbzsk-cj4sp9prjqwx16hnzy4k.png"><br><br>  أخيرًا ، يتم حفظ أمثلة تتبعات الاستعلام الطويلة (والتي تعمل لأكثر من ثانيتين) في التطبيق.  هنا هي لوحة لمعاملة طويلة: <br><br><img src="https://habrastorage.org/webt/jk/b_/ux/jkb_uxm9a3tx9ed6wdtufrz5g6u.png"><br><br>  يمكن ملاحظة أن طريقتين تستغرقان الكثير من الوقت ، ومعه الوقت الذي تم فيه تنفيذ الطلب ، يتم عرض URI ونطاقه أيضًا.  في كثير من الأحيان هذا يساعد على العثور على الاستعلام في السجلات.  بالانتقال إلى <b>تفاصيل التتبع</b> ، يمكنك معرفة أين يتم استدعاء هذه الطرق من: <br><br><img src="https://habrastorage.org/webt/_1/m6/li/_1m6li8g6zgv8siatzj1mrqiclc.png"><br><br>  وفي <b>استعلامات قاعدة البيانات</b> - تقييم استعلامات قاعدة البيانات التي تم تنفيذها في وقت التطبيق: <br><br><img src="https://habrastorage.org/webt/ru/xv/k7/ruxvk7jbfe-93duilolwh3nj7p8.png"><br><br>  مسلحين بهذه المعرفة ، يمكننا تقييم سبب تباطؤ التطبيق ، ومع المطور ، وضع إستراتيجية لحل المشكلة.  في الواقع ، لا تقدم New Relic دائمًا صورة واضحة ، ولكنها تساعد في اختيار متجه التحقيق: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>PDO::Construct</code> الطويلة أدت بنا إلى الأداء الغريب لـ pgpoll ؛ </li><li style=";text-align:right;direction:rtl">  عدم الاستقرار في الوقت <code>Memcache::Get</code> التكوين غير الصحيح المقترح للجهاز الظاهري ؛ </li><li style=";text-align:right;direction:rtl">  أدى الوقت المتزايد بشكل مثير للريبة لمعالجة القالب إلى حلقة متداخلة مع التحقق من وجود 500 تجسيدات في تخزين العنصر ؛ </li><li style=";text-align:right;direction:rtl">  وهلم جرا ... </li></ul><br>  يحدث أيضًا أنه بدلاً من تنفيذ التعليمات البرمجية على الشاشة الرئيسية ، ينمو شيء متعلق بتخزين البيانات الخارجي - ولا يهم ما سيكون عليه: Redis أو PostgreSQL - جميعها مخفية في علامة تبويب <b>قواعد البيانات</b> . <br><br><img src="https://habrastorage.org/webt/ku/ke/xe/kukexe0cn79kgj_x_40dt79au5e.png"><br><br>  يمكنك تحديد قاعدة محددة للبحث وفرز الاستعلامات - على غرار الطريقة التي يتم بها ذلك في المعاملات.  وبالانتقال إلى علامة التبويب "الطلب" ، يمكنك معرفة مقدار العثور على هذا الطلب في كل من وحدات التحكم في التطبيق ، وكذلك تقييم عدد مرات استدعاء هذا الطلب.  هذا مريح جدا: <br><br><img src="https://habrastorage.org/webt/ac/jm/xq/acjmxqt0dop9r1ncalo1enmrihq.png"><br><br>  تحتوي علامة تبويب <b>الخدمات الخارجية</b> على بيانات متشابهة تخفي طلبات خدمات HTTP الخارجية ، مثل الوصول إلى ملف تخزين العناصر أو إرسال الأحداث إلى الحراسة أو ما شابه ذلك.  من خلال محتواها ، تشبه علامة التبويب قواعد البيانات تمامًا: <br><br><img src="https://habrastorage.org/webt/vv/2h/al/vv2halrqjfjjpqltn7ty1had57y.png"><br><br><h2 style=";text-align:right;direction:rtl">  المنافسون: الفرص والانطباعات </h2><br>  الآن الشيء الأكثر إثارة للاهتمام هو مقارنة قدرات New Relic مع ما يقدمه المنافسون.  لسوء الحظ ، لم نتمكن من اختبار الأدوات الثلاثة على نفس الإصدار من تطبيق واحد قيد التشغيل.  ومع ذلك ، حاولنا مقارنة الحالات / التكوينات الأكثر متطابقة. <br><br><h3 style=";text-align:right;direction:rtl">  1. Datadog </h3><br>  يرحب بنا Datadog بلوحة مع جدار من الخدمات: <br><br><img src="https://habrastorage.org/webt/yt/vv/rt/ytvvrt5tlhegxiaoanulug0dwfu.png"><br><br>  إنه يحاول تقسيم التطبيقات إلى مكونات / خدمات microservices ، لذلك في تطبيق Django المثال ، نرى <code>defaultdb</code> بـ PostgreSQL ( <code>defaultdb</code> و <code>postgres</code> ) ، بالإضافة إلى Celery و <code>defaultdb</code> .  يتطلب العمل مع Datadog أن يكون لديك الحد الأدنى من المعرفة بمبادئ MVC: عليك أن تفهم من أين تأتي طلبات المستخدمين.  عادةً ما تساعد <b>خريطة الخدمة في</b> هذا: <br><br><img src="https://habrastorage.org/webt/t3/19/r9/t319r9yb96o3h0fjhdmi5wzdxbc.png"><br><br>  بالمناسبة ، هناك شيء مماثل في New Relic: <br><br><img src="https://habrastorage.org/webt/f8/sr/tq/f8srtq3vds1qmm2ddrp_g-d6pwo.png"><br><br>  ... وخريطتهم ، في رأيي ، أصبحت أبسط وأكثر قابلية للفهم: فهي لا تعرض مكونات تطبيق واحد (مما يجعله مفصلاً بشكل غير ضروري ، كما هو الحال في Datadog) ، ولكن فقط خدمات أو خدمات ميكروية محددة. <br><br>  رجوع إلى Datadog: يتضح من خريطة الخدمة أن طلبات المستخدمين تأتي إلى Django.  دعنا نذهب إلى خدمة Django وأخيرا نرى ما توقعناه: <br><br><img src="https://habrastorage.org/webt/c3/ip/fk/c3ipfkqpsv9jxxr1m0y9lqz7fvw.png"><br><br>  لسوء الحظ ، لا يوجد افتراضيًا أي مخطط <b>زمني لصفقات الويب</b> يشبه ما نراه على اللوحة New New Relic.  ومع ذلك ، يمكن تكوينه بدلاً من الرسم البياني <b>٪ Time Time</b> .  يكفي تحويله إلى <b>متوسط ​​الوقت لكل طلب حسب النوع</b> ... والآن يظهر المخطط المألوف لنا! <br><br><img src="https://habrastorage.org/webt/0l/jb/4m/0ljb4m2fh3_mbje9ihwvo6hlwge.png"><br><br>  لماذا اختار Datadog لجدول زمني مختلف هو لغز بالنسبة لنا.  كان من المحبط أيضًا أن النظام لا يتذكر اختيار المستخدم (على عكس المنافسين) ، وبالتالي فإن حفظ اللوحات المخصصة فقط هو الذي يحفظ. <br><br>  لكنني سررت بالفرصة المتاحة في Datadog للتبديل من هذه الرسوم البيانية إلى مقاييس الخوادم ذات الصلة ، وقراءة السجلات وتقييم حمل معالجات خادم الويب (Gunicorn).  كل شيء هو نفسه تقريبا كما هو الحال في بقايا جديدة ... وحتى عدد قليل (سجلات)! <br><br>  أدناه المخططات هي المعاملات التي تشبه تماما بقايا جديدة: <br><br><img src="https://habrastorage.org/webt/ln/pg/u5/lnpgu5fj2oclzdzlc1uwwjjtfkm.png"><br><br>  في Datadog ، تسمى المعاملات <b>الموارد</b> .  يمكنك فرز وحدات التحكم حسب عدد الطلبات ، حسب متوسط ​​وقت الاستجابة ، حسب الحد الأقصى للوقت المنقضي لفترة زمنية محددة. <br><br>  يمكنك توسيع المورد ورؤية كل ما لاحظناه بالفعل في New Relic: <br><br><img src="https://habrastorage.org/webt/3s/c1/5k/3sc15ksmnyvw_e-gyfagahxtep8.png"><br><br>  هناك إحصاءات حول المورد ، وقائمة معممة للمكالمات الداخلية ، وأمثلة على الطلبات التي يمكن فرزها بواسطة رمز الاستجابة ... بالمناسبة ، أحب مهندسونا هذا التصنيف حقًا. <br><br>  يمكن توسيع نطاق أي مصدر مثال في Datadog واستكشافه: <br><br><img src="https://habrastorage.org/webt/k8/tm/j8/k8tmj8vcz91rwmv-_lvshtzd8qi.png"><br><br>  يتم تقديم معلمات الاستعلام ، ومخطط تلخيصي للوقت المنقضي لكل مكون ، ومخطط شلال ، حيث يكون تسلسل المكالمات مرئيًا.  أيضًا ، يتوفر أيضًا التبديل إلى طريقة العرض الشجري لمخطط الشلال: <br><br><img src="https://habrastorage.org/webt/og/uu/ro/oguurozj3wo9vibezkytxmmc0c4.png"><br><br>  والشيء الأكثر إثارة للاهتمام هو عرض حمل المضيف الذي تم تنفيذ الطلب عليه ، وعرض سجلات الطلب. <br><br><img src="https://habrastorage.org/webt/vg/n6/be/vgn6belqdye20suvjgsq5kje3wu.png"><br><br>  تكامل رائع! <br><br>  قد تتساءل أين توجد علامات التبويب <b>قواعد البيانات</b> <b>والخدمات الخارجية</b> ، كما هو الحال في New Relic.  إنهم ليسوا هنا: نظرًا لأن Datadog يوزع التطبيق على مكونات ، سيتم اعتبار PostgreSQL <b>خدمة منفصلة</b> ، وبدلاً من الخدمات الخارجية ، يجدر البحث عن <code>aws.storage</code> (ستكون هي نفسها بالنسبة لأي خدمة خارجية أخرى يمكن للتطبيق الوصول إليها). <br><br><img src="https://habrastorage.org/webt/qp/bp/ap/qpbpapt5pqxtre_bkspuob-myqe.png"><br><br>  وهنا مثال على <code>postgres</code> : <br><br><img src="https://habrastorage.org/webt/nb/u6/ea/nbu6eaa6-6xlbkipsijjn4i9rxg.png"><br><br>  في الواقع ، هناك كل ما أردناه: <br><br><img src="https://habrastorage.org/webt/ww/r8/-c/wwr8-cpjbw26yv_chyaknlyolfe.png"><br><br>  يمكن أن نرى من "الخدمة" جاء الطلب. <br><br>  لن يكون من الضروري أن نتذكر أن Datadog يتكامل تمامًا مع NGINX Ingress ويسمح بالتتبع من طرف إلى طرف منذ اللحظة التي يصل فيها الطلب إلى الكتلة ، ويسمح لك أيضًا بقبول قياسات statsd وجمع السجلات ومقاييس المضيف. <br><br>  هناك إضافة ضخمة من Datadog وهي أن سعرها <i>يتكون</i> من مراقبة البنية التحتية و APM و Log Management و Synthetics ، أي  يمكنك اختيار خطة بمرونة. <br><br><h3 style=";text-align:right;direction:rtl">  2. اتاتوس </h3><br>  يدعي فريق Atatus أن خدمتهم "هي نفس خدمة New Relic ، ولكنها أفضل".  دعونا نرى ما اذا كان هذا هو حقا كذلك. <br><br>  يبدو شريط العنوان نفسه تمامًا ، لكن لم يكن من الممكن تحديد Redis و memcached المستخدم في التطبيق. <br><br><img src="https://habrastorage.org/webt/-v/f8/9t/-vf89tugun8vmi3f8vc5upnswpq.png"><br><br>  تحدد APM جميع المعاملات افتراضيًا ، على الرغم من أن الويب مطلوبًا في العادة فقط.  كما هو الحال في Datadog ، لا توجد وسيلة للذهاب إلى الخدمة المطلوبة من اللوحة الرئيسية.  علاوة على ذلك ، يتم سرد المعاملات بعد الأخطاء ، والتي لا تبدو منطقية للغاية بالنسبة لـ APM. <br><br>  في معاملات Atatus ، كل شيء يشبه New Relic قدر الإمكان.  ناقص - لا يمكنك رؤية ديناميكيات كل وحدة تحكم على الفور.  عليك أن تبحث عنها في جدول التحكم ، مرتبة حسب <b>معظم الوقت المستهلك</b> : <br><br><img src="https://habrastorage.org/webt/1r/gm/df/1rgmdfhp2wi-etyz90cp-nhicne.png"><br><br>  تتوفر قائمة وحدات التحكم المعتادة في علامة التبويب <b>استكشاف</b> : <br><br><img src="https://habrastorage.org/webt/n6/bm/4e/n6bm4epe4rgm1o0-j6gckbe5xcs.png"><br><br>  في بعض النواحي ، يشبه هذا الجدول Datadog وهو أشبه بالجدول الموجود في New Relic. <br><br>  يمكن نشر كل معاملة ومعرفة ما قام به التطبيق: <br><br><img src="https://habrastorage.org/webt/om/nj/jz/omnjjzghaohvdghitkkynauqwd8.png"><br><br>  تشبه اللوحة أيضًا على الأرجح Datadog: هناك عدد من الطلبات ، صورة شاملة للمكالمات.  يوفر الجزء العلوي علامة تبويب تحتوي على أخطاء <b>فشل HTTP</b> وأمثلة لطلبات <b>تتبع جلسة العمل</b> البطيئة: <br><br><img src="https://habrastorage.org/webt/jc/cp/xo/jccpxoykxlwophfgejumdduui88.png"><br><br>  إذا دخلت في معاملة ، يمكنك رؤية مثال على تتبع ، يمكنك الحصول على قائمة من الاستعلامات إلى قاعدة البيانات ورؤية رؤوس الطلبات.  كل شيء يشبه بقايا جديدة: <br><br><img src="https://habrastorage.org/webt/_c/lb/dn/_clbdnkiqpd-6spg325of0c09o0.png"><br><br>  بشكل عام ، كان Atatus مسرورًا بتتبعات مفصلة - دون الإلتصاق الجديد Relic للمكالمات في كتلة التذكير: <br><br><img src="https://habrastorage.org/webt/m5/ub/hk/m5ubhk5bxdzyqwg3oaidmflbmjc.png"><br><img src="https://habrastorage.org/webt/hv/3s/27/hv3s27-mped0zuubmx9qs-7b_7c.png"><br><br>  ومع ذلك ، لا يوجد مرشح كافي من شأنه (كما في New Relic) قطع طلبات فائق السرعة (&lt;5ms).  من ناحية أخرى ، كان عرض الاستجابة النهائية للمعاملة (نجاح أو خطأ) لطيفًا. <br><br>  ستساعدك لوحة <b>قواعد البيانات في</b> فحص الطلبات إلى قواعد البيانات الخارجية التي يقدمها التطبيق.  دعني أذكرك بأن Atatus عثر على PostgreSQL و MySQL فقط ، على الرغم من مشاركة Redis و memcached أيضًا في المشروع. <br><br><img src="https://habrastorage.org/webt/rj/1z/vn/rj1zvn9n6wvmcbzcx1fj65x1mmg.png"><br><br>  يتم فرز الطلبات وفقًا للمعايير المعتادة: تكرار الاستجابة ، متوسط ​​وقت الاستجابة ، وما إلى ذلك.  أود أيضًا أن أشير إلى علامة التبويب التي تحتوي على أبطأ الاستفسارات - هذا مناسب جدًا.  علاوة على ذلك ، تزامنت البيانات الموجودة في علامة التبويب هذه في PostgreSQL مع البيانات من ملحق <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pg_stat_statements</a> - وهي نتيجة ممتازة! <br><br><img src="https://habrastorage.org/webt/-4/th/4c/-4th4c5ykhiikiwtmrk23rr7g7g.png"><br><br>  علامة التبويب " <b>الطلبات الخارجية"</b> مطابقة لقواعد البيانات. <br><br><h2 style=";text-align:right;direction:rtl">  النتائج </h2><br>  أداء كل من الأدوات المقدمة بشكل جيد في دور APM.  يمكن لأي منهم تقديم الحد الأدنى الضروري.  لخص بإيجاز انطباعاتنا على النحو التالي: <br><br><h3 style=";text-align:right;direction:rtl">  Datadog </h3><br>  الايجابيات: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  جدول تعريفة مناسب (تكاليف APM 31 دولار لكل مضيف) ؛ </li><li style=";text-align:right;direction:rtl">  أداء جيد مع بيثون. </li><li style=";text-align:right;direction:rtl">  القدرة على الاندماج مع OpenTracing </li><li style=";text-align:right;direction:rtl">  التكامل Kubernetes </li><li style=";text-align:right;direction:rtl">  التكامل مع NGINX دخول. </li></ul><br>  سلبيات: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  APM الوحيد الذي تسبب في عدم إمكانية الوصول إلى التطبيق بسبب خطأ في الوحدة النمطية (predis) </li><li style=";text-align:right;direction:rtl">  أدوات PHP الضعيفة ؛ </li><li style=";text-align:right;direction:rtl">  تعريف غريب جزئيًا للخدمات والغرض منها. </li></ul><br><h3 style=";text-align:right;direction:rtl">  Atatus </h3><br>  الايجابيات: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الأجهزة العميقة من PHP. </li><li style=";text-align:right;direction:rtl">  بقايا جديدة تشبه واجهة المستخدم. </li></ul><br>  سلبيات: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  لا يعمل على أنظمة التشغيل الأقدم (Ubuntu 12.05، CentOS 5)؛ </li><li style=";text-align:right;direction:rtl">  أدوات السيارات الضعيفة ؛ </li><li style=";text-align:right;direction:rtl">  دعم لغتين فقط (Node.js و PHP) ؛ </li><li style=";text-align:right;direction:rtl">  التشغيل البطيء للواجهة. </li></ul><br>  نظرًا لسعر Atatus البالغ 69 دولارًا أمريكيًا شهريًا لكل خادم ، نفضل استخدام Datadog ، الذي يتكامل تمامًا مع احتياجاتنا (تطبيقات الويب في K8s) وله العديد من الميزات المفيدة. <br><br><h2 style=";text-align:right;direction:rtl">  PS </h2><br>  اقرأ أيضًا في مدونتنا: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">أدوات لمطوري التطبيقات التي تعمل على Kubernetes</a> " ؛ </li><li style=";text-align:right;direction:rtl">  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubectl-debug plugin لتصحيح الأخطاء في قرون Kubernetes</a> " ؛ </li><li style=";text-align:right;direction:rtl">  "خدمات <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Microservices: الحجم مهم ، حتى لو كان لديك Kubernetes</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar465177/">https://habr.com/ru/post/ar465177/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar465161/index.html">نموذج بيانات خماسي ومئات غيغابايت من البيانات</a></li>
<li><a href="../ar465163/index.html">الطباعة ثلاثية الأبعاد: حالات مذهلة وأكثر إثارة للاهتمام بقليل</a></li>
<li><a href="../ar465167/index.html">تخطيط الموارد. لماذا لا يعمل؟ الجزء 1</a></li>
<li><a href="../ar465169/index.html">DIY من PVS-Studio: Gamification of Achievements</a></li>
<li><a href="../ar465173/index.html">كيفية تغيير تكلفة الاشتراك الذي تم إنشاؤه في التطبيق الخاص بك. متجر التطبيقات Connect و Google Play Console</a></li>
<li><a href="../ar465179/index.html">هل يحل الأتمتة محل الاختبار اليدوي؟</a></li>
<li><a href="../ar465181/index.html">الأماكن الزلقة في C ++ 17</a></li>
<li><a href="../ar465185/index.html">معايير مراقبة فيديو جديدة: اللون في الليل ، ومكافحة الضوضاء ، ePoE</a></li>
<li><a href="../ar465187/index.html">6 عبارات إنجليزية يمكن استخدامها في مفاوضات الرواتب مع الشركات الأجنبية</a></li>
<li><a href="../ar465189/index.html">فريق تطوير سباق العدو</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>