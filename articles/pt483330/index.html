<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßï üî¥ üßïüèø Sobre a opera√ß√£o de um PC usando o exemplo do Windows 10 e o teclado, parte 1 ü§æ üë¥üèΩ ‚òëÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Meu nome √© Andrey Artemyev, trabalho na Microsoft no n√∫cleo do Windows 10, trabalhei anteriormente no Windows 10x (WCOS), XBox, Windows Phone e Micros...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sobre a opera√ß√£o de um PC usando o exemplo do Windows 10 e o teclado, parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483330/"><img src="https://habrastorage.org/getpro/habr/post_images/168/a19/873/168a198732c9cf76e19132b28ceaf04d.png" alt="imagem"><br><br>  Meu nome √© Andrey Artemyev, trabalho na Microsoft no n√∫cleo do Windows 10, trabalhei anteriormente no Windows 10x (WCOS), XBox, Windows Phone e Microsoft Edge.  Eu quero que, popularmente, para fins educacionais, conte sobre como o computador funciona no exemplo de entrada de teclado e Windows 10. Esta s√©rie de artigos foi projetada principalmente para estudantes de especialidades t√©cnicas.  Vamos considerar qual caminho as informa√ß√µes sobre a tecla pressionada v√£o exibir no Notepad.exe.  Devido √† vastid√£o e interdisciplinaridade do t√≥pico, pode haver imprecis√µes nos artigos, que s√£o relatados nos coment√°rios.  Algumas informa√ß√µes podem estar desatualizadas devido √† velocidade com que o Windows est√° se desenvolvendo. <br><a name="habracut"></a><br><h3>  Qu√£o profundo mergulhamos no t√≥pico? </h3><br>  Vamos primeiro falar sobre os n√≠veis em que um computador pode ser considerado.  Cada n√≠vel √© baseado no anterior.  Vamos come√ßar do topo. <br><br>  <i>N√≠vel de aplica√ß√£o</i> .  Todos os aplicativos de usu√°rio est√£o localizados aqui, este √© um navegador, Microsoft Office, bloco de notas, bem como o servidor Web IIS, SQL Server, v√°rios middlewares como Java e .Net e todas as linguagens de script, sejam Ruby, PHP ou Bat-files. <br><br>  <i>N√≠vel do sistema operacional</i> .  O SO pode ser considerado como: <br><br><ul><li>  Gerenciador de recursos - mem√≥ria, discos r√≠gidos, impressoras, tela, teclado, recursos limitados que s√£o compartilhados por programas em execu√ß√£o no computador. </li><li>  M√°quina virtual - um arquivo √© um bom exemplo de um objeto virtual.  Representa uma abstra√ß√£o de dados no disco, uma API para trabalhar com ele e tamb√©m adiciona o conceito de direitos de acesso.  Em vez de um arquivo, poderia haver o conceito de um cont√™iner de dados e uma API completamente diferente.  Existem muitos desses objetos virtuais no sistema operacional. </li><li>  Platform - OS fornece modelos de software e primitivas para a cria√ß√£o de programas.  Por exemplo, a Estrutura de Drivers do Windows permite que voc√™ desenvolva drivers rapidamente; janelas no Windows s√£o usadas para criar interfaces de usu√°rio complexas.  Dll - fornece um modelo para expandir a funcionalidade do programa atrav√©s de plug-ins, bem como um mecanismo para implementar o leitor de tela atrav√©s de traps de teclado (consulte gancho LowLevelKeyboard). </li></ul>  O sistema operacional √© dividido em camadas e componentes.  Em geral, a arquitetura do Windows 10 se parece com isso.  Falaremos sobre isso em detalhes um pouco mais tarde. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a8/b8d/4c8/5a8b8d4c8c9538c8dc7e8ed97882ff90.png" alt="imagem"></div><br>  <i>N√≠vel de arquitetura do computador</i> .  √â representada por uma placa-m√£e, que possui um fator de forma espec√≠fico, fun√ß√µes internas codificadas em microcircuitos chamados chipset e portas atrav√©s das quais √© poss√≠vel expandir a funcionalidade de um computador conectando uma placa gr√°fica, placa de rede, mem√≥ria RAM adicional, discos r√≠gidos, teclado, etc. As portas afetam a velocidade e os recursos do computador, que determinar√° sua finalidade, seja um servidor para processar milhares de solicita√ß√µes por segundo, um tablet para usar a Internet ou um PC para jogos com v√°rios v√≠deos  arty.  O SO abstrai os recursos da placa-m√£e. <br><br>  Os microcircuitos se parecem com a figura abaixo e s√£o um minicomputador que executa programas simples para tarefas de baixo n√≠vel, por exemplo, l√™ dados do teclado e os transfere ainda mais para alcan√ßar o processador.  Como regra, eles s√£o implementados como um microcircuito anal√≥gico n√£o program√°vel ou microcontrolador program√°vel em C. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/352/c4e/d2f/352c4ed2f9d9a581dd63afc6561f2b84.png" alt="imagem"></div><br><br>  A placa-m√£e pode ser considerada uma col√¥nia de microcircuitos que se comunicam atrav√©s de barramentos e atrav√©s deles os dados dos dispositivos conectados ao processador e vice-versa circulam.  O chipset √© um tipo de sistema nervoso do computador.  Todos os chips da placa-m√£e foram criados originalmente para funcionar entre si.  Alguns deles podem ter fun√ß√µes especiais, por exemplo, um timer ou armazenamento das configura√ß√µes do BIOS.  Talvez o mais importante deles seja o que possui um programa interno (firmware, BIOS, UEFI) que come√ßa a funcionar assim que a eletricidade aparece.  Ela encontra o disco r√≠gido com o carregador de inicializa√ß√£o do Windows e transfere o controle para ele, que por sua vez inicia o arquivo execut√°vel do SO, que pode ser chamado de Windows10.exe, na verdade NtOsKrnl.exe.  O BIOS sabe o que procurar gra√ßas a um acordo entre fabricantes de hardware e sistemas operacionais. <br><br>  Em torno da placa-m√£e, voc√™ pode montar um telefone celular, console de jogos, esta√ß√£o de servidor ou dispositivo inteligente.  Na figura abaixo, os fatores de forma comuns das placas-m√£e. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/970/4b1/225/9704b1225b1a0a9308b395a918c9490c.png" alt="imagem"></div><br>  <i>O n√≠vel da microarquitetura</i> √© representado pelo processador (CPU), este √© o cora√ß√£o da placa-m√£e e todo o conjunto de chips √© necess√°rio para atender √† CPU.  Um processador √© um computador em um computador, um microcontrolador mais poderoso e avan√ßado que n√£o precisa de firmware, porque o fluxo de comandos √© enviado instantaneamente quando o agendador de threads altera o contexto do processador.  A funcionalidade do processador √© dividida em subsistemas, por exemplo, um componente envolvido em opera√ß√µes matem√°ticas e l√≥gicas, um coprocessador matem√°tico e um cache.  Alguns deles costumavam ser um chip separado na placa-m√£e, mas agora fazem parte da CPU, por exemplo, um controlador de interrup√ß√£o e um chip chamado North Bridge, que aumentam a velocidade do trabalho. <br><br>  Microarquitetura n√£o √© o mesmo que <i>arquitetura</i> .  Toda a funcionalidade da CPU √© dividida em componentes que trabalham juntos.  Esses componentes e sua intera√ß√£o s√£o microarquitetura.  No fluxograma abaixo, eles s√£o representados por ret√¢ngulos e quadrados coloridos. <br><br><div class="scrollable-table"><table><tbody><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/e7e/755/180/e7e755180f7556d131c52d5bae9e4bbb.png" alt="imagem" width="130"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/879/214/4bf/8792144bf447a9af66f11fb803d4f082.png" alt="imagem" align="right"></td></tr></tbody></table></div><br>  <i>A arquitetura do processador</i> √© essencialmente um documento que descreve qual funcionalidade ele deve ter para corresponder, por exemplo, √† arquitetura x86, x64 ou ARM usada em dispositivos m√≥veis.  Este documento descreve quais comandos, atribui√ß√µes de registro e l√≥gica de opera√ß√£o devem ser suportados.  Os criadores dos processadores Intel, AMD, Elbrus podem implementar essa funcionalidade como quiserem e adicionar novos recursos na forma de comandos, registros, sinalizadores, interrup√ß√µes e, se o sistema operacional souber sobre eles, poder√° us√°-lo.  Em termos de POO, a arquitetura da CPU √© a interface e a microarquitetura √© sua implementa√ß√£o. <br><br>  <i>Circuitos l√≥gicos</i> .  Ret√¢ngulos coloridos do diagrama de blocos da CPU consistem em circuitos l√≥gicos que executam suas opera√ß√µes em seq√º√™ncias de zeros e uns.  O processador v√™ todos os dados e instru√ß√µes na forma de bits (0 e 1), de acordo com a f√≥rmula, qualquer n√∫mero decimal pode ser representado como uma sequ√™ncia de 0 e 1, mas o que significa um n√∫mero espec√≠fico depende do contexto.  Pode ser um c√≥digo, n√∫mero, letra.  A unidade aritm√©tica e l√≥gica (ALU) pode adicionar dois n√∫meros atrav√©s de opera√ß√µes bit a bit.  Os algoritmos bit a bit de adi√ß√£o, subtra√ß√£o, multiplica√ß√£o e divis√£o s√£o conhecidos h√° muito tempo; os desenvolvedores do circuito l√≥gico precisam apenas implement√°-los efetivamente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/295/ec3/90e/295ec390e94e6f5a747108c18a90718d.png" alt="imagem"></div><br>  Os circuitos digitais trabalham com dados no n√≠vel de zeros e uns, enquanto os circuitos anal√≥gicos dependem da explora√ß√£o das leis da f√≠sica.  Eles executam manipula√ß√µes de bits simples, como turnos, AND, OR, XOR.  Atrav√©s dessas primitivas, opera√ß√µes mais complexas s√£o implementadas.  A figura abaixo mostra o operador AND anal√≥gico implementado atrav√©s de transistores.  Na sa√≠da do circuito, uma tens√£o diferente de zero s√≥ existir√° se estiver nos dois contatos de entrada (Bx1 e Bx2), caso contr√°rio, zero volt.  O operador &amp;&amp; em C # funciona da mesma maneira.  Os circuitos digitais s√£o baseados em anal√≥gico.  Elementos fisicamente l√≥gicos em circuitos l√≥gicos podem ser implementados n√£o apenas de maneira eletr√¥nica, mas tamb√©m mec√¢nica, hidr√°ulica, √≥ptica e outras. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/861/bc3/9db/861bc39db7794a592e6e58896a363e0b.png" alt="imagem"></div><br>  <i>O n√≠vel de radioelementos</i> .  Os circuitos fisicamente anal√≥gicos dependem de elementos de r√°dio que realmente exploram as leis da f√≠sica.  Principalmente estes s√£o semicondutores, ou seja,  sob certas condi√ß√µes, eles podem conduzir eletricidade, mas n√£o podem.  O diodo conduz a corrente em apenas uma dire√ß√£o, se n√£o for soldada, girada 180 e soldada de volta, a corrente n√£o passar√° por ela.  O transistor passa corrente somente se houver tens√£o na perna de controle.  A humanidade aprendeu a tornar os transistores microsc√≥picos e, portanto, eles podem ser colocados em uma pequena placa aos milh√µes.  Nas figuras abaixo, elementos de r√°dio semicondutores e um transistor convencional ao lado de um nano transistor sob um microsc√≥pio eletr√¥nico. <br><div class="scrollable-table"><table><tbody><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/webt/n-/ux/k5/n-uxk5c1ocjoowqllgwa6rcpt8a.png" alt="imagem"></div><br></td><td><img src="https://habrastorage.org/getpro/habr/post_images/c55/e83/c82/c55e83c825722050e5e461a8a6521c52.png" alt="imagem"><br></td></tr></tbody></table></div>  <i>O n√≠vel das leis da f√≠sica</i> .  E, finalmente, o n√≠vel mais baixo √© o n√≠vel das leis da f√≠sica que est√£o inclu√≠das nos radioelementos semicondutores. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78b/e31/48d/78be3148d40c073b92a9b33b744cb3a3.png" alt="imagem"></div><br>  Falaremos muito sobre o n√≠vel do sistema operacional e um pouco menos sobre arquitetura de computadores, microarquitetura, circuitos anal√≥gicos e elementos de r√°dio.  Para a √∫ltima parte, voc√™ deve entender como tudo isso funciona em conjunto. <br><br><h3>  No√ß√µes b√°sicas do sistema operacional </h3><br>  Quando fomos para a linguagem assembly na universidade, muitos estudantes ficaram aborrecidos com palavras inteligentes como ‚Äúmodos de kernel e usu√°rio‚Äù, sob as quais o sistema de autentica√ß√£o de fun√ß√µes realmente conhecido est√° oculto em todos, em todos os sites h√° pelo menos um ‚ÄúAdmin‚Äù com acesso a todas as p√°ginas e o "Usu√°rio" t√™m acesso limitado.  Da mesma forma, a fun√ß√£o "N√∫cleo" tem acesso a todos os recursos da CPU, e a fun√ß√£o "Usu√°rio" pode n√£o causar todos os comandos do processador e nem todos os argumentos.  Al√©m desse modelo, o sistema operacional √© constru√≠do com base no princ√≠pio da arquitetura cliente-servidor, em que o servidor √© o n√∫cleo que implementa a funcionalidade do SO e o cliente s√£o programas de usu√°rio.  No mundo da Web, o cliente e o servidor est√£o fisicamente separados - s√£o dois computadores diferentes que se comunicam pela rede.  No sistema operacional, o cliente e o servidor vivem na mesma m√°quina e no mesmo hardware.  O servidor possui uma certa API que permite que os clientes alterem seu estado, por exemplo, a API do Twitter permite criar postagens, fazer login e fazer upload de um feed de tweets para um cliente m√≥vel.  O Windows possui uma API Win, que √© apenas mais complicada devido a uma gama mais ampla de tarefas; hoje, o Windows possui aproximadamente 330.000 APIs mais uma API para aplicativos UWP.  Se os conceitos do Twitter s√£o mais ou menos claros para todos - postar, usu√°rio, feed -, os conceitos do sistema operacional podem exigir algum aprofundamento.  Portanto, pode ser dif√≠cil entender as APIs do Windows sem entender a estrutura interna do sistema operacional. <br><br>  <i>Na verdade, o kernel significa tr√™s coisas diferentes.</i>  <i>O kernel √© como todo c√≥digo do SO.</i>  <i>O kernel como um subsistema respons√°vel pelos mecanismos do SO, como o agendador de threads, altern√¢ncia de contexto, manipula√ß√£o de interrup√ß√£o, troca de mem√≥ria virtual para f√≠sica (Kernel) e o subsistema do kernel para suportar outros sistemas operacionais - CSRSS.exe (Windows), PSXSS.exe (POSIX), OS2SS.exe (OS / 2) ou WSL (Windows Subsystem para Linux).</i>  <i>Nesse contexto, o primeiro significado √© entendido - todo o c√≥digo do SO.</i> <br><br>  Quando uma janela aparece na tela, uma estrutura de dados aparece na parte do servidor do SO (modo kernel) que descreve essa janela - sua posi√ß√£o na tela, tamanho, texto do t√≠tulo, fun√ß√£o da janela atrav√©s da qual o SO permite que o aplicativo responda a eventos.  Como existem muitos subsistemas no sistema operacional, pode haver v√°rias estruturas de dados que descrevem um objeto, por exemplo, informa√ß√µes sobre o processo do usu√°rio est√£o nos componentes: <br><br><ul><li>  <i>Executivo</i> - aqui est√° a l√≥gica do sistema operacional.  Essa camada verifica quais processos podem ou n√£o fazer.  Este arquivo cont√©m informa√ß√µes sobre o processo pai, par√¢metros de in√≠cio do processo (Bloco do ambiente do processo), a conta de usu√°rio associada, o nome do arquivo exe do processo. </li><li>  Mecanismos de <i>Kernel</i> - OS, como um agendador de threads, s√£o implementados aqui.  Ele armazena quanto tempo o processo gasta no modo de usu√°rio e kernel, ao qual processadores seus threads est√£o conectados, a prioridade b√°sica dos threads do processo. </li><li>  <i>Subsistema de janelas</i> - informa√ß√µes sobre objetos GDI usados ‚Äã‚Äãpara desenhar na janela.  Estes s√£o primitivos, como pinc√©is, caneta, etc. </li><li>  <i>DirectX</i> - tudo relacionado ao DirectX: shaders, superf√≠cies, objetos DX, contadores de desempenho da GPU, configura√ß√µes de mem√≥ria para mem√≥ria gr√°fica. </li><li>  <i>O subsistema Windows</i> representado pelo processo CSRSS.exe ( <i>subsistema de</i> tempo de execu√ß√£o do servidor do cliente).  O Windows suportava anteriormente o OS POSIX (processo PSXSS.exe) e OS / 2 (OS2SS.exe).  Naqueles dias, surgiu a id√©ia de tornar o Windows o mesmo subsistema, mas isso era lento e logo parte do CSRSS.exe foi transferida para o win32k.sys, que agora est√° dividido em v√°rios arquivos - win32k.sys, win32kbase.sys e win32kfull.sys.  Informa√ß√µes sobre dados do grupo de processos, n√≠vel de desligamento, dados da sess√£o etc. s√£o armazenadas aqui. </li></ul><br>  O suporte ao POSIX e OS / 2 era mais formal, porque, para transferir o programa desses sistemas operacionais, era necess√°rio encontrar o c√≥digo-fonte e recompil√°-lo de uma maneira especial para obter um arquivo exe no qual todas as chamadas √† API do sistema operacional eram redirecionadas para o PSXdll.dll (NETAPI.DLL e DOSCALLS.DLL para aplicativos OS / 2 e User32.dll para Windows), que era um inv√≥lucro fino sobre a API do Windows.  O estado de algumas APIs foi armazenado no processo do subsistema PSXSS.exe (OS2SS.exe).  Como nem todas as APIs podem ser mapeadas para 1 para 1, esse programa funcionou de maneira inst√°vel.  O suporte ao Linux foi adicionado no Windows 10 e funciona de uma maneira completamente diferente.  O subsistema Linux est√° hospedado no modo kernel e a diferen√ßa entre o Windows Subsystem para Linux e Linux √© aproximadamente a mesma que entre diferentes constru√ß√µes.  Especialmente para a WSL, um novo tipo de processo foi introduzido - processo PICO. <br><br>  <i>O que √© um componente?</i>  <i>Essa √© uma funcionalidade agrupada logicamente.</i>  <i>Um componente pode ser chamado de classe OOP, DLL, pasta, conjunto de fun√ß√µes com um prefixo comum, espa√ßo para nome, camada na arquitetura.</i> <br><br><h3>  Mais sobre particionamento cliente-servidor </h3><br>  A separa√ß√£o do cliente e do servidor √© implementada usando a funcionalidade interna da CPU, compartilhamento de mem√≥ria e verifica√ß√µes de software. <br><br>  Os fabricantes de equipamentos colaboram com os desenvolvedores do sistema operacional; portanto, o processador possui mecanismos criados levando em considera√ß√£o as necessidades dos criadores de sistemas operacionais.  Em todos os processadores modernos, o mecanismo de fun√ß√£o do usu√°rio √© implementado, onde o usu√°rio √© entendido como o c√≥digo execut√°vel no momento.  Em aplicativos da Web, a fun√ß√£o do usu√°rio conectado √© armazenada em uma vari√°vel e, al√©m do nome amig√°vel Admin ou Usu√°rio, possui um ID dessa fun√ß√£o, que √© frequentemente usada durante a autoriza√ß√£o, porque comparar n√∫meros √© mais r√°pido e f√°cil do que seq√º√™ncias de caracteres.  No processador, a fun√ß√£o do usu√°rio atual √© armazenada em um campo chamado ‚ÄúAnel de seguran√ßa‚Äù, n√£o ‚ÄúCurrentUser.Role.Id‚Äù.  Na maioria dos processadores, esse campo aceita quatro valores de 0 a 3. O Windows usa 0 para a fun√ß√£o chamada "Modo Kernel", porque √© o modo mais privilegiado e o maior valor para a fun√ß√£o √© "Modo Usu√°rio", porque √© a fun√ß√£o mais limitada.  As fun√ß√µes restantes n√£o s√£o usadas porque a diferen√ßa entre 0 e 1, 2 e 3 √© insignificante.  Essas fun√ß√µes limitam as p√°ginas da mem√≥ria que podem ser endere√ßadas, voc√™ n√£o pode chamar algumas instru√ß√µes ou n√£o pode cham√°-las com certos argumentos.  Tamb√©m h√° restri√ß√µes no uso da tecnologia de portas de E / S para a troca de dados com dispositivos como um teclado, mas ela n√£o √© usada h√° 10 anos.  A mudan√ßa para o modo kernel ocorre atrav√©s do comando syscall, que pelo √≠ndice encontra a fun√ß√£o a ser chamada na matriz de ponteiros para as APIs do Windows.  Um ponteiro para esta matriz √© armazenado em um registro especial do processador durante a inicializa√ß√£o do SO. <br><br>  Eu chamei especificamente a CPU registrar um campo.  Ao escrever um programa em C #, voc√™ pode adicionar quantos campos quiser √† sua classe e dar nomes amig√°veis.  Para processadores e microcontroladores, os campos s√£o chamados de registradores.  Ao projetar um peda√ßo de ferro, voc√™ j√° precisa entender, nesta fase, quantos registros (campos) voc√™ precisa, qual o tamanho que eles devem ter e que funcionalidade atribuir a eles, para que isso seja suficiente em todas as ocasi√µes para todas as situa√ß√µes imagin√°veis ‚Äã‚Äãe inconceb√≠veis.  Imagine que voc√™ precise escrever um programa em uma linguagem de programa√ß√£o semelhante a C #, com 16 campos predefinidos na classe e n√£o possa usar vari√°veis ‚Äã‚Äãlocais.  I.e.  o mesmo campo pode ser usado para armazenar o usu√°rio conectado, a matriz classificada, os dados tempor√°rios ou o resultado do m√©todo.  Os nomes desses campos devem ser os mais comuns poss√≠veis, em vez de tempData, funcResult, haver√° nomes estranhos EAX, AH, AL, DX, etc. Se voc√™ escreveu um emulador do processador na arquitetura x86 em C #, o c√≥digo pode se parecer com isso (DIV - divide, comando divis√£o inteira): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/714/e34/338/714e34338ea1330cc82b04d548fb25b0.png" alt="imagem"></div><br>  Para ilustrar, eu adicionei uma verifica√ß√£o do modo do kernel.  Se ocorrer um erro de divis√£o por zero, o processador notifica o sistema operacional atrav√©s de uma interrup√ß√£o (lan√ßa um evento).  No momento da inicializa√ß√£o, o sistema operacional fornece ao processador uma matriz unidimensional de ponteiros para uma fun√ß√£o chamada vetor de interrup√ß√£o, em que cada √≠ndice corresponde a algum tipo de evento, por exemplo, divis√£o por zero.  O sistema operacional conhece a arquitetura do processador em que est√° sendo executado e pode organizar indicadores de fun√ß√£o em uma matriz.  A CPU chama essa fun√ß√£o e o sistema operacional tem seu pr√≥prio c√≥digo.  Por exemplo, o Windows verifica no registro se um depurador est√° instalado e exibe uma mensagem informando que ocorreu um erro e √© poss√≠vel executar um depurador para verificar o local em que ocorreu.  Uma interrup√ß√£o √© chamada de interrup√ß√£o porque interfere no curso normal da execu√ß√£o do programa e possibilita a execu√ß√£o do manipulador de interrup√ß√µes e somente ap√≥s sua conclus√£o o processador pode retornar √† execu√ß√£o do programa. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As interrup√ß√µes podem ser geradas n√£o apenas pelo processador, mas tamb√©m por dispositivos externos (teclado, mouse) ou c√≥digo de programa. O agendador de encadeamentos define um cron√¥metro que, a intervalos de um quantum (por padr√£o, cerca de 15ms no Windows Server mais) gera uma interrup√ß√£o para atribuir outro encadeamento a ser executado pelo algoritmo interno. A execu√ß√£o passo a passo do programa no Visual Studio tamb√©m conta com o mecanismo de interrup√ß√£o - o sinalizador √© definido no processador, que, ap√≥s cada comando, causa uma interrup√ß√£o que √© processada pelo mecanismo de depura√ß√£o do Windows e notificada por meio da API do Visual Studio.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O compartilhamento de mem√≥ria √© implementado gra√ßas √† mem√≥ria virtual. Eu disse anteriormente que o sistema operacional √© um gerenciador de recursos e uma m√°quina virtual. Mesmo que voc√™ tenha 1 GB de RAM, o Windows 32 bits funcionar√° como se voc√™ tivesse 4 GB de RAM, ou seja, voc√™ realmente tem 1 GB e praticamente 4 GB. Os computadores modernos s√£o baseados no modelo te√≥rico de uma m√°quina de Turing ou na arquitetura de von Neumann (com algumas modifica√ß√µes). De acordo com esses modelos, a mem√≥ria no computador √© uma fita composta por c√©lulas do tamanho de um byte. Essas c√©lulas s√£o agrupadas em p√°ginas, geralmente 4096 bytes (4Kb), porque:</font></font><br><br><ul><li>  . . CPU      ,         .         ,    ,      ,    ,     .          . </li><li>    ,        .   RAM        4.      RAM ,        . </li><li>        ,         ( new  ++)       / . Exe-     ,                 c .    . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simula√ß√£o de uso exclusivo de RAM por cada processo. </font><font style="vertical-align: inherit;">Quando o agendador de encadeamentos agenda um encadeamento para execu√ß√£o, ele carrega informa√ß√µes no mapeamento das p√°ginas virtuais do processo em p√°ginas f√≠sicas nos registros do processador e quando o c√≥digo do encadeamento tenta ler / gravar algum endere√ßo, o processador o traduz corretamente. </font><font style="vertical-align: inherit;">Al√©m dos processos, as emula√ß√µes contam com o uso exclusivo da RAM para contar com sess√µes que cont√™m c√≥digo e dados espec√≠ficos de um usu√°rio individual, como uma fila de mensagens global. </font><font style="vertical-align: inherit;">O Windows 10 possui um contexto de thread, processo e sess√£o.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O Windows 10 usa c√©lulas no in√≠cio da fita para espa√ßo do usu√°rio e no final para si (espa√ßo no modo kernel), no qual os objetos que descrevem o estado do sistema s√£o armazenados. </font></font><br><div class="scrollable-table"><table><tbody><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/960/f15/ba2/960f15ba232ef507dc327a742ec9b63b.png" alt="imagem"></td><td><img src="https://habrastorage.org/getpro/habr/post_images/d81/9c5/c68/d819c5c68f4a10b9bc924ef54dbc84f8.png" alt="imagem"></td></tr></tbody></table></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um endere√ßo de 64 bits permite endere√ßar 16 exabytes, que s√£o 18.446.744.073.709.551.616 c√©lulas de mem√≥ria. Os processadores modernos ainda n√£o suportam tanta RAM e, portanto, usam apenas os 48 bits inferiores do endere√ßo, os 16 restantes s√£o preenchidos com alta ordem. Portanto, o Win x64 simplesmente n√£o usa parte dos endere√ßos marcados em preto na figura acima. Mas isso n√£o significa que o Windows de 64 bits "veja" 256 TB de RAM. M√°ximo de 8 TB de mem√≥ria virtual na arquitetura IA64 e 7 TB em x64. O limite de mem√≥ria f√≠sica suportada pelo Windows 10 √© de 2 TB, porque com um grande n√∫mero de Windows n√£o foi testado. A quantidade de RAM suportada no Windows 10 √© amplamente determinada pela edi√ß√£o do sistema operacional, quanto mais caro, mais.</font></font><br><br> <i>     (HEX) ,     ?       ,              .           ,    ‚Äî    . CPU       ‚Äî       CPU         .  HEX         .     , 32  ( 64)   .   ‚Äî    ,   HEX       ,    . <br></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo do software de dividir em um cliente-servidor (modo kernel-usu√°rio) √© muito mais chato do que os mecanismos acima. </font><font style="vertical-align: inherit;">Processos e threads podem ser marcados com atributos especiais, ou podemos armazenar uma lista de ponteiros para threads / processos e verific√°-los no c√≥digo. </font><font style="vertical-align: inherit;">Se voc√™ j√° fez uma autoriza√ß√£o em um aplicativo Web, entendeu bem do que estou falando.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Do que o Windows √© composto? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° abstra√ß√£o ou divis√£o em componentes em todas as √°reas da programa√ß√£o e √© intuitivamente claro que o Windows tamb√©m est√° dividido em alguns componentes. </font><font style="vertical-align: inherit;">Um componente refere-se a alguma unidade de funcionalidade - classe OOP, arquivo, DLL, pasta. </font><font style="vertical-align: inherit;">Os componentes no diagrama abaixo podem ser arquivos * .sys, * .dll individuais ou apenas um conjunto de APIs agrupadas logicamente, adicionando um prefixo ao nome da fun√ß√£o, a parte antiga do sistema √© escrita em C e n√£o suporta classes. </font><font style="vertical-align: inherit;">Novas pe√ßas s√£o frequentemente escritas em C ++. </font><font style="vertical-align: inherit;">Em uma exibi√ß√£o ampliada, o Windows fica assim:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a8/b8d/4c8/5a8b8d4c8c9538c8dc7e8ed97882ff90.png" alt="imagem"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vamos analisar rapidamente seus componentes de baixo para cima: </font></font><br><br><ul><li> <i>Hyper-V Hypervisor</i> ‚Äî      Windows    .  ,  Hyper-V     ,              ,           . </li><li> <i>HAL.dll</i> ‚Äî Hardware Abtraction Layer ‚Äî       ‚Äî ,  ,  ‚Äî       Windows      HAL.dll,        .        ,   ,  .    ,       -   ACPI.sys. <br><br> <i>  Advanced Configuration and Power Interface?  1996       UI,                . <br></i> <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/425/8b8/115/4258b811515337cc25af8634a22f5e03.png" alt="imagem"></div><br>  1996    ACPI,            , ..          . ACPI       ,   CD drive, ..      . <br></li><li> <i>Device Drivers</i> ‚Äî    .         *.sys,          ,            . Process Explorer  SysInternals          . </li><li> <i>Kernel</i> ‚Äî <i>Kernel Mode Execution Environment</i> ,   ,   ,  ,    .     . </li><li> <i>Executive</i> ‚Äî    ,      - . </li><li> <i>Windowing &amp; Graphics</i> ‚Äî    DirectX       . </li><li> <i>NtDll.dll</i> ‚Äî                      .   dll   ,       ( ..  dll)    . Nt   Native,       Native American.  I.e.  API  ,     .      dll   Nt (NtDestroyMenu).  Win API         User32.dll.          NtDll.dll,    Nt*       (level of indirection) ‚Äî subsystem dll   User32.dll  PSXdll.dll  DOSCALLS.DLL      Windows. NtDll.dll        ( <b>S</b> ession <b>M</b> anagement <b>S</b> ub <b>S</b> ystem <b>.exe</b> , <b>Win</b> dows <b>Init</b> itialize <b>.exe</b>  .),       . </li><li> <i>SubSystem dlls</i> ‚Äî        .  Windows      User32.dll. - API            ,    Nt*   NtDll.dll,   CreateFile     NtCreateFile). </li><li> <i>Environment Subsystems</i> ‚Äî CSRSS.exe,  Windows.     POSIX ( PSXSS.exe)  OS/2 (OS2SS.exe). Windows Subsystem for Linux   -. </li><li> <i>System Processes</i> ‚Äî       ,   LSASS.exe (Local Security Authority SubSystem)       . </li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processos de servi√ßo</font></font></font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Anteriormente, os servi√ßos do Windows (como o Plug and Play Manager) trabalham em seus processos e eram arquivos * .exe. </font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com o tempo, apareceu o processo SvcHost.exe, que pode hospedar v√°rios componentes implementados como arquivos * .dll de uma s√≥ vez. </font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, quase todos os componentes do sistema foram movidos para o SvcHosts.</font></font></font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Processos do</font></font></font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usu√°rio - processos do usu√°rio. </font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os mesmos que usam todos os dias - navegadores, jogos, programas de escrit√≥rio etc. </font><font style="vertical-align: inherit;">Eles contaminam com infraestrutura instalada nos modelos anteriores.</font></font></font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nisto terminarei a primeira parte. </font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No pr√≥ximo, vamos ver onde o caminho da chave come√ßa.</font></font></font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt483330/">https://habr.com/ru/post/pt483330/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt483318/index.html">Bot para monitorar servi√ßos web em meia hora: telegrama + bash + cron</a></li>
<li><a href="../pt483320/index.html">Cria√ß√£o de um museu medieval de realidade virtual</a></li>
<li><a href="../pt483322/index.html">Desenvolvimento da API REST - qual √© a abordagem Code First?</a></li>
<li><a href="../pt483324/index.html">Processos flex√≠veis na equipe de TI</a></li>
<li><a href="../pt483328/index.html">API REST - O que √© o HATEOAS?</a></li>
<li><a href="../pt483332/index.html">CES 2020, IBM e o primeiro uso comercial verdadeiro do novo computador qu√¢ntico</a></li>
<li><a href="../pt483336/index.html">Aprimoramentos no Inliner do C ++: o Zipliner</a></li>
<li><a href="../pt483340/index.html">ICD lan√ßou uma miss√£o de realidade aumentada</a></li>
<li><a href="../pt483342/index.html">Python no c√≥digo do Visual Studio - vers√£o de janeiro de 2020</a></li>
<li><a href="../pt483344/index.html">Documentos do .NET novidades (dezembro de 2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>