<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©â€ğŸ« ğŸ‘´ğŸ¾ ğŸŒ RxDartï¼šæµç¨‹çš„ç¥å¥‡è½¬å˜ ğŸ“” ğŸ‘ ğŸ‘ƒğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ¬¢è¿ä½¿ç”¨-è¿™æ˜¯æˆ‘çš„Flutter Architectureæ–‡ç« ç³»åˆ—çš„ç¬¬ä¸‰éƒ¨åˆ†ã€‚ 


- å¼•è¨€ 
- Dart StreamsåŸºç¡€çŸ¥è¯† 
- RxDartï¼šé­”æœ¯æµè½¬æ¢ï¼ˆæœ¬æ–‡ï¼‰ 
- RxVMSåŸºç¡€ï¼šRxCommandå’ŒGetIt 
- RxVMSï¼šæœåŠ¡å’Œç®¡ç†å™¨ 
- RxVMSï¼šç‹¬ç«‹çš„å°éƒ¨ä»¶ 
- ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RxDartï¼šæµç¨‹çš„ç¥å¥‡è½¬å˜</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451292/"><p> æ¬¢è¿ä½¿ç”¨-è¿™æ˜¯æˆ‘çš„Flutter Architectureæ–‡ç« ç³»åˆ—çš„ç¬¬ä¸‰éƒ¨åˆ†ã€‚ </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¼•è¨€</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Dart StreamsåŸºç¡€çŸ¥è¯†</a> </li><li>  <strong>RxDartï¼šé­”æœ¯æµè½¬æ¢ï¼ˆæœ¬æ–‡ï¼‰</strong> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RxVMSåŸºç¡€ï¼šRxCommandå’ŒGetIt</a> </li><li>  RxVMSï¼šæœåŠ¡å’Œç®¡ç†å™¨ </li><li>  RxVMSï¼šç‹¬ç«‹çš„å°éƒ¨ä»¶ </li><li> ä½¿ç”¨RxVMSè¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ </li></ul><br><p>è¿™æ¬¡ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ååº”å¼æ‰©å±•ï¼ˆRxï¼‰çš„ç¥å¥‡é¢†åŸŸã€‚ æˆ‘å°†é‡ç‚¹ä»‹ç»æœ€å¸¸ç”¨çš„Rxå‡½æ•°å¹¶è§£é‡Šå…¶åº”ç”¨ã€‚ å¦‚æœæ‚¨è¿˜æ²¡æœ‰é˜…è¯»ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œé‚£ä¹ˆç°åœ¨æ˜¯è¿›è¡Œä¸‹ä¸€æ­¥çš„æ—¶é—´ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RxDart</a>æ˜¯Dartè¯­è¨€Rxæ¦‚å¿µçš„å®ç°ï¼Œè¿™è¦å½’åŠŸäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Frank Pepermans</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Brian Egan</a> ã€‚ å¦‚æœæ‚¨ä»¥å‰ä»¥å…¶ä»–è¯­è¨€ä½¿ç”¨è¿‡Rxï¼Œåˆ™å¯èƒ½ä¼šæ³¨æ„åˆ°è®¸å¤šåŠŸèƒ½çš„å‘½åæœ‰æ‰€ä¸åŒï¼Œä½†è¿™ä¸å¤ªå¯èƒ½ç»™æ‚¨å¸¦æ¥ä»»ä½•å›°éš¾ã€‚ </p><br><p> æµ‹è¯•ä»£ç åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a> ã€‚ </p><br><p> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨æµä½œä¸ºä¸€ç§å°†æ•°æ®ä»åº”ç”¨ç¨‹åºä¸­çš„ä¸€ä¸ªåœ°æ–¹ä¼ è¾“åˆ°å¦ä¸€ä¸ªåœ°æ–¹çš„æ–¹æ³•ï¼Œä½†æ˜¯å®ƒä»¬å¯ä»¥åšå¾—æ›´å¤šã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹Rxæ·»åŠ åˆ°Streamsçš„ä¸€äº›åŠŸèƒ½ã€‚ </p><a name="habracut"></a><br><h2 id="sozdanie-observables"> åˆ›å»ºå¯è§‚å¯Ÿç‰© </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¦‚å‰æ‰€è¿°</a> ï¼ŒObservablesæ˜¯å…·æœ‰å‡ºè‰²åŠŸèƒ½çš„æµçš„Rxç‰ˆæœ¬ã€‚ æœ‰å‡ ç§æœ‰è¶£çš„åˆ›å»ºæ–¹å¼ï¼š </p><br><h3 id="iz-potoka"> æµåª’ä½“æ’­æ”¾ </h3><br><p> é€šè¿‡å°†ä»»ä½•Streamä¼ é€’ç»™æ„é€ å‡½æ•°ï¼Œå¯ä»¥å°†å…¶è½¬æ¢ä¸ºObservableï¼š </p><br><pre><code class="cpp hljs">var controller = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamController&lt;String&gt;(); var streamObservable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observable(controller.stream); streamObservable.listen(print);</code> </pre> <br><h3 id="povtoryayuschiesya-sobytiya"> å‘¨æœŸæ€§äº‹ä»¶ </h3><br><pre> <code class="cpp hljs">var timerObservable = Observable.periodic(Duration(seconds: <span class="hljs-number"><span class="hljs-number">1</span></span>), (x) =&gt; x.toString() ); timerObservable.listen(print);</code> </pre> <br><p> è¿™æ ·ï¼Œå°†æ„é€ ä¸€ä¸ªObservableï¼Œä»¥æ˜¾ç¤ºå…·æœ‰ç‰¹å®šæ—¶é—´æ®µçš„å€¼ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥æ›´æ¢è®¡æ—¶å™¨ã€‚ </p><br><h3 id="iz-odinochnogo-znacheniya"> ä»å•ä¸ªå€¼ </h3><br><p> æœ‰æ—¶ï¼ŒAPIå¸Œæœ›åœ¨æ‚¨ä»…æœ‰å€¼çš„åœ°æ–¹ä½¿ç”¨Stream / Observableã€‚ å¯¹äºè¿™ç§æƒ…å†µï¼ŒObservableæœ‰ä¸€ä¸ªå·¥å‚ã€‚ </p><br><pre> <code class="cpp hljs">var justObservable = Observable&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.just(<span class="hljs-number"><span class="hljs-number">42</span></span>); justObservable.listen(print); <span class="hljs-comment"><span class="hljs-comment">//   : 42</span></span></code> </pre> <br><h3 id="iz-future"> ä»æœªæ¥ </h3><br><pre> <code class="cpp hljs"> Future&lt;String&gt; asyncFunction() async { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Future.delayed(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Duration(seconds: <span class="hljs-number"><span class="hljs-number">1</span></span>), () =&gt; <span class="hljs-string"><span class="hljs-string">"AsyncRsult"</span></span>); } test(<span class="hljs-string"><span class="hljs-string">'Create Observable from Future'</span></span>, () async { print(<span class="hljs-string"><span class="hljs-string">'start'</span></span>); var fromFutureObservable = Observable.fromFuture(asyncFunction()); fromFutureObservable.listen(print);</code> </pre> <br><p> ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Future</a>åˆ›å»º<code>Observable</code>å°†ç­‰å¾…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Future</a>å®Œæˆå¹¶ä¸ºå…¶ç»“æœè¿”å›ä¸€ä¸ªå€¼ï¼›å¦‚æœæœªè¿”å›è¯¥å€¼ï¼Œåˆ™è¿”å›<code>null</code> ã€‚ ä»Futureåˆ›å»ºæµçš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä¸ºä»»ä½•Futureè°ƒç”¨<code>toStream()</code> ã€‚ </p><br><p> æ‚¨å¯èƒ½æƒ³çŸ¥é“å°†Futureè½¬æ¢ä¸ºObservable / Streamè€Œä¸æ˜¯ä»…ä»…ç­‰å¾…å®ƒçš„æ„ä¹‰ä½•åœ¨ã€‚ è¯·æ”¾å¿ƒï¼Œå½“æˆ‘ä»¬æ£€æŸ¥å¯ç”¨äºå¤„ç†æ•°æ®æµä¸­çš„å¯ç”¨å‡½æ•°æ—¶ï¼Œè¿™ä¸€ç‚¹å°†å˜å¾—å¾ˆæ¸…æ¥šã€‚ </p><br><h3 id="subjects"> ç§‘ç›® </h3><br><p>  <code>Subjects</code>æ›¿ä»£äº†RxDartä¸­çš„<code>StreamController</code> ï¼Œè¿™å°±æ˜¯åœ¨åº“çš„æŸä¸ªåœ°æ–¹å®ç°è¿™äº›<code>Subjects</code>æ–¹å¼ã€‚ </p><br><p> ä½†æ˜¯å®ƒä»¬çš„è¡Œä¸ºä¸åŸºæœ¬çš„StreamControllersç•¥æœ‰ä¸åŒï¼š </p><br><ul><li> æ‚¨å¯ä»¥ç›´æ¥å°†<code>listen()</code>ç›´æ¥åº”ç”¨äºä¸»é¢˜ï¼Œè€Œæ— éœ€è®¿é—®Streamå±æ€§ </li><li> ä»»æ„æ•°é‡çš„è®¢é˜…å¯ç”¨ï¼Œå¹¶ä¸”æ‰€æœ‰ä¾¦å¬å™¨åŒæ—¶æ¥æ”¶ç›¸åŒçš„æ•°æ® </li><li> å…±æœ‰ä¸‰ç§ä¸»é¢˜ï¼Œä¸‹é¢é€šè¿‡ç¤ºä¾‹è¿›è¡Œè¯´æ˜ï¼š </li></ul><br><h4 id="publishsubjects"> å‘å¸ƒä¸»é¢˜ </h4><br><p>  <code>PublishSubjects</code>è¡Œä¸ºç±»ä¼¼äº<code>StreamControllers</code> ï¼Œä½†å¯èƒ½å­˜åœ¨è®¸å¤šä¾¦å¬å™¨ï¼š </p><br><pre> <code class="cpp hljs">var subject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PublishSubject&lt;String&gt;(); subject.listen((item) =&gt; print(item)); subject.add(<span class="hljs-string"><span class="hljs-string">"Item1"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    subject.listen((item) =&gt; print(item.toUpperCase())); subject.add("Item2"); subject.add("Item3"); //        await Future.delayed(Duration(seconds: 5)); //    subject.close;</span></span></code> </pre> <br><p> è¿è¡Œæ­¤ä»£ç ï¼Œæ‚¨å°†è·å¾—ï¼š </p><br><pre> <code class="cpp hljs">Item1 ITEM2 Item2 ITEM3 Item3</code> </pre> <br><p> æ˜¾ç„¶ï¼Œå‚åŠ èšä¼šè¿Ÿåˆ°çš„ç¬¬äºŒä½å¬ä¼—ï¼ˆæˆ‘ä»¬ç§°å…¶ä¸ºâ€œæ™šè®¢æˆ·â€ï¼‰é”™è¿‡äº†ç¬¬ä¸€ç‚¹ã€‚ ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>BehaviourSubject</code> </p><br><h4 id="behavioursubject"> è¡Œä¸ºå¯¹è±¡ </h4><br><p> ä½¿ç”¨<code>BehaviourSubject</code>æ¯ä¸ªæ–°è®¢æˆ·å°†é¦–å…ˆæ”¶åˆ°æœ€åæ¥å—çš„å€¼ï¼š </p><br><pre> <code class="cpp hljs">var subject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject&lt;String&gt;(); subject.listen((item) =&gt; print(item)); subject.add(<span class="hljs-string"><span class="hljs-string">"Item1"</span></span>); subject.add(<span class="hljs-string"><span class="hljs-string">"Item2"</span></span>); subject.listen((item) =&gt; print(item.toUpperCase())); subject.add(<span class="hljs-string"><span class="hljs-string">"Item3"</span></span>);</code> </pre> <br><p> åœ¨å‡ºå£å¤„ </p><br><pre> <code class="cpp hljs">Item1 ITEM2 ITEM3 Item2 Item3</code> </pre> <br><p> æ‚¨å¯ä»¥çœ‹åˆ°ç¬¬äºŒä¸ªè®¢æˆ·ä¸¢å¤±äº†<code>Item1</code> ï¼Œä½†æ˜¯å®ƒæ”¶åˆ°äº†<code>Item2</code> ã€‚ æ‚¨å¯èƒ½ä¼šæƒŠè®¶äºç¬¬äºŒä¸ªè®¢é˜…è€…åœ¨ç¬¬ä¸€ä¸ªè®¢é˜…è€…æ¥æ”¶åˆ°<code>Item2</code>ä¹‹å‰æ¥æ”¶åˆ°<code>Item3</code> ã€‚ è¿™æ˜¯å› ä¸ºå°½ç®¡æ‰€æœ‰ç”¨æˆ·éƒ½ä»¥æ­£ç¡®çš„é¡ºåºæ¥æ”¶æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æœåŠ¡ç”¨æˆ·çš„é¡ºåºã€‚  <code>BehaviourSubject</code>ä»…ç¼“å­˜ä¸ºåæœŸè®¢é˜…è€…æ”¶åˆ°çš„æœ€åä¸€ä¸ªé¡¹ç›®ã€‚ å¦‚æœéœ€è¦ç¼“å­˜æ›´å¤šå…ƒç´ ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ReplaySubject</a> ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¸æ˜¯å¿…éœ€çš„ã€‚ </p><br><h2 id="manipulirovanie-dannymi-na-letu"> å³æ—¶å¤„ç†æ•°æ® </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ea5/dfe/1c6/ea5dfe1c65f93367e3207e2a0fe68908.gif"></p><br><p>  Rxçš„çœŸæ­£ä¼˜åŠ¿åœ¨äºï¼Œå®ƒå…è®¸æ‚¨åœ¨æµä¼ è¾“æœŸé—´å¤„ç†æ•°æ®ã€‚ æ¯ä¸ªRxæ–¹æ³•éƒ½è¿”å›ä¸€ä¸ªå¸¦æœ‰ç»“æœæ•°æ®çš„æ–°æµï¼ˆå¦‚å›¾æ‰€ç¤ºï¼‰ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªå¤„ç†ç®¡é“ä¸­å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ï¼Œè¿™ä½¿Rxæˆä¸ºåŠŸèƒ½éå¸¸å¼ºå¤§çš„å·¥å…·ã€‚ </p><br><h3 id="map"> åœ°å›¾ </h3><br><p> å¦‚æœæˆ‘ä¸æƒ³é”™è¿‡ä»»ä½•Streamæ“ä½œï¼Œé‚£å°±æ˜¯<code>map()</code> ã€‚  <code>map()</code>æ‰€åšçš„æ˜¯ï¼Œå®ƒæ¥æ”¶è¦ä¼ è¾“çš„æ¯ä¸ªæ•°æ®é¡¹å¹¶å¯¹å…¶åº”ç”¨ç‰¹å®šçš„åŠŸèƒ½ï¼Œç„¶åå°†ç»“æœæ”¾å…¥ç»“æœæµä¸­ã€‚ ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8e0/05a/ecc/8e005aecc11e119b7c856a4cadec9b11.gif"></p><br><pre> <code class="cpp hljs">var subject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PublishSubject&lt;String&gt;(); subject.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>((item) =&gt; item.toUpperCase()).listen(print); subject.add(<span class="hljs-string"><span class="hljs-string">"Item1"</span></span>); subject.add(<span class="hljs-string"><span class="hljs-string">"Item2"</span></span>); subject.add(<span class="hljs-string"><span class="hljs-string">"Item3"</span></span>);</code> </pre> <br><p> ç»“æœï¼š </p><br><pre> <code class="cpp hljs">ITEM1 ITEM2 ITEM3</code> </pre> <br><p> ä½†æ˜¯ï¼Œä¸éœ€è¦<code>map</code>è¿”å›ä¸è¾“å…¥ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚ ä»¥ä¸‹ç¤ºä¾‹å°†ä½¿ç”¨æ•´æ•°è€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬å°†é“¾æ¥ä¸¤ä¸ªè½¬æ¢ï¼š </p><br><pre> <code class="cpp hljs">var subject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PublishSubject&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); subject.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>((intValue) =&gt; intValue.toString()) .<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>((item) =&gt; item.toUpperCase()) .listen(print); subject.add(<span class="hljs-number"><span class="hljs-number">1</span></span>); subject.add(<span class="hljs-number"><span class="hljs-number">2</span></span>); subject.add(<span class="hljs-number"><span class="hljs-number">3</span></span>);</code> </pre> <br><p> æˆ–ç±»ä¼¼è¿™æ ·çš„ä¸œè¥¿ï¼š </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0bb/73f/2a2/0bb73f2a2ccb82e6a920efbf2c395b0d.gif"></p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataClass</span></span></span><span class="hljs-class">{</span></span>} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WrapperClass</span></span></span><span class="hljs-class"> {</span></span> final DataClass wrapped; WrapperClass(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.wrapped); } var subject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PublishSubject&lt;WrapperClass&gt;(); subject.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;WrapperClass&gt;((a) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WrapperClass(a));</code> </pre> <br><p>  <code>.map</code>çš„æœ€æœ‰ç”¨çš„ç”¨é€”ä¹‹ä¸€æ˜¯ï¼Œå½“æ‚¨ä»æŸç§REST APIæˆ–æ•°æ®åº“ä¸­è·å–æŸç§æ ¼å¼çš„æ•°æ®å¹¶å¸Œæœ›å°†å…¶è½¬æ¢ä¸ºè‡ªå·±çš„å¯¹è±¡æ—¶ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> {</span></span> final String name; final String adress; final String phoneNumber; final <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> age; <span class="hljs-comment"><span class="hljs-comment">//       - //   factory User.fromJson(String jsonString) { var jsonMap = json.decode(jsonString); return User( jsonMap['name'], jsonMap['adress'], jsonMap['phoneNumber'], jsonMap['age'], ); } User(this.name, this.adress, this.phoneNumber, this.age); @override String toString() { return '$name - $adress - $phoneNumber - $age'; } } void main() { test('Map', () { // -  var jsonStrings = [ '{"name": "Jon Doe", "adress": "New York", "phoneNumber":"424242","age": 42 }', '{"name": "Stephen King", "adress": "Castle Rock", "phoneNumber":"123456","age": 71 }', '{"name": "Jon F. Kennedy", "adress": "Washington", "phoneNumber":"111111","age": 66 }', ]; //   json-,    API/DB. var dataStreamFromAPI = new PublishSubject&lt;String&gt;(); dataStreamFromAPI .map&lt;User&gt;((jsonString) =&gt; User.fromJson(jsonString)) // json -&gt; User .listen((user) =&gt; print(user.toString())); //    dataStreamFromAPI.add(jsonStrings[0]); dataStreamFromAPI.add(jsonStrings[1]); dataStreamFromAPI.add(jsonStrings[2]); });</span></span></code> </pre> <br><p>  <em>æˆ‘æ³¨æ„åˆ°ï¼Œä¸ä»…Streamsï¼Œè€Œä¸”ä»»ä½•Iterableéƒ½æä¾›äº†å¯ç”¨äºåˆ—è¡¨è½¬æ¢çš„<code>map</code>å‡½æ•°ã€‚</em> </p><br><h3 id="where"> å“ªé‡Œ </h3><br><p> å¦‚æœæ‚¨ä»…å¯¹æµä¸­é‡åˆ°çš„æŸäº›å€¼æ„Ÿå…´è¶£ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>.where()</code>å‡½æ•°ï¼Œè€Œä¸æ˜¯åœ¨ä¾¦å¬å™¨ä¸­ä½¿ç”¨<code>if</code> ï¼Œè¿™æ ·åšæ›´å…·è¡¨ç°åŠ›ä¸”æ›´æ˜“äºé˜…è¯»ï¼š </p><br><pre> <code class="cpp hljs">var subject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PublishSubject&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); subject.where((val) =&gt; val.isOdd) .listen( (val) =&gt; print(<span class="hljs-string"><span class="hljs-string">'This only prints odd numbers: $val'</span></span>)); subject.where((val) =&gt; val.isEven) .listen( (val) =&gt; print(<span class="hljs-string"><span class="hljs-string">'This only prints even numbers: $val'</span></span>)); subject.add(<span class="hljs-number"><span class="hljs-number">1</span></span>); subject.add(<span class="hljs-number"><span class="hljs-number">2</span></span>); subject.add(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">//: This only prints odd numbers: 1 This only prints even numbers: 2 This only prints odd numbers: 3</span></span></code> </pre> <br><h3 id="debounce"> å»æŠ– </h3><br><p> è¿™æ˜¯Rxçš„å°æ˜ç ä¹‹ä¸€ï¼ å‡è®¾æ‚¨æœ‰ä¸€ä¸ªæœç´¢å­—æ®µï¼Œå¦‚æœå…¶æ–‡æœ¬å‘ç”Ÿæ›´æ”¹ï¼Œå®ƒå°†è°ƒç”¨REST APIã€‚ å¯¹æ¯ä¸ªæŒ‰é”®è¿›è¡ŒAPIè°ƒç”¨éƒ½éå¸¸æ˜‚è´µã€‚ å› æ­¤ï¼Œä»…å½“ç”¨æˆ·æš‚æ—¶æš‚åœæ—¶ï¼Œæ‚¨æ‰æƒ³æ‹¨æ‰“ç”µè¯ã€‚ ä¸ºæ­¤ï¼Œä½¿ç”¨äº†<code>debounce()</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°åä¸‹æ‰€æœ‰ä¼ å…¥äº‹ä»¶ï¼Œå¦‚æœå®ƒä»¬ä¹‹åæ²¡æœ‰æš‚åœã€‚ </p><br><pre> <code class="cpp hljs">var subject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PublishSubject&lt;String&gt;(); subject.debounce(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Duration(milliseconds: <span class="hljs-number"><span class="hljs-number">500</span></span>)).listen((s) =&gt; print(s)); subject.add(<span class="hljs-string"><span class="hljs-string">'A'</span></span>); subject.add(<span class="hljs-string"><span class="hljs-string">'AB'</span></span>); await Future.delayed(Duration(milliseconds: <span class="hljs-number"><span class="hljs-number">200</span></span>)); subject.add(<span class="hljs-string"><span class="hljs-string">"ABC"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    await Future.delayed(Duration(milliseconds: 700)); //       : 'ABC'</span></span></code> </pre> <br><p> å› æ­¤ï¼Œå¦‚æœå°†<code>TextField.onChanged</code>å¤„ç†ç¨‹åºè½¬æ¢ä¸º<code>Observable</code> ï¼Œåˆ™ä¼šå¾—åˆ°ä¸€ä¸ªä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚ </p><br><h3 id="expand"> å±•å¼€ </h3><br><p> å¦‚æœæ‚¨çš„æºStreamå‘å‡ºå¯¹è±¡æ•°ç»„ï¼Œå¹¶ä¸”æ‚¨æƒ³è‡ªå·±å¤„ç†æ¯ä¸ªå¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>.expand</code> ï¼Œå®ƒå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e8e/8d7/2b3/e8e8d72b36dddd0d3469107c6cdae2b1.gif" alt="å›¾ç‰‡"></p><br><p> æ‚¨å°†åœ¨FireStoreç¤ºä¾‹ä¸­çœ‹åˆ°æ­¤æ–¹æ³•çš„åº”ç”¨ç¨‹åºã€‚ </p><br><h3 id="merge"> åˆå¹¶ </h3><br><p> å¦‚æœæ‚¨æœ‰å¤šä¸ªä¸åŒçš„çº¿ç¨‹ï¼Œä½†æ˜¯æƒ³è¦ä¸€èµ·å¤„ç†å®ƒä»¬çš„å¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>.mergeWith</code> ï¼ˆåœ¨å…¶ä»–Rxå®ç°ä¸­ï¼Œåªéœ€<code>merge</code> ï¼‰ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ç»„çº¿ç¨‹å¹¶è¿”å›ä¸€ä¸ªåˆå¹¶çš„çº¿ç¨‹ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a2f/9ba/82b/a2f9ba82b88b555841c21dc623c3d298.gif" alt="å›¾ç‰‡"></p><br><p>  <code>.mergeWith</code>ä¸ä¿è¯æµä¸­çš„ä»»ä½•é¡ºåºéƒ½è¢«åˆå¹¶ã€‚ æ•°æ®æŒ‰è¾“å…¥é¡ºåºå‘å‡ºã€‚ </p><br><p> ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸¤ä¸ªé€šè¿‡æµæŠ¥å‘Šé”™è¯¯çš„ç»„ä»¶ï¼Œå¹¶ä¸”å¸Œæœ›å°†å®ƒä»¬ä¸€èµ·æ˜¾ç¤ºåœ¨å¯¹è¯æ¡†ä¸­ï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼ˆä¼ªä»£ç ï¼‰ï¼š </p><br><pre> <code class="cpp hljs">@<span class="hljs-function"><span class="hljs-function">override </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ super.initState(); component1.errors.mergeWith([component2.errors]) .listen( (error) async =&gt; await showDialog(error.message)); }</code> </pre> <br><p> æˆ–è€…ï¼Œå¦‚æœæ‚¨æƒ³åŒæ—¶æ˜¾ç¤ºæ¥è‡ªå¤šä¸ªç¤¾äº¤ç½‘ç»œçš„æ¶ˆæ¯ï¼Œåˆ™å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆä¼ªä»£ç ï¼‰ï¼š </p><br><pre> <code class="cpp hljs">final observableTwitter = getTwitterStream().<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>((data) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyAppPost.fromTwitter(data)); final observableFacebook = getFacebookStream().<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>((data) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyAppPost.fromFaceBook(data)); final postStream = observableTwitter.mergeWith([observableFacebook]);</code> </pre> <br><h3 id="zipwith"> é‚®ç¼– </h3><br><p>  <code>zipWith</code>è¿˜å¯ä»¥å°†ä¸€ä¸ªæµä¸å¦ä¸€ä¸ªæµåˆå¹¶ã€‚ ä½†æ˜¯ï¼Œä¸<code>.mergeWith</code>ä¸åŒï¼Œå®ƒä¸ä¼šåœ¨ä»å…¶æºæµä¹‹ä¸€æ¥æ”¶åˆ°å…ƒç´ åç«‹å³å‘é€æ•°æ®ã€‚ ä»–ç­‰åˆ°ä¸¤ä¸ªæºæµä¸­çš„å…ƒç´ åˆ°è¾¾ï¼Œç„¶åä½¿ç”¨æä¾›çš„<code>zipper</code>åŠŸèƒ½å°†å®ƒä»¬ç»„åˆï¼š </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5ef/611/847/5ef611847db6bfa40237fb3622d93822.gif" alt="å›¾ç‰‡"></p><br><p>  <code>zipWith</code>ç­¾åçœ‹èµ·æ¥å¾ˆå“äººï¼Œä½†ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// R :   Stream/Observable // S :   Stream/Observable // zipper: - Observable&lt;R&gt; zipWith&lt;S, R&gt;(Stream&lt;S&gt; other, R zipper(T t, S s))</span></span></code> </pre> <br><p> ä¸€ä¸ªéå¸¸ç®€åŒ–çš„ç¤ºä¾‹ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observable.just(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// .just()  Observable,    .zipWith(new Observable.just(2), (one, two) =&gt; one + two) .listen(print); //  3</span></span></code> </pre> <br><p> ä¸€ä¸ªæ›´å®é™…çš„åº”ç”¨ç¨‹åºæ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦ç­‰å¾…ä¸¤ä¸ªè¿”å›<code>Future</code>å¼‚æ­¥å‡½æ•°ï¼Œå¹¶ä¸”æƒ³è¦åœ¨ä¸¤ä¸ªç»“æœéƒ½è¿”å›æ—¶ç«‹å³å¤„ç†æ•°æ®ã€‚ åœ¨è¿™ä¸ªç¨ä½œè®¾è®¡çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªREST APIï¼šä¸€ä¸ªè¿”å›<code>User</code> ï¼Œå¦ä¸€ä¸ªè¿”å›<code>Product</code>ä½œä¸ºJSONå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›åœ¨è¿”å›<code>Invoice</code>å¯¹è±¡ä¹‹å‰ç­‰å¾…ä¸¤æ¬¡è°ƒç”¨ã€‚ </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Invoice</span></span></span><span class="hljs-class"> {</span></span> final User user; final Product product; Invoice(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.product); printInvoice() { print(user.toString()); print(product.toString()); } } <span class="hljs-comment"><span class="hljs-comment">//  HTTP ,  Product,  JSON Future&lt;String&gt; getProduct() async { print("Started getting product"); await Future.delayed(Duration(seconds: 2)); print("Finished getting product"); return '{"name": "Flux compensator", "price": 99999.99}'; } //  HTTP ,  User,  JSON Future&lt;String&gt; getUser() async { print("Started getting User"); await Future.delayed(Duration(seconds: 4)); print("Finished getting User"); return '{"name": "Jon Doe", "adress": "New York", "phoneNumber":"424242","age": 42 }'; } void main() { test('zipWith', () async { var userObservable = Observable.fromFuture(getUser()).map&lt;User&gt;((jsonString) =&gt; User.fromJson(jsonString)); var productObservable = Observable.fromFuture(getProduct()) .map&lt;Product&gt;((jsonString) =&gt; Product.fromJson(jsonString)); Observable&lt;Invoice&gt; invoiceObservable = userObservable.zipWith&lt;Product, Invoice&gt;( productObservable, (user, product) =&gt; Invoice(user, product)); print("Start listening for invoices"); invoiceObservable.listen((invoice) =&gt; invoice.printInvoice()); //        await Future.delayed(Duration(seconds: 5)); }); }</span></span></code> </pre> <br><p> æŸ¥çœ‹è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•å¼‚æ­¥å®Œæˆçš„ </p><br><pre> <code class="cpp hljs">Started getting User Started getting product Start listening <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> invoices Finished getting product Finished getting User Jon Doe - New York - <span class="hljs-number"><span class="hljs-number">424242</span></span> - <span class="hljs-number"><span class="hljs-number">42</span></span> Flux compensator - <span class="hljs-number"><span class="hljs-number">99999.99</span></span></code> </pre> <br><h3 id="combinelatest"> ç»„åˆæœ€æ–° </h3><br><p>  <code>combineLatest</code>è¿˜å¯ä»¥åˆå¹¶æµå€¼ï¼Œä½†æ˜¯<code>merge</code>å’Œ<code>zip</code>æ–¹å¼ç•¥æœ‰ä¸åŒã€‚ æ¯å½“ä¸€ä¸ªçº¿ç¨‹ä¸­æœ‰æ–°å€¼åˆ°è¾¾æ—¶ï¼Œå®ƒå°±ä¼šä¾¦å¬æ›´å¤šçº¿ç¨‹å¹¶å‘å‡ºç»„åˆå€¼ã€‚ æœ‰è¶£çš„æ˜¯ï¼Œå®ƒä¸ä»…ç”Ÿæˆæ›´æ”¹åçš„å€¼ï¼Œè€Œä¸”è¿˜ç”Ÿæˆæ‰€æœ‰å…¶ä»–æºæµçš„æœ€åè·å¾—çš„å€¼ã€‚ ä»”ç»†çœ‹ä¸€ä¸‹è¿™ä¸ªåŠ¨ç”»ï¼š </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/633/acb/bee/633acbbee01158bb7a6ad0450d39f712.gif" alt="å›¾ç‰‡"></p><br><p> åœ¨<code>combineLates</code>å…¶ç¬¬ä¸€ä¸ªå€¼ä¹‹å‰ï¼Œæ‰€æœ‰æºçº¿ç¨‹å¿…é¡»è‡³å°‘æ¥æ”¶ä¸€ä¸ªæ¡ç›®ã€‚ </p><br><p> ä¸ä¹‹å‰ä½¿ç”¨çš„æ–¹æ³•ä¸åŒï¼Œ <code>combineLatest</code>æ˜¯é™æ€çš„ã€‚ æ­¤å¤–ï¼Œç”±äºDartä¸å…è®¸è¿ç®—ç¬¦é‡è½½ï¼Œå› æ­¤æœ‰ä¸€äº›ç‰ˆæœ¬çš„<code>combLastest</code>å–å†³äºæºçº¿ç¨‹çš„æ•°é‡ï¼š <strong>CombineLatest2 ... CombineLatest9</strong> </p><br><p>  <code>combineLatest</code>å¾ˆå¥½çš„ç”¨æ³•ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸¤ä¸ª<code>Observable&lt;bool&gt;</code>è¡¨ç¤ºæ‚¨çš„åº”ç”¨ç¨‹åºçš„æŸäº›éƒ¨åˆ†å¤„äºç¹å¿™çŠ¶æ€ï¼Œå¹¶ä¸”æ‚¨æƒ³åœ¨å…¶ä¸­ä¸€ä¸ªç¹å¿™æ—¶æ˜¾ç¤ºâ€œç¹å¿™â€å¾®è°ƒå™¨ã€‚ å®ƒå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆä¼ªä»£ç ï¼‰ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> {</span></span> Observable&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; get isBusy =&gt; Observable.combineLatest2(isBusyOne,isBusyTwo, (b1, b2) =&gt; b1 || b2); PublishSubject&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; isBusyOne; PublishSubject&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; isBusyTwo; }</code> </pre> <br><p> åœ¨ç”¨æˆ·ç•Œé¢ä¸­ï¼Œå¦‚æœç»“æœå€¼ä¸ºtrueï¼Œåˆ™å¯ä»¥å°†<code>isBusy</code>ä¸<code>StreamBuilder</code>ä¸€èµ·ä½¿ç”¨ä»¥æ˜¾ç¤º<code>Spinner</code> ã€‚ </p><br><p>  <code>combineLatest</code>ä¸<strong>FireStoreå¿«ç…§</strong>æµç»“åˆä½¿ç”¨<code>combineLatest</code>éå¸¸åˆé€‚çš„åŠŸèƒ½ã€‚ </p><br><p> æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨æƒ³åˆ›å»ºä¸€ä¸ªæ˜¾ç¤ºæ–°é—»è®¢é˜…æºå’Œå¤©æ°”é¢„æŠ¥çš„åº”ç”¨ç¨‹åºã€‚ äº¤æ˜“æ¶ˆæ¯å’Œå¤©æ°”æ•°æ®å­˜å‚¨åœ¨ä¸¤ä¸ªä¸åŒçš„FireStoreé›†åˆä¸­ã€‚ ä¸¤è€…å‡ç‹¬ç«‹æ›´æ–°ã€‚ æ‚¨æƒ³ä½¿ç”¨StreamBuilderæ˜¾ç¤ºæ•°æ®æ›´æ–°ã€‚ ä½¿ç”¨<code>combineLatest</code>å¾ˆå®¹æ˜“ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WeatherForecast</span></span></span><span class="hljs-class"> {</span></span> final String forecastText; final GeoPoint location; factory WeatherForecast.fromMap(Map&lt;String, dynamic&gt; <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> WeatherForecast(<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>[<span class="hljs-string"><span class="hljs-string">'forecastText'</span></span>], <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>[<span class="hljs-string"><span class="hljs-string">'location'</span></span>]); } WeatherForecast(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.forecastText, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.location); } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NewsMessage</span></span></span><span class="hljs-class"> {</span></span> final String newsText; final GeoPoint location; factory NewsMessage.fromMap(Map&lt;String, dynamic&gt; <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NewsMessage(<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>[<span class="hljs-string"><span class="hljs-string">'newsText'</span></span>], <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>[<span class="hljs-string"><span class="hljs-string">'location'</span></span>]); } NewsMessage(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.newsText, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.location); } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CombinedMessage</span></span></span><span class="hljs-class"> {</span></span> final WeatherForecast forecast; final NewsMessage newsMessage; CombinedMessage(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.forecast, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.newsMessage); } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> {</span></span> CollectionReference weatherCollection; CollectionReference newsCollection; Model() { weatherCollection = Firestore.instance.collection(<span class="hljs-string"><span class="hljs-string">'weather'</span></span>); newsCollection = Firestore.instance.collection(<span class="hljs-string"><span class="hljs-string">'news'</span></span>); } Observable&lt;CombinedMessage&gt; getCombinedMessages() { Observable&lt;WeatherForecast&gt; weatherForecasts = weatherCollection .snapshots() .expand((snapShot) =&gt; snapShot.documents) .<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;WeatherForecast&gt;((document) =&gt; WeatherForecast.fromMap(document.data)); Observable&lt;NewsMessage&gt; news = newsCollection .snapshots() .expand((snapShot) =&gt; snapShot.documents) .<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;NewsMessage&gt;((document) =&gt; NewsMessage.fromMap(document.data)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Observable.combineLatest2( weatherForecasts, news, (weather, news) =&gt; CombinedMessage(weather, news)); } }</code> </pre> <br><p> åœ¨æ‚¨çš„UIä¸­ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š <code>StreamBuilder&lt;CombinedMessage&gt;(stream: model.getCombinedMessages(),...).</code> </p><br><h3 id="distinct"> ç‹¬ç‰¹çš„ </h3><br><p> åœ¨ä¸Šè¿°æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‘ç”Ÿ<strong>isBusyOne</strong>å’Œ<strong>isBusyTwo</strong>æä¾›ç›¸åŒçš„å€¼ï¼Œè¿™å°†å¯¼è‡´ä½¿ç”¨ç›¸åŒæ•°æ®çš„ç”¨æˆ·ç•Œé¢æ›´æ–°ã€‚ ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>.distinct()</code> ã€‚ å®ƒç¡®ä¿ä»…åœ¨æ–°å…ƒç´ çš„å€¼ä¸æœ€åä¸€ä¸ªå…ƒç´ çš„å€¼ä¸åŒæ—¶æ‰ä¼ è¾“æ•°æ®ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†ä»£ç æ›´æ”¹ä¸ºï¼š </p><br><pre> <code class="cpp hljs"> Observable&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; isBusy =&gt; isBusyOne.mergeWith([isBusyTwo]).distinct();</code> </pre> <br><p> å®ƒä¹Ÿè¡¨æ˜æˆ‘ä»¬å¯ä»¥éšæ„å°†åŠŸèƒ½ç»„åˆåˆ°ä¸åŒçš„é“¾ä¸­ã€‚ </p><br><h3 id="asyncmap"> å¼‚æ­¥æ˜ å°„ </h3><br><p> é™¤äº†<code>map()</code>è¿˜æœ‰<code>asyncMap</code>å‡½æ•°ï¼Œå®ƒå…è®¸æ‚¨å°†å¼‚æ­¥å‡½æ•°ç”¨ä½œåœ°å›¾å‡½æ•°ã€‚ è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„FireStoreç¤ºä¾‹ä»‹ç»ä¸€ä¸ªç¨æœ‰ä¸åŒçš„è®¾ç½®ã€‚ ç°åœ¨ï¼Œå¿…è¦çš„<strong>WeatherForecast</strong>å–å†³äº<strong>NewsMessage</strong>çš„ä½ç½®ï¼Œå¹¶ä¸”ä»…åº”åœ¨<strong>æ”¶åˆ°</strong>æ–°çš„<strong>NewsMessage</strong>æ—¶è¿›è¡Œæ›´æ–°ï¼š </p><br><pre> <code class="cpp hljs">Observable&lt;CombinedMessage&gt; getDependendMessages() { Observable&lt;NewsMessage&gt; news = newsCollection.snapshots().expand((snapShot) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> snapShot.documents; }).<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;NewsMessage&gt;((document) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NewsMessage.fromMap(document.data); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> news.asyncMap((newsEntry) async { var weatherDocuments = await weatherCollection.where(<span class="hljs-string"><span class="hljs-string">'location'</span></span>, isEqualTo: newsEntry.location).getDocuments(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CombinedMessage( WeatherForecast.fromMap(weatherDocuments.documents.first.data), newsEntry); }); }</code> </pre> <br><p> æ¯æ¬¡newsCollectionæ›´æ”¹æ—¶ï¼ŒgetDependendMessagesè¿”å›çš„Observableéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„CombinedMessageã€‚ </p><br><h2 id="otladka-observables"> è°ƒè¯•å¯è§‚å¯Ÿå¯¹è±¡ </h2><br><p> æŸ¥çœ‹ä¼˜é›…çš„Rxè°ƒç”¨é“¾ï¼Œä¼¼ä¹å‡ ä¹ä¸å¯èƒ½è°ƒè¯•è¿™æ ·çš„è¡¨è¾¾å¼ï¼š </p><br><pre> <code class="cpp hljs">Observable&lt;NewsMessage&gt; news = newsCollection .snapshots() .expand((snapShot) =&gt; snapShot.documents) .<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;NewsMessage&gt;((document) =&gt; NewsMessage.fromMap(document.data));</code> </pre> <br><p> ä½†æ˜¯è¯·è®°ä½ï¼Œ <code>=&gt;</code>åªæ˜¯åŒ¿åå‡½æ•°çš„ç¼©å†™ã€‚ ä½¿ç”¨â€œ <strong>è½¬æ¢â€å—ä¸»ä½“</strong> ï¼Œæ‚¨å°†è·å¾—ï¼š </p><br><pre> <code class="cpp hljs">Observable&lt;NewsMessage&gt; news = newsCollection .snapshots() .expand((snapShot) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> snapShot.documents; }) .<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;NewsMessage&gt;((document) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NewsMessage.fromMap(document.data); });</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç®¡é“çš„æ¯ä¸ªæ­¥éª¤ä¸­è®¾ç½®ä¸€ä¸ªæ–­ç‚¹æˆ–æ·»åŠ æ‰“å°è¯­å¥ã€‚ </p><br><h2 id="osteregaytes-pobochnyh-effektov"> å½“å¿ƒå‰¯ä½œç”¨ </h2><br><p>  <strong>å¦‚æœè¦åˆ©ç”¨Rxæ¥ä½¿ä»£ç æ›´å¥å£®ï¼Œè¯·å§‹ç»ˆè®°ä½Rxæ˜¯â€œæ²¿ç€ä¼ é€å¸¦â€ç§»åŠ¨æ—¶çš„æ•°æ®è½¬æ¢ã€‚</strong>  <strong>å› æ­¤ï¼Œåœ¨åˆ°è¾¾.listenå‡½æ•°ä¹‹å‰ï¼Œåˆ‡å‹¿è°ƒç”¨æ›´æ”¹å¤„ç†ç®¡é“ä¹‹å¤–çš„ä»»ä½•å˜é‡/çŠ¶æ€çš„å‡½æ•°ã€‚</strong> <br> è€Œä¸æ˜¯è¿™æ ·åšï¼š </p><br><pre> <code class="cpp hljs">Observable.fromFuture(getProduct()) .<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;Product&gt;((jsonString) { var product = Product.fromJson(jsonString); database.save(product); setState((){ _product = product }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> product; }).listen();</code> </pre> <br><p> è¿™æ ·åšï¼š </p><br><pre> <code class="cpp hljs">Observable.fromFuture(getProduct()) .<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>&lt;Product&gt;((jsonString) =&gt; Product.fromJson(jsonString)) .listen( (product) { database.save(product); setState((){ _product = product }); });</code> </pre> <br><p>  <code>map()</code>çš„èŒè´£æ˜¯è½¬æ¢æµä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”ä»€ä¹ˆéƒ½ä¸åšï¼ å¦‚æœä¼ é€’çš„æ˜¾ç¤ºåŠŸèƒ½è¿˜æœ‰å…¶ä»–ä½œç”¨ï¼Œåˆ™å°†å…¶è§†ä¸ºå‰¯ä½œç”¨ï¼Œä»è€Œç”Ÿæˆåœ¨è¯»å–ä»£ç æ—¶å¾ˆéš¾æ£€æµ‹åˆ°çš„æ½œåœ¨é”™è¯¯ã€‚ </p><br><h2 id="nekotorye-mysli-ob-osvobozhdenii-resursov"> å…³äºé‡Šæ”¾èµ„æºçš„ä¸€äº›æƒ³æ³• </h2><br><p> ä¸ºé¿å…å†…å­˜æ³„æ¼ï¼Œè¯·åœ¨ä¸å†éœ€è¦è®¢é˜…æ—¶å§‹ç»ˆè°ƒç”¨<code>cancel()</code>è¿›è¡Œè®¢é˜…ï¼Œå¯¹StreamControllersè¿›è¡Œ<code>dispose()</code> ï¼Œå¯¹Subjectsè¿›è¡Œ<code>close()</code>è°ƒç”¨ã€‚ </p><br><h2 id="zaklyuchenie"> ç»“è®º </h2><br><p> æ­å–œæ‚¨ä¸€ç›´é™ªåœ¨æˆ‘èº«è¾¹ã€‚ ç°åœ¨ï¼Œæ‚¨ä¸ä»…å¯ä»¥ä½¿ç”¨Rxæ¥<strong>ç®€åŒ–</strong>ç”Ÿæ´»ï¼Œè¿˜å¯ä»¥ä¸ºä¸‹ä¸€ç¯‡æ–‡ç« åšå‡†å¤‡ï¼Œåœ¨è¿™äº›æ–‡ç« ä¸­æˆ‘ä»¬å°†æ·±å…¥ç ”ç©¶<strong>RxVMS</strong>çš„ç»†èŠ‚ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN451292/">https://habr.com/ru/post/zh-CN451292/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN451276/index.html">å¦‚ä½•å»ºç«‹å“ç‰Œï¼Ÿ</a></li>
<li><a href="../zh-CN451278/index.html">å°æ³¢åˆ†æç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN451280/index.html">æœ€æœ‰è¶£çš„é‡‘å±</a></li>
<li><a href="../zh-CN451282/index.html">Webåˆ†æçš„é»‘æ´ï¼šGAä¸­ä¸¢å¤±äº†å¤šå°‘æ•°æ®ï¼Œä¸ºä»€ä¹ˆ</a></li>
<li><a href="../zh-CN451286/index.html">Roskomnadzorï¼Œæˆ‘ä»¬å€¼å¾—</a></li>
<li><a href="../zh-CN451294/index.html">å½“æˆ‘é€šè¿‡CANå‘æ±½è½¦æ·»åŠ åŠŸèƒ½æ—¶ï¼Œæ— æ³•ç¼–ç¨‹</a></li>
<li><a href="../zh-CN451296/index.html">ML.NET 1.0å®£å¸ƒ</a></li>
<li><a href="../zh-CN451298/index.html">å¦‚ä½•é€šè¿‡è®¢è´­ä¸€å—å°åˆ·ç”µè·¯æ¿æ¥åˆ¶ä½œå¸¦æœ‰å¤–å£³çš„æ¸¸æˆæœº</a></li>
<li><a href="../zh-CN451302/index.html">é¡¶çº§ITå¤–åŒ…å…¬å¸</a></li>
<li><a href="../zh-CN451304/index.html">Yandexâ€œç§˜è¯€â€ï¼šå¦‚ä½•ä½¿ä»˜è´¹è®¢é˜…çš„åˆ©æ¶¦æœ€å¤§åŒ–</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>