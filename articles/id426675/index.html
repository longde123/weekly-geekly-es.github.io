<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💇🏻 🤰🏼 🙇🏿 Mengikuti garis berbasis OpenCV ⏮️ 🚵🏼 👩🏿‍🎓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sekarang kursus yang sangat populer tentang cara membuat pilot otomatis untuk mobil. Gelar nano dari Udacity ini mungkin adalah opsi yang paling terke...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengikuti garis berbasis OpenCV</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426675/">  Sekarang kursus yang sangat populer tentang cara membuat pilot otomatis untuk mobil.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Gelar nano</a> dari Udacity ini mungkin adalah opsi yang paling terkenal. <br><br>  Banyak orang belajar darinya dan memposting keputusan mereka.  Saya juga tidak bisa lewat dan terbawa. <br><br>  Perbedaannya adalah bahwa kursus melibatkan pengembangan algoritma berdasarkan data yang diberikan, dan saya melakukan segalanya untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">robot saya</a> . <br><a name="habracut"></a><br>  Tugas pertama yang siswa hadapi ketika mempelajari visi komputer adalah mengikuti garis di jalan.  Banyak artikel telah ditulis tentang topik ini, berikut adalah beberapa yang paling rinci: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Habr</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menuju Ilmu Data</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sedang</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hackster</a> <br></li></ul><br>  Semuanya cukup sederhana dan skema kerjanya dikurangi menjadi beberapa poin: <br><br><ul><li>  Saring berdasarkan warna. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pilih wajah</a> </li><li>  Potong bagian gambar yang tidak diinginkan </li><li>  Deteksi garis menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">transformasi Hough</a> . </li></ul><br>  Saya menempelkan selotip putih ke lantai dan turun ke bisnis. <br><br><img src="https://habrastorage.org/webt/8v/dd/nw/8vddnwlx9odevming4sba03ddjc.jpeg"><br><br>  Dalam karya yang disebutkan di atas, tugas Anda adalah menemukan garis kuning, sehingga mereka bekerja dengan warna HLS dan HSV.  Karena garis saya hanya putih, saya memutuskan untuk tidak repot-repot dengan ini dan membatasi diri pada filter hitam dan putih. <br><br><h2>  Geometri </h2><br>  Masalah dengan geometri segera dimulai.  Untuk siswa dalam gambar, garis dengan panah masuk ke cakrawala.  Dan masih, banyak garis terdeteksi di sana, yang harus digabungkan oleh penulis.  Namun, garis mereka diarahkan dengan baik dan tidak ada puing-puing dalam gambar. <br><br>  Saya memiliki gambaran yang sangat berbeda.  Geometri strip pita listrik jauh dari lurus.  Melotot di lantai menimbulkan kebisingan. <br><br>  Setelah menerapkan Canny, inilah yang terjadi: <br><br><img src="https://habrastorage.org/webt/zi/6n/tw/zi6ntwcuu0t4zwtw9y3nevjg5je.jpeg"><br><br>  Dan garis Hough seperti ini <br><br><img src="https://habrastorage.org/webt/js/f6/vg/jsf6vghy2nrby8qjigoei6chn4o.jpeg" alt="gambar"><br><br>  Memperkuat kriteria, adalah mungkin untuk mengecualikan sampah, tetapi hampir semua garis yang ditemukan di strip menghilang.  Mengandalkan segmen sekecil itu akan bodoh. <br><br><img src="https://habrastorage.org/webt/tu/e1/cz/tue1czduaydztjue0g4aq0oe0so.jpeg"><br><br>  Secara umum, hasilnya sangat tidak stabil, dan terpikir oleh saya untuk mencoba pendekatan yang berbeda. <br><br>  Alih-alih garis, saya mulai mencari kontur.  Setelah membuat asumsi bahwa rangkaian terbesar adalah pita listrik, kami berhasil membuang sampah.  (Kemudian ternyata alas tiang putih besar menempati lebih banyak ruang dalam bingkai daripada pita listrik. Saya harus menutupinya dengan bantal sofa). <br>  Jika kita mengambil persegi panjang minimal yang membatasi kontur, maka garis longitudinal tengah sangat cocok untuk peran vektor gerak. <br><br><img src="https://habrastorage.org/webt/qc/xr/bw/qcxrbwggmkm6wkt-wzxq8xbtbkw.jpeg"><br><br><h2>  Cahaya </h2><br>  Masalah kedua adalah pencahayaan.  Saya sangat berhasil meletakkan satu sisi trek di bawah bayangan sofa dan sama sekali tidak mungkin untuk memproses foto seluruh trek dengan pengaturan yang sama.  Akibatnya, saya harus menerapkan cutoff dinamis pada filter hitam dan putih.  Algoritmanya adalah ini: jika setelah menerapkan filter dalam gambar terlalu banyak putih (lebih dari 10%), maka ambang harus dinaikkan.  Jika terlalu sedikit (kurang dari 3%) - hilangkan.  Praktek telah menunjukkan bahwa rata-rata untuk 3-4 iterasi dimungkinkan untuk menemukan cutoff optimal. <br><br>  Angka ajaib ditempatkan dalam konfigurasi terpisah (lihat di bawah), Anda dapat bermain dengannya untuk mencari yang optimal. <br><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">balance_pic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> T ret = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> direction = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, tconf.th_iterations): rc, gray = cv.threshold(image, T, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) crop = Roi.crop_roi(gray) nwh = cv.countNonZero(crop) perc = int(<span class="hljs-number"><span class="hljs-number">100</span></span> * nwh / Roi.get_area()) logging.debug((<span class="hljs-string"><span class="hljs-string">"balance attempt"</span></span>, i, T, perc)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> perc &gt; tconf.white_max: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> T &gt; tconf.threshold_max: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> direction == <span class="hljs-number"><span class="hljs-number">-1</span></span>: ret = crop <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> T += <span class="hljs-number"><span class="hljs-number">10</span></span> direction = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> perc &lt; tconf.white_min: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> T &lt; tconf.threshold_min: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> direction == <span class="hljs-number"><span class="hljs-number">1</span></span>: ret = crop <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> T -= <span class="hljs-number"><span class="hljs-number">10</span></span> direction = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: ret = crop <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret</code> </pre> <br>  Setelah menyesuaikan visi alat berat, dimungkinkan untuk beralih ke gerakan yang sebenarnya.  Algoritma itu adalah sebagai berikut: <br><br><ul><li>  0,5 detik berkendara lurus </li><li>  ambil gambar </li><li>  temukan vektor </li><li>  jika awal vektor bergeser relatif ke tengah gambar, kami sedikit taksi </li><li>  jika sudut kemiringan vektor menyimpang dari vertikal lebih dari yang diperlukan - kita mengarahkan ke arah yang benar </li><li>  jika tiba-tiba strip itu menghilang dari bingkai, kita membuat asumsi bahwa kita mengendarai belokan dan mulai berbelok ke arah setir terakhir atau kemiringan vektor pada langkah sebelumnya </li></ul><br>  Versi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">singkat</a> dari kode (Full-on <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Github</a> ): <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_shift_turn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(angle, shift)</span></span></span><span class="hljs-function">:</span></span> turn_state = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> angle &lt; tconf.turn_angle <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> angle &gt; <span class="hljs-number"><span class="hljs-number">180</span></span> - tconf.turn_angle: turn_state = np.sign(<span class="hljs-number"><span class="hljs-number">90</span></span> - angle) shift_state = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> abs(shift) &gt; tconf.shift_max: shift_state = np.sign(shift) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> turn_state, shift_state <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_turn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(turn_state, shift_state)</span></span></span><span class="hljs-function">:</span></span> turn_dir = <span class="hljs-number"><span class="hljs-number">0</span></span> turn_val = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> shift_state != <span class="hljs-number"><span class="hljs-number">0</span></span>: turn_dir = shift_state turn_val = tconf.shift_step <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> shift_state != turn_state <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> tconf.turn_step <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> turn_state != <span class="hljs-number"><span class="hljs-number">0</span></span>: turn_dir = turn_state turn_val = tconf.turn_step <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> turn_dir, turn_val <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">follow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(iterations)</span></span></span><span class="hljs-function">:</span></span> tanq.set_motors(<span class="hljs-string"><span class="hljs-string">"ff"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: last_turn = <span class="hljs-number"><span class="hljs-number">0</span></span> last_angle = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, iterations): a, shift = get_vector() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> last_turn != <span class="hljs-number"><span class="hljs-number">0</span></span>: a, shift = find_line(last_turn) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> last_angle != <span class="hljs-number"><span class="hljs-number">0</span></span>: logging.debug((<span class="hljs-string"><span class="hljs-string">"Looking for line by angle"</span></span>, last_angle)) turn(np.sign(<span class="hljs-number"><span class="hljs-number">90</span></span> - last_angle), tconf.turn_step) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> turn_state, shift_state = check_shift_turn(a, shift) turn_dir, turn_val = get_turn(turn_state, shift_state) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> turn_dir != <span class="hljs-number"><span class="hljs-number">0</span></span>: turn(turn_dir, turn_val) last_turn = turn_dir <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: time.sleep(tconf.straight_run) last_turn = <span class="hljs-number"><span class="hljs-number">0</span></span> last_angle = a <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: tanq.set_motors(<span class="hljs-string"><span class="hljs-string">"ss"</span></span>)</code> </pre><br><h2>  Hasil </h2><br>  Tidak rata, tetapi percaya diri, tangki merangkak di sepanjang lintasan: <br><br><img src="https://habrastorage.org/webt/cm/1c/ug/cm1cugubbk4nny-wavpxpqwa5eq.gif"><br><br>  Dan berikut ini adalah GIF dari grafik debugging: <br><br><img src="https://habrastorage.org/webt/x8/iy/rv/x8iyrvqh5r5zrulvgnyn5ipbysu.gif"><br><br><h2>  Pengaturan Algoritma </h2><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">## Picture settings # initial grayscale threshold threshold = 120 # max grayscale threshold threshold_max = 180 #min grayscale threshold threshold_min = 40 # iterations to find balanced threshold th_iterations = 10 # min % of white in roi white_min=3 # max % of white in roi white_max=12 ## Driving settings # line angle to make a turn turn_angle = 45 # line shift to make an adjustment shift_max = 20 # turning time of shift adjustment shift_step = 0.125 # turning time of turn turn_step = 0.25 # time of straight run straight_run = 0.5 # attempts to find the line if lost find_turn_attempts = 5 # turn step to find the line if lost find_turn_step = 0.2 # max # of iterations of the whole tracking max_steps = 100</span></span></code> </pre><br>  Kode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id426675/">https://habr.com/ru/post/id426675/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id426661/index.html">Cara memasuki magistracy atau sekolah pascasarjana tanpa ujian: trek baru - "Robotika" di Olimpiade "I am a Professional"</a></li>
<li><a href="../id426663/index.html">Cookbook Pengembang Ruby: Resep Desain Berbasis Domain (Bagian 1, Cakupan)</a></li>
<li><a href="../id426665/index.html">Paul Graham Debriefing: Viaweb Juni 1998</a></li>
<li><a href="../id426667/index.html">Seymour Papert: "Komputer sebagai kondom"</a></li>
<li><a href="../id426671/index.html">Kepala Google mengomentari peluncuran mesin pencari dengan sensor di Cina</a></li>
<li><a href="../id426677/index.html">Ada kegagalan hampir dua jam dalam pekerjaan layanan YouTube, sekarang layanan telah menjadi operasional</a></li>
<li><a href="../id426679/index.html">Kapan kode terpuji?</a></li>
<li><a href="../id426681/index.html">GitHub mengumumkan CI / CD-nya sendiri dan mulai mendistribusikan undangan</a></li>
<li><a href="../id426685/index.html">Kami mengontrol ratusan perangkat rumah pintar dengan suara dan teks dari telepon pintar. Alexa Echo di pembawa pesan</a></li>
<li><a href="../id426687/index.html">Membuat case robot dengan anggaran terbatas. Vakum membentuk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>