<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’ƒğŸ¿ ğŸ¤¦ ğŸ¤²ğŸ¾ (5-2) FaÃ§ons de migrer une grande table SQL ğŸ‘‚ğŸ¿ ğŸ® ğŸ’Š</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PrÃ©sentation 
 Bonjour Ã  tous! Ceci est mon premier article et je l'Ã©cris au nom d'un ingÃ©nieur de dÃ©veloppement junior en C #. Il n'y aura donc pas d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>(5-2) FaÃ§ons de migrer une grande table SQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434800/"><h3>  PrÃ©sentation </h3><br>  Bonjour Ã  tous!  Ceci est mon premier article et je l'Ã©cris au nom d'un ingÃ©nieur de dÃ©veloppement junior en C #.  Il n'y aura donc pas d'informations dÃ©taillÃ©es sur SQL, seulement des informations pratiques et des rÃ©flexions sur la rÃ©solution d'un problÃ¨me plutÃ´t pas Ã©vident que j'ai dÃ» affronter pour les mÃªmes nouveaux arrivants que moi. <br><br>  Tout d'abord, je vais dÃ©crire la formulation de mon problÃ¨me Ã  titre d'exemple, dans lequel il existe un rÃ©el besoin de dÃ©placer une grande table. <br><br>  Supposons donc que vous disposiez d'un service Web et d'une base de donnÃ©es SQL (MS-SQL) avec une table de lettres html que votre service envoie aux utilisateurs.  Les lettres sont stockÃ©es pendant un certain nombre d'annÃ©es et ne peuvent pas Ãªtre supprimÃ©es, car elles sont nÃ©cessaires pour collecter des statistiques et des analyses.  Cependant, chaque annÃ©e, le nombre de lettres augmente, la base de donnÃ©es augmente et l'espace sur le serveur SQL diminue (dans notre cas, un autre facteur Ã©tait de restaurer la base de donnÃ©es sur le site de test, car son temps augmentait proportionnellement) et quelque chose doit Ãªtre fait avec cela Ã  faire.  Heureusement, dans notre cas, il existe un serveur gratuit avec un tas d'espace libre (en rÃ©alitÃ©, ce n'est peut-Ãªtre pas le cas, et bien sÃ»r, c'est une solution temporaire, mais cela dÃ©passe le cadre de l'article).  Le problÃ¨me s'est donc posÃ© de dÃ©placer une grande table (et en disant Â«grandeÂ», je veux dire une trÃ¨s grande table, tout ce que j'ai vu en recherchant des solutions similaires Ã©tait de l'ordre de 60 Ã  100 Go, dans notre cas, la table pesait plus de 300 Go). <br><br>  Nous considÃ©rerons plusieurs faÃ§ons de rÃ©soudre ce problÃ¨me, mais elles ne concerneront pas toutes le transfert de type serveur-serveur.  Parfois, il peut Ãªtre nÃ©cessaire de transfÃ©rer une table entre des bases de donnÃ©es au sein du mÃªme serveur.  De plus, certaines mÃ©thodes sont purement thÃ©oriques, je ne les ai pas toutes testÃ©es en pratique, mais elles devraient probablement fonctionner. <br><a name="habracut"></a><br><h3>  MÃ©thode -1.  Les donnÃ©es </h3><br>  Peu importe Ã  quel point cela semble Ã©vident, mais vous devez savoir quelles donnÃ©es vous allez transfÃ©rer.  Le plus souvent, les donnÃ©es ne sont pas stockÃ©es de la maniÃ¨re la plus optimale et les informations excÃ©dentaires peuvent Ã©galement Ãªtre stockÃ©es.  Il est probable que dans votre cas particulier, vous puissiez vous passer de transfÃ©rer toutes les donnÃ©es. <br><br>  Tout d'abord, la suppression d'une colonne peut probablement vous aider, mais il s'agit d'une opÃ©ration de blocage et il n'est pas toujours possible d'arrÃªter un service Web.  Et sur HabrÃ©, il y a un article dans lequel on explique comment cela peut se faire. <br><br>  DeuxiÃ¨mement, n'oubliez pas la normalisation.  Peut-Ãªtre que certaines donnÃ©es peuvent Ãªtre transfÃ©rÃ©es dans le dictionnaire (dans le cas des lettres, il Ã©tait possible de stocker non pas le corps des lettres, mais des modÃ¨les avec les donnÃ©es qui y sont insÃ©rÃ©es), et seul l'identifiant de ces Ã©lÃ©ments pourrait Ãªtre stockÃ© dans un grand tableau, cela peut vous libÃ©rer beaucoup d'espace. <br><br><h3>  MÃ©thode 0. SELECT INTO </h3><br>  Blague =) Vous ne pouvez donc que vous mettre une base.  Cependant, si nous parlons de la petite taille de la table (alors que faites-vous ici), vous pouvez essayer de transfÃ©rer la base de donnÃ©es en utilisant cette instruction.  De plus, si vous avez une base de test, vous pouvez effectuer une expÃ©rience pour Ã©valuer le temps de transfert total en utilisant cette mÃ©thode "sur le front". <br><br><h3>  MÃ©thode 1. Sauvegarde </h3><br>  La maniÃ¨re la plus Â«canoniqueÂ», c'est celle-ci qui est devenue la solution Ã  mon problÃ¨me.  Nous faisons une sauvegarde de la base de donnÃ©es contenant notre table, nous la restaurons sur un autre serveur et la supprimons de tout ce qui est inutile.  De plus, s'il est possible d'arrÃªter le service Web, vous pouvez le redÃ©ployer en configurant l'enregistrement dans la table transfÃ©rÃ©e et supprimer l'ancien <b>* *</b> (ici, il est fort probable qu'il puisse y avoir un moment oÃ¹ il sera nÃ©cessaire de lui Ã©crire des requÃªtes avec des jointures, pour ce Google comment lier sql- serveurs).  Si cela n'est pas possible, nous corrigeons l'identifiant de la derniÃ¨re lettre (pour la synchronisation), puis nous devrons supprimer <b>*</b> toutes les lettres transfÃ©rÃ©es (nous continuerons d'Ã©crire dans l'ancien tableau). <br><br>  <b>* En</b> supprimant un sujet sÃ©parÃ© pour la conversation, il peut sembler que c'est beaucoup plus rapide que le transfert, mais ce n'est pas le cas et dans le cas gÃ©nÃ©ral, je conseille de le supprimer par portions. <br><br><h3>  MÃ©thode 2: MS-SQL Management Studio </h3><br>  Si vous avez ce studio, vous pouvez essayer d'utiliser l'outil intÃ©grÃ© pour exporter et importer des donnÃ©es.  Personnellement, j'ai lu sur le dÃ©bordement de pile que cette chose Ã©tait accrochÃ©e Ã  une table de 60 gig et ne prenait aucun risque. <br><br><h3>  MÃ©thode 3. Partition </h3><br>  AmÃ©lioration de la mÃ©thode du front.  L'idÃ©e est de transfÃ©rer les donnÃ©es de la maniÃ¨re habituelle avec un temporisateur entre les itÃ©rations.  Vous coupez toutes les lignes en portions (par exemple, 100k chacune), transfÃ©rez la portion (et vous pouvez la supprimer tout de suite, mais vous ne savez pas Ã  quel point elle est sÃ»re), puis endormez-vous et ainsi de suite jusqu'Ã  la fin amÃ¨re.  Il est prÃ©fÃ©rable de transfÃ©rer depuis la fin pour ne pas avoir Ã  synchroniser les donnÃ©es Ã  la fin.  La mÃ©thode est Ã©videmment trÃ¨s lente, mais de cette faÃ§on vous allez tout transfÃ©rer sans arrÃªter le service web.  Il sera probablement plus pratique de l'implÃ©menter non pas avec un script SQL, mais avec l'aide de certains ORM. <br><br><h3>  RÃ©sumÃ© </h3><br>  Le processus de transfert d'une grande quantitÃ© de donnÃ©es prend toujours un certain temps, et vous devez vous y prÃ©parer.  Il n'y a aucun moyen magique de rÃ©soudre instantanÃ©ment votre problÃ¨me.  Dans chaque cas, vous devez tirer parti de vos volumes et de vos limites.  Si aucune des mÃ©thodes ne fonctionne pour vous, demandez-vous si vous pouvez utiliser n'importe quelle combinaison d'entre elles. <br><br>  Ã€ la fin, je voudrais ajouter 2 points importants. <br><br>  Tout processus de transfert / suppression de lignes dans SQL est enregistrÃ© dans le journal des transactions pour pouvoir tout annuler en cas d'erreur (je supposais auparavant que cela n'Ã©tait effectuÃ© que dans le cadre d'une transaction).  De plus, la taille du journal est mÃªme un peu plus que la quantitÃ© de donnÃ©es.  Assurez-vous que vous disposez de l'espace nÃ©cessaire ou dÃ©sactivez la journalisation, mais ce n'est pas sÃ»r. <br><br>  Avant le transfert, vous devez vous assurer que le fichier de donnÃ©es et le fichier journal sont de la bonne taille, car  les opÃ©rations d'extension prennent un temps considÃ©rable et les configurent en consÃ©quence. Vous optimisez ainsi la migration. <br>  Merci Ã  tous ceux qui ont lu!  Je serai heureux de toute critique, commentaire et clarification.  Partagez vos mÃ©thodes et techniques pour travailler avec les mÃ©gadonnÃ©es, comme  il s'agit souvent d'informations trÃ¨s importantes et nÃ©cessaires qui ne sont pas si faciles Ã  trouver. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434800/">https://habr.com/ru/post/fr434800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434790/index.html">Tant de JDK ... Lequel utiliser et ce qu'il menace?</a></li>
<li><a href="../fr434792/index.html">Freelansim 2018: rÃ©sultats de l'annÃ©e</a></li>
<li><a href="../fr434794/index.html">CompÃ©tences gÃ©nÃ©rales d'un testeur rÃ©ussi</a></li>
<li><a href="../fr434796/index.html">Coding the Art: comment gÃ©nÃ©rer des graphiques et des animations dans les projets de conception</a></li>
<li><a href="../fr434798/index.html">Swagger - Documentation intelligente de votre API Web RESTful - Revue de dÃ©veloppeur back-end junior pour les dÃ©butants</a></li>
<li><a href="../fr434802/index.html">"Je ne donnerai pas de pierre" ou comment les ressources du jeu "Cursed Lands" sont disposÃ©es</a></li>
<li><a href="../fr434804/index.html">La start-up Fintech Robinhood n'a pas pu lancer un analogue des comptes bancaires</a></li>
<li><a href="../fr434806/index.html">DÃ©mantÃ¨lement du nouvel an avec une canette</a></li>
<li><a href="../fr434810/index.html">Starter pour travailler avec Spring Cloud</a></li>
<li><a href="../fr434812/index.html">Gestion du temps du projet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>