<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•§ ğŸ¤¶ğŸ¾ #âƒ£ Tests feuilletÃ©s ğŸ‘©ğŸ½â€ğŸŒ¾ ğŸ¦Š ğŸ‘ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quoi de plus dÃ©sagrÃ©able que le "test rouge"? Le test est soit vert soit rouge, et on ne sait pas pourquoi. Lors de notre confÃ©rence Heisenbug 2017 Ã  ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tests feuilletÃ©s</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/416757/">  Quoi de plus dÃ©sagrÃ©able que le "test rouge"?  Le test est soit vert soit rouge, et on ne sait pas pourquoi.  Lors de notre confÃ©rence Heisenbug 2017 Ã  Moscou, <b>Andrei Solntsev</b> (Codeborne) a expliquÃ© pourquoi ils pouvaient survenir et comment rÃ©duire leur nombre.  Les exemples de son rapport sont tels que vous ressentez la douleur directement dans la peau lorsque vous entrez en collision avec eux.  Et les conseils sont utiles - et cela vaut la peine de faire la connaissance des testeurs et des dÃ©veloppeurs.  Il y a quelque chose d'inattendu: vous pouvez dÃ©couvrir comment parfois vous pouvez rÃ©soudre un problÃ¨me si vous vous Ã©loignez de l'Ã©cran et jouez des cubes avec votre fille. <br><br>  En consÃ©quence, le public a apprÃ©ciÃ© le rapport et nous avons dÃ©cidÃ© non seulement de publier la vidÃ©o, mais aussi de faire une version texte du rapport pour Habr. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/jLG3RXECQU8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br>  Ã€ mon avis, les tests feuilletÃ©s sont le sujet le plus pertinent dans le monde de l'automatisation.  Parce que la question "qu'est-ce qui se fait dans le monde, comment faites-vous avec l'automatisation?"  tous rÃ©pondent: Â«Il n'y a pas de stabilitÃ©!  Nos tests tombent pÃ©riodiquement. Â» <br><br>  Vous avez effectuÃ© un test chez vous, il est vert, encore deux jours verts, puis une fois et tout Ã  coup tombÃ© sur Jenkins.  Vous essayez de le rÃ©pÃ©ter, de le dÃ©marrer et il redevient vert.  Et au final, on ne sait jamais: est-ce un bug ou est-ce juste un test au glucane?  Et chaque fois que vous devez comprendre. <br><br>  Souvent, aprÃ¨s un lancement nocturne de tests sur Jenkins, le testeur voit d'abord "30 tests sont tombÃ©s, vous devez Ã©tudier", mais tout le monde sait ce qui se passe ensuite ... <br><br><img src="https://habrastorage.org/webt/fz/vg/jh/fzvgjhfo6snzfs6qa0d9clltgcc.jpeg"><br><br>  Vous avez bien sÃ»r devinÃ© quel mot indÃ©cent dÃ©guisÃ©: "Je vais recommencer".  Comme, "aujourd'hui, il n'y a aucune rÃ©ticence Ã  comprendre ..." C'est comme Ã§a que Ã§a se passe habituellement, et c'est un vrai dÃ©sastre. <br><br>  Il n'y a pas de statistiques exactes, mais j'ai souvent entendu des gens diffÃ©rents dire qu'ils avaient environ 30% des tests - floconneux.  En gros, ils en lancent un millier, dont 300 sont pÃ©riodiquement rouges, puis ils vÃ©rifient avec leurs mains s'ils sont effectivement tombÃ©s. <br><br>  Google a publiÃ© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un article il y a</a> quelques annÃ©es: il dit qu'ils ont 1,5% de tests floconneux et explique comment ils se battent pour rÃ©duire leur nombre.  Je peux me vanter un peu et dire que mon projet chez Codeborne est maintenant de 0,1%.  Mais en fait, tout cela est mauvais, mÃªme 0,1%.  Pourquoi? <br><br>  Prenez 1,5%, ce chiffre semble faible, mais qu'est-ce que cela signifie en pratique?  Disons qu'il y a mille tests dans un projet.  Cela peut signifier que 15 tests sont tombÃ©s dans une version, les 12 suivants, puis 18. Et c'est terriblement mauvais, car dans ce cas, presque toutes les versions sont rouges, et vous devez constamment vÃ©rifier avec vos mains si c'est vrai ou non. <br><br>  Et mÃªme notre ppm (0,1%) est toujours mauvais.  Supposons que nous ayons 1000 tests, alors 0,1% signifie que rÃ©guliÃ¨rement un build sur dix tombe avec 1-2 tests rouges.  Voici la vraie image de notre Jenkins, et il s'avÃ¨re: avec un run, un test feuilletÃ© est tombÃ©, avec un autre dÃ©part un autre. <br><br><img src="https://habrastorage.org/webt/dv/gx/da/dvgxdacsvc67zygojg18pu50v-q.jpeg"><br><br>  Il sâ€™avÃ¨re que nous nâ€™avons pas de journÃ©e sans construction rouge.  Puisqu'il y a beaucoup de vert, tout semble aller bien, mais le client a le droit de nous demander: "Les gars, nous vous payons de l'argent, et vous nous fournissez toujours du rouge!"  Que fais-tu? " <br><br>  Je serais insatisfait chez le client et expliquer "en gÃ©nÃ©ral, c'est normal dans l'industrie, tout est rouge pour tout le monde" n'est pas bon, non?  Par consÃ©quent, Ã  mon avis, il s'agit d'un problÃ¨me trÃ¨s urgent, et essayons de comprendre ensemble comment y faire face. <br><br>  Le plan est le suivant: <br><br><ol><li>  Ma collection de tests instables (de ma pratique, des cas absolument rÃ©els, des histoires de dÃ©tective complexes et intÃ©ressantes) </li><li>  Causes d'instabilitÃ© (certains ont mÃªme mis des annÃ©es Ã  rechercher) </li><li>  Comment y faire face?  (j'espÃ¨re que ce sera la partie la plus utile) </li></ol><br>  CommenÃ§ons donc avec ma collection, que j'apprÃ©cie beaucoup: cela m'a coÃ»tÃ© de nombreuses heures de vie et de dÃ©bogage.  CommenÃ§ons par un exemple simple. <br><br><h2>  Exemple 1: classique </h2><br>  Pour les semences - le script classique de sÃ©lÃ©nium: <br><br><pre><code class="java hljs">driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://www.google.com/"</span></span>); driver.findElement(By.name(<span class="hljs-string"><span class="hljs-string">"q"</span></span>)).sendKeys(<span class="hljs-string"><span class="hljs-string">"selenide"</span></span>); driver.findElement(By.name(<span class="hljs-string"><span class="hljs-string">"btnK"</span></span>)).click(); assertEquals(<span class="hljs-number"><span class="hljs-number">9</span></span>, driver.findElements(By.cssSelector(<span class="hljs-string"><span class="hljs-string">"#ires .g"</span></span>)).size());</code> </pre> <br><ol><li>  Nous ouvrons WebDriver; </li><li>  Trouvez l'Ã©lÃ©ment q, entrez le mot pour y chercher; </li><li>  Trouvez l'Ã©lÃ©ment Â«ButtonÂ» et cliquez; </li><li>  VÃ©rifiez que la rÃ©ponse est de neuf rÃ©sultats. </li></ol><br>  Question: quelle ligne peut casser ici? <br><br>  C'est vrai, nous le savons tous bien!  N'importe quelle ligne peut casser, pour des raisons complÃ¨tement diffÃ©rentes: <br><br>  La premiÃ¨re ligne est l'Internet lent, le service est tombÃ© en panne, les administrateurs n'ont pas configurÃ© quelque chose. <br><br>  La deuxiÃ¨me ligne - l'Ã©lÃ©ment n'a pas encore eu le temps de s'afficher s'il est dessinÃ© dynamiquement. <br>  Qu'est-ce qui pourrait casser en troisiÃ¨me ligne?  Ici, c'Ã©tait inattendu pour moi: j'ai Ã©crit ce test pour la confÃ©rence, l'ai exÃ©cutÃ© localement et il est tombÃ© sur la troisiÃ¨me ligne avec cette erreur: <br><br><img src="https://habrastorage.org/webt/8n/qu/4l/8nqu4l-8byopdwjdkbcrcgkhery.jpeg"><br><br>  Cela signifie que l'Ã©lÃ©ment Ã  ce stade n'est pas cliquable.  Il semblerait qu'un simple formulaire Google de base.  Le secret Ã©tait que dans la deuxiÃ¨me ligne, nous avons frappÃ© le mot, et pendant que nous le saisissions, Google a dÃ©jÃ  trouvÃ© les premiers rÃ©sultats, a montrÃ© les premiers rÃ©sultats dans une telle fenÃªtre pop-up, et ils ont fermÃ© le bouton suivant.  Et cela ne se produit pas dans tous les navigateurs et pas toujours.  Cela m'est arrivÃ© avec ce script environ une fois sur cinq. <br><br>  La quatriÃ¨me ligne peut tomber, par exemple, car cet Ã©lÃ©ment est dessinÃ© dynamiquement et n'a pas encore eu le temps de dessiner. <br><br>  Dans cet exemple, je veux dire que, selon mon expÃ©rience, 90% des tests feuilletÃ©s sont basÃ©s sur les mÃªmes raisons: <br><br><ul><li>  Ajax demande la vitesse: parfois, ils fonctionnent plus lentement, parfois plus vite; </li><li>  L'ordre des demandes Ajax; </li><li>  Vitesse js. </li></ul><br>  Heureusement, il existe un remÃ¨de pour ces raisons!  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Selenide</a> rÃ©sout ces problÃ¨mes.  Comment dÃ©cide-t-il?  Nous rÃ©Ã©crivons notre test Google sur Selenide - presque tout y ressemble, seuls les signes $ sont utilisÃ©s: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userCanLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ open(â€œhttp:<span class="hljs-comment"><span class="hljs-comment">//localhost:8080/loginâ€); $(By.name(â€œusernameâ€).setValue(â€œjohnâ€); $(â€œ#submitâ€).click(); $(â€œ.menuâ€).shouldHave(text(â€œHello, John!â€)); }</span></span></code> </pre><br>  Ce test passe toujours.  Ã‰tant donnÃ© que les mÃ©thodes setValue (), click () et shouldHave () sont intelligentes: si quelque chose n'a pas le temps de peindre, elles attendent un peu et rÃ©essayent (c'est ce qu'on appelle des Â«attentes intelligentesÂ»). <br><br>  Si vous regardez un peu plus en dÃ©tail, alors toutes ces mÃ©thodes devraient * sont intelligentes: <br><br><img src="https://habrastorage.org/webt/gq/x8/uq/gqx8uq3gjj6wudrx0n3uajntzdy.jpeg"><br><br>  Ils peuvent attendre si nÃ©cessaire.  Par dÃ©faut, ils attendent jusqu'Ã  4 secondes, et ce dÃ©lai, bien sÃ»r, est configurable, vous pouvez en spÃ©cifier un autre.  Par exemple, comme ceci: mvn -Dselenide.timeout = 8000. <br><br><h2>  Exemple 2: nbob </h2><br>  Ainsi, 90% des problÃ¨mes avec les tests feuilletÃ©s sont rÃ©solus avec Selenide.  Mais 10% des cas beaucoup plus sophistiquÃ©s restent avec des raisons complexes et dÃ©routantes.  C'est prÃ©cisÃ©ment Ã  propos d'eux que je veux parler aujourd'hui, car c'est une telle Â«zone griseÂ».  Permettez-moi de vous donner un exemple: un test feuilletÃ©, que j'ai immÃ©diatement rencontrÃ© dans un nouveau projet.  Ã€ premiÃ¨re vue, cela ne peut tout simplement pas se produire, mais c'est quelque chose d'intÃ©ressant. <br><br>  Nous avons testÃ© l'application clavier pour la connexion dans les kiosques.  Le test voulait se connecter en tant qu'utilisateur "bob", c'est-Ã -dire entrer trois lettres dans le champ "login": bob.  Pour ce faire, les boutons Ã  l'Ã©cran ont Ã©tÃ© utilisÃ©s.  En rÃ¨gle gÃ©nÃ©rale, cela a fonctionnÃ©, mais parfois le test s'est Ã©crasÃ©, et la valeur "nbob" est restÃ©e dans le champ "login": <br><br><img src="https://habrastorage.org/webt/7u/hp/zs/7uhpzsf9wrppgubv_cra_ldg2ri.jpeg"><br><br>  Naturellement, vous avez du mal Ã  chercher par le code oÃ¹ nous aurions pu Ã©crire "nbob" - mais dans tout le projet ce n'est pas du tout (ni dans la base de donnÃ©es, ni dans le code, ni mÃªme dans les fichiers Excel).  Comment est-ce possible? <br><br>  Nous regardons le code plus en dÃ©tail - il semblerait que tout est simple, sans Ã©nigmes: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loginKiosk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ open(â€œhttp:<span class="hljs-comment"><span class="hljs-comment">//localhost:9000/kioskâ€); $(â€œbodyâ€).click(); $(By.name(â€œusernameâ€)).sendKeys(â€œbobâ€); $(â€œ#loginâ€).click(); }</span></span></code> </pre><br>  Nous avons commencÃ© Ã  dÃ©battre davantage, Ã  aller pas Ã  pas, et avec cette mÃ©thode, nous avons rÃ©ussi Ã  comprendre: cette erreur apparaÃ®t parfois aprÃ¨s la ligne $ (Â«bodyÂ»). Cliquez sur ().  Autrement dit, Ã  cette Ã©tape, Â«nÂ» apparaÃ®t dans le champ Â«connexionÂ», puis Â«bobÂ» est ajoutÃ© aux Ã©tapes suivantes.  Qui a dÃ©jÃ  devinÃ© d'oÃ¹ vient "n"? <br><br>  Il se trouve que la lettre N Ã©tait au milieu de l'Ã©cran, et la fonction click () au moins dans Chrome fonctionne comme ceci: elle calcule la coordonnÃ©e centrale d'un Ã©lÃ©ment et clique dessus.  Puisque le corps est un grand Ã©lÃ©ment, elle a cliquÃ© au centre de tout l'Ã©cran. <br><br><img src="https://habrastorage.org/webt/56/xh/k_/56xhk_clrm85lqkyn-wqeaa5hg4.jpeg"><br><br>  Et cela ne tombait pas toujours.  Qui sait pourquoi?  En fait, je ne le sais pas moi-mÃªme.  Peut-Ãªtre dÃ» au fait que la fenÃªtre du navigateur sâ€™ouvrait tout le temps dans diffÃ©rentes tailles, et cela ne tombait pas toujours dans la lettre N. <br><br>  Vous avez probablement une question: pourquoi quelqu'un a-t-il fait $ ("body"). Cliquez sur ()?  Je ne sais pas non plus jusqu'Ã  la fin, mais je suppose que pour supprimer le focus du champ.  Il y a un tel problÃ¨me dans Selenium que click () existe, mais unclick () ne l'est pas.  S'il y a un focus dans le champ, il ne peut pas Ãªtre supprimÃ© de lÃ , vous ne pouvez que cliquer sur n'importe quel autre Ã©lÃ©ment.  Et comme il n'y avait pas d'autres Ã©lÃ©ments raisonnables, ils ont cliquÃ© sur le corps et ont obtenu un tel effet. <br><br>  D'oÃ¹ la morale: n'insÃ©rez rien qui pÃ©nÃ¨tre dans le &lt;body&gt;.  En d'autres termes, vous n'avez pas besoin de faire de mouvements supplÃ©mentaires en panique.  En fait, cela arrive souvent: puisque je traite avec Selenide, je reÃ§ois souvent des plaintes Â«quelque chose ne fonctionne pasÂ», puis il s'avÃ¨re que quelque part dans les mÃ©thodes de configuration, il y avait 15 lignes supplÃ©mentaires qui ne font rien d'utile et interfÃ¨rent .  Pas besoin de se tracasser et de s'insÃ©rer quand mÃªme dans des tests comme Â«du coup Ã§a sera plus fiableÂ». <br><br>  En consÃ©quence, nous Ã©largissons la liste des raisons des tests instables: <br><br><ul><li>  Vitesse de requÃªte Ajax; </li><li>  L'ordre des demandes Ajax; </li><li>  Vitesse js; </li><li>  Taille de la fenÃªtre du navigateur; </li><li>  VanitÃ©! </li></ul><br>  Et en mÃªme temps, ma recommandation est: ne pas exÃ©cuter de tests en maximisÃ© (c'est-Ã -dire, ne pas ouvrir le navigateur dans une fenÃªtre complÃ¨te).  En rÃ¨gle gÃ©nÃ©rale, tout le monde le fait, et dans Selenide, c'Ã©tait par dÃ©faut (ou l'est toujours).  Au lieu de cela, je vous conseille de toujours lancer un navigateur avec une rÃ©solution d'Ã©cran strictement dÃ©finie, car alors ce facteur alÃ©atoire est exclu.  Et je vous conseille de dÃ©finir la taille minimale prise en charge par votre application en fonction des spÃ©cifications. <br><br><h2>  Exemple 3: comptes fantÃ´mes </h2><br>  Un exemple est intÃ©ressant en ce que tout ce qui ne peut que coÃ¯ncider coÃ¯ncide immÃ©diatement. <br><br>  Un test a vÃ©rifiÃ© qu'il devrait y avoir 5 comptes sur cet Ã©cran. <br><br><img src="https://habrastorage.org/webt/td/hp/vl/tdhpvl7b-2ar4jxetsboygszf7m.jpeg"><br><br>  En rÃ¨gle gÃ©nÃ©rale, il Ã©tait vert, mais parfois, il n'Ã©tait pas clair dans quelles conditions il tombait et disait qu'il n'y avait pas cinq, mais six chefs d'accusation Ã  l'Ã©cran. <br><br>  J'ai commencÃ© Ã  chercher d'oÃ¹ vient la facture supplÃ©mentaire.  Absolument incomprÃ©hensible.  La question s'est posÃ©e: peut-Ãªtre que nous avons un autre test, qui pendant le test crÃ©e un nouveau compte?  Il s'est avÃ©rÃ© que oui, il existe un tel test de prÃªt.  Et entre celui-ci et la baisse de AccountsTest (qui attend cinq comptes), il peut y avoir un million d'autres tests. <br><br>  Nous essayons de comprendre comment il en est ainsi: le LoansTest, qui crÃ©e le compte, ne devrait-il pas le supprimer Ã  la fin?  Nous regardons son code - oui, il devrait, Ã  la fin il y a une fonction After pour cela.  Alors, en thÃ©orie, tout devrait bien se passer, quel est le problÃ¨me? <br><br>  Peut-Ãªtre que le test le supprime, mais il reste en cache quelque part?  Nous regardons le code de production qui charge les comptes - il a vraiment l'annotation @CacheFor, il met en cache les comptes pendant cinq minutes. <br><br>  La question se pose: mais le test ne devrait-il pas vider ce cache?  Ce serait logique, ne peut-il y avoir un tel montant?  Nous regardons son code - oui, il efface vraiment le cache avant chaque test.  Quoi de neuf?  Ici, vous Ãªtes dÃ©jÃ  perdu, car les hypothÃ¨ses sont terminÃ©es: l'objet est supprimÃ©, le cache est vidÃ©, les arbres, quoi d'autre pourrait poser problÃ¨me?  Puis il a commencÃ© Ã  grimper le code, cela a pris du temps, peut-Ãªtre mÃªme quelques jours.  Jusqu'Ã  ce que je regarde enfin cette classe et cette superclasse, et que j'y trouve une chose suspecte: <br><br><img src="https://habrastorage.org/webt/ug/iz/qz/ugizqze3zr1gmexqfzgxfzqtb_o.jpeg"><br><br>  Quelqu'un a dÃ©jÃ  remarquÃ©, non?  C'est vrai: dans l'enfant et dans la classe parent il y a une mÃ©thode avec le mÃªme nom, et elle n'appelle pas super. <br><br>  Et en Java, c'est trÃ¨s facile Ã  faire: vous appuyez sur Alt + EntrÃ©e ou Ctrl + InsÃ©rer dans IntelliJ IDEA ou Eclipse, par dÃ©faut, il crÃ©e la mÃ©thode setUp () pour vous, et vous ne remarquez pas qu'il remplace la mÃ©thode dans la superclasse.  Autrement dit, le cache n'a toujours pas Ã©tÃ© appelÃ©.  Quand j'ai vu Ã§a, j'Ã©tais extrÃªmement en colÃ¨re.  C'est joyeux pour moi maintenant. <br><br>  D'oÃ¹ la morale: <br><br><ol><li>  Dans les tests, il est trÃ¨s important de surveiller le code propre.  Si dans le code de production tout le monde est attentif Ã  cela, ils procÃ¨dent Ã  une rÃ©vision du code, puis Ã  des tests - pas toujours. </li><li>  Si le code de production est vÃ©rifiÃ© par des tests, alors qui testera les tests?  Par consÃ©quent, il est particuliÃ¨rement important d'utiliser des vÃ©rifications dans l'EDI. </li></ol><br>  AprÃ¨s cet incident, j'ai trouvÃ© dans IDEA une telle inspection, dÃ©sactivÃ©e par dÃ©faut, qui vÃ©rifie: si la mÃ©thode est remplacÃ©e quelque part, mais qu'il n'y a pas d'annotation @ Overrid, cela marque cela comme une erreur.  Maintenant, je coche toujours hystÃ©riquement cette case. <br><br>  RÃ©sumons Ã  nouveau: comment cela s'est-il produit, pourquoi le test n'a-t-il pas toujours Ã©chouÃ©?  Tout d'abord, cela dÃ©pendait de l'ordre de ces deux tests, ils se dÃ©roulent toujours dans un ordre alÃ©atoire.  Un autre test dÃ©pendait du temps qui s'est Ã©coulÃ© entre eux.  Les comptes sont mis en cache pendant cinq minutes, si plus de rÃ©ussite, le test Ã©tait vert, et si moins, il est tombÃ©, et cela s'est rarement produit. <br><br>  Nous Ã©largissons la liste des raisons pour lesquelles les tests peuvent Ãªtre instables: <br><br><ul><li>  Vitesse de requÃªte Ajax; </li><li>  L'ordre des demandes Ajax; </li><li>  Vitesse js; </li><li>  Taille de la fenÃªtre du navigateur; </li><li>  Cache d'application; </li><li>  DonnÃ©es des tests prÃ©cÃ©dents; </li><li>  Le temps. </li></ul><br><h2>  Exemple 4: Java Time </h2><br>  Un test a fonctionnÃ© sur tous nos ordinateurs et sur nos Jenkins, mais s'est parfois Ã©crasÃ© sur un client Jenkins.  Nous regardons le test, comprenons pourquoi.  Il s'est avÃ©rÃ© qu'elle Ã©tait en baisse, car lors de la vÃ©rification "la date de paiement devrait Ãªtre maintenant ou dans le passÃ©", elle s'est avÃ©rÃ©e Ãªtre "Ã  l'avenir". <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> payment.time &lt;= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date();</code> </pre><br>  Nous regardons dans le code, tout Ã  coup, sous certaines conditions, pouvons-nous fixer une date dans le futur?  Nous ne pouvons pas: au seul endroit oÃ¹ le dÃ©lai de paiement est initialisÃ©, une nouvelle date () est utilisÃ©e, et c'est toujours l'heure actuelle (dans les cas extrÃªmes, elle peut Ãªtre dans le passÃ© si le test Ã©tait trÃ¨s lent).  Comment est-ce encore possible?  Ils se sont battus la tÃªte pendant longtemps, ils ne pouvaient pas comprendre. <br><br>  Et une fois qu'ils ont regardÃ© dans le journal des applications.  D'oÃ¹ la premiÃ¨re morale - il est trÃ¨s utile lors de l'examen des tests pour consulter le journal de l'application elle-mÃªme.  Levez la main, qui le fait.  En gÃ©nÃ©ral, pas la majoritÃ©, hÃ©las.  Et il y a des informations utiles: par exemple, le journal des demandes, telle ou telle URL a Ã©tÃ© exÃ©cutÃ©e Ã  un tel moment, a donnÃ© telle ou telle rÃ©ponse. <br><br><img src="https://habrastorage.org/webt/z5/ca/cv/z5cacvqul4e4p9gw_lltdzoqk2c.jpeg"><br><br>  Y a-t-il quelque chose de suspect ici, remarquez?  Regardons l'heure: cette demande a Ã©tÃ© traitÃ©e moins trois secondes.  Comment est-ce possible?  Ils se sont battus pendant longtemps, ne pouvaient pas comprendre.  Enfin, lorsque nous avons manquÃ© de thÃ©orie, nous avons pris une dÃ©cision stupide: Jenkins a Ã©crit un script simple qui enregistre l'heure actuelle dans un cycle une fois par seconde.  Je l'ai lancÃ©.  Le lendemain, lorsque ce test feuilletÃ© est tombÃ© une fois la nuit, ils ont commencÃ© Ã  regarder un extrait de ce fichier pour le moment oÃ¹ il tombait: <br><br><img src="https://habrastorage.org/webt/yn/et/wx/ynetwxiyv1bc7kzmcgfafqolso8.jpeg"><br><br>  Donc: 34 secondes, 35, 36, 37, 35, 39 ... C'est cool que nous l'avons trouvÃ©, mais comment est-ce encore possible?  Les thÃ©ories se terminÃ¨rent Ã  nouveau, deux autres jours se grattant la tÃªte.  C'est vraiment le cas lorsque la matrice plaisante avec vous, non? <br><br>  Jusqu'Ã  ce qu'une idÃ©e me frappe enfin ... Et cela s'est avÃ©rÃ© Ãªtre.  Linux a un service de synchronisation horaire qui s'exÃ©cute sur un serveur central et demande "combien de millisecondes sont maintenant?"  Et il s'avÃ¨re que deux services diffÃ©rents ont Ã©tÃ© lancÃ©s sur ce Jenkins particulier.  Le test a commencÃ© Ã  planter lorsque Ubuntu a Ã©tÃ© mis Ã  jour sur ce serveur. <br><br>  LÃ , un service ntp Ã©tait prÃ©cÃ©demment configurÃ©, qui accÃ©dait Ã  un serveur bancaire spÃ©cial et prenait du temps Ã  partir de lÃ .  Et avec la nouvelle version d'Ubuntu, un nouveau service lÃ©ger a Ã©tÃ© inclus par dÃ©faut, par exemple, systemd-timesyncd.  Et les deux ont fonctionnÃ©.  Personne ne l'a remarquÃ©.  Pour une raison quelconque, le serveur bancaire central et un serveur Ubuntu central ont Ã©mis une rÃ©ponse avec une diffÃ©rence de 3 secondes.  Naturellement, ces deux services se sont interfÃ©rÃ©s.  Quelque part au fond de la documentation Ubuntu, il est dit que, bien sÃ»r, ne permettent pas cette situation ... Eh bien, merci pour l'info :) <br><br>  Soit dit en passant, j'ai en mÃªme temps appris une nuance intÃ©ressante de Java, qui auparavant, malgrÃ© mes nombreuses annÃ©es d'expÃ©rience, ne connaissait pas.  L'une des mÃ©thodes les plus Ã©lÃ©mentaires de Java est appelÃ©e System.currentTimeMillis (), Ã  l'aide de laquelle elle est gÃ©nÃ©ralement programmÃ©e pour appeler quelque chose, beaucoup ont Ã©crit un tel code: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> start = System.currentTimeMillis(); <span class="hljs-comment"><span class="hljs-comment">// ... long end = System.currentTimeMillis(); log.info("Loaded in {} ms", end-start);</span></span></code> </pre><br>  Ce code se trouve dans les bibliothÃ¨ques Apache Commons, Guava.  Autrement dit, si vous devez dÃ©tecter le nombre de millisecondes qu'il a fallu pour appeler quelque chose, ils le font gÃ©nÃ©ralement.  Et beaucoup ont probablement entendu dire que cela ne devrait pas Ãªtre fait.  J'ai aussi entendu, mais je ne savais pas pourquoi, et trop paresseux pour comprendre.  Je pensais que la question Ã©tait exactement parce que System.nanoTime () est apparu dans une version de Java - il est plus prÃ©cis, il produit des nanosecondes qui sont un million de fois plus prÃ©cises.  Et comme, en rÃ¨gle gÃ©nÃ©rale, mes appels durent une seconde ou une demi-seconde, cette prÃ©cision n'est pas importante pour moi, et j'ai continuÃ© Ã  utiliser System.currentTimeMillis (), que nous avons vu dans le journal oÃ¹ il Ã©tait de -3 secondes.  Donc, en fait, la bonne faÃ§on est la suivante, et maintenant j'ai dÃ©couvert pourquoi: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> start = System.nanoTime(); <span class="hljs-comment"><span class="hljs-comment">// ... long end = System.nanoTime(); log.info("Loaded in {} ms", (end-start)/1000000);</span></span></code> </pre><br>  En fait, cela est Ã©crit dans la documentation des mÃ©thodes, mais je ne le lis jamais.  J'ai pensÃ© toute ma vie que System.currentTimeMillis () et System.nanoTime () sont la mÃªme chose, mais avec un million de fois de diffÃ©rence.  Mais il s'est avÃ©rÃ© que ce sont des choses fondamentalement diffÃ©rentes. <br><br>  System.currentTimeMillis () renvoie la date actuelle rÃ©elle - combien de millisecondes sont maintenant depuis le 1er janvier 1970.  Et System.nanoTime () est une sorte de compteur abstrait qui n'est pas liÃ© au temps rÃ©el: oui, il est garanti de croÃ®tre toutes les nanosecondes par unitÃ©, mais il n'est pas connectÃ© Ã  l'heure actuelle, il peut mÃªme Ãªtre nÃ©gatif.  Au dÃ©but de la JVM, un point dans le temps est en quelque sorte choisi au hasard et il commence Ã  croÃ®tre.  Ce fut une surprise pour moi.  Pour toi aussi?  Eh bien, ce n'est pas en vain qu'il est arrivÃ©. <br><br><h2>  Exemple 5: La malÃ©diction du bouton vert </h2><br>  Ici, notre test remplit un certain formulaire, clique sur le bouton vert Confirmer, et parfois il ne va pas plus loin.  Pourquoi cela ne marche pas est incomprÃ©hensible. <br><br><img src="https://habrastorage.org/webt/cb/wq/fe/cbwqfenxe6_sfzyescgepr5m8tg.png"><br><br>  Nous conduisons en quatre zÃ©ros et accrochons, ne passez pas Ã  la page suivante.  Le clic se produit sans erreur.  J'ai tout regardÃ©: requÃªtes Ajax, attente, dÃ©lais d'attente, journaux d'application, cache - je n'ai rien trouvÃ©.  La bibliothÃ¨que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Video Recorder</a> Ã©crite par Sergey Pirogov n'est pas encore apparue.  Il permet, en ajoutant une annotation au code, d'enregistrer de la vidÃ©o.  Puis j'ai pu filmer une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vidÃ©o de</a> ce test, la regarder au ralenti, et cela a finalement clarifiÃ© la situation que je n'ai pas pu rÃ©soudre pendant plusieurs mois avant la vidÃ©o. <br><br><img src="https://habrastorage.org/webt/i_/gz/_j/i_gz_jsw_vswjbeql9s2lwsefga.png"><br><br>  La barre de progression a bloquÃ© le bouton pendant une fraction de seconde, et le clic a fonctionnÃ© exactement Ã  ce moment et a frappÃ© cette barre de progression.  Autrement dit, la barre de progression a cliquÃ© et a disparu!  Et il ne sera pas visible dans aucune capture d'Ã©cran, dans aucun journal, vous ne saurez jamais ce qui s'est passÃ©. <br><br>  En principe, il s'agit en quelque sorte d'un bug d'application: une barre de progression est apparue parce que l'application rampe vraiment hors du bord de l'Ã©cran, et si vous faites dÃ©filer, cela s'avÃ¨re Ãªtre beaucoup de donnÃ©es utiles.  Mais les utilisateurs ne s'en sont pas plaints, car tout tient sur le grand Ã©cran, il ne tient pas seulement sur le petit. <br><br><h2>  Exemple 6: pourquoi Chrome se fige-t-il? </h2><br>  Une enquÃªte policiÃ¨re de deux ans est un cas absolument rÃ©el.  La situation est la suivante: nos tests Ã©taient assez souvent floconneux et sont tombÃ©s, et dans les traces de la pile, il Ã©tait clair que Chrome gÃ¨le: pas notre test, Ã  savoir Chrome.  Dans les journaux, il Ã©tait visible "Build fonctionne 36 heures ..." Ils ont commencÃ© Ã  supprimer les vidages de threads et les traces de pile - ils montrent que tout va bien dans les tests, l'appel au Chromedriver se bloque et, en rÃ¨gle gÃ©nÃ©rale, au moment de la fermeture (nous appelons la mÃ©thode close, et cette mÃ©thode ne fait rien, se bloque 36 heures).  Si c'est intÃ©ressant, alors la trace de la pile ressemblait Ã  ceci: <br><br><img src="https://habrastorage.org/webt/fz/ew/1e/fzew1eu0u-e3oatl1age_oqhnso.jpeg"><br><br>  Nous avons essayÃ© de faire tout ce qui ne pouvait que nous venir Ã  l'esprit: <br><br><ul><li>  Configurez le dÃ©lai d'ouverture / fermeture du navigateur (si vous ne parvenez pas Ã  ouvrir / fermer le navigateur en 15 secondes, rÃ©essayez aprÃ¨s 15 secondes, jusqu'Ã  trois tentatives).  Ouvrez et fermez le navigateur dans un thread sÃ©parÃ©.  RÃ©sultat: les trois tentatives se sont bloquÃ©es de la mÃªme maniÃ¨re. </li><li>  Tuez les anciens processus Chrome.  Ils ont crÃ©Ã© un travail sÃ©parÃ© dans Â«kill-chromeÂ» de Jenkins, par exemple, comme ceci, vous pouvez Â«tuerÂ» tous les processus de plus d'une heure: <br><br>  killall - chromedriver plus vieux que 1h <br>  killall - plus vieux que 1h chrome <br><br>  Cela a au moins libÃ©rÃ© de la mÃ©moire, mais n'a pas rÃ©pondu Ã  la question Â«que se passe-t-il?Â».  En fait, cette chose ne nous a retardÃ© que le moment de la dÃ©cision. </li><li>  Activez les journaux d'application de dÃ©bogage. </li><li>  Activez les journaux de dÃ©bogage WebDriver. </li><li>  Rouvrez le navigateur tous les 20 tests.  Cela peut sembler ridicule, mais la pensÃ©e Ã©tait: "Et si Chrome se fige parce qu'il est fatiguÃ©?"  Eh bien, une fuite de mÃ©moire ou autre chose. </li></ul><br>  Le rÃ©sultat de la derniÃ¨re tentative Ã©tait complÃ¨tement inattendu: le problÃ¨me a commencÃ© Ã  se rÃ©pÃ©ter plus souvent!  Et nous espÃ©rions que cela aiderait Ã  stabiliser Chrome afin qu'il fonctionne mieux.  Il s'agit gÃ©nÃ©ralement d'un plat Ã  emporter.  Mais en fait, lorsque le problÃ¨me commence Ã  se reproduire plus souvent, il ne faut pas Ãªtre triste, mais se rÃ©jouir!  Cela permet de mieux l'Ã©tudier.  Si elle commenÃ§ait Ã  rÃ©pÃ©ter plus souvent, on devrait s'y accrocher: "Oui, oui, maintenant je vais ajouter autre chose, des journaux, des points d'arrÃªt ..." <br><br>  Nous essayons de rÃ©pÃ©ter le problÃ¨me: nous Ã©crivons un cycle de 1 Ã  1000, dans le cycle nous ouvrons simplement le navigateur et fermons la premiÃ¨re page de notre application.  Nous avons Ã©crit un tel cycle, et ... bingo!  RÃ©sultat: le problÃ¨me a commencÃ© Ã  se rÃ©pÃ©ter de maniÃ¨re stable (bien qu'environ toutes les 80 itÃ©rations)!  Cool!  Certes, cette rÃ©alisation n'a rien donnÃ© pendant longtemps.  Vous l'avez commencÃ©, attendu la 80e itÃ©ration, Chrome s'est Ã©crasÃ© ... et ensuite que faire?  Vous regardez les traces de pile, les vidages, les journaux - il n'y a rien d'utile lÃ -bas.  Les outils de dÃ©veloppement dans Chrome peuvent aider, mais jusqu'en septembre 2017, ces outils ne fonctionnaient pas avec Selenium (les ports Ã©taient en conflit: vous lancez Chrome depuis Selenium et DevTools ne s'ouvre pas).  Pendant longtemps, je ne pouvais pas penser Ã  quoi faire. <br><br>  Et ici, dans cette histoire commence un moment fabuleux.  Une fois, aprÃ¨s un nombre infini de tentatives, j'ai exÃ©cutÃ© Ã  nouveau ces tests, il se bloque Ã  nouveau sur une sorte d'itÃ©ration comme la 56e, je pense "creusons autre chose" (bien que je ne sache pas oÃ¹ mettre le point d'arrÃªt ou quoi ajouter un journal).  En ce moment, ma fille propose de jouer aux cubes, mais mon test se bloque juste ici.  Je dis: "Attendez", elle m'a dit: "Quoi, vous ne comprenez pas, j'ai <b>un b et un</b> ici!" <br><br>  Que faire, a malheureusement quittÃ© l'ordinateur, est allÃ© jouer des cubes ... Et soudain, aprÃ¨s environ 20 minutes, je jette un coup d'Å“il accidentel Ã  l'Ã©cran, et je vois une image complÃ¨tement inattendue: <br><br><img src="https://habrastorage.org/webt/hm/7o/6p/hm7o6peoyj0zroryt-8g-osfvkc.jpeg"><br><br>  Que se passe-t-il: il y a un compte Ã  rebours, aprÃ¨s combien de minutes la session expire, et je construis une tour de cubes, il y en a deux, un ... la session expire, le test continue, se termine et tombe (il n'y a plus aucun Ã©lÃ©ment, la session a expirÃ©). <br><br>  Qu'est-ce qui se passe: Chrome n'a pas vraiment gelÃ©, comme nous le pensions tout ce temps, il attendait quelque chose depuis tout ce temps.  Lorsque la session a expirÃ©, a attendu, a continuÃ©.  Ã€ quoi exactement Chrome s'attendait - il est complÃ¨tement incomprÃ©hensible de comprendre cela, j'ai dÃ» pelleter tout le code en utilisant la mÃ©thode de recherche binaire: jeter la moitiÃ© de JavaScript et HTML, essayer de rÃ©pÃ©ter Ã  nouveau 80 itÃ©rations - cela ne s'est pas bloquÃ©, oh, cela signifie quelque part lÃ -bas ... En gÃ©nÃ©ral, nous avons compris expÃ©rimentalement que le problÃ¨me est lÃ : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timeout = setTimeout(sessionWatcher);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y avait du JavaScript sur toutes nos pages - celle qui montre la fenÃªtre que la session expire. Tous les programmeurs JavaScript savent probablement que ce n'est pas trÃ¨s correct: tout ce qui s'exÃ©cute dans les balises &lt;script&gt; dÃ©marre immÃ©diatement. Et cela n'est gÃ©nÃ©ralement pas sÃ»r, car s'il utilise des Ã©lÃ©ments qui n'ont pas encore Ã©tÃ© chargÃ©s, cela peut ne pas fonctionner. Par consÃ©quent, il est toujours recommandÃ© d'envelopper JavaScript - si vous utilisez jQuery, puis dans $, et tout ce qui se trouve dans le bloc fonction ne dÃ©marrera que lorsque tous les Ã©lÃ©ments seront chargÃ©s Ã  la fin:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timeout; $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ timeout = setTimeout(...); });</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est l'ABC de la programmation Web, tout le monde le sait probablement. Et nous ne lâ€™avions pas, nous nous Ã©tions trompÃ©s. Lorsque j'ai changÃ© cela et rÃ©pÃ©tÃ© l'expÃ©rience pendant 1000 itÃ©rations, elle ne s'est plus bloquÃ©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Certes, je ne connais pas pleinement toutes les rÃ©ponses: par exemple, je ne sais pas pourquoi cela ne pendait pas toujours, mais seulement parfois trÃ¨s rarement. C'est peut-Ãªtre un bug Chrome, bon sang. Oui, il a vraiment fallu deux ans pour rechercher ce problÃ¨me.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela veut dire que certains cas avec des tests floconneux sont si irrÃ©alistes que peut-Ãªtre tout le monde ne voudra pas leur gÃ¢cher la vie. En gÃ©nÃ©ral, si vous essayez de conclure de cela - il est intÃ©ressant de noter que la tentative la plus ridicule et stupide, drÃ´le et insensÃ©e (pour redÃ©marrer un navigateur fatiguÃ©) s'est avÃ©rÃ©e rÃ©ussie. C'Ã©tait complÃ¨tement stupide, mais a soudainement conduit au succÃ¨s. Je ne sais pas quelle moralitÃ© en dÃ©duire: faire des tentatives stupides? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans Chrome, pendant longtemps, nous avions Ã©galement une telle raison pour les tests floconneux: il ne savait pas toujours comment fermer les fenÃªtres d'alerte natives, parfois il ne le savait pas, et le processus restait suspendu, personne ne l'a tuÃ©.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parfois, les effets de l'interface utilisateur affectent Ã©galement: vous voulez cliquer sur un bouton, et Ã  ce moment, il se dÃ©place ou passe d'un coin Ã  l'autre. Vous appelez la mÃ©thode click (), elle calcule les coordonnÃ©es du point central de ce bouton et y figure, et le bouton est dÃ©jÃ  parti Ã  ce moment-lÃ . Et, plus important encore, ce qui se passe: la mÃ©thode click () a fonctionnÃ© sans erreur et vous ne vous retrouvez pas sur la page suivante. Quelqu'un a cliquÃ© Ã  nouveau, non?</font></font> :) <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque les navigateurs sont lancÃ©s en parallÃ¨le, ils perdent le focus. </font><font style="vertical-align: inherit;">S'il existe des fonctionnalitÃ©s conÃ§ues pour la mise au point, le survol, elles tomberont Ã©galement lorsqu'elles seront lancÃ©es en parallÃ¨le. </font><font style="vertical-align: inherit;">En consÃ©quence, je conseille de ne pas les utiliser, ou d'utiliser des solutions oÃ¹ les navigateurs sont vraiment sÃ©parÃ©s, exÃ©cutÃ©s sur diffÃ©rents Ã©crans ou dans diffÃ©rents Dockers. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les exemples sont terminÃ©s, donnons maintenant une thÃ©orie pour expliquer pourquoi les tests sont instables. </font><font style="vertical-align: inherit;">Rappelons les problÃ¨mes typiques:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vitesse de requÃªte Ajax; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'ordre des demandes Ajax; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vitesse js; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Taille de la fenÃªtre du navigateur; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cache d'application; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DonnÃ©es des tests prÃ©cÃ©dents; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le temps; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> StabilitÃ© du navigateur; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Effets de l'interface utilisateur </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Navigateurs parallÃ¨les (perte de focalisation). </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe Ã©galement de vrais bugs pour les tests floconneux, comme vous pouvez les trouver. Il arrive que ce soient des bugs et des bugs qui soient dÃ©couverts, et ceci est un cas simple: vous obtenez un bug, ils vont le corriger. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des cas reproductibles difficiles se produisent Ã©galement pour nous. Il existe des bogues Â«irrÃ©alistesÂ». Nous avons eu des cas oÃ¹ le test feuilletÃ© s'est cassÃ©, car la protection sur le nombre de clics par seconde sur le bouton avec le mÃªme ID fonctionnait, et le test feuilletÃ© a rÃ©ussi Ã  cliquer plusieurs fois. Mais le vrai utilisateur n'aura jamais le temps de le faire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a de vrais bugs, mais non critiques: vous avez un test, il est parfois rouge, mais personne ne va le corriger.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il arrive souvent qu'un test feuilletÃ© parle d'un problÃ¨me d'utilisation, comme avec une barre de progression oÃ¹ une partie de l'Ã©cran Ã©tait fermÃ©e et le test feuilletÃ© l'a montrÃ©. </font><font style="vertical-align: inherit;">Donc, parfois, vous devez regarder le test de chute sous un tel angle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le problÃ¨me est que si vous ne le justifiez pas correctement, personne ne corrigera quoi que ce soit ... Plus rÃ©cemment, nous avons eu un cas lorsque nous avons commencÃ© Ã  creuser, nous avons rÃ©alisÃ© que le test floconneux a trouvÃ© un bogue de sÃ©curitÃ© que les tests ordinaires n'ont pas remarquÃ©. </font><font style="vertical-align: inherit;">Mais je ne le dirai pas aujourd'hui, car il n'a pas encore Ã©tÃ© rÃ©parÃ©! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parlons de ce que vous pouvez faire pour minimiser le nombre de tests feuilletÃ©s:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Test de la pyramide; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Selenide </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã‰mulateurs de service; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Une base propre avant chaque test. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La pyramide est une vÃ©ritÃ© Ã©ternelle. Pourquoi est-ce prÃ©cisÃ©ment en ce qui concerne les tests feuilletÃ©s qu'il est important qu'il y ait un ordre de grandeur plus de tests unitaires que les tests UI? Non pas parce qu'ils sont plus rapides (bien que ce soit important), mais parce qu'ils sont beaucoup plus stables et beaucoup moins susceptibles d'Ãªtre feuilletÃ©s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A propos de Selenide a dÃ©jÃ  dit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰mulateurs. Pendant les tests, vous ne pouvez en aucun cas accÃ©der Ã  de vrais services externes (par exemple, envoyer de vrais sms / lettres pendant les tests). Ce n'est pas une blague, j'entends souvent des questions comme Â«comment lire une lettre d'un test?Â». Assurez-vous d'utiliser des Ã©mulateurs pour ces services, d'autant plus qu'ils sont faciles Ã  faire. Artyom Eroshenko dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">son rapport a</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> montrÃ© que je ne m'arrÃªterai pas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IdÃ©alement, avant chaque test, rÃ©initialisez l'Ã©tat des donnÃ©es, nettoyez l'Ã©tat de la base de donnÃ©es. </font><font style="vertical-align: inherit;">Comment le faire spÃ©cifiquement, je ne dirai pas maintenant, c'est un problÃ¨me technique, mais il existe des options pour le faire tout simplement. </font><font style="vertical-align: inherit;">Cela arrive vraiment chez nous: avant chaque test, la base de donnÃ©es est Ã  partir de zÃ©ro, nouvelle, toujours avec le mÃªme ensemble de donnÃ©es (10 utilisateurs, 20 comptes, l'un avec un million, l'autre avec dix roubles). </font><font style="vertical-align: inherit;">Tous les tests pour cela peuvent Ãªtre garantis pour compter, et aucun feuilletÃ© en raison des donnÃ©es n'existe pas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce que vous devez adopter afin d'explorer plus en dÃ©tail les tests feuilletÃ©s:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Journaux des versions prÃ©cÃ©dentes; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Captures d'Ã©cran </font></font></li><li>  VidÃ©o </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'Ã©lÃ©ment Â«enregistrer les journaux des versions prÃ©cÃ©dentesÂ» peut Ã©galement sembler Ã©vident, mais dans chaque projet oÃ¹ je suis venu, j'ai vu cette situation: certaines erreurs et captures d'Ã©cran ne peuvent Ãªtre vues que dans la derniÃ¨re version. Si votre derniÃ¨re version est "verte" et la prÃ©cÃ©dente Ã©tait "rouge", alors c'est tout: il y avait un test feuilletÃ©, mais vous ne pouvez plus savoir pourquoi il Ã©tait feuilletÃ©. Aucun journal, rien n'a Ã©tÃ© conservÃ©, et c'est un dÃ©sastre. Et cela se fait trÃ¨s facilement. Par exemple, si vous utilisez le pipeline Jenkins, alors dans Jenkins, il suffit d'Ã©crire un tel morceau de code:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { stage(<span class="hljs-string"><span class="hljs-string">"Reports"</span></span>) { junit <span class="hljs-string"><span class="hljs-string">'build/test-results/**/*.xml'</span></span> artifacts = <span class="hljs-string"><span class="hljs-string">'build./reports/**/*,build/test-results/**/*,logs/**/*'</span></span> archiveArtifacts artifacts: artifacts } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mÃ©thode finally s'exÃ©cutera quand mÃªme, mÃªme si les tests Ã©chouent. Vous lui dites simplement: copiez tel ou tel journal de tel ou tel papa. Et Jenkins enregistrera pour chaque build tous les rÃ©sultats des tests, tous les rapports. En consÃ©quence, dans l'ancien Jenkins, il Ã©tait possible de placer les tiques au bon endroit, etc. Cela est nÃ©cessaire, tout d'abord. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assurez-vous de prendre des captures d'Ã©cran des tests effectuÃ©s (Selenide le fait automatiquement, donc c'est gÃ©nÃ©ralement facile lÃ -bas). Je vous conseille Ã©galement de filmer des vidÃ©os Ã  partir de tests feuilletÃ©s. En particulier, il y a l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enregistreur vidÃ©o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dÃ©jÃ  mentionnÃ© </font><font style="vertical-align: inherit;">, c'est gÃ©nÃ©ralement facile lÃ -bas: ajoutez l'annotation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vidÃ©o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> au test suspect </font><font style="vertical-align: inherit;">- et c'est tout, vous avez la vidÃ©o!</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une alternative pour ceux qui sont prÃªts Ã  exÃ©cuter des tests dans Docker: il y a une bonne bibliothÃ¨que TestContainers (il y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avait un rapport</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã  ce sujet sur ce Heisenbug </font><font style="vertical-align: inherit;">). LÃ , vous insÃ©rez Ã©galement une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rÃ¨gle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , une annotation </font><font style="vertical-align: inherit;">dans le test </font><font style="vertical-align: inherit;">- avant le test lui-mÃªme, il dÃ©ploie le Docker avec la version souhaitÃ©e du navigateur, enregistre la vidÃ©o et la tue Ã  la fin du test. Dans ce cas, vous aurez Ã©galement une vidÃ©o sur l'Ã©chec du test.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Rule</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BrowserWebDriverContainer chrome = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BrowserWebDriverContainer() .withRecordingMode(RECORD_ALL, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"build"</span></span>)) .withDesiredCapabilities(chrome());</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le message final. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je veux d'abord contacter les dÃ©veloppeurs. Les dÃ©veloppeurs, trÃ¨s chers, assurez-vous de participer aux tests, d'aider Ã  Ã©crire des tests, d'enquÃªter, d'aider les testeurs intÃ©ressÃ©s Ã  lire les journaux. Parce qu'ils ne peuvent jamais faire face Ã  de tels tests floconneux de leur vie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Managers, patrons de ces dÃ©veloppeurs! En rÃ¨gle gÃ©nÃ©rale, le problÃ¨me est avec vous :) Laissez les dÃ©veloppeurs et encouragez les dÃ©veloppeurs Ã  participer aux tests. Si vous ne le faites pas, si vous dites Â«ils n'ont pas le temps pour cela, ils doivent Ã©crire du code, ils sont chersÂ», alors vous gaspillerez de l'argent sur l'automatisation car l'efficacitÃ© de l'automatisation sera faible.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et le message le plus important est pour les experts en automatisation, ceux qui sont impliquÃ©s dans les tests, enquÃªtent sur les tests de chute et font quelque chose avec eux. </font><font style="vertical-align: inherit;">A votre retour au travail, effectuez les travaux prÃ©ventifs dÃ©crits, armez-vous des moyens prÃ©citÃ©s et ... attendez! </font><font style="vertical-align: inherit;">:) Et la prochaine fois que votre test floconneux tombe - rÃ©jouissez-vous: vous partez Ã  la chasse!</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez aimÃ© ce reportage, faites attention: les 6-7 dÃ©cembre, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heisenbug</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> revient Ã  Moscou. </font><font style="vertical-align: inherit;">Il y aura Ã  nouveau des conseils utiles et des histoires incroyables, et les mondes des testeurs et des dÃ©veloppeurs reviendront en contact. </font><font style="vertical-align: inherit;">Vous pouvez toujours voir l'Ã©tat actuel du programme (et, si vous le souhaitez, acheter un billet) sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le site Web de la confÃ©rence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416757/">https://habr.com/ru/post/fr416757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416743/index.html">Bot pour Starcraft dans Rust, C et toute autre langue</a></li>
<li><a href="../fr416745/index.html">Nouveau ASUS ROG au Computex 2018</a></li>
<li><a href="../fr416751/index.html">Collecte d'informations contextuelles pour la journalisation</a></li>
<li><a href="../fr416753/index.html">Plugin VPN Hola populaire compromis</a></li>
<li><a href="../fr416755/index.html">Extreme Likes - ComitÃ© d'enquÃªte contre</a></li>
<li><a href="../fr416759/index.html">Pourquoi l'intelligence artificielle ne rÃ©soudra pas tous les problÃ¨mes</a></li>
<li><a href="../fr416761/index.html">Langage cosmique, partie 1: la grammaire universelle est-elle universelle?</a></li>
<li><a href="../fr416763/index.html">Puppet Salt Chef Ensemble: comparez Ansible, SaltStack, Chef et Puppet</a></li>
<li><a href="../fr416765/index.html">SociÃ©tÃ© Foliplast: un cycle complet de production numÃ©rique en Russie</a></li>
<li><a href="../fr416767/index.html">Un diable pour vous, ou un audit avec piratage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>