<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëâüèæ üë®‚Äçüë©‚Äçüë¶ ü§õüèæ Aprender programaci√≥n multiproceso Go con im√°genes ü§ö üíº ü§ê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lo m√°s probable es que ya haya escuchado sobre el lenguaje de programaci√≥n Go, su popularidad crece constantemente, lo cual es bastante razonable. Est...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprender programaci√≥n multiproceso Go con im√°genes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412715/"><img src="https://habrastorage.org/webt/qk/hi/im/qkhiimd_phctfhx4kka_rhpkepq.png"><br>  Lo m√°s probable es que ya haya escuchado sobre el lenguaje de programaci√≥n Go, su popularidad crece constantemente, lo cual es bastante razonable.  Este lenguaje es simple, r√°pido y se basa en una gran comunidad.  Uno de los aspectos m√°s curiosos del lenguaje es el modelo de programaci√≥n multiproceso.  Las primitivas subyacentes le permiten crear programas multiproceso de manera f√°cil y sencilla.  Este art√≠culo est√° destinado a aquellos que desean aprender estas primitivas: gorutinas y canales.  Y, a trav√©s de las ilustraciones, mostrar√© c√≥mo trabajar con ellos.  Espero que esto sea de gran ayuda para usted en su estudio posterior. <br><a name="habracut"></a><br><h4>  Programas √∫nicos y multiproceso </h4><br>  Lo m√°s probable es que ya haya escrito programas de subproceso √∫nico.  Por lo general, se ve as√≠: hay un conjunto de funciones para realizar diversas tareas, cada funci√≥n se llama solo cuando la anterior prepar√≥ datos para ella.  Por lo tanto, el programa se ejecuta secuencialmente. <br><br>  Ese ser√° nuestro primer ejemplo: el programa de extracci√≥n de minerales.  Nuestras funciones buscar√°n, extraer√°n y procesar√°n minerales.  El mineral en la mina en nuestro ejemplo est√° representado por listas de cadenas, las funciones las toman como par√°metros y devuelven una lista de cadenas "procesadas".  Para un programa de subproceso √∫nico, nuestra aplicaci√≥n se dise√±ar√° de la siguiente manera: <br><br><img src="https://habrastorage.org/webt/c5/ua/ja/c5uajayyncivzzj9_orh-u_sw34.png"><br><br>  En este ejemplo, todo el trabajo lo realiza un hilo (la gopher de Gary).  Tres funciones principales: b√∫squeda, producci√≥n y procesamiento se realizan secuencialmente una tras otra. <br><br><pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { theMine := [<span class="hljs-number"><span class="hljs-number">5</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{<span class="hljs-string"><span class="hljs-string">"rock"</span></span>, <span class="hljs-string"><span class="hljs-string">"ore"</span></span>, <span class="hljs-string"><span class="hljs-string">"ore"</span></span>, <span class="hljs-string"><span class="hljs-string">"rock"</span></span>, <span class="hljs-string"><span class="hljs-string">"ore"</span></span>} foundOre := finder(theMine) minedOre := miner(foundOre) smelter(minedOre) }</code> </pre> <br>  Si imprimimos el resultado de cada funci√≥n, obtenemos lo siguiente: <br><br><pre> <code class="hljs powershell">From Finder: [<span class="hljs-type"><span class="hljs-type">ore</span></span> <span class="hljs-type"><span class="hljs-type">ore</span></span> <span class="hljs-type"><span class="hljs-type">ore</span></span>] From Miner: [<span class="hljs-type"><span class="hljs-type">minedOre</span></span> <span class="hljs-type"><span class="hljs-type">minedOre</span></span> <span class="hljs-type"><span class="hljs-type">minedOre</span></span>] From Smelter: [<span class="hljs-type"><span class="hljs-type">smeltedOre</span></span> <span class="hljs-type"><span class="hljs-type">smeltedOre</span></span> <span class="hljs-type"><span class="hljs-type">smeltedOre</span></span>]</code> </pre><br>  El dise√±o y la implementaci√≥n simples son una ventaja de un enfoque de subproceso √∫nico.  Pero, ¬øqu√© pasa si desea ejecutar y ejecutar funciones de forma independiente?  Aqu√≠ la programaci√≥n multiproceso viene en su ayuda. <br><br><img src="https://habrastorage.org/webt/om/x1/mq/omx1mqphfsqqs57lab9bngsnggi.png"><br>  Este enfoque para la extracci√≥n de minerales es mucho m√°s eficiente.  Ahora varios hilos (gophers) funcionan de forma independiente, y Gary solo hace parte del trabajo.  Un gopher busca mineral, el otro produce y el tercero se derrite, y todo esto es potencialmente simult√°neo.  Para implementar este enfoque, necesitamos dos cosas en el c√≥digo: crear procesadores Gopher independientemente uno del otro y transferir mineral entre ellos.  Go tiene gorutinas y canales para esto. <br><br><h4>  Gorutins </h4><br>  Las goroutines pueden considerarse "hilos ligeros", para crear goroutines solo necesita poner la palabra clave <b>go</b> antes del c√≥digo de llamada de funci√≥n.  Para demostrar lo simple que es, creemos dos funciones de b√∫squeda, ll√°melas con la palabra clave <b>go</b> e imprima un mensaje cada vez que encuentren el "mineral" en su mina. <br><img src="https://habrastorage.org/webt/jz/wx/nb/jzwxnbgxocr-a0rq7kmdoujt_gg.png"><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { theMine := [<span class="hljs-number"><span class="hljs-number">5</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{<span class="hljs-string"><span class="hljs-string">"rock"</span></span>, <span class="hljs-string"><span class="hljs-string">"ore"</span></span>, <span class="hljs-string"><span class="hljs-string">"ore"</span></span>, <span class="hljs-string"><span class="hljs-string">"rock"</span></span>, <span class="hljs-string"><span class="hljs-string">"ore"</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> finder1(theMine) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> finder2(theMine) &lt;-time.After(time.Second * <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-comment"><span class="hljs-comment">//       }</span></span></code> </pre><br>  El resultado de nuestro programa ser√° el siguiente: <br><br><pre> <code class="hljs pgsql">Finder <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> ore! Finder <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> ore! Finder <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> ore! Finder <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> ore! Finder <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> ore! Finder <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> ore!</code> </pre><br>  Como puede ver, no hay un orden en el que la funci√≥n primero "encuentre mineral";  Las funciones de b√∫squeda funcionan simult√°neamente.  Si ejecuta el ejemplo varias veces, el orden ser√° diferente.  Ahora podemos ejecutar programas de subprocesos m√∫ltiples (multiesferas), y este es un progreso serio.  Pero, ¬øqu√© hacer cuando necesitamos establecer una conexi√≥n entre gorutinas independientes?  Se acerca el momento de la magia de los canales. <br><br><h4>  Canales </h4><br><img src="https://habrastorage.org/webt/pa/a-/5r/paa-5r_dtecx3fzem9r0dsv42jo.png"><br>  Los canales permiten que las gorutinas intercambien datos.  Este es un tipo de tuber√≠a a trav√©s del cual las gorutinas pueden enviar y recibir informaci√≥n de otras gorutinas. <br><img src="https://habrastorage.org/webt/-d/vp/fz/-dvpfzbpaa65exwi7l4pgerte48.png"><br>  La lectura y escritura en el canal se realiza utilizando el operador de flecha (&lt;-), que indica la direcci√≥n del movimiento de los datos. <br><img src="https://habrastorage.org/webt/wd/1j/qp/wd1jqp8ipkwvcdgc5xbuoyy6wey.png"><br><pre> <code class="go hljs">myFirstChannel := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) myFirstChannel &lt;- <span class="hljs-string"><span class="hljs-string">"hello"</span></span> <span class="hljs-comment"><span class="hljs-comment">//    myVariable := &lt;- myFirstChannel //   </span></span></code> </pre><br>  Ahora nuestro gopher-scout no necesita acumular mineral, puede transferirlo de inmediato utilizando canales. <br><img src="https://habrastorage.org/webt/60/yx/_j/60yx_jlczbwcy2tfmsqgvzwp4dg.png"><br>  Actualic√© el ejemplo, ahora el c√≥digo del buscador de minerales y minero es funciones an√≥nimas.  No se preocupe demasiado si no los ha encontrado antes, solo tenga en cuenta que cada uno de ellos se llama con la palabra clave <b>go</b> , por lo tanto, se ejecutar√° en su propia rutina.  Lo m√°s importante aqu√≠ es que las gorutinas transmiten datos entre ellas utilizando el canal <b>oreChan</b> .  Y nos ocuparemos de las funciones an√≥nimas m√°s cerca del final. <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { theMine := [<span class="hljs-number"><span class="hljs-number">5</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{‚Äúore1‚Äù, ‚Äúore2‚Äù, ‚Äúore3‚Äù} oreChan := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   go func(mine [5]string) { for _, item := range mine { oreChan &lt;- item // } }(theMine) //   go func() { for i := 0; i &lt; 3; i++ { foundOre := &lt;-oreChan // fmt.Println(‚ÄúMiner: Received ‚Äú + foundOre + ‚Äú from finder‚Äù) } }() &lt;-time.After(time.Second * 5) //     }</span></span></code> </pre><br>  La conclusi√≥n a continuaci√≥n demuestra claramente que nuestro Minero recibe tres veces del canal o una porci√≥n a la vez. <br><br><pre> <code class="hljs cs">Miner: Received ore1 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> finder Miner: Received ore2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> finder Miner: Received ore3 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> finder</code> </pre><br>  Entonces, ahora podemos transferir datos entre diferentes goroutines (gophers), pero antes de comenzar a escribir un programa complejo, veamos algunas propiedades importantes de los canales. <br><br><h4>  Cerraduras </h4><br>  En algunas situaciones, cuando se trabaja con canales, goroutin puede estar bloqueado.  Esto es necesario para que las gorutinas puedan sincronizarse entre s√≠ antes de comenzar o continuar trabajando. <br><br><h4>  Bloqueo de escritura </h4><br><img src="https://habrastorage.org/webt/ir/vv/zi/irvvziqxuk3opysywirescrn40e.png"><br><br>  Cuando goroutine (gopher) env√≠a datos a un canal, se bloquea hasta que otra goroutine lee datos del canal. <br><br><h4>  Leer bloqueo </h4><br><img src="https://habrastorage.org/webt/eq/e5/k8/eqe5k854n39oia6xwaavj5xfk-q.png"><br><br>  Similar al bloqueo al escribir en un canal, goroutin puede bloquearse al leer desde un canal hasta que no se escriba nada en √©l. <br>  Si las cerraduras, a primera vista, le parecen complicadas, puede imaginarlas como una "transferencia de dinero" entre dos goroutines (gophers).  Cuando un gopher quiere transferir o recibir dinero, tiene que esperar al segundo participante en la transacci√≥n. <br><br>  Habiendo tratado con bloqueos de rutina en los canales, analicemos dos tipos diferentes de canales: con y sin b√∫fer.  Al elegir este o aquel tipo, determinamos en gran medida el comportamiento del programa. <br><br><h4>  Canales sin b√∫fer </h4><br><img src="https://habrastorage.org/webt/hv/k0/ba/hvk0badnrvqhncjqf9uwyrlowq8.png"><br><br>  En todos los ejemplos anteriores, utilizamos solo esos canales.  En tales canales, solo se puede transmitir una pieza de datos a la vez (con bloqueo, como se describi√≥ anteriormente). <br><br><h4>  Canales almacenados </h4><br><img src="https://habrastorage.org/webt/zs/zg/b1/zszgb15grrrjjiyaqs6gwtfkkye.png"><br><br>  Las secuencias en un programa no siempre se pueden sincronizar perfectamente.  Supongamos, en nuestro ejemplo, que un explorador de Gopher encontr√≥ tres partes de mineral y un minero de Gopher logr√≥ extraer solo una parte de las reservas encontradas al mismo tiempo.  Aqu√≠, para que el reconocimiento de Gopher no pase la mayor parte de su tiempo, esperando que el minero termine su trabajo, usaremos canales almacenados.  Comencemos creando un canal con una capacidad de 3. <br><br><pre> <code class="go hljs">bufferedChan := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre><br>  Podemos enviar varios datos al canal protegido, sin la necesidad de leerlos con otra rutina.  Esta es la principal diferencia de los canales sin b√∫fer. <br><br><img src="https://habrastorage.org/webt/sh/ok/f2/shokf2oswaiw1yk6i-uwplypezi.png"><br><pre> <code class="go hljs">bufferedChan := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { bufferedChan &lt;- <span class="hljs-string"><span class="hljs-string">"first"</span></span> fmt.Println(<span class="hljs-string"><span class="hljs-string">"Sent 1st"</span></span>) bufferedChan &lt;- <span class="hljs-string"><span class="hljs-string">"second"</span></span> fmt.Println(<span class="hljs-string"><span class="hljs-string">"Sent 2nd"</span></span>) bufferedChan &lt;- <span class="hljs-string"><span class="hljs-string">"third"</span></span> fmt.Println(<span class="hljs-string"><span class="hljs-string">"Sent 3rd"</span></span>) }() &lt;-time.After(time.Second * <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { firstRead := &lt;- bufferedChan fmt.Println(<span class="hljs-string"><span class="hljs-string">"Receiving.."</span></span>) fmt.Println(firstRead) secondRead := &lt;- bufferedChan fmt.Println(secondRead) thirdRead := &lt;- bufferedChan fmt.Println(thirdRead) }()</code> </pre><br>  El orden de salida en dicho programa ser√° el siguiente: <br><br><pre> <code class="hljs dos">Sent <span class="hljs-number"><span class="hljs-number">1</span></span>st Sent <span class="hljs-number"><span class="hljs-number">2</span></span>nd Sent <span class="hljs-number"><span class="hljs-number">3</span></span><span class="hljs-built_in"><span class="hljs-built_in">rd</span></span> Receiving.. first second third</code> </pre><br>  Para evitar complicaciones innecesarias, no utilizaremos canales almacenados en nuestro programa.  Pero es importante recordar que este tipo de canales tambi√©n est√°n disponibles para su uso. <br>  Tambi√©n es importante tener en cuenta que los canales almacenados en b√∫fer no siempre evitan el bloqueo.  Por ejemplo, si un gopher scout es diez veces m√°s r√°pido que un gopher miner, y est√°n conectados a trav√©s de un canal protegido con una capacidad de 2, entonces el gopher scout se bloquear√° cada vez que se env√≠e, si ya hay dos datos en el canal. <br><br><h4>  Poniendo todo junto </h4><br>  Entonces, armados con goroutines y canales, podemos escribir un programa usando todas las ventajas de la programaci√≥n multiproceso en Go. <br><br><img src="https://habrastorage.org/webt/cq/xa/h7/cqxah7wnmg1wbcjqwhd13gyejaw.png"><br><pre> <code class="go hljs">theMine := [<span class="hljs-number"><span class="hljs-number">5</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{<span class="hljs-string"><span class="hljs-string">"rock"</span></span>, <span class="hljs-string"><span class="hljs-string">"ore"</span></span>, <span class="hljs-string"><span class="hljs-string">"ore"</span></span>, <span class="hljs-string"><span class="hljs-string">"rock"</span></span>, <span class="hljs-string"><span class="hljs-string">"ore"</span></span>} oreChannel := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) minedOreChan := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  go func(mine [5]string) { for _, item := range mine { if item == "ore" { oreChannel &lt;- item //   oreChannel } } }(theMine) //  go func() { for i := 0; i &lt; 3; i++ { foundOre := &lt;-oreChannel //   oreChannel fmt.Println("From Finder: ", foundOre) minedOreChan &lt;- "minedOre" //   minedOreChan } }() //  go func() { for i := 0; i &lt; 3; i++ { minedOre := &lt;-minedOreChan //   minedOreChan fmt.Println("From Miner: ", minedOre) fmt.Println("From Smelter: Ore is smelted") } }() &lt;-time.After(time.Second * 5) //    </span></span></code> </pre><br>  Dicho programa generar√° lo siguiente: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Finder: ore <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Finder: ore <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Miner: minedOre <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Smelter: Ore <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> smelted <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Miner: minedOre <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Smelter: Ore <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> smelted <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Finder: ore <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Miner: minedOre <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Smelter: Ore <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> smelted</code> </pre><br>  En comparaci√≥n con nuestro primer ejemplo, esta es una mejora importante, ahora todas las funciones se realizan de forma independiente, cada una en su propia rutina.  Y tambi√©n obtuvimos un transportador de canales, a trav√©s del cual el mineral se transfiere inmediatamente despu√©s del procesamiento.  Para mantener el enfoque en una comprensi√≥n b√°sica del funcionamiento de los canales y las rutinas, omit√≠ algunos puntos, que pueden generar dificultades para iniciar el programa.  En conclusi√≥n, quiero hacer hincapi√© en estas caracter√≠sticas del lenguaje, ya que ayudan a trabajar con gorutinas y canales. <br><br><h4>  Gorutins an√≥nimos </h4><br><img src="https://habrastorage.org/webt/ko/t5/y6/kot5y6lv7cf-3h2zbyghvqwf1is.png"><br><br>  As√≠ como ejecutamos una funci√≥n regular en goroutine, podemos declarar una funci√≥n an√≥nima inmediatamente despu√©s de la palabra clave <b>go</b> y llamarla usando la siguiente sintaxis: <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//   go func() { fmt.Println("I'm running in my own go routine") }()</span></span></code> </pre><br>  Por lo tanto, si necesitamos llamar a una funci√≥n en un solo lugar, podemos ejecutarla en una rutina diferente sin preocuparnos por su declaraci√≥n por adelantado. <br><br><h4>  La funci√≥n principal es la goroutina. </h4><br><img src="https://habrastorage.org/webt/c_/bo/y7/c_boy7hpqt3y3krcd1utthdjy3s.png"><br><br>  S√≠, la funci√≥n <b>principal</b> funciona en su propia rutina.  Y, lo que es m√°s importante, despu√©s de su finalizaci√≥n, todas las otras gorutinas tambi√©n terminan.  Es por esta raz√≥n que colocamos una llamada de temporizador al final de nuestra funci√≥n <b>principal</b> .  Esta llamada crea un canal y le env√≠a datos despu√©s de 5 segundos. <br><br><pre> <code class="go hljs">&lt;-time.After(time.Second * <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-comment"><span class="hljs-comment">//      </span></span></code> </pre><br>  ¬øRecuerdas que goroutine se bloquear√° cuando leas desde el canal hasta que se le env√≠e algo?  Esto es exactamente lo que sucede cuando se agrega el c√≥digo especificado.  La gorutina principal se bloquear√°, dando a las otras goroutias 5 segundos de tiempo para trabajar.  Este m√©todo funciona bien, pero generalmente se utiliza un enfoque diferente para verificar que todas las gorutinas hayan completado su trabajo.  Para transmitir una se√±al sobre la finalizaci√≥n del trabajo, se crea un canal especial, se bloquea la lectura de la gorutina principal y, tan pronto como la gorutina hija completa su trabajo, escribe en este canal;  La gorutina principal se desbloquea y el programa finaliza. <br><br><img src="https://habrastorage.org/webt/vi/4e/zv/vi4ezv-tyvzugvamrwi3z9xod8a.png"><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { doneChan := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//  -  doneChan &lt;- ‚ÄúI'm all done!‚Äù }() &lt;-doneChan //        }</span></span></code> </pre><br><h4>  Leer desde una tuber√≠a en un bucle de rango </h4><br>  En nuestro ejemplo, en la funci√≥n del goffer-getter, utilizamos el bucle <b>for</b> para seleccionar tres elementos del canal.  Pero, ¬øqu√© hacer si no se sabe de antemano cu√°ntos datos puede haber en el canal?  En tales casos, puede usar el canal como argumento para el bucle <b>for-range</b> , al igual que con las colecciones.  La funci√≥n actualizada puede verse as√≠: <br><br><pre> <code class="go hljs"> <span class="hljs-comment"><span class="hljs-comment">//  go func() { for foundOre := range oreChan { fmt.Println(‚ÄúMiner: Received ‚Äú + foundOre + ‚Äú from finder‚Äù) } }()</span></span></code> </pre><br>  Por lo tanto, el minero leer√° todo lo que el explorador le env√≠e; usar el canal en el ciclo garantizar√° esto.  Tenga en cuenta que despu√©s de que se hayan procesado todos los datos del canal, el ciclo se bloquear√° en la lectura;  para evitar el bloqueo, debe cerrar el canal llamando a <b>close (channel)</b> . <br><br><h4>  Lectura de canal sin bloqueo </h4><br>  Usando la construcci√≥n <b>select-case</b> , se pueden evitar las lecturas de bloqueo de la tuber√≠a.  El siguiente es un ejemplo del uso de esta construcci√≥n: goroutine leer√° los datos del canal, si solo est√° all√≠, de lo contrario se ejecutar√° el bloque <b>predeterminado</b> : <br><br><pre> <code class="go hljs">myChan := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ myChan &lt;- ‚ÄúMessage!‚Äù }() <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> msg := &lt;- myChan: fmt.Println(msg) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: fmt.Println(‚ÄúNo Msg‚Äù) } &lt;-time.After(time.Second * <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> msg := &lt;- myChan: fmt.Println(msg) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: fmt.Println(‚ÄúNo Msg‚Äù) }</code> </pre><br>  Una vez iniciado, este c√≥digo generar√° lo siguiente: <br><br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">No</span></span> <span class="hljs-type"><span class="hljs-type">Msg</span></span> <span class="hljs-type"><span class="hljs-type">Message!</span></span></code> </pre><br><h4>  Grabaci√≥n de canal sin bloqueo </h4><br>  Los bloqueos al escribir en un canal se pueden evitar mediante el uso de la misma construcci√≥n de <b>caso de selecci√≥n</b> .  Hagamos una peque√±a edici√≥n al ejemplo anterior: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> myChan &lt;- ‚Äúmessage‚Äù: fmt.Println(‚Äúsent the message‚Äù) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: fmt.Println(‚Äúno message sent‚Äù) }</code> </pre><br><h4>  Qu√© estudiar m√°s </h4><br><img src="https://habrastorage.org/webt/d6/69/yd/d669ydnx51qv_h0tf-p-lbo8xyu.png"><br><br>  Hay una gran cantidad de art√≠culos e informes que cubren el trabajo con canales y gorutinas con mucho m√°s detalle.  Y ahora, con el c√≥digo tiene una idea clara de por qu√© y c√≥mo se utilizan estas herramientas, puede aprovechar al m√°ximo los siguientes materiales: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Google I / O 2012 - Ir a patrones de concurrencia</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Rob Pike - 'La concurrencia no es paralelismo'</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GopherCon 2017: Edward Muller - Go Anti-Patterns</a> </li></ul><br><br>  Gracias por tomarte el tiempo de leer.  Espero haberte ayudado a comprender los canales, las rutinas y los beneficios que te brindan los programas multiproceso. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es412715/">https://habr.com/ru/post/es412715/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es412703/index.html">En una conferencia con Veeam: una revisi√≥n de VeeamON 2018 y una invitaci√≥n al Foro VeeamON en Mosc√∫</a></li>
<li><a href="../es412705/index.html">Hackeado el sistema: c√≥mo cambiamos la selecci√≥n y adaptaci√≥n de los desarrolladores</a></li>
<li><a href="../es412709/index.html">Oh, mi c√≥digo: aprendizaje autom√°tico y an√°lisis en compa√±eros de clase</a></li>
<li><a href="../es412711/index.html">Para verificar las ecuaciones de Einstein, debes patear un agujero negro</a></li>
<li><a href="../es412713/index.html">Una descripci√≥n general de las innovaciones m√°s interesantes de la actualizaci√≥n de mayo de Power BI</a></li>
<li><a href="../es412717/index.html">Hola extraterrestres; por favor no nos mates</a></li>
<li><a href="../es412719/index.html">MDG anuncia concurso de s√≠ntesis de voz</a></li>
<li><a href="../es412721/index.html">Tres esperanzas de la humanidad para el descubrimiento de extraterrestres</a></li>
<li><a href="../es412723/index.html">Buscando un nuevo color de mil millones de d√≥lares</a></li>
<li><a href="../es412725/index.html">C√≥mo hacer que su infraestructura de TI sea aburrida</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>