<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≤üèº üë©üèª‚Äçüîß üôÜüèΩ Tom Hunter Diary: El sabueso de los Baskerville üèΩ üòÖ üçÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Retrasar con la firma es algo com√∫n para cualquier empresa grande. Una excepci√≥n no fue un acuerdo entre Tom Hunter y una tienda de mascotas en l√≠nea ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tom Hunter Diary: El sabueso de los Baskerville</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tomhunter/blog/467199/">  Retrasar con la firma es algo com√∫n para cualquier empresa grande.  Una excepci√≥n no fue un acuerdo entre Tom Hunter y una tienda de mascotas en l√≠nea para un pentesting completo.  Era necesario verificar tanto el sitio como la red interna, e incluso trabajar con Wi-Fi. <br><br>  No es sorprendente que las manos se peinaran antes de que se resolvieran todas las formalidades.  Bueno, solo escanee el sitio por si acaso, es poco probable que una tienda tan conocida como el "Perro Baskervilov" cometa errores aqu√≠.  Despu√©s de un par de d√≠as, Tom entreg√≥ el original firmado del contrato; en ese momento, detr√°s de la tercera taza de caf√©, Tom del CMS interno evalu√≥ la condici√≥n de los almacenes con inter√©s ... <br><br><img src="https://habrastorage.org/webt/y0/bf/ef/y0bfefcwg_2j0dk3qexegw3isxg.jpeg">  <i>Fuente: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ehsan Taebloo</a></i> <br><a name="habracut"></a><br>  Pero no fue posible administrarlo especialmente en CMS: los administradores del sitio prohibieron la IP de Tom Hunter.  Aunque uno podr√≠a tener tiempo para generar bonos en la tarjeta de la tienda y alimentar al querido gato por meses baratos ... "No esta vez, Darth Sidious", pens√≥ Tom con una sonrisa.  No ser√≠a menos divertido pasar de la zona del sitio web a la red local del cliente, pero aparentemente estos segmentos no est√°n conectados con el cliente.  A√∫n as√≠, esto ocurre con mayor frecuencia en empresas muy grandes. <br><br>  Despu√©s de todas las formalidades, Tom Hunter se arm√≥ con la cuenta VPN proporcionada y se dirigi√≥ a la red local del cliente.  La cuenta estaba dentro del dominio de Active Directory, por lo que era posible tomar y sin ning√∫n truco para volcar AD, para fusionar toda la informaci√≥n p√∫blica sobre usuarios y m√°quinas en funcionamiento. <br><br>  Tom lanz√≥ la utilidad adfind y comenz√≥ a enviar solicitudes LDAP al controlador de dominio.  Con un filtro por clase de objetoategory, especificando persona como atributo.  La respuesta regres√≥ aqu√≠ con esta estructura: <br><br><pre><code class="plaintext hljs">dn:CN=,CN=Users,DC=domain,DC=local &gt;objectClass: top &gt;objectClass: person &gt;objectClass: organizationalPerson &gt;objectClass: user &gt;cn:  &gt;description:           &gt;distinguishedName: CN=,CN=Users,DC=domain,DC=local &gt;instanceType: 4 &gt;whenCreated: 20120228104456.0Z &gt;whenChanged: 20120228104456.0Z</code> </pre> <br>  Adem√°s, todav√≠a hab√≠a mucha informaci√≥n √∫til, pero la m√°s interesante estaba en el campo&gt; descripci√≥n:&gt; descripci√≥n.  Este comentario de cuenta es, en principio, un lugar conveniente para almacenar notas menores.  Pero los administradores del cliente consideraron que las contrase√±as tambi√©n pueden descansar aqu√≠ con calma.  ¬øQui√©n, despu√©s de todo, podr√≠a estar interesado en todos estos registros menores de servicio?  Por lo tanto, los comentarios que recibi√≥ Tom se ve√≠an as√≠: <br><br><pre> <code class="plaintext hljs"> , 2018.11.16 7po!*Vqn</code> </pre> <br>  No necesita tener siete tramos en la frente para comprender por qu√© la combinaci√≥n es √∫til al final.  Quedaba por analizar un gran archivo de respuesta del CD por el campo&gt; descripci√≥n: y aqu√≠ est√°n: 20 pares de inicio de sesi√≥n y contrase√±a.  Y casi la mitad tiene derechos de acceso RDP.  Buen punto de apoyo, hora de dividir las fuerzas de ataque. <br><br><h2>  Entorno de red </h2><br>  Las bolas accesibles de Baskerville Dogs se parec√≠an a una gran ciudad en todo su caos e imprevisibilidad.  Con los perfiles de usuario y RDP, Tom Hunter era un ni√±o pobre en esta ciudad, pero incluso √©l logr√≥ mirar muchas cosas a trav√©s de las ventanas brillantes de las pol√≠ticas de seguridad. <br><br>  Partes de servidores de archivos, cuentas de contabilidad e incluso scripts asociados con ellos: todo esto se comparti√≥.  En la configuraci√≥n de uno de estos scripts, Tom encontr√≥ el hash MS SQL de un usuario.  Un poco de fuerza bruta m√°gica, y el hash del usuario se convirti√≥ en una contrase√±a de texto sin formato.  Gracias a John The Ripper y Hashcat. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/475/884/6c0/4758846c0301c7914bc41c33ad92efba.png"><br><br>  Esta llave deber√≠a haber llegado a un cofre.  Se encontr√≥ el cofre y, adem√°s, se conectaron diez "cofres" m√°s.  Y dentro de seis lay ... derechos de superusuario, nt autoridad \ sistema!  En dos, logr√© ejecutar el procedimiento almacenado xp_cmdshell y enviar comandos cmd a Windows.  ¬øQu√© m√°s podr√≠as querer? <br><br><h2>  Controladores de dominio </h2><br>  Tom Hunter ha preparado el segundo golpe para los controladores de dominio.  Hab√≠a tres de ellos en la red de Baskerville Dogs, de acuerdo con el n√∫mero de servidores geogr√°ficamente remotos.  Cada controlador de dominio tiene una carpeta p√∫blica, como un escaparate abierto en una tienda, junto al cual el mismo ni√±o empobrecido Tom se queda. <br><br>  Y esta vez el tipo tuvo suerte nuevamente: olvidaron eliminar el script de la ventana donde estaba codificada la contrase√±a del administrador del servidor local.  Entonces la ruta al controlador de dominio estaba abierta.  ¬°Entra, Tom! <br><br>  Aqu√≠, se extrajo un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mimikatz</a> del sombrero m√°gico, que fue rentable por varios administradores de dominio.  Tom Hunter tuvo acceso a todas las m√°quinas en la red local, y una risa diab√≥lica asust√≥ al gato desde una silla cercana.  Este camino fue m√°s corto de lo esperado. <br><br><h2>  Azul eterno </h2><br>  El recuerdo de WannaCry y Petya sigue vivo en la mente de los pentesters, pero algunos administradores parecen haberse olvidado de los cript√≥grafos en la corriente de otras noticias de la noche.  Tom descubri√≥ tres nodos con una vulnerabilidad en el protocolo SMB: CVE-2017-0144 o EternalBlue.  Esta es la misma vulnerabilidad con la ayuda del ransomware WannaCry y Petya, una vulnerabilidad que permite la ejecuci√≥n de c√≥digo arbitrario en un host.  En uno de los nodos vulnerables hab√≠a una sesi√≥n de administraci√≥n de dominio: "explotar y obtener".  ¬øQu√© puedes hacer? El tiempo no ha ense√±ado a todos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/090/a04/c4d/090a04c4d07cd5a393972031e33776b3.png"><br><br><h2>  El perro basterville </h2><br>  A los cl√°sicos de seguridad de la informaci√≥n les gusta repetir que el punto m√°s d√©bil de cualquier sistema es una persona.  ¬øTe das cuenta de que el t√≠tulo anterior no coincide con el nombre de la tienda?  Quiz√°s no todos sean tan cuidadosos. <br><br>  En la mejor tradici√≥n de los √©xitos de taquilla de phishing, Tom Hunter ha registrado un dominio de una letra diferente del dominio de Baskerville Dogs.  La direcci√≥n de correo en este dominio simulaba la direcci√≥n del servicio de seguridad de la informaci√≥n de la tienda.  Dentro de los 4 d√≠as de 4:00 p.m. a 5:00 p.m., se envi√≥ un mensaje como este de manera uniforme a 360 direcciones desde una direcci√≥n falsa: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/135/744/e45/135744e454ee0075f4745eee7906fdbc.png"><br><br>  Quiz√°s, solo su propia pereza salv√≥ a los empleados del vertido masivo de contrase√±as.  De las 360 cartas, solo se abrieron 61; el servicio de seguridad no es muy popular.  Pero luego fue m√°s f√°cil. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/54a/d2f/c25/54ad2fc254381272cac2dcaefb743cf1.png"><br>  <i>P√°gina de phishing</i> <br><br>  46 personas hicieron clic en el enlace y casi la mitad, 21 empleados, no miraron la barra de direcciones e ingresaron con calma sus nombres de usuario y contrase√±as.  Buena captura, Tom. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ef/c17/e88/3efc17e88dd9a32689c7f6a679118f43.jpg"><br><br><h2>  Red wifi </h2><br>  Ahora no ten√≠a que depender de la ayuda de un gato.  Tom Hunter arroj√≥ algunas piezas de hierro en su viejo sed√°n y se dirigi√≥ a la oficina de Baskerville Dogs.  Su visita no fue acordada: Tom iba a probar el Wi-Fi del cliente.  En el estacionamiento del centro de negocios, hab√≠a varios lugares libres que ingresaron con √©xito en el per√≠metro de la red objetivo.  Aparentemente, no pensaron especialmente en su restricci√≥n, como si los administradores eligieran puntos adicionales al azar en respuesta a cualquier queja sobre una conexi√≥n Wi-Fi d√©bil. <br><br>  ¬øC√≥mo funciona la protecci√≥n WPA / WPA2 PSK?  El cifrado entre el punto de acceso y los clientes proporciona una clave previa a la sesi√≥n: clave transitoria por pares (PTK).  PTK utiliza la clave precompartida y otros cinco par√°metros: SSID, nombre de autenticador (ANounce), nombre de suplicante (SNounce), direcciones MAC del punto de acceso y cliente.  Tom intercept√≥ los cinco par√°metros y ahora solo faltaba la clave precompartida. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/793/240/7a8/7932407a8089981039a332bfb1d97bf6.png"><br><br>  La utilidad Hashcat obtuvo este enlace faltante en aproximadamente 50 minutos, y nuestro h√©roe se encontr√≥ en una red de invitados.  En el vecindario se pod√≠a ver la red de trabajo corporativo; curiosamente, aqu√≠ Tom administr√≥ la contrase√±a durante unos nueve minutos.  Y todo esto sin salir del estacionamiento, sin ninguna VPN.  La red de trabajo abri√≥ a nuestro h√©roe espacios abiertos para actividades monstruosas, pero √©l ... no arroj√≥ bonos en la tarjeta de la tienda. <br><br>  <i>Tom hizo una pausa, mir√≥ su reloj, arroj√≥ un par de billetes sobre la mesa y, despidi√©ndose, sali√≥ del caf√©.</i>  <i>Tal vez de nuevo un pentest, o tal vez pens√© en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">canal de telegramas</a> ...</i> <i><br></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/467199/">https://habr.com/ru/post/467199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../467187/index.html">Crea la √∫ltima biblioteca tecnol√≥gica</a></li>
<li><a href="../467189/index.html">Muestreo de temperatura</a></li>
<li><a href="../467191/index.html">C√≥mo creamos Vivaldi para Android</a></li>
<li><a href="../467193/index.html">Virus minero con "Puerta del cielo"</a></li>
<li><a href="../467197/index.html">C√≥mo se implementa el polimorfismo dentro de la JVM</a></li>
<li><a href="../467201/index.html">Experimento CacheBrowser: omitiendo un firewall chino sin un proxy usando el almacenamiento en cach√© de contenido</a></li>
<li><a href="../467203/index.html">Solo divisi√≥n, o c√≥mo crear una teor√≠a matem√°tica y ganar $ 400K con ella. Serie dos, pen√∫ltima</a></li>
<li><a href="../467205/index.html">Desarrollamos una aplicaci√≥n que env√≠a datos a otras aplicaciones (aplicaci√≥n de ecosistema)</a></li>
<li><a href="../467207/index.html">Cinco lenguajes de programaci√≥n prometedores con un futuro brillante (3 a√±os despu√©s)</a></li>
<li><a href="../467209/index.html">"Agentes aut√≥nomos" o ejecute c√≥digo en la criptoplataforma abierta Obyte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>