<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛡️ 👩🏻‍🚀 🧚🏿 Comment nous avons restauré les horaires des bus interurbains 🙆🏿 😆 ✅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comme sur tous les marchés normaux, les billets de bus sont vendus en ligne depuis quelques années maintenant. Il n'est pas nécessaire de faire la que...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons restauré les horaires des bus interurbains</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tuturu/blog/411629/"><img src="https://habrastorage.org/webt/zq/0q/cb/zq0qcbx7jnixdqezvc2pwx3doqs.jpeg"><br><br>  Comme sur tous les marchés normaux, les billets de bus sont vendus en ligne depuis quelques années maintenant.  Il n'est pas nécessaire de faire la queue à la caisse de la gare routière pour recevoir un reçu.  En Russie, jusqu'à 60% des itinéraires (les jours meilleurs, l'estimation est quelque peu floue compte tenu des vols gris) peuvent être achetés en ligne.  Y compris nous, Tutu. <br><br>  La première chose que nous voulions était de supprimer également le calendrier en ligne et de pouvoir acheter un billet en quelques clics.  Nous sommes habitués à résoudre de tels problèmes et, d'une manière ou d'une autre, nous avons mangé le chien dans le transport ferroviaire.  À première vue, les bus n'avaient pas l'air très compliqués.  C'est juste une affaire - négocier avec les systèmes d'automatisation des gares routières, décharger leurs vols via l'API et peigner un peu. <br><br>  <b>Travail facile, ont-ils dit.</b>  Un projet pour quelques jours, ont-ils dit. <br><br>  Nos idées fausses: <br><br>  1. Toutes les gares routières du pays sont automatisées. <br>  2. D'accord, la plupart sont automatisés. <br>  3. La comptabilité dans un cahier n'est effectuée nulle part ailleurs. <br>  4. D'accord, mais il existe toujours un moyen de connaître le calendrier à distance. <br>  5. Ceux qui sont automatisés affichent également le même itinéraire. <br>  6. D'accord, au moins ceux qui sont automatisés par le même système affichent également le même itinéraire. <br>  7. D'accord, là où il n'y a pas d'automatisation, au moins il y a un calendrier. <br>  8. Eh bien, il doit y avoir un calendrier, car sans cela, il n'y a que du trafic illégal! <br>  9. Le trafic illégal ne suffit pas. <br>  10. D'accord, il y a moins de 10% du marché. <br>  11. Un billet peut être acheté sur place et en arrière. <br>  12. Il n'y a pas d'itinéraires à sens unique. <br>  13. Eh bien, au moins les bus reviennent!  Il était une fois ... <br>  14. Ne peut pas laisser 300 bus vers une autre ville en un an et ne pas revenir. <br>  15. Les arrêts ont des noms uniques différents. <br>  16. Il n'y aura aucun problème avec un arrêt appelé «Turn» ou «Refuel». <a name="habracut"></a><br>  17. Les arrêts dans la région ont des noms différents. <br>  18. Il n'y aura aucun problème avec un arrêt avec le nom «Route». <br>  19. Les arrêts dans la ville ont des noms différents. <br>  20. Un arrêt ne peut avoir qu'un seul nom. <br>  21. D'accord, pas plus de cinq noms d'alias. <br>  22. Ces alias sont également tout à fait uniques. <br>  23. Dans tous les cas, les arrêts dans les documents officiels ont des coordonnées. <br>  24. D'accord, l'arrêt est au moins indiqué par la ville / région. <br>  25. Lorsqu'il y a un horaire pour un arrêt, on sait d'où il vient et où ira l'autobus. <br>  26. D'accord, cela se trouve toujours dans les documents. <br>  27. Bon sang, au moins il y a un programme pour un arrêt spécifique! <br>  28. L'itinéraire ville A - ville B est du centre vers le centre. <br>  29. Eh bien, au moins, il mène à la ville de B. <br>  30. Eh bien, au moins une fois il a conduit à la ville de B. <br>  31. Les bus ne peuvent pas décoller et disparaître au milieu de l'itinéraire. <br>  32. Un vol à une heure précise = un bus. <br>  33. Un bus ne peut pas se déplacer à plus de 120 kilomètres par heure. <br>  34. Le centre-ville est un point compréhensible. <br>  35. D'accord, c'est au moins la gare routière principale. <br>  36. D'accord, c'est au moins une sorte de gare routière. <br>  37. D'accord, au moins dans la ville. <br>  38. Il ne peut pas être un horaire, mais la réponse du système de station pour un vol spécifique est différente. <br>  39. Si vous pouvez y acheter un billet, à votre arrivée, vous pouvez acheter un aller-retour. <br>  40. Les billets aller-retour coûtent le même prix. <br>  41. Eh bien, leur prix ne peut pas différer de moitié. <br><br>  C'est l'essentiel.  Chaque jour, nous complétons cette liste avec de nouvelles petites choses.  Parlons maintenant un peu plus.  Au début - sur la base des bases, les vols officiels. <br><br><h3>  Qu'est-ce qu'un vol gris? </h3><br>  Il existe différents trains sur les chemins de fer et différents transporteurs et les trains se font une concurrence assez active.  Mais lorsque vous achetez un billet, vous l'achetez finalement dans une seule fenêtre, car l'infrastructure revient aux chemins de fer russes.  Leurs rails sont leur standard, ils ne pourront pas s'effondrer. <br><br>  Il y a déjà un ordre de grandeur de plus de transporteurs dans l'aviation, mais il y a de grands nœuds - aéroports, normes communes et un système d'information unique (plus précisément, plusieurs), dans lesquels il existe des identificateurs uniques élémentaires pour chaque nœud. <br><br>  L'informatisation est arrivée aux bus il y a longtemps, mais le marché, en termes informatiques, est similaire à un ornithorynque.  C'est un millier de gares routières et dix mille transporteurs.  Oui, il existe de grands clusters comme Mostransavto, mais il existe également des adresses IP avec un bus rouillé.  Même les petites gares routières des villages ont leurs propres normes. <br><br>  Et le plus drôle: s'il n'y a pas de transports illégaux sur les chemins de fer et dans les airs, alors le marché des bus est encore largement «gris».  Je parle d'un «arrêt à un poste près de la gare routière» pour prendre plus de passagers, et de minibus sur les services de compagnons de voyage, par exemple. <br><br>  Si le conducteur de la voiture de train ramasse des passagers pour de l'argent à la gare et les met dans son compartiment - c'est bien sûr un transport gris.  Mais le vol lui-même n'est pas "gris".  Et dans le transport par bus, l'itinéraire et les horaires sont importants.  Si vous prenez votre bus et emmenez des passagers quelque part, il s'agit soit d'un vol unique sur mesure (affrètement d'un bus, quelque chose comme une charte où la liste des passagers est connue à l'avance), soit d'un transport non commercial (bus pour les centres commerciaux ou bus pour les bureaux). du métro). <br><br>  J'ai des amis dans la Gazelle et je suis allé au chalet - vous n'avez pas le droit de vendre des billets.  Ou payer une amende d'environ 200 000 roubles auprès du transporteur de l'entité juridique. <br><br>  Un vol «gris» est soit quelque chose qui ressemble à une commande, mais ce n'est pas le cas (vente illégale de billets), ou c'est juste un voyage sans papiers avec des passagers, qui devrait logiquement être gratuit, mais en réalité, le chauffeur recueille de l'argent pour billets et ne délivre aucune pièce justificative. <br><br>  Et un vol «gris» peut également être mis en œuvre en utilisant l'infrastructure de la gare routière, bien que ces derniers temps il y ait eu moins de tels cas.  C'est à ce moment que les passagers atterrissent légalement, mais le débarquement est à un point d'arrêt illégal. <br><br>  Si quelque chose vous arrive pendant un vol gris, c'est votre problème.  Dans le cas du fonctionnaire, il s'agit d'un problème de transporteur.  Il est à noter que les horaires d'exploitation et de loisirs du transporteur gris ne sont pas réglementés.  De plus, le conducteur "gris" ne subit pas d'examen médical avant le voyage. <br><br><h3>  Qu'est-ce qu'un «achat de billets en ligne»? </h3><br>  Lorsque la Russie est entrée hardiment dans l'ère numérique, la main invisible du marché a montré qu'il était nécessaire de vendre des billets en ligne.  C'est élémentaire plus rentable pour les gares routières. <br><br>  Cependant, comme le marché est fragmenté, en règle générale, les entités suivantes entrent en jeu - les agrégateurs.  Il existe plusieurs systèmes de billetterie majeurs et des dizaines de plus petits.  Et la gare routière peut acquérir son propre système d'information et essayer de changer les données du gros. <br><br>  Les trois plus grands acteurs de l'automatisation en Russie sont le trafic électronique, KVC et Avibus.  Ils automatisent la gare routière et vous permettent d'ouvrir l'API pour les agrégateurs, si cela ne vous dérange pas.  Grâce à leurs systèmes, vous pouvez accéder aux billets de la gare routière ou du transporteur.  Par exemple, Buses of the Big Country nous donne un accès direct à leurs itinéraires - c'est ainsi que le travail est construit directement avec les plus grands acteurs.  Mais avec les entrepreneurs qui ont acheté un bus dans les années 80 et voyagent, cela ne fonctionnera pas de cette façon.  Ou il y a des opérateurs qui ont bien fonctionné pendant 40 ans sans votre Internet et ne comprennent pas du tout pourquoi cela est nécessaire.  Avec toutes les tentatives de les rassembler en une seule association (je vous rappelle que ce sont des dizaines de milliers d'entités juridiques et d'entrepreneurs individuels), ils se demandent tous à l'amiable et sincèrement pourquoi cela est nécessaire. <br><br>  Nous travaillons spécifiquement avec les petits transporteurs via un agrégateur qui collecte leurs vols au niveau des gares routières de départ. <br><br>  Le prochain frein majeur sur le marché est la nécessité d'imprimer un ticket (plus précisément un ticket de route).  Vous pouvez descendre dans le train par inscription électronique juste avec un passeport en main.  Vous recevrez un billet d'avion partout à l'aéroport avant l'embarquement.  Mais dans le bus - cherchez une imprimante, les gares routières ne fournissent pas toujours de tels services.  Heureusement, ici, le papier doit être vaincu comme il l'a été sur le chemin de fer.  Au fil du temps. <br><br><h3>  Maintenant sang et larmes </h3><br>  Les systèmes d'automatisation, même les plus grands, fonctionnent très localement.  Autrement dit, ils automatisent la ville, au mieux la région.  Ensuite, si possible, rendez-vous chez les voisins. <br>  Par conséquent, tous les systèmes utilisent une structure de géodonnées très simple (ou pas du tout utilisée).  Il peut ne pas y avoir un tel paramètre à l'arrêt, comme les coordonnées, la région / région / région est également le plus souvent absente. <br><br>  Cela signifie que dès que vous mélangez des données de deux systèmes, par exemple, pour pouvoir acheter un billet aller-retour sur la route interrégionale, vous devez regrouper toutes les données sur les arrêts sous une seule forme. <br><br>  En conséquence, nous avons dû écrire notre propre géobase avec la structure et le jeu de données corrects.  Comme base, ils ont pris OpenStreetMap. <br><br>  Les objets géographiques des systèmes intégrables sont déjà comparés aux objets géographiques de la base de données principale et tentent de s'y attacher.  Dans les systèmes intégrés, il y a beaucoup d'arrêts tels que «Track», «Turn», etc., qui, en fait, font partie de l'itinéraire.  Des noms comme Aleksandrovka, Mikhaylovka, etc., sont toujours une surprise, car il existe des dizaines et même des centaines de villages de ce type en Russie. <br><br>  Mais nous sommes des mathématiciens!  Solution: ajustez le moteur, ce qui construira une hypothèse sur l'endroit où le bus aura le temps de se déplacer entre les points déjà connus (attachés) de son itinéraire - quel Mikhailovka?  Il se peut que cela ne se révèle en aucune façon.  Soit dit en passant, cela signifie que soit on y a perdu la trace, soit Mikhailovka il y a 20 ans, ou autre chose.  Vous devez appeler et demander aux habitants. <br><br>  Plus intéressant encore.  Tous les systèmes n'envoient pas de données sur les arrêts, et les passagers peuvent ne pas savoir où ils arrivent ni où le bus part.  Dans différents systèmes, les mêmes arrêts sont appelés différemment.  Parfois, les points sont marqués comme des points matériels, ce qui est important, par exemple, si un passager a acheté un billet pour la ville et que le bus s'arrête sur l'autoroute à la périphérie de la ville et continue.  Du point de vue du système d'information, une ville peut être un objet et un passager 10 kilomètres à pied. <br><br>  Avec beaucoup de difficulté, nous avons reçu et continuons de recevoir les données nécessaires.  Dans le même temps, dans les villes où il n'y a pas d'automatisation, nous avons demandé aux gens d'aider - envoyer des photos de morceaux de papier depuis les gares routières.  Plus tard, ces morceaux de papier ont joué un rôle très important: nous avons vérifié l'exactitude des hypothèses en les utilisant, par exemple, sur le mouvement inverse des bus. <br><br>  Oui!  Le mouvement inverse est souvent la tâche de restaurer un itinéraire.  Parce que A - B est une route d'une région, et B - A est une autre route d'une autre région.  Et ils peuvent être dans différents systèmes d'information.  Et les billets pour eux sont vendus dans différentes stations.  Et l'horaire n'est pas connu au box-office, mais le chauffeur le sait. <br><br>  L'hypothèse était qu'il est possible de prédire mathématiquement le mouvement du bus le long de l'itinéraire, en se basant sur l'idée que les bus rentrent parfois chez eux et que leur nombre sur l'itinéraire est limité.  En général, cela s'est avéré correct.  En général, parce qu'il y a des situations où le bus part pour une autre ville, puis disparaît pendant quelques semaines (apparemment, sur d'autres itinéraires), puis se retrouve soudainement dans la ville de départ.  C'est juste les calendriers qui ont aidé à détecter de tels cas. <br><br>  Encore besoin de coller des vols.  Parce que dans différents systèmes, le même vol peut également être pris en compte de différentes manières.  Et même partir à une heure légèrement différente.  Par conséquent, quatre vols peuvent entrer dans le programme à 20h00, par exemple.  Nous avons dû écrire la mécanique de quelque chose comme un hachage perceptuel - comparer les vols de différents systèmes sur la base de 4-5 paramètres.  Un schéma similaire était nécessaire pour coupler les vols A - B - C - il s'agit parfois d'un vol réel, mais de deux dans les systèmes d'information. <br><br><h3>  Modifications d'horaire </h3><br>  Par rapport à nos trains électriques préférés, où tout est automatisé une centaine de fois, mais aussi change souvent, le bus change beaucoup moins fréquemment.  Parce que pour cela, vous devez vous mettre d'accord sur une nouvelle carte d'itinéraire et un temps de trajet.  La procédure de mise à jour du planning est assez simple, le cache de recherche n'est pas non plus très compliqué - du moins il se réchauffe. <br><br><h3>  Qu'est-il arrivé? </h3><br><img src="https://habrastorage.org/webt/sp/iz/o2/spizo2_fx6ftwn4sbamfkut4dig.png"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Horaires de bus Rostov-sur-le-Don - Moscou</a></i> <br><br>  Nous avons maintenant la possibilité de montrer aux utilisateurs des informations sur les vols et la possibilité d'acheter un billet de bus quelque part dans 40 à 50% des trajets en bus qui traversent la Russie.  Dans 50 à 60% des utilisateurs, ils ne trouvent aucune information sur les vols disponibles (même s'ils y vont effectivement, et on nous dit qu'ils y vont).  Par conséquent, nous avons décidé d'emprunter la voie de la fermeture au moins du besoin de base d'informations, tout en élargissant l'assortiment pour l'achat de billets. <br><br>  Nous pouvons restaurer les itinéraires avec le même degré d'erreur que la différence habituelle de circulation des véhicules. <br><br>  Eh bien, nous gagnons une grande base de données d'avis pour tous les vols, comme nous le faisons avec les trains et les avions.  Cela vous permet de comprendre très clairement les caractéristiques de chaque itinéraire, bus et quelles surprises un passager peut attendre. <br><br>  Et voici plus sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctionnement des bus en Russie en général.</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr411629/">https://habr.com/ru/post/fr411629/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr411613/index.html">Clash of the Titans: comparaison des lecteurs phares du PocketBook 740 et d'Amazon Kindle Oasis 2017</a></li>
<li><a href="../fr411617/index.html">Système multimédia pour Toyota Prius (Restayl)</a></li>
<li><a href="../fr411621/index.html">SpaceX construira une grosse fusée à Los Angeles</a></li>
<li><a href="../fr411623/index.html">Les scientifiques ont créé une enzyme qui décompose le plastique</a></li>
<li><a href="../fr411625/index.html">Radio-86RK sur l'ESP-01S</a></li>
<li><a href="../fr411631/index.html">Un télégramme en Russie pourrait être bloqué en raison des plans de Durov de lancer sa propre crypto-monnaie</a></li>
<li><a href="../fr411633/index.html">Grossesse, accouchement et santé des yeux de maman</a></li>
<li><a href="../fr411635/index.html">Microsoft a ouvert le code source du gestionnaire de fichiers</a></li>
<li><a href="../fr411637/index.html">Il y a plusieurs milliards d'années, le germe de la planète a été détruit dans le système solaire.</a></li>
<li><a href="../fr411639/index.html">Les scientifiques ont développé une technologie pour la production de graphène en rouleaux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>