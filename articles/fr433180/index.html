<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏯️ ☪️ 🙅🏻 Résolution des problèmes de type de données dans Ruby ou Fiabilisation des données 👨🏻‍🎨 👹 👊🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je voudrais parler des problèmes avec les types de données dans Ruby, quels problèmes j'ai rencontrés, comment ils peuvent être réso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Résolution des problèmes de type de données dans Ruby ou Fiabilisation des données</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433180/">  Dans cet article, je voudrais parler des problèmes avec les types de données dans Ruby, quels problèmes j'ai rencontrés, comment ils peuvent être résolus et comment s'assurer que les données avec lesquelles nous travaillons peuvent être fiables. <br><br><img src="https://habrastorage.org/webt/re/27/5n/re275nqouf3ucrd8gxrmv0cvboq.png" alt="image"><br><a name="habracut"></a><br>  Vous devez d'abord décider quels types de données sont.  Je vois une définition très réussie du terme, qui peut être trouvée dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HaskellWiki</a> . <br><blockquote>  Les types sont la façon dont vous décrivez les données avec lesquelles votre programme va travailler. </blockquote>  Mais qu'est-ce qui ne va pas avec les types de données dans Ruby?  Pour décrire le problème de manière globale, je voudrais souligner plusieurs raisons. <br><br><h4>  Raison 1. Problèmes de Ruby lui-même </h4><br>  Comme vous le savez, Ruby utilise <b>un typage dynamique strict avec prise en charge de ce qu'on appelle.</b>  <b>typage de canard</b> .  Qu'est-ce que cela signifie? <br><br>  Un typage fort nécessite une conversion explicite et ne produit pas cette conversion à lui seul, comme c'est le cas, par exemple, en JavaScript.  Par conséquent, la liste de codes suivante dans Ruby échouera: <br><br><pre><code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-string"><span class="hljs-string">'1'</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> #=&gt; <span class="hljs-built_in"><span class="hljs-built_in">TypeError</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> can<span class="hljs-string"><span class="hljs-string">'t be coerced into Integer)</span></span></code> </pre> <br>  En typage dynamique, la vérification de type a lieu lors de l'exécution, ce qui nous permet de ne pas spécifier les types de variables et d'utiliser la même variable pour stocker des valeurs de différents types: <br><br><pre> <code class="javascript hljs">x = <span class="hljs-number"><span class="hljs-number">123</span></span> x = <span class="hljs-string"><span class="hljs-string">"123"</span></span> x = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]</code> </pre><br>  La déclaration suivante est généralement donnée comme explication du terme «typage du canard»: s'il ressemble à un canard, nage comme un canard et quacks comme un canard, alors il s'agit très probablement d'un canard.  C'est-à-dire  le typage canard, s'appuyant sur le comportement des objets, nous offre une flexibilité supplémentaire dans l'écriture de nos systèmes.  Par exemple, dans l'exemple ci-dessous, la valeur pour nous n'est pas le type de l'argument de <code>collection</code> , mais sa capacité à répondre aux messages <code>blank?</code>  et <code>map</code> : <br><br><pre> <code class="javascript hljs">def process(collection) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> collection.blank? collection.map { |item| do_something_with(item) } end</code> </pre><br>  La possibilité de créer de tels «canards» est un outil très puissant.  Cependant, comme tout autre outil puissant, il nécessite une grande prudence lors de son utilisation.  Cela peut être <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vérifié par les recherches de Rollbar</a> , où ils ont analysé plus de 1000 applications ferroviaires et identifié les erreurs les plus courantes.  Et 2 des 10 erreurs les plus courantes sont liées précisément au fait que l'objet ne peut pas répondre à un message spécifique.  Et par conséquent, vérifier le comportement de l'objet que la saisie de canard nous donne dans de nombreux cas peut ne pas être suffisant. <br><br>  Nous pouvons observer comment la vérification de type est ajoutée aux langages dynamiques sous une forme ou une autre: <br><br><ul><li>  TypeScript apporte la vérification de type aux développeurs JavaScript </li><li>  Des indications de type ont été ajoutées dans Python 3 </li><li>  Dialyzer fait un bon travail de vérification de type pour Erlang / Elixir </li><li>  Steep et Sorbet ajoutent une vérification de type dans Ruby 2.x </li></ul><br>  Cependant, avant de parler d'un autre outil pour travailler plus efficacement avec les types dans Ruby, examinons deux autres problèmes pour lesquels je voudrais trouver une solution. <br><br><h4>  Raison 2. Le problème général des développeurs dans divers langages de programmation </h4><br>  Rappelons la définition des types de données que j'ai donnée au tout début de l'article: <blockquote>  Les types sont la façon dont vous décrivez les données avec lesquelles votre programme va travailler. </blockquote>  C'est-à-dire  les types sont conçus pour nous aider à décrire les données de notre domaine dans lequel nos systèmes fonctionnent.  Cependant, souvent au lieu de fonctionner avec les types de données que nous avons créés à partir de notre domaine, nous utilisons des types primitifs, tels que des nombres, des chaînes, des tableaux, etc., qui ne disent rien sur notre domaine.  Ce problème est généralement classé comme obsession primitive (obsession des primitives). <br><br>  Voici un exemple typique d'obsession primitive: <br><br><pre> <code class="javascript hljs">price = <span class="hljs-number"><span class="hljs-number">9.99</span></span> # vs Money = Struct.new(:amount_cents, :currency) price = Money.new(<span class="hljs-number"><span class="hljs-number">9</span></span>_99, <span class="hljs-string"><span class="hljs-string">'USD'</span></span>)</code> </pre><br>  Au lieu de décrire le type de données pour travailler avec de l'argent, des nombres réguliers sont souvent utilisés.  Et ce nombre, comme tout autre type primitif, ne dit rien sur notre sujet.  À mon avis, c'est le plus gros problème de l'utilisation de primitives au lieu de créer votre propre système de types, où ces types décrivent des données de notre domaine.  Nous rejetons nous-mêmes les avantages que nous pouvons obtenir avec l'utilisation de types. <br><br>  Je parlerai de ces avantages juste après avoir couvert un autre problème que notre framework Ruby on Rails préféré nous a appris, grâce auquel, j'en suis sûr, la plupart de ceux qui sont ici sont venus à Ruby. <br><br><h4>  Raison 3. Le problème que le framework Ruby on Rails nous a habitué à </h4><br>  Ruby on Rails, ou plutôt le framework ORM <code>ActiveRecord</code> intégré, nous a appris que les objets qui sont dans un état invalide sont normaux.  À mon avis, c'est loin d'être la meilleure idée.  Et je vais essayer de l'expliquer. <br><br>  Prenez cet exemple: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRecord</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">validates</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">presence</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class"> </span></span>= App.new app.valid? # =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br>  Il n'est pas difficile de comprendre que l'objet <code>app</code> aura un état invalide: la validation du modèle <code>App</code> nécessite que les objets de ce modèle aient un attribut de <code>platform</code> , et notre objet a cet attribut vide. <br><br>  Essayons maintenant de passer cet objet dans un état non valide à un service qui attend un objet <code>App</code> comme argument et effectue certaines actions en fonction de l'attribut de <code>platform</code> - <code>platform</code> de cet objet: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoSomethingWithAppPlatform</span></span></span><span class="hljs-class"> # @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">param</span></span></span><span class="hljs-class"> [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class"> # # @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">) # </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">something</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoSomethingWithAppPlatform</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  Dans ce cas, même la vérification de type passerait.  Cependant, puisque cet attribut est vide pour l'objet, il n'est pas clair comment le service gérera ce cas.  Dans tous les cas, ayant la capacité de créer des objets dans un état invalide, nous nous condamnons à la nécessité de traiter en permanence les cas où un état invalide s'est infiltré dans notre système. <br><br>  Mais réfléchissons à un problème plus profond.  En général, pourquoi vérifions-nous la validité des données?  En règle générale, pour vous assurer qu'un état non valide ne s'infiltre pas dans nos systèmes.  S'il est si important de garantir qu'un état non valide n'est pas autorisé, alors pourquoi autorisons-nous la création d'objets avec un état non valide?  Surtout lorsque nous avons affaire à des objets aussi importants que le modèle ActiveRecord, qui fait souvent référence à la logique métier racine.  À mon avis, cela semble être une très mauvaise idée. <br><br>  Ainsi, résumant tout ce qui précède, nous obtenons les problèmes suivants lors de l'utilisation des données dans Ruby / Rails: <br><br><ul><li>  le langage lui-même a un mécanisme pour vérifier le comportement, mais pas les données </li><li>  nous, comme les développeurs dans d'autres langues, avons tendance à utiliser des types de données primitifs au lieu de créer un système de types pour notre domaine </li><li>  Rails nous a habitués au fait que la présence d'objets dans un état invalide est normale, bien qu'une telle solution semble être une assez mauvaise idée </li></ul><br><h4>  Comment résoudre ces problèmes? </h4><br>  Je voudrais considérer l'une des solutions aux problèmes décrits ci-dessus, en utilisant un exemple d'implémentation de fonctionnalités réelles dans Appodeal.  Dans le processus de collecte de statistiques sur les statistiques des utilisateurs actifs quotidiens (ci-après DAU) pour les applications qui utilisent Appodeal pour monétiser, nous sommes arrivés à environ la structure de données suivante que nous devons collecter: <br><br><pre> <code class="javascript hljs">DailyActiveUsersData = Struct.new( :app_id, :country_id, :user_id, :ad_type, :platform_id, :ad_id, :first_request_date, <span class="hljs-attr"><span class="hljs-attr">keyword_init</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> )</code> </pre><br>  Cette structure a tous les mêmes problèmes que j'ai décrits ci-dessus: <br><br><ul><li>  toute vérification de type est complètement absente, ce qui ne permet pas de savoir quelles valeurs les attributs de cette structure peuvent prendre </li><li>  il n'y a pas de description des données utilisées dans cette structure, et au lieu des types spécifiques à notre domaine, des primitives sont utilisées </li><li>  la structure peut exister dans un état non valide </li></ul><br>  Pour résoudre ces problèmes, nous avons décidé d'utiliser les bibliothèques <code>dry-types</code> et <code>dry-struct</code> .  <code>dry-types</code> est un système de type simple et extensible pour Ruby, utile pour la coulée, l'application de diverses contraintes, la définition de structures complexes, etc. <code>dry-struct</code> est une bibliothèque construite au-dessus de <code>dry-types</code> qui fournit une DSL pratique pour définir des structures typées / cours. <br><br>  Pour décrire les données de notre domaine utilisé dans la structure de collecte des DAU, le système de type suivant a été créé: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span> Types include Dry::Types.module AdTypeId = Types::Strict::Integer.enum(AD_TYPES.invert) EntityId = Types::Strict::Integer.constrained(gt: <span class="hljs-number"><span class="hljs-number">0</span></span>) PlatformId = Types::Strict::Integer.enum(PLATFORMS.invert) Uuid = Types::Strict::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.constrained(format: UUID_REGEX) Zero = Types.Constant(<span class="hljs-number"><span class="hljs-number">0</span></span>) end</code> </pre><br>  Nous avons maintenant reçu une description des données qui sont utilisées dans notre système et que nous pouvons utiliser dans la structure.  Comme vous pouvez le voir, les types <code>EntityId</code> et <code>Uuid</code> ont certaines limitations, et les types énumérables <code>AdTypeId</code> et <code>PlatformId</code> ne peuvent avoir que des valeurs d'un ensemble spécifique.  Comment travailler avec ces types?  Considérez le <code>PlatformId</code> comme exemple: <br><br><pre> <code class="javascript hljs">#     enumerable- PLATFORMS = { <span class="hljs-string"><span class="hljs-string">'android'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'fire_os'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'ios'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> }.freeze #       , #     Types::PlatformId[<span class="hljs-number"><span class="hljs-number">1</span></span>] == Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'android'</span></span>] #    ,    #   ,     Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'fire_os'</span></span>] # =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> #     ,   Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'windows'</span></span>] # =&gt; Dry::Types::ConstraintError</code> </pre><br>  Donc, en utilisant les types eux-mêmes compris.  Appliquons-les maintenant à notre structure.  En conséquence, nous avons obtenu ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DailyActiveUsersData</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dry</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">country_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ad_type</span></span></span><span class="hljs-class">, (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdTypeId</span></span></span><span class="hljs-class"> ǀ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zero</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlarformId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ad_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Uuid</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first_request_date</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Strict</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Que voyons-nous maintenant dans la structure de données de DAU?  En utilisant <code>dry-types</code> et <code>dry-struct</code> nous nous sommes débarrassés des problèmes liés au manque de vérification des types de données et au manque de description des données.  Maintenant, toute personne, après avoir examiné cette structure et la description des types qui y sont utilisés, peut comprendre quelles valeurs chaque attribut peut prendre. <br><br>  En ce qui concerne le problème avec les objets dans un état invalide, <code>dry-struct</code> nous sauve <code>dry-struct</code> de ceci: si nous essayons d'initialiser la structure avec des valeurs invalides, nous obtiendrons une erreur.  Et pour les cas où l'exactitude des données est essentielle (et dans le cas de la collecte DAU, c'est le cas avec nous), à mon avis, obtenir une exception est beaucoup mieux que d'essayer de traiter des données invalides plus tard.  De plus, si le processus de test est bien établi pour vous (et c'est exactement le cas avec nous), alors avec une forte probabilité, le code générant de telles erreurs n'atteindra tout simplement pas l'environnement de production. <br><br>  Et en plus de l'impossibilité d'initialiser des objets dans un état non valide, <code>dry-struct</code> ne permet pas non plus de changer d'objets après l'initialisation.  Grâce à ces deux facteurs, nous obtenons la garantie que les objets de ces structures seront dans un état valide et vous pouvez compter en toute sécurité sur ces données n'importe où dans votre système. <br><br><h4>  Résumé </h4><br>  Dans cet article, j'ai essayé de décrire les problèmes que vous pouvez rencontrer en travaillant avec des données dans Ruby, ainsi que de parler des outils que nous utilisons pour résoudre ces problèmes.  Et grâce à l'implémentation de ces outils, j'ai cessé de m'inquiéter de l'exactitude des données avec lesquelles nous travaillons.  N'est-ce pas parfait?  N'est-ce pas le but d'un instrument - de faciliter notre vie dans certains aspects de celui-ci?  Et à mon avis, les <code>dry-types</code> <code>dry-struct</code> parfaitement leur travail! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433180/">https://habr.com/ru/post/fr433180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433166/index.html">Prédire le temps de solution de ticket à l'aide du Machine Learning</a></li>
<li><a href="../fr433168/index.html">Pourquoi un programmeur fait-il un stage en cuisine - une conversation avec Dodo Pizza sur le gemba, .NET et l'ouverture</a></li>
<li><a href="../fr433172/index.html">Nous attachons le multijoueur au jeu mobile "Make words from words" sur iOS et Android, écrit en C ++</a></li>
<li><a href="../fr433174/index.html">Tous les correctifs ne sont pas également utiles.</a></li>
<li><a href="../fr433178/index.html">Comment nous avons restauré un fichier .wav endommagé</a></li>
<li><a href="../fr433182/index.html">Est-il possible de former un agent pour la négociation en bourse avec des renforts? Implémentation du langage R</a></li>
<li><a href="../fr433184/index.html">ASP.NET Core 2.2 est sorti. Quoi de neuf (2 sur 3)</a></li>
<li><a href="../fr433186/index.html">Il ne suffit pas de compter les polygones pour optimiser les modèles 3D</a></li>
<li><a href="../fr433188/index.html">Un projet de loi sur le travail autonome de Runet a été soumis à la Douma d'État</a></li>
<li><a href="../fr433192/index.html">Kubernetes: une solution de projet personnel incroyablement abordable</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>