<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∏üèª üçí üé≤ Como tornar as corotinas no Unity um pouco mais convenientes üñêüèæ üë©üèΩ‚Äç‚öïÔ∏è üí¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cada desenvolvedor encontra suas vantagens e desvantagens do uso da corotina no Unity. E ele decide em quais cen√°rios aplic√°-los e em que dar prefer√™n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como tornar as corotinas no Unity um pouco mais convenientes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442622/"><p>  Cada desenvolvedor encontra suas vantagens e desvantagens do uso da corotina no Unity.  E ele decide em quais cen√°rios aplic√°-los e em que dar prefer√™ncia a alternativas. </p><br><p>  Na pr√°tica cotidiana, costumo usar corotinas para v√°rios tipos de tarefas.  Certa vez, percebi que era eu quem aborrecia e rejeitava muitos rec√©m-chegados. </p><a name="habracut"></a><br><h2 id="koshmarnyy-interfeys">  Interface pesadelo </h2><br><p>  O mecanismo fornece apenas alguns m√©todos e v√°rias de suas sobrecargas para trabalhar com corotinas: </p><br><p>  <strong>Iniciar</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">docs</a> ) </p><br><ul><li><code>StartCoroutine(string name, object value = null)</code> </li> <li> <code>StartCoroutine(IEnumerator routine)</code> </li> </ul><br><p>  <strong>Parar</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentos</a> ) </p><br><ul><li> <code>StopCoroutine(string methodName)</code> </li> <li> <code>StopCoroutine(IEnumerator routine)</code> </li> <li> <code>StopCoroutine(Coroutine routine)</code> </li> </ul><br><p>  Sobrecargas com par√¢metros de string (apesar de sua conveni√™ncia enganosa) podem imediatamente <del>  enviar para o lixo </del>  esque√ßa por pelo menos tr√™s raz√µes. </p><br><ul><li>  O uso expl√≠cito de nomes de m√©todos de string complicar√° a an√°lise futura de c√≥digos, depura√ß√£o e muito mais. </li><li>  De acordo com a documenta√ß√£o, as sobrecargas de string demoram mais e permitem que apenas um par√¢metro adicional seja passado. </li><li>  Na minha pr√°tica, muitas vezes acontecia que nada acontecia quando uma sobrecarga de string <code>StopCoroutine</code> era <code>StopCoroutine</code> .  Corutin continuou a ser executado. </li></ul><br><p>  Por um lado, os m√©todos fornecidos s√£o suficientes para atender √†s necessidades b√°sicas.  Mas com o tempo, comecei a perceber que, com o uso ativo, tenho que escrever uma grande quantidade de c√≥digo padr√£o - isso √© cansativo e prejudica sua legibilidade. </p><br><h2 id="blizhe-k-suti">  Mais perto do ponto </h2><br><p>  Neste artigo, quero descrever um pequeno inv√≥lucro que utilizo h√° muito tempo.  Gra√ßas a ela, com pensamentos sobre as corotinas, fragmentos do c√≥digo do modelo n√£o aparecem mais na minha cabe√ßa, com os quais tive que dan√ßar ao redor deles.  Al√©m disso, toda a equipe ficou mais f√°cil de ler e entender os componentes onde as corotinas s√£o usadas. </p><br><p>  Suponha que tenhamos a seguinte tarefa - escrever um componente que permita mover um objeto para um determinado ponto. </p><br><p>  Nesse momento, n√£o importa qual m√©todo ser√° usado para mover e em quais coordenadas.  Somente uma das muitas op√ß√µes ser√° selecionada por mim - estas s√£o interpola√ß√£o e coordenadas globais. </p><br><p>  Observe que √© altamente recomend√°vel n√£o mover um objeto alterando suas coordenadas ‚Äúna testa‚Äù, ou seja, o construto <code>transform.position = newPosition</code> se o componente <code>RigidBody</code> for usado com ele (especialmente no m√©todo <code>Update</code> ) ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">docs</a> ). </p><br><h3 id="standartnaya-realizaciya">  Implementa√ß√£o padr√£o </h3><br><p>  Proponho a seguinte op√ß√£o de implementa√ß√£o para o componente necess√°rio: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) StartCoroutine(MoveRoutine()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Um pouco sobre c√≥digo</b> <div class="spoiler_text"><p>  No m√©todo <code>Move</code> , √© muito importante executar a corotina apenas quando ainda n√£o estiver em execu√ß√£o.  Caso contr√°rio, eles podem ser lan√ßados quantos forem desejados e cada um deles mover√° o objeto. </p><br><p>  <code>threshold</code> - toler√¢ncia.  Em outras palavras, a dist√¢ncia at√© o ponto, aproximando-se da qual assumiremos que alcan√ßamos a meta. </p><br><p>  <strong>Para que serve?</strong> </p><br><p>  Dado que todos os componentes ( <code>x</code> , <code>y</code> , <code>z</code> ) da estrutura <code>Vector3</code> s√£o do tipo <code>float</code> , √© uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√° id√©ia</a> usar o resultado da verifica√ß√£o da igualdade de dist√¢ncia do alvo e da toler√¢ncia como condi√ß√£o do loop. </p><br><p>  Verificamos a dist√¢ncia do alvo para mais / menos, o que nos permite evitar esse problema. </p><br><p>  Al√©m disso, se desejar, voc√™ pode usar o <code>Mathf.Approximately</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">docs</a> ) para uma verifica√ß√£o <em>aproximada</em> da igualdade.  Vale a pena notar que, com alguns m√©todos de movimento, a velocidade pode ser grande o suficiente para que o objeto ‚Äúsalte‚Äù o alvo em um quadro.  Ent√£o o ciclo nunca terminar√°.  Por exemplo, se voc√™ usar o m√©todo <code>Vector3.MoveTowards</code> . </p><br><p>  At√© <code>Vector3</code> eu sei, no mecanismo do Unity para a estrutura <code>Vector3</code> , o operador <code>Vector3</code> j√° est√° redefinido de tal forma que <code>Mathf.Approximately</code> √© chamado para verificar a igualdade entre os componentes. </p></div></div><br><p>  Por enquanto √© tudo, nosso componente √© bastante simples.  E no momento n√£o h√° problemas.  Mas, qual √© esse componente que permite mover um objeto para um ponto, mas n√£o oferece uma oportunidade para interromp√™-lo.  Vamos consertar essa injusti√ßa. </p><br><p>  Como voc√™ e eu decidimos n√£o passar para o lado ruim, e n√£o usar sobrecargas com par√¢metros de string, agora precisamos salvar em algum lugar um link para a corotina em execu√ß√£o.  Caso contr√°rio, como ent√£o impedi-la? </p><br><p>  Adicione um campo: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Coroutine moveRoutine;</code> </pre> <br><p>  Fix <code>Move</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) moveRoutine = StartCoroutine(MoveRoutine()); }</code> </pre> <br><p>  Adicione um m√©todo de stop motion: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) StopCoroutine(moveRoutine); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">C√≥digo inteiro</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Coroutine moveRoutine; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) moveRoutine = StartCoroutine(MoveRoutine()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) StopCoroutine(moveRoutine); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> </div></div><br><p>  Uma quest√£o completamente diferente! <del>  Pelo menos aplique na ferida. </del></p><br><p>  Ent√£o  Temos um pequeno componente que executa a tarefa.  Qual √© a minha indigna√ß√£o? </p><br><h3 id="problemy-i-ih-reshenie">  Problemas e sua solu√ß√£o </h3><br><p>  Com o tempo, o projeto cresce e, com ele, o n√∫mero de componentes, incluindo aqueles que utilizam corotinas.  E cada vez essas coisas est√£o me assombrando cada vez mais: </p><br><ul><li>  Chamadas sandu√≠che em andamento </li></ul><br><pre> <code class="cs hljs">StartCoroutine(MoveRoutine());</code> </pre> <br><pre> <code class="cs hljs">StopCoroutine(moveRoutine);</code> </pre> <br><p>  S√≥ de olhar para eles, meus olhos se contraem e ler um c√≥digo desse tipo √© um prazer duvidoso (concordo que pode ser pior).  Mas seria muito melhor e mais visual ter algo assim: </p><br><pre> <code class="cs hljs">moveRoutine.Start();</code> </pre> <br><pre> <code class="cs hljs">moveRoutine.Stop();</code> </pre> <br><ul><li>  Sempre que voc√™ chamar <code>StartCoroutine</code> lembre-se de salvar o valor de retorno: </li></ul><br><pre> <code class="cs hljs">moveRoutine = StartCoroutine(MoveRoutine());</code> </pre> <br><p>  Caso contr√°rio, devido √† falta de refer√™ncia √† corotina, voc√™ simplesmente n√£o poder√° par√°-la. </p><br><ul><li>  Verifica√ß√µes constantes: </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>)</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)</code> </pre> <br><ul><li>  E outra coisa m√° que voc√™ deve sempre lembrar (e que eu <del>  esqueci de novo </del>  especialmente perdido).  No final da corotina e antes de cada sa√≠da dela (por exemplo, usando <code>yield break</code> ), o valor do campo deve ser redefinido. <br><pre> <code class="cs hljs">moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> </li></ul><br><p>  Se voc√™ esquecer, receber√° uma rotina √∫nica.  Ap√≥s a primeira execu√ß√£o em <code>moveRoutine</code> , o link para a corotina permanecer√° e a nova execu√ß√£o n√£o funcionar√°. </p><br><p>  Da mesma maneira, voc√™ precisa fazer no caso de uma parada for√ßada: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { StopCoroutine(moveRoutine); moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">C√≥digo com todas as altera√ß√µes</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Coroutine moveRoutine; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { moveRoutine = StartCoroutine(MoveRoutine()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { StopCoroutine(moveRoutine); moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.localPosition = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> </div></div><br><p>  A certa altura, eu realmente quero tirar toda essa m√°scara em algum lugar e deixar apenas os m√©todos necess√°rios: <code>Start</code> , <code>Stop</code> e mais alguns eventos e propriedades. </p><br><p>  <strong>Vamos finalmente fazer isso!</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Owner { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Coroutine Coroutine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func&lt;IEnumerator&gt; Routine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsProcessing =&gt; Coroutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CoroutineObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour owner, Func&lt;IEnumerator&gt; routine</span></span></span><span class="hljs-function">)</span></span> { Owner = owner; Routine = routine; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Stop(); Coroutine = Owner.StartCoroutine(Process()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsProcessing) { Owner.StopCoroutine(Coroutine); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Debriefing</b> <div class="spoiler_text"><p>  <code>Owner</code> - um link para a inst√¢ncia <code>MonoBehaviour</code> √† qual a corotina ser√° anexada.  Como voc√™ sabe, ele deve ser executado no contexto de um componente espec√≠fico, pois √© para ele que os m√©todos <code>StopCoroutine</code> e <code>StopCoroutine</code> .  Portanto, precisamos de um link para o componente que ser√° o propriet√°rio da corotina. </p><br><p>  <code>Coroutine</code> - um an√°logo do campo <code>moveRoutine</code> no componente <code>MoveToPoint</code> , cont√©m um link para a corotina atual. </p><br><p>  <code>Routine</code> - o delegado com quem o m√©todo que atua como a rotina ser√° comunicado. </p><br><p>  <code>Process()</code> √© um pequeno inv√≥lucro sobre o m√©todo principal de <code>Routine</code> .  √â necess√°rio para poder rastrear quando a execu√ß√£o da corotina estiver conclu√≠da, redefinir o link para ele e executar outro c√≥digo naquele momento (se necess√°rio). </p><br><p>  <code>IsProcessing</code> - permite descobrir se a corotina est√° em execu√ß√£o no momento. </p></div></div><br><p>  Assim, nos livramos de uma grande quantidade de dor de cabe√ßa e nosso componente assume uma apar√™ncia completamente diferente: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CoroutineObject moveRoutine; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { moveRoutine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CoroutineObject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, MoveRoutine); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; moveRoutine.Start(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; moveRoutine.Stop(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><p>  Tudo o que resta √© a pr√≥pria rotina e algumas linhas de c√≥digo para trabalhar com ela.  Significativamente melhor. </p><br><p>  Suponha que uma nova tarefa tenha chegado - voc√™ precisa adicionar a capacidade de executar qualquer c√≥digo depois que o objeto atingir seu objetivo. </p><br><p>  Na vers√£o original, ter√≠amos que adicionar um par√¢metro delegado adicional a cada rotina que pode ser puxada ap√≥s sua conclus√£o. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">System.Action callback</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span> callback?.Invoke(); }</code> </pre> <br><p>  E ligue da seguinte maneira: </p><br><pre> <code class="cs hljs">moveRoutine = StartCoroutine(moveRoutine(CallbackHandler)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallbackHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// do something }</span></span></code> </pre> <br><p>  E se houver algum lambda como manipulador, ele parecer√° ainda pior. </p><br><p>  Com o nosso wrapper, basta adicionar este evento a ele apenas uma vez. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action Finish;</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Finish?.Invoke(); }</code> </pre> <br><p>  E ent√£o, se necess√°rio, assine. </p><br><pre> <code class="cs hljs">moveRoutine.Finished += OnFinish; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnFinish</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// do something }</span></span></code> </pre> <br><p>  Acredito que voc√™ j√° tenha notado que a vers√£o atual do wrapper oferece a capacidade de trabalhar apenas com corotinas sem par√¢metros.  Portanto, podemos escrever um wrapper generalizado para a corotina com um par√¢metro.  O resto √© feito por analogia. </p><br><p>  Mas, para o bem, seria bom primeiro colocar o c√≥digo, que ser√° o mesmo para todos os wrappers, em alguma classe base, para n√£o escrever a mesma coisa.  Estamos lutando contra isso. </p><br><p>  N√≥s o removemos: </p><br><ul><li>  <code>Owner</code> propriedades, <code>IsProcessing</code> , <code>IsProcessing</code> </li><li>  Evento <code>Finished</code> </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Action = System.Action; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObjectBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Owner { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Coroutine Coroutine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsProcessing =&gt; Coroutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action Finished; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Inv√≥lucro sem par√¢metros ap√≥s refatora√ß√£o</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObject</span></span> : <span class="hljs-title"><span class="hljs-title">CoroutineObjectBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func&lt;IEnumerator&gt; Routine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action Finished; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CoroutineObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour owner, Func&lt;IEnumerator&gt; routine</span></span></span><span class="hljs-function">)</span></span> { Owner = owner; Routine = routine; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Finished?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Stop(); Coroutine = Owner.StartCoroutine(Process()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(IsProcessing) { Owner.StopCoroutine(Coroutine); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> </div></div><br><p>  E agora, de fato, um inv√≥lucro para corotina com um par√¢metro: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObject</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">CoroutineObjectBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func&lt;T, IEnumerator&gt; Routine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action Finished; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CoroutineObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour owner, Func&lt;T, IEnumerator&gt; routine</span></span></span><span class="hljs-function">)</span></span> { Owner = owner; Routine = routine; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T arg</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(arg); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Finished?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T arg</span></span></span><span class="hljs-function">)</span></span> { Stop(); Coroutine = Owner.StartCoroutine(Process(arg)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(IsProcessing) { Owner.StopCoroutine(Coroutine); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><p>  Como voc√™ pode ver, o c√≥digo √© quase o mesmo.  Somente em alguns lugares foram adicionados fragmentos, dependendo do n√∫mero de argumentos. </p><br><p>  Suponha que nos pedissem para atualizar o componente MoveToPoint para que o ponto pudesse ser definido n√£o pela janela do <code>Inspector</code> no editor, mas por c√≥digo quando o m√©todo <code>Move</code> foi chamado. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CoroutineObject&lt;Vector3&gt; moveRoutine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsMoving =&gt; moveRoutine.IsProcessing; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { moveRoutine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CoroutineObject&lt;Vector3&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, MoveRoutine); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 target</span></span></span><span class="hljs-function">)</span></span> =&gt; moveRoutine.Start(target); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; moveRoutine.Stop(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 target</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.localPosition = Vector3.Lerp(transform.position, target, speed); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><p>  H√° muitas op√ß√µes para expandir a funcionalidade desse wrapper, tanto quanto poss√≠vel: adicione uma inicializa√ß√£o atrasada, eventos com par√¢metros, poss√≠vel rastreamento do progresso da corotina e muito mais.  Mas sugiro parar nesta fase. </p><br><p>  O objetivo deste artigo √© o desejo de compartilhar os problemas prementes que encontrei e propor uma solu√ß√£o para eles, e n√£o cobrir as poss√≠veis necessidades de todos os desenvolvedores. </p><br><p>  Espero que iniciantes e camaradas experientes se beneficiem da minha experi√™ncia.  Talvez eles compartilhem seus coment√°rios ou apontem os erros que eu poderia ter cometido. </p><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt442622/">https://habr.com/ru/post/pt442622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt442612/index.html">Motor de papel√£o para um jogo de tabuleiro el√©trico. Como a aproximamos da realidade</a></li>
<li><a href="../pt442614/index.html">CI / CD usando Jenkins no Kubernetes</a></li>
<li><a href="../pt442616/index.html">Aceleramos o processamento de eventos para 1,6 milh√µes por segundo</a></li>
<li><a href="../pt442618/index.html">N√£o para selfie: ensaio imunossorvente digital ligado a enzima usando um novo chip incorporado em um smartphone</a></li>
<li><a href="../pt442620/index.html">Aprendizado de m√°quina no monitoramento de TI</a></li>
<li><a href="../pt442624/index.html">O livro ‚ÄúAlgoritmo Perfeito. O b√°sico</a></li>
<li><a href="../pt442626/index.html">Habraiting: construindo uma nuvem de palavras que falam russo no exemplo dos cabe√ßalhos Habra</a></li>
<li><a href="../pt442630/index.html">Durabilidade da l√¢mpada LED e emiss√£o de luz reduzida</a></li>
<li><a href="../pt442632/index.html">Energia geot√©rmica: como o calor da Terra se transformou em um recurso energ√©tico eficiente</a></li>
<li><a href="../pt442636/index.html">Voc√™ traz m√°s not√≠cias para a ger√™ncia?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>