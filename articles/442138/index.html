<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçü§ù‚Äçüë®üèæ ü•´ ü§ú Objeto compuesto "fuente de datos" y elementos de un enfoque funcional üí™ üë®üèø ü§πüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Una vez, (bueno, ni siquiera yo) enfrent√© la tarea de agregar una celda de un tipo completamente diferente al UICollectionView con un cierto tipo de c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Objeto compuesto "fuente de datos" y elementos de un enfoque funcional</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442138/"> Una vez, (bueno, ni siquiera yo) enfrent√© la tarea de agregar una celda de un tipo completamente diferente al <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UICollectionView</a></code> con un cierto tipo de celdas, y hacer esto solo en un caso especial, que se procesa "arriba" y no depende directamente de <code>UICollectionView</code> .  Esta tarea dio lugar, si mi memoria me sirve, a un par de feos bloques <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>if</code> - <code>else</code></a> dentro de los <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UICollectionViewDelegate</a></code> <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UICollectionViewDataSource</a></code> y <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UICollectionViewDelegate</a></code> , que se instalaron de forma segura en el c√≥digo de "producci√≥n" y, probablemente, no ir√°n a ning√∫n lado desde all√≠. <br><br>  En el marco de la tarea antes mencionada, no ten√≠a sentido pensar en una soluci√≥n m√°s elegante, o gastar energ√≠a "reflexiva" en esto.  Sin embargo, record√© esta historia: pens√© en tratar de implementar un cierto objeto "fuente de datos", que podr√≠a estar compuesto de cualquier n√∫mero de otros objetos "fuente de datos" en un solo conjunto.  La soluci√≥n, obviamente, debe ser generalizada, adecuada para cualquier n√∫mero de componentes (incluidos cero y uno) y no depender de tipos espec√≠ficos.  Result√≥ que esto no solo es real, sino que tampoco es demasiado dif√≠cil (aunque hacer que el c√≥digo tambi√©n sea "hermoso" es un poco m√°s dif√≠cil). <a name="habracut"></a><br><br>  <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UITableView</a></code> lo que hice con el ejemplo <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UITableView</a></code> .  Si lo desea, escribir un c√≥digo similar para <code>UICollectionView</code> no deber√≠a ser dif√≠cil. <br><br><h2>  "Una idea siempre es m√°s importante que su encarnaci√≥n" </h2><br>  <i>Este aforismo pertenece al gran autor de c√≥mics <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Alan Moore</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Keepers"</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"V significa Vendetta</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"League of Outstanding Gentlemen"</a> ), pero no se trata realmente de programaci√≥n, ¬øverdad?</i> <br><br>  La idea principal de mi enfoque es almacenar una matriz de objetos <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UITableViewDataSource</a></code> , devolver su n√∫mero total de secciones y poder determinar al acceder a la secci√≥n cu√°l de los objetos originales "fuente de datos" redirigir√° esta llamada. <br><br>  El protocolo <code>UITableViewDataSource</code> ya tiene los m√©todos necesarios para obtener el n√∫mero de secciones, filas, etc., pero, desafortunadamente, en este caso me pareci√≥ extremadamente inconveniente usarlo debido a la necesidad de pasar una referencia a una instancia espec√≠fica de <code>UITableView</code> como uno de los argumentos.  Por lo tanto, decid√≠ extender el protocolo est√°ndar <code>UITableViewDataSource</code> con un par de miembros simples adicionales: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ComposableTableViewDataSource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDataSource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> numberOfSections: <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numberOfRows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> }</code> </pre><br>  Y el "origen de datos" compuesto result√≥ ser una clase simple que implementa los requisitos de <code>UITableViewDataSource</code> y se inicializa con un solo argumento: un conjunto de instancias espec√≠ficas de <code>ComposableTableViewDataSource</code> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ComposedTableViewDataSource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDataSource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataSources: [<span class="hljs-type"><span class="hljs-type">ComposableTableViewDataSource</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(dataSources: <span class="hljs-type"><span class="hljs-type">ComposableTableViewDataSource</span></span>...) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.dataSources = dataSources <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"\(#file) \(#line): Initializer with parameters must be used."</span></span>) } }</code> </pre><br>  Ahora solo queda escribir las implementaciones de todos los m√©todos del protocolo <code>UITableViewDataSource</code> para que se refieran a los m√©todos de los componentes correspondientes. <br><br><h2>  ‚ÄúFue la decisi√≥n correcta.  Mi decision </h2><br>  <i>Estas palabras pertenecieron a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Boris Nikolayevich Yeltsin</a> , el primer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">presidente de la</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Federaci√≥n de Rusia</a> , y en realidad no se refieren al texto a continuaci√≥n, simplemente me gustaron.</i> <br><br>  La decisi√≥n correcta me pareci√≥ utilizar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">funcionalidad</a> del lenguaje <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Swift</a> , y realmente result√≥ ser conveniente. <br><br>  Primero, implementamos un m√©todo que devuelve el n√∫mero de secciones; esto no es dif√≠cil.  Como se mencion√≥ anteriormente, solo necesitamos el n√∫mero total de todas las secciones de los componentes: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numberOfSections</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Default value if not implemented is "1". return dataSources.reduce(0) { $0 + ($1.numberOfSections?(in: tableView) ?? 1) } }</span></span></code> </pre><br>  (No explicar√© la sintaxis y el significado de las funciones est√°ndar. Si es necesario, Internet est√° lleno de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">buenos</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culos</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">introductorios</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sobre el tema</a> . Y tambi√©n puedo recomendar un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">libro bastante bueno</a> ). <br><br>  Un vistazo r√°pido a todos los m√©todos de <code>UITableViewDataSource</code> , notar√° que como argumentos solo aceptan un enlace a la tabla y el valor del n√∫mero de secci√≥n o la fila correspondiente de <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IndexPath</a></code> .  Escribiremos algunos ayudantes que nos ser√°n √∫tiles para implementar todos los dem√°s m√©todos de protocolo. <br><br>  Primero, todas las tareas pueden reducirse a una funci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"gen√©rica"</a> , que toma como argumentos una referencia a un <code>ComposableTableViewDataSource</code> espec√≠fico y el valor del n√∫mero de secci√≥n o <code>IndexPath</code> .  Por conveniencia y brevedad, asignaremos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">alias a los</a> tipos de estas funciones.  Adem√°s, para mayor legibilidad, sugiero declarar un alias para el n√∫mero de secci√≥n: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">SectionNumber</span></span> = <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">AdducedSectionTask</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt; = (<span class="hljs-number"><span class="hljs-number">_</span></span> composableDataSource: <span class="hljs-type"><span class="hljs-type">ComposableTableViewDataSource</span></span>, <span class="hljs-number"><span class="hljs-number">_</span></span> sectionNumber: <span class="hljs-type"><span class="hljs-type">SectionNumber</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">AdducedIndexPathTask</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt; = (<span class="hljs-number"><span class="hljs-number">_</span></span> composableDataSource: <span class="hljs-type"><span class="hljs-type">ComposableTableViewDataSource</span></span>, <span class="hljs-number"><span class="hljs-number">_</span></span> indexPath: <span class="hljs-type"><span class="hljs-type">IndexPath</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span></code> </pre><br>  (Explicar√© los nombres seleccionados justo debajo). <br><br>  En segundo lugar, implementamos una funci√≥n simple que determina el <code>ComposableTableViewDataSource</code> espec√≠fico y el n√∫mero de secci√≥n correspondiente por el n√∫mero de secci√≥n <code>ComposedTableViewDataSource</code> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decompose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(section: SectionNumber)</span></span></span></span> -&gt; (dataSource: <span class="hljs-type"><span class="hljs-type">ComposableTableViewDataSource</span></span>, decomposedSection: <span class="hljs-type"><span class="hljs-type">SectionNumber</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> section = section <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataSourceIndex = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (index, dataSource) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataSources.enumerated() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> diff = section - dataSource.numberOfSections dataSourceIndex = index <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> diff &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { section = diff } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (dataSources[dataSourceIndex], section) }</code> </pre><br>  Quiz√°s, si piensa un poco m√°s que la m√≠a, la implementaci√≥n resultar√° m√°s elegante y menos sencilla.  Por ejemplo, los colegas inmediatamente sugirieron que implemente una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">b√∫squeda binaria</a> en esta funci√≥n (anteriormente, por ejemplo, durante la inicializaci√≥n, componiendo el √≠ndice del n√∫mero de secciones, una simple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">matriz</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enteros</a> ).  O incluso pase un poco de tiempo compilando y almacenando la tabla de correspondencia de los n√∫meros de secci√≥n, pero luego, en lugar de utilizar el m√©todo con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complejidad temporal de</a> O (n) u O (log n), puede obtener el resultado al costo de O (1).  Pero decid√≠ seguir el consejo del gran <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Donald Knuth de</a> no participar en la optimizaci√≥n prematura sin necesidad aparente y medidas apropiadas.  S√≠, y no sobre este art√≠culo. <br><br>  Y finalmente, las funciones que aceptan <code>AdducedSectionTask</code> y <code>AdducedIndexPathTask</code> indicadas anteriormente y las "redirigen" a instancias espec√≠ficas de <code>ComposedTableViewDataSource</code> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adduce</span></span></span><span class="hljs-function">&lt;T&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> section: SectionNumber, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> task: AdducedSectionTask&lt;T&gt;)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (dataSource, decomposedSection) = decompose(section: section) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task(dataSource, decomposedSection) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adduce</span></span></span><span class="hljs-function">&lt;T&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> indexPath: IndexPath, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> task: AdducedIndexPathTask&lt;T&gt;)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (dataSource, decomposedSection) = decompose(section: indexPath.section) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task(dataSource, <span class="hljs-type"><span class="hljs-type">IndexPath</span></span>(row: indexPath.row, section: decomposedSection)) }</code> </pre><br>  Y ahora puedes explicar los nombres que he elegido para todas estas funciones.  Es simple: reflejan un estilo funcional de nombres.  Es decir  significa literalmente poco, pero suena impresionante. <br><br>  Las √∫ltimas dos funciones parecen casi gemelas, pero despu√©s de pensar un poco, dej√© de tratar de deshacerme de la duplicaci√≥n de c√≥digo, porque tra√≠a m√°s inconvenientes que ventajas: ten√≠a que generar o transferir las funciones de conversi√≥n al n√∫mero de secci√≥n y volver al tipo original.  Adem√°s, la probabilidad de reutilizar este enfoque generalizado tiende a cero. <br><br>  Todos estos preparativos y ayudantes brindan una ventaja incre√≠ble en la implementaci√≥n, de hecho, de los m√©todos de protocolo.  M√©todos de configuraci√≥n de tabla: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, titleForHeaderInSection section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">String?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adduce(section) { $<span class="hljs-number"><span class="hljs-number">0</span></span>.tableView?(tableView, titleForHeaderInSection: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, titleForFooterInSection section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">String?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adduce(section) { $<span class="hljs-number"><span class="hljs-number">0</span></span>.tableView?(tableView, titleForFooterInSection: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, numberOfRowsInSection section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adduce(section) { $<span class="hljs-number"><span class="hljs-number">0</span></span>.tableView(tableView, numberOfRowsInSection: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adduce(indexPath) { $<span class="hljs-number"><span class="hljs-number">0</span></span>.tableView(tableView, cellForRowAt: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre><br>  Insertar y eliminar filas: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, commit editingStyle: UITableViewCell.EditingStyle, forRowAt indexPath: IndexPath)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adduce(indexPath) { $<span class="hljs-number"><span class="hljs-number">0</span></span>.tableView?(tableView, commit: editingStyle, forRowAt: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, canEditRowAt indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Default if not implemented is "true". return adduce(indexPath) { $0.tableView?(tableView, canEditRowAt: $1) ?? true } }</span></span></code> </pre><br>  De manera similar, se puede implementar el soporte para encabezados de √≠ndice de secci√≥n.  En este caso, en lugar del n√∫mero de secci√≥n, debe operar con el √≠ndice del encabezado.  Adem√°s, lo m√°s probable es que sea √∫til para esto agregar un campo adicional al protocolo <code>ComposableTableViewDataSource</code> .  Dej√© esta pieza fuera del material. <br><br><h2>  "Lo imposible hoy ser√° posible ma√±ana" </h2><br>  <i>Estas son las palabras del cient√≠fico ruso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Konstantin Eduardovich Tsiolkovsky</a> , el fundador de la cosmonautica te√≥rica.</i> <br><br>  En primer lugar, la soluci√≥n presentada no admite arrastrar y soltar filas.  El plan original inclu√≠a soporte para arrastrar y soltar dentro de uno de los objetos "fuente de datos" constituyentes, pero, desafortunadamente, esto no se puede lograr usando solo <code>UITableViewDataSource</code> .  Los m√©todos de este protocolo determinan si es posible "arrastrar y soltar" una l√≠nea en particular y recibir una "devoluci√≥n de llamada" al final del arrastre.  Y el procesamiento del evento en s√≠ est√° impl√≠cito en los m√©todos <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UITableViewDelegate</a></code> . <br><br>  En segundo lugar, y lo que es m√°s importante, es necesario pensar en los mecanismos para actualizar los datos en la pantalla.  Creo que esto se puede implementar declarando el protocolo del delegado <code>ComposableTableViewDataSource</code> , cuyos m√©todos ser√°n implementados por <code>ComposedTableViewDataSource</code> y recibir una se√±al de que el "origen de datos" original ha recibido una actualizaci√≥n.  Quedan abiertas dos preguntas: c√≥mo determinar de manera confiable qu√© <code>ComposableTableViewDataSource</code> ha cambiado dentro de <code>ComposedTableViewDataSource</code> y c√≥mo es una tarea separada y no la m√°s trivial, pero tener una serie de soluciones (por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tales</a> ).  Y, por supuesto, necesitar√° el <code>ComposedTableViewDataSource</code> delegado <code>ComposedTableViewDataSource</code> , cuyos m√©todos se invocar√°n al actualizar el "origen de datos" compuesto e implementado por el tipo de cliente (por ejemplo, un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">controlador</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">modelo de vista</a> ). <br><br>  Espero investigar mejor estos problemas con el tiempo y cubrirlos en la segunda parte del art√≠culo.  Mientras tanto, me divierte, ¬°ten√≠as curiosidad por leer sobre estos experimentos! <br><br><h2>  PS </h2><br>  Justo el otro d√≠a, tuve que ingresar al c√≥digo mencionado en la introducci√≥n para su modificaci√≥n: necesitaba intercambiar las celdas de esos dos tipos.  Brevemente, tuve que atormentarme y "profanar" constantemente apareciendo en diferentes lugares. <code>Index out of bounds</code> .  Cuando se utiliza el enfoque descrito, solo ser√≠a necesario intercambiar dos objetos de "fuente de datos" en la matriz que se pasa como argumento inicializador. <br><br>  <b>Referencias</b> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Playgroud con c√≥digo completo y ejemplo</a> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mi twitter</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442138/">https://habr.com/ru/post/442138/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442128/index.html">Vida en part√≠culas</a></li>
<li><a href="../442130/index.html">Pruebas de 3CX v16 en Raspberry Pi 3B + y actualizaci√≥n de WebMeeting</a></li>
<li><a href="../442132/index.html">Comience con Azure Machine Learning con Python SDK</a></li>
<li><a href="../442134/index.html">128 c√°lculos de personajes: ganadores del concurso Wolfram Single-Line</a></li>
<li><a href="../442136/index.html">Un pron√≥stico de un d√≠a y medio de energ√≠a e√≥lica ayudar√° a optimizar la potencia de salida de los generadores e√≥licos.</a></li>
<li><a href="../442140/index.html">C√≥mo deshabilitar la protecci√≥n Spectre: se ha agregado un nuevo par√°metro al kernel de Linux</a></li>
<li><a href="../442142/index.html">Roskomnadzor bloque√≥ accidentalmente los talones de los proveedores</a></li>
<li><a href="../442144/index.html">GitLab 11.8 lanzado con soporte de JavaScript en SAST, subgrupos en p√°ginas y seguimiento de errores</a></li>
<li><a href="../442146/index.html">Tel√©fono Energizer: 18,000 mAh de energ√≠a limpia</a></li>
<li><a href="../442148/index.html">C√≥digo VS: fragmentos de titiriteros</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>