<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéá üë©üèΩ‚Äçüè´ üêÇ Gestengesteuerte Lampe auf Arduino üßï ‚ñ∂Ô∏è üíáüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits !!! 
 Ich bin froh, dass ich Ihnen wieder mein neues Handwerk zeigen kann. 
 Diesmal habe ich eine gestengesteuerte Arduino-Lampe zus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gestengesteuerte Lampe auf Arduino</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484278/"><img src="https://habrastorage.org/webt/d4/ag/wq/d4agwqmzn7bi_rgmhdau05bcc8c.jpeg" alt="Bild"><br><br>  Hallo allerseits !!! <br>  Ich bin froh, dass ich Ihnen wieder mein neues Handwerk zeigen kann. <br>  Diesmal habe ich eine gestengesteuerte Arduino-Lampe zusammengestellt. <br><br>  Dieses Projekt hat mich viel Zeit gekostet, was mir immer fehlt. <br>  Ich habe die erste Version der Lampe sehr schnell zusammengebaut und sie funktionierte perfekt f√ºr mich auf dem Steckbrett, aber als ich sie an einen festen Platz im Geh√§use verlegte, fing alles an, und alle Probleme mit Einfrierungen, Fehlalarmen und anderen Problemen traten auf.  Beim Googeln im Internet habe ich auf ausl√§ndischen Websites viele Beschwerden im Zusammenhang mit den Problemen des APDS9960-Sensors gefunden, aber keine L√∂sungen f√ºr diese Probleme gefunden.  Ich musste ein wenig Zeit damit verbringen, das Datenblatt dieses Sensors zu studieren und seine Funktionsweise zu verstehen.  Am Ende hat es sich ausgezahlt und ich konnte stabil funktionierenden Code schreiben. <br><br>  Also alles in Ordnung. <br><a name="habracut"></a><br><h4>  Beschreibung der Lampe </h4><br>  Das Hauptaugenmerk dieser Lampe lag nicht auf der Visualisierung, sondern auf der Gestensteuerung, alle anderen Funktionen sind zweitrangig. <br><br>  Die Lampe schaltet sich mit Gesten nach links oder rechts ein, und Sie k√∂nnen sie auch mit einer Geste gegen sich selbst einschalten, was jedoch nicht ganz praktisch ist.  Als n√§chstes k√∂nnen Sie mit den Gesten nach links und rechts durch die Lichteffekte scrollen.  Wenn Sie nach rechts spiegeln, √§ndert die Lampe zun√§chst ihre Farben von Wei√ü nach Rot, einschlie√ülich aller Prim√§rfarben und der √úberg√§nge zwischen ihnen. <br><br>  Wenn wir nach dem Einschalten der Lampe nach links drehen, sehen wir dynamische Lichteffekte wie ‚ÄûFeuer‚Äú, ‚ÄûMatrix‚Äú, ‚ÄûLavalampe‚Äú, ‚ÄûRegenbogen‚Äú, ‚ÄûKonfetti‚Äú, ‚ÄûFunken‚Äú und ‚ÄûFeurige Lampe‚Äú.  Wenn Sie zu einer normalen Lampe zur√ºckkehren m√ºssen, k√∂nnen Sie die Lampe mit einer Geste von Ihnen ausschalten und eine der drei Gesten einschalten, anstatt sie umzudrehen. <br>  Das Ausschalten erfolgt durch eine Geste von Ihnen. <br><br><img src="https://habrastorage.org/webt/zr/zi/4m/zrzi4maxu4cyqtt9qfh7hzgqu1q.gif"><br><br>  Die Helligkeit wird durch die Geste reguliert, sich dem Sensor zu n√§hern und sich von ihm weg zu bewegen.  Zuerst m√ºssen Sie Ihre Handfl√§che so nah wie m√∂glich an den Sensor heranf√ºhren und ihn dann scharf anheben.  Die Lampe wechselt in den Helligkeitseinstellungsmodus und bewegt die Handfl√§che n√§her und n√§her. Sie m√ºssen die entsprechende Helligkeit finden und Ihre Hand f√ºr ein paar Sekunden sperren, damit der Helligkeitswert erhalten bleibt.  Wenn die Helligkeit beibehalten wird, informiert Sie die Lampe dar√ºber, indem sie das Licht sanft ausschaltet und es dann mit einer neuen Helligkeitsstufe einschaltet. <br><br>  Ich habe nicht viel auf visuelle Effekte geachtet, da ich vorhabe, eine zweite Version der Lampe auf dem Wemos D1 Mini-Controller herzustellen.  In dem ich vorhabe, alles zum Ideal zu bringen.  Aus dem gleichen Grund verwende ich immer noch nur eine LED-Reihe, die aus vier statt vier ws2812b-Streifen besteht. <br><br><h4>  APDS9960-Interrupts </h4><br>  Tats√§chlich sind die Hauptprobleme der LED-Lampe damit verbunden.  Unterbrechungen in apds9960 f√ºhren ein eigenes Leben. Sie k√∂nnen von allem, zum Beispiel von EM-St√∂rungen oder von der N√§he des Sensors einer Person, von St√∂rungen in der Ern√§hrung und m√∂glicherweise von etwas anderem herr√ºhren. <br><br><img src="https://habrastorage.org/webt/vn/iz/or/vnizoragveyxcjqiw3oq74y8dom.jpeg"><br><br>  Zuerst habe ich versucht, das Problem mit √Ñnderungen in der Hardware zu beheben.  Die Leistungsfilterung hat nicht geholfen, auch mit einem 18650-Akku hat der Sensor seine Lebensdauer beibehalten.  Ich habe versucht, den Lastwiderstand des INT-Signals auf + 5V zu schalten, was ebenfalls keinen Erfolg brachte. <br><br>  Als die Studie kam, wurde klar, warum es zu falschen Unterbrechungen kam.  Das Hauptproblem sind zuf√§llige Reflexionen des IR-Signals.  Der Hersteller empfiehlt, den Sensor und alles drum herum mit einer schwarzen Gummibeschichtung abzudecken.  Ich habe keine solche Farbe und ich habe mich nicht darum gek√ºmmert.  Dies kann jedoch die Anzahl der Fehlalarme leicht verringern. <br><br>  Ich habe Code geschrieben, der alle zuf√§lligen Trigger herausfiltert, aber auf ein anderes Problem gesto√üen ist.  Nachdem der Interrupt ausgel√∂st wurde, werden die Gesteninformationen nicht sofort, sondern mit einer gewissen Verz√∂gerung √ºber den I2C-Bus √ºbertragen.  Und wenn die Stromversorgung aufgrund des Adress-LED-Streifens verrauscht ist, ist die √úbertragungszeit unter Ber√ºcksichtigung dieser St√∂rungen immer unterschiedlich.  Ich musste diese Tatsache ber√ºcksichtigen und den Code f√ºr die Bestimmung von Gesten neu schreiben. <br><br><h4>  Gestendefinition </h4><br>  Wenn der Code keinen Interrupt vom Sensor verwendet, gibt es keine Probleme mit der Definition der Geste.  In diesem Fall geht jedoch Multitasking verloren.  Wenn ein dynamischer Effekt f√ºr die Lampe aktiviert ist, ist dementsprechend ein zyklischer, st√§ndig ausf√ºhrbarer Code erforderlich, und es sind Interrupts erforderlich, um die Steuerung aus dem Zyklus zu entfernen. <br><br>  Um die Stabilit√§t der Gestenerkennung zu verbessern, musste auch die Empfindlichkeit des Empf√§ngers in der Bibliothek reduziert werden.  Ersetzen Sie dazu die Zeile in der Datei SparkFun_APDS9960.h: <br><br>  <i>if (! setLEDBoost (LED_BOOST_300))</i> <br>  auf <br>  <i>if (! setLEDBoost (LED_BOOST_150))</i> <br><br>  Wenn Sie die Bibliothek aus diesem Artikel heruntergeladen haben, m√ºssen Sie nichts weiter tun, da bereits alles repariert wurde. <br>  Ich habe auch experimentell den Strom der 50-mA-LED ausgew√§hlt, wobei die Gesten am stabilsten bestimmt werden und es nicht erforderlich ist, eine Infrarot-LED mit einem Strom von 100 mA zu erzwingen. <br><br>  Au√üerdem habe ich einen Fehler gemacht, indem ich den Mikrocontroller unten an der Lampe und den Gesten-Sensor oben in der Abdeckung platziert habe.  Aus diesem Grund musste ich 30 cm lange Dr√§hte verwenden, um arduino und apds9960 zu verbinden, was auch zu einer zus√§tzlichen Instabilit√§t des Sensors f√ºhrte.  Infolgedessen habe ich all diese Probleme programmatisch besiegt. <br><br><h4>  Schema </h4><br><img src="https://habrastorage.org/webt/xe/uu/bi/xeuubilb8sr-rjoyuzi_swhliua.jpeg"><br><br>  Um das Ger√§t mit Strom zu versorgen, verwende ich ein Ladeger√§t von meinem Smartphone mit einer Ausgangsspannung von 5 V und einem Strom von 2A.  Tats√§chlich verbraucht eine Lampe mit wei√üem Licht, das bei maximaler Helligkeit eingeschaltet wird, nicht mehr als 1,3 A. Daher ist jede Stromquelle mit einem Ausgangsstrom von mindestens 1,3 A geeignet. <br><br>  Der Stabilisator dc-dc mini360 kann durch jeden anderen Abw√§rtsspannungswandler mit einem Ausgangsstrom von mindestens 150 mA ersetzt werden. <br><br>  In der folgenden Abbildung verwende ich keinen Logikpegelkonverter. Dies ist jedoch meine pers√∂nliche Entscheidung.  Und deshalb √ºbernehme ich im Voraus keine Verantwortung f√ºr den Fall, dass bei einem Ausfall der APDS9960-Sensor ohne TTL-Pegelwandler angeschlossen wird. <br><br>  Anstelle von Arduino Nano k√∂nnen Sie den Arduino UNO-Controller oder dessen Klone verwenden. <br><br>  Vergewissern Sie sich, dass die Jumper auf dem Gesten-Sensor vorhanden sind. Sie sind auf dem Foto unten rot markiert.  In Abwesenheitsf√§llen sollte auf diese Kontaktbahnen ein L√∂tkolben aufgebracht, das Lot aufgetragen und erw√§rmt werden, bis sich ein gleichm√§√üiger Tropfen bildet.  Jetzt liefern die Chinesen diese Sensoren ohne Jumper.  Ohne diese Jumper kann die Funktion des Sensors nicht garantiert werden. <br><br><img src="https://habrastorage.org/webt/kj/u0/dm/kju0dmvpbqiuuif-hetiy5hb0f8.jpeg"><br><br><h4>  Verwendete Komponenten </h4><br>  Arduino Nano - 1 St√ºck <br>  Gesten-Sensor APDS9960 - 1 Stck. <br>  LED Streifen ws2812b - 4 Stck. <br>  Mini360 Tiefsetzsteller - 1 Stck. <br>  Verbindungskabel - 1 Satz. <br><br><h4>  Programmcode f√ºr Arduino </h4><br>  Der Code ist in zwei Teile unterteilt.  Im ersten Teil befindet sich der Hauptcode, der mit dem Sensor zusammenarbeitet, und im zweiten Teil der Code f√ºr alle Lichteffekte. <br><br>  Sie k√∂nnen jeden Effekt in Analogie zu meinem Code selbst hinzuf√ºgen, aber vergessen Sie vor allem nicht, eine Funktion hinzuzuf√ºgen, um die Geste aus dem Schleifeneffekt zu entfernen.  <i>F√ºgen</i> Sie dazu die folgende Zeile am Ende der Schleife hinzu, <i>wenn (check_int ()) return;</i> <br><br>  Beschreibung der Hauptfunktionen des Programms <br>  processingGesture () verarbeitet Interrupts vom Gestensensor. <br>  processingProximity () verarbeitet Interrupts vom N√§herungssensor. <br>  gesture_int () - Interrupt-Handler vom Gesten-Sensor. <br>  proximity_int () - Interrupt-Handler vom N√§herungssensor. <br><br><h4>  Beschreibung der Konstanten </h4><br>  APDS9960_INT - Eingang f√ºr einen externen Interrupt.  Arduino Nano und UNO haben nur zwei solche Eing√§nge, 2 und 3. <br><br>  PIN - hier m√ºssen Sie die Ausgabe f√ºr den LED-Streifen festlegen.  Sie k√∂nnen einen beliebigen digitalen Pin angeben, an den die ws2812b-B√§nder angeschlossen sind. <br><br>  NUM_PIX - hier geben wir die Anzahl der Adress-LEDs im verwendeten Band an. <br>  Bereich - Die Fehlergrenze liegt zwischen 0 und 10. Wenn beim Einstellen der Helligkeit 2 Sekunden lang ein Zeiger √ºber dem Sensor fixiert ist, sollten die Messwerte gespeichert werden. Wenn die Messwerte nicht gespeichert werden, erh√∂hen Sie die Fehlergrenze schrittweise. <br><br>  <a href="" rel="nofollow">Laden Sie die APDS9960-Bibliothek herunter</a> <br>  <a href="" rel="nofollow">Laden Sie die Lampenskizze herunter</a> <br><br><h4>  Video zeigt den Betrieb der Lampe </h4><br><iframe width="560" height="315" src="https://www.youtube.com/embed/C4QELMzOpiA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4>  Zusammenfassung </h4><br>  Die Lampe sieht live besser aus als im Video.  Jetzt wird jeder, der ihn von mir gesehen hat, gebeten, dasselbe f√ºr sie zu sammeln.  Im Moment gef√§llt mir nicht, wie die Helligkeitsanpassung funktioniert, aber ich arbeite daran.  Das verspreche ich nicht, aber die n√§chste Version der Lampe ist bereits in der Entwicklung. <br><br>  Vielen Dank f√ºr das Lesen des Artikels bis zum Ende!  Wenn Sie noch Fragen haben, k√∂nnen Sie in den Kommentaren unter dem Artikel fragen. <br><br><h4>  PS </h4><br>  Lampenidee <a href="https://www.youtube.com/channel/UCOG6Bi2kvpDa1c8gHWZI5CQ/videos" rel="nofollow">hier</a> inspiriert <br>  Ich habe hier die Haupteffekte genommen </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de484278/">https://habr.com/ru/post/de484278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de484250/index.html">Paul Graham: √úber politische Neutralit√§t und Unabh√§ngigkeit des Denkens (Die zwei Arten von Moderaten)</a></li>
<li><a href="../de484254/index.html">Gewusst wie: Infografiken oder Infografiken?</a></li>
<li><a href="../de484270/index.html">Lassen Sie uns etwas Geld l√∂sen</a></li>
<li><a href="../de484274/index.html">Qualcomm ADAS-Chip</a></li>
<li><a href="../de484276/index.html">Ausgabe Nr. 29: IT-Schulungen - Aktuelle Fragen und Herausforderungen f√ºhrender Unternehmen</a></li>
<li><a href="../de484282/index.html">Das mysteri√∂se LyX-Programm. Teil 3</a></li>
<li><a href="../de484284/index.html">[An den Docks] Flattern. Teil 3. F√ºr reaktive Entwickler</a></li>
<li><a href="../de484288/index.html">Wie die Konfrontation mit dem Kalten Krieg den Chinesen hilft, die Computerproduktion zu starten</a></li>
<li><a href="../de484290/index.html">Der Spickzettel, der auf der Yacht ben√∂tigt wird</a></li>
<li><a href="../de484292/index.html">Der gr√∂√üte Physiker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>