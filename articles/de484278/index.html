<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎇 👩🏽‍🏫 🐂 Gestengesteuerte Lampe auf Arduino 🧕 ▶️ 💇🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits !!! 
 Ich bin froh, dass ich Ihnen wieder mein neues Handwerk zeigen kann. 
 Diesmal habe ich eine gestengesteuerte Arduino-Lampe zus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gestengesteuerte Lampe auf Arduino</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484278/"><img src="https://habrastorage.org/webt/d4/ag/wq/d4agwqmzn7bi_rgmhdau05bcc8c.jpeg" alt="Bild"><br><br>  Hallo allerseits !!! <br>  Ich bin froh, dass ich Ihnen wieder mein neues Handwerk zeigen kann. <br>  Diesmal habe ich eine gestengesteuerte Arduino-Lampe zusammengestellt. <br><br>  Dieses Projekt hat mich viel Zeit gekostet, was mir immer fehlt. <br>  Ich habe die erste Version der Lampe sehr schnell zusammengebaut und sie funktionierte perfekt für mich auf dem Steckbrett, aber als ich sie an einen festen Platz im Gehäuse verlegte, fing alles an, und alle Probleme mit Einfrierungen, Fehlalarmen und anderen Problemen traten auf.  Beim Googeln im Internet habe ich auf ausländischen Websites viele Beschwerden im Zusammenhang mit den Problemen des APDS9960-Sensors gefunden, aber keine Lösungen für diese Probleme gefunden.  Ich musste ein wenig Zeit damit verbringen, das Datenblatt dieses Sensors zu studieren und seine Funktionsweise zu verstehen.  Am Ende hat es sich ausgezahlt und ich konnte stabil funktionierenden Code schreiben. <br><br>  Also alles in Ordnung. <br><a name="habracut"></a><br><h4>  Beschreibung der Lampe </h4><br>  Das Hauptaugenmerk dieser Lampe lag nicht auf der Visualisierung, sondern auf der Gestensteuerung, alle anderen Funktionen sind zweitrangig. <br><br>  Die Lampe schaltet sich mit Gesten nach links oder rechts ein, und Sie können sie auch mit einer Geste gegen sich selbst einschalten, was jedoch nicht ganz praktisch ist.  Als nächstes können Sie mit den Gesten nach links und rechts durch die Lichteffekte scrollen.  Wenn Sie nach rechts spiegeln, ändert die Lampe zunächst ihre Farben von Weiß nach Rot, einschließlich aller Primärfarben und der Übergänge zwischen ihnen. <br><br>  Wenn wir nach dem Einschalten der Lampe nach links drehen, sehen wir dynamische Lichteffekte wie „Feuer“, „Matrix“, „Lavalampe“, „Regenbogen“, „Konfetti“, „Funken“ und „Feurige Lampe“.  Wenn Sie zu einer normalen Lampe zurückkehren müssen, können Sie die Lampe mit einer Geste von Ihnen ausschalten und eine der drei Gesten einschalten, anstatt sie umzudrehen. <br>  Das Ausschalten erfolgt durch eine Geste von Ihnen. <br><br><img src="https://habrastorage.org/webt/zr/zi/4m/zrzi4maxu4cyqtt9qfh7hzgqu1q.gif"><br><br>  Die Helligkeit wird durch die Geste reguliert, sich dem Sensor zu nähern und sich von ihm weg zu bewegen.  Zuerst müssen Sie Ihre Handfläche so nah wie möglich an den Sensor heranführen und ihn dann scharf anheben.  Die Lampe wechselt in den Helligkeitseinstellungsmodus und bewegt die Handfläche näher und näher. Sie müssen die entsprechende Helligkeit finden und Ihre Hand für ein paar Sekunden sperren, damit der Helligkeitswert erhalten bleibt.  Wenn die Helligkeit beibehalten wird, informiert Sie die Lampe darüber, indem sie das Licht sanft ausschaltet und es dann mit einer neuen Helligkeitsstufe einschaltet. <br><br>  Ich habe nicht viel auf visuelle Effekte geachtet, da ich vorhabe, eine zweite Version der Lampe auf dem Wemos D1 Mini-Controller herzustellen.  In dem ich vorhabe, alles zum Ideal zu bringen.  Aus dem gleichen Grund verwende ich immer noch nur eine LED-Reihe, die aus vier statt vier ws2812b-Streifen besteht. <br><br><h4>  APDS9960-Interrupts </h4><br>  Tatsächlich sind die Hauptprobleme der LED-Lampe damit verbunden.  Unterbrechungen in apds9960 führen ein eigenes Leben. Sie können von allem, zum Beispiel von EM-Störungen oder von der Nähe des Sensors einer Person, von Störungen in der Ernährung und möglicherweise von etwas anderem herrühren. <br><br><img src="https://habrastorage.org/webt/vn/iz/or/vnizoragveyxcjqiw3oq74y8dom.jpeg"><br><br>  Zuerst habe ich versucht, das Problem mit Änderungen in der Hardware zu beheben.  Die Leistungsfilterung hat nicht geholfen, auch mit einem 18650-Akku hat der Sensor seine Lebensdauer beibehalten.  Ich habe versucht, den Lastwiderstand des INT-Signals auf + 5V zu schalten, was ebenfalls keinen Erfolg brachte. <br><br>  Als die Studie kam, wurde klar, warum es zu falschen Unterbrechungen kam.  Das Hauptproblem sind zufällige Reflexionen des IR-Signals.  Der Hersteller empfiehlt, den Sensor und alles drum herum mit einer schwarzen Gummibeschichtung abzudecken.  Ich habe keine solche Farbe und ich habe mich nicht darum gekümmert.  Dies kann jedoch die Anzahl der Fehlalarme leicht verringern. <br><br>  Ich habe Code geschrieben, der alle zufälligen Trigger herausfiltert, aber auf ein anderes Problem gestoßen ist.  Nachdem der Interrupt ausgelöst wurde, werden die Gesteninformationen nicht sofort, sondern mit einer gewissen Verzögerung über den I2C-Bus übertragen.  Und wenn die Stromversorgung aufgrund des Adress-LED-Streifens verrauscht ist, ist die Übertragungszeit unter Berücksichtigung dieser Störungen immer unterschiedlich.  Ich musste diese Tatsache berücksichtigen und den Code für die Bestimmung von Gesten neu schreiben. <br><br><h4>  Gestendefinition </h4><br>  Wenn der Code keinen Interrupt vom Sensor verwendet, gibt es keine Probleme mit der Definition der Geste.  In diesem Fall geht jedoch Multitasking verloren.  Wenn ein dynamischer Effekt für die Lampe aktiviert ist, ist dementsprechend ein zyklischer, ständig ausführbarer Code erforderlich, und es sind Interrupts erforderlich, um die Steuerung aus dem Zyklus zu entfernen. <br><br>  Um die Stabilität der Gestenerkennung zu verbessern, musste auch die Empfindlichkeit des Empfängers in der Bibliothek reduziert werden.  Ersetzen Sie dazu die Zeile in der Datei SparkFun_APDS9960.h: <br><br>  <i>if (! setLEDBoost (LED_BOOST_300))</i> <br>  auf <br>  <i>if (! setLEDBoost (LED_BOOST_150))</i> <br><br>  Wenn Sie die Bibliothek aus diesem Artikel heruntergeladen haben, müssen Sie nichts weiter tun, da bereits alles repariert wurde. <br>  Ich habe auch experimentell den Strom der 50-mA-LED ausgewählt, wobei die Gesten am stabilsten bestimmt werden und es nicht erforderlich ist, eine Infrarot-LED mit einem Strom von 100 mA zu erzwingen. <br><br>  Außerdem habe ich einen Fehler gemacht, indem ich den Mikrocontroller unten an der Lampe und den Gesten-Sensor oben in der Abdeckung platziert habe.  Aus diesem Grund musste ich 30 cm lange Drähte verwenden, um arduino und apds9960 zu verbinden, was auch zu einer zusätzlichen Instabilität des Sensors führte.  Infolgedessen habe ich all diese Probleme programmatisch besiegt. <br><br><h4>  Schema </h4><br><img src="https://habrastorage.org/webt/xe/uu/bi/xeuubilb8sr-rjoyuzi_swhliua.jpeg"><br><br>  Um das Gerät mit Strom zu versorgen, verwende ich ein Ladegerät von meinem Smartphone mit einer Ausgangsspannung von 5 V und einem Strom von 2A.  Tatsächlich verbraucht eine Lampe mit weißem Licht, das bei maximaler Helligkeit eingeschaltet wird, nicht mehr als 1,3 A. Daher ist jede Stromquelle mit einem Ausgangsstrom von mindestens 1,3 A geeignet. <br><br>  Der Stabilisator dc-dc mini360 kann durch jeden anderen Abwärtsspannungswandler mit einem Ausgangsstrom von mindestens 150 mA ersetzt werden. <br><br>  In der folgenden Abbildung verwende ich keinen Logikpegelkonverter. Dies ist jedoch meine persönliche Entscheidung.  Und deshalb übernehme ich im Voraus keine Verantwortung für den Fall, dass bei einem Ausfall der APDS9960-Sensor ohne TTL-Pegelwandler angeschlossen wird. <br><br>  Anstelle von Arduino Nano können Sie den Arduino UNO-Controller oder dessen Klone verwenden. <br><br>  Vergewissern Sie sich, dass die Jumper auf dem Gesten-Sensor vorhanden sind. Sie sind auf dem Foto unten rot markiert.  In Abwesenheitsfällen sollte auf diese Kontaktbahnen ein Lötkolben aufgebracht, das Lot aufgetragen und erwärmt werden, bis sich ein gleichmäßiger Tropfen bildet.  Jetzt liefern die Chinesen diese Sensoren ohne Jumper.  Ohne diese Jumper kann die Funktion des Sensors nicht garantiert werden. <br><br><img src="https://habrastorage.org/webt/kj/u0/dm/kju0dmvpbqiuuif-hetiy5hb0f8.jpeg"><br><br><h4>  Verwendete Komponenten </h4><br>  Arduino Nano - 1 Stück <br>  Gesten-Sensor APDS9960 - 1 Stck. <br>  LED Streifen ws2812b - 4 Stck. <br>  Mini360 Tiefsetzsteller - 1 Stck. <br>  Verbindungskabel - 1 Satz. <br><br><h4>  Programmcode für Arduino </h4><br>  Der Code ist in zwei Teile unterteilt.  Im ersten Teil befindet sich der Hauptcode, der mit dem Sensor zusammenarbeitet, und im zweiten Teil der Code für alle Lichteffekte. <br><br>  Sie können jeden Effekt in Analogie zu meinem Code selbst hinzufügen, aber vergessen Sie vor allem nicht, eine Funktion hinzuzufügen, um die Geste aus dem Schleifeneffekt zu entfernen.  <i>Fügen</i> Sie dazu die folgende Zeile am Ende der Schleife hinzu, <i>wenn (check_int ()) return;</i> <br><br>  Beschreibung der Hauptfunktionen des Programms <br>  processingGesture () verarbeitet Interrupts vom Gestensensor. <br>  processingProximity () verarbeitet Interrupts vom Näherungssensor. <br>  gesture_int () - Interrupt-Handler vom Gesten-Sensor. <br>  proximity_int () - Interrupt-Handler vom Näherungssensor. <br><br><h4>  Beschreibung der Konstanten </h4><br>  APDS9960_INT - Eingang für einen externen Interrupt.  Arduino Nano und UNO haben nur zwei solche Eingänge, 2 und 3. <br><br>  PIN - hier müssen Sie die Ausgabe für den LED-Streifen festlegen.  Sie können einen beliebigen digitalen Pin angeben, an den die ws2812b-Bänder angeschlossen sind. <br><br>  NUM_PIX - hier geben wir die Anzahl der Adress-LEDs im verwendeten Band an. <br>  Bereich - Die Fehlergrenze liegt zwischen 0 und 10. Wenn beim Einstellen der Helligkeit 2 Sekunden lang ein Zeiger über dem Sensor fixiert ist, sollten die Messwerte gespeichert werden. Wenn die Messwerte nicht gespeichert werden, erhöhen Sie die Fehlergrenze schrittweise. <br><br>  <a href="" rel="nofollow">Laden Sie die APDS9960-Bibliothek herunter</a> <br>  <a href="" rel="nofollow">Laden Sie die Lampenskizze herunter</a> <br><br><h4>  Video zeigt den Betrieb der Lampe </h4><br><iframe width="560" height="315" src="https://www.youtube.com/embed/C4QELMzOpiA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4>  Zusammenfassung </h4><br>  Die Lampe sieht live besser aus als im Video.  Jetzt wird jeder, der ihn von mir gesehen hat, gebeten, dasselbe für sie zu sammeln.  Im Moment gefällt mir nicht, wie die Helligkeitsanpassung funktioniert, aber ich arbeite daran.  Das verspreche ich nicht, aber die nächste Version der Lampe ist bereits in der Entwicklung. <br><br>  Vielen Dank für das Lesen des Artikels bis zum Ende!  Wenn Sie noch Fragen haben, können Sie in den Kommentaren unter dem Artikel fragen. <br><br><h4>  PS </h4><br>  Lampenidee <a href="https://www.youtube.com/channel/UCOG6Bi2kvpDa1c8gHWZI5CQ/videos" rel="nofollow">hier</a> inspiriert <br>  Ich habe hier die Haupteffekte genommen </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de484278/">https://habr.com/ru/post/de484278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de484250/index.html">Paul Graham: Über politische Neutralität und Unabhängigkeit des Denkens (Die zwei Arten von Moderaten)</a></li>
<li><a href="../de484254/index.html">Gewusst wie: Infografiken oder Infografiken?</a></li>
<li><a href="../de484270/index.html">Lassen Sie uns etwas Geld lösen</a></li>
<li><a href="../de484274/index.html">Qualcomm ADAS-Chip</a></li>
<li><a href="../de484276/index.html">Ausgabe Nr. 29: IT-Schulungen - Aktuelle Fragen und Herausforderungen führender Unternehmen</a></li>
<li><a href="../de484282/index.html">Das mysteriöse LyX-Programm. Teil 3</a></li>
<li><a href="../de484284/index.html">[An den Docks] Flattern. Teil 3. Für reaktive Entwickler</a></li>
<li><a href="../de484288/index.html">Wie die Konfrontation mit dem Kalten Krieg den Chinesen hilft, die Computerproduktion zu starten</a></li>
<li><a href="../de484290/index.html">Der Spickzettel, der auf der Yacht benötigt wird</a></li>
<li><a href="../de484292/index.html">Der größte Physiker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>