<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>„äôÔ∏è üôÜ üßí Organisation des Reduzierers durch eine Standardklasse üö¢ üëú üôáüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gr√º√üe, heute werde ich mit Ihnen dar√ºber sprechen, wie Reducer organisiert ist. Und um zu sagen, wo ich angefangen habe und wo ich hingekommen bin. 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Organisation des Reduzierers durch eine Standardklasse</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439730/"><p> Gr√º√üe, heute werde ich mit Ihnen dar√ºber sprechen, wie Reducer organisiert ist.  Und um zu sagen, wo ich angefangen habe und wo ich hingekommen bin. </p><br><p>  Es gibt also einen bestimmten Standard f√ºr die Organisation von Reducer und dieser sieht folgenderma√üen aus: </p><br><pre><code class="plaintext hljs">export default function someReducer(state = initialState, action) { switch (action.type) { case 'SOME_REDUCER_LABEL': return action.data || {}; default: return state; } }</code> </pre> <br><p>  Hier ist alles einfach und klar, aber nachdem ich ein wenig mit solchen Konstruktionen gearbeitet hatte, stellte ich fest, dass diese Methode eine Reihe von Schwierigkeiten hat. </p><br><ul><li>  Tags m√ºssen irgendwie gespeichert werden, da sie sich entlang des Projekts schleichen und weit √ºber die Controller hinauskriechen. </li><li>  Etiketten mussten eindeutig gemacht werden, da es sonst zu einem Schnittpunkt mit anderen Reduzierst√ºcken kommen k√∂nnte </li><li>  Die meiste Zeit bei der Arbeit mit einer solchen Struktur wurde f√ºr die Organisation des Codes aufgewendet, anstatt f√ºr die Verarbeitung eingehender Daten </li><li>  Und wenn der Reduzierer viele Beschriftungen enth√§lt, wird der Code schlampig und schwer zu lesen, und der allgemeine Namespace hat mir nicht offen gefallen. <a name="habracut"></a><br>  Etwa zur gleichen Zeit begannen wir, Sagen zu verwenden, um Nebenwirkungen zu verarbeiten.  Dies erm√∂glichte es uns, die Kommunikation mit der Serverseite ohne R√ºckrufe erheblich zu vereinfachen. </li></ul><br><p>  Jetzt mussten wir der Saga mitteilen, welcher Reduzierer aufgerufen werden musste, nachdem die Nebenwirkung behoben war. </p><br><p>  Die sinnvollste Option, die ich gefunden habe, ist, einen Aktionsersteller zu erstellen. </p><br><p>  Und unser vorheriger Code sah folgenderma√üen aus: </p><br><pre> <code class="plaintext hljs"> import { FetchSaga } from '../../helpers/sagasHelpers'; const SOME_REDUCER_LABEL = 'SOME_REDUCER_LABEL'; export const someReducerLabelActionCreator = FetchSaga.bind(this, SOME_REDUCER_LABEL); export default function someReducer(state = initialState, action) { switch (action.type) { case SOME_REDUCER_LABEL: return action.data || {}; default: return state; } }</code> </pre> <br><p>  FetchSaga ist eine Aktionsgeneratorfunktion (im Folgenden als Aktionsersteller bezeichnet) f√ºr eine Saga, die Daten von einem Server anfordert und an einen Reduzierer sendet, dessen Bezeichnung in der Initialisierungsphase an die Funktion √ºbergeben wurde (SOME_REDUCER_LABEL). </p><br><p>  Jetzt wurden die Etiketten des Reduzierers entweder aus dem Reduzierer exportiert oder der Aktionsersteller wurde aus dem Reduzierer sowohl f√ºr die Saga als auch f√ºr die Standard-Saga exportiert.  Dar√ºber hinaus wurde f√ºr jedes Etikett ein solcher Handler erstellt.  Dies verursachte nur Kopfschmerzen, da ich nach dem √ñffnen des Reduzierers 10 Konstanten der definierenden Beschriftungen gez√§hlt habe, dann ein paar Aufrufe f√ºr verschiedene Aktionsersteller f√ºr Sagen und dann die Statusverarbeitungsfunktion des Reduzierers. Es sah ungef√§hr so ‚Äã‚Äãaus </p><br><pre> <code class="plaintext hljs">import { FetchSaga } from '../../helpers/sagasHelpers'; const SOME_REDUCER_LABEL1 = 'SOME_REDUCER_LABEL1';  .... const SOME_REDUCER_LABEL10 = 'SOME_REDUCER_LABEL10'; export const someReducerLabelActionCreator1 = FetchSaga.bind(this, SOME_REDUCER_LABEL1);   ..... export const someReducerLabelActionCreator10 = FetchSaga.bind(this, SOME_REDUCER_LABEL10); export default function someReducer(state = initialState, action) { switch (action.type) { case SOME_REDUCER_LABEL: return action.data || {}; case SOME_REDUCER_LABEL1: return action.data || {}; case SOME_REDUCER_LABEL2: return action.data || {}; case SOME_REDUCER_LABEL3: return action.data || {}; .... default: return state; } }</code> </pre> <br><p>  Beim Importieren all dieser Aktionen in den Controller wurde diese ebenfalls so stark aufgeblasen.  Und es st√∂rte. </p><br><p>  Nachdem ich mir so viele Reduzierungen angesehen hatte, stellte ich fest, dass wir eine Menge Utility-Code schreiben, der sich nie √§ndert.  Au√üerdem m√ºssen wir sicherstellen, dass wir den geklonten Status an die Komponente senden. </p><br><p>  Dann kam mir die Idee, das Reduzierst√ºck zu standardisieren.  Aufgaben vor ihm waren nicht schwierig. </p><br><ol><li>  √úberpr√ºfen Sie die eingehende Aktion und geben Sie den alten Status zur√ºck, wenn die Aktion nicht f√ºr den aktuellen Reduzierer oder den automatisch geklonten Status gilt, und √ºbergeben Sie sie an die Handler-Methode, die den Status √§ndert und an die Komponente zur√ºckgibt. </li><li>  Sie sollten die Verwendung von Beschriftungen einstellen. Stattdessen sollte der Controller ein Objekt erhalten, das alle Aktionsersteller f√ºr den Reduzierer enth√§lt, an dem wir interessiert sind. <br>  Nachdem ich einen solchen Satz einmal importiert habe, kann ich eine beliebige Anzahl von Aktionserstellern durchlaufen, um Funktionen vom Reduzierer an die Steuerung zu senden, ohne dass ein erneuter Import erforderlich ist </li><li>  Anstatt einen ungeschickten Switch-Case mit einem gemeinsamen Namespace zu verwenden, den der Linter verwendet, m√∂chte ich f√ºr jede Aktion eine separate Methode haben, in die der geklonte Zustand des Reduzierers und die Aktion selbst √ºbertragen werden </li><li>  Es w√§re sch√∂n, einen neuen Reduzierer vom Reduzierer erben zu k√∂nnen.  Falls sich die Logik wiederholt, aber zum Beispiel f√ºr einen anderen Satz von Beschriftungen. </li></ol><br><p>  Die Idee schien mir realisierbar und ich beschloss, sie umzusetzen. </p><br><p>  So sah der durchschnittliche Reduzierer jetzt aus </p><br><pre> <code class="plaintext hljs"> //    ,        reducer' import stdReducerClass from '../../../helpers/reducer_helpers/stdReducer'; class SomeReducer extends stdReducerClass { constructor() { super(); /**   reducer'.   reducer    action,     */ this.prefix = 'SOME_REDUCER__'; } /**   ,     reducer - type - ,    . -        ,     action creator,  SOME_REDUCE__FETCH.   type        action creator  someReduceInstActions - method - ,      action,            - sagas -    ,   ,       .    ,   action creator  ,      SOME_REDUCE__FETCH,  ,   ,      reducer    . */ config = () =&gt; [ { type: 'fetch', method: this.fetch, saga: 'fetch' }, { type: 'update', method: this.update }, ]; //           action creators init = () =&gt; this.subscribeReduceOnActions(this.config()); //  ,      fetch = (clone, action) =&gt; { //       return clone; }; //  ,         update = (clone, action) =&gt; { //       return clone; }; } const someReducerInst = new SomeReducer(); someReducerInst.init(); //   action creators   config //    action creator      export const someReducerInstActions = someReducerInst.getActionCreators(); //    .   checkActionForState    Action  ,      reducer'   export default someReducerInst.checkActionForState;</code> </pre> <br><p>  stdReducerClass von innen ist wie folgt </p><br><pre> <code class="plaintext hljs">import { cloneDeep } from 'lodash'; //    lodash //        ,            import { FetchSaga } from '../helpers/sagasHelpers/actions'; export default class StdReducer { _actions = {}; actionCreators = {}; /** UNIQUE PREFIX BLOCK START */ /**      ,  .   ,   ,    ,  reducer    action       */ uniquePrefix = ''; set prefix(value) { const lowedValue = value ? value.toLowerCase() : ''; this.uniquePrefix = lowedValue; } get prefix() { return this.uniquePrefix; } /** INITIAL STATE BLOCK START */ /**   initialState      reducer'. */ initialStateValues = {}; set initialState(value) { this.initialStateValues = value; } get initialState() { return this.initialStateValues; } /** PUBLIC BLOCK START */ /** *        init() .   ,      Config, action creator   _subscribeAction * actionsConfig -     ,     {type, method, saga?}     ,     action creator          */ subscribeReducerOnActions = actionsConfig =&gt; actionsConfig.forEach(this._subscribeAction); /**      _subscribeAction,    ,        type.  , reducer  ,       action. */ _subscribeAction = (action) =&gt; { const type = action.type.toLowerCase(); this._actions[type] = action.method; //       this.actionCreators[type] = this._subscribeActionCreator(type, action.saga); //   action creator   } /** _subscribeActionCreator -   , action creator          -   saga    ,      -   fetch           ,             type    ,   ,    action creator,  ,     SOME_Reducer__,      FETCH,      SOME_Reducer__FETCH,     action creator */ _subscribeActionCreator = (type, creatorType) =&gt; { const label = (this.prefix + type).toUpperCase(); switch (creatorType) { case 'fetch': return this._getFetchSaga(label); default: return this._getActionCreator(label); } } /** _getFetchSaga -     ,          */ _getFetchSaga = label =&gt; FetchSaga.bind(this, label); /** _getActionCreator -  action creator,      ,   ,    . */ _getActionCreator = label =&gt; (params = {}) =&gt; ({ type: label, ...params }); /**    ,      playload.     action   ,    */ checkActionForState = (state = this.initialState || {}, action) =&gt; { if (!action.type) return state; const type = action.type.toLowerCase(); const prefix = this.prefix;       ,    ,   . const internalType = type.replace(prefix, ''); //        if (this._actions[internalType]) { //     -    const clone = cloneDeep(state); //  ,    ,  action  ,     //        return this._actions[internalType](clone, action); } //   ,   action   .     return state; } /**       action creator,    reducer */ getActionCreators = () =&gt; this.actionCreators; }</code> </pre><br><p>  Wie sieht es im Controller aus?  Und so </p><br><pre> <code class="plaintext hljs">import { someReducerInstActions } from '../../../SomeReducer.js' const mapDispatchToProps = dispatch =&gt; ({ doSoAction: (params) =&gt; dispatch(someReducerInstActions.fetch(url, params)), doSoAction1: (value, block) =&gt; dispatch(someReducerInstActions.update({value, block})), });</code> </pre><br><p>  Also, was haben wir als Ergebnis: </p><br><ol><li>  Tags loswerden </li><li>  habe eine Reihe von Importen in der Steuerung beseitigt </li><li>  Schaltkasten entfernt </li><li>  Sie haben die Sagen einmal geschlagen und jetzt k√∂nnen wir ihr Set an einem Ort erweitern, wobei sichergestellt ist, dass alle Erben automatisch zus√§tzliche Handler f√ºr Nebenwirkungen erhalten </li><li>  Wir hatten die M√∂glichkeit, von Reduzierern zu erben, falls es eine verwandte Logik gibt (im Moment war dies f√ºr mich nie n√ºtzlich =)) </li><li>  Sie haben die Verantwortung f√ºr das Klonen vom Entwickler auf eine Klasse verlagert, die sich definitiv daran erinnern w√ºrde, dies zu tun. </li><li>  weniger Routine beim Erstellen des Reduzierers </li><li>  Jede Methode hat einen isolierten Namespace </li></ol><br><p>  Ich habe versucht, alles so detailliert wie m√∂glich zu beschreiben =) Entschuldigung, wenn verwirrt, ist der Chukchi kein Schriftsteller.  Ich hoffe, dass meine Erfahrung jemandem n√ºtzlich sein wird. </p><br><p>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Das aktuelle Beispiel finden Sie hier</a> </p><br><p>  Danke f√ºrs Lesen! </p><br><p>  UPD: Fehler behoben.  Er schrieb nachts, las es schlecht.  Danke, dass du sie so fein gezeigt hast =) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439730/">https://habr.com/ru/post/de439730/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439720/index.html">Einf√ºhrung in die Programmierung: Ein einfacher 3D-Shooter von Grund auf √ºber das Wochenende, Teil 2</a></li>
<li><a href="../de439722/index.html">Auswirkungen von SVG-Filtern. Teil 2. Gliederungstext mit feMorphology</a></li>
<li><a href="../de439724/index.html">√úberblick √ºber AI & ML-L√∂sungen im Jahr 2018 und Prognosen f√ºr 2019: Teil 2 - Tools und Bibliotheken, AutoML, RL, Ethik in AI</a></li>
<li><a href="../de439726/index.html">Lock-in: wahr oder fiktiv?</a></li>
<li><a href="../de439728/index.html">Konfigurieren Sie die vollst√§ndige und separate Sicherung und Wiederherstellung von Zimbra OSE ohne Verwendung von Zextras</a></li>
<li><a href="../de439732/index.html">Lazarus - einfache Animation mit der TImageFragment-Komponente</a></li>
<li><a href="../de439734/index.html">Bereitstellung von Kubernetes auf dem Desktop in wenigen Minuten mit MicroK8s</a></li>
<li><a href="../de439736/index.html">IPSec VPN-Verbindung zwischen MikroTik und Kerio Control</a></li>
<li><a href="../de439738/index.html">Auf der Suche nach der Schaltfl√§che "Gut machen". Zyxel im Netzwerk kleiner und mittlerer Unternehmen</a></li>
<li><a href="../de439742/index.html">Zulassung zum Masterstudiengang JetBrains an der ITMO University</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>