<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚≠êÔ∏è üò± üî° VRRP Guide bei MikroTik üõÖ üõ∂ ü•Ñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Derzeit verf√ºgt MikroTik nicht √ºber stapelbare L√∂sungen oder Protokolle f√ºr die Hardware-Synchronisation und das Umschalten von Ger√§ten. Es gibt nicht...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VRRP Guide bei MikroTik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420163/"><p>  Derzeit verf√ºgt MikroTik nicht √ºber stapelbare L√∂sungen oder Protokolle f√ºr die Hardware-Synchronisation und das Umschalten von Ger√§ten.  Es gibt nicht viele L√∂sungen mit mehreren Stromleitungen.  Wenn Sie also die Aufgabe hatten, Hardware-Redundanz herzustellen, hat MikroTik nur sehr wenige Optionen (und sie funktionieren nicht wie gew√ºnscht). Eine davon ist vrrp. </p><a name="habracut"></a><br><p>  <strong>Was Sie √ºber VRRP bedeuten m√ºssen</strong> </p><br><p>  <strong>VRRP</strong> (Virtual Router Redundancy Protocol) ist ein offener Standard zum Kombinieren einer Gruppe von Routern zu einem virtuellen Router, um die Verf√ºgbarkeit zu erh√∂hen.  Wikipedia sagt "Standard-Gateway", aber in der Tat kann es jeder Router sein. </p><br><p>  MikroTik unterst√ºtzt zwei Versionen des vrrp-Protokolls (v2 und v3). In drei Versionen wird IPv6 unterst√ºtzt, die Authentifizierung funktioniert jedoch nicht (zumindest ist sie im Wiki geschrieben). </p><br><p>  Beim Erstellen der vrrp-Schnittstelle m√ºssen Sie die ID f√ºr den virtuellen Router (VRID) angeben. Er kann die Werte 0-255 annehmen.  Ein realer Router kann Teil mehrerer virtueller VRRP-Router sein. </p><br><p>  Jeder Router in VRID muss auf Priorit√§t eingestellt sein.  Der Router mit der h√∂chsten Priorit√§t wird als Master ausgew√§hlt und wird Inhaber der virtuellen IP (der Adresse, an der andere Ger√§te im Netzwerk mit dem Router kommunizieren). </p><br><p>  Der Master-Router sendet einmal pro Sekunde (kann ge√§ndert werden) Nachrichten √ºber seine Aktivit√§t an die Multicast-Adresse 224.0.0.18 (IPv6: FF02: 0: 0: 0: 0: 0: 0: 12) 00: 00: 5E wird als Empf√§nger-Mac angegeben: 00: 01: XX (IPv6: 00: 00: 5E: 00: 02: XX), wobei XX die hexadezimale Darstellung von VRID ist. </p><br><p>  Virtuelle IP - Die Adresse des virtuellen Routers, der auf der vrrp-Schnittstelle konfiguriert ist. </p><br><p>  Ein virtueller Router kann mehr als zwei Router haben, w√§hrend der Standard offen ist und Sie theoretisch Ger√§te verschiedener Hersteller verwenden k√∂nnen. </p><br><p>  <strong>Noch ein paar Kommentare</strong> </p><br><p>  VRRP ist nicht f√ºr die Synchronisierung der Konfiguration oder des Verbindungsstatus verantwortlich.  Dar√ºber hinaus verf√ºgt MikroTik √ºber keine integrierten Tools f√ºr solche Funktionen.  Sie k√∂nnen √Ñnderungen am Master √ºber das Protokoll abfangen, eine Datei mit ge√§nderten Abschnitten erstellen, mithilfe von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Abrufen</a> Dateien an die Sicherung senden, die nach Zeitgebern nach Dateien suchen und diese ausf√ºhren.  Oder verwenden Sie einen Diff-Server eines Drittanbieters, der einmal t√§glich die Konfiguration vergleicht und √Ñnderungen in das Backup hochl√§dt. All dies geht jedoch √ºber den Rahmen von vrrp hinaus. </p><br><p>  Die Hauptanwendung der nachstehend beschriebenen Schemata ist die Verwendung von zwei (oder mehr) Routern, die von verschiedenen (unabh√§ngigen) Stromleitungen mit nahtloser Umschaltung bei Problemen auf einer der Leitungen gespeist werden. </p><br><p>  <strong>Schema 1. Reservierung bei zwei Anbietern</strong> <br><img src="https://habrastorage.org/webt/xa/z-/th/xaz-the94olttyi207vwskacubk.png"></p><br><p>  MikrotTik Master vorl√§ufige Konfiguration: </p><br><pre><code class="hljs sql">/interface ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether1 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth1-wan <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether2 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth2-vrrp /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth1-wan /ip route <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> distance=<span class="hljs-number"><span class="hljs-number">1</span></span> gateway=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=vrrp-<span class="hljs-keyword"><span class="hljs-keyword">master</span></span></code> </pre> <br><p>  Mikrotik Backup vorl√§ufige Konfiguration: </p><br><pre> <code class="hljs sql">/interface ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether1 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth1-wan <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether2 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth2-vrrp /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">2.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth1-wan /ip route <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> distance=<span class="hljs-number"><span class="hljs-number">1</span></span> gateway=<span class="hljs-number"><span class="hljs-number">2.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=vrrp-<span class="hljs-keyword"><span class="hljs-keyword">backup</span></span></code> </pre> <br><p>  Hinzuf√ºgen von vrrp zu vrrp-master: </p><br><p>  [Schnittstellen] -&gt; [VRRP] -&gt; [+] <br>  Name: vrrp100 (beliebig m√∂glich) <br>  Schnittstelle: eth2-lan <br>  VRID: 100 <br>  Priorit√§t: 150 <br>  Auth: ah <br>  Bestanden: testvrrp <br>  Version: 2 </p><br><p>  VRRP wird auf der LAN-Schnittstelle ausgef√ºhrt, daher ist es sinnvoll, die Authentifizierung zum Schutz vor Sabotage festzulegen. </p><br><p>  Hinzuf√ºgen einer Service-IP: <br>  [IP] -&gt; [Adresse] -&gt; [+] <br>  Schnittstelle: eth2-vrrp <br>  Adresse: 10.10.10.1/32 </p><br><p>  <i>In dieser Konfiguration ist es nicht erforderlich, / 32-Adressen zu verwenden, da</i>  <i>Die funktionierende Subnetzadresse und die vrrp-Dienstadressen √ºberschneiden sich nicht.</i>  <i>Wenn Sie Adressen aus dem funktionierenden Subnetz verwenden (z. B. 192.168.100.251 - Master; 192.168.100.252 - Backup), ist die Verwendung von / 32 eine Voraussetzung, da Sie sonst m√∂glicherweise eine ECMP-Route zum LAN-Subnetz haben und alles sehr schlecht funktioniert.</i> <br></p><p>  Wenn der Dienst und die tats√§chlichen Adressen √ºbereinstimmen, gibt es eine weitere Funktion.  Ein Router, auf dem die virtuelle IP-Adresse unabh√§ngig von der Priorit√§t auf einer realen Schnittstelle konfiguriert wird, wird als Master betrachtet. </p><br><p>  Hinzuf√ºgen einer funktionierenden IP: </p><br><p>  <i>Virtuelle IP in VRRP-Terminologie.</i> <br>  [IP] -&gt; [Adresse] -&gt; [+] <br>  Schnittstelle: vrrp100-lan <br>  Adresse: 192.168.100.1/24 </p><br><p><img src="https://habrastorage.org/webt/10/wl/i9/10wli9mcs0j5ebxbxa6eusnq3js.jpeg"></p><br><p>  Konsolenoption: </p><br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">vrrp</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">authentication</span></span>=ah <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp name=vrrp100-lan password=testvrrp priority=<span class="hljs-number"><span class="hljs-number">150</span></span> version=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">100</span></span> /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=vrrp100-lan</code> </pre> <br><p>  Hinzuf√ºgen von vrrp zu vrrp-backup: </p><br><p>  [Schnittstellen] -&gt; [VRRP] -&gt; [+] <br>  Name: vrrp100-lan <br>  Schnittstelle: eth2-vrrp <br>  VRID: 100 <br>  Priorit√§t: 100 (niedriger als Master) <br>  Preemption-Modus: Aus <br>  Auth: ah <br>  Bestanden: testvrrp <br>  Version: 2 </p><br><p>  Preemption-Modus - Einstellung f√ºr Backup-Router.  Wenn diese Option aktiviert ist, gibt der Router die Steuerung nicht mit hoher Priorit√§t an den Router zur√ºck, wenn sie im Netzwerk angezeigt wird. </p><br><p>  Hinzuf√ºgen einer Service-IP: </p><br><p>  [IP] -&gt; [Adresse] -&gt; [+] <br>  Schnittstelle: eth2-vrrp <br>  Adresse: 10.10.10.2/32 </p><br><p>  Hinzuf√ºgen einer funktionierenden IP: </p><br><p>  [IP] -&gt; [Adresse] -&gt; [+] <br>  Schnittstelle: vrrp100-lan <br>  Adresse: 192.168.100.1/24 <br><img src="https://habrastorage.org/webt/wq/dq/op/wqdqopvvuacrjdn_hqygqdtyxu8.jpeg"></p><br><p>  Konsolenoption: </p><br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">vrrp</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">authentication</span></span>=ah <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp name=vrrp100-lan password=testvrrp priority=<span class="hljs-number"><span class="hljs-number">100</span></span> version=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">100</span></span> preemption-mode=no /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=vrrp100-lan</code> </pre> <br><p>  Nach der Konfiguration erfolgt die Koordination - die Router tauschen Hallo aus und entscheiden, wessen Priorit√§t h√∂her ist. <br>  Vrrp-Master-Status ([R] Unning, [M] Aster) </p><br><p><img src="https://habrastorage.org/webt/6o/xr/bw/6oxrbwwozoqgl97bjdpjma-_q_0.png"></p><br><p>  Status vrrp-backup ([B] ackup) </p><br><p><img src="https://habrastorage.org/webt/bf/3u/-r/bf3u-rt8m0h9w-jsl8rfvctch4u.png"></p><br><p>  <i>Oben habe ich versucht, die Schnittstellen so klar wie m√∂glich zu benennen, damit beim Hinzuf√ºgen von Firewall-Regeln usw. keine Verwirrung entsteht. Die Schnittstelle vrrp100-lan ist f√ºr das lokale Netzwerk verantwortlich.</i>  <i>Die eth2-vrrp-Schnittstelle ist f√ºr den technischen vrrp-Verkehr verantwortlich.</i>  <i>Wenn vlan auf der LAN-Schnittstelle verwendet wird, muss es auf der vrrp-Schnittstelle konfiguriert werden.</i> </p><br><p>  <strong>Schema 2. Reservierung und Abw√§gung unter Beteiligung von zwei Anbietern</strong> <br><img src="https://habrastorage.org/webt/ok/r9/he/okr9hexpkaylgbrmbuzjekk2zjm.png"></p><br><p>  Das vorherige Schema funktioniert gut, aber einer der Anbieter h√§ngt in der Luft und wird fast nie verwendet. Sie k√∂nnen die Situation mithilfe mehrerer Standardrouten im Netzwerk korrigieren.  Sie k√∂nnen verschiedene Standardrouter mithilfe von DHCP oder durch statisches Fahren an Benutzer verteilen.  In jedem Fall ist die Konfiguration nicht flexibel.  Dieses Beispiel zeigt jedoch den Betrieb des Routers in mehreren virtuellen vrrp-Routern gut. </p><br><p>  Wir nehmen das vorherige Schema als Grundlage und f√ºgen eine zus√§tzliche vrrp-Schnittstelle hinzu. </p><br><p>  Auf vrrp-master: </p><br><p><img src="https://habrastorage.org/webt/jw/k4/_a/jwk4_aaz2rudwec3cr9dowqdcj0.png"></p><br><p>  Konsolenoption: </p><br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">vrrp</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">authentication</span></span>=ah <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp name=vrrp200-lan password=testvrrp priority=<span class="hljs-number"><span class="hljs-number">100</span></span> version=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">200</span></span> preemption-mode=no /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=vrrp200-lan</code> </pre> <br><p>  Bei vrrp-backup: </p><br><p><img src="https://habrastorage.org/webt/p4/np/jf/p4npjfg-odyhv85o4zcdfrkwaug.png"></p><br><p>  Konsolenoption: </p><br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">vrrp</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">authentication</span></span>=ah <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp name=vrrp200-lan password=testvrrp priority=<span class="hljs-number"><span class="hljs-number">150</span></span> version=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">200</span></span> /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=vrrp200-lan</code> </pre> <br><p>  <i>Es ist nicht ganz angemessen, die Terminologie Master / Backup zu verwenden, da</i>  <i>jetzt sind beide router gleichzeitig beide in bezug auf verschiedene vrid.</i> </p><br><p>  Ergebnis f√ºr vrrp-master: </p><br><p><img src="https://habrastorage.org/webt/yh/ce/4w/yhce4wc5hbqmckikv10oe--qdoq.png"></p><br><p>  Ergebnis f√ºr vrrp-backup: </p><br><p><img src="https://habrastorage.org/webt/ny/cv/wp/nycvwpaauqxeq7oxegvhcoytvv8.png"></p><br><p>  <strong>Schema 3. Reservierung unter Beteiligung eines Anbieters</strong> <br><img src="https://habrastorage.org/webt/53/yp/9y/53yp9yyhao4y6lipd9ixpqqlpdq.png"></p><br><p>  Vorl√§ufige MikroTik Master-Konfiguration: </p><br><pre> <code class="hljs sql">/interface ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether1 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth1-wan <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether2 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth2-vrrp /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth1-wan /ip route <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> distance=<span class="hljs-number"><span class="hljs-number">1</span></span> gateway=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=vrrp-<span class="hljs-keyword"><span class="hljs-keyword">master</span></span></code> </pre> <br><p>  Mikrotik Backup vorl√§ufige Konfiguration: </p><br><pre> <code class="hljs sql">/interface ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether1 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth1-wan disabled=yes <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether2 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth2-vrrp /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth1-wan /ip route <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> distance=<span class="hljs-number"><span class="hljs-number">1</span></span> gateway=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=vrrp-<span class="hljs-keyword"><span class="hljs-keyword">backup</span></span></code> </pre> <br><p>  Wichtig: Bei mikrotik vrrp-backup ist die eth1-wan-Schnittstelle standardm√§√üig deaktiviert. </p><br><p>  Die grundlegende VRRP-Konfiguration √§hnelt der bei zwei Anbietern. </p><br><p>  Vrrp-master konfigurieren: </p><br><p>  Mit vrrp ist alles √§hnlich. </p><br><p><img src="https://habrastorage.org/webt/s5/7z/sv/s57zsvr5e-htlz2hii1aizsfr_a.png"></p><br><p>  In [System] -&gt; [Schedulers] wird jedoch ein zus√§tzliches Skript angezeigt, das beim Laden die WAN-Schnittstelle f√ºr einige Sekunden deaktiviert.  Dies vermeidet Kollisionen (wenn der Mac auf Backup umgestellt wurde) oder ein Verbot des Bedienerwechsels. </p><br><p><img src="https://habrastorage.org/webt/qa/io/o5/qaioo5kg_y_syjbcv1ertotdbjs.png"></p><br><p>  Konsolenoption: </p><br><pre> <code class="hljs pgsql">/interface vrrp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> authentication=ah interface=eth2-vrrp <span class="hljs-type"><span class="hljs-type">name</span></span>=vrrp100-lan <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>=testvrrp priority=<span class="hljs-number"><span class="hljs-number">150</span></span> version=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">100</span></span> /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> interface=eth2-vrrp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> interface=vrrp100-lan /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> scheduler <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>=wan-<span class="hljs-keyword"><span class="hljs-keyword">off</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>-event="/interface set eth1-wan disabled=yes\r\ \n:delay 3\r\ \n/interface set eth1-wan disabled=no" <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>=ftp,reboot,<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>,test,<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>,sniff,sensitive,romon <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>-<span class="hljs-type"><span class="hljs-type">time</span></span>=startup</code> </pre> <br><p>  Konfigurieren von vrrp-backup: </p><br><p>  Alles ist √§hnlich, aber in den vrrp-Skripten werden Aktionen angezeigt, um den eth1-wan-Status zu √§ndern. </p><br><p><img src="https://habrastorage.org/webt/w5/7e/ty/w57etyygcudn9qqhzxskte-zzfk.png"></p><br><p>  Und Sheduller wird hinzugef√ºgt, wodurch eth1-wan beim Booten deaktiviert wird (falls erforderlich, schaltet vrrp es selbst ein). </p><br><p><img src="https://habrastorage.org/webt/_9/tj/d1/_9tjd1imej5fdwqepyods39o9hi.png"></p><br><p>  Konsolenoption: </p><br><pre> <code class="hljs sql">/interface vrrp add authentication=ah interface=eth2-vrrp name=vrrp100-lan on-<span class="hljs-keyword"><span class="hljs-keyword">backup</span></span>=<span class="hljs-string"><span class="hljs-string">"/interface set eth1-wan disabled=yes\r\ \n"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">master</span></span>=<span class="hljs-string"><span class="hljs-string">"/interface set eth1-wan disabled=no"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>=testvrrp preemption-<span class="hljs-keyword"><span class="hljs-keyword">mode</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">100</span></span> /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=vrrp100-lan /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> scheduler <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=wan-<span class="hljs-keyword"><span class="hljs-keyword">off</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>=<span class="hljs-string"><span class="hljs-string">"/interface set eth1-wan disabled=yes"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">ftp</span></span>,reboot,<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>,write,<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>,sniff,sensitive,romon <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">startup</span></span></code> </pre> <br><p>  <i>Wenn der Anbieter den Zugriff auf den Mac einschr√§nkt, vergessen Sie nicht, ihn auf der Backup-Router-Schnittstelle zu √§ndern.</i> </p><br><p>  In diesem Schema haben wir eine Schwachstelle - einen Schalter vor WAN-Schnittstellen.  Es ist m√∂glich, mit dem Anbieter zu vereinbaren, dass er Ihnen zwei Dr√§hte f√ºhrt und diese mit VLAN-Weiterleitung usw. mit verschiedenen Segmenten seines Netzwerks verbunden werden.  Oder ... setzen Sie ein <a href="">passives T-Shirt</a> , aber das ist schreckliche Pornografie, und zu Beginn eines der Router kommt es zu einigen Kollisionen, die jedoch funktionsf√§hig sind (wenn Sie eth1-wan nicht mit den H√§nden auf dem Backup-Router aktivieren). </p><br><p>  Nat√ºrlich k√∂nnen Sie vrrp auf der WAN-Schnittstelle verwenden (wenn die Einstellungen statisch sind), aber dann kann die Installation eines zus√§tzlichen Switches oder Verhandlungen mit dem Anbieter nicht vermieden werden. </p><br><p>  <strong>Schema 4. Reservierung unter Beteiligung eines WISP-Anbieters</strong> <br><img src="https://habrastorage.org/webt/mf/w_/wf/mfw_wftbhb8ewsnepmsebq1egze.png"></p><br><p>  Es mag Ihnen scheinen, dass vrrp ein seltsames Missverst√§ndnis ist, das Sie nicht ohne Kr√ºcken au√üerhalb des Labors verwenden k√∂nnen.  Tats√§chlich gibt es ein Schema, das dem vorherigen sehr √§hnlich ist, jedoch auf drahtlosen Br√ºcken basiert. </p><br><p>  Der Anbieter verf√ºgt √ºber eine AP-Br√ºcke (vorzugsweise mit einem gro√üen Versorgungsbereich).  Auf der Client-Seite befinden sich zwei Platten (z. B. SXT mit einem √Ñther), die in unterschiedlichen Masten (oder Ecken des Geb√§udes) angeordnet sind und von unterschiedlichen Stromleitungen gespeist werden, jedoch einen Internetzugang f√ºr dasselbe Subnetz bieten. </p><br><p>  Die Einstellungen sind dem vorherigen Schema v√∂llig √§hnlich, nur die WAN-Schnittstelle wird zu WLAN1 und die LAN-Schnittstelle Ether1.  Die Platten k√∂nnen so statisch wie m√∂glich konfiguriert werden, und der gesamte Verkehr kann auf einem zus√§tzlichen Ger√§t dahinter gesteuert werden.  Dies ist ein vollst√§ndig funktionierendes Anti-Vandalismus-Programm ohne zus√§tzliche Interaktion mit dem Anbieter. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de420163/">https://habr.com/ru/post/de420163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de420153/index.html">3D-Druck komplexer Teile aus ABS und PLA mit viel Unterst√ºtzung</a></li>
<li><a href="../de420155/index.html">Intel Datacenter SSD. Gro√üe Mengen und neue Namen</a></li>
<li><a href="../de420157/index.html">SJ-Meetup-Funktionsmodellierung mithilfe von Anwendungsf√§llen</a></li>
<li><a href="../de420159/index.html">Andocken von Webdiensten in R und Python</a></li>
<li><a href="../de420161/index.html">1.500 Ver√∂ffentlichungen, ein Captcha-Spiel f√ºr Programmierer und ein gebrochenes Gehirn: 10 Jahre bis zu unserem Blog</a></li>
<li><a href="../de420167/index.html">MBLT DEV 2018: Preiserh√∂hungen und neue Lautsprecher</a></li>
<li><a href="../de420171/index.html">ICO 2.0 und Business Tokenization</a></li>
<li><a href="../de420173/index.html">IoT-Architektur - zuerst unter die Haube schauen</a></li>
<li><a href="../de420175/index.html">Vanessa-Automation ist ein selbstdokumentierendes Tool f√ºr angewandte L√∂sungen auf der 1C: Enterprise-Plattform. Kino und BDD</a></li>
<li><a href="../de420177/index.html">DEFCON Hacker Konferenz. Speed ‚Äã‚ÄãHacks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>