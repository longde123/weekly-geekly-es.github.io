<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§€ ğŸ”– ğŸ‘¨ Kit Pemula Pengujian Keamanan Web â¬ ğŸ¦ ğŸ¥¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! 

 Nama saya Andrey. Selama 10 tahun saya telah mencari kerentanan di berbagai layanan web. dan siap berbagi pengetahuan saya dengan An...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kit Pemula Pengujian Keamanan Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/441966/"> Halo semuanya! <br><br>  Nama saya Andrey.  Selama 10 tahun saya telah mencari kerentanan di berbagai layanan web.  dan siap berbagi pengetahuan saya dengan Anda.  Mei lalu, saya membuat laporan tentang ini di konferensi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Heisenbug</a> , dan sekarang saya siap untuk membagikan pengetahuan saya di sini, di ruang terbuka Habr.  Jadi mari kita mulai. <br><br>  Suatu kali saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menemukan kerentanan</a> di server Facebook perusahaan terkenal.  Orang-orang lupa untuk memperbarui ImageMagick (perpustakaan untuk pemrosesan gambar) dan membayarnya :) Dengan contoh ini saya ingin menunjukkan bahwa kita semua adalah orang dan kita semua dapat membuat kesalahan, tidak peduli di mana perusahaan dan di posisi apa kita bekerja.  Satu-satunya masalah adalah bahwa kesalahan ini dapat menyebabkan segala macam risiko. <br>  Semakin rumit aplikasi / situs web / alat Anda, semakin besar kemungkinan terjadi kesalahan. <br>  Anda perlu memeriksa kerentanannya.  Adalah bodoh untuk tidak melakukan ini sama sekali. <br><a name="habracut"></a><br>  Item-item berikut mungkin merupakan tahap-tahap memeriksa aplikasi web: <br><ul><li>  Persiapan: <ul><li>  Tentukan titik masuk - pada kenyataannya, dari mana data dapat berasal dari dalam aplikasi; </li><li>  Identifikasi stok teknologi; </li><li>  Tentukan kerentanan apa yang masuk akal untuk diperiksa; </li></ul></li><li>  Verifikasi  Anda perlu memeriksa semua kerentanan yang berlaku pada ruang lingkup teknologi aplikasi web Anda; </li><li>  Analisis kode.  Jangan malas, jangan lewatkan item ini.  Dalam beberapa kasus, tanpa akses ke kode, sulit untuk menemukan kerentanan, dan ini juga memungkinkan Anda untuk melewati penyaringan yang mungkin tertanam dalam aplikasi Anda. </li></ul><br>  Saya akan membicarakan semua ini secara rinci. <br><br>  Jadi, persiapan.  Saya tidak akan fokus pada semua jenis kerentanan, jika tidak jumlah teks dalam artikel akan melebihi semua ukuran yang dapat dibayangkan dan tidak dapat dipahami.  Saya menyarankan Anda untuk mulai belajar dari daftar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sepuluh Proyek OWASP</a> .  Setiap beberapa tahun, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">konsorsium OWASP</a> membentuk daftar kerentanan paling relevan saat ini.  Kami akan mempertimbangkan beberapa dari mereka secara detail. <br><br><h2>  Xss </h2><br>  <i>XSS (skrip lintas situs)</i> adalah serangan terhadap pengguna yang memungkinkan penyerang untuk mengeksekusi skrip sewenang-wenang dalam konteks browser korbannya.  Paling sering, ini menyiratkan penerapan tag <i>HTML</i> dan skrip <i>JS</i> . <br>  Contoh: pada suatu waktu ada layanan seperti itu <i>Yahoo!</i>  <i>Ad Exchange</i>  Formulir pemulihan kata sandi memiliki parameter " <i>URL Kembali</i> ".  Ini dapat menunjukkan halaman mana yang akan kembali setelah proses pengaturan ulang kata sandi.  Jika Anda memasukkan satu atau beberapa vektor lain di sana yang mengarah ke pelaksanaan kode <i>JS</i> , Anda bisa mendapatkan semua <i>cookie</i> pengguna.  Kami akan menganalisis bagaimana ini terjadi dan mengapa. <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Di sini adalah vektor itu sendiri.  Sekaligus: <br><img src="https://habrastorage.org/webt/ua/ko/8l/uako8l_hpqr4bov7qmzhm97xwj4.png"><br>  Untuk melakukan injeksi, Anda harus keluar dari konteks variabel di mana kami secara default (secara default - inilah yang diasumsikan programmer ketika ia menulis kode). <br>  Di bawah ini adalah nilai aslinya.  Ini adalah perilaku yang valid. <br><img src="https://habrastorage.org/webt/v4/rm/l7/v4rml7dzf1rqpkyvgq8yxdnl3oi.png"><br>  Kami melihat bahwa returnURL = / login.jsp <br>  Ini termasuk dalam nilai <i>tag &lt;input&gt;</i> . <br>  Jika kita menambahkan tanda kutip setelah <i>jsp</i> , kita akan melihat bahwa sintaks <i>HTML</i> telah dituangkan.  Untungnya, bahasa <i>HTML</i> tidak ketat, pengurai akan melompati dan tidak akan ada masalah: <br><img src="https://habrastorage.org/webt/3o/s6/z1/3os6z130clrrtkshbktmqgkguto.png"><br>  Tambahkan karakter lain.  Di sini kita benar-benar keluar dari konteks <i>tag &lt;input&gt;</i> : <br><img src="https://habrastorage.org/webt/lg/x9/av/lgx9avfst6nskdlowyzx0uasgyy.png"><br>  Sekarang kami menambahkan pembukaan <i>tag &lt;svg&gt;</i> , dan kami mendapatkan dua tag yang valid dalam hal sintaks: <br><img src="https://habrastorage.org/webt/u8/pe/tg/u8petg6ghf1gajt49dvsvtfnzn0.png"><br>  Selanjutnya, tambahkan seluruh vektor serangan: <br><img src="https://habrastorage.org/webt/o2/t5/n8/o2t5n8-li9jpdao1cbzghum-mhe.png"><br>  Dalam hal ini, gambar <i>svg</i> diambil.  Dengan menggunakan penangan <i>JavaScript</i> " <i>onload</i> ", kami menjalankan peringatan dengan <i>cookie pada</i> dokumen.  Itu saja!  Penyerang menerima <i>cookie</i> Anda. <br>  Jika dalam buktinya kami hanya menampilkan peringatan itu sendiri, maka tidak akan sulit bagi penyerang untuk mengirim cookie ke server yang dikendalikan olehnya dan, dalam kasus terburuk, merebut akun Anda.  Mari kita lihat tampilannya lagi: <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Ada juga lebih banyak vektor serangan pada klien.  Saya akan memberikan beberapa contoh dengan deskripsi singkat.  Tetapi pertama-tama Anda perlu memahami bagaimana keluar dari konteks: <br><ul><li>  Di luar konteks.  6 karakter ini akan membantu untuk keluar tidak hanya dari konteks nilai parameter HTML, tetapi juga dari banyak lainnya: <br>  -&gt; '"&gt; <br></li></ul><br>  Sebenarnya, dua vektor serangan paling sederhana: <br><ul><li>  Sisipkan tautan khususnya.  Tetapi dalam kasus umum - mengubah tampilan halaman.  Misalnya, mereka dapat menyematkan kode html di halaman Anda dan menampilkan beberapa jendela palsu yang meminta data: <br><img src="https://habrastorage.org/webt/dt/-p/yz/dt-pyzv0wcrhgxqihw3iuoccbnc.png"><br>  String " <i>aaaa</i> " menunjuk ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">google.com</a> .  Anda dapat melihat bahwa tautan diberikan pada halaman, tetapi Anda mungkin tidak melihatnya, tetapi ini tidak membatalkan keberadaannya dalam kode.  Dalam kedua kasus tersebut, kasing dapat dianggap selesai; </li><li>  Eksekusi skrip, misalnya, mencegat <i>cookie</i> pengguna: <br><img src="https://habrastorage.org/webt/w8/yd/yb/w8ydybkf9oucxuawq_vumapupda.png"><br></li></ul><br><br><h3>  Di mana dan bagaimana mencari XSS? </h3><br>  Pertama, temukan fungsi informasi / data output pada halaman.  Analisis data apa yang ada di sana?  Di sinilah konsep <i>sumber yang tidak dipercaya</i> .  Dan semacamnya, pertama-tama, adalah <i>pengguna Anda</i> .  Vektor serangan dapat dimuat dalam sumber lain: umpan RSS, layanan lain, baik eksternal maupun internal. <br>  Inilah contoh kehidupan nyata: Saya bekerja untuk SEMrush IT.  Kami sedang mengembangkan platform online, yang merupakan alat universal untuk pemasar online.  Jadi, satu layanan menyimpan data untuk kami, yang lain menyimpulkan, masing-masing tim mengandalkan satu sama lain, ternyata pada layanan kedua <i>XSS</i> muncul karena kurangnya pemrosesan data output yang tepat, dan perintah pertama tidak menganggap perlu untuk menyaring data apa yang masuk. dengan cara apa pun dan menjaga mereka " <i>apa adanya</i> ".  Kesimpulan: jika Anda tidak tahu bagaimana data ini atau itu disimpan, mereka harus dianggap tidak dipercaya.  Atau setuju sebelumnya tentang siapa yang menyimpan dan bagaimana, menyaring, menampilkan data. <br><br>  Jika Anda sudah memiliki data dari sumber yang tidak terpercaya, maka saya sarankan: <br><ul><li>  Untuk mempelajari pemfilteran data yang masuk; </li><li>  Periksa konteks output.  Tidak dalam semua kasus <i>XSS</i> dapat dieksekusi, bahkan jika tidak ada penyaringan.  Misalnya, jika tipe <i>konten dari</i> respons adalah: <i>teks / polos;</i> </li><li>  Jangan mengandalkan penyaringan kerangka kerja sistem keamanan tertanam. </li></ul><br><br><h2>  Injeksi SQL </h2><br><img src="https://habrastorage.org/webt/do/b8/ry/dob8ryjj2vifp3w1th18oroewis.png"><br><br>  <i>Implementasi kode-SQL (injeksi SQL bahasa Inggris)</i> - pengantar ke database permintaan instruksi yang tidak tersirat di sana. <br><br>  Contoh (bukan dari kehidupan, tetapi juga baik): <br>  Kami melihat skrip yang menampilkan tabel pengguna.  Dalam hal ini, ia dapat mencari berdasarkan nama pengguna. <br>  Di sebelah kanan diperlihatkan bagaimana kueri ke database terlihat, dan di sebelah kiri adalah hasil dari skrip di browser. <br><img src="https://habrastorage.org/webt/ng/u2/ou/ngu2ouq8da3jtb18gkjj2amzxss.png"><br>  Selanjutnya, untuk menguji dan mendapatkan setidaknya beberapa hasil utama, kami menyisipkan dua kutipan dalam nilai parameter nama.  Tunggal dan ganda: <br><img src="https://habrastorage.org/webt/0a/fd/ck/0afdckohg1xuacw-7olxyrzifha.png"><br>  Kami melihat bahwa dari sudut pandang output, semuanya berantakan, tabel menghilang sepenuhnya.  Permintaan juga mendapat 2 tanda kutip tambahan.  Seluruh sintaks kueri <i>SQL</i> dilanggar. <br>  Jika kita mengambil dan menambahkan konstruksi seperti itu ke nilai parameter ( <i>ed .: Lihat di kotak kuning</i> ), kita mendapatkan permintaan yang benar-benar valid.  Output halaman benar-benar identik dengan permintaan pertama, yang tidak termasuk injeksi: <br><img src="https://habrastorage.org/webt/nh/9q/gu/nh9qguk8d0unxfz1bsxlfb0n8vo.png"><br>  Untuk memverifikasi sepenuhnya bahwa ada kerentanan, kami menambahkan deuce sebagai ganti kesatuan: <br><img src="https://habrastorage.org/webt/lx/je/a6/lxjea6hv3hebohiv96gpauuo4o0.png"><br>  Ternyata permintaan itu menjadi salah, dari sudut pandang logika Boolean dan, sebagai hasilnya, tidak mengandung data.  Namun, tidak seperti saat ketika kami memiliki kesalahan, kami memiliki output dari tabel itu sendiri. <br><br>  Agar tidak mencantumkan semua yang mungkin ada di mesin basis data yang berbeda dan pertanyaan dari jenis yang berbeda, saya telah mengurangi semuanya menjadi satu baris: <br><img src="https://habrastorage.org/webt/xz/ok/mn/xzokmnhyzqdepnyax-n1bzd8siq.png"><br>  Ini adalah sesuatu yang dapat Anda coba masukkan ke dalam parameter, dan kemudian, sesuai dengan perbedaan dalam jawaban, cobalah untuk memahami apa yang terjadi, apakah ada kerentanan atau tidak.  Sekitar 80% kasus yang dapat Anda tutupi dengan manipulasi ini. <br>  Masih ada 20% dari situasi sulit di mana ia tidak akan memberi Anda informasi apa pun, misalnya: kueri / pemfilteran bersarang dan sebagainya.  Dalam latihan saya, saya bertemu dengan yang sama hanya sekali.  Kemudian saya harus melewati pemfilteran di sisi layanan. <br><br>  Apa bahayanya dalam SQL? <br><ul><li>  Dari yang jelas - <i>kebocoran informasi</i> .  Jika seorang penyerang dapat membuat query ke database Anda, ia dapat dengan satu atau lain cara mendapatkan nilai yang tidak seharusnya berupa output (hash kata sandi, alamat klien, dll.); </li><li>  <i>Perubahan data</i> .  Sekarang banyak pengembang menggunakan database melalui sistem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ORM</a> .  Sistem ini sendiri, secara default, memungkinkan Anda untuk membuat beberapa kueri sekaligus, sintaks SQL juga memungkinkan Anda untuk melakukan ini.  Jika ada kerentanan, semuanya dapat berubah tidak hanya untuk pemilihan data, tetapi juga untuk perubahannya (hingga menghapus tabel, mengubah struktur database, dll.). <br>  Dalam situasi yang sama, peningkatan hak pengguna mungkin terjadi.  Ubah bidang dalam tabel tertentu (misalnya, masukkan <i>is_admins = true</i> dalam basis data <i>pengguna</i> ) dan dengan demikian meningkatkan hak Anda kepada administrator; </li><li>  <i>DoS</i> .  Dalam beberapa kasus, suntikan dapat menyebabkan penolakan layanan.  Beberapa pertanyaan berat ke basis data dihasilkan, diluncurkan dalam beberapa utas, dan layanan Anda mungkin berhenti bekerja untuk beberapa waktu; </li><li>  <i>Membaca file sistem</i> adalah bencana lain yang dapat dibawa injeksi SQL.  Terjadinya risiko ini tergantung pada sistem basis data yang Anda gunakan, serta di mana pengguna bekerja dengannya (diistimewakan atau tidak); </li><li>  <i>RCE (Remote Code Execution)</i> adalah eksekusi kode.  Ini secara langsung tergantung pada jenis database yang digunakan (sebelumnya ini dimungkinkan secara default, dengan pengaturan database default, dalam MSSQL). </li></ul><br>  Tabel di bawah ini menunjukkan kerentanan dalam kueri <i>SQL</i> .  Tentu saja, Anda tidak perlu mengingatnya.  Selain itu, ini tidak semua opsi yang mungkin, tetapi hanya contoh.  Hanya memperhatikan fakta bahwa tempat-tempat injeksi ke query <i>SQL</i> dapat terjadi jika data mentah tiba di sana disorot dengan warna merah.  Penyerang yang berpengalaman dapat menemukan cara untuk mengeksploitasi ini.  Berhati-hatilah dan penuh perhatian. <br><img src="https://habrastorage.org/webt/gz/bt/xh/gzbtxhbbrkng9axlc2av07rax9o.png"><br><br><h2>  SSRF (Pemalsuan Permintaan Sisi Server) </h2><br>  Terjemahan literal - permintaan palsu di sisi server.  Itu adalah serangan yang memungkinkan Anda untuk memanipulasi data yang Anda kirim ke aplikasi, memaksa Anda untuk membuat permintaan untuk tidak ke tempat logika bisnis awalnya direncanakan. <br>  Pengoperasian <i>SSRF</i> ditunjukkan pada gambar di bawah ini: <br><img src="https://habrastorage.org/webt/cn/3m/xc/cn3mxclin9jb7tr5fdg6zcowez8.png"><br>  Ada penyerang, ada server Anda, yang ditutup oleh <i>Firewall</i> , tetapi pada saat yang sama ada fungsi yang memungkinkan Anda untuk membuat permintaan atas nama server lebih lanjut. <br>  Jika fungsi ini tidak dilindungi dengan benar dan / atau salah, seperti biasanya :), memproses data yang masuk, penyerang dapat beralih ke <i>Memcached</i> , <i>Redis</i> atau mendapatkan akses ke sumber daya internal korban. <br><br>  Untuk contoh yang lebih ilustratif, pertimbangkan pendirian yang digunakan SEMrush untuk pelatihan karyawan internal. <br>  Penting untuk memperhatikan arti dari " <i>URL Avatar</i> ": <br><img src="https://habrastorage.org/webt/yi/yp/fr/yiypfrzdsu-pqg0adlbup1ziqgk.png"><br>  Di sini kita memperhatikan 2 poin: <br><ul><li>  URL Avatar itu sendiri </li><li>  dan kemampuan untuk mengunduhnya menggunakan file. </li></ul><br>  Harap perhatikan bahwa bidang " <i>URL Avatar</i> " adalah bidang teks untuk input, yang berarti kami dapat memanipulasi nilai ini.  Mari kita coba memakai avatar, mungkin, gambar paling terkenal di Internet - Googlebot dari halaman <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kesalahan 404</a> . <br>  Lakukan sekali: <br><img src="https://habrastorage.org/webt/hg/8d/oa/hg8doavbzbji9apfewlydlpxhyq.png"><br>  Lakukan dua kali klik " <i>Simpan</i> ."  Kami mendapatkan robot alih-alih foto saya: <br><img src="https://habrastorage.org/webt/kf/4x/lr/kf4xlr2atwvebex_dmsiqlxvmbi.png"><br>  Di sini perlu memperhatikan fakta bahwa nilai " <i>URL avatar</i> " telah berubah, ke beberapa jalur lokal - rupanya, aplikasi meminta gambar, menyimpannya ke server dan mengganti nilai baru. <br><br>  Kami melanjutkan.  Di bidang " <i>URL avatar</i> ", masukkan <i>file</i> nilai <i>: /// etc / passwd</i> .  Desain ini memungkinkan Anda untuk mengakses struktur file.  Di beberapa perpustakaan yang digunakan untuk bekerja dengan <i>HTTP</i> , secara default, bekerja dengan struktur file dihidupkan dan menerima data dari server di mana mereka mulai: <br><img src="https://habrastorage.org/webt/_j/2i/jb/_j2ijbofjimkfmd2tjxmoegkh4k.png"><br>  Apa yang terjadi setelah mengklik tombol " <i>Simpan</i> "? .. <br>  Pertama, gambar menjadi " <i>bat</i> ", dan kedua, path ke file berubah. <br><img src="https://habrastorage.org/webt/bn/ro/d5/bnrod5bxckue0avxxbvvktglimg.png"><br>  Jika kami mencoba meminta gambar ini di browser, mereka tidak akan menunjukkan kepada kami apa-apa (file tersebut " <i>rusak</i> ").  Tapi kami bukan hari pertama dalam keamanan informasi, kami tahu apa yang harus dilakukan :) Dengan manipulasi sederhana, kami mendapatkan konten file di komputer kami: <br><img src="https://habrastorage.org/webt/vd/sw/97/vdsw97u1ce8abtqa2aqcp_zb2ac.png"><br>  Dengan demikian, dengan bantuan kerentanan ini, saya, sebagai penyerang, bisa mendapatkan semua kode sumber layanan Anda dan data lain yang tersedia untuk dibaca oleh pengguna yang menjalankan layanan web. <br>  Mari kita lihat bahaya SSRF: <br><ul><li>  Pemindaian port.  Untuk jaringan eksternal, layanan Anda adalah satu titik masuk dan 2 port (http dan https).  Dengan memindai port dari dalam infrastruktur Anda, penyerang dapat mendeteksi port terbuka; </li><li>  Abaikan otentikasi berbasis host.  Apa gunanya  Ada kemungkinan bahwa dalam struktur Anda ada layanan yang tersedia hanya untuk sumber daya tertentu (baca: daftar putih IP).  Jadi, jika server Anda yang rentan ada dalam daftar putih, Anda mendapatkan akses ke layanan yang tersedia baginya, dan, sebagai hasilnya, Anda dapat memanipulasi mereka; </li><li>  Melanjutkan pengembangan serangan yang disebutkan di atas, Anda dapat terus mengeksploitasi program rentan yang berjalan di intranet atau di server lokal.  Cukup sering ada situasi ketika infrastruktur internal, tidak dapat diakses dari luar, tidak dimonitor dengan baik (versi / patch keamanan, dll. Tidak selalu diperbarui).  Ini juga dapat menyebabkan serangan dan pencurian data; </li><li>  Membaca data lokal.  Saya menunjukkannya di atas dengan sebuah contoh.  Konfigurasi Anda dapat dibaca dan diakses, token dan kata sandi. </li></ul><br><br><h3>  Di mana mencari SSRF? </h3><br>  Ini bukan kerentanan standar.  Itu dapat ditemukan di tempat yang berbeda, seringkali di tempat yang paling tidak terduga.  Dalam situasi ini, teknik "lihat di sini, tetapi Anda mungkin tidak melihat di sini" tidak berfungsi. <br>  Tanda-tanda kemungkinan <i>SSRF</i> : <br><ul><li>  <i>Webhook</i> .  Jika mereka dikonfigurasi dengan buruk, jika Firewall tidak terkonfigurasi dengan benar pada server-server dari mana Webhooks membuat permintaan, kerentanan dapat diperoleh; </li><li>  <i>Konversi HTML</i> .  Cobalah menyematkan <i>susunan &lt;iframe&gt;</i> , <i>&lt;img&gt;</i> , <i>&lt;base&gt;</i> , <i>&lt;script&gt;</i> atau <i>CSS</i> yang mengarah ke layanan internal; </li><li>  <i>Unduh file yang dihapus</i> .  Ingat contoh avatar?  Ketika pengguna memiliki kesempatan untuk mengunggah data dengan URL ke server, ini memerlukan masalah besar.  Coba kirim URL dengan port dan lihat konten apa yang diunggah. </li></ul><br><br><h3>  Bagaimana cara mencari SSRF? </h3><br><ul><li>  Angkat server dan jalankan <i>pendengar</i> : <br><pre><code class="bash hljs">user$ nc -1 -n -vv -p 8080 -k</code> </pre> <br>  Dengan cara ini Anda akan melihat semua permintaan yang datang ke server Anda pada port <i>8080</i> .  Di satu sisi, ini adalah port yang tidak dihuni oleh server web Anda, dan di sisi lain, itu adalah port yang sering tidak difilter oleh <i>Firewall</i> .  Dipercayai bahwa protokol ini digunakan untuk protokol <i>http</i> dan melarangnya tampaknya bersifat opsional; </li><li>  Dalam aplikasi yang sedang dipelajari, cari parameter tempat Anda dapat melewati jalur untuk meminta data dari host kami (ke <i>pendengar</i> kami); </li><li>  Periksa output <i>pendengar</i> atau respons yang dikembalikan. </li></ul><br><br><h2>  XXE (Entitas Eksternal XML) </h2><br>  Saya akan memulai ceritanya, seperti biasa dengan contoh, sehingga lebih jelas: <br>  Dalam layanan SEMrush yang disebutkan di atas ada alat yang berkaitan dengan analisis konten.  Pengguna mendorong URL situsnya atau situs pesaing dan sebelum menganalisisnya, layanan mengunduh konten ini.  Tonton bagaimana ini terjadi di video: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WS3pJoyWwto" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Untuk mengunduh, layanan mengakses situs yang ditentukan dan perayap mengunduh file <i>sitemap.xml</i> .  Dan ini adalah <i>XML</i> yang sedang kita bicarakan di blok ini. <br>  Dalam video, kita dapat mengamati bagaimana situs penyerang menambahkan definisi entitas eksternal <i>XXE</i> ke <i>sitemap.xml</i> , yang menunjuk ke " <i>file: /// etc / hosts</i> ".  Pada sistem Linux, ini adalah file yang menjelaskan IP mana yang sesuai dengan host jika tidak ada catatan <i>DNS</i> untuk mereka. <br>  Selanjutnya, penyerang menunjukkan dalam <i>tag &lt;loc&gt;</i> perluasan variabel ini.  Setelah itu, parser <i>XML</i> , setelah memproses semua <i>XML</i> di kompartemen, memasukkan nilai yang ada di " <i>file: /// etc / hosts</i> " ke dalam variabel <i>lokasi</i> (disorot dengan warna merah di video). <br>  Penyerang memulai peluncuran parser kami, pergi ke log, dan di sini garis muncul, disorot dengan warna putih pada video.  Ini adalah isi dari file " <i>file: /// etc / hosts</i> " yang diperoleh dalam permintaan <i>GET</i> dalam log server yang dikendalikan olehnya. <br>  Apa selanjutnya  Penyerang akan memverifikasi bahwa dia benar.  Ini akan mengubah nama file menjadi " <i>file: /// etc / fstab</i> ", jalankan parser lagi dan dapatkan statistik tentang proses yang sedang berjalan. <br><br>  Dan akhirnya: " <i>file: /// etc / hostname</i> ", mulai parser, buka log dan dapatkan <i>nama host dari</i> mesin yang kita pakai. <br>  Ini adalah bug nyata yang ditemukan oleh orang sungguhan yang tidak terkait dengan perusahaan kami.  Saya harus menaburkan abu di kepala saya dan membayar uang :) <br><br>  Contoh lain dari <i>XXE</i> : <br><img src="https://habrastorage.org/webt/3t/va/i9/3tvai98kmgwwmpjwh0wjjuzodk0.png"><br>  Misalkan kita memiliki <i>titik akhir</i> tertentu, itu disebut - <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">example.com/xxe</a></i> . <br>  Kami mengirimkan struktur <i>XML</i> kepadanya â†’ dalam <i>XML kami</i> mendeklarasikan entitas <i></i> â†’ entitas <i></i> merujuk ke file sistem <i>/ etc / passwd</i> dan membuka lebih jauh di tubuh respons â†’ kita mendapatkan konten file ini sebagai respons. <br>  Perlu dicatat bahwa ini tidak terjadi sesering yang kita inginkan. <br><br><h3>  Mengapa ini berhasil? </h3><br>  Dokumen <i>XML</i> adalah format data terstruktur yang, antara lain, memungkinkan Anda untuk menggambarkan tipe data yang mungkin dikandungnya menggunakan tag <i>DOCTYPE</i> khusus. <br>  <i>Data Type Definition (DTD)</i> - Definisi tipe data di dalam dokumen <i>XML</i> ini.  Ada tiga opsi untuk bagaimana hal ini dapat dilakukan: <br><ul><li>  Jika dokumen mendukung <i>DTD</i> .  Contoh di bawah ini menunjukkan beberapa <i>XML</i> di mana ada struktur pesanan, ada elemen <i>produk</i> dan elemen <i>hitung</i> (mungkin: nomor persediaan produk dan jumlah item dalam pesanan).  <i>Urutan</i> adalah induk untuk dua elemen ini: <br><img src="https://habrastorage.org/webt/ft/to/kb/fttokbp3vkqsknatvo8yql9p5h4.png"></li><li>  DTD eksternal pada server lokal. <br>  Kami melakukan hal yang sama seperti pada perwujudan pertama, tetapi kami membuat semua definisi dalam file terpisah, yang terletak di server lokal: <br><img src="https://habrastorage.org/webt/qy/re/3m/qyre3m2bfjatzni4bdq6t-3opko.png"><br></li><li>  DTD eksternal pada server pihak ketiga: <br><img src="https://habrastorage.org/webt/wf/dj/tp/wfdjtpme3bh_lnhgiyr56m-p5si.png"></li></ul><br>  Jika Anda seorang pembaca yang penuh perhatian, Anda mungkin telah mengkorelasikan fakta bahwa kemampuan untuk membuat permintaan seperti itu pada layanan Anda dan permintaan skema <i>DTD</i> eksternal adalah kerentanan itu sendiri, yang kita bicarakan di atas, yaitu kerentanan <i>SSRF</i> . <br>  Kejadian umum: pengembang memperbaiki kerentanan <i>XXE</i> , tetapi lupa untuk melarang pemrosesan <i>DTD</i> eksternal dan dapatkan <i>SSRF</i> .  Konsekuensi fatal tidak akan mengikuti dari ini, tetapi Anda tidak boleh melupakannya. <br><br><h3>  Apa itu Entitas dalam XML? </h3><br>  <i>Entitas</i> dalam <i>XML</i> .  Apa ini  Ini adalah kesempatan untuk mendefinisikan nilai-nilai tertentu dan mengarahkannya ke dalam variabel.  Entitas memiliki tiga jenis: <br><img src="https://habrastorage.org/webt/er/lb/h7/erlbh7l8z_adl4nla3ll_tir1rm.png"><br>  <i>Pradefinisi</i> - pradefinisi.  Mirip dengan kode <i>HTML</i> , memungkinkan untuk menggunakan karakter yang merupakan bagian dari sintaks bahasa, sebagai struktur teks.  Di sini mereka diberikan sebagai contoh, sehingga Anda mengerti apa itu.  Ya, dalam kebanyakan serangan mereka tidak digunakan, tetapi mungkin diperlukan dalam beberapa kasus luar biasa. <br>  <i>Umum</i> dan <i>Parameter</i> .  Ini adalah satu dan sama, hanya sintaks deklarasi mereka yang berubah dan bagaimana mereka dapat dipanggil setelah deklarasi <br><br><h3>  Di mana mencari <i>XXE</i> ? </h3><br>  Beberapa pilihan: <br><ul><li>  Pemrosesan <i>XML</i> dalam manifestasi apa pun: <br><ul><li>  <i>SVG;</i> </li><li>  <i>sitemap;</i> </li></ul></li><li>  Konversi <i>HTML</i> ke format lain; </li><li>  Menangani <i>docx</i> , <i>xlsx</i> dan format serupa. </li></ul><br><br><h3>  Bagaimana cara mencarinya? </h3><br><img src="https://habrastorage.org/webt/eo/ce/tl/eocetlpzyfdgocqc2qwv1hbxnhe.png"><br>  Gambar hanya menunjukkan contoh untuk memulai.  Ini bukan kunci universal.  Itu perlu dioptimalkan untuk format yang Anda gunakan dalam layanan yang sedang dipelajari. <br><br>  Hal pertama yang kita lakukan: mendeklarasikan entitas <i>Z</i> tertentu, yang mengakses host yang dikendalikan oleh host yang menyerang, memperluasnya di dalam tubuh dokumen <i>XML</i> . <br>  Di sini opsi kedua dimungkinkan - hanya esensi <i>Parameter</i> .  Berbeda dari iklan pertama (tanda <i>%</i> ).  Dan untuk beralih ke esensi ini, isi dokumen tidak lagi diperlukan.  Kami dapat mengaksesnya langsung dalam struktur <i>DOCTYPE</i> dan mengekspos entitas ini: <br><img src="https://habrastorage.org/webt/3-/hc/xo/3-hcxohtjre3dee0mbed39vlfzq.png"><br>  Skenario ketiga adalah untuk melihat apakah kemampuan untuk meminta <i>DOCTYPE</i> dari layanan eksternal dihidupkan atau dimatikan: <br><img src="https://habrastorage.org/webt/xn/yo/nj/xnyonjotk9gmb4l1ba-d818g3k4.png"><br>  Selanjutnya, kita melihat output dari server yang dikendalikan oleh kami.  Jika kita melihat panggilan ke <i>URL</i> <i>/ periksa</i> dari berbagai alamat <i>IP</i> , itu berarti bahwa dengan tingkat probabilitas yang tinggi kerentanan telah berlalu, dan kemudian kita hanya perlu mencari cara untuk mendapatkan data yang lebih menarik bagi kita. <br><img src="https://habrastorage.org/webt/xl/7d/oz/xl7dozt94jtm9zf3c_zfr39kacq.png"><br>  Apa bahaya dari <i>XXE</i> ?  Saya akan menulis secara singkat dan poin demi poin: <br><ul><li>  Membaca file lokal; </li><li>  Akses ke sumber daya lokal; </li><li>  Pemindaian Port / Host </li><li>  <i>Pembungkus teks biasa</i> .  Ini adalah kesempatan untuk mengakses layanan Anda yang beroperasi pada protokol teks biasa; </li><li>  <i>Eksekusi Kode Jarak Jauh</i> (tidak sering).  Ini mati secara default; </li><li>  <i>DoS</i> .  Karena fakta bahwa entitas dapat digabungkan, dimungkinkan untuk dengan mudah mendapatkan peningkatan eksponensial dalam jumlah memori yang ditempati oleh parameter ini.  Hasilnya adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">serangan tertawa Billion</a> .  Dengan kata lain, Anda hanya membebani memori server yang diserang. </li></ul><br>  Sebagai kesimpulan, saya akan mengatakan bahwa semua ini (artikel, dan pengetahuan apa pun yang Anda peroleh) tidak masuk akal tanpa aplikasi praktis.  Karenanya, saya akan bertanya kepada Anda tentang hal yang sepele: pikirkan tentang aplikasi yang Anda tulis / uji kemarin dan coba periksa kerentanannya.  Apakah ada formulir input atau pemrosesan <i>XML</i> ?  Apakah aplikasi ini dilindungi?  Apakah penyaringan ditambahkan dan <i>DTD</i> dinonaktifkan? <br>  Buka manual <i>SQLmap</i> dan cari tahu cara memeriksa aplikasi Anda dengannya.  Jika dia tidak menemukan apa-apa, ambil alat lain dan memeriksanya, lalu uji aplikasi Anda untuk kerentanan lain.  Seperti yang saya katakan di awal, artikel ini hanya meneliti beberapa kerentanan, tetapi <i>ribuan</i> . <br>  Saya tidak percaya bahwa Anda dapat menulis kode yang benar-benar aman.  Selalu ada kerentanan, Anda <i><u>belum menemukannya</u></i> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id441966/">https://habr.com/ru/post/id441966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id441952/index.html">Memilih sistem penyimpanan file untuk kerja tim</a></li>
<li><a href="../id441954/index.html">Hadiah pengguna untuk penulis Habr</a></li>
<li><a href="../id441956/index.html">Penanganan kesalahan terpadu (opsi C ++ untuk mikrokontroler)</a></li>
<li><a href="../id441962/index.html">Indeks dalam PostgreSQL - 1</a></li>
<li><a href="../id441964/index.html">Kiat & trik Kubernetes: memindahkan sumber daya kluster ke Helm 2</a></li>
<li><a href="../id441968/index.html">Pengembangan cabang produk baru: cara menyingkirkan tidak praktis dan tetap bermanfaat</a></li>
<li><a href="../id441970/index.html">Analisis FinFisher Butkit</a></li>
<li><a href="../id441972/index.html">Invidious - frontend YouTube alternatif</a></li>
<li><a href="../id441974/index.html">Jalan sejarawan dari HR ke programmer Java: sedikit keberuntungan dan ketekunan</a></li>
<li><a href="../id441976/index.html">Dengan Anda FizTech.Science: kami mencari parameter tersembunyi dan terjun ke dunia kuantum yang luar biasa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>