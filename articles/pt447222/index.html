<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚§µÔ∏è ‚ú°Ô∏è üßú Quest do Linux. Parab√©ns aos vencedores e converse sobre a solu√ß√£o de problemas üöÄ üêÄ üïñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="25 de mar√ßo, abrimos o registro para o Linux Quest , este √© um jogo para f√£s e especialistas no sistema operacional Linux. Algumas estat√≠sticas: 1117 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Quest do Linux. Parab√©ns aos vencedores e converse sobre a solu√ß√£o de problemas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/447222/"><img src="https://habrastorage.org/webt/1h/zh/nd/1hzhnd4vk8qks_p2sjyylz-kpy4.png"><br><br>  25 de mar√ßo, abrimos o registro para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Linux Quest</a> , este √© um jogo para f√£s e especialistas no sistema operacional Linux.  Algumas estat√≠sticas: 1117 pessoas registradas para o jogo, 317 delas encontraram pelo menos uma chave, 241 conclu√≠ram com √™xito a tarefa da primeira etapa, 123 - a segunda e 70 passaram a terceira etapa.  Hoje nosso jogo chegou ao fim e parabenizamos nossos vencedores! <br><a name="habracut"></a><br><ul><li>  <b>O primeiro lugar foi ocupado por Alexander Teldekov.</b> <br>  Alexander disse a si mesmo que ele √© o administrador de sistemas mais t√≠pico.  Vive em Volgogrado, administra v√°rios sistemas semelhantes ao Unix por vinte anos.  Conseguiu trabalhar em provedores de Internet, banco, integrador de sistemas.  Agora ele trabalha remotamente em uma pequena empresa, ele est√° envolvido em infraestrutura de nuvem para um grande cliente estrangeiro.  Gosta de ler, ouvir m√∫sica.  Sobre o jogo, Alexander disse que gostou do jogo como um todo, ele ama esses quebra-cabe√ßas.  Em uma das empresas na entrevista em que participei de um Hackerrank semelhante, foi interessante. </li><li>  <b>Segundo lugar - Roman Suslov.</b> <br>  Um romance de Moscou.  Ele tem 37 anos.  Ele trabalha como engenheiro Linux / Unix na Jet Infosystems.  Para o trabalho, tenho que administrar e solucionar problemas de sistemas Linux / Unix + SAN.  Os interesses s√£o muito diferentes: sistemas Linux, programa√ß√£o, engenharia reversa, seguran√ßa da informa√ß√£o, Arduino.  Sobre o jogo, Roman observou que geralmente gostava do jogo.  ‚ÄúFlexionei um pouco meu giro e me distra√≠ da vida cotidiana cinzenta do trabalho cotidiano.  :) Gostaria de mais tarefas, caso contr√°rio n√£o teria tempo de provar como o jogo j√° havia terminado. " </li><li>  <b>O terceiro √© alex3d.</b> <br>  Alex mora em Moscou, est√° envolvido no desenvolvimento de software.  "Obrigado pelo concurso, foi interessante verificar sua habilidade no google-fu". </li></ul><br>  Tamb√©m no ranking dos 10 melhores jogadores: <br><br><ul><li>  Yevgeniy saldayev </li><li>  Markel Mokhnachevsky </li><li>  Konstantin Konosov </li><li>  Pavel Sergeev </li><li>  Vladimir Bovaev </li><li>  Ivan Bubnov </li><li>  Pavlo klets </li></ul><br>  Entendemos que existem muitas op√ß√µes para resolver todos os nossos problemas. Uma das solu√ß√µes poss√≠veis √© descrita abaixo. <br><br><h3>  1. A primeira etapa </h3><br>  N√≥s o chamamos de ‚ÄúVoc√™ tem certeza do administrador?‚Äù, Porque a tarefa era bastante simples - consertar um servi√ßo de l√¢mpada quente. <br><br><h4>  1.1  Fatos interessantes: </h4><br>  Dois jogadores encontraram a primeira chave nos primeiros 15 minutos do jogo e, na primeira hora, tivemos tr√™s l√≠deres que lidaram com a tarefa. <br><br><h4>  1.2  Tarefa </h4><br>  Voc√™ foi trabalhar para uma empresa em que por um longo tempo n√£o havia um especialista em TI competente.  Antes de come√ßar a limpar, voc√™ precisa resolver um problema de queima que bloqueia o trabalho do escrit√≥rio. <br><br>  Uma faxineira passou o cabo de for√ßa no gabinete do servidor.  Energia restaurada, mas um site muito importante ainda n√£o funciona.  O site √© importante porque a empresa n√£o est√° muito preocupada com a seguran√ßa das informa√ß√µes e, na p√°gina principal, voc√™ encontra a senha do administrador no computador do CEO em texto n√£o criptografado. <br><br>  Outro dia, a senha foi alterada, mas todo mundo esqueceu a nova, o diretor n√£o pode trabalhar.  Dizem que havia chaves nesta m√°quina que poderiam nos ajudar a descriptografar o backup de documentos cont√°beis. <br><br>  Todo mundo est√° esperando uma solu√ß√£o r√°pida para o problema! <br><br><h4>  1.3  Solu√ß√£o </h4><br>  1. Primeiro, voc√™ precisa alterar a senha root na m√°quina virtual para obter acesso a ela.  Na inicializa√ß√£o, percebemos que este √© o Ubuntu 16.04 Server. <br><br>  Para redefinir a senha root, reiniciamos a m√°quina, na inicializa√ß√£o, quando o menu grub √© exibido, v√° para a edi√ß√£o do item Ubuntu com o bot√£o "e".  Editamos a linha linux, adicionamos <code>init=/bin/bash</code> ao final.  Carregamos atrav√©s de Ctrl + x, obtemos o bash.  Remonte a raiz com rw, altere a senha: <br><br><pre> <code class="bash hljs">$ mount -o remount,rw /dev/mapper/ubuntu--vg-root $ passwd</code> </pre> <br>  N√£o se esque√ßa da sincroniza√ß√£o, reinicie. <br><br>  2. A condi√ß√£o diz que o servidor da web n√£o funciona para n√≥s, procuramos: <br><br><pre> <code class="bash hljs">$ curl localhost Not Found The requested URL / was not found on this server. Apache/2.4.18</code> </pre> <br>  Na verdade, o Apache est√° em execu√ß√£o, mas responde com o c√≥digo 404. Observamos a configura√ß√£o: <br><br><pre> <code class="bash hljs">$ vim /etc/apache2/sites-enabled/000-default.conf</code> </pre> <br>  H√° tamb√©m uma chave - StevenPaulSteveJobs. <br><br>  Verificamos o caminho <code>/usr/share/WordPress</code> - n√£o √©, mas existe <code>/usr/share/wordpress</code> .  Corrigimos a configura√ß√£o e reiniciamos o Apache. <br><br><pre> <code class="bash hljs">$ systemctl restart apache2</code> </pre> <br>  3. Tentamos novamente, recebemos um erro: <br><br><pre> <code class="bash hljs">Warning: mysqli_real_connect(): (HY000/2002): Connection refused <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /usr/share/wordpress/wp-includes/wp-db.php on line 1488</code> </pre> <br>  O banco de dados n√£o est√° em execu√ß√£o? <br><br><pre> <code class="bash hljs">$ systemctl status mysql Active: active (running)</code> </pre> <br>  Qual √© o problema?  √â necess√°rio entender.  Para fazer isso, voc√™ precisa acessar o MySQL, como fazer isso √© descrito na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> .  Um dos pontos na documenta√ß√£o recomenda que escrevamos a op√ß√£o <code>skip-grant-tables</code> em <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code> .  Aqui tamb√©m est√° a chave - AugustaAdaKingByron. <br><br>  N√≥s corrigimos os direitos do usu√°rio <code>'wp'@'localhost'</code> .  Iniciamos o MySQL, o tornamos acess√≠vel atrav√©s da rede, comentando a op√ß√£o <code>skip-networking</code> na configura√ß√£o. <br><br>  4. Ap√≥s as a√ß√µes tomadas, o servidor da web √© iniciado, mas o site ainda n√£o funciona, como <br><br><pre> <code class="bash hljs">Warning: require_once(/usr/share/wordpress/wp-content/themes/twentysixteen/footer.php): failed to open stream: Permission denied <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /usr/share/wordpress/wp-includes/template.php on line 562</code> </pre> <br>  Corrigimos os direitos do arquivo. <br><br><pre> <code class="bash hljs">$ chmod 644 /usr/share/wordpress/wp-content/themes/twentysixteen/footer.php</code> </pre><br>  Atualizamos a p√°gina, acessamos o site e encontramos a chave - BjarneStroustrup!  Encontramos as tr√™s chaves, nosso diretor pode trabalhar, descriptografamos os arquivos cont√°beis.  Todos est√£o felizes e voc√™ tem muito trabalho pela frente para estabelecer infraestrutura, backups e seguran√ßa na empresa. <br><br><h3>  2. A segunda etapa </h3><br>  Foi necess√°rio resolver o problema de coletar an√°lises.  Todo mundo adora an√°lises - quem, onde e em que quantidades.  Chegamos a um caso que todos os engenheiros da vida podem encontrar de uma forma ou de outra. <br><br><h4>  2.1  Fatos interessantes </h4><br>  Um de nossos jogadores digitou a chave correta nos primeiros 10 minutos do jogo e, na primeira hora, conseguimos um l√≠der que lidou com a tarefa. <br><br><h4>  2.2  Tarefa </h4><br>  Voc√™ foi trabalhar na empresa, os gerentes foram at√© voc√™ e pediram para descobrir para quem as cartas foram enviadas da √Åfrica.  Voc√™ precisa criar os 21 principais endere√ßos de destinat√°rios.  As primeiras letras dos endere√ßos dos destinat√°rios s√£o a chave.  Uma coisa: o servidor de correio pelo qual as cartas foram enviadas n√£o carrega.  Todo mundo est√° esperando uma solu√ß√£o r√°pida para o problema! <br><br><h4>  2.3  Solu√ß√£o </h4><br>  1. O servidor n√£o √© carregado devido √† parti√ß√£o de swap inexistente no fstab, na inicializa√ß√£o, o sistema tenta mont√°-lo e trava.  Como inicializar? <br><br>  Fa√ßa o download da imagem, baixamos o CentOS 7, inicialize a partir do Live CD / DVD (Solu√ß√£o de problemas -&gt; Recupera√ß√£o), monte o sistema, edite o <code>/etc/fstab</code> .  Aqui encontramos a primeira chave - GottfriedWilhelm11646Leibniz! <br><br>  Crie uma troca: <br><br><pre> <code class="bash hljs">$ lvcreate -n swap centos -L 256M $ sync &amp;&amp; reboot</code> </pre> <br>  2. Como sempre, n√£o h√° senha, voc√™ precisa alterar a senha root na m√°quina virtual.  J√° fizemos isso na primeira tarefa.  Mudamos e vamos com sucesso para o servidor, mas ele √© imediatamente reiniciado.  O servidor est√° sobrecarregado a uma velocidade que voc√™ nem tem tempo para examinar todos os logs com aten√ß√£o.  Como entender o que est√° acontecendo? <br><br>  Novamente, inicializamos a partir do livecd, estudamos cuidadosamente os logs do sistema e, no caso de procurarmos em coroas, desde essa frequ√™ncia.  A√≠ encontramos o problema e a segunda chave √© Alan1912MathisonTuring! <br><br>  √â necess√°rio excluir ou comentar a linha <code>echo b &gt; /proc/sysrq-trigger</code> em <code>/etc/crontab</code> . <br><br>  3. Depois disso, o servidor inicializou e voc√™ pode concluir a tarefa dos gerentes: "Quais s√£o os endere√ßos da √Åfrica?"  Esta informa√ß√£o est√° geralmente dispon√≠vel ao p√∫blico.  Voc√™ pode encontrar essas informa√ß√µes na Internet usando as frases ‚Äúip address africa‚Äù, ‚Äúgeoip database‚Äù.  Para resolver o problema, voc√™ pode usar as bases de distribui√ß√£o de endere√ßos dispon√≠veis gratuitamente (geoip).  Utilizamos o banco de dados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MaxMind GeoLite2</a> , dispon√≠vel sob a licen√ßa Creative Commons Attribution-ShareAlike 4.0, como refer√™ncia. <br><br>  Vamos tentar resolver nosso problema usando apenas utilit√°rios de sistema Linux, mas em geral ele pode ser resolvido de v√°rias maneiras: usando utilit√°rios de filtragem de texto e scripts em v√°rias linguagens de programa√ß√£o. <br><br>  Para come√ßar, apenas obtemos os pares "IP remetente - destinat√°rio" no log de correio <code>/var/log/maillog</code> ( <code>/var/log/maillog</code> criar uma tabela de destinat√°rios por email - remetente IP).  Isso pode ser feito com o seguinte comando: <br><br><pre> <code class="bash hljs">$ cat /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/maillog | fgrep -e <span class="hljs-string"><span class="hljs-string">' connect from'</span></span> -e <span class="hljs-string"><span class="hljs-string">'status=sent'</span></span> | sed <span class="hljs-string"><span class="hljs-string">'s/[]&lt;&gt;[]/ /g'</span></span> | awk <span class="hljs-string"><span class="hljs-string">'/connect from/ {ip=$11} /status=sent/ {print $10" "ip}'</span></span> &gt; log1.txt</code> </pre> <br>  E antes de continuarmos a compila√ß√£o do banco de dados de endere√ßos africanos, examinamos os principais endere√ßos IP dos remetentes. <br><br><pre> <code class="bash hljs">$ cat log1.txt | cut -d<span class="hljs-string"><span class="hljs-string">' '</span></span> -f1 | sort | uniq -c | sort -r | head -n 40 5206 L2JhbjAbM67GA99jg@mail.ru 4165 iHKTBkegOQa6fIALq@mail.ru 3739 nHkcBl7BdgXxijSYD7@mail.ru 3405 SMAzPJAzbl9vp4hAXo@mail.ru 3346 xILz6d7P@mail.ru</code> </pre><br>  Entre todos, os tr√™s primeiros destinat√°rios do topo destacam-se claramente pelo n√∫mero de letras.  Se voc√™ cumprimentar os endere√ßos IP dos remetentes que foram enviados para os endere√ßos deste top 3, poder√° ver a clara predomin√¢ncia de determinadas redes: <br><br><pre> <code class="bash hljs">$ cat log1.txt | fgrep <span class="hljs-string"><span class="hljs-string">'L2JhbjAbM67GA99jg@mail.ru'</span></span> | cut -d<span class="hljs-string"><span class="hljs-string">' '</span></span> -f2 | sort | cut -d<span class="hljs-string"><span class="hljs-string">'.'</span></span> -f1 | uniq -c | sort -r | head 831 105 806 41 782 197 664 196 542 154 503 102 266 156 165 45 150 160 108 165</code> </pre> <br>  A maioria das redes 105/8, 41/8, 196 / 8.197 / 8 √© alocada pelo AFRINIC - um dos cinco registradores regionais da Internet que distribuem recursos da Internet.  AFRINIC distribui espa√ßo de endere√ßo na √Åfrica.  E 41/8 refere-se ao AFRINIC completamente. <br><br><pre> <code class="bash hljs">https://www.nic.ru/whois/?searchWord=105.0.0.0 https://www.nic.ru/whois/?searchWord=41.0.0.0</code> </pre><br>  Assim, a resposta para o problema, de fato, est√° no pr√≥prio log. <br><br><pre> <code class="bash hljs">$ cat log1.txt | fgrep -e <span class="hljs-string"><span class="hljs-string">'105.'</span></span> -e <span class="hljs-string"><span class="hljs-string">'41.'</span></span> -e <span class="hljs-string"><span class="hljs-string">'196.'</span></span> -e <span class="hljs-string"><span class="hljs-string">'197.'</span></span> -e <span class="hljs-string"><span class="hljs-string">'154.'</span></span> -e <span class="hljs-string"><span class="hljs-string">'102.'</span></span> | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span> | sort | uniq -c | sort -r | head -n 21 4209 L2JhbjAbM67GA99jg@mail.ru 3313 iHKTBkegOQa6fIALq@mail.ru 2704 nHkcBl7BdgXxijSYD7@mail.ru 2215 uvRbp1O@mail.ru 1774 sPmMsmmFiV@mail.ru 1448 BtG3aHgQgCKuze2AKuRH@mail.ru 1233 eQpuuQ2uQdbwRL3@mail.ru 958 nJT5dpaBZ@mail.ru 862 ef4WbQiB@mail.ru 762 dQCqKL6eVminFfH7wLA@mail.ru 632 ifq6Rd1HxuCQOdO9@mail.ru 539 cFwm2ssypMmx1sA7@mail.ru 531 twtTnr4G@mail.ru 431 TSrczgYASrR11Hs3qCi@mail.ru 380 o3r3exc3OL@mail.ru 357 rzmjr2VAHK@mail.ru 348 vnPr6YjJ3ndw@mail.ru 312 anOjFXrwOtLP2Rl1Vcz6@mail.ru 289 dvny5zHmRW8fiT@mail.ru 282 sgg9jPxFDYvzw8Kr@mail.ru 274 tKSevzA7GntJ@mail.ru</code> </pre> <br>  Neste ponto, obtemos a string "LinuxBenedictTorvadst". <br><br>  A chave correta √© LinusBenedictTorvalds. <br><br>  A sequ√™ncia resultante cont√©m um erro de digita√ß√£o em rela√ß√£o √† chave correta em 3 caracteres extremos.  Isso se deve ao fato de que as redes que escolhemos n√£o s√£o totalmente alocadas aos pa√≠ses africanos e como os e-mails s√£o distribu√≠dos por endere√ßos IP em nosso registro. <br><br>  Com esclarecimentos suficientes das maiores redes alocadas aos pa√≠ses africanos, voc√™ pode obter a resposta exata: <br><br><pre> <code class="bash hljs">$ cat log1.txt | fgrep -e<span class="hljs-string"><span class="hljs-string">' '</span></span>105.{30..255}. -e<span class="hljs-string"><span class="hljs-string">' '</span></span>41. -e<span class="hljs-string"><span class="hljs-string">' '</span></span>196.{64..47}. -e<span class="hljs-string"><span class="hljs-string">' '</span></span>196.{248..132}. -e<span class="hljs-string"><span class="hljs-string">' '</span></span>197.{160..31}. -e<span class="hljs-string"><span class="hljs-string">' '</span></span>154.{127..255}. -e<span class="hljs-string"><span class="hljs-string">' '</span></span>102.{70..255}. -e<span class="hljs-string"><span class="hljs-string">' '</span></span>156.{155..255}. | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span> | sort | uniq -c | sort -r | head -n 21 3350 L2JhbjAbM67GA99jg@mail.ru 2662 iHKTBkegOQa6fIALq@mail.ru 2105 nHkcBl7BdgXxijSYD7@mail.ru 1724 uvRbp1O@mail.ru 1376 sPmMsmmFiV@mail.ru 1092 BtG3aHgQgCKuze2AKuRH@mail.ru 849 eQpuuQ2uQdbwRL3@mail.ru 712 nJT5dpaBZ@mail.ru 584 ef4WbQiB@mail.ru 463 dQCqKL6eVminFfH7wLA@mail.ru 365 ifq6Rd1HxuCQOdO9@mail.ru 269 cFwm2ssypMmx1sA7@mail.ru 225 twtTnr4G@mail.ru 168 TSrczgYASrR11Hs3qCi@mail.ru 142 o3r3exc3OL@mail.ru 111 rzmjr2VAHK@mail.ru 96 vnPr6YjJ3ndw@mail.ru 78 anOjFXrwOtLP2Rl1Vcz6@mail.ru 56 lHzWiB7ExvRtSbAcU9@mail.ru 56 dvny5zHmRW8fiT@mail.ru 40 sgg9jPxFDYvzw8Kr@mail.ru</code> </pre> <br>  O problema tamb√©m pode ser resolvido de outra maneira. <br>  Baixe o MaxMind, descompacte e as tr√™s equipes a seguir tamb√©m resolvem nosso problema. <br><br><pre> <code class="bash hljs">$ cat GeoLite2-Country-Locations-ru.csv | grep <span class="hljs-string"><span class="hljs-string">""</span></span> | cut -d<span class="hljs-string"><span class="hljs-string">','</span></span> -f1 &gt; africaIds.txt $ grep -Ff africaIds.txt GeoLite2-Country-Blocks-IPv4.csv | cut -d<span class="hljs-string"><span class="hljs-string">','</span></span> -f1 &gt; africaNetworks.txt $ grepcidr -f africaNetworks.txt log1.txt | cut -d<span class="hljs-string"><span class="hljs-string">' '</span></span> -f1 | sort | uniq -c | sort -r | head -n21</code> </pre><br>  De uma maneira ou de outra, finalmente contamos as estat√≠sticas e os gerentes obtiveram os dados necess√°rios para trabalhar! <br><br><h3>  3. Terceira etapa </h3><br>  O terceiro est√°gio √© um pouco semelhante ao primeiro - voc√™ tamb√©m precisa corrigir o servi√ßo da l√¢mpada quente, mas √© mais dif√≠cil do que na primeira tarefa. <br><br><h4>  3.1  Fatos interessantes </h4><br>  Nos primeiros 15 minutos, tr√™s jogadores encontraram a primeira chave, 2 horas e 20 minutos ap√≥s o in√≠cio da etapa, nosso vencedor completou a tarefa. <br><br><h4>  3.2  Tarefa </h4><br>  Voc√™ foi trabalhar em uma empresa na qual todos os documentos da empresa s√£o armazenados no servidor Wiki interno.  No ano passado, um engenheiro encomendou tr√™s novos discos para o servidor, al√©m de um existente, argumentando que, para toler√¢ncia a falhas do sistema, √© necess√°rio colocar discos em algumas matrizes.  Infelizmente, algumas semanas ap√≥s a instala√ß√£o, o engenheiro foi descansar na √çndia e n√£o voltou. <br><br>  Por v√°rios anos, o servidor funcionou sem falhas, mas h√° alguns dias a rede da empresa foi invadida.  De acordo com as instru√ß√µes, os agentes de seguran√ßa removeram os discos do servidor e os enviaram para voc√™.  Durante o transporte, um disco foi irremediavelmente perdido. <br><br>  Voc√™ precisa restaurar o wiki, antes de tudo, o conte√∫do das p√°ginas do wiki √© interessante.  Um peda√ßo de texto que estava em uma das p√°ginas deste wiki √© uma senha de um servidor 1C e √© urgentemente necess√°rio para desbloque√°-lo. <br><br>  Al√©m disso, em algum lugar nas p√°ginas wiki ou em outro lugar, havia senhas do servidor de registro e do servidor de vigil√¢ncia por v√≠deo, que tamb√©m s√£o desej√°veis ‚Äã‚Äãde serem recuperadas, sem elas √© imposs√≠vel investigar o incidente.  Como sempre, eles s√£o esperados de uma solu√ß√£o operacional para o problema! <br><br><h4>  3.3  Solu√ß√£o </h4><br>  1. Tentamos inicializar a partir das unidades que possu√≠mos e em todos os lugares recebemos a mesma mensagem: <br><br><pre> <code class="bash hljs">No bootable medium found! System halted</code> </pre><br>  √â necess√°rio inicializar a partir de algo.  Recupera novamente a inicializa√ß√£o de um Live CD / DVD (Solu√ß√£o de problemas -&gt; Recuperar).  Ao inicializar, tentamos encontrar a parti√ß√£o de inicializa√ß√£o, n√£o encontramos, entramos no shell.  Estamos tentando aprender o que e como com os discos.  Sabe-se que existem tr√™s deles.  Existem mais ferramentas para isso na 7¬™ vers√£o do CentOS, onde existem <code>lsblk</code> ou <code>lsblk</code> que nos mostram todas as informa√ß√µes sobre os discos. <br><br>  Como e o que fazer: <br><br><pre> <code class="bash hljs">$ ls /dev/sd*</code> </pre> <br>  √â imediatamente claro que <br><br><pre> <code class="bash hljs">/dev/sdb1 - ext4 /dev/sdb2 -  lvm /dev/sda1  /dev/sdc1 -   /dev/sda2  /dev/sdc2 -        </code> </pre> <br>  Monte sdb1, √© claro que esta √© a parti√ß√£o de inicializa√ß√£o do CentOS 6. <br><br><pre> <code class="bash hljs">$ mkdir /mnt/sdb1 &amp;&amp; mount /dev/sdb1 /mnt/sdb1</code> </pre> <br>  Obviamente, vamos para a se√ß√£o grub e encontramos a primeira chave l√° - James191955Gosling em um arquivo incomum. <br><br>  2. Estudamos pvs e lvs, enquanto trabalhamos com o LVM.  Vemos que deve haver 2 volumes f√≠sicos, um n√£o est√° localizado e xinga o uid perdido.  Vemos que deve haver 2 volumes logicamente: root e swap, enquanto o root est√° parcialmente perdido (o atributo P do volume).  Mount n√£o funciona, mas desculpe!  N√≥s realmente precisamos dele. <br><br>  Existem mais 2 discos, olhe para eles, monte e monte: <br><br><pre> <code class="bash hljs">$ mdadm --examine --verbose --scan $ mdadm --assemble --verbose --scan $ mkdir /mnt/md127 &amp;&amp; mount /dev/md127 /mnt/md127</code> </pre> <br>  Olhamos, est√° claro que esta √© a parti√ß√£o de inicializa√ß√£o do CentOS 6 e uma amostra do que j√° est√° em <code>/dev/sdb1</code> , e aqui novamente a mesma chave √© James191955Gosling! <br><br>  N√≥s olhamos como o <code>/dev/md127</code> . <br><br><pre> <code class="bash hljs">$ mdadm --detail /dev/md127</code> </pre><br>  Vimos que ele teve que ser montado a partir de 4 discos, montado a partir de dois <code>/dev/sda1</code> e <code>/dev/sdc1</code> , eles deveriam ser os n√∫meros 2 e 4 no sistema.  Assumimos que voc√™ tamb√©m pode criar uma matriz a partir de <code>/dev/sda2</code> e <code>/dev/sdc2</code> .  N√£o est√° claro por que n√£o h√° metadados neles, mas isso est√° na consci√™ncia do administrador, que est√° em algum lugar em Goa.  Assumimos que deve haver RAID10, embora haja op√ß√µes.  N√≥s coletamos: <br><br><pre> <code class="bash hljs">$ mdadm --create --verbose /dev/md0 --assume-clean --level=10 --raid-devices=4 missing /dev/sda2 missing /dev/sdc2</code> </pre><br>  Olhamos para blkid, pvs, lvs.  Descobrimos que coletamos um volume f√≠sico que antes n√£o possu√≠amos. <br><br>  N√≥s imediatamente corrigimos o lvroot, montamos, mas primeiro ativamos o VG: <br><br><pre> <code class="bash hljs">$ vgchange -ay $ mkdir /mnt/lvroot &amp;&amp; mount /dev/mapper/vg_c6m1-lv_root /mnt/lvroot</code> </pre><br>  E tudo est√° l√°, incluindo a chave DennisBMacAlistairCRitchie - no diret√≥rio inicial raiz - <code>/root/sweet</code> . <br><br>  3. No entanto, estamos tentando reviver nosso servidor para que ele inicie normalmente.  Todo o volume l√≥gico c do nosso <code>/dev/md0</code> (onde temos tudo) √© arrastado para <code>/dev/sdb2</code> , onde todo o servidor trabalhou inicialmente. <br><br><pre> <code class="bash hljs">$ pvmove /dev/md0 /dev/sdb2 $ vgreduce vg_c6m1 /dev/md0</code> </pre> <br>  Extingu√≠mos o servidor, removemos 1 e 3 discos, deixamos o segundo, inicializamos a partir do Live CD / DVD no Rescue.  Encontramos a se√ß√£o de inicializa√ß√£o, restaure o gerenciador de inicializa√ß√£o no grub: <br><br><pre> <code class="bash hljs">root (hd0,0) setup (hd0)</code> </pre><br>  Separamos o disco de inicializa√ß√£o e inicializamos com √™xito, mas o site n√£o funciona. <br><br>  4. Existem duas op√ß√µes para iniciar o site: configure o Apache a partir do zero ou use o nginx j√° configurado previamente com o php-fpm: <br><br><pre> <code class="bash hljs">$ /etc/init.d/nginx start $ /etc/init.d/php-fpm start</code> </pre><br>  Finalmente, voc√™ precisa iniciar o MySQL: <br><br><pre> <code class="bash hljs">$ /etc/init.d/mysqld start</code> </pre> <br>  Ele n√£o inicia e a solu√ß√£o est√° em <code>/var/log/mysql</code> .  Assim que voc√™ resolver o problema com o MySQL, o site funcionar√°, haver√° uma chave na p√°gina principal - RichardGCCMatthewGNUStallman!  Agora temos acesso ao 1C, e os funcion√°rios poder√£o receber o pagamento.  E, como sempre, voc√™ tem muito trabalho pela frente para construir infraestrutura e seguran√ßa na empresa. <br><br>  Tamb√©m podemos compartilhar novamente uma lista de livros que nos ajudaram e nossos participantes a se prepararem para o jogo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">linux.mail.ru/books</a> . <br><br>  Obrigado por estar conosco!  Siga os an√∫ncios dos pr√≥ximos jogos! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt447222/">https://habr.com/ru/post/pt447222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt447210/index.html">@Pythonetc compilation Mar√ßo de 2019</a></li>
<li><a href="../pt447212/index.html">Dicas e truques do meu canal de telegrama @pythonetc, mar√ßo de 2019</a></li>
<li><a href="../pt447214/index.html">Como melhorar o design do jogo com estrat√©gias ideais</a></li>
<li><a href="../pt447218/index.html">An√°lise do JPoint 2019</a></li>
<li><a href="../pt447220/index.html">No√ß√µes b√°sicas do mecanismo JavaScript: formul√°rios gerais e cache embutido. Parte 2</a></li>
<li><a href="../pt447226/index.html">Entrevista com o popularizador da ci√™ncia, diretor da √∫nica escola particular de astronomia da R√∫ssia, Pavel Skripnichenko</a></li>
<li><a href="../pt447232/index.html">Experi√™ncia pessoal. Como conectamos a telefonia internacional: compara√ß√£o de 6 trocas virtuais</a></li>
<li><a href="../pt447234/index.html">Como escrever programas polim√≥rficos usando o Arrow</a></li>
<li><a href="../pt447236/index.html">Criando um farm de dispositivos Android usando o Open STF</a></li>
<li><a href="../pt447240/index.html">Aprenda t√°ticas, t√©cnicas e conhecimentos comuns do advers√°rio (ATT @ CK). T√°ticas corporativas. Parte 10</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>