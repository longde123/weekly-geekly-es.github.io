<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé± üíÉüèª üë®üèæ‚Äçüî¨ WebGL-wind y programaci√≥n de GPU. Conferencia en FrontTalks 2018 üéá üê´ üë∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Para representar gr√°ficos complejos en p√°ginas web, hay una Biblioteca de gr√°ficos web, abreviada como WebGL. El dise√±ador de interfaces Dmitry Vasili...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WebGL-wind y programaci√≥n de GPU. Conferencia en FrontTalks 2018</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/433278/">  Para representar gr√°ficos complejos en p√°ginas web, hay una Biblioteca de gr√°ficos web, abreviada como WebGL.  El dise√±ador de interfaces Dmitry Vasiliev habl√≥ sobre la programaci√≥n de GPU desde el punto de vista de un dise√±ador de dise√±o, sobre qu√© es WebGL y c√≥mo resolvimos el problema de visualizar datos meteorol√≥gicos de gran tama√±o utilizando esta tecnolog√≠a. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-yvY4-ovavo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - Estoy desarrollando interfaces en la oficina de Yandex en Ekaterimburgo.  Empec√© en el grupo Sport.  Desarrollamos proyectos deportivos especiales cuando hubo Campeonatos Mundiales de hockey, f√∫tbol, ‚Äã‚ÄãJuegos Ol√≠mpicos, Juegos Paral√≠mpicos y otros eventos geniales.  Tambi√©n trabaj√© en el desarrollo de resultados de b√∫squeda especiales, que se dedicaron a la nueva pista de Sochi. <br><br><a name="habracut"></a><img src="https://habrastorage.org/webt/5p/l2/e_/5pl2e_nhpyefyjt0q3wfspflpyc.jpeg"><br><br><img src="https://habrastorage.org/webt/qw/zy/xd/qwzyxdlvu0jukewd-9prrerk-a8.jpeg"><br><br><img src="https://habrastorage.org/webt/uy/7b/mp/uy7bmpkufgne4mck5yiawv3mj1o.jpeg"><br><br><img src="https://habrastorage.org/webt/q6/cu/kw/q6cukwvmpmwru6iew_ranhk7mwo.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  Adem√°s, en uno y medio cascos, reiniciamos el servicio Trabajar en errores.  Y luego comenz√≥ el trabajo en Pogoda, donde me compromet√≠ a apoyar la operabilidad de la API, su desarrollo, escribir la infraestructura en torno a esta API y escribir carpetas de nodos para las f√≥rmulas de aprendizaje autom√°tico capacitadas. <br><br><img src="https://habrastorage.org/webt/sz/xs/zy/szxszynumbssi9qyhkxwalfmsdy.jpeg"><br><br>  Entonces el trabajo comenz√≥ m√°s interesante.  Particip√≥ en el redise√±o de nuestros servicios meteorol√≥gicos.  Escritorios, carretillas. <br><br><img src="https://habrastorage.org/webt/io/q4/cw/ioq4cwweh1vbjyqonlto5yuo_1e.jpeg"><br><br><img src="https://habrastorage.org/webt/ij/er/w6/ijerw62hpfkj2kvph4wvuag_www.jpeg"><br><br>  Despu√©s de ordenar los pron√≥sticos est√°ndar, decidimos hacer el pron√≥stico que nadie tiene.  Este pron√≥stico fue el pron√≥stico del movimiento de precipitaci√≥n en los territorios. <br><br><img src="https://habrastorage.org/webt/xc/n_/cf/xcn_cfakd_xnyoxaazxgc4bvmso.jpeg"><br><br>  Existen radares meteorol√≥gicos especiales que detectan precipitaciones en un radio de 2000 km, conocen su densidad y distancia a ellos. <br><br><img src="https://habrastorage.org/webt/as/ea/av/aseaavvwl0v3lqhex1kx_dvsr1w.jpeg"><br><br>  Utilizando estos datos y prediciendo con la ayuda del aprendizaje autom√°tico de su movimiento adicional, realizamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tal visualizaci√≥n</a> en el mapa.  Puedes moverte de un lado a otro. <br><br><img src="https://habrastorage.org/webt/jt/qo/fj/jtqofjz8eo8wrjybcydczpxse0a.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  Miramos las cr√≠ticas de las personas.  A la gente le gust√≥.  Comenzaron a aparecer todo tipo de memes, y hab√≠a im√°genes geniales cuando Mosc√∫ estaba inundando el infierno. <br><br>  Como a todos les gust√≥ el formato, decidimos seguir adelante y dedicar el siguiente pron√≥stico al viento. <br><br><img src="https://habrastorage.org/webt/kl/mc/_f/klmc_fqnedxn-okos6d6bhmlszs.jpeg"><br><br>  Los servicios que muestran el pron√≥stico del viento ya est√°n all√≠.  Este es un par de elegantes que se destacan. <br><br><img src="https://habrastorage.org/webt/vo/vc/4k/vovc4kev5lhxvyph9t46z4uhei8.jpeg"><br><br>  Al mirarlos, nos dimos cuenta de que queremos hacer lo mismo, o al menos no peor. <br><br>  Por lo tanto, decidimos visualizar part√≠culas que se mueven suavemente en el mapa dependiendo de la velocidad del viento, y dejar atr√°s alg√∫n tipo de bucle para que se puedan ver, se puede ver la trayectoria del viento. <br><br>  Como ya somos geniales e hicimos un mapa genial con precipitaci√≥n usando un lienzo 2D, decidimos hacer lo mismo con las part√≠culas. <br><br><img src="https://habrastorage.org/webt/hz/jd/yi/hzjdyivbulbjmfod7n2-nix8uca.jpeg"><br><br>  Despu√©s de consultar con el dise√±ador, nos dimos cuenta de que necesitamos llenar aproximadamente el 6% de la pantalla con part√≠culas para tener un efecto genial. <br><br>  Para dibujar tal cantidad de part√≠culas usando el enfoque est√°ndar, tuvimos un tiempo m√≠nimo de 5 ms. <br><br><img src="https://habrastorage.org/webt/yu/l1/7n/yul17ngn7dfm6cadtcy2dpkf6zu.jpeg"><br><br>  Si cree que todav√≠a necesitamos mover las part√≠culas y aportar alg√∫n tipo de belleza, como dibujar la cola de las part√≠culas, podemos suponer que nos caeremos por un tiempo m√≠nimo de 40 ms para mostrar una animaci√≥n suave para producir al menos 25 fotogramas por segundo. <br><br>  El problema es que aqu√≠ cada part√≠cula se procesar√° secuencialmente.  Pero, ¬øy si los procesas en paralelo? <br><br>  "Destructores de leyendas" mostr√≥ una clara distinci√≥n entre el funcionamiento de los procesadores centrales y gr√°ficos en una de las conferencias.  Lanzaron una m√°quina en la que se instal√≥ un marcador de paintball, cuya tarea era dibujar una carita sonriente en un color.  En unos 10 segundos, dibuj√≥ esa imagen.  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace al video</a> - aprox. Ed.) <br><br><img src="https://habrastorage.org/webt/kk/pi/cw/kkpicwfdskxnicbu0jb7sowhgfq.jpeg"><br><br><img src="https://habrastorage.org/webt/zd/ka/3a/zdka3al72tgfcavb5yvww_qx2ug.jpeg"><br><br><img src="https://habrastorage.org/webt/i9/tm/kh/i9tmkhykoiz8vkim-vzftxjjl44.jpeg"><br><br>  Luego, los chicos lanzaron una canoa, que es una GPU, y un par de asadores pintaron a Mona Lisa.  As√≠ es como la velocidad de c√°lculo de la CPU y la GPU es diferente. <br><br><img src="https://habrastorage.org/webt/dm/x-/hc/dmx-hckqzdlztdat2wm-j88cj-k.jpeg"><br><br><img src="https://habrastorage.org/webt/zg/pa/3m/zgpa3m281vzirvjqotbuoqnmms8.jpeg"><br><br><img src="https://habrastorage.org/webt/hq/lf/uj/hqlfujoqgr4mhgxucjpx7xnmedu.jpeg"><br><br><img src="https://habrastorage.org/webt/qb/zo/xz/qbzoxzq0tywqxi0pc2xifdnvnds.jpeg"><br><br><img src="https://habrastorage.org/webt/d6/z5/kq/d6z5kq5c23fjmb2uzfx4aqqj3ec.jpeg"><br><br>  Para aprovechar tales caracter√≠sticas en un navegador, se invent√≥ la tecnolog√≠a WebGL. <br><br>  Que es esto  Con esta pregunta, me sub√≠ a Internet.  Agregando un par de palabras con animaci√≥n de part√≠culas y viento, encontr√© un par de art√≠culos. <br><br><img src="https://habrastorage.org/webt/ob/d-/w_/obd-w_edp80lvmzlh3xmh437itw.jpeg"><br><h5>  <sub><sup>Enlaces de la diapositiva: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primero</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">segundo</a></sup></sub> </h5><br>  Uno de ellos es la demostraci√≥n de Vladimir Agafonkin, un ingeniero de Mapbox, que se puso al d√≠a con WebGL y se refiri√≥ al blog de Chris Wellons, quien habl√≥ sobre c√≥mo mover y almacenar el estado de las part√≠culas en la GPU. <br><br>  Tomamos y copiamos.  Esperamos tal resultado.  Aqu√≠ las part√≠culas se mueven suavemente. <br><br><img src="https://habrastorage.org/webt/s6/5t/7-/s65t7-020jphv-fvyzbk5vpkmoq.jpeg"><br><br>  Tenemos no entiendo qu√©. <br><br><img src="https://habrastorage.org/webt/7n/8i/t1/7n8it1gwmfklms2akt9nydmgima.jpeg"><br><br>  Intentando descifrar el c√≥digo.  Mejorando, nuevamente obteniendo un resultado insatisfactorio.  Subimos a√∫n m√°s profundo: recibimos lluvia en lugar de viento. <br><br><img src="https://habrastorage.org/webt/n4/bd/b1/n4bdb1-ar38mb8lokfjfgjqbrue.jpeg"><br><br>  OK, decidimos hacerlo nosotros mismos. <br><br><img src="https://habrastorage.org/webt/lw/ue/kv/lwuekvj_c1996sjj2q1c2fl4pyk.jpeg"><br><br>  Para trabajar con WebGL, existen marcos.  Casi todos est√°n destinados a trabajar con objetos 3D.  No necesitamos estas capacidades 3D.  Solo necesitamos dibujar una part√≠cula y moverla.  Por lo tanto, decidimos hacer todo con nuestras manos. <br><br><img src="https://habrastorage.org/webt/rt/db/4z/rtdb4zokw74ivcedzljp4t3fu_g.jpeg"><br><br>  Actualmente hay dos versiones de la tecnolog√≠a WebGL.  La segunda versi√≥n, que es genial, tiene una versi√≥n moderna y alta del lenguaje de programaci√≥n en el que el programa se ejecuta en el adaptador de gr√°ficos, puede realizar c√°lculos directamente y no solo dibujar.  Pero tiene poca compatibilidad. <br><br><img src="https://habrastorage.org/webt/yk/gr/ty/ykgrtypkwclnix0f4pat1retheu.jpeg"><br><br>  Bueno, decidimos usar el antiguo WebGL 1 probado, que tiene un buen soporte adem√°s de Opera Mini, que nadie necesita. <br><br><img src="https://habrastorage.org/webt/sr/1q/xr/sr1qxr_ch7enl9z1rjwuv1hshpg.jpeg"><br><br>  WebGL es una cosa de dos componentes.  Este es JS que ejecuta el estado de los programas que se ejecutan en la tarjeta gr√°fica.  Y hay componentes que se ejecutan directamente en la tarjeta gr√°fica. <br><br>  Comencemos con JS.  WebGL es solo el contexto apropiado para el elemento de lienzo.  Adem√°s, al recibir este contexto, no se asigna solo un objeto espec√≠fico, se asignan recursos de hierro.  Y si ejecutamos algo hermoso en WebGL en un navegador, y luego decidimos jugar Quake, entonces es muy posible que se pierdan estos recursos y se pierda el contexto y se rompa todo el programa. <br><br><img src="https://habrastorage.org/webt/y3/bm/p0/y3bmp0fddy1vkxkktxantfrfcdw.jpeg"><br><br>  Por lo tanto, cuando trabaje con WebGL, tambi√©n debe escuchar la p√©rdida de contexto y poder recuperarla.  Por lo tanto, enfatic√© que init es. <br><br><img src="https://habrastorage.org/webt/aj/iu/zk/ajiuzkpsukwyhrhvte4oduqivri.jpeg"><br><br>  Adem√°s, todo el trabajo de JS se reduce a recopilar programas que se ejecutan en la GPU, enviarles una tarjeta gr√°fica, establecer algunos par√°metros y decir "dibujar". <br><br><img src="https://habrastorage.org/webt/3k/2m/zd/3k2mzdhdejzpaxjrx_upik6fdeu.jpeg"><br><br>  En WebGL, si observa el elemento de contexto en s√≠, ver√° un mont√≥n de constantes.  Estas constantes se refieren a direcciones en la memoria.  No son realmente constantes en el proceso del programa.  Porque si el contexto se pierde y se restaura nuevamente, se puede asignar otro grupo de direcciones, y estas constantes ser√°n diferentes para el contexto actual.  Por lo tanto, casi todas las operaciones en WebGL en el lado JS se realizan a trav√©s de utilidades.  Nadie quiere hacer el trabajo rutinario de encontrar direcciones y otros tipos de basura. <br><br><img src="https://habrastorage.org/webt/ii/o7/sa/iio7sahs5z0gt5bccxesgiict44.jpeg"><br><br>  Pasamos a lo que se realiza en la propia tarjeta de video: un programa que consta de dos conjuntos de instrucciones escritas en un lenguaje GLSL tipo C.  Estas instrucciones se denominan sombreador de v√©rtices y sombreador de fragmentos.  Un programa se crea a partir de su par. <br><br><img src="https://habrastorage.org/webt/qg/fu/lb/qgfulbs6almqwpkmutcsxv38-cm.jpeg"><br><br>  ¬øCu√°l es la diferencia entre estos sombreadores?  El sombreador de v√©rtices establece la superficie en la que se debe dibujar algo.  Despu√©s de configurar el primitivo, que debe pintarse, se llama el sombreador de fragmentos que cae dentro de este rango. <br><br><img src="https://habrastorage.org/webt/up/h_/ya/uph_yasoh3q-99otxdym43zykmw.jpeg"><br><br><img src="https://habrastorage.org/webt/u7/vi/qb/u7viqbviwm76x4ovlvion5mm2o8.jpeg"><br><br>  En c√≥digo, se ve as√≠.  El sombreador tiene una secci√≥n para declarar variables que se configuran externamente desde JS, se determinan su tipo y nombre.  Adem√°s de la secci√≥n principal, que ejecuta el c√≥digo necesario para esta iteraci√≥n. <br><br>  Se espera que un sombreador de v√©rtices en la mayor√≠a de los casos establezca la variable gl_Position en alguna coordenada en un espacio de cuatro dimensiones.  Esto es x, y, z y el ancho del espacio, que no es muy necesario saber en este momento. <br><br>  El sombreador de fragmentos espera establecer el color de un p√≠xel espec√≠fico. <br><br>  En este ejemplo, tenemos el color de p√≠xel seleccionado de la textura conectada. <br><br><img src="https://habrastorage.org/webt/y8/nw/1y/y8nw1y1gnwstkv2rgqxatduyuni.jpeg"><br><br>  Para transferir esto a JS, simplemente envuelva el c√≥digo fuente de los sombreadores en variables. <br><br><img src="https://habrastorage.org/webt/ax/fz/ou/axfzouj0xwui47sftwgdhlcadd0.jpeg"><br><br>  Adem√°s, estas variables se transforman en sombreadores.  Este es un contexto WebGL, creamos sombreadores a partir de c√≥digos fuente, creamos un programa en paralelo y adjuntamos un par de sombreadores al programa.  Tenemos un programa viable. <br><br>  En el camino, verificamos que la compilaci√≥n de los sombreadores fue exitosa, que el programa se construy√≥ con √©xito.  Decimos que necesita usar este programa, porque puede haber varios programas para diferentes valores de representaci√≥n. <br><br>  Config√∫ralo y di dibujar.  Resulta alg√∫n tipo de imagen. <br><br><img src="https://habrastorage.org/webt/oz/py/ri/ozpyrifyoft_invjrawmmz-_fjg.jpeg"><br><br>  Subi√≥ m√°s profundo.  En el sombreador de v√©rtices, todos los c√°lculos se realizan en el espacio de -1 a 1, independientemente del tama√±o del punto de salida.  Por ejemplo, el espacio de -1 a 1 puede ocupar toda la pantalla 1920x1080. Para dibujar un tri√°ngulo en el centro de la pantalla, debe dibujar una superficie que cubra la coordenada 0, 0. <br><br><img src="https://habrastorage.org/webt/4q/yp/ex/4qypexiothorcvzkrk9y_p5v9tk.jpeg"><br><br>  El sombreador de fragmentos funciona en el espacio de 0 a 1, y los colores se muestran en cuatro componentes: R, G, B, Alfa. <br><br>  Usando CSS como ejemplo, puede encontrar una notaci√≥n de color similar al usar porcentajes. <br><br><img src="https://habrastorage.org/webt/ys/cn/kn/yscnkn-8x_yg0bl_zknm-42l17q.jpeg"><br><br>  Para dibujar algo, debe decir qu√© datos se deben dibujar.  Espec√≠ficamente para un tri√°ngulo, definimos una matriz tipada de tres v√©rtices, cada uno de los cuales consta de tres componentes, x, y y suficientes. <br><br>  Para este caso, el sombreador de v√©rtices parece obtener el par actual de puntos, coordenadas y establecer esta coordenada en la pantalla.  Aqu√≠, tal como est√°, sin transformaciones, ponemos un punto en la pantalla. <br><br><img src="https://habrastorage.org/webt/up/h_/ya/uph_yasoh3q-99otxdym43zykmw.jpeg"><br><br>  El sombreador de fragmentos puede colorear las constantes pasadas de JS con color, tambi√©n sin c√°lculos adicionales.  Adem√°s, si algunas variables en el sombreador de fragmentos se transfieren desde el exterior o desde el sombreador anterior, entonces se debe especificar la precisi√≥n.  En este caso, la precisi√≥n media es suficiente, y casi siempre es suficiente. <br><br><img src="https://habrastorage.org/webt/dx/9v/jb/dx9vjbxuiz_swlbl1hlmlb5hmys.jpeg"><br><br>  Pasamos a JS.  Asignamos los mismos sombreadores a las variables y declaramos una funci√≥n que crear√° estos sombreadores.  Es decir, se crea un sombreador, se vierte la fuente y luego se compila. <br><br><img src="https://habrastorage.org/webt/jf/x3/eg/jfx3eg-hhqsdbmpc378peyi6tym.jpeg"><br><br>  Hacemos dos sombreadores, v√©rtice y fragmento. <br><br><img src="https://habrastorage.org/webt/jh/pb/um/jhpbumsovp4-rkstmx9dldtg7ug.jpeg"><br><br>  Despu√©s de eso, cree un programa, cargue sombreadores ya compilados.  Vinculamos el programa porque los sombreadores pueden intercambiar variables entre s√≠.  Y en esta etapa, se verifica la correspondencia de los tipos de variables que intercambian estos sombreadores. <br><br>  Decimos que use este programa. <br><br><img src="https://habrastorage.org/webt/7i/hm/rc/7ihmrctum2gyy9cuybn5pr6hcbu.jpeg"><br><br>  A continuaci√≥n, creamos una lista de v√©rtices que queremos visualizar.  WebGL tiene una caracter√≠stica interesante para algunas variables.  Para cambiar un tipo de datos espec√≠fico, debe establecer el contexto global para editar array_buffer y luego cargar algo en esta direcci√≥n.  No hay asignaci√≥n expl√≠cita de ning√∫n dato a una variable.  Todo se hace mediante la inclusi√≥n de alg√∫n contexto. <br><br>  Tambi√©n es necesario establecer las reglas para leer desde este b√∫fer.  Se puede ver que especificamos una matriz de seis elementos, pero el programa necesita explicar que cada v√©rtice consta de dos componentes, el tipo de los cuales es flotante, esto se hace en la √∫ltima l√≠nea. <br><br><img src="https://habrastorage.org/webt/js/_j/qe/js_jqevmwlq0fmo_n6-vbdwsr-k.jpeg"><br><br>  Para establecer el color, el programa busca la direcci√≥n de la variable u_color y establece el valor para esta variable.  Configuramos el color, rojo 255, 0.8 de verde, 0 azul y un p√≠xel completamente opaco: se vuelve amarillo.  Y decimos que ejecute este programa usando las primitivas de tri√°ngulo, en WebGL puede dibujar puntos, l√≠neas, tri√°ngulos, tri√°ngulos de forma compleja, etc.  Y haz tres picos. <br><br><img src="https://habrastorage.org/webt/lk/pz/xe/lkpzxe_tur-bgozsoj47kohstty.jpeg"><br><br>  Tambi√©n puede especificar que la matriz sobre la que estamos renderizando debe contarse desde el principio. <br><br><img src="https://habrastorage.org/webt/p4/1f/_k/p41f_kioprwkxx7ommkzz7tcclw.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  Si complica un poco el ejemplo, puede agregar una dependencia de color en la posici√≥n del cursor.  Al mismo tiempo, fps se dispara. <br><br><img src="https://habrastorage.org/webt/sl/eu/zl/sleuzlnxn8s1tlflhawo5obsrg8.jpeg"><br><br>  Para dibujar part√≠culas en todo el mundo, debes conocer la velocidad del viento en cada punto de este mundo. <br><br>  Para ampliar y de alguna manera mover el mapa, debe crear contenedores que coincidan con la posici√≥n actual del mapa. <br><br>  Para mover las part√≠culas, debe crear un formato de datos que pueda actualizarse con una GPU.  Haz el dibujo en s√≠ y dibuja el bucle. <br><br><img src="https://habrastorage.org/webt/2o/vf/o_/2ovfo_hqaimoyygbbcpkbupf_cu.jpeg"><br><br>  Hacemos todos los datos a trav√©s de la textura.  Utilizamos 22 canales para determinar las velocidades horizontal y vertical, donde la velocidad del viento cero corresponde a la mitad del rango de colores.  Es 128 aproximadamente.  Como la velocidad puede ser negativa y positiva, establecemos el color en relaci√≥n con la mitad del rango. <br><br>  Resulta una imagen as√≠. <br><br><img src="https://habrastorage.org/webt/3-/qu/i8/3-qui8mkzufp6hucltuzpampili.jpeg"><br><br>  Para cargarlo en una tarjeta, necesitamos cortarlo.  Para conectar la imagen al mapa, usaremos la herramienta est√°ndar Yandex.Map Layer, en la que determinaremos la direcci√≥n desde la cual cortar los mosaicos, y agregaremos esta capa al mapa. <br><br><img src="https://habrastorage.org/webt/jo/zj/a8/jozja8duysio2wljyezgjnhfn64.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  Obtenemos una imagen donde el color verde desagradable se codifica la velocidad del viento. <br><br><img src="https://habrastorage.org/webt/uh/nk/jh/uhnkjh1e8sxzgzp-myix3xxyjn4.jpeg"><br><br>  A continuaci√≥n, debe obtener un lugar donde dibujemos la animaci√≥n en s√≠, mientras que este lugar debe corresponder a las coordenadas del mapa, sus movimientos y otras acciones. <br><br>  Por defecto, podemos suponer que usar√≠amos la capa, pero la capa de la tarjeta crea un lienzo desde el cual captura inmediatamente el contexto 2D que puede capturar.  Pero si tratamos de tomar del lienzo, que ya tiene un contexto de un tipo diferente, y tomar de √©l un contexto GL, como resultado obtenemos un valor nulo.  Si accede a √©l, el programa se bloquea. <br><br><img src="https://habrastorage.org/webt/lg/9a/mn/lg9amncxtx9ndmnc7bjqkzcs_lw.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  Por lo tanto, utilizamos Panel, estos son contenedores para dise√±os y agregamos nuestro lienzo all√≠, del cual ya tomamos el contexto que necesit√°bamos. <br><br><img src="https://habrastorage.org/webt/v9/on/pb/v9onpb5gnorqq05kg0og8bd6wvq.jpeg"><br><br>  Para organizar de alguna manera las part√≠culas en la pantalla y poder moverlas, se utiliz√≥ el formato de la posici√≥n de las part√≠culas en la textura. <br><br>  Como funciona  Se crea una textura cuadrada para la optimizaci√≥n, y aqu√≠ se conoce el tama√±o de su lado. <br><br><img src="https://habrastorage.org/webt/ov/hm/qg/ovhmqgdfgbzg3k5wua7se3l-scm.jpeg"><br><br>  Al dibujar las part√≠culas en orden y conocer el n√∫mero de serie de la part√≠cula y el tama√±o de la textura en la que est√°n almacenadas, puede calcular un p√≠xel espec√≠fico en el que se codifica la posici√≥n en la pantalla real. <br><br><img src="https://habrastorage.org/webt/xw/6c/ly/xw6clysjjqrtppxzih0cm4q3sis.jpeg"><br><br><img src="https://habrastorage.org/webt/a_/jt/9m/a_jt9ml9jdjn0vxxk7riv9sbkw8.jpeg"><br><br>  En el sombreador en s√≠, parece leer el √≠ndice renderizado, la textura con la posici√≥n actual de las part√≠culas y el tama√±o del lado.  Luego, determinamos las coordenadas x, y para esta part√≠cula, leemos este valor y lo decodificamos.  ¬øQu√© tipo de magia es esta: rg / 255 + ba? <br><br>  Para la posici√≥n de las part√≠culas usamos 20 canales dobles.  El canal de color tiene un valor de 0 a 255, y para la pantalla 1080 no podemos colocar las part√≠culas en ninguna posici√≥n de la pantalla por un momento, porque podemos poner la part√≠cula en un m√°ximo de 255 p√≠xeles.  Por lo tanto, en un canal almacenamos el conocimiento de cu√°ntas veces una part√≠cula ha pasado 255 p√≠xeles, y en el segundo canal almacenamos el valor exacto de cu√°nto pas√≥ despu√©s. <br><br>  A continuaci√≥n, el sombreador de v√©rtices debe convertir estos valores a su espacio de trabajo, es decir, de -1 a 1, y establecer este punto en la pantalla. <br><br><img src="https://habrastorage.org/webt/g2/ht/g_/g2htg_vqu8k5fdnn_zx6xtl82fs.jpeg"><br><br>  Para mirar nuestras part√≠culas, solo p√≠ntalas de blanco.  GLSL tiene tal az√∫car que si definimos el tipo de una variable y la pasamos a una constante, esta constante se distribuir√° en los cuatro componentes, por ejemplo. <br><br><img src="https://habrastorage.org/webt/ee/h-/hz/eeh-hzn9oaitmm7k7gwfpzin8rq.jpeg"><br><br>  Despu√©s de dibujar dicho programa, vemos un conjunto de cuadrados id√©nticos.  Intentemos agregarles belleza. <br><br><img src="https://habrastorage.org/webt/-r/ud/i1/-rudi16ytlwsw-_fvafdhqmqync.jpeg"><br><br>  Primero, agregue la dependencia de estos cuadrados de la velocidad actual del viento.  Simplemente leemos la velocidad actual y las texturas correspondientes para cada part√≠cula.  Obtenemos la longitud del vector, que corresponde a la velocidad absoluta en el punto, y sumamos esta velocidad al tama√±o de part√≠cula. <br><br><img src="https://habrastorage.org/webt/or/v-/qs/orv-qs0vwvlrcxadmlpvbywokdw.jpeg"><br><br>  Adem√°s, para no dibujar los cuadrados, en el sombreador de fragmentos cortamos todos los p√≠xeles que quedan fuera del radio, que no est√°n incluidos en el radio del c√≠rculo inscrito.  Es decir, nuestro sombreador se convierte en tal cosa. <br><br><img src="https://habrastorage.org/webt/t4/rx/ah/t4rxahmunedzb3k0jamjxiikvia.jpeg"><br><br>  Calculamos la distancia al p√≠xel renderizado desde el centro.  Si excede la mitad del espacio, entonces no lo mostramos. <br><br><img src="https://habrastorage.org/webt/nr/do/ma/nrdomaus-zdhgroynefo3qacxck.jpeg"><br><br>  Obtenemos una imagen m√°s diversa. <br><br>  A continuaci√≥n, debe mover de alguna manera estas cosas.  Dado que WebGL 1 no sabe c√≥mo calcular algo, trabaja directamente con datos, aprovecharemos la capacidad de dibujar programas en componentes especiales, b√∫feres de trama. <br><br>  Los b√∫feres de trama se pueden asignar, por ejemplo, a texturas que se pueden actualizar.  Si no se declara el b√∫fer de trama, el dibujo por defecto se realiza en la pantalla. <br><br>  Al cambiar la salida de una textura de posici√≥n a otra, podemos actualizarlos uno por uno y luego usarlos para renderizar. <br><br><img src="https://habrastorage.org/webt/j7/-j/tn/j7-jtnjwzj-8pav52t-ngiolwji.jpeg"><br><br><img src="https://habrastorage.org/webt/8y/me/ey/8ymeey1havzw-wavn5x8ztr87em.jpeg"><br><br>  El procedimiento para actualizar la posici√≥n en s√≠ se ve as√≠: lee la posici√≥n actual, agr√©gala al vector de velocidad actual y agr√©gala, codif√≠cala en un nuevo color. <br><br><img src="https://habrastorage.org/webt/t7/up/wj/t7upwjpzr8ubgig0cwr1_hn7npa.jpeg"><br><br>  En el c√≥digo, parece leer la posici√≥n actual, decodificar, leer la velocidad actual, llevar la velocidad a la normalidad, plegar los dos componentes, codificar en color. <br><br><img src="https://habrastorage.org/webt/uo/cc/qo/uoccqo8i2fubmgay3oi90teclzw.jpeg"><br><br>  Resulta una imagen as√≠.  El estado de las part√≠culas cambia constantemente y aparece alg√∫n tipo de animaci√≥n. <br><br>  Si ejecuta dicha animaci√≥n durante 5-10 minutos, estar√° claro que todas las part√≠culas llegar√°n a su destino final.  Todos se deslizan en el embudo.  Tienes una foto as√≠. <br><br><img src="https://habrastorage.org/webt/be/m0/bx/bem0bxbrxar_it9lgdjdc2fk91y.jpeg"><br><br>  Para evitar esto, introducimos un factor de permutaci√≥n de part√≠culas en un lugar aleatorio. <br><br>  Depende de la velocidad actual del viento, de la posici√≥n actual de las part√≠culas y del n√∫mero aleatorio que transmitimos desde JS, porque la primera versi√≥n de WebGL no tiene una funci√≥n de aleatorizaci√≥n o alg√∫n tipo de funci√≥n de ruido. <br><br><img src="https://habrastorage.org/webt/zt/ur/_b/ztur_bhp_epcyqk1kzaz9b1r0a0.jpeg"><br><br>  En este ejemplo, calculamos la posici√≥n predicha de la part√≠cula, la posici√≥n aleatoria, y seleccionamos una u otra, dependiendo del factor de reinicio. <br><br><img src="https://habrastorage.org/webt/6o/qq/m8/6oqqm8iswgovcsguseunzhwxauc.jpeg"><br><h5>  <sub><sup>Enlaces de la diapositiva: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primero</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">segundo</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tercero</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cuarto</a></sup></sub> </h5><br>  Para comprender lo que estaba en la √∫ltima diapositiva, puede leer estos art√≠culos.  El primero proporciona un gran impulso para comprender lo que proporciona WebGL, en qu√© consiste y c√≥mo no cometer un error.  En Khronos, este es un grupo que se dedica al desarrollo del est√°ndar, hay una descripci√≥n de todas las funciones. <br><br><img src="https://habrastorage.org/webt/5u/qi/st/5uqistm5t05pqha9xfm1oqdnxfu.jpeg"><br><br>  El √∫ltimo punto de nuestra tarea es dibujar un rastro de part√≠culas.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para hacer esto, nosotros, al igual que con las texturas de actualizaci√≥n de posici√≥n, registraremos la posici√≥n actual en la pantalla en dos texturas y mostraremos la posici√≥n actual, aumentando ligeramente su transparencia, superponiendo una nueva posici√≥n de part√≠culas, y luego incrementaremos la transparencia de esta imagen una y otra vez encima imponemos una nueva posici√≥n. </font></font><br><br><img src="https://habrastorage.org/webt/es/-8/oa/es-8oakhvm9ds8uh-e7teuivgnk.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenemos una animaci√≥n de bucle. </font></font><br><br><img src="https://habrastorage.org/webt/qv/2s/hi/qv2shigmfokikarpx9kzdx0vsck.jpeg"><br><br><img src="https://habrastorage.org/webt/mu/3s/x2/mu3sx2aovopotm_gnyln8to95rm.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si compara el ciclo completo de renderizado WebGL con la visualizaci√≥n de algunos puntos en la pantalla usando un lienzo 2D, puede ver una gran brecha en la velocidad. </font><font style="vertical-align: inherit;">Para dibujar 64 mil puntos en un lienzo 2D, se necesita un promedio de 25 ms, mientras que WebGL bloquea la transmisi√≥n principal durante 0,3 ms. </font><font style="vertical-align: inherit;">Esta es una diferencia de cien veces.</font></font><br><br>  ,  WebGL     ,        ,      . <br><br>   , ,    ,   - break points, -  ,   . WebGL ‚Äî  . <br><br><img src="https://habrastorage.org/webt/6l/ke/u_/6lkeu_xuquuzt8pjc1uj8ckv1fa.jpeg"><br><br>    ,     . ,  Firefox    ¬´¬ª,        WebGL-,    ,    ,     . ,          . <br><br><img src="https://habrastorage.org/webt/w1/0j/vs/w10jvskiqvyvfrvhqwr4mpnu2uk.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La segunda herramienta que hace la vida mucho m√°s f√°cil es la extensi√≥n del navegador Spector.js. </font><font style="vertical-align: inherit;">Tambi√©n captura el lienzo del contexto de WebGL y le permite ver todas las operaciones realizadas en este lienzo, los tiempos y las variables pasadas. </font></font><br><br><img src="https://habrastorage.org/webt/o-/gm/sa/o-gmsa_uu9gddh7qzrept9418ne.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En total durante una semana de trabajo, desde cero obtuvimos una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soluci√≥n llave</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">mano</font></a><font style="vertical-align: inherit;"> en el viento. </font><font style="vertical-align: inherit;">Espero haber podido saber de qu√© tipo de tecnolog√≠a se trata, WebGL, en qu√© consiste y dar un ejemplo real de su uso en el producto. </font><font style="vertical-align: inherit;">Eso es todo</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433278/">https://habr.com/ru/post/es433278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433268/index.html">Cliente PHP Telegram (y recibir mensajes usando MadelineProto)</a></li>
<li><a href="../es433270/index.html">Soluci√≥n de problemas de MapStruct con ManyToMany</a></li>
<li><a href="../es433272/index.html">Entrevista con David Gobel</a></li>
<li><a href="../es433274/index.html">Oleg Dokuka sobre el desarrollo reactivo en jug.msk.ru</a></li>
<li><a href="../es433276/index.html">Sobre los beneficios de incrustar CSS en JS</a></li>
<li><a href="../es433280/index.html">Conferencia DEFCON 18. Ingenier√≠a inversa Trollim usando las matem√°ticas</a></li>
<li><a href="../es433282/index.html">Puertas de enlace de protocolos de intercambio industrial en Linux. Re√∫nete</a></li>
<li><a href="../es433286/index.html">10 reuniones inform√°ticas y hackatones m√°s cercanos en Mosc√∫</a></li>
<li><a href="../es433288/index.html">Seguridad web: Introducci√≥n a HTTP</a></li>
<li><a href="../es433292/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 279 (del 10 al 16 de diciembre)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>