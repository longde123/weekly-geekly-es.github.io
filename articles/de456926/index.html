<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§öüèª üñäÔ∏è ‚ÜóÔ∏è Wie wir Sportmaster machen üë®‚Äç‚öïÔ∏è üìå üè∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Ich bin sicher, dass viele von Ihnen jemals ein T-Shirt, einen Ball, Turnschuhe oder andere Sportger√§te in unseren L√§den gekauft hab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir Sportmaster machen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sportmaster_lab/blog/456926/"> Hallo allerseits!  Ich bin sicher, dass viele von Ihnen jemals ein T-Shirt, einen Ball, Turnschuhe oder andere Sportger√§te in unseren L√§den gekauft haben, aber nur wenige wissen, was Sportmaster aus technischer Sicht ist. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/_s/2g/78/_s2g78t3lwucifnjqtiod7yatja.png"></a> <br>  <i>Ein bisschen Sportmaster 2003 von web.archive.org</i> <br><br>  Mein Name ist Dmitry, ich bin ein leitender Java-Entwickler bei Sportmaster, und heute m√∂chte ich √ºber unseren Online-Shop sprechen, dar√ºber, welchen Weg er gegangen ist, wie Sie ihn jetzt kennen: wie wir angefangen haben, wie wir uns entwickelt haben Was ist passiert und was nicht, √ºber die Probleme heute und √ºber Pl√§ne f√ºr die Zukunft.  Interessant?  Willkommen bei Katze! <br><a name="habracut"></a><br>  Die Geschichte der Pr√§senz unseres Unternehmens im Internet begann bereits 1999 mit der ersten Website des Sportmaster, bei der es sich lediglich um eine Visitenkarte und einen Warenkatalog f√ºr Gro√ühandelsk√§ufer handelte.  Eigentlich hat der Online-Shop des Unternehmens seine Geschichte seit 2001.  Damals hatte das Unternehmen kein eigenes Team f√ºr die Entwicklung von Online-Projekten, und der Online-Shop konnte mehrere selbst erstellte Plattformen √§ndern (jetzt k√∂nnen wir uns nicht einmal mehr daran erinnern, wie viele).  Die erste f√ºr uns relativ stabile L√∂sung wurde 2011 vom n√§chsten Integrator in PHP auf Basis von CMS 1C Bitrix erstellt.  Die Website erwies sich als einfach. Tats√§chlich wurde die Bitrix-Box-Funktionalit√§t verwendet, mit kleinen Anpassungen, um eine Bestellung aufzugeben.  F√ºr die Hardware umfasste die Startkonfiguration 2 Anwendungsserver und einen Datenbankserver. <br><br>  In der Zwischenzeit begann das Unternehmen, seine eigenen Kompetenzen im Bereich des Online-Vertriebs aktiv aufzubauen, vor allem auf der Seite des Gesch√§fts, was sich, wie ich sagen muss, ziemlich schnell entwickelte, und das Entwicklungsteam war gezwungen, in jeder Hinsicht schnell zu wachsen, um seine Bed√ºrfnisse zu erf√ºllen.  In weniger als einem Jahr begannen drei Teams sofort, sich f√ºr die Entwicklung und Unterst√ºtzung der Site zu verantworten - der Integrator selbst, das interne Team des Sportmasters, das zu dieser Zeit nur aus wenigen Personen bestand, und ein anderer Auftragnehmer - sein Erscheinungsbild war in der Tat auf die Tatsache zur√ºckzuf√ºhren, dass der Integrator In diesem Moment konnte ich nicht die Kapazit√§ten bereitstellen, die wir f√ºr die Menschen brauchten. <br><br>  Welche Probleme hatten wir damals?  Es gab viele Probleme, aber das wichtigste ist der instabile Betrieb unseres Online-Shops. <br><br>  Wir k√∂nnten sogar von der Tatsache abfallen, dass das Unternehmen eine Art Newsletter herausbrachte, nach dem ~ 2000-2500 Menschen auf die Website kamen, oder, wie ich mich jetzt erinnere, ein Werbebanner auf Yandex uns in einen tiefen Niederschlag versetzte.  Nat√ºrlich sind solche Dinge nicht akzeptabel, da dies nicht nur entgangene Gewinne sind, sondern auch das Image des Unternehmens - im Allgemeinen haben wir verstanden, dass etwas ge√§ndert werden muss.  Zun√§chst wurde erkannt, dass Standardl√∂sungen mit unseren Workloads (zu dieser Zeit nicht sehr gro√ü, aber immer noch nicht klein) nicht funktionieren w√ºrden.  Dann hatten wir normalerweise ~ 1000 Besucher online, ~ 2500 zu Spitzenzeiten, plus Entwicklungspl√§ne x2 pro Jahr. <br><br>  Sofort in Bezug auf Hardware intensiviert: Wir haben 2 weitere Anwendungsserver hinzugef√ºgt und einen Cluster aus 2 Datenbankservern erstellt.  Unser Stack war zu dieser Zeit Nginx, MySQL, PHP.  Parallel dazu haben wir versucht, die aktuelle L√∂sung zu optimieren - wir haben nach Engp√§ssen gesucht und versucht, alles M√∂gliche neu zu schreiben.  Da unser Engpass die Basis war, war es immer der erste, der ‚Äûstarb‚Äú, und wir beschlossen, ihn maximal zu entladen.  Implementierte Sphinx f√ºr die Volltextsuche und Ausgabe von Warenkacheln mit Facetten durch die ausgew√§hlten Filter und verbundenen Caches.  Und voila - diese Lasten, die sich gestern f√ºr uns als t√∂dlich herausstellten, begannen wir mit Leichtigkeit zu halten. <br><br>  Parallel dazu wurde ein Pilotprojekt gestartet, in dessen Rahmen eine technologische Aktualisierung der Website durchgef√ºhrt werden sollte - die √úbertragung auf eine grundlegend andere Plattform.  Es gab viele Ideen und Ideen - zu dieser Zeit wurde die Personalisierung von allem und jedem, pers√∂nliche Empfehlungen, Mailings, Rabatte und andere n√ºtzliche Dinge immer beliebter, und wir wollten nat√ºrlich auch all dies nutzen.  Wir haben uns angesehen, was auf dem Markt erh√§ltlich ist, und die teuerste Plattform nach dem Prinzip ‚ÄûEinmal teurer, dann k√ºhler‚Äú gekauft.  Die Implementierung wurde mit Hilfe eines Integrators geplant, und wir hatten noch Unterst√ºtzung und Weiterentwicklung des bedingt alten IM, bis das neue auf der neuen Plattform in Betrieb genommen wurde. <br><br>  Da die Geschwindigkeit der funktionalen Entwicklung der aktuellen Website jedoch sehr hoch war, beschlossen wir, die Implementierung der neuen E-Commerce-Plattform √ºber den damals kleineren und einfacheren Online-Shop der Einzelhandelskette in Austin zu beginnen, der auch vom IT Sportmaster-Team bedient wurde.  Dabei stellten wir fest, dass das Ding kr√§ftig und funktional anspruchsvoll, aber technologisch veraltet war, und es stellte sich als gro√ües Problem heraus, Leute zu finden, die es vollst√§ndig umsetzen konnten.  Dar√ºber hinaus f√ºhrte die vor Projektbeginn vorgenommene Dimensionierung zu erheblich geringeren Anforderungen an die Hardware und die Anzahl der Lizenzen - die Lebensdauer erwies sich als wesentlich grausamer.  Im Allgemeinen haben wir eines verstanden: Wir werden keinen Sportmaster darauf machen.  Und da sich das Team f√ºr die Migration auf die Plattform bereits im Rekrutierungsprozess befand, beschlossen die Jungs, mit dem Prototyping ihrer eigenen L√∂sung zu beginnen, basierend auf den Anforderungen, die das Unternehmen an die neue Plattform stellt. <br><br>  Der Technologie-Stack wurde wie folgt ausgew√§hlt: Java, Spring, Tomcat, ElasticSearch, Hazelcast. <br><br>  Infolgedessen hatten wir Ende 2014 eine neue Version von IM fertig, vollst√§ndig selbst geschrieben, auf die wir erfolgreich umgestellt haben.  Sie ist die erste Version der Website, die Sie heute sehen.  Nat√ºrlich ist die aktuelle Version viel funktionaler und technologischer, aber die Basisplattform ist dieselbe. <br><br><h2>  Hauptaufgaben </h2><br>  Wenn wir √ºber einen gro√üen Online-Shop sprechen, sprechen wir nat√ºrlich √ºber die Bereitschaft, nicht nur mit t√§glichen, sondern auch mit Spitzenlasten fertig zu werden - um f√ºr Unternehmen und Endbenutzer stabil zu sein. <br><br>  Die Hauptans√§tze hierbei sind die F√§higkeit zur horizontalen Skalierung und die Anwendung von Daten-Caching-Ans√§tzen auf verschiedenen Ebenen.  Und jetzt, wie vor einiger Zeit, haben wir beschlossen, den Zugriff auf unsere Daten zu optimieren.  Wir k√∂nnen jedoch kein regul√§res Seiten-Caching verwenden.  Im Allgemeinen.  Dies ist eine gesch√§ftliche Anforderung, und die Anforderung ist durchaus vern√ºnftig. Wenn Sie dem Benutzer der Website zu einem bestimmten Zeitpunkt den falschen Preis oder die falsche Verf√ºgbarkeit von Waren anzeigen, f√ºhrt dies h√∂chstwahrscheinlich zu einer Ablehnung des Kaufs und einer Verringerung der Kundenbindung. <br><br>  Und es ist in Ordnung, wenn der Kunde 15 Paar Socken f√ºr 299 Rubel bestellt hat und im Laden festgestellt hat, dass es tats√§chlich nur 14 Paar und 300 Rubel gibt - man kann irgendwie damit leben.  Akzeptiere, kaufe was ist und lebe mit dieser Narbe in deiner Seele weiter.  Aber wenn die Abweichungen in der Anzahl gravierend sind oder Sie nach einer bestimmten Gr√∂√üe gesucht haben - und diese gekauft wurde, w√§hrend Sie die Bewertungen der gl√ºcklichen Besitzer karierter Shorts gelesen haben, ist hier bereits alles trauriger.  Das hei√üt, sofort der Verlust eines zufriedenen (bis zu diesem Zeitpunkt) Kunden und der Verlust von Zeit und Geld f√ºr die Arbeit des Call Centers, wo dieser Kunde anruft, um herauszufinden, was passiert ist und warum. <br><br>  Daher sollte der Benutzer immer den neuesten Preis und die aktuellsten Daten zu Warenbilanzen sehen. Daher sind unsere Caches intelligent und wissen, wann sich die Daten in der Datenbank √§ndern.  F√ºr das Caching verwenden wir Hazelcast. <br><br><h2>  √úbrigens √ºber die Reste </h2><br>  Hierbei ist zu beachten, dass die Tiefe der Warenr√ºckst√§nde sehr gering ist.  Und eine sehr gro√üe Anzahl von Bestellungen wird (sehr) abgeholt.  Daher sollte der Kunde normalerweise die Waren im richtigen Gesch√§ft reservieren und die Salden verfolgen.  Zu einer Zeit wurde bei Bitrix das Problem der R√ºckst√§nde durch die Tatsache aufgegriffen, dass R√ºckst√§nde von mehr als 10 Einheiten einfach als unendlich angesehen wurden.  Das hei√üt, alles, was mehr als 10 ist, ist immer gleich 10, aber die niedrigeren Werte sind f√ºr uns bereits interessant zu berechnen und wir ber√ºcksichtigen sie und laden sie auf die Site hoch. <br><br>  Dies ist jetzt nicht mehr m√∂glich. Daher laden wir die Reste alle 15 Minuten aus allen Gesch√§ften herunter.  Und wir haben ungef√§hr 500 Gesch√§fte sowie eine Reihe regionaler Lagerh√§user und mehrere Einzelhandelsketten.  Und das alles muss umgehend aktualisiert werden.  Die Kirsche hier ist die Tatsache, dass sich die Arbeitsbedingungen von Kurierunternehmen sehr oft im Ma√üstab der Russischen F√∂deration √§ndern, daher m√ºssen auch Lieferparameter geladen werden.  Dar√ºber hinaus wird ein kontinuierlicher Warenfluss an die Lager des Unternehmens geliefert, weshalb sich die Warenmenge in den Lagern voraussichtlich √§ndern wird.  Also muss es auch wieder gezogen werden. <br><br>  Und so werden Commodity Item Identifiers (SKUs) gebildet.  Wir haben ungef√§hr 40.000 sogenannte Farbmodelle von Waren.  Wenn wir weiter zur Gr√∂√üe der Waren gehen, erhalten wir ungef√§hr 200.000 SKU.  Und f√ºr all dies m√ºssen 200.000 in der Gr√∂√üenordnung von 500 Filialen aktualisiert werden. <br><br>  Wir haben auch Zehntausende von St√§dten und D√∂rfern, in die wir Waren aus Gesch√§ften oder Lagern liefern.  Daher stellt sich heraus, dass die Cache-Variabilit√§t f√ºr nur eine Produktseite (Stadt * SKU) ein Millionstel eines Werts betr√§gt.  Unser Ansatz lautet: Die Berechnung der Verf√ºgbarkeit einer bestimmten Wareneinheit erfolgt im laufenden Betrieb, wenn der Benutzer die Produktkarte eingibt.  Wir betrachten die Arbeit der Kuriere in der Region des Benutzers, wir betrachten ihren Arbeitsplan, wir berechnen die Lieferkette und ber√ºcksichtigen deren Dauer.  Parallel dazu werden die √úberreste in nahe gelegenen Gesch√§ften analysiert, von denen aus der Transport arrangiert werden kann. <br><br>  Um die Verwaltung zu vereinfachen, verf√ºgen wir √ºber eine bestimmte Anzahl sehr schneller Caches in der Anwendung. Dank dieser Funktion k√∂nnen wir alle erforderlichen Daten schnell nach ID abrufen und im laufenden Betrieb sortieren.  Das Gleiche gilt f√ºr Kuriere: Wir gruppieren sie in Cluster, und dann werden die Cluster bereits in der Datenbank gespeichert.  Alle 15 Minuten wird dies alles aktualisiert. F√ºr jede eingehende Anfrage berechnen wir eine bestimmte Gruppe von Kurieren mit den erforderlichen Parametern, aggregieren sie und geben sie schnell an den K√§ufer weiter - alles ist in Ordnung, wir haben definitiv solche gr√ºnen Shorts der Gr√∂√üe 50, Sie k√∂nnen es auch In diesen drei Gesch√§ften in der N√§he k√∂nnen Sie mit Stiften abholen oder 3 Tage lang in einem Gesch√§ft auf der anderen Stra√üenseite (oder sogar zu Hause) bestellen. <br><br>  F√ºr Moskau mag diese Situation unn√∂tig erscheinen, aber f√ºr die Regionen ist dies eine ganz andere Sache. Sie bestellen sehr oft Waren in einigen Gesch√§ften (die Sie vielleicht auch speziell erreichen m√ºssen). <br><br><h2>  Zahlen </h2><br>  Jetzt empf√§ngt die Site Tausende von Anforderungen pro Sekunde unter Ber√ºcksichtigung der statischen Daten und 500-1000 Anforderungen pro Sekunde an Anwendungsserver.  Die Anzahl der Anwendungsserver hat sich nicht ge√§ndert, aber ihre Konfiguration hat erheblich zugenommen.  Es werden durchschnittlich etwa 3.000.000 Aufrufe pro Tag erzielt. <br><br>  DDoS werden manchmal auf der Site gefunden.  Gleichzeitig klopfen sie mit Botnetzen, au√üerdem mit unseren Verwandten aus der Russischen F√∂deration.  Vor langer Zeit gab es F√§lle von Versuchen, auf Botnetze aus Mexiko und Taiwan zu klopfen, aber jetzt ist dies nicht mehr der Fall. <br><br>  Es gibt eine Reihe von L√∂sungen f√ºr den Cloud-Schutz gegen DDoS auf dem Markt, ja, und recht gute.  F√ºr bestimmte Sicherheitsrichtlinien k√∂nnen wir diese Art von Cloud-L√∂sungen jedoch nicht verwenden. <br><br><h2>  Was jetzt? </h2><br>  Wir beginnen mit der Erstellung einer Plattforml√∂sung, bei der die Teams nicht vertikal (einige von ihnen sahen einen Standort und der zweite einen anderen), sondern horizontal getrennt werden. Dabei wird die gemeinsame Plattformebene hervorgehoben, in Teile geteilt und ein Team um sie herum gebildet.  Und auf ihnen schlie√üen wir bereits die Site und nicht nur, einschlie√ülich aller Kunden des Unternehmens, sowohl extern als auch intern.  Daher haben wir viele komplexe und interessante Arbeiten. <br><br>  Der Stapel an der Vorderseite hat sich aus offensichtlichen Gr√ºnden in dieser Zeit nicht wirklich ge√§ndert - Java, Spring, Tomcat, ElasticSearch und Hazelcast sind immer noch gut f√ºr unsere Anforderungen.  Eine andere Sache ist, dass jetzt viele Back-Office-Systeme mit verschiedenen Technologien hinter der Site versteckt sind.  Und nat√ºrlich ist ein Reengineering im Gange (da die Anforderungen an interne Systeme und die Arbeit mit ihnen insgesamt optimiert werden m√ºssen und wir die Gesch√§ftsanforderungen und neuen Gesch√§ftsfunktionen nicht vergessen). <br><br>  Und Sie k√∂nnen mir sicher pers√∂nliche (oder Kommentare) Vorschl√§ge zur Verbesserung der Website geben - sowohl in Bezug auf neue Funktionen als auch auf die visuelle Komponente und die allgemeine Benutzererfahrung.  Wir werden versuchen, schnell zu reagieren und alles zu ber√ºcksichtigen.  Und wenn Sie Teil des Teams werden und alles von innen sehen m√∂chten - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">willkommen</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de456926/">https://habr.com/ru/post/de456926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de456910/index.html">Internetprojekt security.txt - Kennenlernen einer anderen bekannten Datei</a></li>
<li><a href="../de456912/index.html">So erstellen Sie Websites im Jahr 2019</a></li>
<li><a href="../de456916/index.html">Cross Compilation im Docker. Warum nicht?</a></li>
<li><a href="../de456920/index.html">Sony Xperia 1 in Russland - Preis- und Vorbestellungsboni</a></li>
<li><a href="../de456922/index.html">Wie Prozessoren entworfen und hergestellt werden: die Grundlagen der Computerarchitektur</a></li>
<li><a href="../de456928/index.html">JMeter - Schweizer Pr√ºfmesser (Teil 1)</a></li>
<li><a href="../de456930/index.html">IoT in die Massen bringen: Ergebnisse des ersten IoT-Hackathons von GeekBrains und Rostelecom</a></li>
<li><a href="../de456932/index.html">Ultramodernes OpenGL. Teil 1</a></li>
<li><a href="../de456936/index.html">Animierte Karten auf SwiftUI</a></li>
<li><a href="../de456938/index.html">Start einer Taxi-App in Tokio: Wie macht Sony das mit S. Ride?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>