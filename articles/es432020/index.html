<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📓 ✖️ 📝 Replicación en cadena: construir un repositorio KV eficiente (parte 2/2) ☹️ 📌 🤚🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuamos considerando ejemplos del uso de la replicación en cadena. Las definiciones y arquitecturas básicas se dieron en la primera parte , le rec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Replicación en cadena: construir un repositorio KV eficiente (parte 2/2)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432020/"><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/ou/4j/jl/ou4jjlsyjknckeriwguidrfcqqs.jpeg"></div><br>  Continuamos considerando ejemplos del uso de la replicación en cadena.  Las definiciones y arquitecturas básicas se dieron en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primera parte</a> , le recomiendo que se familiarice con ellas antes de leer la segunda parte. <br><a name="habracut"></a><br>  En este artículo, estudiaremos los siguientes sistemas: <br><br><ul><li>  Hibari es un repositorio tolerante a fallos distribuido escrito en erlang. </li><li>  HyperDex: almacenamiento distribuido de valores clave con soporte para búsqueda rápida por atributos secundarios y búsqueda por rango. </li><li>  ChainReaction - Causal + consistencia y geo-replicación. </li><li>  Creación de un sistema distribuido sin utilizar procesos externos adicionales de monitoreo / reconfiguración. </li></ul><br><h1>  5. Hibari </h1><br>  Hibari es un repositorio KV tolerante a fallas distribuido escrito en erlang.  Utiliza la replicación de cadena (enfoque básico), es decir  logra una consistencia estricta.  En las pruebas, Hibari muestra un alto rendimiento: se logran varios miles de actualizaciones por segundo en servidores de dos unidades (solicitudes de 1Kb) <br><br><h3>  5.1 Arquitectura </h3><br>  El hashing constante se utiliza para colocar datos.  La base del almacenamiento son los bloques físicos y lógicos.  El <i>ladrillo físico</i> es un servidor con Linux, tal vez una instancia EC2 y, en general, la VM en su conjunto.  Un <i>ladrillo lógico</i> es una instancia de almacenamiento con la que funcionan los procesos principales del clúster, y cada bloque es un nodo en cualquier cadena.  En el siguiente ejemplo, el clúster está configurado con 2 bloques lógicos en cada bloque físico y con una longitud de cadena de 2. Tenga en cuenta que los nodos de la cadena están "untados" sobre los bloques físicos para aumentar la confiabilidad. <br><br>  El proceso maestro (consulte la definición en la primera parte) se denomina <i>servidor de administración</i> . <br><br>  Los datos se almacenan en "tablas", que simplemente se dividen en espacios de nombres, cada tabla se almacena en al menos una cadena, y cada cadena almacena datos en una sola tabla. <br><br>  El cliente Hibari recibe actualizaciones del servidor de administración con una lista de todos los encabezados y cola de todas las cadenas (y todas las tablas).  Por lo tanto, los clientes saben de inmediato a qué nodo lógico enviar la solicitud. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/k1/nh/yg/k1nhygstpeqkgzv5vyuwwsjoffm.png"></div><br><br><h3>  5.2 Hashing </h3><br>  Hibari usa un par <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="noError" id="MJXp-Span-2" style="display: inline-block;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ {T, K \}</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">\&nbsp;{T,&nbsp;K&nbsp;\}</span></span><script type="math/tex" id="MathJax-Element-1"> \ {T, K \} </script>  para determinar el nombre de la cadena que almacena la clave <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.066ex" height="2.057ex" viewBox="0 -780.1 889.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhgqe6lbH0r19fzhTOSwOWZlQHjj1w#MJMATHI-4B" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> K </script>  en la mesa <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.636ex" height="2.057ex" viewBox="0 -780.1 704.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/432020/&amp;usg=ALkJrhgqe6lbH0r19fzhTOSwOWZlQHjj1w#MJMATHI-54" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> T </script>  : clave <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-7"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-4"> K </script>  mapeado al intervalo <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-9"><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ </font></font></span><span class="MJXp-mn" id="MJXp-Span-11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-12" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-mn" id="MJXp-Span-13"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.0 </font></font></span><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-5"> [0.1, 1.0) </script>  (usando MD5), que se divide en secciones de las cuales una cadena es responsable.  Las secciones pueden ser de diferentes anchos, dependiendo del "peso" de la cadena, por ejemplo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kt/hy/hq/kthyhqgqi5bn5xthknmw4f5sjou.png"></div><br><br>  Por lo tanto, si algunos bloques físicos son muy poderosos, entonces las cadenas ubicadas en él pueden tener secciones más anchas (entonces caerán más llaves sobre ellas). <br><br><h1>  6. HyperDex </h1><br>  El objetivo de este proyecto era construir un repositorio distribuido de valores clave, que, a diferencia de otras soluciones populares (BigTable, Cassandra, Dynamo), admitirá una búsqueda rápida de atributos secundarios y pueda realizar rápidamente una búsqueda de rango.  Por ejemplo, en los sistemas considerados anteriormente, para buscar todos los valores en un cierto rango, debe pasar por todos los servidores, lo que, obviamente, es inaceptable.  HyperDex resuelve este problema utilizando <i>Hyperspace Hashing</i> . <br><br><h3>  6.1 Arquitectura </h3><br>  La idea del hash hiperespacial es construir <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-6"> n </script>  -dimensional espacio donde cada atributo corresponde a un eje de coordenadas.  Por ejemplo, para los objetos (nombre, apellido, número de teléfono), el espacio podría verse así: <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/zf/be/hu/zfbehu3mpmbsb1bwdfpofn_xywa.png"></div><br><br>  El hiperplano gris pasa a través de todas las teclas, donde apellido = Smith, amarillo - a través de todas las teclas, donde nombre = John.  La intersección de estos planos forma una respuesta a los números de teléfono de búsqueda de personas con el nombre de John y el apellido Smith.  Entonces la solicitud de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-17"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-7"> k </script>  atributos devuelve <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-19"><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k </font></font></span><span class="MJXp-mo" id="MJXp-Span-24" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-8"> (n-k) </script>  -espacio tridimensional. <br><br>  El espacio de búsqueda se divide en <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-25"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> n </script>  tridimensionales disjuntas, y cada región se asigna a un único servidor.  Un objeto con coordenadas de una región se almacena en el servidor de esta región.  Por lo tanto, se crea un hash entre objetos y servidores. <br><br>  Una consulta de búsqueda (por rango) determinará las regiones incluidas en el hiperplano resultante y, por lo tanto, reducirá al mínimo el número de servidores encuestados. <br><br>  Hay un problema con este enfoque: la cantidad de servidores necesarios crece exponencialmente a partir de la cantidad de atributos, es decir,  si atributos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-27"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> k </script>  entonces necesitas <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-29"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font></span><span class="MJXp-mo" id="MJXp-Span-31" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-32"><span class="MJXp-mn" id="MJXp-Span-33" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-34" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-35" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-11"> O (2 ^ k) </script>  servidores  Para resolver este problema, HyperDex aplica una partición del hiperespacio en subespacios (con una dimensión inferior) con, respectivamente, un subconjunto de atributos: <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/s1/nf/tk/s1nftktukf2qd4e9ljjuzsgj_b0.png"></div><br><h3>  6.2 Replicación </h3><br>  Para garantizar una consistencia estricta, los autores desarrollaron un enfoque especial basado en la replicación de la cadena: <i>encadenamiento dependiente del valor</i> , donde cada nodo posterior se determina mediante el hash del atributo correspondiente.  Por ejemplo, la clave <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-36"><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-38" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">J</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42">n</span><span class="MJXp-mo" id="MJXp-Span-43" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mo" id="MJXp-Span-44" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-45" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">S</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">h</span><span class="MJXp-mo" id="MJXp-Span-51" style="margin-left: 0.333em; margin-right: 0.333em;">"</span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> ("John", "Smith") </script>  primero será desplazado hacia el espacio clave (obtenemos la cadena de la cabeza, también llamada <i>punto líder</i> ), luego el hash de <math> </math> $ en línea $ "John" $ en línea $   a la coordenada en el eje correspondiente y así sucesivamente.  (Consulte la imagen a continuación para ver un ejemplo de actualización. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-60"><span class="MJXp-msubsup" id="MJXp-Span-61"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-63" style="vertical-align: -0.4em;">1</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> u_1 </script>  ) <br><br>  Todas las actualizaciones pasan a través de un líder de puntos, que ordena las solicitudes (linealización). <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/qp/ab/z4/qpabz4f0rpxaybrtt5pzhegrrqk.png"></div><br><br>  Si la actualización produce un cambio en la región, primero se escribe la nueva versión inmediatamente después de la anterior (ver actualización <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-64"><span class="MJXp-msubsup" id="MJXp-Span-65"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-66" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-67" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> u_2 </script>  ), y después de recibir el ACK de la cola, se cambiará el enlace a la versión anterior del servidor anterior.  A solicitudes concurrentes (p. Ej. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-68"><span class="MJXp-msubsup" id="MJXp-Span-69"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-71" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> u_2 </script>  y <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-72"><span class="MJXp-msubsup" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-75" style="vertical-align: -0.4em;">3</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> u_3 </script>  ) no violó el punto de coherencia, el líder agrega versiones y otra información meta al servidor, si se recibe <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-76"><span class="MJXp-msubsup" id="MJXp-Span-77"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-79" style="vertical-align: -0.4em;">3</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> u_3 </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-80"><span class="MJXp-msubsup" id="MJXp-Span-81"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-83" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> u_2 </script>  podría determinar que el pedido está roto y que necesita esperar <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-84"><span class="MJXp-msubsup" id="MJXp-Span-85"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86" style="margin-right: 0.05em;">u</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-87" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> u_2 </script>  . <br><br><h1>  7. Reacción en cadena </h1><br>  Se utiliza un modelo causal + de convergencia, que agrega la condición para la convergencia libre de conflicto a la convergencia causal (causal).  Para cumplir con la convergencia causal, se agregan metadatos a cada solicitud, lo que indica las versiones de todas las claves causalmente dependientes.  ChainReaction le permite hacer una replicación geográfica en varios centros de datos y es un desarrollo adicional de la idea de CRAQ. <br><br><h3>  7.1 Arquitectura </h3><br>  La arquitectura de FAWN se usa con cambios menores: cada DC consta de <i>servidores</i> de <i>datos</i> (backends (almacenamiento de datos, replicación, formar un anillo DHT) y <i>proxies de cliente</i> (front-end) (envíe una solicitud a un nodo específico).  Cada clave se replica en R nodos consecutivos, formando una cadena.  Las solicitudes de lectura se procesan por cola y las de cabeza. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/xz/lv/ei/xzlveipiopeqi4enyao1b_fuehw.png"></div><br><h3>  7.2 Un centro de datos </h3><br>  Observamos una propiedad importante que surge de la replicación de la cadena, si el nodo <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-88"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> k </script>  causal-consistente con algunas operaciones del cliente, luego todos los nodos anteriores también.  Entonces si la operación <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-90"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> Op </script>  fue visto por última vez por nosotros en el sitio <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-93"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94">j</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> j </script>  , entonces todos dependientes de la causalidad (de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-95"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> Op </script>  ) las operaciones de lectura solo se pueden realizar en nodos desde la cabeza hasta <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-98"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99">j</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-25"> j </script>  .  Tan pronto como <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-100"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> Op </script>  se ejecutará en la cola, no habrá restricciones de lectura.  Denote las operaciones de escritura que se realizaron por tail en DC <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-103"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-27"> d </script>  como <b>DC-Write-Stable (d)</b> . <br><br>  Cada cliente almacena una lista (metadatos) de todas las claves solicitadas por el cliente en el formato (clave, versión, chainIndex), donde chainIndex es la posición del nodo en la cadena que respondió a la última solicitud de clave.  <b>Los metadatos se almacenan solo para las claves que el cliente no sabe si es DC-Write-Stable (d) o no</b> . <br><br><h4>  7.2.1 Operación de escritura </h4><br>  Tenga en cuenta que una vez que la operación se ha convertido en DC-Write-Stable (d), ninguna solicitud de lectura puede leer versiones anteriores. <br><br>  Para cada solicitud de escritura, una lista de todas las teclas en las que se realizaron operaciones de lectura antes de agregar la última operación de escritura.  Tan pronto como el proxy del cliente recibe la solicitud, realiza lecturas de bloqueo en las colas de todas las claves de los metadatos (estamos esperando la confirmación de la disponibilidad de la misma versión o una más nueva, en otras palabras, cumplimos la condición de coherencia causal).  Tan pronto como se reciben las confirmaciones, la solicitud de escritura se envía al jefe de la cadena correspondiente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l2/qo/k_/l2qok_yldb0_aaqjcfmzj2ap_gk.png"></div><br><br>  Una vez que el nuevo valor se almacena en <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> k </script>  nodos de la cadena, se envía una notificación al cliente (con el índice del último nodo).  El cliente actualiza el chainIndex y elimina los metadatos de las claves enviadas, como  se supo de ellos que son DC-Write-Stable (d).  En paralelo, la grabación continúa aún más: <i>propagación diferida</i> .  Por lo tanto, se da prioridad a las operaciones de escritura en el primer <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-107"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> k </script>  nodos  Tan pronto como tail almacena la nueva versión de la clave, se envía una notificación al cliente y se transmite a todos los nodos de la cadena para que marquen la clave como estable. <br><br><h4>  7.2.2 Operación de lectura </h4><br>  El proxy del cliente envía una solicitud de lectura a <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-109"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-112">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">x</span><span class="MJXp-mo" id="MJXp-Span-115" style="margin-left: 0.111em; margin-right: 0.167em;">:=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">d</span><span class="MJXp-mo" id="MJXp-Span-120" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-121">1</span><span class="MJXp-mo" id="MJXp-Span-122" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">x</span><span class="MJXp-mo" id="MJXp-Span-133" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> index: = rand (1, chainIndex) </script>  nodo en el circuito, mientras distribuye la carga.  En respuesta, el nodo envía el valor y la versión de este valor.  La respuesta se envía al cliente, mientras que: <br><br><ul><li>  Si la versión es estable, entonces el nuevo chainIndex es igual al tamaño de la cadena. </li><li>  Si la versión es más nueva, entonces el nuevo chainIndex = index. </li><li>  De lo contrario, chainIndex no cambia. </li></ul><br><h4>  7.2.3 Conmutación por error del nodo </h4><br>  Es casi completamente idéntico al enfoque básico, con algunas diferencias en el hecho de que en algunos casos el chainIndex del cliente deja de ser válido; esto se determina fácilmente cuando se ejecutan solicitudes (no hay clave con esta versión) y la solicitud se redirige al jefe de la cadena para buscar el nodo con la versión deseada. <br><br><h3>  7.3 Varios ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-134"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31"> N </script>  ) centros de datos (replicación geográfica) </h3><br>  Tomamos como base algoritmos de una arquitectura de servidor único y los adaptamos al mínimo.  Para empezar, en los metadatos, en lugar de solo los valores version y chainIndex, necesitamos vectores versionados de N dimensiones. <br><br>  Definimos Global-Write-Stable de manera similar con DC-Write-Stable (d): la operación de escritura se considera Global-Write-Stable si se realizó en forma de cruz en todos los DC. <br><br>  Aparece un nuevo componente en cada DC: <i>remote_proxy</i> , su tarea es recibir / enviar actualizaciones de otros DC. <br><br><h4>  7.3.1 Realizar una operación de escritura (en el servidor <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-136"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32"> i </script>  ) </h4><br>  El comienzo es similar a una arquitectura de servidor único: realizamos lecturas de bloqueo, escribimos en el primero <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-138"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> k </script>  nudos de una cadena.  En este punto, el proxy del cliente envía al cliente un nuevo vector chainIndex, donde los ceros están en todas partes, excepto la posición <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-140"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-34"> i </script>  - hay un significado <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-142"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">k</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35"> k </script>  .  Siguiente, como siempre.  Una operación adicional al final: la actualización se envía a remote_proxy, que acumula varias solicitudes y luego envía todo. <br><br>  Aquí surgen dos problemas: <br><br><ul><li>  ¿Cómo asegurar dependencias entre diferentes actualizaciones provenientes de diferentes DC? <br><br>  Cada remote_proxy almacena un vector de versión local <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-144"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36"> rvp </script>  dimensiones <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-148"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-149">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37"> N </script>  , que almacena el número de actualizaciones enviadas y recibidas, y lo envía en cada actualización.  Por lo tanto, al recibir una actualización de otro DC, remote_proxy verifica los contadores, y si el contador local es menor, la operación se bloquea hasta que se reciba la actualización correspondiente. </li><li>  ¿Cómo proporcionar dependencias para esta operación en otros DC? <br><br>  Esto se logra utilizando un filtro Bloom.  Al realizar operaciones de escritura / lectura desde el proxy del cliente, además de los metadatos, también se envía un filtro de floración para cada clave (llamados filtros de respuesta).  Estos filtros se almacenan en la lista <i>AccessedObjects</i> y, cuando se solicitan operaciones de escritura / lectura, los metadatos también envían filtros OR a las claves enviadas (denominado filtro de dependencia).  Del mismo modo, después de la operación de escritura, se eliminan los filtros correspondientes.  Al enviar una operación de escritura a otro DC, también se envían un filtro de dependencia y un filtro de respuesta para esta solicitud. <br><br>  Además, el DC remoto, después de haber recibido toda esta información, verifica que si los bits establecidos del filtro de respuesta coinciden con los bits establecidos de varios filtros de consulta, entonces tales operaciones son potencialmente dependientes casuales.  Potencialmente, porque un filtro de floración. </li></ul><br><h4>  7.3.2 Operación de lectura </h4><br>  De manera similar a una arquitectura de servidor único, ajustada para usar el vector chainIndex en lugar de un escalar y la posibilidad de que falte una clave en el DC (porque las actualizaciones son asíncronas), espere o redirija la solicitud a otro DC. <br><br><h4>  7.3.3 Resolución de conflictos </h4><br>  Gracias a los metadatos, las operaciones causales dependientes siempre se realizan en el orden correcto (a veces hay que bloquear el proceso para esto).  Pero los cambios competitivos en diferentes países en desarrollo pueden generar conflictos.  Para resolver tales situaciones, se utiliza Last Write Wins, para el cual hay un par presente en cada operación de actualización <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-150"><span class="MJXp-mo" id="MJXp-Span-151" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-154">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">j</span><span class="MJXp-mo" id="MJXp-Span-157" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">s</span><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-38"> (reloj, s) </script>  donde <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-160"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">c</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-39"> c </script>  - horas en proxy, y <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-162"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163">s</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-40"> s </script>  - Identificación de DC. <br><br><h4>  7.3.4 Manejo de fallas de nodo </h4><br>  Similar a la arquitectura de servidor único. <br><br><h1>  8. Aprovechamiento de fragmentación en el diseño de protocolos de replicación escalables </h1><br>  El objetivo del estudio es construir un sistema distribuido con fragmentos y con replicación sin utilizar un proceso maestro externo para reconfigurar / monitorear el clúster. <br><br>  En los principales enfoques actuales, los autores ven las siguientes desventajas: <br><br>  Replicación: <br><br><ul><li>  Primaria / Copia de seguridad: conduce a una discrepancia en el estado si Primaria se identificó erróneamente como fallida. </li><li>  Intersección del quórum: puede provocar una discrepancia de estado durante la reconfiguración del clúster. </li></ul><br>  Consistencia estricta: <br><br><ul><li>  Los protocolos se basan en algoritmos de votación mayoritaria (por ejemplo, Paxos) cuando sea necesario <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-164"><span class="MJXp-mn" id="MJXp-Span-165">2</span><span class="MJXp-mo" id="MJXp-Span-166" style="margin-left: 0.267em; margin-right: 0.267em;">∗</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-167">N</span><span class="MJXp-mo" id="MJXp-Span-168" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-169">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-41"> 2 * N + 1 </script>  nudos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-170"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-171">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-42"> N </script>  nodos </li></ul><br>  Detección de fallas de nodos: <br><br><ul><li>  P / B y CR implican la presencia de detección ideal de nodos fallidos con un modelo de detención de fallos, que es inalcanzable en la práctica y debe elegir un intervalo de exploración adecuado. </li><li>  ZooKeeper está sujeto a los mismos problemas: con una gran cantidad de clientes, se requiere una cantidad de tiempo considerable (&gt; 1 segundo) para que actualicen la configuración. </li></ul><br>  El enfoque propuesto por los autores, llamado <i>replicación elástica</i> , carece de estas deficiencias y tiene las siguientes características: <br><br><ul><li>  Consistencia estricta. </li><li>  Para soportar la caída <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-172"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-43"> N </script>  los nodos deben tener <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-174"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">N</span><span class="MJXp-mo" id="MJXp-Span-176" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-177">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-44"> N + 1 </script>  nudo </li><li>  Reconfiguración sin pérdida de consistencia. </li><li>  No hay necesidad de protocolos de consenso basados ​​en un voto mayoritario. </li></ul><br>  Placa resumen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/al/nh/yf/alnhyf9vzquirk-ztizoplkeypa.png"></div><br><h3>  8.1 Organización de réplicas </h3><br>  Cada fragmento define una secuencia de configuraciones <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-178"><span class="MJXp-mtext" id="MJXp-Span-179">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-184">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186">l</span><span class="MJXp-mrow" id="MJXp-Span-187"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">C</span></span><span class="MJXp-mo" id="MJXp-Span-189" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-190"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-191" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-192" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-193" style="margin-left: 0.111em; margin-right: 0.167em;">::</span><span class="MJXp-msubsup" id="MJXp-Span-194"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-196" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-197" style="margin-left: 0.111em; margin-right: 0.167em;">::</span><span class="MJXp-msubsup" id="MJXp-Span-198"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-199" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-200" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mtext" id="MJXp-Span-201">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">s</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-45"> \ mathcal {C} = C_1 :: C_2 :: C_3 \ dots </script>  por ejemplo, la nueva configuración no contiene algún tipo de réplica caída <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-206"><span class="MJXp-mtext" id="MJXp-Span-207">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-208">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">l</span><span class="MJXp-mrow" id="MJXp-Span-215"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">C</span></span><span class="MJXp-mo" id="MJXp-Span-217" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-218">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225">l</span><span class="MJXp-mrow" id="MJXp-Span-226"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227">C</span></span><span class="MJXp-mo" id="MJXp-Span-228" style="margin-left: 0.111em; margin-right: 0.167em;">::</span><span class="MJXp-mo" id="MJXp-Span-229" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-230">R</span><span class="MJXp-mrow" id="MJXp-Span-231"><span class="MJXp-mo" id="MJXp-Span-232" style="margin-left: 0em; margin-right: 0em;">é</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-236">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-238">s</span><span class="MJXp-mtext" id="MJXp-Span-239">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-245">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-246">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247">s</span><span class="MJXp-msubsup" id="MJXp-Span-248"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249" style="margin-right: 0.05em;">R</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-250" style="vertical-align: -0.4em;">j</span></span><span class="MJXp-mo" id="MJXp-Span-251" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-46"> \ mathcal {C} = \ mathcal {C}: :( Réplicas \ setminus R_j) </script><br><br>  Cada elemento de la secuencia de configuración consta de: <br><br><ul><li>  réplicas: un conjunto de réplicas. </li><li>  <i>orderer</i> : identificación de una réplica con un rol especial (ver más abajo). </li></ul><br>  Cada fragmento está representado por un conjunto de réplicas (por construcción - <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-252"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-47"> N </script>  ), es decir  no dividimos los roles de "fragmento" y "réplica". <br><br>  Cada réplica almacena los siguientes datos: <br><br><ul><li>  conf - id de la configuración a la que pertenece esta réplica. </li><li>  orden: qué réplica es la orden de esta configuración. </li><li>  modo - modo réplica, uno de tres: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-254"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-255">P</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-257">N</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-259">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-261">N</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263">E</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-48"> PENDIENTE </script>  (todas las réplicas de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-264"><span class="MJXp-msubsup" id="MJXp-Span-265"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-266" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-267" style="vertical-align: -0.4em;">1</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-49"> C_1 </script>  ), <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-268"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-271">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-272">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-273">V</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274">O</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-50"> ACTIVO </script>  (todas las réplicas de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-275"><span class="MJXp-msubsup" id="MJXp-Span-276"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-277" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-278" style="vertical-align: -0.4em;">1</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-51"> C_1 </script>  ), <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-279"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-280">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-281">N</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-282">M</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-283">U</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-284">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">L</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288">E</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-52"> INMUTABLE </script>  . </li><li>  historial: secuencia de operaciones en los datos de réplica reales <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-289"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-290">o</span><span class="MJXp-msubsup" id="MJXp-Span-291"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-293" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-294" style="margin-left: 0.111em; margin-right: 0.167em;">::</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-295">o</span><span class="MJXp-msubsup" id="MJXp-Span-296"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297" style="margin-right: 0.05em;">p</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-298" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-299" style="margin-left: 0.111em; margin-right: 0.167em;">::</span><span class="MJXp-mtext" id="MJXp-Span-300">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-302">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-303">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304">s</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-53"> op_1 :: op_2 :: \ dots </script>  (o solo una condición). </li><li>  estable: la longitud máxima del prefijo del historial que fija esta réplica.  Obviamente <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-305"><span class="MJXp-mn" id="MJXp-Span-306">0</span><span class="MJXp-mo" id="MJXp-Span-307" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-309">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-310">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-312">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">e</span><span class="MJXp-mo" id="MJXp-Span-315" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-318">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-320">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-321">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-322">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-323">d</span><span class="MJXp-mo" id="MJXp-Span-324" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-326">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-328">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-329">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-333">l</span><span class="MJXp-mo" id="MJXp-Span-334" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-54-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-54"> 0 <= estable <= longitud (historial) </script>  . </li></ul><br>  El objetivo principal de un pedido de réplica es enviar solicitudes al resto de las réplicas y mantener el prefijo de historial más grande: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7_/hk/lo/7_hklowfxczcx0tjd5grugrw9a8.png"></div><br><h3>  8.2 Organización de fragmentos </h3><br>  Los fragmentos se combinan en anillos llamados <i>bandas elásticas</i> .  Cada fragmento pertenece a un solo anillo.  El precursor de cada fragmento <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-335"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336">X</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-55"> X </script>  realiza un papel especial: él es un <i>secuenciador</i> para él.  El trabajo del secuenciador es dar a su sucesor una nueva configuración en caso de fallas de réplica. <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/sc/8g/se/sc8gsegolx8iarmilhrkeftetfo.png"></div><br>  Se requieren dos condiciones: <br><br><ul><li>  Cada banda elástica tiene al menos un fragmento y una réplica de trabajo. </li><li>  Cada banda elástica tiene al menos un fragmento, en el que funcionan todas las réplicas. </li></ul><br>  La segunda condición parece demasiado estricta, pero es equivalente a la condición "tradicional" de que el proceso maestro nunca cae. <br><br><h3>  8.3 Uso de la replicación en cadena </h3><br>  Como habrás adivinado, las réplicas están organizadas como una cadena (enfoque básico): el encargado será el responsable, con ligeras diferencias: <br><br><ul><li>  En caso de falla en CR, el nodo es arrojado fuera de la cadena (y reemplazado por uno nuevo), en ER - se crea una nueva cadena. </li><li>  Las solicitudes de lectura en CR se procesan por cola, en ER, pasan por toda la cadena de la misma manera que las solicitudes de escritura. </li></ul><br><h3>  8.5 Reconfiguración en caso de falla </h3><br><ul><li>  Las réplicas son monitoreadas tanto por las réplicas de su fragmento como por las réplicas de un fragmento secuenciador. </li><li>  Tan pronto como se detecta una falla, las réplicas envían un comando al respecto. </li><li>  Sequencer envía una nueva configuración (sin una réplica fallida). </li><li>  Se crea una nueva réplica que sincroniza su estado con la banda elástica. </li><li>  Después de eso, el secuenciador envía la nueva configuración con la réplica agregada. </li></ul><br><h1>  Referencias </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://">Hibari</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hyperdex.orgerdex.org</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HyperDex: un almacén de valores clave distribuido y con capacidad de búsqueda</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Reacción en cadena</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aprovechamiento de fragmentación en el diseño de protocolos de replicación escalables</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es432020/">https://habr.com/ru/post/es432020/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es432006/index.html">La historia de cómo me metí en el tema de la salud de la mujer.</a></li>
<li><a href="../es432008/index.html">Persiguiendo estándares web</a></li>
<li><a href="../es432012/index.html">Cómo probar contratos inteligentes</a></li>
<li><a href="../es432014/index.html">Kali Linux para principiantes</a></li>
<li><a href="../es432016/index.html">Cómo la música y el dibujo me enseñaron a programar</a></li>
<li><a href="../es432022/index.html">Forkney it: 8 proyectos Go que son interesantes para cavar en el código fuente</a></li>
<li><a href="../es432024/index.html">Gradle 5.0: novedades</a></li>
<li><a href="../es432030/index.html">El camino hacia un detector de mentiras sin contacto, o Cómo organizar un hackathon a la velocidad máxima</a></li>
<li><a href="../es432032/index.html">Terminamos el campo de búsqueda de Google clavado</a></li>
<li><a href="../es432034/index.html">El libro "Electricidad paso a paso" de Rudolf Svoren</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>