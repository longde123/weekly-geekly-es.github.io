<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•¸ï¸ ğŸ“Ÿ ğŸ“˜ Kisah bagaimana saya memperbarui Yandex MapKit di iOS atau peta, uang, 2 pemetaan ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ¼ âœ–ï¸ ğŸ¤±ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kata Pengantar 

 Halo teman-teman , pada awalnya saya akan segera menguraikan tujuan artikel: menghemat waktu Anda jika Anda perlu memperbarui atau m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kisah bagaimana saya memperbarui Yandex MapKit di iOS atau peta, uang, 2 pemetaan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427611/"><h3>  Kata Pengantar </h3><br><br>  <b>Halo teman-teman</b> , pada awalnya saya akan segera menguraikan tujuan artikel: <b>menghemat waktu</b> Anda jika Anda perlu <b>memperbarui atau menyematkan peta Yandex</b> di klien seluler iOS Anda, ditambah keinginan untuk berbagi pengalaman Anda. <br><br>  Kami pernah membangun aplikasi YandexMapkit (sekitar Oktober 2017) alih-alih kartu email (bukan pribadi - hanya bisnis).  Setelah sekitar 3 bulan, pada hari musim dingin yang indah, kartu versi Androyd menjadi rusak pada hari ke-2 karena kunci, kartu hanya berubah menjadi labu). Apa tip dari manual: "Pada android kartu rusak, mereka tidak tahu cara memperbaikinya" Pada saat itu sebagai klien iOS, ini tidak mempengaruhi.  Orang miskin di android ... kali ini orang-orang itu tidak ada hubungannya.  Pada masa itu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">, banyak penginapan jatuh</a> : jabatan Rusia, Platypus, mungkin kalian ingat? <br><br><img src="https://habrastorage.org/webt/ny/sl/uk/nysluk1xq_j6lfzmv2tmusk_gci.png"><br><br>  Ini untuk mengatakan bahwa ketika aplikasi Anda terikat ke layanan pihak ketiga, alangkah baiknya jika Anda memiliki rencana "B" untuk kasus ini, misalnya, beralih ke versi kartu yang sebelumnya dari Apple, dan tidak mengganti satu sama lain ... <br><br>  Setelah 3 bulan berikutnya, di suatu tempat di bulan Maret, sebuah surat tiba dari Yandex bahwa mereka akhirnya memperbarui SDK, (sangat sedikit waktu telah berlalu, 4-5 tahun dari pembaruan sebelumnya): <br>  "-Perbarui, matikan yang lama dalam setahun," singkatnya.  Sebelum itu, hanya ada versi lama 1.0 <br><br><img src="https://habrastorage.org/webt/mk/bn/el/mkbnelhsho-0yzuynyrwg8fw6by.png"><br><a name="habracut"></a><br>  Yah, tentu saja, setelah peringatan seperti itu, kami tidak menarik dan segera memulai transisi ... setelah 3 bulan)) pada bulan Agustus. <br><br><h2>  Tahap "berkomentar"! (Menonaktifkan fungsi) </h2><br>  Anda berkata, ha ... apa yang diperbarui di sana, pod diperbarui, diperbaiki beberapa tempat dan itu saja.  Jadi tidak, teman-teman, API peta baru sama sekali tidak kompatibel dengan yang lama, dan terlebih lagi, ternyata kemudian, bahkan ada banyak kebutuhan vital yang tidak tersedia di versi lama dan perpustakaan kartu lainnya! <br><br>  Jadi, mapkit 3.0 (saat menulis artikel versi 3.1 dirilis), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan ke dokumentasi</a> . <br><br>  Dan mengapa selain peringatan dari Yandex?  Sementara itu, pada versi beta Xcode 10, sebuah proyek dengan paus tua tidak akan melakukannya dengan bodoh, karena C ++ digunakan di suatu tempat di dalam, yang dihilangkan dalam versi baru.  Perlu untuk mengubah nama di sub-daftar, bahkan memperbaruinya di sana, dll, singkatnya, saya tidak melakukan ini, karena pada akhirnya saya masih perlu memperbarui <br><br>  1) Kami memperbarui SDK, bukan versi 1.0 segera 3.0, tentu saja API telah berubah, tetapi begitu banyak .... <br><br>  Jadi Protokol Catatan YMKA yang lama hilang begitu saja <br><br><img src="https://habrastorage.org/webt/0y/ma/2j/0yma2jg0ol_cmlsv5iawysjcq4c.png"><br><br><br>  Dalam gerakan cepat, itu terlihat seperti batang yang dipalsukan secara paksa (: itu tidak berdengung, dan kemudian Anda berkeliling membawa tanda "!" Ke diri sendiri ... Contoh implementasi protokol: <br><br><img src="https://habrastorage.org/webt/6_/7u/uw/6_7uuw9qsz5xa0xydgf5rqeturk.png"><br><br>  Baiklah, mari kita tulis kembali) milik kita sendiri, hanya alih-alih metode koordinat () kita akan membuat propertinya, semuanya sederhana, metode ini berlebihan;  judul! () diganti dengan judul yang belum terbentuk (), di sisi lain, Anda dapat membuat properti, well, ada banyak tempat Anda harus mengubah proyek, jadi saya baru saja menghapus tanda seru. <br><br>  Dalam proyek kami, perlu untuk mengganti 3 pengendali beberapa kali, mengimpor CoreLocation di yang lain, karena sekarang tidak diimpor di salah satu header Yandex MapPocket. <br><br>  Agar tidak mengubah nama YMKMapCoordinate (paus lama) yang sudah dikenal sepanjang proyek, buatlah typealias untuk YMKPoint (paus baru) <br><br><img src="https://habrastorage.org/webt/bk/xi/iv/bkxiivvenzq6k_yulfn8thesay8.png"><br><br>  2) Juga, mari deklarasikan beberapa properti yang akan kita perlukan di masa depan untuk bekerja dengan peta, terutama pengambil: <br><br><img src="https://habrastorage.org/webt/wx/15/zu/wx15zujdm2ylkpok3cujwbagzog.png"><br><br>  3) Hal pertama yang harus dibuat adalah YMKMapView (semuanya baik-baik saja dengan itu, objek seperti itu masih tersedia).  Sebelumnya, saya langsung menginisialisasi, sekarang Anda tidak dapat melakukan ini, itu akan macet, karena pertama-tama Anda harus meletakkan kunci!  Kunci saat ini tidak akan berfungsi dan Anda perlu meminta yang baru.  Tambahkan ke AppDelegate, sesuai dengan dokumentasi.  Hanya setelah mengatur kunci, dapatkah kita membuat YMKMapView dan mengkonfigurasinya dengan cara yang kita butuhkan dalam metode setupMap () <br><br><img src="https://habrastorage.org/webt/ab/fp/8b/abfp8ba-jefubna2qmqsmsxpg7q.png"><br><br>  Apa yang terjadi di sini, kami akan menganalisis secara rinci nanti dalam rangka kebutuhan untuk pengaturan yang sesuai <br><br>  4) Apa selanjutnya?, Dan kemudian kami memiliki lokasi awal CLLocation, tetapi sekarang untuk menggunakannya Anda perlu menambahkan kerangka kerja CoreLocation secara manual, atau ... atau menggantinya dengan YMKPoint dari mapkit Yandex <br><br><img src="https://habrastorage.org/webt/jw/eo/hj/jweohjs_xdkhqdjhg5ludux4qsi.png"><br><br>  5) Selanjutnya, peta dipusatkan pada koordinat ini dengan metode yang sangat sederhana, tetapi sekarang tidak ada yang sederhana <br><br><img src="https://habrastorage.org/webt/db/w_/sf/dbw_sf_pf_7nqkfk4wil_mlt8kw.png"><br><br>  Tetapi ada sedikit lebih rumit dan sedikit lebih dalam, objek peta) ... mapView.mapWindow.map! .Move.  Di sini kita belajar tentang keberadaan objek seperti YMKCameraPosition. <br><br><img src="https://habrastorage.org/webt/6y/hd/lt/6yhdltmfe8hap6p06qzpyk7clj8.png"><br><br>  6) Selanjutnya, kami mengomentari konfigurasi peta, karena tidak ada api / properti seperti itu.  Sekarang kita hanya menghilangkannya untuk memulai setidaknya secara minimal. <br><br>  Kami berkomentar tentang menambahkan anotasi, (Saya akan memperhatikan bahwa ini adalah fungsi standar), kami juga mengomentari untuk menunjukkan poin terdekat (ini sudah semacam fungsi kami). <br><br>  Dan keseluruhan YMKMapViewDelegate juga merupakan komentar, yang tidak saya temukan dalam kerangka kerja baru, dan analog yang serupa juga. <br><br><img src="https://habrastorage.org/webt/ug/jg/ix/ugjgixhzbdvdjtqnyz3g-vawas8.png"><br><br>  Saya mengabaikan implementasinya, hanya metodenya sendiri: <br><br>  - apakah akan menampilkan lokasi pengguna, <br>  - tampilan yang digunakan untuk pin, <br>  - Reaksi untuk mengklik anotasi, <br>  - info apa untuk anotasi, <br>  - Reaksi terhadap mengklik callout, yaitu, semua yang biasa kita gunakan.  Pada akhirnya, ada beberapa jenis metode kami, yang juga menggunakan kartu API tertentu. <br><br>  <b>SEGALA SESUATU</b> tahu dengan MapVC - ini adalah kelas utama di mana mapkit digunakan <br><br>  7) Sedikit komentar tentang info khusus, itu tidak akan mewarisi YMKCalloutView lagi, tidak ada lagi di paus baru. <br><br>  Hore, sekarang proyek telah berkumpul, saya dapat memulai segalanya dan ... melihat buku catatan di dalam kotak, karena setelah dimulai, Anda perlu memberi waktu untuk "pemanasan")), tetapi saya tidak tahu tentang hal itu dan berpikir bahwa ada sesuatu yang tidak jadi, meskipun saya menyarankan agar perlu waktu untuk mengaktifkan kunci.  Ternyata anggapan itu benar.  Anda perlu menunggu sekitar satu jam (mungkin sesuatu telah berubah sekarang). <br><br>  Dengan upaya lain untuk memodifikasi api lama dengan cara baru, peta ditampilkan. <br><br><h2>  Tahap dua - "pencarian" (bagaimana menerapkan fungsi lama dengan cara baru) </h2><br>  Mari kita mulai mengembalikan fungsionalitas yang hilang.  Jadi, Anda perlu menampilkan kunci pengguna, tetapi dengan cara lama hanya mengubah properti dan pengaturan delegasi tidak dapat dilakukan. <br><br>  Sekarang ini dilakukan melalui layer, lihat metode setupMap () poin 3. <br><br><img src="https://habrastorage.org/webt/cs/w5/c8/csw5c8t0hyasi5x87xzmgeffs60.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kami akan melihat</a> contoh di demo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">unduh dari Yandex github</a> ), karena ada di sana.  Ngomong-ngomong, Anda harus memperhatikan setAnchorWith.  Nanti saya akan bilang kenapa, itu terkait dengan zoom.  Ok lokasi berhasil. <br><br>  2) Apa selanjutnya, tentu saja, penjelasan.  Anda tidak dapat menambahkan dengan cara lama, kami melihat dalam demo lagi.  Ada kelas di sana - MapObjectsViewController.  Di versi baru, untuk menambahkan pin ke peta, delegasi tidak diperlukan, untuk ini Anda perlu mengakses properti mapObjects, memanggil metode addPlacemark pada objek, dan meneruskan koordinat di sana (masih ada kelebihan lainnya) Contoh: <br><br><img src="https://habrastorage.org/webt/-c/au/s4/-caus4cx0bkkkniwy66g8mpqi6k.png"><br><br>  Kami beralih pada koleksi anotasi (misalnya, setelah menerima dari server) dan menambahkan satu ke peta.  Metode, omong-omong, mengembalikan "placeMark" (label tempat), yang dapat digunakan untuk membuat pengaturan tambahan, misalnya, mengubah urutan tampilan melalui properti zIndex. <br><br>  Namun, di sini, saya kehilangan poin bahwa sebelum itu saya naik ke pencarian untuk delegasi dan tidak menemukannya dengan aman, dan tidak ada satu pun delegasi sama sekali (pada kenyataannya, mereka hanya mulai dipanggil secara berbeda, sekarang mereka adalah pendengar).  Saya tahu dari pengalaman sebelumnya dengan paus Apple dan paus Yandex lama bahwa anotasi digunakan kembali, seperti halnya dengan sel, tetapi hanya ada addPlacemark di demo.  Untuk pertanyaan tentang kartu Yandex-cards (seorang kenalan pribadi kecil membantu di sini) "- Bagaimana mengoptimalkan penggunaan memori, menggunakan kembali benda-benda?"  Jawab: "Ya, jadi itu bekerja dengan baik" ... yah, semacam ya, itu bekerja. <br><br>  Catatan: 1) Penting untuk dicatat bahwa Yandex.Maps menggunakan mapkit, dan jangan mengembangkannya.  Ini dilakukan oleh tim mapkit (nama panggilan Nikolai di hub - likhogrud @). <br><br>  2) Penjelasan mengapa objek tidak digunakan kembali: <br><br>  Di paus lama, annotationViews adalah view, mereka dibuat oleh pengguna, dan tentu saja view perlu digunakan kembali, karena membuatnya tidak murah.  Pada paus baru, tanda letak dibuat oleh mapkit langsung di GL terbuka.  Dan mungkin mereka digunakan kembali di sana, tetapi ini tidak akurat.  Bagaimanapun, ini jauh lebih efisien daripada menciptakan tampilan. <br><br>  3) Dari yang baru, ngomong-ngomong, ada kemungkinan memodifikasi ikon anotasi untuk pengguna.  Diimplementasikan sebagai berikut: Anda perlu menambahkan pendengar (analog dari delegasi), menerapkan protokol yang sesuai - 1 dari 3 metode, 2 biarkan kosong. <br><br>  Pada saat yang sama, muat ulang tanda letak dengan ikon kami. <br><br><img src="https://habrastorage.org/webt/yq/2t/cv/yq2tcvkmlgp6mxfh5hpppwqgmk4.png"><br><br>  Juga, saya menarik perhatian Anda ke properti jangkar.  Setelah menekan tombol lokasi pengguna di peta, kamera memindahkan fokus ke pusat lokasi.  Tetapi masalahnya adalah, menekan tindakan lagi tidak menghasilkan.  Apa?  Kami mengomentari metode jangkar dan semuanya berfungsi. <br><br>  4) Sekarang Anda harus menampilkan info, masing-masing, untuk menentukan klik.  Ada beberapa metode di antarmuka, yang benar adalah YMKMapObjectTapListener.  Ada 1 metode menarik yang penting yang harus saya siksa sendiri nanti, itu mengembalikan true agar tidak berintegrasi lebih lanjut jika pelanggan ditemukan.  Saya menarik perhatian Anda, Anda harus berlangganan terlebih dahulu, mapObjects akan berlangganan (baris 149). <br><br><img src="https://habrastorage.org/webt/ar/2j/gp/ar2jgphtrvt_or_szwtibdupw74.png"><br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Jadi klik memenuhi.  <b>Hore</b> .  Namun, ada upaya untuk menampilkan pin hanya di zona yang terlihat, ini berlebihan, tampilkan semuanya sekaligus, jadi mari kita tinggalkan (hanya karena tidak memperlambat) <br><br>  5) Lalu saya ingin membuat tombol zoom in / out untuk kenyamanan.  Sedikit salin-tempel dan edit dengan analogi dengan tombol lokasi, dan Anda selesai. <br><br>  Lebih lanjut, karena kita tahu tentang kamera, menggunakan metode bergerak dan, karenanya, zoom saat ini + - 1 atau 0,5, sesuai kebutuhan.  Semuanya baik-baik saja di sini. <br><br><img src="https://habrastorage.org/webt/ar/_s/-p/ar_s-pit7r4wjzzbrbgyiylgm00.png"><br><br>  6) Kami beralih ke fungsi - panggilan utama (ini adalah persegi panjang dengan info tambahan, dengan segitiga di bagian bawah).  Ternyata tidak ada API ("memabukkan di musim panas" - Yandex mengenali pidato saya ketika saya membaca catatan dari selebaran agar tidak mengetik secara manual artikel ini). <br><br><img src="https://habrastorage.org/webt/ck/b3/ew/ckb3ewygj9uy3itbzrlq63wqtfk.png"><br><br>  Bagaimana kabar kalian  100 500 aplikasi menggunakan info. <br><br>  Kami menulis dengan baik di "dukungan teknis" (Kolya) bagaimana melakukan ini secara manual, saya mengetahuinya.  Apa saja pilihanmu? <br><br>  <s>Ubah tampilan menjadi gambar, karena Anda tidak dapat langsung menambahkan tampilan</s> (menambahkan file dalam 3.1), ubah ikon ... <br><br><img src="https://habrastorage.org/webt/tz/w2/qd/tzw2qdppbx86whmrgmqqzmhysge.png"><br><br>  Kruk ini didapat di sebuah flat, sepertinya tempatnya. <br>  Bahkan, bukan kruk, tentu saja, tetapi hanya ketidakhadiran saya mempertimbangkan fungsi dasar <br><br>  7) Oke, mari kita tambahkan testout terlebih dahulu, karena itu kita menggunakan kotak merah.  Jadi, dengan mengklik pin kami, metode delegate / listener dipanggil, di mana titik klik dan objek ditransfer.  Tanpa mengharapkan trik, kami menganggap "titik" sebagai titik di mana Anda ingin menambahkan info.  (Perhatian, apakah semuanya dilakukan dengan benar: "Mereka mengklik, mengambil poin, mengikatnya?" Sekitar 80% menjawab dengan benar, 20% - tidak) <br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Dan panggil metode bantuan showCallout di tubuh metode: <br><br><img src="https://habrastorage.org/webt/sq/aa/8w/sqaa8wmstqdunxobdbyr0xa0jg4.png"><br><br>  baris 544 <br>  Di dalam, buat tampilan uji warna merah empat puluh kali empat puluh, ubah menjadi gambar, nyatakan konstanta x dengan nilai 0,5, itu akan digunakan untuk posisi segitiga info di tengah titik.  Dia menolak ide untuk mengubah posisinya, kemudian lebih suka memindahkan kamera sehingga info yang dipilih ditampilkan di tengah layar ponsel. <br><br>  Selanjutnya, kita mendeklarasikan area "push" dari tappableArea, ada properti seperti itu dalam gaya ikon untuk pin.  Oh well, Anda dapat membatasi zona klik, dan kami akan melakukannya.  Zona tersebut berkisar dari 0,0 hingga 1,1.  kita perlu bagian bawah, di mana seharusnya ada tombol yang diubah menjadi gambar sebelumnya (ingat).  Oke, ini artinya zona (0,0.5 - 1.1) karena tombolnya di bawah. <br>  Pembatasan zona berfungsi, tetapi ada nuansa, sehingga meniadakan segalanya.  Jika ada pin lain di bawah area yang tidak ditekan, maka menekan akan berhasil.  Arti dari daerah ini?  Apakah mereka akan membuat bendera atau sesuatu sehingga klik tidak lulus.  Oke ... <br><br>  550 baris <br>  mari kita buat gaya untuk ikon, Anda dapat segera menentukan posisi jangkar di parameter pertama, misalnya, saya lakukan di bawah pada baris 557.  Posisi y adalah 1,05 untuk menaikkan segitiga di atas pin lagi secara vertikal <br><br>  559 baris <br>  buat info khusus kami dengan ukuran tertentu, <br>  kami mengonfigurasi bidang yang kami perlukan menggunakan informasi dari anotasi yang dipilih terpilih Anotasi, khususnya judul dan sub-judul, tulisan pada tombol untuk info ini.  Maka Anda sendiri dapat melakukan apa yang Anda inginkan.  Anotasi yang dipilih ditentukan sebelumnya dalam delegasi.  Tetapi untuk sekarang, tambahkan kotak merah yang dibuat sebelumnya <br>  Selanjutnya, tambahkan pin ke koleksi mapObjects, metode ini akan mengembalikan tanda letak yang ditambahkan kepada kami, simpan dalam variabel, <br>  Dengan mengklik pada callout itu sendiri, controller yang terperinci terbuka, dan begitu nuansanya, jika di bawah popup pin lain juga masuk ke dalamnya, delegasi akan bekerja lagi, jadi di sini Anda perlu mengubah urutan dalam hierarki melalui zIndex.  Atur visibilitas dan pindahkan info kami ke pusat di saluran 564 <br><br>  <b>Nuansa</b> : Tanda letak variabel adalah pointer ke info. <br>  Pada awalnya kami tidak memilikinya, setelah mengklik pin, tampaknya, setelah mengklik pada pin berikutnya, kami perlu menghapus info pertama kami dan menambahkan yang baru.  Karenanya, jika tanda letak variabel! = Nihil, Anda harus menghapus info lama dari koleksi mapObjects) <br><br><img src="https://habrastorage.org/webt/3r/fo/dg/3rfodg0siuahk0tsvk1qzyvydae.png"><br><br>  Juga, dalam kasus tapas pada kartu, Anda perlu menyembunyikan info, jadi dalam metode delegasi kami menetapkan tanda letak, pengamat berfungsi, info tersebut dihapus, ditambah kami menghapus anotasi yang dipilih <br><br>  Untuk ini, kami mendaftar untuk YMKMapInputListener sebelumnya <br><br><img src="https://habrastorage.org/webt/ew/f-/a2/ewf-a2uvc7khz8okkxw-s6etxds.png"><br><br>  <s>Pada gilirannya, metode untuk mengonversi tampilan adalah sebagai berikut.</s>  (Dalam versi 3.1, menambahkan kemampuan untuk menambahkan tampilan ke peta) <br>  Saya tidak menjelaskan cara melakukan tampilan), tetapi jika akan ada banyak masalah (dimungkinkan dengan segitiga) dengan ini, maka tulis, saya akan menambahkan tahap ini <br><br><img src="https://habrastorage.org/webt/v1/mx/nk/v1mxnkmtkahrp5j6umoevtwadlc.png"><br><br>  Magic 20 yang ditambahkan pada ketinggian diperlukan untuk tempat di bawah segitiga di bawah ini, yang harus Anda gambar <br><br>  Kami juga ingin popup muncul (dilampirkan) ke pin di tempat tertentu (kiri, kanan, di tengah), untuk ini ada properti jangkar.  Didefinisikan sebagai berikut: <br>  Kami membagi area yang terlihat dari peta menjadi 3 zona vertikal dan menentukan di mana kita berada, tergantung pada ini, mengubah posisi penjilidan.  Dalam contoh kode, kita memeriksa apakah kita berada di sisi kiri, dengan analogi yang kita lakukan untuk tengah, jika tidak kiri dan tidak di tengah, masing-masing, titik di kanan adalah <br><br><img src="https://habrastorage.org/webt/o-/xq/ii/o-xqiijbnowv2clav2ny2tl5drc.png"><br><br>  Fungsi pembantu untuk memeriksa apakah suatu titik jatuh ke suatu wilayah: <br><br><img src="https://habrastorage.org/webt/dr/os/5e/dros5emmil06hsac_h-rdbwk_jq.png"><br><br>  Mulai.  Itu bekerja.  Tapi ada nuansa, sepertinya kita mencoba untuk memperbesar, satu, dua, tiga, dan info terbang menjauh dari pin.  Apa?  Bagaimana? <br><br><img src="https://habrastorage.org/webt/9v/il/7f/9vil7fru-hbitdlkvqtu6oeyhnw.gif"><br><br>  7) Kami mulai men-debug, koordinatnya sama <br><br><img src="https://habrastorage.org/webt/tt/t1/u1/ttt1u1jgezg-_ld3n_ksj-e_m90.png"><br><br>  Kemudian ada upaya untuk memahami apa yang terjadi dan bagaimana cara kerjanya, kembali lagi ke demo, pencarian perbedaan yang lebih penuh perhatian ... <br><br><img src="https://habrastorage.org/webt/oc/nb/d_/ocnbd_n89jitplbg4_dtukbnvlo.jpeg"><br><br>  Saya perhatikan bahwa koordinatnya ditransmisikan secara langsung, dan bukan yang disadap!  Tapi saya debazed, jelas bahwa koordinatnya sama, yaitu lingkaran dan bujur sangkar memiliki koordinat yang sama. <br>  Itu sebabnya dalam metode ini saya tidak langsung mengakses objek, tetapi melewati titik, yang tidak benar. <br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Tetapi apakah Anda perlu melemparkan objek, mengambil properti (di mana semuanya disebut berbeda, lalu berkoordinasi, lalu menunjuk, di sini sekarang geometri) apakah ini kreatif atau apa?  493 baris <br><br><img src="https://habrastorage.org/webt/_u/oo/5h/_uoo5hjrg5okyoodbijb7s0rzzo.png"><br><br>  Karena kita perlu memproses dua opsi pengepresan: yang pertama untuk pin, yang kedua untuk callout, dan tidak untuk memproses klik jika kita mengklik pada pin yang sama lagi, hal <b>pertama</b> yang kita lakukan adalah menemukan pin yang kita klik pada koleksi pin, membandingkan mengkoordinasikan 495 baris, jika tidak mengembalikan true, dengan demikian mengatakan bahwa kami memproses klik dan tidak perlu melangkah lebih jauh dalam hierarki <br><br>  <b>Kedua</b> : kami menentukannya dengan mengeklik pin atau pada info, kami juga akan membandingkan koordinat 499 label garis.  Tes Kesetaraan: <br><br><img src="https://habrastorage.org/webt/xd/z5/lk/xdz5lkm2g-zehkggfea6rqdxkfa.png"><br><br>  <b>Selanjutnya,</b> jika ini adalah info dan kami ingin menanggapi klik tombol (atau mensimulasikan, karena sekarang ini adalah gambar), dan bukan ke seluruh area, maka kami perlu membuat beberapa perhitungan dengan pena :) <br><br><ol><li>  Konversi koordinat dunia ke layar 501 baris <br>  Kami menganggap diri kami: kami akan mengonversi koordinat peta ke layar, kami tahu di mana kami berada, kemudian dengan menambahkan lebar dan tinggi tampilan, kami mendapatkan titik sudut, tetapi karena alasan tertentu mereka tidak cocok dan saya secara manual dikalikan tiga, dalam kasus saya untuk iPhone ke 10)).  Ternyata kemudian, saya lupa dan tidak memperhitungkan jumlah piksel per titik.  Yang kita dapat memiliki 1x, (satu titik 1 piksel), 2x, 3x satu titik adalah tiga piksel. </li><li>  Mari kita menghitung ketinggian tombol - tinggi info + ketinggian segitiga dikalikan skala, informasi tentang skala (baris 498).  Selanjutnya, kami membagi semua ini menjadi dua, karena ketinggian tombol adalah setengah tinggi dari info </li><li>  Kemudian kita menghitung koordinat sudut, berdasarkan fakta bahwa jangkar (x: 0,5, y: 1), mengingat skala dan luas segitiga)) </li><li>  Kemudian konversi koordinat layar ini ke dunia </li><li>  Buat area yang terlihat berdasarkan pada mereka, adalah zona tombol </li><li>  Dan kami memeriksa apakah kami menekan tombol zona atau tidak.  Jika Anda menekan, maka periksa jenis anotasi, tergantung pada jenis yang kami sebut beberapa metode kami: pergi ke layar terperinci atau pilih toko ini untuk pengiriman dalam kasus dengan StorePoint </li></ol><br>  Kalau tidak, itu adalah klik pada pin dan kita perlu menambahkan info, yang sebenarnya kita lakukan di atas. <br><br>  Itu saja, pada perkenalan awal dengan paus baru ini sudah berakhir. <br><br>  <s>Apa lagi yang ingin saya katakan, dalam implementasi peta mapkit saat ini mengandung banyak fungsi yang tidak digunakan, ini juga mempengaruhi ukuran biner yang dihasilkan.</s>  <s>Apakah Anda siap untuk pengorbanan seperti itu, di masa depan, orang-orang harus dibongkar menjadi modul</s> .  Saya juga mendengar dari rekan kerja di android dari bengkel bahwa ada masalah kompatibilitas dengan Kotlin. <br><br>  P.S.  Sementara saya memutuskan dan mulai menulis artikel, pembaruan 3.1 keluar, di mana dari masalah di atas diselesaikan dan diimplementasikan: <br><br>  Ditambahkan <br><br>  Untuk Android, arm64 dan x86 build muncul. <br>  <b>Anda dapat menambahkan objek View apa saja ke peta.</b> <b><br></b>  Perutean sepeda telah muncul. <br>  Menambahkan anotasi yang dapat dibatalkan untuk Android. <br><br>  Berubah <br><br>  <b>MapKit dipecah menjadi beberapa bagian:</b> <b><br></b>  MapKit - hanya peta; <br>  Arah MapKit - perutean mobil; <br>  Transportasi MapKit - rute pejalan kaki, rute angkutan umum, dan rute sepeda; <br>  Pencarian MapKit - pencarian dan geocoding; <br>  MapKit Places - panorama. <br>  Untuk iOS, anotasi yang dapat dibatalkan menjadi lebih ketat. <br><br>  Diperbaiki <br><br>  Sejumlah bug telah diperbaiki. <br>  Peningkatan kinerja. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tech.yandex.ru/maps/doc/mapkit/3.x/concepts/versions-docpage</a> <br><br>  <b>Tulis komentar, pertanyaan Anda.</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id427611/">https://habr.com/ru/post/id427611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id427601/index.html">Kasus 5 + 1 di mana spesifikasi REST API memainkan peran besar</a></li>
<li><a href="../id427603/index.html">Cara akhirnya mulai menulis tes dan tidak menyesalinya</a></li>
<li><a href="../id427605/index.html">Bagaimana platform crowdsourcing Yandex membantu melatih drone dan mengevaluasi kualitas layanan</a></li>
<li><a href="../id427607/index.html">Datacenter di Swiss: bekerja seperti jarum jam</a></li>
<li><a href="../id427609/index.html">Memecahkan persamaan dengan pembagian integer tanpa kekuatan kasar</a></li>
<li><a href="../id427613/index.html">10 blog bermanfaat untuk programmer dalam bahasa Inggris</a></li>
<li><a href="../id427615/index.html">Berhentilah membuat situs bergulir yang tak ada habisnyaÇƒ</a></li>
<li><a href="../id427617/index.html">Evolusi mobil kereta api</a></li>
<li><a href="../id427623/index.html">3 buku tentang C ++ 17 (dalam bahasa Inggris)</a></li>
<li><a href="../id427625/index.html">Cara menulis pemindai kerentanan dan menghasilkan uang dari eksploitasi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>