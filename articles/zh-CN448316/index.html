<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€ğŸ’¼ ğŸ‘‹ğŸ½ ğŸ¤¤ ç¡®å®šç‹—çš„å“ç§ï¼šå®Œæ•´çš„å¼€å‘å‘¨æœŸï¼Œä»Pythonä¸­çš„ç¥ç»ç½‘ç»œåˆ°Google Playä¸Šçš„åº”ç”¨ ğŸ˜¾ ğŸ— ğŸ‘ŠğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="é€šå¸¸ï¼Œåœ¨ç¥ç»ç½‘ç»œé¢†åŸŸå°¤å…¶æ˜¯æ¨¡å¼è¯†åˆ«é¢†åŸŸçš„è¿›æ­¥å¯¼è‡´äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³åˆ›å»ºç”¨äºå¤„ç†å›¾åƒçš„ç¥ç»ç½‘ç»œåº”ç”¨ç¨‹åºä¼¼ä¹æ˜¯ä¸€é¡¹å¸¸è§„ä»»åŠ¡ã€‚ ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™æ˜¯-å¦‚æœæ‚¨æƒ³åˆ°äº†ä¸æ¨¡å¼è¯†åˆ«æœ‰å…³çš„æƒ³æ³•ï¼Œè¯·ä¸è¦æ€€ç–‘æœ‰äººå·²ç»å†™è¿‡ç±»ä¼¼çš„ä¸œè¥¿ã€‚ æ‚¨æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨Googleä¸­æ‰¾åˆ°ç›¸åº”çš„ä»£ç ï¼Œç„¶åç”±ä½œè€…â€œç¼–è¯‘â€ã€‚ 

 ä½†æ˜¯ï¼Œæˆ‘æƒ³...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç¡®å®šç‹—çš„å“ç§ï¼šå®Œæ•´çš„å¼€å‘å‘¨æœŸï¼Œä»Pythonä¸­çš„ç¥ç»ç½‘ç»œåˆ°Google Playä¸Šçš„åº”ç”¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448316/"> é€šå¸¸ï¼Œåœ¨ç¥ç»ç½‘ç»œé¢†åŸŸå°¤å…¶æ˜¯æ¨¡å¼è¯†åˆ«é¢†åŸŸçš„è¿›æ­¥å¯¼è‡´äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³åˆ›å»ºç”¨äºå¤„ç†å›¾åƒçš„ç¥ç»ç½‘ç»œåº”ç”¨ç¨‹åºä¼¼ä¹æ˜¯ä¸€é¡¹å¸¸è§„ä»»åŠ¡ã€‚ ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™æ˜¯-å¦‚æœæ‚¨æƒ³åˆ°äº†ä¸æ¨¡å¼è¯†åˆ«æœ‰å…³çš„æƒ³æ³•ï¼Œè¯·ä¸è¦æ€€ç–‘æœ‰äººå·²ç»å†™è¿‡ç±»ä¼¼çš„ä¸œè¥¿ã€‚ æ‚¨æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨Googleä¸­æ‰¾åˆ°ç›¸åº”çš„ä»£ç ï¼Œç„¶åç”±ä½œè€…â€œç¼–è¯‘â€ã€‚ <br><br> ä½†æ˜¯ï¼Œæˆ‘æƒ³è¯´ï¼Œä»ç„¶æœ‰è®¸å¤šç»†èŠ‚ä½¿è¿™é¡¹ä»»åŠ¡ä¸æ˜¯åƒæ— èŠä¸€æ ·éš¾ä»¥è§£å†³ã€‚ è¿™ä¼šèŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ‚¨æ˜¯ä¸€ä¸ªéœ€è¦é¢†å¯¼æ‰èƒ½ï¼Œå¾ªåºæ¸è¿›ï¼Œéœ€è¦åœ¨æ‚¨çœ¼å‰è¿›è¡Œå¹¶ä»å¤´åˆ°å°¾å®Œæˆçš„é¡¹ç›®çš„åˆå­¦è€…ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰é€šå¸¸çš„åšæ³•ï¼Œâ€œè·³è¿‡è¿™ä¸€æ˜æ˜¾çš„éƒ¨åˆ†â€å°±æ˜¯å€Ÿå£ã€‚ <br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘åˆ›å»ºDog Breed Identifierçš„ä»»åŠ¡ï¼šæˆ‘ä»¬å°†åˆ›å»ºå’Œè®­ç»ƒç¥ç»ç½‘ç»œï¼Œç„¶åå°†å…¶ç§»æ¤åˆ°Androidçš„Javaå¹¶åœ¨Google Playä¸Šå‘å¸ƒã€‚ <br><br> å¦‚æœæ‚¨æƒ³æŸ¥çœ‹å®Œæˆçš„ç»“æœï¼Œåˆ™ä¸ºï¼šGoogle Playä¸Šçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NeuroDogåº”ç”¨</a> ã€‚ <br><br> ä½¿ç”¨æˆ‘çš„æœºå™¨äººæŠ€æœ¯çš„ç½‘ç«™ï¼ˆæ­£åœ¨è¿›è¡Œä¸­ï¼‰ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">robotics.snowcron.com</a> ã€‚ <br> ç¨‹åºæœ¬èº«çš„ç½‘ç«™ï¼ŒåŒ…æ‹¬æŒ‡å—ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NeuroDogç”¨æˆ·æŒ‡å—</a> ã€‚ <br><br> è¿™æ˜¯è¯¥ç¨‹åºçš„å±å¹•æˆªå›¾ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/186/b91/457/186b914572170b01446ed1d722bce200.png" alt="å›¾ç‰‡"><br><br><a name="habracut"></a><br><br><h3> é—®é¢˜é™ˆè¿° </h3><br><br> æˆ‘ä»¬å°†ä½¿ç”¨Kerasï¼šä¸€ä¸ªç”¨äºå¤„ç†ç¥ç»ç½‘ç»œçš„Googleåº“ã€‚ è¿™æ˜¯ä¸€ä¸ªé«˜çº§åº“ï¼Œè¿™æ„å‘³ç€ä¸æˆ‘æ‰€çŸ¥é“çš„æ›¿ä»£æ–¹æ³•ç›¸æ¯”ï¼Œå®ƒæ›´æ˜“äºä½¿ç”¨ã€‚ å¦‚æœæœ‰çš„è¯-ç½‘ç»œä¸­æœ‰å¾ˆå¤šå…³äºKerasçš„æ•™ç§‘ä¹¦ï¼Œè´¨é‡å¾ˆé«˜ã€‚ <br><br> æˆ‘ä»¬å°†ä½¿ç”¨CNN-å·ç§¯ç¥ç»ç½‘ç»œã€‚  CNNï¼ˆä»¥åŠåŸºäºå®ƒä»¬çš„æ›´é«˜çº§çš„é…ç½®ï¼‰æ˜¯å›¾åƒè¯†åˆ«ä¸­çš„äº‹å®ä¸Šçš„æ ‡å‡†ã€‚ åŒæ—¶ï¼Œè®­ç»ƒè¿™æ ·çš„ç½‘ç»œå¹¶ä¸æ€»æ˜¯é‚£ä¹ˆå®¹æ˜“ï¼šæ‚¨éœ€è¦é€‰æ‹©æ­£ç¡®çš„ç½‘ç»œç»“æ„ï¼Œè®­ç»ƒå‚æ•°ï¼ˆæ‰€æœ‰è¿™äº›å­¦ä¹ ç‡ï¼ŒåŠ¨é‡ï¼ŒL1å’ŒL2ç­‰ï¼‰ã€‚ è¯¥ä»»åŠ¡éœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºï¼Œå› æ­¤ï¼Œä»…é€šè¿‡éå†æ‰€æœ‰å‚æ•°æ¥è§£å†³è¯¥é—®é¢˜å°†å¤±è´¥ã€‚ <br><br> è¿™æ˜¯ä¸ºä»€ä¹ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä»–ä»¬ä½¿ç”¨æ‰€è°“çš„â€œè½¬ç§»çŸ¥è¯†â€è€Œä¸æ˜¯æ‰€è°“çš„â€œé¦™è‰â€æ–¹æ³•çš„å‡ ä¸ªåŸå› ä¹‹ä¸€ã€‚  Transfer Knowlegeä½¿ç”¨ç”±æˆ‘ä»¬ä¹‹å‰çš„äººå‘˜ï¼ˆä¾‹å¦‚Googleï¼‰è®­ç»ƒçš„ç¥ç»ç½‘ç»œï¼Œé€šå¸¸ç”¨äºå®Œæˆç±»ä¼¼ä½†ä»ä¸åŒçš„ä»»åŠ¡ã€‚ æˆ‘ä»¬ä»ä¸­è·å–åˆå§‹å±‚ï¼Œç”¨æˆ‘ä»¬è‡ªå·±çš„åˆ†ç±»å™¨æ›¿æ¢æœ€ç»ˆå±‚-å®ƒå¯ä»¥å·¥ä½œï¼Œå¹¶ä¸”æ•ˆæœå¾ˆå¥½ã€‚ <br><br> èµ·åˆï¼Œè¿™æ ·çš„ç»“æœå¯èƒ½ä»¤äººæƒŠè®¶ï¼šæˆ‘ä»¬å¦‚ä½•æ¥å—è®­ç»ƒæœ‰ç´ çš„Googleç½‘ç»œæ¥åŒºåˆ†çŒ«å’Œæ¤…å­ï¼Œå¹¶ä¸ºæˆ‘ä»¬è¯†åˆ«ç‹—çš„å“ç§ï¼Ÿ è¦äº†è§£è¿™æ˜¯å¦‚ä½•å‘ç”Ÿçš„ï¼Œæ‚¨éœ€è¦äº†è§£æ·±åº¦ç¥ç»ç½‘ç»œå·¥ä½œçš„åŸºæœ¬åŸç†ï¼ŒåŒ…æ‹¬ç”¨äºæ¨¡å¼è¯†åˆ«çš„åŸç†ã€‚ <br><br> æˆ‘ä»¬â€œå–‚é£Ÿâ€ç½‘ç»œä¸€å¹…å›¾ç‰‡ï¼ˆå³æ•°å­—æ•°ç»„ï¼‰ä½œä¸ºè¾“å…¥ã€‚ ç¬¬ä¸€å±‚åˆ†æå›¾åƒä¸­çš„ç®€å•å›¾æ¡ˆï¼Œä¾‹å¦‚â€œæ°´å¹³çº¿â€ï¼Œâ€œå¼§å½¢â€ç­‰ã€‚ ä¸‹ä¸€å±‚æ¥æ”¶è¿™äº›å›¾æ¡ˆä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”ŸæˆäºŒé˜¶å›¾æ¡ˆï¼Œä¾‹å¦‚â€œæ¯›å‘â€ï¼Œâ€œçœ¼è§’â€ ...æœ€ç»ˆï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªéš¾é¢˜ï¼Œå¯ä»¥ç”¨æ¥é‡å»ºç‹—ï¼šç¾Šæ¯›ï¼Œä¸¤åªçœ¼ç›å’Œäººçš„ç‰™é½¿ã€‚ <br><br> ä»¥ä¸Šæ‰€æœ‰æ“ä½œéƒ½æ˜¯åœ¨æˆ‘ä»¬ï¼ˆä¾‹å¦‚ï¼Œä»Googleï¼‰è·å¾—çš„é¢„è®­ç»ƒå›¾å±‚çš„å¸®åŠ©ä¸‹å®Œæˆçš„ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·»åŠ æˆ‘ä»¬çš„å›¾å±‚ï¼Œå¹¶æ•™ä»–ä»¬ä»è¿™äº›æ¨¡å¼ä¸­æå–å“ç§ä¿¡æ¯ã€‚ å¬èµ·æ¥åˆä¹é€»è¾‘ã€‚ <br><br> æ€»è€Œè¨€ä¹‹ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºâ€œåŸå§‹â€ CNNå’Œä¸åŒç±»å‹ç½‘ç»œçš„å¤šä¸ªâ€œè½¬ç§»å­¦ä¹ â€å˜ä½“ã€‚ è‡³äºâ€œé¦™è‰â€ï¼šæˆ‘ä¼šåˆ›å»ºå®ƒï¼Œä½†æˆ‘ä¸æ‰“ç®—é€šè¿‡é€‰æ‹©å‚æ•°æ¥é…ç½®å®ƒï¼Œå› ä¸ºè®­ç»ƒå’Œé…ç½®â€œé¢„è®­ç»ƒâ€ç½‘ç»œè¦å®¹æ˜“å¾—å¤šã€‚ <br><br> ç”±äºæˆ‘ä»¬è®¡åˆ’æ•™æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œè¯†åˆ«ç‹—çš„å“ç§ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»â€œå±•ç¤ºâ€å„ç§å“ç§çš„æ ·æœ¬ã€‚ å¹¸è¿çš„æ˜¯ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a>ä¸ºç±»ä¼¼çš„ä»»åŠ¡åˆ›å»ºäº†ä¸€ç»„ç…§ç‰‡ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŸå§‹</a>ç…§ç‰‡åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a> ï¼‰ã€‚ <br><br> ç„¶åï¼Œæˆ‘è®¡åˆ’ä¸ºandroidç§»æ¤æœ€å¥½çš„æ¥æ”¶ç½‘ç»œã€‚ å°†Kerasovç½‘ç»œç§»æ¤åˆ°androidç›¸å¯¹ç®€å•ï¼Œå½¢å¼åŒ–ï¼Œæˆ‘ä»¬å°†åšæ‰€æœ‰å¿…è¦çš„æ­¥éª¤ï¼Œå› æ­¤é‡ç°è¿™ä¸€éƒ¨åˆ†å°†ä¸éš¾ã€‚ <br><br> ç„¶åï¼Œæˆ‘ä»¬å°†æ‰€æœ‰è¿™äº›å†…å®¹å‘å¸ƒåœ¨Google Playä¸Šã€‚ å½“ç„¶ï¼ŒGoogleä¼šæŠ—æ‹’ï¼Œå› æ­¤å°†ä½¿ç”¨å…¶ä»–æŠ€å·§ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„å¤§å°ï¼ˆç”±äºåºå¤§çš„ç¥ç»ç½‘ç»œï¼‰å°†å¤§äºGoogle Playæ¥å—çš„Android APKçš„å…è®¸å¤§å°ï¼šæˆ‘ä»¬å°†ä¸å¾—ä¸ä½¿ç”¨æ†ç»‘è½¯ä»¶ã€‚ æ­¤å¤–ï¼ŒGoogleä¸ä¼šåœ¨æœç´¢ç»“æœä¸­æ˜¾ç¤ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥é€šè¿‡åœ¨åº”ç”¨ç¨‹åºä¸­æ³¨å†Œæœç´¢æ ‡ç­¾æ¥è§£å†³æ­¤é—®é¢˜ï¼Œæˆ–è€…åªéœ€ç­‰å¾…ä¸€ä¸¤ä¸ªæ˜ŸæœŸã€‚ <br><br> ç»“æœï¼Œæˆ‘ä»¬ä¸ºAndroidå’Œç¥ç»ç½‘ç»œè·å¾—äº†åŠŸèƒ½é½å…¨çš„â€œå•†ä¸šâ€ï¼ˆå¼•å·ï¼Œå› ä¸ºå®ƒæ˜¯å…è´¹æä¾›çš„ï¼‰åº”ç”¨ç¨‹åºã€‚ <br><br><h3> å¼€å‘ç¯å¢ƒ </h3><br><br> æ‚¨å¯ä»¥é‡‡ç”¨ä¸åŒçš„æ–¹å¼ä¸ºKerasç¼–ç¨‹ï¼Œå…·ä½“å–å†³äºæ‰€ä½¿ç”¨çš„OSï¼ˆå»ºè®®ä½¿ç”¨Ubuntuï¼‰ï¼Œæ˜¯å¦å­˜åœ¨è§†é¢‘å¡ç­‰ç­‰ã€‚ é™¤äº†ä¸æ˜¯æœ€ç®€å•çš„æ–¹æ³•ä¹‹å¤–ï¼Œåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿›è¡Œå¼€å‘ï¼ˆå¹¶å› æ­¤è¿›è¡Œå…¶é…ç½®ï¼‰ä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸å¥½ã€‚ <br><br> é¦–å…ˆï¼Œå®‰è£…å’Œé…ç½®å¤§é‡å·¥å…·å’Œåº“éœ€è¦èŠ±è´¹æ—¶é—´ï¼Œç„¶ååœ¨å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œæ‚¨å°†ä¸å¾—ä¸å†æ¬¡èŠ±è´¹æ—¶é—´ã€‚ å…¶æ¬¡ï¼Œç¥ç»ç½‘ç»œéœ€è¦å¤§é‡çš„è®¡ç®—èƒ½åŠ›æ¥è¿›è¡Œè®­ç»ƒã€‚ å¦‚æœæ‚¨ä½¿ç”¨GPUï¼Œåˆ™å¯ä»¥åŠ å¿«ï¼ˆæé«˜10å€æˆ–æ›´å¤šå€ï¼‰æ­¤è¿‡ç¨‹ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæœ€é€‚åˆæ­¤å·¥ä½œçš„é¡¶çº§GPUçš„ä»·æ ¼ä¸º2,000ç¾å…ƒ-7,000ç¾å…ƒã€‚ æ˜¯çš„ï¼Œå®ƒä»¬ä¹Ÿéœ€è¦é…ç½®ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å°†å¦è¾Ÿã€‚å¾„ã€‚ äº‹å®æ˜¯ï¼ŒGoogleå…è®¸åƒæˆ‘ä»¬è¿™æ ·çš„è´«ç©·åˆºçŒ¬å…è´¹ä½¿ç”¨å…¶é›†ç¾¤ä¸­çš„GPUï¼Œä»¥è¿›è¡Œä¸ç¥ç»ç½‘ç»œæœ‰å…³çš„è®¡ç®—ï¼Œå®ƒè¿˜æä¾›äº†å®Œå…¨é…ç½®çš„ç¯å¢ƒï¼Œæ€»ä¹‹ç§°ä¸ºGoogle Colabã€‚ è¯¥æœåŠ¡ä½¿æ‚¨å¯ä»¥ä½¿ç”¨pythonï¼ŒKeraså’Œè®¸å¤šå…¶ä»–å·²é…ç½®çš„åº“è®¿é—®Jupiter Notebookã€‚ æ‚¨è¦åšçš„å°±æ˜¯è·å¾—ä¸€ä¸ªGoogleå¸æˆ·ï¼ˆè·å¾—ä¸€ä¸ªGmailå¸æˆ·ï¼Œè¿™å°†ä½¿æ‚¨èƒ½å¤Ÿè®¿é—®å…¶ä»–æ‰€æœ‰å†…å®¹ï¼‰ã€‚ <br><br> ç›®å‰ï¼Œæ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>è˜ç”¨Colabï¼Œä½†æ˜¯äº†è§£Googleï¼Œè¿™ç§æƒ…å†µå¯ä»¥éšæ—¶æ›´æ”¹ã€‚ åªæ˜¯è°·æ­Œè°·æ­ŒColabã€‚ <br><br> ä½¿ç”¨Colabçš„æ˜æ˜¾é—®é¢˜æ˜¯å®ƒæ˜¯ä¸€ä¸ªWEBæœåŠ¡ã€‚ æˆ‘ä»¬å¦‚ä½•è®¿é—®æˆ‘ä»¬çš„æ•°æ®ï¼Ÿ è®­ç»ƒåä¿å­˜ç¥ç»ç½‘ç»œï¼Œä¾‹å¦‚ï¼Œä¸‹è½½ç‰¹å®šäºæˆ‘ä»¬ä»»åŠ¡çš„æ•°æ®ç­‰ç­‰ï¼Ÿ <br><br> æœ‰å‡ ç§ï¼ˆåœ¨æ’°å†™æœ¬æ–‡æ—¶-ä¸‰ç§ï¼‰ä¸åŒçš„æ–¹å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ç§æˆ‘è®¤ä¸ºæœ€æ–¹ä¾¿çš„æ–¹å¼-æˆ‘ä»¬ä½¿ç”¨Googleäº‘ç«¯ç¡¬ç›˜ã€‚ <br><br>  Googleäº‘ç«¯ç¡¬ç›˜æ˜¯ä¸€ç§åŸºäºäº‘çš„æ•°æ®å­˜å‚¨ï¼Œå…¶å·¥ä½œæ–¹å¼ä¸å¸¸è§„ç¡¬ç›˜éå¸¸ç›¸ä¼¼ï¼Œå¹¶ä¸”å¯ä»¥æ˜ å°„åˆ°Google Colabï¼ˆè¯·å‚è§ä¸‹é¢çš„ä»£ç ï¼‰ã€‚ ä¹‹åï¼Œæ‚¨å¯ä»¥åƒå¤„ç†æœ¬åœ°ç£ç›˜ä¸Šçš„æ–‡ä»¶ä¸€æ ·ä½¿ç”¨å®ƒã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¾‹å¦‚ï¼Œä¸ºäº†è®¿é—®ç‹—çš„ç…§ç‰‡ä»¥è®­ç»ƒæˆ‘ä»¬çš„ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬ä¸Šä¼ åˆ°Googleäº‘ç«¯ç¡¬ç›˜ï¼Œä»…æ­¤è€Œå·²ã€‚ <br><br><h2> åˆ›å»ºå’Œè®­ç»ƒç¥ç»ç½‘ç»œ </h2><br><br> ä¸‹é¢ï¼Œæˆ‘é€ä¸ªé€èŠ‚ç»™å‡ºPythonä¸­çš„ä»£ç ï¼ˆæ¥è‡ªJupiter Notebookï¼‰ã€‚ æ‚¨ä¹Ÿå¯ä»¥å°†æ­¤ä»£ç å¤åˆ¶åˆ°Jupiter Notebookä¸­å¹¶é€å—è¿è¡Œå®ƒï¼Œå› ä¸ºå—å¯ä»¥ç‹¬ç«‹æ‰§è¡Œï¼ˆå½“ç„¶ï¼Œåœ¨æ—©æœŸå—ä¸­å¯èƒ½éœ€è¦åœ¨æ—©æœŸå—ä¸­å®šä¹‰çš„å˜é‡ï¼Œä½†è¿™æ˜¾ç„¶æ˜¯ä¾èµ–æ€§ï¼‰ã€‚ <br><br><h3> åˆå§‹åŒ– </h3><br><br> é¦–å…ˆï¼Œè®©æˆ‘ä»¬æŒ‚è½½Googleäº‘ç«¯ç¡¬ç›˜ã€‚ åªæœ‰ä¸¤è¡Œã€‚ æ­¤ä»£ç ä»…åº”åœ¨Colabä¼šè¯ä¸­æ‰§è¡Œä¸€æ¬¡ï¼ˆä¾‹å¦‚ï¼Œæ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚ å¦‚æœåœ¨ä¼šè¯ä»å¤„äºâ€œæ´»åŠ¨â€çŠ¶æ€æ—¶ç¬¬äºŒæ¬¡è°ƒç”¨å®ƒï¼Œåˆ™ç”±äºå·²å®‰è£…é©±åŠ¨å™¨ï¼Œå› æ­¤å°†è·³è¿‡è¯¥ä¼šè¯ã€‚ <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.colab <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> drive drive.mount(<span class="hljs-string"><span class="hljs-string">'/content/drive/'</span></span>)</code> </pre> <br><br> åœ¨å¼€å§‹æ—¶ï¼Œå°†è¦æ±‚æ‚¨ç¡®è®¤æ‚¨çš„æ„å›¾ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚ çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>Go to this URL <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a browser: ... &gt;&gt;&gt; Enter your authorization code: &gt;&gt;&gt; Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· &gt;&gt;&gt; Mounted at /content/drive/</code> </pre><br><br> å®Œå…¨æ ‡å‡†çš„<i>åŒ…å«</i>éƒ¨åˆ†ï¼› å¯èƒ½ä¸éœ€è¦å…¶ä¸­åŒ…å«çš„æŸäº›æ–‡ä»¶ï¼Œå—¯...æŠ±æ­‰ã€‚ å¦å¤–ï¼Œç”±äºæˆ‘å°†æµ‹è¯•ä¸åŒçš„ç¥ç»ç½‘ç»œï¼Œå› æ­¤æ‚¨å°†å¿…é¡»é’ˆå¯¹ç‰¹å®šç±»å‹çš„ç¥ç»ç½‘ç»œæ³¨é‡Š/å–æ¶ˆæ³¨é‡Šå…¶ä¸­åŒ…å«çš„ä¸€äº›æ¨¡å—ï¼šä¾‹å¦‚ï¼Œè¦ä½¿ç”¨InceptionV3 NNï¼Œè¯·æ³¨é‡Šä¸åŒ…æ‹¬InceptionV3ï¼Œå¹¶æ³¨é‡Šæ‰ä¾‹å¦‚ResNet50ã€‚ æ˜¯å¦ï¼šæ‰€å‘ç”Ÿçš„æ‰€æœ‰å˜åŒ–ä»…æ˜¯æ‰€ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œå¹¶ä¸”ä¸æ˜¯å¾ˆå¼ºã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> dt <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> seaborn <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sns <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tqdm <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tqdm <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> warnings <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> keras <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> backend <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> K <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> regularizers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Sequential <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Model <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.layers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dense, Dropout, Activation <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.layers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flatten, Conv2D <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.layers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MaxPooling2D <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.layers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BatchNormalization, Input <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.layers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dropout, GlobalAveragePooling2D <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.callbacks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Callback, EarlyStopping <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.callbacks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReduceLROnPlateau <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.callbacks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ModelCheckpoint <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> shutil <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.applications.vgg16 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> preprocess_input <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.preprocessing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> image <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.preprocessing.image <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ImageDataGenerator <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> load_model <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.applications.resnet50 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ResNet50 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.applications.resnet50 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> preprocess_input <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.applications.resnet50 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> decode_predictions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.applications <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> inception_v3 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.applications.inception_v3 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> InceptionV3 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.applications.inception_v3 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> preprocess_input <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> inception_v3_preprocessor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.applications.mobilenetv2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MobileNetV2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.applications.nasnet <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> NASNetMobile</code> </pre><br><br> åœ¨Googleäº‘ç«¯ç¡¬ç›˜ä¸Šï¼Œæˆ‘ä»¬ä¸ºæ–‡ä»¶åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ ç¬¬äºŒè¡Œæ˜¾ç¤ºå…¶å†…å®¹ï¼š <br><br><pre> <code class="python hljs">working_path = <span class="hljs-string"><span class="hljs-string">"/content/drive/My Drive/DeepDogBreed/data/"</span></span> !ls <span class="hljs-string"><span class="hljs-string">"/content/drive/My Drive/DeepDogBreed/data"</span></span> &gt;&gt;&gt; all_images labels.csv models test train valid</code> </pre><br><br> å¦‚æ‚¨æ‰€è§ï¼Œè¿™äº›ç‹—çš„ç…§ç‰‡ï¼ˆä»Googleäº‘ç«¯ç¡¬ç›˜ä¸Šçš„æ–¯å¦ç¦æ•°æ®é›†ï¼ˆè§ä¸Šæ–‡ï¼‰å¤åˆ¶ï¼‰é¦–å…ˆä¿å­˜åœ¨<i>all_images</i>æ–‡ä»¶å¤¹ä¸­ã€‚ ç¨åï¼Œæˆ‘ä»¬å°†å®ƒä»¬å¤åˆ¶åˆ°<i>ç«è½¦</i>ç›®å½•<i>ï¼Œæœ‰æ•ˆ</i>ç›®å½•å’Œ<i>æµ‹è¯•</i>ç›®å½•ä¸­ã€‚ æˆ‘ä»¬å°†è®­ç»ƒå¥½çš„æ¨¡å‹ä¿å­˜åœ¨<i>models</i>æ–‡ä»¶å¤¹ä¸­ã€‚ è‡³äºlabels.csvæ–‡ä»¶ï¼Œè¿™æ˜¯å¸¦æœ‰ç…§ç‰‡çš„æ•°æ®é›†çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒåŒ…å«ä¸€å¼ å›¾ç‰‡å’Œç‹—çš„å“ç§åç§°å¯¹åº”çš„è¡¨æ ¼ã€‚ <br><br> æ‚¨å¯ä»¥è¿è¡Œè®¸å¤šæµ‹è¯•æ¥äº†è§£æˆ‘ä»¬ä»Googleæš‚æ—¶è·å¾—çš„ç¡®åˆ‡ä¿¡æ¯ã€‚ ä¾‹å¦‚ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Is GPU Working? import tensorflow as tf tf.test.gpu_device_name() &gt;&gt;&gt; '/device:GPU:0'</span></span></code> </pre><br><br> å¦‚æ‚¨æ‰€è§ï¼ŒGPUå·²çœŸæ­£è¿æ¥ï¼Œå¦‚æœæœªè¿æ¥ï¼Œåˆ™éœ€è¦åœ¨Jupiter Notebookè®¾ç½®ä¸­æ‰¾åˆ°å¹¶å¯ç”¨æ­¤é€‰é¡¹ã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ä¸€äº›å¸¸é‡ï¼Œä¾‹å¦‚å›¾åƒçš„å¤§å°ç­‰ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨å¤§å°ä¸º256x256åƒç´ çš„å›¾ç‰‡ï¼Œè¿™æ˜¯ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å›¾åƒï¼Œä»¥å…ä¸¢å¤±ç»†èŠ‚ï¼Œåˆè¶³å¤Ÿå°ï¼Œä»¥è‡³äºæ‰€æœ‰å†…å®¹éƒ½é€‚åˆå­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ ä½†æ˜¯è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨çš„æŸäº›ç±»å‹çš„ç¥ç»ç½‘ç»œæœŸæœ›224x224åƒç´ çš„å›¾åƒã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯„è®º256è€Œå–æ¶ˆè¯„è®º224ã€‚ <br><br> ç›¸åŒçš„æ–¹æ³•ï¼ˆæ³¨é‡Šä¸€-å–æ¶ˆæ³¨é‡Šï¼‰å°†åº”ç”¨äºæˆ‘ä»¬ä¿å­˜çš„æ¨¡å‹çš„åç§°ï¼Œä»…ä»…æ˜¯å› ä¸ºæˆ‘ä»¬ä¸æƒ³è¦†ç›–å¯èƒ½ä»ç„¶æœ‰ç”¨çš„æ–‡ä»¶ã€‚ <br><pre> <code class="python hljs">warnings.filterwarnings(<span class="hljs-string"><span class="hljs-string">"ignore"</span></span>) os.environ[<span class="hljs-string"><span class="hljs-string">'TF_CPP_MIN_LOG_LEVEL'</span></span>] = <span class="hljs-string"><span class="hljs-string">'2'</span></span> np.random.seed(<span class="hljs-number"><span class="hljs-number">7</span></span>) start = dt.datetime.now() BATCH_SIZE = <span class="hljs-number"><span class="hljs-number">16</span></span> EPOCHS = <span class="hljs-number"><span class="hljs-number">15</span></span> TESTING_SPLIT=<span class="hljs-number"><span class="hljs-number">0.3</span></span> <span class="hljs-comment"><span class="hljs-comment"># 70/30 % NUM_CLASSES = 120 IMAGE_SIZE = 256 #strModelFileName = "models/ResNet50.h5" # strModelFileName = "models/InceptionV3.h5" strModelFileName = "models/InceptionV3_Sgd.h5" #IMAGE_SIZE = 224 #strModelFileName = "models/MobileNetV2.h5" #IMAGE_SIZE = 224 #strModelFileName = "models/NASNetMobileSgd.h5"</span></span></code> </pre><br><br><h3> èµ„æ–™è½½å…¥ </h3><br><br> é¦–å…ˆï¼Œè®©æˆ‘ä»¬<i>ä¸Šä¼ labels.csv</i>æ–‡ä»¶å¹¶å°†å…¶åˆ†ä¸ºè®­ç»ƒå’ŒéªŒè¯éƒ¨åˆ†ã€‚ è¯·æ³¨æ„ï¼Œç›®å‰å°šæ— æµ‹è¯•éƒ¨åˆ†ï¼Œå› ä¸ºæˆ‘å°†ä½œå¼Šä»¥è·å–æ›´å¤šè®­ç»ƒæ•°æ®ã€‚ <br><br><pre> <code class="python hljs">labels = pd.read_csv(working_path + <span class="hljs-string"><span class="hljs-string">'labels.csv'</span></span>) print(labels.head()) train_ids, valid_ids = train_test_split(labels, test_size = TESTING_SPLIT) print(len(train_ids), <span class="hljs-string"><span class="hljs-string">'train ids'</span></span>, len(valid_ids), <span class="hljs-string"><span class="hljs-string">'validation ids'</span></span>) print(<span class="hljs-string"><span class="hljs-string">'Total'</span></span>, len(labels), <span class="hljs-string"><span class="hljs-string">'testing images'</span></span>) &gt;&gt;&gt; id breed &gt;&gt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">000</span></span>bec180eb18c7604dcecc8fe0dba07 boston_bull &gt;&gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">001513</span></span>dfcb2ffafc82cccf4d8bbaba97 dingo &gt;&gt;&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">001</span></span>cdf01b096e06d78e9e5112d419397 pekinese &gt;&gt;&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">00214</span></span>f311d5d2247d5dfe4fe24b2303d bluetick &gt;&gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0021</span></span>f9ceb3235effd7fcde7f7538ed62 golden_retriever &gt;&gt;&gt; <span class="hljs-number"><span class="hljs-number">7155</span></span> train ids <span class="hljs-number"><span class="hljs-number">3067</span></span> validation ids &gt;&gt;&gt; Total <span class="hljs-number"><span class="hljs-number">10222</span></span> testing images</code> </pre><br><br> æ¥ä¸‹æ¥ï¼Œæ ¹æ®æ–‡ä»¶åå°†å›¾åƒæ–‡ä»¶å¤åˆ¶åˆ°training / validation / testæ–‡ä»¶å¤¹ã€‚ ä»¥ä¸‹å‡½æ•°å°†æˆ‘ä»¬å°†å…¶åç§°ä¼ è¾“åˆ°çš„æ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copyFileSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(strDirFrom, strDirTo, arrFileNames)</span></span></span><span class="hljs-function">:</span></span> arrBreeds = np.asarray(arrFileNames[<span class="hljs-string"><span class="hljs-string">'breed'</span></span>]) arrFileNames = np.asarray(arrFileNames[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> os.path.exists(strDirTo): os.makedirs(strDirTo) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tqdm(range(len(arrFileNames))): strFileNameFrom = strDirFrom + arrFileNames[i] + <span class="hljs-string"><span class="hljs-string">".jpg"</span></span> strFileNameTo = strDirTo + arrBreeds[i] + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + arrFileNames[i] + <span class="hljs-string"><span class="hljs-string">".jpg"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> os.path.exists(strDirTo + arrBreeds[i] + <span class="hljs-string"><span class="hljs-string">"/"</span></span>): os.makedirs(strDirTo + arrBreeds[i] + <span class="hljs-string"><span class="hljs-string">"/"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># As a new breed dir is created, copy 1st file # to "test" under name of that breed if not os.path.exists(working_path + "test/"): os.makedirs(working_path + "test/") strFileNameTo = working_path + "test/" + arrBreeds[i] + ".jpg" shutil.copy(strFileNameFrom, strFileNameTo) shutil.copy(strFileNameFrom, strFileNameTo)</span></span></code> </pre><br><br> å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬ä»…å°†æ¯ä¸ªçŠ¬ç§å¤åˆ¶ä¸€ä¸ªæ–‡ä»¶ä½œä¸º<i>æµ‹è¯•</i> ã€‚ åŒæ ·ï¼Œåœ¨å¤åˆ¶æ—¶ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºå­æ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªå­æ–‡ä»¶å¤¹ä¸€ä¸ªã€‚ å› æ­¤ï¼ŒæŒ‰å“ç§å°†ç…§ç‰‡å¤åˆ¶åˆ°å­æ–‡ä»¶å¤¹ä¸­ã€‚ <br><br> è¿™æ ·åšæ˜¯å› ä¸ºKeraså¯ä»¥ä½¿ç”¨ç»“æ„ç›¸ä¼¼çš„ç›®å½•ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è€Œä¸æ˜¯ä¸€æ¬¡å…¨éƒ¨åŠ è½½å›¾åƒæ–‡ä»¶ï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ã€‚ ä¸€æ¬¡ä¸Šä¼ æ‰€æœ‰15,000å¼ å›¾ç‰‡æ˜¯ä¸€ä¸ªåä¸»æ„ã€‚ <br><br> æˆ‘ä»¬å°†ä»…éœ€è°ƒç”¨ä¸€æ¬¡æ­¤å‡½æ•°ï¼Œå› ä¸ºå®ƒä¼šå¤åˆ¶å›¾åƒ-ä¸å†éœ€è¦ã€‚ å› æ­¤ï¼Œä¸ºäº†å°†æ¥ä½¿ç”¨ï¼Œæˆ‘ä»¬å¿…é¡»å¯¹æ­¤å‘è¡¨è¯„è®ºï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Move the data in subfolders so we can # use the Keras ImageDataGenerator. # This way we can also later use Keras # Data augmentation features. # --- Uncomment once, to copy files --- #copyFileSet(working_path + "all_images/", # working_path + "train/", train_ids) #copyFileSet(working_path + "all_images/", # working_path + "valid/", valid_ids)</span></span></code> </pre><br><br> è·å–ç‹—çš„å“ç§åˆ—è¡¨ï¼š <br><br><pre> <code class="python hljs">breeds = np.unique(labels[<span class="hljs-string"><span class="hljs-string">'breed'</span></span>]) map_characters = {} <span class="hljs-comment"><span class="hljs-comment">#{0:'none'} for i in range(len(breeds)): map_characters[i] = breeds[i] print("&lt;item&gt;" + breeds[i] + "&lt;/item&gt;") &gt;&gt;&gt; &lt;item&gt;affenpinscher&lt;/item&gt; &gt;&gt;&gt; &lt;item&gt;afghan_hound&lt;/item&gt; &gt;&gt;&gt; &lt;item&gt;african_hunting_dog&lt;/item&gt; &gt;&gt;&gt; &lt;item&gt;airedale&lt;/item&gt; &gt;&gt;&gt; &lt;item&gt;american_staffordshire_terrier&lt;/item&gt; &gt;&gt;&gt; &lt;item&gt;appenzeller&lt;/item&gt;</span></span></code> </pre><br><br><h3> å½±åƒå¤„ç† </h3><br><br> æˆ‘ä»¬å°†ä½¿ç”¨ç§°ä¸ºImageDataGeneratorsçš„Kerasåº“åŠŸèƒ½ã€‚  ImageDataGeneratorå¯ä»¥å¤„ç†å›¾åƒï¼Œç¼©æ”¾ï¼Œæ—‹è½¬ç­‰ã€‚ å®ƒè¿˜å¯ä»¥æ¥å—å¯ä»¥é¢å¤–å¤„ç†å›¾åƒçš„<i>å¤„ç†</i>åŠŸèƒ½ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preprocess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(img)</span></span></span><span class="hljs-function">:</span></span> img = cv2.resize(img, (IMAGE_SIZE, IMAGE_SIZE), interpolation = cv2.INTER_AREA) <span class="hljs-comment"><span class="hljs-comment"># or use ImageDataGenerator( rescale=1./255... img_1 = image.img_to_array(img) img_1 = cv2.resize(img_1, (IMAGE_SIZE, IMAGE_SIZE), interpolation = cv2.INTER_AREA) img_1 = np.expand_dims(img_1, axis=0) / 255. #img = cv2.blur(img,(5,5)) return img_1[0]</span></span></code> </pre><br><br> è¯·æ³¨æ„ä»¥ä¸‹ä»£ç ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># or use ImageDataGenerator( rescale=1./255...</span></span></code> </pre><br><br> æˆ‘ä»¬å¯ä»¥åœ¨ImageDataGeneratoræœ¬èº«ä¸­è§„èŒƒåŒ–ï¼ˆå­æ•°æ®åœ¨0-1èŒƒå›´å†…ï¼Œè€Œä¸æ˜¯åŸå§‹çš„0-255ï¼‰ã€‚ ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦é¢„å¤„ç†å™¨ï¼Ÿ ä¾‹å¦‚ï¼Œè€ƒè™‘æ¨¡ç³Šè°ƒç”¨ï¼ˆæ³¨é‡Šï¼Œæˆ‘ä¸ä½¿ç”¨å®ƒï¼‰ï¼šè¿™æ˜¯ç›¸åŒçš„è‡ªå®šä¹‰å›¾åƒæ“ä½œï¼Œå¯ä»¥æ˜¯ä»»æ„çš„ã€‚ ä»HDRåˆ°å¯¹æ¯”åº¦çš„ä»»ä½•äº‹ç‰©ã€‚ <br><br> æˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ç§ä¸åŒçš„ImageDataGeneratorï¼Œä¸€ç§ç”¨äºè®­ç»ƒï¼Œå¦ä¸€ç§ç”¨äºéªŒè¯ã€‚ ä¸åŒä¹‹å¤„åœ¨äºï¼Œå¯¹äºè®­ç»ƒï¼Œæˆ‘ä»¬éœ€è¦è½®æµå’Œç¼©æ”¾ä»¥å¢åŠ æ•°æ®çš„â€œå¤šæ ·æ€§â€ï¼Œä½†å¯¹äºéªŒè¯ï¼Œè‡³å°‘ä¸éœ€è¦è¿™é¡¹ä»»åŠ¡ã€‚ <br><br><pre> <code class="python hljs">train_datagen = ImageDataGenerator( preprocessing_function=preprocess, <span class="hljs-comment"><span class="hljs-comment">#rescale=1./255, # done in preprocess() # randomly rotate images (degrees, 0 to 30) rotation_range=30, # randomly shift images horizontally # (fraction of total width) width_shift_range=0.3, height_shift_range=0.3, # randomly flip images horizontal_flip=True, ,vertical_flip=False, zoom_range=0.3) val_datagen = ImageDataGenerator( preprocessing_function=preprocess) train_gen = train_datagen.flow_from_directory( working_path + "train/", batch_size=BATCH_SIZE, target_size=(IMAGE_SIZE, IMAGE_SIZE), shuffle=True, class_mode="categorical") val_gen = val_datagen.flow_from_directory( working_path + "valid/", batch_size=BATCH_SIZE, target_size=(IMAGE_SIZE, IMAGE_SIZE), shuffle=True, class_mode="categorical")</span></span></code> </pre><br><br><h3> åˆ›å»ºä¸€ä¸ªç¥ç»ç½‘ç»œ </h3><br><br> å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬å°†åˆ›å»ºå‡ ç§ç±»å‹çš„ç¥ç»ç½‘ç»œã€‚ æ¯æ¬¡æˆ‘ä»¬è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°æ¥åˆ›å»ºï¼ŒåŒ…å«å…¶ä»–æ–‡ä»¶æ—¶ï¼Œæœ‰æ—¶ä¼šç¡®å®šä¸åŒçš„å›¾åƒå¤§å°ã€‚ å› æ­¤ï¼Œè¦åœ¨ä¸åŒç±»å‹çš„ç¥ç»ç½‘ç»œä¹‹é—´åˆ‡æ¢ï¼Œæˆ‘ä»¬å¿…é¡»æ³¨é‡Š/å–æ¶ˆæ³¨é‡Šç›¸åº”çš„ä»£ç ã€‚ <br><br> é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªâ€œé¦™è‰â€ CNNã€‚ å®ƒä¸èƒ½å¾ˆå¥½åœ°å·¥ä½œï¼Œå› ä¸ºæˆ‘å†³å®šä¸æµªè´¹æ—¶é—´å¯¹å…¶è¿›è¡Œè°ƒè¯•ï¼Œä½†æ˜¯è‡³å°‘å®ƒæä¾›äº†å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œå¼€å‘çš„åŸºç¡€ï¼ˆé€šå¸¸è¿™æ˜¯ä¸€ä¸ªåä¸»æ„ï¼Œå› ä¸ºç»è¿‡é¢„å…ˆåŸ¹è®­çš„ç½‘ç»œå¯ä»¥æä¾›æœ€ä½³ç»“æœï¼‰ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createModelVanilla</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> model = Sequential() <span class="hljs-comment"><span class="hljs-comment"># Note the (7, 7) here. This is one of technics # used to reduce memory use by the NN: we scan # the image in a larger steps. # Also note regularizers.l2: this technic is # used to prevent overfitting. The "0.001" here # is an empirical value and can be optimized. model.add(Conv2D(16, (7, 7), padding='same', use_bias=False, input_shape=(IMAGE_SIZE, IMAGE_SIZE, 3), kernel_regularizer=regularizers.l2(0.001))) # Note the use of a standard CNN building blocks: # Conv2D - BatchNormalization - Activation # MaxPooling2D - Dropout # The last two are used to avoid overfitting, also, # MaxPooling2D reduces memory use. model.add(BatchNormalization(axis=3, scale=False)) model.add(Activation("relu")) model.add(MaxPooling2D(pool_size=(2, 2), strides=(2, 2), padding='same')) model.add(Dropout(0.5)) model.add(Conv2D(16, (3, 3), padding='same', use_bias=False, kernel_regularizer=regularizers.l2(0.01))) model.add(BatchNormalization(axis=3, scale=False)) model.add(Activation("relu")) model.add(MaxPooling2D(pool_size=(2, 2), strides=(1, 1), padding='same')) model.add(Dropout(0.5)) model.add(Conv2D(32, (3, 3), padding='same', use_bias=False, kernel_regularizer=regularizers.l2(0.01))) model.add(BatchNormalization(axis=3, scale=False)) model.add(Activation("relu")) model.add(Dropout(0.5)) model.add(Conv2D(32, (3, 3), padding='same', use_bias=False, kernel_regularizer=regularizers.l2(0.01))) model.add(BatchNormalization(axis=3, scale=False)) model.add(Activation("relu")) model.add(MaxPooling2D(pool_size=(2, 2), strides=(1, 1), padding='same')) model.add(Dropout(0.5)) model.add(Conv2D(64, (3, 3), padding='same', use_bias=False, kernel_regularizer=regularizers.l2(0.01))) model.add(BatchNormalization(axis=3, scale=False)) model.add(Activation("relu")) model.add(Dropout(0.5)) model.add(Conv2D(64, (3, 3), padding='same', use_bias=False, kernel_regularizer=regularizers.l2(0.01))) model.add(BatchNormalization(axis=3, scale=False)) model.add(Activation("relu")) model.add(MaxPooling2D(pool_size=(2, 2), strides=(1, 1), padding='same')) model.add(Dropout(0.5)) model.add(Conv2D(128, (3, 3), padding='same', use_bias=False, kernel_regularizer=regularizers.l2(0.01))) model.add(BatchNormalization(axis=3, scale=False)) model.add(Activation("relu")) model.add(Dropout(0.5)) model.add(Conv2D(128, (3, 3), padding='same', use_bias=False, kernel_regularizer=regularizers.l2(0.01))) model.add(BatchNormalization(axis=3, scale=False)) model.add(Activation("relu")) model.add(MaxPooling2D(pool_size=(2, 2), strides=(1, 1), padding='same')) model.add(Dropout(0.5)) model.add(Conv2D(256, (3, 3), padding='same', use_bias=False, kernel_regularizer=regularizers.l2(0.01))) model.add(BatchNormalization(axis=3, scale=False)) model.add(Activation("relu")) model.add(Dropout(0.5)) model.add(Conv2D(256, (3, 3), padding='same', use_bias=False, kernel_regularizer=regularizers.l2(0.01))) model.add(BatchNormalization(axis=3, scale=False)) model.add(Activation("relu")) model.add(MaxPooling2D(pool_size=(2, 2), strides=(1, 1), padding='same')) model.add(Dropout(0.5)) # This is the end on "convolutional" part of CNN. # Now we need to transform multidementional # data into one-dim. array for a fully-connected # classifier: model.add(Flatten()) # And two layers of classifier itself (plus an # Activation layer in between): model.add(Dense(NUM_CLASSES, activation='softmax', kernel_regularizer=regularizers.l2(0.01))) model.add(Activation("relu")) model.add(Dense(NUM_CLASSES, activation='softmax', kernel_regularizer=regularizers.l2(0.01))) # We need to compile the resulting network. # Note that there are few parameters we can # try here: the best performing one is uncommented, # the rest is commented out for your reference. #model.compile(optimizer='rmsprop', # loss='categorical_crossentropy', # metrics=['accuracy']) #model.compile( # optimizer=keras.optimizers.RMSprop(lr=0.0005), # loss='categorical_crossentropy', # metrics=['accuracy']) model.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy']) #model.compile(optimizer='adadelta', # loss='categorical_crossentropy', # metrics=['accuracy']) #opt = keras.optimizers.Adadelta(lr=1.0, # rho=0.95, epsilon=0.01, decay=0.01) #model.compile(optimizer=opt, # loss='categorical_crossentropy', # metrics=['accuracy']) #opt = keras.optimizers.RMSprop(lr=0.0005, # rho=0.9, epsilon=None, decay=0.0001) #model.compile(optimizer=opt, # loss='categorical_crossentropy', # metrics=['accuracy']) # model.summary() return(model)</span></span></code> </pre><br><br> å½“æˆ‘ä»¬ä½¿ç”¨<i>è½¬ç§»å­¦ä¹ </i>åˆ›å»ºç½‘ç»œæ—¶ï¼Œè¿‡ç¨‹å°†æ›´æ”¹ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createModelMobileNetV2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># First, create the NN and load pre-trained # weights for it ('imagenet') # Note that we are not loading last layers of # the network (include_top=False), as we are # going to add layers of our own: base_model = MobileNetV2(weights='imagenet', include_top=False, pooling='avg', input_shape=(IMAGE_SIZE, IMAGE_SIZE, 3)) # Then attach our layers at the end. These are # to build "classifier" that makes sense of # the patterns previous layers provide: x = base_model.output x = Dense(512)(x) x = Activation('relu')(x) x = Dropout(0.5)(x) predictions = Dense(NUM_CLASSES, activation='softmax')(x) # Create a model model = Model(inputs=base_model.input, outputs=predictions) # We need to make sure that pre-trained # layers are not changed when we train # our classifier: # Either this: #model.layers[0].trainable = False # or that: for layer in base_model.layers: layer.trainable = False # As always, there are different possible # settings, I tried few and chose the best: # model.compile(optimizer='adam', # loss='categorical_crossentropy', # metrics=['accuracy']) model.compile(optimizer='sgd', loss='categorical_crossentropy', metrics=['accuracy']) #model.summary() return(model)</span></span></code> </pre><br><br> åˆ›å»ºå…¶ä»–ç±»å‹çš„ç½‘ç»œéµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createModelResNet50</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> base_model = ResNet50(weights=<span class="hljs-string"><span class="hljs-string">'imagenet'</span></span>, include_top=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, pooling=<span class="hljs-string"><span class="hljs-string">'avg'</span></span>, input_shape=(IMAGE_SIZE, IMAGE_SIZE, <span class="hljs-number"><span class="hljs-number">3</span></span>)) x = base_model.output x = Dense(<span class="hljs-number"><span class="hljs-number">512</span></span>)(x) x = Activation(<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) x = Dropout(<span class="hljs-number"><span class="hljs-number">0.5</span></span>)(x) predictions = Dense(NUM_CLASSES, activation=<span class="hljs-string"><span class="hljs-string">'softmax'</span></span>)(x) model = Model(inputs=base_model.input, outputs=predictions) <span class="hljs-comment"><span class="hljs-comment">#model.layers[0].trainable = False # model.compile(loss='categorical_crossentropy', # optimizer='adam', metrics=['accuracy']) model.compile(optimizer='sgd', loss='categorical_crossentropy', metrics=['accuracy']) #model.summary() return(model)</span></span></code> </pre><br><br> è­¦å‘Šï¼šèµ¢å®¶ï¼ è¯¥NNæ˜¾ç¤ºå‡ºæœ€ä½³ç»“æœï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createModelInceptionV3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># model.layers[0].trainable = False # model.compile(optimizer='sgd', # loss='categorical_crossentropy', # metrics=['accuracy']) base_model = InceptionV3(weights = 'imagenet', include_top = False, input_shape=(IMAGE_SIZE, IMAGE_SIZE, 3)) x = base_model.output x = GlobalAveragePooling2D()(x) x = Dense(512, activation='relu')(x) predictions = Dense(NUM_CLASSES, activation='softmax')(x) model = Model(inputs = base_model.input, outputs = predictions) for layer in base_model.layers: layer.trainable = False # model.compile(optimizer='adam', # loss='categorical_crossentropy', # metrics=['accuracy']) model.compile(optimizer='sgd', loss='categorical_crossentropy', metrics=['accuracy']) #model.summary() return(model)</span></span></code> </pre><br><br> å¦ä¸€ä¸ªï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createModelNASNetMobile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># model.layers[0].trainable = False # model.compile(optimizer='sgd', # loss='categorical_crossentropy', # metrics=['accuracy']) base_model = NASNetMobile(weights = 'imagenet', include_top = False, input_shape=(IMAGE_SIZE, IMAGE_SIZE, 3)) x = base_model.output x = GlobalAveragePooling2D()(x) x = Dense(512, activation='relu')(x) predictions = Dense(NUM_CLASSES, activation='softmax')(x) model = Model(inputs = base_model.input, outputs = predictions) for layer in base_model.layers: layer.trainable = False # model.compile(optimizer='adam', # loss='categorical_crossentropy', # metrics=['accuracy']) model.compile(optimizer='sgd', loss='categorical_crossentropy', metrics=['accuracy']) #model.summary() return(model)</span></span></code> </pre><br><br> ä¸åŒç±»å‹çš„ç¥ç»ç½‘ç»œå¯ç”¨äºä¸åŒä»»åŠ¡ã€‚ å› æ­¤ï¼Œé™¤äº†å¯¹é¢„æµ‹å‡†ç¡®æ€§çš„è¦æ±‚å¤–ï¼Œå¤§å°ï¼ˆç§»åŠ¨NNæ¯”Inceptionå°5å€ï¼‰å’Œé€Ÿåº¦ï¼ˆå¦‚æœæˆ‘ä»¬éœ€è¦å®æ—¶å¤„ç†è§†é¢‘æµï¼Œåˆ™å¿…é¡»ç‰ºç‰²å‡†ç¡®æ€§ï¼‰ä¹Ÿå¾ˆé‡è¦ã€‚ <br><br><h3> ç¥ç»ç½‘ç»œè®­ç»ƒ </h3><br><br> é¦–å…ˆï¼Œæˆ‘ä»¬æ­£åœ¨<i>è¯•éªŒ</i> ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåˆ é™¤å·²ä¿å­˜ä½†ä¸å†ä½¿ç”¨çš„ç¥ç»ç½‘ç»œã€‚ ä»¥ä¸‹å‡½æ•°åˆ é™¤NNï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Make sure that previous "best network" is deleted. def deleteSavedNet(best_weights_filepath): if(os.path.isfile(best_weights_filepath)): os.remove(best_weights_filepath) print("deleteSavedNet():File removed") else: print("deleteSavedNet():No file to remove")</span></span></code> </pre><br><br> æˆ‘ä»¬åˆ›å»ºå’Œåˆ é™¤ç¥ç»ç½‘ç»œçš„æ–¹æ³•éå¸¸ç®€å•æ˜äº†ã€‚ é¦–å…ˆï¼Œåˆ é™¤ã€‚ å½“è°ƒç”¨<i>delete</i> ï¼ˆä»…ï¼‰æ—¶ï¼Œåº”ç‰¢è®°Jupiter Notebookå…·æœ‰â€œè¿è¡Œé€‰æ‹©â€åŠŸèƒ½ï¼Œä»…é€‰æ‹©è¦ä½¿ç”¨çš„åŠŸèƒ½ï¼Œç„¶åè¿è¡Œå®ƒã€‚ <br><br> ç„¶åï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªç¥ç»ç½‘ç»œï¼›å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªè°ƒç”¨ï¼šå½“ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½è°ƒç”¨â€œ deleteâ€ï¼Œç„¶åæœŸæœ›NNå­˜åœ¨ï¼Œå› æ­¤è¦ä½¿ç”¨ä¿å­˜çš„ç¥ç»ç½‘ç»œï¼Œè¯·ä¸è¦è°ƒç”¨<i>delete</i> ã€‚ <br><br> æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æƒ…å†µå’Œå½“å‰æ­£åœ¨å°è¯•çš„å†…å®¹æ¥åˆ›å»ºæ–°çš„NNï¼Œæˆ–ä½¿ç”¨ç°æœ‰çš„NNã€‚ ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼šæˆ‘ä»¬è®­ç»ƒäº†ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œç„¶åå»åº¦å‡ã€‚ ä»–ä»¬å›æ¥äº†ï¼Œè°·æ­Œç¡®å®šäº†ä¼šè®®çš„å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åŠ è½½ä»¥å‰ä¿å­˜çš„æ–‡ä»¶ï¼šæ³¨é‡Šæ‰â€œåˆ é™¤â€ï¼Œå–æ¶ˆæ³¨é‡Šâ€œåŠ è½½â€ã€‚ <br><br><pre> <code class="python hljs">deleteSavedNet(working_path + strModelFileName) <span class="hljs-comment"><span class="hljs-comment">#if not os.path.exists(working_path + "models"): # os.makedirs(working_path + "models") # #if not os.path.exists(working_path + # strModelFileName): # model = createModelResNet50() model = createModelInceptionV3() # model = createModelMobileNetV2() # model = createModelNASNetMobile() #else: # model = load_model(working_path + strModelFileName)</span></span></code> </pre><br><br>  <b>æ£€æŸ¥ç‚¹</b>æ˜¯æˆ‘ä»¬ç¨‹åºä¸­éå¸¸é‡è¦çš„å…ƒç´ ã€‚ æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°æ•°ç»„ï¼Œæ¯ä¸ªè®­ç»ƒæ—¶ä»£ç»“æŸæ—¶åº”è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æ£€æŸ¥ç‚¹ã€‚ ä¾‹å¦‚ï¼Œ <i>å¦‚æœ</i>ç¥ç»ç½‘ç»œæ˜¾ç¤ºçš„ç»“æœæ¯”å·²ä¿å­˜çš„ç»“æœå¥½ï¼Œåˆ™å¯ä»¥ä¿å­˜è¯¥ç¥ç»ç½‘ç»œã€‚ <br><br><pre> <code class="python hljs">checkpoint = ModelCheckpoint(working_path + strModelFileName, monitor=<span class="hljs-string"><span class="hljs-string">'val_acc'</span></span>, verbose=<span class="hljs-number"><span class="hljs-number">1</span></span>, save_best_only=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'auto'</span></span>, save_weights_only=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) callbacks_list = [ checkpoint ]</code> </pre><br><br> æœ€åï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒé›†ä¸Šæ•™æˆç¥ç»ç½‘ç»œï¼š <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Calculate sizes of training and validation sets STEP_SIZE_TRAIN=train_gen.n//train_gen.batch_size STEP_SIZE_VALID=val_gen.n//val_gen.batch_size # Set to False if we are experimenting with # some other part of code, use history that # was calculated before (and is still in # memory bDoTraining = True if bDoTraining == True: # model.fit_generator does the actual training # Note the use of generators and callbacks # that were defined earlier history = model.fit_generator(generator=train_gen, steps_per_epoch=STEP_SIZE_TRAIN, validation_data=val_gen, validation_steps=STEP_SIZE_VALID, epochs=EPOCHS, callbacks=callbacks_list) # --- After fitting, load the best model # This is important as otherwise we'll # have the LAST model loaded, not necessarily # the best one. model.load_weights(working_path + strModelFileName) # --- Presentation part # summarize history for accuracy plt.plot(history.history['acc']) plt.plot(history.history['val_acc']) plt.title('model accuracy') plt.ylabel('accuracy') plt.xlabel('epoch') plt.legend(['acc', 'val_acc'], loc='upper left') plt.show() # summarize history for loss plt.plot(history.history['loss']) plt.plot(history.history['val_loss']) plt.title('model loss') plt.ylabel('loss') plt.xlabel('epoch') plt.legend(['loss', 'val_loss'], loc='upper left') plt.show() # As grid optimization of NN would take too long, # I did just few tests with different parameters. # Below I keep results, commented out, in the same # code. As you can see, Inception shows the best # results: # Inception: # adam: val_acc 0.79393 # sgd: val_acc 0.80892 # Mobile: # adam: val_acc 0.65290 # sgd: Epoch 00015: val_acc improved from 0.67584 to 0.68469 # sgd-30 epochs: 0.68 # NASNetMobile, adam: val_acc did not improve from 0.78335 # NASNetMobile, sgd: 0.8</span></span></code> </pre><br><br> æœ€ä½³é…ç½®çš„ç²¾åº¦å’ŒæŸè€—å›¾å¦‚ä¸‹ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0e/97d/9cc/f0e97d9ccdc8f8ed9e44ddba02cf1f8d.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/612/e09/8b0/612e098b088979768d1cc66c2f6972bc.png"><br><br> å¦‚æ‚¨æ‰€è§ï¼Œç¥ç»ç½‘ç»œæ­£åœ¨å­¦ä¹ ï¼Œè€Œä¸”è¿˜ä¸é”™ã€‚ <br><br><h3> ç¥ç»ç½‘ç»œæµ‹è¯• </h3><br><br> è®­ç»ƒå®Œæˆåï¼Œæˆ‘ä»¬å¿…é¡»æµ‹è¯•ç»“æœï¼› ä¸ºæ­¤ï¼ŒNNå±•ç¤ºäº†å¥¹ä»¥å‰ä»æœªè§è¿‡çš„ç…§ç‰‡-æˆ‘ä»¬å¤åˆ¶åˆ°æµ‹è¯•æ–‡ä»¶å¤¹ä¸­çš„ç…§ç‰‡-æ¯ä¸ªçŠ¬ç§ä¸€å¼ ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># --- Test j = 0 # Final cycle performs testing on the entire # testing set. for file_name in os.listdir( working_path + "test/"): img = image.load_img(working_path + "test/" + file_name); img_1 = image.img_to_array(img) img_1 = cv2.resize(img_1, (IMAGE_SIZE, IMAGE_SIZE), interpolation = cv2.INTER_AREA) img_1 = np.expand_dims(img_1, axis=0) / 255. y_pred = model.predict_on_batch(img_1) # get 5 best predictions y_pred_ids = y_pred[0].argsort()[-5:][::-1] print(file_name) for i in range(len(y_pred_ids)): print("\n\t" + map_characters[y_pred_ids[i]] + " (" + str(y_pred[0][y_pred_ids[i]]) + ")") print("--------------------\n") j = j + 1</span></span></code> </pre><br><br><h3> å°†ç¥ç»ç½‘ç»œå¯¼å‡ºåˆ°Javaåº”ç”¨ç¨‹åº </h3><br><br> é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä»ç£ç›˜ç»„ç»‡ç¥ç»ç½‘ç»œçš„åŠ è½½ã€‚ åŸå› å¾ˆæ˜æ˜¾ï¼šå¯¼å‡ºæ˜¯åœ¨å¦ä¸€ä¸ªä»£ç å—ä¸­è¿›è¡Œçš„ï¼Œå› æ­¤å¾ˆå¯èƒ½æˆ‘ä»¬å°†ç¥ç»ç½‘ç»œç½®äºæœ€ä½³çŠ¶æ€æ—¶åˆ†åˆ«å¼€å§‹å¯¼å‡ºã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å³å°†å¯¼å‡ºä¹‹å‰ï¼Œåœ¨è¯¥ç¨‹åºçš„åŒä¸€è¿è¡Œä¸­ï¼Œæˆ‘ä»¬å°†ä¸ä¼šè®­ç»ƒç½‘ç»œã€‚ å¦‚æœä½¿ç”¨æ­¤å¤„æ˜¾ç¤ºçš„ä»£ç ï¼Œåˆ™æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œå› æ­¤å·²ä¸ºæ‚¨é€‰æ‹©äº†æœ€ä½³ç½‘ç»œã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å­¦åˆ°äº†ä¸€äº›è‡ªå·±çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆåœ¨ä¿å­˜ä¹‹å‰é‡æ–°åŸ¹è®­æ‰€æœ‰å†…å®¹å°†æµªè´¹æ—¶é—´ï¼Œå¦‚æœåœ¨æ­¤ä¹‹å‰æ‚¨å·²ä¿å­˜äº†æ‰€æœ‰å†…å®¹ã€‚ <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Test: load and run model = load_model(working_path + strModelFileName)</span></span></code> </pre><br><br> å‡ºäºåŒæ ·çš„åŸå› -ä¸è¦è·³è¿‡ä»£ç -æˆ‘åœ¨æ­¤å¤„åŒ…æ‹¬äº†å¯¼å‡ºæ‰€éœ€çš„æ–‡ä»¶ã€‚ å¦‚æœæ‚¨çš„ç¾æ„Ÿéœ€è¦ï¼Œæ²¡æœ‰äººä¼šæ‰“æ‰°æ‚¨å°†å…¶ç§»è‡³ç¨‹åºçš„å¼€å¤´ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Model <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> load_model <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.layers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensorflow <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tf</code> </pre><br><br> åŠ è½½ç¥ç»ç½‘ç»œåè¿›è¡Œçš„ä¸€é¡¹å°å‹æµ‹è¯•ï¼Œåªæ˜¯ä¸ºäº†ç¡®ä¿åŠ è½½çš„æ‰€æœ‰å†…å®¹éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œï¼š <br><br><pre> <code class="python hljs">img = image.load_img(working_path + <span class="hljs-string"><span class="hljs-string">"test/affenpinscher.jpg"</span></span>) <span class="hljs-comment"><span class="hljs-comment">#basset.jpg") img_1 = image.img_to_array(img) img_1 = cv2.resize(img_1, (IMAGE_SIZE, IMAGE_SIZE), interpolation = cv2.INTER_AREA) img_1 = np.expand_dims(img_1, axis=0) / 255. y_pred = model.predict(img_1) Y_pred_classes = np.argmax(y_pred,axis = 1) # print(y_pred) fig, ax = plt.subplots() ax.imshow(img) ax.axis('off') ax.set_title(map_characters[Y_pred_classes[0]]) plt.show()</span></span></code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/05c/032/846/05c03284674e4337a2e5a3ba617634dd.png" alt="å›¾ç‰‡"><br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è·å–ç½‘ç»œè¾“å…¥å’Œè¾“å‡ºå±‚çš„åç§°ï¼ˆæ— è®ºæ˜¯æ­¤åŠŸèƒ½è¿˜æ˜¯åˆ›å»ºåŠŸèƒ½ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»æ˜ç¡®åœ°â€œå‘½åâ€è¿™äº›å±‚ï¼Œè€Œæˆ‘ä»¬æ²¡æœ‰è¿™æ ·åšï¼‰ã€‚ <br><br><pre> <code class="python hljs">model.summary() &gt;&gt;&gt; Layer (type) &gt;&gt;&gt; ====================== &gt;&gt;&gt; input_7 (InputLayer) &gt;&gt;&gt; ______________________ &gt;&gt;&gt; conv2d_283 (Conv2D) &gt;&gt;&gt; ______________________ &gt;&gt;&gt; ... &gt;&gt;&gt; dense_14 (Dense) &gt;&gt;&gt; ====================== &gt;&gt;&gt; Total params: <span class="hljs-number"><span class="hljs-number">22</span></span>,<span class="hljs-number"><span class="hljs-number">913</span></span>,<span class="hljs-number"><span class="hljs-number">432</span></span> &gt;&gt;&gt; Trainable params: <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">110</span></span>,<span class="hljs-number"><span class="hljs-number">648</span></span> &gt;&gt;&gt; Non-trainable params: <span class="hljs-number"><span class="hljs-number">21</span></span>,<span class="hljs-number"><span class="hljs-number">802</span></span>,<span class="hljs-number"><span class="hljs-number">784</span></span></code> </pre><br><br> ç¨åï¼Œå½“æˆ‘ä»¬å°†ç¥ç»ç½‘ç»œå¯¼å…¥Javaåº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¾“å…¥å’Œè¾“å‡ºå±‚çš„åç§°ã€‚ <br><br> æ¼«æ¸¸ç½‘ç»œä»¥è·å–æ­¤æ•°æ®çš„å¦ä¸€ä¸ªä»£ç ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_graph_nodes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename)</span></span></span><span class="hljs-function">:</span></span> g = tf.GraphDef() g.ParseFromString(open(filename, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>).read()) print() print(filename) print(<span class="hljs-string"><span class="hljs-string">"=======================INPUT==================="</span></span>) print([n <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> g.node <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n.name.find(<span class="hljs-string"><span class="hljs-string">'input'</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span>]) print(<span class="hljs-string"><span class="hljs-string">"=======================OUTPUT=================="</span></span>) print([n <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> g.node <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n.name.find(<span class="hljs-string"><span class="hljs-string">'output'</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span>]) print(<span class="hljs-string"><span class="hljs-string">"===================KERAS_LEARNING=============="</span></span>) print([n <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> g.node <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n.name.find(<span class="hljs-string"><span class="hljs-string">'keras_learning_phase'</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span>]) print(<span class="hljs-string"><span class="hljs-string">"==============================================="</span></span>) print() <span class="hljs-comment"><span class="hljs-comment">#def get_script_path(): # return os.path.dirname(os.path.realpath(sys.argv[0]))</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½†æ˜¯æˆ‘ä¸å–œæ¬¢ä»–ï¼Œä¹Ÿä¸æ¨èä»–ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¸‹ä»£ç ä¼šå°†Kerasç¥ç»ç½‘ç»œå¯¼å‡ºä¸º</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ¼å¼ï¼Œè¿™æ˜¯æˆ‘ä»¬å°†ä»Androidæ•è·çš„æ ¼å¼ã€‚</font></font><br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">keras_to_tensorflow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(keras_model, output_dir, model_name,out_prefix=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"output_"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, log_tensorboard=True)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.exists(output_dir) == <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>: os.mkdir(output_dir) out_nodes = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(keras_model.outputs)): out_nodes.append(out_prefix + str(i + <span class="hljs-number"><span class="hljs-number">1</span></span>)) tf.identity(keras_model.output[i], out_prefix + str(i + <span class="hljs-number"><span class="hljs-number">1</span></span>)) sess = K.get_session() <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tensorflow.python.framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> graph_util <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tensorflow.python.framework graph_io init_graph = sess.graph.as_graph_def() main_graph = graph_util.convert_variables_to_constants( sess, init_graph, out_nodes) graph_io.write_graph(main_graph, output_dir, name=model_name, as_text=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> log_tensorboard: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tensorflow.python.tools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> import_pb_to_tensorboard import_pb_to_tensorboard.import_to_tensorboard( os.path.join(output_dir, model_name), output_dir)</code> </pre><br><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è°ƒç”¨ä»¥ä¸‹å‡½æ•°ä»¥å¯¼å‡ºç¥ç»ç½‘ç»œï¼š </font></font><br><br></p><pre> <code class="python hljs">model = load_model(working_path + strModelFileName) keras_to_tensorflow(model, output_dir=working_path + strModelFileName, model_name=working_path + <span class="hljs-string"><span class="hljs-string">"models/dogs.pb"</span></span>) print_graph_nodes(working_path + <span class="hljs-string"><span class="hljs-string">"models/dogs.pb"</span></span>)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ€åä¸€è¡Œæ˜¾ç¤ºäº†æ‰€å¾—ç¥ç»ç½‘ç»œçš„ç»“æ„ã€‚ </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½¿ç”¨ç¥ç»ç½‘ç»œåˆ›å»ºAndroidåº”ç”¨ç¨‹åº </font></font></h2><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Androidä¸­ç¥ç»ç½‘ç»œçš„å¯¼å‡ºå·²è¢«å½¢å¼åŒ–ï¼Œä¸åº”é€ æˆä»»ä½•å›°éš¾ã€‚</font><font style="vertical-align: inherit;">å’Œå¾€å¸¸ä¸€æ ·ï¼Œæœ‰å‡ ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æœ€æµè¡Œçš„ï¼ˆåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼‰ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨Android Studioåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†â€œå·å·¥å‡æ–™â€ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä»»åŠ¡ä¸æ˜¯androidæ•™ç¨‹ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œè¯¥åº”ç”¨ç¨‹åºå°†ä»…åŒ…å«ä¸€ä¸ªæ´»åŠ¨ã€‚</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b3/76e/997/6b376e997b34f45359c46923f6613d60.png" alt="å›¾ç‰‡"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬æ·»åŠ äº†â€œ assetsâ€æ–‡ä»¶å¤¹å¹¶å°†ç¥ç»ç½‘ç»œå¤åˆ¶åˆ°å…¶ä¸­ï¼ˆæˆ‘ä»¬ä¹‹å‰å¯¼å‡ºçš„é‚£ä¸ªï¼‰ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‘‡ç¯®æ–‡ä»¶ </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œæ‚¨éœ€è¦è¿›è¡Œä¸€äº›æ›´æ”¹ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tensorflow-android</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº“</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒç”¨äºJavaä¸­çš„Tensorflowï¼ˆä»¥åŠç›¸åº”çš„Kerasï¼‰ï¼š</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a16/091/fab/a16091fab2166f834827812611142d26.png" alt="å›¾ç‰‡"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦ä¸€ä¸ªä¸æ˜æ˜¾çš„ç»Šè„šçŸ³ï¼š</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versionCode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">versionName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å½“åº”ç”¨ç¨‹åºæ›´æ”¹æ—¶ï¼Œæ‚¨å°†éœ€è¦åœ¨Google Playä¸Šä¸Šä¼ æ–°ç‰ˆæœ¬ã€‚</font><font style="vertical-align: inherit;">å¦‚æœä¸æ›´æ”¹gdadleä¸­çš„ç‰ˆæœ¬ï¼ˆä¾‹å¦‚1-&gt; 2-&gt; 3 ...ï¼‰ï¼Œåˆ™æ— æ³•æ‰§è¡Œæ­¤æ“ä½œï¼ŒGoogleä¼šç»™å‡ºé”™è¯¯æ¶ˆæ¯â€œæ­¤ç‰ˆæœ¬å·²å­˜åœ¨â€ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¸…å• </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†æ˜¯â€œç¹é‡çš„â€-100 Mbç¥ç»ç½‘ç»œå°†å¾ˆå®¹æ˜“è£…å…¥ç°ä»£æ‰‹æœºçš„å†…å­˜ä¸­ï¼Œä½†æ˜¯ä¸ºä»Facebookâ€œå…±äº«â€çš„æ¯å¼ ç…§ç‰‡æ‰“å¼€å•ç‹¬çš„å®ä¾‹ç»å¯¹ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬ç¦æ­¢åˆ›å»ºå¤šä¸ªåº”ç”¨ç¨‹åºå®ä¾‹ï¼š</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MainActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:launchMode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"singleTask"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é€šè¿‡å‘</font><font style="vertical-align: inherit;">MainActivity </font><font style="vertical-align: inherit;">æ·»åŠ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">androidï¼šlaunchMode =â€œ singleTaskâ€</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬å‘Šè¯‰Androidæ‰“å¼€ï¼ˆæ¿€æ´»ï¼‰åº”ç”¨ç¨‹åºçš„ç°æœ‰å‰¯æœ¬ï¼Œè€Œä¸æ˜¯åˆ›å»ºå¦ä¸€ä¸ªå®ä¾‹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåŒ…å«åœ¨åˆ—è¡¨ä¸­ï¼Œå½“æœ‰äººâ€œå…±äº«â€å›¾ç‰‡æ—¶ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºè¯¥åº”ç”¨ç¨‹åºï¼š</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Send action required to display activity in share list --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.SEND"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Make activity default to launch --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.DEFAULT"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Mime type ie what can be shared with this activity only image and text --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:mimeType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image/*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ€åï¼Œæˆ‘ä»¬éœ€è¦è¯·æ±‚åº”ç”¨ç¨‹åºå°†ä½¿ç”¨çš„åŠŸèƒ½å’Œæƒé™ï¼š </font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-feature</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.hardware.camera"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">= </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.READ_PHONE_STATE"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:node</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remove"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¦‚æœæ‚¨ç†Ÿæ‚‰Androidç¼–ç¨‹ï¼Œåˆ™æ­¤éƒ¨åˆ†ä¸ä¼šå¼•èµ·ä»»ä½•é—®é¢˜ã€‚ </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¸ƒå±€åº”ç”¨ç¨‹åºã€‚ </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†åˆ›å»ºä¸¤ç§å¸ƒå±€ï¼Œä¸€ç§ç”¨äºçºµå‘ï¼Œä¸€ç§ç”¨äºæ¨ªå‘ã€‚</font><font style="vertical-align: inherit;">è¿™å°±æ˜¯</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portraitå¸ƒå±€çš„</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ·å­</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ·»åŠ çš„å†…å®¹ï¼šæ˜¾ç¤ºå›¾ç‰‡çš„å¤§è§†é‡ï¼ˆè§†å›¾ï¼‰ï¼Œçƒ¦äººçš„å¹¿å‘Šåˆ—è¡¨ï¼ˆæŒ‰ä¸‹å¸¦æœ‰éª¨éª¼çš„æŒ‰é’®æ—¶æ˜¾ç¤ºï¼‰ï¼Œâ€œå¸®åŠ©â€æŒ‰é’®ï¼Œç”¨äºä»â€œæ–‡ä»¶/å›¾åº“â€ä¸‹è½½å›¾ç‰‡å¹¶ä»ç›¸æœºæ•è·å›¾ç‰‡çš„æŒ‰é’®ï¼Œæœ€åï¼ˆæœ€åˆæ˜¯éšè—ï¼‰ç”¨äºå›¾åƒå¤„ç†çš„â€œå¤„ç†â€æŒ‰é’®ã€‚</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f71/882/81f/f7188281ff581965c20c7e818cb0fd77.png" alt="å›¾ç‰‡"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ¹æ®åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œæ´»åŠ¨æœ¬èº«åŒ…å«æ˜¾ç¤ºå’Œéšè—ä»¥åŠå¯ç”¨/ç¦ç”¨æŒ‰é’®çš„æ‰€æœ‰é€»è¾‘ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸»è¦æ´»åŠ¨ </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¯¥æ´»åŠ¨ç»§æ‰¿ï¼ˆæ‰©å±•ï¼‰äº†æ ‡å‡†çš„Androidæ´»åŠ¨ï¼š </font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è€ƒè™‘è´Ÿè´£ç¥ç»ç½‘ç»œæ“ä½œçš„ä»£ç ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¦–å…ˆï¼Œç¥ç»ç½‘ç»œæ¥å—ä½å›¾ã€‚</font><font style="vertical-align: inherit;">æœ€åˆï¼Œè¿™æ˜¯æ¥è‡ªç›¸æœºæˆ–æ–‡ä»¶ï¼ˆm_bitmapï¼‰çš„å¤§ä½å›¾ï¼ˆä»»æ„å¤§å°ï¼‰ï¼Œç„¶åæˆ‘ä»¬å¯¹å…¶è¿›è¡Œè½¬æ¢ï¼Œä»è€Œç”Ÿæˆæ ‡å‡†256x256åƒç´ ï¼ˆm_bitmapForNnï¼‰ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜å°†ä½å›¾å¤§å°ï¼ˆ256ï¼‰å­˜å‚¨åœ¨ä¸€ä¸ªå¸¸é‡ä¸­ï¼š</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Bitmap m_bitmap = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Bitmap m_bitmapForNn = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> m_nImageSize = <span class="hljs-number"><span class="hljs-number">256</span></span>;</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¿…é¡»å‘Šè¯‰ç¥ç»ç½‘ç»œè¾“å…¥å’Œè¾“å‡ºå±‚çš„åç§°ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¾ƒæ—©æ”¶åˆ°äº†å®ƒä»¬ï¼ˆè¯·å‚è§æ¸…å•ï¼‰ï¼Œä½†è¯·è®°ä½ï¼Œåœ¨æ‚¨çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬å¯èƒ½æœ‰æ‰€ä¸åŒï¼š</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String INPUT_NAME = <span class="hljs-string"><span class="hljs-string">"input_7_1"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String OUTPUT_NAME = <span class="hljs-string"><span class="hljs-string">"output_1"</span></span>;</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶åï¼Œæˆ‘ä»¬å£°æ˜ä¸€ä¸ªå˜é‡æ¥ä¿å­˜TensofFlowå¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œæˆ‘ä»¬å­˜å‚¨ç¥ç»ç½‘ç»œæ–‡ä»¶ï¼ˆä½äºèµ„äº§ä¸­ï¼‰çš„è·¯å¾„ï¼š</font></font><br><br><p></p><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç§æœ‰TensorFlowInferenceInterface tf;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ç§æœ‰å­—ç¬¦ä¸²MODEL_PATH = </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
	â€œæ–‡ä»¶ï¼š////android_asset/dogs.pbâ€ï¼›</font></font><font></font>
</pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬å°†ç‹—çš„å“ç§å­˜å‚¨åœ¨åˆ—è¡¨ä¸­ï¼Œä»¥ä¾¿ç¨åå°†å®ƒä»¬æ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œè€Œä¸æ˜¯æ•°ç»„ç´¢å¼•ï¼š </font></font><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String[] m_arrBreedsArray;</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åˆï¼Œæˆ‘ä»¬ä¸‹è½½äº†ä½å›¾ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œç¥ç»ç½‘ç»œéœ€è¦ä¸€ä¸ªRGBå€¼æ•°ç»„ï¼Œå¹¶ä¸”å…¶è¾“å‡ºæ˜¯è¯¥å“ç§å°±æ˜¯å›¾ä¸­æ‰€ç¤ºæ¦‚ç‡çš„æ•°ç»„ã€‚</font><font style="vertical-align: inherit;">å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸¤ä¸ªä»¥ä¸Šçš„æ•°ç»„ï¼ˆè¯·æ³¨æ„ï¼Œæˆ‘ä»¬çš„è®­ç»ƒæ•°æ®ä¸­å­˜åœ¨120ä¸ªçŠ¬ç§ï¼‰ï¼š</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] m_arrPrediction = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[<span class="hljs-number"><span class="hljs-number">120</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] m_arrInput = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä¸‹è½½tensorflowæ¨ç†åº“ï¼š </font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { System.loadLibrary(<span class="hljs-string"><span class="hljs-string">"tensorflow_inference"</span></span>); }</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç”±äºç¥ç»ç½‘ç»œæ“ä½œéœ€è¦æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œå®ƒä»¬ï¼Œå¦åˆ™æˆ‘ä»¬å°†æœ‰å¯èƒ½æ”¶åˆ°ç³»ç»Ÿæ¶ˆæ¯â€œåº”ç”¨ç¨‹åºæ— å“åº”â€ï¼Œæ›´ä¸ç”¨è¯´ç”¨æˆ·ä¸æ»¡æ„äº†ã€‚ </font></font><br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PredictionTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPreExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPreExecute(); } <span class="hljs-comment"><span class="hljs-comment">// --- @Override protected Void doInBackground(Void... params) { try { # We get RGB values packed in integers # from the Bitmap, then break those # integers into individual triplets m_arrInput = new float[ m_nImageSize * m_nImageSize * 3]; int[] intValues = new int[ m_nImageSize * m_nImageSize]; m_bitmapForNn.getPixels(intValues, 0, m_nImageSize, 0, 0, m_nImageSize, m_nImageSize); for (int i = 0; i &lt; intValues.length; i++) { int val = intValues[i]; m_arrInput[i * 3 + 0] = ((val &gt;&gt; 16) &amp; 0xFF) / 255f; m_arrInput[i * 3 + 1] = ((val &gt;&gt; 8) &amp; 0xFF) / 255f; m_arrInput[i * 3 + 2] = (val &amp; 0xFF) / 255f; } // --- tf = new TensorFlowInferenceInterface( getAssets(), MODEL_PATH); //Pass input into the tensorflow tf.feed(INPUT_NAME, m_arrInput, 1, m_nImageSize, m_nImageSize, 3); //compute predictions tf.run(new String[]{OUTPUT_NAME}, false); //copy output into PREDICTIONS array tf.fetch(OUTPUT_NAME, m_arrPrediction); } catch (Exception e) { e.getMessage(); } return null; } // --- @Override protected void onPostExecute(Void result) { super.onPostExecute(result); // --- enableControls(true); // --- tf = null; m_arrInput = null; # strResult contains 5 lines of text # with most probable dog breeds and # their probabilities m_strResult = ""; # What we do below is sorting the array # by probabilities (using map) # and getting in reverse order) the # first five entries TreeMap&lt;Float, Integer&gt; map = new TreeMap&lt;Float, Integer&gt;( Collections.reverseOrder()); for(int i = 0; i &lt; m_arrPrediction.length; i++) map.put(m_arrPrediction[i], i); int i = 0; for (TreeMap.Entry&lt;Float, Integer&gt; pair : map.entrySet()) { float key = pair.getKey(); int idx = pair.getValue(); String strBreed = m_arrBreedsArray[idx]; m_strResult += strBreed + ": " + String.format("%.6f", key) + "\n"; i++; if (i &gt; 5) break; } m_txtViewBreed.setVisibility(View.VISIBLE); m_txtViewBreed.setText(m_strResult); } }</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨MainActivityçš„onCreateï¼ˆï¼‰ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºâ€œ Processâ€æŒ‰é’®æ·»åŠ onClickListenerï¼š </font></font><br><br><pre> <code class="java hljs">m_btn_process.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ processImage(); } });</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿™é‡Œçš„processImageï¼ˆï¼‰åªæ˜¯è°ƒç”¨æˆ‘ä»¬ä¸Šé¢æè¿°çš„çº¿ç¨‹ï¼š </font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { enableControls(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">// --- PredictionTask prediction_task = new PredictionTask(); prediction_task.execute(); } catch (Exception e) { e.printStackTrace(); } }</span></span></code> </pre><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é™„åŠ è¯´æ˜ </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸æ‰“ç®—è®¨è®ºAndroidçš„UIç¼–ç¨‹çš„ç»†èŠ‚ï¼Œå› ä¸ºè¿™å½“ç„¶ä¸é€‚ç”¨äºç§»æ¤ç¥ç»ç½‘ç»œçš„ä»»åŠ¡ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œæœ‰ä¸€ä»¶äº‹ä»ç„¶å€¼å¾—ä¸€æã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“æˆ‘ä»¬é˜»æ­¢åˆ›å»ºåº”ç”¨ç¨‹åºçš„å…¶ä»–å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿç ´åäº†åˆ›å»ºå’Œåˆ é™¤æ´»åŠ¨ï¼ˆæ§åˆ¶æµç¨‹ï¼‰çš„é€šå¸¸é¡ºåºï¼šå¦‚æœæ‚¨â€œå…±äº«â€ Facebookä¸­çš„å›¾ç‰‡ï¼Œç„¶åå…±äº«å¦ä¸€å¼ å›¾ç‰‡ï¼Œåˆ™è¯¥åº”ç”¨ç¨‹åºå°†ä¸ä¼šé‡æ–°å¯åŠ¨ã€‚</font><font style="vertical-align: inherit;">è¿™æ„å‘³ç€åœ¨onCreateä¸­æ•è·ä¼ è¾“æ•°æ®çš„â€œä¼ ç»Ÿâ€æ–¹å¼æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºä¸ä¼šè°ƒç”¨onCreateã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•å¦‚ä¸‹ï¼š</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.åœ¨MainActivityä¸­çš„onCreateä¸­ï¼Œè°ƒç”¨onSharedIntentå‡½æ•°ï¼š</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); .... onSharedIntent(); ....</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬è¿˜ä¸ºonNewIntentæ·»åŠ äº†ä¸€ä¸ªå¤„ç†ç¨‹åºï¼š </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNewIntent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onNewIntent(intent); setIntent(intent); onSharedIntent(); }</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¿™æ˜¯onSharedIntentå‡½æ•°æœ¬èº«ï¼š </font></font><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSharedIntent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Intent receivedIntent = getIntent(); String receivedAction = receivedIntent.getAction(); String receivedType = receivedIntent.getType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (receivedAction.equals(Intent.ACTION_SEND)) { <span class="hljs-comment"><span class="hljs-comment">// If mime type is equal to image if (receivedType.startsWith("image/")) { m_txtViewBreed.setText(""); m_strResult = ""; Uri receivedUri = receivedIntent.getParcelableExtra( Intent.EXTRA_STREAM); if (receivedUri != null) { try { Bitmap bitmap = MediaStore.Images.Media.getBitmap( this.getContentResolver(), receivedUri); if(bitmap != null) { m_bitmap = bitmap; m_picView.setImageBitmap(m_bitmap); storeBitmap(); enableControls(true); } } catch (Exception e) { e.printStackTrace(); } } } } }</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨onCreateï¼ˆå¦‚æœåº”ç”¨ç¨‹åºä¸åœ¨å†…å­˜ä¸­ï¼‰æˆ–onNewIntentï¼ˆå¦‚æœå®ƒæ—©å…ˆå¯åŠ¨ï¼‰ä¸­å¤„ç†ä¼ è¾“çš„æ•°æ®ã€‚</font></font><br><br><br><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¥ä½ å¥½è¿ </font><font style="vertical-align: inherit;">å¦‚æœæ‚¨å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ä»¥æ‰€æœ‰å¯èƒ½çš„æ–¹å¼â€œå–œæ¬¢â€å®ƒï¼Œ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç½‘ç«™</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸Šä¹Ÿæœ‰â€œç¤¾äº¤â€æŒ‰é’®</font><font style="vertical-align: inherit;">ã€‚</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN448316/">https://habr.com/ru/post/zh-CN448316/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN448300/index.html">ä¼šè®®é‚®ä»¶ï¼šCLOUD-å…³äºäº‘åŠå…¶å‘¨å›´</a></li>
<li><a href="../zh-CN448302/index.html">AdBlockå’ŒuBlockè¿‡æ»¤å™¨ä¸­çš„æ¼æ´å…è®¸åœ¨ç”¨æˆ·ç«¯æ‰§è¡Œä»»æ„ä»£ç </a></li>
<li><a href="../zh-CN448304/index.html">ã€Šè¡ŒåŠ¨ä¸­çš„Vue.jsã€‹ä¸€ä¹¦</a></li>
<li><a href="../zh-CN448308/index.html">æ•°æ®ç§‘å­¦æ–‡æ‘˜ï¼ˆ2019å¹´4æœˆï¼‰</a></li>
<li><a href="../zh-CN448310/index.html">ä½¿ç”¨Telebotåº“ç¬¬1éƒ¨åˆ†åœ¨pythonä¸­ç¼–å†™ç”µæŠ¥bot</a></li>
<li><a href="../zh-CN448320/index.html">ä¸ºä»€ä¹ˆè¦ç¡…ï¼Œä¸ºä»€ä¹ˆè¦CMOSï¼Ÿ</a></li>
<li><a href="../zh-CN448322/index.html">C ++ Russia 2019ï¼šå…è´¹æ’­æ”¾ç¬¬ä¸€å¤§å…ï¼Œå¹¶ç®€è¦ä»‹ç»äº†ä¼šè®®çš„å†…å®¹</a></li>
<li><a href="../zh-CN448324/index.html">åˆ›å»ºç¨‹åºæ€§åœ°çƒä»ª</a></li>
<li><a href="../zh-CN448326/index.html">çœ‹ç©¿ å¦‚ä½•åœ¨ä¸ç ´åå­¦ç§‘çš„æƒ…å†µä¸‹å­¦ä¹ å­¦ç§‘ï¼Ÿ</a></li>
<li><a href="../zh-CN448328/index.html">åœ¨è«æ–¯ç§‘ï¼Œå°†å±•ç¤ºä¸€å°å¯ä»¥æ‰“å°å™¨å®˜å’Œç»„ç»‡çš„æ‰“å°æœº</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>