<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🏭 👩‍❤️‍👨 📞 Guide de l'audit automatique des contrats intelligents. Partie 2: Slither 🤾🏾 🛠️ 🍱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Analyseur: Slither 
 Description: Framework d'analyse statique open-source pour Solidity 
 githib: https://github.com/trailofbits/slither 


 Il s'agi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide de l'audit automatique des contrats intelligents. Partie 2: Slither</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438338/"><p>  Analyseur: Slither <br>  Description: Framework d'analyse statique open-source pour Solidity <br>  githib: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/trailofbits/slither</a> </p><br><p>  Il s'agit d'un analyseur de code statique écrit en python.  Il sait comment surveiller les variables, les appels et détecte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une telle liste de vulnérabilités</a> .  Chaque vulnérabilité a un lien avec une description, et si vous êtes nouveau sur Solidity, il est logique que vous appreniez à connaître tout le monde. </p><br><p>  Slither peut fonctionner comme un module python et fournir au programmeur une interface pour l'audit selon son propre plan.  Un exemple simple et illustratif de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce que peut faire Slither peut être vu ici</a> . </p><br><p>  Nous reviendrons sur les scénarios d'analyse à la fin de l'article, mais pour l'instant exécutez Slither: </p><a name="habracut"></a><br><pre><code class="plaintext hljs">git clone https://github.com/trailofbits/slither.git cd slither docker build -t slither .</code> </pre> <br><p>  et essayez d'analyser notre contrat. </p><br><p>  Nous allons dans le répertoire avec constructor-eth-booking et essayons d'exécuter slither depuis le docker: </p><br><pre> <code class="bash hljs">$ docker run -v $(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>)/contracts:/slither/contracts slither contracts/flattened.sol</code> </pre> <br><p>  nous obtenons l'erreur "Le fichier source nécessite une version différente du compilateur", et maintenant nous devons mettre la version de <code>solc=0.4.20</code> dans le docker slither.  Pour ce faire, nous corrigeons le Dockerfile de Slither lui-même, comme indiqué dans la section 2 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de l'introduction</a> , c'est-à-dire  quelque part à la fin du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dockerfile, nous</a> ajoutons la ligne: </p><br><pre> <code class="plaintext hljs">COPY --from=ethereum/solc:0.4.20 /usr/bin/solc /usr/bin</code> </pre> <br><p>  , reconstruisez l'image, courez, applaudissez, tout se compile. </p><br><p>  Nous voyons la sortie, un avertissement sur différents «pragma» et sur les noms de variables incorrects comme le <code>Parameter '_price' of Booking.Booking (flattened.sol#73) is not in mixedCase</code> .  Les analyseurs donnent beaucoup d'avertissements, mais nous recherchons de vrais bugs, et nous ne ferons pas attention à la bagatelle.  Nous filtrons tous les messages sur mixedCase, maintenant ce n'est pas à la hauteur du style: </p><br><pre> <code class="plaintext hljs">$ docker run -v $(pwd)/contracts:/slither/contracts slither contracts/flattened.sol 2&gt;&amp;1 | fgrep -v 'mixedCase'</code> </pre> <br><p>  Les vrais programmeurs manquent tout ce qui est vert, tout ce qui est rouge, et voici ce que Slither a trouvé dans le contrat en plus des faux positifs: </p><br><pre> <code class="plaintext hljs">Booking.refundWithoutCancellationFee (flattened.sol#243-250) sends eth to arbirary user Dangerous calls: - client.transfer(address(this).balance) (flattened.sol#249) Reference: https://github.com/trailofbits/slither/wiki/Vulnerabilities-Description#functions-that-send-ether-to-arbitrary-destinations INFO:Detectors: Booking.refundWithCancellationFee (flattened.sol#252-259) sends eth to arbirary user Dangerous calls: - owner.transfer(m_cancellationFee) (flattened.sol#257) - client.transfer(address(this).balance) (flattened.sol#258) Reference: https://github.com/trailofbits/slither/wiki/Vulnerabilities-Description#functions-that-send-ether-to-arbitrary-destinations</code> </pre> <br><p>  Maintenant, regardez ce qui ne va pas avec cette fonction dans le contrat: </p><br><pre> <code class="plaintext hljs"> /************************** PRIVATE **********************/ function refundWithoutCancellationFee() private { address client = m_client; m_client = address(0); changeState(State.OFFER); client.transfer(address(this).balance); } function refundWithCancellationFee() private { address client = m_client; m_client = address(0); changeState(State.CANCELED); owner.transfer(m_cancellationFee); client.transfer(address(this).balance); }</code> </pre> <br><p>  dans ce cas, par exemple, la fonction <code>refundWithoutCancellationFee()</code> est appelée comme ceci: </p><br><pre> <code class="plaintext hljs"> function rejectPayment() external onlyOwner onlyState(State.PAID) { refundWithoutCancellationFee(); } function refund() external onlyClient onlyState(State.PAID) { refundWithoutCancellationFee(); }</code> </pre><br><p>  Hmm, formellement, il n'y a pas d'erreur: les appels sont protégés par toutes sortes de <code>onlyOwner</code> , mais Slither jure que, selon eux, la diffusion est envoyée sans aucun contrôle à l'intérieur de remboursementWithoutCancellationFee ().  Et il a raison, la fonction elle-même n'a vraiment presque aucune restriction.  Que ce soit privé, et il est appelé à partir des wrappers "rejettePaiement ()" "remboursement ()" avec les restrictions nécessaires, mais dans ce formulaire, si vous modifiez le contrat, il y a un grand risque d'oublier les restrictions et de coller le <code>refundWithoutCancellationFee()</code> appel à <code>refundWithoutCancellationFee()</code> vers un autre endroit, à la disposition de l'attaquant.  Ainsi, même s'il n'y a formellement aucune vulnérabilité, les informations se sont avérées utiles - il s'agit au moins d'un niveau «d'avertissement», si la mission prévoit de développer davantage le code du contrat.  Dans ce cas, deux fonctions de participants différents utilisent le même code, et cette décision a été prise d'économiser du gaz - le contrat est unique et le coût de son calcul est un facteur important. </p><br><p>  J'ai revérifié que Slither maudissait pour toute diffusion, et j'ai transféré le corps de la fonction directement aux «rejeterPaiement ()» et «remboursement ()» ci-dessus, l'avertissement a disparu, c'est-à-dire  Slither s'est rendu compte que maintenant la diffusion n'est pas envoyée sans vérification d'adresse.  Bon début! </p><br><p>  Voyons maintenant comment Slither surveille l'initialisation des variables, pour cela nous commentons deux initialisations: </p><br><pre> <code class="plaintext hljs">- m_fileHash = _fileHash; + // m_fileHash = _fileHash; - m_price = _price; + // m_price = _price;</code> </pre> <br><p>  le premier n'est pas très important, en termes de trous, sauf pour le gaspillage de ressources, car m_fileHash n'est utilisé nulle part, il est simplement stocké sur la blockchain lors de la création d'un contrat.  Mais m_price est utilisé, et Slither jure correctement que m_price n'est initialisé nulle part, bien qu'il soit utilisé: </p><br><pre> <code class="plaintext hljs">Booking.m_price (flattened.sol#128) is never initialized. It is used in: - fallback (flattened.sol#144-156)</code> </pre> <br><p>  Eh bien, c'est un truc simple, comme prévu, tout a bien fonctionné. </p><br><p>  Nous allons maintenant ajouter la réentrance si chère à tout le monde dans le contrat: nous allons changer l'état du contrat après un appel externe.  Nous apportons les modifications suivantes: </p><br><pre> <code class="plaintext hljs"> function refundWithoutCancellationFee() private { address client = m_client; - m_client = address(0); - changeState(State.OFFER); - client.transfer(address(this).balance); + client.call.value(address(this).balance)(); + m_client = address(0); + changeState(State.OFFER); }</code> </pre> <br><p>  J'ai dû remplacer le transfert par un appel, car  la variante de transfert ne jure pas car le transfert envoie un appel avec un minimum de gaz, et un rappel est impossible (bien que lors du passage à la fourche de Constantinople dans Ethereum, le prix du gaz a été modifié et cela a réactivé l'attaque de réentrance en utilisant le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">transfert</a> . </p><br><p>  Résultat de la recherche de réentrance: </p><br><pre> <code class="plaintext hljs">Reentrancy in Booking.refundWithoutCancellationFee (flattened.sol#243-253): External calls: - client.call.value(address(this).balance)() (flattened.sol#245) State variables written after the call(s): - m_client (flattened.sol#246)</code> </pre> <br><p>  C'est bien, au moins ça ne donnera pas de variables d'état après des appels externes, et c'est très bien. </p><br><p>  Si vous vous déplacez le long de la liste, les vulnérabilités restantes de la liste recherchent simplement des méthodes spécifiques dans le code ou des modèles connus qui, bien sûr, si l'accès au balisage par python est disponible, fonctionne de manière assez fiable.  C'est-à-dire  schémas bien connus Slither ne manquera pas. </p><br><p>  Maintenant, je vais apporter des modifications qui montrent parfaitement les spécificités du travail des analyseurs statiques: </p><br><pre> <code class="plaintext hljs">- client.transfer(address(this).balance + for (uint i=0; i &lt; 1; i++) { + client.transfer(address(this).balance - 999999999999999999); + }</code> </pre> <br><p>  et le résultat: </p><br><pre> <code class="plaintext hljs">Booking.refundWithoutCancellationFee has external calls inside a loop: - client.transfer(address(this).balance - 999999999999999999) (flattened.sol#252) Reference: https://github.com/trailofbits/slither/wiki/Vulnerabilities-Description/_edit#calls-inside-a-loop</code> </pre> <br><p>  Le cycle est exécuté une fois et est dégénéré - par conséquent, l'avertissement émis est faux positif, et l'absence d'avertissement sur l'arithmétique dangereuse est faux négatif.  Analyse des types, résultats des opérations, comptage des appels - les tâches ne sont pas destinées aux analyseurs statiques.  Par conséquent, comprenez clairement quelles erreurs Slither trouvera et lesquelles devraient être recherchées à l'aide d'autres outils. </p><br><p>  Nous avons promis de mentionner la possibilité d'écrire nos propres scripts pour les tests et la sortie de toute information intéressante sur le contrat en utilisant la clé <code>--print</code> .  De ce point de vue, Slither est un excellent outil pour CI.  Les développeurs d'un grand système de contrat connaissent les noms des variables critiques pour la sécurité: soldes, tailles de commission, indicateurs et peuvent écrire un script de test qui bloquera toutes les modifications du code qui, par exemple, écraseront une variable importante ou changeront les variables d'état après un appel externe, et son analyse hautement prévisible est un excellent outil pour une utilisation dans les crochets. <br>  La tâche de Slither est de vous sauver des bogues stupides, de trouver des schémas dangereux bien connus et d'avertir le développeur.  Dans cette version, c'est un bon outil pour un développeur novice sur Solidity, vous demandant immédiatement comment écrire du code dans Solidity correctement. </p><br><h3 id="itogi">  Résumé </h3><br><p>  Dans mes tests personnels, je mettrais Slither quatre pour la polyvalence, la simplicité et la facilité d'utilisation, ainsi que pour des scripts de test simples et compréhensibles et l'adaptabilité à CI. </p><br><p>  Slither a trouvé en toute confiance un véritable AVERTISSEMENT associé à l'utilisation de la fonction d'envoi de la diffusion, il a trouvé tous les bugs introduits.  Il ne pourrait pas faire face uniquement à l'analyse dynamique, ce qui ne devrait pas être fait officiellement, sinon il devrait sacrifier l'universalité, la prévisibilité et la facilité d'utilisation. </p><br><p>  Dans le prochain article, nous traiterons de l'analyseur Mythril, mais voici la table des matières des articles prêts ou prévus pour l'écriture: </p><br><p>  Partie 1. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Introduction.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Compilation, aplatissement, versions de Solidity</a> <br>  Partie 2. Slither (cet article) <br>  Partie 3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mythril</a> <br>  Partie 4. Manticore (en cours d'écriture) <br>  Partie 5. Echidna (en cours d'écriture) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438338/">https://habr.com/ru/post/fr438338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438328/index.html">Comment gonflé la bulle salariale des programmeurs?</a></li>
<li><a href="../fr438330/index.html">Université d'État d'Adams. Comment pirater des sites Web. Partie 1</a></li>
<li><a href="../fr438332/index.html">Université d'État d'Adams. Comment pirater des sites Web. 2e partie</a></li>
<li><a href="../fr438334/index.html">Transition vers la 3D: l'impact de l'architecture à puce et des algorithmes d'enregistrement sur la vie des SSD</a></li>
<li><a href="../fr438336/index.html">Guide de l'audit automatique des contrats intelligents. Partie 1: Se préparer pour un audit</a></li>
<li><a href="../fr438340/index.html">Médias: iCloud pourrait avoir une fuite de données qu'Apple tentait de cacher</a></li>
<li><a href="../fr438342/index.html">Pourquoi Cheats AI Amical dans Ghost Recon Wildlands</a></li>
<li><a href="../fr438346/index.html">Comment font-ils? Présentation des technologies d'anonymisation des crypto-monnaies</a></li>
<li><a href="../fr438348/index.html">Comment apprendre à programmer à 9 ans de façon autonome</a></li>
<li><a href="../fr438350/index.html">Guide complet de recherche professionnelle de caméras cachées et d'appareils espions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>