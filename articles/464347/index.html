<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêâ üì≠ üéóÔ∏è Inyecci√≥n de dependencias, JavaScript y m√≥dulos ES6 üë®‚Äçüëß‚Äçüë¶ üòô ü§òüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Otra implementaci√≥n de Dependency Injection en JavaScript es con m√≥dulos ES6, con la capacidad de usar el mismo c√≥digo en un navegador y en nodejs y n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Inyecci√≥n de dependencias, JavaScript y m√≥dulos ES6</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464347/"><p>  Otra implementaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dependency Injection en JavaScript</a> es con m√≥dulos ES6, con la capacidad de usar el mismo c√≥digo en un navegador y en nodejs y no usar transpilers. </p><br><p><img src="https://habrastorage.org/webt/cm/yd/it/cmyditgokfobpp0llt2opzsflts.jpeg" alt="imagen"></p><br><p>  Debajo del corte est√° mi opini√≥n sobre DI, su lugar en las aplicaciones web modernas, la implementaci√≥n fundamental de un contenedor DI que puede crear objetos tanto en el frente como en la parte posterior, as√≠ como una explicaci√≥n de lo que Michael Jackson tiene que ver con √©l. </p><a name="habracut"></a><br><p>  Les pido encarecidamente a quienes consideran trivial en el art√≠culo que no se violen y no lean hasta el final, para que luego, cuando est√©n decepcionados, no pongan un "menos".  No estoy en contra de los "inconvenientes", pero solo si el signo negativo va acompa√±ado de un comentario, qu√© exactamente en la publicaci√≥n caus√≥ una reacci√≥n negativa.  Este es un art√≠culo t√©cnico, as√≠ que trate de ser condescendiente con el estilo de presentaci√≥n y critique con precisi√≥n el componente t√©cnico de lo anterior.  Gracias </p><br><h1 id="obekty-v-prilozhenii">  Objetos en la aplicaci√≥n </h1><br><p>  Realmente respeto la programaci√≥n funcional, pero dediqu√© la mayor parte de mi actividad profesional a crear aplicaciones consistentes en objetos.  JavaScript me impresiona con el hecho de que las funciones en √©l tambi√©n son objetos.  Al crear aplicaciones, pienso en objetos, esta es mi deformaci√≥n profesional. </p><br><p>  Seg√∫n la duraci√≥n, los objetos en la aplicaci√≥n se pueden dividir en las siguientes categor√≠as: </p><br><ul><li>  <strong>permanente</strong> : surgen en alguna etapa de la solicitud y se destruyen solo cuando se completa la solicitud; </li><li>  <strong>temporal</strong> : surgen cuando es necesario realizar alguna operaci√≥n y se destruyen cuando se completa esta operaci√≥n; </li></ul><br><p>  En este sentido, en la programaci√≥n existen patrones de dise√±o tales como: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">singleton</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">f√°brica abstracta</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">constructor</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">piscina</a> , ... </li></ul><br><p>  Es decir, desde mi punto de vista, la aplicaci√≥n consiste en solitarios existentes permanentemente que realizan las operaciones requeridas ellos mismos o generan objetos temporales para ejecutarlos. </p><br><h1 id="konteyner-obektov">  Contenedor de objetos </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La inyecci√≥n de dependencia</a> es un enfoque que facilita la creaci√≥n de objetos en una aplicaci√≥n.  Es decir, en la aplicaci√≥n hay un objeto especial que "sabe" c√≥mo crear todos los dem√°s objetos.  Tal objeto se llama un Contenedor de Objetos (a veces un Administrador de Objetos). </p><br><p>  El contenedor de objetos no es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">objeto divino</a> , porque  su tarea es solo crear objetos significativos de la aplicaci√≥n y proporcionarles acceso a otros objetos.  La gran mayor√≠a de los objetos de aplicaci√≥n, generados por el Contenedor y ubicados en √©l, no tienen idea sobre el Contenedor en s√≠.  Se pueden colocar en cualquier otro entorno, con las dependencias necesarias, y tambi√©n funcionar√°n notablemente bien all√≠ (los evaluadores saben a qu√© me refiero). </p><br><h1 id="mesto-vnedreniya">  Lugar de implementaci√≥n </h1><br><p>  En general, hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dos formas</a> de inyectar dependencias en un objeto: </p><br><ul><li>  a trav√©s del constructor; </li><li>  a trav√©s de una propiedad (o su accesor); </li></ul><br><p>  B√°sicamente utilic√© el primer enfoque, as√≠ que continuar√© la descripci√≥n con el punto de vista de la inyecci√≥n de dependencia a trav√©s del constructor. </p><br><p>  Digamos que tenemos una aplicaci√≥n que consta de tres objetos: </p><br><p><img src="https://habrastorage.org/webt/lv/5n/w4/lv5nw4nv1bperu7mgoxtn4luss4.png" alt="imagen"></p><br><p>  En PHP (este lenguaje con tradiciones DI de larga data, actualmente tengo equipaje activo, pasar√© a JS un poco m√°s tarde) una situaci√≥n similar podr√≠a reflejarse de esta manera: </p><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Config $config)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config = $config; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $service; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Config $config, Service $service)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config = $config; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;service = $service; } }</code> </pre> <br><p>  Esta informaci√≥n deber√≠a ser suficiente para que un contenedor DI (por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">liga / contenedor</a> ), si se configura adecuadamente, puede, previa solicitud, crear un objeto <code>Application</code> , crear sus dependencias <code>Service</code> y <code>Config</code> y pasarlos par√°metros al constructor del objeto <code>Application</code> . </p><br><h1 id="identifikatory-zavisimostey">  Identificadores de dependencia </h1><br><p>  ¬øC√≥mo entiende el Contenedor de objetos que el constructor del objeto <code>Application</code> requiere dos objetos <code>Config</code> y <code>Service</code> ?  Analizando el objeto a trav√©s de la API de Reflection ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PHP</a> ) o analizando el c√≥digo del objeto directamente (anotaciones de c√≥digo).  Es decir, en el caso general, podemos determinar los nombres de las variables que el constructor de objetos espera ver en la entrada, y si el lenguaje es tipificable, tambi√©n podemos obtener los tipos de estas variables. </p><br><p>  Por lo tanto, como identificadores de objetos, el Contenedor puede operar con los nombres de los par√°metros de entrada del constructor o con los tipos de par√°metros de entrada. </p><br><h1 id="sozdanie-obektov">  Crear objetos </h1><br><p>  El programador puede crear expl√≠citamente el objeto y colocarlo en el Contenedor bajo el identificador correspondiente (por ejemplo, "configuraci√≥n") </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \League\Container\Container $container */</span></span> $container-&gt;add(<span class="hljs-string"><span class="hljs-string">"configuration"</span></span>, $config);</code> </pre> <br><p>  y puede ser creado por el Contenedor de acuerdo con ciertas reglas espec√≠ficas.  Estas reglas, en general, se reducen a hacer coincidir el identificador del objeto con su c√≥digo.  Las reglas se pueden establecer expl√≠citamente (mapeo en forma de c√≥digo, XML, JSON, ...) </p><br><pre> <code class="json hljs">[ [<span class="hljs-string"><span class="hljs-string">"object_id_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"/path/to/source1.php"</span></span>], [<span class="hljs-string"><span class="hljs-string">"object_id_2"</span></span>, <span class="hljs-string"><span class="hljs-string">"/path/to/source2.php"</span></span>], ... ]</code> </pre> <br><p>  o en forma de alg√∫n algoritmo: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{. <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"/path/to/source/${id}.php"</span></span>; }</code> </pre> <br><p>  En PHP, las reglas para hacer coincidir un nombre de clase con un archivo con su c√≥digo fuente est√°n estandarizadas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PSR-4</a> ); en Java, la coincidencia se realiza en el nivel de configuraci√≥n JVM ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cargador de clases</a> ).  Si el Contenedor proporciona una b√∫squeda autom√°tica de fuentes al crear objetos, entonces los nombres de clase son identificadores suficientemente buenos para los objetos en dicho Contenedor. </p><br><h1 id="namespaces">  Espacios de nombres </h1><br><p>  Por lo general, en un proyecto, adem√°s de su propio c√≥digo, tambi√©n se utilizan m√≥dulos de terceros.  Con el advenimiento de los administradores de dependencias (maven, composer, npm), el uso de m√≥dulos se ha simplificado enormemente, y el n√∫mero de m√≥dulos en proyectos ha aumentado considerablemente.  Los espacios de nombres permiten que existan elementos de c√≥digo del mismo nombre en un solo proyecto desde varios m√≥dulos (clases, funciones, constantes). </p><br><p>  Hay idiomas en los que el espacio de nombres est√° integrado inicialmente (Java): </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> vendor.project.<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.folder;</code> </pre> <br><p>  Hay idiomas en los que se agreg√≥ el espacio de nombres durante el desarrollo del lenguaje (PHP): </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Vendor</span></span>\<span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">Module</span></span>\<span class="hljs-title"><span class="hljs-title">Folder</span></span>;</code> </pre> <br><p>  Una buena implementaci√≥n del espacio de nombres le permite abordar inequ√≠vocamente cualquier elemento del c√≥digo: </p><br><pre> <code class="php hljs">\Doctrine\Common\Annotations\Annotation\Attribute::$name</code> </pre> <br><p>  El espacio de nombres resuelve el problema de organizar muchos elementos de software en un proyecto, y la estructura de archivos resuelve el problema de organizar archivos en disco.  Por lo tanto, no solo hay mucho en com√∫n entre ellos, y a veces mucho, en Java, por ejemplo, una clase p√∫blica en el espacio de nombres debe estar unida a un archivo con el c√≥digo de esta clase. </p><br><p>  Por lo tanto, usar el identificador de una clase de objeto en el espacio de nombres del proyecto como identificadores de objeto en el Contenedor es una buena idea y puede servir como base para crear reglas para la detecci√≥n autom√°tica de c√≥digos fuente al crear el objeto deseado. </p><br><pre> <code class="php hljs">$container-&gt;add(\Vendor\Project\Module\ObjectType::class, $obj);</code> </pre> <br><h1 id="avtozagruzka-koda">  Inicio de c√≥digo </h1><br><p>  En PHP <code>composer</code> espacio de nombres <code>composer</code> m√≥dulo se asigna al sistema de archivos dentro del m√≥dulo en el descriptor del m√≥dulo <code>composer.json</code> : </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"autoload"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"psr-4"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Doctrine\\Common\\Annotations\\"</span></span>: <span class="hljs-string"><span class="hljs-string">"lib/Doctrine/Common/Annotations"</span></span> } }</code> </pre> <br><p>  La comunidad JS podr√≠a hacer una asignaci√≥n similar en <code>package.json</code> si hubiera espacios de nombres en JS. </p><br><h1 id="identifikatory-zavisimostey-v-js">  Identificadores de dependencia JS </h1><br><p>  Arriba, indiqu√© que el Contenedor puede usar los nombres de los par√°metros de entrada del constructor o los tipos de par√°metros de entrada como identificadores.  El problema es que: </p><br><ol><li>  JS es un lenguaje con tipeo din√°mico y no permite especificar tipos al declarar una funci√≥n. </li><li>  JS usa minificadores que pueden cambiar el nombre de los par√°metros de entrada. </li></ol><br><p>  Los desarrolladores del contenedor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">awilix</a> DI sugieren usar el objeto como el √∫nico par√°metro de entrada para el constructor, y las propiedades de este objeto como dependencias: </p><br><pre> <code class="plaintext hljs">class UserController { constructor(opts) { this.userService = opts.userService } }</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El identificador de</a> propiedad del objeto en JS puede consistir en caracteres alfanum√©ricos, "_" y "$", y puede no comenzar con un d√≠gito. </p><br><p>  Como necesitaremos asignar identificadores de dependencia a la ruta de acceso a sus fuentes en el sistema de archivos para la carga autom√°tica, es mejor abandonar el uso de "$" y usar la experiencia de PHP.  Antes de que apareciera el operador de <code>namespace</code> en algunos marcos (por ejemplo, en Zend 1), se utilizaron los siguientes nombres para las clases: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zend_Config_Writer_Json</span></span></span><span class="hljs-class"> </span></span>{...}</code> </pre> <br><p>  Por lo tanto, podr√≠amos reflejar nuestra aplicaci√≥n de tres objetos ( <code>Application</code> , <code>Config</code> , <code>Service</code> ) en JS algo como esto: </p><br><pre> <code class="plaintext hljs">class Vendor_Project_Config { constructor() { } } class Vendor_Project_Service { constructor({Vendor_Project_Config}) { this.config = Vendor_Project_Config; } } class Vendor_Project_Application { constructor({Vendor_Project_Config, Vendor_Project_Service}) { this.config = Vendor_Project_Config; this.service = Vendor_Project_Service; } }</code> </pre> <br><p>  Si publicamos el c√≥digo de cada clase: </p><br><pre> <code class="plaintext hljs">export default class Vendor_Project_Application { constructor({Vendor_Project_Config, Vendor_Project_Service}) { this.config = Vendor_Project_Config; this.service = Vendor_Project_Service; } }</code> </pre> <br><p>  en su archivo dentro de nuestro m√≥dulo de proyecto: </p><br><ul><li> <code>./src/</code> <br> <ul><li> <code>./Application.js</code> </li> <li> <code>./Config.js</code> </li> <li> <code>./Service.js</code> </li> </ul></li></ul><br><p>  Luego podemos conectar el directorio ra√≠z del m√≥dulo con el "espacio de nombres" ra√≠z del m√≥dulo en la configuraci√≥n del Contenedor: </p><br><pre> <code class="plaintext hljs">const ns = "Vendor_Project"; const path = path.join(module_root, "src"); container.addSourceMapping(ns, path);</code> </pre> <br><p>  y luego, a partir de esta informaci√≥n, construya la ruta a las fuentes correspondientes ( <code>${module_root}/src/Config.js</code> ) en funci√≥n del identificador de dependencia ( <code>${module_root}/src/Config.js</code> ). </p><br><h1 id="es6-moduli">  M√≥dulos ES6 </h1><br><p>  ES6 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ofrece un</a> dise√±o general para cargar m√≥dulos ES6: </p><br><pre> <code class="plaintext hljs">import { something } from 'path/to/source/with/something';</code> </pre> <br><p>  Como necesitamos adjuntar un objeto (clase) a un archivo, tiene sentido en la fuente exportar esta clase de manera predeterminada: </p><br><pre> <code class="plaintext hljs">export default class Vendor_Project_Path_To_Source_With_Something {...}</code> </pre> <br><p>  En principio, es posible no escribir un nombre tan largo para la clase, solo <code>Something</code> funcionar√° tambi√©n, pero en Zend 1 escribieron y no se rompieron, y la unicidad del nombre de la clase dentro del proyecto afecta positivamente tanto las capacidades del IDE (autocompletar y las indicaciones contextuales), por lo que y al depurar: </p><br><p><img src="https://habrastorage.org/webt/qc/vj/wg/qcvjwg4lkvdwbg0nwcbmotantby.png" alt="imagen"></p><br><p>  Importar una clase y crear un objeto en este caso se ve as√≠: </p><br><pre> <code class="plaintext hljs">import Something from 'path/to/source/with/something'; const something = new Something();</code> </pre> <br><h1 id="front--back-import">  Importaci√≥n frontal y posterior </h1><br><p>  Importar funciona tanto en el navegador como en nodejs, pero hay matices.  Por ejemplo, el navegador no comprende la importaci√≥n de m√≥dulos nodejs: </p><br><pre> <code class="plaintext hljs">import path from "path";</code> </pre> <br><p>  Recibimos un error en el navegador: </p><br><pre> <code class="plaintext hljs">Failed to resolve module specifier "path". Relative references must start with either "/", "./", or "../".</code> </pre> <br><p>  Es decir, si queremos que nuestro c√≥digo funcione tanto en el navegador <strong>como en</strong> nodejs, no podemos usar construcciones que el navegador <strong>o</strong> nodejs no entiendan.  Me concentro espec√≠ficamente en esto, porque tal conclusi√≥n es demasiado natural para pensarlo.  C√≥mo respirar </p><br><h1 id="mesto-di-v-sovremennyh-web-prilozheniyah">  El lugar de DI en las aplicaciones web modernas </h1><br><p>  Esta es puramente mi opini√≥n personal, debido a mi experiencia personal, como todo lo dem√°s en esta publicaci√≥n. </p><br><p>  En las aplicaciones web, JS pr√°cticamente ocupa su lugar en la parte frontal, en el navegador, casi sin alternativa.  En el lado del servidor, Java, PHP, .Net, Ruby, Python, densamente excavados ... Pero con el advenimiento de nodejs, JavaScript tambi√©n penetr√≥ en el servidor.  Y las tecnolog√≠as utilizadas en otros idiomas, incluido DI, comenzaron a penetrar en JS del lado del servidor. </p><br><p>  El desarrollo de JavaScript se debe al comportamiento as√≠ncrono del c√≥digo en el navegador.  La asincron√≠a no es una caracter√≠stica excepcional de JS, sino m√°s bien innata.  Ahora, la presencia de JS tanto en el servidor como en el frente no sorprende a nadie, sino que alienta el uso de los mismos enfoques en ambos extremos de la aplicaci√≥n web.  Y el mismo c√≥digo.  Por supuesto, el anverso y el reverso son demasiado diferentes en esencia y en las tareas a resolver para usar el mismo c√≥digo tanto all√≠ como all√°.  Pero podemos suponer que en una aplicaci√≥n m√°s o menos compleja habr√° navegador, servidor y c√≥digo general. </p><br><p>  DI ya est√° en uso en la parte delantera, en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RequireJS</a> : </p><br><pre> <code class="plaintext hljs">define( ["./config", "./service"], function App(Config, Service) {} );</code> </pre> <br><p>  Es cierto que aqu√≠ los identificadores de dependencias se escriben expl√≠cita e inmediatamente en forma de enlaces a las fuentes (puede configurar la asignaci√≥n de identificadores en la configuraci√≥n del cargador de arranque). </p><br><p>  En las aplicaciones web modernas, la DI existe no solo en el lado del servidor, sino tambi√©n en el navegador. </p><br><h1 id="pri-chyom-tut-maykl-dzhekson">  ¬øQu√© tiene que ver Michael Jackson con eso? </h1><br><p>  Cuando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habilita el</a> soporte del m√≥dulo ES en nodejs (flag <code>--experimental-modules</code> ), el motor identifica el contenido de los archivos con la <code>*.mjs</code> como m√≥dulos EcmaScript (a diferencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de los m√≥dulos comunes</a> con la <code>*.cjs</code> ). </p><br><p>  Este enfoque a veces se llama la " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Soluci√≥n Michael Jackson</a> ", y los guiones se llaman Michael Jackson Scripts ( <code>*.mjs</code> ). </p><br><p>  Estoy de acuerdo en que la intriga del KDPV se resolvi√≥, pero ... el camon de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">los</a> muchachos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">, Michael Jackson ...</a> </p><br><h1 id="yet-another-di-implementation">  Otra implementaci√≥n m√°s de DI </h1><br><p>  Bueno, como se esperaba, el tuyo <del>  la bici </del>  M√≥dulo DI - <a href="">@ teqfw / di</a> </p><br><p>  Esta no es una soluci√≥n lista para luchar, sino una implementaci√≥n fundamental.  Todas las dependencias deben ser m√≥dulos ES y utilizar funciones comunes para el navegador y nodejs. </p><br><p>  Para resolver dependencias, el m√≥dulo utiliza el enfoque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">awilix</a> : </p><br><pre> <code class="plaintext hljs">constructor(spec) { /** @type {Vendor_Module_Config} */ const _config = spec.Vendor_Module_Config; /** @type {Vendor_Module_Service} */ const _service = spec.Vendor_Module_Service; }</code> </pre> <br><p>  Para ejecutar el ejemplo anterior: </p><br><pre> <code class="plaintext hljs">import Container from "./src/Container.mjs"; const container = new Container(); container.addSourceMapping("Vendor_Module", "../example"); container.get("Vendor_Module_App") .then((app) =&gt; { app.run(); });</code> </pre> <br><p>  en el servidor: </p><br><pre> <code class="plaintext hljs">$ node --experimental-modules main.mjs</code> </pre> <br><p>  Para ejecutar el ejemplo frontal ( <code>example.html</code> ): </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>DI in Browser<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./main.mjs"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Load main script './main.mjs', create new DI container, then get object by ID from container.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Open browser console to see output.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  debe colocar el m√≥dulo en el servidor y abrir la p√°gina <code>example.html</code> en el navegador (o usar las capacidades del IDE).  Si abre <code>example.html</code> directamente, entonces el error en Chrom es: </p><br><pre> <code class="plaintext hljs">Access to script at 'file:///home/alex/work/teqfw.di/main.mjs' from origin 'null' has been blocked by CORS policy: Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension, https.</code> </pre> <br><p>  Si todo sali√≥ bien, entonces en la consola (navegador o nodejs) habr√° algo como esto: </p><br><pre> <code class="plaintext hljs">Create object with ID 'Vendor_Module_App'. Create object with ID 'Vendor_Module_Config'. There is no dependency with id 'Vendor_Module_Config' yet. 'Vendor_Module_Config' instance is created. Create object with ID 'Vendor_Module_Service'. There is no dependency with id 'Vendor_Module_Service' yet. 'Vendor_Module_Service' instance is created (deps: [Vendor_Module_Config]). 'Vendor_Module_App' instance is created (deps: [Vendor_Module_Config, Vendor_Module_Service]). Application 'Vendor_Module_Config' is running.</code> </pre> <br><h1 id="rezyume">  Resumen </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AMD, CommonJS, UMD?</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ESM</a> ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/464347/">https://habr.com/ru/post/464347/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../464331/index.html">Beneficios in√∫tiles: s√≠ntesis de productos qu√≠micos absorbentes de UV a partir de anacardos</a></li>
<li><a href="../464333/index.html">Seguimiento del ciclo de vida de los usuarios sin alicates y cinta aislante.</a></li>
<li><a href="../464335/index.html">Pruebas unitarias en DBMS: c√≥mo lo hacemos en Sportmaster, primera parte</a></li>
<li><a href="../464337/index.html">C√≥mo omitir captcha: red neuronal en Tensorflow, Keras, python v captcha ruidosa num√©rica</a></li>
<li><a href="../464345/index.html">5 razones para abrir una startup de TI en Alemania</a></li>
<li><a href="../464351/index.html">C√°maras IP PoE, requisitos especiales y funcionamiento sin problemas: uniendo todo</a></li>
<li><a href="../464353/index.html">1C: ERP VS 1C: KA 2.0. ¬øQu√© deber√≠an elegir los fabricantes de alimentos?</a></li>
<li><a href="../464355/index.html">C√≥mo se representa un marco en Shadow Fight 3</a></li>
<li><a href="../464357/index.html">Blockchain aleatorio RSA</a></li>
<li><a href="../464359/index.html">Caracter√≠sticas de probar aplicaciones web m√≥viles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>