<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¨ üçπ üë©üèø‚Äçüé§ Mit Golang Microservices in The Economist erstellen: Eine Retrospektive üôèüèª üë©üèº‚Äç‚úàÔ∏è üéÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Bereits am 28. Mai starten wir die erste Gruppe beim Golang Developer Kurs. Und heute teilen wir Ihnen die erste Ver√∂ffentlichung mi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mit Golang Microservices in The Economist erstellen: Eine Retrospektive</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/451760/">  Hallo allerseits!  Bereits am 28. Mai starten wir die erste Gruppe beim <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Golang Developer</a> Kurs.  Und heute teilen wir Ihnen die erste Ver√∂ffentlichung mit, die dem Start dieses Kurses gewidmet ist.  Lass uns gehen. <br><br><img src="https://habrastorage.org/webt/3r/wa/jy/3rwajyps3se5vmahtiv_ioninq0.png"><br><br>  <b>Schl√ºsselausz√ºge</b> <br><br><ul><li>  Der Economist brauchte mehr Flexibilit√§t, um Inhalte auf einen immer vielf√§ltiger werdenden digitalen Kanal zu verteilen.  Um dieses Ziel zu erreichen und ein hohes Ma√ü an Leistung und Zuverl√§ssigkeit aufrechtzuerhalten, hat sich die Plattform von einer monolithischen zu einer Microservice-Architektur entwickelt. </li><li>  In Go geschriebene Tools waren eine Schl√ºsselkomponente des neuen Systems, mit dem The Economist skalierbare, leistungsstarke Services bereitstellen und schnell neue Produkte erstellen konnte. </li><li>  Go, das auf Parallelit√§t und API-Unterst√ºtzung abzielte, sowie die Erstellung einer statischen kompilierten Sprache erm√∂glichten die Entwicklung verteilter Ereignisverarbeitungssysteme, die skaliert werden konnten.  Testunterst√ºtzung war auch ein Plus. </li><li>  Im Allgemeinen war die Teamerfahrung von The Economist mit Go positiv, und dies war einer der entscheidenden Faktoren f√ºr die Skalierung der Content-Plattform. </li><li>  Go wird nicht immer ein geeignetes Werkzeug sein, und das ist normal.  Der Economist hat eine polyglotte Plattform und verwendet verschiedene Sprachen, wo es Sinn macht. </li></ul><a name="habracut"></a><br>  Ich bin als Drupal-Entwickler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zum</a> Entwicklungsteam von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">The Economist gekommen</a> .  Meine eigentliche Aufgabe bestand jedoch darin, an einem Projekt teilzunehmen, das die Technologie zur Bereitstellung von Inhalten des √ñkonomen grundlegend ver√§ndern w√ºrde.  In den ersten Monaten habe ich Go studiert, mehrere Monate mit einem externen Berater zusammengearbeitet, um ein MVP (Minimum Viable Product) zu erstellen, und bin dann erneut dem Team beigetreten, um deren Eintauchen in Go zu √ºberwachen. <br>  Dieser technologische Wandel wurde durch die Mission von The Economist ausgel√∂st, das digitale Publikum zu erweitern, da sich der Nachrichtenverbrauch von den Printmedien abwandte.  Der Economist brauchte mehr Flexibilit√§t, um Inhalte f√ºr immer vielf√§ltigere digitale Kan√§le bereitzustellen.  Um dieses Ziel zu erreichen und ein hohes Ma√ü an Leistung und Zuverl√§ssigkeit aufrechtzuerhalten, hat sich die Plattform von einer monolithischen zu einer Microservice-Architektur entwickelt.  In Go geschriebene Tools waren eine Schl√ºsselkomponente des neuen Systems, mit dem The Economist skalierbare, leistungsstarke Services bereitstellen und schnell neue Produkte erstellen konnte. <br><br>  Implementierung von Go in The Economist: <br><br><ul><li>  Erm√∂glicht Ingenieuren die schnelle Entwicklung und Implementierung neuer Funktionen. </li><li>  Zugelassene Best Practices f√ºr schnell ausfallende Services mit intelligenter Fehlerbehandlung. </li><li>  Zuverl√§ssige Unterst√ºtzung f√ºr Parallelit√§t und Netzwerkbetrieb in einem verteilten System. </li><li>  Es zeigte einen Mangel an Reife und Unterst√ºtzung in einigen Bereichen, die f√ºr Inhalte und Medien ben√∂tigt werden. </li><li>  Erm√∂glicht eine Plattform, die f√ºr das digitale Publizieren skaliert werden kann. </li></ul><br>  <b>Warum hat sich The Economist f√ºr Go entschieden?</b> <br><br>  Um diese Frage zu beantworten, ist es hilfreich, die Gesamtarchitektur der neuen Plattform hervorzuheben.  Die als Content Platform bezeichnete Plattform ist ein Ereignisbehandlungssystem.  Es reagiert auf Ereignisse von verschiedenen Plattformen zur Erstellung von Inhalten und startet eine Reihe von Prozessen, die in separat funktionierenden Microservices ausgef√ºhrt werden.  Diese Dienste f√ºhren Funktionen wie das Standardisieren von Daten, das Analysieren semantischer Tags, das Indizieren in ElasticSearch und das Senden von Inhalten an externe Plattformen wie Apple News oder Facebook aus.  Die Plattform verf√ºgt au√üerdem √ºber eine RESTful-API, die in Kombination mit GraphQL der wichtigste Einstiegspunkt f√ºr Front-End-Clients und -Produkte ist. <br><br>  Bei der Entwicklung einer gemeinsamen Architektur untersuchte das Team, welche Sprachen f√ºr die Plattform geeignet sind.  Go wurde mit Python, Ruby, Node, PHP und Java verglichen.  W√§hrend jede Sprache ihre eigenen St√§rken hat, eignet sich Go am besten f√ºr die Plattformarchitektur.  Go, das auf Parallelit√§t und API-Unterst√ºtzung abzielte, sowie die Erstellung einer statischen kompilierten Sprache erm√∂glichten die Entwicklung verteilter Ereignisverarbeitungssysteme, die skaliert werden konnten.  Dar√ºber hinaus machte es die relativ einfache Syntax von Go einfach, sich an der Entwicklung zu beteiligen und mit dem Schreiben von Arbeitscode zu beginnen, was einem Team, das sich in einem so gro√üen technologischen Wandel befindet, unmittelbare Vorteile versprach.  Im Allgemeinen wurde festgestellt, dass Go die Sprache ist, die f√ºr Benutzerfreundlichkeit und Effizienz in einem verteilten Cloud-System am besten geeignet ist. <br><br>  <b>Drei Jahre sp√§ter: Passte Go zu diesen ehrgeizigen Zielen?</b> <br><br>  Einige Plattformdesignelemente waren gut auf die Go-Sprache abgestimmt.  Das schnelle Scheitern war ein kritischer Teil des Systems, da es aus verteilten unabh√§ngigen Diensten bestand.  In √úbereinstimmung mit den Prinzipien der Zw√∂lf-Faktoren-App ("12-Faktor-Anwendung") musste die Anwendung schnell ausgef√ºhrt werden und schnell fehlschlagen (schnell fehlschlagen).  Das Design von Go als statische, kompilierte Sprache bietet schnelle Startzeiten, und die Compilerleistung wird st√§ndig verbessert und war nie ein Problem f√ºr Design oder Bereitstellung.  Dar√ºber hinaus erm√∂glichte das Fehlerbehandlungsdesign von Go, dass Anwendungen nicht nur schneller, sondern auch intelligenter ausfielen. <br><br>  <b>Fehlerbehandlung</b> <br><br>  Eine Funktion, die Ingenieure in Go schnell bemerken, ist, dass es sich eher um einen Fehler vom Typ Fehler als um ein Ausnahmesystem handelt.  In Go sind alle Fehler Werte.  Der Fehlertyp ist vordefiniert und eine Schnittstelle.  Eine Schnittstelle in Go ist im Wesentlichen eine benannte Sammlung von Methoden, und jeder andere Benutzertyp kann eine Schnittstelle erf√ºllen, wenn sie √ºber dieselben Methoden verf√ºgt.  Der Fehlertyp ist eine Schnittstelle, die sich selbst als Zeichenfolge beschreiben kann. <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> error <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Error() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> }</code> </pre> <br>  Dies gibt den Ingenieuren mehr Kontrolle und Funktionalit√§t bei der Fehlerbehandlung.  Durch Hinzuf√ºgen einer Fehlermethode, die eine Zeichenfolge in einem beliebigen Benutzermodul zur√ºckgibt, k√∂nnen Sie eigene Fehler erstellen und diese generieren, z. B. mithilfe der folgenden neuen Funktion, die aus dem Fehlerpaket stammt. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> errorString <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { s <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e *errorString)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> es }</code> </pre> <br>  Was bedeutet das in der Praxis?  In Go erlauben Funktionen mehrere R√ºckgabewerte. Wenn Ihre Funktion also m√∂glicherweise nicht funktioniert, gibt sie h√∂chstwahrscheinlich einen Fehlerwert zur√ºck.  Die Sprache fordert Sie dazu auf, explizit nach Fehlern zu suchen, wo sie auftreten (im Gegensatz zum Ausl√∂sen und Abfangen einer Ausnahme). Daher sollte Ihr Code normalerweise die Pr√ºfung ‚Äûif err!  = Null. "  Diese h√§ufige Fehlerbehandlung mag zun√§chst eint√∂nig erscheinen.  Mit Fehler als Wert k√∂nnen Sie jedoch Fehler verwenden, um die Fehlerbehandlung zu vereinfachen.  In einem verteilten System k√∂nnen Sie beispielsweise problemlos Versuche implementieren, Abfragen erneut zu versuchen, indem Sie Fehler einschlie√üen. <br><br>  Netzwerkprobleme treten immer im System auf, unabh√§ngig davon, ob Daten an andere interne Dienste gesendet oder an Tools von Drittanbietern √ºbertragen werden.  Dieses Beispiel f√ºr ein Netzpaket zeigt, wie Sie den Fehler als Typ verwenden k√∂nnen, um tempor√§re Netzwerkfehler von permanenten Fehlern zu unterscheiden.  Das Economist-Team verwendete einen √§hnlichen Fehler-Wrapper, um inkrementelle Wiederholungsversuche beim Senden von Inhalten an externe APIs zu erstellen. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> net <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Error <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { error Timeout() <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-comment"><span class="hljs-comment">// Is the error a timeout? Temporary() bool // Is the error temporary? } if nerr, ok := err.(net.Error); ok &amp;&amp; nerr.Temporary() { time.Sleep(1e9) continue } if err != nil { log.Fatal(err) }</span></span></code> </pre> <br>  Go-Autoren glauben, dass nicht alle Ausnahmen au√üergew√∂hnlich sind.  Ingenieure k√∂nnen Fehler eher intelligent beheben als die Anwendung zum Absturz bringen.  Dar√ºber hinaus k√∂nnen Sie mit der Go-Fehlerbehandlung Fehler besser kontrollieren, wodurch Aspekte wie das Debuggen oder die Benutzerfreundlichkeit von Fehlern verbessert werden k√∂nnen.  Innerhalb der Content Platform erm√∂glichte dieses Designmerkmal von Go Entwicklern, fundierte Entscheidungen in Bezug auf Fehler zu treffen, was zu einer Erh√∂hung der Zuverl√§ssigkeit des Gesamtsystems f√ºhrte. <br><br>  <b>Datenkonsistenz</b> <br><br>  Datenkonsistenz ist ein kritischer Faktor in der Content Platform.  Bei The Economist bilden Inhalte die Grundlage des Gesch√§fts. Ziel der Inhaltsplattform ist es, sicherzustellen, dass Inhalte einmal ver√∂ffentlicht werden k√∂nnen und √ºberall verf√ºgbar sind.  Daher ist es wichtig, dass jedes Produkt und jeder Verbraucher Datenkonsistenz mit der Content Platform-API aufweist.  Produkte verwenden GraphQL haupts√§chlich f√ºr API-Anforderungen, f√ºr die ein statisches Schema erforderlich ist, das als eine Art Vertrag zwischen Verbrauchern und der Plattform dient.  Von der Plattform verarbeitete Inhalte m√ºssen mit diesem Schema √ºbereinstimmen.  Die statische Sprache half bei der Implementierung und machte es einfach, Datenkonsistenz zu erreichen. <br><br>  <b>Testen mit Go</b> <br><br>  Ein weiteres Merkmal, das die Konsistenz f√∂rdert, ist die Go-Testsuite.  Die schnelle Kompilierungszeit von Go in Kombination mit erstklassigen Tests als Merkmal der Sprache erm√∂glichte es dem Team, effektive Testmethoden in Entwurfsworkflows und schnelle Fehler in Baugruppen zu implementieren.  Die Testtools von Go erleichtern das Einrichten und Ausf√ºhren.  Wenn Sie "go test" ausf√ºhren, werden alle Tests im aktuellen Verzeichnis ausgef√ºhrt, und der Testbefehl verf√ºgt √ºber mehrere n√ºtzliche Flags.  Das Cover-Flag bietet einen detaillierten Code-Coverage-Bericht.  Der Bench-Test f√ºhrt Benchmark-Tests durch, die durch Ausf√ºhren des Namens der Testfunktion mit dem Wort "Bench" anstelle von "Test" angezeigt werden.  Die TestMain-Funktion bietet Methoden f√ºr zus√§tzliche Testkonfigurationen, z. B. einen Dummy-Authentifizierungsserver. <br><br>  Dar√ºber hinaus kann Go tabellarische Tests mit anonymen Strukturen und Stubs mit Schnittstellen erstellen, um die Testabdeckung zu verbessern.  Obwohl das Testen in Bezug auf Sprachfunktionen nicht neu ist, macht es Go einfach, robuste Tests zu erstellen und diese einfach in Workflows zu integrieren.  Von Anfang an konnten die Economist-Ingenieure Tests als Teil der Assembly-Pipelines ohne spezielle Konfiguration ausf√ºhren und sogar Git Hooks hinzuf√ºgen, um Tests auszuf√ºhren, bevor Code in Github √ºbertragen wurde. <br><br>  Das Projekt war jedoch nicht ohne Aufwand, um Datenkonsistenz zu erreichen.  Das erste gro√üe Problem f√ºr die Plattform war die Verwaltung dynamischer Inhalte aus unvorhersehbaren Backends.  Die Plattform verwendet Inhalte von den urspr√ºnglichen CMS-Systemen haupts√§chlich √ºber JSON-Endpunkte, bei denen die Struktur und die Datentypen nicht garantiert sind.  Dies bedeutete, dass die Plattform das Standard-Go-Paket nicht zur Interpretation von json verwenden kann, das die JSON-Deserialisierung in Strukturen unterst√ºtzt. Es ert√∂nt jedoch ein Alarm, wenn die Typen der Struktur- und Eingabedatenfelder nicht √ºbereinstimmen. <br><br>  Um dieses Problem zu l√∂sen, war eine spezielle Methode erforderlich, um den Serverteil dem Standardformat zuzuordnen.  Nach mehreren Iterationen des gew√§hlten Ansatzes f√ºhrte das Team einen eigenen Deserialisierungsprozess ein.  Obwohl dieser Ansatz ein bisschen wie die √úberarbeitung eines Standardbibliothekspakets war, gab er den Ingenieuren die vollst√§ndige Kontrolle √ºber die Verarbeitung der Quelldaten. <br><br>  <b>Netzwerkunterst√ºtzung</b> <br><br>  Die Skalierbarkeit stand bei der neuen Plattform im Vordergrund, und dies wurde durch Standard-Go-Bibliotheken f√ºr Netzwerke und APIs bereitgestellt.  In Go k√∂nnen Sie schnell skalierbare HTTP-Endpunkte implementieren, ohne dass Frameworks erforderlich sind.  Im folgenden Beispiel wird das Standardbibliothekspaket net / http verwendet, um einen Handler zu konfigurieren, der einen Anforderungs- und Antwortschreiber akzeptiert.  Bei der ersten Implementierung der Content Platform-API wurde das API-Framework verwendet.  Es wurde schlie√ülich durch eine Standardbibliothek ersetzt, da das Team anerkannte, dass es alle Netzwerkanforderungen ohne zus√§tzliche unn√∂tige Kompromisse erf√ºllt.  Golang HTTP-Handler skalieren, da jede Anforderung an den Handler in Goroutine, einem kompakten Thread ohne Anpassung, parallel ausgef√ºhrt wird. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, handler) log.Fatal(http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) }</code> </pre> <br>  <b>Parallelit√§tsmodell</b> <br><br>  Das Go-Parallelit√§tsmodell bietet mehrere Vorteile bei der Verbesserung der Leistung auf der gesamten Plattform.  Bei der Arbeit mit verteilten Daten m√ºssen die den Verbrauchern versprochenen Garantien eingehalten werden.  Nach dem CAP-Theorem ist es nicht m√∂glich, mehr als zwei der folgenden drei Garantien gleichzeitig bereitzustellen: Datenkonsistenz.  Verf√ºgbarkeit  Best√§ndig gegen Trennung.  In der Economist-Plattform wurde letztendlich die Konsistenz √ºbernommen, was bedeutet, dass das Lesen aus Datenquellen letztendlich konsistent ist und moderate Verz√∂gerungen bei allen Datenquellen, die einen konsistenten Zustand erreichen, akzeptabel sind.  Eine M√∂glichkeit, diese L√ºcke zu minimieren, ist die Verwendung von Goroutinen. <br><br>  Goroutinen sind einfache Threads, die von der Go-Laufzeit verwaltet werden, um zu verhindern, dass ihnen die Threads ausgehen.  Goroutinen erm√∂glichten die Optimierung asynchroner Aufgaben auf der Plattform.  Eines der Datenrepositorys der Plattform ist beispielsweise Elasticsearch.  Wenn Inhalte auf dem System aktualisiert werden, werden Inhalte, die auf dieses Element in Elasticsearch verweisen, aktualisiert und neu indiziert.  Dank der Implementierung von Goroutines konnte die Verarbeitungszeit verk√ºrzt werden, was eine schnelle Konsistenz der Elemente sicherstellte.  Dieses Beispiel zeigt, wie Elemente, die f√ºr die Wiederaufbereitung geeignet sind, in Goroutine wiederaufbereitet werden. <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reprocess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(searchResult *http.Response)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { responses := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>([]response, <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(searchResult.Hits)) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wg sync.WaitGroup wg.Add(<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(responses)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, hit := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> searchResult.Hits { wg.Add(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, item elastic.SearchHit)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> wg.Done() code, err := reprocessItem(item) responses[i].code = code responses[i].err = err }(i, *hit) } wg.Wait <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.StatusOK, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  Das Entwerfen von Systemen ist mehr als nur Programmieren.  Ingenieure m√ºssen verstehen, welche Werkzeuge wo und wann geeignet sind.  W√§hrend Go ein leistungsstarkes Tool f√ºr die meisten Anforderungen der Content Platform von The Economist war, erforderten einige Einschr√§nkungen andere L√∂sungen. <br><br>  <b>Abh√§ngigkeitsmanagement</b> <br><br>  Als Go gerade ver√∂ffentlicht wurde, gab es kein Abh√§ngigkeitsverwaltungssystem.  Innerhalb der Community wurden verschiedene Tools entwickelt, um diesen Bedarf zu decken.  Der Economist verwendete Git-Submodule, was zu einer Zeit sinnvoll war, als die Community aktiv ein Standard-Tool f√ºr das Abh√§ngigkeitsmanagement bewarb.  Obwohl die Community einem koh√§renten Ansatz f√ºr das Abh√§ngigkeitsmanagement bereits viel n√§her ist, ist sie heute nicht mehr da.  Der The Economist-Ansatz mit Submodulen stellte keine ernsthaften Probleme dar, war jedoch f√ºr andere Go-Entwickler schwierig, und dies sollte bei der Umstellung auf Go ber√ºcksichtigt werden. <br><br>  Es gab auch Plattformanforderungen, f√ºr die Go-Funktionen oder -Design nicht die beste L√∂sung waren.  Da die Plattform die Audioverarbeitung unterst√ºtzte, waren die Tools von Go zum Extrahieren von Metadaten zu diesem Zeitpunkt begrenzt. Daher entschied sich das Team stattdessen f√ºr Exiftool Python.  Plattformdienste arbeiten in Docker-Containern, mit denen Exiftool installiert und √ºber die Go-Anwendung gestartet werden konnte. <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runExif</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { cmdOut, err := exec.Command(<span class="hljs-string"><span class="hljs-string">"exiftool"</span></span>, args...).Output() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmdOut, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  Ein weiteres h√§ufiges Szenario f√ºr die Plattform ist der Empfang von nicht funktionierendem HTML-Code aus den CMS-Quellsystemen, die Analyse des HTML-Codes auf Richtigkeit und die Bereinigung des HTML-Codes.  Urspr√ºnglich wurde Go f√ºr diesen Prozess verwendet. Da jedoch f√ºr die Standard-HTML-Bibliothek von Go korrektes HTML erforderlich ist, war vor der Verarbeitung eine gro√üe Menge an benutzerdefiniertem Code erforderlich, um HTML zu analysieren.  Dieser Code wurde schnell fragil und verfehlte Grenzf√§lle, sodass eine neue L√∂sung in Javascript implementiert wurde.  Javascript bietet gro√üe Flexibilit√§t und Anpassungsf√§higkeit, um den Prozess der √úberpr√ºfung und Bereinigung von HTML zu steuern. <br><br>  Javascript war auch eine h√§ufige Wahl zum Filtern und Weiterleiten von Ereignissen in der Plattform.  Ereignisse werden mithilfe von AWS Lambdas gefiltert. Hierbei handelt es sich um einfache Funktionen, die nur beim Aufruf ausgef√ºhrt werden.  Ein Anwendungsfall ist das Filtern von Ereignissen in verschiedenen B√§ndern, z. B. schnell und langsam.  Diese Filterung basiert auf einem einzelnen Metadatenfeld im JSON-Objekt der Event-Handler-Shell.  Die Filterimplementierung verwendete ein JSON-Javascript-Zeigerpaket, um ein Element in einem JSON-Objekt zu erfassen.  Dieser Ansatz war viel effizienter als das vollst√§ndige Zerlegen des JSON, das Go ben√∂tigen w√ºrde.  W√§hrend Funktionen dieses Typs mit Go erreicht werden konnten, war die Verwendung von Javascript f√ºr Ingenieure einfacher und lieferte einfachere Lambdas. <br><br>  <b>R√ºckblick Go</b> <br><br>  Wenn ich nach der Implementierung der Kontaktplattform und deren Unterst√ºtzung in der Produktion eine Retrospektive von Go und der Inhaltsplattform durchf√ºhren w√ºrde, w√§re mein Feedback wie folgt: <br><br>  Was ist schon gut <br><br><ul><li>  Schl√ºsselelemente des Sprachdesigns f√ºr verteilte Systeme. </li><li>  Ein Parallelit√§tsmodell, das relativ einfach zu implementieren ist. </li><li>  Sch√∂ne Codierung und lustige Community. </li></ul><br>  Was kann verbessert werden? <br><br><ul><li>  Weitere Weiterentwicklung der Standards f√ºr Versionskontrolle und Verkauf. </li><li>  In einigen Bereichen nicht gen√ºgend Reife. </li><li>  Details f√ºr bestimmte Benutzerf√§lle. </li></ul><br>  Im Allgemeinen war es eine positive Erfahrung, und Go ist eines der wichtigsten Elemente, mit denen die Content-Plattform skaliert werden konnte.  Go wird nicht immer ein geeignetes Werkzeug sein, und das ist normal.  Der Economist hat eine polyglotte Plattform und verwendet verschiedene Sprachen, wo es Sinn macht.  Go wird wahrscheinlich nie die beste Wahl sein, wenn Sie mit Textobjekten und dynamischem Inhalt herumspielen m√ºssen, sodass sich Javascript immer noch in der Toolbox befindet.  Die St√§rken von Go sind jedoch die Grundlage, auf der das System skalieren und wachsen kann. <br>  Ber√ºcksichtigen Sie bei der √úberlegung, ob Go f√ºr Sie geeignet ist, die wichtigsten Aspekte des Systemdesigns: <br><br><ul><li>  Was sind die Aufgaben Ihres Systems? </li><li>  Welche Garantien bieten Sie Ihren Verbrauchern? </li><li>  Welche Architektur und Muster sind f√ºr Ihr System geeignet? </li><li>  Wie soll Ihr System skalieren? </li></ul><br>  Wenn Sie ein System entwickeln, das die Herausforderungen verteilter Daten, asynchroner Workflows sowie hoher Leistung und Skalierbarkeit bew√§ltigt, empfehlen wir Ihnen, Go und seine Funktionen zur Beschleunigung Ihrer Systemziele in Betracht zu ziehen. <br><br>  Freunde, wir warten auf Ihre Kommentare und laden alle zu dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offenen Webinar ein</a> , das am 16. vom leitenden Entwickler bei Yandex abgehalten wird. In Kombination ist unser Lehrer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dmitry Smal</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de451760/">https://habr.com/ru/post/de451760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de451748/index.html">√úberwachen des SSD-Status in Qsan-Arrays</a></li>
<li><a href="../de451750/index.html">Buch "Elasticsearch, Kibana, Logstash und Suchmaschinen der n√§chsten Generation"</a></li>
<li><a href="../de451752/index.html">30. Jahrestag der grassierenden Unsicherheit</a></li>
<li><a href="../de451754/index.html">Wie wir Lambda-Ausdr√ºcke in IntelliJ IDEA finden</a></li>
<li><a href="../de451758/index.html">Zus√§tzliche Uplinks in der Intel C620-Systemlogikarchitektur</a></li>
<li><a href="../de451766/index.html">Heisenbug 2019 Piter: Was wird in der kostenlosen Sendung passieren und was nur auf der Veranstaltung</a></li>
<li><a href="../de451768/index.html">Verbesserung der Arbeit von Wi-Fi. Allgemeine Grunds√§tze und n√ºtzliche Dinge</a></li>
<li><a href="../de451770/index.html">Veeam Backup & Replication: N√ºtzliche Tipps, um Backups und Replikate funktionsf√§hig zu machen</a></li>
<li><a href="../de451772/index.html">Was ist das Besondere an Cloudera und wie man es kocht</a></li>
<li><a href="../de451776/index.html">Wie programmiere ich Rollenspiel-Engines in Google Sheets?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>