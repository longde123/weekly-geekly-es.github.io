<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ê üë®üèª‚Äçüç≥ üîì Toute la v√©rit√© sur RTOS. Article # 30. Proc√©dures d'initialisation et de d√©marrage de Nucleus SE üë®üèæ‚Äçüé§ üëáüèø üëçüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tout syst√®me d'exploitation poss√®de un m√©canisme de d√©marrage sp√©cifique. Le principe de fonctionnement de ce m√©canisme pour chaque syst√®me est diff√©r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toute la v√©rit√© sur RTOS. Article # 30. Proc√©dures d'initialisation et de d√©marrage de Nucleus SE</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460617/"><img src="https://habrastorage.org/webt/nr/me/cz/nrmeczn3tg-kdwyme6qgmd7ily4.jpeg"><br><br>  Tout syst√®me d'exploitation poss√®de un m√©canisme de d√©marrage sp√©cifique.  Le principe de fonctionnement de ce m√©canisme pour chaque syst√®me est diff√©rent.  Habituellement, ils disent que le syst√®me d√©marre (Eng. Boot), il s'agit d'une abr√©viation de "bootstrap", qui se r√©f√®re √† l'expression "tirer soi-m√™me sur une cl√¥ture par ses bootstraps" (pour franchir la cl√¥ture, se tirer par les sangles des chaussures), qui d√©crit grossi√®rement comment le syst√®me passe ind√©pendamment d'un √©tat dans lequel la m√©moire est pleine de vide ( <i>note du traducteur: si absolument pr√©cis, alors ordure</i> ) √† l'ex√©cution stable du programme.  Traditionnellement, une petite partie du programme est charg√©e en m√©moire; elle peut √™tre stock√©e dans la ROM.  Dans le pass√©, il pouvait √™tre saisi √† l'aide des commutateurs situ√©s √† l'avant de l'ordinateur.  Ce chargeur de d√©marrage lit un programme de d√©marrage plus complexe qui a d√©j√† charg√© le syst√®me d'exploitation.  Aujourd'hui, l'ordinateur de bureau d√©marre comme suit: le code BIOS recherche les p√©riph√©riques (disques durs, CD-ROM, cl√©s USB) √† partir desquels vous pouvez d√©marrer, puis le syst√®me d'exploitation d√©marre. <br><br>  Le syst√®me d'exploitation pour les syst√®mes embarqu√©s peut √©galement √™tre initialis√© de la m√™me mani√®re.  Et en fait, les syst√®mes d'exploitation embarqu√©s d√©velopp√©s sur la base des syst√®mes d'exploitation de bureau sont charg√©s.  Mais dans la plupart des RTOS "classiques", une m√©thode beaucoup plus simple (et donc plus rapide) est utilis√©e. <br><a name="habracut"></a><br>  Le syst√®me d'exploitation fait partie du logiciel.  Si ce logiciel est d√©j√† en m√©moire (par exemple, sous une forme ou une autre de ROM), il vous suffit de vous assurer que la s√©quence de commandes CPU apr√®s la r√©initialisation se termine avec l'ex√©cution du code d'initialisation du syst√®me d'exploitation.  C'est ainsi que la plupart des RTOS fonctionnent, y compris Nucleus SE ( <i>note du traducteur: cela s'applique √©galement √† notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS MAX</a></i> ). <br><br>  La plupart des outils de d√©veloppement de logiciels int√©gr√©s incluent le code de d√©marrage n√©cessaire pour g√©rer la r√©initialisation du processeur et transf√©rer le contr√¥le √† la fonction Point d'entr√©e dans la fonction <b>main ()</b> .  Le code redistribuable Nucleus SE ne traite pas ce processus, car il doit √™tre aussi portable que possible.  Au lieu de cela, il contient la fonction <b>main ()</b> , qui prend le contr√¥le du CPU et initialise et d√©marre le syst√®me d'exploitation.  Cette fonctionnalit√© sera discut√©e en d√©tail ci-dessous. <br><br><div class="spoiler">  <b class="spoiler_title">Articles pr√©c√©dents de la s√©rie:</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 29.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Interruptions dans Nucleus SE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 28.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Minuteries logicielles</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 27.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Heure syst√®me</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 26.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Canaux: services auxiliaires et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 25.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Canaux de donn√©es: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 24.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Files d'attente: services auxiliaires et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 23.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Files d'attente: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 22.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bo√Ætes aux lettres: services auxiliaires et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bo√Ætes aux lettres: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S√©maphores: services auxiliaires et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S√©maphores: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Groupes d'indicateurs d'√©v√©nements: services d'assistance et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Groupes de drapeaux d'√©v√©nements: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Signaux</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partitions de m√©moire: services et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sections de m√©moire: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structures de donn√©es de t√¢che et appels d'API non pris en charge</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Services pour travailler avec des t√¢ches</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢ches: configuration et introduction √† l'API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler: fonctionnalit√©s avanc√©es et pr√©servation du contexte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler: impl√©mentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleus SE: conception interne et d√©ploiement</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleus SE: Introduction</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Autres services RTOS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Interaction et synchronisation des t√¢ches</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢ches, changement de contexte et interruptions</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢ches et planification</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS: Structure et mode temps r√©el</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS: introduction.</a> <br></div></div><br><h3>  Initialisation de la m√©moire </h3><br>  Les d√©clarations de toutes les variables statiques dans le code Nucleus SE commencent par le pr√©fixe <b>ROM</b> ou <b>RAM</b> pour indiquer o√π elles doivent √™tre situ√©es.  Ces deux directives <b>#define</b> sont d√©finies dans le fichier <b>nuse_types.h</b> et doivent √™tre configur√©es en tenant compte des sp√©cificit√©s de l'ensemble d'outils de d√©veloppement utilis√© (compilateur et √©diteur de liens).  En r√®gle g√©n√©rale, la <b>ROM</b> doit √™tre de type <b>const</b> ( <i>note du traducteur: d'apr√®s mon exp√©rience, <b>const</b> n'est pas toujours suffisant, <b>statique</b> est meilleur</i> ), et <b>RAM</b> est une valeur vide. <br><br>  Toutes <b>les</b> variables <b>ROM</b> sont initialis√©es statiquement, ce qui est logique.  <b>Les</b> variables <b>RAM</b> ne sont pas initialis√©es statiquement (car cela ne fonctionne qu'avec certaines bo√Ætes √† outils configur√©es pour copier automatiquement de la ROM vers la RAM);  un code d'initialisation explicite est inclus dans l'application et sera d√©crit en d√©tail ci-dessous. <br><br>  Nucleus SE ne stocke pas de donn√©es ¬´constantes¬ª dans la RAM, qui est g√©n√©ralement insuffisante dans les petits syst√®mes.  Au lieu d'utiliser des structures de donn√©es complexes pour d√©crire les objets du noyau, des ensembles de tables (tableaux) sont utilis√©s, qui sont facilement plac√©s dans la ROM ou la RAM, selon les besoins. <br><br><h2>  Fonction Main () </h2><br>  Voici le code complet de la fonction <b>main ()</b> de Nucleus SE: <br><br><pre><code class="plaintext hljs">void main(void) { NUSE_Init(); /* initialize kernel data */ /* user initialization code here */ NUSE_Scheduler(); /* start tasks */ }</code> </pre> <br>  La s√©quence des op√©rations est assez simple: <br><br><ul><li>  Tout d'abord, la fonction <b>NUSE_Init ()</b> est <b>appel√©e</b> .  Il initialise toutes les structures de donn√©es Nucleus SE et sera d√©crit en d√©tail ci-dessous. </li><li>  L'utilisateur peut ensuite ins√©rer tout code d'initialisation d'application qui sera ex√©cut√© avant le d√©marrage du planificateur de t√¢ches.  Pour plus d'informations sur ce qui peut √™tre r√©alis√© avec ce code, voir plus loin dans cet article. </li><li>  Enfin, le planificateur Nucleus SE ( <b>NUSE_Scheduler ()</b> ) d√©marre.  Cela sera √©galement discut√© en d√©tail plus loin dans cet article. </li></ul><br><h2>  Fonction NUSE_Init () </h2><br>  Cette fonction initialise toutes les variables du noyau Nucleus SE et les structures de donn√©es. <br><br><div class="spoiler">  <b class="spoiler_title">Voici le code de fonction complet:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">void NUSE_Init(void) { U8 index; /* global data */ NUSE_Task_Active = 0; NUSE_Task_State = NUSE_STARTUP_CONTEXT; #if NUSE_SYSTEM_TIME_SUPPORT NUSE_Tick_Clock = 0; #endif #if NUSE_SCHEDULER_TYPE == NUSE_TIME_SLICE_SCHEDULER NUSE_Time_Slice_Ticks = NUSE_TIME_SLICE_TICKS; #endif /* tasks */ #if ((NUSE_SCHEDULER_TYPE != NUSE_RUN_TO_COMPLETION_SCHEDULER) || NUSE_SIGNAL_SUPPORT || NUSE_TASK_SLEEP || NUSE_SUSPEND_ENABLE || NUSE_SCHEDULE_COUNT_SUPPORT) for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { NUSE_Init_Task(index); } #endif /* partition pools */ #if NUSE_PARTITION_POOL_NUMBER != 0 for (index=0; index&lt;NUSE_PARTITION_POOL_NUMBER; index++) { NUSE_Init_Partition_Pool(index); } #endif /* mailboxes */ #if NUSE_MAILBOX_NUMBER != 0 for (index=0; index&lt;NUSE_MAILBOX_NUMBER; index++) { NUSE_Init_Mailbox(index); } #endif /* queues */ #if NUSE_QUEUE_NUMBER != 0 for (index=0; index&lt;NUSE_QUEUE_NUMBER; index++) { NUSE_Init_Queue(index); } #endif /* pipes */ #if NUSE_PIPE_NUMBER != 0 for (index=0; index&lt;NUSE_PIPE_NUMBER; index++) { NUSE_Init_Pipe(index); } #endif /* semaphores */ #if NUSE_SEMAPHORE_NUMBER != 0 for (index=0; index&lt;NUSE_SEMAPHORE_NUMBER; index++) { NUSE_Init_Semaphore(index); } #endif /* event groups */ #if NUSE_EVENT_GROUP_NUMBER != 0 for (index=0; index&lt;NUSE_EVENT_GROUP_NUMBER; index++) { NUSE_Init_Event_Group(index); } #endif /* timers */ #if NUSE_TIMER_NUMBER != 0 for (index=0; index&lt;NUSE_TIMER_NUMBER; index++) { NUSE_Init_Timer(index); } #endif }</code> </pre><br></div></div><br>  Tout d'abord, les variables globales sont initialis√©es: <br><ul><li>  <b>NUSE_Task_Active</b> - index de la t√¢che active, initialis√© √† z√©ro;  plus tard, cela peut changer le planificateur. </li><li>  <b>NUSE_Task_State</b> - initialis√© avec la valeur <b>NUSE_STARTUP_CONTEXT</b> , ce qui limite la fonctionnalit√© de l'API pour tout code d'initialisation d'application ult√©rieur. </li><li>  Si la prise en charge de l'heure syst√®me est activ√©e, <b>NUSE_Tick_Clock est d√©fini</b> sur z√©ro. </li><li>  Si le planificateur de tranche horaire est activ√©, <b>NUSE_Time_Slice_Ticks</b> re√ßoit la valeur configur√©e <b>NUSE_TIME_SLICE_TICKS</b> . </li></ul><br>  Ensuite, les fonctions sont appel√©es pour initialiser les objets du noyau: <br><br><ul><li>  <b>NUSE_Init_Task ()</b> est appel√©e pour initialiser les structures de donn√©es de chaque t√¢che.  Cet appel n'est ignor√© que si le planificateur Run to Completion est utilis√© et que les signaux, la pause de t√¢che et le compteur de planification ne sont pas configur√©s (car cette combinaison de fonctions entra√Ænera l'absence de ces structures de t√¢ches dans la RAM, par cons√©quent, l'initialisation ne sera pas effectu√©e). </li><li>  <b>NUSE_Init_Partition_Pool ()</b> est appel√©e pour initialiser chaque objet de pool de partitions.  Ces appels sont ignor√©s si aucun pool de partitions n'est configur√©. </li><li>  <b>NUSE_Init_Mailbox ()</b> est appel√©e pour initialiser chaque objet de bo√Æte aux lettres.  Ces appels sont ignor√©s s'il n'y a pas de bo√Ætes aux lettres configur√©es. </li><li>  <b>NUSE_Init_Queue ()</b> est appel√©e pour initialiser chaque objet de file d'attente.  Ces appels sont ignor√©s si aucune file d'attente n'est configur√©e. </li><li>  <b>NUSE_Init_Pipe ()</b> est appel√© pour initialiser chaque objet de canal.  Ces appels sont ignor√©s si aucun canal n'est configur√©. </li><li>  <b>NUSE_Init_Semaphore ()</b> est appel√© pour initialiser chaque objet s√©maphore.  Ces appels sont ignor√©s si aucun s√©maphores n'est configur√©. </li><li>  <b>NUSE_Init_Event_Group ()</b> est appel√© pour initialiser chaque objet de groupe d'√©v√©nements.  Ces appels sont ignor√©s s'il n'y a aucun groupe d'√©v√©nements configur√©. </li><li>  <b>NUSE_Init_Timer ()</b> est appel√© pour initialiser chaque objet timer.  Ces appels sont ignor√©s si aucun temporisateur n'est configur√©. </li></ul><br><h3>  Initialisation de la t√¢che </h3><br><div class="spoiler">  <b class="spoiler_title">Voici le code complet de la fonction NUSE_Init_Task ():</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">void NUSE_Init_Task(NUSE_TASK task) { #if NUSE_SCHEDULER_TYPE != NUSE_RUN_TO_COMPLETION_SCHEDULER NUSE_Task_Context[task][15] = /* SR */ NUSE_STATUS_REGISTER; NUSE_Task_Context[task][16] = /* PC */ NUSE_Task_Start_Address[task]; NUSE_Task_Context[task][17] = /* SP */ (U32 *)NUSE_Task_Stack_Base[task] + NUSE_Task_Stack_Size[task]; #endif #if NUSE_SIGNAL_SUPPORT || NUSE_INCLUDE_EVERYTHING NUSE_Task_Signal_Flags[task] = 0; #endif #if NUSE_TASK_SLEEP || NUSE_INCLUDE_EVERYTHING NUSE_Task_Timeout_Counter[task] = 0; #endif #if NUSE_SUSPEND_ENABLE || NUSE_INCLUDE_EVERYTHING #if NUSE_INITIAL_TASK_STATE_SUPPORT || NUSE_INCLUDE_EVERYTHING NUSE_Task_Status[task] = NUSE_Task_Initial_State[task]; #else NUSE_Task_Status[task] = NUSE_READY; #endif #endif #if NUSE_SCHEDULE_COUNT_SUPPORT || NUSE_INCLUDE_EVERYTHING NUSE_Task_Schedule_Count[task] = 0; #endif }</code> </pre><br></div></div><br>  Si le planificateur Run to Completion n'a pas √©t√© configur√©, le bloc de contexte pour la <b>t√¢che NUSE_Task_Context [task] [] est</b> initialis√©.  La plupart des √©l√©ments ne sont pas affect√©s de valeurs, car ils repr√©sentent des registres de machine communs, qui devraient avoir une valeur interm√©diaire lors du d√©marrage d'une t√¢che.  Dans l'exemple (Freescale ColdFire) de l'impl√©mentation de Nucleus SE (mais pour les autres processeurs, le m√©canisme sera similaire), les trois derni√®res entr√©es sont d√©finies explicitement: <br><br><ul><li>  <b>NUSE_Task_Context [t√¢che] [15]</b> contient le registre d'√©tat ( <b>SR</b> , registre d'√©tat) et a la valeur de la directive <b>#define NUSE_STATUS_REGISTER</b> . </li><li>  <b>NUSE_Task_Context [t√¢che] [16]</b> contient le compteur de programme ( <b>PC</b> , compteur de programme) et a la valeur d'adresse du point d'entr√©e du code de t√¢che: <b>NUSE_Task_Start_Address [t√¢che]</b> . </li><li>  <b>NUSE_Task_Context [t√¢che] [17]</b> contient le pointeur de pile ( <b>SP</b> , pointeur de pile) et est initialis√© avec la valeur calcul√©e comme la somme de l'adresse de la pile de t√¢ches ( <b>NUSE_Task_Stack_Base [t√¢che]</b> ) et la taille de la pile de t√¢ches ( <b>NUSE_Task_Stack_Size [t√¢che]</b> ). </li></ul><br>  Si la prise en charge du signal est activ√©e, les indicateurs de signal de t√¢che ( <b>NUSE_Task_Signal_Flags [t√¢che]</b> ) sont mis √† z√©ro. <br><br>  Si la suspension de t√¢che est activ√©e (c'est-√†-dire l'appel de service API <b>NUSE_Task_Sleep ()</b> ), le compteur de d√©lai d'expiration de t√¢che ( <b>NUSE_Task_Timeout_Counter [t√¢che]</b> ) est d√©fini sur z√©ro. <br><br>  Si l'√©tat de suspension de t√¢che est activ√©, l'√©tat de la t√¢che ( <b>NUSE_Task_Status [t√¢che]</b> ) est initialis√©.  Cette valeur initiale est d√©finie par l'utilisateur (dans <b>NUSE_Task_Initial_State [t√¢che]</b> ) si la prise en charge de l'√©tat initial de la t√¢che est activ√©e.  Sinon, l'√©tat est affect√© √† <b>NUSE_READY</b> . <br><br>  Si le compteur de planification est activ√©, le compteur de t√¢ches ( <b>NUSE_Task_Schedule_Count [t√¢che]</b> ) est mis √† z√©ro. <br><br><h3>  Initialisation des pools de partitions </h3><br>  Voici le code complet de la fonction <b>NUSE_Init_Partition_Pool ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Partition_Pool(NUSE_PARTITION_POOL pool) { NUSE_Partition_Pool_Partition_Used[pool] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Partition_Pool_Blocking_Count[pool] = 0; #endif }</code> </pre><br>  Le compteur du pool de partitions "utilis√©" ( <b>NUSE_Partition_Pool__Partition_Used [pool]</b> ) est d√©fini sur z√©ro. <br><br>  Si le verrouillage des t√¢ches est activ√©, le compteur de t√¢ches bloqu√©es des pools de partitions ( <b>NUSE_Partition_Pool_Blocking_Count [pool]) est d√©fini</b> sur z√©ro. <br><br><h3>  Initialisation des bo√Ætes aux lettres </h3><br>  Ci-dessous, le <b>code</b> complet <b>NUSE_Init_Mailbox ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Mailbox(NUSE_MAILBOX mailbox) { NUSE_Mailbox_Data[mailbox] = 0; NUSE_Mailbox_Status[mailbox] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Mailbox_Blocking_Count[mailbox] = 0; #endif }</code> </pre><br>  La <b>banque de</b> donn√©es de bo√Æte aux lettres ( <b>NUSE_Mailbox_Data [bo√Æte aux lettres]</b> ) est d√©finie sur z√©ro et l'√©tat ( <b>NUSE_Mailbox_Status [bo√Æte aux lettres]</b> ) devient "inutilis√©" (c'est-√†-dire z√©ro). <br><br>  Si le verrouillage des t√¢ches est activ√©, le compteur des t√¢ches de bo√Æte aux lettres bloqu√©es ( <b>NUSE_Mailbox_Blocking_Count [bo√Æte aux lettres]</b> ) est d√©fini sur z√©ro. <br><br><h3>  Initialisation de la file d'attente </h3><br>  Voici le code complet de la fonction <b>NUSE_Init_Queue ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Queue(NUSE_QUEUE queue) { NUSE_Queue_Head[queue] = 0; NUSE_Queue_Tail[queue] = 0; NUSE_Queue_Items[queue] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Queue_Blocking_Count[queue] = 0; #endif }</code> </pre><br>  Les pointeurs vers le d√©but et la fin de la file d'attente (en fait, ce sont les index <b>NUSE_Queue_Head [queue</b> ] et <b>NUSE_Queue_Tail [file d'attente)</b> ) re√ßoivent des valeurs qui indiquent le d√©but de la zone de donn√©es des files d'attente (c'est-√†-dire qu'ils prennent une valeur nulle).  Le compteur dans la file d'attente ( <b>NUSE_Queue_Items [file d'attente]</b> ) est √©galement mis √† z√©ro. <br><br>  Si le verrouillage des t√¢ches est activ√©, le compteur des t√¢ches de file d'attente bloqu√©es ( <b>NUSE_Queue_Blocking_Count [file d'attente)</b> ) est mis √† z√©ro. <br><br><h3>  Initialisation de canal </h3><br>  Voici le code complet de la fonction <b>NUSE_Init_Pipe ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Pipe(NUSE_PIPE pipe) { NUSE_Pipe_Head[pipe] = 0; NUSE_Pipe_Tail[pipe] = 0; NUSE_Pipe_Items[pipe] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Pipe_Blocking_Count[pipe] = 0; #endif }</code> </pre><br>  Les pointeurs vers le d√©but et la fin du canal (en fait, ce sont les index - <b>NUSE_Pipe_Head [pipe]</b> et <b>NUSE_Pipe_Tail [pipe]</b> ) re√ßoivent une valeur qui indique le d√©but de la zone de donn√©es du canal (c'est-√†-dire qu'ils prennent une valeur nulle).  Le <b>compteur de</b> canaux ( <b>NUSE_Pipe_Items [pipe]</b> ) est √©galement d√©fini sur z√©ro. <br><br>  Si le verrouillage des t√¢ches est activ√©, le compteur de t√¢ches bloqu√©es du canal ( <b>NUSE_Pipe_Blocking_Count [pipe]</b> ) est d√©fini sur z√©ro. <br><br><h3>  Initialisation du s√©maphore </h3><br>  Voici le code complet de la fonction <b>NUSE_Init_Semaphore ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Semaphore(NUSE_SEMAPHORE semaphore) { NUSE_Semaphore_Counter[semaphore] = NUSE_Semaphore_Initial_Value[semaphore]; #if NUSE_BLOCKING_ENABLE NUSE_Semaphore_Blocking_Count[semaphore] = 0; #endif }</code> </pre><br>  Le compteur de s√©maphore ( <b>NUSE_Semaphore_Counter [s√©maphore]</b> ) est initialis√© avec la valeur d√©finie par l'utilisateur ( <b>NUSE_Semaphore_Initial_Value [s√©maphore]</b> ). <br><br>  Si le verrouillage de t√¢che est activ√©, le compteur de t√¢ches de s√©maphore verrouill√© ( <b>NUSE_Semaphore_Blocking_Count [s√©maphore]</b> ) est d√©fini sur z√©ro. <br><br><h3>  Initialisation des groupes d'√©v√©nements </h3><br>  Voici le code complet de la fonction <b>NUSE_Init_Event_Group ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Event_Group(NUSE_EVENT_GROUP group) { NUSE_Event_Group_Data[group] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Event_Group_Blocking_Count[group] = 0; #endif }</code> </pre><br>  Les drapeaux du groupe d'√©v√©nements sont r√©initialis√©s, c'est-√†-dire  <b>NUSE_Event_Group_Data [group]</b> re√ßoit une valeur nulle. <br><br>  Si le verrouillage des t√¢ches est activ√©, le compteur de t√¢ches bloqu√©es du groupe d'indicateurs d'√©v√©nements ( <b>NUSE_Event_Group_Blocking_Count [groupe]</b> ) est d√©fini sur z√©ro. <br><br><h3>  Initialisation de la minuterie </h3><br>  Ci-dessous, le code complet de <b>NUSE_Init_Timer ()</b> ; <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Timer(NUSE_TIMER timer) { NUSE_Timer_Status[timer] = FALSE; NUSE_Timer_Value[timer] = NUSE_Timer_Initial_Time[timer]; NUSE_Timer_Expirations_Counter[timer] = 0; }</code> </pre><br>  L'√©tat du temporisateur ( <b>NUSE_Timer_Status [timer]</b> ) est r√©gl√© sur "inutilis√©", c'est-√†-dire  <b>FAUX</b> <br><br>  La valeur du compte √† rebours ( <b>NUSE_Timer_Value [timer</b> ]) est initialis√©e par la valeur d√©finie par l'utilisateur ( <b>NUSE_Timer_Initial_Time [timer]</b> ). <br><br>  Le compteur d'ach√®vement ( <b>NUSE_Timer_Expirations_Counter [timer]</b> ) est mis √† z√©ro. <br><br><h2>  Initialisation du code d'application </h2><br>  Une fois les structures de donn√©es Nucleus SE initialis√©es, il devient possible d'ex√©cuter le code responsable de l'initialisation de l'application avant de d√©marrer la t√¢che.  Cette fonctionnalit√© peut √™tre utile pour les t√¢ches suivantes: <br><br><ul><li>  Initialisation des structures de donn√©es d'application.  Le remplissage explicite des structures de donn√©es est plus facile √† comprendre et √† d√©boguer que l'initialisation automatique des variables statiques. </li><li>  Affectation des objets du noyau.  √âtant donn√© que tous les objets du noyau sont cr√©√©s statiquement au stade de la construction et sont identifi√©s √† l'aide de valeurs d'index, il peut √™tre utile d'attribuer un ¬´propri√©taire¬ª ou de d√©terminer l'utilisation de ces objets.  Cela peut √™tre fait √† l'aide de la directive #define, cependant, s'il existe plusieurs instances de t√¢ches, il est pr√©f√©rable d'affecter des index d'objets via des tableaux globaux (index√©s par ID de t√¢che). </li><li>  Initialisation de l'appareil.  Cela peut √™tre utile pour l'installation initiale des p√©riph√©riques. </li></ul><br>  √âvidemment, bon nombre de ces objectifs peuvent √™tre atteints avant l'initialisation de Nucleus SE, mais l'avantage de l'emplacement du code d'application ici est que vous pouvez d√©sormais utiliser les services du noyau (appels d'API).  Par exemple, une file d'attente ou une bo√Æte aux lettres peut √™tre pr√©remplie avec des donn√©es qui devront √™tre trait√©es au d√©marrage de la t√¢che. <br><br>  Les appels d'API ont une restriction: toutes les actions qui conduisent g√©n√©ralement √† l'activation du planificateur sont interdites (par exemple, suspendre / bloquer des t√¢ches).  La variable globale <b>NUSE_Task_State a</b> √©t√© d√©finie sur <b>NUSE_STARTUP_CONTEXT</b> pour <b>indiquer</b> cette limitation. <br><br><h2>  Lancer le planificateur </h2><br>  Une fois l'initialisation termin√©e, il ne reste plus qu'√† ex√©cuter le planificateur pour commencer √† ex√©cuter le code d'application - t√¢ches.  La configuration de l'ordonnanceur et le travail de divers types d'ordonnanceurs ont √©t√© d√©crits en d√©tail dans l'un des articles pr√©c√©dents ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="># 9</a> ), donc seul un bref r√©sum√© est requis ici. <br>  La s√©quence des √©tapes cl√©s est la suivante: <br><br><ul><li>  <b>D√©finition de la</b> variable globale <b>NUSE_Task_State sur</b> <b>NUSE_TASK_CONTEXT</b> . </li><li>  S√©lectionnez l'index de la premi√®re t√¢che √† ex√©cuter.  Si la prise en charge de la t√¢che initiale est activ√©e, la recherche de la premi√®re t√¢che termin√©e est effectu√©e, sinon, une valeur nulle est utilis√©e. </li><li>  L'ordonnanceur est <b>appel√©</b> - <b>NUSE_Scheduler ()</b> . </li></ul><br>  Ce qui se passe exactement √† la derni√®re √©tape d√©pend du planificateur s√©lectionn√©.  Lorsque vous utilisez le planificateur Run to Completion, un cycle de planification d√©marre et les t√¢ches sont appel√©es s√©quentiellement.  Lorsque vous utilisez d'autres planificateurs, le contexte de la premi√®re t√¢che est charg√© et le contr√¥le est transf√©r√© √† la t√¢che. <br><br>  L'article suivant traite des diagnostics et de la v√©rification des erreurs. <br><br>  <b>√Ä propos de l'auteur:</b> Colin Walls travaille dans l'industrie √©lectronique depuis plus de trente ans, consacrant la majeure partie de son temps au micrologiciel.  Il est maintenant ing√©nieur firmware chez Mentor Embedded (une division de Mentor Graphics).  Colin Walls intervient souvent lors de conf√©rences et s√©minaires, auteur de nombreux articles techniques et de deux livres sur le firmware.  Vit au Royaume-Uni.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Blog</a> professionnel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de Colin</a> , e-mail: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460617/">https://habr.com/ru/post/fr460617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460603/index.html">V2G. Les voitures √©lectriques aideront √† √©quilibrer la production et la consommation d'√©lectricit√©</a></li>
<li><a href="../fr460605/index.html">Studio photo automatique, partie 1</a></li>
<li><a href="../fr460607/index.html">App Store de s√©curit√© offensive avec des outils de piratage d'Android</a></li>
<li><a href="../fr460611/index.html">Basculement: le perfectionnisme nous ruine et ... la paresse</a></li>
<li><a href="../fr460615/index.html">Dans le sillage d'Industrial Ninja: comment PLC a √©t√© pirat√© lors de Positive Hack Days 9</a></li>
<li><a href="../fr460621/index.html">Tic Tac Toe Partie 4: Interaction avec le backend Flask en utilisant HTTP</a></li>
<li><a href="../fr460623/index.html">√Ä propos de la torture de Julian Assange</a></li>
<li><a href="../fr460625/index.html">Comme je n'ai pas pris la premi√®re place dans la comp√©tition pour les d√©veloppeurs JavaScript de Telegram</a></li>
<li><a href="../fr460627/index.html">vGPU - l'utilisation ne peut pas √™tre ignor√©e</a></li>
<li><a href="../fr460629/index.html">La probabilit√© que 2 mineurs aient le m√™me monde</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>