<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∏üèª üë©üèª‚Äçü§ù‚Äçüë®üèæ üßìüèº B√©nissez Nouveau, ou √† propos de mon tourment avec Nvidia Optimus. Partie 1. La beaut√© de la documentation Arch üîù üì® üè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avant de commencer 
 Avant de commencer l'histoire principale, je voudrais clarifier quelques points. L'article s'adresse principalement aux propri√©ta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>B√©nissez Nouveau, ou √† propos de mon tourment avec Nvidia Optimus. Partie 1. La beaut√© de la documentation Arch</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414061/"><h2>  Avant de commencer </h2><br>  Avant de commencer l'histoire principale, je voudrais clarifier quelques points.  L'article s'adresse principalement aux propri√©taires d'ordinateurs portables dot√©s de la technologie Nvidia Optimus qui souhaitent installer GNU / Linux (ci-apr√®s Linux).  Le mat√©riel vise √† faire en sorte que l'Asie centrale susmentionn√©e se familiarise avec les solutions possibles au probl√®me et √† faciliter et acc√©l√©rer sa r√©solution.  De plus, l'article n'est pas moins <b>motivant</b> et vise √† comprendre une v√©rit√© simple par les gens: sous Linux, comme dans la vie, il y a toujours une solution de contournement, et si vous abandonnez, ce ne sera pas <i>(dans la plupart des cas)</i> meilleur. <br><blockquote>  <b><i>Qui quaerit, reperit</i></b> </blockquote>  <i>- proverbe latin</i> <br><br><h3>  Pr√©face </h3><br>  Pour le moment, j'√©tais un Linuxoid ordinaire.  J'ai test√© diff√©rentes distributions, j'ai lentement appris de nouvelles choses.  Juste parce que j'√©tais int√©ress√©.  En r√®gle g√©n√©rale, la ¬´connaissance¬ª √©tait limit√©e √† Ubuntu et ses fourches, ainsi qu'√† Fedora et √† quelques distributions ¬´conviviales¬ª.  Mais, comme le dit un autre proverbe latin, omnia fluunt, omnia mutantur, c'est-√†-dire que tout coule, tout change, et il est clair que cela ne pourrait pas durer √©ternellement. <br><br><h3>  Tout a bien commenc√© </h3><br>  Il convient de noter que je n'avais pas beaucoup d'espace pour les exp√©riences: un PC <i>relativement</i> faible qui tirait √† peine GNOME 3 et un Internet lent, ce qui compliquait consid√©rablement la situation globale.  Mais alors plus pour le gar√ßon de 12 ans et ce n'√©tait pas n√©cessaire.  Au final, j'en ai marre d'exp√©rimenter, j'ai install√© Windows 10 et oubli√© Linux pendant quelques ann√©es. <br><br>  Le temps a pass√© et apr√®s environ 2 ans, j'ai r√©alis√© qu'il √©tait temps de mettre √† jour mon <s>morceau de fer</s> PC <s>moussu et</s> j'ai commenc√© √† √©conomiser de l'argent.  Quelque chose venait de la vente de leurs affaires, ils donnaient quelque chose, plus de la moiti√© du montant a √©t√© jet√© par les parents, j'ai m√™me d√ª me <s>sacrifier</s> pour vendre ma Xbox (!) <a name="habracut"></a>  pour amuser votre FAQ pour augmenter vos comp√©tences Linux.  Cette fois, j'ai d√©cid√© d'essayer d'installer Arch.  J'ai entendu dire qu'il avait une tr√®s bonne documentation.  Et il a commenc√©. <br><br><h3>  La beaut√© de la documentation Arch </h3><br>  L'installation a √©t√© rapide et <i>relativement</i> indolore.  Encore une fois, gr√¢ce √† la documentation.  Apr√®s avoir install√© le syst√®me et DE repr√©sent√© par KDE Plasma, j'ai essay√© de connecter l'ordinateur portable √† mon moniteur externe, car le moniteur a une diagonale de 24 'et l'√©cran du portable n'est que de 15,6'.  Il ne s'est rien pass√©, il n'y avait aucun signal sur le moniteur.  Comme toujours, j'ai commenc√© √† googler.  Et apr√®s 30 minutes de recherche, j'ai trouv√© que le probl√®me √©tait avec la technologie Nvidia Optimus. <br><br><h4>  Un peu sur Nvidia Optimus </h4><br>  Nvidia est une bonne entreprise.  Au cours de leurs 25 ans d'histoire, ils ont mis en ≈ìuvre de nombreuses solutions <i>relativement</i> bonnes.  Nvidia Optimus en est un.  Le sujet est une technologie hybride pour assurer le bon fonctionnement de deux cartes graphiques (g√©n√©ralement des graphiques Nvidia puissants et Intel int√©gr√©) sur les ordinateurs portables.  S'il <s>fonctionne</s> correctement <s>sous Windows</s> , il permet d'√©conomiser l'√©nergie et les ressources de l'ordinateur portable.  Tout cela est excellent, mais ce qui m'a pouss√© √† √©crire cet opus, c'est que cette belle technologie sous Linux, selon les d√©veloppeurs, ne fonctionne que <i>partiellement</i> , et √† mon avis cela prend beaucoup, beaucoup de nerfs, de temps et d'efforts pour la configurer. <br><br><h3>  La beaut√© de la documentation Arch (suite) </h3><br>  Apr√®s avoir d√©couvert la v√©ritable racine du probl√®me, j'√©tais d'abord content d'avoir d√©termin√© ¬´o√π le chien est enterr√©¬ª (seule la carte Nvidia avait une sortie HDMI), et ma premi√®re √©tape a √©t√© de lire la documentation officielle d'Arch.  Son essence √©tait d'utiliser Xorg.conf et .xinitrc pour forcer X √† n'utiliser que la carte Nvidia.  Apr√®s avoir termin√© ces √©tapes et red√©marr√© ... un √©cran noir est apparu.  La documentation indique que dans ce cas, il est n√©cessaire de v√©rifier s'il y a des esperluettes dans .xinitrc et, s'il n'y en a pas, d'utiliser la "Configuration alternative", qui a oblig√© X √† n'utiliser qu'une carte Intel.  Cela ne me convenait pas, car la carte Intel √©tait d√©j√† utilis√©e par d√©faut et cette option ne me convenait pas.  Il y avait √©galement des options pour divers DM.  Ils ne convenaient pas non plus, car aucun d'entre eux ne pouvait d√©marrer le serveur X pour diverses raisons. <br>  D√©crire chacun d'eux s√©par√©ment serait un exercice tr√®s long et d√©nu√© de sens. <br><br><h3>  Qui quaerit, reperit </h3><br>  Cette expression traduite du latin signifie ¬´qui cherche, trouve¬ª.  Ce n'est pas en vain que je l'ai plac√© au d√©but, car pour moi cette expression deviendra la morale id√©ale pour cet article. <br><br>  J'√©tais d√©sesp√©r√©.  Pendant deux jours, j'ai essay√© en vain de trouver une solution, j'ai √©cum√© les forums √©trangers (uniquement sur eux, car dans le LOR orthodoxe, la r√©ponse √©tait la suivante: vous ne pouvez en aucun cas d√©marrer X via Nvidia. C'est impossible, r√©conciliez).  Mais encore, un matin nuageux du troisi√®me jour de recherches, je suis tomb√© sur un fil (lien au sous-sol) sur le forum de d√©veloppement Nvidia, dans lequel il a √©t√© d√©crit comment Nvidia Optimus est impl√©ment√© dans Arch sur les ordinateurs portables Dell.  J'ai imm√©diatement r√©alis√© - je suis sauv√©!  En suivant les √©tapes, j'ai red√©marr√© et ... un √©cran noir.  Bien s√ªr, j'√©tais boulevers√©, mais je me suis souvenu: je ne me suis pas inscrit dans la ligne .xinitrc pour ex√©cuter DE.  Apr√®s avoir √©crit exec startkde, j'ai red√©marr√© √† nouveau et cela a fonctionn√©.  X a d√©marr√© via Nvidia.  Il m'a fallu quatre longs jours pour installer et configurer Arch, et pourtant je l'ai fait! <br><br><h3>  D√©briefing </h3><br>  Analysons maintenant les instructions du fil ci-dessus.  Commen√ßons: <br><br>  Tout d'abord, vous devez activer le support KMS (Kernel Mode Setting, la m√©thode de d√©finition de la r√©solution directement dans le noyau) en ajoutant aux param√®tres du noyau (fichier / etc / default / grub) dans la ligne GRUB_CMDLINE_LINUX_DEFAULT = param√®tre <br><br><pre><code class="bash hljs">nvidia-drm.modeset=1</code> </pre> <br>  Ensuite, nous cr√©ons un script pour le DM (gestionnaire de connexion).  Consid√©rez l'option avec LightDM.  Nous cr√©ons le script /etc/lightdm/display_setup.sh avec le contenu suivant: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh xrandr --setprovideroutputsource modesetting NVIDIA-0 xrandr --auto</span></span></code> </pre> <br>  Avec ce script, nous sp√©cifions le fournisseur et d√©finissons la r√©solution d'√©cran maximale possible. <br><br>  Rendons le script cr√©√© ex√©cutable: <br><br><pre> <code class="bash hljs">chmod +x /etc/lightdm/display_setup.sh</code> </pre> <br>  Laissez LightDM ex√©cuter le script ci-dessus au d√©marrage.  Tout d'abord, modifiez /etc/lightdm/lightdm.conf: <br><br><pre> <code class="bash hljs">nano /etc/lightdm/lightdm.conf</code> </pre> <br>  Entrez le param√®tre <br><br><pre> <code class="bash hljs">display-setup-script=/etc/lightdm/display_setup.sh</code> </pre> <br>  Vous pouvez voir les instructions pour SDDM dans le fil que j'ai d√©j√† mentionn√©, des liens dans le sous-sol. <br><br>  Maintenant, nous devons mettre √† jour le microcode du processeur (plus d'informations sur le microcode √† partir des liens dans le sous-sol): <br><br><pre> <code class="bash hljs">sudo pacman -S intel-ucode</code> </pre> <br>  Apr√®s avoir mis √† jour le microcode, installez un tas de packages de Nvidia: <br><br><pre> <code class="bash hljs">sudo pacman -S lib32-mesa-demos mesa-demos libva-vdpau-driver nvidia nvidia-libgl lib32-nvidia-utils nvidia-settings lib32-opencl-nvidia</code> </pre> <br><blockquote>  <b>Remarque:</b> certains packages peuvent ne pas √™tre disponibles.  Dans ce cas, installez tout s√©par√©ment.  Ignorez les packages qui ne seront pas disponibles. </blockquote>  Activez le d√©mon nvidia.persistenced, qui est responsable de la persistance (en savoir plus √† ce sujet dans le lien de sous-sol) du pilote Nvidia: <br><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> nvidia-persistenced.service</code> </pre> <br>  Configurer automatiquement GRUB: <br><br><pre> <code class="bash hljs">sudo grub-mkconfig -o /boot/grub/grub.cfg</code> </pre> <br>  Cr√©ez un disque RAM amor√ßable: <br><br><pre> <code class="bash hljs">mkinitcpio -p linux</code> </pre> <br>  V√©rifiez .xinitrc: <br><br><pre> <code class="bash hljs">nano ~/.xinitrc</code> </pre> <br>  S'il n'est pas entr√©, entrez <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> gnome-session</code> </pre> <br>  pour GNOME et <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> startkde</code> </pre> <br>  pour KDE Plasma. <br><br>  Red√©marrer: <br><br><pre> <code class="bash hljs">reboot</code> </pre> <br>  Apr√®s avoir red√©marr√© l'ordinateur portable, connectez-vous √† l'aide de votre compte et profitez du monde d'Arch. <br><br><h3>  √Ä propos de Bumblebee et PRIME </h3><br>  Vous avez peut-√™tre remarqu√© que je n'ai rien dit sur les ¬´b√©quilles¬ª qui visent √† assurer le <u>bon</u> fonctionnement de Nvidia Optimus sur Linux: Bumblebee et PRIME. <br>  De plus, je n'ai obtenu qu'une carte Nvidia avec un pilote propri√©taire, Nouveau n'a pas fonctionn√© (c'est pourquoi l'article s'appelle ¬´Bless Nouveau¬ª. <br>  Quant √† mon exp√©rience personnelle avec eux, il est petit et d√©plorable: les deux b√©quilles √† bout portant n'ont pas vu ma carte graphique Nvidia.  Si vous √™tes int√©ress√© par eux, au sous-sol, vous trouverez des liens vers des documents sur eux. <br><br><h2>  Postface </h2><br>  Si vous lisez l'int√©gralit√© de l'article, vous √™tes un h√©ros <i>(enfin, ou un mod√©rateur)</i> . <br><br>  Lors de la r√©daction d'un article, j'ai essay√© de le diluer pour vous <i>avec</i> des blagues <i>relativement</i> dr√¥les afin de justifier en quelque sorte l'absence d'images.  J'esp√®re que vous avez atteint le zen apr√®s avoir lu. <br><br><h3>  Liste des sources </h3><br>  √Ä propos du microcode: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en.wikipedia.org/wiki/</a> Microcode <br>  √Ä propos de Bumblebee: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki.archlinux.org/index.php/Bumblebee_</a> (russe) <br>  √Ä propos de PRIME: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki.archlinux.org/index.php/PRIME</a> <br>  Fil: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">devtalk.nvidia.com/default/topic/1027679/linux/optimus-support-for-arch-linux-for-dell-i7559-dual-graphics-intel-nvidia-gtx-960m-laptop-/2</a> <br>  √Ä propos de la persistance: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en.wikipedia.org/wiki/Persistency</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414061/">https://habr.com/ru/post/fr414061/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414049/index.html">Les principaux jeux de l'E3 2018: Fallout 76, Metro Exodus, Doom Eternal et autres</a></li>
<li><a href="../fr414053/index.html">5 id√©es fausses sur le RGPD</a></li>
<li><a href="../fr414055/index.html">Trans-PRK: l'une des normes de correction de la vision</a></li>
<li><a href="../fr414057/index.html">Refroidissement du centre de donn√©es: un chant de glace et de feu</a></li>
<li><a href="../fr414059/index.html">Le pourcentage de mariage parmi les lampes LED. Une s√©lection de 27 000 lampes vendues</a></li>
<li><a href="../fr414063/index.html">Commandant du matin</a></li>
<li><a href="../fr414065/index.html">Le meilleur smartphone chinois "jusqu'√† 10 mille roubles" avec AliExpress vs Xiaomi Redmi 5</a></li>
<li><a href="../fr414067/index.html">Lancez le reciblage mobile avec Adjust: param√®tres, rapports et liens</a></li>
<li><a href="../fr414069/index.html">Restrictions sur le drone pendant la Coupe du Monde de la FIFA 2018 (FIFA 2018)</a></li>
<li><a href="../fr414071/index.html">De la surveillance √† la gestion des incidents. Rapport du Meetup DevOps Moscou</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>