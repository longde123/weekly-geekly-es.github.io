<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüè´ ‚óªÔ∏è üßïüèº Mise en ≈ìuvre typique de la surveillance. Nikolay Sivko üòÇ üóØÔ∏è ‚úäüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D√©codage du rapport ¬´Mise en ≈ìuvre type du suivi¬ª par Nikolay Sivko. 


 Je m'appelle Nikolai Sivko. Je fais aussi du monitoring. Okmeter est la surve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mise en ≈ìuvre typique de la surveillance. Nikolay Sivko</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473728/"><p>  D√©codage du rapport ¬´Mise en ≈ìuvre type du suivi¬ª par Nikolay Sivko. </p><br><p>  Je m'appelle Nikolai Sivko.  Je fais aussi du monitoring.  Okmeter est la surveillance que je fais.  J'ai d√©cid√© que je sauverais tout le monde de l'enfer de la surveillance et nous sauverions quelqu'un de cette souffrance.  J'essaie toujours de ne pas annoncer d'okm√®tre dans mes pr√©sentations.  Naturellement, les photos seront de l√†.  Mais l'id√©e de ce que je veux dire est que nous faisons de la surveillance une approche l√©g√®rement diff√©rente de ce que tout le monde fait habituellement.  Nous en parlons beaucoup.  Lorsque nous essayons de convaincre chaque individu en cela, il devient finalement convaincu.  Je veux parler de notre approche pr√©cis√©ment pour que si vous faites le suivi vous-m√™me, pour √©viter notre r√¢teau. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/btKYOueAAzc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/za/jq/fi/zajqfi-zfkopot4qxgmw79zgnp8.png"></p><br><p>  √Ä propos de l'Okmeter en bref.  Nous faisons la m√™me chose que vous, mais il y a toutes sortes de puces.  Chips: </p><br><ul><li>  d√©tailler; </li><li>  un grand nombre de d√©clencheurs pr√©configur√©s bas√©s sur les probl√®mes de nos clients; </li><li>  Configuration automatique </li></ul><br><p><img src="https://habrastorage.org/webt/nj/n0/vs/njn0vsnh6hfcyvjuejxy7qtopek.png"></p><br><p>  Un client typique vient √† nous.  Il a deux t√¢ches: </p><br><p>  1) comprendre que tout est tomb√© en panne de surveillance, alors qu'il n'y a rien du tout. </p><br><p>  2) le r√©parer rapidement. </p><br><p>  Il vient surveiller les r√©ponses de ce qui lui arrive. </p><br><p><img src="https://habrastorage.org/webt/ig/ff/fl/igffflnnpqwybqqxxw1yd0nb9tw.png"></p><br><p>  La premi√®re chose que font les gens qui n'ont rien est de mettre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.pingdom.com/</a> et d'autres services pour v√©rification.  L'avantage de cette solution est qu'elle peut se faire en 5 minutes.  Vous ne d√©couvrirez plus le probl√®me lors des appels des clients.  Il y a des probl√®mes de pr√©cision pour qu'ils sautent les probl√®mes.  Mais pour les sites simples, cela suffit. </p><br><p><img src="https://habrastorage.org/webt/cz/hb/td/czhbtddbrnh7n0msqxzrqxn8_wq.png"></p><br><p>  La deuxi√®me chose que nous pr√©conisons est de compter par les logs selon les statistiques des utilisateurs r√©els.  C'est combien un utilisateur particulier obtient des erreurs 5xx.  Quel est le temps de r√©ponse des utilisateurs.  Il y a des inconv√©nients, mais en g√©n√©ral, une telle chose fonctionne. </p><br><p><img src="https://habrastorage.org/webt/4g/ka/bk/4gkabkle1j9w96av-pkspnlwtis.png"></p><br><p>  √Ä propos de nginx: nous avons fait en sorte que tout client qui vient imm√©diatement place l'agent sur le frontend et que tout soit automatiquement capt√© par lui, il commence l'analyse, les erreurs commencent √† appara√Ætre, etc.  Il n'a presque rien √† configurer. </p><br><p><img src="https://habrastorage.org/webt/cf/ef/5p/cfef5pftq8hwwmmb1zqfwiqyf7m.png"></p><br><p>  Mais la plupart des clients n'ont pas de temporisateur dans les journaux nginx standard.  Ces 90% de clients ne souhaitent pas conna√Ætre le temps de r√©ponse de leur site.  Nous sommes constamment confront√©s √† cela.  Il est n√©cessaire d'√©tendre le journal nginx.  Ensuite, hors de la bo√Æte, nous commen√ßons automatiquement √† afficher les histogrammes hors de la bo√Æte.  Il s'agit probablement d'un aspect important du fait que le temps doit √™tre mesur√©. </p><br><p><img src="https://habrastorage.org/webt/qv/yx/_x/qvyx_xrqm7dg8vqcxkonum__aws.png"></p><br><p>  Que retirons-nous de l√†?  Dans la pratique, nous prenons des mesures dans de telles dimensions.  Ce ne sont pas des mesures plates.  La m√©trique est appel√©e index.request.rate - le nombre de requ√™tes par seconde.  Il est d√©taill√© par: </p><br><ul><li>  l'h√¥te duquel vous avez supprim√© les journaux; </li><li>  le journal d'o√π ces donn√©es ont √©t√© extraites; </li><li>  http par m√©thode; </li><li>  statut http; </li><li>  √©tat du cache. </li></ul><br><p>  Ce n'est PAS chaque URL sp√©cifique avec tous les arguments.  Nous ne voulons pas supprimer 100 000 mesures du journal. </p><br><p><img src="https://habrastorage.org/webt/u6/ah/0r/u6ah0rgp43jp3mnzdrqjpet5sza.png"></p><br><p>  Nous voulons prendre 1000 m√©triques.  Par cons√©quent, nous essayons de normaliser l'URL, si possible.  Prenez l'URL du haut.  Et pour les URL significatives, nous montrons un graphique √† barres s√©par√©, s√©par√©ment 5xx. </p><br><p><img src="https://habrastorage.org/webt/ij/dr/ir/ijdrirnx6vwpo9jfteyepp3ax_e.png"></p><br><p>  Voici un exemple de la fa√ßon dont cette m√©trique simple se transforme en graphiques utilisables.  C'est notre DSL en haut.  J'ai essay√© cette DSL pour expliquer la logique approximative.  Nous avons pris toutes les demandes de nginx par seconde et les avons dispos√©es sur toutes les machines que nous avons.  J'ai des connaissances sur la fa√ßon dont nous √©quilibrons, combien nous avons RPS total (demande par seconde, demandes par seconde). </p><br><p><img src="https://habrastorage.org/webt/mc/hv/sv/mchvsvendei8dswx2umciwkg8qu.png"></p><br><p>  D'un autre c√¥t√©, nous pouvons filtrer cette m√©trique et afficher uniquement 4xx.  Sur un graphique 4xx, ils peuvent √™tre dispos√©s en fonction de l'√©tat r√©el.  Je vous rappelle que c'est la m√™me m√©trique. </p><br><p><img src="https://habrastorage.org/webt/uk/14/vc/uk14vcumvrmenkg4mubhonkv5gu.png"></p><br><p>  Sur le graphique, vous pouvez afficher 4xx par URL.  Il s'agit de la m√™me mesure. </p><br><p><img src="https://habrastorage.org/webt/1l/n4/g8/1ln4g8sgwvteebpsdsbg_xmtly8.png"></p><br><p>  Nous tirons √©galement un histogramme √† partir des journaux.  Un histogramme est la m√©trique response_time.histrogram, qui est en fait RPS avec un param√®tre de niveau suppl√©mentaire.  Il s'agit simplement d'une coupure de temps dans laquelle le compartiment obtient la demande. </p><br><p><img src="https://habrastorage.org/webt/cb/3b/nh/cb3bnh0wosk9il_ntyywe3z1kiq.png"></p><br><p>  Nous dessinons une demande: r√©sumons l'histogramme entier et le trions en niveaux: </p><br><ul><li>  Demandes lentes </li><li>  demandes rapides; </li><li>  requ√™tes moyennes; </li></ul><br><p>  Nous avons une image qui a d√©j√† √©t√© r√©sum√©e par les serveurs.  La m√©trique est la m√™me.  Sa signification physique est compr√©hensible.  Mais nous en profitons de mani√®res compl√®tement diff√©rentes. </p><br><p><img src="https://habrastorage.org/webt/og/_q/0a/og_q0acmw4ianhc6n5sc3z4aokq.png"></p><br><p>  Sur le graphique, vous pouvez afficher l'histogramme uniquement par URL commen√ßant par "/ api".  Ainsi, nous regardons l'histogramme s√©par√©ment.  Nous regardons combien en ce moment.  Nous voyons combien de RPS √©taient dans l'URL "/ api".  La m√™me m√©trique, mais une application diff√©rente. </p><br><p><img src="https://habrastorage.org/webt/lt/jw/46/ltjw46topobrcyeyyhkkigncknm.png"></p><br><p>  Quelques mots sur les timings dans nginx.  Il y a request_time, qui inclut le temps entre le d√©but de la demande et le transfert du dernier octet au socket au client.  Et il y a upstream_response_time.  Ils doivent √™tre mesur√©s √† la fois.  Si nous supprimons simplement request_time, alors vous verrez des retards dus √† des probl√®mes de connectivit√© client avec votre serveur, vous y verrez des retards si nous avons configur√© la demande de limitation c burst et le client dans le bain.  Vous ne comprendrez pas si vous devez r√©parer le serveur ou appeler l'h√©bergeur.  En cons√©quence, nous supprimons les deux et il est √† peu pr√®s clair ce qui se passe. </p><br><p><img src="https://habrastorage.org/webt/uy/xy/a9/uyxya9gyu-fr0ccab75sa7fjt3q.png"></p><br><p>  Avec la t√¢che de comprendre si le site fonctionne ou non, je pense que nous avons plus ou moins compris.  Il y a des erreurs.  Il y a des inexactitudes.  Les principes g√©n√©raux sont les suivants. </p><br><p>  Maintenant sur la surveillance de l'architecture √† plusieurs niveaux.  Parce que m√™me la boutique en ligne la plus simple a au moins une interface, suivie d'une bitrix et d'une base.  C'est d√©j√† beaucoup de liens.  Le point g√©n√©ral est que vous devez tirer quelques indicateurs de chaque niveau.  Autrement dit, l'utilisateur pense √† l'interface.  Frontend pense au backend.  Le backend pense au backend voisin.  Et ils pensent tous √† la base.  Donc, par couches, par d√©pendances, on passe.  Nous couvrons tout avec une sorte de m√©trique.  Nous obtenons quelque chose √† la sortie. </p><br><p><img src="https://habrastorage.org/webt/nq/ov/rx/nqovrxw3la9pl8bkrufpklydrii.png"></p><br><p>  Pourquoi ne pas se limiter √† une seule couche?  En r√®gle g√©n√©rale, entre les couches se trouve un r√©seau.  Un grand r√©seau sous charge est une substance extr√™mement instable.  Par cons√©quent, tout se passe l√†-bas.  De plus, ces mesures que vous faites sur quelle couche peut se trouver.  Si vous prenez des mesures sur la couche ¬´A¬ª et la couche ¬´B¬ª, et si elles interagissent entre elles via le r√©seau, vous pouvez comparer leurs lectures, trouver des anomalies et des incoh√©rences. </p><br><p><img src="https://habrastorage.org/webt/7a/kq/ov/7akqovksuz3bhdmaxez5vcibepk.png"></p><br><p>  √Ä propos du backend.  Nous voulons comprendre comment surveiller le backend.  Que faire avec pour comprendre rapidement ce qui se passe.  Je vous rappelle que nous sommes d√©j√† pass√©s √† la t√¢che de minimiser les temps d'arr√™t.  Et √† propos du backend, nous sugg√©rons g√©n√©ralement de comprendre: </p><br><ul><li>  Combien cette ressource mange-t-elle? </li><li>  Sommes-nous heurt√©s √† une limite? </li><li>  Que se passe-t-il avec le runtime?  Par exemple, la plate-forme d'ex√©cution JVM, l'environnement d'ex√©cution Golang et d'autres environnements d'ex√©cution. </li><li>  Lorsque nous avons d√©j√† couvert tout cela, il est int√©ressant pour nous d√©j√† plus proche de notre code.  Nous pouvons soit utiliser l'intrum√©trie automatique (statsd, * -metric), qui nous montrera tout cela.  Ou informez-vous en r√©glant des minuteries, des compteurs, etc. </li></ul><br><p><img src="https://habrastorage.org/webt/wk/xq/6p/wkxq6ptxbigdvp3evm4t2mqh3lq.png"></p><br><p>  √Ä propos des ressources.  Notre agent standard supprime la consommation de ressources par tous les processus.  Par cons√©quent, pour le backend, nous n'avons pas besoin de capturer s√©par√©ment les donn√©es.  Nous prenons et voyons combien le CPU consomme le processus, par exemple Python sur les serveurs masqu√©s.  Nous montrons tous les serveurs du cluster sur le m√™me graphique, car nous voulons comprendre si nous avons des d√©s√©quilibres et si quelque chose a explos√© sur la m√™me machine.  Nous voyons la consommation totale d'hier √† aujourd'hui. </p><br><p><img src="https://habrastorage.org/webt/t0/fl/oe/t0floe26e2hgev70o5fs18yf4ua.png"></p><br><p>  Il en va de m√™me pour la m√©moire.  Quand on le dessine comme √ßa.  Nous s√©lectionnons Python RSS (RSS est la taille des pages m√©moire allou√©es au processus par le syst√®me d'exploitation et actuellement situ√©es dans la RAM).  Somme par h√¥te.  Nous ne regardons nulle part o√π la m√©moire coule.  Partout la m√©moire est r√©partie uniform√©ment.  En principe, nous avons re√ßu une r√©ponse √† nos questions. </p><br><p><img src="https://habrastorage.org/webt/zl/cu/yz/zlcuyz_bgzybypkgcndsotzdcsk.png"></p><br><p>  Exemple d'ex√©cution.  Notre agent est √©crit √† Golang.  L'agent Golang s'envoie des m√©triques de son runtime.  Il s'agit en particulier du nombre de secondes pass√©es par le ramasse-miettes de Golang sur la collecte des ordures par seconde.  Nous voyons ici que certains serveurs ont des m√©triques diff√©rentes des autres serveurs.  Nous avons vu une anomalie.  Nous essayons d'expliquer cela. </p><br><p><img src="https://habrastorage.org/webt/oj/ir/pu/ojirpuokww_ym6e1hg1yrwz_8ao.png"></p><br><p>  Il existe une autre mesure d'ex√©cution.  La quantit√© de m√©moire allou√©e par unit√© de temps.  Nous voyons que les agents de type sup√©rieur allouent plus de m√©moire que les agents inf√©rieurs.  Vous trouverez ci-dessous des agents avec un garbage collector moins agressif.  C'est logique.  Plus la m√©moire qui vous traverse est allou√©e, lib√©r√©e, plus la charge sur le garbage collector est importante.  De plus, selon nos m√©triques internes, nous comprenons pourquoi nous voulons autant de m√©moire sur ces machines et moins sur ces machines. </p><br><p><img src="https://habrastorage.org/webt/8h/4s/yq/8h4syq_g35fjhfdztsheuybzyrc.png"></p><br><p>  Quand on parle d'instrumentation, toutes sortes d'outils comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://pinba.org/</a> pour php arrivent.  Pinba est une extension pour php de Badoo, que vous installez et connectez-vous √† php.  Il vous permet de supprimer et d'envoyer imm√©diatement le protobuf via UDP.  Ils ont un serveur pinba.  Mais nous avons cr√©√© un serveur Pinba int√©gr√© dans l'agent.  PHP s'envoie combien il a d√©pens√© de CPU et de m√©moire pour de tels scripts, combien de trafic est donn√© par ces scripts, etc.  Voici un exemple avec Pinba.  Nous montrons les 5 meilleurs scripts sur la consommation du processeur.  Nous voyons une valeur violette aberrante qui est un point barbouill√© de PHP.  Nous allons r√©parer le point souill√© de PHP ou comprendre pourquoi il mange le CPU.  Nous avons d√©j√† r√©duit la port√©e du probl√®me afin de comprendre les √©tapes suivantes.  Nous allons regarder le code et le r√©parer. </p><br><p><img src="https://habrastorage.org/webt/kx/el/vv/kxelvvi9xxzv4bfefhf4m0xbhay.png"></p><br><p>  Il en va de m√™me pour le trafic.  Nous regardons les 5 meilleurs scripts de trafic.  Si c'est important pour nous, alors nous allons comprendre. </p><br><p><img src="https://habrastorage.org/webt/nz/io/zs/nziozsp_7pzn3ej88j8t3bdpenk.png"></p><br><p>  Il s'agit d'un tableau sur nos outils internes.  Lorsque nous avons r√©gl√© le minuteur via statsd et mesur√© les m√©triques.  Nous avons fait en sorte que le temps total pass√© dans le CPU ou en pr√©vision d'une ressource soit d√©fini selon le gestionnaire que nous traitons actuellement, et selon les √©tapes importantes de votre code: ils ont attendu la cassander, attendu elasticsearch.  Le graphique pr√©sente les 5 premi√®res √©tapes du gestionnaire / metric / query.  Sur le graphique, vous pouvez afficher les 5 meilleurs gestionnaires pour la consommation du processeur, donc ce qui se passe √† l'int√©rieur.  Il est clair que corriger. </p><br><p>  √Ä propos du backend, vous pouvez aller plus loin.  Il y a des choses qui font le tra√ßage.  Autrement dit, vous pouvez voir cette demande d'utilisateur particuli√®re avec un cookie tel ou tel et une telle ou telle adresse IP g√©n√©r√©e tant de demandes √† la base de donn√©es, ils ont attendu tellement de temps.  Nous ne sommes pas en mesure de retracer.  Nous ne tra√ßons pas.  Nous pouvons toujours croire que nous ne faisons pas d'applications ni de surveillance des performances. </p><br><p><img src="https://habrastorage.org/webt/pr/zy/yf/przyyfqriaulwy_fe4swdvq2bco.png"></p><br><p>  √Ä propos de la base de donn√©es.  La m√™me chose.  Les bases de donn√©es sont le m√™me processus.  Il consomme des ressources.  Si la base est tr√®s sensible √† la latence, il existe des fonctionnalit√©s l√©g√®rement diff√©rentes.  Nous sugg√©rons de v√©rifier qu'il n'y a pas moins de ressources, pas de d√©gradation des ressources.  Il est id√©al de comprendre que si la base commence √† consommer plus qu'elle n'en consomme, alors comprenez exactement ce qui a chang√© dans votre code. </p><br><p><img src="https://habrastorage.org/webt/az/zc/lj/azzcljm0hkvcfxc1lgeqeukrdgq.png"></p><br><p>  √Ä propos des ressources.  De la m√™me mani√®re, nous regardons combien le processus MySQL g√©n√®re sur notre disque.  On voit qu'en moyenne il y en a tellement, mais certains pics se produisent.  Par exemple, beaucoup d'insert arrive et il commence √† √©crire sur le disque √† 15h15, 16h15, 17h15. </p><br><p><img src="https://habrastorage.org/webt/u8/vb/rc/u8vbrcgbovxfcalnkk7sph4rw2i.png"></p><br><p>  A propos de la d√©gradation des ressources.  Par exemple, une batterie RAID est pass√©e en mode maintenance.  Elle a cess√© d'√™tre un contr√¥leur comme une batterie sous tension.  √Ä ce stade, le cache d'√©criture est d√©connect√©, la latence des disques d'√©criture augmente.  √Ä ce stade, si la base de donn√©es a commenc√© √† s'√©mousser en attendant le disque et que vous savez approximativement qu'avec la m√™me charge sur votre √©criture, la latence du disque √©tait diff√©rente, v√©rifiez la batterie en RAID. </p><br><p><img src="https://habrastorage.org/webt/j_/ap/qb/j_apqbgrlnp5zkiopa794hq0v4y.png"></p><br><p>  Ressources √† la demande.  Ce n'est pas si simple ici.  D√©pend de la base.  La base doit pouvoir parler d'elle-m√™me: quelles demandes elle d√©pense en ressources, etc.  Le leader dans ce domaine est PostgreSQL.  Il a pg_stat_statements.  Vous pouvez comprendre le type de demande que vous avez en utilisant beaucoup de CPU, de disque de lecture et d'√©criture et de trafic. </p><br><p>  Dans MySQL, pour √™tre honn√™te, tout est bien pire.  Il a performance_schema.  Cela fonctionne en quelque sorte √† partir de la version 5.7.  Contrairement √† une seule vue dans PostgreSQL, performance_schema est une table de vue syst√®me 27 ou 23 dans MySQL.  Parfois, si vous faites des requ√™tes sur les mauvaises tables (sur la mauvaise vue), vous pouvez dilapider MySQL. </p><br><p>  Redis a des statistiques sur l'√©quipe.  Vous voyez qu'une certaine commande utilise beaucoup de CPU, etc. </p><br><p>  Cassandra dispose de temps pour interroger des tables sp√©cifiques.  Mais comme la cassandra est con√ßue pour qu'un seul type de requ√™te soit fait sur la table, cela suffit pour la surveillance. </p><br><p><img src="https://habrastorage.org/webt/qx/gt/wo/qxgtwoplv8i3wnce0ncygyipfgw.png"></p><br><p>  Voici Redis.  Nous voyons que le violet utilise beaucoup de CPU.  Le violet est un setex.  Setex - enregistrement cl√© avec installation TTL.  Si c'est important pour nous, allons-y.  Si cela n'est pas important pour nous, nous savons simplement o√π vont toutes les ressources. </p><br><p><img src="https://habrastorage.org/webt/78/x_/ng/78x_nghhya3bc-3zd2xtgd2kyxy.png"></p><br><p>  Cassandra.  Nous voyons les 5 premiers tableaux pour les demandes de lecture par le temps de r√©ponse total.  Nous voyons cette mont√©e subite.  Ce sont des requ√™tes √† la table, et nous comprenons √† peu pr√®s qu'une requ√™te √† cette table fait un morceau de code.  Cassandra n'est pas une base de donn√©es SQL dans laquelle nous pouvons effectuer diff√©rentes requ√™tes sur des tables.  Cassandra est de plus en plus mis√©rable. </p><br><p><img src="https://habrastorage.org/webt/z3/ho/s3/z3hos3wz7mgt5yvh3jbw9sgodxi.png"></p><br><p>  Quelques mots sur le workflow avec les incidents.  Comme je le vois. </p><br><p>  √Ä propos de l'alerte.  Notre vision du flux de travail des incidents est diff√©rente de ce qui est g√©n√©ralement accept√©. </p><br><p><img src="https://habrastorage.org/webt/px/zd/n4/pxzdn4r9vdjznfd6hrr2x63nmxi.png"></p><br><p>  Severy Critical.  Nous vous informons par SMS et tous les canaux de communication en temps r√©el. </p><br><p>  Severy Info est une ampoule qui peut vous aider avec quelque chose lorsque vous travaillez avec des incidents.  L'information n'est notifi√©e nulle part.  Info se bloque simplement et vous indique que quelque chose se passe. </p><br><p>  Severy Warning est quelque chose qui peut √™tre notifi√©, peut-√™tre pas. </p><br><p><img src="https://habrastorage.org/webt/op/hd/az/ophdazu-e1tchrtymsdxetidpq8.png"></p><br><p>  Exemples critiques. </p><br><p>  Le site ne fonctionne pas du tout.  Par exemple, 5xx 100% ou le temps de r√©ponse a augment√© et les utilisateurs ont commenc√© √† partir. </p><br><p>  Erreurs de logique m√©tier.  Ce qui est critique.  Il faut mesurer l'argent par seconde.  L'argent par seconde est une bonne source de donn√©es pour Critical.  Par exemple, le nombre de commandes, la promotion d'annonces et autres. </p><br><p><img src="https://habrastorage.org/webt/it/n3/em/itn3emdzqhe7lapptysa1nvlwjy.png"></p><br><p>  Workflow avec Critical de sorte que cet incident ne puisse pas √™tre report√©.  Vous ne pouvez pas cliquer sur OK et rentrer chez vous.  Si Critical est venu vers vous et que vous prenez le m√©tro, vous devez sortir du m√©tro, sortir, prendre un banc et commencer √† r√©parer.  Sinon, ce n'est pas critique.  √Ä partir de ces consid√©rations, nous construisons la gravit√© restante pour l'attribut r√©siduel. </p><br><p><img src="https://habrastorage.org/webt/pq/ct/ww/pqctww-7nkjkjjdvmujjl9ntjrm.png"></p><br><p>  Attention.  Exemples d'avertissement. </p><br><ul><li>  L'espace disque est √©puis√©. </li><li>  Le service interne fonctionne depuis longtemps, mais si vous n'avez pas Critical, cela signifie que vous √™tes quand m√™me conditionnel. </li><li>  Beaucoup d'erreurs sur l'interface r√©seau. </li><li>  Le plus controvers√© est que le serveur n'est pas disponible.  En fait, si vous avez plusieurs serveurs et que le serveur n'est pas disponible, il s'agit d'un avertissement.  Si vous n'avez pas 1 backend sur 100, alors c'est stupide de se r√©veiller des SMS et vous obtiendrez des administrateurs nerveux. </li></ul><br><p>  Tous les autres Severy sont con√ßus pour vous aider √† g√©rer les critiques. </p><br><p><img src="https://habrastorage.org/webt/ze/rv/je/zervjevqnr3gnnaqugze3h1jf-g.png"></p><br><p>  Attention.  Nous pr√©conisons cette approche pour travailler avec Warning.  De pr√©f√©rence avertissement ferm√© pendant la journ√©e.  La plupart de nos clients ont d√©sactiv√© la notification d'avertissement.  Ainsi, ils ne disposent pas de la soi-disant surveillance de la c√©cit√©.  Cela signifie plier des lettres dans le courrier sans lire un r√©pertoire s√©par√©.  Les clients ont d√©sactiv√© l'alerte d'avertissement. </p><br><p>  (Si je comprends bien, la surveillance pure est des alertes et des d√©clencheurs inutiles ajout√©s aux exceptions - note de l'auteur de l'article) </p><br><p>  Si vous utilisez la technique de surveillance pure, si vous avez 5 nouveaux avertissements, vous pouvez les r√©parer en mode silencieux.  Ils n‚Äôont pas eu le temps de le r√©parer aujourd‚Äôhui, mais ils l‚Äôont report√© √† demain, sinon de mani√®re critique.  Si l'avertissement s'allume et s'√©teint, cela doit √™tre tordu dans la surveillance afin que vous ne vous d√©rangiez pas √† nouveau.  Ensuite, vous serez plus tol√©rant envers eux et, en cons√©quence, la vie s'am√©liorera. </p><br><p><img src="https://habrastorage.org/webt/xp/92/lv/xp92lvui1q6xbawczc9ltl0osys.png"></p><br><p>  Exemples d'informations.  Il est discutable que l'utilisation √©lev√©e du processeur de nombreux Critical.  En fait, si rien n'affecte, vous pouvez ignorer cette notification. </p><br><p><img src="https://habrastorage.org/webt/xb/nn/p1/xbnnp13tktiqtspilpycu2oaxba.png"></p><br><p>  Attention (peut-√™tre que je vois Info - une note de l'auteur du post) ce sont les lumi√®res qui s'allument lorsque vous venez r√©parer le Critical.  Vous voyez deux panneaux d'avertissement c√¥te √† c√¥te (il y a peut-√™tre un lien Info - note de l'auteur du message).  Ils peuvent vous aider √† r√©soudre l'incident avec Critical.  Pourquoi il n'est pas clair sur l'utilisation √©lev√©e du processeur s√©par√©ment dans SMS ou dans une lettre. </p><br><p>  L'information inutile est √©galement mauvaise.  Si vous les configurez comme exception, vous allez trop aimer Info. </p><br><p><img src="https://habrastorage.org/webt/ra/rc/uc/rarcucyuedf9vp6v6keycnnjbz4.png"></p><br><p>  Principes g√©n√©raux de conception des alertes.  L'alerte doit indiquer la raison.  C'est parfait.  Mais cela est difficile √† r√©aliser.  Ici, nous travaillons √† plein temps sur une t√¢che et elle se r√©v√®le avec un certain succ√®s. </p><br><p>  Tout le monde parle du besoin de d√©pendance, d'auto-magie.  En fait, si vous ne recevez pas de notifications pour quelque chose qui ne vous int√©resse pas, il n'y en aura pas trop.  Dans ma pratique, les statistiques montrent qu'une personne regardera au moment d'un incident critique avec ses yeux une centaine d'ampoules en diagonale.  Il trouvera la bonne l√†-bas et ne pensera pas que la d√©pendance a cach√© des ampoules qui pourraient m'aider maintenant.  En pratique, cela fonctionne.  Il vous suffit de nettoyer les alertes inutiles. </p><br><p><img src="https://habrastorage.org/webt/wq/i8/mm/wqi8mmyravgx7yllannlhsgdvg8.png"></p><br><p>  (Ici la vid√©o saut√©e - note de l'auteur de l'article) </p><br><p><img src="https://habrastorage.org/webt/ys/t_/0d/yst_0dqqfwqnra1yz0krnccw7ae.png"></p><br><p>  Ce serait bien de classer ces temps d'arr√™t afin de pouvoir travailler avec eux plus tard.  Par exemple, tirez des conclusions organisationnelles.  Vous devez comprendre pourquoi vous mentiez.  Nous proposons de classer / diviser dans les classes suivantes: </p><br><ul><li>  cr√©√© par l'homme </li><li>  mise en place d'h√©bergeur </li><li>  est venu des bots </li></ul><br><p>  Si vous les classifiez, alors tout le monde sera content. </p><br><p><img src="https://habrastorage.org/webt/_c/kz/ll/_ckzllbldi_jkamyonco194favy.png"></p><br><p>  Le SMS est arriv√©.  On fait quoi?  Nous courons d'abord pour tout r√©parer.  Jusqu'√† pr√©sent, rien n'est important pour nous, √† l'exception du temps d'arr√™t.  Parce que nous sommes motiv√©s √† mentir moins.  Ensuite, lorsque l'incident est clos, il doit √™tre ferm√© au syst√®me de surveillance.  Nous pensons que l'incident doit √™tre contr√¥l√© par surveillance.  Si votre surveillance n'est pas configur√©e, il suffit de vous assurer que le probl√®me est r√©solu.  Cela doit √™tre tordu.  Une fois l'incident clos, il n'est pas r√©ellement clos.  Il attend pendant que vous arrivez au fond de la raison.  En fait, tout dirigeant doit d‚Äôabord s‚Äôassurer que les probl√®mes ne se reproduisent pas.  Pour que les probl√®mes ne se reproduisent pas, il faut aller au fond de la raison.  Une fois que nous sommes arriv√©s au fond de la raison, nous avons des donn√©es pour les classer.  Nous analysons les raisons.  Ensuite, alors que nous arrivons au fond de la raison, nous devons le faire √† l'avenir pour que l'incident ne se reproduise pas: </p><br><ul><li>  il faut deux personnes par quart pour √©crire telle ou telle logique dans le backend. </li><li>  besoin de mettre plus de r√©pliques. </li></ul><br><p>  Il est n√©cessaire de s'assurer que le m√™me incident ne se produit pas exactement.  Lorsque vous travaillez dans un tel flux de travail √† travers N it√©rations, le bonheur vous attend, une bonne disponibilit√©. </p><br><p>  Pourquoi les avons-nous class√©s?  Nous pouvons prendre les statistiques du trimestre et comprendre quel temps d'arr√™t vous a le plus apport√©.  Travaillez ensuite dans cette direction.  Vous pouvez travailler sur tous les fronts ne sera pas tr√®s efficace, surtout si vous avez peu de ressources l√†-bas. </p><br><p><img src="https://habrastorage.org/webt/b9/os/oh/b9osohrb-qilf4mcb7ddcqjckju.png"></p><br><p>  Nous avons calcul√© que nous restions l√† pendant tellement de temps, par exemple 90% √† cause de l'h√©bergeur.  Nous facturons nous changeons cet h√©bergeur.  Si les gens jouent avec nous, nous les envoyons aux cours.   ,      - ‚Äî  .   .     ,     .    ,    . </p><br><p><img src="https://habrastorage.org/webt/js/gl/wp/jsglwpchvythu9tvkjnbruwtcr8.png"></p><br><p>  .      : </p><br><ul><li>  . </li><li>  . </li></ul><br><p>     ,    ,    .      ,    ,  . </p><br><p><img src="https://habrastorage.org/webt/nn/rb/fl/nnrbflbnglbwbwggjdxuipfuxss.png"></p><br><p> :    ,  .     : ,  ,    .   False Positive ( ),   ,    .       ? </p><br><p> :      .    10- frontend ,      .    9 frontend     nginx,   10-  ,     warning alert  .            .     ,     .          .    . </p><br><p> :       . ,      ,   load avarage 4  , -   load avarage 20  . </p><br><p> :        load avarage.      100       .   CPU usage   Hadoop  .          .       .    .     ,       ,     .      PostgreSQL    autovacuum,  worker autovacuum      .          99  . Warning     .  Critical     .    Critical 10 5  ,     Critical. </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Question: √Ä quel moment et comment le seuil est-il d√©termin√©? </font><font style="vertical-align: inherit;">Qui fait √ßa?</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©ponse: Vous venez chez nous et dites: nous voulons demander √† certains critiques de notre projet. </font><font style="vertical-align: inherit;">Si vous mettez 10 5xx par seconde maintenant, alors combien de notifications vous recevriez il y a une semaine.</font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Question: Quel est le poids de tout ce bon suivi? </font></font></p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©ponse: En moyenne, il est g√©n√©ralement invisible. </font><font style="vertical-align: inherit;">Mais si vous analysez 50 000 RPS, ce sera de 1% √† 10% d'un processeur. </font><font style="vertical-align: inherit;">Comme nous ne faisons que du suivi, nous avons optimis√© notre agent. </font><font style="vertical-align: inherit;">Nous mesurons les performances des agents. </font><font style="vertical-align: inherit;">Si vous n'avez pas les ressources √† surveiller sur le serveur, vous faites quelque chose de mal. </font><font style="vertical-align: inherit;">Il devrait toujours y avoir des ressources √† surveiller. </font><font style="vertical-align: inherit;">Si vous ne le faites pas, vous serez aussi aveugle au toucher pour administrer votre projet.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473728/">https://habr.com/ru/post/fr473728/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473716/index.html">Widgets pilot√©s par la souris. Glissez et d√©posez dans la fen√™tre</a></li>
<li><a href="../fr473718/index.html">Comment ajouter des ch√®ques √† NoVerify sans √©crire une seule ligne de code Go</a></li>
<li><a href="../fr473720/index.html">Deux fa√ßons de r√©aliser des tests unitaires fiables</a></li>
<li><a href="../fr473722/index.html">Isolement √† distance, anxi√©t√© et d√©pression</a></li>
<li><a href="../fr473726/index.html">Il ne suffit pas de savoir ce que sont Mutex, Semaphore et async / wait. Vous devez tout savoir des quanta</a></li>
<li><a href="../fr473732/index.html">L'histoire de la fraude dans la construction d'un r√©seau c√¢bl√© sous l'Arctique pour 1 milliard de dollars</a></li>
<li><a href="../fr473740/index.html">CreateRemoteThread pour Linux</a></li>
<li><a href="../fr473742/index.html">Imprimantes d'ing√©nierie Epson pour CAO et SIG et quelques mots sur la "conception robuste"</a></li>
<li><a href="../fr473748/index.html">Courbe de B√©zier au service des √©conomistes du travail</a></li>
<li><a href="../fr473750/index.html">Stereopi + WebRTC = t√©l√©pr√©sence √† domicile</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>