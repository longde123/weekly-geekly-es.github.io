<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêá üë©üèø‚Äçüç≥ üéóÔ∏è Enkripsi File Konfigurasi üç¢ üôé üõï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Latar belakang 
 Saya mendapat tugas mengatur CI. Diputuskan untuk menggunakan transformasi file konfigurasi dan menyimpan data rahasia dalam bentuk t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Enkripsi File Konfigurasi</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462379/"><h2>  Latar belakang </h2><br>  Saya mendapat tugas mengatur CI.  Diputuskan untuk menggunakan transformasi file konfigurasi dan menyimpan data rahasia dalam bentuk terenkripsi.  Anda dapat mengenkripsi dan mendekripsi mereka menggunakan Key Container. <br><br><h3>  Wadah kunci </h3><br>  Setiap OS Windows memiliki set kunci yang dibuat.  Kunci dihasilkan baik di akun atau di mesin.  Kunci yang dihasilkan oleh mesin dapat dilihat di sepanjang jalur ini C: \ ProgramData \ Microsoft \ Crypto \ RSA \ MachineKeys.  Di sinilah kunci yang akan kita buat selanjutnya akan pergi. <br><a name="habracut"></a><br><h4>  Penciptaan kunci </h4><br>  Kami mulai cmd dari administrator dan beralih ke direktori dengan aspnet_regiis, saya punya C: \ Windows \ Microsoft.NET \ Framework64 \ v4.0.30319 <br><br>  Jalankan perintah <br><br><pre><code class="plaintext hljs">aspnet_regiis -pc "TestKey" -exp</code> </pre> <br>  exp - ditambahkan sehingga Anda dapat mengekspor kunci di masa mendatang <br>  TestKey - nama Wadah Kunci kami <br><br><h4>  Ekspor Utama </h4><br>  Tim <br><br><pre> <code class="plaintext hljs">aspnet_regiis -px "TestKey" :\TestKey.xml -pri</code> </pre> <br>  TestKey - beri nama Key Container <br>  C: \ TestKey.xml - path tempat file akan diekspor <br>  pri - tambahkan kunci pribadi untuk ekspor <br><br><h4>  Kunci impor </h4><br>  Tim <br><br><pre> <code class="plaintext hljs">aspnet_regiis -pi "TestKey" :\TestKey.xml</code> </pre> <br>  TestKey - beri nama Key Container <br>  C: \ TestKey.xml - jalur dari mana file akan diekspor <br><br><h4>  Hak Pengaturan </h4><br>  Agar aplikasi atau IIS Anda berfungsi dengan wadah utama, Anda perlu mengonfigurasi hak untuk itu. <br><br>  Ini dilakukan oleh tim <br><br><pre> <code class="plaintext hljs">aspnet_regiis -pa "TestKey" "NT AUTHORITY\NETWORK SERVICE"</code> </pre> <br>  TestKey - beri nama Key Container <br>  NT AUTHORITY \ LAYANAN JARINGAN - yang akan diberikan akses ke kunci <br><br>  Secara default, IIS memiliki ApplicationPoolIdentity untuk kumpulan. <br><br>  Dokumentasi Microsoft (lihat tautan 2) menjelaskan ApplicationPoolIdentity sebagai: <br><br><ul><li><blockquote>  <b>ApplicationPoolIdentity</b> : Ketika kumpulan aplikasi baru dibuat, IIS membuat akun virtual yang memiliki nama kumpulan aplikasi baru dan yang menjalankan proses pekerja kumpulan aplikasi di bawah akun ini.  Ini juga merupakan akun yang paling tidak istimewa. </blockquote></li></ul><br>  Oleh karena itu, agar IIS dapat mendekripsi konfigurasi, Identitas harus dikonfigurasi di kumpulan akun, atau Anda dapat memilih "LAYANAN JARINGAN" dan memberikannya hak. <br><br><h4>  Menambahkan bagian ke config </h4><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configProtectedData</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultProvider</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RsaProtectedConfigurationProvider"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">providers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CustomRsaProtectedConfigurationProvider"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Configuration.RsaProtectedConfigurationProvider,System.Configuration, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Uses RsaCryptoServiceProvider to encrypt and decrypt"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">keyContainerName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestKey"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cspProviderName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useMachineContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useOAEP</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">providers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configProtectedData</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Juga kontainer kunci dan RsaProtectedConfigurationProvider didefinisikan secara global dalam file <br><br>  C: \ Windows \ Microsoft.NET \ Framework \ v4.0.30319 \ Config \ machine.config, C: \ Windows \ Microsoft.NET \ Framework64 \ v4.0.30319 \ Config \ machine.config <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configProtectedData</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultProvider</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RsaProtectedConfigurationProvider"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">providers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RsaProtectedConfigurationProvider"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Configuration.RsaProtectedConfigurationProvider,System.Configuration, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Uses RsaCryptoServiceProvider to encrypt and decrypt"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">keyContainerName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NetFrameworkConfigurationKey"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cspProviderName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useMachineContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useOAEP</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DataProtectionConfigurationProvider"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Configuration.DpapiProtectedConfigurationProvider,System.Configuration, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Uses CryptProtectData and CryptUnProtectData Windows APIs to encrypt and decrypt"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useMachineProtection</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">keyEntropy</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">providers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configProtectedData</span></span></span><span class="hljs-tag">&gt;</span></span></code> = "System.Configuration.DpapiProtectedConfigurationProvider, System.Configuration, Version = 4.0.0.0, Culture = netral, PublicKeyToken = b03f5f7f11d50a3a" description = "Menggunakan CryptProtectData dan CryptUnprotectData API Windows untuk mengenkripsi dan mendekripsi" useMachineProtection = <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configProtectedData</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultProvider</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RsaProtectedConfigurationProvider"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">providers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RsaProtectedConfigurationProvider"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Configuration.RsaProtectedConfigurationProvider,System.Configuration, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Uses RsaCryptoServiceProvider to encrypt and decrypt"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">keyContainerName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NetFrameworkConfigurationKey"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cspProviderName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useMachineContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useOAEP</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DataProtectionConfigurationProvider"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Configuration.DpapiProtectedConfigurationProvider,System.Configuration, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Uses CryptProtectData and CryptUnProtectData Windows APIs to encrypt and decrypt"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useMachineProtection</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">keyEntropy</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">providers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configProtectedData</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h3>  Enkripsi </h3><br>  Enkripsi itu sendiri dapat dilakukan dengan tiga cara. <br><br><h4>  Enkripsi Baris Perintah </h4><br><pre> <code class="plaintext hljs">aspnet_regiis.exe -pef connectionStrings :\Site -prov "CustomRsaProtectedConfigurationProvider"</code> </pre> <br>  C: \ Site - path ke file dengan konfigurasi. <br><br>  CustomRsaProtectedConfigurationProvider - penyedia kami ditentukan dalam konfigurasi yang disebut wadah kunci. <br><br><h4>  Enkripsi melalui aplikasi tertulis </h4><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> provider = <span class="hljs-string"><span class="hljs-string">"CustomRsaProtectedConfigurationProvider"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProtectConfiguration</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None); ConfigurationSection connStrings = config.ConnectionStrings; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (connStrings != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !connStrings.SectionInformation.IsProtected &amp;&amp; !connStrings.ElementInformation.IsLocked) { connStrings.SectionInformation.ProtectSection(provider); connStrings.SectionInformation.ForceSave = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; config.Save(ConfigurationSaveMode.Full); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnProtectConfiguration</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path</span></span></span><span class="hljs-function">)</span></span> { Configuration config = ConfigurationManager.OpenExeConfiguration(path); ConfigurationSection connStrings = config.ConnectionStrings; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (connStrings != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; connStrings.SectionInformation.IsProtected &amp;&amp; !connStrings.ElementInformation.IsLocked) { connStrings.SectionInformation.UnprotectSection(); } }</code> </pre><br><h4>  Sepeda </h4><br>  Ketika ada transformasi file dan Anda perlu mengenkripsi bagian secara terpisah dari seluruh konfigurasi, maka hanya versi yang ditulis sendiri yang cocok.  Kami membuat instance dari kelas RsaProtectedConfigurationProvider, mengambil node dari xml dan mengenkripsi secara terpisah, kemudian mengganti node xml asli dengan yang dienkripsi kami dan menyimpan hasilnya. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Protect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filePath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sectionName = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { XmlDocument xmlDocument = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlDocument { PreserveWhitespace = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; xmlDocument.Load(filePath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmlDocument.DocumentElement == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidXmlException(<span class="hljs-string"><span class="hljs-string">$"Invalid Xml document"</span></span>); } sectionName = !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(sectionName) ? sectionName : xmlDocument.DocumentElement.Name; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xmlElement = xmlDocument.GetElementsByTagName(sectionName)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> XmlElement; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NameValueCollection { { <span class="hljs-string"><span class="hljs-string">"keyContainerName"</span></span>, _settings.KeyContainerName }, { <span class="hljs-string"><span class="hljs-string">"useMachineContainer"</span></span>, _settings.UseMachineContainer ? <span class="hljs-string"><span class="hljs-string">"true"</span></span> : <span class="hljs-string"><span class="hljs-string">"false"</span></span> } }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rsaProvider = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RsaProtectedConfigurationProvider(); rsaProvider.Initialize(_encryptionProviderSettings.ProviderName, config); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> encryptedData = rsaProvider.Encrypt(xmlElement); encryptedData = xmlDocument.ImportNode(encryptedData, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> createdXmlElement = xmlDocument.CreateElement(sectionName); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xmlAttribute = xmlDocument.CreateAttribute(<span class="hljs-string"><span class="hljs-string">"configProtectionProvider"</span></span>); xmlAttribute.Value = _encryptionProviderSettings.ProviderName; createdXmlElement.Attributes.Append(xmlAttribute); createdXmlElement.AppendChild(encryptedData); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (createdXmlElement.ParentNode == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || createdXmlElement.ParentNode.NodeType == XmlNodeType.Document || xmlDocument.DocumentElement == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { XmlDocument docNew = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlDocument { InnerXml = createdXmlElement.OuterXml }; docNew.Save(filePath); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xmlDocument.DocumentElement.ReplaceChild(createdXmlElement, xmlElement); xmlDocument.Save(filePath); } }</code> </pre><br><h2>  Referensi </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">1.docs.microsoft.com/en-us/previous-versions/53tyfkaw</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">2.support.microsoft.com/en-za/help/4466942/understanding-identities-in-iis</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id462379/">https://habr.com/ru/post/id462379/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id462359/index.html">Dat - protokol apa itu dan siapa yang menggunakannya</a></li>
<li><a href="../id462365/index.html">Keterbatasan Pembelajaran Mesin</a></li>
<li><a href="../id462367/index.html">13 fakta tentang kapitalisme ventura bagi para pendiri</a></li>
<li><a href="../id462371/index.html">Mulai Spring StateMachine</a></li>
<li><a href="../id462377/index.html">Bagaimana ruang bawah tanah dihasilkan di Enter The Gungeon</a></li>
<li><a href="../id462381/index.html">Jaringan saraf dan pembelajaran mendalam, bab 5: mengapa jaringan saraf dalam begitu sulit untuk dilatih?</a></li>
<li><a href="../id462383/index.html">Dari gudang di Dagestan - hingga programmer: bagaimana saya menjadi pengembang iOS dari awal</a></li>
<li><a href="../id462385/index.html">Pendekatan baru dapat membantu kita menyingkirkan perhitungan floating point</a></li>
<li><a href="../id462387/index.html">Apa itu pemrograman musikal - siapa yang melakukannya dan mengapa, mengatur sesi live nyata</a></li>
<li><a href="../id462393/index.html">Bagaimana memulai karir di universitas: lulusan lima hakim khusus memberi tahu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>