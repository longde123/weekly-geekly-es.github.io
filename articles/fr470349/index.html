<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé∂ ü§∑üèø üéüÔ∏è Automatisez les routines de g√©n√©ration automatique de clients SOAP avec l'importation WSDL pour SBT et Scala üë®üèº‚Äçüíª üë®‚Äçüëß‚Äçüë¶ üëÇüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Travailler avec SOAP devient souvent d√©licat, et g√©rer WSDL peut √™tre une √©norme contribution √† la complexit√© de cette t√¢che. Vraiment, ce pourrait √™t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatisez les routines de g√©n√©ration automatique de clients SOAP avec l'importation WSDL pour SBT et Scala</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470349/"><p>  Travailler avec SOAP devient souvent d√©licat, et g√©rer WSDL peut √™tre une √©norme contribution √† la complexit√© de cette t√¢che.  Vraiment, ce pourrait √™tre la chose la moins attendue √† affronter lorsque vous √™tes dans un langage moderne et sophistiqu√© comme, par exemple, Scala, qui est bien connu pour sa r√©activit√© et sa mani√®re asynchrone de traiter les demandes.  En fait, de nombreux d√©veloppeurs de logiciels qui ont fait leur entr√©e dans l'industrie assez r√©cemment, ne connaissent peut-√™tre m√™me pas les protocoles SOAP et WSDL, et deviennent rapidement ennuy√©s ou m√™me enrag√©s lorsqu'ils essaient pour la premi√®re fois de se connecter √† un tel service h√©rit√©.  Alors, devrions-nous d√©pr√©cier tout cela au profit d'une pile de technologies modernes, ou peut-√™tre qu'il existe une solution moins douloureuse? </p><a name="habracut"></a><br><h2 id="soap-legacy">  SAVON: H√©ritage </h2><br><p>  Il est difficile de pr√©tendre que cette chose SOAP semble assez obsol√®te de nos jours, en particulier en contraste avec l'√©tat actuel de la technologie.  √âcrire un client WSDL √† partir de z√©ro avec Kotlin, Scala ou un autre langage moderne pourrait √™tre p√©nible, et le manque de documentation appropri√©e ne facilite pas la vie.  Mais j'ai une bonne nouvelle pour vous, il y a une tache de lumi√®re dans le royaume du savon noir.  Eh bien, en fait WSDL lui-m√™me est celui-l√†.  En d√©pit d'√™tre lourd et quelque peu laid, il a un certain avantage.  L'exc√®s du format WSDL facilite la g√©n√©ration du code client (et √©galement serveur), peut-√™tre pas pour les humains mais certainement pour les syst√®mes automatis√©s. </p><br><p> M√™me par rapport aux sp√©cifications API modernes, il pourrait en fait rester √† √©galit√© avec OpenAPI ou les concepts sophistiqu√©s de l'API Swagger o√π tout est d√©crit dans une sp√©cification ind√©pendante du langage.  Cela offre d'√©normes possibilit√©s d'interop√©rabilit√© entre diff√©rentes plates-formes et langues, jusqu'au niveau de mise en ≈ìuvre.  Par exemple, si l'un expose un service Web .NET avec des sp√©cifications WSDL, un autre pourrait g√©n√©rer automatiquement un client bas√© sur JVM pour s'y connecter avec peu ou pas de douleur de conversion ou d'incompatibilit√© des formats de donn√©es. </p><br><h2 id="wsdl-import-magic">  Importation WSDL Magic </h2><br><p>  Allons plus loin et parlons de la g√©n√©ration de code automatis√©e.  Vous pourriez √™tre surpris, mais la plupart des plates-formes d'entreprise, principalement Java et .NET, sont livr√©es avec des outils de g√©n√©ration de code WSDL pr√™ts √† l'emploi.  Par exemple, il y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wsimport</a> qui fait partie d'une distribution JDK.  Ces outils sont assez puissants et devraient couvrir une t√¢che de g√©n√©ration automatique de bout en bout.  La seule partie restante est de connecter votre logique m√©tier au code client et de l'utiliser. </p><br><p> Donc, puisque nous sommes actuellement sur le th√®me Scala, regardons plus en profondeur l'outil <code>wsimport</code> de Java: </p><br><pre> <code class="plaintext hljs">wsimport -p stockquote http://stockquote.example.com/quote?wsdl</code> </pre> <br><p>  La commande prend un sch√©ma WSDL comme param√®tre requis, et en gros, il suffit juste de produire un ensemble complet de POJO et d'interfaces, marqu√©s de toutes les annotations appropri√©es.  Ces derniers font vraiment l'affaire: c'est essentiellement ce qui rend tout possible.  Une fois ex√©cut√©e, la JVM connecte votre code client avec l'impl√©mentation du client de service Web interne, qui sort de la bo√Æte, de sorte que vous n'avez pas √† vous soucier beaucoup des r√©seaux de bas niveau et des E / S.  Le reste de l'entreprise consiste √† g√©rer correctement les tenants et aboutissants et √† faire attention aux erreurs et exceptions. </p><br><h2 id="bring-automation-to-the-next-level-with-sbt">  Faites passer l'automatisation au niveau sup√©rieur avec SBT </h2><br><p>  D'accord, il est temps de passer √† l'action.  Imaginez que nous ayons certains services Web SOAP que nous devons √©galement connecter, et qu'ils exposent WSDL.  J'en ai d√©lib√©r√©ment pris quelques-uns pour des tests, pour le bien de la science et de l'√©ducation seulement, bien s√ªr.  Ex√©cutez le g√©n√©rateur de code: </p><br><pre> <code class="plaintext hljs">wsimport -s ../src/main/java -extension -p your.package.wsdl.nl \ -XadditionalHeaders -Xnocompile \ http://webservices.oorsprong.org/websamples.countryinfo/CountryInfoService.wso?WSDL</code> </pre> <br><p>  Il produit un certain nombre de code Java brut dans le dossier de sortie.  Nous pourrions proc√©der √† la connexion de notre logique m√©tier, comme sugg√©r√© ci-dessus.  Mais attendez une seconde, que se passe-t-il si le c√¥t√© serveur change - nous n'en serons conscients qu'au moment de l'ex√©cution r√©elle du code (ou au moment de l'√©chec des tests d'int√©gration, si nous en avons).  Pas jolie.  Cela devient vite pas joli du tout si vous songez √† valider tout ce code de bean Java standard dans votre r√©f√©rentiel Scala vierge. </p><br><p>  Bien s√ªr, il serait bien plus agr√©able de g√©n√©rer tout cela automatiquement et de garder les choses propres et propres.  Une premi√®re √©tape pour cela serait d'automatiser l'obtention de toutes les classes WSDL avec une seule commande et d'en faire un script Shell.  En fait, j'en ai fait un pour vous afin que vous puissiez y jeter un ≈ìil: <a href="">wsdl_import.sh</a> . </p><br><p>  Ensuite, nous pourrions simplement l'envelopper avec une t√¢che de construction: prenons SBT comme exemple, puisque nous sommes sur Scala, donc quelque chose comme √ßa devrait fonctionner: </p><br><pre> <code class="plaintext hljs">lazy val wsdlImport = TaskKey[Unit]("wsdlImport", "Generates Java classes from WSDL") wsdlImport := { val wsdlSources = "./wsdl/src/main/java" val d = file(wsdlSources) if (d.isDirectory) { // don't forget to rename to your fav one in line with WSDL generating sh val gen = file(s"$wsdlSources/github/sainnr/wsdl") if (!gen.exists() || gen.listFiles().isEmpty) { import sys.process._ println("[wsdl_import] Importing Java beans from WSDL...") "./wsdl/bin/wsdl_import.sh" ! } else println("[wsdl_import] Looks like WSDL is already imported, skipping.") } else println(s"[wsdl_import] Make sure the directory ${d.absolutePath} exists.") }</code> </pre> <br><p>  <em><a href="">Source</a></em> </p><br><p>  Maintenant, nous devons nous assurer que nous avons tout ce code avant la compilation de Scala, pour des raisons √©videntes.  Facile, nous avons SBT donc nous avons juste besoin d'ex√©cuter le script Shell comme une t√¢che SBT comme ci-dessus et d'ex√©cuter les choses dans le bon ordre, correct?  Eh bien, c'est un peu plus compliqu√© dans la vraie vie.  Sans entrer dans la plupart des d√©tails sur le fonctionnement de SBT, les choses deviennent beaucoup plus faciles si nous s√©parons cette partie WSDL-Java en un sous-projet autonome et cr√©ons une d√©pendance appropri√©e dans la configuration SBT principale. </p><br><pre> <code class="plaintext hljs">lazy val wsdl = (project in file("wsdl")) .settings ( publishSettings, sources in (Compile, doc) := Seq.empty ) lazy val root = (project in file(".")) .aggregate(wsdl) .dependsOn(wsdl)</code> </pre> <br><p>  <em><a href="">Source</a></em> </p><br><p>  Lorsque vous compilez le projet ma√Ætre, SBT s'assure d'abord que le sous-projet est d√©j√† compil√©.  Mais il y a un hic: lorsque vous venez de v√©rifier votre r√©f√©rentiel, vous n'avez peut-√™tre pas ex√©cut√© la compilation.  Donc, lorsque vous l'ouvrez pour la premi√®re fois dans l'√©diteur, certaines des d√©pendances seront bien s√ªr manquantes.  Heureusement, la seule chose dont vous avez besoin est d'ex√©cuter une commande de compilation sbt et, peut-√™tre, d'actualiser le projet dans IDE. </p><br><p>  Il peut y avoir une autre mise en garde si vous ex√©cutez votre application Scala en tant que client autonome ou dans un conteneur Web all√©g√© (par exemple Netty si vous utilisez Play Framework).  Dans ce cas, il est tr√®s probable que le runtime d'application ne contienne pas le bit d'impl√©mentation qui aide JVM √† faire la magie SOAP pour vous, gr√¢ce aux versions JRE modernes et au projet Jigsaw Java.  Pas besoin de paniquer cependant, ajoutez simplement quelques biblioth√®ques √† votre liste de d√©pendances, ou lancez un seul rt.jar depuis votre distribution JRE en tant que d√©pendance non g√©r√©e: </p><br><pre> <code class="plaintext hljs"> unmanagedJars in Test += Attributed.blank( file(System.getenv("JAVA_HOME") + "/jre/lib") )</code> </pre> <br><h2 id="as-a-conclusion">  En conclusion </h2><br><p>  D'accord, pour r√©capituler: nous avons appris un peu sur SOAP et WSDL et nous esp√©rons que ce n'est pas un cauchemar avec lequel travailler, gr√¢ce √† tous ces g√©n√©rateurs de code et √† la sp√©cification WSDL excessive.  Nous avons √©galement trouv√© comment automatiser un sale boulot et avons trouv√© un moyen de garder nos r√©f√©rentiels vierges et propres du code ind√©sirable.  Il a fallu une certaine connaissance de SBT pour configurer correctement l'ordre de compilation et les d√©pendances, mais apr√®s tout, cela devrait fonctionner assez bien.  Pour simplifier encore les choses, j'ai cr√©√© un petit mod√®le de bootstrap qui devrait vous aider √† d√©marrer un projet la prochaine fois: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/sainnr/sbt-scala-wsdl-template</a> .  J'esp√®re que vous avez appr√©ci√© ce petit voyage dans le pass√©! </p><br><h2 id="references">  Les r√©f√©rences </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En savoir plus sur le sch√©ma WSDL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Outil Wsimport</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mod√®le SBT pour la g√©n√©ration automatique WSDL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quand c'est all√© trop loin</a> </li></ul><br><p>  <em>Envoyez-moi un message si vous voyez des fautes de frappe ou des erreurs.</em> </p><br><p>  <em>Cet article a √©t√© initialement publi√© sur mon blog <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fullstackme.co.uk</a> avec peu de modifications.</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470349/">https://habr.com/ru/post/fr470349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470327/index.html">Application de MATLAB / Simulink avec des √©quipements fabriqu√©s par InSys JSC</a></li>
<li><a href="../fr470331/index.html">Comment identifier les journaux ISI, Scopus ou Scimago index√©s?</a></li>
<li><a href="../fr470333/index.html">Programmeur, gestionnaire, MVC et crit√®res d'acceptation</a></li>
<li><a href="../fr470337/index.html">Comment j'ai travaill√© pendant 3 mois √† Y. Market et quitter</a></li>
<li><a href="../fr470347/index.html">Comment apprendre ICI API en peu de temps</a></li>
<li><a href="../fr470353/index.html">Holivar. Histoire de Runet. Partie 4. Mail.ru: jeux, r√©seaux sociaux, Durov</a></li>
<li><a href="../fr470355/index.html">Dynamique en C #: recettes d'utilisation</a></li>
<li><a href="../fr470357/index.html">√âv√©nements num√©riques √† Moscou du 7 au 13 octobre</a></li>
<li><a href="../fr470359/index.html">Nouvelles du monde d'OpenStreetMap n ¬∞ 479 (17/09/2019 - 23/09/2019)</a></li>
<li><a href="../fr470361/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 383 (1 - 6 octobre 2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>