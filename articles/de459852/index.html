<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚≠êÔ∏è üèá „äôÔ∏è Die Praxis der Verwendung der Lottie-Bibliothek in der mobilen Anwendung der Bank ü§≤üèº üçÅ üñ≤Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 

 Einmal hat uns der Product Owner gebeten, √ºber die Erstellung eines effektiven Prozesses zur Einf√ºhrung von Animationen in unsere Andro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die Praxis der Verwendung der Lottie-Bibliothek in der mobilen Anwendung der Bank</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/homecredit/blog/459852/">  Hallo Habr! <br><br>  Einmal hat uns der Product Owner gebeten, √ºber die Erstellung eines effektiven Prozesses zur Einf√ºhrung von Animationen in unsere Android / iOS-Anwendung nachzudenken.  Zu diesem Zeitpunkt hatten wir die Aufgabe, den Antrag mit personenbezogenen Daten f√ºr ein Darlehensprodukt vorab auszuf√ºllen, und es dauerte einige Zeit, bis der Server antwortete. W√§hrend dieser Zeit wollten wir eine sch√∂ne Ladeanimation zeigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0f/zx/te/0fzxtebssjpev57e8wic-slkpu8.png" width="300"></div><a name="habracut"></a><br>  Die Aufgabe war klar: Der Designer wollte sch√∂n zeichnen, um beiden den Quellcode zu geben <br>  Plattformen ohne Dopilivaniya seinerseits, und damit es nicht auf √§lteren Ger√§ten verz√∂gert (ja, wir unterst√ºtzen immer noch Android 4.1). <br><br>  <b>Was waren meine Optionen f√ºr die Einf√ºhrung von Animation:</b> <br><br><ol><li>  Stifte mit animiertem Vektor zum Zeichnen.  Das Gute ist, dass das Rendern funktioniert <br>  In einem separaten Thread (beginnend mit API 25) sind die Nachteile die Komplexit√§t der Erstellung solcher Animationen und eine kleine Anzahl von Manipulationen mit Objekten.  F√ºr einfache Animationen funktioniert das alles gut, aber etwas komplizierter, und die H√∂lle beginnt.  Ja, und auf verschiedenen Plattformen werden Sie nicht starten. </li><li>  Gif - sie wiegen viel, haben eine feste Gr√∂√üe, was bedeutet, dass sie nicht normal skalieren.  Und Sie werden keine besonderen Manipulationen mit ihnen vornehmen. </li><li>  Die PNG-Sequenz (kein Kommentar). </li></ol><br>  Ich grub einige Zeit in Richtung der nativen Vektoranimation von Android und GIF (oh mein Gott, wir haben diese Option immer noch in Betracht gezogen), erinnerte mich an die wunderbare Lottie-Bibliothek und zeigte sie meinen Kollegen. <br><br>  Nach einigen Tests mit verschiedenen Ger√§ten haben wir beschlossen, die Bibliothek zu implementieren, zumal ihre Funktionen beeindruckend waren.  Der Designer war besonders begeistert, jetzt konnte er fast jede Animation in Adobe After Effects erstellen und mit wenigen Klicks in eine JSON-Datei exportieren.  Wir waren auch begeistert, aber das Wichtigste zuerst. <br><br>  Lottie wurde von Airbnb als Reaktion auf die wachsende Nachfrage nach plattform√ºbergreifender Animation erfunden und implementiert, sodass es auf allen Plattformen gleich (fast) funktioniert.  Die Entwickler selbst behaupten, dass ihr Ziel darin besteht, die maximale Anzahl von After Effects-Funktionen zu realisieren, und dies ist ihnen gelungen.  Das Einbetten von Lottie-Animationen ist jetzt so einfach wie das Einf√ºgen eines Bildes in ImageView. <br><br>  <b>Schl√ºssel 3 Klassen:</b> <br><br><ol><li>  LottieAnimationView ist der Nachfolger von ImageView und der einfachste Weg, Animationen zu verwenden.  Sie k√∂nnen die Animation in XML beschreiben oder im Code, die meisten Methoden werden unterst√ºtzt. </li><li>  LottieDrawable - Mit Drawable-Nachkommen mit derselben Funktionalit√§t wie in der vorherigen Klasse k√∂nnen Sie Animationen auf jede Ansicht anwenden. </li><li>  Mit LottieComposition und seinem Begleiter LottieCompositionFactory k√∂nnen Sie Animationen aus verschiedenen Quellen vorladen und auf LottieDrawable und LottieAnimationView anwenden. </li></ol><br><h4>  Laden von Ressourcen </h4><br>  Unterst√ºtzt das Laden von Ressourcen aus: <br><br><ol><li>  res / raw </li><li>  src / verm√∂genswerte </li><li>  Json String </li><li>  Jede URL aus dem Netzwerk, die zu einer JSON- oder ZIP-Datei f√ºhrt (implementiert √ºber HttpURLConnection, um keine externen Abh√§ngigkeiten hinzuzuf√ºgen. Wenn Sie eine Animation mit Bildern haben, m√ºssen Sie Zip verwenden.) </li><li>  InputStream JSON- oder ZIP-Datei </li></ol><br><h4>  Animations-Caching </h4><br>  Das Coole ist, dass alle Animationen, die √ºber res / raw oder Assets heruntergeladen wurden, vom LRU-Cache gespeichert werden. Dadurch k√∂nnen wir keine Zeit damit verschwenden, die Animation neu zu laden und zu analysieren, da dies bei komplexen Animationen einige Zeit dauern kann.  Was ist noch cooler, wenn Sie die Animation vorladen m√ºssen und dann im n√§chsten Fragment die Animation sofort anzeigen m√ºssen, k√∂nnen Sie den Code verwenden <br><br><pre><code class="kotlin hljs">LottieCompositionFactory.fromRawRes(context, rawFile)</code> </pre> <br>  Die Animation wird mit der rawFile-Taste zwischengespeichert, und wo Sie sie wirklich ben√∂tigen, beginnt sie fast sofort. <br><br><h4>  Fortschrittsmanagement </h4><br>  Mit Lottie k√∂nnen Sie den aktuellen Animationsstatus √ºber setProgress (...) festlegen.  Dies kann n√ºtzlich sein, wenn Sie den Upload-Status der Datei, die Bildlaufposition, verschiedene Gesten usw. animieren m√∂chten.  Ich habe verschiedene Implementierungen auf BottomSheets, PullToRefresh und CollapsingToolbarLayout gesehen. <br><br>  So verwenden Sie den Fortschritt mit AppBarLayout: <br><br><pre> <code class="kotlin hljs">appBarLayout.addOnOffsetChangedListener(AppBarLayout.OnOffsetChangedListener { appBarLayout, verticalOffset -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> percent = Math.abs(verticalOffset).toFloat()/appBarLayout.totalScrollRange animationView.progress = percent })</code> </pre><br><h4>  Schleifen </h4><br>  Lottie unterst√ºtzt das Schleifen von setRepeatMode () oder setRepeatCount () nicht nur der gesamten Animation, sondern auch aller Fragmente in (0.0 ... 1.0).  Dies wird durch die Eigenschaften setMinFrame, setMaxFrame, setMinAndMaxFrame implementiert.  Wir haben dies verwendet, um nicht 3 Animationen f√ºr verschiedene Datei-Upload-Zust√§nde zu implementieren: Leerlauf, Fortschritt, abgeschlossen.  Hier ist ein kleiner Code, der dies l√∂st: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (loadingStatus) { LoadingStatus.IDLE -&gt; { animationView.setMaxProgress(<span class="hljs-number"><span class="hljs-number">0.1f</span></span>) } LoadingStatus.PROGRESS -&gt; { animationView.setMinAndMaxProgress(<span class="hljs-number"><span class="hljs-number">0.2f</span></span>, <span class="hljs-number"><span class="hljs-number">0.9f</span></span>) animationView.repeatCount = LottieDrawable.INFINITE animationView.playAnimation() } LoadingStatus.COMPLETE -&gt; { animationView.setMinAndMaxProgress(<span class="hljs-number"><span class="hljs-number">0.9f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) animationView.repeatCount = <span class="hljs-number"><span class="hljs-number">1</span></span> animationView.playAnimation() }}</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mi/iw/iu/miiwiupaeldyjmhfegtkruqn9jo.gif" width="250"></div><br><h4>  Bilder </h4><br>  Einer der Hauptvorteile von Lottie war f√ºr uns, dass die Bibliothek das Einf√ºgen von Bildern direkt in die Animation unterst√ºtzt.  Dar√ºber hinaus k√∂nnen Sie sowohl ein statisches als auch ein dynamisches Bild einf√ºgen, das aus dem Internet heruntergeladen wurde.  Jetzt werde ich erkl√§ren, wie es funktioniert. <br><br>  Bei einem statischen Bild ist alles einfach: Der Designer entl√§dt das Archiv mit json und dem Bild selbst. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"v"</span></span>: <span class="hljs-string"><span class="hljs-string">"5.1.13"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fr"</span></span>: <span class="hljs-number"><span class="hljs-number">29.9700012207031</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ip"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"op"</span></span>: <span class="hljs-number"><span class="hljs-number">47.0000019143492</span></span>, <span class="hljs-attr"><span class="hljs-attr">"w"</span></span>: <span class="hljs-number"><span class="hljs-number">1034</span></span>, <span class="hljs-attr"><span class="hljs-attr">"h"</span></span>: <span class="hljs-number"><span class="hljs-number">1334</span></span>, <span class="hljs-attr"><span class="hljs-attr">"nm"</span></span>: <span class="hljs-string"><span class="hljs-string">" 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ddd"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"assets"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"image_0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"w"</span></span>: <span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-attr"><span class="hljs-attr">"h"</span></span>: <span class="hljs-number"><span class="hljs-number">436</span></span>, <span class="hljs-attr"><span class="hljs-attr">"u"</span></span>: <span class="hljs-string"><span class="hljs-string">"images/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p"</span></span>: <span class="hljs-string"><span class="hljs-string">"img_0.png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"comp_0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"layers"</span></span>: [ ... ]}] }</code> </pre> <br>  Dies ist img_0.png, dies ist das Bild, das Sie in src / assets einf√ºgen sollten und das sich in der Animation befindet. <br><br>  F√ºr das dynamische Laden wird die setImageAssetDelegate-Methode verwendet, an die Sie die Bitmap √ºbergeben m√ºssen.  Wir laden das Bild mit Glide vor, sodass beim √ñffnen eines Fragments mit Animation und Bild alles aus dem Cache kommt und alles ziemlich schnell ist.  Hier ist der Code: <br><br><pre> <code class="kotlin hljs">glideLoader.loadAsBitmap(imageUrl).into(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>: CustomTarget&lt;Bitmap&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResourceReady</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resource: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bitmap</span></span></span></span><span class="hljs-function"><span class="hljs-params">, transition: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Transition</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bitmap</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;?)</span></span></span></span> { viewAnimation.setImageAssetDelegate(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>: ImageAssetDelegate { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchBitmap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(asset: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LottieImageAsset</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Bitmap { asset?.let { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resizeBitmap =Bitmap.createScaledBitmap(resource, it.width, it.height, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resizeBitmap } ?: run { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resource } } }) setAnimation(viewAnimation, animationImage) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLoadCleared</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(placeholder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Drawable</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> {} })</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eb/i3/ly/ebi3lylquqmqr2yljlo3jllm-ja.gif" width="250"></div><br><h4>  Leistung </h4><br>  Nat√ºrlich ist es besser, nicht viel Animation auf Bildschirmen zu verwenden, auf denen der Benutzer viel Zeit verbringt, da dies hohe Anforderungen an den Prozessor stellt.  Nach unseren Tests erreicht die Prozessorlast bei einigen Animationen 20%.  Der Idealfall einer solchen Animation sind daher interaktive Elemente, die einmal ausgel√∂st werden. <br><br>  Wenn die Animation auf einigen Ger√§ten langsamer wird, hilft dies manchmal <br><br><pre> <code class="kotlin hljs">viewAnimation.useHardwareAcceleration(<span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br>  Entwickler empfehlen jedoch, diese Methode mit Vorsicht zu verwenden, da verschiedene Telefone die Hardwarebeschleunigung auf unterschiedliche Weise verwenden, sodass Sie anstelle der Beschleunigung den gegenteiligen Effekt erzielen k√∂nnen. <br><br><h4>  Fazit </h4><br>  Im Allgemeinen vereinfacht die Verwendung der Lottie-Bibliothek die Implementierung von Animationen in der Anwendung erheblich. <br><br>  <b>Die Hauptvorteile von Lottie, die wir hervorgehoben haben:</b> <br><br><ol><li>  Kleine Bibliotheksgr√∂√üe (300 kb) </li><li>  Plattform√ºbergreifende L√∂sung ios / android / web </li><li>  Laden Sie Animationen aus dem Internet herunter </li><li>  Fortschrittsmanagement und Looping √ºberall </li><li>  Eine gro√üe Anzahl von Funktionen aus After Effects erm√∂glicht es dem Designer, den beabsichtigten Effekt zu realisieren. </li></ol><br>  <b>Nachteile:</b> <br><br><ol><li>  Das Rendern erfolgt im Hauptthread, und fps k√∂nnen in der Anwendung erheblich sinken. </li><li>  Das Parsen von Lottie-Animationen kann bei komplexen Animationen viel Zeit in Anspruch nehmen. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4v/l9/i7/4vl9i7i2nta0osmi8rj3x6oixzm.gif" width="250"></div><br>  Um zu √ºberpr√ºfen, wie ressourcenintensiv Animation ist, k√∂nnen Sie √ºbrigens die offizielle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lottie-</a> App <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von Google Play verwenden</a> .  Es gibt ein Renderdiagramm, in dem Sie die Zeit zum Rendern eines Frames sehen und sehen k√∂nnen, wie die Animation aussehen wird, wenn Sie sie in Frames schneiden, oder wie sich Hardwarebeschleunigung und vieles mehr auswirken. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de459852/">https://habr.com/ru/post/de459852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de459838/index.html">Schreiben Sie mit Roslyn Analyzers schneller besseren Code</a></li>
<li><a href="../de459840/index.html">XAML Hot Reload f√ºr Xamarin.Forms ver√∂ffentlicht</a></li>
<li><a href="../de459842/index.html">Luxor</a></li>
<li><a href="../de459844/index.html">Pinguin im Fenster: √ºber das Potenzial und die Perspektiven von WSL2</a></li>
<li><a href="../de459850/index.html">Amateurfunktechnologie: Wie ich die Installation einer Leiterplatte in einer chinesischen Fabrik bestellt habe</a></li>
<li><a href="../de459858/index.html">Erkundung der modernen Malware Cerberus f√ºr Android</a></li>
<li><a href="../de459860/index.html">ClickHouse f√ºr Integrationstests in gitlab-ci konfigurieren</a></li>
<li><a href="../de459862/index.html">Berkeley DB STL-Schnittstelle</a></li>
<li><a href="../de459866/index.html">Probleml√∂sung mit pwnable.kr 02 - Kollision. Hash-Kollision</a></li>
<li><a href="../de459870/index.html">Beispiel f√ºr eine Model-View-Update-Architektur in F #</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>