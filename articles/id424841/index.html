<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜¦ ğŸš¢ ğŸ‘©ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ¿ Menyimpan arsip gambar untuk situs di penyimpanan Azure BLOB â˜ğŸ¼ ğŸ¤±ğŸ¿ ğŸˆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini menjelaskan pengalaman mengatur penyimpanan anggaran arsip gambar untuk situs dengan jutaan iklan. 



 Dalam kasus saya, gambar dipahami ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menyimpan arsip gambar untuk situs di penyimpanan Azure BLOB</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424841/"> Artikel ini menjelaskan pengalaman mengatur penyimpanan anggaran arsip gambar untuk situs dengan jutaan iklan. <br><br><img src="https://habrastorage.org/webt/9c/_6/sg/9c_6sgzywejobg-vzsrzgazv7_w.png"><br><a name="habracut"></a><br>  Dalam kasus saya, gambar dipahami sebagai foto apartemen, rumah, plot, dll.  Saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">memiliki proyek</a> saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sendiri</a> yang merupakan situs dengan iklan untuk penjualan dan penyewaan real estat.  Situs ini telah ada selama sekitar 6 tahun dan selama waktu ini sejumlah besar iklan telah terkumpul.  Pada setiap kartu objek foto ditampilkan, rata-rata 8 foto per iklan.  Sebenarnya, saya akan menyimpan foto-foto ini di cloud sehingga nanti saya bisa menunjukkannya kepada pengunjung di kartu objek. <br><br>  Bagaimana saya menyimpannya sebelumnya?  - tidak mungkin.  Saya tidak menyimpan gambar kecuali gambar yang ditempatkan secara manual.  Dalam kebanyakan kasus, iklan masuk ke situs melalui mitra melalui unggahan feed otomatis.  Dalam umpan untuk setiap objek ada tautan ke foto - saya menyimpan tautan dan memberi pengunjung foto langsung dari mitra.  Sirkuit ini berfungsi dengan baik dan menghemat banyak sumber daya. <br><br>  Foto yang dilihat pengunjung dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pemilihan iklan</a> atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kartu objek</a> sebenarnya diambil dari sumber daya pihak ketiga. <br><br>  Ada satu peringatan terkait dengan spesifikasi situs - objek arsip tidak pernah dihapus.  Yaitu  setelah iklan dihapus dari publikasi, tentu saja menghilang dari hasil pencarian, tetapi tautan langsung selalu tersedia (tanpa kontak penjual).  Untuk beberapa waktu, tautan ke foto masih hidup, terkadang selama bertahun-tahun, tetapi cepat atau lambat mereka akan mati.  Objek yang diarsipkan sangat berharga karena pengunjung dari mesin pencari terus mendatanginya.  Juga, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">peta harga</a> dibangun dari arsip (saya sudah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menulis tentang itu</a> ), dan saya tidak sengaja menemukan sumber pendapatan tambahan untuk proyek dalam bentuk menjual informasi kontak benda-benda arsip.  Mengapa mereka membelinya, saya tidak tahu pasti, tetapi saya kira pengunjung ingin mendapatkan kontak karena mereka berpikir bahwa iklan telah dihapus dari publikasi karena kecelakaan atau karena kesalahan.  Mungkin juga terjadi bahwa mereka ingin belajar sesuatu dari pemilik sebelumnya.  Dengan satu atau lain cara, iklan dengan foto dalam hal ini lebih mungkin untuk dibeli.  Nilai foto meningkat setelah kesadaran akan nuansa ini. <br><br>  Jumlah data yang akan saya simpan di cloud sekitar 3-4 terabyte.  Ditambah perolehan harian beberapa gigabytes.  Mengingat bahwa inovasi ini tidak akan secara langsung menghasilkan uang, itu hanya dapat secara tidak langsung mempengaruhi pengambilan keputusan oleh pengunjung, anggaran di mana saya ingin bertemu dengan yang sangat sederhana adalah 1000-2000 r.  per bulan.  Akan menyenangkan sekali gratis, tetapi saya tidak menemukan kesempatan seperti itu. <br><br><h2>  Azure </h2><br>  Saya entah bagaimana segera melihat ke arah Azure karena saya bekerja di .net, dan sering melihat artikel iklan yang indah tentang topik ini.  Plus, saya harus menggunakan platform ini untuk pekerjaan utama saya, tetapi di sana kemampuan saya dibatasi oleh persyaratan bisnis dan keinginan manajemen. <br><br>  Azure menawarkan penyimpanan BLOB dengan tiga tingkatan penyimpanan: Panas, Dingin, dan Arsip.  Harga di semua level berbeda.  Secara umum, semakin panas semakin murah membaca / menulis dan semakin mahal biaya penyimpanan bulanan, dan sebaliknya.  On Hot - bermanfaat untuk menulis / membaca dan menghapus banyak, tetapi mahal untuk menyimpannya untuk waktu yang lama.  Arsip murah untuk disimpan tetapi mahal untuk membaca / menulis.  Juga, pada tingkat arsip dan dingin, ada biaya untuk penghapusan awal - ini berarti bahwa jika saya menghapus (atau mentransfer ke tingkat lain) suatu objek lebih awal dari periode tertentu, maka saya masih akan dikenakan biaya untuk seluruh periode.  Untuk tingkat arsip, ini adalah 180 hari, untuk dingin - 30. <br><br><h2>  Harga </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Biaya penyimpanan</a> adalah $ 0,0023 per GB per bulan di tingkat arsip, $ 0,01 pada dingin dan $ 0,0196 pada panas.  Pada tingkat saat ini, ini adalah sekitar 0,15, 0,65 dan 1,28 rubel, masing-masing. <br><br>  Saya membandingkannya dengan biaya di Amazon dan Google, ternyata Azure lebih murah. <br><br><table><tbody><tr><td></td><td>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Azure</a></b> </td><td>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Amazon (S3)</a></b> </td><td>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Google</a></b> </td></tr><tr><td>  <b>Panas</b> </td><td>  $ 0,0196 </td><td>  $ 0,024 </td><td>  $ 0,026 </td></tr><tr><td>  <b>Keren</b> </td><td>  $ 0,01 </td><td>  $ 0,01 </td><td>  $ 0,01 </td></tr><tr><td>  <b>Arsipkan</b> </td><td>  $ 0,0023 </td><td>  $ 0,0045 </td><td>  $ 0,007 </td></tr></tbody></table><br><br>  Selain biaya penyimpanan, perlu untuk memperhitungkan biaya operasi - mereka juga berbeda di semua tingkatan.  Harga berlaku untuk 10.000 transaksi. <br><br>  <b>Panas</b> <br>  Baca: $ 0,0043, Tulis: $ 0,054 <br><br>  <b>Keren</b> <br>  Baca: $ 0,01, Tulis: $ 0,10 <br><br>  <b>Arsipkan</b> <br>  Baca: $ 6, Tulis: $ 0,12 <br><br><h2>  Logika kerja </h2><br><br>  Saat iklan aktif, foto di dalamnya ditampilkan oleh tautan dari sumber pihak ketiga (dari mitra).  Setelah pengumuman dihapus dari publikasi, itu menjadi arsip, tetapi tautan ke foto masih hidup untuk beberapa waktu.  Cepat atau lambat, mereka mati, dan Anda perlu memastikan bahwa saat ini sudah ada salinan arsip. <br><br>  Proses pemrosesan foto dapat dijelaskan dalam langkah-langkah berikut: <br><br><ol><li>  Segera setelah iklan menghilang dari file impor mitra, mis.  mitra berhenti mempublikasikannya, sebuah entri terbentuk dalam antrian prioritas, di mana prioritasnya adalah jumlah tampilan oleh pengunjung - semakin banyak tampilan, semakin besar kemungkinan arsip diarsipkan, objek akan dilihat lebih lanjut. </li><li>  Saat memproses catatan dari antrian, objek BLOB terbentuk berisi foto yang berkurang (hingga 800x600) untuk iklan.  Penggunaan objek komposit daripada foto langsung juga karena penghematan - alih-alih 8 operasi perekaman (rata-rata 8 foto per objek), satu dilakukan, dan setiap operasi membutuhkan biaya. </li><li>  BLOB dimuat pertama kali di Hot, dan kemudian segera ditransfer ke arsip.  Tidak ada kemungkinan untuk menulis langsung ke arsip, dan karena Cool memiliki biaya untuk penghapusan awal, lebih murah untuk menggunakan Hot sebagai transit. </li><li>  Arsip BLOB selama tautan ke foto asli aktif (foto sejauh ini ditunjukkan oleh tautan dari mitra). </li><li>  Tautan diperiksa untuk fungsionalitas ketika pengunjung mengunjungi kartu objek - jika mereka pergi ke sana, maka objek tersebut populer dan masuk akal untuk mengembalikan foto dari arsip. </li><li>  Jika tautan ke foto asli telah mati, saya memeriksa apakah ada salinan arsip, dan jika demikian, saya mengirim permintaan untuk memulihkan dari arsip ke Dingin (mungkin diperlukan hingga 15 jam untuk mengembalikan gumpalan dari arsip - ini disebut rehidrasi dari Microsoft). </li><li>  Setelah BLOB telah dipulihkan dari arsip, itu disalin ke penyimpanan lokal dan dibagi menjadi foto normal.  Penyimpanan lokal adalah hard drive server saya. </li><li>  Foto pada kartu pengumuman sudah diberikan dari penyimpanan lokal. </li><li>  Foto disimpan di penyimpanan lokal selama beberapa hari.  Jika selama ini ada pemindaian, periode penyimpanan lokal diperpanjang.  Jika tidak ada tampilan, foto akan dihapus dari penyimpanan lokal, tetapi tetap pada level Cool di Azure. </li><li>  Dari Cool ke Archive mereka disalin jika tidak ada tampilan selama dua bulan - objek jelas tidak populer dan, karenanya, tidak masuk akal untuk membayar lebih untuk penyimpanan di Cool. </li></ol><br><br><h2>  Peluncuran pertama </h2><br>  Ketika proses itu ditulis dan diuji, tiba saatnya untuk percobaan, dan ada masalah yang diharapkan.  Dalam antrian pada waktu itu ada sekitar 10 juta objek, saya memutuskan untuk memulai migrasi dari 30.000 objek per hari.  Siapkan grafik yang indah di dasbor dan mulai mengamati.  Dalam statistik, saya melihat "lunges" aneh dengan permintaan GetBlobProperties.  Mereka terjadi dengan interval kira-kira sama satu jam, selalu mulai sekitar satu setengah jam setelah dimulainya migrasi, dan berlangsung selama beberapa waktu setelah selesai. <br><br><img src="https://habrastorage.org/webt/wm/qx/qr/wmqxqrsvn7zctu-xyulyvr-25wu.png"><br><br>  Jumlah permintaan semacam itu terlalu besar untuk diabaikan.  Saya melihat log dan melihat bahwa permintaan ini tidak datang dari server saya tetapi dari alamat IP asing.  Saya tidak mau membayar untuk mereka sama sekali. <br><br>  Saya mencari di tumpukan dan di dokumentasi, tetapi tidak berhasil.  Menulis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pertanyaan tentang Stackoverflow</a> dan dukungan teknis.  Akibatnya, setelah korespondensi yang panjang dengan dukungan teknis, dan memberi mereka log, mereka mengatakan kepada saya bahwa mereka dapat mereproduksi situasi dan ini adalah bug di pihak mereka. <br><br>  Nuansa yang menarik adalah bahwa pertanyaan saya tentang Stackoverflow dijawab tidak menjelaskan alasannya, tetapi hanya menegaskan bahwa saya akan membayar untuk permintaan ini, tetapi orang yang memberikan jawaban dengan tegas meminta saya untuk menandainya sebagai benar.  Dia juga mengisyaratkan untuk menyampaikan kepada saya bahwa mereka (dalam dukungan) tidak dapat menyebarkan bug di produk mereka sendiri.  Saya memberi tahu dia bahwa saya tidak akan melakukannya sampai dia menulis kebenaran.  Saya dapat menulis ini sendiri, tetapi saya berpikir bahwa staf dukungan teknis mungkin mengukur jumlah jawaban yang dikonfirmasi, jadi saya memintanya untuk menulis alasan yang sebenarnya dan dalam hal ini saya menandai jawabannya sebagai benar.  Setelah ragu-ragu, dia setuju dan menambahkan komentarnya dengan laporan bug.  Secara umum, saya menyukai cara kerja dukungan teknis - saya bahkan dipindahkan ke seorang gadis Rusia yang masih membuat saya tahu tentang perubahan pada masalah ini. <br><br>  Fakta bahwa bug itu dikenali hanya memuaskan saya secara moral, tetapi saya ingin menjalankan mekanisme itu, dan pada saat yang sama tidak membayar uang untuk permintaan kidal.  Terutama mengingat bahwa saya biasanya menjadi bingung untuk meminimalkan jumlah permintaan dan biaya. <br><br>  Dalam dukungan teknis, mereka menyarankan saya untuk menunggu dengan peluncuran dan setelah beberapa minggu mereka menulis bahwa bug telah diperbaiki, tetapi ketika rilis dengan perbaikannya akan diketahui, tidak diketahui.  Mereka menawarkan untuk mengaktifkan pencatatan dan bekerja seperti itu, dan setelah rilis, meminta kompensasi di Microsoft.  Sebenarnya, dalam mode ini, masih berfungsi.  Setiap hari saya memulai migrasi sejumlah kecil objek dan menunggu rilis. <br><br><h2>  Kesimpulan </h2><br>  Biaya 30.000 objek harian masih 900 p.  per bulan - dan ini cukup dapat diterima.  Sebagian besar biaya adalah operasi tulis.  Jadi ketika seluruh antrian diproses dan tahap pekerjaan yang direncanakan dimulai, akan menjadi jelas berapa biaya sebenarnya dari penyimpanan semacam itu.  Tetapi menurut perhitungan saya, ini akan terjadi dalam waktu sekitar satu tahun. <br><br>  Ketika akan ada rilis di Azure Blob-storage, saya akan menambahkan di sini apakah saya berhasil mendapatkan kompensasi.  Mengenai biaya bulanan, ini sekitar 10% dari biaya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id424841/">https://habr.com/ru/post/id424841/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id424823/index.html">Bagaimana Nutrisi Rendah Kalori Mempengaruhi Penuaan</a></li>
<li><a href="../id424825/index.html">Robot dan Komunisme</a></li>
<li><a href="../id424827/index.html">Ilusi ruang: bagaimana Spiderman baru membuat kamar tanpa geometri</a></li>
<li><a href="../id424831/index.html">Apa yang diinvestasikan dalam ekonomi digital</a></li>
<li><a href="../id424835/index.html">Cara mengurangi risiko investasi di bursa: 3 faktor diversifikasi</a></li>
<li><a href="../id424843/index.html">Apakah IBOutlet pribadi di aplikasi iOS Anda?</a></li>
<li><a href="../id424845/index.html">Menghitung Kotak Ajaib Menggunakan GPU</a></li>
<li><a href="../id424847/index.html">MNaaS dan eSIM - pro dan kontra dari virtualisasi untuk operator seluler dan pelanggan mereka</a></li>
<li><a href="../id424849/index.html">Apa yang membuat UCS C480 ML M5 baru menarik - server pembelajaran mesin dari Cisco</a></li>
<li><a href="../id424851/index.html">Apa yang salah dengan mempekerjakan IT?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>