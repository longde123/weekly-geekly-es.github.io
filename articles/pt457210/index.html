<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è© ü§µ ü§¥üèø Armazene recursos est√°ticos em sua hospedagem üë©‚Äç‚öïÔ∏è üé† üêì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Uma das primeiras coisas que recomendo aos meus clientes para acelerar os sites parecer√° um paradoxo no in√≠cio: voc√™ precisa colocar recursos est√°tico...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Armazene recursos est√°ticos em sua hospedagem</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457210/">  Uma das primeiras coisas que recomendo aos meus clientes para acelerar os sites parecer√° um paradoxo no in√≠cio: voc√™ precisa colocar recursos est√°ticos em sua hospedagem, abrindo m√£o de uma infraestrutura CDN de terceiros.  Neste post curto e, espero, muito simples, quero descrever as desvantagens de armazenar seus arquivos est√°ticos "de lado" e as vantagens incr√≠veis de hosped√°-los na minha hospedagem. <br><a name="habracut"></a><br><h4>  Do que estou falando? </h4><br>  √â comum que os desenvolvedores cliquem no link para ativos est√°ticos, como bibliotecas ou plugins, localizados em sites e recursos da CDN.  Um exemplo cl√°ssico √© o jQuery. <br><br>  Existem v√°rias vantagens √≥bvias, mas meu objetivo mais adiante neste artigo √© expor essa abordagem e mostrar que as desvantagens s√£o muito mais prevalentes. <br><br>  (Primeiro, considere os benef√≠cios). <br><br><ul><li>  <b>Isso √© conveniente.</b>  Isso requer muito pouco esfor√ßo para conectar arquivos.  Copie a linha do c√≥digo HTML e pronto.  F√°cil. </li><li>  <b>Temos acesso √† CDN.</b>  code.jquery.com √© fornecido pelo StackPath, √© uma CDN.  Ao conectar-se ao conte√∫do deste recurso, obtemos entrega com qualidade CDN, gratuitamente. </li><li> <b>Os arquivos do usu√°rio j√° podem estar armazenados em cache.</b>  Se website-a.com vincular a <a href="">code.jquery.com/jquery-3.3.1.slim.min.js</a> e o usu√°rio for daqui para website-b.com, que tamb√©m vincula a <a href="">code.jquery.com/jquery-3.3 .1.slim.min.js</a> , o usu√°rio ter√° esse arquivo no cache. </li></ul><br><h4>  Risco: queda de velocidade e falhas </h4><br>  N√£o vou entrar em muitos detalhes neste post.  Tenho um artigo completo sobre a viabilidade de terceiros e os riscos associados a atrasos e interrup√ß√µes.  Basta dizer que, se voc√™ tiver recursos cr√≠ticos associados a provedores de terceiros, e se o provedor sofrer falhas e queda de velocidade ou indisponibilidade, isso √© uma not√≠cia bastante desagrad√°vel para voc√™.  Voc√™ tamb√©m sofrer√° com isso. <br><br>  Se voc√™ tiver algum CSS de bloqueio de renderiza√ß√£o ou JS s√≠ncrono hospedado em recursos de terceiros, prossiga e transfira-os para sua pr√≥pria infraestrutura imediatamente.  Os ativos cr√≠ticos s√£o valiosos demais para serem deixados em servidores de terceiros. <br><br><h4>  Risco: rescis√£o do servi√ßo </h4><br>  Essa √© uma ocorr√™ncia muito menos comum, mas o que acontece se o provedor decidir que precisa interromper o servi√ßo?  Foi exatamente o que o Rawgit fez em outubro de 2018, at√© o momento (no momento da reda√ß√£o), uma pesquisa grosseira no c√≥digo do GitHub ainda fornece mais de um milh√£o de links para o servi√ßo, que est√° sendo fechado no momento, e quase 20.000 sites existentes continuam sendo consulte-o. <br><br><h4>  Risco: vulnerabilidades de seguran√ßa </h4><br>  Outra coisa a prestar aten√ß√£o √© uma simples quest√£o de confian√ßa.  Se trouxermos conte√∫do de recursos de terceiros para nossa p√°gina, esperamos que os arquivos que recebemos sejam exatamente o que esperamos receber e que fa√ßam exatamente o que esperamos deles. <br><br>  Imagine o dano que poderia ser causado se algu√©m pudesse obter o controle de um provedor como o code.jquery.com e come√ßar a entregar conte√∫do comprometido ou malicioso.  √â assustador pensar nisso! <br><br><h4>  Integridade do sub-recurso </h4><br>  Devemos prestar homenagem a todos os fornecedores de terceiros mencionados at√© agora neste artigo, eles est√£o fazendo de tudo para garantir a integridade do sub-recurso (Subresource Integrity - SRI).  SRI √© o mecanismo pelo qual o provedor fornece o hash (tecnicamente, um hash seguido pela codifica√ß√£o Base64) do arquivo espec√≠fico que voc√™ espera e pretende usar.  O navegador pode verificar se o arquivo que voc√™ recebeu √© exatamente o que voc√™ solicitou. <br><br><pre><code class="plaintext hljs">&lt;script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"&gt;&lt;/script&gt;</code> </pre> <br>  Mais uma vez, se voc√™ definitivamente precisar conectar conte√∫do est√°tico a um recurso de terceiros, verifique se o SRI est√° ativo.  Voc√™ pode conectar o SRI voc√™ mesmo. <br><br><h4>  Acerto de contas: negocia√ß√µes de rede </h4><br>  Um dos custos maiores e mais urgentes em que incorremos √© o custo da abertura de novas conex√µes TCP.  Cada novo recurso que precisamos visitar exige a abertura de uma conex√£o, o que pode ser muito caro: resolu√ß√£o DNS, handshake TCP, negocia√ß√£o TLS, tudo isso contribui, e a hist√≥ria fica pior √† medida que a conex√£o atrasa. <br><br>  Vou dar um exemplo extra√≠do diretamente da p√°gina de introdu√ß√£o do Bootstrap.  Eles instruem os usu√°rios a anexar quatro arquivos. <br><br>  Esses quatro arquivos est√£o localizados em tr√™s recursos diferentes, ou seja, precisamos abrir tr√™s conex√µes TCP.  Quanto custa?  Bem, com uma conex√£o bastante r√°pida, o conte√∫do desses arquivos est√°ticos ao lado √© 311ms ou 1,65x mais lento do que quando voc√™ os coloca em sua pr√≥pria hospedagem. <br><br>  Ao entrar em contato com tr√™s fontes diferentes para a manuten√ß√£o de ativos est√°ticos, perdemos coletivamente os 805ms desnecess√°rios para aprova√ß√µes de rede. <br><br>  OK, n√£o √© t√£o assustador, mas a Trainline, meu cliente, descobriu que quando o atraso era reduzido em 300ms, os visitantes pagavam 8 milh√µes de libras adicionais por ano.  Esta √© uma maneira muito f√°cil de ganhar 8 milh√µes. <br><br>  Apenas movendo nossos recursos para o seu dom√≠nio, eliminamos completamente o custo de conex√µes adicionais. <br><br>  Para uma conex√£o mais lenta, com um atraso maior, a hist√≥ria √© muito pior.  Para 3G, a vers√£o de terceiros √© mais lenta que a 1.765s.  Eu pensei que era para tornar nosso site mais r√°pido. <br><br>  Ao se conectar com um grande atraso, os custos totais da rede s√£o monstruosos 5.037s.  O que pode ser completamente evitado. <br><br>  Mover arquivos para nossa pr√≥pria infraestrutura reduz o tempo de download de 5.4s para 3.6s. <br><br>  Se esse n√£o √© um bom motivo para hospedar seus recursos est√°ticos, n√£o sei mais o que trazer. <br><br><h4>  Pr√©-conex√£o </h4><br>  Naturalmente, o ponto principal da minha apresenta√ß√£o aqui √© que voc√™ n√£o deve publicar nenhum recurso est√°tico ao lado se conseguir fazer isso em sua hospedagem.  No entanto, se suas m√£os estiverem atadas de alguma forma, voc√™ poder√° usar a pr√©-conex√£o Dica de Recurso para abrir proativamente uma conex√£o TCP com uma (s) fonte (s) espec√≠fica (s): <br>  <b>Nota</b>  Mesmo se voc√™ usar a pr√©-conex√£o, a quantidade de tempo perdida diminuir√° apenas um pouco: voc√™ ainda precisar√° abrir as conex√µes correspondentes e √© improv√°vel que os custos sejam justificados, especialmente para conex√µes lentas. <br><br><h4>  Acerto de contas: perda de prioriza√ß√£o </h4><br>  O segundo acerto de contas vem na forma de otimiza√ß√£o no n√≠vel do protocolo, que perdemos quando dividimos o conte√∫do em dom√≠nios.  Se voc√™ usa HTTP / 2, o que deve ser feito, voc√™ obt√©m acesso √† prioriza√ß√£o. <br><br>  Todos os fluxos (portanto, recursos) com a mesma conex√£o TCP mant√™m a prioridade, e o navegador e o servidor trabalham em conjunto para criar a √°rvore de depend√™ncia de todos esses fluxos priorizados, para que possamos retornar recursos cr√≠ticos mais rapidamente e, possivelmente, atrasar a entrega dos menos importantes. <br><br>  <b>Nota</b>  Tecnicamente, devido √† mesclagem de conex√µes HTTP / 2, as solicita√ß√µes podem ser priorizadas entre si em dom√≠nios diferentes, desde que compartilhem o mesmo endere√ßo IP. <br><br>  Se distribuirmos nossos recursos por diferentes dom√≠nios, teremos que abrir v√°rias conex√µes TCP exclusivas.  N√£o podemos cruzar prioridades de refer√™ncia para essas conex√µes, ou seja, perdemos a capacidade de entregar arquivos de uma certa maneira bem pensada. <br><br>  Ao hospedar todo o conte√∫do em uma hospedagem, podemos criar uma √°rvore de depend√™ncia mais complexa.  Cada encadeamento possui seu pr√≥prio ID, pois eles pertencem √† mesma √°rvore.  Se fornecermos o m√°ximo de conte√∫do poss√≠vel de um dom√≠nio, podemos permitir que o HTTP / 2 fa√ßa seu trabalho e priorize os ativos mais plenamente, na esperan√ßa de uma resposta mais r√°pida. <br><br><h4>  Armazenamento em cache </h4><br>  Em geral, os hosts de recursos est√°ticos parecem se sair muito bem ao definir diretivas de dura√ß√£o m√°xima de longa dura√ß√£o.  Isso faz sentido, pois o conte√∫do est√°tico nos URLs com vers√£o (como mencionado acima) nunca ser√° alterado.  Isso torna muito seguro e racional aplicar uma pol√≠tica de cache razoavelmente agressiva. <br><br>  No entanto, esse nem sempre √© o caso e, ao colocar seus recursos independentemente, voc√™ pode desenvolver muito mais estrat√©gias de armazenamento em cache individuais. <br><br><h4>  Mito: Armazenamento em cache entre dom√≠nios </h4><br>  Mais interessante √© a capacidade de cache de ativos entre dom√≠nios.  Ou seja, se muitos sites apontam para a mesma vers√£o do jQuery, localizada na CDN, certamente os usu√°rios j√° possuem esse arquivo espec√≠fico em seu computador.  Algo como compartilhamento de recursos ponto a ponto.  Esse √© um dos argumentos mais comuns para o uso de um provedor de ativos est√°ticos de terceiros. <br><br>  Infelizmente, n√£o h√° evid√™ncias publicadas para apoiar essas alega√ß√µes: n√£o h√° raz√£o para acreditar que isso seja verdade.  Por outro lado, um estudo recente de Paul Calvano sugere que o oposto pode ser verdadeiro: <br><br>  H√° uma lacuna percept√≠vel entre a idade do cache de recursos CSS e as fontes da web de primeiro e de terceiros.  95% das fontes de terceiros t√™m mais de uma semana, em compara√ß√£o com 50% das fontes de terceiros com menos de uma semana.  Isso fornece bons motivos para fontes da web auto-hospedadas. <br><br>  Em geral, parece que o conte√∫do de terceiros √© armazenado em cache pior que o pr√≥prio. <br><br>  Ainda mais importante, o Safari desativou completamente esse recurso devido a preocupa√ß√µes com abuso de privacidade; portanto, a tecnologia de cache compartilhado pode n√£o funcionar no momento da reda√ß√£o deste artigo para 16% dos usu√°rios em todo o mundo. <br><br>  Em resumo, embora isso seja teoricamente bom, n√£o h√° evid√™ncias de que o cache entre dom√≠nios seja de alguma forma eficiente. <br><br><h4>  Acesso CDN </h4><br>  Outro benef√≠cio generalizado de entrar em contato com um provedor de recursos est√°ticos √© que ele provavelmente usar√° uma infraestrutura poderosa com recursos de CDN: distribui√ß√£o global, escalabilidade, baixa lat√™ncia e alta disponibilidade. <br><br>  Como isso √© absolutamente verdade, se voc√™ se importa com seu desempenho, deve executar seu pr√≥prio conte√∫do a partir da CDN.  Com o n√≠vel dos pre√ßos atuais de hospedagem, existem muito poucas desculpas para voc√™ n√£o estar usando isso para seus recursos. <br><br>  Em outras palavras: se voc√™ acha que precisa de uma CDN para o seu jQuery, precisar√° de uma CDN para tudo. <br><br><h4>  Hospede recursos est√°ticos em sua hospedagem </h4><br>  De fato, existem muito poucas raz√µes para deixar seus recursos est√°ticos na infraestrutura de outra pessoa.  Os benef√≠cios poss√≠veis costumam ser um mito e, mesmo que n√£o, os compromissos simplesmente n√£o valem a pena.  Carregar recursos de diferentes fontes √© muito mais lento.  Nos pr√≥ximos dias, gaste dez minutos auditando seus projetos e assuma o controle de todos os recursos est√°ticos de terceiros. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt457210/">https://habr.com/ru/post/pt457210/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt457200/index.html">Um rob√¥ de desenho para realizar cenas do cotidiano e at√© hist√≥rias</a></li>
<li><a href="../pt457202/index.html">Como escolhemos id√©ias para o desenvolvimento de nossos produtos: o fornecedor deve poder ouvir ...</a></li>
<li><a href="../pt457204/index.html">Windows PowerShell e caminhos longos</a></li>
<li><a href="../pt457206/index.html">SQL Index Manager - uma longa hist√≥ria sobre o SQL Server, escava√ß√µes graves e manuten√ß√£o de √≠ndices</a></li>
<li><a href="../pt457208/index.html">Gerando robots.txt dinamicamente para sites ASP.NET Core com base no ambiente</a></li>
<li><a href="../pt457212/index.html">Por que nunca √© tarde para come√ßar a aprender Java (ou outras linguagens Java)</a></li>
<li><a href="../pt457224/index.html">Uma abordagem moderna da concorr√™ncia no Android: Corotins no Kotlin</a></li>
<li><a href="../pt457232/index.html">Abelha rob√¥ "Bumble" - o primeiro v√¥o de teste dentro da ISS</a></li>
<li><a href="../pt457234/index.html">Vi√©s cognitivo do produto</a></li>
<li><a href="../pt457236/index.html">Como uma empresa de TI lutou para vender m√∫sica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>