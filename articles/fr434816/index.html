<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🤝‍👨🏻 😚 😦 Detox et Appium: Test d'interface automatisé dans React Native 🚊 ⌨️ 💃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Environnement mobile inconnu 
 Je suis peut-être, comme vous, venu chez React Native en tant que développeur JavaScript, plutôt qu'en tant que dévelop...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Detox et Appium: Test d'interface automatisé dans React Native</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434816/"><img src="https://habrastorage.org/webt/xx/gv/pp/xxgvpps9vbr5q2jkamchgmd-quk.jpeg"><br><br><h3>  Environnement mobile inconnu </h3><br>  Je suis peut-être, comme vous, venu chez React Native en tant que développeur JavaScript, plutôt qu'en tant que développeur d'applications mobiles natives.  Un monde complètement nouveau avec ses propres nuances et astuces. <br><br>  L'un des sujets les plus importants à étudier sera le test.  Lorsque tout est plus ou moins clair avec les tests unitaires, que faire des tests d'interface et des tests de bout en bout?  iOS  Android  Il existe un mélange de différents types d'appareils sur le marché. <br><br>  Malgré le fait que la technologie elle-même soit relativement nouvelle, c'est toujours un environnement mobile et beaucoup doivent emprunter et apprendre du côté natif. <br><br>  J'examinerai brièvement deux cadres auxquels il convient de prêter attention afin de me faciliter la vie en tant que développeur. <br><a name="habracut"></a><br><h3>  Appium </h3><br>  En utilisant Selenium WebDriver dans les coulisses, Appium est un cadre puissant avec une énorme communauté de développeurs d'applications mobiles natives.  Sorti avant React.js, c'est un leader et n'a pas d'égal. <br><br>  Débuter avec Appium est assez simple.  En utilisant npm, nous installons les packages «appium» et «appium-doctor», nous pouvons globalement, nous pouvons le faire dans le cadre du projet.  L'équipe «appium-doctor» nous indiquera ce qui doit être installé et configuré avant de commencer les travaux et, si possible, aidera à corriger les défauts.  Lorsque tout est décidé, les packages sont installés et la configuration Jest est en place, nous pouvons exécuter le serveur Appium et les tests. <br><br>  Je n'entrerai pas dans les détails de la configuration, mais voici à quoi ressemble un simple test avec la configuration (commentaires ajoutés): <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*  selenium webdriver  node */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wd <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'wd'</span></span> <span class="hljs-comment"><span class="hljs-comment">/* 60  ,    ,   */</span></span> jasmine.DEFAULT_TIMEOUT_INTERVAL = <span class="hljs-number"><span class="hljs-number">60000</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   Appium.    ,  localhost */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> URL = <span class="hljs-string"><span class="hljs-string">'localhost'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PORT = <span class="hljs-number"><span class="hljs-number">4723</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   webdriver */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> driver = wd.promiseChainRemote(URL, PORT) <span class="hljs-comment"><span class="hljs-comment">/*  . *    Appium, *   ,   . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> capabilities = { <span class="hljs-attr"><span class="hljs-attr">platformName</span></span>: <span class="hljs-string"><span class="hljs-string">'iOS'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  Android platformVersion: '12.1', //   deviceName: 'iPhone 8', //  “Android Emulator”     automationName: 'XCUITest', //   (UIAutomator2  Android) app: '/path/to/.app' //   .app ( Android  .apk) } beforeAll(async () =&gt; { try { //  ,    await driver.init(capabilities) //   await driver.sleep(4000) //  ,       ,   ! } catch(err) { console.log(err) //  ,   ,    } }) afterAll(async () =&gt; { try { await driver.quit() //   } catch(err) { console.error(err) } }); /* Jest,   ,   Appium! *     ,    * 'topLabel'  'subLabel'  *       Appium */ describe("Home Screen landing", () =&gt; { test("render search screen", async () =&gt; { let topLabel = await driver.elementById('topLabel') let subLabel = await driver.elementById('subLabel') expect(await topLabel.text()).toBe("OK") expect(await subLabel.text()).toBe(" ") }) })</span></span></code> </pre> <br>  Le test lui-même, ce sont les dernières lignes qui vérifient si le texte «OK» et «écran principal» sont à l'écran.  Comme vous pouvez le voir, rien de spécial dans le test, le même Jest.  La documentation sur le site Web d'Appium décrit toutes les fonctionnalités du framework, y compris des exemples JavaScript. <br><br>  <code>await driver.sleep(4000)</code> n'aime pas <code>await driver.sleep(4000)</code> .  Malheureusement, les tests n'ont aucune idée de ce qui se passe dans l'application.  La soi-disant «boîte noire» ou Blackbox.  Imaginez si vous écriviez du code sur Node, et avant la requête http, vous définiriez une minuterie au lieu d'utiliser la promesse ou le rappel.  Voilà, la fragilité des tests d'interface. <br><br>  Dans ce test simple, nous attendons 4 secondes pour lancer l'application.  Au fil du temps et avec une augmentation du nombre de tests, nous réglerons plus souvent les temporisations - requêtes http, animation, React Native lui-même - le pont entre le code natif et JavaScript ne fait que compliquer la situation. <br><br>  <i>"Black Box", nous avons l'assemblage de l'application sans accès aux structures internes.</i> <br><img src="https://habrastorage.org/webt/pt/zs/cp/ptzscp_jlpii4ltt8ahqzhghtyq.png"><br><br>  <b>Qu'aimez-vous chez Appium?</b> <br><br><ul><li>  7+ ans dans l'industrie. </li><li>  Fonctionnalités API étendues. </li><li>  Aide facile à trouver (c'est aussi un inconvénient, la liste ci-dessous) </li><li>  Prise en charge de différentes langues, y compris JavaScript. </li><li>  Un environnement de développement JavaScript familier pour Jest. </li><li>  Utilisé pour les tests de bout en bout dans MS AppCenter, BrowserStack et AWS DeviceFarm. </li><li>  La possibilité de tester sur de vrais appareils. </li></ul><br>  <b>Ce que je n'aime pas chez Appium</b> <br><br><ul><li>  Les recherches Web renvoient des résultats pour différents langages de programmation, la plupart d'entre eux Java. </li><li>  Test de la boîte noire (les tests ne connaissent pas les processus à l'intérieur de l'application). </li><li>  Il n'y a pas de synchronisation avec l'application, la fragilité, React Native crée encore plus de problèmes. </li><li>  testID pour une raison quelconque ne fonctionne pas sur Android. </li></ul><br><br>  <i>Remarquez trois onglets: les journaux du serveur Appium, le bundler metro et le test lui-même.</i> <br><img src="https://habrastorage.org/webt/ap/n-/pm/apn-pmr1nkmzno2m728ljq39tb8.png"><br><br><h3>  Detox </h3><br>  Detox de Wix fonctionne de manière similaire à Appium.  La principale différence est le test selon la stratégie de la «boîte grise».  L'une des tâches des développeurs Detox était de résoudre les problèmes de fragilité - la tâche dans l'application ne sera pas démarrée avant la fin de la précédente et jusqu'à ce que l'application soit gratuite.  Cela a été rendu possible grâce à un autre framework créé sous le nom EarlGrey. <br><br>  Comme pour Appium, nous définissons les paramètres. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*     package.json,   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> detox = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"detox"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"./package.json"</span></span>).detox; <span class="hljs-comment"><span class="hljs-comment">/*  Jest */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> adapter = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"detox/runners/jest/adapter"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* , *   Jest */</span></span> jest.setTimeout(<span class="hljs-number"><span class="hljs-number">120000</span></span>); jasmine.getEnv().addReporter(adapter); beforeAll(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> detox.init(config); }); <span class="hljs-comment"><span class="hljs-comment">/* beforeEach  afterEach   Detox, *   Jest *    */</span></span> beforeEach(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> adapter.beforeEach(); }); afterAll(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> adapter.afterAll(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> detox.cleanup(); });</code> </pre><br>  Et en définissant dans package.json: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"detox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"configurations"</span></span>: { <span class="hljs-string"><span class="hljs-string">"ios.detox"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">//   iOS (  detox test -c ios.detox) "binaryPath": "path/to/.app", "build": "xcodebuild -workspace ios/app.xcworkspace -scheme scheme -configuration Debug -sdk iphonesimulator -derivedDataPath ios/build", //  workspace  project.      debug  production (release). "type": "ios.simulator", "name": "iPhone 8" //   }, "android.detox": { //   Android (  detox test -c android.detox) "binaryPath": "path/to/.apk", "build": "cd android &amp;&amp; ./gradlew assembleDebug assembleAndroidTest -DtestBuildType=debug &amp;&amp; cd ..", //      debug  production (release). "type": "android.emulator", "name": "Pixel_2_API_28" //  . “adb devices”     Android } }, "test-runner": "jest", "runner-config": { "setupTestFrameworkScriptFile" : "./detox.init.js", //   "testEnvironment": "node", "testRegex": "(.*|\\.(ui))\\.(ts|tsx)$" //  ,     } "specs": "./__tests__/" //    }</span></span></code> </pre><br>  Écrire des tests est aussi simple que d'écrire Appium, mais en utilisant les fonctionnalités et les limites de Detox. <br><br>  <i>"Boîte grise", nous avons le montage de l'application et l'accès aux structures internes.</i> <br><img src="https://habrastorage.org/webt/wb/eo/ox/wbeooxh72x0szw2op-lbixoeiow.png"><br><br>  <b>Ce que j'aime chez Detox</b> <br><br><ul><li>  Créé par Wix pour React Native. </li><li>  Axé sur JavaScript. </li><li>  Test sur la stratégie de la "boîte grise". </li><li>  Il fonctionne de manière synchrone avec l'application. </li></ul><br>  <b>Ce que vous n'aimez pas chez Detox</b> <br><br><ul><li>  Les possibilités ne sont pas aussi larges que celles d'Appium. </li><li>  Petite communauté. </li></ul><br><h3>  Fragilité </h3><br>  Bien que Detox utilise le principe de la «boîte grise», la fragilité est toujours présente.  Le test avec saisie de texte et balayage n'a pas fonctionné comme il se doit dans 1 cas sur 10. Vous ne pouvez pas être sûr à 100% dans les tests d'interface. <br><br><h3>  La vitesse </h3><br>  Appium «ralentit» les minuteries «.sleep» réglées manuellement, Detox gagne dans ce cas, car tout est synchrone.  En général, je ne tirerais aucune conclusion de ma part, car je n'ai pas écrit un grand nombre de tests identiques sur les deux plateformes.  Dans les tests de 30 secondes et le test simple créé pour cet article, Detox a effectué quelques secondes plus rapidement.  Si vous regardez deux plates-formes différentes, iOS et Android, les tests ont pris + - en même temps.  La principale chose à retenir est que les tests d'interface prennent beaucoup plus de temps de test unitaire. <br><br><h3>  Que choisir </h3><br>  J'étudie toujours les deux frameworks et il faudra un certain temps pour comprendre tous leurs avantages, mais pour le moment, en tant que développeur JavaScript, je choisis Detox. <br><br>  Essayez les deux, heureusement, il n'y en a que deux.  Tout dépend de l'application sur laquelle vous travaillez et de l'équipe. <br><br>  Tests d'interface dans l'équipe de développement - pour les développeurs, essayez Detox.  Des tests de bout en bout plus complexes - il serait peut-être préférable de regarder de plus près Appium avec ses riches capacités API et sa prise en charge sur les plateformes BrowserStack, MS AppCenter et AWS DeviceFarm. <br><br><h3>  Les références </h3><br>  Il existe de nombreuses ressources et articles utiles, mais malheureusement en anglais.  La première chose que je recommande.  sites. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Appium</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Detox</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434816/">https://habr.com/ru/post/fr434816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434802/index.html">"Je ne donnerai pas de pierre" ou comment les ressources du jeu "Cursed Lands" sont disposées</a></li>
<li><a href="../fr434804/index.html">La start-up Fintech Robinhood n'a pas pu lancer un analogue des comptes bancaires</a></li>
<li><a href="../fr434806/index.html">Démantèlement du nouvel an avec une canette</a></li>
<li><a href="../fr434810/index.html">Starter pour travailler avec Spring Cloud</a></li>
<li><a href="../fr434812/index.html">Gestion du temps du projet</a></li>
<li><a href="../fr434818/index.html">Un accident au centre de données CenturyLink a causé des pannes de service au 911</a></li>
<li><a href="../fr434822/index.html">Programme PRC "Voitures avec de nouvelles sources d'énergie". À quoi s'attendre en 2019</a></li>
<li><a href="../fr434824/index.html">Génie politico-électrique. Modélisation des processus socio-politiques par des circuits électriques</a></li>
<li><a href="../fr434826/index.html">Le champ de lit à l'heure, ou 5 signes de problèmes cachés dans l'équipe</a></li>
<li><a href="../fr434828/index.html">Devenez un professionnel. Habitudes utiles des concepteurs UX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>