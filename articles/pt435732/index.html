<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧘🏽 👐🏿 🚴🏽 Friday JS: um quine que toca tic-tac-toe 👨🏿‍🏭 👨🏿‍⚖️ 🧛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saúdo todos na minha seção tradicional, cheios de loucura Lovecraftiana. 

 No processo de escrever um dos artigos anteriores (não olhe, não era parti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Friday JS: um quine que toca tic-tac-toe</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435732/"> Saúdo todos na minha seção tradicional, cheios de loucura Lovecraftiana. <br><br>  No processo de escrever um dos artigos anteriores (não olhe, não era particularmente bom), pensei no fato de o quine ... Sim, só para garantir, lembro: o quine é um programa que exibe seu próprio texto e o faz "honestamente" ( sem procurar, por exemplo, este texto em um arquivo no seu disco rígido).  Em geral, o tradicional puzomerka sem sentido de programadores. <br><br>  Então, pensei no fato de que a quine, em princípio, pode transportar uma carga útil arbitrária.  Ou seja, fazer qualquer outra coisa além de sua função principal.  E como prova de conceito, decidi escrever um quine que toca tic-tac-toe.  E escreveu.  Detalhes sujos sob o corte. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/310/2e0/e41/3102e0e41c87371ea771188ab03d4c13.jpg" alt="imagem"><br><a name="habracut"></a><br>  "Mas como ele pode fazer outra coisa senão exibir seu texto?"  - talvez você pergunte.  E fácil.  Além da saída, o programa também tem entrada.  Se o programa exibir seu texto na ausência de entrada - então é correto.  Se o programa faz outra coisa quando há informações, quem somos nós para condená-lo? <br><br>  Talvez eu imediatamente coloque as cartas na mesa.  <a href="">Aqui está um link para minha criação.</a>  Existem três entidades no arquivo por referência: <br><br><ol><li>  A função quine é do que estou falando. </li><li>  A função evalAndCall é auxiliar. </li><li>  Classe do jogo - ainda mais ajudante </li></ol><br>  Primeiro, falaremos sobre como trabalhar com a função quine e depois como ela funciona. <br><br><h3>  Como trabalhar com ela </h3><br>  No início da função quine, você pode ver o seguinte: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-comment"><span class="hljs-comment">/* |1|2|3| |4|x|6| |7|8|9| !  - ,     -. ,   .     ,    ,     .             ,    . :   - 0   - 0  - 0 */</span></span></code> </pre> <br>  O comentário no início da função é a interface do usuário.  Por meio dele, a função se comunicará com quem a usar no jogo.  No começo, pensei em fazê-lo através do console, mas depois decidi que seria mais correto manter a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">função limpa</a> . <br><br>  Vamos verificar se a função está realmente correta.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aqui,</a> por conveniência, publiquei uma página HTML (quase) vazia com o script quine.js anexado.  Ao abrir as ferramentas do desenvolvedor, você pode direcionar o código a seguir de maneira não seletiva: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> quineText = quine(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> evaluatedQuine = <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(<span class="hljs-string"><span class="hljs-string">"("</span></span> + quineText + <span class="hljs-string"><span class="hljs-string">")"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ,     eval       //  undefined,   const evaluatedQuineText = evaluatedQuine(); quineText == evaluatedQuineText; // true</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Modificação do furo</b> <div class="spoiler_text">  De fato, é claro, verificamos apenas que a função quine retorna o texto da quine, e não que ela mesma seja a quine.  E para ser absolutamente preciso - verificamos apenas que a função quine retorna o texto da função, que no nosso caso funcionava como quine.  Não há garantias de que o interior não contenha algo como: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() &lt; <span class="hljs-number"><span class="hljs-number">0.99</span></span>){ beAGoodQuine(); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ haltAndCatchFire(); }</code> </pre><br></div></div><br>  Agora podemos tentar brincar com ela.  Digamos que fazemos o primeiro movimento para o canto superior esquerdo do campo. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quineText = quine(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  Agora a "interface do usuário" é a seguinte: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-comment"><span class="hljs-comment">/* |o|x|3| |4|x|6| |7|8|9| !  - ,     -. ,   .     ,    ,     .             ,    . :   - 0   - 0  - 0 */</span></span></code> </pre><br>  Quine levou em conta a nossa jogada e deu uma resposta no campo central superior.  A propósito, a função resultante também é denominada quine sem argumentos, ela retornará seu novo texto, não o texto da função original.  Podemos jogar o jogo inteiro, mas por conveniência, usaremos a função auxiliar evalAndCall. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quineText = quine(); <span class="hljs-comment"><span class="hljs-comment">//         ,    . /* |1|2|3| |4|x|6| |7|8|9| */ quineText = evalAndCall(quineText, 1) /* |x|o|3| |4|x|6| |7|8|9| */ quineText = evalAndCall(quineText, 3) /* |x|o|o| |4|x|6| |7|8|x|     .    ,   0    */ quineText = evalAndCall(quineText, 0) /* |1|2|3| |4|x|6| |7|8|9| :   - 0   - 1  - 0 */</span></span></code> </pre><br>  Voila!  Quine joga, vence e até pontua.  Você pode jogar por mais tempo, mas para maior comodidade, recomendo usar a classe Game, com a qual eu mesmo testei o jogo.  Acho que se você ler até este ponto, não preciso explicar como usá-lo. <br><br><h3>  Como funciona </h3><br>  Em geral, a tarefa consistia em duas partes: escrever, se possível, uma função concisa do jogo do jogo da velha, depois empurrá-lo para o jogo.  Vamos começar com o jogo da velha. <br><br>  O núcleo da "inteligência artificial" está nas linhas 66-90 e sua silhueta se assemelha a um esquilo teimoso: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rules = { <span class="hljs-string"><span class="hljs-string">"o___x____"</span></span>: <span class="hljs-string"><span class="hljs-string">"ox__x__!_"</span></span>, <span class="hljs-string"><span class="hljs-string">"ox__x__o_"</span></span>: <span class="hljs-string"><span class="hljs-string">"ox!_x_xo_"</span></span>, <span class="hljs-string"><span class="hljs-string">"oxo_x_xo_"</span></span>: <span class="hljs-string"><span class="hljs-string">"oxo!xxxo_"</span></span>, <span class="hljs-string"><span class="hljs-string">"oxooxxxo_"</span></span>: <span class="hljs-string"><span class="hljs-string">"oxooxxxoxd"</span></span>, <span class="hljs-string"><span class="hljs-string">"_o__x____"</span></span>: <span class="hljs-string"><span class="hljs-string">"xo__x___!"</span></span>, <span class="hljs-string"><span class="hljs-string">"xo__x___o"</span></span>: <span class="hljs-string"><span class="hljs-string">"xo_xx!!_o"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> next = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">field, move</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!~<span class="hljs-string"><span class="hljs-string">"!_"</span></span>.indexOf(field[--move])){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } field[move] = <span class="hljs-string"><span class="hljs-string">"o"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> win = field.indexOf(<span class="hljs-string"><span class="hljs-string">"!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(~win){ field[win] = <span class="hljs-string"><span class="hljs-string">"x"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [...field, <span class="hljs-string"><span class="hljs-string">"w"</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> n = <span class="hljs-number"><span class="hljs-number">0</span></span>; n &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; n++){ field = field.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_, i</span></span></span><span class="hljs-function">) =&gt;</span></span> field[[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>][i]]); rules[field.join(<span class="hljs-string"><span class="hljs-string">""</span></span>)] &amp;&amp; (field = rules[field.join(<span class="hljs-string"><span class="hljs-string">""</span></span>)].split(<span class="hljs-string"><span class="hljs-string">""</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> field; }</code> </pre> <br>  Esse código parece um pouco ofuscado porque eu estava interessado em torná-lo o mais curto possível.  Sua essência é a seguinte: o estado do campo - uma matriz de nove elementos - e o número da célula onde a pessoa-jogador faz um movimento (o próximo verifica a validade desse movimento) entra na próxima função.  Cada elemento do campo pode ser uma cruz, um zero, um sublinhado (célula vazia) ou um ponto de exclamação (uma célula vazia na qual colocar uma cruz na primeira oportunidade).  Se houver um ponto de exclamação no campo, imediatamente fazemos uma jogada para lá e vencemos.  Caso contrário, colamos o array em uma string e procuramos a regra correspondente no objeto de regras.  Para economizar espaço, as regras são precisas para rotação, portanto, para pesquisar, o campo é girado quatro vezes.  Quando a regra desejada é encontrada, o estado do campo é substituído pelo valor da regra, dividido em caracteres.  Em seguida, a próxima função retorna o novo estado do campo.  Ao mesmo tempo, um décimo personagem adicional pode se juntar a ele: "w" - se a IA vencer, "d" - se houver um empate. <br><br>  Graças aos pontos de exclamação, "dicas" e à rotação do campo, e também, é claro, devido ao fato de a IA se mover primeiro, a estratégia ideal foi descrita em apenas 6 regras. <br><br>  Usando a próxima função, a função quine processa a entrada e grava alguns campos no objeto magicHash.  E aqui passamos sem problemas para a segunda parte: como o componente "quayne" funciona.  Toda mágica está no objeto magicHash e sua propriedade magicString. <br><br>  A linha magicString, como você pode ver facilmente, contém texto de programa quase completamente duplicado.  No entanto, como todo mundo que já tentou escrever um quine sabe, você não pode inserir um texto completamente completo nele - porque ele precisará se conter estritamente, o que é impossível para strings de comprimento finito.  Portanto, além do texto "simples", ele também contém sequências curinga "mágicas" delimitadas em ambos os lados pelo caractere "$". <br><br>  Quando chega a hora de X e temos que retornar o texto da função, pegamos magicString e substituímos as seqüências curinga nela pelas propriedades correspondentes do objeto magicHash.  Essas propriedades podem ser estáticas (backtick), alterar no tempo de execução (campo) ou até mesmo serem adicionadas no tempo de execução (mensagem) - isso não importa.  É importante que, para cada pedaço de código "problemático" que não possa ser simplesmente duplicado em uma linha, tenhamos uma propriedade "mágica" do objeto magicHash.  O último substitui o magicString.  O último - porque, caso contrário, haveria sequências curinga adicionais que também seriam substituídas. <br><br><h3>  Sumário </h3><br>  Eu verifiquei por experiência própria que você pode colocar qualquer coisa em uma solução.  Em princípio, se você se incomodar, poderá criar um gerador de quine - uma função que transforma qualquer outra função pura em quine e permite armazenar um estado arbitrário que a função pura acima pode acessar.  No entanto, as margens deste manuscrito são muito estreitas ... <br><br>  Em geral, não finjo a novidade especial da minha "descoberta".  Funcionários hardcore devem ter lido este texto com um sorriso de excelência.  Mas foi interessante para mim pegá-lo com minhas próprias mãos, colocar, por assim dizer, dedos em feridas.  E espero que você esteja interessado em ler sobre isso. <br><br>  Adeus, meninas e meninos.  Vejo você de novo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt435732/">https://habr.com/ru/post/pt435732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt435720/index.html">Rádio Adblock de desenvolvimento</a></li>
<li><a href="../pt435722/index.html">NB-IoT, Internet das coisas em banda estreita. Modos de economia de energia e comandos de controle</a></li>
<li><a href="../pt435724/index.html">Retendo os vícios do imperativo</a></li>
<li><a href="../pt435728/index.html">[Sexta-feira] História de como a venda de TI tentou vender lenha, ou nos bastidores de um concurso</a></li>
<li><a href="../pt435730/index.html">A concha rachou</a></li>
<li><a href="../pt435734/index.html">Como não se deixar enganar fazendo física</a></li>
<li><a href="../pt435738/index.html">Técnica de projeto DIY. Parte um</a></li>
<li><a href="../pt435740/index.html">As inscrições estão abertas no GraphQL Meetup em São Petersburgo</a></li>
<li><a href="../pt435742/index.html">Gerenciamento de recursos no Zimbra Collaboration Suite</a></li>
<li><a href="../pt435744/index.html">Resumo da Fintech: Banco da Rússia poderá bloquear sites, volumes de empréstimos p2p estão caindo, criptografia na Europa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>