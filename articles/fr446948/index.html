<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚Ü©Ô∏è ü¶á üë©üèø‚Äçüè≠ Comment le cheval de Troie Android Gustuff supprime la cr√®me (fiat et crypto) de vos comptes üíÉüèΩ üë®‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® üõê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'autre jour, Group-IB a rendu compte de l'activit√© du cheval de Troie mobile Android Gustuff. Il fonctionne exclusivement sur les march√©s internation...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment le cheval de Troie Android Gustuff supprime la cr√®me (fiat et crypto) de vos comptes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/446948/"><img src="https://habrastorage.org/webt/b9/hn/wr/b9hnwrlclblkmurq29bkezeanui.png"><br><br>  L'autre jour, Group-IB a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rendu compte</a> de l'activit√© du cheval de Troie mobile Android Gustuff.  Il fonctionne exclusivement sur les march√©s internationaux, attaquant les clients des 100 plus grandes banques √©trang√®res, les utilisateurs de 32 portefeuilles cryptographiques mobiles, ainsi que d'importantes ressources de commerce √©lectronique.  Mais le d√©veloppeur de Gustuff est un cybercriminel russophone sous le surnom de Bestoffer.  Jusqu'√† r√©cemment, il louait son cheval de Troie comme ¬´un produit s√©rieux pour les personnes ayant des connaissances et de l'exp√©rience¬ª. <br><br>  <b>Ivan Pisarev,</b> sp√©cialiste de l'analyse des codes malveillants du groupe IB, explique dans ses recherches en d√©tail comment Gustuff fonctionne et quel est son danger. <a name="habracut"></a><br><br><h2>  Qui chasse Gustuff? </h2><br>  Gustuff est une nouvelle g√©n√©ration de malware avec des fonctionnalit√©s enti√®rement automatis√©es.  Selon le d√©veloppeur, le cheval de Troie est devenu une nouvelle version am√©lior√©e du logiciel malveillant AndyBot, qui, depuis novembre 2017, attaque les t√©l√©phones Android et vole de l'argent via des formulaires Web de phishing qui se font passer pour des applications mobiles de banques et de syst√®mes de paiement internationaux bien connus.  Bestoffer a indiqu√© que le prix de location du Gustuff Bot √©tait de 800 $ par mois. <br><br>  L'analyse de l'√©chantillon de Gustuff a montr√© que le cheval de Troie est potentiellement destin√© aux clients utilisant les applications mobiles des plus grandes banques, telles que Bank of America, Bank of Scotland, JPMorgan, Wells Fargo, Capital One, TD Bank, PNC Bank, ainsi que Bitcoin Wallet, BitPay crypto wallets , Cryptopay, Coinbase, etc. <br><br>  Cr√©√©e √† l'origine comme un cheval de Troie bancaire classique, la version actuelle de Gustuff a consid√©rablement √©largi la liste des cibles potentielles d'attaque.  En plus des applications Android des banques, des soci√©t√©s de technologies financi√®res et des services de cryptographie, Gustuff s'adresse aux utilisateurs d'applications de march√©, de boutiques en ligne, de syst√®mes de paiement et de messageries instantan√©es.  En particulier, PayPal, Western Union, eBay, Walmart, Skype, WhatsApp, Gett Taxi, Revolut et autres. <br><br><h2>  Point d'entr√©e: calcul de l'infection de masse </h2><br>  Gustuff se caract√©rise par le vecteur ¬´classique¬ª de p√©n√©tration dans les smartphones Android via l'envoi de SMS avec des liens vers des APK.  Si l'appareil Android est infect√© par un cheval de Troie √† la demande du serveur, Gustuff peut se propager davantage via la base de donn√©es de contacts du t√©l√©phone infect√© ou via la base de donn√©es du serveur.  La fonctionnalit√© de Gustuff est con√ßue pour une infection massive et la capitalisation maximale de l'entreprise de ses op√©rateurs - elle a une fonction unique de ¬´remplissage automatique¬ª dans les applications bancaires mobiles et les crypto-portefeuilles l√©gitimes, ce qui vous permet d'acc√©l√©rer et d'√©tendre le vol d'argent. <br><br>  L'√©tude du cheval de Troie a montr√© que la fonction de remplissage automatique y √©tait impl√©ment√©e √† l'aide du service d'accessibilit√© - un service pour les personnes handicap√©es.  Gustuff n'est pas le premier cheval de Troie qui contourne avec succ√®s la protection contre l'interaction avec les √©l√©ments de fen√™tre d'autres applications utilisant ce service Android.  Cependant, l'utilisation du service d'accessibilit√© conjointement avec le chargement automatique est encore assez rare. <br><br>  Apr√®s avoir t√©l√©charg√© la victime sur le t√©l√©phone, Gustuff, en utilisant le service d'accessibilit√©, a la possibilit√© d'interagir avec des √©l√©ments de fen√™tre d'autres applications (banque, crypto-monnaie, ainsi que des applications pour les achats en ligne, la messagerie, etc.), effectuant les actions n√©cessaires pour les attaquants.  Par exemple, √† la commande du serveur, le cheval de Troie peut cliquer sur des boutons et modifier les valeurs des champs de texte dans les applications bancaires.  L'utilisation du m√©canisme du service d'accessibilit√© permet au cheval de Troie de contourner les m√©canismes de protection utilis√©s par les banques pour contrer les chevaux de Troie mobiles de la g√©n√©ration pr√©c√©dente, ainsi que les changements dans la politique de s√©curit√© introduite par Google dans les nouvelles versions du syst√®me d'exploitation Android.  Ainsi, Gustuff "sait comment" d√©sactiver la protection Google Protect: selon l'auteur, cette fonction fonctionne dans 70% des cas. <br><br><img src="https://habrastorage.org/webt/ih/x4/1k/ihx41k2p4hqubcaaisklwvdyoy8.png"><br><br>  Gustuff peut √©galement afficher de fausses notifications PUSH avec des ic√¥nes d'applications mobiles l√©gitimes.  L'utilisateur clique sur la notification PUSH et voit une fen√™tre de phishing t√©l√©charg√©e depuis le serveur, o√π il entre lui-m√™me les donn√©es demand√©es d'une carte bancaire ou d'un portefeuille crypt√©.  Dans un autre sc√©nario, Gustuff ouvre une application pour le compte de laquelle une notification PUSH a √©t√© d√©montr√©e.  Dans ce cas, le programme malveillant, sur commande du serveur via le service d'accessibilit√©, peut remplir les champs du formulaire de l'application bancaire pour une transaction frauduleuse. <br><br>  La fonctionnalit√© de Gustuff comprend √©galement l'envoi d'informations sur un appareil infect√© au serveur, la possibilit√© de lire / envoyer des messages SMS, d'envoyer des demandes USSD, de lancer le proxy SOCKS5, de suivre le lien, d'envoyer des fichiers (y compris des num√©risations de photos de documents, des captures d'√©cran, des photos) au serveur r√©initialiser l'appareil aux param√®tres d'usine. <br><br><h2>  Analyse des logiciels malveillants </h2><br>  Avant d'installer une application malveillante, Android OS affiche √† l'utilisateur une fen√™tre contenant une liste des droits demand√©s par Gustuff: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ku/th/ac/kuthacuzh0webqtrwhgktysougi.png" alt="image alt"></div><br>  L'installation de l'application n'aura lieu qu'apr√®s avoir obtenu le consentement de l'utilisateur.  Apr√®s avoir lanc√© l'application, le cheval de Troie affichera √† l'utilisateur une fen√™tre: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hj/uq/xa/hjuqxaw2ezubek_xmd3clywhpsw.png" alt="image alt"></div><br>  Ensuite, il supprimera son ic√¥ne. <br><br>  Gustuff est conditionn√©, selon l'auteur, par un conditionneur FTT.  Apr√®s le d√©marrage, l'application acc√®de p√©riodiquement au serveur CnC afin de recevoir des commandes.  Dans plusieurs des fichiers que nous avons examin√©s, l'adresse IP <b>88.99.171 [.] 105 a √©t√©</b> utilis√©e comme serveur de contr√¥le (dans ce qui suit, nous la d√©signerons comme <b>&lt;% CnC%&gt;</b> ). <br><br>  Apr√®s le d√©marrage, le programme commence √† envoyer des messages au serveur <b>http: // &lt;% CnC%&gt; /api/v1/get.php</b> . <br><br>  En r√©ponse, JSON est attendu dans le format suivant: <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"results"</span></span> : <span class="hljs-string"><span class="hljs-string">"OK"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;%id%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt;%command%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt;%Server Timestamp%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>:{ &lt;%Command parameters as JSON%&gt; }, }, }</code> </pre> <br>  Chaque fois que l'application envoie des informations sur un appareil infect√©.  Le format du message est pr√©sent√© ci-dessous.  Il convient de noter que les champs <b>complets</b> , <b>suppl√©mentaires</b> , <b>applications</b> et <b>autorisations</b> sont facultatifs et ne seront envoy√©s qu'en cas de commande de demande de CnC. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"info"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"info"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"cell"</span></span>:&lt;%Sim operator name%&gt;, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>:&lt;%Country ISO%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%IMEI%&gt;, <span class="hljs-attr"><span class="hljs-attr">"number"</span></span>:&lt;%Phone number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"line1Number"</span></span>:&lt;%Phone number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"advertisementId"</span></span>:&lt;%ID%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"state"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"admin"</span></span>:&lt;%Has admin rights%&gt;, <span class="hljs-attr"><span class="hljs-attr">"source"</span></span>:&lt;%String%&gt;, <span class="hljs-attr"><span class="hljs-attr">"needPermissions"</span></span>:&lt;%Application needs permissions%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accesByName"</span></span>:&lt;%Boolean%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accesByService"</span></span>:&lt;%Boolean%&gt;, <span class="hljs-attr"><span class="hljs-attr">"safetyNet"</span></span>:&lt;%String%&gt;, <span class="hljs-attr"><span class="hljs-attr">"defaultSmsApp"</span></span>:&lt;%Default Sms Application%&gt;, <span class="hljs-attr"><span class="hljs-attr">"isDefaultSmsApp"</span></span>:&lt;%Current application is Default Sms Application%&gt;, <span class="hljs-attr"><span class="hljs-attr">"dateTime"</span></span>:&lt;%Current date time%&gt;, <span class="hljs-attr"><span class="hljs-attr">"batteryLevel"</span></span>:&lt;%Battery level%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"socks"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%Proxy module ID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"enabled"</span></span>:&lt;%Is enabled%&gt;, <span class="hljs-attr"><span class="hljs-attr">"active"</span></span>:&lt;%Is active%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"versionName"</span></span>:&lt;%Package Version Name%&gt;, <span class="hljs-attr"><span class="hljs-attr">"versionCode"</span></span>:&lt;%Package Version Code%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lastUpdateTime"</span></span>:&lt;%Package Last Update Time%&gt;, <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>:&lt;%Tag, default value: <span class="hljs-string"><span class="hljs-string">"TAG"</span></span>%&gt;, <span class="hljs-attr"><span class="hljs-attr">"targetSdkVersion"</span></span>:&lt;%Target Sdk Version%&gt;, <span class="hljs-attr"><span class="hljs-attr">"buildConfigTimestamp"</span></span>:<span class="hljs-number"><span class="hljs-number">1541309066721</span></span> }, }, <span class="hljs-attr"><span class="hljs-attr">"full"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%Device Model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"localeCountry"</span></span>:&lt;%Country%&gt;, <span class="hljs-attr"><span class="hljs-attr">"localeLang"</span></span>:&lt;%Locale language%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accounts"</span></span>:&lt;%JSON array, contains from <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> and <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> of accounts%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lockType"</span></span>:&lt;%Type of lockscreen password%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"serial"</span></span>:&lt;%Build serial number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"board"</span></span>:&lt;%Build Board%&gt;, <span class="hljs-attr"><span class="hljs-attr">"brand"</span></span>:&lt;%Build Brand%&gt;, <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>:&lt;%Build User%&gt;, <span class="hljs-attr"><span class="hljs-attr">"device"</span></span>:&lt;%Build Device%&gt;, <span class="hljs-attr"><span class="hljs-attr">"display"</span></span>:&lt;%Build Display%&gt;, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%Build ID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"manufacturer"</span></span>:&lt;%Build manufacturer%&gt;, <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%Build model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>:&lt;%Build product%&gt;, <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span>:&lt;%Build tags%&gt;, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:&lt;%Build type%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%imei%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imsi"</span></span>:&lt;%imsi%&gt;, <span class="hljs-attr"><span class="hljs-attr">"line1number"</span></span>:&lt;%phonenumber%&gt;, <span class="hljs-attr"><span class="hljs-attr">"iccid"</span></span>:&lt;%Sim serial number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"mcc"</span></span>:&lt;%Mobile country code of operator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"mnc"</span></span>:&lt;%Mobile network codeof operator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"cellid"</span></span>:&lt;%GSM-data%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lac"</span></span>:&lt;%GSM-data%&gt;, <span class="hljs-attr"><span class="hljs-attr">"androidid"</span></span>:&lt;%Android Id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"ssid"</span></span>:&lt;%Wi-Fi SSID%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"apps"</span></span>:{&lt;%List of installed applications%&gt;}, <span class="hljs-attr"><span class="hljs-attr">"permission"</span></span>:&lt;%List of granted permissions%&gt; }</code> </pre> <br><h3>  Stockage des donn√©es de configuration </h3><br>  Gustuff stocke des informations importantes sur le travail dans un fichier de pr√©f√©rences.  Le nom de fichier, ainsi que les noms de param√®tres qu'il <b>contient</b> , est le r√©sultat du calcul de la somme MD5 √† partir de la ligne <b>15413090667214.6.1 &lt;% name%&gt;</b> , o√π <b>&lt;% name%&gt;</b> est la valeur de nom d'origine.  Interpr√©tation Python de la fonction de g√©n√©ration de nom: <br><br><pre> <code class="json hljs"> nameGenerator(input): output = md<span class="hljs-number"><span class="hljs-number">5</span></span>(<span class="hljs-string"><span class="hljs-string">"15413090667214.6.1"</span></span> + input)</code> </pre> <br>  Dans ce qui suit, nous le d√©signerons comme <b>nameGenerator (entr√©e)</b> . <br><br>  Ainsi, le nom du premier fichier est: <b>nameGenerator ("API_SERVER_LIST")</b> , il contient des valeurs avec les noms suivants: <br><br><table><tbody><tr><th width="400">  <b>Nom de variable</b> </th><th>  <b>Valeur</b> </th></tr><tr><td>  <b>nameGenerator ("API_SERVER_LIST")</b> </td><td>  Contient une liste d'adresses CnC sous forme de tableau. </td></tr><tr><td>  <b>nameGenerator ("API_SERVER_URL")</b> </td><td>  Contient une adresse CnC. </td></tr><tr><td>  <b>nameGenerator ("SMS_UPLOAD")</b> </td><td>  Le drapeau est d√©fini par d√©faut.  Si l'indicateur est d√©fini - envoie des messages SMS √† CnC. </td></tr><tr><td>  <b>nameGenerator ("SMS_ROOT_NUMBER")</b> </td><td>  Num√©ro de t√©l√©phone auquel les SMS re√ßus par l'appareil infect√© seront envoy√©s.  La valeur par d√©faut est null. </td></tr><tr><td>  <b>nameGenerator ("SMS_ROOT_NUMBER_RESEND")</b> </td><td>  Le drapeau est effac√© par d√©faut.  S'il est install√©, lorsqu'un appareil infect√© re√ßoit un SMS, il sera envoy√© au num√©ro racine. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_APP_SMS")</b> </td><td>  Le drapeau est effac√© par d√©faut.  Si cet indicateur est d√©fini, l'application traitera les messages SMS entrants. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_ADMIN")</b> </td><td>  Le drapeau est effac√© par d√©faut.  Si l'indicateur est d√©fini, l'application dispose de droits d'administrateur. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_ACCESSIBILITY")</b> </td><td>  Le drapeau est effac√© par d√©faut.  Si l'indicateur est d√©fini, un service utilisant le service d'accessibilit√© est d√©marr√©. </td></tr><tr><td>  <b>nameGenerator ("APPS_CONFIG")</b> </td><td>  L'objet JSON contient une liste d'actions qui doivent √™tre effectu√©es lorsque l'√©v√©nement d'accessibilit√© associ√© √† une application particuli√®re est d√©clench√©. </td></tr><tr><td>  <b>nameGenerator ("APPS_INSTALLED")</b> </td><td>  Stocke une liste des applications install√©es sur l'appareil. </td></tr><tr><td>  <b>nameGenerator ("IS_FIST_RUN")</b> </td><td>  Le drapeau est r√©initialis√© au premier d√©marrage. </td></tr><tr><td>  <b>nameGenerator ("UNIQUE_ID")</b> </td><td>  Contient un identifiant unique.  Il est g√©n√©r√© lors du premier lancement du bot. </td></tr></tbody></table><br><h3>  Module de traitement des commandes du serveur </h3><br>  L'application stocke les adresses des serveurs CnC sous la forme d'un tableau de <b>cha√Ænes</b> cod√©es en <b>Base85</b> .  La liste des serveurs CnC peut √™tre modifi√©e √† la r√©ception de la commande appropri√©e, auquel cas les adresses seront stock√©es dans un fichier de pr√©f√©rences. <br><br>  En r√©ponse √† la demande, le serveur envoie une commande √† l'application.  Il convient de noter que les commandes et les param√®tres sont pr√©sent√©s au format JSON.  Une application peut traiter les commandes suivantes: <br><table><tbody><tr><th width="150">  <b>L'√©quipe</b> </th><th>  <b>La description</b> </th></tr><tr><td>  <b>forwardStart</b> </td><td>  Commencez √† envoyer des messages SMS re√ßus par le p√©riph√©rique infect√© au serveur CnC. </td></tr><tr><td>  <b>forwardStop</b> </td><td>  Arr√™tez d'envoyer des messages SMS re√ßus par le p√©riph√©rique infect√© au serveur CnC. </td></tr><tr><td>  <b>ussdRun</b> </td><td>  Ex√©cutez la demande USSD.  Le num√©ro auquel vous souhaitez faire une demande USSD se trouve dans le champ JSON "num√©ro". </td></tr><tr><td>  <b>sendSms</b> </td><td>  Envoyez un SMS (si n√©cessaire, le message est "divis√©" en plusieurs parties).  En param√®tre, la commande prend un objet JSON contenant les champs "√†" - le num√©ro de destination et "corps" - le corps du message. </td></tr><tr><td>  <b>sendSmsAb</b> </td><td>  Envoyez des SMS (si n√©cessaire, le message est "divis√©" en parties) √† tout le monde √† partir de la liste de contacts de l'appareil infect√©.  L'intervalle entre l'envoi de messages est de 10 secondes.  Le corps du message se trouve dans le champ JSON "body" </td></tr><tr><td>  <b>sendSmsMass</b> </td><td>  Envoyer des messages SMS (si n√©cessaire, le message est "divis√©" en parties) aux contacts sp√©cifi√©s dans les param√®tres de commande.  L'intervalle entre l'envoi de messages est de 10 secondes.  En param√®tre, la commande accepte un tableau JSON (champ "sms"), dont les √©l√©ments contiennent les champs "to" - le num√©ro de destination et "body" - le corps du message. </td></tr><tr><td>  <b>changeServer</b> </td><td>  Cette commande en tant que param√®tre peut prendre une valeur avec la cl√© "url" - alors le bot changera la valeur de nameGenerator ("SERVER_URL"), ou "array" - puis le bot √©crira le tableau dans nameGenerator ("API_SERVER_LIST") Ainsi, l'application change l'adresse des serveurs CnC. </td></tr><tr><td>  <b>adminNumber</b> </td><td>  La commande est con√ßue pour fonctionner avec le num√©ro racine.  La commande accepte un objet JSON avec les param√®tres suivants: "nombre" - remplacez nameGenerator ("ROOT_NUMBER") par la valeur re√ßue, "resend" - changez nameGenerator ("SMS_ROOT_NUMBER_RESEND"), "sendId" - envoyez √† nameGenerator ("ROOT_NUMBER") uniqueID. </td></tr><tr><td>  <b>updateInfo</b> </td><td>  Envoyez des informations sur un p√©riph√©rique infect√© au serveur. </td></tr><tr><td>  <b>wipeData</b> </td><td>  La commande est con√ßue pour supprimer les donn√©es utilisateur.  Selon le nom du lancement de l'application, soit les donn√©es sont compl√®tement effac√©es lors du red√©marrage de l'appareil (utilisateur principal), soit seules les donn√©es utilisateur sont supprim√©es (utilisateur secondaire). </td></tr><tr><td>  <b>chaussettes</b> </td><td>  Lancez le module proxy.  Le fonctionnement du module est d√©crit dans une section distincte. </td></tr><tr><td>  <b>chaussettes</b> </td><td>  Arr√™tez le module proxy. </td></tr><tr><td>  <b>openLink</b> </td><td>  Suivez le lien.  Le lien est situ√© dans le param√®tre JSON par la cl√© "url".  Pour ouvrir le lien, utilisez "android.intent.action.VIEW". </td></tr><tr><td>  <b>uploadAllSms</b> </td><td>  Envoyez au serveur tous les messages SMS re√ßus par l'appareil. </td></tr><tr><td>  <b>uploadAllPhotos</b> </td><td>  Envoyez des images d'un appareil infect√© √† l'URL.  L'URL est fournie en tant que param√®tre. </td></tr><tr><td>  <b>uploadFile</b> </td><td>  Envoyez le fichier √† l'URL depuis le p√©riph√©rique infect√©.  L'URL est fournie en tant que param√®tre. </td></tr><tr><td>  <b>uploadPhoneNumbers</b> </td><td>  Envoyez des num√©ros de t√©l√©phone de la liste de contacts au serveur.  Si un objet JSON avec la cl√© ¬´ab¬ª vient en param√®tre, l'application re√ßoit la liste des contacts du r√©pertoire t√©l√©phonique.  Si un objet JSON avec la touche "sms" est fourni en param√®tre, l'application lit la liste des contacts des exp√©diteurs de messages SMS. </td></tr><tr><td>  <b>changeArchive</b> </td><td>  L'application t√©l√©charge le fichier √† partir de l'adresse, qui vient en param√®tre avec la cl√© "url".  Le fichier t√©l√©charg√© est enregistr√© sous le nom "archive.zip".  Apr√®s cela, l'application d√©compressera le fichier, si n√©cessaire, en utilisant le mot de passe pour l'archive "b5jXh37gxgHBrZhQ4j3D".  Les fichiers d√©compress√©s sont enregistr√©s dans le r√©pertoire [stockage externe] / hgps.  Dans ce r√©pertoire, l'application stocke les contrefa√ßons Web (d√©crites plus loin). </td></tr><tr><td>  <b>les actions</b> </td><td>  La commande est con√ßue pour fonctionner avec le service d'action, qui est d√©crit dans une section distincte. </td></tr><tr><td>  <b>test</b> </td><td>  √áa ne fait rien. </td></tr><tr><td>  <b>t√©l√©charger</b> </td><td>  La commande est con√ßue pour t√©l√©charger un fichier √† partir d'un serveur distant et l'enregistrer dans le r√©pertoire T√©l√©chargements.  L'URL et le nom de fichier sont fournis en param√®tre, les champs du param√®tre d'objet JSON, respectivement: "url" et "fileName". </td></tr><tr><td>  <b>supprimer</b> </td><td>  Supprime un fichier du r√©pertoire T√©l√©chargements.  Le nom de fichier vient dans le param√®tre JSON avec la cl√© "fileName".  Le nom de fichier par d√©faut est ¬´tmp.apk¬ª. </td></tr><tr><td>  <b>notification</b> </td><td>  Afficher une notification avec des textes de description et de titre d√©finis par le serveur de gestion. </td></tr></tbody></table><br>  Le format de la commande de <b>notification</b> est le suivant: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"results"</span></span> : <span class="hljs-string"><span class="hljs-string">"OK"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: &lt;%id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"notification"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>:&lt;%Server Timestamp%&gt;, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"openApp"</span></span>:&lt;%Open original app or not%&gt;, <span class="hljs-attr"><span class="hljs-attr">"array"</span></span>:[ {<span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:&lt;%Title text%&gt;, <span class="hljs-attr"><span class="hljs-attr">"desc"</span></span>:&lt;%Description text%&gt;, <span class="hljs-attr"><span class="hljs-attr">"app"</span></span>:&lt;%Application name%&gt;} ] }, }, }</code> </pre> <br>  La notification g√©n√©r√©e par le fichier √©tudi√© semble identique aux notifications cr√©√©es par l'application sp√©cifi√©e dans le champ d' <b>application</b> .  Si la valeur du champ <b>openApp</b> est True, lorsque la notification est ouverte, l'application sp√©cifi√©e dans le champ <b>app</b> est lanc√©e.  Si la valeur du champ <b>openApp</b> est False, alors: <br><br><ul><li>  une fen√™tre de phishing s'ouvre, dont le contenu est t√©l√©charg√© depuis le r√©pertoire <b>&lt;% external storage%&gt; / hgps / &lt;% filename%&gt;</b> </li><li>  une fen√™tre de phishing s'ouvre, dont le contenu est t√©l√©charg√© depuis le serveur <b>&lt;% url%&gt;? id = &lt;% Bot id%&gt; &amp; app = &lt;% Application name%&gt;</b> </li><li>  Une fen√™tre de phishing d√©guis√©e en carte Google Play s'ouvre, avec la possibilit√© de saisir les informations de la carte. </li></ul><br>  L'application envoie le r√©sultat de l'ex√©cution de toute commande √† <b>&lt;% CnC%&gt; \ set_state.php en</b> tant qu'objet JSON au format suivant: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:&lt;%command%&gt;, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%command_id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"state"</span></span>:&lt;%command_state%&gt; } <span class="hljs-string"><span class="hljs-string">"id"</span></span>:&lt;%bot_id%&gt; }</code> </pre> <br>  <b>ActionsService</b> <br><br>  La liste des commandes que l'application traite comprend une <b>action</b> .  D√®s r√©ception d'une commande, le module de traitement de commande acc√®de √† ce service afin d'ex√©cuter une commande √©tendue.  Le service accepte un objet JSON comme param√®tre.  Un service peut ex√©cuter les commandes suivantes: <br><br>  <b>1.</b> <b>PARAMS_ACTION</b> - √† r√©ception d'une telle commande, le service re√ßoit tout d'abord du param√®tre JSON la valeur par la cl√© Type, elle peut √™tre la suivante: <br><br><ul><li>  <b>serviceInfo</b> - la sous-commande re√ßoit du param√®tre JSON la valeur de la cl√© <b>includeNotImportant</b> .  Si l'indicateur est True, l'application d√©finit l'indicateur <b>FLAG_ISOLATED_PROCESS</b> sur un service qui utilise le service d'accessibilit√©.  Ainsi, le service sera lanc√© dans un processus distinct. </li><li>  <b>root</b> - obtenir et envoyer au serveur des informations sur la fen√™tre, qui est maintenant au point.  Une application r√©cup√®re des informations √† l'aide de la classe AccessibilityNodeInfo. </li><li>  <b>admin</b> - demande des droits d'administrateur. </li><li>  <b>delay</b> - suspendre le ActionsService pendant le nombre de millisecondes sp√©cifi√© dans le param√®tre avec la cl√© "data". </li><li>  <b>windows</b> - envoyer une liste des fen√™tres visibles √† l'utilisateur. </li><li>  <b>installer</b> - installez l'application sur un appareil infect√©.  Le nom du package - archive est dans la cl√© "fileName".  L'archive elle-m√™me se trouve dans le r√©pertoire T√©l√©chargements. </li><li>  <b>global</b> - la sous-commande est con√ßue pour passer de la fen√™tre actuelle: <br><ul><li>  dans le menu Param√®tres rapides </li><li>  retour </li><li>  la maison </li><li>  aux notifications </li><li>  √† la fen√™tre des applications r√©cemment ouvertes </li></ul><br></li><li>  <b>launch</b> - lance l'application.  Le nom de l'application vient en param√®tre de la cl√© de <b>donn√©es</b> . </li><li>  <b>sons</b> - changez le mode sonore pour le faire taire. </li><li>  <b>d√©verrouiller</b> - allume le r√©tro√©clairage de l'√©cran et du clavier √† pleine luminosit√©.  L'application ex√©cute cette action √† l'aide de WakeLock, la cha√Æne [√âtiquette d'application]: INFO </li><li>  <b>permissionOverlay</b> - la fonction n'est pas impl√©ment√©e (la r√©ponse √† l'ex√©cution de la commande est {"message": "Not support"} ou {"message": "low sdk"}) </li><li>  <b>geste</b> - la fonction n'est pas impl√©ment√©e (la r√©ponse √† l'ex√©cution de la commande est {"message": "Not support"} ou {"message": "Low API"}) </li><li>  <b>autorisations</b> - cette commande est requise pour demander des autorisations pour l'application.  Cependant, la fonction de requ√™te n'est pas impl√©ment√©e, donc la commande n'a pas de sens.  La liste des droits demand√©s se pr√©sente sous la forme d'un tableau JSON avec la cl√© "permissions".  Liste standard: <br><br><ul><li>  android.permission.READ_PHONE_STATE </li><li>  android.permission.READ_CONTACTS </li><li>  android.permission.CALL_PHONE </li><li>  android.permission.RECEIVE_SMS </li><li>  android.permission.SEND_SMS </li><li>  android.permission.READ_SMS </li><li>  android.permission.READ_EXTERNAL_STORAGE </li><li>  android.permission.WRITE_EXTERNAL_STORAGE </li></ul><br></li><li>  <b>open</b> - affiche une fen√™tre de phishing.  Selon le param√®tre provenant du serveur, l'application peut afficher les fen√™tres de phishing suivantes: <br><br><ul><li>  Afficher une fen√™tre de phishing dont le contenu est √©crit dans le fichier du r√©pertoire <b>&lt;% external directory%&gt; / hgps / &lt;% param_filename%&gt;</b> .  Le r√©sultat de l'interaction de l'utilisateur avec la fen√™tre sera envoy√© √† <b>&lt;% CnC%&gt; / records.php</b> </li><li>  Afficher une fen√™tre de phishing dont le contenu est pr√©charg√© √† partir de l'adresse <b>&lt;% url_param%&gt;? Id = &lt;% bot_id%&gt; &amp; app = &lt;% packagename%&gt;</b> .  Le r√©sultat de l'interaction de l'utilisateur avec la fen√™tre sera envoy√© √† <b>&lt;% CnC%&gt; / records.php</b> </li><li>  Afficher la fen√™tre de phishing d√©guis√©e en carte Google Play. </li></ul></li><li>  <b>interactive</b> - la commande est con√ßue pour interagir avec les √©l√©ments de fen√™tre d'autres applications √† l'aide d'AcessibilityService.  Pour l'interaction, un service sp√©cial est impl√©ment√© dans le programme.  L'application √† l'√©tude peut interagir avec les fen√™tres: <br><ul><li>  Actif en ce moment.  Dans ce cas, le param√®tre contient l'identifiant ou le texte (nom) de l'objet avec lequel il est n√©cessaire d'interagir. </li><li>  Visible par l'utilisateur au moment de l'ex√©cution de la commande.  L'application s√©lectionne les fen√™tres par id. </li></ul><br>  Apr√®s avoir re√ßu des objets <b>AccessibilityNodeInfo</b> pour les √©l√©ments de fen√™tre d'int√©r√™t, l'application, en fonction des param√®tres, peut effectuer des actions: <br><ul><li>  focus - d√©finit le focus sur l'objet. </li><li>  cliquez - cliquez sur un objet. </li><li>  actionId - effectuer une action par ID. </li><li>  setText - change le texte de l'objet.  La modification du texte est possible de deux mani√®res: effectuez l'action <b>ACTION_SET_TEXT</b> (si la version Android du p√©riph√©rique infect√© est plus jeune ou √©gale √† <b>LOLLIPOP</b> ), ou en pla√ßant une ligne dans le presse-papiers et en la collant dans l'objet (pour les versions plus anciennes).  Cette commande peut √™tre utilis√©e pour modifier des donn√©es dans une application bancaire. </li></ul></li></ul><br>  <b>2.</b> <b>PARAMS_ACTIONS</b> - identique √† <b>PARAMS_ACTION</b> , seul le tableau de commandes JSON est fourni. <br><br>  Il semble que beaucoup seront int√©ress√©s par l'apparence de la fonction d'interaction avec les √©l√©ments de fen√™tre d'une autre application.  Voici comment cette fonctionnalit√© est impl√©ment√©e dans Gustuff: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interactiveAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List aiList, JSONObject action, JsonObject res)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = action.optInt(<span class="hljs-string"><span class="hljs-string">"repeat"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); Iterator aiListIterator = ((Iterable)aiList).iterator(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(aiListIterator.hasNext()) { Object ani = aiListIterator.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;= count) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(index = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; ++index) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"focus"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(<span class="hljs-number"><span class="hljs-number">1</span></span>)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"click"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(<span class="hljs-number"><span class="hljs-number">16</span></span>)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"actionId"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(action.optInt(<span class="hljs-string"><span class="hljs-string">"actionId"</span></span>))) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"setText"</span></span>)) { customHeader ch = CustomAccessibilityService.a; Context context = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getApplicationContext(); String text = action.optString(<span class="hljs-string"><span class="hljs-string">"setText"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(performSetTextAction(ch, context, ((AccessibilityNodeInfo)ani), text)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(index == count) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } ((AccessibilityNodeInfo)ani).recycle(); } res.addPropertyNumber(<span class="hljs-string"><span class="hljs-string">"res"</span></span>, Integer.valueOf(count)); }</code> </pre> <br>  Fonction de remplacement de texte: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performSetTextAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AccessibilityNodeInfo ani, String text)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Build$VERSION.SDK_INT &gt;= <span class="hljs-number"><span class="hljs-number">21</span></span>) { Bundle b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); b.putCharSequence(<span class="hljs-string"><span class="hljs-string">"ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE"</span></span>, ((CharSequence)text)); result = ani.performAction(<span class="hljs-number"><span class="hljs-number">0x200000</span></span>, b); <span class="hljs-comment"><span class="hljs-comment">// ACTION_SET_TEXT } else { Object clipboard = context.getSystemService("clipboard"); if(clipboard != null) { ((ClipboardManager)clipboard).setPrimaryClip(ClipData.newPlainText("autofill_pm", ((CharSequence)text))); result = ani.performAction(0x8000); // ACTION_PASTE } else { result = false; } } return result; }</span></span></code> </pre> <br>  Ainsi, si le serveur de contr√¥le est correctement configur√©, Gustuff est en mesure de remplir les champs de texte de l'application bancaire et de cliquer sur les boutons n√©cessaires √† la transaction.  Le cheval de Troie n'a m√™me pas besoin d'√™tre autoris√© dans l'application - il suffit d'envoyer une commande pour d√©montrer la notification PUSH, puis d'ouvrir l'application bancaire pr√©c√©demment install√©e.  L'utilisateur passera par une autorisation, apr√®s quoi Gustuff pourra remplir automatiquement. <br><br><h3>  Module de traitement SMS </h3><br>  L'application d√©finit le gestionnaire d'√©v√©nements pour accepter les messages SMS par le p√©riph√©rique infect√©.  L'application √† l'√©tude peut recevoir des commandes de l'op√©rateur qui viennent dans le corps des messages SMS.  Les commandes sont au format: <br><br>  <b>7! 5 = &lt;% Base64 encoded command%&gt;</b> <br><br>  L'application recherche dans tous les messages SMS entrants la cha√Æne <b>7! 5 =</b> , si elle d√©tecte une cha√Æne, elle d√©code une cha√Æne Base64 √† l'offset 4 et ex√©cute la commande.  Les commandes sont similaires aux commandes avec CnC.  Le r√©sultat de l'ex√©cution est envoy√© au m√™me num√©ro que la commande.  Format de r√©ponse: <br><br>  <b>7 * 5 = &lt;% Encodage Base64 de la "commande code_r√©sultat"%&gt;</b> <br><br>  Facultativement, l'application peut envoyer tous les messages re√ßus au num√©ro racine.  Pour ce faire, un num√©ro racine doit √™tre sp√©cifi√© dans le fichier de pr√©f√©rences et l'indicateur de redirection de message est d√©fini.  Un SMS est envoy√© au num√©ro de l'attaquant au format: <br><br>  <b>&lt;% Du num√©ro%&gt; - &lt;% Heure, format: jj / MM / aaaa HH: mm: ss%&gt; &lt;% Corps SMS%&gt;</b> <br><br>  En option, l'application peut √©galement envoyer des messages √† CnC.  Le message SMS est envoy√© au serveur au format JSON: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%BotID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"sms"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"text"</span></span>:&lt;%SMS body%&gt;, <span class="hljs-attr"><span class="hljs-attr">"number"</span></span>:&lt;%From number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>:&lt;%Timestamp%&gt; } }</code> </pre> <br>  Si l'indicateur <b>nameGenerator ("DEFAULT_APP_SMS")</b> est d√©fini, l'application arr√™te le traitement des messages SMS et efface la liste des messages entrants. <br><br><h3>  Module proxy </h3><br>  Dans l'application √† l'√©tude, il existe un module Proxy Backconnect (ci-apr√®s d√©nomm√© module Proxy), qui a une classe distincte qui comprend des champs statiques avec configuration.  Les donn√©es de configuration sont stock√©es dans l'exemple sous forme ouverte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/4f/mi/g-4fmidam6alfsjuhw1ltmcodhy.png" alt="image alt"></div><br><br>  Toutes les actions effectu√©es par le module Proxy sont enregistr√©es dans des fichiers.  Pour ce faire, l'application dans le stockage externe cr√©e un r√©pertoire appel√© "logs" (le champ ProxyConfigClass.logsDir dans la classe de configuration), dans lequel les fichiers journaux sont stock√©s.  La journalisation se produit dans des fichiers avec des noms: <br><br><ol><li>  <b>main.txt</b> - cette classe <b>enregistre le</b> fonctionnement de la classe avec le nom CommandServer.  √Ä l'avenir, la journalisation de la cha√Æne str dans ce fichier sera d√©nomm√©e mainLog (str). </li><li>  <b>session - &lt;% id%&gt;. txt</b> - les donn√©es de journal associ√©es √† une session proxy sp√©cifique sont enregistr√©es dans ce fichier.  La journalisation ult√©rieure de la cha√Æne str dans ce fichier sera appel√©e sessionLog (str). </li><li>  <b>server.txt</b> - ces donn√©es enregistrent toutes les donn√©es √©crites dans les fichiers ci-dessus. </li></ol><br>  Format des donn√©es du journal: <br><br>  &lt;% Date%&gt; [Thread [&lt;% thread id%&gt;], id []]: cha√Æne de journal <br><br>  Les exceptions qui se produisent pendant le fonctionnement du module Proxy sont √©galement enregistr√©es dans un fichier.  Pour cela, l'application g√©n√®re un objet JSON au format: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"uncaughtException"</span></span>:&lt;%short description of throwable%&gt; <span class="hljs-string"><span class="hljs-string">"thread"</span></span>:&lt;%thread%&gt; <span class="hljs-string"><span class="hljs-string">"message"</span></span>:&lt;%detail message of throwable%&gt; <span class="hljs-string"><span class="hljs-string">"trace"</span></span>: //Stack trace info [ { <span class="hljs-attr"><span class="hljs-attr">"ClassName"</span></span>: <span class="hljs-string"><span class="hljs-string">"FileName"</span></span>: <span class="hljs-string"><span class="hljs-string">"LineNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"MethodName"</span></span>: }, { <span class="hljs-attr"><span class="hljs-attr">"ClassName"</span></span>: <span class="hljs-string"><span class="hljs-string">"FileName"</span></span>: <span class="hljs-string"><span class="hljs-string">"LineNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"MethodName"</span></span>: } ] }</code> </pre> <br>  Il la convertit ensuite en une repr√©sentation sous forme de cha√Æne et des journaux. <br><br>  Le module proxy est lanc√© apr√®s r√©ception de l'√©quipe appropri√©e.  Lorsqu'une commande arrive pour d√©marrer le module Proxy, l'application d√©marre un service appel√© <b>MainService</b> , qui est charg√© de contr√¥ler le fonctionnement du module Proxy - son d√©marrage et son arr√™t. <br><br>  √âtapes de d√©marrage du service: <br><br>  <b>1.</b> D√©marre une minuterie qui fonctionne une fois par minute et v√©rifie l'activit√© du module proxy.  Si le module n'est pas actif, il le d√©marre. <br>  De plus, lorsque l'√©v√©nement <b>android.net.conn.CONNECTIVITY_CHANGE</b> est d√©clench√©, le module Proxy d√©marre. <br><br>  <b>2. L'</b> application cr√©e un verrou de r√©veil avec le param√®tre <b>PARTIAL_WAKE_LOCK</b> et le capture.  Par cons√©quent, il ne permet pas au processeur de l'appareil de passer en mode veille. <br><br>  <b>3.</b> D√©marre la classe de traitement des commandes du module proxy en enregistrant d'abord la ligne mainLog <b>(¬´d√©marrer le serveur¬ª)</b> et <br><br>  <b>Serveur :: start () h√¥te [&lt;% proxy_cnc%&gt;], commandPort [&lt;% command_port%&gt;], proxyPort [&lt;% proxy_port%&gt;]</b> <br><br>  o√π <b>proxy_cnc, command_port et proxy_port</b> sont les param√®tres obtenus √† partir de la configuration du serveur proxy. <br><br>  La classe de traitement des commandes est appel√©e <b>CommandConnection</b> .  Imm√©diatement apr√®s le lancement, il effectue les actions suivantes: <br><br>  <b>4.</b> Se connecte √† <b>ProxyConfigClass.host</b> : <b>ProxyConfigClass.commandPort</b> et y envoie les donn√©es sur le p√©riph√©rique infect√© au format JSON: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%imei%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imsi"</span></span>:&lt;%imsi%&gt;, <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"manufacturer"</span></span>:&lt;%manufacturer%&gt;, <span class="hljs-attr"><span class="hljs-attr">"androidVersion"</span></span>:&lt;%androidVersion%&gt;, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>:&lt;%country%&gt;, <span class="hljs-attr"><span class="hljs-attr">"partnerId"</span></span>:&lt;%partnerId%&gt;, <span class="hljs-attr"><span class="hljs-attr">"packageName"</span></span>:&lt;%packageName%&gt;, <span class="hljs-attr"><span class="hljs-attr">"networkType"</span></span>:&lt;%networkType%&gt;, <span class="hljs-attr"><span class="hljs-attr">"hasGsmSupport"</span></span>:&lt;%hasGsmSupport%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simReady"</span></span>:&lt;%simReady%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simCountry"</span></span>:&lt;%simCountry%&gt;, <span class="hljs-attr"><span class="hljs-attr">"networkOperator"</span></span>:&lt;%networkOperator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simOperator"</span></span>:&lt;%simOperator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>:&lt;%version%&gt; }</code> </pre> <br>  O√π: <br><br><ul><li>  id - identifiant, essayant d'obtenir la valeur avec le champ "id" du fichier de pr√©f√©rences partag√©es avec le nom "x".  Si cette valeur n'a pas pu √™tre obtenue, elle en g√©n√®re une nouvelle.  , Proxy-  ÃÜ , ÃÜ   Bot ID. </li><li> imei ‚Äî IMEI ÃÜ.        ‚Äî         . </li><li> imsi ‚Äî International Mobile Subscriber Identity ÃÜ.        ‚Äî         . </li><li> model ‚Äî The end-user-visible name for the end product. </li><li> manufacturer ‚Äî The manufacturer of the product/hardware (Build.MANUFACTURER). </li><li> androidVersion ‚Äî    "&lt;%release_version%&gt; (&lt;%os_version%&gt;),&lt;%sdk_version%&gt;" </li><li> country ‚Äî   ÃÜ. </li><li> partnerId ‚Äì  . </li><li> packageName ‚Äì package name. </li><li> networkType ‚Äî     (: ¬´WIFI¬ª, ¬´MOBILE¬ª).     null. </li><li> hasGsmSupport ‚Äì true ‚Äì    GSM,  false. </li><li> simReady ‚Äì  SIM-. </li><li> simCountry ‚Äî ISO-  (  ÃÜ -). </li><li> networkOperator ‚Äî  .        ‚Äî         . </li><li> simOperator ‚Äî The Service Provider Name (SPN).        ‚Äî         . </li><li> version ‚Äî     -,   ÃÜ     ¬´1.6¬ª. </li></ul><br> <b>5.</b>       .      : <br><br><ul><li> 0 offset ‚Äì command </li><li> 1 offset ‚Äì sessionId </li><li> 2 offset ‚Äì length </li><li> 4 offset ‚Äî data </li></ul><br>     : <br><br> <b>mainLog(¬´Header { sessionId&lt;%id%&gt;], type[&lt;%command%&gt;], length[&lt;%length%&gt;] }¬ª)</b> <br><br>     : <br><br><table><tbody><tr><th> Name </th><th> Command </th><th> Data </th><th>  La description </th></tr><tr><td> <b>connectionId</b> </td><td>  0 </td><td> Connection ID </td><td>    </td></tr><tr><td> <b>SLEEP</b> </td><td>  3 </td><td>  Le temps </td><td>   Proxy- </td></tr><tr><td> <b>PING_PONG</b> </td><td>  4 </td><td>  - </td><td>  PONG- </td></tr></tbody></table><br> PONG-   4     : <b>0x04000000</b> . <br><br>    connectionId (   ) <b>CommandConnection</b>    <b>ProxyConnection</b> . <br><br><ul><li>      : <b>ProxyConnection</b>  <b>end</b> .    <b>ProxyConnection</b>     <b>ProxyConfigClass.host</b> : <b>ProxyConfigClass.proxyPort</b>   JSON-: </li></ul><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%connectionId%&gt; }</code> </pre> <br>     SOCKS5-,     ,     . ÃÜ       <b>end</b> .       : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hz/ed/y7/hzedy7sapdijp20ayiacbiwarc8.png" alt="image alt"></div><br><h2>  ÃÜ </h2><br>       ÃÜ  CnC-        SSL.             JSON-.       : <br><br><ul><li> <b>http://&lt;%CnC%&gt;/api/v1/set_state.php</b> ‚Äî   . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/get.php</b> ‚Äî  . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/load_sms.php</b> ‚Äî  SMS-ÃÜ   ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/load_ab.php</b> ‚Äî      ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/aevents.php</b> ‚Äì     ,   preference-ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/set_card.php</b> ‚Äî  ,    -,   Google Play Market. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/logs.php</b> ‚Äì  -. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/records.php</b> ‚Äì  ,     . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/set_error.php</b> ‚Äì   ÃÜ . </li></ul><br><h2>  </h2><br>              ,          ,     . <br><br>              ,    .               ,   ,             . <br><br>    ‚Äì   - ,      ,      -,    , ,     ,       ,     . <br><br><h3>    : </h3><br><ul><li>         Android  - ,  Google Play; </li><li>     <b> </b>    ; </li><li>     Android; </li><li>      ; </li><li>    ; </li><li>    ,   SMS-. </li></ul><br>   <b> </b> ,          Group-IB. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446948/">https://habr.com/ru/post/fr446948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446932/index.html">Fairway TDMS et BIM</a></li>
<li><a href="../fr446938/index.html">Syst√®me de particules dans Core Animation. Histoire de No√´l</a></li>
<li><a href="../fr446940/index.html">QA sur prod. Pourquoi c'est cool</a></li>
<li><a href="../fr446942/index.html">Serveur, vous m'entendez? Attaque BROP sur l'exemple de la t√¢che NeoQUEST-2019</a></li>
<li><a href="../fr446944/index.html">Pourquoi investir dans des entreprises non rentables?</a></li>
<li><a href="../fr446950/index.html">76% des fabricants n'ont aucune exp√©rience de la mise en ≈ìuvre d'additifs - pourquoi est-ce bon</a></li>
<li><a href="../fr446952/index.html">Cr√©er des histogrammes anim√©s √† l'aide de R</a></li>
<li><a href="../fr446956/index.html">C'est nocif pour la lumi√®re, ou comment garder la charge d'une batterie de voiture</a></li>
<li><a href="../fr446958/index.html">Tricky Perl Quine</a></li>
<li><a href="../fr446960/index.html">La maison que Jack a construite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>