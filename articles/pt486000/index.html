<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüåæ üôãüèº üîü ADSM3. Sistemas IPAM / DCIM üõÇ üõë ü••</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na s√©rie ADSM anterior, desenvolvemos a estrutura de automa√ß√£o, descobrimos por que a virtualiza√ß√£o apareceu e como ela funciona. Na √∫ltima parte, sel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ADSM3. Sistemas IPAM / DCIM</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486000/"> Na s√©rie ADSM anterior, desenvolvemos a estrutura de automa√ß√£o, descobrimos por que a virtualiza√ß√£o apareceu e como ela funciona.  Na <a href="https://linkmeup.ru/blog/479.html" rel="nofollow">√∫ltima parte,</a> selecionamos e justificamos o design da rede, os pap√©is dos dispositivos, fabricantes, decididos pelo LLD (endere√ßamento, roteamento, n√∫mero de sistemas aut√¥nomos). <br><br>  Agora, estamos prontos para pensar em como armazenar toda essa montanha de informa√ß√µes e recuper√°-las convenientemente no futuro. <br><br>  N√£o, √© claro, hoje existem empresas que controlam os endere√ßos IP alocados em uma planilha do Excel.  Mas este n√£o √© o nosso caminho. <br><br>  Mesmo para o escrit√≥rio de menor tamanho em algumas filiais, a presen√ßa de um sistema centralizado de gerenciamento de espa√ßo IP n√£o prejudicar√°. <br><br>  A necessidade de um sistema de invent√°rio √© √≥bvia sem uma palavra. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b44/a21/5cc/b44a215cc7c93ecf6eeca48c41d721d9.svg" width="800"><br><br>  Todas as edi√ß√µes do ADSM: <br><br>  <a href="https://habr.com/ru/post/453516/">0. ADSM.</a>  <a href="https://habr.com/ru/post/453516/">Parte zero.</a>  <a href="https://habr.com/ru/post/453516/">Planejamento</a> <br>  <a href="https://habr.com/ru/post/458622/">1. ADSM.</a>  <a href="https://habr.com/ru/post/458622/">Parte Um (que √© depois de zero).</a>  <a href="https://habr.com/ru/post/458622/">Virtualiza√ß√£o de rede</a> <br>  <a href="https://habr.com/ru/post/475614/">2. ADSM.</a>  <a href="https://habr.com/ru/post/475614/">Parte Dois.</a>  <a href="https://habr.com/ru/post/475614/">Projeto de rede</a> <br>  <a href="https://habr.com/ru/post/485618/">3. ADSM.</a>  <a href="https://habr.com/ru/post/485618/">Parte Tr√™s.</a>  <a href="https://habr.com/ru/post/485618/">Sistema IPAM / DCIM</a> <br><br>  Esta edi√ß√£o dedicarei aos sistemas integrais de automa√ß√£o de rede - o sistema de gerenciamento de espa√ßo de endere√ßo e o sistema de invent√°rio. <br><br>  Vamos selecion√°-lo e instal√°-lo, lidaremos com a arquitetura, o esquema do banco de dados, as interfaces de intera√ß√£o e o preencheremos.  E nas partes a seguir, come√ßaremos a escrever scripts simples que automatizam opera√ß√µes repetitivas, como adicionar novos racks. <br><br>  Al√©m disso, eu j√° publiquei um artigo separado sobre a <a href="https://habr.com/ru/post/485618/">API RESTful</a> , no qual fiz uma breve revis√£o de seus princ√≠pios e trabalho, precisaremos disso. <br><a name="habracut"></a><br><h1>  Conte√∫do </h1><br><ul><li>  <b>Arquitetura do sistema</b> </li><li>  <b>Esquema de dados NetBox</b> </li><li>  <b>Conclus√£o</b> </li><li>  <b>Algumas nuances da instala√ß√£o do NetBox</b> </li><li>  <b>Um pouco sobre o PostgreSQL</b> </li><li>  <b>Links √∫teis</b> </li></ul><br>  Hoje, o mercado oferece cerca de uma d√∫zia de ferramentas que implementam essa tarefa: paga e de c√≥digo aberto. <br><br>  Para as tarefas desta s√©rie de artigos, escolhi o NetBox pelos seguintes motivos: <br><br><ol><li>  √â gr√°tis </li><li>  Ele cont√©m as duas partes necess√°rias - invent√°rio e gerenciamento de espa√ßo IP. </li><li>  Possui uma API RESTful. </li><li>  Foi desenvolvido pela Digital Ocean (e mais especificamente, amado por todos os Jeremy Stretch) para si pr√≥prio, ou seja, para data centers.  Portanto, h√° quase tudo que voc√™ precisa e quase nada mais. </li><li>  √â suportado ativamente (Slack, Github, Google Newsletters) e est√° sendo atualizado. </li><li>  Este √© um c√≥digo aberto </li></ol><br><blockquote>  Para as necessidades do ADSM, implantei o NetBox em um virtualochka em nosso servidor (gra√ßas a Anton Klochkov e <a href="https://miran.ru/" rel="nofollow">Miran</a> ): <a href="http://netbox.linkmeup.ru:45127/" rel="nofollow">http://netbox.linkmeup.ru:45127</a> <br>  Al√©m disso, preenchi quase todos os dados que precisamos no futuro. <br>  Portanto, voc√™ pode tentar quase todos os exemplos e estudar o esquema de dados no modo de leitura at√© implantar sua instala√ß√£o. <br></blockquote>  Um pouco √∫til antes de come√ßar: <br><br><ul><li>  <a href="https://github.com/netbox-community/netbox" rel="nofollow">NetBox em si no github</a> </li><li>  <a href="https://github.com/netbox-community/netbox-docker" rel="nofollow">Vers√£o do cont√™iner</a> </li><li>  <a href="https://netbox.readthedocs.io/en/stable/" rel="nofollow">Instru√ß√µes completas de instala√ß√£o e toda a documenta√ß√£o do produto</a> </li><li>  <a href="https://github.com/digitalocean/pynetbox" rel="nofollow">Python NetKox SDK</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/api/docs/" rel="nofollow">Documenta√ß√£o da API</a> </li><li>  <a href="https://groups.google.com/forum/" rel="nofollow">Lista de discuss√£o</a> </li><li>  <a href="https://networktocode.slack.com/" rel="nofollow">Canal frouxo NetworkToCode</a> </li><li>  <a href="https://habr.com/ru/post/485618/">O que √© REST?</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/" rel="nofollow">Instala√ß√£o do NetBox para ADSM</a> </li></ul><br><hr><br><h1>  Arquitetura do sistema </h1><br><ul><li>  O NetBox √© escrito em Python3.  O que √© bom, porque v√°rias outras solu√ß√µes s√£o escritas em php e alter√°-las, se necess√°rio, n√£o √© t√£o simples. </li><li>  A estrutura do site em si √© o Django. </li><li>  O PostgreSQL √© usado como banco de dados. </li><li>  WEB-frontend (servi√ßo HTTP) - NGINX - proxies solicita√ß√µes ao Gunicron. </li><li>  WSGI - Gunicorn - a interface entre o Nginx e o pr√≥prio aplicativo. </li><li>  Estrutura de documenta√ß√£o da API - Swagger. </li><li>  Para demonizar o NetBox - Systemd. </li></ul><br><blockquote>  O NetBox √© um projeto jovem e r√°pido.  Por exemplo, no 2.7 eles abandonaram o supervisord e o Python 2.7 o alcan√ßou em favor do systemd.  N√£o faz muito tempo, n√£o havia cache ou Webhooks. <br><br>  Portanto, tudo muda rapidamente e as informa√ß√µes no artigo podem ficar desatualizadas no momento da leitura. <br></blockquote><br>  Em outras palavras, todos os componentes est√£o maduros e testados. <br><br>  Segundo o autor, o NetBox n√£o reflete o estado real da rede, mas o destino.  Portanto, nada √© carregado no NetBox a partir da rede - essa rede √© configurada de acordo com o conte√∫do do NetBox. <br>  Assim, o NetBox atua como a √∫nica fonte de verdade (papel vegetal com fonte √∫nica de verdade). <br><br>  E as altera√ß√µes na rede devem ser acionadas por altera√ß√µes na NetBox. <br><br>  E isso se encaixa muito bem na ideologia que professo nesta s√©rie de artigos - se voc√™ deseja fazer altera√ß√µes na rede - primeiro fa√ßa-as no sistema. <br><br><hr><br><h1>  Esquema de dados NetBox </h1><br>  As duas tarefas principais que o NetBox resolve s√£o gerenciamento e invent√°rio do espa√ßo de endere√ßo. <br><br>  √â improv√°vel que o NetBox se torne o √∫nico sistema de invent√°rio da empresa; ser√° um sistema adicional espec√≠fico para o invent√°rio da rede, retirando dados do sistema principal. <br><br>  Obviamente, no nosso caso, haver√° apenas o NetBox para fins de ADSM. <br><blockquote>  Neste ponto, a maioria dos dados iniciais no NetBox j√° foi inserida. <br>  Com esses dados, demonstrarei v√°rios exemplos de trabalho atrav√©s da API. <br>  Voc√™ pode simplesmente subir e ver: <a href="http://netbox.linkmeup.ru/" rel="nofollow">netbox.linkmeup.ru</a> : 45127 <br>  E os mesmos dados ser√£o necess√°rios no futuro, quando passarmos para a automa√ß√£o. <br></blockquote>  Em termos gerais, o esquema de dados pode ser visto pelo esquema de banco de dados no Postgres. <br><br><pre><code class="bash hljs">List of relations Schema | Name | Type | Owner --------+------------------------------------+-------+-------- public | auth_group | table | netbox public | auth_group_permissions | table | netbox public | auth_permission | table | netbox public | auth_user | table | netbox public | auth_user_groups | table | netbox public | auth_user_user_permissions | table | netbox public | circuits_circuit | table | netbox public | circuits_circuittermination | table | netbox public | circuits_circuittype | table | netbox public | circuits_provider | table | netbox public | dcim_cable | table | netbox public | dcim_consoleport | table | netbox public | dcim_consoleporttemplate | table | netbox public | dcim_consoleserverport | table | netbox public | dcim_consoleserverporttemplate | table | netbox public | dcim_device | table | netbox public | dcim_devicebay | table | netbox public | dcim_devicebaytemplate | table | netbox public | dcim_devicerole | table | netbox public | dcim_devicetype | table | netbox public | dcim_frontport | table | netbox public | dcim_frontporttemplate | table | netbox public | dcim_interface | table | netbox public | dcim_interface_tagged_vlans | table | netbox public | dcim_interfacetemplate | table | netbox public | dcim_inventoryitem | table | netbox public | dcim_manufacturer | table | netbox public | dcim_platform | table | netbox public | dcim_powerfeed | table | netbox public | dcim_poweroutlet | table | netbox public | dcim_poweroutlettemplate | table | netbox public | dcim_powerpanel | table | netbox public | dcim_powerport | table | netbox public | dcim_powerporttemplate | table | netbox public | dcim_rack | table | netbox public | dcim_rackgroup | table | netbox public | dcim_rackreservation | table | netbox public | dcim_rackrole | table | netbox public | dcim_rearport | table | netbox public | dcim_rearporttemplate | table | netbox public | dcim_region | table | netbox public | dcim_site | table | netbox public | dcim_virtualchassis | table | netbox public | django_admin_log | table | netbox public | django_content_type | table | netbox public | django_migrations | table | netbox public | django_session | table | netbox public | extras_configcontext | table | netbox public | extras_configcontext_platforms | table | netbox public | extras_configcontext_regions | table | netbox public | extras_configcontext_roles | table | netbox public | extras_configcontext_sites | table | netbox public | extras_configcontext_tags | table | netbox public | extras_configcontext_tenant_groups | table | netbox public | extras_configcontext_tenants | table | netbox public | extras_customfield | table | netbox public | extras_customfield_obj_type | table | netbox public | extras_customfieldchoice | table | netbox public | extras_customfieldvalue | table | netbox public | extras_customlink | table | netbox public | extras_exporttemplate | table | netbox public | extras_graph | table | netbox public | extras_imageattachment | table | netbox public | extras_objectchange | table | netbox public | extras_reportresult | table | netbox public | extras_tag | table | netbox public | extras_taggeditem | table | netbox public | extras_webhook | table | netbox public | extras_webhook_obj_type | table | netbox public | ipam_aggregate | table | netbox public | ipam_ipaddress | table | netbox public | ipam_prefix | table | netbox public | ipam_rir | table | netbox public | ipam_role | table | netbox public | ipam_service | table | netbox public | ipam_service_ipaddresses | table | netbox public | ipam_vlan | table | netbox public | ipam_vlangroup | table | netbox public | ipam_vrf | table | netbox public | secrets_secret | table | netbox public | secrets_secretrole | table | netbox public | secrets_secretrole_groups | table | netbox public | secrets_secretrole_users | table | netbox public | secrets_sessionkey | table | netbox public | secrets_userkey | table | netbox public | taggit_tag | table | netbox public | taggit_taggeditem | table | netbox public | tenancy_tenant | table | netbox public | tenancy_tenantgroup | table | netbox public | users_token | table | netbox public | virtualization_cluster | table | netbox public | virtualization_clustergroup | table | netbox public | virtualization_clustertype | table | netbox public | virtualization_virtualmachine | table | netbox</code> </pre> <br>  <a href="https://netbox.readthedocs.io/en/stable/" rel="nofollow">Recursos do NetBox</a> : <br><br><ul><li>  <b>Gerenciamento de endere√ßo IP (IPAM)</b> - prefixos IP, endere√ßos, VRFs e VLANs </li><li>  <b>Racks de equipamentos</b> - <b>racks de equipamentos</b> organizados por site, grupo e fun√ß√£o </li><li>  <b>Dispositivos</b> - dispositivos, seus modelos, fun√ß√µes, componentes e implanta√ß√£o </li><li>  <b>Conex√µes</b> - <b>conex√µes de</b> rede, console e energia entre dispositivos </li><li>  <b>Virtualiza√ß√£o</b> - M√°quinas Virtuais e Clusters de Computa√ß√£o </li><li>  <b>Circuitos de dados</b> - Conex√µes do provedor </li><li>  <b>Segredos</b> - Armazenamento de credenciais de usu√°rio criptografado </li></ul><br>  Neste artigo, abordarei o seguinte: DCIM - Gerenciamento de infraestrutura de datacenter, IPAM - Gerenciamento de endere√ßo IP, Virtualiza√ß√£o, Coisas legais adicionais. <br><br><hr><br>  Primeiras coisas primeiro. <br><br><h2>  DCIM </h2><br>  A parte mais importante √©, sem d√∫vida, o equipamento que temos e como ele est√° conectado.  Mas tudo come√ßa <b>onde</b> est√°. <br><br><h3>  Regi√µes e sites (regi√µes / sites) </h3><br>  No paradigma NetBox, um dispositivo √© instalado em um site, um site pertence a uma regi√£o e regi√µes podem ser aninhadas.  No entanto, o dispositivo n√£o pode ser instalado simplesmente na regi√£o.  Se houver tal necessidade, um site separado deve ser estabelecido. <br><br>  Para o nosso caso, isso pode (e ser√°) parecer com o seguinte: <br><br><ul><li>  <a href="http://netbox.linkmeup.ru:45127/dcim/sites/%3Fregion%3Dru" rel="nofollow">R√∫ssia</a> : <a href="http://netbox.linkmeup.ru:45127/dcim/sites/msk/" rel="nofollow">Moscou</a> , <a href="http://netbox.linkmeup.ru:45127/dcim/sites/kzn/" rel="nofollow">Kazan</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/dcim/sites/%3Fregion%3Dsp" rel="nofollow">Espanha</a> : <a href="http://netbox.linkmeup.ru:45127/dcim/sites/bcn/" rel="nofollow">Barcelona</a> , <a href="http://netbox.linkmeup.ru:45127/dcim/sites/mlg/" rel="nofollow">M√°laga</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/dcim/sites/%3Fregion%3Dcn" rel="nofollow">China</a> : <a href="http://netbox.linkmeup.ru:45127/dcim/sites/sha/" rel="nofollow">Xangai</a> , <a href="http://netbox.linkmeup.ru:45127/dcim/sites/Sia/" rel="nofollow">Xian</a> . </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/703/ab7/358/703ab73587ab4d1fe9079aa548ba93d1.png" width="800"><br><br>  Lembro onde e como planejamos nossa rede: <a href="https://linkmeup.ru/blog/479.html" rel="nofollow">ADSM2.</a>  <a href="https://linkmeup.ru/blog/479.html" rel="nofollow">Projeto de rede</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1df/012/888/1df0128888e0708959f6108e176a0de9.png" width="700"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5d/b34/709/d5db34709814c8e1fe07f74b8c9f96fd.png" width="800"><br><br>  Vamos ver o que a API permite. <br><br>  Aqui est√° uma lista de todas as regi√µes: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/regions/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.regions.all()</code> </pre> <br><blockquote>  A seguir, darei exemplos de curl e pynetbox sem gerar o resultado. <br>  <b>N√£o se esque√ßa da</b> barra no final do URL - sem ela, n√£o funcionar√°. <br>  Eu falei sobre como usar o pynetbox em um artigo sobre a <a href="https://habr.com/ru/post/485618/">API RESTful</a> . <br></blockquote>  Obtenha a lista de sites: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/sites/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.sites.all()</code> </pre><br>  Lista de sites em uma regi√£o espec√≠fica: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/sites/?region=ru"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.sites.filter(region=<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)</code> </pre><br><blockquote>  Observe que a pesquisa n√£o √© por nome completo, mas pela chamada <a href="https://qna.habr.com/q/375615" rel="nofollow">lesma</a> . <br>  <b>Slug</b> √© um identificador que cont√©m apenas caracteres seguros: [0-9A-Za-z-_], que pode ser usado no URL.  √â definido ao criar um objeto, por exemplo, "bcn" em vez de "Barcelona". <br><img src="https://habrastorage.org/getpro/habr/post_images/3db/6cc/f89/3db6ccf89097c571900457aebbc922fe.png" width="400"><br></blockquote><br><hr><br><h3>  Aparelhos </h3><br>  O dispositivo em si tem uma <a href="http://netbox.linkmeup.ru:45127/dcim/device-roles/" rel="nofollow">fun√ß√£o</a> , por exemplo, folha, coluna, borda, borda. <br><br>  Obviamente, √© algum tipo de <a href="http://netbox.linkmeup.ru:45127/dcim/device-types/" rel="nofollow">modelo de</a> algum <a href="http://netbox.linkmeup.ru:45127/dcim/manufacturers/" rel="nofollow">fornecedor</a> . <br>  Por exemplo, <a href="http://netbox.linkmeup.ru:45127/dcim/device-types/%3Fmanufacturer%3Darista" rel="nofollow">Arista</a> . <br><br>  Assim, um fornecedor √© criado primeiro e depois dentro do modelo. <br><br>  <a href="http://netbox.linkmeup.ru:45127/dcim/device-types/2/" rel="nofollow">O modelo √©</a> caracterizado por um nome, um conjunto de interfaces de servi√ßo, uma interface de controle remoto, uma porta de console e um conjunto de m√≥dulos de energia. <br><br>  Al√©m de comutadores, roteadores e hosts com interfaces Ethernet, voc√™ pode criar servidores de console. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/826/9a4/f9f/8269a4f9ffb7f7e66096eff89dc19013.png" width="800"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c81/cce/0f9/c81cce0f9d543eedd4f7c1e1ede5f43f.png" width="500"><br><br>  Obtenha uma lista de todos os dispositivos: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.all()</code> </pre><br>  Todos os dispositivos para um site espec√≠fico: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?site=mlg"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(site=<span class="hljs-string"><span class="hljs-string">"mlg"</span></span>)</code> </pre><br>  Todos os dispositivos de um determinado modelo <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?model=veos"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(device_type_id=<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre><br>  Todos os dispositivos com uma fun√ß√£o espec√≠fica: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?role=leaf"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(role=<span class="hljs-string"><span class="hljs-string">"leaf"</span></span>)</code> </pre><br>  O dispositivo pode estar em diferentes status: Ativo, Off-line, Planejado, etc. <br><br>  Todos os dispositivos ativos: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?status=active"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(status=<span class="hljs-string"><span class="hljs-string">"active"</span></span>)</code> </pre><br><hr><br><h3>  Interfaces </h3><br>  O NetBox suporta muitos tipos de <a href="http://netbox.linkmeup.ru:45127/api/dcim/_choices/" rel="nofollow">interfaces</a> f√≠sicas e LAGs, no entanto, todas as virtuais, como Vlan / IRB e loopback, s√£o combinadas sob um tipo - Virtual. <br>  Cada interface est√° vinculada a um dispositivo. <br><br>  As interfaces do dispositivo podem ser conectadas entre si.  Isso ser√° exibido na interface e nas respostas da API (atributo linked_endpoint). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aea/c56/b47/aeac56b47e58145211f5726c8e48cb91.png" width="800"><br><br>  A interface pode estar em v√°rios modos: Marcado ou Acesso. <br><br>  Consequentemente, ele pode ser lan√ßado na tag com ou sem VLANs - neste site ou global. <br><br>  Obtenha uma lista de todas as interfaces de dispositivos: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.interfaces.filter(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>)</code> </pre><br>  Obtenha uma lista de VLANs de uma interface espec√≠fica. <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;name=Ethernet7"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.interfaces.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Ethernet7"</span></span>).untagged_vlan.vid</code> </pre><br><blockquote>  Observe que aqui eu j√° uso o m√©todo <b>get em</b> vez do <b>filtro</b> .  Filtro retorna uma lista, mesmo se o resultado for um √∫nico objeto.  Get - retorna um √∫nico objeto ou falha se o resultado da consulta for uma lista de objetos. <br><br>  Portanto, get deve ser usado apenas quando voc√™ tiver certeza absoluta de que o resultado estar√° em uma √∫nica c√≥pia. <br><br>  Aqui, logo ap√≥s a solicita√ß√£o, viro para os atributos do objeto.  A rigor, isso est√° errado: se nada foi encontrado pela solicita√ß√£o, o pynetbox retornar√° None e n√£o possui o atributo "untagged_vlan". <br><br>  E tamb√©m observe que nem em todos os lugares o pynetbox espera slug, algum lugar e nome. <br></blockquote>  Descubra a qual interface de qual dispositivo uma interface espec√≠fica est√° conectada: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;name=Ethernet1"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">iface = nb.dcim.interfaces.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Ethernet1"</span></span>) iface.connected_endpoint.device iface.connected_endpoint.name</code> </pre><br>  Descubra o nome da interface de gerenciamento: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;mgmt_only=true"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.interfaces.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, mgmt_only=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br><hr><br><h3>  Portas do console </h3><br>  As portas do console n√£o s√£o interfaces, portanto, elas s√£o renderizadas como terminais separados. <br>  As portas do dispositivo podem ser associadas √†s portas do servidor do console. <br><br>  Descubra em qual porta o servidor do console ao qual um dispositivo espec√≠fico est√° conectado. <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/console-ports/?device=mlg-leaf-0"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.console_ports.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>).serialize()</code> </pre><br><blockquote>  O m√©todo <b>serialize</b> no pynetbox permite converter os atributos de uma inst√¢ncia de uma classe em um dicion√°rio. <br></blockquote><hr><br><h2>  Ipam </h2><br><h3>  VLAN e VRF </h3><br>  Eles podem ser vinculados a um local - √∫til para VLAN. <br><br>  Ao criar um VRF, voc√™ pode especificar se o espa√ßo de endere√ßo pode cruzar com outros VRFs. <br><br>  Obtenha uma lista de todas as VLANs: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/vlans/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.vlans.all()</code> </pre><br>  Obtenha uma lista de todos os VRFs: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/vrfs/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.vrfs.all()</code> </pre><br><hr><br><h3>  Prefixos de IP </h3><br>  Eles t√™m uma estrutura hier√°rquica.  Pode pertencer a qualquer VRF (se n√£o, ent√£o Global). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/94b/ea6/8c4/94bea68c425c9a8bd601c9a0da74193e.png" width="800"><br><br>  O NetBox tem uma representa√ß√£o visual muito conveniente de prefixos gratuitos: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1be/90e/14d/1be90e14da8f4c3bedc4bcb892cb5156.png" width="800"><br><br>  Voc√™ pode selecion√°-lo simplesmente clicando na linha verde. <br><br>  Pode ser anexado a um local.  Voc√™ pode selecionar o pr√≥ximo sub-prefixo gratuito do tamanho necess√°rio ou o pr√≥ximo endere√ßo IP gratuito por meio da API. <br><br>  A marca de sele√ß√£o / par√¢metro "√â um pool" determina se o 0-√©simo endere√ßo desse prefixo ser√° destacado durante a sele√ß√£o autom√°tica ou se ser√° iniciado a partir do 1¬∫. <br><br>  Obtenha uma lista de prefixos de IP do site M√°laga com a fun√ß√£o Underlay e um comprimento de 19: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/?site=mlg&amp;role=underlay&amp;mask_length=19"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">prefix = nb.ipam.prefixes.get(site=<span class="hljs-string"><span class="hljs-string">"mlg"</span></span>, role=<span class="hljs-string"><span class="hljs-string">"underlay"</span></span>, mask_length=<span class="hljs-string"><span class="hljs-string">"19"</span></span>)</code> </pre><br>  Obtenha uma lista de prefixos gratuitos na regi√£o da R√∫ssia com a fun√ß√£o Underlay: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/40/available-prefixes/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="bash hljs">prefix.available_prefixes.list()</code> </pre> <br>  Destaque o seguinte prefixo gratuito 24: <br><br><pre> <code class="bash hljs">curl -X POST <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/40/available-prefixes/"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"accept: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Authorization: TOKEN a9aae70d65c928a554f9a038b9d4703a1583594f"</span></span> \ -d <span class="hljs-string"><span class="hljs-string">"{\"prefix_length\": 24}"</span></span></code> </pre> <br><pre> <code class="bash hljs">prefix.available_prefixes.create({<span class="hljs-string"><span class="hljs-string">"prefix_length"</span></span>:24})</code> </pre> <br><blockquote>  Quando precisamos selecionar algum filho dentro de um objeto, o m√©todo POST √© usado e precisamos especificar o ID do objeto pai - neste caso - <b>40</b> .  Descobrimos ligando do exemplo anterior. <br>  No caso de pynetbox, primeiro (no exemplo anterior) salvamos o resultado na vari√°vel <b>prefix</b> e depois voltamos para o atributo <b>available_prefixes</b> e o m√©todo <b>create</b> . <br>  Este exemplo <b>n√£o funcionar√°</b> para voc√™, pois o token com o direito de grava√ß√£o j√° √© inv√°lido. <br></blockquote><hr><br><h3>  Endere√ßos IP </h3><br>  Se houver um prefixo incluindo este endere√ßo, eles far√£o parte dele.  Eles podem estar por conta pr√≥pria. <br>  Pode pertencer a qualquer VRF ou estar na Global. <br>  Eles podem ser conectados √† interface, mas podem ficar no ar. <br>  Voc√™ pode selecionar o pr√≥ximo endere√ßo IP gratuito no prefixo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a1/c4d/442/4a1c4d4428f703d9a90766ffa9351fe8.png" width="800"><br><br>  Para fazer isso, basta clicar na linha verde. <br><br>  Obtenha uma lista de endere√ßos IP para uma interface espec√≠fica: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?interface_id=8"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.ip_addresses.filter(interface_id=<span class="hljs-number"><span class="hljs-number">8</span></span>)</code> </pre><br>  Ou: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?device=mlg-leaf-0&amp;interface=Ethernet1"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.ip_addresses.filter(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, interface=<span class="hljs-string"><span class="hljs-string">"Ethernet1"</span></span>)</code> </pre><br>  Obtenha uma lista de todos os endere√ßos IP do dispositivo: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?device=mlg-leaf-0"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.ip_addresses.filter(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>)</code> </pre><br>  Obtenha uma lista dos endere√ßos IP de prefixo dispon√≠veis: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/28/available-ips/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">prefix = nb.ipam.prefixes.get(site=<span class="hljs-string"><span class="hljs-string">"mlg"</span></span>, role=<span class="hljs-string"><span class="hljs-string">"leaf-loopbacks"</span></span>) prefix.available_ips.list()</code> </pre><br><blockquote>  Aqui, novamente, voc√™ precisa especificar o ID do prefixo no URL a partir do qual selecionamos o endere√ßo - desta vez, √© 28. <br></blockquote>  Destaque o seguinte endere√ßo IP gratuito no prefixo: <br><br><pre> <code class="bash hljs">curl -X POST <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/28/available-ips/"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"accept: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Authorization: TOKEN a9aae70d65c928a554f9a038b9d4703a1583594f"</span></span></code> </pre> <br><pre> <code class="bash hljs">prefix.available_ips.create()</code> </pre> <br><hr><br><h2>  Virtualiza√ß√£o </h2><br>  Ainda estamos lutando pelo t√≠tulo da DC moderna.  Onde sem virtualiza√ß√£o. <br><br>  O NetBox n√£o parece e n√£o √© um lugar onde vale a pena armazenar informa√ß√µes sobre m√°quinas virtuais (voc√™ pode at√© especular sobre a necessidade de armazenar m√°quinas f√≠sicas nele).  No entanto, isso pode ser √∫til para n√≥s, por exemplo, √© poss√≠vel inserir informa√ß√µes sobre refletores de rota, m√°quinas de servi√ßo, como NTP, Syslog, servidores S-Flow e m√°quinas de controle. <br><br>  A VM possui sua pr√≥pria lista de interfaces - elas s√£o diferentes das interfaces de dispositivos f√≠sicos e t√™m seu pr√≥prio ponto de extremidade separado. <br><br>  Ent√£o voc√™ pode listar todas as m√°quinas virtuais: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/virtualization/virtual-machines/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.virtualization.virtual_machines.all()</code> </pre><br>  Ent√£o - de todas as interfaces de todas as VMs: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/virtualization/interfaces/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.virtualization.interfaces.all()</code> </pre><br>  Para uma VM, n√£o √© poss√≠vel especificar o hypervisor / m√°quina f√≠sica espec√≠fica na qual est√° sendo executada, mas √© poss√≠vel especificar um cluster.  Embora nem tudo seja t√£o desesperador.  Continue lendo. <br><br><hr><br><h2>  Extra nice stuff </h2><br>  A funcionalidade b√°sica do NetBox cobre a maioria das tarefas de muitos usu√°rios, mas n√£o todas.  Ainda assim, o produto foi originalmente escrito para resolver os problemas de uma empresa em particular.  No entanto, est√° desenvolvendo ativamente e novos lan√ßamentos s√£o lan√ßados com bastante <a href="https://github.com/netbox-community/netbox/releases" rel="nofollow">frequ√™ncia</a> .  Assim, novas fun√ß√µes aparecem. <br><br>  Assim, por exemplo, desde a minha primeira instala√ß√£o do NetBox h√° alguns anos, surgiram tags, contextos de configura√ß√£o, webhooks, cache, supervisord alterados para systemd, armazenamento externo de arquivos. <br><br>  Cuidado. <br><br><h3>  Campos personalizados </h3><br>  √Äs vezes, voc√™ deseja adicionar um campo a qualquer entidade na qual voc√™ pode colocar dados arbitr√°rios. <br><br>  Por exemplo, indique o n√∫mero do contrato de fornecimento pelo qual o switch foi comprado ou o nome da m√°quina f√≠sica na qual a VM est√° sendo executada. <br><br>  √â aqui que os campos personalizados s√£o resgatados - exatamente um campo com um valor de texto que pode ser adicionado a quase qualquer entidade na NetBox. <br><br>  Crie campos personalizados no painel de administra√ß√£o <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1cf/10e/568/1cf10e56808f227ce7f7270581b84a31.png" width="600"><br><br>  √â assim que aparece ao editar o dispositivo para o qual o campo personalizado foi criado: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3a/c2b/c78/d3ac2bc78d80acccc3895463f7ed7295.png" width="450"><br><br>  Solicitar uma lista de dispositivos por valor custom_field <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?cf_contract_number=0123456789"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(cf_contract_number=<span class="hljs-string"><span class="hljs-string">"0123456789"</span></span>)</code> </pre><br><hr><br><h3>  Contexto de configura√ß√£o </h3><br>  √Äs vezes, voc√™ quer algo mais que texto n√£o estruturado.  Em seguida, o <a href="http://netbox.linkmeup.ru:45127/extras/config-contexts/1/" rel="nofollow">contexto de configura√ß√£o</a> √© resgatado. <br><br>  Esta √© uma oportunidade para introduzir um conjunto de dados estruturados no formato JSON, que n√£o tem mais para colocar. <br><br>  Pode ser, por exemplo, um conjunto de comunidades BGP ou uma lista de servidores Syslog. <br><br>  O contexto de configura√ß√£o pode ser local - configurado para um objeto espec√≠fico - ou global, quando √© configurado uma vez e, em seguida, se aplica a todos os objetos que atendem a determinadas condi√ß√µes (por exemplo, localizadas no mesmo site ou em execu√ß√£o na mesma plataforma). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97a/406/224/97a406224499ed35e9c471c3709a8d98.png" width="800"><br><br>  O contexto de configura√ß√£o √© adicionado automaticamente aos resultados da consulta.  Ao mesmo tempo, os contextos local e global se fundem em um. <br><br>  Por exemplo, para um dispositivo apenas uma garota russa simples, para a qual existe um contexto local, a sa√≠da conter√° a chave "config_context": <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?q=russian"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/031/608/4bd/0316084bd52d028434631298a22ba33e.png" width="204"><br><br><hr><br><h3>  Tags </h3><br>  √â dif√≠cil dizer algo novo sobre tags.  Eles s√£o  Eles s√£o convenientes para adicionar qualquer recurso.  Por exemplo, voc√™ pode marcar as op√ß√µes "byada" do lote em que a mem√≥ria falha. <br><br><hr><br><h3>  Webhooks </h3><br>  Uma coisa insubstitu√≠vel quando voc√™ precisa de outros servi√ßos para aprender sobre as altera√ß√µes no NetBox. <br>  Por exemplo, ao iniciar um novo comutador, um gancho √© enviado ao sistema de automa√ß√£o, que inicia o processo de configura√ß√£o e coloca√ß√£o do dispositivo. <br><br><hr><br><h1>  Conclus√£o </h1><br>  Neste artigo, n√£o pretendo considerar todos os recursos do NetBox; portanto, darei tudo o mais para voc√™.  Entenda, tente. <br><br>  Al√©m disso, como parte da constru√ß√£o do sistema de automa√ß√£o, tocarei apenas nas partes que realmente precisamos. <br><br>  Ent√£o, acima, eu falei brevemente sobre o que √© o NetBox e como os dados s√£o armazenados nele. <br><br>  Repito que j√° inseri quase todos os dados necess√°rios l√° e voc√™ pode arrastar um <a href="" rel="nofollow">despejo de banco de dados para</a> si mesmo. <br><br>  Tudo est√° pronto para o pr√≥ximo est√°gio de automa√ß√£o: escrever um sistema (ahaha, apenas scripts) para inicializar os dispositivos e gerenciar a configura√ß√£o. <br><br><hr><br>  Mas, antes de terminar o artigo, direi algumas palavras sobre a instala√ß√£o e opera√ß√£o dos componentes NetBox. <br><br><h1>  Algumas nuances da instala√ß√£o do NetBox </h1><br>  N√£o descreverei o processo de instala√ß√£o em detalhes - ele √© mais do que famoso na <a href="https://netbox.readthedocs.io/en/stable/installation/" rel="nofollow">documenta√ß√£o oficial</a> . <br><br>  Voc√™ pode ver o processo de inicializa√ß√£o da imagem do docker NetBox e trabalhar na GUI no v√≠deo de Dima Figol ( <a href="https://www.youtube.com/watch%3Fv%3DGGXgAlWm9aY%26t%3D9655s" rel="nofollow">uma</a> e <a href="https://www.youtube.com/watch%3Fv%3Da3yK_WAisPw" rel="nofollow">duas vezes</a> ) e <a href="https://www.youtube.com/watch%3Fv%3DI_Ra3PIR2Lc%26feature%3Dyoutu.be" rel="nofollow">Emil Garipov</a> . <br><br>  Em geral, se voc√™ seguir rigorosamente as etapas de instala√ß√£o / inicializa√ß√£o, tudo dar√° certo. <br>  Mas aqui est√£o as nuances que voc√™ pode esquecer acidentalmente. <br><br><ul><li>  No arquivo configuration.py, o par√¢metro <a href="https://netbox.readthedocs.io/en/stable/installation/2-netbox/" rel="nofollow">ALLOWED_HOSTS</a> deve ser preenchido: <br><pre> <code class="bash hljs">ALLOWED_HOSTS = [<span class="hljs-string"><span class="hljs-string">'netbox.linkmeup.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>]</code> </pre> <br>  Aqui voc√™ precisa especificar todos os nomes poss√≠veis de NetBox aos quais voc√™ acessar√°, por exemplo, pode haver um endere√ßo IP externo ou 127.0.0.1 ou alias de DNS. <br>  Se isso n√£o for feito, o site da NetBox n√£o abrir√° e exibir√° 400. </li><li>  No mesmo arquivo, <a href="https://netbox.readthedocs.io/en/stable/installation/2-netbox/" rel="nofollow">SECRET_KEY</a> deve ser especificado, o qual voc√™ pode inventar ou gerar um script. </li><li>  A p√°gina principal mostrar√° 502 Bad Gateway se algo estiver errado com a configura√ß√£o do banco de dados PostgreSQL: verifique o host (se instalado em outra m√°quina), porta, nome do banco de dados, nome de usu√°rio e senha. </li><li>  Por <a href="" rel="nofollow">algum tempo, o</a> NetBox, por padr√£o, n√£o concede direitos de leitura sem autoriza√ß√£o. <br><br>  Tudo isso muda na mesma configuration.py: <br><br><pre> <code class="bash hljs">EXEMPT_VIEW_PERMISSIONS = [<span class="hljs-string"><span class="hljs-string">'*'</span></span>]</code> </pre> </li><li>  E tamb√©m as solicita√ß√µes de API retornar√£o 200 e n√£o funcionar√£o se n√£o houver uma barra no URL da API no final. <br><pre> <code class="bash hljs">curl -X GET -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span> <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices"</span></span></code> </pre> <br></li></ul><br><hr><br><h1>  Um pouco sobre o PostgreSQL </h1><br>  Para se conectar ao servidor: <br><br><pre> <code class="bash hljs">psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt;</code> </pre> <br>  Por exemplo: <br><br><pre> <code class="bash hljs">psql -U netbox -h localhost netbox</code> </pre> <br>  Para exibir todas as tabelas: <br><br><pre> <code class="bash hljs">/dt</code> </pre> <br>  Para sair: <br><br><pre> <code class="bash hljs">/q</code> </pre> <br>  Para um despejo de banco de dados: <br><br><pre> <code class="bash hljs">pg_dump -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; &gt; netbox.sql</code> </pre> <br>  Se voc√™ n√£o quiser inserir uma senha todas as vezes: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> *:*:*:&lt;i&gt;username&lt;/i&gt;:&lt;i&gt;password&lt;/i&gt; &gt; ~/.pgpass chmod 600 ~/.pgpass</code> </pre> <br>  Se voc√™ possui sua pr√≥pria instala√ß√£o e n√£o deseja fazer tudo manualmente, basta fazer um despejo do banco de dados atual do NetBox <a href="" rel="nofollow">aqui</a> : <br><br><pre> <code class="bash hljs">psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; &lt; netbox_initial_db.sql</code> </pre> <br>  Se voc√™ primeiro precisar descartar todas as tabelas (e precisar fazer isso), poder√° preparar o arquivo com anteced√™ncia: <br><br><pre> <code class="bash hljs">psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; \o drop_all_tables.sql select <span class="hljs-string"><span class="hljs-string">'drop table '</span></span> || tablename || <span class="hljs-string"><span class="hljs-string">' cascade;'</span></span> from pg_tables; \q psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; -f drop_all_tables.sql</code> </pre> <br><hr><br><h1>  Links √∫teis </h1><br><ul><li>  <a href="https://github.com/netbox-community/netbox" rel="nofollow">NetBox em si no guthub</a> </li><li>  <a href="https://github.com/netbox-community/netbox-docker" rel="nofollow">Vers√£o do cont√™iner</a> </li><li>  <a href="https://netbox.readthedocs.io/en/stable/" rel="nofollow">Instru√ß√µes completas de instala√ß√£o e toda a documenta√ß√£o do produto</a> </li><li>  <a href="http://karneliuk.com/2019/04/documenting-your-network-infrastructure-in-netbox-integrating-with-ansible-over-rest-api-and-automating-provisioning-of-cumulus-linux-arista-eos-nokia-sr-os-and-cisco-ios-xr/" rel="nofollow">Documentando sua infraestrutura de rede no NetBox, integrando-se √† API Ansible over REST</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3DGGXgAlWm9aY%26t%3D9655s" rel="nofollow">IPAM NetBox e sua API, Docker, Postman</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3Da3yK_WAisPw" rel="nofollow">IPAM NetBox e sua API, modelos de configura√ß√£o com Python</a> </li><li>  <a href="https://github.com/digitalocean/pynetbox" rel="nofollow">Python NetKox SDK</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/api/docs/" rel="nofollow">Documenta√ß√£o da API</a> </li><li>  <a href="https://groups.google.com/forum/" rel="nofollow">Lista de discuss√£o</a> </li><li>  <a href="https://networktocode.slack.com/" rel="nofollow">Canal frouxo NetworkToCode</a> </li><li>  <a href="https://habr.com/ru/post/485618/">O que √© REST?</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/" rel="nofollow">Instala√ß√£o do NetBox para ADSM</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt486000/">https://habr.com/ru/post/pt486000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt485974/index.html">Modem Raspberry Pi e SIM7600E 4G HAT</a></li>
<li><a href="../pt485986/index.html">As 5 principais tend√™ncias de localiza√ß√£o em 2020</a></li>
<li><a href="../pt485990/index.html">Automa√ß√£o mata?</a></li>
<li><a href="../pt485996/index.html">APM el√°stico no aplicativo</a></li>
<li><a href="../pt485998/index.html">LyX: Observa√ß√µes gerais. Parte 2</a></li>
<li><a href="../pt486006/index.html">Armazene o status do bate-papo na pilha</a></li>
<li><a href="../pt486010/index.html">Fazendo uma demonstra√ß√£o para um telefone antigo - AONDEMO</a></li>
<li><a href="../pt486014/index.html">SLAC Tour: Laborat√≥rio Nacional de Aceleradores do Departamento de Energia dos EUA em Stanford</a></li>
<li><a href="../pt486018/index.html">Resultados da Pesquisa da Sess√£o</a></li>
<li><a href="../pt486024/index.html">Gr√°ficos realmente simples em R para ci√™ncia e jornalismo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>