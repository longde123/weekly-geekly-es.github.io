<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥕 🤚🏿 🧔 一个请求的历史 🏿 🚚 😠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="想象一下您从事新工作的第一天。 办公室位于完全陌生的Kurskaya地铁站区域。 午餐快到了。 您打开搜索应用程序，写上“ East on Kursk”，并获得可供选择的用餐选择。 

 “库尔斯克吃”请求的背后是什么？如何处理它以找到您真正需要的东西？ 在本文中，我将告诉您2GIS搜索团队如何尽一...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>一个请求的历史</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/2gis/blog/433696/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/9q/ks/jt/9qksjtj-bhuaxl7okhilaidgqsa.png" alt="图片"></div><br> 想象一下您从事新工作的第一天。 办公室位于完全陌生的Kurskaya地铁站区域。 午餐快到了。 您打开搜索应用程序，写上<b>“ East on Kursk”，</b>并获得可供选择的用餐选择。 <br><br>  <b>“库尔斯克吃”</b>请求的背后是什么？如何处理它以找到您真正需要的东西？ 在本文中，我将告诉您2GIS搜索团队如何尽一切可能使用户的城市生活更加便利和舒适。 <br><a name="habracut"></a><br> 重要的是要了解搜索查询的文本只是冰山一角，只是用户直接与之交互的一小部分。 除文本外，搜索查询本身还包含许多其他数据。 它们包括有关用户位置，他看到的地图区域，他的收藏夹中的记录集以及有关搜索模式的信息的个性化信息。 例如，在地图上或建筑物中进行搜索，或者对路线进行搜索。 数据是良好搜索功能成功的关键。 <br><br> 我们非常注意我们的数据及其结构。 此外，我们将搜索算法称为2GIS结构搜索，因为它可以通过对我们的结构化数据进行有效而快速的搜索而变得更加敏锐。 我们专门准备搜索索引及其构建数据。 我不会赘述，我只能说数据的组织方式要足够简单以至于可以处理，可以被很好地压缩，而且最重要的是，它使我们即使在移动设备上也可以快速处理数据。 <br><br> 此外，搜索可以脱机工作，因此对搜索索引的速度和数量有特殊要求。 我们非常重视此功能-我们会不断压缩搜索索引，评估各种平台上的性能，并在特定搜索条件超出设置的时间限制时加快功能。 顺便说一句，我们可以吹嘘移动设备上2GIS中的普通搜索查询比应用程序根据结果绘制下拉列表要快。 <br><br> 在下面，我将揭开神秘面纱，涵盖我们搜索的魔力。 例如，我们采用上述请求<b>“在库尔斯克吃”</b> 。 考虑其处理的阶段以及每个阶段发生的情况。 所以走吧！ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cm/bo/ik/cmboik3cpygx88wzp2apwq7gvjq.jpeg" width="375" height="667"></div><br><br><h3> 阶段1.解析 </h3><br> 输入参数：请求<b>“在Kursk上吃”</b> <br><br> 首先，我们需要解析请求文本。 这很重要，因为在解析之后，我们不能使用请求文本，而可以使用它所组成的标记集。 令牌是单个请求字。 在我们的情况下，我们将收到一组三个令牌： <b>“吃”</b> ， <b>“上”</b> ， <b>“库尔斯克”</b> 。 看起来一切都很简单，但细节在于魔鬼。 有时并不太明显：例如，在“ wi-fi”或“第二”查询中，我们必须了解我们应该完整地处理这种组合。 <br><br> 令牌本身包含有关单词文本，请求中的位置，单词后面是否存在分隔符以及单词某些特征的信息-字符的寄存器，无论单词是数字，序号，电话号码，地址还是其他数据。 <br><br><h3> 第二阶段。字典搜索 </h3><br> 输入参数：标记<b>“ eat”</b> ， <b>“ on”</b> ， <b>“ Kursk”</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bm/nx/gs/bmnxgsmvl1wuogtxci70yebty3i.jpeg" alt="图片"></div><br> 有了准备好的请求标记列表，我们就可以进入字典搜索的阶段，也就是进入针对每个标记从数据中找到单词形式列表的阶段。 单词形式是有关单词词根及其结尾的编码信息。 <br><br> 我们将字典搜索作为一种分析字典的算法提出，以图形的形式呈现。 其中的节点是字母或符号。 图由符号节点和这些节点之间的过渡组成。 绕过字典图的结果是，根据上一阶段传输的令牌，我们可以获得许多单词形式。 因此，我们尝试在字典中查找与请求中的下一个标记匹配的字符序列。 同时，众所周知，用户在键盘布局中会打错字，遗漏字母甚至会犯错误。 因此，在浏览字典时，我们会进行一些操作，以考虑可能的人为因素或尝试猜测一个人现在正在获得什么。 使用了字符链的各种转换：插入，替换，附加字符等。 <br><br> 结果，对于图中的每个请求令牌，我们提取了一组单词形式，其中包含有关单词的词根和结尾的信息，有关单词形式中的字符数的信息以及找到的估计值。 评估发现-评估发现的字符序列到所需序列的词汇距离的评估。 评估表示找到的字符串与请求令牌有多少不同。 <br><br> 因此，对于令牌，我们发现单词形式： <br><br><ul><li>  <b>“ eat”的</b> 13种形式：“ eat”，“ eat”，“ paese”，“ payot”，... </li><li>  <b>“ on”的</b> 3种形式：“ na”，“ nu”，“ on” </li><li>  <b>“ Kursk”的</b> 48种形式：“ Kursk”，“ Kursk”，“ Kursk”，“ Kursk”，“ Kurako”，... </li></ul><br> 接下来，根据评估结果过滤找到的单词形式。 它们中的最佳者，即尽可能接近查询中的单词，落入术语列表中。 术语我们是指形式和发现的估计。 另外，除了找到的单词形式外，还将使用形态规则添加的术语添加到列表中。 形态学处理的重要步骤是添加形态学评估。 事实是，在我们的搜索中，我们使用了强大的形态处理机制，不仅使我们能够从字典中查找相似的单词，而且根据自然语言的规则，更准确地根据含义而不是单词的相似性来查找用户真正感兴趣的内容。 <br><br> 因此，将为令牌创建术语： <br><br><ul><li>  <b>“吃”</b> ：“吃”，“吃”，“吃”，“吃”，“吃” </li><li>  <b>“开”</b> ：“开”，“ na”，“ nu” </li><li>  <b>“库尔斯克”</b> ：“库尔斯克”，“库尔斯克”，“库尔斯克”，“库尔斯克”，“库尔斯克” </li></ul><br> 在此阶段，词典搜索结束。 我们已经处理了请求，并为每个令牌列出了需要进一步处理的条款列表。 这些术语包含有关它们所代表的单词的所有信息，并评估如何找到它们。 <br><br><h3> 步骤3.查找数据条目 </h3><br> 输入：针对请求的每个部分的一组术语 <br><br><ul><li>  <b>“吃”</b> ：“吃”，“吃”，“吃”，“吃”，“吃” </li><li>  <b>“开”</b> ：“开”，“ na”，“ nu” </li><li>  <b>“库尔斯克”</b> ：“库尔斯克”，“库尔斯克”，“库尔斯克”，“库尔斯克”，“库尔斯克” </li></ul><br> 从上一阶段接收到针对请求的每个部分的一组术语后，我们便开始通过索引进行搜索。 数据中的每个文档都有许多标题，并以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">反向索引</a>编写，因此我们可以轻松地在代表组织，地址或任何其他文档的特定文档中找到所需术语的所有引用。 <br><br> 对于请求的每个部分以及这些部分的每个条款，我们正在寻找包含以条款编码的单词的文档。 因此，对于部分请求，将在所有术语中找到条目： <br><br><ul><li>  <b>“吃”</b> ：18个条目 </li><li>  <b>开</b> ：4,304条目 </li><li>  <b>库尔斯克</b> ：79个条目 </li></ul><br> 显然，介词<b>“ on”</b>出现了很多次，因此落入了许多文档标题中，例如“外卖咖啡”，“ <b>在</b>控制台<b>上</b>播放”，“机器注册”。  <b>“饮食”</b>和<b>“库尔斯克”</b>也被重复使用。 第二个单词及其词在我们的数据中的出现频率比第一个单词高。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3j/4m/da/3j4mdasko01hxwfdvyk3n_bih5a.jpeg" width="300" height="300"></div><br> 通过命中，我们考虑了搜索查询中的单词与特定文档中的单词的匹配。 这些匹配将保存在列表中，将在下一步中进行分析。 当添加匹配时，我们不仅会从该词中复制有关单词中的数据，而且还会计算出如何找到该单词的最佳估计。 换句话说，我们选择术语的形态学评估，或对术语在词典中的查找方式的评估，具体取决于哪个等级更接近请求令牌。 <br><br> 此阶段是开始搜索本身的序幕。 我们已经在特定文档中准备了一组匹配项，根据这些匹配项，以下算法将选择并评估需要提供给用户的内容。 <br><br><h3> 阶段4：搜寻的核心 </h3><br> 入口：命中清单 <br><br><ul><li>  <b>“吃”</b> ：18个条目 </li><li>  <b>开</b> ：4,304条目 </li><li>  <b>库尔斯克</b> ：79个条目 </li></ul><br> 实际上，我们实现中的命中列表是一个非常棘手的容器。 重要的是要了解，向其中添加匹配项时，会创建特殊节点，在其中记录匹配项本身，并链接到这些匹配项所在的文档。 <br><br> 因此，如下所示显示输入数据会更正确： <br> 入口：文档节点的容器 <br><br><ul><li>  <b>document1：{hits，...}</b> </li><li>  <b>document2：{hits，...}</b> </li><li>  <b>document3：{hits，...}</b> </li><li>  <b>document4：{hits，...}</b> </li><li>  ... </li></ul><br> 首先，搜索开始绕过文档树，每个节点将其发送到分析器，分析器评估来自此节点的文档是否适合作为进入输出的结果。 为了了解分析仪必须处理的体积，我将首先说该容器包含3000多个节点！ 但是可以在爬网过程中添加节点，因此，实际上它的处理甚至更多。 毫不夸张地说，分析是搜索中最昂贵的部分，同时也是项目中最复杂，规模最大的功能之一。 但是，即使在移动设备上，它的运行速度也非常快。 <br><br><h3> 阶段5.分析 </h3><br> 输入： <b>Document</b>节点<b>：{hits，...}</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ak/jj/my/akjjmypuvajc-jymk3_x4o0r9vo.png"></div><br> 分析首先从节点获得标题列表。 标题是标题和属于此文档标题的命中列表。 这些标题将在第一阶段进行评估。 对于我们来说，找出每个标题的有用性很重要。 有用性可以是好，弱和垃圾。 <br><br> 对于每个标题，都选择了命中链中最好的-长度和词汇量最好的，由命中的相似性组成。 根据最佳链接，将对标题进行实用性评估。 为了确定该链的有用性，我们还使用了一种基于文档中单词出现频率的机制。 粗略地说，单词在文档中出现的频率越高，它的重要性就越大（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TF-IDF</a> ）。 因此，如果链中包含文档标题中的一个重要单词而没有很大的形态差异（例如，数量或性别都很好），则我们认为标题很有用。 如果标题的命中完全覆盖了文档标题中的单词，则标题也可能很有用。 <br><br> 使用实用程序，所有标题均形成该节点的实用程序掩码。 该掩码使我们对被分析的节点覆盖的请求令牌有了一个概念。 借助它的帮助，我们在很大程度上决定了是否进一步分析该节点。 <br><br> 结果，我们不仅从索引中获得了一个文档，而且还提供了一组结构化数据，这些结构化数据表示潜在结果以及有关如何找到该结果的信息。 <br><br><h3> 步骤6.评估 </h3><br> 输入： <b>Document</b>节点<b>：{hits，...}</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vs/ek/rs/vsekrs0bs3knmkccjj160wxpdzw.jpeg"></div><br> 根据实用程序掩码，我们将处理该节点，或立即进行下一个。 在许多已处理的节点中，我们积累了有关其总数的各种信息。 例如，许多节点标题，节点之间的关系以及其他一些数据。 <br><br> 接下来开始分析彼此互连的节点的标题。 实际上，许多节点被组合成一个节点图，我们对其进行评估。 <br><br> 从图节点的节点中，我们获得了排名标题的列表。 简而言之，我们从各种节点组成一个标题列表，其中，对于每个元素，我们还从所有参与节点的标题命中中添加一个估计值和一个因素组合。 <br><br> 评估-从字典搜索阶段开始，该结构包含有关查询中标题所涉及的单词数的信息以及有关如何找到和处理该单词的许多其他因素的信息。 重要的是，来自排名标题的这些成绩将参与最佳成绩的选择。 其中一些将被标记为已选择，并将有助于对用户看到的结果进行最终评估。 <br><br> 总体评估会提供结果信息，这对于排序整个输出至关重要。 它包含一些因素，例如查询中缺少单词。 该度量特征在于其结构信息未被节点覆盖的单词数量。 <br><br> 根据有关标题效用的信息，确定结果的清晰度。 清晰度可以是好，弱和坏。 并在已处理节点的所有选定标题的参与下进行计算。 所有这些数据都对结果的命运和发布顺序产生重大影响。 <br><br> 渐渐地，我们即将结束对节点的分析。 在节点最终离开分析器并成为潜在结果之前，我们还要进行一些其他指定操作。 例如，所选文档标题的兼容性。 <br><br> 经过分析器所有圆周的节点形成一个结果，其中包含有关所选标题和文档的信息。 结果可以很好地覆盖搜索查询，并将结果发送到后处理。 <br><br><h3> 步骤7.后处理 </h3><br> 输入：从节点构造的结果 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ve/ue/9b/veue9bh6pkqqx7hd1pynhtyanms.jpeg"></div><br> 分析器会在它们成为结果之前从索引中过滤掉许多记录。 但是，在分析过程中，可以评估并发送许多潜在结果进行处理。 为了仅按相关性顺序向用户显示最有用的选项，我们需要切断分析仪发现的最差的选项。 <br><br> 在上一步中，提到了对结果的总体评估。 总体评估使我们能够在后期处理阶段中截取最差的结果。 等级如下。 不覆盖任何请求令牌的结果显然要比完全覆盖用户请求的结果差。 清晰度较差的结果显然不如清晰度较好的结果。 后处理器累积有关传入结果的信息，并消除那些明显较差的结果。 其余的添加到列表中。 <br><br> 在向饥饿的用户提供有关网吧的信息之前，我们先进行最终处理-按相关性排序。 排序涉及许多因素，这些因素是在搜索的不同阶段进行计算和汇总的。 最终， <b>“吃库尔斯克”的</b>搜索结果超过500个结果。 他们中许多人以相同的方式被发现，因此具有相同的评级。 它们将根据用户受欢迎程度进行排序。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ya/ml/jo/yamljowh757kha0ft1akjtwccae.jpeg" width="375" height="667"></div><br><br><h3> 结论 </h3><br> 我们收到了许多咖啡馆和餐馆的引渡，很高兴我们去吃晚饭。 我们很快就得到了所有结果。 我们甚至都不需要互联网连接。 <br><br> 该应用程序将搜索索引存储在设备上。 这样的方案为我们提供了优化数据压缩和处理速度的艰巨任务-毕竟，搜索应该可以在各种移动设备上快速进行！ 但是，这是一个完全不同的故事。 <br><br> 今天，我试图打开我们搜索引擎的引擎盖，向我们展示如何帮助用户在城市中找到他们所需的东西，并快速便捷地进行操作。 我希望它能提供信息。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433696/">https://habr.com/ru/post/zh-CN433696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433680/index.html">HSE和桌面gamedev模拟器中游戏行业的冬季活动</a></li>
<li><a href="../zh-CN433682/index.html">如何在PowerShell中合并文件内容。 而且不要受苦</a></li>
<li><a href="../zh-CN433686/index.html">亚马逊开始直接在其网站上出售苹果产品</a></li>
<li><a href="../zh-CN433688/index.html">YouTube年度活动回顾如何引发内战</a></li>
<li><a href="../zh-CN433692/index.html">要解决最困难的优化任务，只需添加激光器</a></li>
<li><a href="../zh-CN433698/index.html">CSS哲学</a></li>
<li><a href="../zh-CN433700/index.html">带有Guava的Java中的Bloom过滤器</a></li>
<li><a href="../zh-CN433704/index.html">摘自《无尽笑话》小说中有关照片和视频的视频伪装和面具的摘录-早在其真实出现之前的几年</a></li>
<li><a href="../zh-CN433706/index.html">Windows上的沙箱</a></li>
<li><a href="../zh-CN433708/index.html">欢迎参加第五届工业网络安全聚会</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>