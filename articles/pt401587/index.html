<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüé§ üìä üî≠ Painel do operador (IHM) com barramento I2C para Arduino ‚ôøÔ∏è üç¢ üê≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como parte do trabalho com alguns equipamentos compat√≠veis com arduino (sobre isso no final), eu precisava de uma tela com bot√µes para controlar e exi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Painel do operador (IHM) com barramento I2C para Arduino</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401587/">  Como parte do trabalho com alguns equipamentos compat√≠veis com arduino (sobre isso no final), eu precisava de uma tela com bot√µes para controlar e exibir informa√ß√µes atuais.  Ou seja, o painel do operador era necess√°rio, tamb√©m √© HMI. <br><br>  Foi decidido fazer a HMI de forma independente e usar o barramento i2c "quadrado" como uma interface. <br><br><img src="https://habrastorage.org/files/3e6/4e6/24e/3e64e624ed5741d9a37eea535359c671.jpg"><br><br>  Se voc√™ estiver interessado no processo de desenvolvimento e programa√ß√£o de tais dispositivos, bem-vindo ao gato. <br><a name="habracut"></a><br>  Caracter√≠sticas <br><br><ul><li>  Exibir 1602, caracteres monocrom√°ticos de 16x2 </li><li>  5 bot√µes: cima, baixo, cancelar, entrar, editar </li><li>  Interface I2c </li><li>  Conector DB9F </li><li>  Dimens√µes 155x90x44 mm </li></ul><br>  Existem perguntas √≥bvias: <br><br><div class="spoiler">  <b class="spoiler_title">Por que n√£o comprar um escudo pronto?</b> <div class="spoiler_text">  Obviamente, era poss√≠vel comprar um escudo pronto do mesmo chin√™s com uma tela e teclado, e assim: <br><img src="https://habrastorage.org/files/c7b/06a/03d/c7b06a03dff44d12bf25dddc779b2a82.jpg"><br>  Voc√™ pode soldar 2 len√ßos FC-113 nesse escudo e ele funcionar√° da mesma forma que o meu: um monitor com um teclado trabalhando no i2c.  O pre√ßo do conjunto ser√° de US $ 4. <br><br>  Mas nesta placa, o tamanho dos bot√µes n√£o combina comigo, mas eu queria grandes, com a capacidade de instalar bon√©s multicoloridos.  Eu n√£o queria conectar o Arduino √† HMI usando o conector DB9F normal, mas era necess√°rio fazer uma placa de conex√£o.  E, neste caso, qual √© a diferen√ßa, criando um tabuleiro ou dois?  Al√©m disso, eu j√° tinha v√°rios monitores de 1602 em estoque, ent√£o s√≥ precisei gastar US $ 1,02 para comprar o FC-113 (US $ 0,55) e o expansor de porta PCF8574P (US $ 0,47) no Aliexpress. <br><br>  Bem, e mais importante, se voc√™ est√° lidando com o Arduino, a fabrica√ß√£o independente de escudos para ele √© uma quest√£o de curso, certo? <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Por que o barramento i2c n√£o √© mais f√°cil conectar os bot√µes diretamente?</b> <div class="spoiler_text">  No campo dos sistemas de controle industrial, onde trabalho, as IHMs usam interfaces de transmiss√£o de dados digitais RS-232, RS-485, CAN etc. para se comunicar com os dispositivos.  Portanto, √© l√≥gico para mim que minha IHM caseira funcione em uma interface de dados, neste caso, no i2c. <br><br>  Se eu fizesse um dispositivo em que o monitor funcionasse em um barramento quadrado e os bot√µes fossem diretamente para a entrada do Arduino, isso me faria sentir profundamente insatisfeito.  Como apresentarei esta figura: um cabo separado se destaca do painel para a interface, fios separados para a entrada, brrrr ... <br><br>  Al√©m disso, a diferen√ßa entre a placa do bot√£o que vai diretamente para as entradas do Arduino e a placa do bot√£o com a interface i2c est√° apenas no chip PCF8574P (US $ 0,47), um capacitor e dois resistores. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Por que os bot√µes est√£o organizados assim e n√£o de outra forma?</b> <div class="spoiler_text">  Os bot√µes da esquerda para a direita t√™m as seguintes fun√ß√µes: cima, baixo, cancelar, entrar, editar. <br>  O bot√£o ‚Äúeditar‚Äù √© retirado um pouco dos outros para enfatizar sua fun√ß√£o - alterando os valores dos par√¢metros l√≥gicos (ligado / desligado) ou alternando para o modo de edi√ß√£o no caso de par√¢metros num√©ricos. <br><br>  Existem 5 bot√µes no total, embora o chip na placa do teclado permita conectar at√© 8 pe√ßas. <br>  Seria o suficiente para quatro bot√µes e a funcionalidade n√£o seria afetada - ‚Äúentrada‚Äù e ‚Äúedi√ß√£o‚Äù podem ser combinadas em um bot√£o.  Mas fiquei com pena de que metade das 8 pernas do microcircuito expansor de portas n√£o estivesse envolvida. <br>  Outro bot√£o "editar" separado pode ser √∫til se eu decidir exibir v√°rios par√¢metros em uma linha.  Ent√£o, com este bot√£o, voc√™ pode alternar entre os par√¢metros, indicando qual deles precisa ser alterado.  √â assim que o bot√£o "SET" funciona na popular HMI OP320 chinesa. <br><br>  Se os dois primeiros bot√µes significam para cima e para baixo, por que n√£o coloc√°-los na vertical, como, por exemplo, √© feito no escudo chin√™s acima? <br><br>  Para mim, pessoalmente, √© mais conveniente quando todos os bot√µes est√£o na horizontal; depois, durante a opera√ß√£o, os dedos se movem apenas em um plano. <br></div></div><br><h4>  <b>Ferro</b> </h4><br><img src="https://habrastorage.org/files/fdf/110/dee/fdf110deea844523baaf7fed5e5d7f67.jpg"><br><br><img src="https://habrastorage.org/files/d2e/39d/084/d2e39d0848924a5b9d2d3e1e8952462c.jpg"><br><br>  1. Backplane caseiro com conector DB9F.  Ent√£o, quando pegamos uma fonte de alimenta√ß√£o de + 5V para os expansores de porta e display do Arduino, coloquei um fus√≠vel de 0,1 A na placa <br><br>  2. Todos conhecemos o conhecido monitor 1602 com uma placa soldada FC-113 que conecta o monitor ao barramento i2c. <br><br>  3. Uma placa de teclado caseira com um chip PCF8574P, que ler√° o status dos bot√µes e os transmitir√° pelo barramento i2c.  A prop√≥sito, a placa ‚Äúdisplay‚Äù do FC-113 tamb√©m √© baseada no chip PCF8574, apenas com o √≠ndice T, ou seja,  planar, n√£o DIP, como PCF8574P. <br><br>  Bot√µes Coloquei 12h12mm com um empurrador quadrado; neles voc√™ pode usar grandes capas multicoloridas. <br><br><div class="spoiler">  <b class="spoiler_title">Fotos e esquemas de placas de circuito caseiras</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d9a/41d/043/d9a41d0435244acc995795055522501c.jpg"><br><br><img src="https://habrastorage.org/files/a8a/faa/a15/a8afaaa15f16482a8eac22c8a99f5db2.jpg"><br><br><img src="https://habrastorage.org/files/693/76e/475/69376e475bc4455da8658553b0edbd1c.jpg"><br></div></div><br>  Vale a pena dizer algumas palavras sobre o chip PCF8574P, com base no qual fiz uma placa de teclado. <br>  O PCF8574P √© um extensor de porta i2c.  Existem 8 portas no total, cada uma das quais pode ser configurada para funcionar como entrada ou sa√≠da.  Para este chip e a cinta, como tal, n√£o √© necess√°rio (lembre-se, por exemplo, max232), apenas no caso de eu colocar um capacitor de energia. <br><br>  O endere√ßo do chip PCF8574P √© definido usando as pernas de endere√ßo A0, A1, A2, que s√£o puxadas para o ch√£o ou para a fonte de alimenta√ß√£o atrav√©s de um resistor de 10 kŒ©. <br><br>  Na placa do teclado, coloquei todas as pernas de endere√ßo do PCF8574P no ch√£o, para que o endere√ßo seja codificado como 0x20 e voc√™ n√£o possa alter√°-lo. <br><br>  Como j√° escrevi, escolhi o DB9F como o conector para a HMI.  O Arduino recebe sinais dele +5 V, GND, SDA, SCL. <br><br><img src="https://habrastorage.org/files/b9b/46d/b11/b9b46db117ea4418acc54be7f35db069.jpg"><br><br>  O fio para comunica√ß√£o via i2c Arduino e HMI tem 1,4 m de comprimento e funciona sem falhas. <br><br>  Eu desenhei as placas no Sprint Layout 6, as transferi para o textolite usando o m√©todo LUT e as gravei em uma solu√ß√£o de per√≥xido e √°cido c√≠trico. <br><br><div class="spoiler">  <b class="spoiler_title">Um pouco sobre decapagem</b> <div class="spoiler_text">  Existem muitas receitas para gravar placas de √°cido c√≠trico em fibra de vidro. <br><br>  Eu fiz esta solu√ß√£o: 100 ml de per√≥xido de hidrog√™nio a 3%, 50 g de √°cido c√≠trico, 3 colheres de ch√° de sal.  Ele aqueceu o frasco de per√≥xido em uma panela com √°gua a uma temperatura de cerca de 70 graus. <br><br>  Mergulhamos o cart√£o na solu√ß√£o com o padr√£o para baixo, conforme recomendado quando gravado com per√≥xido. <br>  Depois de algumas dezenas de segundos, um processo tempestuoso come√ßa.  √â liberado muito vapor, o que n√£o √© recomendado para inala√ß√£o.  Provavelmente. <br><br><img src="https://habrastorage.org/files/54a/f92/248/54af9224862547c1a6e41f57d73c0794.jpg"><br><br>  Ent√£o o processo desaparece.  Vire o quadro. <br><br><img src="https://habrastorage.org/files/e84/801/c1a/e84801c1a7bc43e998f586b8241b202a.jpg"><br><br>  Feito. <br><br><img src="https://habrastorage.org/files/101/9ec/44e/1019ec44edc945559d4f6b02514077c5.jpg"><br></div></div><br>  O estojo foi fabricado com um amigo da Plexiglas de 4 mm em uma m√°quina de corte a laser. <br><br><div class="spoiler">  <b class="spoiler_title">Digress√£o l√≠rica sobre o corpo</b> <div class="spoiler_text">  Compre um estojo acabado ou fa√ßa voc√™ mesmo?  Depois de um pouco de reflex√£o, decidi fazer isso sozinho.  Aqueles que vi √† venda n√£o eram adequados para mim nem por pre√ßo ou por raz√µes est√©ticas, ou estavam em um trilho DIN, o que tamb√©m n√£o era adequado para mim. <br><br>  Inicialmente, o corpo queria cortar madeira compensada.  Mas ent√£o lembrei que tinha um amigo maravilhoso e, pela minha grande alegria, o diretor de uma empresa de pr√™mios esportivos.  Ele tem todos os tipos de m√°quinas, inclusive para corte a laser. <br><br>  Ele pediu ajuda e um amigo n√£o recusou, por alguns minutos as pe√ßas foram cortadas com um laser. <br><br>  Aproveito a oportunidade para dizer obrigado, Kolya!  Caso contr√°rio, eu teria que cortar e moer madeira compensada o dia todo, e o resultado dificilmente seria t√£o brilhante. </div></div><br><h4>  <b>Programa√ß√£o</b> </h4><br>  Do ponto de vista do Arduino, esta HMI consiste em 2 dispositivos que operam no barramento i2c: um display (LCD) com o endere√ßo 0x27 e um teclado com o endere√ßo 0x20.  Consequentemente, o Arduino funcionar√° separadamente com o teclado e separadamente com o LCD. <br><br>  O trabalho com o LCD √© realizado atrav√©s de uma biblioteca especial "LiquidCrystal_I2C.h", deve ser instalado no Aduino IDE. <br><br>  O trabalho com o teclado √© realizado atrav√©s da biblioteca Wire.h padr√£o, que est√° inicialmente dispon√≠vel no Aduino IDE. <br><br>  Conectamos a HMI a Ardiuno. <br><br><img src="https://habrastorage.org/files/cd7/c58/0c1/cd7c580c192e4cac95a2eda6d5cd8756.jpg"><br><br>  1. Primeiro, verifique se o Arduino v√™ nossa IHM.  Para fazer isso, carregue o programa nele, que verificar√° o barramento i2c quanto a dispositivos nele. <br><br><div class="spoiler">  <b class="spoiler_title">Esbo√ßo 1, verifica√ß√£o de barramento i2c</b> <div class="spoiler_text"><pre><code class="hljs pgsql">//i2c_scaner #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;Wire.h&gt; String stringOne; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { Wire.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!<span class="hljs-type"><span class="hljs-type">Serial</span></span>); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { byte error, address; <span class="hljs-type"><span class="hljs-type">int</span></span> nDevices; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Scanning..."); nDevices = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(address = <span class="hljs-number"><span class="hljs-number">1</span></span>; address &lt; <span class="hljs-number"><span class="hljs-number">127</span></span>; address++ ) { Wire.beginTransmission(address); error = Wire.endTransmission(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error == <span class="hljs-number"><span class="hljs-number">0</span></span>) { String stringOne = String(address, HEX); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("0x"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(stringOne); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(" - "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="0A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Motor Driver'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="0F") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Motor Driver'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="1D") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADXL345 Input 3-Axis Digital Accelerometer'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="1E") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'HMC5883 3-Axis Digital Compass'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5B") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5C") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BH1750FVI digital Light Sensor' OR 'Touch Sensor" ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5D") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="20") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'LCM1602 LCD Adapter' "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="21") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="22") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="23") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'BH1750FVI digital Light Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="24") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="25") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="26") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="27") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'LCM1602 LCD Adapter '"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="39") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'TSL2561 Ambient Light Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="40") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP180 barometric pressure sensor'" ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="48") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="49") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit' OR 'SPI-to-UART'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="4A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="4B") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="50") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'AT24C32 EEPROM'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="53") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADXL345 Input 3-Axis Digital Accelerometer'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="68") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'DS3231 real-time clock' OR 'MPU-9250 Nine axis sensor module'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="7A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'LCD OLED 128x64'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="76") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP280 barometric pressure sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="77") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP180 barometric pressure sensor' OR 'BMP280 barometric pressure sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="78") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'LCD OLED 128x64'" ); nDevices++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error==<span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Unknow error at address 0x"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (address&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("0"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(address,HEX); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nDevices == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("No I2C devices found\n"); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("done\n"); delay(<span class="hljs-number"><span class="hljs-number">5000</span></span>); }</code> </pre> <br></div></div><br>  Durante a execu√ß√£o deste programa, o Arduino gravar√° os resultados da varredura do barramento i2c na porta serial.  Para visualizar esses dados, v√° para Arduino IDE Tools-&gt; Port Monitor. <br><br><img src="https://habrastorage.org/files/cb1/fe9/19c/cb1fe919c65f484bb7d431cae64e87ec.jpg"><br><br>  Vimos que o Arduino no barramento i2c identificou dois dispositivos com os endere√ßos 0x20 e 0x27, esses s√£o o teclado e o LCD, respectivamente. <br><br>  2. Agora vamos ver como o nosso teclado funciona.  Crie um programa que ir√° pesquisar o estado dos bot√µes e exibi-lo no LCD. <br><br><div class="spoiler">  <b class="spoiler_title">Esbo√ßo 2, exibe o status dos bot√µes</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*   LCD     i2c LCD    FC-113,  0x27      PCF8574P,  0x20 */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;LiquidCrystal_I2C.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;Wire.h&gt; #define led <span class="hljs-number"><span class="hljs-number">13</span></span> #define ADDR_KBRD <span class="hljs-number"><span class="hljs-number">0x20</span></span> #define ADDR_LCD <span class="hljs-number"><span class="hljs-number">0x27</span></span> byte dio_in; <span class="hljs-type"><span class="hljs-type">bool</span></span> b; <span class="hljs-type"><span class="hljs-type">bool</span></span> key[<span class="hljs-number"><span class="hljs-number">5</span></span>]; LiquidCrystal_I2C lcd(ADDR_LCD,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); //   <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { pinMode(led, OUTPUT); // lcd.init(); lcd.backlight();//    // Wire.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); Wire.beginTransmission(ADDR_KBRD); Wire.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(B11111111); //   PCF8574P     Wire.endTransmission(); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { Wire.requestFrom(ADDR_KBRD,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Wire.available()); byte dio_in = Wire.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); //   PCF8574P() //      byte mask=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-type"><span class="hljs-type">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>;i++) { key[i]=!(dio_in &amp; mask); mask=mask&lt;&lt;<span class="hljs-number"><span class="hljs-number">1</span></span>; } b=!b; digitalWrite(led, b); //    //    LCD lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.print(String(key[<span class="hljs-number"><span class="hljs-number">0</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">1</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">2</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">3</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">4</span></span>])+" "); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); }</code> </pre><br></div></div><br><img src="https://habrastorage.org/files/450/92f/cf3/45092fcf30ff4986bacf1bf3891ff58e.jpg"><br><br>  O teclado est√° funcionando. <br><br>  3. Finalmente, voc√™ pode prosseguir para o que tudo estava fazendo, criando um menu de v√°rios n√≠veis no Arduino.  Atrav√©s do menu, n√£o apenas assistiremos √†s informa√ß√µes, mas tamb√©m controlaremos as sa√≠das do pr√≥prio Arduino. <br><br><img src="https://habrastorage.org/files/570/c95/a3b/570c95a3b830423e827c7ac3b68605bf.jpg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xBZAx9ewLq4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  No nete, h√° muitas informa√ß√µes sobre a cria√ß√£o de um menu de v√°rios n√≠veis em C ++, mas para o Arduino, eu at√© vi algumas bibliotecas.  Mas eu decidi no meu programa escrever o menu pessoalmente.  Em primeiro lugar, quanto menos bibliotecas sobrarem no projeto, mais calmo.  E segundo, √© simples. <br><br>  Eu tenho outra varia√ß√£o do menu da √°rvore.  O menu permite exibir em cada linha ao mesmo tempo o texto est√°tico e o valor da vari√°vel.  Por exemplo, voc√™ pode exibir o nome do par√¢metro e seu valor. <br><br>  Para exibir vari√°veis ‚Äã‚Äãna tela, aplico o princ√≠pio das tags - de certa maneira, as etiquetas de texto projetadas no texto, em vez das quais, quando o texto √© exibido na tela, um valor √© exibido. <br><br>  Os par√¢metros podem ser alterados pressionando o bot√£o "Editar".  Al√©m disso, a tag de cada par√¢metro indica se est√° dispon√≠vel para edi√ß√£o ou somente leitura.  Se o par√¢metro atual for somente leitura, no in√≠cio da linha o ponteiro ser√° '*'; se a edi√ß√£o estiver ativada, o ponteiro se tornar√° '+'. <br><br><div class="spoiler">  <b class="spoiler_title">Esbo√ßo 3, menu de v√°rios n√≠veis</b> <div class="spoiler_text"><pre> <code class="hljs markdown">/<span class="hljs-bullet"><span class="hljs-bullet">*  ,    LCD   i2c LCD    FC-113,  0x27      PCF8574P,  0x20 *</span></span>/ #include <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LiquidCrystal_I2C.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> #include <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Wire.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> #define led 13 //    ;  ,  ,     #define ADDR<span class="hljs-emphasis"><span class="hljs-emphasis">_KBRD 0x20 #define ADDR_</span></span>LCD 0x27 #define PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D2 2 #define PORT_</span></span>D3 3 #define PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D4 4 #define POINT_</span></span>ON<span class="hljs-emphasis"><span class="hljs-emphasis">_ROOT_</span></span>MENU<span class="hljs-emphasis"><span class="hljs-emphasis">_ITEM 0 // 0/1= /   (*  +)     byte dio_</span></span>in; bool b; byte i; //bool ,      bool BoolVal[<span class="hljs-string"><span class="hljs-string">9</span></span>]={0,0,0, 0,0,0, 0,0,0}; #define ValSvet1 BoolVal[<span class="hljs-string"><span class="hljs-string">0</span></span>] #define ValSvet2 BoolVal[<span class="hljs-string"><span class="hljs-string">1</span></span>] #define ValSvet3 BoolVal[<span class="hljs-string"><span class="hljs-string">2</span></span>] #define ValRozetka1 BoolVal[<span class="hljs-string"><span class="hljs-string">3</span></span>] #define ValRozetka2 BoolVal[<span class="hljs-string"><span class="hljs-string">4</span></span>] #define ValRozetka3 BoolVal[<span class="hljs-string"><span class="hljs-string">5</span></span>] #define ValClapan1 BoolVal[<span class="hljs-string"><span class="hljs-string">6</span></span>] #define ValClapan2 BoolVal[<span class="hljs-string"><span class="hljs-string">7</span></span>] #define ValClapan3 BoolVal[<span class="hljs-string"><span class="hljs-string">8</span></span>] // struct STRUCT<span class="hljs-emphasis"><span class="hljs-emphasis">_KEY{ bool StateCur; //   bool StateOld; //     bool Imp; //   (  0  1) }; // STRUCT_</span></span>KEY Key[<span class="hljs-string"><span class="hljs-string">5</span></span>]={0,0,0, 0,0,0, 0,0,0, 0,0,0, 0,0,0 }; //--- /<span class="hljs-emphasis"><span class="hljs-emphasis">*   *</span></span>  , : <span class="hljs-bullet"><span class="hljs-bullet">* '#A1' bool ,  *</span></span> '#'-   bool, <span class="hljs-bullet"><span class="hljs-bullet">* 'A'- (HEX)    BoolVal, *</span></span> '1'-    <span class="hljs-bullet"><span class="hljs-bullet">*   ,       *</span></span>/ String StrNull=" "; //  String StrRoot1="COMP-MAN.INFO"; String StrRoot2="PLC-BLOG.COM.UA"; String StrSvet= ""; // String StrSvet1=" 1 #01"; String StrSvet2=" 2 #10"; String StrSvet3=" 3 #21"; String StrRozetka=""; // String StrRozetka1=" 1 #30"; String StrRozetka2=" 2 #40"; String StrRozetka3=" 3 #50"; String StrClapan=""; // String StrClapan1=" 1 #60"; // String StrClapan2=" 2 #70"; String StrClapan3=" 3 #80"; struct MENU<span class="hljs-emphasis"><span class="hljs-emphasis">_ITEM // (),   2        { byte KeyUp; //‚Ññ  ,     "" byte KeyDwn; //‚Ññ  ,     "" byte KeyCancel; //‚Ññ  ,     ""(cancel) byte KeyEnter; //‚Ññ  ,     ""(enter) byte KeyEdit; // "edit",  String *pstr1; //    () String *pstr2; //    () }; // MENU_</span></span>ITEM Menu[<span class="hljs-string"></span><span class="hljs-string"></span>]={0,0,0,1,0, &amp;StrRoot1,&amp;StrRoot2, //0   1,8,0,2,0, &amp;StrSvet,&amp;StrRozetka, //1  2,3,1,2,0, &amp;StrSvet1,&amp;StrSvet2, //2 2,4,1,3,0, &amp;StrSvet2,&amp;StrSvet3, //3 3,4,1,4,0, &amp;StrSvet3,&amp;StrNull, //4 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //5  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //6 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //7 1,15,0,9,0, &amp;StrRozetka,&amp;StrClapan, //8  9,10,8,9,0, &amp;StrRozetka1, &amp;StrRozetka2, //9 9,11,8,10,0, &amp;StrRozetka2, &amp;StrRozetka3, //10 10,11,8,11,0, &amp;StrRozetka3, &amp;StrNull, //11 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //12  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //13 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //14 8,15,0,16,0, &amp;StrClapan, &amp;StrNull, //15  16,17,15,0,0, &amp;StrClapan1,&amp;StrClapan2, //16 16,18,15,0,0, &amp;StrClapan2,&amp;StrClapan3, //17 17,18,15,0,0, &amp;StrClapan3,&amp;StrNull, //18 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //19  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //20 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //21 }; byte PosMenu=0; //  LiquidCrystal<span class="hljs-emphasis"><span class="hljs-emphasis">_I2C lcd(ADDR_</span></span>LCD,16,2); //   //   void ReadKey(byte dio<span class="hljs-emphasis"><span class="hljs-emphasis">_in) { //      byte mask=1; for(i=0; i&lt;5; i++) { Key[i].StateCur=!(dio_</span></span>in &amp; mask); mask=mask<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">!Key[i].StateOld</span></span></span></span><span class="xml"><span class="hljs-tag"> &amp; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.StateCur</span></span></span></span><span class="xml"><span class="hljs-tag">; //   (  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.StateOld</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">Key[i].StateCur;</span></span></span></span><span class="xml"><span class="hljs-tag"> } } /* *  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">UTF-8</span></span></span></span><span class="xml"><span class="hljs-tag">   ( )   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">LCD</span></span></span></span><span class="xml"><span class="hljs-tag"> *       */ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">MasRus</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">33</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span></span><span class="xml"><span class="hljs-tag">]= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">144</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x41</span></span></span></span><span class="xml"><span class="hljs-tag">, // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">145</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">146</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x42</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">147</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa1</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">148</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">149</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x45</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">129</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa2</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">150</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa3</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">151</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa4</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">152</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa5</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">153</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa6</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">154</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4b</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">155</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa7</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">156</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4d</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">157</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x48</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">158</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4f</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">159</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa8</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">160</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x50</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">161</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x43</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">162</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x54</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">163</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa9</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">164</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xaa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">165</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x58</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">166</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe1</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">167</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xab</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">168</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xac</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">169</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe2</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">170</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xad</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">171</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xae</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">172</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xc4</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">173</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xaf</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">174</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xb0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">175</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xb1</span></span></span></span><span class="xml"><span class="hljs-tag"> // }; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">RusStrLCD</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrIn</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">l</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.length();</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">l</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.charAt(i);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">128</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrOut+char(b1);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">else</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">208)</span></span></span></span><span class="xml"><span class="hljs-tag"> //==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">208,</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2-</span></span></span></span><span class="xml"><span class="hljs-tag">  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.</span></span></span></span><span class="xml"><span class="hljs-tag">  { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.charAt(i+1);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">33</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">++) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">MasRus</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">]==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">b1)</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrOut+char(MasRus[y][1]);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">break</span></span></span></span><span class="xml"><span class="hljs-tag">; } } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++; } } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">return</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">; } //</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">---------------------------</span></span></span></span><span class="xml"><span class="hljs-tag"> //</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ASCII</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">HEX</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">---</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> dec byte StrHexToByte(char val) { byte dec=0; switch (val) { case '0': dec=0; break; case '1': dec=1; break; case '2': dec=2; break; case '3': dec=3; break; case '4': dec=4; break; case '5': dec=5; break; case '6': dec=6; break; case '7': dec=7; break; case '8': dec=8; break; case '9': dec=9; break; case 'A': dec=10; break; case 'B': dec=11; break; case 'C': dec=12; break; case 'D': dec=13; break; case 'E': dec=14; break; case 'F': dec=15; break; default: dec=0; break; } return dec; } //     void WriteLCD(byte num) { String str[]={"<span class="hljs-emphasis"><span class="hljs-emphasis">*"+*</span></span>Menu[num].pstr1,<span class="hljs-emphasis"><span class="hljs-emphasis">*Menu[num].pstr2}; if (num==0 &amp;&amp; POINT_ON_ROOT_MENU_ITEM==0) //     ? str[0].setCharAt(0,' '); // ,   //     byte NumVal; byte l; for(byte y=0; y&lt;2; y++) { l=str[y].length(); for(i=0; i&lt;l; i++) { if (str[y].charAt(i)=='#') //# bool,  off/ON { if(StrHexToByte(str[y].charAt(i+2))==1 &amp;&amp; y==0) //  ? str[y].setCharAt(0,'+'); NumVal=StrHexToByte(str[y].charAt(i+1)); str[y]=str[y].substring(0,i)+String(NumVal) ; if(BoolVal[NumVal]==0) str[y]=str[y].substring(0,i)+"off" ; if(BoolVal[NumVal]==1) str[y]=str[y].substring(0,i)+"ON" ; } if (str[y].charAt(i)=='$') //$ int,     ,      { ; } if (str[y].charAt(i)=='~') //~ ,     ,      { ; } } } //--- lcd.clear(); lcd.setCursor(0, 0); lcd.print(str[0]); lcd.setCursor(1, 1); lcd.print(str[1]); } //,       byte GoMenu(byte key) { byte PosMenuNew=PosMenu; switch (key) { case 0: PosMenuNew=Menu[PosMenu].KeyUp; break; case 1: PosMenuNew=Menu[PosMenu].KeyDwn; break; case 2: PosMenuNew=Menu[PosMenu].KeyCancel; break; case 3: PosMenuNew=Menu[PosMenu].KeyEnter; break; case 4: ; break; default: break; } return PosMenuNew; } //    "Edit" void Edit(byte posmenu) { byte NumVal; bool *</span></span>pval; String str=<span class="hljs-emphasis"><span class="hljs-emphasis">*Menu[posmenu].pstr1; byte l=str.length(); for(i=0; i&lt;l; i++) if (str.charAt(i)=='#') //#- bool,  off/ON { if(StrHexToByte(str.charAt(i+2))==1) //  ? { pval= &amp;(BoolVal[StrHexToByte(str.charAt(i+1))]); // ,    .   *</span></span>pval=!(*pval); //     } } } //     void ValToPort() { digitalWrite(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D2,ValSvet1); digitalWrite(PORT_</span></span>D3,ValSvet2); digitalWrite(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D4,ValSvet3); } void setup() { pinMode(led, OUTPUT); //     pinMode(PORT_</span></span>D2, OUTPUT); pinMode(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D3, OUTPUT); pinMode(PORT_</span></span>D4, OUTPUT); //    LCD StrSvet=RusStrLCD(StrSvet); StrSvet1=RusStrLCD(StrSvet1); StrSvet2=RusStrLCD(StrSvet2); StrSvet3=RusStrLCD(StrSvet3); StrRozetka=RusStrLCD(StrRozetka); StrRozetka1=RusStrLCD(StrRozetka1); StrRozetka2=RusStrLCD(StrRozetka2); StrRozetka3=RusStrLCD(StrRozetka3); StrClapan=RusStrLCD(StrClapan); StrClapan1=RusStrLCD(StrClapan1); StrClapan2=RusStrLCD(StrClapan2); StrClapan3=RusStrLCD(StrClapan3); // lcd.init(); lcd.backlight();//    WriteLCD(PosMenu); Wire.begin(); Wire.beginTransmission(ADDR<span class="hljs-emphasis"><span class="hljs-emphasis">_KBRD); Wire.write(B11111111); //   PCF8574P     Wire.endTransmission(); } void loop() { Wire.requestFrom(ADDR_</span></span>KBRD,1); while (!Wire.available()); byte dio<span class="hljs-emphasis"><span class="hljs-emphasis">_in = Wire.read(); //   PCF8574P() ReadKey(dio_</span></span>in); //   //,    ;  ,      int KeyImp=-1; for (i=0; i<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">5;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1)</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">KeyImp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">i;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">KeyImp</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>-1) //  ? { if (KeyImp==4) // "Edit" Edit(PosMenu); PosMenu=GoMenu((KeyImp)); WriteLCD(PosMenu); } b=!b; digitalWrite(led, b); //    ValToPort(); //  delay(50); }</code> </pre><br></div></div><br><h4>  <b>LCD 1602 e problema de idioma</b> </h4><br>  Separadamente, √© necess√°rio levantar a quest√£o da russifica√ß√£o. <br><br>  No gerador de caracteres de alguns LCD 1602 n√£o h√° letras russas e, em vez delas, krakozyabry japon√™s √© costurado.  √â imposs√≠vel atualizar o gerador de caracteres.  Portanto, voc√™ precisar√° escrever palavras na tela em letras latinas ou no programa para formar as letras russas, porque  O LCD 1602 tem a capacidade de criar e armazenar seus pr√≥prios caracteres na RAM RAM.  Mas, neste √∫ltimo caso, voc√™ pode exibir na tela n√£o mais do que oito caracteres "caseiros" por vez. <br><br><div class="spoiler">  <b class="spoiler_title">Gr√°fico de caracteres LCD 1602</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/91b/eed/92f/91beed92f6f0487f922c3f9834ae9a8f.png"><br><br><img src="https://habrastorage.org/files/ecf/799/4a5/ecf7994a50584faba9805df1550d6157.png"><br></div></div><br>  Em princ√≠pio, n√£o h√° problema em escrever palavras russas em ingl√™s no LCD.  L√°, mesmo a vener√°vel empresa francesa Shneider Electric (a que vendeu obuses at√© o czar antes da revolu√ß√£o) por uma d√©cada e meia n√£o conseguiu introduzir o russo em seus famosos rel√©s program√°veis ‚Äã‚ÄãZelio.  Mas isso n√£o os impede de negociar ativamente a vastid√£o de toda a CEI.  Al√©m disso, canais, espanhol e portugu√™s introduzidos. <br><br>  Em muitas de nossas f√°bricas, esses Zelio se comunicam com a equipe com frases como "NASOS 1 VKL". <br><br>  Quando n√£o est√° claro se h√° letras russas em um LCD espec√≠fico, √© necess√°rio exibir todos os caracteres de seu gerador de caracteres na tela.  Se houver cir√≠lico, ele come√ßa na posi√ß√£o 160. <br><br><div class="spoiler">  <b class="spoiler_title">Desenho 4, exibindo todos os caracteres da tabela do gerador de caracteres LCD 1602</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*   LCD     * LCD    i2c */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;LiquidCrystal_I2C.h&gt; LiquidCrystal_I2C lcd(<span class="hljs-number"><span class="hljs-number">0x27</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); //   <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { // put your setup code here, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> run once: lcd.init(); lcd.clear(); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { <span class="hljs-type"><span class="hljs-type">int</span></span> i,y; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>; i++) { lcd.clear(); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.print(String(i*<span class="hljs-number"><span class="hljs-number">16</span></span>)+" - "+String(i*<span class="hljs-number"><span class="hljs-number">16</span></span>+<span class="hljs-number"><span class="hljs-number">15</span></span>)); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(y=<span class="hljs-number"><span class="hljs-number">0</span></span>;y&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>;y++) lcd.print(<span class="hljs-type"><span class="hljs-type">char</span></span>(i*<span class="hljs-number"><span class="hljs-number">16</span></span>+y)); delay(<span class="hljs-number"><span class="hljs-number">3000</span></span>); } } }</code> </pre><br></div></div><br>  Mas mesmo que seu LCD 1602 seja russo, exibir palavras em russo n√£o √© t√£o simples.  Pelo menos, usando a biblioteca LiquidCrystal_I2C.h ao trabalhar com LCD no barramento i2c. <br><br>  Se voc√™ simplesmente imprimir o texto em russo, por exemplo, com a instru√ß√£o lcd.print ("Ol√° !!!"), em vez de "Ol√° !!!"  algum lixo aparecer√° na tela. <br><br>  Isso ocorre porque o IDE do Arduino converte letras russas em c√≥digo UTF-8 de dois bytes, e no LCD todos os caracteres s√£o de byte √∫nico. <br><br>  A prop√≥sito, o mesmo problema √© observado ao transferir textos em russo do Arduino para o monitor de porta IDE do Arduino.  O Arduino envia letras russas na codifica√ß√£o UTF-8 de dois bytes para a porta serial, e o monitor de porta IDE do Arduino tenta l√™-las na codifica√ß√£o Windows-1251 de byte √∫nico (cp1251).  Embora o cp1251 tamb√©m seja de 8 bits, como a codifica√ß√£o LCD 1602, ele n√£o corresponde a ele. <br><br>  Voc√™ pode formar textos em russo atrav√©s de c√≥digos de caracteres.  Por exemplo, a linha 'display LCD' em um LCD russificado ser√° exibida assim: <br><br><pre> <code class="hljs swift">lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\243K \343\270c\276\273e\271"</span></span>);</code> </pre> <br>  Mas eu n√£o gosto dessa abordagem. <br><br>  Para exibir corretamente o texto em russo no LCD Russified 1602, v√°rias bibliotecas foram inventadas para o Arduino.  Mas depois de ler os coment√°rios, vi que muitos reclamam de falhas ao us√°-los. <br><br>  Portanto, no meu programa de menu multin√≠vel, eu mesmo escrevi uma fun√ß√£o simples para converter c√≥digos UTF-8 em LCD.  √â verdade que fiz isso apenas com letras mai√∫sculas russas, o que combina perfeitamente comigo. <br><br><div class="spoiler">  <b class="spoiler_title">Fun√ß√£o para converter letras russas mai√∫sculas UTF-8 em c√≥digo LCD 1602 de byte √∫nico</b> <div class="spoiler_text"><pre> <code class="hljs powershell">/* *  UTF<span class="hljs-literal"><span class="hljs-literal">-8</span></span>   ( )   LCD *       */ byte MasRus[<span class="hljs-number"><span class="hljs-number">33</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]= { <span class="hljs-number"><span class="hljs-number">144</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x41, // <span class="hljs-number"><span class="hljs-number">145</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa0, <span class="hljs-number"><span class="hljs-number">146</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x42, <span class="hljs-number"><span class="hljs-number">147</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa1, <span class="hljs-number"><span class="hljs-number">148</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xe0, <span class="hljs-number"><span class="hljs-number">149</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x45, <span class="hljs-number"><span class="hljs-number">129</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa2, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa3, <span class="hljs-number"><span class="hljs-number">151</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa4, <span class="hljs-number"><span class="hljs-number">152</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa5, <span class="hljs-number"><span class="hljs-number">153</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa6, <span class="hljs-number"><span class="hljs-number">154</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x4b, <span class="hljs-number"><span class="hljs-number">155</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa7, <span class="hljs-number"><span class="hljs-number">156</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x4d, <span class="hljs-number"><span class="hljs-number">157</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x48, <span class="hljs-number"><span class="hljs-number">158</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x4f, <span class="hljs-number"><span class="hljs-number">159</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa8, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x50, <span class="hljs-number"><span class="hljs-number">161</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x43, <span class="hljs-number"><span class="hljs-number">162</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x54, <span class="hljs-number"><span class="hljs-number">163</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa9, <span class="hljs-number"><span class="hljs-number">164</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xaa, <span class="hljs-number"><span class="hljs-number">165</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x58, <span class="hljs-number"><span class="hljs-number">166</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xe1, <span class="hljs-number"><span class="hljs-number">167</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xab, <span class="hljs-number"><span class="hljs-number">168</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xac, <span class="hljs-number"><span class="hljs-number">169</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xe2, <span class="hljs-number"><span class="hljs-number">170</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xad, <span class="hljs-number"><span class="hljs-number">171</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xae, <span class="hljs-number"><span class="hljs-number">172</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xc4, <span class="hljs-number"><span class="hljs-number">173</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xaf, <span class="hljs-number"><span class="hljs-number">174</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xb0, <span class="hljs-number"><span class="hljs-number">175</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xb1 // }; String RusStrLCD(String StrIn) { String StrOut=<span class="hljs-string"><span class="hljs-string">""</span></span>; byte b1; byte y; byte l=StrIn.length(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(byte i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;l; i++) { b1=StrIn.charAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b1&lt;<span class="hljs-number"><span class="hljs-number">128</span></span>) StrOut=StrOut+char(b1); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b1==<span class="hljs-number"><span class="hljs-number">208</span></span>) //==<span class="hljs-number"><span class="hljs-number">208</span></span>,     <span class="hljs-number"><span class="hljs-number">2</span></span>-  .  { b1=StrIn.charAt(i+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(y=<span class="hljs-number"><span class="hljs-number">0</span></span>; y&lt;<span class="hljs-number"><span class="hljs-number">33</span></span>; y++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(MasRus[<span class="hljs-type"><span class="hljs-type">y</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]==b1) { StrOut=StrOut+char(MasRus[<span class="hljs-type"><span class="hljs-type">y</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } i++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StrOut; }</code> </pre><br></div></div><br>  Isso √© tudo para a IHM caseira com o barramento i2c. <br><br>  Ah, sim, no come√ßo do artigo, escrevi que fazia HMI n√£o exatamente para o Arduino, mas para equipamentos compat√≠veis com o arduino.  Este sou eu sobre o PLC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CONTROLLINO MAXI</a> , que √© programado a partir do Arduino IDE (e muitos outros). <br><br><img src="https://habrastorage.org/files/e62/97f/16b/e6297f16bfa84a449fe1d34f629ed061.jpg"><br><br>  CONTROLLINO MAXI √© na verdade Arduino + um monte de escudos e tudo √© projetado como um PLC industrial.  Mas sobre ele na pr√≥xima vez. <br><br>  <b>Refer√™ncias</b> <br><br>  ‚Üí <a href="">Arquivar</a> com diagramas, esbo√ßos e uma placa de circuito impresso no formato lay6 <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PLC CONTROLLINO compat√≠vel com Arduino</a> , o trabalho com o qual inspirou a cria√ß√£o da HMI i2c <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Expansor de porta PCF8574</a> e conect√°-lo ao Arduino <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Placa FC-113</a> para opera√ß√£o do LCD 1602 via barramento i2c e sua conex√£o com o Arduino <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Menu em √°rvore multin√≠vel</a> , princ√≠pios gerais de cria√ß√£o em C <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Codifica√ß√£o UTF-8</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Codifica√ß√£o do Windows-1251</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt401587/">https://habr.com/ru/post/pt401587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt401567/index.html">Chrome Sandbox viola tr√™s patentes, o Google pagar√° royalties</a></li>
<li><a href="../pt401569/index.html">Os 10 melhores gadgets da CES 2017 que nos impressionaram</a></li>
<li><a href="../pt401573/index.html">Freelance. Quatro hist√≥rias de sucesso: deixou o escrit√≥rio e a vida girou</a></li>
<li><a href="../pt401577/index.html">Benchmarks n√£o oficiais e pre√ßos para processadores Ryzen</a></li>
<li><a href="../pt401583/index.html">–Ø –ø–æ—á–µ–º—É –≤—Ä–µ–¥–Ω—ã–π –±—ã–ª? –ü–æ—Ç–æ–º—É —á—Ç–æ —É –º–µ–Ω—è SSD –Ω–µ –±—ã–ª–æ! –ï—Å—Ç—å –ª–∏ —Å–º—ã—Å–ª —Å—Ç–∞–≤–∏—Ç—å —Ç–≤–µ—Ä–¥–æ—Ç–µ–ª—å–Ω—ã–π –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å –≤ —Å—Ç–∞—Ä—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä?</a></li>
<li><a href="../pt401591/index.html">O que √© um planeta?</a></li>
<li><a href="../pt401593/index.html">Car Digest: Repara√ß√£o, Seguros e Novas Tecnologias</a></li>
<li><a href="../pt401595/index.html">F√≠sicos aprenderam a apertar os parafusos com um campo magn√©tico</a></li>
<li><a href="../pt401597/index.html">Empresas praticam m√©todos de vigil√¢ncia no local de trabalho</a></li>
<li><a href="../pt401599/index.html">Como encontrar um emprego na sua especialidade favorita</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>