<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî• üë∏üèΩ üó®Ô∏è Joyeux Quartusel, ou comment le processeur est arriv√© √† une telle vie üå∂Ô∏è üßòüèæ üë©üèª‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lors du d√©bogage de programmes r√©guliers, les points d'arr√™t peuvent √™tre d√©finis presque partout et en quantit√©s assez importantes. H√©las. Lorsqu'un ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Joyeux Quartusel, ou comment le processeur est arriv√© √† une telle vie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464795/"><img src="https://habrastorage.org/webt/ws/5w/vc/ws5wvcsjeh19phozcqcximmvjbo.jpeg"><br><br>  Lors du d√©bogage de programmes r√©guliers, les points d'arr√™t peuvent √™tre d√©finis presque partout et en quantit√©s assez importantes.  H√©las.  Lorsqu'un programme est ex√©cut√© sur le contr√¥leur, cette r√®gle ne s'applique pas.  S'il y a une section dans laquelle le diagramme temporel est form√©, alors l'arr√™t g√¢chera tout.  Et le passage aux basses et hautes fr√©quences n'est pas la m√™me chose.  Les conditions aux limites sont un fl√©au pour les d√©veloppeurs.  Ou, disons, un bus USB.  Dans NIOS II, je ne travaillais pas avec, mais sur STM32 c'est terrible.  Et je veux voir quelque chose, et quand tu t'arr√™tes, tu attrapes un temps mort.  En g√©n√©ral, tr√®s souvent, malgr√© la pr√©sence d'un d√©bogage JTAG avanc√©, le comportement du programme dans les zones critiques est obscurci.  Ce serait formidable de voir, au moins apr√®s l'ex√©cution, quelle cha√Æne le programme a travers√©, quelles branches ont fonctionn√© et lesquelles n'ont pas fonctionn√©! <br><br>  Il est encore plus important de conna√Ætre l'historique des exceptions.  Sur NIOS II, je ne l'ai pas fait, mais sur le Cyclone V SoC dans le noyau ARM - compl√®tement.  Lors du d√©bogage, tout fonctionne et si vous d√©marrez le programme √† partir de la ROM, vous obtenez une exception.  Il est clair comment ils y sont entr√©s et quel type d'√©volution de la situation n'a pas conduit √† cela.  Le tra√ßage casse √©galement toutes les couvertures. <br><a name="habracut"></a><br>  Articles pr√©c√©dents de la s√©rie: <ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©veloppement du ¬´firmware¬ª le plus simple pour les FPGA install√©s dans Redd, et d√©bogage en utilisant le test de m√©moire comme exemple</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©veloppement du ¬´firmware¬ª le plus simple pour les FPGA install√©s dans Redd.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2. Code de programme</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©veloppement de son propre noyau pour l'int√©gration dans un syst√®me de processeur bas√© sur FPGA</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©veloppement de programmes pour le processeur central Redd sur l'exemple d'acc√®s au FPGA</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les premi√®res exp√©riences utilisant le protocole de streaming sur l'exemple de communication CPU et processeur dans le FPGA Redd</a> </li></ol><br><h2>  Pr√©sentation </h2><br>  Il est de coutume d'√©crire des articles √©ducatifs avec un visage s√©rieux, pr√©sentant le mat√©riel avec calme et impartialit√©.  Mais h√©las, cela ne fonctionne pas toujours.  Maintenant, selon le plan, il devrait y avoir un article sur l'optimisation du processeur synth√©tis√© dans le complexe Redd, dans lequel nous devons parler des caract√©ristiques de travailler avec le cache.  Ensuite, un article sur les retards lors de l'acc√®s au bus.  En g√©n√©ral, tout cela peut √™tre montr√© sur un oscilloscope.  Je l'ai d√©j√† fait dans un article sur le DMA (" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DMA: Mythes et r√©alit√©</a> ").  Mais je voulais tout montrer en utilisant le processeur lui-m√™me, j'ai effectu√© de telles v√©rifications pour le c≈ìur ARM dans le FPGA Cyclone V SoC.  Tr√®s pratique (bien que les r√©sultats n'aient pas √©t√© publi√©s).  Pour cette raison, j'ai d√©cid√© de traiter le m√©canisme de tra√ßage inh√©rent au bloc JTAG.  C'est dommage que jusqu'√† pr√©sent je n'ai pas pu afficher avec des ressources t√©l√©chargeables gratuitement combien de temps jouait telle ou telle commande, mais il y avait du mat√©riel par lequel le programme peut toujours √™tre demand√© comment il est arriv√© √† une telle vie.  Eh bien, et d'ailleurs, alors que les souvenirs des soir√©es orageuses sont encore frais dans ma m√©moire, je vais les jeter d'une mani√®re plut√¥t √©motionnelle.  Il y aura donc aujourd'hui de nombreux m√©moires et une petite th√©orie utile. <br><br><h2>  Mat√©riel informatique </h2><br>  Ainsi, tr√®s souvent lors du d√©bogage d'un programme pour un microcontr√¥leur, il est souhaitable de conna√Ætre le chemin qu'il a parcouru, et il doit le passer √† toute vitesse.  Pour le cas de NIOS II, ce m√©canisme est disponible et est inclus ici sur cet onglet des propri√©t√©s du c≈ìur du processeur: <br><br><img src="https://habrastorage.org/webt/aw/b5/cq/awb5cqb6qtp8es-_vm_xo1dwuok.png"><br><br>  Type de trace d√©finit le type d'informations √† stocker.  Vous ne pouvez rien enregistrer (cela √©conomisera la m√©moire de la puce), vous pouvez enregistrer uniquement l'historique des commandes (le plus souvent cela suffit), ou bien, enregistrer l'historique des commandes et des donn√©es.  Il convient de noter que la documentation indique que dans le dernier mode, l'enregistrement des informations est en quelque sorte difficile, alors que des superpositions avec l'historique des commandes sont possibles, et plus de m√©moire est consomm√©e.  N'utilisez donc ce mode que lorsque c'est vraiment n√©cessaire. <br><br>  Le param√®tre Trace Storage d√©finit le type de m√©moire dans lequel la trace sera enregistr√©e.  La documentation indique que la m√©moire externe n'est pas prise en charge par l'environnement de d√©veloppement standard.  Par cons√©quent, il vaut mieux choisir uniquement l'int√©rieur. <br><br><img src="https://habrastorage.org/webt/vy/bw/ef/vybwef9zoeklef_gcevjoeihy6y.png"><br><br>  Eh bien, Onchip Trace Frame Size d√©finit la taille du tampon.  Plus le tampon est grand, plus il peut y √™tre plac√© d'√©v√©nements, plus l'historique peut √™tre consid√©r√©.  Mais le moins sera la m√©moire du cristal pour d'autres besoins. <br><br><img src="https://habrastorage.org/webt/_f/l5/u0/_fl5u0ax87tjg6jqriqa6ksg6ic.png"><br><br>  Il n'est pas n√©cessaire d'activer la case √† cocher pour cr√©er un port JTAG distinct.  Laissez tout taxis r√©guli√®rement. <br><br><h2>  Support logiciel </h2><br>  Bon.  Nous avons donc mis en place le c≈ìur du processeur, et ensuite?  Ohhhh!  Commence alors l'histoire du d√©tective.  Si les figures ci-dessus doivent √™tre interpr√©t√©es comme un guide d'action, des illustrations montrant un g√¢chis et un b√¢illonnement suivront.  Un certain nombre de documents indiquent que pour travailler avec le tra√ßage, vous devez utiliser des programmes tiers co√ªteux et m√™me un √©quipement JTAG sp√©cial.  Mais dans certains documents, il glisse que vous pouvez prendre quelque chose √† plein temps. <br><br><h3>  Exp√©riences Eclipse </h3><br>  Super.  Regardons autour d'Eclipse.  Je vous rappelle que j'utilise l'environnement de d√©veloppement Quartus Prime 17.1.  Eh bien, c'est arriv√©.  Nous d√©marrons le programme de d√©bogage et passons √† l'√©l√©ment de menu qui vous permet d'ouvrir diff√©rentes fen√™tres: <br><br><img src="https://habrastorage.org/webt/eu/yc/2z/euyc2ztgrga0uxh606lat4tu3kw.png"><br><br>  L√†, nous s√©lectionnons la fen√™tre Debug-&gt; Trace Control: <br><br><img src="https://habrastorage.org/webt/6w/qu/wz/6wquwzygaqz4ozivccboxsyvuey.png"><br><br>  Et nous obtenons un tel mannequin: <br><br><img src="https://habrastorage.org/webt/hv/qb/hd/hvqbhdjpwryfpsbhprwh7ehbobq.png"><br><br>  Mais la session de d√©bogage est lanc√©e.  De plus, les √©l√©ments de menu D√©marrer le suivi et Arr√™ter le suivi y figuraient m√™me (avant d'ouvrir cette fen√™tre, ils ne l'√©taient pas).  Mais ils sont bloqu√©s.  Et je n'ai pas pu les activer. <br><br><img src="https://habrastorage.org/webt/mk/xp/ir/mkxpiratj9qrxtpee0hz91tx3uc.png"><br><br>  En vain, j'ai rempli Google avec diff√©rentes demandes.  Dans les anciens documents, ces √©l√©ments sont d√©crits comme fonctionnant assez bien, mais dans les documents modernes, ils ne sont tout simplement pas mentionn√©s.  Personne ne les mentionne sur les forums.  Peut-√™tre que quelqu'un dans les commentaires vous dira quelque chose? <br><br><h3>  Probl√®mes avec la derni√®re version d'Eclipse </h3><br>  Bon.  Qu'en est-il de la derni√®re version de l'environnement de d√©veloppement?  Peut-√™tre que tout fonctionne l√†-bas?  Yyyyyy!  Ceci est un sujet pour un chapitre s√©par√©.  La derni√®re version pour les quatri√®me et cinqui√®me cyclones est la 18.1.1.  Autrement dit, vous devez d'abord t√©l√©charger la version 18.1, puis installer la mise √† jour 18.1.1.  Si quelqu'un d√©cide que j'ai trop de temps libre, que je r√©organise le logiciel pour le bien de tout, alors tout va bien.  La v√©rification principale concernait les probl√®mes de cache.  Ils sont plus s√©rieux, je voulais les v√©rifier dans la nouvelle version, je n'√©cris pas sur eux ici. <br><br>  Je l'ai donc t√©l√©charg√©.  Install√©.  Tout d'abord, la version 18.1 sous WIN7 est lanc√©e, mais 18.1.1 ne trouve pas la DLL.  Bon.  J'ai d√©couvert que je devais t√©l√©charger Redist √† partir de Visual Studio 2015. Je l'ai install√©.  Il a commenc√© √† fonctionner.  Cr√©ation d'un projet avec un syst√®me de processeur.  Il s'est m√™me pr√©par√©.  Je vais sur Eclipse, je cr√©e un programme avec BSP bas√© sur tout, comme nous l'avons d√©j√† fait plusieurs fois ... Et je re√ßois ce genre de chose ... <br><br><img src="https://habrastorage.org/webt/dz/ge/wm/dzgewmffjurbmrm7q9gzziiok5i.png"><br><br>  Le projet ne va pas.  Si vous quittez et entrez, il ne s'ouvre que partiellement. <br><br><img src="https://habrastorage.org/webt/hw/_p/85/hw_p85rarlvryo3rvmuu_zoqa7k.png"><br><br>  Voir le dossier ferm√©?  Voil√†.  Pourquoi?  Ohhhh!  Trois fichiers ont: <br><br><img src="https://habrastorage.org/webt/08/ca/fu/08cafumzaksxsqe9tquadzuckwa.png"><br><br>  Ce sont les merveilleux attributs de la protection: <br><br><img src="https://habrastorage.org/webt/zj/zy/db/zjzydbav2mjwdppsuq6y5mp3uay.png"><br><br>  Ils ne peuvent donc pas √™tre ouverts ou modifi√©s ... Si vous donnez plus de droits, le projet s'ouvrira, mais les fichiers ne sont pas compl√®tement cr√©√©s, donc cela ne fonctionnera pas pour les collecter.  J'ai essay√© de donner des droits jusqu'√† la fermeture d'Eclipse, puis d'enregistrer le projet.  Le r√©sultat est le m√™me. <br><br>  Le vieillissement rapide de Windows 7 pourrait-il √™tre √† bl√¢mer?  Pas √©tonnant que je manquais de biblioth√®ques!  J'ai mis Quartus frais sur WIN10, j'obtiens un r√©sultat compl√®tement identique en cr√©ant le projet!  J'ai un ami.  En raison de son lieu de travail, il rencontre parfois des produits de fabricants nationaux.  Et il exprime une s√©rie de r√©flexions sur eux-m√™mes et sur leurs proches.  Eh bien, sur le fait que "qui construit cela?"  Vous savez, en regardant les joies du logiciel Intel, je commence √† penser qu'il est loin du pays d'origine ... En fait, ce n'√©tait pas le cas sous Alter ... Tout est arriv√©, mais je ne m'en souviens pas. <br><br>  Je viens de sortir.  J'ai copi√© le projet sur une cl√© USB avec le syst√®me de fichiers FAT32.  Il n'y a aucun attribut de s√©curit√©.  J'en ai ouvert le projet, je suis entr√© dans Eclipse et j'ai cr√©√© le code.  Aucun attribut de s√©curit√© - pas de probl√®me.  Ensuite, je l'ai copi√© sur le disque dur et ... Eh bien, bien s√ªr, j'ai eu des probl√®mes pour g√©n√©rer BSP.  Parce que le fichier * .bsp contient de nombreux chemins relatifs et un absolu.  C'est bien d'avoir sorti une cl√© USB.  Sinon, je n'aurais pas remarqu√© que BSP tombe dessus (car c'est le lieu de naissance du projet), et le projet est collect√© sur le disque dur.  Voici un exemple d'un tel chemin (d√©j√† corrig√©): <br><br><img src="https://habrastorage.org/webt/ba/qw/c3/baqwc3vz7g4xtyxou9lzaydkaf0.png"><br><br>  Eh bien, tr√®s bien ... Tout a √©t√© g√©n√©r√©, assembl√© ... Et cela fonctionne exactement de la m√™me mani√®re que dans la version 17.1 ... Et pour les contr√¥leurs SoC dans le nouvel environnement, vous devez √©galement recr√©er la cha√Æne JTAG √† chaque fois dans le programmeur.  Dans la version 17.1, il suffisait de le faire une fois et d'√©conomiser ... Eeeeeh.  Eh bien oh bien ... <br><br><h3>  Altera Monitor et son probl√®me </h3><br>  D'une mani√®re ou d'une autre, la recherche en r√©seau des mots D√©marrer le tra√ßage et Arr√™ter le tra√ßage m'a conduit √† des documents int√©ressants.  Ils d√©crivent diff√©rentes versions d'un programme amusant appel√© <b>Altera Monitor</b> aujourd'hui (le nom √©tait diff√©rent dans les anciens documents).  La trouver √©tait relativement facile.  Vous devez t√©l√©charger le package du <b>programme universitaire</b> pour votre version de l'environnement de d√©veloppement.  Faites attention aux restrictions de licence.  Mais puisque nous √©tudions maintenant, nous n'en avons pas peur.  Mais pour le travail commercial - tout est mauvais l√†-bas.  D√©tails ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.intel.com/content/www/us/en/programmable/support/training/university/materials-software.html</a> <br><br>  T√©l√©charger, mettre ... Il y a un document attach√© √† la version actuelle (car les versions dispers√©es sur Internet varient √©norm√©ment).  J'ai m√™me essay√© d'ex√©cuter un exemple pour ma planche √† pain DE0-Nano-SoC.  Il travaille.  Mais quand j'ai essay√© de faire mon projet, √ßa n'a pas march√©.  Le fichier * .sof est charg√© dans le FPGA, apr√®s quoi, apr√®s un certain temps, un message s'affiche: <br><br><img src="https://habrastorage.org/webt/h-/v9/8-/h-v98-afyfovvykexwt8piekhdu.png"><br><br>  Seulement, il n'y a aucune information dans la fen√™tre sp√©cifi√©e.  Si vous essayez de t√©l√©charger √† nouveau: eh bien, le texte appara√Ætra juste dans cette fen√™tre: <br>  <b>Impossible d'interroger les ID d'instance JTAG.</b> <b><br><br></b>  <b>Veuillez vous assurer que le FPGA a √©t√© configur√© en utilisant le fichier .sof correct.</b> <br><br>  Quel genre de probl√®me est-ce?  J'ai cherch√© sur Google.  Trouv√© plusieurs forums avec le m√™me probl√®me.  √Ä une heure, un employ√© d'Intel a demand√© quelle fr√©quence l'auteur avait chez JTAG et a sugg√©r√© d'en fixer une standard.  Bien que, √† ce moment-l√†, j'ai d√©j√† compris que ce n'√©tait pas une question de fr√©quence: l'exemple de l'entreprise fonctionnait et comment le d√©finir?  Sur un forum, l'auteur a √©crit que cela avait r√©ussi.  Il n'a pas compris comment.  Et il a dit que si vous faites tout avec soin selon les instructions, tout fonctionnera.  Le reste de l'image √©tait le m√™me.  Demande l'homme.  Ils ne lui r√©pondent pas.  Apr√®s six mois ou un an, quelqu'un √©crit qu'il a la m√™me situation, y a-t-il eu une solution?  Et le silence aaaaaaaa ... <br><br><h3>  Tentatives de solution exp√©riment√©es </h3><br>  Bon.  Quelle pourrait √™tre la raison?  Au d√©but, j'ai d√©cid√© de regarder autour de moi dans un exemple de travail.  Quel genre de myst√©rieux identifiant JTAG?  Cela pourrait-il √™tre d√ª √† la pr√©sence d'un syst√®me d'identification syst√®me fonctionnel? <br><br><img src="https://habrastorage.org/webt/jo/an/be/joanbea7ptsikwoxwrio-xjcfta.png"><br><br>  Ajout√© √† lui-m√™me, n'a pas aid√©.  Peut-√™tre que le JTAG vers le pont d'Avalon, auquel tous les p√©riph√©riques sont √©galement connect√©s, est √† bl√¢mer? <br><br><img src="https://habrastorage.org/webt/to/al/dr/toaldrafp5anp22mp7f-b0kfv6o.png"><br><br>  Ajout√© - n'a pas aid√©.  J'ai essay√© quelques hypoth√®ses de plus, mais j'ai r√©alis√© que vous pouvez deviner pour toujours.  Avec chagrin, j'ai m√™me demand√© √† Yandex, Bing et m√™me BaiDu.  Ils en savent tous moins que Google.  Il est devenu clair que nous devions faire face √† la d√©compilation afin d'extraire du programme lui-m√™me ce dont il avait besoin.  V√©rifi√© dans quelle langue le programme est √©crit.  Il s'est av√©r√© qu'√† Java.  Le bytecode est stock√© dans le fichier Altera_Monitor_Program.jar.  Eh bien, c'est bizarre.  Sauf que je ne connais pas du tout ce Java.  Sur Java Script, il y avait un cas, t√¢t√© dans l'Internet des objets, mais je ne suis pas tomb√© sur un vrai Java.  Mais l√† o√π le n√¥tre n'a pas disparu! <br><br><h3>  Analyse de bytecode JAVA pour trouver le probl√®me </h3><br>  Comment ouvrir le code d'octet?  Google a conduit √† un article sur Habr√©, qui dit que pour cela, vous devez utiliser le JD-GUI.  Je l'ai trouv√© sur github, je l'ai t√©l√©charg√©.  J'ai identifi√© la zone probl√©matique assez rapidement, car la JD-GUI a une merveilleuse navigation interactive.  Du message au site, je suis sorti en 10 minutes.  Cette section appelle un programme tiers, apr√®s quoi il analyse sa r√©ponse.  L'appel ressemble √† ceci: <br><pre><code class="plaintext hljs">systemConsoleCommand[index] = "system-console"; systemConsoleCommand[var24++] = "--script=" + Globals.gHost.getMonitorProgramRootDir("bin/jtag_instance_check.tcl", true); systemConsoleCommand[var24++] = cable; systemConsoleCommand[var24++] = Globals.gProject.system.sofFilename; try { Process sysConsoleProc = NiosIIShell.executeCommand(systemConsoleCommand).start(); BufferedReader gdbIn = new BufferedReader(new InputStreamReader(sysConsoleProc.getInputStream()));</code> </pre> <br>  Eh bien, et plus loin - analyse de la r√©ponse que nous ne consid√©rons pas encore. <br><br>  Avec ce code, j'ai essay√© d'ouvrir la console NIOS II: <br><br><img src="https://habrastorage.org/webt/s4/u8/tl/s4u8tl-vtf3qn8x0ckrughrfjey.png"><br><br>  L√†, je suis all√© dans le r√©pertoire o√π se trouve le fichier sof et j'ai conduit la ligne de commande: <br>  <b>console syst√®me --script = jtag_instance_check.tcl USB-0 test.sof</b> <br><br>  Certes, pour cela, j'ai d√ª copier le fichier C: \ intelFPGALite \ 17.1 \ University_Program \ Monitor_Program \ bin \ jtag_instance_check.tcl au m√™me endroit o√π se trouve sof, afin de ne pas souffrir avec le chemin.  Au final, j'ai eu une r√©ponse assez d√©cente: <br><br>  <b>TYPE_NAME altera_avalon_jtag_uart.jtag FULL_HPATH jtag_uart_0 (INSTANCE_ID: 0)</b> <b><br><br></b>  <b>TYPE_NAME altera_nios2_gen2.data_master FULL_HPATH nios2_gen2_0 (INSTANCE_ID: 0)</b> <b><br></b> <br><br>  Tout semble √™tre beau ... <br><br><h3>  Suivi de bytecode JAVA </h3><br>  Si l'affaire avait eu lieu aujourd'hui, cette section n'existerait pas.  Mais c'est arriv√© hier.  Je comprenais encore tr√®s mal Java.  Ce qui y √©tait √©crit lors de l'analyse du texte √©tait une for√™t sombre pour moi.  Certes, pendant deux ans, mon enfant a suivi des cours de programmation olympiade chez 1 franchis√©s sovi√©tiques (les certificats et les documents √©taient 1 sovi√©tique).  De l'argent fou a √©t√© donn√© pour ces cours.  Et ils leur ont enseign√© l√†-bas juste √† Java.  Donc, il n'a pas non plus compris ce qui √©tait √©crit plus loin dans le code (en gardant l'intrigue, je publierai le code un peu plus bas, pas maintenant).  En g√©n√©ral, il y avait un sentiment persistant qu'il √©tait temps de retracer.  Je connais la mauvaise section, je vois que les lignes ont √©t√© re√ßues l√†-bas et le programme ne les aime pas avec quelque chose.  Et alors? <br><br>  L'enfant m'a trouv√© un tr√®s bel article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.crowdstrike.com/blog/native-java-bytecode-debugging-without-source-code</a> <br><br>  Il parle d'un plugin tr√®s utile pour Eclipse, qui vous permet de travailler avec des fichiers JAR, en y d√©finissant des points d'arr√™t.  O√π t√©l√©charger, j'ai trouv√© ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">marketplace.eclipse.org/content/bytecode-visualizer/help</a> <br><br>  J'ai t√©l√©charg√© Eclipse, t√©l√©charg√© le plug-in pour une installation hors ligne avec une peine de moiti√© ... J'ai commenc√© √† installer - il n'y a pas assez de biblioth√®ques.  J'ai commenc√© √† lire.  Il s'av√®re qu'il existe trois versions du plugin.  Sous Eslipse 4.5 (Mars), 4.4 (Luna) et 4.3 (je ne me souviens pas du nom).  Eh bien, tout est simple.  On va sur le site d'Eclipse, on voit un lien pour t√©l√©charger la version de Mars pour Java ... Et ... Elle est morte.  Peu importe!  Il y a une dizaine de miroirs! .. Et tous les liens vers eux sont morts.  Nous essayons Luna pour Java, les liens vers x64 sont morts, vers x86 il y en a un vivant ... Comme dit un de mes amis: "H√©morro√Ødes, c'est complet."  En g√©n√©ral, Google a eu du mal, mais m'a trouv√© un assemblage Java 64 bits de la version Mars sur un serveur non officiel.  Je l'ai t√©l√©charg√© pendant une demi-heure, mais je l'ai t√©l√©charg√©. <br><br>  Impl√©mentation d'un plugin, cr√©ation d'un projet ... Horreur!  L√†, la trace n'est pas au niveau du code source, mais au niveau d'un assembleur.  En bref, le code d'octet d√©cod√© est trac√©.  Mais en fait, ce n'est pas grave!  Apr√®s tout, vous pouvez toujours v√©rifier avec les sources d√©compil√©es ouvertes dans une autre fen√™tre, et ce plugin affiche de tr√®s bons commentaires ... Il s'est √©galement av√©r√© que les points d'arr√™t peuvent √™tre d√©finis non pas √† n'importe quel endroit, mais seulement √† l'entr√©e de la fonction.  Mais je ne peux pas m'arr√™ter!  Il n'y a pas grand-chose l√†-bas et vous devez marcher de l'entr√©e de la zone √† probl√®me. <br><br>  Permettez-moi de vous rappeler que les lignes trait√©es ressemblent √† ceci: <br>  <b>TYPE_NAME altera_avalon_jtag_uart.jtag FULL_HPATH jtag_uart_0 (INSTANCE_ID: 0)</b> <b><br><br></b>  <b>TYPE_NAME altera_nios2_gen2.data_master FULL_HPATH nios2_gen2_0 (INSTANCE_ID: 0)</b> <br><br>  Et voici le code Java: <br><pre> <code class="plaintext hljs">if (str.contains("(INSTANCE_ID:")) { Pattern getInstance = Pattern.compile("\\(INSTANCE_ID:(\\d+)\\)"); Matcher idMatcher = getInstance.matcher(str); if (idMatcher.find()) { String foundstr = idMatcher.group(1); instance = Integer.parseInt(foundstr); }</code> </pre><br>  isole parfaitement l'ID d'instance.  Et voici le code: <br><pre> <code class="plaintext hljs"> Pattern getHPath = Pattern.compile("FULL_HPATH (.+?)\\|(.+?) \\("); Matcher hpathMatcher = getHPath.matcher(str); if (hpathMatcher.find()) { hpath = hpathMatcher.group(2).replace("|", "."); }</code> </pre><br>  La variable hpath ne se remplit pas.  Aujourd'hui, je sais d√©j√† que l'expression r√©guli√®re: <br><pre> <code class="plaintext hljs">"FULL_HPATH (.+?)\\|(.+?) \\("</code> </pre> <br>  n√©cessite deux mots s√©par√©s par une barre verticale.  Eh bien, alors seulement ce qui est apr√®s la ligne est pris.  Je ne le savais pas hier.  Plus int√©ressant est un autre.  L'enfant a √©tudi√© le travail √† Java pendant deux ans et n'a pas appris les expressions r√©guli√®res!  Non, il est clair qu'on leur a enseign√© non pas le langage, mais la programmation de l'Olympiade au moyen du langage, mais si je comprends bien, les expressions r√©guli√®res en Java sont dans l'ordre des choses.  Ils prennent un tel argent, ils secouent des certificats d'entreprises r√©put√©es, mais ils n'enseignent pas des choses importantes ... Mais je m'√©gare. <br><br><h3>  La lumi√®re au bout du tunnel </h3><br>  Quelle est la ligne verticale?  Nous prenons le projet qui a fonctionn√©, lui donnons la m√™me √©quipe et obtenons cette r√©ponse: <br><br>  <b>TYPE_NAME altera_avalon_jtag_uart.jtag FULL_HPATH Computer_System: The_System | JTAG_UART (INSTANCE_ID: 0)</b> <b><br><br></b>  <b>TYPE_NAME altera_avalon_jtag_uart.jtag FULL_HPATH Computer_System: The_System | JTAG_UART_2nd_Core (INSTANCE_ID: 1)</b> <b><br><br></b>  <b>TYPE_NAME altera_avalon_jtag_uart.jtag FULL_HPATH Computer_System: The_System | JTAG_UART_for_ARM_0 (INSTANCE_ID: 2)</b> <b><br><br></b>  <b>TYPE_NAME altera_avalon_jtag_uart.jtag FULL_HPATH Computer_System: The_System | JTAG_UART_for_ARM_1 (INSTANCE_ID: 3)</b> <b><br><br></b>  <b>TYPE_NAME altera_nios2_gen2.data_master FULL_HPATH Computer_System: The_System | Nios2 (INSTANCE_ID: 0)</b> <b><br><br></b>  <b>TYPE_NAME altera_nios2_gen2.data_master FULL_HPATH Computer_System: The_System | Nios2_2nd_Core (INSTANCE_ID: 1)</b> <br><br>  Qu'est-ce que Computer_System: The_System?  Ici, tout est simple.  Dans cette s√©rie d'articles, je fais la promotion d'une id√©e avanc√©e o√π le syst√®me informatique est au niveau sup√©rieur de la hi√©rarchie. <div class="spoiler">  <b class="spoiler_title">Et cet exemple a cette couche Verilog:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">module DE0_Nano_SoC_Computer ( //////////////////////////////////// // FPGA Pins //////////////////////////////////// // Clock pins input CLOCK_50, input CLOCK2_50, input CLOCK3_50, // ADC output ADC_CONVST, output ADC_SCLK, output ADC_SDI, input ADC_SDO, // ARDUINO inout [15:0] ARDUINO_IO, inout ARDUINO_RESET_N, // GPIO inout [35:0] GPIO_0, inout [35:0] GPIO_1, // KEY input [1:0] KEY, // LED output [7:0] LED, // SW input [3:0] SW, //////////////////////////////////// // HPS Pins //////////////////////////////////// // DDR3 SDRAM output [14:0] HPS_DDR3_ADDR, output [2:0] HPS_DDR3_BA, output HPS_DDR3_CAS_N, output HPS_DDR3_CKE, output HPS_DDR3_CK_N, output HPS_DDR3_CK_P, output HPS_DDR3_CS_N, output [3:0] HPS_DDR3_DM, inout [31:0] HPS_DDR3_DQ, inout [3:0] HPS_DDR3_DQS_N, inout [3:0] HPS_DDR3_DQS_P, output HPS_DDR3_ODT, output HPS_DDR3_RAS_N, output HPS_DDR3_RESET_N, input HPS_DDR3_RZQ, output HPS_DDR3_WE_N, // Ethernet output HPS_ENET_GTX_CLK, inout HPS_ENET_INT_N, output HPS_ENET_MDC, inout HPS_ENET_MDIO, input HPS_ENET_RX_CLK, input [3:0] HPS_ENET_RX_DATA, input HPS_ENET_RX_DV, output [3:0] HPS_ENET_TX_DATA, output HPS_ENET_TX_EN, // Accelerometer inout HPS_GSENSOR_INT, // I2C inout HPS_I2C0_SCLK, inout HPS_I2C0_SDAT, inout HPS_I2C1_SCLK, inout HPS_I2C1_SDAT, // Pushbutton inout HPS_KEY, // LED inout HPS_LED, // LTC inout HPS_LTC_GPIO, // SD Card output HPS_SD_CLK, inout HPS_SD_CMD, inout [3:0] HPS_SD_DATA, // SPI output HPS_SPIM_CLK, input HPS_SPIM_MISO, output HPS_SPIM_MOSI, inout HPS_SPIM_SS, // UART input HPS_UART_RX, output HPS_UART_TX, // USB inout HPS_CONV_USB_N, input HPS_USB_CLKOUT, inout [7:0] HPS_USB_DATA, input HPS_USB_DIR, input HPS_USB_NXT, output HPS_USB_STP ); //======================================================= // REG/WIRE declarations //======================================================= wire hps_fpga_reset_n; //======================================================= // Structural coding //======================================================= Computer_System The_System ( //////////////////////////////////// // FPGA Side //////////////////////////////////// // Global signals .system_pll_ref_clk_clk (CLOCK_50), .system_pll_ref_reset_reset (1'b0), // ADC .adc_sclk (ADC_SCLK), .adc_cs_n (ADC_CONVST), .adc_dout (ADC_SDO), .adc_din (ADC_SDI), // Arduino GPIO .arduino_gpio_export (ARDUINO_IO), // Arduino Reset_n .arduino_reset_n_export (ARDUINO_RESET_N), // Slider Switches .slider_switches_export (SW), // Pushbuttons .pushbuttons_export (~KEY), // Expansion JP1 .expansion_jp1_export ({GPIO_0[35:19], GPIO_0[17], GPIO_0[15:3], GPIO_0[1]}), // Expansion JP7 .expansion_jp7_export ({GPIO_1[35:19], GPIO_1[17], GPIO_1[15:3], GPIO_1[1]}), // LEDs .leds_export (LED), //////////////////////////////////// // HPS Side //////////////////////////////////// // DDR3 SDRAM .memory_mem_a (HPS_DDR3_ADDR), .memory_mem_ba (HPS_DDR3_BA), .memory_mem_ck (HPS_DDR3_CK_P), .memory_mem_ck_n (HPS_DDR3_CK_N), .memory_mem_cke (HPS_DDR3_CKE), .memory_mem_cs_n (HPS_DDR3_CS_N), .memory_mem_ras_n (HPS_DDR3_RAS_N), .memory_mem_cas_n (HPS_DDR3_CAS_N), .memory_mem_we_n (HPS_DDR3_WE_N), .memory_mem_reset_n (HPS_DDR3_RESET_N), .memory_mem_dq (HPS_DDR3_DQ), .memory_mem_dqs (HPS_DDR3_DQS_P), .memory_mem_dqs_n (HPS_DDR3_DQS_N), .memory_mem_odt (HPS_DDR3_ODT), .memory_mem_dm (HPS_DDR3_DM), .memory_oct_rzqin (HPS_DDR3_RZQ), // Accelerometer .hps_io_hps_io_gpio_inst_GPIO61 (HPS_GSENSOR_INT), // Ethernet .hps_io_hps_io_gpio_inst_GPIO35 (HPS_ENET_INT_N), .hps_io_hps_io_emac1_inst_TX_CLK (HPS_ENET_GTX_CLK), .hps_io_hps_io_emac1_inst_TXD0 (HPS_ENET_TX_DATA[0]), .hps_io_hps_io_emac1_inst_TXD1 (HPS_ENET_TX_DATA[1]), .hps_io_hps_io_emac1_inst_TXD2 (HPS_ENET_TX_DATA[2]), .hps_io_hps_io_emac1_inst_TXD3 (HPS_ENET_TX_DATA[3]), .hps_io_hps_io_emac1_inst_RXD0 (HPS_ENET_RX_DATA[0]), .hps_io_hps_io_emac1_inst_MDIO (HPS_ENET_MDIO), .hps_io_hps_io_emac1_inst_MDC (HPS_ENET_MDC), .hps_io_hps_io_emac1_inst_RX_CTL (HPS_ENET_RX_DV), .hps_io_hps_io_emac1_inst_TX_CTL (HPS_ENET_TX_EN), .hps_io_hps_io_emac1_inst_RX_CLK (HPS_ENET_RX_CLK), .hps_io_hps_io_emac1_inst_RXD1 (HPS_ENET_RX_DATA[1]), .hps_io_hps_io_emac1_inst_RXD2 (HPS_ENET_RX_DATA[2]), .hps_io_hps_io_emac1_inst_RXD3 (HPS_ENET_RX_DATA[3]), // I2C .hps_io_hps_io_i2c0_inst_SDA (HPS_I2C0_SDAT), .hps_io_hps_io_i2c0_inst_SCL (HPS_I2C0_SCLK), .hps_io_hps_io_i2c1_inst_SDA (HPS_I2C1_SDAT), .hps_io_hps_io_i2c1_inst_SCL (HPS_I2C1_SCLK), // Pushbutton .hps_io_hps_io_gpio_inst_GPIO54 (HPS_KEY), // LED .hps_io_hps_io_gpio_inst_GPIO53 (HPS_LED), // LTC .hps_io_hps_io_gpio_inst_GPIO40 (HPS_LTC_GPIO), // SD Card .hps_io_hps_io_sdio_inst_CMD (HPS_SD_CMD), .hps_io_hps_io_sdio_inst_D0 (HPS_SD_DATA[0]), .hps_io_hps_io_sdio_inst_D1 (HPS_SD_DATA[1]), .hps_io_hps_io_sdio_inst_CLK (HPS_SD_CLK), .hps_io_hps_io_sdio_inst_D2 (HPS_SD_DATA[2]), .hps_io_hps_io_sdio_inst_D3 (HPS_SD_DATA[3]), // SPI .hps_io_hps_io_spim1_inst_CLK (HPS_SPIM_CLK), .hps_io_hps_io_spim1_inst_MOSI (HPS_SPIM_MOSI), .hps_io_hps_io_spim1_inst_MISO (HPS_SPIM_MISO), .hps_io_hps_io_spim1_inst_SS0 (HPS_SPIM_SS), // UART .hps_io_hps_io_uart0_inst_RX (HPS_UART_RX), .hps_io_hps_io_uart0_inst_TX (HPS_UART_TX), // USB .hps_io_hps_io_gpio_inst_GPIO09 (HPS_CONV_USB_N), .hps_io_hps_io_usb1_inst_D0 (HPS_USB_DATA[0]), .hps_io_hps_io_usb1_inst_D1 (HPS_USB_DATA[1]), .hps_io_hps_io_usb1_inst_D2 (HPS_USB_DATA[2]), .hps_io_hps_io_usb1_inst_D3 (HPS_USB_DATA[3]), .hps_io_hps_io_usb1_inst_D4 (HPS_USB_DATA[4]), .hps_io_hps_io_usb1_inst_D5 (HPS_USB_DATA[5]), .hps_io_hps_io_usb1_inst_D6 (HPS_USB_DATA[6]), .hps_io_hps_io_usb1_inst_D7 (HPS_USB_DATA[7]), .hps_io_hps_io_usb1_inst_CLK (HPS_USB_CLKOUT), .hps_io_hps_io_usb1_inst_STP (HPS_USB_STP), .hps_io_hps_io_usb1_inst_DIR (HPS_USB_DIR), .hps_io_hps_io_usb1_inst_NXT (HPS_USB_NXT) ); endmodule</code> </pre><br></div></div><br>  Je l'ai sp√©cifiquement apport√© dans son int√©gralit√© pour souligner la quantit√© de code compl√®tement inutile que vous devez √©crire dans ce cas.  Et si les jambes sont ajout√©es ou supprim√©es, ce code devra √©galement √™tre modifi√©.  En fait, les lignes <br><br><img src="https://habrastorage.org/webt/gg/_n/b3/gg_nb3rvplsmdkewhuqiqgctyqa.png"><br><div class="spoiler">  <b class="spoiler_title">M√™me texte:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">... Computer_System The_System ( //////////////////////////////////// // FPGA Side //////////////////////////////////// // Global signals .system_pll_ref_clk_clk (CLOCK_50), ...</code> </pre><br></div></div><br>  et donnez ce pr√©fixe.  Les auteurs estiment que la hi√©rarchie doit √™tre telle, seulement ceci et pas d'autre.  Le syst√®me de processeur ne peut pas √™tre retir√© plus profond√©ment et ne peut pas √™tre transport√©. <br><br><h3>  Nous ne devons pas attendre la piti√© de la nature, prenez-la - notre t√¢che! </h3><br>  Avons-nous vraiment fait un tel travail uniquement pour supporter cette affaire?  Comme un de mes amis aime √† le dire: ¬´le travail inutile est pire que l'ivresse¬ª, et la cr√©ation d'une telle couche est un cas typique de travail inutile.  Par cons√©quent, nous essaierons de contourner cette limitation.  Rappelez-vous, lorsque vous appelez un programme JAVA tiers, le code a substitu√© un script tcl, je l'ai √©galement copi√© dans le r√©pertoire √† c√¥t√© du fichier sof?  C'est notre salut!  C'est lui qui indique √† la console syst√®me les actions √† entreprendre et c'est lui qui formate la r√©ponse.  le formatage se pr√©sente comme suit: <br><img src="https://habrastorage.org/webt/6a/si/cq/6asicqpxflldfmtmq1qveh_6c4q.png"><br><div class="spoiler">  <b class="spoiler_title">M√™me texte:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># PRINT OUT INSTANCE ID INFO FOR EVERYTHING: set i 0 foreach path [lsort -command compare_node_number [get_service_paths bytestream]] { # If this path corresponds to a JTAG UART, incr i if {[string match *$cable_name* $path ] &amp;&amp; [string match *jtag_uart* [marker_get_type $path] ]} { puts "[marker_get_info $path] (INSTANCE_ID:$i)" incr i } } set i 0 foreach path [lsort -command compare_node_number [get_service_paths processor]] { # If this path corresponds to a NiosII, incr i if {[string match *$cable_name* $path ] &amp;&amp; [string match *nios2* [marker_get_type $path] ]} { puts "[marker_get_info $path] (INSTANCE_ID:$i)" incr i } }</code> </pre><br></div></div><br>  Le premier bloc formate les informations sur les blocs JTAG_UART, le second - sur les c≈ìurs de processeur.  Maintenant, si ici nous ajoutons des lignes verticales au flux de sortie!  Mon coll√®gue a corrig√© cet article comme suit: <br><pre> <code class="plaintext hljs"># PRINT OUT INSTANCE ID INFO FOR EVERYTHING: set i 0 foreach path [lsort -command compare_node_number [get_service_paths bytestream]] { # If this path corresponds to a JTAG UART, incr i if {[string match *$cable_name* $path ] &amp;&amp; [string match *jtag_uart* [marker_get_type $path] ]} { set info [marker_get_info $path] if {[string first "|" $info] == -1} { set info [string map {"FULL_HPATH " "FULL_HPATH a:b|"} $info] } puts "$info (INSTANCE_ID:$i)" incr i } } set i 0 foreach path [lsort -command compare_node_number [get_service_paths processor]] { # If this path corresponds to a NiosII, incr i if {[string match *$cable_name* $path ] &amp;&amp; [string match *nios2* [marker_get_type $path] ]} { set info [marker_get_info $path] if {[string first "|" $info] == -1} { set info [string map {"FULL_HPATH " "FULL_HPATH a:b|"} $info] } puts "$info (INSTANCE_ID:$i)" incr i } }</code> </pre><br>  Maintenant, s'il n'y a pas de tirets, ils seront ajout√©s.  Et enfin, le programme fonctionnera non seulement avec un terrible, mais aussi avec un syst√®me de processeur √©crit de mani√®re optimale! <br><br><h2>  Configuration d'un projet dans Altera Monitor </h2><br>  Uffff.  C‚Äôest tout.  La fin du gougeage, du tout-terrain et de la n√©gligence (bien que, tout-terrain - ce n'est pas exact).  Encore une fois, les dessins de l'article refl√®tent les instructions de travail!  Nous avons un projet pour les FPGA, ainsi qu'un programme qui se construit et s'ex√©cute dans Eclipse.  Lancez maintenant Altera Monitor et cr√©ez un projet. <br><br><img src="https://habrastorage.org/webt/zy/kc/b0/zykcb02zebkc-u6wknzbnnqozew.png"><br><br>  Nous cr√©ons un catalogue avec le projet (je le mets s√©par√©ment du projet pour FPGA) et donnons le nom du projet.  Choisissez √©galement une architecture de processeur <br><br><img src="https://habrastorage.org/webt/md/8c/sg/md8csgrftsf_j0mt8vyjrcaaaua.png"><br><br>  Le syst√®me que je choisis est un syst√®me personnalis√©.  Vous devez sp√©cifier mes fichiers * .sof et * .sopcinfo.  Je les s√©lectionne dans les r√©pertoires de travail.  Notre syst√®me n'a pas besoin de pr√©chargeur. <br><br><img src="https://habrastorage.org/webt/ej/zb/ad/ejzbad_u22w-hczkkgluen36nfa.png"><br><br>  S√©lectionnez le type de programme Programme avec prise en charge du pilote de p√©riph√©rique, puis la biblioth√®que BSP sera cr√©√©e: <br><br><img src="https://habrastorage.org/webt/td/dw/ew/tddwewush_a8-srgsrrnpbcmbo4.png"><br><br>  Il n'y a pour l'instant qu'un seul fichier de travail (il a √©t√© cr√©√© dans Eclipse).  Ici, je l'ajoute: <br><br><img src="https://habrastorage.org/webt/f9/pt/mk/f9ptmk-t78ilnla5-7hm4mlnpno.png"><br><br>  Dans la derni√®re fen√™tre, je ne change rien: <br><br><img src="https://habrastorage.org/webt/sm/lf/e_/smlfe__fqs5gt3ieiuhcryd0fso.png"><br><br>  Nous acceptons le t√©l√©chargement du fichier sof: <br><br><img src="https://habrastorage.org/webt/yl/x6/qx/ylx6qxkmhkql0hbxgdqgakxek4c.png"><br><br>  Si nous venons d'installer le logiciel, nous sommes pass√©s en mode source.  Ensuite, il sera d√©j√† activ√© (je vous montrerai √† quoi ressemble le menu lorsque tout est d√©j√† activ√©, il y aura √©galement un √©l√©ment √† inclure). <br><br><img src="https://habrastorage.org/webt/nj/jo/4p/njjo4pxzvs87ygedajsdkh8gx_u.png"><br><br>  J'ai le programme C le plus simple: <br><pre> <code class="plaintext hljs">#include "sys/alt_stdio.h" int main() { alt_putstr("Hello from Nios II!\n"); volatile int i=0; i += 1; i += 2; i += 3; i += 4; i += 5; i += 6; i += 7; i += 8; i += 9; i += 10; i += 11; i += 12; /* Event loop never exits. */ while (1); return 0; }</code> </pre><br>  J'essaye de le r√©cup√©rer: <br><br><img src="https://habrastorage.org/webt/d_/2q/pq/d_2qpq5wlpcikhp1sqfzfn4qfxq.png"><br><br>  Je re√ßois une erreur: <br>  <b>c: /intelfpga/17.1/nios2eds/bin/gnu/h-x86_64-mingw32/bin /../ lib / gcc / nios2-elf / 5.3.0 /../../../../ .. /H-x86_64-mingw32/nios2-elf/bin/ld.exe: r√©gion `Code 'd√©bord√©e de 15888 octets</b> <br><br>  C'est parce que je n'ai pas ajout√© de SDRAM au syst√®me, je l'ai limit√© √† la m√©moire FPGA interne.  Mais pourquoi tout s'int√©grait-il dans Eclipse, mais pas ici?  Parce que j'y ai choisi BSP avec le suffixe Small, mais ici on m'a automatiquement fait un package r√©gulier.  Par cons√©quent, ouvrez le fichier: C: \ Work \ Play2 \ BSP \ settings.bsp <br><br>  Et nous commen√ßons le r√©glage manuel. <br><br><img src="https://habrastorage.org/webt/bu/tv/vn/butvvng3etvwox28euel6mvggyq.png"><br><br><img src="https://habrastorage.org/webt/sq/ei/kk/sqeikkntwrn4ju8qtve_yybvgxw.png"><br><br>  Reconstruire BSP: <br><br><img src="https://habrastorage.org/webt/a0/sf/0_/a0sf0_tbaegc9-cusl2bfa-xova.png"><br><br>  Et encore une fois, nous collectons le projet.  Cette fois avec succ√®s.  Maintenant, chargez-le: <br><br><img src="https://habrastorage.org/webt/sm/kg/rl/smkgrlr9croftl0y-fagdqqhr1a.png"><br><br><h2>  Enfin, la vraie trace </h2><br>  Tu n'as pas oubli√© pourquoi je fais tout √ßa?  Je fais cela pour le tra√ßage.  Il doit √™tre activ√©.  Pour ce faire, acc√©dez √† l'onglet Trace et s√©lectionnez Activer la trace dans le menu contextuel: <br><br><img src="https://habrastorage.org/webt/nv/bo/pp/nvboppbqx8ihyhh6qlxmbxjgfq0.png"><br><br>  Je mettrai un point d'arr√™t √† la fin de la fonction main () sur l'onglet D√©sassemblage (√† quel point l'assembleur RISC s'occupe bien du terrible assembleur de pile dans lequel le code Java se transforme!) <br><br>  Voici le d√©but de la fonction principale: <br><br><img src="https://habrastorage.org/webt/ue/m2/-q/uem2-qdgcpj7stuobbouowscfkw.png"><br><br>  Faites d√©filer un peu et mettez un point d'arr√™t ici: <br><br><img src="https://habrastorage.org/webt/ev/zf/ot/evzfotqiwhr4w0j2f-xrilmfooe.png"><br><br>  Nous commen√ßons, attendons un arr√™t et allons dans l'onglet Trace. <br><br>  En g√©n√©ral, tout n'est pas tr√®s bon.  Au d√©but, il y avait √©videmment une sorte d‚Äôattente (nous avions l√† une conclusion dans JTAG, donc c‚Äôest une chose l√©gitime): <br><br><img src="https://habrastorage.org/webt/yd/fo/jf/ydfojfs41-yysqn8kqndisvaguw.png"><br><br>  En fin de compte - un autre code ... Mais je ne vois pas le code de fonction principale!  Voici la fin: <br><br><img src="https://habrastorage.org/webt/ww/eb/ky/wwebkyjc8nj3nrdnxrpfqoosbc0.png"><br><br>  Je ne sais m√™me pas quoi dire.  Mais de toute fa√ßon, si vous mettez non pas un, mais deux points d'arr√™t (au d√©but et √† la fin de la fonction principale), puis apr√®s avoir ex√©cut√© du premier au deuxi√®me, l'image sera d√©cente: <br><br><img src="https://habrastorage.org/webt/kq/pr/en/kqprenc25bb2vbucdmxq_49vzqy.png"><br><br><h2>  Br√®ves conclusions </h2><br>  Nous avons donc d√©couvert qu'il √©tait tout √† fait possible de d√©couvrir comment fonctionnait un site particulier.  Ainsi, le sujet de l'article ("... comment le processeur est arriv√© √† une telle vie") est divulgu√©.  Il est plus int√©ressant de voir comment tous ceux dont les probl√®mes ont d√ª √™tre r√©solus pour obtenir un r√©sultat sont arriv√©s √† une telle vie?  Et il est tr√®s regrettable que jusqu'√† pr√©sent je n'ai pas pu d√©terminer combien de barres une √©quipe particuli√®re a compl√©t√©es.  D'apr√®s des extraits de documentation, il est clair que cela semble techniquement possible, mais le logiciel qui permettra de le faire n'est pas clair.  Il y a une opinion que le document <b>Analyser et d√©boguer des conceptions avec la console syst√®me</b> , que j'ai d√ª lire lors de l'analyse du script tcl, nous aidera.  Il a une tablette int√©ressante <b>Tableau 10-15: Commandes du syst√®me de trace</b> , mais personnellement, je n'ai tout simplement pas le temps pour une √©tude d√©taill√©e de cette question.  Mais peut-√™tre que ce sera si important pour quelqu'un qu'il mettra tout en ≈ìuvre.  Ces commandes sont incluses dans les scripts tcl. <br><br>  Eh bien, dans les articles suivants, les mesures devront √™tre faites √† l'ancienne, avec un oscilloscope. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464795/">https://habr.com/ru/post/fr464795/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464777/index.html">Pourquoi const n'acc√©l√®re-t-il pas le code C / C ++?</a></li>
<li><a href="../fr464779/index.html">√Ä propos des abeilles h√©donistes, de la fa√ßon dont les gens les font fonctionner et des drones</a></li>
<li><a href="../fr464785/index.html">Avantages non comp√©titifs de Beeline</a></li>
<li><a href="../fr464787/index.html">Je suis s√ªr que le d√©veloppeur mobile senior ne viendra que sur recommandation</a></li>
<li><a href="../fr464791/index.html">Kubernetes pour la voiture: comment ouvrir l'acc√®s du d√©veloppeur √† l'ordinateur de bord et le s√©curiser</a></li>
<li><a href="../fr464803/index.html">"Hide www": pourquoi les d√©veloppeurs de navigateurs traditionnels ont de nouveau refus√© d'afficher le sous-domaine</a></li>
<li><a href="../fr464805/index.html">√âcrire un serpent sur iPad (Pythonista)</a></li>
<li><a href="../fr464809/index.html">Comment nous avons test√© la technologie de reconnaissance faciale et ce qui en est ressorti</a></li>
<li><a href="../fr464811/index.html">Apple Music pour le d√©veloppeur</a></li>
<li><a href="../fr464813/index.html">Remplacement de Punto Switcher, Birman layouts par un script sur autohotkey</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>