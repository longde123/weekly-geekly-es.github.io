<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§òüèº üë®üèæ‚Äçüé® üë®‚Äçüë©‚Äçüëß "Eu n√£o vou dar uma pedra" ou como os recursos do jogo "Terras Amaldi√ßoadas" s√£o organizados üßëüèΩ‚Äçü§ù‚Äçüßëüèª üë®üèΩ‚Äçüç≥ üâê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voc√™ se lembra de muitos jogos russos? Qualitativo? Memor√°vel? Sim eles eram. Se voc√™ tem mais de 35 anos ou √© um f√£ da ind√∫stria de jogos russa, prov...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Eu n√£o vou dar uma pedra" ou como os recursos do jogo "Terras Amaldi√ßoadas" s√£o organizados</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434802/"><p><img src="https://habrastorage.org/webt/ry/nk/a_/rynka_dqz5ny9nqgs7gawsw4zxy.jpeg"></p><br><p>  Voc√™ se lembra de muitos jogos russos?  Qualitativo?  Memor√°vel?  Sim eles eram.  Se voc√™ tem mais de 35 anos ou √© um f√£ da ind√∫stria de jogos russa, provavelmente est√° familiarizado com as Terras Amaldi√ßoadas. </p><br><p>  A hist√≥ria come√ßou de maneira muito prosaica: ver√£o, calor.  N√£o h√° nada de especial a fazer e, ao navegar pregui√ßosamente pelo conte√∫do do disco r√≠gido do laptop, meu olhar pegou uma pasta com o familiar √≠cone de drag√£o que estava inativo por alguns anos. </p><br><p>  Que f√£ do jogo n√£o estar√° interessado em saber o que est√° dentro? </p><a name="habracut"></a><br><h1 id="vvedenie">  1. Introdu√ß√£o </h1><br><h2 id="informaciya-ob-igre">  Informa√ß√µes do jogo </h2><br><p>  <strong>Terras Amaldi√ßoadas</strong> - ou, como eram chamadas fora da CEI, <strong>Ilhas Malignas: Maldi√ß√£o da Alma Perdida</strong> , um jogo de RPG furtivo lan√ßado em 2000.  O jogo foi desenvolvido pela Nival Interactive, que na √©poca j√° havia se estabelecido como uma s√©rie de jogos Alloda (Rage of Mages no exterior).  A maioria dos graduados da Universidade Estatal de Moscou trabalhou nele - eles foram capazes de realizar um dos primeiros jogos com um mundo completamente tridimensional. <br>  Em 2010, o Mail.Ru ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">informa√ß√µes</a> ) transferiu o t√≠tulo para o nome, mas o jogo ainda est√° sendo vendido na loja GOG em nome da Nival. </p><br><p>  Recentemente, o jogo completou 18 anos - o anivers√°rio √© considerado 26 de outubro, a data de lan√ßamento na CEI.  Apesar da idade, o servidor mestre oficial ainda est√° em servi√ßo: periodicamente, algu√©m decide rastejar pelas florestas de Gipat e atingir uma d√∫zia ou dois esqueletos com um esquadr√£o de camaradas. </p><br><h2 id="korotko-o-state">  Brevemente sobre o artigo </h2><br><p>  Inicialmente, meu objetivo era apenas escrever um conversor unidirecional "para mim" no Python 3, usando bibliotecas exclusivamente padr√£o.  No entanto, no processo, a documenta√ß√£o dos formatos come√ßou sem problemas, tentativas de alguma forma padronizar a sa√≠da.  Para alguns formatos, a estrutura foi descrita usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kaitai Struct</a> .  Como resultado, tudo resultou na reda√ß√£o deste artigo e no wiki em formatos. </p><br><p>  Percebo imediatamente: na maioria das vezes, os arquivos do jogo j√° foram pesquisados, os editores de f√£s foram escritos para eles.  No entanto, as informa√ß√µes s√£o extremamente fragmentadas e n√£o h√° descri√ß√£o mais ou menos completa dos formatos no dom√≠nio p√∫blico, nem existe um conjunto adequado para a cria√ß√£o de modifica√ß√µes. </p><br><h2 id="i-o-tom-kak-eyo-chitat">  ... e como l√™-lo </h2><br><p>  Os esquemas (arquivos .ksy) s√£o fornecidos para todos os formatos, que podem ser convertidos em dois cliques no c√≥digo em v√°rios dos idiomas mais populares. </p><br><p>  Infelizmente, j√° nos √∫ltimos est√°gios de reda√ß√£o deste artigo, descobri que o estimado Habr n√£o √© capaz de destacar o YAML (e o JSON), e todos os esquemas o utilizam.  Isso n√£o deve ser um grande problema, mas se for inconveniente ler o esquema, posso aconselh√°-lo a copi√°-lo para um editor de terceiros, por exemplo, NPP. </p><br><h1 id="resursy-i-gde-oni-obitayut">  Recursos e onde eles moram </h1><br><p>  O jogo √© um aplicativo port√°til que cont√©m um mecanismo com bibliotecas, um iniciador e, de fato, recursos compactados. </p><br><blockquote>  <strong>Isso √© interessante:</strong> as configura√ß√µes do jogo s√£o quase inteiramente armazenadas no registro.  O bug da c√¢mera na vers√£o GOG √© devido ao fato de o instalador n√£o registrar os valores padr√£o corretos. </blockquote><p>  √Ä primeira vista no conte√∫do da pasta do jogo, notamos imediatamente algumas novas extens√µes de arquivo: ASI e REG. <br>  A primeira √© uma biblioteca din√¢mica, que n√£o consideraremos (isso √© feito por especialistas em engenharia reversa), mas a segunda √© o primeiro formato de arquivo nativo do jogo. </p><br><h2 id="reg">  REG </h2><br><p>  Arquivos desse tipo s√£o serializa√ß√£o bin√°ria de arquivos INI de texto conhecidos. <br>  O conte√∫do √© dividido em se√ß√µes que armazenam chaves e seus valores.  Um arquivo REG mant√©m essa hierarquia, mas acelera a leitura e a an√°lise de dados - em 2000, isso era aparentemente cr√≠tico. </p><br><p>  Em geral, voc√™ pode descrever a estrutura deste diagrama: <br><img src="https://habrastorage.org/webt/yh/se/fo/yhsefo2h5nxp0ghwse2zla8cmv0.png"></p><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o da estrutura</b> <div class="spoiler_text"><pre><code class="plaintext hljs">meta: id: reg title: Evil Islands, REG file (packed INI) application: Evil Islands file-extension: reg license: MIT endian: le doc: Packed INI file seq: - id: magic contents: [0xFB, 0x3E, 0xAB, 0x45] doc: Magic bytes - id: sections_count type: u2 doc: Number of sections - id: sections_offsets type: section_offset doc: Sections offset table repeat: expr repeat-expr: sections_count types: section_offset: doc: Section position in file seq: - id: order type: s2 doc: Section order number - id: offset type: u4 doc: Global offset of section in file instances: section: pos: offset type: section types: section: doc: Section representation seq: - id: keys_count type: u2 doc: Number of keys in section - id: name_len type: u2 doc: Section name lenght - id: name type: str encoding: cp1251 size: name_len doc: Section name - id: keys type: key doc: Section's keys repeat: expr repeat-expr: keys_count types: key: doc: Named key seq: - id: order type: s2 doc: Key order in section - id: offset type: u4 doc: Key offset in section instances: key_record: pos: _parent._parent.offset + offset type: key_data key_data: seq: - id: packed_type type: u1 doc: Key value info - id: name_len type: u2 doc: Key name lenght - id: name type: str encoding: cp1251 size: name_len doc: Key name - id: value type: value doc: Key value instances: is_array: value: packed_type &gt; 127 doc: Is this key contain array value_type: value: packed_type &amp; 0x7F doc: Key value type types: value: doc: Key value seq: - id: array_size type: u2 if: _parent.is_array doc: Value array size - id: data type: switch-on: _parent.value_type cases: 0: s4 1: f4 2: string repeat: expr repeat-expr: '_parent.is_array ? array_size : 1' doc: Key value data string: doc: Sized string seq: - id: len type: u2 doc: String lenght - id: value type: str encoding: cp1251 size: len doc: String</code> </pre> </div></div><br><blockquote>  <strong>Isso √© interessante:</strong> em 2002, o Nival compartilhou algumas ferramentas com a comunidade do jogo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://web.archive.org/web/20020610194020/">instant√¢neo do site</a> ) - uma delas era o serializador INI no REG.  Como voc√™ pode imaginar, um desserializador apareceu quase imediatamente, embora n√£o seja oficial. </blockquote><p>  Com a pasta inicial organizada, vamos para os subdiret√≥rios. <br>  A primeira olhada fica na pasta C√¢meras que cont√©m os arquivos CAM. </p><br><h2 id="cam">  Cam </h2><br><p>  Um formato muito simples √© simplesmente colocar as posi√ß√µes das c√¢meras ao longo do tempo.  A c√¢mera √© descrita por posi√ß√£o e rota√ß√£o.  Os outros dois campos s√£o presumivelmente tempo e passo na sequ√™ncia de movimentos. </p><br><p><img src="https://habrastorage.org/webt/cu/8u/bj/cu8ubjrcz2pode-v3lydliwrvsq.png"></p><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o da estrutura</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: cam title: Evil Islands, CAM file (cameras) application: Evil Islands file-extension: cam license: MIT endian: le doc: Camera representation seq: - id: cams type: camera repeat: eos types: vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis quat: doc: quaternion seq: - id: w type: f4 doc: w component - id: x type: f4 doc: x component - id: y type: f4 doc: y component - id: z type: f4 doc: z component camera: doc: Camera parameters seq: - id: unkn0 type: u4 doc: unknown - id: unkn1 type: u4 doc: unknown - id: position type: vec3 doc: camera's position - id: rotation type: quat doc: camera's rotation</code> </pre> </div></div><br><p>  Na pr√≥xima pasta - Res, (inesperadamente!), Os arquivos RES armazenados s√£o armazenados. </p><br><h2 id="res">  RES </h2><br><p>  √Äs vezes, esse formato est√° oculto em outras extens√µes, mas o original ainda √© exatamente RES. <br>  A estrutura de dados √© muito t√≠pica para um arquivo morto com acesso aleat√≥rio a arquivos: existem tabelas para armazenar informa√ß√µes sobre arquivos, uma tabela de nomes e o conte√∫do dos arquivos. <br>  A estrutura de diret√≥rios est√° contida diretamente nos nomes. </p><br><p>  Vale ressaltar dois fatos extremamente interessantes: </p><br><ol><li>  O arquivamento √© otimizado para carregar informa√ß√µes do arquivo em uma lista vinculada com hash fechado. </li><li>  Voc√™ pode armazenar o conte√∫do do arquivo uma vez, mas consulte-o com nomes diferentes.  At√© onde eu sei, esse fato foi usado em uma reembalagem de f√£s, onde o tamanho do jogo foi bastante reduzido devido a isso.  Na distribui√ß√£o original, a otimiza√ß√£o de arquivo n√£o foi usada. </li></ol><br><p><img src="https://habrastorage.org/webt/_9/ie/8_/_9ie8_m0lc_b1n0ddnagkue514g.png"></p><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o da estrutura</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: res title: Evil Islands, RES file (resources archive) application: Evil Islands file-extension: res license: MIT endian: le doc: Resources archive seq: - id: magic contents: [0x3C, 0xE2, 0x9C, 0x01] doc: Magic bytes - id: files_count type: u4 doc: Number of files in archive - id: filetable_offset type: u4 doc: Filetable offset - id: nametable_size type: u4 doc: Size of filenames instances: nametable_offset: value: filetable_offset + 22 * files_count doc: Offset of filenames table filetable: pos: filetable_offset type: file_record repeat: expr repeat-expr: files_count doc: Files metadata table types: file_record: doc: File metadata seq: - id: next_index type: s4 doc: Next file index - id: file_size type: u4 doc: Size of file in bytes - id: file_offset type: u4 doc: File data offset - id: last_change type: u4 doc: Unix timestamp of last change time - id: name_len type: u2 doc: Lenght of filename - id: name_offset type: u4 doc: Filename offset in name array instances: name: io: _root._io pos: name_offset + _parent.nametable_offset type: str encoding: cp1251 size: name_len doc: File name data: io: _root._io pos: file_offset size: file_size doc: Content of file</code> </pre> </div></div><br><blockquote>  <strong>Isso √© interessante:</strong> na vers√£o russa do jogo, o arquivo Speech.res cont√©m dois subdiret√≥rios s e t com conte√∫do completamente id√™ntico, e √© por isso que o tamanho do arquivo √© duas vezes maior - e √© por isso que o jogo n√£o cabe em um CD. </blockquote><p>  Agora voc√™ pode descompactar todos os arquivos (pode ser aninhado): </p><br><ul><li>  RES √© apenas um arquivo, </li><li>  MPR - cen√°rio de n√≠veis de jogo, </li><li>  MQ - informa√ß√µes sobre as tarefas do multiplayer, </li><li>  ANM - um conjunto de anima√ß√µes, </li><li>  MOD - modelo 3d, </li><li>  BON - a localiza√ß√£o dos ossos do modelo. </li></ul><br><p>  Se os arquivos dentro do arquivo morto n√£o tiverem uma extens√£o, colocaremos a extens√£o pai - nos arquivos BON e ANM. </p><br><p>  Voc√™ tamb√©m pode dividir todos os arquivos recebidos em quatro grupos: </p><br><ol><li>  Texturas </li><li>  Bases de dados </li><li>  Modelos </li><li>  Arquivos de n√≠vel. </li></ol><br><p>  Vamos come√ßar com o simples - com as texturas. </p><br><h2 id="mmp">  MMP </h2><br><p>  Na verdade, a textura.  Possui um cabe√ßalho pequeno, indicando os par√¢metros da imagem, o n√∫mero de n√≠veis de MIP e a compacta√ß√£o usada.  Ap√≥s o cabe√ßalho, est√£o os n√≠veis de imagem MIP em ordem decrescente de tamanho. </p><br><p><img src="https://habrastorage.org/webt/a7/1s/-r/a71s-rtar5cg6ipi53n86bbsxps.png"></p><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o da estrutura</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: mmp title: Evil Islands, MMP file (texture) application: Evil Islands file-extension: mmp license: MIT endian: le doc: MIP-mapping texture seq: - id: magic contents: [0x4D, 0x4D, 0x50, 0x00] doc: Magic bytes - id: width type: u4 doc: Texture width - id: height type: u4 doc: Texture height - id: mip_levels_count type: u4 doc: Number of MIP-mapping stored levels - id: fourcc type: u4 enum: pixel_formats doc: FourCC label of pixel format - id: bits_per_pixel type: u4 doc: Number of bits per pixel - id: alpha_format type: channel_format doc: Description of alpha bits - id: red_format type: channel_format doc: Description of red bits - id: green_format type: channel_format doc: Description of green bits - id: blue_format type: channel_format doc: Description of blue bits - id: unused size: 4 doc: Empty space - id: base_texture type: switch-on: fourcc cases: 'pixel_formats::argb4': block_custom 'pixel_formats::dxt1': block_dxt1 'pixel_formats::dxt3': block_dxt3 'pixel_formats::pnt3': block_pnt3 'pixel_formats::r5g6b5': block_custom 'pixel_formats::a1r5g5b5': block_custom 'pixel_formats::argb8': block_custom _: block_custom types: block_pnt3: seq: - id: raw size: _root.bits_per_pixel block_dxt1: seq: - id: raw size: _root.width * _root.height &gt;&gt; 1 block_dxt3: seq: - id: raw size: _root.width * _root.height block_custom: seq: - id: lines type: line_custom repeat: expr repeat-expr: _root.height types: line_custom: seq: - id: pixels type: pixel_custom repeat: expr repeat-expr: _root.width types: pixel_custom: seq: - id: raw type: switch-on: _root.bits_per_pixel cases: 8: u1 16: u2 32: u4 instances: alpha: value: '_root.alpha_format.count == 0 ? 255 : 255 * ((raw &amp; _root.alpha_format.mask) &gt;&gt; _root.alpha_format.shift) / (_root.alpha_format.mask &gt;&gt; _root.alpha_format.shift)' red: value: '255 * ((raw &amp; _root.red_format.mask) &gt;&gt; _root.red_format.shift) / (_root.red_format.mask &gt;&gt; _root.red_format.shift)' green: value: '255 * ((raw &amp; _root.green_format.mask) &gt;&gt; _root.green_format.shift) / (_root.green_format.mask &gt;&gt; _root.green_format.shift)' blue: value: '255 * ((raw &amp; _root.blue_format.mask) &gt;&gt; _root.blue_format.shift) / (_root.blue_format.mask &gt;&gt; _root.blue_format.shift)' channel_format: doc: Description of bits for color channel seq: - id: mask type: u4 doc: Binary mask for channel bits - id: shift type: u4 doc: Binary shift for channel bits - id: count type: u4 doc: Count of channel bits enums: pixel_formats: 0x00004444: argb4 0x31545844: dxt1 0x33545844: dxt3 0x33544E50: pnt3 0x00005650: r5g6b5 0x00005551: a1r5g5b5 0x00008888: argb8</code> </pre> </div></div><br><p>  Poss√≠veis formatos de embalagem de pixel: </p><br><table><thead><tr><th>  fourcc </th><th>  Descri√ß√£o do produto </th></tr></thead><tbody><tr><td>  44 44 00 00 </td><td>  ARGB4 </td></tr><tr><td>  44 58 54 31 </td><td>  Dxt1 </td></tr><tr><td>  44 58 54 33 </td><td>  Dxt3 </td></tr><tr><td>  50 4E 54 33 </td><td>  PNT3 - ARGB8 comprimido por RLE </td></tr><tr><td>  50 56 00 00 </td><td>  R5G5B5 </td></tr><tr><td>  51 55 00 00 </td><td>  A1R5G5B5 </td></tr><tr><td>  88 88 00 00 </td><td>  ARGB8 </td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">Sobre o PNT3</b> <div class="spoiler_text"><p>  Se o formato da imagem for <strong>PNT3</strong> , a estrutura de pixels ap√≥s a descompacta√ß√£o √© ARGB8;  <code>bits_per_pixel</code> - tamanho da imagem compactada em bytes. </p><br><h4 id="raspakovka-pnt3">  Desembalando o PNT3 </h4><br><pre> <code class="python hljs">n = <span class="hljs-number"><span class="hljs-number">0</span></span> destination = <span class="hljs-string"><span class="hljs-string">b""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> src &lt; size: v = int.from_bytes(source[src:src + <span class="hljs-number"><span class="hljs-number">4</span></span>], byteorder=<span class="hljs-string"><span class="hljs-string">'little'</span></span>) src += <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v &gt; <span class="hljs-number"><span class="hljs-number">1000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> v == <span class="hljs-number"><span class="hljs-number">0</span></span>: n += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: destination += source[src - (<span class="hljs-number"><span class="hljs-number">1</span></span> + n) * <span class="hljs-number"><span class="hljs-number">4</span></span>:src - <span class="hljs-number"><span class="hljs-number">4</span></span>] destination += <span class="hljs-string"><span class="hljs-string">b"\x00"</span></span> * v n = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> </div></div><br><blockquote>  <strong>Isso √© interessante:</strong> algumas das texturas s√£o refletidas verticalmente (ou algumas n√£o s√£o refletidas?). <br>  E o jogo tem muita inveja da transpar√™ncia - se a imagem estiver em um canal alfa, a cor dos pixels transparentes deve ser exatamente preta.  Ou branco - que sorte. </blockquote><p>  Formatos simples terminaram, vamos para os mais r√≠gidos - ao mesmo tempo, as fileiras dos fabricantes de mods furiosamente mantiveram suas pr√≥prias ferramentas de edi√ß√£o para os seguintes formatos, e n√£o em v√£o.  Eu te avisei. </p><br><h2 id="bazy-dannyh-db-i-izhe-s-nimi">  Bancos de dados (* DB e outros) </h2><br><p>  Esse formato √© extremamente inconveniente para descrever - em ess√™ncia, √© uma √°rvore serializada de n√≥s (ou tabelas de registros).  Um arquivo consiste em v√°rias tabelas com os tipos de campo especificados.  Estrutura geral: as tabelas s√£o aninhadas em um n√≥ "raiz" comum, os registros s√£o n√≥s dentro de uma tabela. </p><br><p>  Em cada n√≥, seu tipo e tamanho s√£o especificados: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> type_index; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> raw_size; <span class="hljs-comment"><span class="hljs-comment">//      unsigned length; //     read(raw_size); if (raw_size &amp; 1) { length = raw_size &gt;&gt; 1; for (int i = 0; i &lt; 3; i++) length &lt;&lt;= 8; read(raw_size); length += raw_size; } else length = raw_size &gt;&gt; 1;</span></span></code> </pre> <br><p>  O tipo do campo da tabela √© obtido pelo √≠ndice a partir da string de formato da tabela, o tipo real √© determinado pelo valor obtido. </p><br><div class="spoiler">  <b class="spoiler_title">Tipos de campo</b> <div class="spoiler_text"><table><thead><tr><th>  designa√ß√£o </th><th>  a descri√ß√£o </th></tr></thead><tbody><tr><td>  S </td><td>  corda </td></tr><tr><td>  Eu </td><td>  4b int </td></tr><tr><td>  U </td><td>  4b n√£o assinado </td></tr><tr><td>  F </td><td>  4b float </td></tr><tr><td>  X </td><td>  bits byte </td></tr><tr><td>  f </td><td>  matriz flutuante </td></tr><tr><td>  eu </td><td>  matriz int </td></tr><tr><td>  B </td><td>  bool </td></tr><tr><td>  b </td><td>  matriz bool </td></tr><tr><td>  H </td><td>  bytes hexadecimais desconhecidos </td></tr><tr><td>  T </td><td>  tempo </td></tr><tr><td>  0 0 </td><td>  n√£o declarado </td></tr><tr><td>  1 </td><td> <code>0FII</code> </td> </tr><tr><td>  2 </td><td> <code>SUFF</code> </td> </tr><tr><td>  3 </td><td> <code>FFFF</code> </td> </tr><tr><td>  4 </td><td> <code>0SISS</code> </td> </tr><tr><td>  5 </td><td> <code>0SISS00000U</code> </td> </tr></tbody></table></div></div><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o das bases</b> <div class="spoiler_text"><h4 id="predmety-idb">  Itens (.idb) </h4><br><table><thead><tr><th>  mesa </th><th>  a estrutura </th></tr></thead><tbody><tr><td>  Materiais </td><td> <code>SSSIFFFIFIFfIX</code> </td> </tr><tr><td>  Arma </td><td> <code>SSISIIIFFFFIFIXB00000IHFFFfHHFF</code> </td> </tr><tr><td>  Armadura </td><td> <code>SSISIIIFFFFIFIXB00000ffBiHH</code> </td> </tr><tr><td>  Itens r√°pidos </td><td> <code>SSISIIIFFFFIFIXB00000IIFFSbH</code> </td> </tr><tr><td>  Itens de miss√£o </td><td> <code>SSISIIIFFFFIFIXB00000Is</code> </td> </tr><tr><td>  Venda de itens </td><td> <code>SSISIIIFFFFIFIXB00000IHI</code> </td> </tr></tbody></table><br><h4 id="pereklyuchateli-ldb">  Op√ß√µes (.ldb) </h4><br><table><thead><tr><th>  mesa </th><th>  a estrutura </th></tr></thead><tbody><tr><td>  Switch prototype </td><td> <code>SfIFTSSS</code> </td> </tr></tbody></table><br><h4 id="umeniya-i-navyki-pdb">  Habilidades e Habilidades (.pdb) </h4><br><table><thead><tr><th>  mesa </th><th>  a estrutura </th></tr></thead><tbody><tr><td>  Habilidades </td><td> <code>SSI0000000s</code> </td> </tr><tr><td>  Compet√™ncias </td><td> <code>SSI0000000SSIIIFFFIIIIBI</code> </td> </tr></tbody></table><br><h4 id="sledy-printsdb">  Pegadas (impress√µes.db) </h4><br><table><thead><tr><th>  mesa </th><th>  a estrutura </th></tr></thead><tbody><tr><td>  Vest√≠gios de sangue </td><td> <code>0S11</code> </td> </tr><tr><td>  Tra√ßos de chama </td><td> <code>0S110000001</code> </td> </tr><tr><td>  Pegadas </td><td> <code>0S11</code> </td> </tr></tbody></table><br><h4 id="zaklinaniya-sdb">  Feiti√ßos (.sdb) </h4><br><table><thead><tr><th>  mesa </th><th>  a estrutura </th></tr></thead><tbody><tr><td>  Prot√≥tipos </td><td> <code>SSSFIFIFFFFIIIIUSSIIbIXFFFFF</code> </td> </tr><tr><td>  Modificadores </td><td> <code>SSFIFFISX</code> </td> </tr><tr><td>  Padr√µes </td><td> <code>0SssSX</code> </td> </tr><tr><td>  Modelos de armaduras </td><td> <code>0SssSX</code> </td> </tr><tr><td>  Padr√µes de armas </td><td> <code>0SssSX</code> </td> </tr></tbody></table><br><h4 id="suschestva-udb">  Criaturas (.udb) </h4><br><table><thead><tr><th>  mesa </th><th>  a estrutura </th></tr></thead><tbody><tr><td>  Pe√ßas danificadas </td><td> <code>SffUU</code> </td> </tr><tr><td>  Ra√ßa </td><td> <code>SUFFUUFfFUUf222222000000000000SssFSsfUUfUUIUSBFUUUU</code> </td> </tr><tr><td>  Prot√≥tipos de monstros </td><td> <code>SSIUIFFFSFFFFFFFFFUFFFFFFff33sfssSFFFFFUFUSF</code> </td> </tr><tr><td>  Npc </td><td> <code>SUFFFFbbssssFUB</code> </td> </tr></tbody></table><br><h4 id="vykriki-acksdb">  Gritos (acks.db) </h4><br><table><thead><tr><th>  mesa </th><th>  a estrutura </th></tr></thead><tbody><tr><td>  As respostas </td><td> <code>0S0000000044444444444444444444445444444444444</code> </td> </tr><tr><td>  Gritos </td><td> <code>0S0000000044444</code> </td> </tr><tr><td>  Outros </td><td> <code>0S0000000044</code> </td> </tr></tbody></table><br><h4 id="zadaniya-qdb">  Miss√µes (.qdb) </h4><br><table><thead><tr><th>  mesa </th><th>  a estrutura </th></tr></thead><tbody><tr><td>  Miss√µes </td><td> <code>SFIISIIs</code> </td> </tr><tr><td>  Briefings </td><td> <code>SFFsSsssssI</code> </td> </tr></tbody></table></div></div><br><blockquote>  <strong>Isso √© interessante:</strong> 16 de janeiro de 2002 A Nival postou as bases de origem para o multiplayer no formato csv, bem como um conversor de utilidades no formato do jogo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://web.archive.org/web/20020610194020/">instant√¢neo do site</a> ).  Naturalmente, o conversor inverso n√£o demorou a aparecer.  Tamb√©m h√° pelo menos dois documentos descrevendo os campos e seus tipos dos modmakers, mas l√™-los √© muito dif√≠cil. </blockquote><br><h2 id="adb">  Adb </h2><br><p>  Banco de dados de anima√ß√£o para um tipo espec√≠fico de unidade.  Em contraste com o * DB mencionado acima, √© bastante "humano" - √© uma tabela de n√≠vel √∫nico com tamanhos de campo est√°tico. </p><br><p><img src="https://habrastorage.org/webt/vm/f4/jr/vmf4jr_3jtmqytycobxvurk7v2c.png"></p><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o da estrutura</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: adb title: Evil Islands, ADB file (animations database) application: Evil Islands file-extension: adb license: MIT endian: le doc: Animations database seq: - id: magic contents: [0x41, 0x44, 0x42, 0x00] doc: Magic bytes - id: animations_count type: u4 doc: Number of animations in base - id: unit_name type: str encoding: cp1251 size: 24 doc: Name of unit - id: min_height type: f4 doc: Minimal height of unit - id: mid_height type: f4 doc: Middle height of unit - id: max_height type: f4 doc: Maximal height of unit - id: animations type: animation doc: Array of animations repeat: expr repeat-expr: animations_count types: animation: doc: Animation's parameters seq: - id: name type: str encoding: cp1251 size: 16 doc: Animation's name - id: number type: u4 doc: Index in animations array - id: additionals type: additional doc: Packed structure with animation parameters - id: action_probability type: u4 doc: Percents of action probability - id: animation_length type: u4 doc: Lenght of animation in game ticks - id: movement_speed type: f4 doc: Movement speed - id: start_show_hide1 type: u4 - id: start_show_hide2 type: u4 - id: start_step_sound1 type: u4 - id: start_step_sound2 type: u4 - id: start_step_sound3 type: u4 - id: start_step_sound4 type: u4 - id: start_hit_frame type: u4 - id: start_special_sound type: u4 - id: spec_sound_id1 type: u4 - id: spec_sound_id2 type: u4 - id: spec_sound_id3 type: u4 - id: spec_sound_id4 type: u4 types: additional: seq: - id: packed type: u8 instances: weapons: value: 'packed &amp; 127' allowed_states: value: '(packed &gt;&gt; 15) &amp; 7' action_type: value: '(packed &gt;&gt; 18) &amp; 15' action_modifyer: value: '(packed &gt;&gt; 22) &amp; 255' animation_stage: value: '(packed &gt;&gt; 30) &amp; 3' action_forms: value: '(packed &gt;&gt; 36) &amp; 63'</code> </pre> </div></div><br><blockquote>  <strong>Isso √© interessante:</strong> para v√°rias unidades, √© usado um formato de banco de dados parcialmente truncado, que dificilmente foi explorado. </blockquote><p>  Tendo lidado com os bancos de dados, declaramos uma quebra de publicidade.  Mas n√£o anunciaremos nada - n√£o nosso m√©todo.  Melhor indicar o que ser√° √∫til a seguir - como os arquivos de criaturas s√£o nomeados. </p><br><h2 id="format-imyon-modeley">  Formato do nome do modelo </h2><br><p>  O nome √© coletado de grupos de dois caracteres - abrevia√ß√µes do "n√≠vel" l√≥gico. <br>  Por exemplo, o personagem feminino n√£o ser√° <code>unhufe</code> - <code>Unit &gt; Human &gt; Female</code> e <code>initwesp</code> - <code>Inventory &gt; Item &gt; Weapon &gt; Spear</code> , ou seja, uma lan√ßa no invent√°rio (n√£o nas costas, e isso √© bom). </p><br><div class="spoiler">  <b class="spoiler_title">√Årvore completa dos elementos do nome:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">un: # unit an: # animal wi: # wild ti # tiger ba # bat bo # boar hy # hyen de # deer gi # rat ra # rat cr # crawler wo # wolf ho: # home co # cow pi # pig do # dog ho # horse ha # hare or: # orc fe # female ma # male mo: # monster co # column (menu) un # unicorn cu # Curse be # beholder tr # troll el # elemental su # succub (harpie) ba # banshee dr # driad sh # shadow li # lizard sk # skeleton sp # spider go # golem, goblin ri # Rick og # ogre zo # zombie bi # Rik's dragon cy # cyclope dg # dragon wi # willwisp mi # octopus to # toad hu: # human fe # female ma # male in: # inventory it: # item qu # quest qi # interactive ar: # armor pl # plate gl # gloves lg # leggins bt # boots sh # shirt hl # helm pt # pants li: # loot mt # material tr # trade we: # weapon hm # hammer dg # dagger sp # spear cb # crossbow sw # sword ax # axe bw # bow gm # game menu fa: # faces un: # unit an: # animal wi: # wild ti: # tiger face # face ba: # bat face # face bo: # boar face # face de: # deer face # face ra: # rat face # face cr: # crawler face # face wo: # wolf face # face ho: # home co: # cow face # face pi: # pig face # face do: # dog face # face ho: # horse face # face ha: # hare face # face hu: # human fe: # female fa # me # th # ma: # male fa # me # th # mo: # monster to: # toad face # face tr: # troll face # face or: # orc face # face sp: # spider face # face li: # lizard face # face na: # nature fl: # flora bu # bush te # termitary tr # tree li # waterplant wa # waterfall sk # sky st # stone ef: # effects cu # ar # co # components st: # static si # switch bu: # building to # tower ho # house tr # trap br # bridge ga # gate we # well (waterhole) wa: # wall me # medium li # light to # torch st # static</code> </pre> </div></div><br><blockquote>  <strong>Isso √© interessante: de</strong> acordo com essa classifica√ß√£o, cogumelos s√£o √°rvores, golens com goblins s√£o irm√£os e Tka-Rick √© um monstro.  Tamb√©m aqui voc√™ pode ver os nomes "de trabalho" dos monstros, suspeitosamente semelhantes aos de D&amp;D - observador (olho mau), succub (harpia), ogro (canibal), driad (silvicultores). </blockquote><p>  Tendo descansado moralmente, mergulhamos de cabe√ßa no modelo.  Eles s√£o apresentados em v√°rios formatos vinculados. </p><br><h2 id="lnk">  Lnk </h2><br><p>  Logicamente - a base do modelo.  Descreve a hierarquia de partes do modelo, em termos da modelagem 3D moderna - a hierarquia dos ossos. </p><br><p><img src="https://habrastorage.org/webt/we/va/a1/wevaa186p5bq4fvw8-4vtxbfiju.png"></p><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o da estrutura</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: lnk title: Evil Islands, LNK file (bones hierarchy) application: Evil Islands file-extension: lnk license: MIT endian: le doc: Bones hierarchy seq: - id: bones_count type: u4 doc: Number of bones - id: bones_array type: bone repeat: expr repeat-expr: bones_count doc: Array of bones types: bone: doc: Bone node seq: - id: bone_name_len type: u4 doc: Length of bone's name - id: bone_name type: str encoding: cp1251 size: bone_name_len doc: Bone's name - id: parent_name_len type: u4 doc: Length of bone's parent name - id: parent_name type: str encoding: cp1251 size: parent_name_len doc: Bone's parent name</code> </pre> </div></div><br><p>  O nome do pai do osso pai √© uma sequ√™ncia vazia (comprimento 0). </p><br><p>  Existem ossos, no entanto, n√£o √© suficiente nome√°-los e junt√°-los - voc√™ precisa mont√°-los em um esqueleto. </p><br><h2 id="bon">  Bon </h2><br><p>  Mencionado anteriormente, esse formato (se n√£o for um arquivo morto) define a posi√ß√£o das partes (ossos) do modelo em rela√ß√£o √† parte pai.  Somente o deslocamento √© armazenado, sem rota√ß√£o - uma das diferen√ßas dos formatos modernos. </p><br><p><img src="https://habrastorage.org/webt/rq/f0/nt/rqf0ntdd5sxadr0us5gfq5cfq2g.png"></p><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o da estrutura</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: bon title: Evil Islands, BON file (bone position) application: Evil Islands file-extension: bon license: MIT endian: le doc: Bone position seq: - id: position type: vec3 doc: Bone translation repeat: eos types: vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis</code> </pre> </div></div><br><p>  Como voc√™ pode ver, h√° muitos n√∫meros para uma mudan√ßa - o fato √© que aqui encontramos um dos principais recursos do mecanismo de jogo - a interpola√ß√£o trilinear de modelos. </p><br><p>  Como funciona: o modelo possui tr√™s par√¢metros de interpola√ß√£o - condicionalmente, for√ßa, destreza, crescimento.  Existem tamb√©m 8 estados extremos do modelo.  Usando os par√¢metros, podemos obter o modelo final por interpola√ß√£o trilinear. </p><br><div class="spoiler">  <b class="spoiler_title">O pr√≥prio algoritmo</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trilinear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val, coefs=[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Linear interpolation by str t1 = val[0] + (val[1] - val[0]) * coefs[1] t2 = val[2] + (val[3] - val[2]) * coefs[1] # Bilinear interpolation by dex v1 = t1 + (t2 - t1) * coefs[0] # Linear interpolation by str t1 = val[4] + (val[5] - val[4]) * coefs[1] t2 = val[6] + (val[7] - val[6]) * coefs[1] # Bilinear interpolation by dex v2 = t1 + (t2 - t1) * coefs[0] # Trilinear interpolation by height return v1 + (v2 - v1) * coefs[2]</span></span></code> </pre> </div></div><br><blockquote>  <strong>Isso √© interessante: a</strong> interpola√ß√£o de modelo trilinear √© usada para animar alguns objetos, por exemplo, abrir uma porta de pedra e ba√∫s. </blockquote><p>  Agora √© a hora de examinar as partes do modelo em si. </p><br><h2 id="fig">  FIG </h2><br><p>  Talvez este com√≠cio seja imposs√≠vel de entender.  Voc√™ pode encontrar sua descri√ß√£o e o plug-in do liquidificador na rede, mas mesmo com eles a conscientiza√ß√£o n√£o vem imediatamente.  D√™ uma olhada: </p><br><p><img src="https://habrastorage.org/webt/c_/yx/bu/c_yxbuglpgn1h0j2g48gc1lk1dw.png"></p><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o da estrutura</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: fig title: Evil Islands, FIG file (figure) application: Evil Islands file-extension: fig license: MIT endian: le doc: 3d mesh seq: - id: magic contents: [0x46, 0x49, 0x47, 0x38] doc: Magic bytes - id: vertex_count type: u4 doc: Number of vertices blocks - id: normal_count type: u4 doc: Number of normals blocks - id: texcoord_count type: u4 doc: Number of UV pairs - id: index_count type: u4 doc: Number of indeces - id: vertex_components_count type: u4 doc: Number of vertex components - id: morph_components_count type: u4 doc: Number of morphing components - id: unknown contents: [0, 0, 0, 0] doc: Unknown (aligment) - id: group type: u4 doc: Render group - id: texture_index type: u4 doc: Texture offset - id: center type: vec3 doc: Center of mesh repeat: expr repeat-expr: 8 - id: aabb_min type: vec3 doc: AABB point of mesh repeat: expr repeat-expr: 8 - id: aabb_max type: vec3 doc: AABB point of mesh repeat: expr repeat-expr: 8 - id: radius type: f4 doc: Radius of boundings repeat: expr repeat-expr: 8 - id: vertex_array type: vertex_block doc: Blocks of raw vertex data repeat: expr repeat-expr: 8 - id: normal_array type: vec4x4 doc: Packed normal data repeat: expr repeat-expr: normal_count - id: texcoord_array type: vec2 doc: Texture coordinates data repeat: expr repeat-expr: texcoord_count - id: index_array type: u2 doc: Triangles indeces repeat: expr repeat-expr: index_count - id: vertex_components_array type: vertex_component doc: Vertex components array repeat: expr repeat-expr: vertex_components_count - id: morph_components_array type: morph_component doc: Morphing components array repeat: expr repeat-expr: morph_components_count types: morph_component: doc: Morphing components indeces seq: - id: morph_index type: u2 doc: Index of morphing data - id: vertex_index type: u2 doc: Index of vertex vertex_component: doc: Vertex components indeces seq: - id: position_index type: u2 doc: Index of position data - id: normal_index type: u2 doc: Index of normal data - id: texture_index type: u2 doc: Index of texcoord data vec2: doc: 2d vector seq: - id: u type: f4 doc: u axis - id: v type: f4 doc: v axis vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis vec3x4: doc: 3d vector with 4 values per axis seq: - id: x type: f4 doc: x axis repeat: expr repeat-expr: 4 - id: y type: f4 doc: y axis repeat: expr repeat-expr: 4 - id: z type: f4 doc: z axis repeat: expr repeat-expr: 4 vertex_block: doc: Vertex raw block seq: - id: block type: vec3x4 doc: Vertex data repeat: expr repeat-expr: _root.vertex_count vec4x4: doc: 4d vector with 4 values per axis seq: - id: x type: f4 doc: x axis repeat: expr repeat-expr: 4 - id: y type: f4 doc: y axis repeat: expr repeat-expr: 4 - id: z type: f4 doc: z axis repeat: expr repeat-expr: 4 - id: w type: f4 doc: w axis repeat: expr repeat-expr: 4</code> </pre> </div></div><br><p>  Qual √© a dificuldade?  Afinal, os dados de normais e v√©rtices s√£o armazenados em blocos de 4 e os v√©rtices tamb√©m s√£o organizados em 8 blocos para interpola√ß√£o. </p><br><blockquote>  <strong>Isso √© interessante:</strong> presumivelmente, esse agrupamento foi feito para acelerar o processamento com a ajuda das instru√ß√µes SSE que apareceram nos processadores Intel desde 1999. </blockquote><p>  Bem, lemos e compusemos o modelo, mas algo est√° faltando.  Exatamente - anima√ß√µes! </p><br><h2 id="anm">  Anm </h2><br><p>  A anima√ß√£o √© armazenada no formato de componente como estados principais.  Um fato interessante √© que ele suporta n√£o apenas a anima√ß√£o esquel√©tica, mas tamb√©m a transforma√ß√£o de v√©rtices. </p><br><p><img src="https://habrastorage.org/webt/i_/yb/lr/i_yblr5zy2irqqer1jqi6tm8v_c.png"></p><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o da estrutura</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: anm title: Evil Islands, ANM file (bone animation) application: Evil Islands file-extension: anm license: MIT endian: le doc: Bone animation seq: - id: rotation_frames_count type: u4 doc: Number of rotation frames - id: rotation_frames type: quat repeat: expr repeat-expr: rotation_frames_count doc: Bone rotations - id: translation_frames_count type: u4 doc: Number of translation frames - id: translation_frames type: vec3 repeat: expr repeat-expr: translation_frames_count doc: Bone translation - id: morphing_frames_count type: u4 doc: Number of morphing frames - id: morphing_vertex_count type: u4 doc: Number of vertices with morphing - id: morphing_frames type: morphing_frame repeat: expr repeat-expr: morphing_frames_count doc: Array of morphing frames types: vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis quat: doc: quaternion seq: - id: w type: f4 doc: w component - id: x type: f4 doc: x component - id: y type: f4 doc: y component - id: z type: f4 doc: z component morphing_frame: doc: Array of verteces morphing seq: - id: vertex_shift type: vec3 repeat: expr repeat-expr: _parent.morphing_vertex_count doc: Morphing shift per vertex</code> </pre> </div></div><br><p>  √â isso a√≠ - agora temos um modelo completo, voc√™ pode admirar o lagarto eremita rec√©m-renderizado: </p><br><p><img src="https://habrastorage.org/webt/bu/tk/sm/butksmbjbom_kgib93drtz9xvj8.jpeg"></p><br><div class="spoiler">  <b class="spoiler_title">Um momento de nostalgia</b> <div class="spoiler_text"><h4 id="uznat-chto-nuzhno-yascheru">  Descubra o que o Lizard precisa </h4><br><p>  <em>Conversa com o lagarto em sua casa</em> </p><br><p>  <strong>Lagarto eremita:</strong> Voc√™ veio, cara.  Isso √© bom </p><br><p>  <strong>Zach:</strong> Isso √© tudo que voc√™ queria me dizer? </p><br><p>  <strong>Hermit Lizard:</strong> Voc√™ est√° com pressa novamente.  Lembro de suas perguntas e vou respond√™-las.  Eu vim para as pessoas de ferro para fazer um acordo.  Mas eu vi como eles fizeram com voc√™.  Eles n√£o t√™m uma palavra, eu parei de acreditar neles.  Voc√™ manteve sua palavra.  Um acordo ser√° oferecido a voc√™. </p><br><p>  <strong>Lagarto eremita:</strong> As pessoas adoram ouro.  Lagartos de ouro s√£o desinteressantes.  Voc√™ completar√° minha tarefa e eu lhe darei o ouro que tenho.  H√° muito ouro. </p><br><p>  <strong>Zach <em>(pensativo e sem muito interesse)</em> :</strong> Hmm ... Ouro ... Certamente n√£o vai doer ... </p><br><p>  <strong>Zach:</strong> Seria melhor se voc√™ pudesse me ajudar a descobrir onde o velho mago que eu venho procurando h√° tanto tempo.  Afinal, os lagartos s√£o um povo antigo, e voc√™ pode conhec√™-lo! </p><br><p>  <strong>Hermit Lizard:</strong> Voc√™ est√° certo.  Lagartos s√£o um povo antigo.  Eu posso coletar tudo o que sabemos sobre o velho.  Voc√™ concorda em completar minha miss√£o? </p><br><p>  <strong>Zach:</strong> Que conversa!  Considere que tudo j√° foi feito. </p><br><p>  <strong>Lagarto eremita <em>(s√©rio)</em> :</strong> J√° terminou?  Voc√™ quer me enganar? </p><br><p>  <strong>Zach:</strong> Na verdade, eu queria fazer uma piada, caso contr√°rio voc√™ estava falando s√©rio. </p><br><p>  <strong>O Lagarto Eremita:</strong> Entendo.  Isso √© uma piada.  Acho que posso fazer uma piada tamb√©m.  Ent√£o  E agora preciso que voc√™ devolva a √°gua ao canal.  Orcs roubaram √°gua de n√≥s. </p><br><p>  <strong>Hermit Lizard:</strong> V√° para o sul ao longo da √°gua.  Voc√™ ver√° a barragem e o canal.  A barragem deve ser elevada.  Alavancagem.  Eu darei.  O canal precisa estar bloqueado.  A pedra  Eu n√£o vou dar uma pedra.  Ele j√° est√° na beira do canal.  Rio acima da barragem.  A pedra √© pesada.  Quando os orcs cavaram, eles o ergueram por um longo tempo.  Se voc√™ empurr√°-lo, ele voltar√° rapidamente. </p><br><p>  <strong>Hermit Lizard:</strong> Depois disso, volte.  Vou lhe contar tudo que aprender sobre o velho mago. </p><br><p>  <strong>Zach:</strong> M√£o na m√£o!  A prop√≥sito, se voc√™ adicionar um pouco de moedas √† hist√≥ria, n√£o ficarei ofendido. </p><br><p>  <strong>O lagarto eremita:</strong> Para moedas, v√° para meus parentes que vivem nas √°guas rasas mais ao sul.  V√° para a ilha mais distante, a terceira consecutiva.  Os tesouros ser√£o seus! </p><br><p>  <strong>Eremita Lagarto <em>(para si mesmo)</em> :</strong> Estranho.  Este homem adora humor.  Eu estava brincando.  O homem n√£o riu.  Muito estranho </p></div></div><br><p>  Agora - o mais interessante: como o mapa √© armazenado. </p><br><h2 id="mp">  MP </h2><br><p>  Este √© o arquivo de cabe√ßalho do mapa.  Devido a uma infeliz coincid√™ncia, a extens√£o coincide com a dos arquivos salvos para v√°rios jogadores, que n√£o consideraremos. </p><br><p>  Primeiro, voc√™ precisa fornecer uma descri√ß√£o geral da paisagem: </p><br><ul><li>  o n√∫mero de "peda√ßos" - peda√ßos do cart√£o 32x32 metros; </li><li>  altura m√°xima (uma vez que a altura dos v√©rtices √© armazenada em uma escala inteira); </li><li>  n√∫mero de atlas de ladrilhos. </li></ul><br><p>     ,     ‚Äî ,   . </p><br><p><img src="https://habrastorage.org/webt/rq/5a/zv/rq5azvlnywx7dynoartwivfelea.png"></p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: mp title: Evil Islands, MP file (map header) application: Evil Islands file-extension: mp license: MIT endian: le doc: Map header seq: - id: magic contents: [0x72, 0xF6, 0x4A, 0xCE] doc: Magic bytes - id: max_altitude type: f4 doc: Maximal height of terrain - id: x_chunks_count type: u4 doc: Number of sectors by x - id: y_chunks_count type: u4 doc: Number of sectors by y - id: textures_count type: u4 doc: Number of texture files - id: texture_size type: u4 doc: Size of texture in pixels by side - id: tiles_count type: u4 doc: Number of tiles - id: tile_size type: u4 doc: Size of tile in pixels by side - id: materials_count type: u2 doc: Number of materials - id: animated_tiles_count type: u4 doc: Number of animated tiles - id: materials type: material doc: Map materials repeat: expr repeat-expr: materials_count - id: id_array type: u4 doc: Tile type repeat: expr repeat-expr: tiles_count enum: tile_type - id: animated_tiles type: animated_tile doc: Animated tiles repeat: expr repeat-expr: animated_tiles_count types: material: doc: Material parameters seq: - id: type type: u4 doc: Material type by enum: terrain_type - id: color type: rgba doc: RGBA diffuse color - id: self_illumination type: f4 doc: Self illumination - id: wave_multiplier type: f4 doc: Wave speed multiplier - id: warp_speed type: f4 doc: Warp speed multiplier - id: unknown size: 12 types: rgba: doc: RGBA color seq: - id: r type: f4 doc: Red channel - id: g type: f4 doc: Green channel - id: b type: f4 doc: Blue channel - id: a type: f4 doc: Alpha channel enums: terrain_type: 0: base 1: water_notexture 2: grass 3: water animated_tile: doc: Animated tile parameters seq: - id: start_index type: u2 doc: First tile of animation - id: length type: u2 doc: Animation frames count enums: tile_type: 0: grass 1: ground 2: stone 3: sand 4: rock 5: field 6: water 7: road 8: empty 9: snow 10: ice 11: drygrass 12: snowballs 13: lava 14: swamp 15: highrock</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><table><thead><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tipo de terreno </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tipo </font></font></th></tr></thead><tbody><tr><td>  0 0 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Paisagem base </font></font></td></tr><tr><td>  1 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √Ågua sem textura </font></font></td></tr><tr><td>  2 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Grama texturizada </font></font></td></tr><tr><td>  3 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √Ågua texturizada </font></font></td></tr></tbody></table></div></div><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><table><thead><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tipo de material </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tipo </font></font></th></tr></thead><tbody><tr><td>  0 0 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> grama </font></font></td></tr><tr><td>  1 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ch√£o </font></font></td></tr><tr><td>  2 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pedra </font></font></td></tr><tr><td>  3 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> areia </font></font></td></tr><tr><td>  4 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rock </font></font></td></tr><tr><td>  5 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> campo </font></font></td></tr><tr><td>  6 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agua </font></font></td></tr><tr><td>  7 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estrada </font></font></td></tr><tr><td>  8 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (vazio) </font></font></td></tr><tr><td>  9 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> neve </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gelo </font></font></td></tr><tr><td>  11 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erva seca </font></font></td></tr><tr><td>  12 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bolas de neve </font></font></td></tr><tr><td>  13 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lava </font></font></td></tr><tr><td>  14 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> p√¢ntano </font></font></td></tr><tr><td>  15 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> highrock </font></font></td></tr></tbody></table></div></div><br><p>      ,      <code>Res/aiinfo.res/tileDesc.reg</code> . </p><br><blockquote> <strong> :</strong>     ,   ‚Äî       . <br>   :       . </blockquote><p>       .  ! </p><br><h2 id="sec"> SEC </h2><br><p>      ‚Äî  3232 .       ,    <code>ZonenameXXXYYY</code> . </p><br><p><img src="https://habrastorage.org/webt/9-/pd/_l/9-pd_ltybkk7hx_oywo4wsfwrpc.png"></p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: sec title: Evil Islands, SEC file (map sector) application: Evil Islands file-extension: sec license: MIT endian: le doc: Map sector seq: - id: magic contents: [0x74, 0xF7, 0x4B, 0xCF] doc: Magic bytes - id: liquids type: u1 doc: Liquids layer indicator - id: vertexes type: vertex doc: Vertex array 33x33 repeat: expr repeat-expr: 1089 - id: liquid_vertexes type: vertex doc: Vertex array 33x33 if: liquids != 0 repeat: expr repeat-expr: 'liquids != 0 ? 1089 : 0' - id: tiles type: tile doc: Tile array 16x16 repeat: expr repeat-expr: 256 - id: liquid_tiles type: tile doc: Tile array 16x16 if: liquids != 0 repeat: expr repeat-expr: 'liquids != 0 ? 256 : 0' - id: liquid_material type: u2 doc: Index of material if: liquids != 0 repeat: expr repeat-expr: 'liquids != 0 ? 256 : 0' types: vertex: doc: Vertex data seq: - id: x_shift type: s1 doc: Shift by x axis - id: y_shift type: s1 doc: Shift by y axis - id: altitude type: u2 doc: Height (z position) - id: packed_normal type: normal doc: Packed normal normal: doc: Normal (3d vector) seq: - id: packed type: u4 doc: Normal packed in 4b instances: x: doc: Unpacked x component value: packed &gt;&gt; 11 &amp; 0x7FF y: doc: Unpacked y component value: packed &amp; 0x7FF z: doc: Unpacked z component value: packed &gt;&gt; 22 tile: doc: Tile parameters seq: - id: packed type: u2 doc: Tile information packed in 2b instances: index: doc: Tile index in texture value: packed &amp; 63 texture: doc: Texture index value: packed &gt;&gt; 6 &amp; 255 rotation: doc: Tile rotation (*90 degrees) value: packed &gt;&gt; 14 &amp; 3</code> </pre> </div></div><br><p>      ‚Äî       . </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><h4 id="raspakovka-normali"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Desembalagem normal </font></font></h4><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10 bits por eixo z, 11 por x e y </font></font></p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> packed_normal; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)((packed_normal &gt;&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x7FF</span></span>) - <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>) / <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(packed_normal &amp; <span class="hljs-number"><span class="hljs-number">0x7FF</span></span>) - <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>) / <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(packed_normal &gt;&gt; <span class="hljs-number"><span class="hljs-number">22</span></span>) / <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>;</code> </pre> <br><h4 id="informaciya-o-teksture"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Informa√ß√µes de textura </font></font></h4><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6 bits por √≠ndice no atlas, 8 por n√∫mero de textura, 2 por rota√ß√£o </font></font></p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> texture; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> tile_index = f &amp; <span class="hljs-number"><span class="hljs-number">63</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> texture_index = (f &gt;&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> rotation = (f &gt;&gt; <span class="hljs-number"><span class="hljs-number">14</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title"> 3d </b> <div class="spoiler_text"><h4 id="poluchenie-landshafta"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Obtendo paisagem </font></font></h4><br><p>    33   33 ,  ,  3232 .     ‚Äî 1  . </p><br><p>  : <br> x =   x + x_offset / 254 <br> y =   y + y_offset / 254 <br> z = altitude / 65535 * max_altitude ( .mp ) </p><br><p>     "",       : </p><br><pre> <code class="plaintext hljs"> 0 1 2 *-*-* |\|\| ~ 33 *-*-* |\|\| ~ 66 *-*-* ~ ~ ~</code> </pre> <br><p>       ,  , 1616 .   ‚Äî 2  .      ,  90 . </p></div></div><br><p>        .   ,     ,     ID  ,       MP . </p><br><blockquote> <strong> :</strong>    MP,     ,       :  ID     , -     . <br>  ID       ‚Äî         . </blockquote><p>  ‚Äî      : </p><br><p><img src="https://habrastorage.org/webt/so/88/c6/so88c6ufcpzn1cqhxc7orbzeif4.jpeg"></p><br><p>   - ‚Äî    ,         . </p><br><h2 id="mob"> MOB </h2><br><p>    ( )   ,     ,     :   .           ‚Äî    " ",     . <br>         ,    (    ). </p><br><p>   : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> structure { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> type_id; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> size; byte data[size - <span class="hljs-number"><span class="hljs-number">8</span></span>]; } node;</code> </pre> <br><div class="spoiler"> <b class="spoiler_title">  (,   !)</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/hf/jd/yi/hfjdyiujzmtzizewv5i86pmjil0.png"></p><br><p>   ( , ) </p><br><pre> <code class="plaintext hljs">meta: id: mob title: Evil Islands, MOB file (map entities) application: Evil Islands file-extension: mob license: MIT endian: le doc: Map entities tree seq: - id: root_node type: node doc: Root node types: node: doc: Entity node seq: - id: type_id type: u4 doc: Node children type ID - id: size type: u4 doc: Node full size - id: data type: node_data size: size - 8 doc: Node stored data node_data: doc: Node data seq: - id: value type: switch-on: _parent.type_id cases: 0xA000: node 0x00001E00: node 0x00001E01: node 0x00001E02: node 0x00001E03: node 0x00001E0B: node 0x00001E0E: node 0x0000A000: node 0x0000AA01: node 0x0000ABD0: node 0x0000B000: node 0x0000B001: node 0x0000CC01: node 0x0000DD01: node 0x0000E000: node 0x0000E001: node 0x0000F000: node 0x0000FF00: node 0x0000FF01: node 0x0000FF02: node 0xBBAB0000: node 0xBBAC0000: node 0xBBBB0000: node 0xBBBC0000: node 0xBBBD0000: node 0xBBBE0000: node 0xBBBF0000: node 0xDDDDDDD1: node _: u1 doc: Node elements repeat: eos</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><table><thead><tr><th>   </th><th>  () </th><th>  </th></tr></thead><tbody><tr><td> AiGraph </td><td></td><td>   </td></tr><tr><td> AreaArray </td><td></td><td></td></tr><tr><td> Byte </td><td>  1 </td><td> 1   </td></tr><tr><td> Diplomacy </td><td> 4096 </td><td> 32x32   2  </td></tr><tr><td> Dword </td><td>  4 </td><td> 4   </td></tr><tr><td>  Flutuar </td><td>  4 </td><td> 4  </td></tr><tr><td> LeverStats </td><td>  12 </td><td>   </td></tr><tr><td> Null </td><td>  0 0 </td><td>   </td></tr><tr><td> Plot </td><td>  12 </td><td> 3 floats (vec3) </td></tr><tr><td> Plot2DArray </td><td></td><td></td></tr><tr><td> Quaternion </td><td>  16 </td><td> 4 floats (vec4) </td></tr><tr><td> Record </td><td> &gt;8 </td><td>   </td></tr><tr><td> Rectangle </td><td></td><td></td></tr><tr><td>  String </td><td></td><td>  </td></tr><tr><td> StringArray </td><td> &gt;4 </td><td>   </td></tr><tr><td> StringEncrypted </td><td> &gt;4 </td><td>    </td></tr><tr><td> UnitStats </td><td>  180 </td><td>   </td></tr><tr><td> Unknown </td><td></td><td></td></tr></tbody></table></div></div><br><div class="spoiler"> <b class="spoiler_title">  type_id</b> <div class="spoiler_text"><table><thead><tr><th> type_id </th><th>   </th><th>   </th></tr></thead><tbody><tr><td> 0x00000000 </td><td> Record </td><td> ROOT </td></tr><tr><td> 0x00001E00 </td><td> Record </td><td> VSS_SECTION </td></tr><tr><td> 0x00001E01 </td><td> Record </td><td> VSS_TRIGER </td></tr><tr><td> 0x00001E02 </td><td> Record </td><td> VSS_CHECK </td></tr><tr><td> 0x00001E03 </td><td> Record </td><td> VSS_PATH </td></tr><tr><td> 0x00001E04 </td><td> Dword </td><td> VSS_ID </td></tr><tr><td> 0x00001E05 </td><td> Rectangle </td><td> VSS_RECT </td></tr><tr><td> 0x00001E06 </td><td> Dword </td><td> VSS_SRC_ID </td></tr><tr><td> 0x00001E07 </td><td> Dword </td><td> VSS_DST_ID </td></tr><tr><td> 0x00001E08 </td><td>  String </td><td> VSS_TITLE </td></tr><tr><td> 0x00001E09 </td><td>  String </td><td> VSS_COMMANDS </td></tr><tr><td> 0x00001E0A </td><td> Byte </td><td> VSS_ISSTART </td></tr><tr><td> 0x00001E0B </td><td> Record </td><td> VSS_LINK </td></tr><tr><td> 0x00001E0C </td><td>  String </td><td> VSS_GROUP </td></tr><tr><td> 0x00001E0D </td><td> Byte </td><td> VSS_IS_USE_GROUP </td></tr><tr><td> 0x00001E0E </td><td> Record </td><td> VSS_VARIABLE </td></tr><tr><td> 0x00001E0F </td><td> StringArray </td><td> VSS_BS_CHECK </td></tr><tr><td> 0x00001E10 </td><td> StringArray </td><td> VSS_BS_COMMANDS </td></tr><tr><td> 0x00001E11 </td><td>  String </td><td> VSS_CUSTOM_SRIPT </td></tr><tr><td> 0x0000A000 </td><td> Record </td><td> OBJECTDBFILE </td></tr><tr><td> 0x0000AA00 </td><td> Null </td><td> LIGHT_SECTION </td></tr><tr><td> 0x0000AA01 </td><td> Record </td><td> LIGHT </td></tr><tr><td> 0x0000AA02 </td><td>  Flutuar </td><td> LIGHT_RANGE </td></tr><tr><td> 0x0000AA03 </td><td>  String </td><td> LIGHT_NAME </td></tr><tr><td> 0x0000AA04 </td><td> Plot </td><td> LIGHT_POSITION </td></tr><tr><td> 0x0000AA05 </td><td> Dword </td><td> LIGHT_ID </td></tr><tr><td> 0x0000AA06 </td><td> Byte </td><td> LIGHT_SHADOW </td></tr><tr><td> 0x0000AA07 </td><td> Plot </td><td> LIGHT_COLOR </td></tr><tr><td> 0x0000AA08 </td><td>  String </td><td> LIGHT_COMMENTS </td></tr><tr><td> 0x0000ABD0 </td><td> Record </td><td> WORLD_SET </td></tr><tr><td> 0x0000ABD1 </td><td> Plot </td><td> WS_WIND_DIR </td></tr><tr><td> 0x0000ABD2 </td><td>  Flutuar </td><td> WS_WIND_STR </td></tr><tr><td> 0x0000ABD3 </td><td>  Flutuar </td><td> WS_TIME </td></tr><tr><td> 0x0000ABD4 </td><td>  Flutuar </td><td> WS_AMBIENT </td></tr><tr><td> 0x0000ABD5 </td><td>  Flutuar </td><td> WS_SUN_LIGHT </td></tr><tr><td> 0x0000B000 </td><td> Record </td><td> OBJECTSECTION </td></tr><tr><td> 0x0000B001 </td><td> Record </td><td> OBJECT </td></tr><tr><td> 0x0000B002 </td><td> Dword </td><td> NID </td></tr><tr><td> 0x0000B003 </td><td> Dword </td><td> OBJTYPE </td></tr><tr><td> 0x0000B004 </td><td>  String </td><td> OBJNAME </td></tr><tr><td> 0x0000B005 </td><td> Null </td><td> OBJINDEX </td></tr><tr><td> 0x0000B006 </td><td>  String </td><td> OBJTEMPLATE </td></tr><tr><td> 0x0000B007 </td><td>  String </td><td> OBJPRIMTXTR </td></tr><tr><td> 0x0000B008 </td><td>  String </td><td> OBJSECTXTR </td></tr><tr><td> 0x0000B009 </td><td> Plot </td><td> OBJPOSITION </td></tr><tr><td> 0x0000B00A </td><td> Quaternion </td><td> OBJROTATION </td></tr><tr><td> 0x0000B00B </td><td> Null </td><td> OBJTEXTURE </td></tr><tr><td> 0x0000B00C </td><td> Plot </td><td> OBJCOMPLECTION </td></tr><tr><td> 0x0000B00D </td><td> StringArray </td><td> OBJBODYPARTS </td></tr><tr><td> 0x0000B00E </td><td>  String </td><td> PARENTTEMPLATE </td></tr><tr><td> 0x0000B00F </td><td>  String </td><td> OBJCOMMENTS </td></tr><tr><td> 0x0000B010 </td><td> Null </td><td> OBJ_DEF_LOGIC </td></tr><tr><td> 0x0000B011 </td><td> Byte </td><td> OBJ_PLAYER </td></tr><tr><td> 0x0000B012 </td><td> Dword </td><td> OBJ_PARENT_ID </td></tr><tr><td> 0x0000B013 </td><td> Byte </td><td> OBJ_USE_IN_SCRIPT </td></tr><tr><td> 0x0000B014 </td><td> Byte </td><td> OBJ_IS_SHADOW </td></tr><tr><td> 0x0000B015 </td><td> Null </td><td> OBJ_R </td></tr><tr><td> 0x0000B016 </td><td>  String </td><td> OBJ_QUEST_INFO </td></tr><tr><td> 0x0000C000 </td><td> Null </td><td> SC_OBJECTDBFILE </td></tr><tr><td> 0x0000CC00 </td><td> Null </td><td> SOUND_SECTION </td></tr><tr><td> 0x0000CC01 </td><td> Record </td><td> SOUND </td></tr><tr><td> 0x0000CC02 </td><td> Dword </td><td> SOUND_ID </td></tr><tr><td> 0x0000CC03 </td><td> Plot </td><td> SOUND_POSITION </td></tr><tr><td> 0x0000CC04 </td><td> Dword </td><td> SOUND_RANGE </td></tr><tr><td> 0x0000CC05 </td><td>  String </td><td> SOUND_NAME </td></tr><tr><td> 0x0000CC06 </td><td> Dword </td><td> SOUND_MIN </td></tr><tr><td> 0x0000CC07 </td><td> Dword </td><td> SOUND_MAX </td></tr><tr><td> 0x0000CC08 </td><td>  String </td><td> SOUND_COMMENTS </td></tr><tr><td> 0x0000CC09 </td><td> Null </td><td> SOUND_VOLUME </td></tr><tr><td> 0x0000CC0A </td><td> StringArray </td><td> SOUND_RESNAME </td></tr><tr><td> 0x0000CC0B </td><td> Dword </td><td> SOUND_RANGE2 </td></tr><tr><td> 0x0000CC0D </td><td> Byte </td><td> SOUND_AMBIENT </td></tr><tr><td> 0x0000CC0E </td><td> Byte </td><td> SOUND_IS_MUSIC </td></tr><tr><td> 0x0000D000 </td><td> Null </td><td> PR_OBJECTDBFILE </td></tr><tr><td> 0x0000DD00 </td><td> Null </td><td> PARTICL_SECTION </td></tr><tr><td> 0x0000DD01 </td><td> Record </td><td> PARTICL </td></tr><tr><td> 0x0000DD02 </td><td> Dword </td><td> PARTICL_ID </td></tr><tr><td> 0x0000DD03 </td><td> Plot </td><td> PARTICL_POSITION </td></tr><tr><td> 0x0000DD04 </td><td>  String </td><td> PARTICL_COMMENTS </td></tr><tr><td> 0x0000DD05 </td><td>  String </td><td> PARTICL_NAME </td></tr><tr><td> 0x0000DD06 </td><td> Dword </td><td> PARTICL_TYPE </td></tr><tr><td> 0x0000DD07 </td><td>  Flutuar </td><td> PARTICL_SCALE </td></tr><tr><td> 0x0000E000 </td><td> Record </td><td> DIRICTORY </td></tr><tr><td> 0x0000E001 </td><td> Record </td><td> FOLDER </td></tr><tr><td> 0x0000E002 </td><td>  String </td><td> DIR_NAME </td></tr><tr><td> 0x0000E003 </td><td> Dword </td><td> DIR_NINST </td></tr><tr><td> 0x0000E004 </td><td> Dword </td><td> DIR_PARENT_FOLDER </td></tr><tr><td> 0x0000E005 </td><td> Byte </td><td> DIR_TYPE </td></tr><tr><td> 0x0000F000 </td><td> Record </td><td> DIRICTORY_ELEMENTS </td></tr><tr><td> 0x0000FF00 </td><td> Record </td><td> SEC_RANGE </td></tr><tr><td> 0x0000FF01 </td><td> Record </td><td> MAIN_RANGE </td></tr><tr><td> 0x0000FF02 </td><td> Record </td><td> RANGE </td></tr><tr><td> 0x0000FF05 </td><td> Dword </td><td> MIN_ID </td></tr><tr><td> 0x0000FF06 </td><td> Dword </td><td> MAX_ID </td></tr><tr><td> 0x31415926 </td><td> AiGraph </td><td> AIGRAPH </td></tr><tr><td> 0xACCEECCA </td><td>  String </td><td> SS_TEXT_OLD </td></tr><tr><td> 0xACCEECCB </td><td> StringEncrypted </td><td> SS_TEXT </td></tr><tr><td> 0xBBAB0000 </td><td> Record </td><td> MAGIC_TRAP </td></tr><tr><td> 0xBBAB0001 </td><td> Dword </td><td> MT_DIPLOMACY </td></tr><tr><td> 0xBBAB0002 </td><td>  String </td><td> MT_SPELL </td></tr><tr><td> 0xBBAB0003 </td><td> AreaArray </td><td> MT_AREAS </td></tr><tr><td> 0xBBAB0004 </td><td> Plot2DArray </td><td> MT_TARGETS </td></tr><tr><td> 0xBBAB0005 </td><td> Dword </td><td> MT_CAST_INTERVAL </td></tr><tr><td> 0xBBAC0000 </td><td> Record </td><td> LEVER </td></tr><tr><td> 0xBBAC0001 </td><td> Null </td><td> LEVER_SCIENCE_STATS </td></tr><tr><td> 0xBBAC0002 </td><td> Byte </td><td> LEVER_CUR_STATE </td></tr><tr><td> 0xBBAC0003 </td><td> Byte </td><td> LEVER_TOTAL_STATE </td></tr><tr><td> 0xBBAC0004 </td><td> Byte </td><td> LEVER_IS_CYCLED </td></tr><tr><td> 0xBBAC0005 </td><td> Byte </td><td> LEVER_CAST_ONCE </td></tr><tr><td> 0xBBAC0006 </td><td> LeverStats </td><td> LEVER_SCIENCE_STATS_NEW </td></tr><tr><td> 0xBBAC0007 </td><td> Byte </td><td> LEVER_IS_DOOR </td></tr><tr><td> 0xBBAC0008 </td><td> Byte </td><td> LEVER_RECALC_GRAPH </td></tr><tr><td> 0xBBBB0000 </td><td> Record </td><td> UNIT </td></tr><tr><td> 0xBBBB0001 </td><td> Null </td><td> UNIT_R </td></tr><tr><td> 0xBBBB0002 </td><td>  String </td><td> UNIT_PROTOTYPE </td></tr><tr><td> 0xBBBB0003 </td><td> Null </td><td> UNIT_ITEMS </td></tr><tr><td> 0xBBBB0004 </td><td> UnitStats </td><td> UNIT_STATS </td></tr><tr><td> 0xBBBB0005 </td><td> StringArray </td><td> UNIT_QUEST_ITEMS </td></tr><tr><td> 0xBBBB0006 </td><td> StringArray </td><td> UNIT_QUICK_ITEMS </td></tr><tr><td> 0xBBBB0007 </td><td> StringArray </td><td> UNIT_SPELLS </td></tr><tr><td> 0xBBBB0008 </td><td> StringArray </td><td> UNIT_WEAPONS </td></tr><tr><td> 0xBBBB0009 </td><td> StringArray </td><td> UNIT_ARMORS </td></tr><tr><td> 0xBBBB000A </td><td> Byte </td><td> UNIT_NEED_IMPORT </td></tr><tr><td> 0xBBBC0000 </td><td> Record </td><td> UNIT_LOGIC </td></tr><tr><td> 0xBBBC0001 </td><td> Null </td><td> UNIT_LOGIC_AGRESSIV </td></tr><tr><td> 0xBBBC0002 </td><td> Byte </td><td> UNIT_LOGIC_CYCLIC </td></tr><tr><td> 0xBBBC0003 </td><td> Dword </td><td> UNIT_LOGIC_MODEL </td></tr><tr><td> 0xBBBC0004 </td><td>  Flutuar </td><td> UNIT_LOGIC_GUARD_R </td></tr><tr><td> 0xBBBC0005 </td><td> Plot </td><td> UNIT_LOGIC_GUARD_PT </td></tr><tr><td> 0xBBBC0006 </td><td> Byte </td><td> UNIT_LOGIC_NALARM </td></tr><tr><td> 0xBBBC0007 </td><td> Byte </td><td> UNIT_LOGIC_USE </td></tr><tr><td> 0xBBBC0008 </td><td> Null </td><td> UNIT_LOGIC_REVENGE </td></tr><tr><td> 0xBBBC0009 </td><td> Null </td><td> UNIT_LOGIC_FEAR </td></tr><tr><td> 0xBBBC000A </td><td>  Flutuar </td><td> UNIT_LOGIC_WAIT </td></tr><tr><td> 0xBBBC000B </td><td> Byte </td><td> UNIT_LOGIC_ALARM_CONDITION </td></tr><tr><td> 0xBBBC000C </td><td>  Flutuar </td><td> UNIT_LOGIC_HELP </td></tr><tr><td> 0xBBBC000D </td><td> Byte </td><td> UNIT_LOGIC_ALWAYS_ACTIVE </td></tr><tr><td> 0xBBBC000E </td><td> Byte </td><td> UNIT_LOGIC_AGRESSION_MODE </td></tr><tr><td> 0xBBBD0000 </td><td> Record </td><td> GUARD_PT </td></tr><tr><td> 0xBBBD0001 </td><td> Plot </td><td> GUARD_PT_POSITION </td></tr><tr><td> 0xBBBD0002 </td><td> Null </td><td> GUARD_PT_ACTION </td></tr><tr><td> 0xBBBE0000 </td><td> Record </td><td> ACTION_PT </td></tr><tr><td> 0xBBBE0001 </td><td> Plot </td><td> ACTION_PT_LOOK_PT </td></tr><tr><td> 0xBBBE0002 </td><td> Dword </td><td> ACTION_PT_WAIT_SEG </td></tr><tr><td> 0xBBBE0003 </td><td> Dword </td><td> ACTION_PT_TURN_SPEED </td></tr><tr><td> 0xBBBE0004 </td><td> Byte </td><td> ACTION_PT_FLAGS </td></tr><tr><td> 0xBBBF0000 </td><td> Record </td><td> TORCH </td></tr><tr><td> 0xBBBF0001 </td><td>  Flutuar </td><td> TORCH_STRENGHT </td></tr><tr><td> 0xBBBF0002 </td><td> Plot </td><td> TORCH_PTLINK </td></tr><tr><td> 0xBBBF0003 </td><td>  String </td><td> TORCH_SOUND </td></tr><tr><td> 0xDDDDDDD1 </td><td> Record </td><td> DIPLOMATION </td></tr><tr><td> 0xDDDDDDD2 </td><td> Diplomacy </td><td> DIPLOMATION_FOF </td></tr><tr><td> 0xDDDDDDD3 </td><td> StringArray </td><td> DIPLOMATION_PL_NAMES </td></tr><tr><td> 0xFFFFFFFF </td><td> Unknown </td><td> UNKNOWN </td></tr></tbody></table></div></div><br><p>        ‚Äî ,    ,     Nival,    ‚Äî  ,     (  ,  ). </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> key; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { key += (((((key * <span class="hljs-number"><span class="hljs-number">13</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) + key) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) - key) * <span class="hljs-number"><span class="hljs-number">4</span></span> + <span class="hljs-number"><span class="hljs-number">2531011</span></span>; data[i] ^= key &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>; }</code> </pre> </div></div><br><blockquote> <strong> :</strong>      ,       (   )    .   ,      ,       ,       . </blockquote><p>      (  ,   ,    ‚Äî Windows 98): </p><br><p><img src="https://habrastorage.org/webt/8w/qv/gz/8wqvgzyxxuqmqremuny92irjzue.jpeg"></p><br><blockquote> <strong> :</strong>       ,     . ,        ( , ,  " :   ",     ). </blockquote><p>  ,     ,  -     -   , , Collada      : </p><br><p><img src="https://habrastorage.org/webt/l8/2i/tc/l82itcjm6orpd7hb0tp6p9rqq5y.jpeg"></p><br><h1 id="epilog">  </h1><br><p>          .      ,          <em> </em>   . </p><br><p>  ,            .     -   ,   ‚Äî -    ,      . , -... </p><br><p>     ‚Äî     ! </p><br><p> <strong>UPD (23.01.2019):</strong> <br>        ,             : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a> . <br>        ,          (,   ""      ). </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><h3 id="obschaya-informaciya-ob-igre">     </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://ru.nival.com/games/history/zemli</a> ‚Äî    </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://ru.wikipedia.org/wiki/_</a> ‚Äî    </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://allods.gipat.ru/index.php?p=ei</a> ‚Äî    " " </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://evil-islands.github.io</a> ‚Äî  ,     </li></ul><br><h3 id="instrumenty-s-otkrytymi-ishodnikami">     </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://gipatgroup.org/utilities</a> ‚Äî EiEdit (.res, .*db), MobSurgeon (.mob) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://svn.gipat.org/trac/GGWiki</a> ‚Äî EiEdit (.res, .*db), MobSurgeon (.mob),    .mp, .sec, .*db </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/demothorg/eifixer</a> ‚Äî     </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/konstvest/ei_figer</a> ‚Äî   Blender   .lnk, .fig, .bon, .anm </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/demothorg/ei-tools</a> ‚Äî       (.mob, .lnk, .mpr, .res) +   </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/konstvest/ei_maper</a> ‚Äî   (.mpr, .mp, .sec, .mob) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/chemmalion/EIDBEditor</a> ‚Äî     (.*db) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://gitlab.com/ykurganov/open-evil-islands</a> ‚Äî       ,      </li></ul><br><h3 id="kommyuniti">  </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://vk.com/evil.islands</a> ‚Äî   </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://allods.gipat.ru</a> ‚Äî " " </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://gipat.ru</a> ‚Äî  " " </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://gipatgroup.org/forum</a> ‚Äî  GipatGroup (   ‚Äî  ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://honestgroup.net/forum</a> ‚Äî  HonestGroup </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt434802/">https://habr.com/ru/post/pt434802/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt434792/index.html">Freelansim 2018: resultados do ano</a></li>
<li><a href="../pt434794/index.html">Soft-skills de um testador de sucesso</a></li>
<li><a href="../pt434796/index.html">Codificando a arte: como geramos gr√°ficos e anima√ß√£o em projetos de design</a></li>
<li><a href="../pt434798/index.html">Swagger - documenta√ß√£o inteligente para sua API da web RESTful - Revis√£o do desenvolvedor de back-end j√∫nior para iniciantes</a></li>
<li><a href="../pt434800/index.html">(5-2) Maneiras de migrar uma grande tabela SQL</a></li>
<li><a href="../pt434804/index.html">Robinhood, startup da Fintech, n√£o conseguiu lan√ßar um an√°logo de contas banc√°rias</a></li>
<li><a href="../pt434806/index.html">Desmonte de ano novo com uma canoa</a></li>
<li><a href="../pt434810/index.html">Starter para trabalhar com o Spring Cloud</a></li>
<li><a href="../pt434812/index.html">Gerenciamento de tempo do projeto</a></li>
<li><a href="../pt434816/index.html">Desintoxica√ß√£o e Appium: Teste de Interface Automatizado em React Native</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>