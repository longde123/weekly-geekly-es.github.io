<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©â€â¤ï¸â€ğŸ‘¨ ğŸ‘¨ğŸ¾â€ğŸš’ ğŸ¤§ Pengoperasian TA505: bagaimana kami menganalisis alat baru dari pencipta Trojan Dridex, Locky ransomware, dan botnet Neutrino ğŸ¤ŸğŸ¿ ğŸ”‹ ğŸ¤¾ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Geografi serangan kelompok TA505 untuk 2019 

 Tim analis Threat Intelligence kami dari PT Expert Security Center telah memantau penjahat cyber dari T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengoperasian TA505: bagaimana kami menganalisis alat baru dari pencipta Trojan Dridex, Locky ransomware, dan botnet Neutrino</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/469813/"><img src="https://habrastorage.org/webt/pe/vr/pg/pevrpgqqlgbp6qmkcpyoc_mmato.jpeg"><br><br>  <i>Geografi serangan kelompok TA505 untuk 2019</i> <br><br>  Tim analis Threat Intelligence kami dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PT Expert Security Center</a> telah memantau penjahat cyber dari TA505 selama enam bulan.  Bidang yang diminati para penyerang adalah keuangan, dan tujuannya terletak di banyak negara di berbagai benua. <a name="habracut"></a><br><br><h2>  Grup TA505 dikenal untuk apa </h2><br>  Kelompok penyerang ini memiliki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sejarah yang kaya</a> : sejak 2014, mereka telah mendaftarkan Trojan Dridex perbankan, botnet Neutrino, serta seluruh rangkaian kriptografer - Locky, Jaff, GlobeImposter, dll. <br><br>  Aktivitas kelompok ini direkam di seluruh dunia - dari Amerika Utara hingga Asia Tengah.  Catatan: kami mencatat kasus terisolasi pengelompokan TA505 berbahaya di Rusia, tetapi ada alasan untuk meyakini bahwa para penyerang tidak memiliki target di negara kami, dan surat-surat itu sifatnya acak. <br><br>  Terlepas dari motivasi keuangan kelompok yang dominan, di antara tujuannya dalam enam bulan terakhir terdapat lembaga penelitian, organisasi industri energi, layanan kesehatan, perusahaan penerbangan, dan bahkan sektor publik. <br><br><img src="https://habrastorage.org/webt/l9/mn/-c/l9mn-cadrlkmy1jnapnfgmm6wd8.jpeg"><br><br>  <i>Distribusi serangan TA505 oleh industri untuk 2019</i> <br><br>  Di bawah ini adalah contoh email phising yang berisi perangkat lunak berbahaya yang dikembangkan oleh grup dan ditargetkan, dilihat dari alamat email, ke Kantor Luar Negeri Inggris. <br><br><img src="https://habrastorage.org/webt/fy/ea/5m/fyea5mnfm5fhgxs0-_l15bbxxy0.jpeg"><br><br>  Sejak musim semi 2018, grup ini telah menggunakan Alat Akses Jarak Jauh FlawedAmmyy, dan sejak akhir tahun ini telah menggunakan backdoor ServHelper baru.  TA505 - salah satu dari sedikit yang dapat membanggakan aktivitas yang kuat untuk waktu yang lama.  Selain itu, dengan setiap gelombang serangan baru, mereka membawa perubahan menarik pada alat mereka. <br><br><img src="https://habrastorage.org/webt/0r/8h/-z/0r8h-zydxxkqwl0ob50jhxfgh8o.jpeg"><br><br>  <i>TA505 Group Discovery Dynamics berdasarkan Bulan untuk 2019</i> <br><br>  Tentu saja, aktivitas riuh seperti itu tidak luput dari perhatian: ada banyak publikasi rekan kami dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Proofpoint</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Trend Micro</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Yoroi</a> dan tidak hanya tentang teknik jahat dan malware.  Namun, banyak detail menarik diabaikan: <br><br><ul><li>  pengidentifikasi PE packer kelompok; </li><li>  variasi dari backdoor ServHelper, di mana penekanannya bukan pada fungsionalitasnya sendiri, tetapi pada implementasi NetsupportManager yang sudah jadi dan terkenal; </li><li>  infrastruktur jaringan: pendaftar karakteristik, host, termasuk persimpangan dengan infrastruktur kelompok Buhtrap; </li><li>  grup VPO lain yang tidak dijelaskan sebelumnya. </li></ul><br>  Artikel ini adalah yang pertama dari serangkaian posting kami tentang TA505. <br><br><h2>  Bagian Satu  Bertemu dengan paket </h2><br>  Pada pertengahan Juni 2019, kami memperhatikan bahwa pengunduh malware FlawedAmmy berikutnya secara signifikan berbeda dari versi sebelumnya: misalnya, representasi visual dari kode program dalam editor heksadesimal berubah, dan bahkan menjadi sesuatu karakteristik dari beberapa sampel yang diambil: <br><br><img src="https://habrastorage.org/webt/k6/7l/wn/k67lwnebhvicltujro7n_6fo_pu.jpeg"><br><br>  <i>Representasi kode program ASCII</i> <br><br>  Analisis cepat terhadap kode menunjukkan bahwa di hadapan kami ada paket yang tidak diketahui dari file yang dapat dieksekusi.  Kemudian ternyata bahwa paket ini tidak hanya mencakup loader yang disebutkan di atas, tetapi juga sampel lain dari grup HPE, termasuk muatannya.  Kemudian kami memutuskan untuk mempelajari secara detail logika dekompresi untuk mengekstraksi objek target secara otomatis. <br><br><h3>  Layer 1. Twisted XOR </h3><br>  Bagian penting dari pembongkaran didahului oleh banyak instruksi yang tidak berguna.  Penulis virus sering menggunakan teknik seperti itu untuk membingungkan emulator produk antivirus.  Semua hal menarik dimulai dengan alokasi memori untuk buffer ukuran 0xD20 menggunakan fungsi WinAPI VirtualAllocEx.  Memori dialokasikan dengan izin PAGE_EXECUTE_READWRITE, yang memungkinkan Anda untuk menulis dan mengeksekusi kode. <br><br><img src="https://habrastorage.org/webt/av/98/-t/av98-tw9eejhg79lgqusz9wizya.jpeg"><br><br>  <i>Mulai dari konten unpacker</i> <br><br>  Bagian data dari file yang sedang dipelajari berisi larik data yang melewati prosedur dekripsi, dan hasilnya ditulis ke memori yang dialokasikan.  Algoritma Dekripsi: <br><br><ul><li>  menafsirkan 4 byte sebagai integer, </li><li>  kurangi nomor seri </li><li>  melakukan operasi XOR dengan konstanta yang diberikan, </li><li>  melakukan pergeseran bitwise siklik ke kiri sebanyak 7 unit, </li><li>  melakukan operasi XOR lagi dengan konstanta yang diberikan. </li></ul><br><img src="https://habrastorage.org/webt/nz/fq/1w/nzfq1w5puluzqikeibh8ucintau.jpeg"><br><br>  <i>Decoding layer pertama</i> <br>  Kami menyatakan algoritma ini dengan singkatan <b>SUB-XOR-ROL7-XOR</b> untuk merujuknya nanti. <br>  Setelah prosedur dekripsi, variabel diinisialisasi secara berurutan.  Ini dapat direpresentasikan sebagai pengisian struktur dalam C dalam format berikut: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZOZ</span></span></span><span class="hljs-class"> {</span></span> HMODULE hkernel32; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *aEncodedBlob; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nEncodedBlobSize; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nBlobMagic; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nBlobSize; };</code> </pre> <br>  dimana: <br><br><ul><li>  <i>hkernel32</i> - deskriptor perpustakaan kernel32.dll; </li><li>  <i>aEncodedBlob</i> - penunjuk ke blok data yang disandikan, kami sebutkan ketika kami merujuk pada kesamaan visual dari sampel di atas; </li></ul><br><img src="https://habrastorage.org/webt/tw/gf/fc/twgffcvlsjw2mfo6rdeyjof2lju.jpeg"><br><br>  <i>Blok data yang dikodekan</i> <br><br><ul><li>  <i>nEncodedBlobSize</i> - ukuran 4 byte dari blok data yang disandikan; </li><li>  <i>nBlobMagic</i> - <i>konstanta</i> 4-byte di depan blok data, yang akan kita <i>bahas</i> nanti; </li><li>  <i>nBlobSize</i> - ukuran 4 byte dari blok data yang di-decode; </li></ul><br>  Kami menyebut struktur <b>ZOZ</b> (ini "505" di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">leetspeak</a> ). <br><br><img src="https://habrastorage.org/webt/zv/le/sm/zvlesmivdy2wt26l0-p2nixbnjk.jpeg"><br><br>  <i>Isi Struktur ZOZ</i> <br><br>  Sebagai hasil dari tindakan yang dijelaskan, eksekusi kode akan diarahkan ke buffer dekripsi (sekarang tidak ada keraguan bahwa data yang didekripsi adalah kode yang dapat dieksekusi), dan penunjuk ke struktur yang diisi akan diteruskan sebagai parameter fungsi: <br><br><img src="https://habrastorage.org/webt/zp/a4/jm/zpa4jmn9rtfvnrnnbhbw31autc0.jpeg"><br><br>  <i>Memanggil kode yang didekripsi dengan struktur " <b>ZOZ</b> " <b>diteruskan</b> sebagai argumen</i> <br><br><img src="https://habrastorage.org/webt/30/iu/8_/30iu8_lgix9_bg7kvo72dmp2oca.jpeg"><br><br>  <i>Potongan kode dekripsi yang dibongkar</i> <br><br><h3>  Layer 2. Semakin kecil semakin baik </h3><br>  Setelah mentransfer kontrol ke potongan kode yang didekripsi, langkah pertama adalah menentukan alamat fungsi WinAPI GetProcAddress, VirtualQuery, VirtualAlloc, VirtualProtect, VirtualFree dan LoadLibraryA.  Daftar ini sering ditemukan dalam karya kode shell: setelah semua, mereka perlu mempersiapkan dan mengisi memori dengan benar untuk peluncuran payload berikutnya. <br><br>  Setelah menyelesaikan prosedur awal, blok data yang disandikan yang ditransmisikan terpotong: dari setiap lima byte, dua yang pertama dibuang, dan tiga sisanya disimpan: <br><br><img src="https://habrastorage.org/webt/vl/5a/jf/vl5ajfnndn3od-62hput6y5ihgm.jpeg"><br><br>  <i>Pengurangan Blok Data Berkode</i> <br><br>  Kemudian, prosedur dekripsi, yang kami sebut <b>SUB-XOR-ROL7-XOR, dilakukan</b> .  Dalam hal ini, sebagai konstanta untuk operasi XOR, nilai nBlobMagic lain digunakan, yang diteruskan dalam struktur <b>ZOZ</b> . <br><br><img src="https://habrastorage.org/webt/bt/4c/w2/bt4cw2dondbm1m04erjff1hfqec.jpeg"><br><br>  <i>Menggunakan kembali SUB-XOR-ROL7-XOR</i> <br><br>  Setelah itu, array yang dihasilkan ditransfer ke fungsi di mana serangkaian transformasi yang lebih kompleks terjadi.  Dengan nilai-nilai karakteristik konstanta, mudah untuk menetapkan bahwa ini adalah <a href="">implementasi</a> FSG PE-wrapper populer (Fast Small Good).  Sangat mengherankan bahwa versi asli packer FSG memampatkan PE menjadi beberapa bagian, dan implementasi algoritma dalam kasus kami bekerja dengan PE secara keseluruhan. <br><br><img src="https://habrastorage.org/webt/qy/fu/qy/qyfuqyq6uoa7nktub3-f8xluxnc.jpeg"><br><br>  <i>Implementasi FSG Packer</i> <br><br>  Pada tahap ini, file target PE yang sudah dibongkar siap untuk analisis lebih lanjut.  Sisa dari shellcode akan menimpa PE asli di ruang alamat dengan versi yang sudah dibongkar dan menjalankannya dengan benar.  Sangat menarik untuk dicatat bahwa dalam proses menyesuaikan titik masuk dari modul yang dimuat, struktur dimanipulasi dalam PEB.  Mengapa penyerang memutuskan untuk meneruskan deskriptor kernel32 dari logika lapisan pertama alih-alih mengambilnya menggunakan struktur PEB yang sama tidak diketahui. <br><br><img src="https://habrastorage.org/webt/0n/zr/zy/0nzrzyvv4vwyqzoc4rnnhz3trxu.jpeg"><br><br>  <i>Menimpa nilai dari titik masuk modul yang dimuat di PEB</i> <br><br><h2>  Kesimpulan </h2><br>  Jadi, algoritma pembongkaran payload: <br><br><ul><li>  decoding kode shell menggunakan SUB-XOR-ROL7-XOR, </li><li>  mengisi struktur ZOZ dan memanggil shellcode, </li><li>  pengurangan lima hingga tiga payload, </li><li>  decoding payload menggunakan SUB-XOR-ROL7-XOR, </li><li>  pengurai dekompresi FSG. </li></ul><br>  Selama evolusi malware, logikanya berubah: misalnya, jumlah perubahan siklik dari algoritma SUB-XOR-ROL7-XOR (tujuh dalam kasus yang dipertimbangkan) diubah oleh lima, sembilan, versi paket untuk platform x64 dirilis, dll. epigraf untuk narasi masa depan tentang alat dan fitur TA505. <br><br>  Dalam artikel berikut, kita akan berbicara tentang bagaimana alat TA505 dikembangkan dan diubah selama serangan terbaru, tentang interaksi peserta dengan kelompok cyber lainnya, dan kita akan mempelajari model malware yang sebelumnya tidak dianggap. <br><br>  <b>Penulis</b> : Alexey Vishnyakov dan Stanislav Rakovsky, Positive Technologies <br><br><h2>  IOC </h2><br>  <code>b635c11efdf4dc2119fa002f73a9df7b</code> - <code>b635c11efdf4dc2119fa002f73a9df7b</code> Packaged Loader <br>  <code>71b183a44f755ca170fc2e29b05b64d5</code> - <code>71b183a44f755ca170fc2e29b05b64d5</code> bootloader </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id469813/">https://habr.com/ru/post/id469813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id469803/index.html">Cara mendesain pelajaran yang sempurna</a></li>
<li><a href="../id469805/index.html">Evolusi ulasan sprint dalam tim Agile</a></li>
<li><a href="../id469807/index.html">Ya, kami dapat menghapus semuanya, tidak, kami tidak membaca SMS Anda</a></li>
<li><a href="../id469809/index.html">Itu terjadi! Lampu LED murah dengan CRI 90+</a></li>
<li><a href="../id469811/index.html">Font yang bagus</a></li>
<li><a href="../id469817/index.html">"Ominous weed" dalam baterai: ilmuwan NUST "MISiS" menguji parsnip sapi sebagai elektroda superkapasitor</a></li>
<li><a href="../id469821/index.html">Origami lima meter, atau Cara membangun kota kardus yang futuristik</a></li>
<li><a href="../id469827/index.html">Orang-orang sangat tidak logis: perilaku irasional dalam pengadaan publik</a></li>
<li><a href="../id469829/index.html">Bagaimana Saya Membuat Lebih Dari 100 Aplikasi Sumber Terbuka Menggunakan Alat Otomasi</a></li>
<li><a href="../id469831/index.html">Dobroshrift</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>