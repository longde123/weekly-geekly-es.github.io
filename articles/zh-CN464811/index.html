<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗾 ⛑️ 🥌 适用于开发人员的Apple Music ➗ 🐀 🥃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="介绍词 


 无论苹果对封闭平台和生态系统本身有多大的责骂，他们的某些解决方案都是一个例外。 市场上有很多流媒体服务，但是在第三方产品中提供完整的用于流媒体的SDK的机会非常小，对于俄罗斯市场，正式可用的SDK的列表仅限于Deezer和Apple Music。 当然，当Spotify进入我们的市场...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>适用于开发人员的Apple Music</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464811/"><h2 id="vvodnye-slova"> 介绍词 </h2><br><p> 无论苹果对封闭平台和生态系统本身有多大的责骂，他们的某些解决方案都是一个例外。 市场上有很多流媒体服务，但是在第三方产品中提供完整的用于流媒体的SDK的机会非常小，对于俄罗斯市场，正式可用的SDK的列表仅限于Deezer和Apple Music。 当然，当Spotify进入我们的市场时，将会有更多可用的SDK，但是到目前为止，有两个参与者，只有一个拥有广泛的用户基础。 </p><br><p>碰巧，我有使用Android的Deezer SDK的经验，现在我正在积极使用iOS的Apple Music SDK（ <em>MusicKit</em> ）。 与Deezer体验的主要不同在于，MusicKit是冰山一角，它也是公开可用的API。 与Deezer不同，在其中重复官方应用程序的大部分功能只是一个漫长的过程，即使仅使用公共API也无法重复甚至Apple Music网页的功能。 即使Apple在其解决方案中使用了MusicKit，除此以外，它还使用了许多未公开的API请求和私有API，这些应用程序不允许凡人使用。 </p><br><p> 在本文中，我将从开发人员的角度讨论在实现“ <em>简单任务</em> ”的背景下如何使用MusicKit：搜索目录，在搜索结果中显示图片，获取歌曲，推荐甚至播放某种音乐。 展望未来，我要说的是，以上大部分内容对于在Android和Javascript中使用Apple Music都是正确的。 </p><br><p> 如有必要，我准备在评论中提供带有代码的详细答案。 </p><a name="habracut"></a><br><h2 id="otdelim-muh-ot-kotlet"> 肉饼和果肉分开 </h2><br><p> 在iOS下使用MusicKit时，您将必须与以下实体进行交互： </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">StoreKit</a>用于Apple Music中的授权并提供对该服务的订阅（ <em>如果可以订阅会员计划，则请参考</em> ） </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">HTTP API，</a>用于从目录中搜索和检索各种信息 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">iTunes Search API，</a>用于搜索iTunes目录（ <em>HTTP API的</em>一种<em>非常有用的替代方法</em> ）。  Apple表示每分钟最多可请求20个请求，这在从用户设备发出请求时通常就足够了 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Media Player，</a>用于播放和管理队列 </li></ul><br><p> 另外，在连接到会员程序时，您可以请求访问<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Enterprise Partner Feed</a>元数据转储，Apple建议使用它，而不是经常向iTunes Search API发送请求。 </p><br><p> 而且，以防万一，Music.app是iOS设备上的音乐应用程序，它是官方的Apple Music播放器。 </p><br><p> 信息源，按其效用从高到低的顺序： </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">官方文件</a> </li><li> 搜索<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">所有</a> Apple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档</a> </li><li> 使用HTTP API的科学实验方法<sup>1</sup> </li><li> 您喜欢的浏览器中的开发者控制台，固定在Apple Music中感兴趣实体的网页上 </li><li> 苹果开发者论坛 </li><li> 堆栈溢出 </li></ul><br><h2 id="poisk-kartinki"> 搜索。 图片 </h2><br><p>检查您的应用程序中是否可以完成某些操作的最明显方法是，在官方应用程序中可以找到类似的信息。 这里以搜索为例。 我们正在寻找“警察” <code>Music.app</code> ，在<code>Music.app</code>我们带着微笑的Sting <code>Music.app</code>了一张<code>Music.app</code>的照片： </p><br><img alt="警察搜查" src="https://habrastorage.org/webt/wn/jo/31/wnjo31ts3vxptbekvmhgdmxttqq.png" width="200"><br><p> 很好，我们将使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">搜索API</a> 。 在发行中，我们为<code>artwork</code>提供了带有嵌入式<code>url</code>链接的<code>artwork</code>密钥，适用于除艺术家以外的所有内容。 真奇怪 再次检查，在Music.app中所有内容都存在。 此外，Web界面还具有照片，并且在json搜索引擎API中提供了指向该网页的链接。 </p><br><p>  iTunes Search API也不<code>artistLinkUrl</code>图像，但是它还包含网页地址， <code>artistLinkUrl</code>包含<code>artistLinkUrl</code>键。 </p><br><p> 好了，该怎么办，您必须下载该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">网页</a>并从中获取图像地址，所幸，开发人员已注意并在元信息中注册了图像地址： </p><br><pre> <code class="plaintext hljs">&lt;meta property="og:image" content="https://is5-ssl.mzstatic.com/image/thumb/Features113/v4/bb/a2/66/bba266dd-570b-bff7-d7c6-777982582964/mzl.tdrwskof.jpg/1200x630cw.png" id="ember52310559" class="ember-view"&gt;</code> </pre> <br><p> 正式而言，我们已经违反了Apple禁止“抓取”其网页的规则。 实际上，除使用第三方服务查找图片的应用程序外，所有第三方应用程序都可以执行此操作。 </p><br><p> 还有一个减号：我们请求的页面大小为几百千字节。 对于已经驱动大量数据（ <em>播放音乐</em> ）的应用程序，它是可以忍受的（ <em>特别是当您考虑以压缩形式传输数据时</em> ），但是通常情况下并不是那么容易。 </p><br><p> 图像的大小可以根据您的需要进行调整： <code>url</code>有用于替换的模板（ <code>{w}</code> ， <code>{h}</code> ），并且在网页上，图像的链接具有相同的格式，因此，获取合适尺寸的图像没有困难。 如果要获取舍入的图像，则需要在扩展名之前添加<code>cw</code> 。 </p><br><h3 id="bonus-pro-kartinki-dlya-otobrazheniya-v-pleere"> 关于要在播放器中显示的图片的奖励 </h3><br><p> 在播放期间，来自<code>Media Player</code>器在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>MPMediaItem</code></a>构造上运行，该构造特别提供了<code>Artwork</code>对象。 在播放器中显示曲目的图片非常方便。 唯一的问题是，实际上，无论该对象怎么说，该对象都不提供流音乐（ <em>Apple Music中的任何音乐</em> ）的图片，因此您必须“播放” <code>MPMediaItem</code>播放的<code>MPMediaItem</code>添加到队列中并下载的歌曲图像类似于相册。 </p><br><h2 id="poisk-po-zhanram"> 按类型搜索 </h2><br><p>  iTunes和Apple Music应用程序中都有类型和热门歌曲的列表。 寻找类型应该不难，因为我们可以搜索任何东西？ </p><br><p> 事实并非如此。 该API不会按流派进行搜索，并且不提供流派列表。 可以通过其标识符请求类型的信息（ <em>从有用的名称</em> ）， <br> 但API中的大多数信息仅包含类型名称，而不包含标识符。 </p><br><p>  iTunes的好处是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">卸载了所有流派</a> （ <em>包括移动应用程序的“流派”在内的</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">所有流派</a> ）。 流派的标识符（ <em>如iTunes中的其他标识符</em> ）完全对应于Apple Music中的标识符。 卸载适用于所有区域（该<em>区域在<code>cc</code>键中指示，而不是在Apple Music API中在<code>storefront</code>指示</em> ），但实际上只有名称不同（ <em>它们已翻译</em> ）。 流派的结构是分层的，流派名称重复。 </p><br><p> 通常，必须按类型进行搜索，并且要记住，放克爵士乐，放克爵士乐和放克爵士乐是一回事。 并不困难，但没有要求搜索API按类型进行搜索那样简单。 </p><br><p> 找到一种流派后，您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">请求</a>此流派<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的图表</a> （ <em>最受欢迎歌曲</em>的<em>列表</em> ）。 对于罕见的流派，很有可能只发行3首歌曲。 </p><br><p> 有趣的事实：对于某些专辑和艺术家（ <em>著名的Ed Sheeran</em> ），仅一种流派简单地表明了“音乐”的顶级流派。 如果您要根据体裁提出建议，则应忽略此体裁。 </p><br><h2 id="pesni-artistov"> 歌手歌曲 </h2><br><p> 当应用程序最需要播放艺术家（ <em>音乐团体</em> ）的歌曲时，这意味着有必要播放该团体的流行歌曲。  Apple Music可以请求歌手作为歌手的“歌曲” <sup>2</sup> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">链接</a> 。 输出最多包含20首歌曲<sup>3</sup> ，按流行程度清晰地排序。 </p><br><p> 有时您仍然想多听一些歌曲。 对于非常受欢迎的群组，可以选择获取播放列表，例如“ <em>[艺术家姓名]：</em> <em>基本</em> ”和“ <em>[艺术家姓名]：详细信息</em> ”（“ <em>[艺术家姓名]：后续步骤</em> “），但是通常，此选项不合适。 另一种选择：选取20首流行歌曲，然后从专辑中删除其余歌曲，Apple Music的好处是可以在一个请求中立即获取所有艺术家专辑（ <em>如<code>albums</code>链接</em> ）和其中的所有歌曲（ <code>include="tracks"</code> ）。 </p><br><p> 但是，如果您获得了歌手的所有歌曲，那么就会出现另一个问题：您需要从所有这些歌曲中选择流行歌曲。 不幸的是，流行度信息API没有提供<sup>4</sup> 。 您可以从整个列表中随机挑选歌曲，但实际上，这种方法会导致经常播放完全没意思的录音（ <em>现场录音，排练录音，偏僻等等</em> ），这在非常受欢迎的人群中尤其明显<sup>5</sup> 。 </p><br><p> 让我们尝试以另一种方式获得热门歌曲。 甚至在MusicKit出现之前，Apple便开始在iTunes Store中提供<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">搜索API</a> 。 如前所述，Apple Music和iTunes Store中的目录是相同的<sup>6</sup> ，因此，歌曲的标识符也相同。 默认情况下，此API返回50首歌曲，但您最多可以请求200首歌曲。 结果也按受欢迎程度排序。 </p><br><p> 有趣的是，Apple本身在其Web界面中未使用任何这些选项。 他们使用未<em>公开的</em> （ <em>读取的，私有的</em> ）API <sup>7</sup> ，该API发行时缺少所有内容，包括类型的标识符（ <em>而不仅仅是名称</em> ）和流行指数。 我不敢在实践<sup>8中</sup>使用此API，因为可以通过按类型名称<sup>9</sup>进行反向搜索来获得类型标识符，并且当您获得按流行度排序的歌曲列表时，数字流行度索引并不那么重要。 </p><br><p> 我称之为“ <em>休·劳瑞问题</em> ”的有趣事实是，苹果音乐目录中包含大量非音乐内容。 尤其是来自喜剧表演和站立表演的各种汇编。 一方面这很好（ <em>我们为音乐付费，但我们还和Stephen Fry进行了有趣的对话，您可以在上床睡觉前收听</em> ），另一方面，当要求打开音乐时会引起一些chat不休。 因此，当应用程序的操作上下文直接指示用户想要听音乐时，必须从“ <em>歌曲</em> ”列表中独立删除那些流派被指定为“ <em>口语</em> ”和“ <em>喜剧</em> ”的用户。 </p><br><h2 id="rekomendacii"> 推荐建议 </h2><br><p> 播放推荐（它们也是“ <em>类似的歌曲</em> ”，“ <em>广播电台</em> ”，“ <em>您会喜欢</em> ”等）已经成为流媒体播放器的基本功能。 按照惯例，推荐可以分为两种类型<sup>10</sup> ：针对用户（ <em>基于收听历史，购买和喜欢</em> ）和针对音乐对象（ <em>艺术家，曲目，不太频繁的专辑和播放列表</em> ）。 </p><br><p> 根据Apple Music中用户的喜好，正式<sup>11</sup>一切都很好：您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">请求</a>个人推荐<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">列表</a> ，其中包括“ <em>个人混音</em> ”（ <em>播放列表</em> ）和推荐专辑。 从专辑中，可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>API   ( tracks</code> ）</a>类似地获取播放列表的歌曲列表。 请记住，曲目不仅可以包含歌曲（ <code>type = "songs"</code> ），还可以包含视频剪辑，因此对接收到的数据进行其他过滤不会受到损害。 </p><br><p> 有了其他建议，一切都会变得更加复杂。 如果您查看Music.app，则那里会显示“ <em>相似的艺术家</em> ”，您可以为该艺术家打开“ <em>广播电台</em> ”。 后者失去了艺术家的推荐和推荐。 </p><br><img alt="警察类似" src="https://habrastorage.org/webt/lr/yr/e2/lryre2qusu_88h-xyvna4_gs8kc.png" width="200"><br><p> 似乎一切都很简单：对于艺术家而言，可能存在“ <em>相似艺术家</em> ”之间的联系。 我赶紧难过，没有这种联系。 企业合作伙伴Feed数据架构中也没有相似性信息。 </p><br><p> 好的，所以我们可以为艺术家请求一个“ <em>广播电台</em> ”并获取歌曲列表？ 再说一次，不，我们真的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">可以</a>要求广播电台，它的标识符在艺术家的联系信息中。 但是在电台信息中，没有有关正在播放的歌曲，专辑或艺术家的信息，只有服务对象具有用于播放<code>playParams</code>信息。  <code>playParams</code>的想法<code>playParams</code>简单：我们将字典<sup>12</sup>放入播放队列并收听。 </p><br><p> 如果您只想播放广播电台（ <em>就像Music.app一样</em> ），那么这一切都很好，但是如果您想将广播电台<sup>13中的</sup>歌曲与其他歌曲混在一起怎么办？ 显然，我们需要某种方式获得类似艺术家的名单。 </p><br><p> 在<code>Media Player</code> ，播放队列尤其是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MPMusicPlayerControllerMutableQueue</a>扮演着重要角色。 队列使您可以：在特定的可播放对象之后插入描述符，删除指定的对象，以及获取队列中所有对象的列表。 查询对象以进行输出时，我们应该从<code>MPMediaItem</code>获得一个数组。  <code>MPMediaItem</code>特别包括<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">歌曲</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">标识符</a> 。 只有一个问题：队列构造器不是公共API，我将翻译为： <code>Media Player</code>可以提供一个现成的队列（有时是<em>可编辑的</em> ），但是您无法自己创建它<sup>14</sup> 。 </p><br><p> 好吧，稍微拐杖会很有帮助。 如果<code>Media Player</code>可以给我一个可变队列，那么我需要接受它。 为此，您必须与当前的（ <em>单身</em> ）播放器一起使用，因此您需要快速采取行动，否则用户可能会错失一些东西，并且播放器仍然有时间预加载到目前为止不需要的歌曲。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我们更改</a>当前的播放队列（ <em>添加站点描述符</em> ），查看发生了什么，使用新事务回滚队列中的更改（ <em>删除实际添加到队列中的内容</em> ）。 </p><br><p> 不幸的是，我们发现只有两个<code>MPMediaItem</code>对象被<code>MPMediaItem</code>到队列中。 两者看起来都像歌曲（ <em>有艺术家的名字，曲目的名称，曲目的长度</em> ），但不包含歌曲的标识符。 如果您查看Music.app，我们发现那里一切都融合了：打开广播电台将播放歌曲，并且在队列中仅可播放一首歌曲。 当您移至下一首歌曲时，队列将更新。 </p><br><p> 尝试进一步建立带有广播电台的拐杖是没有意义的；您必须使用其他选项。 </p><br><p> 回想一下，在Music.app和Web界面中，显示了类似的艺术家。 同类歌手仅适用于最受欢迎的乐队<sup>15</sup> 。 同样，您必须诉诸于禁止解析网页的方法。 从专业人士那里：我们已经在下载网页以获取图片，因此我们可以立即从中获取相似的艺术家。 </p><br><p> 在html页面代码中，我们看到一个大的json对象，我们首先从中获取相似艺术家的标识符（ <code>["data"]["relationships"]["artistContemporaries"]</code> ）： </p><br><img alt="网页数据" src="https://habrastorage.org/webt/xg/o-/yx/xgo-yxn-dh73gqcd8zieowzam3y.png" width="200"><br><p> 然后使用这些标识符从同一个json（类型为<code>lockup/artist</code> <code>["included"]</code>获取艺术家数据： </p><br><img alt="包含网页" src="https://habrastorage.org/webt/j8/du/my/j8dumysqer6_oh9wlj_8geroip4.png" width="300"><br><p> 有了艺术家的标识符，我们可以请求他们的足迹。 该API允许您在启用链接的单个请求中按其标识符请求<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">多个艺术家</a> 。  las，实际上，API返回错误，指示无法在结果中添加曲目列表。 这只能通过一次请求一个艺术家或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">直接请求</a>单个艺术家的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">歌曲</a>来完成。 在这种情况下，您可以使用已经提到的iTunes Search API，它将提供更多有用的信息。 </p><br><p>  Apple Music中的“ <em>类似艺术家</em> ”列表相当不错，但实际上，它们经常是空的。 在建议列表为空的情况下，您必须使用第三方服务。 经典-Last.fm，稍微复杂一点-Spotify。 两者的结果都需要与Apple Music目录中的对象匹配。  “在额头上”的解决方案是按名称<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">搜索每个歌手</a> ，并给出一个准确的结果，然后如上所述接收歌曲。 这些解决方案有些有趣，但是使用musicbrainz进行匹配会更加昂贵。  Musicbrainz在其他服务中提供有关标识符<sup>16的</sup>信息，即 您可以将Spotify中的标识符与Apple Music中的标识符关联。  Last.fm的情况甚至更好：Last.fm从建议列表中的musicbrainz返回标识符。 开销在于对musicbrainz的使用限制，您需要大量流量来提高自己的musicbrainz克隆版本（幸运的是， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这是可能的</a> ）或围绕<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">数据库</a>开发自己的API，可以轻松下载其转储。 </p><br><p> 对于新组，即使Last.fm也不会给出建议；替代选项将是“体裁”建议。 我们采用艺术家的流派（ <em>根据名称，我们从已加载的所有流派列表中获取标识符</em> ），获得每种流派的图表，并混合接收到的歌曲。 总比没有好。 </p><br><h2 id="dve-veschi-nerazluchnye-pleer-i-ochered"> 两件事是密不可分的：播放器和队列 </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Media Player</a>负责在Apple Music中的iOS中播放；它允许您使用Apple Music中的音乐和用户的个人目录<sup>17</sup> 。 该框架是高级框架，在将流内容降至<sup>18</sup>以下的情况下将无法正常工作。 </p><br><p> 该框架为两个播放器提供了通用的软件界面： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一个</a>直接在Music.app应用程序中播放音乐， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">另一个则</a>或多或少地独立工作。 用第一个严肃的东西毫无意义<sup>19</sup> 。 而且<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文件</a>大胆地谎称第二个播放器在后台不工作<sup>20</sup> </p><br><p> 从体系结构的角度来看，处理这个问题很简单：我们告诉播放器播放什么（ <em>例如，基于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一系列歌曲标识符</a>填充队列</em> ）并控制播放（ <em>播放，暂停，下一个，上一个</em> ）。 </p><br><p> 没有对播放队列的直接控制，您需要执行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">事务更改</a> ，这需要时间。 此外，通常会用超时错误来调用<code>completionHandler</code>处理程序，该错误的含义是：“ <em>我不知道我是否能够做某事，或者是否正在做其他事情，但我厌倦了等待自己</em> 。” 大多数情况下，事务处理良好，必须忽略处理程序中出现的错误。 可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">更高的</a>级别上进行某些更改，但是，如果您已经必须使用事务性更改，那么最好将它们用于所有内容。 </p><br><p> 通常，队列是非常灵活的，并且如果您的应用程序不可能一次与其他流服务<sup>21一起工作</sup> ，那么您可以对队列做很多有趣的事情，特别是指出什么时候开始播放什么元素以及持续多长时间。 </p><br><p> 在此高级方法的其他“ <em>缺点</em> ”中，值得注意的是无法处理用户操作。 将用户按在“ <em>下一首</em> ”按钮的耳机上不会导致对程序“ <em>我应该做什么</em> ”的请求，播放器会更好地知道该怎么做，并将自己切换歌曲。 因此，您只能捕获播放器状态中实际完成的更改，然后根据实际情况做出一些决策。 </p><br><p> 另一方面，您无需做太多事情：在锁定屏幕上播放信息就在那里，并且所有按钮都可以使用，Apple Watch和Siri可以控制播放，而通过AirPlay到Apple TV的流媒体播放则在第<sup>22</sup>栏中。 </p><br><p> 可以在您的应用程序中重复Music.app队列的功能和界面，但是实际上，队列中拖放元素的看似简单实际上是在变通事务以更改队列并同步所需的队列和<sup>23个</sup>播放器的真实队列。 </p><br><h2 id="para-slov-pro-sdk-dlya-drugih-platform"> 关于其他平台的SDK的几点说明 </h2><br><p> 实际上，在其他平台上使用API​​并没有什么不同，但SDK并未完全与iOS完全兼容，并且在某些地方更为方便<sup>24</sup> ，尽管仍然保留了串联队列和播放器的一般概念。 </p><br><p> 因此，在Android下，您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">通过</a>事务更改（ <em>从队列中删除并用手指交叉将其添加到正确的位置</em> ）来<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">获取当前队列</a>并<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">移动该</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">队列中</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的元素</a>而无需花招。 </p><br><p>  MusicKit JS还提供了用于处理Apple Music API的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">特殊包装方法</a> ， <br> 但是在使用包装器时，您必须阅读API本身的文档。 使用队列和播放器并<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">没有比iOS SDK更方便</a> ，但是使用小的附加组件就<a href="">可以忍受</a> 。 </p><br><h2 id="para-slov-o-simulyatore"> 关于模拟器的几句话 </h2><br><p> 您只能在与HTTP API通信的上下文中使用MusicKit在模拟器中工作，但是即使在这种情况下，您也必须稳定用户的令牌来进行请求，而不是通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">StoreKit来</a>获取。 因为缺少Music.app应用程序，所以完全不可能在模拟器中播放Apple Music的音乐。 </p><br><p> 实际上，您必须在SDK上开发自己的附加组件，并且在模拟器中运行时，使用替代（ <em>模拟</em> ）实现。 实际上，在开发过程中，模拟器仅用于在用户界面上工作。 自己的抽象在应用程序的自动屏幕截图中（ <em>以及实际上在使用模拟器创建屏幕截图时</em> ）也很有<em>用</em> ，因为在武器库中拥有两代“大型” iPad Pro只是为了在两个屏幕上都为您的播放器拍摄屏幕截图是极其无利且愚蠢的。 </p><br><p> 作为一个有趣但不太有用的实验，您可以基于MusicKit JS替代自己的高级播放器。 </p><br><h2 id="pro-enterprise-partner-feed"> 关于企业合作伙伴供稿 </h2><br><p> 一方面，Apple可应要求提供元数据转储，并表示要使用它以减轻API的负担并获取API没有的信息。 另一方面，我们对鸡肉和鸡蛋存在明显的问题：通过指定应用程序的链接，可以访问Affiliate程序。 使用只能通过在App Store上发布的应用程序才能获得的数据来开发应用程序是非常困难的。 </p><br><p> 而且，当然，数据不会给第一个来者。 每个申请将在五个工作日内得到检查。 在撰写本文时，我还没有获得元数据转储。  Apple包装了我的应用程序，但未指定确切原因。  ,  -     " <em>Apple Music</em> "    ,    Apple   .   - ,      -, <em>       </em> . ,       Apple    ,    ,     . </p><br><p>       ,        ,         .             Apple Music    ( <em>      ,       </em> ),     . ,     ,     Apple Music  .         ,      ,      . </p><br><p>   Enterprise Partner Feed     : </p><br><ul><li>          Apple Music API  iTunes Search API </li><li>      (" <em> </em> "),   -   </li><li>        </li></ul><br><h2 id="ochevidnye-sovety">   </h2><br><p>    ,  -  : </p><br><ol><li>   .     ,   ,     .   <br>     ,   .         ,    -     </li><li>   -  ,   ,            . ,       -  ,             -. </li><li> ,  SDK         ,      .  Apple <sup>25</sup>   SDK     <sup>26</sup> ,         ,   ,     API  ,   SDK    . </li><li>      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>   " <em>code level</em> "      .      " <em>Q&amp;A</em> "  " <em>Tech Notes</em> ",     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   </a> ,      - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . </li><li>      . ,  ,       .  API ( <em>Last.fm, musicbrainz, iTunes Search API    </em> )    IP   .       Apple Music      .        " <em></em> "       ,         <sup>27</sup> . </li><li> ,   Apple Music API,       ,   . - App Store   ,      ( <em>    </em> )     , ,  ( <em>        </em> ).     <sup>28</sup>   ,    ,          ,            <sup>29</sup> .   Apple      <sup>30</sup> . </li><li> ,  - Apple Music —   Ember.    ,   ,     html         DOM   Javascript. </li><li>   -,   ,          .          ,    . </li></ol><br><h2 id="posleslovie">  </h2><br><p>     SDK,        batch   API,          ,    « »  Apple Music.  ,     ,        SDK   .          SDK,             . </p><br><p> ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . </p><br><h2 id="bespoleznye-primechaniya">   </h2><br><p> <sup>1</sup>    ( <em> </em> ) </p><br><p> <sup>2</sup> ,       </p><br><p> <sup>3</sup> ,  Music.app  -        ( <em>   </em> ),    API   ( <em>   ""</em> )  </p><br><p> <sup>4</sup>    <code>limit</code>  : <code>Specified limit for relationship 'songs' exceeds maximum of 20</code> </p><br><p> <sup>5</sup> The Beatles </p><br><p> <sup>6</sup>    ,      Apple Music   iTunes Store.   API iTunes Store   `isStreamablez,        Apple Music  . </p><br><p> <sup>7</sup>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewArtistSeeAll?cc=ru&amp;ids=424279384&amp;section=0</a> </p><br><p> <sup>8</sup>  ,     ,  ,     iTunes    ( <em></em> )   iTunes Store </p><br><p> <sup>9</sup>             </p><br><p> <sup>10</sup>  ,       ! </p><br><p> <sup>11</sup> ,    Apple Music      :   ,        ,      </p><br><p> <sup>12</sup> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MPMusicPlayerPlayParametersQueueDescriptor</a> </p><br><p> <sup>13</sup>   Apple Music   ,    ( <em></em> )   .        . </p><br><p> <sup>14</sup> , ,    App Store </p><br><p> <sup>15</sup>    ( <em></em> )    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">( <em></em> )</a>  ( <em></em> )    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">( <em></em> )</a> .       . </p><br><p> <sup>16</sup>       -,         </p><br><p> <sup>17</sup>     ,     iTunes Store    iTunes Match </p><br><p> <sup>18</sup>        API URL   </p><br><p> <sup>19</sup>  —   -,       . ,  . </p><br><p> <sup>20</sup>  : ( <em>When your app moves to the background, the music player stops playing the current media.</em> ).       <code>AVPlayer</code> ,     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>  <code>Info.plist</code>            . </p><br><p> <sup>21</sup>              . </p><br><p> <sup>22</sup>      ,    <code>MPMediaItem</code>    </p><br><p> <sup>23</sup>           </p><br><p> <sup>24</sup>     ,   SDK    ,     ,       .    iOS <code>Media Player</code>    ,     API  . </p><br><p> <sup>25</sup>         ,      —      ,       . </p><br><p> <sup>26</sup>     SDK       ,    Apple Music. Apple    ,   . </p><br><p> <sup>27</sup>       ,      —   . ,     Enterprise Partner Feed, musicbrainz,          API.  ,       ( <em>       </em> )    .      ,         . </p><br><p> <sup>28</sup> RIP </p><br><p> <sup>29</sup>   API  Bing </p><br><p> <sup>30</sup>        </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464811/">https://habr.com/ru/post/zh-CN464811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464791/index.html">汽车用Kubernetes：如何打开开发人员对车载计算机的访问权限并使其安全</a></li>
<li><a href="../zh-CN464795/index.html">快活的Quartusel或处理器如何变成这样的生活</a></li>
<li><a href="../zh-CN464803/index.html">“隐藏www”：为什么主流浏览器开发人员再次拒绝显示该子域</a></li>
<li><a href="../zh-CN464805/index.html">在ipad上写蛇（pythonista）</a></li>
<li><a href="../zh-CN464809/index.html">我们如何测试人脸识别技术以及它的结果</a></li>
<li><a href="../zh-CN464813/index.html">用autohotkey上的脚本替换Punto Switcher，Birman布局</a></li>
<li><a href="../zh-CN464819/index.html">我与Haiku的第六天：在资源，图标和程序包的掩护下</a></li>
<li><a href="../zh-CN464823/index.html">我们考虑了“数据科学家”的平均工资。 使用熊猫/ python的Parsim hh.ru</a></li>
<li><a href="../zh-CN464825/index.html">为Android Q准备应用程序。第2部分</a></li>
<li><a href="../zh-CN464831/index.html">将Razor Pages功能添加到标准.NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>