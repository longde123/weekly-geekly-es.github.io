<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ô¶Ô∏è ‚õπüèº üöµüèæ No cargue, no pruebe: c√≥mo identificamos problemas con el sistema de gesti√≥n de documentos VTB üëô üôÑ üë®üèæ‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recientemente, VTB ha cambiado algunos de los componentes de hardware y software del sistema de flujo de trabajo. Los cambios fueron demasiado signifi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>No cargue, no pruebe: c√≥mo identificamos problemas con el sistema de gesti√≥n de documentos VTB</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vtb/blog/467647/">  Recientemente, VTB ha cambiado algunos de los componentes de hardware y software del sistema de flujo de trabajo.  Los cambios fueron demasiado significativos para continuar trabajando sin pruebas de carga a gran escala: cualquier problema con el sistema de soporte de documentos (LMS) est√° plagado de grandes p√©rdidas. <br><br><img src="https://habrastorage.org/webt/yc/vo/e5/ycvoe5se_fq1pfmmaumbgodslew.jpeg"><br><br>  Los especialistas de Intertrust probaron VTB SDO en equipos Huawei: un complejo de granja de servidores, red de datos y almacenamiento basado en unidades de estado s√≥lido.  Para las pruebas, creamos un entorno que reproduc√≠a escenarios reales con la carga m√°xima posible.  Resultados y conclusiones - debajo del corte. <br><a name="habracut"></a><br><h2>  ¬øPor qu√© necesitamos un sistema de flujo de trabajo en un banco y por qu√© probarlo? </h2><br>  LMS en VTB es un paquete de software complejo, en el que est√°n vinculados todos los procesos de gesti√≥n de claves.  El sistema proporciona servicios de documentaci√≥n general, interacci√≥n electr√≥nica, an√°lisis.  Una circulaci√≥n de documentos debidamente organizada acelera las decisiones de gesti√≥n, hace que el proceso de su adopci√≥n sea transparente y controlado, mejora la calidad de la gesti√≥n y mejora la competitividad del banco. <br><br>  El LMS debe garantizar una implementaci√≥n clara de las decisiones de acuerdo con las regulaciones establecidas.  Esto requiere alto rendimiento, tolerancia a fallas, escalado flexible.  El sistema tiene altos requisitos para el control de acceso, el volumen de documentos procesados ‚Äã‚Äãsimult√°neamente y la cantidad de usuarios.  Ahora hay 65 mil de ellos en VTB SDO, y este n√∫mero contin√∫a creciendo. <br><br>  El sistema est√° en constante evoluci√≥n: la arquitectura est√° cambiando, las tecnolog√≠as obsoletas est√°n siendo reemplazadas por otras modernas.  Y recientemente, algunos de los componentes del sistema fueron reemplazados por componentes independientes de importaci√≥n, sin software propietario.  ¬øLa nueva arquitectura SDO basada en el software CompanyMedia y el complejo de hardware de Huawei manejar√°n el aumento de carga?  Responda inequ√≠vocamente a esta pregunta, sin esperar una situaci√≥n similar en la realidad, solo fue posible con la ayuda de pruebas de estr√©s. <br><br>  Adem√°s de probar el nuevo producto de software para la resistencia al estr√©s, tuvimos las siguientes tareas: <br><br><ul><li>  determinar los par√°metros exactos del tama√±o horizontal y vertical de los servidores para el perfil de carga bancaria; <br></li><li>  verificar los componentes para tolerancia a fallas bajo condiciones de alta carga; <br></li><li>  para identificar el coeficiente de entrop√≠a de interacci√≥n entre grupos con escala horizontal; <br></li><li>  intente escalar solicitudes de lectura cuando use el equilibrador de plataforma; <br></li><li>  determinar el coeficiente de escala horizontal de todos los nodos y componentes del sistema; <br></li><li>  determinar los par√°metros de hardware m√°ximos posibles de los servidores para diversos fines funcionales (escala vertical); <br></li><li>  estudiar el perfil de carga de la aplicaci√≥n en la infraestructura t√©cnica, para aproximar los resultados para planificar el desarrollo del sistema de informaci√≥n; <br></li><li>  Investigue el impacto de la consolidaci√≥n de datos de aplicaciones en un √∫nico sistema de almacenamiento de datos en la optimizaci√≥n de recursos, mejorando la confiabilidad y el rendimiento. <br></li></ul><br><h2>  Metodolog√≠a y equipamiento </h2><br>  Las pruebas de carga de los sistemas de gesti√≥n de documentos electr√≥nicos a menudo se llevan a cabo de acuerdo con escenarios simplificados.  Simulan la b√∫squeda r√°pida y la apertura de tarjetas de documentos que no est√°n asociadas con otros archivos y que no tienen un historial de ciclo de vida.  En este caso, por regla general, nadie tiene en cuenta los derechos de acceso y otros factores que consumen recursos caracter√≠sticos de las condiciones reales. <br><br>  A menudo, estas pruebas de divorcio son realizadas por proveedores de soluciones.  Es comprensible: es importante que un proveedor demuestre a un cliente potencial el alto rendimiento y la velocidad del sistema.  No es sorprendente que los modelos de prueba simplificados muestren tiempos de respuesta r√©cord del sistema, incluso si el n√∫mero de usuarios y documentos aumenta significativamente. <br><br>  Necesit√°bamos reproducir las condiciones operativas reales.  Por lo tanto, al principio, recopilamos estad√≠sticas durante un mes: registramos la actividad del usuario, observamos el trabajo de fondo de todos los servicios.  Los sistemas de monitoreo integrados en el LMS se convirtieron en una gran ayuda en este asunto.  Los empleados del banco ayudaron a corregir los datos resultantes en los flujos de documentos, mientras que realizamos ajustes para el crecimiento proyectado en los flujos. <br><br>  El resultado fue una metodolog√≠a de prueba, con la ayuda de la cual fue posible simular los procesos que ocurren en el sistema, teniendo en cuenta todas las cargas reales.  En el banco de pruebas, reprodujimos, individualmente y en varias combinaciones, las operaciones comerciales m√°s comunes, as√≠ como las solicitudes que requieren m√°s tiempo.  Durante las pruebas de rendimiento, todos los componentes fueron sometidos a estr√©s.  Se realizaron operaciones para calcular los derechos de acceso de los usuarios a los objetos del sistema, abrir documentos con una jerarqu√≠a ramificada compleja y una gran cantidad de enlaces, buscar en el sistema, etc. <br><br><h3>  Perfil de prueba de carga: </h3><br><ul><li>  usuarios registrados: 65 mil con un aumento de hasta 150 mil; <br></li><li>  frecuencia de inicios de sesi√≥n de usuarios (autenticaciones): 50 mil por hora; <br></li><li>  usuarios que trabajan simult√°neamente en el sistema: 10 mil; <br></li><li>  documentos registrados: 10 millones por a√±o; <br></li><li>  volumen de archivos adjuntos: 1 TB por a√±o; <br></li><li>  procesos de aprobaci√≥n de documentos: 1,5 millones por a√±o; <br></li><li>  visas de las partes del acuerdo: 7.5 millones por a√±o; <br></li><li>  resoluciones e instrucciones: 15 millones por a√±o; <br></li><li>  informes sobre resoluciones e instrucciones: 15 millones por a√±o; <br></li><li>  tareas de usuario: 18 millones por a√±o. <br></li></ul><br>  Estas aplicaciones se consolidaron en un solo sistema de almacenamiento Huawei OceanStor Dorado 6000 V3 con 117 unidades SSD de 3.6 TB cada una, el volumen total utilizable es m√°s de 300 TB.  La potencia de c√°lculo se coloc√≥ en el sistema de servidor modular de Huawei E9000, y los datos se transmitieron a trav√©s de la red en funci√≥n de los conmutadores del nivel del centro de datos de la serie Huawei CE.  Durante la prueba, observamos durante todo el d√≠a todos los indicadores del sistema.  Todos los resultados, incluidos los datos hist√≥ricos, se registraron en forma de gr√°ficos y tablas para su posterior an√°lisis. <br><br><h3>  Servidores de infraestructura de hardware de prueba de carga </h3><br><br><img src="https://habrastorage.org/webt/_e/2s/jw/_e2sjwzdxhukjiw-glhk_vj3j98.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b4/1e0/a74/9b41e0a74f08b980c948037de04d525a.png"><br><br>  Debido al alto rendimiento del sistema de almacenamiento Huawei OceanStor Dorado 6000 V3, los retrasos al realizar cualquier solicitud del usuario rara vez superan 1 ms.  Esta velocidad del subsistema de disco de la aplicaci√≥n nos inspir√≥ a seguir investigando.  Decidimos, al analizar datos hist√≥ricos, determinar el efecto de varios tipos de cargas de trabajo en la infraestructura t√©cnica.  Los resultados obtenidos nos permiten planificar de manera flexible y precisa el desarrollo del sistema de acuerdo con los requisitos para la plataforma de hardware. <br><br><h3>  En t√©rminos de escala, verificamos: </h3><br><ul><li>  l√≠mite de escalado vertical del <b>servidor de aplicaciones (CMJ)</b> , recursos cr√≠ticos: n√∫mero de n√∫cleos y frecuencia, cantidad de RAM; <br></li><li>  soporte para escalado horizontal del <b>servidor de aplicaciones (CMJ)</b> mediante la duplicaci√≥n de servicios funcionalmente id√©nticos y el equilibrio entre ellos; <br></li><li>  l√≠mites de escala vertical y horizontal del <b>servidor del cliente (Web-GUI)</b> ; <br></li><li>  l√≠mites de escala vertical del <b>almacenamiento</b> de <b>archivos (FS)</b> , recursos cr√≠ticos: ancho de banda de red, velocidad de disco; <br></li><li>  soporte para escalado horizontal del <b>almacenamiento</b> de <b>archivos (FS)</b> debido al sistema de archivos distribuido - CEPH, GLUSTERFS; <br></li><li>  l√≠mites de escalado vertical de <b>la base</b> de <b>datos (PostgreSQL)</b> , recursos seg√∫n el grado de criticidad: capacidad de RAM, velocidad de disco, n√∫mero de n√∫cleos y frecuencia; <br></li><li>  soporte para el escalado horizontal de la <b>base de datos (PostgreSQL)</b> : escalar la carga de lectura en servidores esclavos, escalar la carga de escritura seg√∫n el principio de dividir en m√≥dulos funcionales; <br></li><li>  l√≠mites de escala vertical y horizontal del <b>intermediario de mensajes (Apache Artemis)</b> ; <br></li><li>  l√≠mites de escala vertical y horizontal del <b>servidor de b√∫squeda (Apache Solr)</b> . <br></li></ul><br><h2>  Problemas y soluciones </h2><br>  Una de las tareas principales era identificar posibles problemas con el rendimiento del LMS.  Durante el trabajo, se identificaron los siguientes cuellos de botella y se encontraron formas de abordarlos. <br><br>  <b>Bloquea el registro sincr√≥nico.</b>  Las operaciones de registro en la configuraci√≥n est√°ndar de WildFly se realizan sincr√≥nicamente y afectan en gran medida el rendimiento.  Se decidi√≥ cambiar a un registrador as√≠ncrono y, al mismo tiempo, escribir no en un disco, sino en el sistema de agregaci√≥n de registros ELK. <br><br>  <b>Inicializaci√≥n de sesiones innecesarias cuando se trabaja con un almac√©n de datos.</b>  Cada subproceso que recibi√≥ datos del repositorio inicializ√≥ dos veces una sesi√≥n para autenticaci√≥n en modo SSO.  Esta operaci√≥n requiere muchos recursos y aumenta en gran medida el tiempo de ejecuci√≥n de la solicitud del usuario, y tambi√©n reduce el rendimiento general del servidor. <br><br>  <b>Se bloquea al trabajar con objetos de cach√© de aplicaciones.</b>  La aplicaci√≥n us√≥ bloqueos reentrantLock bastante pesados ‚Äã‚Äã(Java 7), que afectaron negativamente la velocidad de ejecuci√≥n de la consulta.  El tipo de bloqueo se cambi√≥ a stampedLock, lo que redujo significativamente el tiempo dedicado a trabajar con objetos de cach√©. <br><br>  Despu√©s de eso, nuevamente lanzamos pruebas de carga para determinar el tiempo promedio de operaciones t√≠picas en el sistema LMS con almacenamiento relacional en el perfil del banco.  Obtuvimos los siguientes resultados: <br><br><ul><li>  autorizaci√≥n de usuario en el sistema - 400 ms; <br></li><li>  viendo el progreso en promedio - 2.5 s; <br></li><li>  creaci√≥n de una tarjeta de registro y control - 1.4 s; <br></li><li>  registro y registro de tarjeta de control - 600 ms; <br></li><li>  creaci√≥n de una resoluci√≥n - 1 p. <br></li></ul><br><h2>  Conclusiones </h2><br>  Adem√°s de identificar problemas, las pruebas de estr√©s han confirmado algunos de nuestros supuestos. <br><br><ul><li>  El sistema funciona mucho mejor en la familia de sistemas operativos Linux. <br></li><li>  Los principios declarados para garantizar la tolerancia a fallos funcionan a nivel de cada componente en modo "activo". <br></li><li>  Un componente clave, el servicio de l√≥gica de negocios (que acepta las solicitudes de los usuarios), tiene una escala horizontal "espejo" y una escala de rendimiento casi lineal con un aumento en el n√∫mero de instancias. <br></li><li>  Dimensionamiento √≥ptimo del servicio de l√≥gica de negocios para 1200 usuarios simult√°neos: 8 vCPU para el servicio y 1.5 vCPU para el DBMS. <br></li><li>  La consolidaci√≥n de los datos de la aplicaci√≥n en un solo sistema de almacenamiento aumenta significativamente la productividad y la confiabilidad, aumenta la escalabilidad. <br></li></ul><br>  Estaremos encantados de responder sus preguntas en los comentarios; tal vez le interese aprender m√°s sobre algunos aspectos de las pruebas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/467647/">https://habr.com/ru/post/467647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../467629/index.html">El libro "Realidad irreal. Viajando por el bucle cu√°ntico ¬ª</a></li>
<li><a href="../467631/index.html">Vistas de contexto de JavaScript</a></li>
<li><a href="../467633/index.html">Petici√≥n: Informe autom√°tico y pago de impuestos sobre los ingresos de FLP (Ucrania)</a></li>
<li><a href="../467639/index.html">Semana de la seguridad 38: seguimiento de dispositivos m√≥viles mediante tarjeta SIM</a></li>
<li><a href="../467645/index.html">Siguiendo a Angular Meetup # 15</a></li>
<li><a href="../467653/index.html">Habrastatistics: an√°lisis de comentarios de los lectores</a></li>
<li><a href="../467655/index.html">C√≥mo pas√© el verano con C # 8</a></li>
<li><a href="../467657/index.html">Inventario de la I a la Z. Contamos las licencias de software</a></li>
<li><a href="../467659/index.html">Acelere significativamente la ejecuci√≥n de tareas con el ejemplo de configuraci√≥n adicional de la memoria HyperX FURY DDR4 actualizada</a></li>
<li><a href="../467661/index.html">Dos√≠metro para Seryozha. Parte I. Polimaster - Nuclide Hunters</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>