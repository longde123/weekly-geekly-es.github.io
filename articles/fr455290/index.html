<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úàÔ∏è üåÖ üèä Le guide complet de Prom√©th√©e en 2019 ‚öïÔ∏è üèÑ üë®üèª‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les ing√©nieurs DevOps et SRE ont probablement entendu parler de Prometheus plus d'une fois. 


 Prometheus a √©t√© cr√©√© √† SoundCloud en 2012 et est depu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le guide complet de Prom√©th√©e en 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/455290/"><p><img src="https://habrastorage.org/webt/sw/aw/et/swawetpfrgxw6k0m4bb960d3q2c.jpeg"></p><br><p>  <strong>Les ing√©nieurs DevOps et SRE</strong> ont probablement entendu parler de <strong>Prometheus</strong> plus d'une fois. </p><br><p>  Prometheus a √©t√© cr√©√© √† SoundCloud en 2012 et est depuis devenu la norme pour <strong>les syst√®mes de surveillance</strong> .  Il a un code source compl√®tement ouvert, il fournit des dizaines d'exportateurs diff√©rents avec lesquels vous pouvez configurer la <strong>surveillance de l'ensemble de l'infrastructure en</strong> <strong>quelques minutes</strong> . </p><br><p>  Prometheus a une valeur √©vidente et est d√©j√† utilis√© par des innovateurs de l'industrie comme DigitalOcean ou Docker dans le cadre d'un syst√®me de surveillance complet. </p><br><p>  <em>Qu'est-ce que Prom√©th√©e?</em> <em><br></em>  <em>Pourquoi est-il n√©cessaire?</em> <em><br></em>  <em>En quoi est-il diff√©rent des autres syst√®mes?</em> </p><br><p> Si vous ne savez rien du tout sur Prom√©th√©e ou souhaitez mieux le comprendre, son √©cosyst√®me et toutes ses interactions, <strong>cet article est fait pour vous</strong> . </p><a name="habracut"></a><br><p>  Nous avons divis√© ce guide en 3 parties, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme nous l'avons fait avec InfluxDB</a> . </p><br><ul><li>  Vient d'abord un aper√ßu complet de <strong>Prometheus</strong> , de son √©cosyst√®me et des aspects cl√©s de la technologie en √©volution rapide. </li><li>  Ensuite, des <strong>explications sur les termes techniques de Prometheus</strong> sont fournies.  Si vous ne savez pas ce que sont les m√©triques, les √©tiquettes, les instances ou les exportateurs, vous √™tes ici. </li><li>  Enfin, nous d√©crivons divers <strong>sc√©narios du monde r√©el pour l'utilisation de Prometheus</strong> .  Ici, vous serez inspir√© par des exemples d'entreprises prosp√®res. </li></ul><br><h2 id="chast-i-chto-takoe-prometheus">  Partie I. Qu'est-ce que Prom√©th√©e? </h2><br><p>  Prometheus est une base de donn√©es de s√©ries chronologiques.  Si vous ne savez pas ce qu'est une base de donn√©es de s√©ries chronologiques, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lisez la premi√®re partie du manuel InfluxDB</a> . </p><br><p>  Mais Prometheus n'est pas seulement une base de donn√©es de s√©ries chronologiques. </p><br><p>  Vous pouvez y attacher un <strong>√©cosyst√®me complet d'outils</strong> pour √©tendre les fonctionnalit√©s. </p><br><p>  Prometheus <strong>surveille une grande vari√©t√© de syst√®mes</strong> : serveurs, bases de donn√©es, machines virtuelles individuelles et presque tout. </p><br><p>  Pour ce faire, <strong>Prometheus gratte p√©riodiquement ses cibles</strong> . </p><br><p>  <em>Qu'est-ce que le grattage?</em> </p><br><p>  Prometheus <strong>r√©cup√®re les m√©triques via des appels HTTP</strong> vers des points de terminaison sp√©cifiques sp√©cifi√©s dans la configuration Prometheus. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/bu/li/99/buli99giwtpiuq88n9e3xc1b6ng.png"></a> </p><br><p>  Prenons, par exemple, l'application Web situ√©e sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 3000</a> .  L'application transmet des m√©triques au format texte √† une URL.  Disons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 3000 / metrics</a> . </p><br><p>  √Ä cette adresse, Prometheus <strong>r√©cup√®re les donn√©es</strong> de la cible √† des intervalles sp√©cifiques. </p><br><h3 id="1-kak-rabotaet-prometheus">  1. Comment fonctionne Prom√©th√©e? </h3><br><p>  Comme nous l'avons dit, Prometheus se compose d'une grande vari√©t√© de composants. </p><br><p>  Tout d'abord, vous en avez besoin pour extraire des m√©triques de vos syst√®mes.  Il existe diff√©rentes mani√®res: </p><br><ul><li>  <strong>L'instrumentation de l'</strong> application, c'est-√†-dire que votre application fournira des mesures compatibles avec Prometheus √† l'URL sp√©cifi√©e.  Prom√©th√©e l'identifiera comme la cible et la supprimera √† l'intervalle sp√©cifi√©. </li><li>  Utilisation d' <strong>exportateurs pr√™ts √† l'emploi</strong> .  Prometheus poss√®de une collection d'exportateurs pour les technologies existantes.  Par exemple, des exportateurs pr√™ts √† l'emploi pour surveiller les machines Linux ( <em>Node Exporter</em> ), pour les bases de donn√©es courantes ( <em>SQL Exporter</em> ou <em>MongoDB Exporter</em> ), et m√™me pour les √©quilibreurs de charge HTTP (par exemple, <em>HAProxy Exporter</em> ). </li><li>  Utilisation de <strong>Pushgateway</strong> .  Parfois, les applications ou les t√¢ches ne fournissent pas de m√©triques directement.  Ils peuvent ne pas √™tre con√ßus pour cela (par exemple, les travaux par lots) ou vous-m√™me avez d√©cid√© de ne pas fournir de m√©triques directement via l'application. </li></ul><br><p>  Comme vous l'avez d√©j√† compris, <strong>Prometheus collecte elle-m√™me les donn√©es</strong> (sauf dans les rares cas o√π nous utilisons Pushgateway). </p><br><p> <a href=""><img src="https://habrastorage.org/webt/x8/x5/xl/x8x5xlzryccoxhuk0ly10m4z0ky.png"></a> </p><br><p>  <em>Qu'est-ce que cela signifie?</em> <em><br></em>  <em>Pourquoi est-ce n√©cessaire?</em> </p><br><h3 id="2-sbor-vs-otpravka">  2. Collection vs  envoi </h3><br><p>  Prometheus a une diff√©rence notable par rapport aux autres bases de donn√©es de s√©ries chronologiques: <strong>il scanne activement les cibles pour en obtenir des m√©triques</strong> . </p><br><p>  InfluxDB, par exemple, fonctionne diff√©remment: vous lui <strong>envoyez</strong> directement <strong>des donn√©es</strong> . </p><br><p> <a href=""><img src="https://habrastorage.org/webt/hp/f5/of/hpf5ofsciuwl0z2jjymkfh9dbi0.png"></a> </p><br><p>  Les deux approches ont leurs avantages et leurs inconv√©nients.  Sur la base de la documentation disponible, nous avons compil√© une liste de raisons pour lesquelles les cr√©ateurs de Prometheus ont choisi cette architecture: </p><br><ul><li>  <strong>Contr√¥le centralis√©</strong> .  Si Prometheus envoie des demandes aux cibles, nous effectuons toute la configuration du c√¥t√© Prometheus, pas les syst√®mes individuels. </li></ul><br><p>  Prom√©th√©e d√©cide <strong>o√π</strong> et √† <strong>quelle fr√©quence</strong> gratter. </p><br><p>  Si les objets eux-m√™mes envoient des donn√©es, il y a un risque que ces donn√©es soient trop nombreuses et que le serveur tombe en panne.  Lorsque le syst√®me collecte des donn√©es, vous pouvez <strong>contr√¥ler la fr√©quence de collecte</strong> et cr√©er plusieurs configurations de grattage pour s√©lectionner une <strong>fr√©quence diff√©rente pour diff√©rents objets</strong> . </p><br><ul><li>  Prometheus stocke <strong>des m√©triques agr√©g√©es</strong> . </li></ul><br><p>  Ceci est un ajout √† la premi√®re partie o√π nous avons discut√© du r√¥le de Prom√©th√©e. </p><br><p>  Prometheus n'est pas bas√© sur des √©v√©nements et est tr√®s diff√©rent des autres bases de donn√©es de s√©ries chronologiques.  Il n'intercepte pas les √©v√©nements individuels avec une r√©f√©rence √† l'heure (par exemple, les pannes de service), <strong>mais recueille des m√©triques pr√©-agr√©g√©es sur vos services</strong> . </p><br><p>  Plus pr√©cis√©ment, le service Web n'envoie pas de message d'erreur 404 et un message avec la cause de l'erreur.  Un message est envoy√© indiquant que le service a re√ßu un message d'erreur 404 au cours des cinq derni√®res minutes. </p><br><p>  Il s'agit de la principale diff√©rence entre les bases de donn√©es de s√©ries chronologiques qui collectent des m√©triques agr√©g√©es et celles qui collectent des m√©triques brutes. </p><br><h3 id="3-razvitaya-ekosistema-prometheus">  3. √âcosyst√®me Prometheus d√©velopp√© </h3><br><p>  Essentiellement, Prometheus est une base de donn√©es de s√©ries chronologiques. </p><br><p>  Mais lorsque vous travaillez avec de telles bases de donn√©es, vous devez souvent <strong>visualiser les</strong> donn√©es, les <strong>analyser</strong> et configurer des <strong>alertes</strong> pour elles. </p><br><p>  Prometheus prend en charge les outils suivants qui √©tendent ses fonctionnalit√©s: </p><br><ul><li>  <strong>Alertmanager</strong> .  Prometheus envoie des alertes √† Alertmanager en fonction de r√®gles personnalis√©es d√©finies dans les fichiers de configuration.  De l√†, ils peuvent √™tre export√©s vers diff√©rents points de terminaison (par exemple, Pagerduty ou Slack). </li><li>  <strong>Visualisation des donn√©es</strong> .  Comme Grafana, vous pouvez visualiser les s√©ries chronologiques directement dans l'interface utilisateur Web de Prometheus.  Vous pouvez filtrer les donn√©es et cr√©er des revues sp√©cifiques de ce qui se passe dans diff√©rentes cibles. </li><li>  <strong>D√©couverte de service</strong> .  Prometheus d√©tecte dynamiquement les cibles et gratte automatiquement les nouvelles cibles sur demande.  Cela est particuli√®rement pratique si vous travaillez avec des conteneurs qui modifient dynamiquement les adresses en fonction de la demande. </li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/vn/v8/hw/vnv8hwhdgfwge_zr4fpijo-dw6w.png"></a> </p><br><p><img src="https://habrastorage.org/webt/c0/i6/9g/c0i69gzbicfmvsaangv6g5-4jpa.png"></p><br><h2 id="chast-ii-koncepcii-prometheus">  Partie II  Concepts de Prom√©th√©e </h2><br><p>  Comme dans le manuel InfluxDB, nous expliquerons en d√©tail <strong>les termes techniques</strong> li√©s √† Prometheus. </p><br><h3 id="1-model-dannyh-klyuch-znachenie">  1. Mod√®le de donn√©es de valeur-cl√© </h3><br><p>  Avant de passer aux outils Prometheus, il est important de bien comprendre ce mod√®le de donn√©es. </p><br><p>  Prometheus fonctionne avec <strong>des paires cl√©-valeur</strong> .  La cl√© d√©crit ce que nous mesurons et la valeur stocke la valeur r√©elle sous forme de nombre. </p><br><blockquote>  N'oubliez pas: Prometheus n'est pas con√ßu pour stocker des informations brutes, telles que du texte brut.  Il stocke des m√©triques agr√©g√©es sur une p√©riode de temps. </blockquote><p>  Dans ce cas, la cl√© est appel√©e <strong>m√©trique</strong> .  Il s'agit, par exemple, de la vitesse du processeur ou de l'utilisation de la m√©moire. </p><br><p>  <em>Mais que se passe-t-il si vous avez besoin de plus de d√©tails sur la mesure?</em> <em><br></em>  <em>Par exemple, le processeur a 4 c≈ìurs et nous avons besoin de 4 mesures distinctes?</em> </p><br><p>  Et ici, les raccourcis viennent √† la rescousse.  Les raccourcis fournissent plus d'informations sur les mesures en ajoutant des champs suppl√©mentaires.  Par exemple, vous d√©crivez non seulement la vitesse du processeur, mais la vitesse d'un c≈ìur sur une adresse IP sp√©cifique. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/k3/an/wz/k3anwzmbgecefriltntgwfkge3o.png"></a> </p><br><p>  Ensuite, vous pouvez filtrer les m√©triques par √©tiquettes et afficher uniquement les informations dont vous avez besoin. </p><br><h3 id="2-tipy-metrik">  2. Types de m√©triques </h3><br><p>  Lors de la surveillance avec Prometheus, les mesures peuvent √™tre d√©crites de quatre mani√®res.  Il vaut mieux le lire jusqu'au bout, car il y a des <strong>pi√®ges</strong> ici. </p><br><h3 id="schetchik">  Comptoir </h3><br><p>  Il s'agit probablement du type de mesure le plus simple.  Le compteur, comme son nom l'indique, <strong>compte les √©l√©ments pendant un certain temps</strong> . </p><br><p>  Si vous souhaitez compter, par exemple, les erreurs HTTP sur les serveurs ou visiter un site Web, utilisez un <strong>compteur</strong> . </p><br><p>  Et logiquement, bien s√ªr, le <strong>compteur ne peut qu'augmenter ou mettre √† z√©ro le nombre</strong> , il n'est donc pas adapt√© aux valeurs qui peuvent diminuer, ou aux valeurs n√©gatives. </p><br><p>  Avec son aide, il est particuli√®rement pratique de consid√©rer le <strong>nombre d'occurrences d'un</strong> certain √©v√©nement sur une p√©riode de temps, c'est-√†-dire le taux de changement de la m√©trique dans le temps. </p><br><p>  <em>Et si vous avez besoin de mesurer, disons, la m√©moire utilis√©e pendant une certaine p√©riode?</em> <em><br></em>  <em>Cette valeur peut diminuer.</em>  <em>Comment le compter avec Prom√©th√©e?</em> </p><br><h3 id="izmeriteli">  M√®tres </h3><br><p>  <strong>Rencontrez les compteurs!</strong> </p><br><p>  Les compteurs traitent des valeurs qui <strong>peuvent diminuer avec le temps</strong> .  Ils peuvent √™tre compar√©s aux thermom√®tres - si vous regardez le thermom√®tre, nous verrons la temp√©rature actuelle. </p><br><p>  <em>Mais si les compteurs peuvent augmenter et diminuer et prendre des valeurs positives et n√©gatives, alors il s'av√®re qu'ils sont meilleurs que les compteurs?</em> <em><br></em>  <em>Les compteurs sont donc inutiles?</em> </p><br><p>  Au d√©but, je le pensais.  Puisqu'ils peuvent tout faire, utilisons-les partout.  Est-ce logique? </p><br><h3 id="a-vot-i-net">  Mais non. </h3><br><p>  Les compteurs sont id√©aux pour mesurer la valeur m√©trique actuelle, qui peut diminuer avec le temps. </p><br><p>  C'est l√† que se trouvent les pi√®ges m√™mes: le compteur ne montre pas le d√©veloppement de la m√©trique sur une p√©riode de temps.  √Ä l'aide de compteurs, <strong>vous pouvez manquer des changements m√©triques irr√©guliers au fil du temps</strong> . </p><br><p>  Pourquoi?  Voici ce que <em>/ u / justinDavidow dit</em> : </p><br><blockquote>  ¬´Le compteur montre la valeur moyenne du compteur delta pour une unit√© sur une p√©riode de temps. <br><br>  Le compteur prend en compte chaque unit√© utilis√©e (s'il s'agit d'un processeur, puis des op√©rations, des cycles ou des ticks), puis vous pouvez choisir les indicateurs pour quelle p√©riode vous avez besoin. <br><br>  Si vous utilisez un lecteur, la fr√©quence d'√©chantillonnage doit √™tre pr√©cise.  Si la fr√©quence diff√®re d'au moins quelques microsecondes, la valeur ne sera pas fiable.  "Ceci est encore plus visible sous une charge √©lev√©e, o√π le temps entre les mesures augmente de fa√ßon exponentielle, car le planificateur du syst√®me n'a pas le temps de pr√™ter attention √† l'application de surveillance." </blockquote><p>  Si le syst√®me envoie des m√©triques toutes les 5 secondes et que Prometheus √©limine la cible toutes les 15, certaines m√©triques peuvent √™tre perdues au cours du processus.  Si vous effectuez des calculs suppl√©mentaires avec ces mesures, la pr√©cision des r√©sultats sera encore plus faible. </p><br><p>  Au comptoir, chaque valeur est agr√©g√©e.  Lorsque Prom√©th√©e le r√©cup√®re, il se rend compte que la valeur a √©t√© envoy√©e √† un certain intervalle. </p><br><p>  Maintenant, ne vous trompez pas. </p><br><h3 id="gistogramma">  Graphique √† barres </h3><br><p>  Un histogramme est un type de m√©trique plus complexe.  Il fournit des informations suppl√©mentaires.  Par exemple, la somme des mesures et leur nombre. </p><br><p>  Les valeurs sont collect√©es dans une zone avec une limite sup√©rieure personnalis√©e.  Par cons√©quent, un histogramme peut: </p><br><ul><li>  <strong>Calculez les valeurs moyennes</strong> , c'est-√†-dire la somme des valeurs divis√©e par le nombre de valeurs. </li><li>  <strong>Calculez les mesures relatives des valeurs</strong> , et cela est tr√®s pratique si vous avez besoin de savoir combien de valeurs dans une certaine zone correspondent aux crit√®res sp√©cifi√©s.  Cela est particuli√®rement utile si vous devez suivre les proportions ou d√©finir des indicateurs de qualit√©. </li></ul><br><p>  Dans le monde r√©el, j'aimerais recevoir une alerte si 20% de mes serveurs ont une r√©ponse de plus de 300 ms ou une r√©ponse de serveur de plus de 300 ms plus de 20% du temps. </p><br><p>  Si vous avez affaire √† des proportions, <strong>vous avez besoin d'histogrammes</strong> . </p><br><h3 id="svodki">  R√©sum√© </h3><br><p>  Les tableaux de bord <strong>sont des histogrammes avanc√©s</strong> .  Ils montrent √©galement la somme et le nombre de mesures, ainsi que les <strong>quantiles pour la p√©riode en mouvement</strong> . </p><br><p>  Les quantiles, le cas √©ch√©ant, divisent la densit√© de probabilit√© en segments de probabilit√© √©gale. </p><br><p>  <em>Alors: graphiques √† barres ou r√©sum√©s?</em> </p><br><p>  Tout d√©pend de l' <strong>intention</strong> . </p><br><p>  Les histogrammes combinent des valeurs sur une p√©riode de temps, fournissant la quantit√© et la quantit√© gr√¢ce auxquelles vous pouvez suivre le d√©veloppement d'une m√©trique particuli√®re. </p><br><p>  Les r√©sum√©s, d'autre part, montrent des quantiles sur une p√©riode en mouvement (c'est-√†-dire un d√©veloppement continu dans le temps). </p><br><p>  Ceci est particuli√®rement pratique si vous avez besoin de conna√Ætre une valeur qui repr√©sente 95% des valeurs enregistr√©es sur une p√©riode. </p><br><h3 id="3-zadaniya-i-ekzemplyary">  3. T√¢ches et instances </h3><br><p>  Compte tenu des progr√®s r√©cents des architectures distribu√©es et de la popularit√© des solutions bas√©es sur le cloud, il est peu probable que vous utilisiez un seul serveur fonctionnant seul. </p><br><p>  <strong>Les serveurs sont r√©pliqu√©s et distribu√©s dans le monde entier.</strong> </p><br><p>  Pour illustrer cela, regardons l'architecture classique de deux serveurs HAProxy qui redistribuent la charge sur neuf serveurs Web principaux ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">non, non, pas de piles Stackoverflow</a> ) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">.</a> </p><br><p>  Dans cet exemple r√©el, nous suivrons le <strong>nombre d'erreurs HTTP renvoy√©es par les serveurs Web</strong> . </p><br><p>  Dans Prometheus, un serveur Web est appel√© une <strong>instance</strong> .  <strong>La t√¢che</strong> consistera √† mesurer le nombre d'erreurs HTTP sur toutes les instances. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/3x/s4/n9/3xs4n94kpfhqg3igmcrlfjatube.png"></a> </p><br><p>  La beaut√© est que les t√¢ches et les instances sont des champs dans les √©tiquettes, et vous pouvez filtrer les r√©sultats par une instance ou une t√¢che sp√©cifique. </p><br><h3 id="udobno-zhe">  Est-ce pratique? </h3><br><h3 id="4-promql">  4. PromQL </h3><br><p>  Si vous utilisez des bases de donn√©es bas√©es sur InfluxDB, vous connaissez probablement d√©j√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">InfluxQL</a> .  Ou utilisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SQL dans TimescaleDB</a> . </p><br><p>  Prometheus poss√®de √©galement son propre langage d'interrogation et de r√©cup√©ration des donn√©es des serveurs: <strong>PromQL</strong> . </p><br><p>  Comme nous le savons d√©j√†, les donn√©es sont pr√©sent√©es sous forme de paires cl√©-valeur.  PromQL utilise la m√™me syntaxe et renvoie des r√©sultats en tant que vecteurs. </p><br><p>  <em>Quel genre de vecteurs?</em> </p><br><p>  Il existe deux types de vecteurs dans Prom√©th√©e et PromQL: </p><br><ul><li>  <strong>Des vecteurs instantan√©s</strong> qui repr√©sentent toutes les m√©triques par le dernier horodatage. </li><li>  <strong>Vecteurs avec une plage de temps</strong> : si vous avez besoin de regarder le d√©veloppement d'une m√©trique dans le temps, vous pouvez sp√©cifier une plage de temps dans une demande √† Prometheus.  En cons√©quence, vous obtiendrez un vecteur qui combine toutes les valeurs enregistr√©es pour la p√©riode s√©lectionn√©e. </li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/gs/ih/1_/gsih1_1lvftmhzgzuze3ctrlhci.png"></a> </p><br><p>  L'API PromQL fournit un ensemble de fonctions pour les op√©rations avec des donn√©es dans les requ√™tes. </p><br><p>  Vous pouvez trier les valeurs, leur appliquer des fonctions math√©matiques (par exemple, calculer des d√©riv√©es ou des exposants) et m√™me faire des pr√©dictions (par exemple, en utilisant le mod√®le Holt-Winters). </p><br><h3 id="5-instrumentirovanie">  5. Instrumentation </h3><br><p>  <strong>L'instrumentation</strong> est une autre partie importante de Prom√©th√©e.  Vous instrumentez les applications avant d'en extraire des donn√©es. </p><br><p>  Dans Prometheus, l'instrumentation signifie l'ajout de biblioth√®ques clientes √† l'application pour fournir des m√©triques Prometheus. </p><br><p>  L'instrumentation est disponible pour la plupart des langages de programmation courants: par exemple, <strong>Python, Java, Ruby, Go et m√™me Node ou C #</strong> . </p><br><p>  En substance, vous cr√©ez des objets de m√©moire (par exemple, des compteurs ou des compteurs) qui augmenteront ou diminueront dynamiquement la valeur. </p><br><p>  Ensuite, vous choisissez o√π fournir les m√©triques.  Prometheus les r√©cup√©rera √† partir de l√† et les enregistrera dans leur base de donn√©es de s√©ries chronologiques. </p><br><p><img src="https://habrastorage.org/webt/xi/-u/xk/xi-uxkqvgontz2729o5rmroyxkk.png"></p><br><h3 id="6-eksportery">  6. Exportateurs </h3><br><p>  Dans les applications que vous avez √©crites, il est tr√®s pratique de personnaliser les mesures fournies et de les modifier au fil du temps √† l'aide de l'instrumentation. </p><br><p>  Pour les applications, serveurs et bases de donn√©es bien connus, <strong>Prometheus propose des exportateurs avec lesquels vous pouvez surveiller les cibles</strong> . </p><br><p>  Ces exportateurs sont g√©n√©ralement repr√©sent√©s sous forme d'images Docker et sont faciles √† personnaliser.  Ils fournissent un ensemble de mesures pr√©d√©finies et des tableaux de bord souvent pr√™ts √† l'emploi avec lesquels vous pouvez configurer la surveillance en quelques minutes. </p><br><p>  Exemples d'exportateurs: </p><br><ul><li>  <strong>Exportateurs</strong> de bases de donn√©es: pour les bases de donn√©es MongoDB, les serveurs SQL et MySQL. </li><li>  <strong>Exportateurs HTTP</strong> : pour les serveurs HAProxy, Apache ou NGINX. </li><li>  <strong>Exportateurs Unix</strong> : les performances du syst√®me peuvent √™tre surveill√©es √† l'aide des exportateurs de n≈ìuds int√©gr√©s, qui fournissent toutes les m√©triques du syst√®me sans configuration suppl√©mentaire. </li></ul><br><p><img src="https://habrastorage.org/webt/7q/fm/uh/7qfmuhfszdwxa-k21na-hpko3tk.png"></p><br><h3 id="para-slov-o-vzaimnoy-sovmestimosti">  Quelques mots sur la compatibilit√© mutuelle </h3><br><p>  La plupart des bases de donn√©es de s√©ries chronologiques prennent en charge l'interop√©rabilit√© de leurs syst√®mes. </p><br><p>  Prometheus n'est pas le seul syst√®me de surveillance avec ses exigences m√©triques.  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">InfluxDB</a> (via Telegraf), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CollectD</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">StatsD</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nagios</a> ont √©galement leurs propres normes. </p><br><p>  Par cons√©quent, pour l'interaction de diff√©rents syst√®mes, des exportateurs sont cr√©√©s.  M√™me si Telegraf n'envoie pas les m√©triques au format accept√© par Prometheus, Telegraf peut envoyer ces m√©triques √† l'exportateur InfluxDB, d'o√π Prometheus les r√©cup√©rera ensuite. </p><br><h3 id="7-opovescheniya">  7. Alertes </h3><br><p>  Lorsque vous travaillez avec des bases de donn√©es de s√©ries chronologiques, vous avez besoin de la r√©troaction des donn√©es, et les gestionnaires d'alerte en sont responsables. </p><br><p>  √Ä Grafana, les alertes sont courantes, mais elles sont √©galement disponibles dans Prometheus via le gestionnaire d'alertes. </p><br><p>  <strong>Alert Manager est un outil distinct qui rejoint Prometheus et lance des sir√®nes personnalis√©es</strong> . </p><br><p>  Les alertes sont d√©finies dans le <strong>fichier de configuration</strong> et d√©finissent un ensemble de r√®gles pour les m√©triques.  Si la conformit√© √† la r√®gle se produit dans la s√©rie chronologique, une alerte est d√©clench√©e et envoy√©e aux destinataires sp√©cifi√©s. </p><br><p>  Comme dans Grafana, vous pouvez sp√©cifier l'adresse e-mail, le <strong>webhook Slack, PagerDuty et les objets HTTP personnalis√©s en</strong> tant que destinataire. </p><br><p><img src="https://habrastorage.org/webt/0x/xz/gf/0xxzgfpfufej_ro_ztjded5lbys.png"></p><br><h2 id="chast-iii-primery-ispolzovaniya-prometheus">  Partie III.  Exemples de Prom√©th√©e </h2><br><p><img src="https://habrastorage.org/webt/rq/6r/zk/rq6rzkeqnwe2xhzpukzx-hjdgi0.png"></p><br><p>  Et, bien s√ªr, chaque guide devrait avoir <strong>des exemples pratiques</strong> .  Comme j'aime √† le dire, la technologie n'est pas une fin en soi et doit remplir une t√¢che sp√©cifique. </p><br><p>  Nous en parlerons. </p><br><h2 id="1-devops">  1. DevOps </h2><br><p>  Avec tous ces exportateurs pour diff√©rents syst√®mes, bases de donn√©es et serveurs, il est √©vident que Prometheus est principalement destin√© √† l' <strong>industrie DevOps</strong> . </p><br><p>  Nous savons qu'il existe de nombreux fournisseurs concurrents et des solutions personnalis√©es dans ce domaine. </p><br><p>  <strong>Prometheus est parfait pour DevOps.</strong> </p><br><p>  L'installation et l'ex√©cution des instances ne n√©cessitent presque aucun effort et vous pouvez facilement activer et configurer n'importe quel outil auxiliaire. </p><br><p>  En <strong>d√©tectant des cibles</strong> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par exemple, via un exportateur de fichiers</a> - c'est une excellente solution pour les piles o√π les conteneurs et les architectures distribu√©es sont largement utilis√©s. </p><br><p>  Dans un environnement o√π les instances sont constamment cr√©√©es et supprim√©es, aucune pile DevOps ne peut se passer de la <strong>d√©couverte de service</strong> . </p><br><h3 id="2-zdravoohranenie">  2. Sant√© </h3><br><p>  Aujourd'hui, les solutions de surveillance sont n√©cessaires non seulement en informatique.  Ils sont √©galement utilis√©s dans les grandes industries qui fournissent des architectures de soins de sant√© flexibles et √©volutives. </p><br><p>  La demande augmente et les architectures informatiques doivent s'y conformer.  Si vous ne disposez pas d'un outil fiable pour surveiller l'ensemble de l'infrastructure, <strong>vous courez le risque de graves interruptions de service</strong> .  D√©j√† dans le secteur de la sant√©, un tel danger doit d√©finitivement √™tre minimis√©. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cet exemple a √©t√© abord√© sur opensource.com dans l'article suivant</a> . </p><br><h3 id="3-finansovye-uslugi">  3. Services financiers </h3><br><p>  Le dernier exemple a √©t√© donn√© lors de la conf√©rence InfoQ, qui a discut√© de l'utilisation de Prom√©th√©e dans les institutions financi√®res. </p><br><p>  Jamie Christian et Alan Strader montrent comment ils utilisent Prometheus pour surveiller leur infrastructure √† Northern Trust.  Tr√®s instructif, je vous conseille de regarder. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_WQ9DSanFdw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="chast-x-chto-dalshe">  Partie X. Et ensuite? </h2><br><p><img src="https://habrastorage.org/webt/mt/c6/ox/mtc6oxvnw8qk4fijh1ihciosuwy.png"></p><br><p>  Il est temps de passer de la <strong>th√©orie</strong> √† la <strong>pratique</strong> . </p><br><p>  Aujourd'hui, vous vous √™tes familiaris√© avec les bases de Prometheus, avez appris quelles fonctions il remplit, avec quels outils et syst√®mes il fonctionne et quels termes il utilise. </p><br><p>  <strong>Vous disposez</strong> maintenant de <strong>tout ce dont vous avez besoin pour cr√©er votre solution de surveillance</strong> . </p><br><p>  Pour commencer avec Prometheus, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©tudiez tous les exportateurs disponibles</a> . </p><br><p>  Installez ensuite les outils n√©cessaires, cr√©ez votre premier tableau de bord - et c'est parti! </p><br><p>  Si vous avez besoin d'inspiration, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lisez mon article sur la fa√ßon de surveiller une machine Linux avec Prometheus et Grafana</a> .  Il y a des instructions pour configurer les outils et le premier tableau de bord. </p><br><p>  J'esp√®re que vous avez appris quelque chose de nouveau. </p><br><p>  Si vous avez un sujet pour mon prochain article, partagez-le. </p><br><p>  <strong>Restez avec bonheur!</strong> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455290/">https://habr.com/ru/post/fr455290/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455276/index.html">Jeux cloud: le service Google Stadia annonce la tarification des utilisateurs</a></li>
<li><a href="../fr455280/index.html">R√©ponse du psychiatre √† l'article "Malade en bonne sant√©"</a></li>
<li><a href="../fr455284/index.html">Alexey Savvateev et la th√©orie des jeux: "Quelle est la probabilit√© qu'une bombe atomique soit largu√©e dans les cinq prochaines ann√©es?"</a></li>
<li><a href="../fr455286/index.html">Dents de sagesse: ne peuvent pas √™tre enlev√©es</a></li>
<li><a href="../fr455288/index.html">Nouvelles de la semaine: bloqueur de publicit√©s pour entreprises dans les cl√©s de chiffrement Chrome, FSB et Yandex, la communication devient plus ch√®re</a></li>
<li><a href="../fr455292/index.html">Comment augmenter 4 fois la dur√©e d'ex√©cution des appareils avec auto-alimentation</a></li>
<li><a href="../fr455294/index.html">Guide: comment choisir un v√©lo √©lectrique en utilisant Twitter comme exemple - parler de cadres</a></li>
<li><a href="../fr455302/index.html">Framework d'API Golang</a></li>
<li><a href="../fr455306/index.html">R√©ponses √† vos questions sur les raisons pour lesquelles vous avez besoin d'un √©diteur pour publier un livre</a></li>
<li><a href="../fr455308/index.html">Endroit prometteur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>