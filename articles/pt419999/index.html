<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÖ ü§∑ ü•ì Compartilhamento de autentica√ß√£o Yii1 / yii2 üòä üòã üõÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo n√£o faz sentido sem a primeira parte , na qual h√° uma resposta "por que fazer isso". 

 √â sobre a t√©cnica de migrar sem problemas um proje...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Compartilhamento de autentica√ß√£o Yii1 / yii2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419999/"><img src="https://habrastorage.org/webt/ax/qo/vv/axqovvxw6vehedogcejd1obzehs.jpeg" alt="imagem"><br><br>  Este artigo n√£o faz sentido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sem a primeira parte</a> , na qual h√° uma resposta "por que fazer isso". <br><br>  √â sobre a t√©cnica de migrar sem problemas um projeto de yii1 para yii2.  Sua ess√™ncia √© que os ramos do projeto no yii1 e sua nova vers√£o no yii2 trabalham juntos no mesmo dom√≠nio em um host virtual, e a migra√ß√£o √© realizada gradualmente, em pequenas etapas (atrav√©s de p√°ginas, controladores, m√≥dulos etc.). <br><br>  A primeira parte foi sobre como executar um projeto simples no yii2 em um host virtual existente, ou seja,  fa√ßa os dois ramos trabalharem juntos sem interferir um no outro. <br><br>  Depois disso, come√ßa a fase mais psicologicamente dif√≠cil: voc√™ precisa criar uma infraestrutura m√≠nima para o in√≠cio.  Eu destacaria duas tarefas: design duplicado e autentica√ß√£o de usu√°rio de ponta a ponta. <br><br>  A duplica√ß√£o do design √© dada em primeiro lugar pelo chato.  Se voc√™ tiver azar, basta copiar / reverter o antigo "1 em 1".  Pessoalmente, eu sempre combinei com o redesenho.  I.e.  a interface e o design foram significativamente atualizados e, nesse sentido, o trabalho n√£o √© est√∫pido.  Mas aqui cada um na sua - presto muita aten√ß√£o √† interface e design, algu√©m, pelo contr√°rio, gosta mais do back-end e do console.  No entanto, independentemente das prefer√™ncias, n√£o h√° como superar essa tarefa - voc√™ precisar√° fazer uma interface e a quantidade de trabalho ser√° bastante grande. <br><br>  A autentica√ß√£o de ponta a ponta √© um pouco mais interessante e haver√° menos trabalho.  Como no primeiro artigo, n√£o haver√° revela√ß√µes.  Personagem do artigo: tutorial para quem resolve esse problema pela primeira vez. <br><br>  Se este for o seu caso, mais detalhes ser√£o apresentados <br><a name="habracut"></a><br>  Primeiro de tudo, voc√™ precisa dividir a funcionalidade entre os ramos.  Porque  Entende-se que o est√°gio de migra√ß√£o ocorre apenas no in√≠cio e, provavelmente, todo o trabalho com usu√°rios (registro, autentica√ß√£o, recupera√ß√£o de senha etc.) permanece no site antigo.  E a nova ramifica√ß√£o no yii2 deve apenas ver usu√°rios j√° autenticados. <br><br>  Os mecanismos de autentica√ß√£o do yii1 / yii2 s√£o um pouco diferentes e voc√™ precisa ajustar o c√≥digo do yii2 para que ele possa ver um usu√°rio autenticado.  Porque  Como os dados de autentica√ß√£o s√£o armazenados na sess√£o, voc√™ s√≥ precisa concordar com os par√¢metros para a leitura dos dados da sess√£o. <br><br>  Em uma sess√£o do yii1, isso √© armazenado da seguinte forma: <br><br><pre><code class="php hljs">print_r($_SESSION); <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__id] =&gt; <span class="hljs-number"><span class="hljs-number">123456</span></span> [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__name] =&gt; tester [<span class="hljs-number"><span class="hljs-number">34e60</span></span>d27092d90364d1807021107e5a3__states] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( ) )</code> </pre> <br>  Como ele √© armazenado com voc√™ - verifique, por exemplo, o prefixoKey √© gerado de maneira diferente em diferentes vers√µes do yii1. <br><br>  Aqui est√£o os dados que voc√™ precisa do yii1 <br><br><pre> <code class="php hljs">Yii::app()-&gt;user-&gt;getStateKeyPrefix() Yii::app()-&gt;name Yii::app()-&gt;getBasePath() Yii::app()-&gt;getId() get_class(Yii::app()-&gt;user)</code> </pre><br>  A maneira mais f√°cil √© criar uma p√°gina de teste e mostrar nela todos os dados necess√°rios - eles ser√£o necess√°rios no futuro. <br><br><h2>  Autentica√ß√£o no yii2 </h2><br>  No Yii2, toda a funcionalidade que precisamos est√° localizada no componente do usu√°rio ( <u>\ yii \ web \ User</u> ), que controla o estado da autentica√ß√£o. <br><br><ul><li>  No m√©todo <u>getIdentity ()</u> , <u>renewAuthStatus ()</u> √© chamado, no qual a sess√£o de autentica√ß√£o √© procurada pela chave da vari√°vel <u>$ idParam</u> (por padr√£o, '__id' √© armazenado l√°); </li><li>  Na vari√°vel da sess√£o, o ID do usu√°rio √© armazenado usando a chave <u>$ idParam</u> (por exemplo, de <u>app / model / User</u> ). </li></ul><br>  <i>O algoritmo de autentica√ß√£o √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descrito em</a> detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no guia oficial</a> .</i> <br><br>  Obviamente, no yii1, as sess√µes s√£o armazenadas com uma chave diferente.  Portanto, voc√™ precisa fazer o yii2 procurar o ID do usu√°rio usando as mesmas chaves com as quais ele √© armazenado no yii1. <br><br>  <b>Para fazer isso:</b> <br><br>  1. Altere a classe do componente de usu√°rio respons√°vel por gerenciar o estado de autentica√ß√£o para o nosso, herdado de <u>yii / web / User</u> em <u>config / web.php</u> <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'components'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\models\WebUser'</span></span>, <span class="hljs-string"><span class="hljs-string">'identityClass'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'app\models\User'</span></span>, ], ]</code> </pre><br>  2. Ajuste o valor de <u>$ idParam</u> em <u>app \ models \ WebUser</u> . <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  idParam (    //    ) $this-&gt;idParam = $this-&gt;getIdParamYii1(); }</span></span></code> </pre> <br>  Sob o spoiler, haver√° alguns m√©todos que, de alguma forma, imitam o comportamento semelhante do yii1. <br><br>  Em geral, pode-se copiar o <u>_keyPrefix</u> original (ou mesmo o <u>idParam imediatamente</u> ) do yii1 e n√£o emular sua gera√ß√£o, mas seria como a instru√ß√£o "copiar lixo incompreens√≠vel". <br><br>  Na verdade, voc√™ pode copiar porque _keyPrefix no yii1 √© quase est√°tico.  Depende do nome da classe do componente do usu√°rio e do ID do aplicativo, que por sua vez √© obtido a partir do local do aplicativo e seu nome. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   yii1  _keyPrefix $this-&gt;_keyPrefix = md5('Yii.'.get_class($this).'.'.Yii::app()-&gt;getId()); //   - ID  $this-&gt;_id=sprintf('%x',crc32($this-&gt;getBasePath().$this-&gt;name));</span></span></code> </pre><br>  Se nos limitarmos apenas √† tarefa de autentica√ß√£o, copiar o valor _keyPrefix reduzir√° significativamente a quantidade de trabalho.  Mas terei exemplos para uso mais amplo. <br><br><div class="spoiler">  <b class="spoiler_title">Componente do usu√°rio (app \ models \ WebUser)</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">web</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebUser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *    cookies  yii2, *     yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $autoRenewCookie = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * _keyPrefix    CWebUser  Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_keyPrefix; <span class="hljs-comment"><span class="hljs-comment">/** *    Yii1,    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $paramsYii1 = [ <span class="hljs-comment"><span class="hljs-comment">//    user   Yii1 'classUserComponent' =&gt; 'CWebUser', // ID  Yii1 //  ,  Yii::app()-&gt;getId() 'appId' =&gt; '', //     Yii1 'appName' =&gt; 'My Web Application', //     yii1  \Yii::getAlias('@app') 'relPath' =&gt; '../htdocs/protected', ]; public function init() { //  idParam (    //    ) $this-&gt;idParam = $this-&gt;getIdParamYii1(); } }</span></span></code> </pre><br>  E m√©todos adicionais para ele (WebUser).  <i>Separado para facilitar a visualiza√ß√£o.</i> <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *     Yii1,    ID  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdParamYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getStateKeyPrefix() . <span class="hljs-string"><span class="hljs-string">'__id'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *    Yii 1 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStateKeyPrefix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix; $class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'classUserComponent'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_keyPrefix = md5(<span class="hljs-string"><span class="hljs-string">'Yii.'</span></span> . $class . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getAppIdYii1()); } <span class="hljs-comment"><span class="hljs-comment">/** *   getId()  CApplication * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string ID  Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAppIdYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appId'</span></span>] = sprintf(<span class="hljs-string"><span class="hljs-string">'%x'</span></span>, crc32(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getBasePathYii1() . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'appName'</span></span>])); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string    Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBasePathYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $basePath = realpath(\Yii::getAlias(<span class="hljs-string"><span class="hljs-string">'@app'</span></span>) . DIRECTORY_SEPARATOR . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;paramsYii1[<span class="hljs-string"><span class="hljs-string">'relPath'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$basePath) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidConfigException(<span class="hljs-string"><span class="hljs-string">'basePath  yii1  .'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $basePath; }</code> </pre><br>  <i>Somente para a tarefa de " <u>concordar com o formato da chave da sess√£o</u> ", a decomposi√ß√£o dos m√©todos √© um pouco complicada, mas eles s√£o √∫teis para os exemplos abaixo.</i> <br></div></div><br>  Depois disso, em uma nova ramifica√ß√£o no yii2, o reconhecimento de usu√°rios previamente autorizados no yii1 come√ßa a funcionar.  Idealmente, seria necess√°rio parar com isso, porque o caminho escorregadio come√ßa ainda mais. <br><br><h2>  Login de usu√°rio no yii2 </h2><br>  Depois que o formato de armazenamento para o ID do usu√°rio na sess√£o for acordado, √© poss√≠vel que mesmo "automaticamente" o login do Usu√°rio funcione com o yii2. <br><br>  <i>Considero incorreto usar o formul√°rio de login no yii2 no modo de combate sem desativar o formul√°rio correspondente no yii1; no entanto, a funcionalidade b√°sica funcionar√° ap√≥s uma pequena coordena√ß√£o.</i> <br><br>  Porque  Acreditamos que, enquanto o registro do usu√°rio e, consequentemente, o hash da senha, permanecem no yii1, para um login de trabalho no yii2, precisamos garantir que o m√©todo de valida√ß√£o da senha salva no yii2 possa entender o que foi armazenado e armazenado no yii1. <br><br>  Verifique o que esses m√©todos fazem. <br><br>  Por exemplo, se no Yii2, o modelo de usu√°rio condicionalmente padr√£o User valida a senha da seguinte maneira: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validatePassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> \Yii::$app-&gt;getSecurity()-&gt;validatePassword($password, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;password); }</code> </pre><br>  Em seguida, observe o <u>m√©todo</u> <u>validatePassword ($ password, $ hash)</u> em <u>yii \ base \ Security</u> (Yii2) <br><br><div class="spoiler">  <b class="spoiler_title">validatePassword ()</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validatePassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password, $hash)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_string($password) || $password === <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'Password must be a string and cannot be empty.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!preg_match(<span class="hljs-string"><span class="hljs-string">'/^\$2[axy]\$(\d\d)\$[\.\/0-9A-Za-z]{22}/'</span></span>, $hash, $matches) || $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> || $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">30</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'Hash is invalid.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (function_exists(<span class="hljs-string"><span class="hljs-string">'password_verify'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> password_verify($password, $hash); } $test = crypt($password, $hash); $n = strlen($test); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($n !== <span class="hljs-number"><span class="hljs-number">60</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compareString($test, $hash); }</code> </pre></div></div><br>  E se no Yii1 o hash de senha no modelo de Usu√°rio for feito assim: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CPasswordHelper::hashPassword($password); }</code> </pre><br>  Em seguida, compare com o <u>confirmPassword ($ senha, $ hash)</u> em <u>yii \ framework \ utils \ CPasswordHelper</u> <br><br><div class="spoiler">  <b class="spoiler_title">hashPassword ()</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashPassword</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($password,$cost=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">13</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::checkBlowfish(); $salt=<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::generateSalt($cost); $hash=crypt($password,$salt); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_string($hash) || (function_exists(<span class="hljs-string"><span class="hljs-string">'mb_strlen'</span></span>) ? mb_strlen($hash, <span class="hljs-string"><span class="hljs-string">'8bit'</span></span>) : strlen($hash))&lt;<span class="hljs-number"><span class="hljs-number">32</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CException(Yii::t(<span class="hljs-string"><span class="hljs-string">'yii'</span></span>,<span class="hljs-string"><span class="hljs-string">'Internal error while generating hash.'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $hash; }</code> </pre><br></div></div><br>  Se os m√©todos de hash e valida√ß√£o forem diferentes, ser√° necess√°rio alterar a valida√ß√£o em <u>validatePassword ()</u> de <u>app \ model \ User</u> . <br><br>  Nas caixas das vers√µes mais recentes da estrutura, os hashes de senha Yii1 / Yii2 s√£o compat√≠veis.  Mas isso n√£o significa que eles sejam compat√≠veis com voc√™ ou que coincidam no futuro.  Com um alto grau de probabilidade, os m√©todos de hash do projeto no Yii1 e a valida√ß√£o no novo projeto no Yii2 ser√£o diferentes. <br><br><h2>  Login autom√°tico no Yii2 em cookies da yii1 </h2><br><blockquote>  Como uma filial no Yii2 j√° sabe como usar com transpar√™ncia os dados de autentica√ß√£o do usu√°rio do Yii1, por que n√£o configurar o logon autom√°tico por cookie? <br></blockquote>  Se tal pensamento acontecer, aconselho-o a abandon√°-lo.  N√£o vejo uma boa raz√£o para ativar o logon autom√°tico no Yii2 sem transferir o trabalho do usu√°rio (autentica√ß√£o, antes de tudo) para este segmento.  I.e.  Quero dizer o seguinte caso: <br><br>  <i>a autentica√ß√£o do usu√°rio √© realizada no Yii1, mas a ramifica√ß√£o do Yii2 deve poder fazer logon autom√°tico nos cookies armazenados no Yii1.</i> <i><br></i> <br>  Para ser sincero, √© uma pervers√£o franca.  N√£o ser√° f√°cil e elegante, e apenas aqui a linha passa entre a tarefa consciente e justificada da migra√ß√£o e a inven√ß√£o de bicicletas desnecess√°rias. <br><br>  A dificuldade √© que, nos dois ramos, o Yii est√° protegido contra cookies falsos, por isso √© dif√≠cil concordar com os m√©todos. <br><br><ul><li>  Os componentes envolvidos no Yii2 s√£o: usu√°rio ( <u>\ yii \ web \ User</u> ), <u>Request</u> , <u>Security</u> + <u>CookieCollection</u> </li><li>  No Yii1: <u>CWebUser</u> , <u>CHttpRequest</u> , <u>CSecurityManager</u> , <u>CStatePersister</u> , <u>CCookieCollection</u> </li></ul><br>  No entanto, os casos s√£o diferentes.  Abaixo est√° um exemplo de como fazer um login autom√°tico com bicicletas. <br><br>  No yii2, estamos interessados ‚Äã‚Äãno m√©todo <u>getIdentityAndDurationFromCookie ()</u> de <u>\ yii \ web \ User</u> .  Na primeira linha deste m√©todo, o cookie desejado deve ser obtido: <br><br><pre> <code class="php hljs">$value = Yii::$app-&gt;getRequest()-&gt;getCookies()-&gt;getValue(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]);</code> </pre> <br>  Mas ela n√£o ser√°, porque  a cole√ß√£o <u>Yii :: $ app-&gt; getRequest () -&gt; getCookies ()</u> ficar√° vazia, porque em <u>Request os</u> cookies s√£o carregados com valida√ß√£o em <u>loadCookies ()</u> e, √© claro, n√£o passa. <br><br>  A maneira mais f√°cil de bifurcar √© o comportamento padr√£o substituindo <u>getIdentityAndDurationFromCookie ()</u> .  Por exemplo, assim: <br><br><ol><li>  Fa√ßa o download do cookie desejado diretamente do superglobal $ _COOKIE para n√£o adaptar o mecanismo padr√£o de carregamento de cookies. <br><br>  O nome do cookie de identifica√ß√£o √© apenas _keyPrefix, que j√° sabemos como receber (ou copiar).  Portanto, alteramos o <u>$ identityCookie</u> padr√£o em <u>init ()</u> . <br></li><li>  Descriptografe o cookie resultante "aproximadamente como em yii1".  Como voc√™ deseja.  Por exemplo, copiei os m√©todos necess√°rios do <u>CSecurityManager</u> . </li></ol><br>  Abaixo, de fato, est√° o c√≥digo. <br><br><div class="spoiler">  <b class="spoiler_title">Trabalhamos em app / models / WebUser</b> <div class="spoiler_text">  1. O nome identityCookie cookies definido de acordo com yii1 <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;idParam = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getIdParamYii1(); <span class="hljs-comment"><span class="hljs-comment">//     $this-&gt;identityCookie = ['name' =&gt; $this-&gt;getStateKeyPrefix()]; }</span></span></code> </pre><br><br>  2. Adicione mais dois m√©todos <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdentityAndDurationFromCookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getIdIdentityFromCookiesYii1(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } $class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityClass; $identity = $class::findOne($id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($identity !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'identity'</span></span> =&gt; $identity, <span class="hljs-string"><span class="hljs-string">'duration'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** *  ID identity  cookies,   yii1 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> null|integer  ID     null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIdIdentityFromCookiesYii1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_COOKIE[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $cookieValue = $_COOKIE[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;identityCookie[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]]; <span class="hljs-comment"><span class="hljs-comment">// Cookies  yii1 ,  $utilSecurity = new UtilYii1Security($this-&gt;getBasePathYii1()); $data = $utilSecurity-&gt;validateData($cookieValue); if ($data === false) { return null; } $data = @unserialize($data); if (is_array($data) &amp;&amp; isset($data[0], $data[1], $data[2], $data[3])) { list($id, $name, $duration, $states) = $data; return $id; } return null; }</span></span></code> </pre><br></div></div><br>  O c√≥digo usa uma certa classe <u>UtilYii1Security</u> - esta √© uma c√≥pia e colar modificada dos m√©todos necess√°rios do <u>CSecurityManager</u> , para que, por um lado, pare√ßa com o original, mas com simplifica√ß√µes.  Por exemplo, no <u>CSecurityManager, existem</u> v√°rias op√ß√µes para gerar o HMAC (c√≥digo de autentica√ß√£o de mensagens baseado em hash), que depende da vers√£o do php e da presen√ßa do mbstring.  Mas desde  Sabe-se que o yii1 funciona no mesmo ambiente que o yii2, ent√£o a tarefa √© simplificada e, consequentemente, o c√≥digo tamb√©m. <br><br>  Porque  √© bastante claro que uma muleta expl√≠cita est√° escrita aqui, ent√£o n√£o h√° necessidade de tentar universaliz√°-la e dar-lhe uma forma graciosa, √© suficiente para "aprision√°-la" sob suas condi√ß√µes. <br><br><div class="spoiler">  <b class="spoiler_title">UtilYii1Security.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *   CSecurityManager  Yii1, *     * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">base</span></span>\<span class="hljs-title"><span class="hljs-title">InvalidConfigException</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UtilYii1Security</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * ,   yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STATE_VALIDATION_KEY = <span class="hljs-string"><span class="hljs-string">'Yii.CSecurityManager.validationkey'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *  ,    yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $hashAlgorithm = <span class="hljs-string"><span class="hljs-string">'sha1'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *   cookies */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_validationKey; <span class="hljs-comment"><span class="hljs-comment">/** *    Yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $basePath; <span class="hljs-comment"><span class="hljs-comment">/** *      yii1 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $stateFile; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $basePath -    Yii1 *        stateFile */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($basePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath = $basePath; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;stateFile = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;basePath . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'runtime'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'state.bin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!realpath(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;stateFile)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidConfigException(<span class="hljs-string"><span class="hljs-string">'    '</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $key = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_string($data)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $len = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;computeHMAC(<span class="hljs-string"><span class="hljs-string">'test'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen($data) &gt;= $len) { $hmac = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;substr($data, <span class="hljs-number"><span class="hljs-number">0</span></span>, $len); $data2 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;substr($data, $len, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;strlen($data)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compareString($hmac, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;computeHMAC($data2, $key)) ? $data2 : <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">computeHMAC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $key = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($key === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) $key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getValidationKey(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash_hmac(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hashAlgorithm, $data, $key); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValidationKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($key = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loadStateValidationKey(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::STATE_VALIDATION_KEY)) !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey = $key; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_validationKey; } <span class="hljs-comment"><span class="hljs-comment">//  validationKey    Yii1 private function loadStateValidationKey($key) { $content = $this-&gt;loadState(); if ($content) { $content = unserialize($content); if (isset($content[$key])) return $content[$key]; } return false; } //      Yii1 protected function loadState() { $filename = $this-&gt;stateFile; $file = fopen($filename, "r"); if ($file &amp;&amp; flock($file, LOCK_SH)) { $contents = @file_get_contents($filename); flock($file, LOCK_UN); fclose($file); return $contents; } return false; } public function compareString($expected, $actual) { $expected .= "\0"; $actual .= "\0"; $expectedLength = $this-&gt;strlen($expected); $actualLength = $this-&gt;strlen($actual); $diff = $expectedLength - $actualLength; for ($i = 0; $i &lt; $actualLength; $i++) $diff |= (ord($actual[$i]) ^ ord($expected[$i % $expectedLength])); return $diff === 0; } private function strlen($string) { return mb_strlen($string, '8bit'); } private function substr($string, $start, $length) { return mb_substr($string, $start, $length, '8bit'); } }</span></span></code> </pre><br></div></div><br><h2>  Sequ√™ncia de a√ß√µes </h2><br>  Ao migrar do yii1 para o yii2 em termos de autentica√ß√£o, segui a seguinte sequ√™ncia: <br><br><ol><li>  Fa√ßa autentica√ß√£o de usu√°rio transparente entre filiais. <br>  I.e.  para que a ramifica√ß√£o yii2 aceite usu√°rios autenticados com yii1.  √â r√°pido, n√£o √© dif√≠cil. <br></li><li>  Transfira a autentica√ß√£o (login do usu√°rio) de yii1 para yii2. <br>  Desabilitando-o ao mesmo tempo na ramifica√ß√£o antiga.  Observe que, depois disso, o login autom√°tico de cookies deixar√° de funcionar, porque  os cookies do yii1 n√£o s√£o mais adequados e ainda existem poucas p√°ginas novas no yii2. </li><li>  Portar pelo menos a p√°gina principal do site para yii2 <br>  Para que voc√™ possa usar o logon autom√°tico para os novos cookies armazenados no yii2. <br>  A presen√ßa de um logon autom√°tico, pelo menos no principal, ajudar√° a mascarar o logon ausente na ramifica√ß√£o anterior. <br></li><li>  Verifique se o yii1 entende autenticado no yii2. <br>  Atrav√©s da negocia√ß√£o de chaves de sess√£o. <br></li><li>  Transfira o registro do usu√°rio para yii2. <br>  A transfer√™ncia deve ser feita com a coordena√ß√£o dos hashes de senha armazenados anteriormente.  Talvez mantenha o formato hash antigo ou introduza um novo, mas para que o login entenda os dois tipos. </li><li>  Considere adicionar usu√°rios ao site um servi√ßo que fornece ao yii2 "pronto para uso". <br>  Refiro-me √† implementa√ß√£o da interface <u>IdentityInterface do</u> usu√°rio, que permite autentica√ß√£o por token, recupera√ß√£o de senha etc.  Talvez voc√™ j√° tenha o cinto adequado, mas de repente n√£o?  Ent√£o essa √© uma √≥tima op√ß√£o para melhorar o servi√ßo com o m√≠nimo de esfor√ßo. <br><br>  Se sim, isso levar√° √† implementa√ß√£o (migra√ß√£o) da conta pessoal no yii2 (pelo menos parcialmente). <br>  Se "n√£o", voc√™ ainda deve pensar na migra√ß√£o da sua conta pessoal (mesmo sem novos produtos). <br></li></ol><br><h4>  PS: </h4><br>  Nem sempre descreve solu√ß√µes inequ√≠vocas em uma tarefa espec√≠fica e nem todas precisam ser aplicadas. <br><br>  Eles n√£o s√£o descritos com o objetivo de dizer "fa√ßa o que eu fa√ßo"  Por exemplo, √© poss√≠vel fazer o login autom√°tico do yii2 para cookies a partir do yii1, mas, para dizer o m√≠nimo, n√£o √© bom (e essa muleta deve ser justificada de alguma forma). <br><br>  Mas j√° dediquei tempo a essa migra√ß√£o passo a passo de projetos e ficarei feliz se algu√©m, olhando minha experi√™ncia, o salvar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt419999/">https://habr.com/ru/post/pt419999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt419989/index.html">Nova Zel√¢ndia pro√≠be sacos de pl√°stico</a></li>
<li><a href="../pt419991/index.html">Drones aut√¥nomos direcionam bandos de p√°ssaros de aeroportos</a></li>
<li><a href="../pt419993/index.html">Entrevista TypeScript: 20 perguntas e respostas</a></li>
<li><a href="../pt419995/index.html">Um estudo de Ivy, o novo compilador Angular</a></li>
<li><a href="../pt419997/index.html">Analisando o Padr√£o "M√≥dulo" em JavaScript</a></li>
<li><a href="../pt420001/index.html">Apresentando o 3CX v15.5 Atualiza√ß√£o 6 BETA e o Softphone do navegador WebRTC</a></li>
<li><a href="../pt420003/index.html">Janela com bot√µes no JavaFX:</a></li>
<li><a href="../pt420005/index.html">Vigil√¢ncia por v√≠deo n√£o profissional do apartamento √© divertido e barato</a></li>
<li><a href="../pt420007/index.html">FidgetPen, l√¢mpada estranha e cubos divisores: conhecendo o Allocacoc</a></li>
<li><a href="../pt420009/index.html">As sutilezas do design do produto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>