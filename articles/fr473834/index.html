<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé≤ üë®üèø‚Äç‚öñÔ∏è üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø Surveillance de Blackbox dans les r√©seaux Clos. Rapport Yandex üëÆ üë©üèø‚Äçü§ù‚Äçüë®üèæ ü§°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La topologie des centres de donn√©es modernes et des appareils qui s'y trouvent ne nous permet plus de nous contenter exclusivement de la surveillance ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Surveillance de Blackbox dans les r√©seaux Clos. Rapport Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/473834/"> La topologie des centres de donn√©es modernes et des appareils qui s'y <abbr title="Type de surveillance bas√© sur des m√©triques obtenues √† partir d'applications sur l'appareil. Par exemple, la surveillance de la bo√Æte blanche comprend la collecte de journaux et la v√©rification de l'√©tat des sessions.">trouvent</abbr> ne nous permet plus de nous contenter exclusivement de la <abbr title="Type de surveillance bas√© sur des m√©triques obtenues √† partir d'applications sur l'appareil. Par exemple, la surveillance de la bo√Æte blanche comprend la collecte de journaux et la v√©rification de l'√©tat des sessions.">surveillance de la bo√Æte blanche</abbr> .  Au fil du temps, j'avais besoin d'un outil qui montrera les performances de p√©riph√©riques sp√©cifiques, en fonction de la situation r√©elle avec le transfert de trafic (dataplane) n'importe o√π dans le <abbr title="Le r√©seau Klose est un type de r√©seau de commutation √† plusieurs √©tages d√©crit par Charles Klose. Largement utilis√© dans les centres de donn√©es.">r√©seau Clos</abbr> .  Il y a quelques semaines, lors de la conf√©rence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Next Hop</a> , l'ing√©nieur r√©seau Yandex Alexander Klimenko a partag√© son exp√©rience dans la r√©solution de ce probl√®me. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/o3/kv/n3/o3kvn3oecpuipgvx68yuzfib4t4.jpeg"></a> <br><br>  - Je travaille dans le d√©partement d'exploitation et de d√©veloppement du r√©seau Yandex, et parfois je suis oblig√© de r√©soudre certains probl√®mes, au lieu de dessiner de beaux nuages ‚Äã‚Äãsur les feuilles ou d'inventer un avenir radieux.  Les gens viennent et disent que quelque chose ne fonctionne pas pour eux.  Si cette question est surveill√©e, si nos ing√©nieurs de service constatent que cela ne fonctionne pas, cela me sera plus facile.  Ces 30 minutes seront donc consacr√©es au monitoring. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/wi/m7/gn/wim7gnm9iv9s50sfcujeemna250.jpeg"><br><br>  T√¥t ou tard, tout le monde vient √† l'id√©e de surveiller.  Autrement dit, au d√©but, vous pouvez collecter les appels des utilisateurs eux-m√™mes, ils vont vous frapper et dire que quelque chose ne fonctionne pas pour eux.  Mais il est clair qu'un tel syst√®me n'est pas tr√®s √©volutif.  Si vous avez plus d'un commutateur, si vous avez un r√©seau suffisamment grand, alors avec cette option de surveillance, vous ne pouvez pas aller loin. <br><br>  Et t√¥t ou tard, tous parviennent √† la conclusion qu'il est n√©cessaire de collecter certaines donn√©es de l'√©quipement.  Ceci est la toute premi√®re √©tape.  Il peut s'agir de journaux, de diverses donn√©es sur SNMP, de gouttes, vous pouvez cr√©er des topologies selon LLDP, etc. Il y a un inconv√©nient clair - le p√©riph√©rique lui-m√™me vous fournit toutes ces informations.  Cela peut ne rien dire, vous tromper, etc. <br><br>  L'√©tape logique du d√©veloppement de votre surveillance est la surveillance sur les h√¥tes.  On peut dire qu'il y a une petite branche.  Si vous avez la chance - ou pas la chance - d'avoir un r√©seau sur un seul fournisseur, le fournisseur peut vous proposer certaines de vos propres options de surveillance.  Mais l'ann√©e derni√®re √† Next Hop, Dima Ershov a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©clar√©</a> que notre usine avait √©t√© cr√©√©e √† partir de deux fournisseurs de base et que nous ne pouvions pas nous permettre un tel luxe.  Ou nous pouvons, mais seulement partiellement. <br><br>  Enfin, la derni√®re option, que tout le monde atteint en quelque sorte avec le d√©veloppement du r√©seau.  Il s'agit de la surveillance des h√¥tes finaux.  Yandex a une telle surveillance.  Cela s'appelle Netmon. <br><br><img src="https://habrastorage.org/webt/8j/kj/_w/8jkj_whnq8eze73jzmmc_w_c-_q.jpeg"><br><br>  Au bas de la diapositive, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">il y a un lien avec une pr√©sentation d√©taill√©e</a> sur le fonctionnement de Netmon.  Je vais dire litt√©ralement dans une diapositive.  Si quelqu'un le souhaite, veuillez lire le discours d'une autre conf√©rence Netmon. <br><br>  Netmon sont des agents install√©s sur presque tous les h√¥tes du r√©seau.  La t√¢che arrive aux agents: envoyer des paquets √† un n≈ìud de r√©seau.  Ils peuvent √™tre compl√®tement diff√©rents: UDP, TCP, ICMP.  Il peut s'agir de diff√©rentes peintures, c'est-√†-dire DSCP et destination.  Les ports source et de destination peuvent √©galement √™tre diff√©rents. <br><br>  Ces donn√©es sont agr√©g√©es, t√©l√©charg√©es sur un stockage s√©par√©, et nous obtenons ici une tranche comme celle de droite sur la figure.  Une tranche peut √™tre plus agr√©g√©e ou moins agr√©g√©e, selon ce que nous voulons voir.  Par exemple, ici, pour autant que je sache, nous avons une tranche de toute la connectivit√© des centres de donn√©es, c'est-√†-dire entre tous nos centres de donn√©es.  Nous pouvons tomber plus profond√©ment dans les carr√©s - voir la connectivit√© entre le POD ou √† l'int√©rieur du b√¢timent d'un centre de donn√©es;  encore plus profond√©ment - √† l'int√©rieur du POD entre les racks;  et encore plus profond - m√™me dans le rack. <br><br><img src="https://habrastorage.org/webt/ea/iq/to/eaiqtolvrecwgo0apgnxdc2rgy0.jpeg"><br><br>  Qu'est-ce qui pourrait mal tourner ici?  Une petite parenth√®se pour ceux qui n'ont pas regard√© le Next Hop de l'ann√©e derni√®re. <br><br>  Nous avons utilis√© 400 gigabits par ToR, et au premier moment de la mise en ≈ìuvre de cette usine, nous n'en avions inclus que 200, car il y avait des t√¢ches plus importantes.  Peu importe pourquoi.  Ils ont allum√© 200, les services sont venus et ont dit: pourquoi 200?  Nous en voulons 400!  Commenc√© √† l'allumer.  Et il se trouve que la deuxi√®me partie de l'usine, que nous avons incluse, a eu une sorte de mariage dans la m√©moire des cartes.  En cons√©quence, nous allumons l'usine et voyons cette image: <br><br><img src="https://habrastorage.org/webt/-m/mt/vb/-mmtvbpckx_kmr42-u3dwoditz4.jpeg"><br><br>  Ce Netmon, les carr√©s rouges, est en feu.  Nous comprenons que tout est perdu.  Nous agrippons nos t√™tes, comme Hom√®re, et essayons de pousser quelque chose fr√©n√©tiquement.  Et sur quoi appuyer, quoi √©teindre, on ne comprend pas.  Autrement dit, Netmon nous montre la pr√©sence d'un probl√®me, mais ne montre pas o√π, en fait, le probl√®me se trouve sur le r√©seau. <br><br><img src="https://habrastorage.org/webt/ef/sg/tu/efsgtu9frnrwu4mcwoajkhqtw4m.jpeg"><br><br>  Nous sommes arriv√©s √† la t√¢che que nous devons accomplir.  Que faut-il faire?  D√©terminez avec quel appareil du r√©seau il y a un probl√®me et mettez-le hors service, soit automatiquement, soit par la force, par exemple, des ing√©nieurs en service. <br><br>  De plus, les conditions initiales sont telles que nous avons une topologie assez r√©guli√®re, c'est-√†-dire qu'il n'y a pas de liens √©tranges entre les spins de second niveau ou entre les tores.  Nous avons la majeure partie du trafic - TCP, il y a une place centrale, on nous en a d√©j√† parl√©, et les serveurs sont plus ou moins centralis√©s.  Nous pouvons venir √† cet endroit central et d√©clarer raisonnablement: les gars, nous voulons le faire, veuillez le faire. <br><br>  Quelles options avons-nous envisag√©es? <br><br><img src="https://habrastorage.org/webt/y-/cx/1m/y-cx1mnilmeqpxmlibivrgychbq.jpeg"><br><br>  La premi√®re chose qui me vient √† l'esprit est le tra√ßage.  Pourquoi?  Parce que le m√™me Netmon d√©charge les paires source et destination en √©chec dans un collecteur distinct.  En cons√©quence, nous pouvons prendre ce 5-tuple, le regarder et faire une trace avec les m√™mes param√®tres.  Et pour agr√©ger les donn√©es sur quel lien ou √† travers quels appareils le plus grand nombre de traces passe. <br><br>  Mais malheureusement, MPLS est utilis√© dans notre usine (maintenant nous nous dirigeons dans la direction oppos√©e √† MPLS, mais nous devons √©galement surveiller les anciennes usines d'une mani√®re ou d'une autre, mais ne les jetez pas, en fait).  Nous avons MPLS en usine, et le probl√®me avec MPLS et le tra√ßage est qu'il doit tunneler le message ICMP d√©pass√© TTL, qui sous-tend le tra√ßage.  Ayant perdu un tel message de l'entr√©e √† la sortie, nous pouvons perdre la surveillance m√™me.  Autrement dit, nous ne comprendrons pas par quels n≈ìuds ce message est pass√©.  Cela ne nous convenait pas pour le suivi. <br><br><img src="https://habrastorage.org/webt/xl/bg/fr/xlbgfroj02orrytuqectvxi-n18.jpeg"><br><br>  Il existe une deuxi√®me option li√©e √† ECMP.  Nous prenons la m√™me paire source et destination, en plus source-port destination-port.  Nous arrivons √† un morceau de fer, via l'API ou via la CLI, nous alimentons ce morceau de fer dans le morceau de fer et nous obtenons l'interface de sortie.  De nombreux appareils prennent en charge ce type de sortie. <br><br>  Nous arrivons √† ToR, voyons que ToR a choisi un lien gauche ou droit.  Dans ce cas, le lien gauche est vers la gauche S1. <br><br><img src="https://habrastorage.org/webt/pf/k1/fq/pfk1fq3l3zpso1b0dtteib-ip5a.jpeg"><br><br>  Nous sommes arriv√©s √† ce S1, avons regard√©, √† droite S2, et de cette fa√ßon un chemin pr√™t s'est form√©. <br><br><img src="https://habrastorage.org/webt/lb/gu/7r/lbgu7r5ogih0uzo4zoazcczuuya.jpeg"><br><br>  Il y a quelques inconv√©nients.  Premi√®rement, tous les appareils ne peuvent normalement pas accepter ces donn√©es d'entr√©e que nous leur donnons.  Cela est d√ª au fait que nous avons IPv6 et MPLS, ainsi qu'au fait que certains fournisseurs ne l'ont tout simplement pas impl√©ment√©.  Le deuxi√®me inconv√©nient de cette solution: nous comptons sur ce que le morceau de fer nous dira √† nouveau, au lieu de regarder ce qui se passe sur les h√¥tes.  Et enfin, le troisi√®me inconv√©nient - pendant le temps que vous allez voir ce qui s'y passe, quelque chose peut d√©j√† changer sur le r√©seau et vos donn√©es ne seront pas pertinentes. <br><br><img src="https://habrastorage.org/webt/dy/he/_s/dyhe_sdybz_8nsum0uce40pjg2c.jpeg"><br><br>  Ensuite, nous sommes tomb√©s sur une pr√©sentation int√©ressante faite par Facebook.  Nous avons aim√© l'id√©e propos√©e par Facebook, nous avons d√©cid√© d'essayer de faire quelque chose de similaire. <br><br>  Quelle √©tait l'id√©e principale?  Utilisez un programme eBPF sur l'h√¥te pour colorer la retransmission TCP, puis calculez le nombre de ces paquets.  Malheureusement, nous ne pouvions pas le faire comme sur Facebook, nous avons d√ª inventer notre propre v√©lo.  Je vais essayer de vous parler du chemin de la douleur et de la souffrance que nous avons travers√©. <br><br><img src="https://habrastorage.org/webt/bt/5l/5e/bt5l5e9el6kbhutnjsamv3hpo5u.jpeg"><br><br>  Qu'avons-nous fait?  Juste au cas o√π, je soulignerai que la retransmission TCP sont des messages TCP qui sont r√©p√©t√©s plusieurs fois car leur r√©ception n'a pas √©t√© confirm√©e.  Nous avons un programme eBPF install√© sur l'h√¥te et regarde si ce message TCP est retransmis ou non retransmis.  Il le fait ringard - par num√©ro de s√©quence.  Si le m√™me num√©ro de s√©quence est transmis dans une session TCP, il s'agit alors d'une retransmission. <br><br>  Que faisons-nous avec de tels packages?  Nous avons mis le dernier bit du champ DSCP √† un pour calculer davantage le tout. <br><br><img src="https://habrastorage.org/webt/rk/nh/qm/rknhqmvuhuu9vss_juaqyzlxtza.jpeg"><br><br>  De mani√®re g√©n√©rale, DSCP est en quelque sorte li√© √† la QoS, non?  Et avec la QoS, l'histoire de notre r√©seau est assez compliqu√©e et ancienne.  Nous avons certaines politiques qui sont surveill√©es sur les commutateurs ToR.  √Ä ces politiques, nous venons d'ajouter la n√©cessit√© de compter plus et ces paquets color√©s. <br><br>  Ainsi, pour les paquets color√©s (lire: pour les paquets TCP retransmis depuis l'h√¥te), nous avons simplement ajout√© une autre file d'attente QoS.  C'√©tait assez facile √† faire, car nous avions encore des lignes libres.  De plus, cela est pratique, car au stade de la transition entre IPv6 et MPLS en usine, c'est-√†-dire au stade o√π le paquet vole S1 et quitte notre partie MPLS de l'usine, il est pratique de prendre et de repeindre EXP / TC dans l'en-t√™te du paquet MPLS pour chaque file d'attente sp√©cifique . <br><br><img src="https://habrastorage.org/webt/n1/jz/yy/n1jzyyspbgw39b3zv1xngyavgwm.jpeg"><br><br>  Que faisons-nous de ces donn√©es?  Nous les collectons avec des filtres ACL standard, classe de trafic.  Autrement dit, cela fonctionne, en principe, sur n'importe quel fournisseur.  Nous pouvons collecter et calculer le nombre de ces colis partout. <br><br>  Ensuite, nous examinons la distribution in√©gale de ces paquets sur le POD.  Dans celui-ci, par exemple, quatre √©pines, comme sur la photo.  Si le nombre de paquets sur les liens jaunes, sur bleu, sur vert et sur rouge est le m√™me, alors nous pensons que tout est plus ou moins bon.  Si √† un moment donn√©, nous voyons une augmentation, disons, sur la colonne vert√©brale la plus √† droite du premier niveau, nous comprenons que cet appareil attire la retransmission, quelque chose ne va pas.  Ensuite, nous essayons soit de le mettre hors service, soit du moins de le louer.  Au moins, lorsque nous verrons des probl√®mes sur Netmon, nous saurons avec quel appareil ils peuvent survenir. <br><br><img src="https://habrastorage.org/webt/ky/9t/8u/ky9t8uf1v57wlbqmqsxmmtusipc.jpeg"><br><br>  √Ä quoi cela ressemble-t-il sur des donn√©es brutes simples?  Voici deux graphiques.  En fait, ce sont des graphiques retransmis avec ToR vers la colonne vert√©brale de premier niveau.  Dans l'exemple, deux dos dans le module.  Le graphique sup√©rieur est l'agr√©gation de la premi√®re colonne vert√©brale, le graphique inf√©rieur est la deuxi√®me colonne vert√©brale.  Regarder cela dans ce formulaire n'est pas tr√®s pratique, nous avons donc ajout√© l'agr√©gation de ces informations. <br><br><img src="https://habrastorage.org/webt/ab/pu/-o/abpu-on4l0cwiglpfdftt7mzykc.jpeg"><br><br>  Cela ressemble √† ceci.  Il y a un module dans lequel trois √©pines, pour une raison quelconque, peu importe laquelle, et nous voyons ici une telle distribution totale des retransmissions √† trois √©pines.  Il est, en principe, assez uniforme. <br><br><img src="https://habrastorage.org/webt/ar/m0/cm/arm0cmbz77k8bpdu8qqerqsttto.jpeg"><br><br>  Pour la colonne vert√©brale de deuxi√®me niveau, nous pouvons avoir divers √©carts, appelons-les ainsi.  La topologie reste toujours r√©guli√®re, mais selon le centre de donn√©es, nous pouvons ou non utiliser une architecture de type plaque.  Le point ici est exactement le m√™me.  √Ä un niveau, nous devrions avoir approximativement la m√™me distribution de paquets color√©s. <br><br><img src="https://habrastorage.org/webt/if/od/og/ifodogqs86mqbfgahucjzo_wrgi.jpeg"><br><br>  Regardons quelques exemples.  Quelqu'un voit-il un probl√®me sur un tel graphique?  Il y a un probl√®me ici, mais ce n'est pas en m√™me temps.  Oui, c'est le probl√®me de Schr√∂dinger.  Pourquoi est-elle l√† et pas?  Parce que nous voyons une augmentation du nombre de retransmissions, il est √©vident que quelque chose s'est produit pour nous.  Mais en m√™me temps, nous voyons que cette croissance est assez uniforme.  Autrement dit, trois bleus de colonne vert√©brale, rouges, bleus, m√™me la distribution sur eux.  Qu'est-ce que cela signifie?  Qu'il y avait une sorte de probl√®me dans le r√©seau, mais ce n'est pas li√© √† ce niveau d'agr√©gation de donn√©es.  Elle est ailleurs. <br><br>  Peut-√™tre que quelqu'un a ferm√© le port sur les pare-feu, d√©connect√© un cluster, c'est-√†-dire que quelque chose s'est produit.  Mais nous ne sommes pas du tout int√©ress√©s par ce qui √©tait l√† et pourquoi.  Autrement dit, nous ne consid√©rons m√™me pas un tel probl√®me. <br><br><img src="https://habrastorage.org/webt/ie/_4/tz/ie_4tzqchudv3zrxi6vi_mcwxgm.jpeg"><br><br>  Et ici, peut-√™tre, pas si clairement, mais le probl√®me est visible.  Deux √©pines dans le module, 46 paquets peints ont vol√© sur l'un et un peu sur le second.  Nous comprenons que nous avons un probl√®me avec une sorte de colonne vert√©brale sur le r√©seau, nous devons y faire quelque chose. <br><br>  Pourquoi ai-je d'abord parl√© du chemin de la douleur et de la souffrance?  Parce qu'il y a beaucoup de probl√®mes avec une telle solution.  Le probl√®me principal est, bien s√ªr, le probl√®me de toute surveillance, c'est un faux positif.  Les faux positifs, c'√©tait beaucoup.  Principalement d√ª au fait que nous utilisons DSCP et sommes g√©n√©ralement li√©s √† la QoS. <br><br><img src="https://habrastorage.org/webt/ht/md/rb/htmdrbopskl2febbslxadjbqtlw.jpeg"><br><br>  Nous avons constat√© que les colis d'autres personnes volent dans notre peinture et nous alertent de notre surveillance.  Autrement dit, nous pensons que c'est une retransmission, et quelqu'un d'autre met leurs paquets l√†-bas et, en g√©n√©ral, g√¢che l'image pour nous.  Naturellement, nous avons commenc√© √† comprendre, trouv√© beaucoup d'endroits o√π nous pensions que cela fonctionnait, mais cela ne fonctionne pas comme nous le pensons.  Par exemple, le trafic entrant dans le r√©seau doit apparemment √™tre repeint, le trafic avec les classes CS6 et CS7 sur les fronti√®res ne doit pas entrer dans notre r√©seau.  Mais √† certains endroits, il y avait, disons, des d√©fauts, et nous les avons trait√©s avec succ√®s. <br><br>  Certains fabricants ont pr√©sent√© des surprises sous la forme de compteurs sur la direction sortante de ces paquets, et la puce fonctionne de telle sorte qu'en fait, pour traiter la liste d'acc√®s sortante, elle enveloppe √† nouveau le trafic, en mordant la moiti√© de la bande passante de la puce .  C'√©tait 900 gigabits par puce, c'est devenu la moiti√©. <br><br>  Et nous avons fait quelques am√©liorations car les param√®tres de l'h√¥te peuvent √™tre diff√©rents.  Autrement dit, certains h√¥tes peuvent envoyer des retransmissions plus souvent, certains h√¥tes peuvent √™tre moins probables, deux ou cinq, et tout cela alerte notre surveillance, tout cela est faux positif. <br><br>  Tout d'abord, nous avons abandonn√© l'id√©e de peindre chaque retransmission TCP.  Nous avons r√©alis√© qu'en principe, nous n'avons pas besoin de chaque retransmission pour comprendre o√π se situe le probl√®me.  Nous avons commenc√© √† peindre uniquement SYN-retransmettre.  SYN est le premier paquet de la session, cela nous suffit pour recevoir un signal.  Nous peignons √©galement SYN-ACL. <br><br>  Cela a quand m√™me donn√© de faux positifs.  Nous sommes all√©s un peu plus loin.  Nous avons commenc√© √† peindre uniquement la premi√®re retransmission TCP SYN de la session.  Autrement dit, il y en a plusieurs envoy√©s, nous les avons peints chacun - un seul a commenc√© √† √™tre peint.  Nous en sommes donc arriv√©s √† ce que nous avons maintenant. <br><br>  Au total, il y a Netmon, il y a des agents sur les h√¥tes qui colorent le premier SYN-retransmit dans la session, et nous comptons ces retransmissions sur chaque appareil, sur presque chaque lien de notre r√©seau. <br><br><img src="https://habrastorage.org/webt/bk/pn/y1/bkpny1rbllgxlz8nf4v6wynm6ro.jpeg"><br><br>  Mais regarder avec les yeux l'image que je montrais n'est pas tr√®s pratique.  Autrement dit, vous ne pouvez pas le vendre √† un officier de garde, car dans chaque section, vous devez tout √©valuer avec vos yeux.  Et nous sommes arriv√©s au fait que je veux avoir une alerte.  Je veux qu'une lumi√®re s'allume: un appareil tel ou tel est un probl√®me;  un autre appareil pose probl√®me. <br><br>  Rappelons quelques statistiques math√©matiques.  L'id√©e avec alerte est que chaque appareil est essentiellement un panier.  Nous avons une probabilit√© de succ√®s et une probabilit√© d'√©chec pour quatre appareils.  La probabilit√© de retransmission dans le panier, c'est-√†-dire le succ√®s, est de ¬º.  Il s'av√®re une distribution binomiale. <br><br>  Quelle est la difficult√© de faire une alerte ici?  Le fait qu'on ne puisse pas rendre les seuils statiques, on ne peut pas dire: si dix retransmissions arrivent sur un appareil et neuf sur l'autre, alors il n'y a pas de probl√®me.  Et si dix et cinq, alors il y a un probl√®me.  Parce que si nous l'adaptons √† mille PPS, ces donn√©es ne seront plus pertinentes.  1000 PPS et 800 PPS entre diff√©rents appareils est d√©finitivement un probl√®me. <br><br>  Nous ne pouvons pas d√©finir de seuils statiques en PPS ou en octets, nous ne pouvons pas les d√©finir en pourcentage - le m√™me probl√®me avec eux.  Par cons√©quent, nous avons besoin d'une solution qui rend ce seuil plus ou moins dynamique, en fonction du nombre de paquets. <br><br>  Et le charme de la distribution binomiale est qu'√† l'augmentation du PPS, elle tend √† la normale, et pour une distribution normale, nous pouvons d√©j√† calculer l'attente, la variance et calculer l'intervalle de confiance, ce que nous avons fait.  L'intervalle de confiance pour nous est 3NPQ, c'est-√†-dire qu'il d√©pend du nombre de paquets √† travers l'appareil.  En cons√©quence, nous avons un seuil de d√©calage dynamique. <br><br>  Voici √† quoi ressemble notre signal dans l'image.  Si un appareil est √©limin√© de la distribution, nous levons un drapeau dessus - quelque chose ne va pas. <br><br><img src="https://habrastorage.org/webt/0e/bo/c_/0eboc_4g2lwamtfgsdus0o-tqzi.jpeg"><br><br>  O√π voulons-nous nous d√©velopper davantage, que voulons-nous am√©liorer ici, en plus, bien s√ªr, de la lutte contre les faux positifs?  Tout d'abord, nous serions int√©ress√©s de voir ce qu'il y avait au moment du probl√®me?  Pour ce faire, nous avons une telle option dans l'agent - Debug.  Nous pouvons t√©l√©charger exactement ce qui a √©t√© retransmis, c'est-√†-dire un paquet de 5 tuples, par exemple, dans un collecteur s√©par√©, puis le regarder.  Mais cela donne une certaine charge aux h√¥tes, il nous est donc parfois interdit de le faire.  Nous voulons fixer ERSPAN et d√©charger ces packages sur le collecteur depuis le mat√©riel lui-m√™me, car personne ne nous interdit de le faire sur le mat√©riel. <br><br>  Dima Afanasyev a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">expliqu√©</a> comment nous allons d√©velopper nos usines, et l'un des points √©tait la transition de l'usine MPLS √† IPv6 uniquement.  Qu'est-ce que cela nous donne?  MPLS a trois bits pour le marquage QoS.  En IPv6, au moins six.  Actuellement, seuls trois bits sont utilis√©s dans notre r√©seau.  Autrement dit, nous avons encore trois bits de plus dans lesquels nous pouvons mettre, en fait, toutes les informations de l'h√¥te. <br><br>  Par exemple, nous ne peignons maintenant que le premier SYN-retransmis de la session.  Et nous pouvons colorer le deuxi√®me bit, par exemple, si le paquet va vers un r√©seau externe.  Et nous pouvons retransmettre, c'est-√†-dire mettre en √©vidence un autre signal, que nous examinerons ensuite s√©par√©ment. <br><br>  De plus, la transition vers la conception avec le pod de bord, lorsque nous avons effectu√© le DCI √† un endroit particulier, nous menace du fait qu'√† cet endroit, nous pouvons contr√¥ler plus pr√©cis√©ment notre domaine diffserv.  Autrement dit, repeindre et faire quelque chose avec des peintures pour couper les faux positifs. <br><br>  En cons√©quence, faire tout ce qui pr√©c√®de s'est av√©r√© plut√¥t douloureux, mais int√©ressant.  Il n'y avait rien √† craindre.  En fait, nous avons d√©velopp√© une solution que tout le monde peut utiliser.  Il est test√© sur pratiquement tous les fournisseurs, cela fonctionne, ce n'est pas difficile.  Et cela montre vraiment quel appareil sur le r√©seau il y a un probl√®me.  Par cons√©quent, mon message est - n'ayez pas peur de faire de m√™me et laissez votre surveillance rester verte.  Merci d'avoir √©cout√©. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473834/">https://habr.com/ru/post/fr473834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473822/index.html">Offre d'emploi en 1 jour: comment nous avons interview√© et comment√© le m√™me jour</a></li>
<li><a href="../fr473824/index.html">Comment construire une technologie d'entreprise pour la planification des ventes dans un seul syst√®me</a></li>
<li><a href="../fr473826/index.html">Authentification OTP sur le serveur Web Apache</a></li>
<li><a href="../fr473828/index.html">La vision par ordinateur comme alternative aux laissez-passer de bureau</a></li>
<li><a href="../fr473832/index.html">ShIoTiny: mises √† jour et notifications</a></li>
<li><a href="../fr473838/index.html">DJI Mavic Mini: le quadricopt√®re pliant le plus l√©ger</a></li>
<li><a href="../fr473840/index.html">Diffusez des vid√©os depuis un appareil Android via UDP vers une application JAVA</a></li>
<li><a href="../fr473842/index.html">Sommaire des actualit√©s sur l'apprentissage automatique et l'intelligence artificielle d'octobre</a></li>
<li><a href="../fr473844/index.html">Pourquoi avons-nous besoin de plages de C ++ 20 dans un simple broyeur?</a></li>
<li><a href="../fr473846/index.html">Comment mesurer les performances des r√©seaux blockchain. Mesures cl√©s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>