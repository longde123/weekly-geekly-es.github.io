<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïç üêµ ‚ò¢Ô∏è Montamos um projeto conveniente da NPM para n√≥s e para a equipe ou um pouco sobre as modernas ferramentas de front-end ‚õπÔ∏è ü§æüèø üßúüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal. Recentemente, deparei-me com a tarefa de configurar pacotes npm privados. Tudo parecia muito interessante e promissor, at√© que n√£o havia ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Montamos um projeto conveniente da NPM para n√≥s e para a equipe ou um pouco sobre as modernas ferramentas de front-end</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417429/"><p><img src="https://habrastorage.org/webt/de/cu/3u/decu3uxv998uiwmqbioi99ojnfi.png"></p><br><p>  Ol√° pessoal.  Recentemente, deparei-me com a tarefa de configurar pacotes npm privados.  Tudo parecia muito interessante e promissor, at√© que n√£o havia muito o que fazer l√°.  Tudo teria terminado aqui, mas surgiu a segunda tarefa - escrever um reposit√≥rio de demonstra√ß√£o para o pacote npm, que poderia ser usado, clonado e baseado nele rapidamente, criar algo √∫til e no mesmo estilo. </p><br><p> O resultado foi um projeto com formata√ß√£o personalizada, estilo de c√≥digo, testes para cada pool, limites de cobertura de c√≥digo, relat√≥rio de cobertura de c√≥digo e documenta√ß√£o autom√°tica.  Al√©m de publica√ß√£o conveniente em npm.  Detalhes sobre a configura√ß√£o - sob o corte. </p><a name="habracut"></a><br><h2 id="trebovaniya">  Exig√™ncias </h2><br><p>  Primeiro, descobri o que j√° temos: </p><br><ul><li>  Novos projetos s√£o escritos em TypeScript </li><li>  Al√©m de novos projetos, h√° v√°rios projetos em JavaScript puro </li><li>  Existem requisitos para escrever testes e os resultados devem ser enviados para an√°lise </li></ul><br><p>  Ent√£o ele estimou sua lista de desejos - j√° que h√° tempo e desejo, por que n√£o ficar com calma?  O que eu quero mais: </p><br><ul><li>  Eu quero um estilo de formata√ß√£o uniforme </li><li>  Quero um estilo TypeScript unificado </li><li>  Quero documenta√ß√£o, mas n√£o quero escrev√™-la </li><li>  Em geral, eu quero automatizar tudo ao m√°ximo.  O que fyr-fyr-fyr e em produ√ß√£o </li></ul><br><p>  Como resultado, os requisitos tomaram forma no seguinte: </p><br><ul><li>  O m√≥dulo deve ser TypeScript e testado usando TsLint </li><li>  O m√≥dulo deve ser usado em TypeScript e em JavaScript </li><li>  Os testes devem ser configurados no git hook, a cobertura m√≠nima de c√≥digo tamb√©m deve ser configurada, as estat√≠sticas devem ser </li><li>  A formata√ß√£o deve ser configurada </li><li>  A documenta√ß√£o deve ser criada a partir do c√≥digo. </li><li>  A publica√ß√£o deve ser conveniente e consistente. </li><li>  Tudo isso pode ser automatizado </li></ul><br><p>  Parece ser bom, voc√™ precisa tentar. </p><br><h2 id="predvaritelnye-telodvizheniya">  Gestos preliminares </h2><br><p>  Criamos (clonamos) o reposit√≥rio, inicializamos o package.json, configuramos o TypeScript localmente.  Em geral, definimos todas as depend√™ncias localmente, porque  tudo ir√° para o servidor.  N√£o se esque√ßa de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">corrigir as depend√™ncias da vers√£o</a> . </p><br><pre><code class="hljs swift">git <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> npm <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> npm i -<span class="hljs-type"><span class="hljs-type">D</span></span> typescript ./node_modules/.bin/tsc --<span class="hljs-keyword"><span class="hljs-keyword">init</span></span></code> </pre> <br><p>  Imediatamente no local, voc√™ precisa ajustar o tsconfig.json por conta pr√≥pria - defina target, libs, include / exclude, outDir e outras op√ß√µes. </p><br><h2 id="stil-formatirovaniya">  Estilo de formata√ß√£o </h2><br><p>  Para manter a formata√ß√£o uniforme, peguei duas ferramentas.  O primeiro √© o arquivo .editorconfig.  Ele √© entendido por todos os principais IDEs (WebStorm, VSCode, Visual Studio etc.), n√£o requer instala√ß√£o de nada sup√©rfluo e funciona com um grande n√∫mero de tipos de arquivos - js, ts, md e assim por diante. </p><br><pre> <code class="hljs vbscript">#root = <span class="hljs-literal"><span class="hljs-literal">true</span></span> [*] indent_style = <span class="hljs-built_in"><span class="hljs-built_in">space</span></span> end_of_line = lf charset = utf<span class="hljs-number"><span class="hljs-number">-8</span></span> trim_trailing_whitespace = <span class="hljs-literal"><span class="hljs-literal">true</span></span> insert_final_newline = <span class="hljs-literal"><span class="hljs-literal">true</span></span> max_line_length = <span class="hljs-number"><span class="hljs-number">100</span></span> indent_size = <span class="hljs-number"><span class="hljs-number">4</span></span> [*.md] trim_trailing_whitespace = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><p>  Agora, o autoformato se comportar√° mais ou menos o mesmo com meus colegas. </p><br><p>  A segunda ferramenta √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mais bonita</a> .  Este √© um pacote npm que verifica e, se poss√≠vel, corrige automaticamente sua formata√ß√£o de texto.  Instale-o localmente e adicione o primeiro comando ao package.json </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D prettier</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs css">"<span class="hljs-selector-tag"><span class="hljs-selector-tag">prettier</span></span>": "<span class="hljs-selector-tag"><span class="hljs-selector-tag">prettier</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--config</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.prettierrc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--write</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">src</span></span><span class="hljs-comment"><span class="hljs-comment">/**/</span></span>*<span class="hljs-selector-class"><span class="hljs-selector-class">.ts</span></span>"</code> </pre> <br><p>  O Prettier n√£o possui um comando init, portanto voc√™ precisa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">configur√°-</a> lo manualmente.  Crie .prettierrc.json na raiz do projeto com algo parecido com este conte√∫do controverso (se houver, a postagem n√£o √© sobre quais aspas s√£o melhores, mas voc√™ pode tentar) </p><br><p>  .prettierrc.json </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"tabWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"useTabs"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"singleQuote"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"trailingComma"</span></span>: <span class="hljs-string"><span class="hljs-string">"es5"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arrowParens"</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span> }</code> </pre> <br><p>  Agora crie a pasta src, crie index.ts com algum conte√∫do condicional e tente executar mais bonita.  Se ele n√£o gostar da sua formata√ß√£o, ele a corrigir√° automaticamente.  Muito confort√°vel  Se voc√™ n√£o quiser se lembrar disso apenas durante uma confirma√ß√£o / envio, poder√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">configur√°-lo para executar automaticamente</a> ou instalar uma extens√£o para o est√∫dio. </p><br><h2 id="stil-koda">  Estilo do c√≥digo </h2><br><p>  Com o estilo do c√≥digo, tudo tamb√©m n√£o √© complicado.  Para JavaScript, existe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">eslint</a> ; para TypeScript, existe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tslint</a> .  Colocamos tslint e criamos tsconfig.js para armazenar as configura√ß√µes </p><br><pre> <code class="hljs coffeescript"><span class="hljs-built_in"><span class="hljs-built_in">npm</span></span> i -D tslint .<span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>.bin/tslint --init</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"lint"</span></span>: <span class="hljs-string"><span class="hljs-string">"tslint -c tslint.json 'src/**/*.ts' 'tests/**/*.spec.ts'"</span></span></code> </pre> <br><p>  Voc√™ pode escrever suas pr√≥prias regras ou pode usar regras existentes usando o par√¢metro extend.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aqui</a> , por exemplo, uma configura√ß√£o do airbnb. </p><br><div class="spoiler">  <b class="spoiler_title">Desenvolvedores Tslint est√£o brincando</b> <div class="spoiler_text"><pre> <code class="hljs powershell">module.exports = { extends: <span class="hljs-string"><span class="hljs-string">"./tslint-base.json"</span></span>, rules: { <span class="hljs-string"><span class="hljs-string">"no-excessive-commenting"</span></span>: [<span class="hljs-type"><span class="hljs-type">true</span></span>, {<span class="hljs-type"><span class="hljs-type">maxComments</span></span>: <span class="hljs-type"><span class="hljs-type">Math.random</span></span>() * <span class="hljs-number"><span class="hljs-number">10</span></span>}] } };</code> </pre> <br><p>  Bem, isso n√£o √© bonito? </p></div></div><br><p>  H√° um ponto importante: tslint e mais bonitos se cruzam na funcionalidade (por exemplo, no comprimento de uma string ou v√≠rgulas "penduradas").  Portanto, se voc√™ usar os dois, precisar√° monitorar a conformidade ou abandonar algo. </p><br><p>  E, no entanto, para aqueles que desejam verificar nem todos os arquivos, mas apenas em etapas - existe um pacote em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">etapas</a> </p><br><h2 id="testy">  Testes </h2><br><p>  O que precisamos dos testes acima de tudo?  Em primeiro lugar, para que iniciem automaticamente, em segundo lugar, controle de cobertura, em terceiro lugar algum relat√≥rio, de prefer√™ncia no formato lcov (se houver, lcov √© bem compreendido por diferentes analisadores - do SonarQube ao CodeCov).  Lidaremos com a automa√ß√£o um pouco mais tarde, enquanto configuramos os pr√≥prios testes. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Colocamos karma</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jasmim</a> e todo o kit corporal correspondente </p><br><pre> <code class="hljs powershell">npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> karma karma<span class="hljs-literal"><span class="hljs-literal">-jasmine</span></span> jasmine karma<span class="hljs-literal"><span class="hljs-literal">-typescript</span></span> karma<span class="hljs-literal"><span class="hljs-literal">-chrome</span></span><span class="hljs-literal"><span class="hljs-literal">-launcher</span></span> @types/jasmine ./node_modules/.bin/karma init</code> </pre> <br><p>  Modificamos um pouco o karma.conf.js e configuramos imediatamente o trabalho com cobertura </p><br><div class="spoiler">  <b class="spoiler_title">karma.conf.js</b> <div class="spoiler_text"><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">karmaTypescriptConfig</span></span> : { <span class="hljs-attribute"><span class="hljs-attribute">include</span></span>: [<span class="hljs-string"><span class="hljs-string">"./src/**/*.ts"</span></span>, <span class="hljs-string"><span class="hljs-string">"./tests/**/*.spec.ts"</span></span>], tsconfig: <span class="hljs-string"><span class="hljs-string">"./tsconfig.json"</span></span>, reports: { <span class="hljs-string"><span class="hljs-string">"html"</span></span>: <span class="hljs-string"><span class="hljs-string">"coverage"</span></span>, <span class="hljs-string"><span class="hljs-string">"lcovonly"</span></span>: { directory: <span class="hljs-string"><span class="hljs-string">'./coverage'</span></span>, filename: <span class="hljs-string"><span class="hljs-string">'../lcov.dat'</span></span> } }, <span class="hljs-selector-tag"><span class="hljs-selector-tag">coverageOptions</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">threshold</span></span>: { global: { statements: <span class="hljs-number"><span class="hljs-number">60</span></span>, branches: <span class="hljs-number"><span class="hljs-number">60</span></span>, functions: <span class="hljs-number"><span class="hljs-number">60</span></span>, lines: <span class="hljs-number"><span class="hljs-number">60</span></span>, excludes: [] }, <span class="hljs-selector-tag"><span class="hljs-selector-tag">file</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">statements</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, branches: <span class="hljs-number"><span class="hljs-number">60</span></span>, functions: <span class="hljs-number"><span class="hljs-number">60</span></span>, lines: <span class="hljs-number"><span class="hljs-number">60</span></span>, excludes: [], overrides: {} } } }, }</code> </pre> </div></div><br><p>  E, √© claro, n√£o esque√ßa de adicionar um novo comando ao package.json </p><br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"karma start"</span></span></code> </pre> <br><p>  Se voc√™ estiver usando ou planejando usar o IC, √© melhor colocar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HeadlessChrome</a> : </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D puppeteer</code> </pre> <br><p>  E pr√©-configure o Karma (corre√ß√£o do Chrome no ChromeHeadless) e mais alguma coisa.  As edi√ß√µes podem ser visualizadas no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio de demonstra√ß√£o</a> . </p><br><p>  Execute os testes, verifique se tudo funciona.  Ao mesmo tempo, verifique o relat√≥rio de cobertura (est√° na pasta de cobertura) e remova-o do controle de vers√£o, pois n√£o √© necess√°rio no reposit√≥rio. </p><br><p>  Relat√≥rio: </p><br><p><img src="https://habrastorage.org/webt/9h/0l/pi/9h0lpiplvfhu8pxbrawnnwysdw4.png"></p><br><h2 id="stil-kommitov">  Estilo de confirma√ß√£o </h2><br><p>  As confirma√ß√µes tamb√©m podem ser unificadas (e, ao mesmo tempo, levar algu√©m a ficar incandescente, se voc√™ exagerar, √© melhor sem fanatismo).  Por isso, assumi o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">compromisso</a> .  Ele funciona na forma de um di√°logo, suporta o formato de registro de altera√ß√µes convencional (voc√™ pode criar um registro de altera√ß√µes a partir de suas confirma√ß√µes) e existe um plug- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">in</a> VsCode para ele </p><br><pre> <code class="hljs powershell">npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> commitizen npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> cz<span class="hljs-literal"><span class="hljs-literal">-conventional</span></span><span class="hljs-literal"><span class="hljs-literal">-changelog</span></span></code> </pre> <br><p>  cz-convencional-changelog √© um adaptador respons√°vel por perguntas e, como resultado, pelo formato de suas confirma√ß√µes </p><br><p>  Adicione um novo comando √† se√ß√£o de scripts </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"commit"</span></span>:<span class="hljs-string"><span class="hljs-string">"git-cz"</span></span></code> </pre> <br><p>  E uma nova se√ß√£o package.json - config for commitizen </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"config"</span></span>: { <span class="hljs-string"><span class="hljs-string">"commitizen"</span></span>: { <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"./node_modules/cz-conventional-changelog"</span></span> } }</code> </pre> <br><p>  A caixa de di√°logo com o commitizen fica assim: </p><br><p><img src="https://habrastorage.org/webt/tn/xk/_l/tnxk_ll7a-chazpw8p0a2fnl3wk.png"></p><br><h2 id="dokumentaciya">  A documenta√ß√£o </h2><br><p>  Agora para a documenta√ß√£o.  Teremos dois tipos de documenta√ß√£o - do c√≥digo e do commit.  Para documenta√ß√£o do c√≥digo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usei typedoc</a> (an√°logo ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esdoc,</a> mas para TypeScript).  √â muito simples de configurar e trabalhar.  O principal √© n√£o se esque√ßa de remover os resultados de seu trabalho do controle de vers√£o. </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> typedoc -D</code> </pre> <br><p>  e atualize o package.json </p><br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"doc"</span></span>: <span class="hljs-string"><span class="hljs-string">"typedoc --out docs/src/ --readme ./README.md"</span></span></code> </pre> <br><p>  O sinalizador --readme for√ßar√° o leia-me a ser inclu√≠do na p√°gina principal da documenta√ß√£o, o que √© conveniente. </p><br><p>  O segundo tipo de documenta√ß√£o √© o changelog, e o pacote <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">changelog-cli convencional</a> nos ajudar√° com isso. </p><br><pre> <code class="hljs powershell">npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> conventional<span class="hljs-literal"><span class="hljs-literal">-changelog</span></span><span class="hljs-literal"><span class="hljs-literal">-cli</span></span></code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"changelog"</span></span>: <span class="hljs-string"><span class="hljs-string">"conventional-changelog -p angular -i CHANGELOG.md -s"</span></span></code> </pre> <br><p>  Do angular, h√° apenas formata√ß√£o e nada mais.  Agora, para atualizar o changelog, basta executar o npm run changelog.  O principal √© escrever cuidadosamente as confirma√ß√µes.  Bem, sempre escrevemos confirma√ß√µes perfeitas, portanto isso n√£o deve ser um problema. </p><br><h2 id="bild">  Construir </h2><br><p>  Como nosso pacote tamb√©m deve funcionar para JavaScript, precisamos transformar o TypeScript em JavaScript.  Al√©m disso, seria bom fazer um pacote compactado, apenas por precau√ß√£o.  Para isso, precisamos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uglifyjs</a> e um pequeno pacote de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ajustes.json</a> </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D uglifyjs</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"clean"</span></span>:<span class="hljs-string"><span class="hljs-string">"rmdir dist /S /Q"</span></span>, <span class="hljs-string"><span class="hljs-string">"build"</span></span>: <span class="hljs-string"><span class="hljs-string">"tsc --p ./ --sourceMap false"</span></span>, <span class="hljs-string"><span class="hljs-string">"bundle"</span></span>: <span class="hljs-string"><span class="hljs-string">"uglifyjs ./dist/*.js --compress --mangle --output ./dist/index.min.js"</span></span></code> </pre> <br><p>  A prop√≥sito, se voc√™ deseja controlar o tamanho do seu projeto, existem mais dois pacotes interessantes </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tamanho de pacote</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sizelimit</a> - a mesma coisa, mas no webpack </li></ul><br><p>  Eles tamb√©m podem ser integrados no processo de confirma√ß√£o / envio / publica√ß√£o para permanecer no tamanho aceit√°vel do pacote configur√°vel.  Muito, muito √∫til. </p><br><h2 id="avtomatizaciya">  Automa√ß√£o </h2><br><p>  Bem, j√° tomamos as etapas b√°sicas, agora tudo precisa ser automatizado; caso contr√°rio, ser√° francamente inconveniente para o trabalho. </p><br><p>  Para isso, precisamos de mais um pacote - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">husky</a> .  Ele reescreve o git hooks e chama os comandos associados do package.json.  Por exemplo, quando voc√™ confirma, o pr√©-comprometimento funciona, o push-push e assim por diante.  Se o script retornar um erro, a confirma√ß√£o falhar√°. </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D husky</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"precommit"</span></span>:<span class="hljs-string"><span class="hljs-string">"npm run prettier"</span></span>, <span class="hljs-string"><span class="hljs-string">"prepush"</span></span>: <span class="hljs-string"><span class="hljs-string">"call npm run lint &amp;&amp; call npm run test"</span></span></code> </pre> <br><p>  H√° uma nuance importante aqui, o uso da sintaxe de chamada n√£o √© multiplataforma e n√£o decola em sistemas unix.  Portanto, se voc√™ quiser fazer tudo honestamente, tamb√©m precisar√° instalar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pacote npm-run-all</a> , mas o mesmo ser√° feito em v√°rias plataformas. </p><br><h2 id="publikaciya">  Postagem </h2><br><p>  Bem, aqui chegamos √† publica√ß√£o do nosso pacote (embora vazio).  Vamos pensar o que queremos da publica√ß√£o? </p><br><ul><li>  Teste tudo de novo </li><li>  Coletar artefatos de constru√ß√£o </li><li>  Coletar documenta√ß√£o </li><li>  Aumentar vers√£o </li><li>  Gatilho de tags </li><li>  Enviar para npm </li></ul><br><p>  As m√£os fazem tudo - triste.  Ou voc√™ esquece alguma coisa ou precisa escrever uma lista de verifica√ß√£o.  Tamb√©m √© necess√°rio automatizar.  Voc√™ pode colocar outro pacote - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">solte</a> .  E voc√™ pode usar os ganchos nativos do pr√≥prio npm - prevers√£o, vers√£o, p√≥s-vers√£o, por exemplo: </p><br><pre> <code class="hljs sql">"preversion": "npm run test", "version": "<span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run clean &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run <span class="hljs-keyword"><span class="hljs-keyword">build</span></span> &amp;&amp; npm run bundle &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run doc &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run changelog &amp;&amp; git <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> . &amp;&amp; git <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> -m <span class="hljs-string"><span class="hljs-string">'changelogupdate'</span></span> <span class="hljs-comment"><span class="hljs-comment">--no-verify", "postversion": "git add . &amp;&amp; git push &amp;&amp; git push --tags",</span></span></code> </pre> <br><p>  Resta especificar para package.json o que incluir no pacote, o ponto de entrada e o caminho para nossos tipos (n√£o esque√ßa de especificar o sinalizador --declaration em tsconfig.json para obter os arquivos d.ts) </p><br><p>  package.json </p><br><pre> <code class="hljs powershell"><span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"./dist/index.min.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"types"</span></span>: <span class="hljs-string"><span class="hljs-string">"./dist/index.d.ts"</span></span>, <span class="hljs-string"><span class="hljs-string">"files"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"dist/"</span></span>, <span class="hljs-string"><span class="hljs-string">"src/"</span></span>, <span class="hljs-string"><span class="hljs-string">"tests/"</span></span> ]</code> </pre> <br><p>  Bem, isso parece ser tudo.  Agora apenas fa√ßa </p><br><pre> <code class="hljs coffeescript"><span class="hljs-built_in"><span class="hljs-built_in">npm</span></span> version ... <span class="hljs-built_in"><span class="hljs-built_in">npm</span></span> publish</code> </pre> <br><p>  E tudo o mais ser√° feito automaticamente. </p><br><h2 id="bonus">  B√¥nus </h2><br><p>  Como b√¥nus, existe um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio de demonstra√ß√£o</a> que suporta tudo isso + CI usando travis-ci.  Deixe-me lembr√°-lo de que o HeadlessChrome est√° configurado l√°; portanto, se isso for importante para voc√™, recomendo que voc√™ procure l√°. </p><br><h2 id="blagodarnosti">  Agradecimentos </h2><br><p>  Muito obrigado a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Alexei Volkov</a> por seu relat√≥rio sobre o JsFest, que se tornou a base deste artigo. </p><br><p>  Gra√ßas ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">max7z</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">indestrut√≠vel</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">justboris</a> por esclarecer que os caminhos para as depend√™ncias locais podem ser omitidos. </p><br><h2 id="i-nemnogo-statistiki">  E algumas estat√≠sticas </h2><br><ul><li>  Tamanho dos n√≥s de m√≥dulo: 444 MB (NTFS) </li><li>  N√∫mero de depend√™ncias do primeiro n√≠vel: 17 </li><li>  Total de pacotes usados: 643 </li></ul><br><h2 id="poleznye-ssylki">  Links √∫teis </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">.editorconfig</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mais bonita</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tslint</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">eslint</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">typedoc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esdoc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">comprometer</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Plugin commitizen para vscode</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">changelog convencional</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uglifyjs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tamanho de pacote</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sizelimit</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rouco</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">npm-run-all</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desencadear</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio de demonstra√ß√£o</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt417429/">https://habr.com/ru/post/pt417429/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt417415/index.html">Aulas de impress√£o 3D. Impress√£o de pe√ßas com diferentes espessuras de camada do 3Dtool</a></li>
<li><a href="../pt417419/index.html">[Yekaterinburg, an√∫ncio] Alice visitando Kontur - hackathon para criar habilidades para assistentes de voz</a></li>
<li><a href="../pt417421/index.html">Tornando-se dalt√¥nico: um experimento de empatia</a></li>
<li><a href="../pt417423/index.html">33 dicas para o marketing da OIC</a></li>
<li><a href="../pt417427/index.html">V√≠deo do UralJS # 8 mitap - trabalhando com dados brutos em um navegador e escrevendo habilidades para Alice</a></li>
<li><a href="../pt417431/index.html">Anti-entrevista</a></li>
<li><a href="../pt417435/index.html">Um erro de digita√ß√£o foi encontrado na configura√ß√£o Aliens: Colonial Marines, devido √† qual o jogo AI estava com erros por quatro anos</a></li>
<li><a href="../pt417437/index.html">Projetor vs tela plana. Tentamos o manto de um oftalmologista e descobrimos por que o tamanho importa</a></li>
<li><a href="../pt417439/index.html">O Intel Core i7-8086K (parte 1)</a></li>
<li><a href="../pt417441/index.html">Como eliminamos jogadores comuns e por DDoS ou nossos servidores: um guia pr√°tico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>