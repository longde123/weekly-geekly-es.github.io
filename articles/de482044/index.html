<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÄ üë∏üèø üßëüèæ‚Äçü§ù‚Äçüßëüèæ 10 Best Practices zum Sichern von Docker-Images. Teil 2 üê• üßíüèΩ ü§£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine √úbersetzung des Artikels wurde speziell f√ºr Studenten des Linux-Sicherheitskurses erstellt . 


 Lesen Sie den ersten Teil 

 5. Belassen Sie kei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>10 Best Practices zum Sichern von Docker-Images. Teil 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/482044/">  <i>Eine √úbersetzung des Artikels wurde speziell f√ºr Studenten des <a href="https://otus.pw/Z04t/">Linux-Sicherheitskurses erstellt</a> .</i> <br><br><img src="https://habrastorage.org/webt/cd/uv/fr/cduvfrdqonmoqahspgrc3xr5zgc.png"><br>  <a href="https://habr.com/ru/company/otus/blog/480970/">Lesen Sie den ersten Teil</a> <br><hr><br><h3>  5. Belassen Sie keine sensiblen Daten in Docker-Bildern </h3><br>  Manchmal ben√∂tigen Sie beim Erstellen einer Anwendung in einem Docker-Image vertrauliche Daten wie einen privaten SSH-Schl√ºssel zum Extrahieren von Code aus einem privaten Repository oder Token zum Installieren geschlossener Pakete.  Wenn Sie sie in einen Docker-Zwischencontainer kopieren, werden sie in der Ebene zwischengespeichert, zu der sie hinzugef√ºgt wurden, auch wenn Sie sie sp√§ter l√∂schen.  Diese Token und Schl√ºssel m√ºssen au√üerhalb der <code>Dockerfile</code> gespeichert werden. <a name="habracut"></a><br><br><h4>  Verwenden Sie mehrstufige Builds </h4><br>  Bearbeiten Sie mithilfe der Docker-Unterst√ºtzung f√ºr mehrstufige Builds Geheimnisse in der mittleren Bildebene, die anschlie√üend gel√∂scht werden, damit keine vertraulichen Daten den endg√ºltigen Build erreichen.  Verwenden Sie den folgenden Code, um geheime Daten zur Middleware hinzuzuf√ºgen: <br><br><pre> <code class="bash hljs">FROM: ubuntu as intermediate WORKDIR /app COPY secret/key /tmp/ RUN scp -i /tmp/key build@acme/files . FROM ubuntu WORKDIR /app COPY --from=intermediate /app .</code> </pre> <br><h4>  Verwenden Sie Docker Secrets-Befehle </h4><br>  Verwenden Sie die Alpha-Funktion in Docker, um vertrauliche Daten zu verwalten und vertrauliche Dateien bereitzustellen, ohne sie zwischenzuspeichern: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># syntax = docker/dockerfile:1.0-experimental FROM alpine # shows secret from default secret location RUN --mount=type=secret,id=mysecret cat /run/secrets/mysecre # shows secret from custom secret location RUN --mount=type=secret,id=mysecret,dst=/foobar cat /foobar</span></span></code> </pre> <br>  Weitere Informationen zum Verwalten vertraulicher Daten finden Sie auf der Docker-Website. <br><br><h4>  Achten Sie auf rekursives Kopieren </h4><br>  Sie sollten auch darauf achten, Dateien in das erstellte Image zu kopieren.  Mit dem folgenden Befehl wird beispielsweise der gesamte Assemblykontextordner rekursiv in ein Docker-Image kopiert, wodurch auch vertrauliche Dateien kopiert werden k√∂nnen: <br><br><pre> <code class="bash hljs">COPY . .</code> </pre> <br>  Wenn sich in Ihrem Ordner vertrauliche Dateien befinden, l√∂schen Sie diese oder ignorieren Sie sie mit <code>.dockerignore</code> : <br><br><pre> <code class="bash hljs">private.key appsettings.json</code> </pre> <br><h3>  6. Verwenden Sie feste Tags f√ºr die Immunit√§t </h3><br>  Jedes Docker-Bild kann mehrere Tags haben, die Variationen derselben Bilder darstellen.  Das am h√§ufigsten verwendete Tag ist " <code>latest</code> und steht f√ºr die neueste Version eines Bildes.  Bild-Tags sind nicht unver√§nderlich, und ein Bildautor kann dasselbe Tag mehrmals ver√∂ffentlichen. <br><br>  Dies bedeutet, dass sich das Basisimage f√ºr Ihre Docker-Datei zwischen den Builds √§ndern kann.  Dies kann aufgrund von √Ñnderungen am Basisimage zu unerwartetem Verhalten f√ºhren. <br><br>  Es gibt verschiedene M√∂glichkeiten, um dieses Problem zu beheben: <br><br><ul><li>  Bevorzugen Sie das spezifischste verf√ºgbare Tag.  Wenn das Bild mehrere Tags hat, wie z. <code>:8.0.1</code> <code>:8</code> und <code>:8.0.1</code> oder sogar <code>:8.0.1-alpine</code> , bevorzugen Sie letzteres, da dies der spezifischste Link zum Bild ist.  Vermeiden Sie die Verwendung der g√§ngigsten Tags, z. B. "latest".  Denken Sie beim Fixieren eines bestimmten Tags daran, dass es eventuell gel√∂scht werden kann. </li><li>  Um das Problem zu beheben, dass auf ein bestimmtes Image-Tag nicht mehr zugegriffen werden kann und die Anzeigenanzeige f√ºr Gruppen, die darauf angewiesen sind, eingeschr√§nkt ist, sollten Sie einen lokalen Spiegel dieses Images in der Registrierung oder im Konto starten, die bzw. das von Ihnen gesteuert wird.  Es ist wichtig, die f√ºr diesen Ansatz erforderlichen Wartungskosten zu ber√ºcksichtigen, da dies bedeutet, dass Sie die Registrierung warten m√ºssen.  Es wird empfohlen, das Image, das Sie in Ihrer Registrierung verwenden m√∂chten, zu replizieren, um sicherzustellen, dass sich das von Ihnen verwendete Image nicht √§ndert. </li><li>  Seien Sie √§u√üerst spezifisch!  Anstatt das Tag zu ziehen, ziehen Sie das Bild mithilfe eines bestimmten SHA256-Links zum Docker-Bild, um sicherzustellen, dass Sie f√ºr jede Anforderung dasselbe Bild erhalten.  Beachten Sie jedoch, dass die Verwendung eines SHA256-Links das folgende Risiko birgt: Wenn sich das Bild √§ndert, funktioniert der Hash m√∂glicherweise nicht mehr. </li></ul><br><h3>  7. Verwenden Sie KOPIEREN anstelle von HINZUF√úGEN </h3><br>  Docker bietet zwei Befehle zum Kopieren von Dateien vom Host in das Docker-Image, wenn es erstellt wird: <code>COPY</code> und <code>ADD</code> .  Befehle sind von Natur aus √§hnlich, unterscheiden sich jedoch in ihrer Funktionalit√§t: <br><br><ul><li>  KOPIEREN - kopiert rekursiv lokale Dateien und gibt dabei die Quell- und Zieldateien oder Verzeichnisse an.  Mit COPY m√ºssen Sie Standorte deklarieren. </li><li>  ADD - kopiert rekursiv lokale Dateien, erstellt implizit ein Zielverzeichnis, wenn es nicht vorhanden ist, und akzeptiert Archive als lokale oder ferne URLs als Quelle, die es erweitert oder in das Zielverzeichnis l√§dt. <br>  Obwohl die Unterschiede zwischen ADD und COPY nicht so grundlegend sind, sind sie wichtig.  Seien Sie sich dessen bewusst, um potenzielle Sicherheitsprobleme zu vermeiden: </li><li>  Wenn Remote-URLs verwendet werden, um Daten direkt an ihren urspr√ºnglichen Speicherort herunterzuladen, kann dies zu Brokerangriffen f√ºhren, die den Inhalt der heruntergeladenen Datei √§ndern.  Dar√ºber hinaus m√ºssen Herkunft und Authentizit√§t von Remote-URLs weiter √ºberpr√ºft werden.  Bei Verwendung von COPY muss die Quelle f√ºr Dateien, die von Remote-URLs heruntergeladen werden sollen, √ºber eine sichere TLS-Verbindung angegeben und ihre Herkunft muss ebenfalls √ºberpr√ºft werden. </li><li>  Hinweise zum Speicherplatz und zu den Bildebenen: Mit COPY k√∂nnen Sie das Hinzuf√ºgen des Archivs von entfernten Speicherorten trennen und in verschiedene Ebenen entpacken, wodurch der Cache der Bilder optimiert wird.  Wenn Remotedateien erforderlich sind, kombinieren Sie alle Dateien zu einem RUN-Befehl, der anschlie√üend herunterl√§dt, extrahiert und l√∂scht. Auf diese Weise wird der einschichtige Vorgang auf mehreren Ebenen optimiert, die mithilfe von ADD erforderlich w√§ren. </li><li>  Wenn lokale Archive verwendet werden, extrahiert ADD diese automatisch in das Zielverzeichnis.  Dies ist zwar akzeptabel, birgt jedoch das Risiko, dass Zip-Bomben und <a href="https://snyk.io/research/zip-slip-vulnerability">Zip Slip-Sicherheitsl√ºcken entstehen</a> , die dann automatisch gestartet werden k√∂nnen. </li></ul><br><h3>  8. Verwenden Sie Metadaten-Tags </h3><br>  Bildbezeichnungen stellen Metadaten f√ºr die von Ihnen erstellten Bilder bereit.  Auf diese Weise k√∂nnen Benutzer leichter herausfinden, wie das Bild verwendet wird.  Das am h√§ufigsten verwendete Tag lautet "Betreuer" und gibt die E-Mail-Adresse und den Namen der Person an, die dieses Bild unterst√ºtzt.  F√ºgen Sie Metadaten mit dem folgenden <code>LABEL</code> Befehl hinzu: <br><br><pre> <code class="bash hljs">LABEL maintainer=<span class="hljs-string"><span class="hljs-string">"me@acme.com"</span></span></code> </pre> <br>  F√ºgen Sie zus√§tzlich zu den Kontakten des Betreuers alle f√ºr Sie wichtigen Metadaten hinzu.  Diese Metadaten k√∂nnen Folgendes enthalten: einen Festschreibungs-Hash, einen Link zur entsprechenden Assembly, einen Qualit√§tsstatus (wurden alle Tests bestanden?), Einen Quellcode, einen Link zum Speicherort der Datei SECURITY.TXT usw. <br><br>  Es wird empfohlen, die Datei <a href="https://securitytxt.org/">SECURITY.TXT</a> (RFC5785) zu unterst√ºtzen, die auf Ihre Richtlinie zur verantwortlichen Offenlegung f√ºr Ihr Docker-Etikettenschema verweist, wenn Sie neue hinzuf√ºgen. Beispiel: <br><br><pre> <code class="bash hljs">LABEL securitytxt=<span class="hljs-string"><span class="hljs-string">"https://www.example.com/.well-known/security.txt"</span></span></code> </pre> <br>  Weitere Label-Informationen f√ºr Docker-Images anzeigen: <br><br>  <a href="https://label-schema.org/rc1/">https://label-schema.org/rc1/</a> <br><br><h3>  9. Verwenden Sie eine mehrstufige Baugruppe f√ºr kleine und sichere Bilder </h3><br>  Wenn Sie eine Anwendung mit dem <code>Dockerfile</code> , werden viele Artefakte erstellt, die nur zum Zeitpunkt der <code>Dockerfile</code> erforderlich sind.  Dies k√∂nnen Entwicklungstools und Bibliotheken sein, die zum Kompilieren ben√∂tigt werden, oder Abh√§ngigkeiten, die zum Ausf√ºhren von Komponententests, tempor√§ren Dateien, Geheimnissen usw. ben√∂tigt werden. <br><br>  Das Speichern dieser Artefakte in einem Basis-Image, das in der Produktion verwendet werden kann, f√ºhrt zu einer Vergr√∂√üerung des Docker-Images, was sich erheblich auf die Zeit zum Herunterladen auswirken und auch die Angriffsfl√§che erh√∂hen kann, wodurch mehr Pakete installiert werden.  Dasselbe gilt f√ºr das Docker-Image, das Sie verwenden. M√∂glicherweise ben√∂tigen Sie ein bestimmtes Docker-Image, um den Anwendungscode zu erstellen, aber nicht, um ihn auszuf√ºhren. <br><br>  Golang ist ein gutes Beispiel.  Um eine Golang-Anwendung zu erstellen, ben√∂tigen Sie einen Go-Compiler.  Der Compiler erstellt eine ausf√ºhrbare Datei, die auf jedem Betriebssystem ohne Abh√§ngigkeiten ausgef√ºhrt wird, einschlie√ülich sauberer Abbilder. <br><br>  Dies ist ein guter Grund, warum Docker in der Lage ist, in Etappen zu bauen.  Mit dieser Funktion k√∂nnen Sie w√§hrend des Zusammenbaus mehrere tempor√§re Bilder verwenden und nur das letzte Bild zusammen mit den Informationen speichern, die Sie in das Bild kopiert haben.  Sie haben also zwei Bilder: <br><br><ul><li>  Das erste Image ist sehr gro√ü und mit vielen Abh√§ngigkeiten verbunden, die zum Erstellen der Anwendung und Ausf√ºhren der Tests verwendet werden. </li><li>  Das zweite Bild ist in Bezug auf Gr√∂√üe und Anzahl der Bibliotheken sehr hell und enth√§lt nur Kopien der Artefakte, die zum Ausf√ºhren der Anwendung in der Produktion erforderlich sind. </li></ul><br><h3>  10. Verwenden Sie den Linter </h3><br>  Verwenden Sie den Linter, um h√§ufige Fehler zu vermeiden und Best Practices zu etablieren, die Ingenieure automatisch befolgen k√∂nnen. <br><br>  Ein solcher Linter ist <a href="https://github.com/hadolint/hadolint">Hadolint</a> .  Es analysiert das Dockerfile und warnt vor Fehlern, die nicht den Empfehlungen entsprechen. <br><br><img src="https://habrastorage.org/webt/ka/at/b5/kaatb5gbkyhycanjgi0x6pk0nqy.png"><br><br>  Hadolint wird in einer integrierten Entwicklungsumgebung (IDE) noch leistungsf√§higer.  Wenn Sie beispielsweise hadolint als <a href="https://marketplace.visualstudio.com/items%3FitemName%3Dexiasr.hadolint">VSCode-Erweiterung verwenden,</a> treten bei der Eingabe <a href="https://marketplace.visualstudio.com/items%3FitemName%3Dexiasr.hadolint">Flusenfehler</a> auf.  Dies hilft beim schnelleren Schreiben der besten Dockerdateien. <br><br>  <a href="https://snyk.io/container-vulnerability-management/">Weitere Informationen zum Schutz Ihrer Docker-Bilder.</a> <a href="https://snyk.io/container-vulnerability-management/"><br></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de482044/">https://habr.com/ru/post/de482044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de482030/index.html">Vue.js: Lifecycle-Hooks f√ºr Ihre und Komponenten von Drittanbietern</a></li>
<li><a href="../de482034/index.html">Yandex: Es gibt alles ... √ºber Benutzer</a></li>
<li><a href="../de482038/index.html">Wir fassen die Ergebnisse von 2019 bei Haber Career zusammen</a></li>
<li><a href="../de482040/index.html">Enth√§lt Profiling-Programme in C ++</a></li>
<li><a href="../de482042/index.html">Arbeiten mit der Newtonsoft.Json-Bibliothek anhand eines realen Beispiels. Teil 2</a></li>
<li><a href="../de482050/index.html">Jedi Convolution Network Reduction-Technik - Beschneiden</a></li>
<li><a href="../de482052/index.html">Neujahrs-Datensatz 2019: offenes Tonw√∂rterbuch der russischen Sprache</a></li>
<li><a href="../de482054/index.html">3. Elastic Stack: Sicherheitsprotokollanalyse. Dashboards</a></li>
<li><a href="../de482058/index.html">Raubtier oder Beute? Wer sch√ºtzt die Zertifizierungsstellen?</a></li>
<li><a href="../de482060/index.html">Access Control Mandate Model (MAC): √úbersicht und Anwendungsapplikationen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>